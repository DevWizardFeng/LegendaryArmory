<h1 _ngcontent-nhh-c119="" class="doc-title ng-star-inserted" title="动态照片拍摄(ArkTS)"> 动态照片拍摄(ArkTS) </h1>

<div _ngcontent-nhh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>相机框架提供动态照片拍摄能力，业务应用可以类似拍摄普通照片一样，一键式拍摄得到动态照片。</p>    <p>应用开发动态照片主要分为以下步骤：</p>    <ul>     <li>应用开发动态照片前，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation">申请相机开发的权限</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-device-management">相机管理</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-device-input">设备输入</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-session-management">会话管理</a>等流程完成相机应用开发必选能力配置。</li>     <li>查询当前设备的当前模式是否支持拍摄动态照片。</li>     <li>如果支持动态照片，可以调用相机框架提供的使能接口<strong>使能</strong>动态照片能力。</li>     <li>监听照片回调，将照片存入媒体库。可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-movingphoto">MediaLibrary Kit-访问和管理动态照片资源</a>。</li>    </ul>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>拍摄动态照片需要麦克风权限ohos.permission.MICROPHONE，权限申请和校验的方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation">开发准备</a>。否则拍摄的照片没有声音。</li>       </ul>      </div></div></div>     <ol>      <li>       <p>导入依赖，需要导入相机框架、媒体库、图片相关领域依赖。</p>       <div _ngcontent-nhh-c106="" class="highlight-div"><div _ngcontent-nhh-c106="" class="highlight-div-header"><div _ngcontent-nhh-c106="" class="highlight-div-header-left"><div _ngcontent-nhh-c106="" class="handle-button expand-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhh-c106="" class="highlight-div-header-right"><div _ngcontent-nhh-c106="" class="handle-button ai-button"></div><div _ngcontent-nhh-c106="" class="handle-button line-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhh-c106="" class="handle-button theme-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhh-c106="" class="handle-button copy-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>确定拍照输出流。</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>中的photoProfiles属性，可获取当前设备支持的拍照输出流，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createphotooutput11" target="_blank">createPhotoOutput</a>方法创建拍照输出流。</p>       <div _ngcontent-nhh-c106="" class="highlight-div"><div _ngcontent-nhh-c106="" class="highlight-div-header"><div _ngcontent-nhh-c106="" class="highlight-div-header-left"><div _ngcontent-nhh-c106="" class="handle-button expand-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhh-c106="" class="highlight-div-header-right"><div _ngcontent-nhh-c106="" class="handle-button ai-button"></div><div _ngcontent-nhh-c106="" class="handle-button line-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhh-c106="" class="handle-button theme-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhh-c106="" class="handle-button copy-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoOutput</span>(<span class="hljs-params">cameraManager: camera.CameraManager,</span></li><li><span class="hljs-params">  cameraOutputCapability: camera.CameraOutputCapability</span>): camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">if</span> (!cameraOutputCapability || !cameraOutputCapability.<span class="hljs-property">photoProfiles</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoProfilesArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = cameraOutputCapability.<span class="hljs-property">photoProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (!photoProfilesArray || photoProfilesArray.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"photoProfilesArray is null or []"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOutput</span>: camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>(photoProfilesArray[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPhotoOutput. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> photoOutput;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>查询当前设备当前模式是否支持动态照片能力。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>查询是否支持动态照片前需要先完成相机会话配置、提交和启动会话，详细开发步骤请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-session-management">会话管理</a>。</p>        </div></div></div>       <div _ngcontent-nhh-c106="" class="highlight-div"><div _ngcontent-nhh-c106="" class="highlight-div-header"><div _ngcontent-nhh-c106="" class="highlight-div-header-left"><div _ngcontent-nhh-c106="" class="handle-button expand-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhh-c106="" class="highlight-div-header-right"><div _ngcontent-nhh-c106="" class="handle-button ai-button"></div><div _ngcontent-nhh-c106="" class="handle-button line-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhh-c106="" class="handle-button theme-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhh-c106="" class="handle-button copy-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">isMovingPhotoSupported</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">isSupported</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    isSupported = photoOutput.<span class="hljs-title function_">isMovingPhotoSupported</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 失败返回错误码error.code并处理。</span></li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`The isMovingPhotoSupported call failed. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> isSupported;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使能动态照片拍照能力。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>使能动态照片前需要使能<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-deferred-capture">分段式拍照</a>能力。</p>        </div></div></div>       <div _ngcontent-nhh-c106="" class="highlight-div"><div _ngcontent-nhh-c106="" class="highlight-div-header"><div _ngcontent-nhh-c106="" class="highlight-div-header-left"><div _ngcontent-nhh-c106="" class="handle-button expand-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhh-c106="" class="highlight-div-header-right"><div _ngcontent-nhh-c106="" class="handle-button ai-button"></div><div _ngcontent-nhh-c106="" class="handle-button line-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhh-c106="" class="handle-button theme-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhh-c106="" class="handle-button copy-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">enableMovingPhoto</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput.<span class="hljs-title function_">enableMovingPhoto</span>(<span class="hljs-literal">true</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 失败返回错误码error.code并处理。</span></li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`The enableMovingPhoto call failed. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>触发拍照，与普通拍照方式相同，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-shooting">拍照</a>。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听动态照片拍照输出流状态。通过注册photoAsset的回调函数获取监听结果，photoOutput创建成功时即可监听。</p>     <div _ngcontent-nhh-c106="" class="highlight-div"><div _ngcontent-nhh-c106="" class="highlight-div-header"><div _ngcontent-nhh-c106="" class="highlight-div-header-left"><div _ngcontent-nhh-c106="" class="handle-button expand-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhh-c106="" class="highlight-div-header-right"><div _ngcontent-nhh-c106="" class="handle-button ai-button"></div><div _ngcontent-nhh-c106="" class="handle-button line-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhh-c106="" class="handle-button theme-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhh-c106="" class="handle-button copy-button"><div _ngcontent-nhh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoAccessHelper</span>(<span class="hljs-params">context: Context</span>): photoAccessHelper.<span class="hljs-property">PhotoAccessHelper</span> {</li><li>  <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>  <span class="hljs-keyword">return</span> phAccessHelper;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mediaLibSavePhoto</span>(<span class="hljs-params">photoAsset: photoAccessHelper.PhotoAsset,</span></li><li><span class="hljs-params">  phAccessHelper: photoAccessHelper.PhotoAccessHelper</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">assetChangeRequest</span>: photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">MediaAssetChangeRequest</span>(photoAsset);</li><li>    assetChangeRequest.<span class="hljs-title function_">saveCameraPhoto</span>();</li><li>    <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">applyChanges</span>(assetChangeRequest);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'apply saveCameraPhoto successfully'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`apply saveCameraPhoto failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputPhotoAssetAvailable</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput, context: Context</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAssetAvailable'</span>, (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">photoAsset</span>: photoAccessHelper.<span class="hljs-property">PhotoAsset</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`photoAssetAvailable error: <span class="hljs-subst">${err}</span>.`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'photoOutPutCallBack photoAssetAvailable'</span>);</li><li>    <span class="hljs-comment">// 调用媒体库落盘接口保存一阶段图和动态照片视频。</span></li><li>    <span class="hljs-title function_">mediaLibSavePhoto</span>(photoAsset, <span class="hljs-title function_">getPhotoAccessHelper</span>(context));</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>