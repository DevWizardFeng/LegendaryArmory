<h1 _ngcontent-iaj-c119="" class="doc-title ng-star-inserted" title="动态调整预览帧率(ArkTS)"> 动态调整预览帧率(ArkTS) </h1>

<div _ngcontent-iaj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>动态调整帧率是直播、视频等场景下控制预览效果的重要能力之一。应用可通过此能力，显性地控制流输出帧率，以适应不同帧率下的业务目标。</p> <p>某些场景下降低帧率可在相机设备启用时降低功耗。</p> <div class="tiledSection"><h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2><p>支持的帧率范围及帧率的设置依赖于硬件能力的实现，不同的硬件平台可能拥有不同的默认帧率。</p> </div> <div class="tiledSection"><h2 id="section1159277538">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section1159277538" tips="复制节点链接"></i></h2><p>相机使用预览功能前，均需要创建相机会话。完成会话配置后，应用提交和开启会话，才可以开始调用相机相关功能。</p> <p>流程图如下所示：</p> <p><span><img originheight="1124" originwidth="1016" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114440.24653897280917450202121418785610:50001231000000:2800:227C357DAB7291FFEED4878C162CBE549B0A76A3815398E0EF20EF5CD4CE19E5.png" width="920" height="1017.7952755905511"></span></p> <p>与普通的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preview" target="_blank">预览</a>流程相比，动态调整预览帧率的注意点如图上标识：</p> <ol><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createsession11" target="_blank">createSession</a>创建会话（Session）时，需要指定模式为NORMAL_PHOTO或NORMAL_VIDEO。<p>仅当Session处于NORMAL_PHOTO或NORMAL_VIDEO模式时，支持调整预览流帧率。调整帧率的创建会话方式见<a href="/consumer/cn/doc/harmonyos-guides/camera-framerate#section20428202912114">创建Session会话并指定模式</a>。</p> </li><li><a href="/consumer/cn/doc/harmonyos-guides/camera-framerate#section95234419219">动态调整帧率</a>的操作，可在启动预览前后任意时刻调用。</li><li><a href="/consumer/cn/doc/harmonyos-guides/camera-framerate#section95234419219">动态调整帧率</a>在预览里属于可选操作，可以完成：<ul><li>查询当前支持调整的帧率范围</li><li>设置当前帧率</li><li>获取当前生效的帧率设置</li></ul> </li></ol> <p>如何配置会话（Session）、释放资源，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-session-management" target="_blank">会话管理</a> &gt; <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preview" target="_blank">预览</a>，或是<a href="/consumer/cn/doc/harmonyos-guides/camera-framerate#完整流程">完整流程</a>示例。</p> </div> <div class="tiledSection"><h2 id="section389318418563">导入依赖<i class="anchor-icon anchor-icon-link" anchorid="section389318418563" tips="复制节点链接"></i></h2><div class="p">导入camera接口，接口中提供了相机相关的属性和方法，导入方法如下。<div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section20428202912114">创建Session会话并指定模式<i class="anchor-icon anchor-icon-link" anchorid="section20428202912114" tips="复制节点链接"></i></h2><p>相机使用预览等功能前，均需完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-device-management" target="_blank">相机管理</a>和创建相机会话，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager" target="_blank">CameraManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createsession11" target="_blank">createSession</a>创建一个会话。</p> <p>创建会话时需指定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#scenemode11" target="_blank">SceneMode</a>为NORMAL_PHOTO或NORMAL_VIDEO，创建出的Session处于拍照或录像模式。</p> <p>以创建Session会话并指定为NORMAL_PHOTO模式为例：</p> <div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPhotoSession</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>): camera.<span class="hljs-property">Session</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: camera.<span class="hljs-property">Session</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 创建Session会话并指定为NORMAL_PHOTO模式</span></li><li>    session = cameraManager.<span class="hljs-title function_">createSession</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create the session instance. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> session;</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section95234419219">调整帧率<i class="anchor-icon anchor-icon-link" anchorid="section95234419219" tips="复制节点链接"></i></h2><ol><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput" target="_blank">PreviewOutput</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput#getsupportedframerates12" target="_blank">getSupportedFrameRates</a>，查询当前支持的帧率范围。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要在Session调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#commitconfig11" target="_blank">commitConfig</a>完成配流之后调用。</p> </div></div></div> <div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSupportedFrameRange</span>(<span class="hljs-params">previewOutput: camera.PreviewOutput</span>): <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">FrameRateRange</span>&gt; {</li><li><span class="hljs-comment">// 获取支持的帧率范围，不同的硬件平台可能提供不同的帧率范围</span></li><li>  <span class="hljs-keyword">return</span> previewOutput.<span class="hljs-title function_">getSupportedFrameRates</span>();</li><li>}</li></ol></pre></div></div> </li><li><p>根据实际开发需求，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput" target="_blank">PreviewOutput</a>类提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput#setframerate12" target="_blank">setFrameRate</a>接口对帧率进行动态调整。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p><strong>调用时机：</strong></p> <ul><li>需要在Session调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#commitconfig11" target="_blank">commitConfig</a>完成配流之后调用。</li><li>可在Session调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#start11" target="_blank">start</a>启动预览前后任意时刻调用。</li></ul> <p><strong>setFrameRate调用限制：</strong></p> <ul><li>在调用setFrameRate接口设置非固定帧率后，不支持再次调用该接口重新设置动态帧率。</li><li>在调用setFrameRate接口设置固定帧率后，支持重新设置固定帧率，但必须保证新设置的帧率可以整除之前设置的帧率或者被之前设置的帧率整除。</li></ul> </div></div></div> <div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setFrameRate</span>(<span class="hljs-params">previewOutput: camera.PreviewOutput, minFps: <span class="hljs-built_in">number</span>, maxFps: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    previewOutput.<span class="hljs-title function_">setFrameRate</span>(minFps, maxFps);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to setFrameRate for previewOutput. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li><p>（可选）通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput" target="_blank">PreviewOutput</a>提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput#getactiveframerate12" target="_blank">getActiveFrameRate</a>接口查询已设置过并生效的帧率。</p> <div class="p">仅通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput#setframerate12" target="_blank">setFrameRate</a>接口显性设置过帧率才可查询当前生效帧率信息。<div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getActiveFrameRange</span>(<span class="hljs-params">previewOutput: camera.PreviewOutput</span>): camera.<span class="hljs-property">FrameRateRange</span> {</li><li>  <span class="hljs-keyword">return</span> previewOutput.<span class="hljs-title function_">getActiveFrameRate</span>();</li><li>}</li></ol></pre></div></div> </div> </li></ol> </div> <div class="tiledSection"><h2 id="完整流程">完整流程<i class="anchor-icon anchor-icon-link" anchorid="完整流程" tips="复制节点链接"></i></h2><p>结合上述开发流程1~3，完整的session配流及previewOutput在session.start前后调整帧率示例代码如下。</p> <div _ngcontent-iaj-c106="" class="highlight-div"><div _ngcontent-iaj-c106="" class="highlight-div-header"><div _ngcontent-iaj-c106="" class="highlight-div-header-left"><div _ngcontent-iaj-c106="" class="handle-button expand-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iaj-c106="" class="highlight-div-header-right"><div _ngcontent-iaj-c106="" class="handle-button ai-button"></div><div _ngcontent-iaj-c106="" class="handle-button line-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iaj-c106="" class="handle-button theme-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iaj-c106="" class="handle-button copy-button"><div _ngcontent-iaj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iaj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sessionConfig</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraInput: camera.CameraInput,</span></li><li><span class="hljs-params">  previewOutput: camera.PreviewOutput</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: camera.<span class="hljs-property">Session</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-comment">// 创建CaptureSession实例</span></li><li>    session = <span class="hljs-title function_">createPhotoSession</span>(cameraManager);</li><li>    <span class="hljs-keyword">if</span> (session === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 开始配置会话</span></li><li>    session.<span class="hljs-title function_">beginConfig</span>();</li><li>    <span class="hljs-comment">// 把CameraInput加入到会话</span></li><li>    session.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>    <span class="hljs-comment">// 把previewOutput加入到会话</span></li><li>    session.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>    <span class="hljs-comment">// 提交配置信息</span></li><li>    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">commitConfig</span>();</li><li>    <span class="hljs-comment">// 获取当前支持的帧率范围</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">supportFrameRateArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">FrameRateRange</span>&gt; = <span class="hljs-title function_">getSupportedFrameRange</span>(previewOutput);</li><li>
</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`frame rate supported by previewOutput: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(supportFrameRateArray)}</span>`</span>);</li><li>    <span class="hljs-comment">// 可在start前对帧率进行设置</span></li><li>    <span class="hljs-keyword">if</span> (supportFrameRateArray.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-comment">// 将帧率设置为第一组帧率范围的最大值</span></li><li>      <span class="hljs-title function_">setFrameRate</span>(previewOutput, supportFrameRateArray[<span class="hljs-number">0</span>].<span class="hljs-property">max</span>, supportFrameRateArray[<span class="hljs-number">0</span>].<span class="hljs-property">max</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 获取当前生效的帧率设置</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">activeFrameRateArray</span>: camera.<span class="hljs-property">FrameRateRange</span> = <span class="hljs-title function_">getActiveFrameRange</span>(previewOutput);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`current effective frame rate for this previewOutput: <span class="hljs-subst">${activeFrameRateArray}</span>`</span>);</li><li>    <span class="hljs-comment">// 开始会话工作并启动预览</span></li><li>    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">start</span>();</li><li>    <span class="hljs-comment">// 可在start后对帧率进行设置</span></li><li>    <span class="hljs-keyword">if</span> (supportFrameRateArray.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-comment">// 可将帧率设置为最大值的一半（能否设置成功取决于平台是否支持）</span></li><li>      <span class="hljs-title function_">setFrameRate</span>(previewOutput, supportFrameRateArray[<span class="hljs-number">0</span>].<span class="hljs-property">max</span> / <span class="hljs-number">2</span>, supportFrameRateArray[<span class="hljs-number">0</span>].<span class="hljs-property">max</span> / <span class="hljs-number">2</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 获取当前生效的帧率设置</span></li><li>    activeFrameRateArray = <span class="hljs-title function_">getActiveFrameRange</span>(previewOutput);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`current effective frame rate for this previewOutput: <span class="hljs-subst">${activeFrameRateArray}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`sessionConfig fail : <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>