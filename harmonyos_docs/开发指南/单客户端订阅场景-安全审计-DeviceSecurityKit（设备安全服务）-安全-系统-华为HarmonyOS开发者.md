<h1 _ngcontent-mox-c119="" class="doc-title ng-star-inserted" title="单客户端订阅场景"> 单客户端订阅场景 </h1>

<div _ngcontent-mox-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section14564084215">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section14564084215" tips="复制节点链接"></i></h2>          <p>提供统一的安全审计数据单客户端订阅与取消订阅接口，应用可以获取设备上的安全审计数据（如下表），以支撑审计相关业务。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.3.1.1" valign="top" width="35.410000000000004%">          <p>审计事件ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.3.1.2" valign="top" width="64.59%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x027000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>剪切板复制粘贴事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x810800800</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>账号登录登出事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x007000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>窗口截屏录屏投屏事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x00F000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>移动存储插拔事件，如U盘、存储卡等具有存储功能的外设插拔事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x02E000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>打印机事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C000007</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>文件事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C000008</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>进程创建退出事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C000009</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>网络事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C00000A</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>KIA文件拦截事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x02D000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>相机事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x010000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>应用事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x011000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>edm事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x012003000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>证书操作事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C00000B</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>KIA文件新增事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C00000C</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>KIA文件变种事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C00000E</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>网络流量事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x01C00000F</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>网络连接事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x00B000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>应用权限变更事件</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p>0x003000001</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p>DNS审计事件</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section47419315463">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section47419315463" tips="复制节点链接"></i></h2>          <p>当前能力仅支持2in1设备。</p>    </div>    <div class="tiledSection">     <h2 id="section1868103517464">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1868103517464" tips="复制节点链接"></i></h2>          <p><span><img originheight="617" originwidth="839" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115029.38664930336951919846018729163999:50001231000000:2800:011F9107943E3E8C19C98AC2391597154217BE25FE1F5E17E51C61FDAC79E2C5.png" width="839" height="617"></span></p>     <p><strong>流程说明：</strong></p>     <ol>      <li>开发者应用订阅安全审计数据。</li>      <li>Device Security Kit调用回调函数通知开发者应用，开发者应用根据审计数据进行业务处理。</li>      <li>当开发者应用不需要使用该审计数据时，取消订阅安全审计数据。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section12853714125811">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section12853714125811" tips="复制节点链接"></i></h2>          <p>以下是安全审计数据订阅与取消订阅接口，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-securityaudit-api#section10996135475216" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="47.949999999999996%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="52.05%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="47.949999999999996%">          <p>on(type: 'auditEventOccur', auditEventInfo: AuditEventInfo, callback: Callback&lt;AuditEvent&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="52.05%">          <p>订阅安全审计数据</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="47.949999999999996%">          <p>off(type: 'auditEventOccur', auditEventInfo: AuditEventInfo, callback?: Callback&lt;AuditEvent&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="52.05%">          <p>取消订阅安全审计数据</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1192801915199">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1192801915199" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>在开发准备过程中，需要申请权限：ohos.permission.QUERY_AUDIT_EVENT。</li>        <li>只允许清单内的企业类应用申请该权限，申请方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/permissions-for-enterprise-apps" target="_blank">申请使用企业类应用可用权限</a>。</li>       </ul>      </div></div></div>     <ol>      <li><span>导入Device Security Kit模块及相关公共模块。</span>       <p></p>       <div _ngcontent-mox-c106="" class="highlight-div"><div _ngcontent-mox-c106="" class="highlight-div-header"><div _ngcontent-mox-c106="" class="highlight-div-header-left"><div _ngcontent-mox-c106="" class="handle-button expand-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mox-c106="" class="highlight-div-header-right"><div _ngcontent-mox-c106="" class="handle-button ai-button"></div><div _ngcontent-mox-c106="" class="handle-button line-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mox-c106="" class="handle-button theme-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mox-c106="" class="handle-button copy-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mox-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { securityAudit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>; </li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>; </li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>订阅安全审计事件。</span>       <p></p>       <div _ngcontent-mox-c106="" class="highlight-div"><div _ngcontent-mox-c106="" class="highlight-div-header"><div _ngcontent-mox-c106="" class="highlight-div-header-left"><div _ngcontent-mox-c106="" class="handle-button expand-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mox-c106="" class="highlight-div-header-right"><div _ngcontent-mox-c106="" class="handle-button ai-button"></div><div _ngcontent-mox-c106="" class="handle-button line-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mox-c106="" class="handle-button theme-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mox-c106="" class="handle-button copy-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mox-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> TAG = <span class="hljs-string">"SecurityAuditJsTest"</span>; </li><li><span class="hljs-keyword">const</span> callback = (<span class="hljs-keyword">event</span>: securityAudit.AuditEvent) =&gt; { </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func eventId= '</span> + <span class="hljs-keyword">event</span>.eventId); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func version= '</span> + <span class="hljs-keyword">event</span>.version); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func content= '</span> + <span class="hljs-keyword">event</span>.content); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func timestamp= '</span> + <span class="hljs-keyword">event</span>.timestamp); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func userId= '</span> + <span class="hljs-keyword">event</span>.userId); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Security_SecurityAudit_JsApi_Func deviceId= '</span> + <span class="hljs-keyword">event</span>.deviceId); </li><li>}; </li><li><span class="hljs-keyword">let</span> auditEventInfo: securityAudit.AuditEventInfo = { </li><li>   eventId: <span class="hljs-number">0x810800800</span> </li><li>}; </li><li> </li><li><span class="hljs-keyword">try</span> { </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'on begin.'</span>); </li><li>  securityAudit.<span class="hljs-keyword">on</span>(<span class="hljs-string">'auditEventOccur'</span>, auditEventInfo, callback); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'Succeeded in on.'</span>); </li><li>} <span class="hljs-keyword">catch</span> (err) { </li><li>  <span class="hljs-keyword">let</span> e: BusinessError = err <span class="hljs-keyword">as</span> BusinessError; </li><li>  hilog.error(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'on failed: %{public}d %{public}s'</span>, e.code, e.message); </li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>取消订阅安全审计事件。</span>       <p></p>       <div _ngcontent-mox-c106="" class="highlight-div"><div _ngcontent-mox-c106="" class="highlight-div-header"><div _ngcontent-mox-c106="" class="highlight-div-header-left"><div _ngcontent-mox-c106="" class="handle-button expand-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mox-c106="" class="highlight-div-header-right"><div _ngcontent-mox-c106="" class="handle-button ai-button"></div><div _ngcontent-mox-c106="" class="handle-button line-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mox-c106="" class="handle-button theme-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mox-c106="" class="handle-button copy-button"><div _ngcontent-mox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mox-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> { </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'off begin.'</span>); </li><li>  securityAudit.off(<span class="hljs-string">'auditEventOccur'</span>, auditEventInfo, callback); </li><li>  hilog.info(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'Succeeded in off.'</span>); </li><li>} <span class="hljs-keyword">catch</span> (err) { </li><li>  <span class="hljs-keyword">let</span> e: BusinessError = err <span class="hljs-keyword">as</span> BusinessError; </li><li>  hilog.error(<span class="hljs-number">0x0000</span>, TAG, <span class="hljs-string">'off failed: %{public}d %{public}s'</span>, e.code, e.message); </li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>