<h1 _ngcontent-fpf-c119="" class="doc-title ng-star-inserted" title="卡片传递消息给应用（message事件）"> 卡片传递消息给应用（message事件） </h1>

<div _ngcontent-fpf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在卡片页面中可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-postcardaction#postcardaction-1" target="_blank">postCardAction</a>接口触发message事件拉起<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability" target="_blank">FormExtensionAbility</a>，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonformevent" target="_blank">onFormEvent</a>接口回调通知，以完成点击卡片控件后传递消息给应用的功能，然后由FormExtensionAbility刷新卡片内容，下面是这种刷新方式的简单示例。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本文主要介绍动态卡片的事件开发。对于静态卡片，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-formlink" target="_blank">FormLink</a>。</p>     </div></div></div>    <ul>     <li>      <p>在卡片页面通过注册Button的onClick点击事件回调，并在回调中调用postCardAction接口触发message事件拉起FormExtensionAbility。卡片页面中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorageprop">LocalStorageProp</a>装饰需要刷新的卡片数据。</p>      <div _ngcontent-fpf-c106="" class="highlight-div"><div _ngcontent-fpf-c106="" class="highlight-div-header"><div _ngcontent-fpf-c106="" class="highlight-div-header-left"><div _ngcontent-fpf-c106="" class="handle-button expand-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpf-c106="" class="highlight-div-header-right"><div _ngcontent-fpf-c106="" class="handle-button ai-button"></div><div _ngcontent-fpf-c106="" class="handle-button line-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpf-c106="" class="handle-button theme-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpf-c106="" class="handle-button copy-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> storageUpdateByMsg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storageUpdateByMsg)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">UpdateByMessageCard</span> {</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'title'</span>) <span class="hljs-attr">title</span>: <span class="hljs-title class_">ResourceStr</span> = $r(<span class="hljs-string">'app.string.default_title'</span>);</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'detail'</span>) <span class="hljs-attr">detail</span>: <span class="hljs-title class_">ResourceStr</span> = $r(<span class="hljs-string">'app.string.DescriptionDefault'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.9</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'8%'</span>, <span class="hljs-attr">left</span>: <span class="hljs-string">'10%'</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">detail</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'5%'</span>, <span class="hljs-attr">left</span>: <span class="hljs-string">'10%'</span> })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.update'</span>))</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#45A6F4'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">120</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'30%'</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-string">'10%'</span> })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title function_">postCardAction</span>(<span class="hljs-variable language_">this</span>, {</li><li>            <span class="hljs-attr">action</span>: <span class="hljs-string">'message'</span>,</li><li>            <span class="hljs-attr">params</span>: { <span class="hljs-attr">msgTest</span>: <span class="hljs-string">'messageEvent'</span> }</li><li>          });</li><li>        })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)</li><li>    .<span class="hljs-title function_">backgroundImage</span>($r(<span class="hljs-string">'app.media.CardEvent'</span>))</li><li>    .<span class="hljs-title function_">backgroundImageSize</span>(<span class="hljs-title class_">ImageSize</span>.<span class="hljs-property">Cover</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>在FormExtensionAbility的onFormEvent生命周期中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formprovider#formproviderupdateform" target="_blank">updateForm</a>接口刷新卡片。</p>      <div _ngcontent-fpf-c106="" class="highlight-div"><div _ngcontent-fpf-c106="" class="highlight-div-header"><div _ngcontent-fpf-c106="" class="highlight-div-header-left"><div _ngcontent-fpf-c106="" class="handle-button expand-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpf-c106="" class="highlight-div-header-right"><div _ngcontent-fpf-c106="" class="handle-button ai-button"></div><div _ngcontent-fpf-c106="" class="handle-button line-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpf-c106="" class="handle-button theme-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpf-c106="" class="handle-button copy-button"><div _ngcontent-fpf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { formBindingData, <span class="hljs-title class_">FormExtensionAbility</span>, formProvider } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'EntryFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onFormEvent</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 当卡片提供方的postCardAction接口的message事件被触发时调用</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility onFormEvent, formId = <span class="hljs-subst">${formId}</span>, message: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(message)}</span>`</span>);</li><li>
</li><li>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {</li><li>      <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Title Update.'</span>; <span class="hljs-comment">// 和卡片布局中对应</span></li><li>      <span class="hljs-attr">detail</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Description update success.'</span>; <span class="hljs-comment">// 和卡片布局中对应</span></li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 请根据业务替换为实际刷新的卡片数据</span></li><li>    <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);</li><li>    formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Operation updateForm failed. Cause: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    })</li><li>  }</li><li>  <span class="hljs-comment">//...</span></li><li>}</li></ol></pre></div></div>      <p>运行效果如下图所示。</p>      <div class="tablenoborder">       <div class="tbBox"><table class="layoutFixed idpTab">        <thead>         <tr>          <th align="left" class="cellrowborder" id="mcps1.3.3.2.4.1.3.1.1" valign="top" width="50%">初始状态</th>          <th align="left" class="cellrowborder" id="mcps1.3.3.2.4.1.3.1.2" valign="top" width="50%">点击刷新</th>         </tr>        </thead>                 <tbody><tr>          <td class="cellrowborder" valign="top" width="50%"><span><img originheight="287" originwidth="287" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114936.87594925968002721309305162790979:50001231000000:2800:2E7F08F2FC1720FCA3F33BE04F69DFD9C00FB8AF2DAEC279B763F60AAABA1E61.png" class="notEnlarge" width="287" height="287"></span></td>          <td class="cellrowborder" valign="top" width="50%"><span><img originheight="287" originwidth="287" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114937.05540003697253074122245294552840:50001231000000:2800:678918C16BBC74F8ADCE21741350E6A480B7E3ACB888F7055E5F0D3D7D0E0D26.png" class="notEnlarge" width="287" height="287"></span></td>         </tr>               </tbody></table></div>      </div></li>    </ul>   </div>   <div></div></div>