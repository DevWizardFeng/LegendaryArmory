<h1 _ngcontent-dvv-c119="" class="doc-title ng-star-inserted" title="原型定义接口（REG_OP）"> 原型定义接口（REG_OP） </h1>

<div _ngcontent-dvv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section108822mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section108822mcpsimp" tips="复制节点链接"></i></h2><p>函数原型定义示例如下。</p> <div _ngcontent-dvv-c106="" class="highlight-div"><div _ngcontent-dvv-c106="" class="highlight-div-header"><div _ngcontent-dvv-c106="" class="highlight-div-header-left"><div _ngcontent-dvv-c106="" class="handle-button expand-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dvv-c106="" class="highlight-div-header-right"><div _ngcontent-dvv-c106="" class="handle-button ai-button"></div><div _ngcontent-dvv-c106="" class="handle-button line-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dvv-c106="" class="handle-button theme-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dvv-c106="" class="handle-button copy-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dvv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">REG_OP</span>(xxx) </li><li>    .<span class="hljs-built_in">INPUT</span>(x1, type) </li><li>    .<span class="hljs-built_in">OPTIONAL_INPUT</span>(x2, type) </li><li>    .<span class="hljs-built_in">DYNAMIC_INPUT</span>(x3, type) </li><li>    .<span class="hljs-built_in">OUTPUT</span>(y1, type) </li><li>    .<span class="hljs-built_in">DYNAMIC_OUTPUT</span>(y3, type) </li><li>    .<span class="hljs-built_in">REQUIRED_ATTR</span>(a, type) </li><li>    .<span class="hljs-built_in">ATTR</span>(b, type, default_value) </li><li>    .<span class="hljs-built_in">GRAPH</span>(z1) </li><li>    .<span class="hljs-built_in">DYNAMIC_GRAPH</span>(z2) </li><li>    .<span class="hljs-built_in">OP_END_FACTORY_REG</span>(xxx)</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section108826mcpsimp">功能说明<i class="anchor-icon anchor-icon-link" anchorid="section108826mcpsimp" tips="复制节点链接"></i></h2><p>定义算子的原型，包括算子的输入、输出、属性以及对应的数据类型。</p> <p>进行如上算子原型定义后，即相当于向GE注册了该算子的原型，告知GE对应类型的算子应该具备哪些输入、输出与属性；同时相当于定义了一个op::xxx的Class，开发者可以include该原型头文件，然后实例化该Class进行IR模型构建，如下所示：</p> <div _ngcontent-dvv-c106="" class="highlight-div"><div _ngcontent-dvv-c106="" class="highlight-div-header"><div _ngcontent-dvv-c106="" class="highlight-div-header-left"><div _ngcontent-dvv-c106="" class="handle-button expand-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dvv-c106="" class="highlight-div-header-right"><div _ngcontent-dvv-c106="" class="handle-button ai-button"></div><div _ngcontent-dvv-c106="" class="handle-button line-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dvv-c106="" class="handle-button theme-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dvv-c106="" class="handle-button copy-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dvv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>conv = op::<span class="hljs-built_in">Conv2D</span>() </li><li>conv.<span class="hljs-built_in">set_input_x</span>(feature_map_data) </li><li>conv.<span class="hljs-built_in">set_input_filter</span>(weight_data)</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section108832mcpsimp">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section108832mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="39.07%"><p><strong>接口名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="30.930000000000003%"><p><strong>接口说明</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="30%"><p>衍生接口（可用于IR模型构建）</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="39.07%"><p>REG_OP(x)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义一个算子原型，算子类型为x。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109057mcpsimp">REG_OP</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.INPUT(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义输入名称（x）和类型(type)。</p> <p>类型为TensorType类型，例如：</p> <ul><li>TensorType{DT_FLOAT}</li><li>TensorType({DT_FLOAT, DT_INT8})</li><li>TensorType::ALL()</li></ul> <p>关于TensorType类，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tensortype">TensorType</a>。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109062mcpsimp">INPUT</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.OPTIONAL_INPUT(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义可选输入的名称（x）和类型（type）。</p> <p>类型为TensorType类型，例如：</p> <ul><li>TensorType{DT_FLOAT}</li><li>TensorType({DT_FLOAT, DT_INT8})</li><li>TensorType::ALL()</li></ul> <p>关于TensorType类，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tensortype">TensorType</a>。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109067mcpsimp">OPTIONAL_INPUT</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.DYNAMIC_INPUT(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义动态输入的名称（x）和类型（type）。</p> <p>类型为TensorType类型，例如：</p> <ul><li>TensorType{DT_FLOAT}</li><li>TensorType({DT_FLOAT, DT_INT8})</li><li>TensorType::ALL()</li></ul> <p>关于TensorType类，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tensortype">TensorType</a>。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109072mcpsimp">DYNAMIC_INPUT</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.OUTPUT(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义输出的名称（x）和类型（type）。</p> <p>类型为TensorType类型，例如：</p> <ul><li>TensorType{DT_FLOAT}</li><li>TensorType({DT_FLOAT, DT_INT8})</li><li>TensorType::ALL()</li></ul> <p>关于TensorType类，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tensortype">TensorType</a>。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109077mcpsimp">OUTPUT</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.DYNAMIC_OUTPUT(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义动态输出的名称（x）和类型（type）。</p> <p>类型为TensorType类型，例如：</p> <ul><li>TensorType{DT_FLOAT}</li><li>TensorType({DT_FLOAT, DT_INT8})</li><li>TensorType::ALL()</li></ul> <p>关于TensorType类，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tensortype">TensorType</a>。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109082mcpsimp">DYNAMIC_OUTPUT</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.REQUIRED_ATTR(x, type)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义必备属性的名称（x）和类型（type）。</p> <p>type的可选值包括：</p> <ul><li>Int，属性类型为int64_t</li><li>Float, 属性类型为float</li><li>String，属性类型为string</li><li>Bool，属性类型为bool</li><li>Tensor，属性类型为Tensor</li><li>Type，属性为Type枚举定义</li><li>NamedAttrs，属性类型为NamedAttrs</li><li>AscendString，属性类型为AscendString</li><li>ListInt，属性类型为vector&lt;int64_t&gt;, int64_t列表</li><li>ListFloat, 属性类型为vector&lt;float&gt;, float列表</li><li>ListString，属性类型为vector&lt;string&gt;，string列表</li><li>ListBool，属性类型为vector&lt;bool&gt;，bool列表</li><li>ListTensor，属性类型为vector&lt;Tensor&gt;，Tensor列表</li><li>Bytes，属性类型为Buffer</li><li>ListType，属性类型为vector&lt;Type&gt;，Type列表</li><li>ListListInt，属性类型为vector&lt;vector&lt;int64_t&gt;&gt;，2维列表</li><li>ListAscendString，属性类型为vector&lt;AscendString&gt;，AscendString列表</li><li>ListNamedAttrs，属性类型为vector&lt;NamedAttrs&gt;，NamedAttrs列表</li></ul> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109087mcpsimp">REQUIRED_ATTR</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.ATTR(x, type, default_value)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>定义可选属性的名称、类型以及默认值。</p> <p>当开发者不设置算子对象的属性时，会使用此处设置的默认值。</p> <p>type的可选值包括：</p> <ul><li>Int，属性类型为int64_t</li><li>Float, 属性类型为float</li><li>String，属性类型为string</li><li>Bool，属性类型为bool</li><li>Tensor，属性类型为Tensor</li><li>Type，属性为Type枚举定义</li><li>NamedAttrs，属性类型为NamedAttrs</li><li>AscendString，属性类型为AscendString</li><li>ListInt，属性类型为vector&lt;int64_t&gt;, int64_t列表</li><li>ListFloat, 属性类型为vector&lt;float&gt;, float列表</li><li>ListString，属性类型为vector&lt;string&gt;，string列表</li><li>ListBool，属性类型为vector&lt;bool&gt;，bool列表</li><li>ListTensor，属性类型为vector&lt;Tensor&gt;，Tensor列表</li><li>Bytes，属性类型为Buffer</li><li>ListType，属性类型为vector&lt;Type&gt;，Type列表</li><li>ListListInt，属性类型为vector&lt;vector&lt;int64_t&gt;&gt;，2维列表</li><li>ListAscendString，属性类型为vector&lt;AscendString&gt;，AscendString列表</li><li>ListNamedAttrs，属性类型为vector&lt;NamedAttrs&gt;，NamedAttrs列表</li></ul> <p>定义示例：</p> <ul><li>.ATTR(mode, Int, 1)</li><li>.ATTR(pad, ListInt, {0, 0, 0, 0})</li></ul> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109092mcpsimp">ATTR</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.GRAPH(z1)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>注册算子中包含的子图信息，输入z1为子图名称。</p> <p>例如If算子注册的子图为：</p> <p>.GRAPH(then_branch)    .GRAPH(else_branch)</p> <p>对于同一个算子，注册的算子子图名称需要保持唯一。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109111mcpsimp">GRAPH</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.DYNAMIC_GRAPH(z2)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>注册动态算子子图信息，输入z2为子图名称。</p> <p>例如Case算子注册的子图为：</p> <p>.DYNAMIC_GRAPH(branches)</p> <p>对于同一个算子，注册的算子子图名称需要保持唯一。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-prototype-definition-derivative-api#section109116mcpsimp">DYNAMIC_GRAPH</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.INFER_SHAPE_AND_TYPE()</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>该接口为历史遗留兼容性接口，当前版本开发者无需使用。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="39.07%"><p>.OP_END_FACTORY_REG(x)</p> </td> <td class="cellrowborder" valign="top" width="30.930000000000003%"><p>与REG_OP配对，结束算子原型定义。</p> <p>算子类型（x）与REG_OP(x)中的类型相同。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p>-</p> </td> </tr>  </tbody></table></div> </div> <p>OpReg类中的OpReg &amp;N()接口的功能是为了开发者进行算子注册的时候，使用.**的方式调用OpReg类的接口，例如.INPUT(x, type)、.OUTPUT(x, type)，无其他含义。</p> </div> <div class="tiledSection"><h2 id="section109037mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section109037mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section109040mcpsimp">约束说明<i class="anchor-icon anchor-icon-link" anchorid="section109040mcpsimp" tips="复制节点链接"></i></h2><ul><li>REG_OP的算子类型必须全局唯一。</li><li>同一个算子的输入名称之间不能重复。</li><li>同一个算子的输出名称之间不能重复。</li><li>同一个算子的属性名称之间不能重复。</li></ul> </div> <div class="tiledSection"><h2 id="section109047mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section109047mcpsimp" tips="复制节点链接"></i></h2><p>动态输入的算子原型定义示例：</p> <div _ngcontent-dvv-c106="" class="highlight-div"><div _ngcontent-dvv-c106="" class="highlight-div-header"><div _ngcontent-dvv-c106="" class="highlight-div-header-left"><div _ngcontent-dvv-c106="" class="handle-button expand-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dvv-c106="" class="highlight-div-header-right"><div _ngcontent-dvv-c106="" class="handle-button ai-button"></div><div _ngcontent-dvv-c106="" class="handle-button line-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dvv-c106="" class="handle-button theme-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dvv-c106="" class="handle-button copy-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dvv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">REG_OP</span>(AddN) </li><li>    .<span class="hljs-built_in">DYNAMIC_INPUT</span>(x, TensorType::<span class="hljs-built_in">NumberType</span>()) </li><li>    .<span class="hljs-built_in">OUTPUT</span>(y, TensorType::<span class="hljs-built_in">NumberType</span>()) </li><li>    .<span class="hljs-built_in">REQUIRED_ATTR</span>(N, Int) </li><li>    .<span class="hljs-built_in">OP_END_FACTORY_REG</span>(AddN)</li></ol></pre></div></div> <p>多输入的算子原型定义示例：</p> <div _ngcontent-dvv-c106="" class="highlight-div"><div _ngcontent-dvv-c106="" class="highlight-div-header"><div _ngcontent-dvv-c106="" class="highlight-div-header-left"><div _ngcontent-dvv-c106="" class="handle-button expand-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dvv-c106="" class="highlight-div-header-right"><div _ngcontent-dvv-c106="" class="handle-button ai-button"></div><div _ngcontent-dvv-c106="" class="handle-button line-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dvv-c106="" class="handle-button theme-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dvv-c106="" class="handle-button copy-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dvv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">REG_OP</span>(GreaterEqual) </li><li>    .<span class="hljs-built_in">INPUT</span>(x1, TensorType::<span class="hljs-built_in">RealNumberType</span>()) </li><li>    .<span class="hljs-built_in">INPUT</span>(x2, TensorType::<span class="hljs-built_in">RealNumberType</span>()) </li><li>    .<span class="hljs-built_in">OUTPUT</span>(y, <span class="hljs-built_in">TensorType</span>({DT_BOOL})) </li><li>    .<span class="hljs-built_in">OP_END_FACTORY_REG</span>(GreaterEqual)</li></ol></pre></div></div> <p>注册子图的算子原型定义示例：</p> <div _ngcontent-dvv-c106="" class="highlight-div"><div _ngcontent-dvv-c106="" class="highlight-div-header"><div _ngcontent-dvv-c106="" class="highlight-div-header-left"><div _ngcontent-dvv-c106="" class="handle-button expand-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dvv-c106="" class="highlight-div-header-right"><div _ngcontent-dvv-c106="" class="handle-button ai-button"></div><div _ngcontent-dvv-c106="" class="handle-button line-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dvv-c106="" class="handle-button theme-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dvv-c106="" class="handle-button copy-button"><div _ngcontent-dvv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dvv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">REG_OP</span>(If) </li><li>    .<span class="hljs-built_in">INPUT</span>(cond, TensorType::<span class="hljs-built_in">ALL</span>()) </li><li>    .<span class="hljs-built_in">DYNAMIC_INPUT</span>(input, TensorType::<span class="hljs-built_in">ALL</span>()) </li><li>    .<span class="hljs-built_in">DYNAMIC_OUTPUT</span>(output, TensorType::<span class="hljs-built_in">ALL</span>()) </li><li>    .<span class="hljs-built_in">GRAPH</span>(then_branch) </li><li>    .<span class="hljs-built_in">GRAPH</span>(else_branch) </li><li>    .<span class="hljs-built_in">OP_END_FACTORY_REG</span>(If)</li></ol></pre></div></div> </div> </div> <div></div></div>