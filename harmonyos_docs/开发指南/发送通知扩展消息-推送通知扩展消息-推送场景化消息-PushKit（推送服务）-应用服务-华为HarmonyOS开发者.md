<h1 _ngcontent-uti-c119="" class="doc-title ng-star-inserted" title="发送通知扩展消息"> 发送通知扩展消息 </h1>

<div _ngcontent-uti-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section53607400811">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section53607400811" tips="复制节点链接"></i></h2>          <p>当用户终端收到您发送的通知扩展消息时：</p>     <ul>      <li>若您的应用进程不在前台，Push Kit会将消息内容传递给通知扩展进程，您可以在该进程中自行完成业务处理（例如：语音播报、消息内容解密等）后，返回自定义消息内容，Push Kit将弹出通知提醒。您需要在10秒内返回消息内容，否则Push Kit将默认展示原有的消息内容。</li>      <li>若您的应用进程在前台，则不弹出通知提醒，您可以在应用进程中获取通知扩展消息内容并自行完成业务处理。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section842412232016">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section842412232016" tips="复制节点链接"></i></h2>          <p>推送通知扩展消息能力支持Phone、Tablet、PC/2in1。并且从5.1.0(18)版本开始新增支持Wearable设备。</p>    </div>    <div class="tiledSection">     <h2 id="section3836623133819">开通权益<i class="anchor-icon anchor-icon-link" anchorid="section3836623133819" tips="复制节点链接"></i></h2>          <ul>      <li>推送通知扩展消息需要申请推送通知扩展消息权益，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-apply-right#section159981112245">申请推送通知扩展消息权益</a>。</li>      <li>推送通知扩展消息当前支持的消息自分类类别为PLAY_VOICE（语音播报），请在完成上一步申请后，申请对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-apply-right#section16708911111611">PLAY_VOICE（语音播报）消息自分类权益</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section0476182611435">频控规则<i class="anchor-icon anchor-icon-link" anchorid="section0476182611435" tips="复制节点链接"></i></h2>          <p><strong>调测阶段</strong>，每个项目每日全网最多可推送<span id="ZH-CN_TOPIC_0000002402305681__zh-cn_topic_0000002368705820_text54316313257">1000</span>条测试消息。发送测试消息需设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">testMessage</a>为true。</p>     <p><strong>正式发布阶段</strong>，单设备单应用下每日推送消息总条数受<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-msg-freq-control#section993063213715" target="_blank">设备消息频控</a>限制，系统会根据现网使用场景和流量进行管控，不合理的使用场景系统会进行频控。</p>    </div>    <div class="tiledSection">     <h2 id="section7799156112814">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7799156112814" tips="复制节点链接"></i></h2>          <ol>      <li><span>参见指导<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>。</span></li>      <li><span>为确保应用可正常收到消息，建议应用发送通知前调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-notificationmanager#notificationmanagerrequestenablenotification10-1" target="_blank">requestEnableNotification</a>()方法弹出提醒，告知用户需要允许接收通知消息。详情请参见Notification Kit-<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/notification-enable" target="_blank">请求通知授权</a>。</span></li>      <li><span>应用服务端调用REST API推送消息，消息详情可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-intro" target="_blank">场景化消息API接口功能介绍</a>，请求示例如下：</span>       <p></p>       <div _ngcontent-uti-c106="" class="highlight-div"><div _ngcontent-uti-c106="" class="highlight-div-header"><div _ngcontent-uti-c106="" class="highlight-div-header-left"><div _ngcontent-uti-c106="" class="handle-button expand-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uti-c106="" class="highlight-div-header-right"><div _ngcontent-uti-c106="" class="handle-button ai-button"></div><div _ngcontent-uti-c106="" class="handle-button line-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uti-c106="" class="handle-button theme-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uti-c106="" class="handle-button copy-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uti-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Request URL </span></li><li>POST <span class="hljs-string">"https://push-api.cloud.huawei.com/v3/</span><strong><span class="hljs-string">[projectId]</span></strong><span class="hljs-string">/messages:send"</span></li><li> </li><li><span class="hljs-comment">// Request Header </span></li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>Authorization<span class="hljs-punctuation">:</span> Bearer eyJr*****OiIx---****.eyJh*****iJodHR--***.QRod*****<span class="hljs-number">4</span>Gp---**** </li><li><strong>push-type<span class="hljs-punctuation">:</span> <span class="hljs-number">2</span></strong></li><li>
</li><li><span class="hljs-comment">// Request Body</span></li><li><span class="hljs-punctuation">{</span> </li><li>  <span class="hljs-attr">"payload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> </li><li>    <span class="hljs-attr">"extraData"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{\"title\":\"replace title\",\"text\":\"replace text\"}"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> </li><li>      <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PLAY_VOICE"</span><span class="hljs-punctuation">,</span>  </li><li>      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"通知标题"</span><span class="hljs-punctuation">,</span> </li><li>      <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"通知内容"</span><span class="hljs-punctuation">,</span> </li><li>      <span class="hljs-attr">"clickAction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> </li><li>        <span class="hljs-attr">"actionType"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span> </li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"notifyId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12345</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> </li><li>  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> </li><li>    <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"MAMzLg**********lPW"</span><span class="hljs-punctuation">]</span> </li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> </li><li>  <span class="hljs-attr">"pushOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> </li><li>    <span class="hljs-attr">"testMessage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li><strong>    </strong><span class="hljs-attr">"ttl"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">86400</span></li><li>  <span class="hljs-punctuation">}</span> </li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <ul>        <li>[projectId]：项目ID，登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“开发与服务”，在项目列表中选择对应的项目，左侧导航栏选择“项目设置”，在该页面获取。</li>        <li>Authorization：JWT格式字符串，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-struct#section20573634202313" target="_blank">Authorization</a>获取。</li>        <li>push-type：2表示通知扩展场景。</li>        <li>category：消息自分类类别，当前支持设置为PLAY_VOICE，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section17371529101117" target="_blank">参数说明</a>，发送消息前请确保您已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-apply-right#section16708911111611">申请通知消息自分类权益</a>。</li>        <li>actionType：0表示点击消息打开应用首页。</li>        <li>token：Push Token，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>获取。</li>        <li>extraData：通知扩展场景可携带的额外数据，字符串类型。详情参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section161192514234" target="_blank">ExtensionPayload 通知扩展消息</a>。extraData数据获取请参考<a href="https://gitcode.com/harmonyos_samples/push-kit-sample-code-clientdemo-arkts/blob/master/entry/src/main/ets/abilities/RemoteNotificationExtAbility.ets" target="_blank">示例代码</a>。</li>        <li>testMessage：（选填）测试消息标识，true表示测试消息。每个项目每天限制发送1000条测试消息，单次推送可发送Token数不超过10个。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">testMessage</a>。</li>        <li>ttl：（选填）消息缓存时间，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">ttl</a>。</li>        <li>notifyId：（选填）自定义消息标识字段。不携带或者设置-1时，推送服务自动为每条消息生成一个唯一标识；不同的通知消息可以拥有相同的notifyId，实现新消息覆盖旧消息功能。仅支持数字，范围 [0, 2147483647]，若要<strong>用于消息撤回则必填</strong>。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section17371529101117" target="_blank">notifyId</a>。</li>        <li>image：（选填）通知右侧大图标URL，URL使用的协议必须是HTTPS协议。         <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">           <p>推送服务禁止推送包含敏感信息的图片。</p>          </div></div></div></li>       </ul>       <p></p></li>      <li><span>应用服务端调用REST API推送消息后，若应用进程在后台，Push Kit会将通知消息内容传递给通知扩展进程，并返回特定的消息内容（例如title、body等）后，通知栏将弹出通知提醒。实现步骤如下：</span>       <p></p>       <p>在项目工程的<strong>src/main/module.json5</strong>文件的<strong>extensionAbilities</strong>模块中配置RemoteNotificationExtAbility的<strong>type</strong>和<strong>actions</strong>信息（<strong>定义该type和actions的ExtensionAbility有且只能有一个</strong><strong>，配置如下，若同时添加uris</strong><strong>参数，则uris</strong><strong>内容需为空</strong>）：</p>       <div _ngcontent-uti-c106="" class="highlight-div"><div _ngcontent-uti-c106="" class="highlight-div-header"><div _ngcontent-uti-c106="" class="highlight-div-header-left"><div _ngcontent-uti-c106="" class="handle-button expand-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uti-c106="" class="highlight-div-header-right"><div _ngcontent-uti-c106="" class="handle-button ai-button"></div><div _ngcontent-uti-c106="" class="handle-button line-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uti-c106="" class="handle-button theme-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uti-c106="" class="handle-button copy-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uti-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"extensionAbilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>  <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"RemoteNotificationExtAbility"</span><span class="hljs-punctuation">,</span></li><li>    <strong><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remoteNotification"</span></strong><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/entryability/RemoteNotificationExtAbility.ets"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"RemoteNotificationExtAbility test"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"exported"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-comment">// 新增一个独立的skill对象，配置actions参数</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <strong><span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"action.hms.push.extension.remotenotification"</span><span class="hljs-punctuation">]</span></strong></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">]</span></li></ol></pre></div></div>       <ul>        <li>type：固定值为<strong>remoteNotification</strong>，表示通知扩展的ExtensionAbility类型。</li>        <li>actions：固定值为<strong>action.hms.push.extension.remotenotification</strong>，用于接收通知扩展消息。</li>       </ul>       <div class="p">        在您的工程内创建一个ExtensionAbility类型的组件并且继承<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-remote-notification-extension-ability" target="_blank">RemoteNotificationExtensionAbility</a>，完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-remote-notification-extension-ability#section455013322919" target="_blank">onReceiveMessage</a>()方法的覆写，在此方法中进行数据接收及业务处理。代码示例如下：        <div _ngcontent-uti-c106="" class="highlight-div"><div _ngcontent-uti-c106="" class="highlight-div-header"><div _ngcontent-uti-c106="" class="highlight-div-header-left"><div _ngcontent-uti-c106="" class="handle-button expand-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uti-c106="" class="highlight-div-header-right"><div _ngcontent-uti-c106="" class="handle-button ai-button"></div><div _ngcontent-uti-c106="" class="handle-button line-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uti-c106="" class="handle-button theme-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uti-c106="" class="handle-button copy-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uti-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/entryability/RemoteNotificationExtAbility.ets</span></li><li><span class="hljs-keyword">import</span> { pushCommon, <span class="hljs-title class_">RemoteNotificationExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</span></li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteNotificationExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RemoteNotificationExtensionAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onReceiveMessage</span>(<span class="hljs-attr">remoteNotificationInfo</span>: pushCommon.<span class="hljs-property">RemoteNotificationInfo</span>): <span class="hljs-title class_">Promise</span>&lt;pushCommon.<span class="hljs-property">RemoteNotificationContent</span>&gt; {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RemoteNotificationExtAbility onReceiveMessage, remoteNotificationInfo'</span>);</li><li>
</li><li>    <span class="hljs-comment">// Read the pixel map object</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIExtensionContext</span>).<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">fileData</span>: <span class="hljs-title class_">Uint8Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">0</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      fileData = <span class="hljs-keyword">await</span> resourceMgr.<span class="hljs-title function_">getMediaContent</span>($r(<span class="hljs-string">'app.media.startIcon'</span>).<span class="hljs-property">id</span>);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to get media content: %{public}d %{public}s'</span>, e.<span class="hljs-property">code</span>, e.<span class="hljs-property">message</span>);</li><li>    }</li><li>    <span class="hljs-keyword">const</span> buffer = fileData.<span class="hljs-property">buffer</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(buffer <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>    <span class="hljs-keyword">if</span> (pixelMap) {</li><li>      pixelMap.<span class="hljs-title function_">getImageInfo</span>(<span class="hljs-function">(<span class="hljs-params">err, imageInfo</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (imageInfo) {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`imageInfo <span class="hljs-subst">${imageInfo.size.width}</span> * <span class="hljs-subst">${imageInfo.size.height}</span>`</span>);</li><li>        }</li><li>      });</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// Return the replaced message content.</span></li><li>    <span class="hljs-keyword">return</span> {</li><li>      <span class="hljs-attr">title</span>: <span class="hljs-string">'Default replace title.'</span>,</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">'Default replace text.'</span>,</li><li>      <span class="hljs-attr">badgeNumber</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-attr">setBadgeNumber</span>: <span class="hljs-number">2</span>,</li><li>      <span class="hljs-attr">overlayIcon</span>: pixelMap,</li><li>      <span class="hljs-attr">wantAgent</span>: {</li><li>        <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'DemoAbility'</span>,</li><li>        <span class="hljs-attr">parameters</span>: {</li><li>          <span class="hljs-attr">key</span>: <span class="hljs-string">'Default value'</span></li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RemoteNotificationExtAbility onDestroy.'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>        <ul>         <li>函数的返回值用于替换最终展示在终端的通知，title和text代表您要展示的通知标题与通知内容。</li>         <li>badgeNumber字段为展示通知时<strong>增加</strong>的角标数量，setBadgeNumber字段为展示通知时<strong>显示</strong>的角标数量，两者同时返回时，setBadgeNumber优先于badgeNumber。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushcommon#section155703491918" target="_blank">RemoteNotificationContent</a>。</li>         <li>overlayIcon字段为展示通知时的叠加图标。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushcommon#section155703491918" target="_blank">RemoteNotificationContent</a>。</li>         <li>wantAgent.abilityName字段为需要替换的点击拉起的落地页abilityName（例如DemoAbility），DemoAbility需要您自行适配开发。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushcommon#section122049160211" target="_blank">RemoteWantAgent</a>。</li>         <li>wantAgent.parameters字段表示传递给应用的数据。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushcommon#section122049160211" target="_blank">RemoteWantAgent</a>。          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>以上代码示例实现了消息替换的功能，如您想通过通知扩展消息实现<strong>语音播报</strong>，具体业务代码可在onReceiveMessage()方法中完成。</p>            <p>您可参考以下3种Kit能力实现<strong>语音播报</strong>：</p>            <ul>             <li>文本转语音 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/texttospeech-guide" target="_blank">Core Speech Kit（基础语音服务）</a>。</li>             <li>媒体服务 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro" target="_blank">Media Kit（媒体服务）</a>。</li>             <li>音频播放 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-overview" target="_blank">Audio Kit（音频服务）</a>。</li>            </ul>           </div></div></div></li>        </ul>       </div>       <p></p></li>      <li><span>应用服务端调用REST API推送消息后，若应用进程在前台，通知栏将不会弹出通知提醒。实现步骤如下：</span>       <p></p>       <div class="p">        在项目模块的<strong>src/main/module.json5</strong>文件的abilities模块中（以PushMessageAbility为例）配置skills标签的actions属性内容为<strong> action.ohos.push.listener</strong>（有且只能有一个ability定义该action，<strong>若同时添加uris参数，则uris内容需为空</strong>）：        <div _ngcontent-uti-c106="" class="highlight-div"><div _ngcontent-uti-c106="" class="highlight-div-header"><div _ngcontent-uti-c106="" class="highlight-div-header-left"><div _ngcontent-uti-c106="" class="handle-button expand-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uti-c106="" class="highlight-div-header-right"><div _ngcontent-uti-c106="" class="handle-button ai-button"></div><div _ngcontent-uti-c106="" class="handle-button line-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uti-c106="" class="handle-button theme-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uti-c106="" class="handle-button copy-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uti-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PushMessageAbility"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/abilities/PushMessageAbility.ets"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"launchType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"singleton"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"startWindowIcon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:startIcon"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"startWindowBackground"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$color:start_window_background"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"exported"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-comment">// 保持现有skill对象不变</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"com.app.action"</span></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// 新增一个独立的skill对象，配置actions参数</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <strong><span class="hljs-string">"action.ohos.push.listener"</span></strong></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       </div>       <div class="p">        在客户端项目中现有的UIAbility类的onCreate()中（以PushMessageAbility为例），通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section125883044911" target="_blank">receiveMessage</a>()方法传入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section5507492425" target="_blank">PushType</a>为"IM"获取通知扩展消息，用于应用在前台时接收通知扩展消息，示例代码如下：        <div _ngcontent-uti-c106="" class="highlight-div"><div _ngcontent-uti-c106="" class="highlight-div-header"><div _ngcontent-uti-c106="" class="highlight-div-header-left"><div _ngcontent-uti-c106="" class="handle-button expand-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uti-c106="" class="highlight-div-header-right"><div _ngcontent-uti-c106="" class="handle-button ai-button"></div><div _ngcontent-uti-c106="" class="handle-button line-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uti-c106="" class="handle-button theme-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uti-c106="" class="handle-button copy-button"><div _ngcontent-uti-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uti-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/abilities/PushMessageAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { pushService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 此处以PushMessageAbility为例，用于应用在前台时接收通知消息</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushMessageAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// receiveMessage中的参数固定为IM</span></li><li>      pushService.<span class="hljs-title function_">receiveMessage</span>(<span class="hljs-string">'IM'</span>, <span class="hljs-variable language_">this</span>, <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-comment">// 获取服务端传递的数据</span></li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = payload.<span class="hljs-property">data</span>;</li><li>          <span class="hljs-comment">// TODO：业务自行处理</span></li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting notification,data=%{public}s'</span>,</li><li>            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)?.<span class="hljs-property">notification</span>));</li><li>        } <span class="hljs-keyword">catch</span> (e) {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">errRes</span>: <span class="hljs-title class_">BusinessError</span> = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to process data: %{public}d %{public}s'</span>,</li><li>            errRes.<span class="hljs-property">code</span>, errRes.<span class="hljs-property">message</span>);</li><li>        }</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to get message: %{public}d %{public}s'</span>, e.<span class="hljs-property">code</span>,</li><li>        e.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       </div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>