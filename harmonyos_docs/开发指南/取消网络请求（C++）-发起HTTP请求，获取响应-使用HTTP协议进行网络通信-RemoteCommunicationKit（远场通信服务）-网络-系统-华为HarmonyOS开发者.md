<h1 _ngcontent-puj-c119="" class="doc-title ng-star-inserted" title="取消网络请求（C++）"> 取消网络请求（C++） </h1>

<div _ngcontent-puj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在远场通信服务的框架中，没有明确指定任何request的情况下，可以取消所有正在进行的网络请求。如果开发者需要取消特定的一个网络请求，可以使用HMS_Rcp_CancelRequest方法，并传入需要取消的请求，以实现这一目标。开发者们可以根据具体需求，灵活地管理和控制网络请求的执行。总之，HMS_Rcp_CancelRequest方法的灵活运用，不仅能够优化网络资源的使用，还能提升应用程序的用户体验。</p>    <div class="tiledSection">     <h2 id="section15385135185019">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section15385135185019" tips="复制节点链接"></i></h2>          <p>取消网络请求能力支持Phone、2in1、Tablet、Wearable设备。并且从5.1.1(19)开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section2093314011405">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section2093314011405" tips="复制节点链接"></i></h2>          <p>具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-overview#gae7974f60c9b17a16e853befd391b7f81" target="_blank">接口文档</a>。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.1" valign="top" width="50%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.2" valign="top" width="50%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="50%">         <p>uint32_t HMS_Rcp_CancelRequest(<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-overview#ga4f3a7d39c18fe6fdf01c52759213ddcd" target="_blank">Rcp_Session</a> *session, const <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-overview#ga98dde966841135537e05053bf4da4d5b" target="_blank">Rcp_Request</a> *request);</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p>取消指定或所有正在进行的会话请求。返回为空。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section1115911358401">使用示例<i class="anchor-icon anchor-icon-link" anchorid="section1115911358401" tips="复制节点链接"></i></h2>          <ol>      <li><span>CPP侧导入模块。</span>       <p></p>       <div _ngcontent-puj-c106="" class="highlight-div"><div _ngcontent-puj-c106="" class="highlight-div-header"><div _ngcontent-puj-c106="" class="highlight-div-header-left"><div _ngcontent-puj-c106="" class="handle-button expand-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-puj-c106="" class="highlight-div-header-right"><div _ngcontent-puj-c106="" class="handle-button ai-button"></div><div _ngcontent-puj-c106="" class="handle-button line-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-puj-c106="" class="handle-button theme-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-puj-c106="" class="handle-button copy-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-puj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"RemoteCommunicationKit/rcp.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span></li></ol></pre></div></div>       <p></p></li>      <li><span>CMakeLists.txt中添加以下lib。（具体请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/remote-communication-preparations#section2095732915253">C API开发准备</a>）。</span>       <p></p>       <div _ngcontent-puj-c106="" class="highlight-div"><div _ngcontent-puj-c106="" class="highlight-div-header"><div _ngcontent-puj-c106="" class="highlight-div-header-left"><div _ngcontent-puj-c106="" class="handle-button expand-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-puj-c106="" class="highlight-div-header-right"><div _ngcontent-puj-c106="" class="handle-button ai-button"></div><div _ngcontent-puj-c106="" class="handle-button line-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-puj-c106="" class="handle-button theme-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-puj-c106="" class="handle-button copy-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-puj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>librcp_c.so</li></ol></pre></div></div>       <p></p></li>      <li><span>创建会话，会话发起请求，并在使用fetch请求后，使用HMS_Rcp_CancelRequest取消网络请求。销毁request并关闭session。“http://www.example.com”请根据实际情况替换为想要请求的URL地址。</span>       <p></p>       <div _ngcontent-puj-c106="" class="highlight-div"><div _ngcontent-puj-c106="" class="highlight-div-header"><div _ngcontent-puj-c106="" class="highlight-div-header-left"><div _ngcontent-puj-c106="" class="handle-button expand-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-puj-c106="" class="highlight-div-header-right"><div _ngcontent-puj-c106="" class="handle-button ai-button"></div><div _ngcontent-puj-c106="" class="handle-button line-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-puj-c106="" class="handle-button theme-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-puj-c106="" class="handle-button copy-button"><div _ngcontent-puj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-puj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResponseCallback</span><span class="hljs-params">(<span class="hljs-type">void</span> *usrCtx, Rcp_Response *response, <span class="hljs-type">uint32_t</span> errCode)</span></span></li><li><span class="hljs-function"></span>{</li><li>    (<span class="hljs-type">void</span> *)usrCtx;</li><li>    <span class="hljs-keyword">if</span> (response != <span class="hljs-literal">NULL</span>) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Response status: %d\n"</span>, response-&gt;statusCode);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Fetch failed: errCode: %u\n"</span>, errCode);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (response != <span class="hljs-literal">NULL</span>) {</li><li>        response-&gt;<span class="hljs-built_in">destroyResponse</span>(response);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *kHttpServerAddress = <span class="hljs-string">"http://www.example.com/delete"</span>;</li><li>    Rcp_Request *request = <span class="hljs-built_in">HMS_Rcp_CreateRequest</span>(kHttpServerAddress);</li><li>    request-&gt;method = RCP_METHOD_DELETE;</li><li>    <span class="hljs-type">uint32_t</span> errCode = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 创建session</span></li><li>    Rcp_Session *session = <span class="hljs-built_in">HMS_Rcp_CreateSession</span>(<span class="hljs-literal">NULL</span>, &amp;errCode);</li><li>    <span class="hljs-comment">// 配置请求回调</span></li><li>    Rcp_ResponseCallbackObject responseCallback = {ResponseCallback, <span class="hljs-literal">NULL</span>};</li><li>    <span class="hljs-comment">// 发起fetch请求</span></li><li>    errCode = <span class="hljs-built_in">HMS_Rcp_Fetch</span>(session, request, &amp;responseCallback);</li><li>    <span class="hljs-comment">// 取消请求，处理errCode</span></li><li>    errCode = <span class="hljs-built_in">HMS_Rcp_CancelRequest</span>(session, request);</li><li>    <span class="hljs-comment">// 在退出前取消可能还在执行的requests </span></li><li>    errCode = <span class="hljs-built_in">HMS_Rcp_CancelSession</span>(session);</li><li>    <span class="hljs-comment">// 清理request</span></li><li>    <span class="hljs-built_in">HMS_Rcp_DestroyRequest</span>(request);</li><li>    <span class="hljs-comment">// 关闭session</span></li><li>    errCode = <span class="hljs-built_in">HMS_Rcp_CloseSession</span>(&amp;session);</li><li>    <span class="hljs-comment">// 处理errCode</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>