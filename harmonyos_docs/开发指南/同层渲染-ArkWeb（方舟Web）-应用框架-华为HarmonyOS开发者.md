<h1 _ngcontent-knt-c119="" class="doc-title ng-star-inserted" title="同层渲染"> 同层渲染 </h1>

<div _ngcontent-knt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在系统中，应用可以使用Web组件加载Web网页。当非系统框架的UI组件功能或性能不如系统组件时，可使用同层渲染技术，通过ArkUI组件渲染这些组件（简称为同层组件）。</p>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="web网页" class="firsth2">Web网页<i class="anchor-icon anchor-icon-link" anchorid="web网页" tips="复制节点链接"></i></h3>          <p>小程序的地图组件，可以使用ArkUI的XComponent组件渲染来提升性能。小程序的输入框组件，可以使用ArkUI的TextInput组件渲染，达到与系统应用一致的输入体验。</p>     <ul>      <li>       <p>在网页侧，应用开发者可将&lt;embed&gt;、&lt;object&gt;的网页UI组件（简称为同层标签），按一定规则进行同层渲染，详细规格见同层渲染规格小节。</p></li>      <li>       <p>在应用侧，应用开发者可以通过Web组件的同层渲染事件上报接口，感知到H5同层标签的生命周期以及输入事件，进行同层渲染组件的相应业务逻辑处理。</p></li>      <li>       <p>在应用侧，应用开发者可以使用ArkUI的NodeContainer等接口，构建H5同层标签对应的同层渲染组件。可支持同层渲染的ArkUI常用组件包括：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textinput" target="_blank">TextInput</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvas" target="_blank">Canvas</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-media-components-video" target="_blank">Video</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web" target="_blank">Web</a>。具体规格可参见<a href="/consumer/cn/doc/harmonyos-guides/web-same-layer#规格约束">同层渲染规格小节</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="三方ui框架">三方UI框架<i class="anchor-icon anchor-icon-link" anchorid="三方ui框架" tips="复制节点链接"></i></h3>          <p>Flutter提供了PlatformView与Texture抽象组件，这些组件可使用系统组件渲染，用于支持Flutter组件功能不足的部分。Weex2.0框架的Camera、Video和Canvas组件可以使用系统组件渲染，以增强功能和性能。</p>     <ul>      <li>       <p>在三方框架页面侧，由于Flutter、Weex等三方框架不在操作系统范围内，本文不列举可被同层渲染的三方框架UI组件的范围与使用方式。</p></li>      <li>       <p>在应用侧，应用开发者可以使用ArkUI的NodeContainer等接口，构建三方框架同层标签对应的同层渲染组件。可支持同层渲染的ArkUI常用组件包括：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textinput" target="_blank">TextInput</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvas" target="_blank">Canvas</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-media-components-video" target="_blank">Video</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web" target="_blank">Web</a>。具体规格可参见<a href="/consumer/cn/doc/harmonyos-guides/web-same-layer#规格约束">同层渲染规格</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="整体架构">整体架构<i class="anchor-icon anchor-icon-link" anchorid="整体架构" tips="复制节点链接"></i></h2>          <p>ArkWeb同层渲染特性主要提供两种能力：同层标签生命周期和事件命中转发处理。</p>     <p>同层标签生命周期主要关联前端标签（&lt;embed&gt;/&lt;object&gt;），同时命中到同层标签的事件会被上报到开发者侧，由开发者分发到对应组件树。整体框架如下图所示：</p>     <p><strong>图1</strong> 同层渲染整体架构</p>     <p><span><img originheight="681" originwidth="742" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.43673897242900484058942575818517:50001231000000:2800:0030F9BDF0F3F99D6F847BAB3B658273FE2428A26FE04D947793D889CF5DF565.png" width="742" height="681"></span></p>    </div>    <div class="tiledSection">     <h2 id="规格约束">规格约束<i class="anchor-icon anchor-icon-link" anchorid="规格约束" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="可被同层渲染的arkui组件" class="firsth2">可被同层渲染的ArkUI组件<i class="anchor-icon anchor-icon-link" anchorid="可被同层渲染的arkui组件" tips="复制节点链接"></i></h3>          <p>以下规格对Web网页和三方框架场景均生效。</p>     <p><strong>支持的组件范围:</strong></p>     <ul>      <li>       <p>基础组件：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-alphabet-indexer" target="_blank">AlphabetIndexer</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-blank" target="_blank">Blank</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-button" target="_blank">Button</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-calendarpicker" target="_blank">CalendarPicker</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-checkbox" target="_blank">Checkbox</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-checkboxgroup" target="_blank">CheckboxGroup</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan" target="_blank">ContainerSpan</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-datapanel" target="_blank">DataPanel</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-datepicker" target="_blank">DatePicker</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-divider" target="_blank">Divider</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-gauge" target="_blank">Gauge</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-hyperlink" target="_blank">Hyperlink</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image" target="_blank">Image</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imageanimator" target="_blank">ImageAnimator</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imagespan" target="_blank">ImageSpan</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-loadingprogress" target="_blank">LoadingProgress</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-marquee" target="_blank">Marquee</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-patternlock" target="_blank">PatternLock</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-progress" target="_blank">Progress</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-qrcode" target="_blank">QRCode</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-radio" target="_blank">Radio</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-rating" target="_blank">Rating</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh" target="_blank">Refresh</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll" target="_blank">ScrollBar</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-search" target="_blank">Search</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-select" target="_blank">Select</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-slider" target="_blank">Slider</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textarea" target="_blank">TextArea</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textclock" target="_blank">TextClock</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textinput" target="_blank">TextInput</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textpicker" target="_blank">TextPicker</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-texttimer" target="_blank">TextTimer</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-timepicker" target="_blank">TimePicker</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-toggle" target="_blank">Toggle</a></p></li>      <li>       <p>容器类组件：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-badge" target="_blank">Badge</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-column" target="_blank">Column</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-columnsplit" target="_blank">ColumnSplit</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-counter" target="_blank">Counter</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-flex" target="_blank">Flex</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-gridcol" target="_blank">GridCol</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-gridrow" target="_blank">GridRow</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid" target="_blank">Grid</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-griditem" target="_blank">GridItem</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list" target="_blank">List</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitem" target="_blank">ListItem</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitemgroup" target="_blank">ListItemGroup</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-relativecontainer" target="_blank">RelativeContainer</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-row" target="_blank">Row</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-rowsplit" target="_blank">RowSplit</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll" target="_blank">Scroll</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-stack" target="_blank">Stack</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper" target="_blank">Swiper</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabs" target="_blank">Tabs</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabcontent" target="_blank">TabContent</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer" target="_blank">NodeContainer</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-sidebarcontainer" target="_blank">SideBarContainer</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-stepper" target="_blank">Stepper</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-stepperitem" target="_blank">StepperItem</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-waterflow" target="_blank">WaterFlow</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-flowitem" target="_blank">FlowItem</a></p></li>      <li>       <p>自绘制类组件：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvas" target="_blank">Canvas</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-media-components-video" target="_blank">Video</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web" target="_blank">Web</a></p></li>      <li>       <p>命令式自定义绘制节点：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-componentcontent" target="_blank">ComponentContent</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-contentslot" target="_blank">ContentSlot</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode" target="_blank">FrameNode</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-graphics" target="_blank">Graphics</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller" target="_blank">NodeController</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode" target="_blank">RenderNode</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-xcomponentnode" target="_blank">XComponentNode</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-attributeupdater" target="_blank">AttributeUpdater</a>, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule" target="_blank">CAPI</a>（支持同层渲染的组件范围同ArkTS）</p></li>     </ul>     <p><strong>支持的组件通用属性与事件:</strong></p>     <ul>      <li>       <p>不支持的通用属性：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-restoreid" target="_blank">分布式迁移标识</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-use-effect" target="_blank">特效绘制合并</a>。</p></li>      <li>       <p>其他未明确标注不支持的属性与事件及组件能力，均默认支持。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="web网页的同层渲染标签">Web网页的同层渲染标签<i class="anchor-icon anchor-icon-link" anchorid="web网页的同层渲染标签" tips="复制节点链接"></i></h3>          <p>此规格仅针对Web网页，不适用于三方框架场景。</p>     <p>如果应用需要在Web组件加载的网页中使用同层渲染，需要按照以下规格将网页中的&lt;embed&gt;、&lt;object&gt;标签指定为同层渲染组件。</p>     <p><strong>支持的H5标签：</strong></p>     <ul>      <li>       <p>支持&lt;embed&gt;标签：在开启同层渲染后，仅支持type类型为native前缀的标签识别为同层组件，不支持自定义属性。</p></li>      <li>       <p>支持&lt;object&gt;标签：在开启同层渲染后，支持将非标准MIME type的object标签识别为同层组件，支持通过param/value的自定义属性解析。</p></li>      <li>       <p>不支持W3C规范标准标签（如&lt;input&gt;、&lt;video&gt;）定义为同层标签。</p></li>      <li>       <p>不支持同时配置&lt;object&gt;标签和&lt;embed&gt;标签作为同层标签。</p></li>      <li>       <p>标签类型只支持英文字符，不区分大小写。</p></li>     </ul>     <p><strong>同层标签支持的css属性：</strong></p>     <p>display，position，z-index，visibility，opacity, background-color，background-image，width，height，padding，padding-left，padding-top，padding-right，padding-bottom，margin，margin-left，margin-top，margin-right，margin-bottom，border-width，border-style，border-color，border-left-width，border-left-style，border-left-color，border-top-width，border-top-style，border-top-color，border-right-width，border-right-style，border-right-color，border-bottom-width，border-bottom-style，border-bottom-color，border-left，border-right，border-top，border-bottom，border，border-top-left-radius，border-top-right-radius，border-bottom-left-radius，border-bottom-right-radius，border-radius，transition，transform（仅支持translate/scale，scale对应参数只支持大于等于0的值）</p>     <p>除上面支持的css属性范围，其他的css属性均不保证符合预期，比如transform属性中的rotate，skew等。</p>     <p><strong>同层标签的生命周期管理：</strong></p>     <p>当同层标签生命周期变化时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedlifecyclechange11" target="_blank">onNativeEmbedLifecycleChange()</a>回调。</p>     <ul>      <li>       <p>支持创建、销毁、位置宽高变化。</p></li>      <li>       <p>支持同层组件所在Web页面进入前进后退缓存。</p></li>     </ul>     <p><strong>同层标签的输入事件分发处理：</strong></p>     <ul>      <li>       <p>支持触摸事件TouchEvent的DOWN/UP/MOVE/CANCEL。支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedgestureevent11" target="_blank">配置触摸事件消费结果</a>，默认为应用侧消费。</p></li>      <li>       <p>不支持同层标签所在的应用页面缩放和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#initialscale9" target="_blank">initialScale</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#zoom" target="_blank">zoom</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#zoomin" target="_blank">zoomIn</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#zoomout" target="_blank">zoomOut</a>等缩放接口。</p></li>      <li>       <p>暂不支持鼠标、键盘、触摸板事件上报。</p></li>      <li>       <p>支持默认将鼠标和触摸板左键事件（MousePress/MouseRelease/MouseMOVE）转换为触摸事件（TouchDOWN/TouchUP/TouchMOVE）上报。</p></li>     </ul>     <p><strong>同层标签的可见状态变化：</strong></p>     <p>当同层标签可见状态变化时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedvisibilitychange12" target="_blank">onNativeEmbedVisibilityChange</a>回调。</p>     <ul>      <li>       <p>支持同层标签相对于视口的可见状态上报。</p></li>      <li>       <p>默认不支持由于同层标签CSS样式或尺寸变化导致的可见状态变化上报，具体规格参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedvisibilitychange12" target="_blank">onNativeEmbedVisibilityChange</a>。</p></li>     </ul>     <p><strong>同层渲染&lt;object&gt;标签内嵌param元素状态变化：</strong></p>     <p>当同层渲染&lt;object&gt;内嵌标签param元素变化时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedobjectparamchange21" target="_blank">onNativeEmbedObjectParamChange()</a>回调。</p>     <ul>      <li>       <p>支持上报param元素的增加、修改、删除三种状态变化。</p></li>      <li>       <p>接口每次最多上报500个param元素变化信息，超出部分将分多次上报。</p></li>      <li>       <p>详细上报信息参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-i#nativeembedparamdatainfo21" target="_blank">NativeEmbedParamDataInfo</a>。</p></li>     </ul>     <p><strong>约束限制：</strong></p>     <ul>      <li>       <p>Web页面内同层标签数量应控制在5个以内。超过5个，渲染性能将会下降。</p></li>      <li>       <p>受GPU限制，同层标签最大高度不超过8000px，最大纹理大小为8000px。</p></li>      <li>       <p>开启同层渲染后，Web组件打开的所有Web页面将不支持同步渲染模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-e#rendermode12" target="_blank">RenderMode</a>。</p></li>      <li>       <p>Video组件：在非全屏Video变为全屏时，Video组件变为非纹理导出模式，视频播放状态保持延续；恢复为非全屏时，变为纹理导出模式，视频播放状态保持延续。</p></li>      <li>       <p>Web组件：仅支持一层同层渲染嵌套，不支持多层同层渲染嵌套。输入事件只支持滑动、点击、长按，不支持拖拽、旋转、缩放。</p></li>      <li>       <p>涉及界面交互的ArkUI组件（如TextInput等）：建议在页面布局中使用Stack包裹同层组件容器与BuilderNode，并使两者位置一致，NodeContainer要与&lt;embed&gt;/&lt;object&gt;标签对齐，以保障组件正常交互。如两者位置不一致，可能出现的问题有：TextInput/TextArea等附属的文本选择框位置错位（如下图）、LoadingProgress/Marquee等组件的动画启停与组件可见状态不匹配。</p>       <p><strong>图2</strong> 未使用Stack包裹，TextInput的位置错位</p>       <p><span><img originheight="429" originwidth="251" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.32033827704512693368988095316649:50001231000000:2800:4019626FF7E7EB8CF30DFD785E475619E80D55DE1817AF1AB00C3F526950E493.png" class="notEnlarge" width="251" height="429"></span></p>       <p><strong>图3</strong> 使用Stack包裹，TextInput的位置正常</p>       <p><span><img originheight="422" originwidth="250" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.17061482111949818181473458495258:50001231000000:2800:ECE4D26E65E536D69708DAD8C922DDBF0791D6C5C03961AE41527F4DCE35E554.png" class="notEnlarge" width="250" height="422"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="web页面中同层渲染输入框">Web页面中同层渲染输入框<i class="anchor-icon anchor-icon-link" anchorid="web页面中同层渲染输入框" tips="复制节点链接"></i></h2>          <p>在Web页面中，可以使用ArkUI系统的TextInput组件进行同层渲染。此处利用同层渲染展示三个输入框，渲染效果图如下：</p>     <p><strong>图4</strong> 同层渲染输入框</p>     <p><span><img originheight="619" originwidth="388" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.15153656071259123247288499756733:50001231000000:2800:C13B88AF9694F629E231E08D15ABCFE3342C2860DE72FA8D2C58EF55A430023E.png" width="388" height="619"></span></p>     <ol>      <li>       <p>在Web页面中标记需要同层渲染的HTML标签。</p>       <p>同层渲染支持&lt;embed&gt;/&lt;object&gt;两种标签。type类型可任意指定，两个字符串参数均不区分大小写，ArkWeb内核将会统一转换为小写。其中，tag字符串使用全字符串匹配，type使用字符串前缀匹配。</p>       <p>若开发者不使用该接口或该接口接收的为非法字符串（空字符串）时，ArkWeb内核将使用默认设置，即"embed" + "native/"前缀模式。若指定类型与w3c定义的&lt;embed&gt;或&lt;object&gt;标准类型重合，如registerNativeEmbedRule("object", "application/pdf")，ArkWeb将遵循w3c标准行为，不会将其识别为同层标签。</p>       <ul>        <li>         <p>采用&lt;embed&gt;标签。</p>         <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--HAP's src/main/resources/rawfile/text.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>同层渲染html<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background:white"</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input1"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"native/view"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 600px"</span>/&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input2"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"native/view2"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 50px"</span>/&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input3"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"native/view3"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 50px"</span>/&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>        <li>         <p>采用&lt;object&gt;标签。</p>         <p>需要使用registerNativeEmbedRule注册object标签。</p>         <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>  <span class="hljs-comment">// 注册同层标签为"object"，类型为"test"前缀。</span></li><li>  .<span class="hljs-title function_">registerNativeEmbedRule</span>(<span class="hljs-string">"object"</span>, <span class="hljs-string">"test"</span>)</li><li>  <span class="hljs-comment">// ...</span></li></ol></pre></div></div>         <p>与registerNativeEmbedRule相对应的前端页面代码，类型可使用"test"及以"test"为前缀的字串。</p>         <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--HAP's src/main/resources/rawfile/text.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>同层渲染html<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background:white"</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">object</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input1"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"test/input"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 600px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">object</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input2"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"test/input"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 50px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">object</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input3"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"test/input"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 100px; margin: 30px; margin-top: 50px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>       </ul></li>      <li>       <p>在应用侧开启同层渲染功能。</p>       <p>同层渲染功能默认不开启，如果要使用同层渲染的功能，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#enablenativeembedmode11" target="_blank">enableNativeEmbedMode</a>来开启。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>        .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>创建自定义组件。</p>       <p>同层渲染功能开启后，展示在对应区域的系统组件。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextInputComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'please input your word...'</span>})</li><li>        .<span class="hljs-title function_">placeholderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">elementId</span>)</li><li>        .<span class="hljs-title function_">placeholderFont</span>({<span class="hljs-attr">size</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">400</span>})</li><li>        .<span class="hljs-title function_">caretColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">width</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">height</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>    }</li><li>    <span class="hljs-comment">//自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">TextInputBuilder</span>(<span class="hljs-params">params:Params</span>) {</li><li>  <span class="hljs-title class_">TextInputComponent</span>({<span class="hljs-attr">params</span>: params})</li><li>    .<span class="hljs-title function_">width</span>(params.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(params.<span class="hljs-property">height</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>}</li></ol></pre></div></div></li>      <li>       <p>创建节点控制器。</p>       <p>用于控制和反馈对应NodeContainer上的节点行为。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">embedId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">surfaceId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">renderType_</span>: <span class="hljs-title class_">NodeRenderType</span> = <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_DISPLAY</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">width_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">height_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">type_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isDestroy_</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">setRenderOption</span>(<span class="hljs-params">params: NodeControllerParams</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span> = params.<span class="hljs-property">surfaceId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> = params.<span class="hljs-property">renderType</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span> = params.<span class="hljs-property">embedId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span> = params.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span> = params.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> = params.<span class="hljs-property">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 必须要重写的方法，用于构建节点数、返回节点数挂载在对应NodeContainer中。</span></li><li>  <span class="hljs-comment">// 在对应NodeContainer创建的时候调用、或者通过rebuild方法调用刷新。</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) { <span class="hljs-comment">// rootNode为null。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {<span class="hljs-comment">// rootNode 为undefined时。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">surfaceId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span>, <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> });</li><li>      <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">TextInputBuilder</span>), {  <span class="hljs-attr">textOne</span>: <span class="hljs-string">"myTextInput"</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span>  })</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>      }<span class="hljs-keyword">else</span>{</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 返回FrameNode节点。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">updateNode</span>(<span class="hljs-attr">arg</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">update</span>(arg);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getEmbedId</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span>;</li><li>  }</li><li>  </li><li>  <span class="hljs-title function_">setDestroy</span>(<span class="hljs-attr">isDestroy</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span> = isDestroy;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li> </li><li>  <span class="hljs-title function_">postEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">TouchEvent</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postTouchEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>监听同层渲染的生命周期变化。</p>       <p>开启该功能后，当网页中存在同层渲染支持的标签时，ArkWeb内核会触发由<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedlifecyclechange11" target="_blank">onNativeEmbedLifecycleChange</a>注册的回调函数。</p>       <p>开发者则需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedlifecyclechange11" target="_blank">onNativeEmbedLifecycleChange</a>来监听同层渲染标签的生命周期变化。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>        }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>        <span class="hljs-comment">// Web组件加载本地text.html页面。</span></li><li>        <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>          <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>          .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>            <span class="hljs-comment">// 注册同层标签为&lt;object&gt;，类型为"test"前缀。</span></li><li>          .<span class="hljs-title function_">registerNativeEmbedRule</span>(<span class="hljs-string">"object"</span>, <span class="hljs-string">"test"</span>)</li><li>            <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>          .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed surfaceId"</span> + embed.<span class="hljs-property">surfaceId</span>);</li><li>            <span class="hljs-comment">// 如果使用embed.info.id作为映射nodeController的key，请在h5页面显式指定id。</span></li><li>            <span class="hljs-keyword">const</span> componentId = embed.<span class="hljs-property">info</span>?.<span class="hljs-property">id</span>?.<span class="hljs-title function_">toString</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span></li><li>            <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">CREATE</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed create"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed.<span class="hljs-property">info</span>));</li><li>              <span class="hljs-comment">// 创建节点控制器、设置参数。</span></li><li>              <span class="hljs-keyword">let</span> nodeController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>              <span class="hljs-comment">// embed.info.width和embed.info.height单位是px格式，需要转换成ets侧的默认单位vp。</span></li><li>              nodeController.<span class="hljs-title function_">setRenderOption</span>({surfaceId : embed.<span class="hljs-property">surfaceId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                <span class="hljs-keyword">type</span> : embed.<span class="hljs-property">info</span>?.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                renderType : <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_TEXTURE</span>,</li><li>                embedId : embed.<span class="hljs-property">embedId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                width : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>),</li><li>                height : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)})</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>              nodeController.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">false</span>);</li><li>              <span class="hljs-comment">//根据web传入的embed的id属性作为key，将nodeController存入Map。</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">set</span>(componentId, nodeController);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>              <span class="hljs-comment">// 将web传入的embed的id属性存入@State状态数组变量中，用于动态创建nodeContainer节点容器,需要将push动作放在set之后。</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">push</span>(componentId)</li><li>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">UPDATE</span>) {</li><li>              <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed update"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>              nodeController?.<span class="hljs-title function_">updateNode</span>({<span class="hljs-attr">textOne</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>), <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span>)</li><li>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">DESTROY</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed destroy"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>              <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>              nodeController?.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">true</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> value !== componentId);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed status"</span> + embed.<span class="hljs-property">status</span>);</li><li>            }</li><li>          })</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">"80%"</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同层渲染手势事件。</p>       <p>开启该功能后，每当在同层渲染的区域进行触摸操作时，ArkWeb内核会触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedgestureevent11" target="_blank">onNativeEmbedGestureEvent</a>注册的回调函数。</p>       <p>开发者则需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedgestureevent11" target="_blank">onNativeEmbedGestureEvent</a>来监听同层渲染区域的手势事件。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>        }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>        <span class="hljs-comment">// Web组件加载本地text.html页面。</span></li><li>        <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>          <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>          .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>            <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>          .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 生命周期变化实现。</span></li><li>          })</li><li>          .<span class="hljs-title function_">onNativeEmbedGestureEvent</span>(<span class="hljs-function">(<span class="hljs-params">touch</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedGestureEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(touch.<span class="hljs-property">touchEvent</span>));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>              <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>              <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == touch.<span class="hljs-property">embedId</span>) {</li><li>                <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postEvent</span>(touch.<span class="hljs-property">touchEvent</span>)</li><li>                <span class="hljs-keyword">if</span>(ret) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent success "</span> + componentId);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent fail "</span> + componentId);</li><li>                }</li><li>                <span class="hljs-keyword">if</span>(touch.<span class="hljs-property">result</span>) {</li><li>                  <span class="hljs-comment">// 通知Web组件手势事件消费结果。</span></li><li>                  touch.<span class="hljs-property">result</span>.<span class="hljs-title function_">setGestureEventResult</span>(ret);</li><li>                }</li><li>              }</li><li>            })</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同层渲染鼠标事件</p>       <p>开启该功能后，在同层渲染的区域进行下述动作时，ArkWeb内核会触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedmouseevent20" target="_blank">onNativeEmbedMouseEvent</a>注册的回调函数：</p>       <ul>        <li>使用鼠标左键、中键、右键进行点击或长按。</li>        <li>使用触摸板进行对应鼠标左键、中键、右键点击长按的操作。</li>       </ul>       <p>开发者则需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onnativeembedmouseevent20" target="_blank">onNativeEmbedMouseEvent</a>来监听同层渲染区域的鼠标事件。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>        }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>        <span class="hljs-comment">// Web组件加载本地text.html页面。</span></li><li>        <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>          <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>          .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>            <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>          .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 生命周期变化实现。</span></li><li>          })</li><li>          .<span class="hljs-title function_">onNativeEmbedGestureEvent</span>(<span class="hljs-function">(<span class="hljs-params">touch</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 处理同层渲染手势事件。</span></li><li>          })</li><li>          .<span class="hljs-title function_">onNativeEmbedMouseEvent</span>(<span class="hljs-function">(<span class="hljs-params">mouse</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedMouseEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(mouse.<span class="hljs-property">mouseEvent</span>));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>              <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>              <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == mouse.<span class="hljs-property">embedId</span>) {</li><li>                <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postInputEvent</span>(mouse.<span class="hljs-property">mouseEvent</span>)</li><li>                <span class="hljs-keyword">if</span>(ret) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent success "</span> + componentId);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent fail "</span> + componentId);</li><li>                }</li><li>                <span class="hljs-keyword">if</span>(mouse.<span class="hljs-property">result</span>) {</li><li>                  <span class="hljs-comment">// 通知Web组件鼠标事件消费结果。</span></li><li>                  mouse.<span class="hljs-property">result</span>.<span class="hljs-title function_">setMouseEventResult</span>(ret);</li><li>                }</li><li>              }</li><li>            })</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>     <p><strong>完整示例：</strong></p>     <p>使用前请在module.json5中添加网络权限，添加方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#在配置文件中声明权限">在配置文件中声明权限</a>。</p>     <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"requestPermissions"</span>:[</li><li>    {</li><li>      <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.INTERNET"</span></li><li>    }</li><li>  ]</li></ol></pre></div></div>     <p>应用侧代码。</p>     <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建NodeController</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">NodeRenderType</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span>{</li><li>  <span class="hljs-attr">elementId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">textOne</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">textTwo</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NodeControllerParams</span> {</li><li>  <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">renderType</span>: <span class="hljs-title class_">NodeRenderType</span></li><li>  <span class="hljs-attr">embedId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 用于控制和反馈对应的NodeContainer上的节点的行为，需要与NodeContainer一起使用。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">embedId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">surfaceId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">renderType_</span>: <span class="hljs-title class_">NodeRenderType</span> = <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_DISPLAY</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">width_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">height_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">type_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isDestroy_</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">setRenderOption</span>(<span class="hljs-params">params: NodeControllerParams</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span> = params.<span class="hljs-property">surfaceId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> = params.<span class="hljs-property">renderType</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span> = params.<span class="hljs-property">embedId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span> = params.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span> = params.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> = params.<span class="hljs-property">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 必须要重写的方法，用于构建节点数、返回节点数挂载在对应NodeContainer中。</span></li><li>  <span class="hljs-comment">// 在对应NodeContainer创建的时候调用、或者通过rebuild方法调用刷新。</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) { <span class="hljs-comment">// rootNode为null。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {<span class="hljs-comment">// rootNode 为undefined时。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">surfaceId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span>, <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> });</li><li>      <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">TextInputBuilder</span>), {  <span class="hljs-attr">textOne</span>: <span class="hljs-string">"myTextInput"</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span>  })</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>      }<span class="hljs-keyword">else</span>{</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 返回FrameNode节点。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">updateNode</span>(<span class="hljs-attr">arg</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">update</span>(arg);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getEmbedId</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setDestroy</span>(<span class="hljs-attr">isDestroy</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span> = isDestroy;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">TouchEvent</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postTouchEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postInputEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postInputEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextInputComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'please input your word...'</span>})</li><li>        .<span class="hljs-title function_">placeholderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">elementId</span>)</li><li>        .<span class="hljs-title function_">placeholderFont</span>({<span class="hljs-attr">size</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">400</span>})</li><li>        .<span class="hljs-title function_">caretColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>    }</li><li>    <span class="hljs-comment">//自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// @Builder中为动态组件的具体组件内容。</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">TextInputBuilder</span>(<span class="hljs-params">params:Params</span>) {</li><li>  <span class="hljs-title class_">TextInputComponent</span>({<span class="hljs-attr">params</span>: params})</li><li>    .<span class="hljs-title function_">width</span>(params.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(params.<span class="hljs-property">height</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>{</li><li>  <span class="hljs-attr">browserTabController</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeControllerMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyNodeController</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">componentIdArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">widthMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">heightMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">positionMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Edges</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">edges</span>: <span class="hljs-title class_">Edges</span> = {};</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Stack</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>          }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>          <span class="hljs-comment">// Web组件加载本地text.html页面。</span></li><li>          <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>            <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>            .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>            <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed surfaceId"</span> + embed.<span class="hljs-property">surfaceId</span>);</li><li>               <span class="hljs-comment">// 如果使用embed.info.id作为映射nodeController的key，请在h5页面显式指定id。</span></li><li>               <span class="hljs-keyword">const</span> componentId = embed.<span class="hljs-property">info</span>?.<span class="hljs-property">id</span>?.<span class="hljs-title function_">toString</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span></li><li>               <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">CREATE</span>) {</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed create"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed.<span class="hljs-property">info</span>));</li><li>                 <span class="hljs-comment">// 创建节点控制器、设置参数。</span></li><li>                 <span class="hljs-keyword">let</span> nodeController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>                 <span class="hljs-comment">// embed.info.width和embed.info.height单位是px格式，需要转换成ets侧的默认单位vp。</span></li><li>                 nodeController.<span class="hljs-title function_">setRenderOption</span>({surfaceId : embed.<span class="hljs-property">surfaceId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                   <span class="hljs-keyword">type</span> : embed.<span class="hljs-property">info</span>?.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                   renderType : <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_TEXTURE</span>,</li><li>                   embedId : embed.<span class="hljs-property">embedId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                   width : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>),</li><li>                   height : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)})</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                 nodeController.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">false</span>);</li><li>                 <span class="hljs-comment">//根据web传入的embed的id属性作为key，将nodeController存入Map。</span></li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">set</span>(componentId, nodeController);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                 <span class="hljs-comment">// 将web传入的embed的id属性存入@State状态数组变量中，用于动态创建nodeContainer节点容器,需要将push动作放在set之后。</span></li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">push</span>(componentId)</li><li>               } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">UPDATE</span>) {</li><li>                 <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed update"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                 nodeController?.<span class="hljs-title function_">updateNode</span>({<span class="hljs-attr">textOne</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>), <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span>)</li><li>               } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">DESTROY</span>) {</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed destroy"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>                 <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                 nodeController?.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">true</span>);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> value !== componentId);</li><li>               } <span class="hljs-keyword">else</span> {</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed status"</span> + embed.<span class="hljs-property">status</span>);</li><li>               }</li><li>             })<span class="hljs-comment">// 获取同层渲染组件触摸事件信息。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedGestureEvent</span>(<span class="hljs-function">(<span class="hljs-params">touch</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedGestureEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(touch.<span class="hljs-property">touchEvent</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>                <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == touch.<span class="hljs-property">embedId</span>) {</li><li>                  <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postEvent</span>(touch.<span class="hljs-property">touchEvent</span>)</li><li>                  <span class="hljs-keyword">if</span>(ret) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent success "</span> + componentId);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent fail "</span> + componentId);</li><li>                  }</li><li>                  <span class="hljs-keyword">if</span>(touch.<span class="hljs-property">result</span>) {</li><li>                    <span class="hljs-comment">// 通知Web组件手势事件消费结果。</span></li><li>                    touch.<span class="hljs-property">result</span>.<span class="hljs-title function_">setGestureEventResult</span>(ret);</li><li>                  }</li><li>                }</li><li>              })</li><li>            })</li><li>            .<span class="hljs-title function_">onNativeEmbedMouseEvent</span>(<span class="hljs-function">(<span class="hljs-params">mouse</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedMouseEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(mouse.<span class="hljs-property">mouseEvent</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>                <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == mouse.<span class="hljs-property">embedId</span>) {</li><li>                  <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postInputEvent</span>(mouse.<span class="hljs-property">mouseEvent</span>)</li><li>                  <span class="hljs-keyword">if</span>(ret) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent success "</span> + componentId);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent fail "</span> + componentId);</li><li>                  }</li><li>                  <span class="hljs-keyword">if</span>(mouse.<span class="hljs-property">result</span>) {</li><li>                    <span class="hljs-comment">// 通知Web组件鼠标事件消费结果。</span></li><li>                    mouse.<span class="hljs-property">result</span>.<span class="hljs-title function_">setMouseEventResult</span>(ret);</li><li>                  }</li><li>                }</li><li>              })</li><li>            })</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="绘制xcomponentavplayer和button组件">绘制XComponent+AVPlayer和Button组件<i class="anchor-icon anchor-icon-link" anchorid="绘制xcomponentavplayer和button组件" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>应用侧代码组件使用示例。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// HAP's src/main/ets/pages/Index.ets</span></li><li><span class="hljs-comment">// 创建NodeController</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">NodeRenderType</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AVPlayerDemo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./PlayerDemo'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  textOne : <span class="hljs-built_in">string</span></li><li>  textTwo : <span class="hljs-built_in">string</span></li><li>  width : <span class="hljs-built_in">number</span></li><li>  height : <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NodeControllerParams</span> {</li><li>  surfaceId : <span class="hljs-built_in">string</span></li><li>  <span class="hljs-keyword">type</span> : <span class="hljs-built_in">string</span></li><li>  renderType : <span class="hljs-title class_">NodeRenderType</span></li><li>  embedId : <span class="hljs-built_in">string</span></li><li>  width : <span class="hljs-built_in">number</span></li><li>  height : <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 用于控制和反馈对应的NodeContainer上的节点的行为，需要与NodeContainer一起使用。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> embedId_ : <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> surfaceId_ : <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> renderType_ :<span class="hljs-title class_">NodeRenderType</span> = <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_DISPLAY</span>;</li><li>  <span class="hljs-keyword">private</span> width_ : <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> height_ : <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> type_ : <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> isDestroy_ : <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">setRenderOption</span>(<span class="hljs-params">params : NodeControllerParams</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span> = params.<span class="hljs-property">surfaceId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> = params.<span class="hljs-property">renderType</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span> = params.<span class="hljs-property">embedId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span> = params.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span> = params.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> = params.<span class="hljs-property">type</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 必须要重写的方法，用于构建节点数、返回节点数挂载在对应NodeContainer中。</span></li><li>  <span class="hljs-comment">// 在对应NodeContainer创建的时候调用、或者通过rebuild方法调用刷新。</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span>{</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) { <span class="hljs-comment">// rootNode为null。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) { <span class="hljs-comment">// rootNode 为undefined时。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">surfaceId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span>, <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span>});</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> === <span class="hljs-string">'native/video'</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">VideoBuilder</span>), {<span class="hljs-attr">textOne</span>: <span class="hljs-string">"myButton"</span>, width : <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span>, height : <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span>});</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// other</span></li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 返回FrameNode节点。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">updateNode</span>(<span class="hljs-attr">arg</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">update</span>(arg);</li><li>  }</li><li>  <span class="hljs-title function_">getEmbedId</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setDestroy</span>(isDestroy : <span class="hljs-built_in">boolean</span>) : <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span> = isDestroy;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">TouchEvent</span> | <span class="hljs-literal">undefined</span>) : <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postTouchEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postInputEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postInputEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">VideoComponent</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span></li><li>  <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">player_changed</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  player?: <span class="hljs-title class_">AVPlayerDemo</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">textOne</span>)</li><li>
</li><li>      <span class="hljs-title class_">XComponent</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'video_player_id'</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>})</li><li>        .<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>})</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AVPlayerDemo</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">setSurfaceID</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>());</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">player_changed</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">player_changed</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">avPlayerLiveDemo</span>()</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>    }</li><li>    <span class="hljs-comment">//自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>  }</li><li>}</li><li><span class="hljs-comment">// @Builder中为动态组件的具体组件内容。</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">VideoComponent</span>({ <span class="hljs-attr">params</span>: params })</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebIndex</span> {</li><li>  <span class="hljs-attr">browserTabController</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeControllerMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyNodeController</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">componentIdArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">widthMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">heightMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">positionMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Edges</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">edges</span>: <span class="hljs-title class_">Edges</span> = {};</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 配置web开启调试模式。</span></li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setWebDebuggingAccess</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Stack</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>          }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>          <span class="hljs-comment">// Web组件加载本地test.html页面。</span></li><li>          <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"test.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span> })</li><li>            <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>            .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>              <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed surfaceId"</span> + embed.<span class="hljs-property">surfaceId</span>);</li><li>              <span class="hljs-comment">// 1. 如果使用embed.info.id作为映射nodeController的key，请在h5页面显式指定id。</span></li><li>              <span class="hljs-keyword">const</span> componentId = embed.<span class="hljs-property">info</span>?.<span class="hljs-property">id</span>?.<span class="hljs-title function_">toString</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span></li><li>              <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">CREATE</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed create"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed.<span class="hljs-property">info</span>))</li><li>                <span class="hljs-comment">// 创建节点控制器，设置参数。</span></li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>                <span class="hljs-comment">// 1. embed.info.width和embed.info.height单位是px格式，需要转换成ets侧的默认单位vp。</span></li><li>                nodeController.<span class="hljs-title function_">setRenderOption</span>({surfaceId : embed.<span class="hljs-property">surfaceId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span> : embed.<span class="hljs-property">info</span>?.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                  renderType : <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_TEXTURE</span>, embedId : embed.<span class="hljs-property">embedId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                  width : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>), height : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)})</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                nodeController.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">false</span>);</li><li>                <span class="hljs-comment">// 根据web传入的embed的id属性作为key，将nodeController存入map。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">set</span>(componentId, nodeController)</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                <span class="hljs-comment">// 将web传入的embed的id属性存入@State状态数组变量中，用于动态创建nodeContainer节点容器，需要将push动作放在set之后。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">push</span>(componentId)</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">UPDATE</span>) {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId)</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                nodeController?.<span class="hljs-title function_">updateNode</span>({<span class="hljs-attr">textOne</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>), <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span>)</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">DESTROY</span>) {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                nodeController?.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">true</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> value !== componentId);</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed status"</span> + embed.<span class="hljs-property">status</span>);</li><li>              }</li><li>            })<span class="hljs-comment">// 获取同层渲染组件触摸事件信息。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedGestureEvent</span>(<span class="hljs-function">(<span class="hljs-params">touch</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedGestureEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(touch.<span class="hljs-property">touchEvent</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId)</li><li>                <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>                <span class="hljs-keyword">if</span> (nodeController?.<span class="hljs-title function_">getEmbedId</span>() === touch.<span class="hljs-property">embedId</span>) {</li><li>                  <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postEvent</span>(touch.<span class="hljs-property">touchEvent</span>)</li><li>                  <span class="hljs-keyword">if</span> (ret) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent success "</span> + componentId)</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent fail "</span> + componentId)</li><li>                  }</li><li>                  <span class="hljs-keyword">if</span> (touch.<span class="hljs-property">result</span>) {</li><li>                    <span class="hljs-comment">// 通知Web组件手势事件消费结果。</span></li><li>                    touch.<span class="hljs-property">result</span>.<span class="hljs-title function_">setGestureEventResult</span>(ret);</li><li>                  }</li><li>                }</li><li>              })</li><li>            })</li><li>            .<span class="hljs-title function_">onNativeEmbedMouseEvent</span>(<span class="hljs-function">(<span class="hljs-params">mouse</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedMouseEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(mouse.<span class="hljs-property">mouseEvent</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>                <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == mouse.<span class="hljs-property">embedId</span>) {</li><li>                  <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postInputEvent</span>(mouse.<span class="hljs-property">mouseEvent</span>)</li><li>                  <span class="hljs-keyword">if</span>(ret) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent success "</span> + componentId);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedMouseEvent fail "</span> + componentId);</li><li>                  }</li><li>                  <span class="hljs-keyword">if</span>(mouse.<span class="hljs-property">result</span>) {</li><li>                    <span class="hljs-comment">// 通知Web组件鼠标事件消费结果。</span></li><li>                    mouse.<span class="hljs-property">result</span>.<span class="hljs-title function_">setMouseEventResult</span>(ret);</li><li>                  }</li><li>                }</li><li>              })</li><li>            })</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>应用侧代码示例，视频播放，使用时需替换为正确的视频链接地址。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// HAP's src/main/ets/pages/PlayerDemo.ets</span></li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AVPlayerDemo</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">surfaceID</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// surfaceID用于播放画面显示，具体的值需要通过Xcomponent接口获取，相关文档链接见上面Xcomponent创建方法。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isSeek</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 用于区分模式是否支持seek操作。</span></li><li>
</li><li>  <span class="hljs-title function_">setSurfaceID</span>(<span class="hljs-params">surface_id: <span class="hljs-built_in">string</span></span>){</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'setSurfaceID : '</span> + surface_id);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceID</span> = surface_id;</li><li>  }</li><li>  <span class="hljs-comment">// 注册avplayer回调函数。</span></li><li>  <span class="hljs-title function_">setAVPlayerCallback</span>(<span class="hljs-params">avPlayer: media.AVPlayer</span>) {</li><li>    <span class="hljs-comment">// seek操作结果回调函数。</span></li><li>    avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'seekDone'</span>, <span class="hljs-function">(<span class="hljs-params">seekDoneTime: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`AVPlayer seek succeeded, seek time is <span class="hljs-subst">${seekDoneTime}</span>`</span>);</li><li>    })</li><li>    <span class="hljs-comment">// error回调监听函数，当avplayer在操作过程中出现错误时，调用reset接口触发重置流程。</span></li><li>    avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Invoke avPlayer failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      avPlayer.<span class="hljs-title function_">reset</span>();</li><li>    })</li><li>    <span class="hljs-comment">// 状态机变化回调函数。</span></li><li>    avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stateChange'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">state</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">reason</span>: media.<span class="hljs-property">StateChangeReason</span>) =&gt; {</li><li>      <span class="hljs-keyword">switch</span> (state) {</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'idle'</span>: <span class="hljs-comment">// 成功调用reset接口后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state idle called.'</span>);</li><li>          avPlayer.<span class="hljs-title function_">release</span>(); <span class="hljs-comment">// 调用release接口销毁实例对象。</span></li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'initialized'</span>: <span class="hljs-comment">// avplayer 设置播放源后触发该状态上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state initialized called.'</span>);</li><li>          avPlayer.<span class="hljs-property">surfaceId</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceID</span>; <span class="hljs-comment">// 设置显示画面，当播放的资源为纯音频时无需设置。</span></li><li>          avPlayer.<span class="hljs-title function_">prepare</span>();</li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'prepared'</span>: <span class="hljs-comment">// prepared调用成功后上报该状态机。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state prepared called.'</span>);</li><li>          avPlayer.<span class="hljs-title function_">play</span>(); <span class="hljs-comment">// 调用播放接口开始播放。</span></li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'playing'</span>: <span class="hljs-comment">// play成功调用后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state playing called.'</span>);</li><li>          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> !== <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isSeek</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer start to seek.'</span>);</li><li>              avPlayer.<span class="hljs-title function_">seek</span>(avPlayer.<span class="hljs-property">duration</span>); <span class="hljs-comment">// seek到视频末尾。</span></li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-comment">// 当播放模式不支持seek操作时继续播放到结尾。</span></li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer wait to play end.'</span>);</li><li>            }</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            avPlayer.<span class="hljs-title function_">pause</span>(); <span class="hljs-comment">// 调用暂停接口暂停播放。</span></li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'paused'</span>: <span class="hljs-comment">// pause成功调用后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state paused called.'</span>);</li><li>          avPlayer.<span class="hljs-title function_">play</span>(); <span class="hljs-comment">// 再次播放接口开始播放。</span></li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'completed'</span>: <span class="hljs-comment">//播放接口后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state completed called.'</span>);</li><li>          avPlayer.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// 调用播放接口。</span></li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'stopped'</span>: <span class="hljs-comment">// stop接口后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state stopped called.'</span>);</li><li>          avPlayer.<span class="hljs-title function_">reset</span>(); <span class="hljs-comment">// 调用reset接口初始化avplayer状态。</span></li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'released'</span>: <span class="hljs-comment">//播放接口后触发该状态机上报。</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AVPlayer state released called.'</span>);</li><li>          <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-attr">default</span>:</li><li>          <span class="hljs-keyword">break</span>;</li><li>      }</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通过url设置网络地址来实现播放直播码流。</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">avPlayerLiveDemo</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-comment">// 创建avPlayer实例对象。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">avPlayer</span>: media.<span class="hljs-property">AVPlayer</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVPlayer</span>();</li><li>    <span class="hljs-comment">// 创建状态机变化回调函数。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setAVPlayerCallback</span>(avPlayer);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSeek</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 不支持seek操作。</span></li><li>    <span class="hljs-comment">// 使用时需要自行替换视频链接。</span></li><li>    avPlayer.<span class="hljs-property">url</span> = <span class="hljs-string">'https://xxx.xxx/demo.mp4'</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>前端页面示例。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--HAP's src/main/resources/rawfile/test.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>同层渲染测试html<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bodyId"</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nativeVideo"</span> <span class="hljs-attr">type</span> = <span class="hljs-string">"native/video"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"1500"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"test"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"background-color:red"</span>/&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>      <li>       <p>实现效果：</p>       <p><span><img originheight="569" originwidth="362" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.79719233368499156977487194729394:50001231000000:2800:2D44B9CFEC1142493DFB0885DF99658452C06458742F75C9EEBD5D32DDB1EC12.png" width="362" height="569"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="同层标签设置为最高层级">同层标签设置为最高层级<i class="anchor-icon anchor-icon-link" anchorid="同层标签设置为最高层级" tips="复制节点链接"></i></h2>          <p>同层渲染支持私有属性arkwebnativestyle，该属性仅在开启同层渲染后的&lt;embed&gt;和&lt;object&gt;中生效，该属性的display属性用于控制同层标签的显示层级，使其高于其他Web元素。如果多个同层标签都设置了arkwebnativestyle的display属性，并且属性相同，则它们的层级顺序将遵循W3C标准层级排序规则：先比较z-index属性值，当z-index相同时，按照元素在DOM中的先后顺序排序。display属性取值说明如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.3.1.1" valign="top" width="50%">display取值</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">overlay</td>         <td class="cellrowborder" valign="top" width="50%">设置同层标签层级高于其他Web元素。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">overlay-infinity</td>         <td class="cellrowborder" valign="top" width="50%">设置同层标签层级高于其他Web元素和设置overlay的同层标签。</td>        </tr>             </tbody></table></div>     </div>     <ul>      <li>       <p>应用侧代码：</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">NodeRenderType</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span>{</li><li>  <span class="hljs-attr">elementId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">textOne</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">textTwo</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NodeControllerParams</span> {</li><li>  <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">renderType</span>: <span class="hljs-title class_">NodeRenderType</span></li><li>  <span class="hljs-attr">embedId</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 用于控制和反馈对应的NodeContainer上的节点的行为，需要与NodeContainer一起使用。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">embedId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">surfaceId_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">renderType_</span>: <span class="hljs-title class_">NodeRenderType</span> = <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_DISPLAY</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">width_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">height_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">type_</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isDestroy_</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">setRenderOption</span>(<span class="hljs-params">params: NodeControllerParams</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span> = params.<span class="hljs-property">surfaceId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> = params.<span class="hljs-property">renderType</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span> = params.<span class="hljs-property">embedId</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span> = params.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span> = params.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> = params.<span class="hljs-property">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 必须要重写的方法，用于构建节点数、返回节点数挂载在对应NodeContainer中。</span></li><li>  <span class="hljs-comment">// 在对应NodeContainer创建的时候调用、或者通过rebuild方法调用刷新。</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) { <span class="hljs-comment">// rootNode为null。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {<span class="hljs-comment">// rootNode 为undefined时。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">surfaceId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">surfaceId_</span>, <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderType_</span> });</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> == <span class="hljs-string">'native/view1'</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">TextInputBuilder1</span>), {  <span class="hljs-attr">textOne</span>: <span class="hljs-string">"myTextInput"</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span>  })</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type_</span> == <span class="hljs-string">'native/view2'</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">TextInputBuilder2</span>), {  <span class="hljs-attr">textOne</span>: <span class="hljs-string">"myTextInput"</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width_</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height_</span>  })</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>      } <span class="hljs-keyword">else</span>{</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 返回FrameNode节点。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">updateNode</span>(<span class="hljs-attr">arg</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">update</span>(arg);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getEmbedId</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">embedId_</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setDestroy</span>(<span class="hljs-attr">isDestroy</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span> = isDestroy;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDestroy_</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">TouchEvent</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">postTouchEvent</span>(event) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextInputComponent1</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"display:overlay-infinity"</span>)</li><li>      <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'please input your word...'</span>})</li><li>        .<span class="hljs-title function_">placeholderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">elementId</span>)</li><li>        .<span class="hljs-title function_">placeholderFont</span>({<span class="hljs-attr">size</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">400</span>})</li><li>        .<span class="hljs-title function_">caretColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>    }</li><li>    <span class="hljs-comment">// 自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// @Builder中为动态组件的具体组件内容。</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">TextInputBuilder1</span>(<span class="hljs-params">params:Params</span>) {</li><li>  <span class="hljs-title class_">TextInputComponent1</span>({<span class="hljs-attr">params</span>: params})</li><li>    .<span class="hljs-title function_">width</span>(params.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(params.<span class="hljs-property">height</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextInputComponent2</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"display:overlay"</span>)</li><li>      <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'please input your word...'</span>})</li><li>        .<span class="hljs-title function_">placeholderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>?.<span class="hljs-property">elementId</span>)</li><li>        .<span class="hljs-title function_">placeholderFont</span>({<span class="hljs-attr">size</span>: <span class="hljs-number">13</span>, <span class="hljs-attr">weight</span>: <span class="hljs-number">400</span>})</li><li>        .<span class="hljs-title function_">caretColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>    }</li><li>    <span class="hljs-comment">// 自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-comment">// @Builder中为动态组件的具体组件内容。</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">TextInputBuilder2</span>(<span class="hljs-params">params:Params</span>) {</li><li>  <span class="hljs-title class_">TextInputComponent2</span>({<span class="hljs-attr">params</span>: params})</li><li>    .<span class="hljs-title function_">width</span>(params.<span class="hljs-property">width</span>)</li><li>    .<span class="hljs-title function_">height</span>(params.<span class="hljs-property">height</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>{</li><li>  <span class="hljs-attr">browserTabController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeControllerMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyNodeController</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">componentIdArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">widthMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">heightMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">positionMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Edges</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">edges</span>: <span class="hljs-title class_">Edges</span> = {};</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Stack</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>          }, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li><li>          <span class="hljs-comment">// Web组件加载本地text.html页面。</span></li><li>          <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"overlay.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">browserTabController</span>})</li><li>            <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>            .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li><li>              <span class="hljs-comment">// 获取&lt;embed&gt;标签的生命周期变化数据。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedLifecycleChange</span>(<span class="hljs-function">(<span class="hljs-params">embed</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed surfaceId"</span> + embed.<span class="hljs-property">surfaceId</span>);</li><li>              <span class="hljs-comment">// 如果使用embed.info.id作为映射nodeController的key，请在h5页面显式指定id。</span></li><li>              <span class="hljs-keyword">const</span> componentId = embed.<span class="hljs-property">info</span>?.<span class="hljs-property">id</span>?.<span class="hljs-title function_">toString</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span></li><li>              <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">CREATE</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed create"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed.<span class="hljs-property">info</span>));</li><li>                <span class="hljs-comment">// 创建节点控制器、设置参数。</span></li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>                <span class="hljs-comment">// embed.info.width和embed.info.height单位是px格式，需要转换成ets侧的默认单位vp。</span></li><li>                nodeController.<span class="hljs-title function_">setRenderOption</span>({surfaceId : embed.<span class="hljs-property">surfaceId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                  <span class="hljs-keyword">type</span> : embed.<span class="hljs-property">info</span>?.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                  renderType : <span class="hljs-title class_">NodeRenderType</span>.<span class="hljs-property">RENDER_TYPE_TEXTURE</span>,</li><li>                  embedId : embed.<span class="hljs-property">embedId</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,</li><li>                  width : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>),</li><li>                  height : <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)})</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                nodeController.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">false</span>);</li><li>                <span class="hljs-comment">// 根据web传入的embed的id属性作为key，将nodeController存入Map。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">set</span>(componentId, nodeController);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                <span class="hljs-comment">// 将web传入的embed的id属性存入@State状态数组变量中，用于动态创建nodeContainer节点容器,需要将push动作放在set之后。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">push</span>(componentId)</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">UPDATE</span>) {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed update"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span> = {<span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.x <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>, <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${embed.info?.position?.y <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>}</span>px`</span>}</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">edges</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>));</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">set</span>(componentId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>));</li><li>                nodeController?.<span class="hljs-title function_">updateNode</span>({<span class="hljs-attr">textOne</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">width</span>), <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(embed.<span class="hljs-property">info</span>?.<span class="hljs-property">height</span>)} <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span>)</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (embed.<span class="hljs-property">status</span> == <span class="hljs-title class_">NativeEmbedStatus</span>.<span class="hljs-property">DESTROY</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed destroy"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(embed));</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                nodeController?.<span class="hljs-title function_">setDestroy</span>(<span class="hljs-literal">true</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">delete</span>(componentId);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> value !== componentId);</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed status"</span> + embed.<span class="hljs-property">status</span>);</li><li>              }</li><li>            })<span class="hljs-comment">// 获取同层渲染组件触摸事件信息。</span></li><li>            .<span class="hljs-title function_">onNativeEmbedGestureEvent</span>(<span class="hljs-function">(<span class="hljs-params">touch</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NativeEmbed onNativeEmbedGestureEvent"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(touch.<span class="hljs-property">touchEvent</span>));</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> nodeController = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId);</li><li>                <span class="hljs-comment">// 将获取到的同层区域的事件发送到该区域embedId对应的nodeController上。</span></li><li>                <span class="hljs-keyword">if</span>(nodeController?.<span class="hljs-title function_">getEmbedId</span>() == touch.<span class="hljs-property">embedId</span>) {</li><li>                  <span class="hljs-keyword">let</span> ret = nodeController?.<span class="hljs-title function_">postEvent</span>(touch.<span class="hljs-property">touchEvent</span>)</li><li>                  <span class="hljs-keyword">if</span>(ret) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent success "</span> + componentId);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onNativeEmbedGestureEvent fail "</span> + componentId);</li><li>                  }</li><li>                  <span class="hljs-keyword">if</span>(touch.<span class="hljs-property">result</span>) {</li><li>                    <span class="hljs-comment">// 通知Web组件手势事件消费结果。</span></li><li>                    touch.<span class="hljs-property">result</span>.<span class="hljs-title function_">setGestureEventResult</span>(ret);</li><li>                  }</li><li>                }</li><li>              })</li><li>            })</li><li>            .<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>})</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">"50%"</span>)</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>前端页面示例：</p>       <p>示例代码使用&lt;embed&gt;标签，若使用&lt;object&gt;标签，请在ets侧注册&lt;object&gt;标签及type类型。</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--HAP's src/main/resources/rawfile/overlay.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>同层渲染html<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"initial-scale=1.0"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"test"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"position: absolute; z-index: 9999; text-align: center; background-color: rgb(61, 157, 180); top: 40px; left: 30px; width: 300px; height: 120px"</span>&gt;</span></li><li>        z-index: 9999</li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>
</li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input1"</span> <span class="hljs-attr">type</span> = <span class="hljs-string">"native/view1"</span> <span class="hljs-attr">arkwebnativestyle</span> = <span class="hljs-string">"display:overlay-infinity"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"position: absolute; top: 60px; left: 50px; width: 300px; height: 100px"</span>&gt;</span></li><li>
</li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">embed</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"input2"</span> <span class="hljs-attr">type</span> = <span class="hljs-string">"native/view2"</span> <span class="hljs-attr">arkwebnativestyle</span> = <span class="hljs-string">"display:overlay"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"position: absolute; top: 150px; left: 40px; width: 300px; height: 100px"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>      <li>       <p>实现效果：</p>       <p>未设置arkwebnativestyle的display属性：</p>       <p><span><img originheight="601" originwidth="604" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.99733472026406539774540985117166:50001231000000:2800:E7A66CBD0B5E62E997B8118DA0609365D946B4BEEFCBF9E815CF71F1A686AE54.png" width="604" height="601"></span></p>       <p>设置arkwebnativestyle的display属性：</p>       <p><span><img originheight="601" originwidth="604" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114718.80041419305224578966236856248688:50001231000000:2800:0053E7E73F216E33B8B71F158ECFF9E97230800CD9D48FC86F1C66AF582D37A3.png" width="604" height="601"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="同层渲染组件被拉伸该如何解决" class="firsth2">同层渲染组件被拉伸该如何解决？<i class="anchor-icon anchor-icon-link" anchorid="同层渲染组件被拉伸该如何解决" tips="复制节点链接"></i></h3>          <ul>      <li>       <p>组件高度过大</p>       <p>受GPU限制，同层标签存在8000px的高度限制，如果html5中同层标签高度过高，会存在组件被拉伸的情况，这时需要将同层标签的高度设为8000px以下。</p></li>      <li>       <p>自定义组件宽高未指定为同层渲染标签的宽高</p>       <p>自定义的同层渲染组件宽高需要与同层标签的宽高保持一致，示例如下：</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-meta">@Component</span></li><li>  struct <span class="hljs-title class_">TextInputComponent</span> {</li><li>    <span class="hljs-meta">@Prop</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span></li><li>    <span class="hljs-meta">@State</span> <span class="hljs-attr">bkColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span></li><li>
</li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">TextInput</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'please input your word...'</span>})</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>      }</li><li>      <span class="hljs-comment">// 自定义组件中的最外层容器组件宽高应该为同层标签的宽高。</span></li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">width</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">params</span>.<span class="hljs-property">height</span>)</li><li>    }</li><li>  }</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="如何将同层渲染组件捕获到的事件透传到web前端">如何将同层渲染组件捕获到的事件透传到web前端？<i class="anchor-icon anchor-icon-link" anchorid="如何将同层渲染组件捕获到的事件透传到web前端" tips="复制节点链接"></i></h3>          <p>同层渲染手势事件通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-eventresult#setgestureeventresult14" target="_blank">setGestureEventResult()</a>设置手势事件消费结果，可以选择系统组件侧或ArkWeb侧消费手势事件。如果要实现系统组件侧和ArkWeb侧同时消费手势事件，可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-eventresult#setgestureeventresult14" target="_blank">setGestureEventResult()</a>中将stopPropagation设置为false，即系统组件侧消费的同时可以将手势事件向上冒泡给ArkWeb。</p>    </div>    <div class="tiledSection">     <h3 id="同层渲染页面显示该插件不支持该如何解决">同层渲染页面显示该插件不支持该如何解决？<i class="anchor-icon anchor-icon-link" anchorid="同层渲染页面显示该插件不支持该如何解决" tips="复制节点链接"></i></h3>          <ul>      <li>       <p>同层渲染开关<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#enablenativeembedmode11" target="_blank">enableNativeEmbedMode</a>未开启</p>       <p>使用同层渲染技术需要显式开启同层渲染开关</p>       <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"text.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>  <span class="hljs-comment">// 配置同层渲染开关开启。</span></li><li>  .<span class="hljs-title function_">enableNativeEmbedMode</span>(<span class="hljs-literal">true</span>)</li></ol></pre></div></div></li>      <li>       <p>同层标签使用有误</p>       <p>如果使用&lt;embed&gt;标签，需要显式书写embed，并且type类型以"native/"开头；如果使用&lt;object&gt;标签，需要注册&lt;object&gt;标签及type类型。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="涉及界面交互的arkui组件如textinput等光标与输入框错位该如何解决">涉及界面交互的ArkUI组件（如TextInput等）光标与输入框错位该如何解决？<i class="anchor-icon anchor-icon-link" anchorid="涉及界面交互的arkui组件如textinput等光标与输入框错位该如何解决" tips="复制节点链接"></i></h3>          <p>首先，需使用Stack包裹同层组件容器和BuilderNode。其次，同层组件容器NodeContainer应与同层标签的位置绑定。示例如下：</p>     <div _ngcontent-knt-c106="" class="highlight-div"><div _ngcontent-knt-c106="" class="highlight-div-header"><div _ngcontent-knt-c106="" class="highlight-div-header-left"><div _ngcontent-knt-c106="" class="handle-button expand-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knt-c106="" class="highlight-div-header-right"><div _ngcontent-knt-c106="" class="handle-button ai-button"></div><div _ngcontent-knt-c106="" class="handle-button line-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knt-c106="" class="handle-button theme-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knt-c106="" class="handle-button copy-button"><div _ngcontent-knt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">componentIdArr</span>, <span class="hljs-function">(<span class="hljs-params">componentId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeControllerMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>    <span class="hljs-comment">// 同层组件容器应与同层标签的宽高和位置绑定。</span></li><li>    .<span class="hljs-title function_">position</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">positionMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">widthMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heightMap</span>.<span class="hljs-title function_">get</span>(componentId))</li><li>}, <span class="hljs-function">(<span class="hljs-params">embedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> embedId)</li></ol></pre></div></div>    </div>   </div>   <div></div></div>