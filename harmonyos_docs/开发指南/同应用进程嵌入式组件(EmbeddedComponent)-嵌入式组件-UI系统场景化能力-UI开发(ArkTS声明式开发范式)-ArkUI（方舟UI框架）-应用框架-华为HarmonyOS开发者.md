<h1 _ngcontent-oew-c119="" class="doc-title ng-star-inserted" title="同应用进程嵌入式组件 (EmbeddedComponent)"> 同应用进程嵌入式组件 (EmbeddedComponent) </h1>

<div _ngcontent-oew-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>EmbeddedComponent组件允许当前页面嵌入同一应用内其他EmbeddedUIExtensionAbility供给的UI内容，这些UI运行在独立进程中，提供更高的安全性和稳定性。</p>    <p>EmbeddedComponent组件主要用于实现跨模块、跨进程的嵌入式界面集成，其核心目标是通过模块化设计提升应用的灵活性和用户体验。</p>    <p>开发者在使用时需注意其使用限制和生命周期管理，合理设计应用架构以最大限度地发挥其优势。</p>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component" target="_blank">EmbeddedComponent</a>组件</p>       <p>EmbeddedComponent组件用于在当前页面嵌入本应用内其他EmbeddedUIExtensionAbility提供的UI。它允许开发者将应用的某些功能或界面嵌入另一个界面中，实现更灵活的用户界面设计，适用于需要进程隔离的模块化开发场景。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-embeddeduiextensionability" target="_blank">EmbeddedUIExtensionAbility</a>组件</p>       <p>提供方应用中定义使用，用于实现跨进程界面嵌入功能，仅能被同应用的UIAbility拉起，并需在多进程权限的场景下使用。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用约束">使用约束<i class="anchor-icon anchor-icon-link" anchorid="使用约束" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>设备要求</p>       <p>EmbeddedComponent组件仅可在支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-embeddeduiextensionability" target="_blank">EmbeddedUIExtensionAbility</a>的设备上正常运行。</p></li>      <li>       <p>应用范围</p>       <p>EmbeddedComponent组件只能在UIAbility中使用，且被拉起的EmbeddedUIExtensionAbility需与UIAbility属于同一应用。</p></li>      <li>       <p>属性限制</p>       <p>EmbeddedComponent组件支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-component-general-attributes" target="_blank">通用属性</a>，且宽高默认值和最小值均为10vp；</p>       <p>不支持如下与宽高相关的属性：</p>       <p>"constraintSize"、"aspectRatio"、"layoutWeight"、"flexBasis"、"flexGrow"和"flexShrink"。</p></li>      <li>       <p>事件调用</p>       <p>与屏幕坐标相关的事件信息会基于EmbeddedComponent的位置宽高进行坐标转换后传递给被拉起的EmbeddedUIExtensionAbility处理。</p>       <p>EmbeddedComponent组件不支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-click" target="_blank">点击</a>等通用事件，仅支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component#onterminated" target="_blank">onTerminated</a>事件和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component#onerror" target="_blank">onError</a>事件。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="场景示例">场景示例<i class="anchor-icon anchor-icon-link" anchorid="场景示例" tips="复制节点链接"></i></h2>          <p>该示例简单展示了EmbeddedComponent组件和EmbeddedUIExtensionAbility的基础使用方式。</p>     <p><strong>加载项首页</strong></p>     <p>加载项首页是EmbeddedComponent组件的宿主页面，负责加载和展示嵌入式UI扩展能力的内容。以下是一个完整的加载项首页实现示例：</p>     <div _ngcontent-oew-c106="" class="highlight-div"><div _ngcontent-oew-c106="" class="highlight-div-header"><div _ngcontent-oew-c106="" class="highlight-div-header-left"><div _ngcontent-oew-c106="" class="handle-button expand-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oew-c106="" class="highlight-div-header-right"><div _ngcontent-oew-c106="" class="handle-button ai-button"></div><div _ngcontent-oew-c106="" class="handle-button line-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oew-c106="" class="handle-button theme-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oew-c106="" class="handle-button copy-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oew-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Message: '</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.embeddeddemo"</span>,</li><li>    <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ExampleEmbeddedAbility"</span>,</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">EmbeddedComponent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">want</span>, <span class="hljs-title class_">EmbeddedType</span>.<span class="hljs-property">EMBEDDED_UI_EXTENSION</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>          .<span class="hljs-title function_">onTerminated</span>(<span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 点击extension页面内的terminateSelfWithResult按钮后触发onTerminated回调，文本框显示如下信息</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Termination: code = '</span> + info.<span class="hljs-property">code</span> + <span class="hljs-string">', want = '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(info.<span class="hljs-property">want</span>);</li><li>          })</li><li>          .<span class="hljs-title function_">onError</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 失败或异常触发onError回调，文本框显示如下报错内容</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Error: code = '</span> + error.<span class="hljs-property">code</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在ArkTS项目中，EmbeddedUIExtensionAbility的实现代码通常位于项目的ets/extensionAbility目录下。例如，ExampleEmbeddedAbility.ets文件位于./ets/extensionAbility/目录中。</p>     <p>在实现加载项首页时，开发者需要注意以下几点：</p>     <ul>      <li>       <p>多进程模型检测</p>       <p>在应用启动时，建议检测设备是否已开启多进程模型。如果未开启，应提供明确的错误提示或引导用户开启。</p></li>      <li>       <p>异常处理</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component#onerror" target="_blank">onError</a>事件处理加载或运行嵌入式能力时可能出现的错误，提升用户体验。</p></li>      <li>       <p>生命周期管理</p>       <p>了解并管理好嵌入式组件的生命周期，确保资源的正确释放和回收。</p></li>      <li>       <p>样式配置</p>       <p>合理配置EmbeddedComponent组件的大小和位置，确保嵌入式界面能够以期望的尺寸和位置显示。</p></li>     </ul>     <p><strong>提供方应用生命周期实现</strong></p>     <p>提供方应用是指提供嵌入式UI扩展能力的应用。以下是提供方应用生命周期实现的代码示例：</p>     <div _ngcontent-oew-c106="" class="highlight-div"><div _ngcontent-oew-c106="" class="highlight-div-header"><div _ngcontent-oew-c106="" class="highlight-div-header-left"><div _ngcontent-oew-c106="" class="handle-button expand-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oew-c106="" class="highlight-div-header-right"><div _ngcontent-oew-c106="" class="handle-button ai-button"></div><div _ngcontent-oew-c106="" class="handle-button line-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oew-c106="" class="handle-button theme-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oew-c106="" class="handle-button copy-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oew-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">EmbeddedUIExtensionAbility</span>, <span class="hljs-title class_">UIExtensionContentSession</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[ExampleEmbeddedAbility]'</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleEmbeddedAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EmbeddedUIExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onCreate`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onForeground`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onBackground`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onDestroy`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionCreate</span>(<span class="hljs-params">want: Want, session: UIExtensionContentSession</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onSessionCreate, want: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(want)}</span>`</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">UIExtensionContentSession</span>&gt; = {</li><li>      <span class="hljs-string">'session'</span>: session</li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(param);</li><li>    <span class="hljs-comment">// 加载pages/extension.ets页面内容</span></li><li>    session.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/extension'</span>, storage);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionDestroy</span>(<span class="hljs-params">session: UIExtensionContentSession</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onSessionDestroy`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>关键实现说明：</p>     <ul>      <li>       <p>生命周期阶段</p>       <p>onCreate → onForeground：组件初始化到可见的完整流程；</p>       <p>onBackground → onForeground：前后台切换时的状态迁移；</p>       <p>onDestroy：组件被宿主主动销毁时的资源回收点。</p></li>      <li>       <p>会话管理</p>       <p>onSessionCreate：创建独立存储上下文并加载UI界面；</p>       <p>onSessionDestroy：处理会话结束时（如用户主动关闭）的清理操作。</p></li>      <li>       <p>上下文传递</p>       <p>通过LocalStorage实现UIExtensionContentSession的跨组件传递；</p>       <p>使用loadContent方法绑定ArkTS页面与扩展能力上下文。</p></li>     </ul>     <p><strong>入口页面</strong></p>     <p>以下提供方应用的入口组件实现，展示了如何使用UIExtensionContentSession会话以及如何通过按钮点击事件退出嵌入式页面并返回结果，该代码文件需要在main_pages.json配置文件中声明使用。</p>     <div _ngcontent-oew-c106="" class="highlight-div"><div _ngcontent-oew-c106="" class="highlight-div-header"><div _ngcontent-oew-c106="" class="highlight-div-header-left"><div _ngcontent-oew-c106="" class="handle-button expand-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oew-c106="" class="highlight-div-header-right"><div _ngcontent-oew-c106="" class="handle-button ai-button"></div><div _ngcontent-oew-c106="" class="handle-button line-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oew-c106="" class="handle-button theme-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oew-c106="" class="handle-button copy-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oew-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIExtensionContentSession</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Extension</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'EmbeddedUIExtensionAbility Index'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">localStorage</span>: <span class="hljs-title class_">LocalStorage</span>|<span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getSharedLocalStorage</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">session</span>: <span class="hljs-title class_">UIExtensionContentSession</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">localStorage</span>?.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">UIExtensionContentSession</span>&gt;(<span class="hljs-string">'session'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"terminateSelfWithResult"</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击按钮后调用terminateSelfWithResult退出</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">session</span>?.<span class="hljs-title function_">terminateSelfWithResult</span>({</li><li>          <span class="hljs-attr">resultCode</span>: <span class="hljs-number">1</span>,</li><li>          <span class="hljs-attr">want</span>: {</li><li>            <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.embeddeddemo"</span>,</li><li>            <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ExampleEmbeddedAbility"</span>,</li><li>          }</li><li>        });</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在实现入口页面时，开发者需要注意以下几点：</p>     <ol>      <li>       <p>会话管理</p>       <p>正确获取并使用UIExtensionContentSession会话对象，确保与宿主应用的通信正常。</p></li>      <li>       <p>结果返回</p>       <p>通过terminateSelfWithResult方法向宿主应用返回结果时，需要指定：</p>       <ul>        <li>         <p>resultCode：结果代码；</p></li>        <li>         <p>want：目标意图，指定结果的接收方。</p></li>       </ul></li>      <li>       <p>页面生命周期</p>       <p>了解并管理好入口页面的生命周期，确保资源的正确释放和回收。</p></li>      <li>       <p>样式配置</p>       <p>合理配置页面元素的样式，确保界面显示效果符合预期。</p></li>     </ol>     <p><strong>添加配置项</strong></p>     <p>为了使嵌入式UI扩展能力正常工作，需要在应用的配置文件中进行相应的设置。</p>     <p>在module.json5配置文件的"extensionAbilities"标签下增加ExampleEmbeddedAbility配置，以注册ExampleEmbeddedAbility嵌入式UI扩展能力。</p>     <div _ngcontent-oew-c106="" class="highlight-div"><div _ngcontent-oew-c106="" class="highlight-div-header"><div _ngcontent-oew-c106="" class="highlight-div-header-left"><div _ngcontent-oew-c106="" class="handle-button expand-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oew-c106="" class="highlight-div-header-right"><div _ngcontent-oew-c106="" class="handle-button ai-button"></div><div _ngcontent-oew-c106="" class="handle-button line-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oew-c106="" class="handle-button theme-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oew-c106="" class="handle-button copy-button"><div _ngcontent-oew-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oew-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ExampleEmbeddedAbility"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/extensionAbility/ExampleEmbeddedAbility.ets"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"embeddedUI"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <p><strong>预期效果</strong></p>     <ol>      <li>       <p>在支持EmbeddedUIExtensionAbility的设备上启动应用；</p>       <p><span><img originheight="192" originwidth="619" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114915.87510408721597754374741730513069:50001231000000:2800:99AB1DECE6BAD8C182F7AC530C872FE82A86819DB236FF00C265F85960FF5B1A.jpg" width="619" height="192"></span></p></li>      <li>       <p>点击terminateSelfWithResult按钮，提供方内容消失，页面显示onTerminated信息。</p></li>     </ol>    </div>   </div>   <div></div></div>