<h1 _ngcontent-wdx-c119="" class="doc-title ng-star-inserted" title="同步（备份恢复）关键资产(ArkTS)"> 同步（备份恢复）关键资产(ArkTS) </h1>

<div _ngcontent-wdx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="新增支持同步的关键资产">新增支持同步的关键资产<i class="anchor-icon anchor-icon-link" anchorid="新增支持同步的关键资产" tips="复制节点链接"></i></h2>          <p>新增密码demo_pwd（别名demo_alias），附属信息为demo_label，支持同步的关键资产。</p>     <div _ngcontent-wdx-c106="" class="highlight-div"><div _ngcontent-wdx-c106="" class="highlight-div-header"><div _ngcontent-wdx-c106="" class="highlight-div-header-left"><div _ngcontent-wdx-c106="" class="handle-button expand-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdx-c106="" class="highlight-div-header-right"><div _ngcontent-wdx-c106="" class="handle-button ai-button"></div><div _ngcontent-wdx-c106="" class="handle-button line-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdx-c106="" class="handle-button theme-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdx-c106="" class="handle-button copy-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { asset } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AssetStoreKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToArray</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Uint8Array</span> {</li><li>  <span class="hljs-keyword">let</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li>  <span class="hljs-keyword">return</span> textEncoder.<span class="hljs-title function_">encodeInto</span>(str);</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">attr</span>: asset.<span class="hljs-property">AssetMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>attr.<span class="hljs-title function_">set</span>(asset.<span class="hljs-property">Tag</span>.<span class="hljs-property">SECRET</span>, <span class="hljs-title function_">stringToArray</span>(<span class="hljs-string">'demo_pwd'</span>));</li><li>attr.<span class="hljs-title function_">set</span>(asset.<span class="hljs-property">Tag</span>.<span class="hljs-property">ALIAS</span>, <span class="hljs-title function_">stringToArray</span>(<span class="hljs-string">'demo_alias'</span>));</li><li>attr.<span class="hljs-title function_">set</span>(asset.<span class="hljs-property">Tag</span>.<span class="hljs-property">DATA_LABEL_NORMAL_1</span>, <span class="hljs-title function_">stringToArray</span>(<span class="hljs-string">'demo_label'</span>));</li><li>attr.<span class="hljs-title function_">set</span>(asset.<span class="hljs-property">Tag</span>.<span class="hljs-property">SYNC_TYPE</span>, asset.<span class="hljs-property">SyncType</span>.<span class="hljs-property">TRUSTED_DEVICE</span>); <span class="hljs-comment">// 需指定在可信设备间同步（如新旧设备间克隆）。</span></li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  asset.<span class="hljs-title function_">add</span>(attr).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in adding Asset with sync.`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to add Asset with sync. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to add Asset with sync. Code is <span class="hljs-subst">${err?.code}</span>, message is <span class="hljs-subst">${err?.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="接入备份恢复扩展能力">接入备份恢复扩展能力<i class="anchor-icon anchor-icon-link" anchorid="接入备份恢复扩展能力" tips="复制节点链接"></i></h2>          <p>为触发应用数据备份恢复，需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file-backup-extension">应用接入数据备份恢复</a>。</p>    </div>    <div class="tiledSection">     <h2 id="查询关键资产同步结果">查询关键资产同步结果<i class="anchor-icon anchor-icon-link" anchorid="查询关键资产同步结果" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="接口介绍" class="firsth2">接口介绍<i class="anchor-icon anchor-icon-link" anchorid="接口介绍" tips="复制节点链接"></i></h3>          <p>通过API文档查看查询关键资产同步结果接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-asset#assetquerysyncresult20" target="_blank">asset.querySyncResult</a>。</p>     <p>在查询关键资产同步结果时，关键资产属性的内容（AssetMap）参数如下表所示。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.5.1.1" valign="top" width="25%">属性名称（Tag）</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.5.1.2" valign="top" width="25%">属性内容（Value）</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.5.1.3" valign="top" width="25%">是否可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">REQUIRE_ATTR_ENCRYPTED<sup>14+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为boolean。</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">是否查询业务自定义附属信息被加密的关键资产同步结果。true表示查询业务自定义附属信息加密存储的关键资产同步结果，false表示查询业务自定义附属信息不加密存储的关键资产同步结果。默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">GROUP_ID<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为Uint8Array，长度为7-127字节。</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">待查询的关键资产所属群组，默认查询不属于任何群组的关键资产同步结果。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="代码示例">代码示例<i class="anchor-icon anchor-icon-link" anchorid="代码示例" tips="复制节点链接"></i></h3>          <div _ngcontent-wdx-c106="" class="highlight-div"><div _ngcontent-wdx-c106="" class="highlight-div-header"><div _ngcontent-wdx-c106="" class="highlight-div-header-left"><div _ngcontent-wdx-c106="" class="handle-button expand-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdx-c106="" class="highlight-div-header-right"><div _ngcontent-wdx-c106="" class="handle-button ai-button"></div><div _ngcontent-wdx-c106="" class="handle-button line-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdx-c106="" class="handle-button theme-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdx-c106="" class="handle-button copy-button"><div _ngcontent-wdx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { asset } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AssetStoreKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">query</span>: asset.<span class="hljs-property">AssetMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>asset.<span class="hljs-title function_">querySyncResult</span>(query).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: asset.SyncResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in querying sync result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(res)}</span>`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to query sync result of Asset. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="约束和限制">约束和限制<i class="anchor-icon anchor-icon-link" anchorid="约束和限制" tips="复制节点链接"></i></h2>          <p>在可信设备间同步过程中，新旧设备的关键资产均需处于可访问的状态，否则可能出现关键资产无法同步的情况。</p>     <ul>      <li>       <p>仅设置密码时可访问的关键资产，如果新旧设备中任意一台设备未设置锁屏密码，则无法同步成功。</p></li>      <li>       <p>仅屏幕处于解锁状态时可访问的关键资产，如果新旧设备中任意一台设备的屏幕未处于解锁状态，则无法同步成功。</p></li>      <li>       <p>仅用户认证通过后可访问的关键资产，如果旧设备未设置锁屏密码，则无法同步成功。</p></li>     </ul>    </div>   </div>   <div></div></div>