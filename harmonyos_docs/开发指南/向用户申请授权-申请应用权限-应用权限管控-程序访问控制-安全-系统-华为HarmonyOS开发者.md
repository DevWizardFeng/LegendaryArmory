<h1 _ngcontent-mbk-c119="" class="doc-title ng-star-inserted" title="向用户申请授权"> 向用户申请授权 </h1>

<div _ngcontent-mbk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>当应用需要访问用户的隐私信息或使用系统能力时，如获取位置信息、访问日历、使用相机拍摄照片或录制视频等，应向用户申请授权。这些权限属于user_grant权限。</p>    <p>当应用申请user_grant权限时，需完成以下步骤：</p>    <ol>     <li>      <p>在配置文件中，声明应用需要请求的权限。</p></li>     <li>      <p>将应用中需要申请权限的目标对象与对应权限关联，确保用户明确哪些操作需授予应用指定权限。</p>      <p>以上两步请参考章节<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>完成。</p></li>     <li>      <p>运行应用时，用户触发访问目标对象时应调用接口，精准触发动态授权弹框。接口内部会检查当前用户是否已授权所需权限，若未授权，将拉起动态授权弹框请求用户授权。</p></li>     <li>      <p>检查用户的授权结果，确认用户已授权后，再进行下一步操作。</p></li>    </ol>    <p>本章节将详细介绍如何完成步骤3和4。</p>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>user_grant权限授权要基于用户可知可控的原则，需要应用在运行时主动调用系统动态申请权限的接口，系统弹框由用户授权，用户结合应用运行场景的上下文，识别出应用申请相应敏感权限的合理性，从而做出正确的选择。</p></li>      <li>       <p>系统不鼓励频繁弹窗打扰用户。如果用户拒绝授权，将无法再次弹窗，应用需引导用户在系统设置中手动授予权限。或是调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization-second">requestPermissionOnSetting</a>，拉起权限设置弹窗，引导用户授权。</p></li>      <li>       <p>系统权限弹窗不可被遮挡。</p>       <p>系统权限弹窗不可被其他组件或控件遮挡，弹窗信息需完整展示，便于用户识别并完成授权。</p>       <p>如果系统权限弹窗与其他组件/控件同时在相同位置展示，系统权限弹窗将默认覆盖其他组件/控件。</p></li>      <li>       <p>每次执行需要目标权限的操作时，应用都必须检查自己是否已经具有该权限。</p>       <p>如需检查用户是否已向您的应用授予特定权限，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#checkaccesstoken9" target="_blank">checkAccessToken()</a>函数。此方法会返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#grantstatus" target="_blank">PERMISSION_GRANTED</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#grantstatus" target="_blank">PERMISSION_DENIED</a>。具体示例可参考下文。</p></li>      <li>       <p>每次访问受目标权限保护的接口之前，都需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>接口请求相应的权限。</p>       <p>用户可能在动态授予权限后通过系统设置来取消应用的权限，因此不能将之前授予的授权状态持久化。</p></li>      <li>       <p>应用在onWindowStageCreate()回调中申请授权时，需要等待异步接口loadContent()/setUIContent()执行结束后或在loadContent()/setUIContent()回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>，否则在Content加载完成前，requestPermissionsFromUser会调用失败。</p>       <p>应用在UIExtensionAbility申请授权时，需要在onWindowStageCreate函数执行结束后或在onWindowStageCreate函数回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>，否则在ability加载完成前，requestPermissionsFromUser会调用失败。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>以申请使用位置权限为例进行说明。</p>     <p>效果展示：</p>     <p><span><img originheight="497" originwidth="375" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115106.63925446360052591946371831092065:50001231000000:2800:5E8D823C92BE4B14EE0AF22959D7D84B9E5CC561ABAB7D6340D550284E3F97E6.png" width="375" height="497"></span></p>     <ol>      <li>       <p>申请ohos.permission.LOCATION、ohos.permission.APPROXIMATELY_LOCATION权限，配置方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>。</p></li>      <li>       <p>校验当前是否已经授权。</p>       <p>在进行权限申请之前，需要先检查当前应用程序是否已经被授予权限。可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#checkaccesstoken9" target="_blank">checkAccessToken()</a>方法来校验当前是否已经授权。如果已经授权，则可以直接访问目标操作，否则需要进行下一步操作，即向用户申请授权。</p>       <div _ngcontent-mbk-c106="" class="highlight-div"><div _ngcontent-mbk-c106="" class="highlight-div-header"><div _ngcontent-mbk-c106="" class="highlight-div-header-left"><div _ngcontent-mbk-c106="" class="handle-button expand-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbk-c106="" class="highlight-div-header-right"><div _ngcontent-mbk-c106="" class="handle-button ai-button"></div><div _ngcontent-mbk-c106="" class="handle-button line-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbk-c106="" class="handle-button theme-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbk-c106="" class="handle-button copy-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, bundleManager, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPermissionGrant</span>(<span class="hljs-params">permission: Permissions</span>): <span class="hljs-title class_">Promise</span>&lt;abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: abilityAccessCtrl.<span class="hljs-property">GrantStatus</span> = abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_DENIED</span>;</li><li>
</li><li>  <span class="hljs-comment">// 获取应用程序的accessTokenID。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">tokenId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">bundleInfo</span>: bundleManager.<span class="hljs-property">BundleInfo</span> = <span class="hljs-keyword">await</span> bundleManager.<span class="hljs-title function_">getBundleInfoForSelf</span>(bundleManager.<span class="hljs-property">BundleFlag</span>.<span class="hljs-property">GET_BUNDLE_INFO_WITH_APPLICATION</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">appInfo</span>: bundleManager.<span class="hljs-property">ApplicationInfo</span> = bundleInfo.<span class="hljs-property">appInfo</span>;</li><li>    tokenId = appInfo.<span class="hljs-property">accessTokenId</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get bundle info for self, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 校验应用是否被授予权限。</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    grantStatus = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">checkAccessToken</span>(tokenId, permission);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to check access token, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">return</span> grantStatus;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPermissions</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus1</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkPermissionGrant</span>(<span class="hljs-string">'ohos.permission.LOCATION'</span>) === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;<span class="hljs-comment">// 获取精确定位权限状态。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus2</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkPermissionGrant</span>(<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>) === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;<span class="hljs-comment">// 获取模糊定位权限状态。</span></li><li>  <span class="hljs-comment">// 精确定位权限只能跟模糊定位权限一起申请，或者已经有模糊定位权限才能申请精确定位权限。</span></li><li>  <span class="hljs-keyword">if</span> (grantStatus2 &amp;&amp; !grantStatus1) {</li><li>     <span class="hljs-comment">// 申请精确定位权限。</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!grantStatus1 &amp;&amp; !grantStatus2) {</li><li>     <span class="hljs-comment">// 申请模糊定位权限与精确定位权限或单独申请模糊定位权限。</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>     <span class="hljs-comment">// 已经授权，可以继续访问目标操作。</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>动态向用户申请授权。</p>       <p>动态向用户申请权限是指在应用程序运行时向用户请求授权的过程。可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>方法来实现。该方法接收一个权限列表参数，例如位置、日历、相机、麦克风等。用户可以选择授予权限或者拒绝授权。</p>       <p>可以在UIAbility的onWindowStageCreate()回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>方法动态请求授权，或根据业务需要在UI中请求授权。</p>       <p>应用在onWindowStageCreate()回调中申请授权时，需要等待异步接口loadContent()/setUIContent()执行结束后或在loadContent()/setUIContent()回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>，否则在Content加载完成前，requestPermissionsFromUser会调用失败。</p>       <p>应用在UIExtensionAbility申请授权时，需要在onWindowStageCreate函数执行结束后或在onWindowStageCreate函数回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>，否则在ability加载完成前，requestPermissionsFromUser会调用失败。</p>       <ul>        <li>         <p>在UIAbility中向用户申请授权。</p>         <div _ngcontent-mbk-c106="" class="highlight-div"><div _ngcontent-mbk-c106="" class="highlight-div-header"><div _ngcontent-mbk-c106="" class="highlight-div-header-left"><div _ngcontent-mbk-c106="" class="handle-button expand-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbk-c106="" class="highlight-div-header-right"><div _ngcontent-mbk-c106="" class="handle-button ai-button"></div><div _ngcontent-mbk-c106="" class="handle-button line-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbk-c106="" class="handle-button theme-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbk-c106="" class="handle-button copy-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 使用UIExtensionAbility：将import { UIAbility } from '@kit.AbilityKit' 替换为import { UIExtensionAbility } from '@kit.AbilityKit';</span></li><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, common, <span class="hljs-title class_">Permissions</span>, <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">'ohos.permission.LOCATION'</span>,<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>];</li><li><span class="hljs-comment">// 使用UIExtensionAbility：将common.UIAbilityContext 替换为common.UIExtensionContext。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">reqPermissionsFromUser</span>(<span class="hljs-params">permissions: <span class="hljs-built_in">Array</span>&lt;Permissions&gt;, context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-comment">// requestPermissionsFromUser会判断权限的授权状态来决定是否唤起弹窗。</span></li><li>  atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, permissions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = data.<span class="hljs-property">authResults</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> = grantStatus.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {</li><li>      <span class="hljs-keyword">if</span> (grantStatus[i] === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 用户授权，可以继续访问目标操作。</span></li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 用户拒绝授权，提示用户必须授权才能访问当前页面的功能，并引导用户到系统设置中打开相应的权限。</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 授权成功。</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  })</li><li>}</li><li><span class="hljs-comment">// 使用UIExtensionAbility：将 UIAbility 替换为UIExtensionAbility</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-title function_">reqPermissionsFromUser</span>(permissions, <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div></li>        <li>         <p>在UI中向用户申请授权。</p>         <div _ngcontent-mbk-c106="" class="highlight-div"><div _ngcontent-mbk-c106="" class="highlight-div-header"><div _ngcontent-mbk-c106="" class="highlight-div-header-left"><div _ngcontent-mbk-c106="" class="handle-button expand-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbk-c106="" class="highlight-div-header-right"><div _ngcontent-mbk-c106="" class="handle-button ai-button"></div><div _ngcontent-mbk-c106="" class="handle-button line-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbk-c106="" class="handle-button theme-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbk-c106="" class="handle-button copy-button"><div _ngcontent-mbk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, common, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">permissions</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">'ohos.permission.LOCATION'</span>,<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>];</li><li><span class="hljs-comment">// 使用UIExtensionAbility：将common.UIAbilityContext 替换为common.UIExtensionContext</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">reqPermissionsFromUser</span>(<span class="hljs-params">permissions: <span class="hljs-built_in">Array</span>&lt;Permissions&gt;, context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-comment">// requestPermissionsFromUser会判断权限的授权状态来决定是否唤起弹窗。</span></li><li>  atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, permissions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = data.<span class="hljs-property">authResults</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> = grantStatus.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {</li><li>      <span class="hljs-keyword">if</span> (grantStatus[i] === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 用户授权，可以继续访问目标操作。</span></li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 当用户拒绝授权时，系统应提示用户必须授予相应权限才能使用当前页面的功能，并指导用户前往系统设置开启所需权限。</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 授权成功</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 使用UIExtensionAbility：将common.UIAbilityContext 替换为common.UIExtensionContext</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-title function_">reqPermissionsFromUser</span>(permissions, context);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>处理授权结果。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissionsfromuser9" target="_blank">requestPermissionsFromUser()</a>方法后，应用程序将等待用户授权的结果。</p>       <p>如果用户授权，则可以继续访问目标操作。</p>       <p>如果用户拒绝授权，则需要提示用户必须授权才能访问当前页面的功能，并引导用户到系统应用“设置”中打开相应的权限；或是调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestpermissiononsetting12" target="_blank">requestPermissionOnSetting()</a>，拉起权限设置弹框，引导用户授权。</p>       <p>路径：设置 &gt; 隐私与安全 &gt; 权限类型（如位置信息） &gt; 具体应用</p></li>     </ol>    </div>   </div>   <div></div></div>