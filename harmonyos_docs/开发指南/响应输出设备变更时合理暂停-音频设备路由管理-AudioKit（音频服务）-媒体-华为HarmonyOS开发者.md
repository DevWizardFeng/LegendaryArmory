<h1 _ngcontent-hrf-c119="" class="doc-title ng-star-inserted" title="响应输出设备变更时合理暂停"> 响应输出设备变更时合理暂停 </h1>

<div _ngcontent-hrf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>开发者可以了解音频流输出设备变更信息，并完成相应适配，比如：应用在播放音乐时发现输出设备下线，为避免打扰用户，应该立即暂停音乐。</p>    <p>开发者可使用AudioRenderer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#onoutputdevicechangewithinfo11" target="_blank">outputDeviceChangeWithInfo</a>，用于监听音频流输出设备变化及原因。当系统出现音频输出设备的上下线、用户强选、设备抢占或设备选择策略变更等情况，导致音频流输出设备变更时，系统将通过该接口通知应用当前音频流设备变更信息，包含当前音频流输出设备信息和设备变更原因。</p>    <div class="tiledSection">     <h2 id="音频流输出设备信息">音频流输出设备信息<i class="anchor-icon anchor-icon-link" anchorid="音频流输出设备信息" tips="复制节点链接"></i></h2>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#onoutputdevicechangewithinfo11" target="_blank">outputDeviceChangeWithInfo</a>返回的音频流设备变更信息中，包含当前音频流输出设备信息，以数组形式发送，一般该列表仅包含一个设备信息，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-t#audiodevicedescriptors" target="_blank">AudioDeviceDescriptors</a>（设备信息列表）。</p>    </div>    <div class="tiledSection">     <h2 id="音频流输出设备变更原因">音频流输出设备变更原因<i class="anchor-icon anchor-icon-link" anchorid="音频流输出设备变更原因" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当发生下述四种情况（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#audiostreamdevicechangereason11" target="_blank">AudioStreamDeviceChangeReason</a>）时，系统将向应用发送设备变更回调。</p>      </div></div></div>     <ul>      <li>       <p><strong>REASON_NEW_DEVICE_AVAILABLE</strong>：新设备可用。</p>       <p><strong>触发场景：</strong></p>       <p>普通蓝牙设备（耳机、眼镜、音箱、车机等）连接、支持佩戴检测的蓝牙设备（耳机、眼镜等）佩戴、有线设备（3.5mm耳机、Type-C耳机、USB耳机、USB音箱等）插入、分布式设备上线等。</p></li>      <li>       <p><strong>REASON_OLD_DEVICE_UNAVAILABLE</strong>：旧设备不可用。</p>       <p>当报告此原因时，应用程序应考虑暂停音频播放。</p>       <p><strong>触发场景：</strong></p>       <p>普通蓝牙设备（耳机、眼镜、音箱、车机等）断开、支持佩戴检测的蓝牙耳机双耳摘下、支持佩戴检测的蓝牙眼镜摘下、有线设备（3.5mm耳机、Type-C耳机、USB耳机、USB音箱等）拔出、分布式设备下线等。</p>       <p>针对此场景，常用业务场景的<strong>处理建议</strong>如下：</p>       <ul>        <li>游戏场景：不暂停</li>        <li>听书场景：暂停</li>        <li>音乐场景：暂停</li>        <li>视频场景：暂停</li>       </ul></li>      <li>       <p><strong>REASON_OVERRODE</strong>：用户强制选择设备。</p>       <p><strong>触发场景：</strong></p>       <p>用户从界面选择切换音频流输出设备、从外设选择接听蜂窝或VoIP来电。</p></li>      <li>       <p><strong>REASON_UNKNOWN</strong>：未知原因。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="参考示例">参考示例<i class="anchor-icon anchor-icon-link" anchorid="参考示例" tips="复制节点链接"></i></h2>          <div _ngcontent-hrf-c106="" class="highlight-div"><div _ngcontent-hrf-c106="" class="highlight-div-header"><div _ngcontent-hrf-c106="" class="highlight-div-header-left"><div _ngcontent-hrf-c106="" class="handle-button expand-button"><div _ngcontent-hrf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrf-c106="" class="highlight-div-header-right"><div _ngcontent-hrf-c106="" class="handle-button ai-button"></div><div _ngcontent-hrf-c106="" class="handle-button line-button"><div _ngcontent-hrf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrf-c106="" class="handle-button theme-button"><div _ngcontent-hrf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrf-c106="" class="handle-button copy-button"><div _ngcontent-hrf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRenderer</span>: audio.<span class="hljs-property">AudioRenderer</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioStreamInfo</span>: audio.<span class="hljs-property">AudioStreamInfo</span> = {</li><li>  <span class="hljs-attr">samplingRate</span>: audio.<span class="hljs-property">AudioSamplingRate</span>.<span class="hljs-property">SAMPLE_RATE_48000</span>, <span class="hljs-comment">// 采样率。</span></li><li>  <span class="hljs-attr">channels</span>: audio.<span class="hljs-property">AudioChannel</span>.<span class="hljs-property">CHANNEL_2</span>, <span class="hljs-comment">// 通道。</span></li><li>  <span class="hljs-attr">sampleFormat</span>: audio.<span class="hljs-property">AudioSampleFormat</span>.<span class="hljs-property">SAMPLE_FORMAT_S16LE</span>, <span class="hljs-comment">// 采样格式。</span></li><li>  <span class="hljs-attr">encodingType</span>: audio.<span class="hljs-property">AudioEncodingType</span>.<span class="hljs-property">ENCODING_TYPE_RAW</span> <span class="hljs-comment">// 编码格式。</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>  <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>  <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererOptions</span>: audio.<span class="hljs-property">AudioRendererOptions</span> = {</li><li>  <span class="hljs-attr">streamInfo</span>: audioStreamInfo,</li><li>  <span class="hljs-attr">rendererInfo</span>: audioRendererInfo</li><li>};</li><li>
</li><li><span class="hljs-comment">// 创建AudioRenderer实例。</span></li><li>audio.<span class="hljs-title function_">createAudioRenderer</span>(audioRendererOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>  audioRenderer = data;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AudioFrameworkRenderLog: AudioRenderer Created : Success : Stream Type: SUCCESS'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`AudioFrameworkRenderLog: AudioRenderer Created : ERROR : <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-keyword">if</span> (audioRenderer) {</li><li>  <span class="hljs-comment">// 订阅监听音频流输出设备变化及原因。</span></li><li>  (audioRenderer <span class="hljs-keyword">as</span> audio.<span class="hljs-property">AudioRenderer</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">'outputDeviceChangeWithInfo'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">deviceChangeInfo</span>: audio.<span class="hljs-property">AudioStreamDeviceChangeInfo</span>) =&gt; {</li><li>    <span class="hljs-keyword">switch</span> (deviceChangeInfo.<span class="hljs-property">changeReason</span>) {</li><li>      <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_OLD_DEVICE_UNAVAILABLE</span>:</li><li>        <span class="hljs-comment">// 响应设备不可用事件，如果应用处于播放状态，应暂停播放，更新UX界面。</span></li><li>        <span class="hljs-comment">// await audioRenderer.pause();</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_NEW_DEVICE_AVAILABLE</span>:</li><li>        <span class="hljs-comment">// 应用根据业务情况响应设备可用事件。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_OVERRODE</span>:</li><li>        <span class="hljs-comment">// 应用根据业务情况响应设备强选事件。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_UNKNOWN</span>:</li><li>        <span class="hljs-comment">// 应用根据业务情况响应未知原因事件。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>