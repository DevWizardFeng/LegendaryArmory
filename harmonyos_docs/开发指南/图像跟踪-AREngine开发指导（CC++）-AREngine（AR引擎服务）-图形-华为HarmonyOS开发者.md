<h1 _ngcontent-rqm-c119="" class="doc-title ng-star-inserted" title="图像跟踪"> 图像跟踪 </h1>

<div _ngcontent-rqm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section19803101214197">概要<i class="anchor-icon anchor-icon-link" anchorid="section19803101214197" tips="复制节点链接"></i></h2>          <p>从5.1.0(18)开始，AR Engine支持图像跟踪的能力。</p>     <p>本章节介绍如何识别和跟踪2D图像的位姿信息，通过学习本章节，可以检测场景中是否存在输入的图像，识别之后输出图像的位姿。</p>     <div class="fignone">      <span class="figcap"><b>图1 </b>图像跟踪<strong>示</strong>意图</span>     </div>     <p><span><img originheight="657" originwidth="318" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114357.43142664927512409232021776848422:50001231000000:2800:858009E7DBBF4FD4BEB48890BFF0A4FE87E35BB4AAEAF75DFC72A77E101E43F0.png" width="318" height="657"></span></p>    </div>    <p>本章节涉及的AR Engine能力如下：</p>    <ul>     <li>运动跟踪能力</li>     <li>环境跟踪能力（平面检测）</li>    </ul>    <div class="tiledSection">     <h2 id="section4701164061710">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section4701164061710" tips="复制节点链接"></i></h2>          <p>以下接口为AR图像跟踪相关接口。详细接口和说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine" target="_blank">AR Engine API参考</a>。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.5.1.3.1.1" valign="top" width="49.94%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.1.3.1.2" valign="top" width="50.06%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga47713cb18234569e03b5216b6c8442d3" target="_blank">HMS_AREngine_ARSession_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>创建一个新的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga2dbf3585f50628750ec855501c043650" target="_blank">AREngine_ARSession</a>会话。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga1d1cacf372a8011a439f0e4e76994259" target="_blank">HMS_AREngine_ARSession_Update</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>更新AR Engine的计算结果。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga6394ae995148abbe3d00082817bf320a" target="_blank">HMS_AREngine_ARSession_Configure</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga2dbf3585f50628750ec855501c043650" target="_blank">AREngine_ARSession</a>会话。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gadfcb9589137a39c5afcb217e18853a9d" target="_blank">HMS_AREngine_ARFrame_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>创建一个新的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gaf35f728a1179ef54a3eba9f1cf021719" target="_blank">AREngine_ARFrame</a>对象，将指针存储到中*outFrame。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga3f23bf747def8303c3fb261a9e9a2286" target="_blank">HMS_AREngine_ARSession_SetDisplayGeometry</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>设置显示的高和宽（以像素为单位）。该高度和宽度是显示视图的高度和宽度，如果不一致，会导致显示相机预览出错。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac697e4be36db63ed6098f154aa9ac01c" target="_blank">HMS_AREngine_ARSession_SetCameraGLTexture</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>设置可用于存储相机预览流数据的openGL纹理。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取所有指定类型的可跟踪对象集合。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gab1782eeeeddc01b77a140af915cb351c" target="_blank">HMS_AREngine_ARTrackableList_AcquireItem</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>从可跟踪列表中获取指定index的对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gabbb03027afb984be8542d00d2eebd063" target="_blank">HMS_AREngine_ARPlane_GetCenterPose</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取从平面的局部坐标系到世界坐标系转换的位姿信息。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga5295c975a0ff3d633a1dde5a8eb70863" target="_blank">HMS_AREngine_ARFrame_AcquireCamera</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前帧的相机参数对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gafb471f39563ca1a4947d4f87c77e24e2" target="_blank">HMS_AREngine_ARPose_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>分配并初始化一个新的位姿对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga00df108c4ba187967a10e9c4d2e27d3a" target="_blank">HMS_AREngine_ARCamera_GetPose</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前相机对象在AR世界空间中的位姿。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section4108822184411" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>创建一个空的跟踪图像数据。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section0315115618403" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_AddImage</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>将图像添加到图像数据库并输出对应图像的索引。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取所有指定类型的可跟踪对象集合。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gad9729d4436f3d969286f31b33d07513e" target="_blank">HMS_AREngine_ARTrackableList_GetSize</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取此列表中的可跟踪对象的数量。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section498975343520" target="_blank">HMS_AREngine_ARAugmentedImage_GetCenterPose</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取跟踪图像中心点在世界坐标系中的位姿信息。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section917593011382" target="_blank">HMS_AREngine_ARAugmentedImage_GetExtendX</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取图像的中心点为坐标原点，物理图像的宽度（单位为米），得到X轴上的估计值。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section9630192711390" target="_blank">HMS_AREngine_ARAugmentedImage_GetExtendZ</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取图像的中心点为坐标原点，物理图像的宽度（单位为米），得到Z轴上的估计值。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section6536162875117" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_Serialize</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>序列化特征数据库，在添加完图片后，可以将特征库序列化为buffer，用户可以保存此buffer以供下次使用。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section1619582764511" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_Deserialize</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>反序列化特征数据库，用户可以将上次生成的或者保存的buffer数据反序列化为特征数据库后直接使用。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section171161453144613">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section171161453144613" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002329946678__zh-cn_topic_0000002363865165_p193824275361">本章节给出了关键开发步骤，完整代码可以参考<a href="https://gitcode.com/harmonyos_samples/arengine_-sample-code_-clientdemo_cpp" target="_blank">示例代码</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section1149014511314" class="firsth2">声明Native接口<i class="anchor-icon anchor-icon-link" anchorid="section1149014511314" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002329946678__zh-cn_topic_0000002363865165_p16573195181311">开发者可参考AR物体摆放章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arworld#section1557014318265">声明Native接口</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section65312574410">创建UI界面<i class="anchor-icon anchor-icon-link" anchorid="section65312574410" tips="复制节点链接"></i></h3>          <p>首先创建一个起始UI页面“ARImage.ets”，设置两个按钮，用于实现“添加本地图片”和“读取本地数据库”两个功能，分别命名“ARImageByAdd.ets”和“ARImageByDatabase.ets”。配置路由进行页面间跳转，页面路由配置详细可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation" target="_blank">组件导航(Navigation) (推荐)</a>。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此代码可参考示例代码：ARSample/entry/src/main/ets/pages/ARImage.ets。</span></li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ARImageBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">ARImage</span>();</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ARImage</span> {</li><li>  <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">imagePathArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'选择本地图片'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>, <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span> })</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>
</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOption</span>: photoAccessHelper.<span class="hljs-property">PhotoSelectOptions</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>              photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>              photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">50</span>;</li><li>              photoOption.<span class="hljs-property">isEditSupported</span> = <span class="hljs-literal">false</span>;</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>
</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">photoResult</span>: photoAccessHelper.<span class="hljs-property">PhotoSelectResult</span> = <span class="hljs-keyword">await</span> photoPicker.<span class="hljs-title function_">select</span>(photoOption);</li><li>              <span class="hljs-keyword">if</span> (photoResult.<span class="hljs-property">photoUris</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; photoResult.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>].<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">imagePathArray</span> = photoResult.<span class="hljs-property">photoUris</span>;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushDestinationByName</span>(<span class="hljs-string">'ARImageByAdd'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">imagePathArray</span>);</li><li>              }</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to select by photoPicker. Code: <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>            }</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'加载本地数据库'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>, <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span> })</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushDestinationByName</span>(<span class="hljs-string">'ARImageByDatabase'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>创建一个ARImageByAdd.ets，用于选择图片，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件加载相机预览画面，并定时触发每一帧绘制。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此代码可参考示例代码：ARSample/entry/src/main/ets/pages/ARImageByAdd.ets。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">taskpool</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span>, <span class="hljs-variable">deviceInfo</span>, <span class="hljs-variable">emitter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">fileIo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">resourceManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">arEngineDemo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">ARImageByAddBuilder</span>() {</li><li>  <span class="hljs-title function_">ARImageByAdd</span>();</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ARImageByAdd</span> {</li><li>  <span class="hljs-variable">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">imageAddFailedNumbers</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">imageAddNumbers</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">imagePathList</span>: <span class="hljs-title class_">string</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">isSurfaceDestroy</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">interval</span>: <span class="hljs-title class_">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">isUpdate</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">xComponentId</span> = <span class="hljs-string">'ARImage'</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">addImageLog</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">''</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">resMgr</span>: <span class="hljs-title class_">resourceManager</span>.<span class="hljs-title class_">ResourceManager</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">resourceManager</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageTotalNumbers</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-keyword">private</span> <span class="hljs-variable">isImageAddComplete</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">deviceInfo</span>.<span class="hljs-variable">deviceType</span> === <span class="hljs-string">'tablet'</span> ? <span class="hljs-number">3</span> : <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">showPage</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">true</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">NavDestination</span>() {</li><li>      <span class="hljs-title function_">RelativeContainer</span>() {</li><li>        <span class="hljs-title function_">XComponent</span>({ <span class="hljs-variable">id</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentId</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>, <span class="hljs-variable">libraryname</span>: <span class="hljs-string">'entry'</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">visibility</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">showPage</span> ? <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-title class_">None</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onLoad</span>(() =&gt; {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">XComponent</span> <span class="hljs-variable">onLoad</span> ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>}.`);</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span> = <span class="hljs-title function_">setInterval</span>(() =&gt; {</li><li>              <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> || !<span class="hljs-keyword">this</span>.<span class="hljs-variable">isImageAddComplete</span> || <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span> === <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-keyword">return</span>;</li><li>              }</li><li>              <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>            }, <span class="hljs-number">33</span>) <span class="hljs-comment">// 将帧率设置为30fps（每33ms 刷新一次帧）。</span></li><li>          })</li><li>          .<span class="hljs-title function_">onDestroy</span>(() =&gt; {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">XComponent</span> <span class="hljs-variable">onDestroy</span> ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>}.`);</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">isSurfaceDestroy</span> = <span class="hljs-keyword">true</span>;</li><li>            <span class="hljs-title function_">clearInterval</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span>);</li><li>          })</li><li>
</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-string">'添加图片进度：'</span> +</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTotalNumbers</span>.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">'/'</span> + <span class="hljs-keyword">this</span>.<span class="hljs-variable">imagePathList</span>.<span class="hljs-variable">length</span>.<span class="hljs-title function_">toString</span>() + <span class="hljs-string">'\n '</span> +</li><li>        <span class="hljs-string">'添加成功数量：'</span> +</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span> + <span class="hljs-string">' \n'</span> +</li><li>        <span class="hljs-string">'添加失败数量：'</span> +</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddFailedNumbers</span> + <span class="hljs-string">'\n'</span> + <span class="hljs-keyword">this</span>.<span class="hljs-variable">addImageLog</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-variable">TextAlign</span>.<span class="hljs-variable">Center</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span>)</li><li>          .<span class="hljs-title function_">visibility</span>(!<span class="hljs-keyword">this</span>.<span class="hljs-variable">isImageAddComplete</span> ? <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-title class_">None</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onBackPressed</span>(() =&gt; {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to onBackPressed.'</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">resMgr</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">config</span>: <span class="hljs-title class_">Int32Array</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Int32Array</span>([<span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">rotation</span>]);</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">start</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-variable">config</span>);</li><li>
</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">Image</span> <span class="hljs-variable">path</span> <span class="hljs-variable">length</span>: ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">imagePathList</span>.<span class="hljs-variable">length</span>}.`);</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">RegisterAddImageCallback</span>();</li><li>        <span class="hljs-variable">taskpool</span>.<span class="hljs-title function_">execute</span>(<span class="hljs-variable">addImage</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">imagePathList</span>, <span class="hljs-variable">errcode</span>).<span class="hljs-title function_">then</span>(() =&gt; {</li><li>          <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Add image task complete.'</span>);</li><li>          <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'checkAddImageResult'</span>);</li><li>        })</li><li>      } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">promise</span> <span class="hljs-variable">options</span> <span class="hljs-variable">error</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}.`);</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">onWillDisappear</span>(() =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">saveImageDataBaseToLocal</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">filesDir</span>);</li><li>      }</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">stop</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onShown</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">true</span>;</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">show</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onHidden</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">false</span>;</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">isSurfaceDestroy</span>) {</li><li>        <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">hide</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>((<span class="hljs-variable">context</span>: <span class="hljs-title class_">NavDestinationContext</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathStack</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">imagePathList</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathInfo</span>.<span class="hljs-variable">param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">string</span>[];</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-keyword">false</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-keyword">true</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">ShowDialog</span>(<span class="hljs-variable">msg</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">showAlertDialog</span>({</li><li>      <span class="hljs-variable">title</span>: <span class="hljs-string">'警告'</span>,</li><li>      <span class="hljs-variable">message</span>: <span class="hljs-title class_">msg</span>,</li><li>      <span class="hljs-variable">autoCancel</span>: <span class="hljs-keyword">true</span>,</li><li>      <span class="hljs-variable">alignment</span>: <span class="hljs-title class_">DialogAlignment</span>.<span class="hljs-title class_">Center</span>,</li><li>      <span class="hljs-variable">offset</span>: { <span class="hljs-variable">dx</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">dy</span>: -<span class="hljs-number">20</span> },</li><li>      <span class="hljs-variable">gridCount</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-variable">transition</span>: <span class="hljs-title class_">TransitionEffect</span></li><li>        .<span class="hljs-title function_">asymmetric</span>(<span class="hljs-variable">TransitionEffect</span>.<span class="hljs-variable">OPACITY</span></li><li>          .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Sharp</span> })</li><li>          .<span class="hljs-title function_">combine</span>(<span class="hljs-variable">TransitionEffect</span></li><li>            .<span class="hljs-title function_">scale</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">1.5</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">1.5</span> })</li><li>            .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Sharp</span> })</li><li>          ),</li><li>          <span class="hljs-variable">TransitionEffect</span>.<span class="hljs-variable">OPACITY</span></li><li>            .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Smooth</span> })</li><li>            .<span class="hljs-title function_">combine</span>(<span class="hljs-variable">TransitionEffect</span>.<span class="hljs-title function_">scale</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">0.5</span> })</li><li>              .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Smooth</span> })</li><li>            )</li><li>        ),</li><li>      <span class="hljs-variable">buttons</span>: [{</li><li>        <span class="hljs-variable">enabled</span>: <span class="hljs-keyword">true</span>,</li><li>        <span class="hljs-variable">defaultFocus</span>: <span class="hljs-keyword">true</span>,</li><li>        <span class="hljs-variable">style</span>: <span class="hljs-title class_">DialogButtonStyle</span>.<span class="hljs-title class_">HIGHLIGHT</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-string">'退出'</span>,</li><li>        <span class="hljs-variable">action</span>: () =&gt; {</li><li>          <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Callback when the second button is clicked'</span>)</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>        }</li><li>      }]</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">RegisterAddImageCallback</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'addImage'</span>, (<span class="hljs-variable">data</span>: <span class="hljs-title class_">emitter</span>.<span class="hljs-title class_">EventData</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">data</span>.<span class="hljs-variable">data</span>?.<span class="hljs-variable">addImageReason</span> === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span>++;</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">adding</span> <span class="hljs-variable">image</span>, <span class="hljs-variable">image</span> <span class="hljs-variable">numbers</span>: ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span>}.`);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddFailedNumbers</span>++;</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">addImageLog</span> += <span class="hljs-string">'失败图片名：'</span> +</li><li>          <span class="hljs-variable">data</span>.<span class="hljs-variable">data</span>?.<span class="hljs-variable">imageName</span> + <span class="hljs-string">'\n'</span> +</li><li>          <span class="hljs-string">'失败原因：'</span> +</li><li>          <span class="hljs-variable">errcode</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">data</span>?.<span class="hljs-variable">addImageReason</span>) + <span class="hljs-string">'\n'</span>;</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">add</span> <span class="hljs-variable">image</span>, <span class="hljs-variable">image</span> <span class="hljs-variable">numbers</span>: ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddFailedNumbers</span>}.`);</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTotalNumbers</span>++;</li><li>    })</li><li>
</li><li>    <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'checkAddImageResult'</span>, () =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageAddNumbers</span> === <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">showPage</span> = <span class="hljs-keyword">false</span>;</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">ShowDialog</span>(<span class="hljs-string">'请添加有效图片'</span>);</li><li>      }</li><li>      <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'addImage'</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isImageAddComplete</span> = <span class="hljs-keyword">true</span>;</li><li>      <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'checkAddImageResult'</span>);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">errcode</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">number</span>, <span class="hljs-title class_">string</span>&gt; = <span class="hljs-variable">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">number</span>, <span class="hljs-title class_">string</span>&gt;([[<span class="hljs-number">0</span>, <span class="hljs-string">'success'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'size not match'</span>],</li><li>  [<span class="hljs-number">2</span>, <span class="hljs-string">'too bright or too dark'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'image color is relatively single'</span>], [<span class="hljs-number">4</span>, <span class="hljs-string">'other error'</span>]]);</li><li>
</li><li><span class="hljs-comment">// 异步执行添加图片任务。</span></li><li>@<span class="hljs-title function_">Concurrent</span></li><li><span class="hljs-variable">async</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">addImage</span>(<span class="hljs-variable">componentId</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">imagePathList</span>: <span class="hljs-title class_">string</span>[],</li><li>  <span class="hljs-variable">errcode</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">number</span>, <span class="hljs-title class_">string</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">index</span> &lt; <span class="hljs-title class_">imagePathList</span>.<span class="hljs-title class_">length</span>; <span class="hljs-title class_">index</span>++) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imagePath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">imagePathList</span>[<span class="hljs-variable">index</span>];</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">file</span>: <span class="hljs-title class_">fileIo</span>.<span class="hljs-title class_">File</span> = <span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">openSync</span>(<span class="hljs-variable">imagePath</span>, <span class="hljs-variable">fileIo</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">READ_ONLY</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">imageName</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">file</span>.<span class="hljs-variable">name</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageSourceApi</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">file</span>.<span class="hljs-variable">fd</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable">fileIo</span>.<span class="hljs-title function_">closeSync</span>(<span class="hljs-variable">file</span>);</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">closeSync</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}.`);</li><li>      <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">release</span>();</li><li>      <span class="hljs-keyword">continue</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageInfo</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageInfo</span> = <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">getImageInfoSync</span>();</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">imageInfo</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">obtain</span> <span class="hljs-variable">the</span> <span class="hljs-variable">image</span> <span class="hljs-variable">pixel</span> <span class="hljs-variable">map</span> <span class="hljs-variable">information</span>.`);</li><li>      <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">release</span>();</li><li>      <span class="hljs-keyword">continue</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">opts</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">DecodingOptions</span> = {</li><li>      <span class="hljs-variable">editable</span>: <span class="hljs-keyword">true</span>,</li><li>      <span class="hljs-variable">desiredPixelFormat</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMapFormat</span>.<span class="hljs-title class_">RGBA_8888</span>,</li><li>      <span class="hljs-variable">desiredSize</span>: { <span class="hljs-variable">width</span>: <span class="hljs-title class_">imageInfo</span>.<span class="hljs-title class_">size</span>.<span class="hljs-title class_">width</span>, <span class="hljs-variable">height</span>: <span class="hljs-title class_">imageInfo</span>.<span class="hljs-title class_">size</span>.<span class="hljs-title class_">height</span> }</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> = <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">createPixelMapSync</span>(<span class="hljs-variable">opts</span>);</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">pixelMap</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to create pixelMap.'</span>);</li><li>      <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">release</span>();</li><li>      <span class="hljs-keyword">continue</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">readBuffer</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">ArrayBuffer</span>(<span class="hljs-variable">pixelMap</span>.<span class="hljs-title function_">getPixelBytesNumber</span>());</li><li>    <span class="hljs-variable">await</span> <span class="hljs-variable">pixelMap</span>.<span class="hljs-title function_">readPixelsToBuffer</span>(<span class="hljs-variable">readBuffer</span>);</li><li>    <span class="hljs-variable">pixelMap</span>.<span class="hljs-title function_">release</span>();</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">result</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">initImage</span>(<span class="hljs-variable">componentId</span>, <span class="hljs-variable">imageInfo</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">width</span>, <span class="hljs-variable">imageInfo</span>.<span class="hljs-variable">size</span>.<span class="hljs-variable">height</span>, <span class="hljs-variable">readBuffer</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">errcode</span>.<span class="hljs-title function_">has</span>(<span class="hljs-variable">result</span>) === <span class="hljs-keyword">false</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to add image, break.'</span>);</li><li>      <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">release</span>();</li><li>      <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">result</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">Add</span> <span class="hljs-variable">image</span>, <span class="hljs-variable">reason</span> <span class="hljs-keyword">is</span>: ${<span class="hljs-variable">errcode</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable">result</span>)}, <span class="hljs-variable">imageName</span> <span class="hljs-keyword">is</span>: ${<span class="hljs-variable">imageName</span>}.`);</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">eventData</span>: <span class="hljs-title class_">emitter</span>.<span class="hljs-title class_">EventData</span> = {</li><li>      <span class="hljs-variable">data</span>: {</li><li>        <span class="hljs-string">'addImageReason'</span>: <span class="hljs-title class_">result</span>,</li><li>        <span class="hljs-string">'imageName'</span>: <span class="hljs-title class_">imageName</span>,</li><li>      }</li><li>    }</li><li>    <span class="hljs-variable">emitter</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'addImage'</span>, <span class="hljs-variable">eventData</span>);</li><li>    <span class="hljs-variable">imageSourceApi</span>.<span class="hljs-title function_">release</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>创建一个ARImageByDatabase.ets，用于加载本地数据库，加载相机预览画面，并定时触发每一帧绘制。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此代码可参考示例代码：ARSample/entry/src/main/ets/pages/ARImageByDatabase.ets。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">deviceInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">resourceManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">arEngineDemo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">ARImageByDatabaseBuilder</span>() {</li><li>  <span class="hljs-title function_">ARImageByDatabase</span>();</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ARImageByDatabase</span> {</li><li>  <span class="hljs-variable">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">isSurfaceDestroy</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">interval</span>: <span class="hljs-title class_">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">isUpdate</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">xComponentId</span> = <span class="hljs-string">'ARImage'</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">resMgr</span>: <span class="hljs-title class_">resourceManager</span>.<span class="hljs-title class_">ResourceManager</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">resourceManager</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">deviceInfo</span>.<span class="hljs-variable">deviceType</span> === <span class="hljs-string">'tablet'</span> ? <span class="hljs-number">3</span> : <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">showPage</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">true</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">NavDestination</span>() {</li><li>      <span class="hljs-title function_">RelativeContainer</span>() {</li><li>        <span class="hljs-title function_">XComponent</span>({ <span class="hljs-variable">id</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentId</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>, <span class="hljs-variable">libraryname</span>: <span class="hljs-string">'entry'</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">visibility</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">showPage</span> ? <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-title class_">None</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onLoad</span>(() =&gt; {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">XComponent</span> <span class="hljs-variable">onLoad</span> ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>}.`);</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span> = <span class="hljs-title function_">setInterval</span>(() =&gt; {</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span>) {</li><li>                <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>              }</li><li>            }, <span class="hljs-number">33</span>) <span class="hljs-comment">// 将帧率设置为30fps（每33毫秒刷新一次帧）。</span></li><li>          })</li><li>          .<span class="hljs-title function_">onDestroy</span>(() =&gt; {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">XComponent</span> <span class="hljs-variable">onDestroy</span> ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>}.`);</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">isSurfaceDestroy</span> = <span class="hljs-keyword">true</span>;</li><li>            <span class="hljs-title function_">clearInterval</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">resMgr</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">config</span>: <span class="hljs-title class_">Int32Array</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Int32Array</span>([<span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">rotation</span>]);</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">start</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-variable">config</span>);</li><li>
</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">setPath</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">filesDir</span>);</li><li>
</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">imageCountInDatabase</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">getImageCount</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">ImageCountInDatabase</span>: ${<span class="hljs-variable">imageCountInDatabase</span>}.`);</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">imageCountInDatabase</span> &lt;= <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">ShowDialog</span>(<span class="hljs-string">'请添加有效图片'</span>);</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">onWillDisappear</span>(() =&gt; {</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">stop</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onShown</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">true</span>;</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">show</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onHidden</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">false</span>;</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">isSurfaceDestroy</span>) {</li><li>        <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">hide</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>((<span class="hljs-variable">context</span>: <span class="hljs-title class_">NavDestinationContext</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathStack</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-keyword">true</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">ShowDialog</span>(<span class="hljs-variable">msg</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">showAlertDialog</span>({</li><li>      <span class="hljs-variable">title</span>: <span class="hljs-string">'警告'</span>,</li><li>      <span class="hljs-variable">message</span>: <span class="hljs-title class_">msg</span>,</li><li>      <span class="hljs-variable">autoCancel</span>: <span class="hljs-keyword">true</span>,</li><li>      <span class="hljs-variable">alignment</span>: <span class="hljs-title class_">DialogAlignment</span>.<span class="hljs-title class_">Center</span>,</li><li>      <span class="hljs-variable">offset</span>: { <span class="hljs-variable">dx</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">dy</span>: -<span class="hljs-number">20</span> },</li><li>      <span class="hljs-variable">gridCount</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-variable">transition</span>: <span class="hljs-title class_">TransitionEffect</span></li><li>        .<span class="hljs-title function_">asymmetric</span>(<span class="hljs-variable">TransitionEffect</span>.<span class="hljs-variable">OPACITY</span></li><li>          .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Sharp</span> })</li><li>          .<span class="hljs-title function_">combine</span>(<span class="hljs-variable">TransitionEffect</span></li><li>            .<span class="hljs-title function_">scale</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">1.5</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">1.5</span> })</li><li>            .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Sharp</span> })</li><li>          ),</li><li>          <span class="hljs-variable">TransitionEffect</span>.<span class="hljs-variable">OPACITY</span>.<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Smooth</span> })</li><li>            .<span class="hljs-title function_">combine</span>(<span class="hljs-variable">TransitionEffect</span>.<span class="hljs-title function_">scale</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">0.5</span> })</li><li>              .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Smooth</span> })</li><li>            )</li><li>        ),</li><li>      <span class="hljs-variable">buttons</span>: [{</li><li>        <span class="hljs-variable">enabled</span>: <span class="hljs-keyword">true</span>,</li><li>        <span class="hljs-variable">defaultFocus</span>: <span class="hljs-keyword">true</span>,</li><li>        <span class="hljs-variable">style</span>: <span class="hljs-title class_">DialogButtonStyle</span>.<span class="hljs-title class_">HIGHLIGHT</span>,</li><li>        <span class="hljs-variable">value</span>: <span class="hljs-string">'退出'</span>,</li><li>        <span class="hljs-variable">action</span>: () =&gt; {</li><li>          <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Callback when the second button is clicked.'</span>);</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>        }</li><li>      }]</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>配置路由进行页面间跳转，页面路由配置详细可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation" target="_blank">组件导航(Navigation) (推荐)</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section13951554911">引入AR Engine<i class="anchor-icon anchor-icon-link" anchorid="section13951554911" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002329946678__zh-cn_topic_0000002363865165_p1174733951511">开发者可参考AR物体摆放章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arworld#section183721115521">引入AR Engine</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section15100195015019">创建AR会话<i class="anchor-icon anchor-icon-link" anchorid="section15100195015019" tips="复制节点链接"></i></h3>          <p>创建AR会话并配置ARType为图像跟踪。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARSession *arSession = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Create</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;arSession);</li><li>AREngine_ARConfig *arConfig = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话配置器。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_Create</span>(arSession, &amp;arConfig);</li><li><span class="hljs-comment">// 设置ARType为ARENGINE_TYPE_IMAGE</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_SetARType</span>(arSession, arConfig, ARENGINE_TYPE_IMAGE);</li><li><span class="hljs-comment">// 配置器设置给AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Configure</span>(arSession, arConfig);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section195101342518">创建跟踪图像数据库并添加图像<i class="anchor-icon anchor-icon-link" anchorid="section195101342518" tips="复制节点链接"></i></h3>          <p>1.调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section4108822184411" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_Create</a>函数，创建跟踪图像数据库。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建跟踪图像数据库</span></li><li>AREngine_ARAugmentedImageDatabase *mDataBase = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARAugmentedImageDatabase_Create</span>(&amp;mDataBase);</li></ol></pre></div></div>     <p>2.调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section0315115618403" target="_blank">HMS_AREngine_ARAugmentedImageDatabase_AddImage</a>函数，添加图像到数据库，将添加失败的结果保存在reason中。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 添加图像到数据库</span></li><li>AREngine_ARAddAugmentedImageReason reason = ARENGINE_ADD_AUGMENTED_IMAGE_REASON_NONE;</li><li>AREngine_ARAugmentedImageSource image;</li><li><span class="hljs-type">uint32_t</span> outputIndex = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 通过输入的图片构造image,具体可参考示例代码</span></li><li><span class="hljs-keyword">auto</span> addRet = <span class="hljs-built_in">HMS_AREngine_ARAugmentedImageDatabase_AddImage</span>(mDataBase, &amp;image, &amp;outputIndex, &amp;reason);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section159568285516">识别环境中的可跟踪图像<i class="anchor-icon anchor-icon-link" anchorid="section159568285516" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a>函数，检测当前环境中的所有跟踪图像，并将结果存放在augmentList中。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackableList *augmentList = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_Create</span>(arSession, &amp;augmentList);</li><li><span class="hljs-built_in">HMS_AREngine_ARSession_GetAllTrackables</span>(arSession, ARENGINE_TRACKABLE_AUGMENTED_IMAGE, augmentList);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section2093917494515">获取环境中的可跟踪图像数量<i class="anchor-icon anchor-icon-link" anchorid="section2093917494515" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gad9729d4436f3d969286f31b33d07513e" target="_blank">HMS_AREngine_ARTrackableList_GetSize</a>函数获取平面数量，结果存放在augmentSize中。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> augmentSize = <span class="hljs-number">0</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_GetSize</span>(arSession, augmentList, &amp;augmentSize);</li></ol></pre></div></div>     <p>应用环境中，可能存在0个、1个或多个可跟踪图像。</p>     <p>当augmentSize等于0时，表示当前环境中不存在可跟踪图像。</p>     <p>当augmentSize等于1时，表示当前环境中仅存在1个可跟踪图像。</p>     <p>当augmentSize大于1时，表示当前环境中存在多个可跟踪图像。</p>    </div>    <div class="tiledSection">     <h3 id="section58012014165217">获取跟踪图像示例<i class="anchor-icon anchor-icon-link" anchorid="section58012014165217" tips="复制节点链接"></i></h3>          <p>当存在1个或多个跟踪图像时，可以依次遍历augmentList获取所有跟踪图像。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; augmentSize; ++i) {</li><li>    <span class="hljs-comment">// 遍历所有可跟踪对象，根据应用进行处理。</span></li><li>}</li></ol></pre></div></div>     <p>对于第i个跟踪图像，创建并获取跟踪对象，并将其转化为跟踪图像对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section68491824155217" target="_blank">AREngine_ARAugmentedImage</a>。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackable *augment = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_AcquireItem</span>(arSession, augmentList, i, &amp;augment);</li><li>AREngine_ARAugmentedImage *arImage = <span class="hljs-built_in">reinterpret_cast</span>&lt;AREngine_ARAugmentedImage*&gt;(augment);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section8782123725214">获取跟踪图像中心点在世界坐标系中的位姿信息<i class="anchor-icon anchor-icon-link" anchorid="section8782123725214" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section498975343520" target="_blank">HMS_AREngine_ARAugmentedImage_GetCenterPose</a>函数，获取跟踪图像中心点的位姿信息，位姿信息可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-get-pose">获取设备位姿</a></p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARPose *imagePose = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARPose_Create</span>(arSession, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;imagePose);</li><li><span class="hljs-built_in">HMS_AREngine_ARAugmentedImage_GetCenterPose</span>(arSession, arImage, imagePose);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1546409185313">获取跟踪图像的宽度<i class="anchor-icon anchor-icon-link" anchorid="section1546409185313" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section917593011382" target="_blank">HMS_AREngine_ARAugmentedImage_GetExtendX</a>函数，获取图像的中心点为坐标原点，物理图像的宽度（单位为米），得到X轴上的估计值。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">float</span> extent_x;</li><li><span class="hljs-built_in">HMS_AREngine_ARAugmentedImage_GetExtendX</span>(arSession, arImage, &amp;extent_x);</li></ol></pre></div></div>     <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section9630192711390" target="_blank">HMS_AREngine_ARAugmentedImage_GetExtendZ</a>函数，获取图像的中心点为坐标原点，物理图像的宽度（单位为米），得到Z轴上的估计值。</p>     <div _ngcontent-rqm-c106="" class="highlight-div"><div _ngcontent-rqm-c106="" class="highlight-div-header"><div _ngcontent-rqm-c106="" class="highlight-div-header-left"><div _ngcontent-rqm-c106="" class="handle-button expand-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqm-c106="" class="highlight-div-header-right"><div _ngcontent-rqm-c106="" class="handle-button ai-button"></div><div _ngcontent-rqm-c106="" class="handle-button line-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqm-c106="" class="handle-button theme-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqm-c106="" class="handle-button copy-button"><div _ngcontent-rqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">float</span> extent_z;</li><li><span class="hljs-built_in">HMS_AREngine_ARAugmentedImage_GetExtendZ</span>(arSession, arImage, &amp;extent_z); </li></ol></pre></div></div>    </div>   </div>   <div></div></div>