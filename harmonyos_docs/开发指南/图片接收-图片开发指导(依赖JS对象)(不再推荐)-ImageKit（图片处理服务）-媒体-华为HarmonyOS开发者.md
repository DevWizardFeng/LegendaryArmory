<h1 _ngcontent-oaq-c119="" class="doc-title ng-star-inserted" title="图片接收"> 图片接收 </h1>

<div _ngcontent-oaq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>当前开发指导使用的接口为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-image" target="_blank">Image</a>模块下的C API，可完成图片编解码，图片接收器，处理图像数据等功能。这部分API在API version 11之前发布，在后续的版本不再增加新功能，<strong>不再推荐使用</strong>。</p>      <p>开发者可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-image-nativemodule" target="_blank">Image_NativeModule</a>模块下的C API，不仅提供上述图片框架基础功能，还可以完成多图编解码等新特性，相关开发指导请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-source-c">图片开发指导(C/C++)</a>节点下的内容。这部分API从API version 12开始支持，并将持续演进，<strong>推荐开发者使用</strong>。</p>      <p>两套C API不建议同时使用，在部分场景下存在不兼容的问题。</p>     </div></div></div>    <p>图片接收类，用于获取组件surface id，接收最新的图片和读取下一张图片，以及释放ImageReceiver实例。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="添加依赖" class="firsth2">添加依赖<i class="anchor-icon anchor-icon-link" anchorid="添加依赖" tips="复制节点链接"></i></h3>          <p>在进行应用开发之前，开发者需要打开native工程的src/main/cpp/CMakeLists.txt，在target_link_libraries依赖中添加libace_napi.z.so、libimage_ndk.z.so、libimage_receiver_ndk.z.so、libnative_image.so以及日志依赖libhilog_ndk.z.so。</p>     <div _ngcontent-oaq-c106="" class="highlight-div"><div _ngcontent-oaq-c106="" class="highlight-div-header"><div _ngcontent-oaq-c106="" class="highlight-div-header-left"><div _ngcontent-oaq-c106="" class="handle-button expand-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oaq-c106="" class="highlight-div-header-right"><div _ngcontent-oaq-c106="" class="handle-button ai-button"></div><div _ngcontent-oaq-c106="" class="handle-button line-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oaq-c106="" class="handle-button theme-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oaq-c106="" class="handle-button copy-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oaq-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so libimage_ndk.z.so libimage_receiver_ndk.z.so libnative_image.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加接口映射">添加接口映射<i class="anchor-icon anchor-icon-link" anchorid="添加接口映射" tips="复制节点链接"></i></h3>          <p>打开src/main/cpp/hello.cpp文件，在Init函数中添加接口映射如下：</p>     <div _ngcontent-oaq-c106="" class="highlight-div"><div _ngcontent-oaq-c106="" class="highlight-div-header"><div _ngcontent-oaq-c106="" class="highlight-div-header-left"><div _ngcontent-oaq-c106="" class="handle-button expand-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oaq-c106="" class="highlight-div-header-right"><div _ngcontent-oaq-c106="" class="handle-button ai-button"></div><div _ngcontent-oaq-c106="" class="handle-button line-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oaq-c106="" class="handle-button theme-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oaq-c106="" class="handle-button copy-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oaq-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"createFromReceiver"</span>, <span class="hljs-literal">nullptr</span>, createFromReceiver, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>    };</li><li>
</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加权限申请">添加权限申请<i class="anchor-icon anchor-icon-link" anchorid="添加权限申请" tips="复制节点链接"></i></h3>          <p>此处通过camera图片获取输入数据，需要申请权限ohos.permission.CAMERA，申请方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">向用户申请授权</a>。</p>    </div>    <div class="tiledSection">     <h3 id="js侧调用">JS侧调用<i class="anchor-icon anchor-icon-link" anchorid="js侧调用" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>打开src\main\cpp\types\libentry\index.d.ts（其中libentry根据工程名生成），导入如下引用文件：</p>       <div _ngcontent-oaq-c106="" class="highlight-div"><div _ngcontent-oaq-c106="" class="highlight-div-header"><div _ngcontent-oaq-c106="" class="highlight-div-header-left"><div _ngcontent-oaq-c106="" class="handle-button expand-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oaq-c106="" class="highlight-div-header-right"><div _ngcontent-oaq-c106="" class="handle-button ai-button"></div><div _ngcontent-oaq-c106="" class="handle-button line-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oaq-c106="" class="handle-button theme-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oaq-c106="" class="handle-button copy-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oaq-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createFromReceiver</span>: <span class="hljs-function">(<span class="hljs-params">a: image.ImageReceiver</span>) =&gt;</span> image.<span class="hljs-property">Image</span>;</li></ol></pre></div></div></li>      <li>       <p>打开src\main\ets\pages\index.ets，导入"libentry.so（根据工程名生成）"，调用Native接口，传入JS的资源对象。示例如下：</p>       <div _ngcontent-oaq-c106="" class="highlight-div"><div _ngcontent-oaq-c106="" class="highlight-div-header"><div _ngcontent-oaq-c106="" class="highlight-div-header-left"><div _ngcontent-oaq-c106="" class="handle-button expand-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oaq-c106="" class="highlight-div-header-right"><div _ngcontent-oaq-c106="" class="handle-button ai-button"></div><div _ngcontent-oaq-c106="" class="handle-button line-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oaq-c106="" class="handle-button theme-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oaq-c106="" class="handle-button copy-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oaq-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { common, abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li>
</li><li>@<span class="hljs-title class_">Entry</span></li><li>@<span class="hljs-title class_">Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  private <span class="hljs-attr">receiver</span>: image.<span class="hljs-property">ImageReceiver</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  func (){</li><li>     <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>     abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>().<span class="hljs-title function_">requestPermissionsFromUser</span>(context,[<span class="hljs-string">'ohos.permission.CAMERA'</span>]).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>        <span class="hljs-keyword">let</span> cameraManager = <span class="hljs-keyword">await</span> camera.<span class="hljs-title function_">getCameraManager</span>(context);</li><li>        <span class="hljs-comment">// 获取支持的相机设备对象。</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraDevices</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>        <span class="hljs-keyword">if</span> (cameraDevices.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 获取对应相机设备的profiles。</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">profiles</span>: camera.<span class="hljs-property">CameraOutputCapability</span> = cameraManager.<span class="hljs-title function_">getSupportedOutputCapability</span>(cameraDevices[<span class="hljs-number">0</span>], camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">previewProfiles</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = profiles.<span class="hljs-property">previewProfiles</span>;</li><li>        <span class="hljs-keyword">if</span> (previewProfiles.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">let</span> profileObj = previewProfiles[<span class="hljs-number">0</span>];</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span> = image.<span class="hljs-title function_">createImageReceiver</span>({<span class="hljs-attr">width</span>:profileObj.<span class="hljs-property">size</span>.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>:profileObj.<span class="hljs-property">size</span>.<span class="hljs-property">height</span>}, image.<span class="hljs-property">ImageFormat</span>.<span class="hljs-property">JPEG</span>, <span class="hljs-number">8</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">receiverSurfaceId</span>: string = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span>.<span class="hljs-title function_">getReceivingSurfaceId</span>();</li><li>        <span class="hljs-comment">// 创建预览流输出对象。</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">previewOutput</span>: camera.<span class="hljs-property">PreviewOutput</span> = cameraManager.<span class="hljs-title function_">createPreviewOutput</span>(profileObj,receiverSurfaceId);</li><li>        <span class="hljs-keyword">let</span> cameraInput : camera.<span class="hljs-property">CameraInput</span> = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraDevices[<span class="hljs-number">0</span>]);</li><li>        <span class="hljs-comment">// 打开相机。</span></li><li>        <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>();</li><li>        <span class="hljs-comment">// 会话流程。</span></li><li>        <span class="hljs-keyword">let</span> session : camera.<span class="hljs-property">PhotoSession</span> = cameraManager.<span class="hljs-title function_">createSession</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>        <span class="hljs-comment">// 配置会话。</span></li><li>        session.<span class="hljs-title function_">beginConfig</span>();</li><li>        <span class="hljs-comment">// 把cameraInput加入到会话。</span></li><li>        session.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>        <span class="hljs-comment">// 把预览流加入到会话。</span></li><li>        session.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>        <span class="hljs-comment">// 提交配置信息。</span></li><li>        <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">commitConfig</span>();</li><li>        <span class="hljs-comment">// 会话开始。</span></li><li>        <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">start</span>();</li><li>
</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'imageArrival'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-keyword">let</span> img : image.<span class="hljs-property">Image</span> = testNapi.<span class="hljs-title function_">createFromReceiver</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span>);</li><li>           img.<span class="hljs-title function_">release</span>();</li><li>        })</li><li>
</li><li>     });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"start"</span>)</li><li>           .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>           .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>           .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"button click in"</span>);</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span> == <span class="hljs-literal">undefined</span>) {</li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">func</span>();</li><li>              }</li><li>           })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>     }</li><li>     .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="native接口调用">Native接口调用<i class="anchor-icon anchor-icon-link" anchorid="native接口调用" tips="复制节点链接"></i></h3>          <p>具体接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-image" target="_blank">API文档</a>。</p>     <p>在hello.cpp文件中获取JS的资源对象，并转为Native的资源对象，即可调用Native接口，调用方式示例代码如下：</p>     <p><strong>添加引用文件</strong></p>     <div _ngcontent-oaq-c106="" class="highlight-div"><div _ngcontent-oaq-c106="" class="highlight-div-header"><div _ngcontent-oaq-c106="" class="highlight-div-header-left"><div _ngcontent-oaq-c106="" class="handle-button expand-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oaq-c106="" class="highlight-div-header-right"><div _ngcontent-oaq-c106="" class="handle-button ai-button"></div><div _ngcontent-oaq-c106="" class="handle-button line-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oaq-c106="" class="handle-button theme-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oaq-c106="" class="handle-button copy-button"><div _ngcontent-oaq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oaq-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/image_framework/image_mdk.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/image_framework/image_receiver_mdk.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;malloc.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">createFromReceiver</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>   <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>   napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>   <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>   napi_valuetype valuetype0;</li><li>   <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valuetype0);</li><li>   napi_ref reference;</li><li>   <span class="hljs-built_in">napi_create_reference</span>(env, args[<span class="hljs-number">0</span>], <span class="hljs-number">1</span> ,&amp;reference);</li><li>   napi_value imgReceiver_js;</li><li>   <span class="hljs-built_in">napi_get_reference_value</span>(env, reference, &amp;imgReceiver_js);</li><li>   </li><li>   ImageReceiverNative * imgReceiver_c = <span class="hljs-built_in">OH_Image_Receiver_InitImageReceiverNative</span>(env, imgReceiver_js);</li><li>
</li><li>   <span class="hljs-type">int32_t</span> capacity;</li><li>   <span class="hljs-built_in">OH_Image_Receiver_GetCapacity</span>(imgReceiver_c, &amp;capacity);</li><li>   <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"[receiver]"</span>, <span class="hljs-string">"capacity: %{public}d"</span>, capacity);</li><li>   <span class="hljs-type">int32_t</span> format;</li><li>   <span class="hljs-built_in">OH_Image_Receiver_GetFormat</span>(imgReceiver_c, &amp;format);</li><li>   <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"[receiver]"</span>, <span class="hljs-string">"format: %{public}d"</span>, format);</li><li>   <span class="hljs-type">char</span> * surfaceId = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">char</span> *&gt;(<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>)));</li><li>   <span class="hljs-built_in">OH_Image_Receiver_GetReceivingSurfaceId</span>(imgReceiver_c, surfaceId, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>));</li><li>   <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"[receiver]"</span>, <span class="hljs-string">"surfaceId: %{public}c"</span>, surfaceId[<span class="hljs-number">0</span>]);</li><li>   OhosImageSize size;</li><li>   <span class="hljs-built_in">OH_Image_Receiver_GetSize</span>(imgReceiver_c, &amp;size);</li><li>   <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"[receiver]"</span>, <span class="hljs-string">"OH_Image_Receiver_GetSize  width: %{public}d, height:%{public}d"</span>, size.width, size.height);</li><li>   </li><li>   <span class="hljs-type">int32_t</span> ret;</li><li>   napi_value nextImage;</li><li>   <span class="hljs-comment">// 或调用 OH_Image_Receiver_ReadNextImage(imgReceiver_c, &amp;nextImage);</span></li><li>   ret = <span class="hljs-built_in">OH_Image_Receiver_ReadLatestImage</span>(imgReceiver_c, &amp;nextImage);</li><li>   </li><li>   ImageNative * nextImage_native = <span class="hljs-built_in">OH_Image_InitImageNative</span>(env, nextImage);</li><li>
</li><li>   OhosImageSize imageSize;</li><li>   <span class="hljs-built_in">OH_Image_Size</span>(nextImage_native, &amp;imageSize);</li><li>   <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"[receiver]"</span>, <span class="hljs-string">"OH_Image_Size  width: %{public}d, height:%{public}d"</span>, imageSize.width, imageSize.height);</li><li>
</li><li>   OhosImageComponent imgComponent;</li><li>   ret = <span class="hljs-built_in">OH_Image_GetComponent</span>(nextImage_native, <span class="hljs-number">4</span>, &amp;imgComponent); <span class="hljs-comment">// 4=jpeg</span></li><li>   </li><li>   <span class="hljs-type">uint8_t</span> *img_buffer = imgComponent.byteBuffer;</li><li>   </li><li>   ret = <span class="hljs-built_in">OH_Image_Release</span>(nextImage_native);</li><li>   ret = <span class="hljs-built_in">OH_Image_Receiver_Release</span>(imgReceiver_c);</li><li>   <span class="hljs-keyword">return</span> nextImage;</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>