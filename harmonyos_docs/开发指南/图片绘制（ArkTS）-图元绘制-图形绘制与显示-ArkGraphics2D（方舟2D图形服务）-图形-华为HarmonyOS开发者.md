<h1 _ngcontent-auk-c119="" class="doc-title ng-star-inserted" title="图片绘制（ArkTS）"> 图片绘制（ArkTS） </h1>

<div _ngcontent-auk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>位图是一种用于在内存中存储和表示图像的数据结构，它是一个未经过压缩的像素集合，而JPEG或PNG等格式的图片是压缩格式的，两者并不相同。如果需要将JPEG或PNG绘制到屏幕上，需要先解码成位图格式，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-overview">图片处理服务（Image Kit）</a>图片解码相关章节。</p>    <p>目前Drawing（ArkTS）中位图绘制需要依赖PixelMap，它可以用于读取或写入图像数据以及获取图像信息。详细的API介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>。</p>    <ol>     <li>      <p>创建PixelMap。</p>      <p>有多个API接口可以创建PixelMap，下文以createPixelMapSync()为例。更多创建方式和接口请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image" target="_blank">@ohos.multimedia.image (图片处理)</a>模块。</p>      <p>createPixelMapSync()函数接受两个参数，第一个参数为图像像素数据的缓冲区，用于初始化PixelMap的像素。第二个参数为创建像素的属性，包括透明度、尺寸、缩略值、像素格式和是否可编辑。</p>      <div _ngcontent-auk-c106="" class="highlight-div"><div _ngcontent-auk-c106="" class="highlight-div-header"><div _ngcontent-auk-c106="" class="highlight-div-header-left"><div _ngcontent-auk-c106="" class="handle-button expand-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auk-c106="" class="highlight-div-header-right"><div _ngcontent-auk-c106="" class="handle-button ai-button"></div><div _ngcontent-auk-c106="" class="handle-button line-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auk-c106="" class="handle-button theme-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auk-c106="" class="handle-button copy-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 图片宽高</span></li><li><span class="hljs-keyword">let</span> width = <span class="hljs-number">600</span>;</li><li><span class="hljs-keyword">let</span> height = <span class="hljs-number">400</span>;</li><li><span class="hljs-comment">// 字节长度，RGBA_8888每个像素占4字节</span></li><li><span class="hljs-keyword">let</span> byteLength = width * height * <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(byteLength);</li><li><span class="hljs-keyword">let</span> bufferArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(color);</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bufferArr.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) {</li><li>  <span class="hljs-comment">// 遍历并编辑每个像素，从而形成红绿蓝相间的条纹</span></li><li>  bufferArr[i] = <span class="hljs-number">0x00</span>;</li><li>  bufferArr[i+<span class="hljs-number">1</span>] = <span class="hljs-number">0x00</span>;</li><li>  bufferArr[i+<span class="hljs-number">2</span>] = <span class="hljs-number">0x00</span>;</li><li>  bufferArr[i+<span class="hljs-number">3</span>] = <span class="hljs-number">0xFF</span>;</li><li>  <span class="hljs-keyword">let</span> n = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(i / <span class="hljs-number">80</span>) % <span class="hljs-number">3</span>;</li><li>  <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) {</li><li>    bufferArr[i] = <span class="hljs-number">0xFF</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) {</li><li>    bufferArr[i+<span class="hljs-number">1</span>] = <span class="hljs-number">0xFF</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    bufferArr[i+<span class="hljs-number">2</span>] = <span class="hljs-number">0xFF</span>;</li><li>  }</li><li>}</li><li><span class="hljs-comment">// 设置像素属性</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">opts</span>: image.<span class="hljs-property">InitializationOptions</span> = { <span class="hljs-attr">editable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">pixelFormat</span>: image.<span class="hljs-property">PixelMapFormat</span>.<span class="hljs-property">RGBA_8888</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">height</span>: height, <span class="hljs-attr">width</span>: width }};</li><li><span class="hljs-comment">// 创建PixelMap</span></li><li><span class="hljs-keyword">let</span> pixelMap : image.<span class="hljs-property">PixelMap</span> = image.<span class="hljs-title function_">createPixelMapSync</span>(color, opts);</li></ol></pre></div></div></li>     <li>      <p>（可选）编辑PixelMap中的像素。如果没有编辑像素的需求，此步骤可以省略。</p>      <p>有多个API接口可以编辑PixelMap中的像素，下文以writePixelsSync()为例。更多方式和接口的使用可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>。</p>      <div _ngcontent-auk-c106="" class="highlight-div"><div _ngcontent-auk-c106="" class="highlight-div-header"><div _ngcontent-auk-c106="" class="highlight-div-header-left"><div _ngcontent-auk-c106="" class="handle-button expand-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auk-c106="" class="highlight-div-header-right"><div _ngcontent-auk-c106="" class="handle-button ai-button"></div><div _ngcontent-auk-c106="" class="handle-button line-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auk-c106="" class="handle-button theme-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auk-c106="" class="handle-button copy-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置编辑区域的宽高</span></li><li><span class="hljs-keyword">let</span> innerWidth = <span class="hljs-number">400</span>;</li><li><span class="hljs-keyword">let</span> innerHeight = <span class="hljs-number">200</span>;</li><li><span class="hljs-comment">// 编辑区域的字节长度，RGBA_8888每个像素占4字节</span></li><li><span class="hljs-keyword">let</span> innerByteLength = innerWidth * innerHeight * <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">innerColor</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(innerByteLength);</li><li><span class="hljs-keyword">let</span> innerBufferArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(innerColor);</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; innerBufferArr.<span class="hljs-property">length</span>; i += <span class="hljs-number">4</span>) {</li><li>  <span class="hljs-comment">// 编辑区域的像素都设置为黑白相间条纹</span></li><li>  <span class="hljs-keyword">let</span> n = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(i / <span class="hljs-number">80</span>) % <span class="hljs-number">2</span>;</li><li>  <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) {</li><li>    innerBufferArr[i] = <span class="hljs-number">0x00</span>;</li><li>    innerBufferArr[i+<span class="hljs-number">1</span>] = <span class="hljs-number">0x00</span>;</li><li>    innerBufferArr[i+<span class="hljs-number">2</span>] = <span class="hljs-number">0x00</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    innerBufferArr[i] = <span class="hljs-number">0xFF</span>;</li><li>    innerBufferArr[i+<span class="hljs-number">1</span>] = <span class="hljs-number">0xFF</span>;</li><li>    innerBufferArr[i+<span class="hljs-number">2</span>] = <span class="hljs-number">0xFF</span>;</li><li>  }</li><li>  innerBufferArr[i+<span class="hljs-number">3</span>] = <span class="hljs-number">0xFF</span>;</li><li>}</li><li><span class="hljs-comment">// 设置编辑区域的像素、宽高、偏移量等</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">area</span>: image.<span class="hljs-property">PositionArea</span> = {</li><li>  <span class="hljs-attr">pixels</span>: innerColor,</li><li>  <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">stride</span>: innerWidth * <span class="hljs-number">4</span>,</li><li>  <span class="hljs-attr">region</span>: { <span class="hljs-attr">size</span>: { <span class="hljs-attr">height</span>: innerHeight, <span class="hljs-attr">width</span>: innerWidth }, <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> }</li><li>};</li><li><span class="hljs-comment">// 编辑位图，形成中间的黑白相间条纹</span></li><li>pixelMap.<span class="hljs-title function_">writePixelsSync</span>(area);</li></ol></pre></div></div></li>     <li>      <p>绘制PixelMap。</p>      <p>绘制PixelMap时需要通过Canva相关接口绘制位图，下文以drawImage()为例。更多方式和接口的使用请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas" target="_blank">drawing.Canvas</a>。</p>      <p>drawImage()函数接受4个参数，第一个就是上文中创建的PixelMap，第二个是绘制图片位置的左上角x轴坐标，第三个是左上角y轴坐标，第四个为采样选项对象，默认为不使用任何参数构造的原始采样选项对象。</p>      <div _ngcontent-auk-c106="" class="highlight-div"><div _ngcontent-auk-c106="" class="highlight-div-header"><div _ngcontent-auk-c106="" class="highlight-div-header-left"><div _ngcontent-auk-c106="" class="handle-button expand-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auk-c106="" class="highlight-div-header-right"><div _ngcontent-auk-c106="" class="handle-button ai-button"></div><div _ngcontent-auk-c106="" class="handle-button line-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auk-c106="" class="handle-button theme-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auk-c106="" class="handle-button copy-button"><div _ngcontent-auk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>canvas.<span class="hljs-title function_">drawImage</span>(pixelMap, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li></ol></pre></div></div>      <p>绘制效果如下：</p>      <p><span><img originheight="258" originwidth="493" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114405.89055611219271156168962473126964:50001231000000:2800:13AF1A7AF7322B52276114E57046E63CA966C5BF9FA130FEF0C3BE2F2C7B65C8.png" width="493" height="258"></span></p></li>    </ol>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/DocsSample_Graphics/blob/master/ArkGraphics2D/Drawing/ArkTSGraphicsDraw" target="_blank">图形绘制（ArkTS）</a></li>     </ul>    </div>   </div>   <div></div></div>