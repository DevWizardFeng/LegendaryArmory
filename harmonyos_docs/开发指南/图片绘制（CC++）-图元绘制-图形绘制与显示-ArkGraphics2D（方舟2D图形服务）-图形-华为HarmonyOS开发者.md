<h1 _ngcontent-gbx-c119="" class="doc-title ng-star-inserted" title="图片绘制（C/C++）"> 图片绘制（C/C++） </h1>

<div _ngcontent-gbx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>位图是一种用于在内存中存储和表示图像的数据结构，它是一个未经过压缩的像素集合，而JPEG或PNG等图片是压缩格式的，两者并不相同。如果需要将JPEG或PNG绘制到屏幕上，需要先解码成位图格式，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-overview">图片处理服务（Image Kit）</a>图片解码相关章节。</p>    <p>目前Drawing（C/C++）中位图绘制需要依赖PixelMap，它可以用于读取或写入图像数据以及获取图像信息。详细的API介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-pixel-map-h" target="_blank">drawing_pixel_map.h</a>。</p>    <p>有多个API接口可以创建PixelMap，下文以使用OH_Drawing_PixelMapGetFromOhPixelMapNative()为例。</p>    <ol>     <li>      <p>添加链接库。</p>      <p>在Native工程的src/main/cpp/CMakeLists.txt，添加如下链接库：</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_drawing.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libhilog_ndk.z.so libpixelmap.so)</li></ol></pre></div></div></li>     <li>      <p>导入依赖的相关头文件。</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;multimedia/image_framework/image/pixelmap_native.h&gt;</span></span></li></ol></pre></div></div></li>     <li>      <p>创建OH_PixelmapNative像素图对象。</p>      <p>PixelMap需要从图像框架定义的像素图对象（OH_PixelmapNative）中获取，所以需要先通过OH_PixelmapNative_CreatePixelmap()创建OH_PixelmapNative。该函数接受4个参数，第一个参数为图像像素数据的缓冲区，用于初始化PixelMap的像素。第二个参数是缓冲区长度。第三个参数是位图格式（包括长、宽、颜色类型、透明度类型等）。第四个参数即OH_PixelmapNative对象，作为出参使用。</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 图片宽高</span></li><li><span class="hljs-type">uint32_t</span> width = <span class="hljs-number">600</span>;</li><li><span class="hljs-type">uint32_t</span> height = <span class="hljs-number">400</span>;</li><li><span class="hljs-comment">// 字节长度，RGBA_8888每个像素占4字节</span></li><li><span class="hljs-type">size_t</span> bufferSize = width * height * <span class="hljs-number">4</span>;</li><li><span class="hljs-type">uint8_t</span> *pixels = <span class="hljs-keyword">new</span> <span class="hljs-type">uint8_t</span>[bufferSize];</li><li><span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; width*height; ++i) {</li><li>    <span class="hljs-comment">// 遍历并编辑每个像素，从而形成红绿蓝相间的条纹</span></li><li>    <span class="hljs-type">uint32_t</span> n = i / <span class="hljs-number">20</span> % <span class="hljs-number">3</span>;</li><li>    pixels[i*<span class="hljs-number">4</span>] = <span class="hljs-number">0x00</span>;</li><li>    pixels[i*<span class="hljs-number">4</span>+<span class="hljs-number">1</span>] = <span class="hljs-number">0x00</span>;</li><li>    pixels[i*<span class="hljs-number">4</span>+<span class="hljs-number">2</span>] = <span class="hljs-number">0x00</span>;</li><li>    pixels[i*<span class="hljs-number">4</span>+<span class="hljs-number">3</span>] = <span class="hljs-number">0xFF</span>;</li><li>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) {</li><li>        pixels[i*<span class="hljs-number">4</span>] = <span class="hljs-number">0xFF</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) {</li><li>        pixels[i*<span class="hljs-number">4</span>+<span class="hljs-number">1</span>] = <span class="hljs-number">0xFF</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        pixels[i*<span class="hljs-number">4</span>+<span class="hljs-number">2</span>] = <span class="hljs-number">0xFF</span>;</li><li>    }</li><li>}</li><li><span class="hljs-comment">// 设置位图格式（长、宽、颜色类型、透明度类型）</span></li><li>OH_Pixelmap_InitializationOptions *createOps = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_Create</span>(&amp;createOps);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetWidth</span>(createOps, width);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetHeight</span>(createOps, height);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetPixelFormat</span>(createOps, PIXEL_FORMAT_RGBA_8888);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetAlphaType</span>(createOps, PIXELMAP_ALPHA_TYPE_UNKNOWN);</li><li><span class="hljs-comment">// 创建OH_PixelmapNative对象</span></li><li>OH_PixelmapNative *pixelMapNative = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_PixelmapNative_CreatePixelmap</span>(pixels, bufferSize, createOps, &amp;pixelMapNative);</li></ol></pre></div></div></li>     <li>      <p>创建PixelMap。</p>      <p>通过OH_Drawing_PixelMapGetFromOhPixelMapNative()函数从OH_PixelmapNative中获取PixelMap。</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_PixelMap *pixelMap = OH_Drawing_PixelMapGetFromOhPixelMapNative(pixelMapNative);</li></ol></pre></div></div></li>     <li>      <p>绘制PixelMap。</p>      <p>需要通过OH_Drawing_CanvasDrawPixelMapRect()绘制位图PixelMap。函数接受5个参数，分别为画布Canvas、PixelMap对象、PixelMap中像素的截取区域、画布中显示的区域以及采样选项对象。</p>      <p>其中采样选项对象（OH_Drawing_SamplingOptions）表示了从原始像素数据（即Bitmap）中采样以生成新的像素值的具体方式，具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-sampling-options-h" target="_blank">drawing_sampling_options.h</a>。</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PixelMap中像素的截取区域</span></li><li><span class="hljs-variable">OH_Drawing_Rect</span> *<span class="hljs-variable">src</span> = <span class="hljs-title function_">OH_Drawing_RectCreate</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">600</span>, <span class="hljs-number">400</span>);</li><li><span class="hljs-comment">// 画布中显示的区域</span></li><li><span class="hljs-variable">OH_Drawing_Rect</span> *<span class="hljs-variable">dst</span> = <span class="hljs-title function_">OH_Drawing_RectCreate</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">800</span>, <span class="hljs-number">600</span>);</li><li><span class="hljs-comment">// 采样选项对象</span></li><li><span class="hljs-variable">OH_Drawing_SamplingOptions</span>* <span class="hljs-variable">samplingOptions</span> = <span class="hljs-title function_">OH_Drawing_SamplingOptionsCreate</span>(</li><li>    <span class="hljs-variable">OH_Drawing_FilterMode</span>::<span class="hljs-title class_">FILTER_MODE_LINEAR</span>, <span class="hljs-variable">OH_Drawing_MipmapMode</span>::<span class="hljs-title class_">MIPMAP_MODE_LINEAR</span>);</li><li><span class="hljs-comment">// 绘制PixelMap</span></li><li><span class="hljs-title function_">OH_Drawing_CanvasDrawPixelMapRect</span>(<span class="hljs-variable">canvas</span>, <span class="hljs-variable">pixelMap</span>, <span class="hljs-variable">src</span>, <span class="hljs-variable">dst</span>, <span class="hljs-variable">samplingOptions</span>);</li></ol></pre></div></div></li>     <li>      <p>绘制完成后释放相关对象。</p>      <div _ngcontent-gbx-c106="" class="highlight-div"><div _ngcontent-gbx-c106="" class="highlight-div-header"><div _ngcontent-gbx-c106="" class="highlight-div-header-left"><div _ngcontent-gbx-c106="" class="handle-button expand-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gbx-c106="" class="highlight-div-header-right"><div _ngcontent-gbx-c106="" class="handle-button ai-button"></div><div _ngcontent-gbx-c106="" class="handle-button line-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gbx-c106="" class="handle-button theme-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gbx-c106="" class="handle-button copy-button"><div _ngcontent-gbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gbx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_PixelmapNative_Release</span>(pixelMapNative);</li><li>delete<span class="hljs-selector-attr">[]</span> pixels;</li></ol></pre></div></div>      <p>绘制效果如下：</p>      <p><span><img originheight="671" originwidth="1010" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114411.52166755551098130286287642500623:50001231000000:2800:1EA64F3F9575E1643989D53F2C99E28D1837C7776C304914B9AD4338CDEBA4B5.jpg" width="920" height="611.2079207920792"></span></p></li>    </ol>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/DocsSample_Graphics/tree/master/ArkGraphics2D/Drawing/NDKAPIDrawing" target="_blank">图形绘制（C/C++）</a></li>     </ul>    </div>   </div>   <div></div></div>