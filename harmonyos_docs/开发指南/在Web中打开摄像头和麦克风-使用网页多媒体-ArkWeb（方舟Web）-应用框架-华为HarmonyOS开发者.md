<h1 _ngcontent-lak-c119="" class="doc-title ng-star-inserted" title="在Web中打开摄像头和麦克风"> 在Web中打开摄像头和麦克风 </h1>

<div _ngcontent-lak-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>WebRTC（Web Real-Time Communications）是一项实时通讯技术，它允许网络应用或站点在无需中间媒介的情况下建立浏览器之间的点对点（Peer-to-Peer）连接，实现视频流、音频流或其他任意数据的传输。WebRTC所包含的标准使得用户无需安装任何插件或第三方软件即可创建点对点（Peer-to-Peer）的数据共享与电话会议。WebRTC技术适用于所有现代浏览器和主要平台的本机客户端，其背后的技术作为开放的Web标准实现，并在所有主要浏览器中作为常规JavaScript API提供。</p>    <p>Web组件可以通过W3C标准协议接口拉起摄像头和麦克风，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onpermissionrequest9" target="_blank">onPermissionRequest</a>接口接收权限请求通知，需在配置文件中声明相应的音频权限。</p>    <ul>     <li>      <p>使用摄像头和麦克风功能前请在module.json5中添加音频相关权限，权限的添加方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#在配置文件中声明权限">在配置文件中声明权限</a>。</p>      <div _ngcontent-lak-c106="" class="highlight-div"><div _ngcontent-lak-c106="" class="highlight-div-header"><div _ngcontent-lak-c106="" class="highlight-div-header-left"><div _ngcontent-lak-c106="" class="handle-button expand-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lak-c106="" class="highlight-div-header-right"><div _ngcontent-lak-c106="" class="handle-button ai-button"></div><div _ngcontent-lak-c106="" class="handle-button line-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lak-c106="" class="handle-button theme-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lak-c106="" class="handle-button copy-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lak-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-comment">// src/main/resources/base/element/string.json</span></li><li> <span class="hljs-punctuation">{</span></li><li>   <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reason_for_camera"</span><span class="hljs-punctuation">,</span></li><li>   <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reason_for_camera"</span></li><li> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li> <span class="hljs-punctuation">{</span></li><li>   <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reason_for_microphone"</span><span class="hljs-punctuation">,</span></li><li>   <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"reason_for_microphone"</span></li><li> <span class="hljs-punctuation">}</span></li></ol></pre></div></div>      <div _ngcontent-lak-c106="" class="highlight-div"><div _ngcontent-lak-c106="" class="highlight-div-header"><div _ngcontent-lak-c106="" class="highlight-div-header-left"><div _ngcontent-lak-c106="" class="handle-button expand-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lak-c106="" class="highlight-div-header-right"><div _ngcontent-lak-c106="" class="handle-button ai-button"></div><div _ngcontent-lak-c106="" class="handle-button line-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lak-c106="" class="handle-button theme-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lak-c106="" class="handle-button copy-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lak-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-comment">// src/main/module.json5</span></li><li>  <span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.CAMERA"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:reason_for_camera"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"EntryAbility"</span></li><li>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"inuse"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.MICROPHONE"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:reason_for_microphone"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"EntryAbility"</span></li><li>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"inuse"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li></ol></pre></div></div></li>    </ul>    <p>通过在JavaScript中调用W3C标准协议接口navigator.mediaDevices.getUserMedia()，该接口用于拉起摄像头和麦克风。constraints参数是一个包含了video和audio两个成员的MediaStreamConstraints对象，用于说明请求的媒体类型。</p>    <p>在下面的示例中，点击前端页面中的开启摄像头按钮再点击onConfirm，打开摄像头和麦克风。</p>    <ul>     <li>      <p>应用侧代码。</p>      <div _ngcontent-lak-c106="" class="highlight-div"><div _ngcontent-lak-c106="" class="highlight-div-header"><div _ngcontent-lak-c106="" class="highlight-div-header-left"><div _ngcontent-lak-c106="" class="handle-button expand-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lak-c106="" class="highlight-div-header-right"><div _ngcontent-lak-c106="" class="handle-button ai-button"></div><div _ngcontent-lak-c106="" class="handle-button line-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lak-c106="" class="handle-button theme-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lak-c106="" class="handle-button copy-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lak-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 配置Web开启调试模式</span></li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setWebDebuggingAccess</span>(<span class="hljs-literal">true</span>);</li><li>    <span class="hljs-comment">// 获取权限请求通知，点击onConfirm按钮后，拉起摄像头和麦克风。</span></li><li>    <span class="hljs-keyword">let</span> atManager = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>(), [<span class="hljs-string">'ohos.permission.CAMERA'</span>, <span class="hljs-string">'ohos.permission.MICROPHONE'</span>])</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'data:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'data permissions:'</span> + data.<span class="hljs-property">permissions</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'data authResults:'</span> + data.<span class="hljs-property">authResults</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onPermissionRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">showAlertDialog</span>({</li><li>              <span class="hljs-attr">title</span>: <span class="hljs-string">'title'</span>,</li><li>              <span class="hljs-attr">message</span>: <span class="hljs-string">'text'</span>,</li><li>              <span class="hljs-attr">primaryButton</span>: {</li><li>                <span class="hljs-attr">value</span>: <span class="hljs-string">'deny'</span>,</li><li>                <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                  event.<span class="hljs-property">request</span>.<span class="hljs-title function_">deny</span>();</li><li>                }</li><li>              },</li><li>              <span class="hljs-attr">secondaryButton</span>: {</li><li>                <span class="hljs-attr">value</span>: <span class="hljs-string">'onConfirm'</span>,</li><li>                <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                  event.<span class="hljs-property">request</span>.<span class="hljs-title function_">grant</span>(event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getAccessibleResource</span>());</li><li>                }</li><li>              },</li><li>              <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                event.<span class="hljs-property">request</span>.<span class="hljs-title function_">deny</span>();</li><li>              }</li><li>            })</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>前端页面index.html代码。</p>      <div _ngcontent-lak-c106="" class="highlight-div"><div _ngcontent-lak-c106="" class="highlight-div-header"><div _ngcontent-lak-c106="" class="highlight-div-header-left"><div _ngcontent-lak-c106="" class="handle-button expand-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lak-c106="" class="highlight-div-header-right"><div _ngcontent-lak-c106="" class="handle-button ai-button"></div><div _ngcontent-lak-c106="" class="handle-button line-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lak-c106="" class="handle-button theme-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lak-c106="" class="handle-button copy-button"><div _ngcontent-lak-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lak-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- index.html --&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"video"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500px"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"500px"</span> <span class="hljs-attr">autoplay</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500px"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"500px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"HTML5摄像头"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"开启摄像头"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"getMedia()"</span>/&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMedia</span>(<span class="hljs-params"></span>)</span></li><li><span class="language-javascript">  {</span></li><li><span class="language-javascript">    <span class="hljs-keyword">let</span> constraints = {</span></li><li><span class="language-javascript">      <span class="hljs-attr">video</span>: {<span class="hljs-attr">width</span>: <span class="hljs-number">500</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">500</span>},</span></li><li><span class="language-javascript">      <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span></span></li><li><span class="language-javascript">    };</span></li><li><span class="language-javascript">    <span class="hljs-comment">// 获取video摄像头区域</span></span></li><li><span class="language-javascript">    <span class="hljs-keyword">let</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"video"</span>);</span></li><li><span class="language-javascript">    <span class="hljs-comment">// 返回的Promise对象</span></span></li><li><span class="language-javascript">    <span class="hljs-keyword">let</span> promise = navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(constraints);</span></li><li><span class="language-javascript">    <span class="hljs-comment">// then()异步，调用MediaStream对象作为参数</span></span></li><li><span class="language-javascript">    promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">MediaStream</span>) {</span></li><li><span class="language-javascript">      video.<span class="hljs-property">srcObject</span> = <span class="hljs-title class_">MediaStream</span>;</span></li><li><span class="language-javascript">      video.<span class="hljs-title function_">play</span>();</span></li><li><span class="language-javascript">    }).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) {</span></li><li><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(err.<span class="hljs-property">name</span> + <span class="hljs-string">": "</span> + err.<span class="hljs-property">message</span>);</span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript">  }</span></li><li><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>    </ul>   </div>   <div></div></div>