<h1 _ngcontent-dyb-c119="" class="doc-title ng-star-inserted" title="在build-profile.json5中配置arkOptions"> 在build-profile.json5中配置arkOptions </h1>

<div _ngcontent-dyb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>arkOptions主要提供ArkTS编译相关配置，当前文档介绍arkOptions中types配置类型、maxFlowDepth配置控制流分析最大栈深度等，arkOptions中的其他配置项请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-configuration-file-overview" target="_blank">build-profile.json5</a>。</p> </div>  <div class="tiledSection"><h2 id="types">types<i class="anchor-icon anchor-icon-link" anchorid="types" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="types配置文件标签说明" class="firsth2">types配置文件标签说明<i class="anchor-icon anchor-icon-link" anchorid="types配置文件标签说明" tips="复制节点链接"></i></h3><p> arkOptions的types字段配置文件标签说明：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.6.1.1" valign="top" width="20%">属性名称</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.6.1.2" valign="top" width="20%">含义</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.6.1.3" valign="top" width="20%">配置范围</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.6.1.4" valign="top" width="20%">数据类型</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.6.1.5" valign="top" width="20%">是否可缺省</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20%">types</td> <td class="cellrowborder" valign="top" width="20%">通过types字段将指定的类型声明文件作为全局引入，从而避免在每个源码文件中单独引入。</td> <td class="cellrowborder" valign="top" width="20%">模块级</td> <td class="cellrowborder" valign="top" width="20%">数组</td> <td class="cellrowborder" valign="top" width="20%">该标签可缺省，缺省值为空。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="arkoptions中的types字段配置说明">arkOptions中的types字段配置说明<i class="anchor-icon anchor-icon-link" anchorid="arkoptions中的types字段配置说明" tips="复制节点链接"></i></h3><p>arkOptions中types字段示例：</p> <p>在模块build-profile.json5配置文件buildOption标签的arkOptions属性中添加types字段。</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在/entry/build-profile.json5</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"arkOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"chai"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"./oh_modules/@types/mocha"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"./src/main/ets/pages/global"</span><span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p>types字段支持填写包名、包所在位置的相对路径以及声明文件所在相对路径，仅支持当前模块内的查找，若目录下存在同名文件（后缀不同），默认加载顺序.d.ets &gt; .d.ts。</p> <p>（1）填写包名方式：通过包名到oh_modules/@types/目录查找包名中定义的声明文件，如"chai"。</p> <p>（2）填写包所在相对路径方式：支持在基于build-profile.json5的相对路径中查找定义的声明文件，如"./oh_modules/@types/mocha"。</p> <p>（3）填写声明文件所在相对路径方式：支持查找相对路径下的声明文件，如"./src/main/ets/pages/global"。</p> </div>  <div class="tiledSection"><h3 id="注意事项">注意事项<i class="anchor-icon anchor-icon-link" anchorid="注意事项" tips="复制节点链接"></i></h3><p>如果在types字段中填写包名或者包所在位置的相对路径，需要在工程文件/entry/oh-package.json5中dependencies作如下配置：</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"@types/chai"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"latest"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"@types/mocha"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"latest"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p>如果在types字段中填写声明文件所在相对路径，前提是在模块下存在相应的声明文件，比如模块下存在src/main/ets/pages/global.d.ts声明文件，声明文件内容如下所示：</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Global</span> {</li><li>  <span class="hljs-keyword">type</span> <span class="hljs-title class_">ObjectType</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;</li><li>}</li></ol></pre></div></div> <p>通过types全局引入后，对全局类型的使用示例如下：</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在entry/src/main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: <span class="hljs-title class_">Chai</span>.<span class="hljs-property">Message</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: <span class="hljs-title class_">Mocha</span>.<span class="hljs-property">HookFunction</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>: <span class="hljs-title class_">Global</span>.<span class="hljs-property">ObjectType</span>;</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="maxflowdepth">maxFlowDepth<i class="anchor-icon anchor-icon-link" anchorid="maxflowdepth" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="maxflowdepth配置文件标签说明" class="firsth2">maxFlowDepth配置文件标签说明<i class="anchor-icon anchor-icon-link" anchorid="maxflowdepth配置文件标签说明" tips="复制节点链接"></i></h3><p> arkOptions下tscConfig中maxFlowDepth字段配置文件标签说明：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.1" valign="top" width="20%">属性名称</th> <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.2" valign="top" width="20%">含义</th> <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.3" valign="top" width="20%">配置范围</th> <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.4" valign="top" width="20%">数据类型</th> <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.5" valign="top" width="20%">是否可缺省</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20%">maxFlowDepth</td> <td class="cellrowborder" valign="top" width="20%">开发者通过maxFlowDepth字段自定义配置tsc编译过程中的tsc控制流分析最大栈，避免固定最大栈导致编译报栈问题。该配置项可配置的最小值为2000，可配置最大值为65535。</td> <td class="cellrowborder" valign="top" width="20%">工程级</td> <td class="cellrowborder" valign="top" width="20%">数字型</td> <td class="cellrowborder" valign="top" width="20%">该标签可缺省，缺省值时使用tsc控制流分析最大栈默认值2000。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="arkoptions下的tscconfig中maxflowdepth字段配置说明">arkOptions下的tscConfig中maxFlowDepth字段配置说明<i class="anchor-icon anchor-icon-link" anchorid="arkoptions下的tscconfig中maxflowdepth字段配置说明" tips="复制节点链接"></i></h3><p>arkOptions/tscConfig中maxFlowDepth字段展示。</p> <p>在工程级目录下的build-profile.json5配置文件buildOption标签的arkOptions/tscConfig属性中添加maxFlowDepth字段。</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在工程名/build-profile.json5文件中</span></li><li>{</li><li>  <span class="hljs-string">"arkOptions"</span>: {</li><li>    <span class="hljs-string">"tscConfig"</span>: {</li><li>      <span class="hljs-string">"maxFlowDepth"</span>: <span class="hljs-number">2222</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="注意事项-1">注意事项<i class="anchor-icon anchor-icon-link" anchorid="注意事项-1" tips="复制节点链接"></i></h3><ul><li><p>仅可在工程级目录下build-profile.json5文件中配置maxFlowDepth字段。</p>  </li><li><p>若开发者未对maxFlowDepth字段进行配置时，则该字段默认为2000；若开发者对maxFlowDepth字段配置的值超过可配置范围，则会出现编译构建相关报错。</p>  <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li> hvigor ERROR: Schema validate failed.</li><li>  Detail: Please check the following fields.</li><li>    {</li><li>       instancePath: 'app.products[0].buildOption.arkOptions.tscConfig.maxFlowDepth',</li><li>       keyword: 'maximum',</li><li>       params: { comparision: '&lt;=', limit: 65535 },</li><li>       message: 'must be &lt;= 65535',</li><li>       location: 'D:/工程名/build-profile.json5:行号:列号'</li><li>    }</li></ol></pre></div></div>  </li><li><p>如果代码中函数或者模块过长导致控制流分析深度大于或者等于该字段所配置/默认的值，则会终止控制流分析并且报错：The containing function or module body is too large for control flow analysis.</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="transformlib">transformLib<i class="anchor-icon anchor-icon-link" anchorid="transformlib" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="transformlib配置文件标签说明" class="firsth2">transformLib配置文件标签说明<i class="anchor-icon anchor-icon-link" anchorid="transformlib配置文件标签说明" tips="复制节点链接"></i></h3><p>arkOptions的transformLib字段配置文件标签说明：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.1" valign="top" width="20%">属性名称</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.2" valign="top" width="20%">含义</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.3" valign="top" width="20%">配置范围</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.4" valign="top" width="20%">数据类型</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.5" valign="top" width="20%">是否可缺省</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20%">transformLib</td> <td class="cellrowborder" valign="top" width="20%">字节码插桩插件配置，允许开发者在编译时对字节码进行插桩修改。仅支持Stage模型，格式为相对路径，指向实现插桩功能的动态库。不同系统要求的动态库文件类型如下，动态库文件内容需要在对应平台生成，不能拷贝修改后缀名混用。</td> <td class="cellrowborder" valign="top" width="20%">模块级</td> <td class="cellrowborder" valign="top" width="20%">字符串型</td> <td class="cellrowborder" valign="top" width="20%">该标签可缺省，缺省值时代表不使用该功能。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="arkoptions中的transformlib字段配置说明">arkOptions中的transformLib字段配置说明<i class="anchor-icon anchor-icon-link" anchorid="arkoptions中的transformlib字段配置说明" tips="复制节点链接"></i></h3><p>arkOptions中transformLib字段示例：</p> <p>在模块build-profile.json5配置文件buildOption标签的arkOptions属性中添加transformLib字段。</p> <div _ngcontent-dyb-c106="" class="highlight-div"><div _ngcontent-dyb-c106="" class="highlight-div-header"><div _ngcontent-dyb-c106="" class="highlight-div-header-left"><div _ngcontent-dyb-c106="" class="handle-button expand-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dyb-c106="" class="highlight-div-header-right"><div _ngcontent-dyb-c106="" class="handle-button ai-button"></div><div _ngcontent-dyb-c106="" class="handle-button line-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dyb-c106="" class="handle-button theme-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dyb-c106="" class="handle-button copy-button"><div _ngcontent-dyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dyb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在/entry/build-profile.json5</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"transformLib"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dll/example.dll"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p>修改方舟字节码能力可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/customize-bytecode-during-compilation">编译期自定义修改方舟字节码</a>。</p> </div>  <div class="tiledSection"><h3 id="注意事项-2">注意事项<i class="anchor-icon anchor-icon-link" anchorid="注意事项-2" tips="复制节点链接"></i></h3><ul><li>若开发者未对字段进行配置时，则默认不使用该功能。</li><li>HAP、HSP模块配置即生效，HAR模块仅字节码HAR配置生效，非字节码HAR配置不生效。</li><li>文件格式要求：Windows：.dll文件，Linux/Mac：.so文件。</li></ul> </div> </div> <div></div></div>