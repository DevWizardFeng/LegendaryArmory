<h1 _ngcontent-bty-c119="" class="doc-title ng-star-inserted" title="在端侧调用云函数"> 在端侧调用云函数 </h1>

<div _ngcontent-bty-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001950448098"><div class="tiledSection"><h2 id="section1574023511013">前提条件<i class="anchor-icon anchor-icon-link" anchorid="section1574023511013" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002179338328__p72201248191">请确保<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/agc-harmonyos-clouddev-deployfunc">云函数已正确开发并部署</a>。</p> </div> <div class="tiledSection"><h2 id="section254643452119">操作步骤<i class="anchor-icon anchor-icon-link" anchorid="section254643452119" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002179338328__ol777944192119"><li id="li278184415216">在代码文件中引入Cloud Foundation Kit。<div _ngcontent-bty-c106="" class="highlight-div"><div _ngcontent-bty-c106="" class="highlight-div-header"><div _ngcontent-bty-c106="" class="highlight-div-header-left"><div _ngcontent-bty-c106="" class="handle-button expand-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bty-c106="" class="highlight-div-header-right"><div _ngcontent-bty-c106="" class="handle-button ai-button"></div><div _ngcontent-bty-c106="" class="handle-button line-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bty-c106="" class="handle-button theme-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bty-c106="" class="handle-button copy-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bty-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002179338328__screen1317420107243" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudFunction } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div> </li><li id="li82949862313">调用您云侧部署的云函数。关于云函数接口的更详细信息，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudfunction" target="_blank">Cloud Foundation Kit API参考-云函数模块</a>。<div _ngcontent-bty-c106="" class="highlight-div"><div _ngcontent-bty-c106="" class="highlight-div-header"><div _ngcontent-bty-c106="" class="highlight-div-header-left"><div _ngcontent-bty-c106="" class="handle-button expand-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bty-c106="" class="highlight-div-header-right"><div _ngcontent-bty-c106="" class="handle-button ai-button"></div><div _ngcontent-bty-c106="" class="handle-button line-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bty-c106="" class="handle-button theme-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bty-c106="" class="handle-button copy-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bty-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002179338328__screen10198194743815" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//填入需要调用的云函数名称</span></li><li><span class="hljs-variable">cloudFunction</span>.<span class="hljs-title function_">call</span>({<span class="hljs-variable">name</span>: <span class="hljs-string">'xxxx'</span>})</li><li>.<span class="hljs-title function_">then</span>((<span class="hljs-variable">res</span>: <span class="hljs-title class_">cloudFunction</span>.<span class="hljs-title class_">FunctionResult</span>) =&gt; {  </li><li>  <span class="hljs-comment">// 处理调用返回</span></li><li>}).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>  <span class="hljs-comment">// 调用云函数异常时的处理逻辑</span></li><li>})</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002179338328__p117831925103117">例如，调用云侧函数“my-cloud-function”，以返回一个时间戳。</p> <div _ngcontent-bty-c106="" class="highlight-div"><div _ngcontent-bty-c106="" class="highlight-div-header"><div _ngcontent-bty-c106="" class="highlight-div-header-left"><div _ngcontent-bty-c106="" class="handle-button expand-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bty-c106="" class="highlight-div-header-right"><div _ngcontent-bty-c106="" class="handle-button ai-button"></div><div _ngcontent-bty-c106="" class="handle-button line-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bty-c106="" class="handle-button theme-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bty-c106="" class="handle-button copy-button"><div _ngcontent-bty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bty-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002179338328__screen130103863616" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">cloudFunction</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">result</span> {</li><li>  <span class="hljs-variable">intervalTime</span>: <span class="hljs-title class_">number</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">res</span> {</li><li>  <span class="hljs-variable">result</span>: <span class="hljs-title class_">result</span></li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CloudFunction</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">globalId</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Navigation</span>()</li><li>        .<span class="hljs-title function_">title</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.cloud_function_title'</span>))</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50vp'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">bottom</span>: <span class="hljs-number">10</span> })</li><li>        .<span class="hljs-title function_">titleMode</span>(<span class="hljs-variable">NavigationTitleMode</span>.<span class="hljs-variable">Mini</span>)</li><li>
</li><li>      <span class="hljs-title function_">Text</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.cloud_function_description'</span>))</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-variable">TextAlign</span>.<span class="hljs-variable">Center</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">20</span>, <span class="hljs-variable">bottom</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">fontSize</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.body_font_size'</span>))</li><li>      <span class="hljs-title function_">Button</span>({ <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Normal</span> }) {</li><li>        <span class="hljs-title function_">Text</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.cloud_function_button_text'</span>))</li><li>          .<span class="hljs-title function_">fontColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.white'</span>))</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">5</span>, <span class="hljs-variable">bottom</span>: <span class="hljs-number">5</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-string">'8vp'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'30vp'</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">10</span> })</li><li>      .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">callMyFunction</span>()</li><li>      })</li><li>
</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">globalId</span>).<span class="hljs-title function_">fontSize</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.body_font_size'</span>))</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">padding</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">20</span>, <span class="hljs-variable">bottom</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">backgroundColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.placeholder_background'</span>))</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">callMyFunction</span>() {</li><li>    <span class="hljs-variable">cloudFunction</span>.<span class="hljs-title function_">call</span>({ <span class="hljs-variable">name</span>: <span class="hljs-string">'my-cloud-function'</span> }).<span class="hljs-title function_">then</span>((<span class="hljs-variable">res</span>: <span class="hljs-title class_">cloudFunction</span>.<span class="hljs-title class_">FunctionResult</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">callback</span>  = <span class="hljs-variable">res</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">res</span>;</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(`<span class="hljs-variable">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">call</span> <span class="hljs-variable">the</span> <span class="hljs-variable">function</span>, <span class="hljs-variable">time</span>:${<span class="hljs-variable">callback</span>.<span class="hljs-variable">result</span>.<span class="hljs-variable">intervalTime</span>} `);</li><li>    }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">call</span> <span class="hljs-variable">the</span> <span class="hljs-variable">function</span>, <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>