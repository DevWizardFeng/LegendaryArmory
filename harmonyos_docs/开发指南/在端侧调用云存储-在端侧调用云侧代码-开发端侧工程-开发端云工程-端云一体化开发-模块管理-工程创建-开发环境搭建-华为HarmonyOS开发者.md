<h1 _ngcontent-wix-c119="" class="doc-title ng-star-inserted" title="在端侧调用云存储"> 在端侧调用云存储 </h1>

<div _ngcontent-wix-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001950448102"><div class="tiledSection"><h2 id="section857015522520">前提条件<i class="anchor-icon anchor-icon-link" anchorid="section857015522520" tips="复制节点链接"></i></h2><ul id="ZH-CN_TOPIC_0000002179498028__ul10603180265"><li id="li9603407613">请确保云存储服务已经开通。</li><li id="li126041701261">使用云存储功能，需要获取用户凭据。请确保您已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section9723191765120" target="_blank">配置AccessToken</a>。</li></ul> </div> <div class="tiledSection"><h2 id="section15460173012322">操作步骤<i class="anchor-icon anchor-icon-link" anchorid="section15460173012322" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002179498028__ol12403105619319"><li id="li5403145653114">在代码文件中引入Cloud Foundation Kit。<div _ngcontent-wix-c106="" class="highlight-div"><div _ngcontent-wix-c106="" class="highlight-div-header"><div _ngcontent-wix-c106="" class="highlight-div-header-left"><div _ngcontent-wix-c106="" class="handle-button expand-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wix-c106="" class="highlight-div-header-right"><div _ngcontent-wix-c106="" class="handle-button ai-button"></div><div _ngcontent-wix-c106="" class="handle-button line-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wix-c106="" class="handle-button theme-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wix-c106="" class="handle-button copy-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002179498028__screen555854818133" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudStorage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div> </li><li id="li17314172716917">初始化云存储实例。<div _ngcontent-wix-c106="" class="highlight-div"><div _ngcontent-wix-c106="" class="highlight-div-header"><div _ngcontent-wix-c106="" class="highlight-div-header-left"><div _ngcontent-wix-c106="" class="handle-button expand-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wix-c106="" class="highlight-div-header-right"><div _ngcontent-wix-c106="" class="handle-button ai-button"></div><div _ngcontent-wix-c106="" class="handle-button line-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wix-c106="" class="handle-button theme-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wix-c106="" class="handle-button copy-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002179498028__screen830920381399" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">bucket</span>: <span class="hljs-title class_">cloudStorage</span>.<span class="hljs-title class_">StorageBucket</span> = <span class="hljs-variable">cloudStorage</span>.<span class="hljs-title function_">bucket</span>();</li></ol></pre></div></div> </li><li id="li675011345445">调用云存储接口，如uploadFile接口。“src/main/ets/pages/CloudStorage.ets”代码片段节选如下，更完整的接口信息请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudstorage" target="_blank">Cloud Foundation Kit API参考-云存储模块</a>。<div _ngcontent-wix-c106="" class="highlight-div"><div _ngcontent-wix-c106="" class="highlight-div-header"><div _ngcontent-wix-c106="" class="highlight-div-header-left"><div _ngcontent-wix-c106="" class="handle-button expand-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wix-c106="" class="highlight-div-header-right"><div _ngcontent-wix-c106="" class="handle-button ai-button"></div><div _ngcontent-wix-c106="" class="handle-button line-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wix-c106="" class="handle-button theme-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wix-c106="" class="handle-button copy-button"><div _ngcontent-wix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wix-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002179498028__screen13424201171312" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>bucket.<span class="hljs-title function_">uploadFile</span>(<span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>), {</li><li>  <span class="hljs-attr">localPath</span>: cacheFilePath,</li><li>  <span class="hljs-attr">cloudPath</span>: cloudPath,</li><li>}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// add task event listener</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addEventListener</span>(task, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onUploadCompleted</span>(cloudPath, cacheFilePath));</li><li>  <span class="hljs-comment">// start task</span></li><li>  task.<span class="hljs-title function_">start</span>();</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">HILOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'uploadFile failed, error code: %{public}d, message: %{public}s'</span>,</li><li>    err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isUploading</span> = <span class="hljs-literal">false</span>;</li><li>});</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002179498028__p3301139144420"></p> </li></ol> </div> </div> <div></div></div>