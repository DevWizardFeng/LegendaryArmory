<h1 _ngcontent-obj-c119="" class="doc-title ng-star-inserted" title="在自绘编辑框中使用输入法开发指导 (C/C++)"> 在自绘编辑框中使用输入法开发指导 (C/C++) </h1>

<div _ngcontent-obj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>IME Kit支持开发者在自绘编辑框中使用输入法，与输入法应用交互，包括显示、隐藏输入法，接收来自输入法应用的文本编辑操作通知等，本文档介绍开发者如何使用C/C++完成此功能开发。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>详细接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod" target="_blank">InputMethod接口文档</a>。</p>    </div>    <div class="tiledSection">     <h2 id="添加动态链接库">添加动态链接库<i class="anchor-icon anchor-icon-link" anchorid="添加动态链接库" tips="复制节点链接"></i></h2>          <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libohinputmethod.so</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="引用头文件">引用头文件<i class="anchor-icon anchor-icon-link" anchorid="引用头文件" tips="复制节点链接"></i></h2>          <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;inputmethod/inputmethod_controller_capi.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="绑定输入法">绑定输入法<i class="anchor-icon anchor-icon-link" anchorid="绑定输入法" tips="复制节点链接"></i></h2>          <p>开发者需要在输入框获焦时，通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod-controller-capi-h#oh_inputmethodcontroller_attach" target="_blank">OH_InputMethodController_Attach</a>绑定输入法，绑定成功后用户可以通过输入法输入文字。</p>     <ol>      <li>       <p>创建InputMethod_TextEditorProxy实例，示例代码如下所示：</p>       <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建InputMethod_TextEditorProxy实例</span></li><li>InputMethod_TextEditorProxy *textEditorProxy = OH_TextEditorProxy_Create();</li></ol></pre></div></div></li>      <li>       <p>创建InputMethod_AttachOptions实例，设置绑定输入法时的选项。示例代码如下所示：</p>       <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建InputMethod_AttachOptions实例，选项showKeyboard用于指定此次绑定成功后是否显示键盘，此处以目标显示键盘为例</span></li><li><span class="hljs-type">bool</span> showKeyboard = <span class="hljs-literal">true</span>;</li><li>InputMethod_AttachOptions *options = OH_AttachOptions_Create(showKeyboard);</li></ol></pre></div></div></li>      <li>       <p>调用OH_InputMethodController_Attach发起绑定输入法服务，调用成功后，可以获取到用于和输入法交互的InputMethod_InputMethodProxy。示例代码如下所示：</p>       <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>InputMethod_InputMethodProxy *inputMethodProxy = nullptr;</li><li><span class="hljs-comment">// 发起绑定请求</span></li><li><span class="hljs-keyword">if</span> (OH_InputMethodController_Attach(textEditorProxy, options, &amp;inputMethodProxy) != InputMethod_ErrorCode::IME_ERR_OK) {</li><li>    OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Attach failed!"</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="显示隐藏面板功能">显示/隐藏面板功能<i class="anchor-icon anchor-icon-link" anchorid="显示隐藏面板功能" tips="复制节点链接"></i></h2>          <p>绑定成功后，可以使用获取到的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod-inputmethod-inputmethodproxy" target="_blank">InputMethod_InputMethodProxy</a>对象向输入法发送消息。示例代码如下所示：</p>     <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 显示键盘</span></li><li><span class="hljs-keyword">if</span> (OH_InputMethodProxy_ShowKeyboard(inputMethodProxy) != InputMethod_ErrorCode::IME_ERR_OK) {</li><li>    OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"ShowKeyboard failed!"</span>);</li><li>}</li><li><span class="hljs-comment">// 隐藏键盘</span></li><li><span class="hljs-keyword">if</span> (OH_InputMethodProxy_HideKeyboard(inputMethodProxy) != InputMethod_ErrorCode::IME_ERR_OK) {</li><li>    OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"HideKeyboard failed!"</span>);</li><li>}</li><li><span class="hljs-comment">// 通知输入框配置信息变化</span></li><li><span class="hljs-keyword">if</span> (OH_InputMethodProxy_NotifyConfigurationChange(inputMethodProxy, InputMethod_EnterKeyType::IME_ENTER_KEY_GO, InputMethod_TextInputType::IME_TEXT_INPUT_TYPE_TEXT) != InputMethod_ErrorCode::IME_ERR_OK) {</li><li>    OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"NotifyConfigurationChange failed!"</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听输入法应用的请求通知">监听输入法应用的请求/通知<i class="anchor-icon anchor-icon-link" anchorid="监听输入法应用的请求通知" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>需要先实现对输入法应用发送的请求或通知的响应处理函数，示例代码如下所示：</p>       <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 实现InputMethod_TextEditorProxy中的输入法应用事件响应函数</span></li><li><span class="hljs-type">void</span> <span class="hljs-title function_">GetTextConfig</span><span class="hljs-params">(InputMethod_TextEditorProxy *textEditorProxy, InputMethod_TextConfig *config)</span></li><li>{</li><li>    <span class="hljs-comment">// 处理输入法发送的获取输入框配置请求</span></li><li>}</li><li><span class="hljs-type">void</span> <span class="hljs-title function_">InsertText</span><span class="hljs-params">(InputMethod_TextEditorProxy *textEditorProxy, <span class="hljs-type">const</span> <span class="hljs-type">char16_t</span> *text, <span class="hljs-type">size_t</span> length)</span></li><li>{</li><li>    <span class="hljs-comment">// 处理输入法发送的插入文本请求</span></li><li>}</li><li><span class="hljs-type">void</span> <span class="hljs-title function_">DeleteForward</span><span class="hljs-params">(InputMethod_TextEditorProxy *textEditorProxy, <span class="hljs-type">int32_t</span> length)</span></li><li>{</li><li>    <span class="hljs-comment">// 处理输入法发送的删除文本请求</span></li><li>}</li><li><span class="hljs-comment">// ......</span></li></ol></pre></div></div></li>      <li>       <p>将实现后的响应函数，设置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod-inputmethod-texteditorproxy" target="_blank">InputMethod_TextEditorProxy</a>中，再通过绑定输入法时调用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod-controller-capi-h#oh_inputmethodcontroller_attach" target="_blank">OH_InputMethodController_Attach</a>将其设置到输入法框架中，完成监听注册。示例代码如下所示：</p>       <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 将实现好的响应处理函数设置到InputMethod_TextEditorProxy中</span></li><li>OH_TextEditorProxy_SetGetTextConfigFunc(textEditorProxy, GetTextConfig);</li><li>OH_TextEditorProxy_SetInsertTextFunc(textEditorProxy, InsertText);</li><li>OH_TextEditorProxy_SetDeleteForwardFunc(textEditorProxy, DeleteForward);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="解绑输入法">解绑输入法<i class="anchor-icon anchor-icon-link" anchorid="解绑输入法" tips="复制节点链接"></i></h2>          <p>当编辑框失焦，需要结束使用输入法，通过接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-inputmethod-controller-capi-h#oh_inputmethodcontroller_detach" target="_blank">OH_InputMethodController_Detach</a>与输入法框架解绑。</p>     <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 发起解绑请求</span></li><li><span class="hljs-keyword">if</span> (OH_InputMethodController_Detach(inputMethodProxy) != InputMethod_ErrorCode::IME_ERR_OK) {</li><li>    OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Detach failed!"</span>);</li><li>}</li><li>inputMethodProxy = nullptr;</li><li>OH_TextEditorProxy_Destroy(textEditorProxy);</li><li>textEditorProxy = nullptr;</li><li>OH_AttachOptions_Destroy(options);</li><li>options = nullptr;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <p>示例代码展示了绑定输入法、隐藏输入法、解绑输入法的完整流程。</p>     <p>示例代码总入口为InputMethodNdkDemo函数。</p>     <p>说明：</p>     <p>需要在CMakeList.txt中添加libohinputmethod.so libhilog_ndk.z.so依赖。</p>     <div _ngcontent-obj-c106="" class="highlight-div"><div _ngcontent-obj-c106="" class="highlight-div-header"><div _ngcontent-obj-c106="" class="highlight-div-header-left"><div _ngcontent-obj-c106="" class="handle-button expand-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-obj-c106="" class="highlight-div-header-right"><div _ngcontent-obj-c106="" class="handle-button ai-button"></div><div _ngcontent-obj-c106="" class="handle-button line-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-obj-c106="" class="handle-button theme-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-obj-c106="" class="handle-button copy-button"><div _ngcontent-obj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-obj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;codecvt&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;locale&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"inputmethod/inputmethod_controller_capi.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">GetTextConfigFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_TextConfig *config)</span> </span>{ <span class="hljs-comment">// 处理获取输入框配置请求</span></li><li>    <span class="hljs-keyword">auto</span> ret = <span class="hljs-built_in">OH_TextConfig_SetEnterKeyType</span>(config, InputMethod_EnterKeyType::IME_ENTER_KEY_SEND);</li><li>    <span class="hljs-keyword">if</span> (ret != IME_ERR_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"SetEnterKeyType failed, ret=%{public}d"</span>, ret);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    ret = <span class="hljs-built_in">OH_TextConfig_SetInputType</span>(config, InputMethod_TextInputType::IME_TEXT_INPUT_TYPE_PHONE);</li><li>    <span class="hljs-keyword">if</span> (ret != IME_ERR_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"SetInputType failed, ret=%{public}d"</span>, ret);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InsertTextFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">const</span> <span class="hljs-type">char16_t</span> *text, <span class="hljs-type">size_t</span> length)</span> </span>{</li><li>    <span class="hljs-comment">// 处理插入文本请求</span></li><li>    <span class="hljs-comment">// 将char16_t类型的字符串转换为u16string</span></li><li>    <span class="hljs-function">std::u16string <span class="hljs-title">u16Str</span><span class="hljs-params">(text)</span></span>;</li><li>
</li><li>    <span class="hljs-comment">// 转换为UTF-8编码的string</span></li><li>    std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="hljs-type">char16_t</span>&gt;, <span class="hljs-type">char16_t</span>&gt; converter;</li><li>    std::string utf8Str = converter.<span class="hljs-built_in">to_bytes</span>(u16Str);</li><li>
</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"insertText=%{public}s"</span>, utf8Str.<span class="hljs-built_in">c_str</span>());</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DeleteForwardFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">int32_t</span> length)</span> </span>{</li><li>    <span class="hljs-comment">// 处理删除光标右侧文本请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DeleteBackwardFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">int32_t</span> length)</span> </span>{</li><li>    <span class="hljs-comment">// 处理删除光标左侧文本请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SendKeyboardStatusFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_KeyboardStatus status)</span> </span>{</li><li>    <span class="hljs-comment">// 处理键盘状态发生变化请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SendEnterKeyFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_EnterKeyType type)</span> </span>{</li><li>    <span class="hljs-comment">// 处理回车键功能发生变化请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MoveCursorFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_Direction direction)</span> </span>{</li><li>    <span class="hljs-comment">// 处理移动光标请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HandleSetSelectionFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">int32_t</span> start, <span class="hljs-type">int32_t</span> end)</span> </span>{</li><li>    <span class="hljs-comment">// 处理选中文本请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HandleExtendActionFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_ExtendAction action)</span> </span>{</li><li>    <span class="hljs-comment">// 处理扩展编辑请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">GetleftTextOfCursorFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">int32_t</span> number, <span class="hljs-type">char16_t</span> text[], <span class="hljs-type">size_t</span> *length)</span> </span>{</li><li>    <span class="hljs-comment">// 处理获取光标左侧文本请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">GetRightTextOfCursorFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">int32_t</span> number, <span class="hljs-type">char16_t</span> text[], <span class="hljs-type">size_t</span> *length)</span> </span>{</li><li>    <span class="hljs-comment">// 处理获取光标右侧文本请求</span></li><li>}</li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">GetTextIndexAtCursorFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy)</span> </span>{</li><li><span class="hljs-comment">// 处理获取光标所在输入框文本索引请求</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">ReceivePrivateCommandFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, InputMethod_PrivateCommand *privateCommand[],</span></span></li><li><span class="hljs-function">                                  <span class="hljs-type">size_t</span> size)</span> {</li><li>    <span class="hljs-comment">// 处理私有数据命令请求</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">SetPreviewTextFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy, <span class="hljs-type">const</span> <span class="hljs-type">char16_t</span> *text, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int32_t</span> start,</span></span></li><li><span class="hljs-function">                           <span class="hljs-type">int32_t</span> end)</span> {</li><li>    <span class="hljs-comment">// 处理设置预上屏文本请求</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">FinishTextPreviewFunc</span><span class="hljs-params">(InputMethod_TextEditorProxy *proxy)</span> </span>{</li><li>    <span class="hljs-comment">// 处理结束预上屏请求</span></li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ConstructTextEditorProxy</span><span class="hljs-params">(InputMethod_TextEditorProxy *textEditorProxy)</span> </span>{</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetGetTextConfigFunc</span>(textEditorProxy, GetTextConfigFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetInsertTextFunc</span>(textEditorProxy, InsertTextFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetDeleteForwardFunc</span>(textEditorProxy, DeleteForwardFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetDeleteBackwardFunc</span>(textEditorProxy, DeleteBackwardFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetSendKeyboardStatusFunc</span>(textEditorProxy, SendKeyboardStatusFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetSendEnterKeyFunc</span>(textEditorProxy, SendEnterKeyFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetMoveCursorFunc</span>(textEditorProxy, MoveCursorFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetHandleSetSelectionFunc</span>(textEditorProxy, HandleSetSelectionFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetHandleExtendActionFunc</span>(textEditorProxy, HandleExtendActionFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetGetLeftTextOfCursorFunc</span>(textEditorProxy, GetleftTextOfCursorFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetGetRightTextOfCursorFunc</span>(textEditorProxy, GetRightTextOfCursorFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetGetTextIndexAtCursorFunc</span>(textEditorProxy, GetTextIndexAtCursorFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetReceivePrivateCommandFunc</span>(textEditorProxy, ReceivePrivateCommandFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetSetPreviewTextFunc</span>(textEditorProxy, SetPreviewTextFunc);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_SetFinishTextPreviewFunc</span>(textEditorProxy, FinishTextPreviewFunc);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InputMethodNdkDemo</span><span class="hljs-params">()</span> </span>{</li><li>    <span class="hljs-comment">// 创建InputMethod_TextEditorProxy实例</span></li><li>    InputMethod_TextEditorProxy *textEditorProxy = <span class="hljs-built_in">OH_TextEditorProxy_Create</span>();</li><li>    <span class="hljs-keyword">if</span> (textEditorProxy == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Create TextEditorProxy failed."</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 将实现好的响应处理函数设置到InputMethod_TextEditorProxy中</span></li><li>    <span class="hljs-built_in">ConstructTextEditorProxy</span>(textEditorProxy);</li><li>
</li><li>    <span class="hljs-comment">// 创建InputMethod_AttachOptions实例，选项showKeyboard用于指定此次绑定成功后是否显示键盘，此处以目标显示键盘为例</span></li><li>    <span class="hljs-type">bool</span> showKeyboard = <span class="hljs-literal">true</span>;</li><li>    InputMethod_AttachOptions *attachOptions = <span class="hljs-built_in">OH_AttachOptions_Create</span>(showKeyboard);</li><li>    <span class="hljs-keyword">if</span> (attachOptions == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Create AttachOptions failed."</span>);</li><li>        <span class="hljs-built_in">OH_TextEditorProxy_Destroy</span>(textEditorProxy);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    InputMethod_InputMethodProxy *inputMethodProxy = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 发起绑定请求</span></li><li>    <span class="hljs-keyword">auto</span> ret = <span class="hljs-built_in">OH_InputMethodController_Attach</span>(textEditorProxy, attachOptions, &amp;inputMethodProxy);</li><li>    <span class="hljs-keyword">if</span> (ret != IME_ERR_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Attach failed, ret=%{public}d."</span>, ret);</li><li>        <span class="hljs-built_in">OH_TextEditorProxy_Destroy</span>(textEditorProxy);</li><li>        <span class="hljs-built_in">OH_AttachOptions_Destroy</span>(attachOptions);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 让键盘显示3s</span></li><li>    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(<span class="hljs-number">3</span>));</li><li>
</li><li>    <span class="hljs-comment">// 隐藏键盘</span></li><li>    ret = <span class="hljs-built_in">OH_InputMethodProxy_HideKeyboard</span>(inputMethodProxy);</li><li>    <span class="hljs-keyword">if</span> (ret != IME_ERR_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"HideKeyboard failed, ret=%{public}d."</span>, ret);</li><li>        <span class="hljs-built_in">OH_TextEditorProxy_Destroy</span>(textEditorProxy);</li><li>        <span class="hljs-built_in">OH_AttachOptions_Destroy</span>(attachOptions);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 发起解绑请求</span></li><li>    <span class="hljs-built_in">OH_InputMethodController_Detach</span>(inputMethodProxy);</li><li>    <span class="hljs-built_in">OH_TextEditorProxy_Destroy</span>(textEditorProxy);</li><li>    <span class="hljs-built_in">OH_AttachOptions_Destroy</span>(attachOptions);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"Finished."</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>