<h1 _ngcontent-ypo-c119="" class="doc-title ng-star-inserted" title="基于Link的装饰器方案"> 基于Link的装饰器方案 </h1>

<div _ngcontent-ypo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>开发者使用@InsightIntentLink装饰器进行基于Link的意图声明，可快速将已实现的Link跳转功能接入意图框架，以购买电影票意图为例，详细说明如下：</p> <ol><li>装饰器的添加位置：装饰器建议添加到处理该Link的Class上，如下所示。<div _ngcontent-ypo-c106="" class="highlight-div"><div _ngcontent-ypo-c106="" class="highlight-div-header"><div _ngcontent-ypo-c106="" class="highlight-div-header-left"><div _ngcontent-ypo-c106="" class="handle-button expand-button"><div _ngcontent-ypo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ypo-c106="" class="highlight-div-header-right"><div _ngcontent-ypo-c106="" class="handle-button ai-button"></div><div _ngcontent-ypo-c106="" class="handle-button line-button"><div _ngcontent-ypo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ypo-c106="" class="handle-button theme-button"><div _ngcontent-ypo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ypo-c106="" class="handle-button copy-button"><div _ngcontent-ypo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ypo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InsightIntentLink</span>, <span class="hljs-title class_">LinkParamCategory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@ohos.app.ability.InsightIntentDecorator"</span>;</li><li><span class="hljs-keyword">import</span> { url } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkTS"</span>;</li><li>
</li><li><span class="hljs-meta">@InsightIntentLink</span>({</li><li>  <span class="hljs-attr">intentName</span>: <span class="hljs-string">'PurchaseMovieTickets'</span>,</li><li>  <span class="hljs-attr">domain</span>: <span class="hljs-string">'PurchaseTickets'</span>,</li><li>  <span class="hljs-attr">intentVersion</span>: <span class="hljs-string">'1.0.1'</span>,</li><li>  <span class="hljs-attr">displayName</span>: <span class="hljs-string">'购买电影票'</span>,</li><li>  <span class="hljs-attr">llmDescription</span>: <span class="hljs-string">'用于在线购买电影票，允许用户选择指定影院、电影和场次时间进行购票。在用户明确表达购票需求，且已提供所有必要信息（cinema, film, time）时使用。如果信息不全或者用户只是查询电影信息、放映时间或票价，不应调用此工具。'</span>,</li><li>  <span class="hljs-attr">uri</span>: <span class="hljs-string">'decorator://ability.entry/main'</span>,</li><li>  <span class="hljs-attr">parameters</span>: {</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,</li><li>    <span class="hljs-string">"properties"</span>: {</li><li>      <span class="hljs-string">"cinema"</span>: {</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"目标影院名称，仅支持平台合作的影院"</span></li><li>      },</li><li>      <span class="hljs-string">"film"</span>: {</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"目标电影名称，需为当前上映或即将上映且在影院排片列表中的电影"</span></li><li>      },</li><li>      <span class="hljs-string">"time"</span>: {</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"放映时间，必须为未来的场次，且需为影院当天有效排片时间；时间格式应为'YYYY-MM-DD HH:MM'（例如'2025-07-01 19:30'）"</span></li><li>      }</li><li>    },</li><li>    <span class="hljs-string">"required"</span>: [<span class="hljs-string">"cinema"</span>, <span class="hljs-string">"film"</span>, <span class="hljs-string">"time"</span>]</li><li>  },</li><li>  <span class="hljs-attr">paramMappings</span>:[</li><li>    {</li><li>      <span class="hljs-attr">paramName</span>: <span class="hljs-string">'cinema'</span>,</li><li>      <span class="hljs-attr">paramMappingName</span>: <span class="hljs-string">'location'</span>,</li><li>      <span class="hljs-attr">paramCategory</span>: <span class="hljs-title class_">LinkParamCategory</span>.<span class="hljs-property">LINK</span></li><li>    },</li><li>    {</li><li>      <span class="hljs-attr">paramName</span>: <span class="hljs-string">'film'</span>,</li><li>      <span class="hljs-attr">paramMappingName</span>: <span class="hljs-string">'title'</span>,</li><li>      <span class="hljs-attr">paramCategory</span>: <span class="hljs-title class_">LinkParamCategory</span>.<span class="hljs-property">LINK</span></li><li>    },</li><li>    {</li><li>      <span class="hljs-attr">paramName</span>: <span class="hljs-string">'time'</span>,</li><li>      <span class="hljs-attr">paramMappingName</span>: <span class="hljs-string">'time'</span>,</li><li>      <span class="hljs-attr">paramCategory</span>: <span class="hljs-title class_">LinkParamCategory</span>.<span class="hljs-property">LINK</span></li><li>    }</li><li>  ]</li><li>})</li><li><strong><span class=""><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> </span></strong><span class=""><span class="hljs-title class_">PurchaseMovieTicketsLinkIntent</span> </span><span class="">{</span></li><li>   <strong><span class=""><span class="hljs-keyword">private</span> </span></strong><span class=""><span class="hljs-title function_">purchaseMovieTickets</span></span><span class="">(</span><span class=""><span class="hljs-attr">uri</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">)</span><span class="">: </span><span class=""><span class="hljs-built_in">void</span> </span><span class="">{</span></li><li>     <em><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">从want中获取传入的链接信息。</span></span></em></li><li><em><span class="">     <span class="hljs-comment">// 如传入的url为：decorator://ability.entry/main?location=XXX影城</span></span><span class=""><span class="hljs-comment">&amp;</span></span><span class=""><span class="hljs-comment">title=XXX</span></span><span class=""><span class="hljs-comment">&amp;</span></span><span class=""><span class="hljs-comment">time=2025.06.01</span></span></em></li><li><em>     </em><strong><span class=""><span class="hljs-keyword">let</span> </span></strong><span class="">urlObject </span><span class="">= </span><span class="">url</span><span class="">.</span><span class=""><span class="hljs-property">URL</span></span><span class="">.</span><span class=""><span class="hljs-title function_">parseURL</span></span><span class="">(</span><span class="">uri</span><span class="">)</span><span class="">;</span></li><li>     <strong style="color: rgb(181,106,1);"><span class="hljs-keyword">let</span> </strong><span class="">location </span><span class="">= </span><span class="">urlObject</span><span class="">.</span><span class=""><span class="hljs-property">params</span></span><span class="">.</span><span class=""><span class="hljs-title function_">get</span></span><span class="">(</span><span class=""><span class="hljs-string">'location'</span></span><span class="">)</span><span class="">;</span></li><li>     <strong style="color: rgb(181,106,1);"><span class="hljs-keyword">if</span> </strong><span class="">(</span><span class="">location </span><span class="">=== </span><span class=""><span class="hljs-string">"XXX</span></span><span class=""><span class="hljs-string">影城"</span></span><span class="">) </span><span class="">{</span></li><li>       <em><span class=""><span class="hljs-comment">// ...</span></span></em></li><li><em>     </em><span class="">}</span></li><li><span class="">   }</span></li><li><span class=""> }</span></li></ol></pre></div></div> </li><li>装饰器的字段说明以及示例：@InsightIntentLink字段以及具体说明如下。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.1" valign="top" width="15.07%"><p><strong>字段名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.2" valign="top" width="15.440000000000001%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.3" valign="top" width="10.17%"><p><strong>必选</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.4" valign="top" width="59.31999999999999%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15.07%"><p>intentName</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图名称，最大长度：64。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>domain</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图所属的功能垂域。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>intentVersion</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图的版本号，用于兼容性管理。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>displayName</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图的展示名称，用于界面显示，最大长度：64。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>llmDescription</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图的描述，详细描述该意图可实现的能力，便于大模型理解并调用，接入自定义意图时，该字段必选。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>uri</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>Link跳转uri。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>parameters</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>Record&lt;string, object &gt;</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图参数定义，描述参数类型以及含义。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>paramMappings</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p><a href="/consumer/cn/doc/harmonyos-guides/intents-skill-all-rec-decorator-link#table1558332918513">LinkIntentParamMapping[]</a></p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>Link的参数映射，定义了意图入参与uri拼接参数的映射关系，如果需要参数映射或者需要添加wantParams，需要使用该字段。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.07%"><p>result</p> </td> <td class="cellrowborder" valign="top" width="15.440000000000001%"><p>Record&lt;string, object &gt;</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>意图执行返回结果定义。</p> </td> </tr>  </tbody></table></div> </div> <p>LinkIntentParamMapping结构如下表：</p>  <div class="tablenoborder"><a name="ZH-CN_TOPIC_0000002402179741__table1558332918513"></a><a name="table1558332918513"></a><div class="tbBox"><table id="table1558332918513" class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.3.1.5.1.1" valign="top" width="13.25%"><p><strong>字段名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.1.5.1.2" valign="top" width="17.26%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.1.5.1.3" valign="top" width="10.17%"><p><strong>必选</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.1.5.1.4" valign="top" width="59.31999999999999%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="13.25%"><p>paramName</p> </td> <td class="cellrowborder" valign="top" width="17.26%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>映射后的意图参数名称。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.25%"><p>paramMappingName</p> </td> <td class="cellrowborder" valign="top" width="17.26%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>映射前的Link参数名称，意图调用时可将意图参数映射为Link参数，用于适配已有的Link调用。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.25%"><p>paramCategory</p> </td> <td class="cellrowborder" valign="top" width="17.26%"><p>LinkParamCategory</p> </td> <td class="cellrowborder" valign="top" width="10.17%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="59.31999999999999%"><p>Link参数类型枚举，默认作为域名参数，设置为“link”类型；如需要wantParams，则需要设置为“want”类型。</p> </td> </tr>  </tbody></table></div> </div> <p>为便于大模型理解和调用，相关参数定义需要遵照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-skill-all-rec-specification">自定义意图相关信息定义规范</a>。</p> </li><li>添加装饰器的方式：装饰器可以直接手动添加，同时也支持一键生成装饰器，建议使用后者，此方式需要安装相应插件，详细步骤如下：<ol><li>打开CodeGenie插件：在DevEco Studio右侧边栏点击CodeGenie或输入快捷键Alt/Option+U，可以进入DevEco CodeGenie。若使用非最新版本的DevEco Studio，可通过<a href="https://developer.huawei.com/consumer/cn/download/deveco-codegenie" target="_blank">下载中心</a>获取并使用相关功能，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-codegenie#section18337533718" target="_blank">插件获取及安装</a>。<p><span><img height="334.1625" originheight="989" originwidth="1549" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114257.00790626565389308807386532796921:50001231000000:2800:DEB75146F9317C1849F4C1C5CFA7E0EF838D44FF0869A13C9DFAA97D1AA409FF.png" title="点击放大" width="523.6875"></span></p> </li><li>框选想要接入意图框架功能的代码。<p><span><img height="334.1625" originheight="990" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.00601537445688910350283196963699:50001231000000:2800:B74FC28859568D38B608C9EFFC3F30435F9008769159817D5ABEB12996648F1C.png" title="点击放大" width="523.6875"></span></p> </li><li>在选中的代码块上右键CodeGenie &gt; Insight Intent &gt; 选择适合的装饰器。<p><span><img height="334.1625" originheight="990" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.40973073807229342912048350454699:50001231000000:2800:CEC56DBE12E54CACD532B15F9A6514B3803A7E469A449C4F73060B2E3B7080C3.png" title="点击放大" width="523.6875"></span></p> </li><li>在DevEco CodeGenie对话框中对意图定义、功能和参数等进行描述。<p><span><img height="334.1625" originheight="989" originwidth="1549" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.15767278463369344528164315568888:50001231000000:2800:0C270C0072FE17EB7F388CDB1F3F85EC36213F590F74B22A15B62C6F6EBE66F4.png" title="点击放大" width="523.6875"></span></p> </li><li>回车或者点击发送按钮，即可生成对应的装饰器内容。<p><span><img height="334.1625" originheight="989" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.90318528069764752211154372440397:50001231000000:2800:B9B8C05E3AC565E7EA6896137C528D0892D14C2DDFABF3CF3F48E051EEAA0774.png" title="点击放大" width="523.6875"></span></p> </li><li>将光标放置于要插入装饰器的位置，点击插入图标，即可在对应位置插入装饰器。</li></ol> <p>插入前：</p> <p><span><img height="334.1625" originheight="991" originwidth="1549" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.86056483365496719326054248180395:50001231000000:2800:B4A0D6930A9B45EDD700B36B5CF4010044DD1D07E0D4C4B6B11C97D6B1398904.png" title="点击放大" width="523.6875"></span></p> <p>插入后：</p> <p><span><img height="334.1625" originheight="990" originwidth="1547" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114258.75516312058347740386288941141008:50001231000000:2800:83B421D8602DE1A6A7485C0A1A790AE68EE49A393C883A9B468DEBC664FDA191.png" title="点击放大" width="523.6875"></span></p> </li><li>装饰器的使用约束和说明：<ul><li>Link装饰器包含通过Link接入意图的所有配置，因此对装饰器所在Class、变量、成员没有要求，但是必须要在被依赖的ets文件中添加装饰器才可以被编译。</li><li>支持开发者设置wantParameter，执行Link时，会将该参数附带到want的parameter中。</li><li>装饰器方式仅支持参数名映射，不做参数加工，包括取值转换、合并等情况。</li></ul> </li></ol> </div> <div></div></div>