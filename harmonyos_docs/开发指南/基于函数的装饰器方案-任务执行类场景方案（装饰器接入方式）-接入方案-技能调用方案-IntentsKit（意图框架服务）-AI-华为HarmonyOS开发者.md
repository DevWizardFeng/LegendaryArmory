<h1 _ngcontent-qnv-c119="" class="doc-title ng-star-inserted" title="基于函数的装饰器方案"> 基于函数的装饰器方案 </h1>

<div _ngcontent-qnv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>开发者使用@InsightIntentFunction和@InsightIntentFunctionMethod装饰器进行基于函数的意图声明，可快速将已有的函数功能接入意图框架，以购买电影票的意图为例，详细说明如下：</p> <ol><li>装饰器添加位置：在目标执行函数上添加@InsightIntentFunctionMethod装饰器，以及在目标执行函数所属Class上添加@InsightIntentFunction进行意图声明，且仅支持在静态方法上使用。<div _ngcontent-qnv-c106="" class="highlight-div"><div _ngcontent-qnv-c106="" class="highlight-div-header"><div _ngcontent-qnv-c106="" class="highlight-div-header-left"><div _ngcontent-qnv-c106="" class="handle-button expand-button"><div _ngcontent-qnv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnv-c106="" class="highlight-div-header-right"><div _ngcontent-qnv-c106="" class="handle-button ai-button"></div><div _ngcontent-qnv-c106="" class="handle-button line-button"><div _ngcontent-qnv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnv-c106="" class="handle-button theme-button"><div _ngcontent-qnv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnv-c106="" class="handle-button copy-button"><div _ngcontent-qnv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InsightIntentFunction</span>, <span class="hljs-title class_">InsightIntentFunctionMethod</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@ohos.app.ability.InsightIntentDecorator"</span>;</li><li><span class="hljs-keyword">import</span> insightIntent <span class="hljs-keyword">from</span> <span class="hljs-string">"@ohos.app.ability.insightIntent"</span>;</li><li>
</li><li><span class="hljs-meta">@InsightIntentFunction</span>()</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PurchaseMovie</span> {</li><li>
</li><li>  <span class="hljs-meta">@InsightIntentFunctionMethod</span> ({</li><li>    <span class="hljs-attr">intentName</span>: <span class="hljs-string">'PurchaseMovieTickets'</span>,</li><li>    <span class="hljs-attr">domain</span>: <span class="hljs-string">'PurchaseTickets'</span>,</li><li>    <span class="hljs-attr">intentVersion</span>: <span class="hljs-string">'1.0.1'</span>,</li><li>    <span class="hljs-attr">displayName</span>: <span class="hljs-string">'购买电影票'</span>,</li><li>    <span class="hljs-attr">llmDescription</span>: <span class="hljs-string">'用于在线购买电影票，允许用户选择指定影院、电影和场次时间进行购票。在用户明确表达购票需求，且已提供所有必要信息（cinema, film, time）时使用。如果信息不全或者用户只是查询电影信息、放映时间或票价，不应调用此工具。'</span>,</li><li>    <span class="hljs-attr">parameters</span>: {</li><li>      <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,</li><li>      <span class="hljs-string">"properties"</span>: {</li><li>        <span class="hljs-string">"cinema"</span>: {</li><li>          <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>          <span class="hljs-string">"description"</span>: <span class="hljs-string">"目标影院名称，仅支持平台合作的影院"</span></li><li>        },</li><li>        <span class="hljs-string">"film"</span>: {</li><li>          <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>          <span class="hljs-string">"description"</span>: <span class="hljs-string">"目标电影名称，需为当前上映或即将上映且在影院排片列表中的电影"</span></li><li>        },</li><li>        <span class="hljs-string">"time"</span>: {</li><li>          <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>          <span class="hljs-string">"description"</span>: <span class="hljs-string">"放映时间，必须为未来的场次，且需为影院当天有效排片时间；时间格式应为'YYYY-MM-DD HH:MM'（例如'2025-07-01 19:30'）"</span></li><li>        }</li><li>      },</li><li>      <span class="hljs-string">"required"</span>: [<span class="hljs-string">"cinema"</span>, <span class="hljs-string">"film"</span>, <span class="hljs-string">"time"</span>]</li><li>    }</li><li>  })</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">executePurchaseMovieIntent</span>(<span class="hljs-attr">cinema</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">film</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">time</span>: <span class="hljs-built_in">string</span>): insightIntent.<span class="hljs-property">ExecuteResult</span> {</li><li>    <span class="hljs-keyword">return</span> {</li><li>      <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">//意图执行成功时code必须为0</span></li><li>      <span class="hljs-attr">result</span>: {</li><li>        <span class="hljs-attr">orderNumber</span>: <span class="hljs-string">"XXXXXX"</span>,</li><li>        <span class="hljs-attr">resultDesc</span>:<span class="hljs-string">`电影票<span class="hljs-subst">${film}</span>购买成功`</span></li><li>      }</li><li>    };</li><li>  }</li><li>}</li></ol></pre></div></div> <p>函数返回结果必须为insightIntent.ExecuteResult结构，且该结构result对象中需增加resultDesc字段对结果进行描述，模型依据此描述生成该意图执行结果的小艺回复话术。请参考上述示例代码。</p> </li><li>装饰器的字段说明以及示例：@InsightIntentFunction不涉及参数，@InsightIntentFunctionMethod字段以及具体说明如下。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.1" valign="top" width="13.270000000000001%"><p>字段名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.2" valign="top" width="21.45%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.3" valign="top" width="11.73%"><p>必选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.1.5.1.4" valign="top" width="53.55%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>intentName</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图名称，最大长度：64。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>domain</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图所属的功能垂域。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>intentVersion</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图的版本号，用于兼容性管理。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>displayName</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图的展示名称，用于界面显示，最大长度：64。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>llmDescription</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图的描述，详细描述该意图可实现的能力，便于大模型理解并调用。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>parameters</p> </td> <td class="cellrowborder" valign="top" width="21.45%"><p>Record&lt;string, object&gt;</p> </td> <td class="cellrowborder" valign="top" width="11.73%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="53.55%"><p>意图参数定义，描述参数类型以及含义。</p> </td> </tr>  </tbody></table></div> </div> <p>为便于大模型理解和调用，相关参数定义需要遵照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-skill-all-rec-specification">自定义意图相关信息定义规范</a>进行设定。</p> </li><li>装饰器的添加方式：装饰器可以直接手动添加，同时也支持一键生成装饰器，建议使用后者，此方式需要安装相应插件，详细步骤如下。<ol><li>打开CodeGenie插件：在DevEco Studio右侧边栏点击CodeGenie或输入快捷键Alt/Option+U，可以进入DevEco CodeGenie。若使用非最新版本的DevEco Studio，可通过<a href="https://developer.huawei.com/consumer/cn/download/deveco-codegenie" target="_blank">下载中心</a>获取并使用相关功能，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-codegenie#section18337533718" target="_blank">插件获取及安装</a>。<p><span><img height="334.1625" originheight="989" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114301.48592597880023362629276079350968:50001231000000:2800:6C5A912DD5EF8E6402574675A2592A59011818D8217C0D88A86D760AA1331104.png" title="点击放大" width="523.6875"></span></p> </li><li>框选想要接入意图框架功能的代码。<p><span><img height="334.1625" originheight="990" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114301.06168189841295195717877250968072:50001231000000:2800:E89D203E77CBF1FF28D1B20B4F02FA6B4918AA8362F61B1FA7A20714CCB70B67.png" title="点击放大" width="523.6875"></span></p> </li><li>在选中的代码块上右键CodeGenie &gt; Insight Intent &gt; 选择适合的装饰器。<p><span><img height="334.1625" originheight="988" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114301.29223568004496812063855701638452:50001231000000:2800:CF0AFC3249BC027E05835CACFC2BCDFF447CC46AAE9E912CCEB49FDBCE163035.png" title="点击放大" width="523.6875"></span></p> </li><li>在DevEco CodeGenie对话框中对意图定义，功能，参数等进行描述。<p><span><img height="331.17" originheight="1323" originwidth="2091" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114301.47633176290562050505730682161472:50001231000000:2800:23DE9DBE8FB4C8B4D7C7B861D8EDCC10CDF749C736E81E8AF15AD4213ABA0230.png" title="点击放大" width="523.6875"></span></p> </li><li>回车或者点击发送按钮，即可生成对应的装饰器内容。<p><span><img height="334.1625" originheight="1333" originwidth="2088" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114302.84631732474302403782223674713557:50001231000000:2800:29E8D58D876F20DD70B424A70A9958CFEEA6C2605FDF6FA3033BB2824E552BFF.png" title="点击放大" width="523.6875"></span></p> </li><li>将光标放置于要插入装饰器的位置，点击插入图标，即可在对应位置插入装饰器。</li></ol> <p>插入前：</p> <p><span><img height="333.165" originheight="1328" originwidth="2087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114302.78027375895474248951862379516727:50001231000000:2800:C22B5674F10BE1001FFA321498D97E68BFB964B3F97059A4D39106BE79A4837B.png" title="点击放大" width="523.6875"></span></p> <p>插入后：</p> <p><span><img height="333.165" originheight="1328" originwidth="2087" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114302.14246561992104184589097960860576:50001231000000:2800:40CCEF562A8A9AD724EB23A575A5444F5566F63FEE5427404ADA53EBD3B508AE.png" title="点击放大" width="523.6875"></span></p> <div class="p">装饰器的使用约束和说明：<ul><li>仅限无其他依赖，可以直接拉起调用的全局函数。</li><li>支持将函数参数作为意图参数进行声明，参数类型支持基本类型。</li><li>装饰器所在函数不应该参与混淆，否则无法调用。</li><li>仅支持在export的类上添加装饰器。</li></ul> </div> </li></ol> </div> <div></div></div>