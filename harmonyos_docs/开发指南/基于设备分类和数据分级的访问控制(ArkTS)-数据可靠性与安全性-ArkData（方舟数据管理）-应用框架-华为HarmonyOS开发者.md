<h1 _ngcontent-bnd-c119="" class="doc-title ng-star-inserted" title="基于设备分类和数据分级的访问控制 (ArkTS)"> 基于设备分类和数据分级的访问控制 (ArkTS) </h1>

<div _ngcontent-bnd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <p>分布式数据管理对数据实施分类分级保护，提供基于数据安全标签以及设备安全等级的访问控制机制。</p>     <p>数据安全标签和设备安全等级越高，加密措施和访问控制措施越严格，数据安全性越高。</p>    </div>    <div class="tiledSection">     <h3 id="数据安全标签" class="firsth2">数据安全标签<i class="anchor-icon anchor-icon-link" anchorid="数据安全标签" tips="复制节点链接"></i></h3>          <p>按照数据分类分级规范要求，可将数据分为S1、S2、S3、S4四个安全等级。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.5.1.1" valign="top" width="25%">风险等级</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.5.1.2" valign="top" width="25%">风险标准</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.5.1.3" valign="top" width="25%">定义</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.5.1.4" valign="top" width="25%">样例</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">严重</td>         <td class="cellrowborder" valign="top" width="25%">S4</td>         <td class="cellrowborder" valign="top" width="25%">业界法律法规定义的特殊数据类型，涉及个人的最私密领域的信息或一旦泄露、篡改、破坏、销毁可能会给个人或组织造成重大的不利影响的数据。</td>         <td class="cellrowborder" valign="top" width="25%">政治观点、宗教和哲学信仰、工会成员资格、基因数据、生物信息、健康和性生活状况，性取向等或设备认证鉴权、个人信用卡等财务信息等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">高</td>         <td class="cellrowborder" valign="top" width="25%">S3</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致严峻的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">个人实时精确定位信息、运动轨迹等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">中</td>         <td class="cellrowborder" valign="top" width="25%">S2</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致严重的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">个人的详细通信地址、姓名昵称等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">低</td>         <td class="cellrowborder" valign="top" width="25%">S1</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致有限的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">性别、国籍、用户申请记录等。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="设备安全等级">设备安全等级<i class="anchor-icon anchor-icon-link" anchorid="设备安全等级" tips="复制节点链接"></i></h3>          <p>根据设备安全能力，比如是否有TEE、是否有安全存储芯片等，将设备安全等级分为SL1、SL2、SL3、SL4、SL5五个等级。例如，手表通常为低安全的SL1设备，手机、平板通常为高安全的SL4设备。</p>     <p>在设备组网时可以通过hidumper -s 3511查看设备安全等级。</p>    </div>    <div class="tiledSection">     <h2 id="跨设备同步访问控制机制">跨设备同步访问控制机制<i class="anchor-icon anchor-icon-link" anchorid="跨设备同步访问控制机制" tips="复制节点链接"></i></h2>          <p>数据跨设备同步时，基于数据安全标签和设备安全等级进行访问控制。数据库的数据安全标签不高于对端设备的设备安全等级时，数据才能同步。具体访问控制矩阵如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">设备安全级别</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">可同步的数据安全标签</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">SL1</td>         <td class="cellrowborder" valign="top" width="50%">S1</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL2</td>         <td class="cellrowborder" valign="top" width="50%">S1~S2</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL3</td>         <td class="cellrowborder" valign="top" width="50%">S1~S3</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL4</td>         <td class="cellrowborder" valign="top" width="50%">S1~S4</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL5</td>         <td class="cellrowborder" valign="top" width="50%">S1~S4</td>        </tr>             </tbody></table></div>     </div>     <p>例如，手表通常为低安全的SL1设备。若创建数据安全标签为S1的数据库，则此数据库数据可以在这些设备间同步；若创建的数据库标签为S2-S4，则不能在这些设备间同步。</p>    </div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>分布式数据库的访问控制机制确保了数据存储和同步时的安全能力。在创建数据库时，应当基于数据分类分级规范合理地设置数据库的安全标签，确保数据库内容和数据标签的一致性。</p>    </div>    <div class="tiledSection">     <h2 id="使用键值型数据库实现数据分级">使用键值型数据库实现数据分级<i class="anchor-icon anchor-icon-link" anchorid="使用键值型数据库实现数据分级" tips="复制节点链接"></i></h2>          <p>键值型数据库，通过securityLevel参数设置数据库的安全等级，安全等级具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributedkvstore#securitylevel" target="_blank">SecurityLevel</a>枚举。此处以创建安全等级为S3的数据库为例。</p>     <p>具体接口及功能，可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributedkvstore" target="_blank">分布式键值数据库</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在单设备使用场景下，KV数据库支持修改securityLevel开库参数进行安全等级升级。数据库安全等级升级操作需要注意以下几点：</p>       <ul>        <li>该操作不支持需要进行跨设备同步的数据库，不同安全等级的数据库之间不能进行数据同步，需要跨设备同步的数据库如果要升级安全等级，建议重新创建更高安全等级的数据库。</li>        <li>该操作需在关闭当前数据库之后，通过修改securityLevel开库参数重新设置数据库的安全等级，再进行开库操作。</li>        <li>该操作只支持升级，不支持降级。例如支持S2-&gt;S3的升级，不支持S3-&gt;S2的降级。</li>       </ul>      </div></div></div>     <div _ngcontent-bnd-c106="" class="highlight-div"><div _ngcontent-bnd-c106="" class="highlight-div-header"><div _ngcontent-bnd-c106="" class="highlight-div-header-left"><div _ngcontent-bnd-c106="" class="handle-button expand-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bnd-c106="" class="highlight-div-header-right"><div _ngcontent-bnd-c106="" class="handle-button ai-button"></div><div _ngcontent-bnd-c106="" class="handle-button line-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bnd-c106="" class="handle-button theme-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bnd-c106="" class="handle-button copy-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bnd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">ConfigurationConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { distributedKVStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">kvManager</span>: distributedKVStore.<span class="hljs-property">KVManager</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">kvStore</span>: distributedKVStore.<span class="hljs-property">SingleKVStore</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">kvManagerConfig</span>: distributedKVStore.<span class="hljs-property">KVManagerConfig</span> = {</li><li>      <span class="hljs-attr">context</span>: context,</li><li>      <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.datamanagertest'</span></li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      kvManager = distributedKVStore.<span class="hljs-title function_">createKVManager</span>(kvManagerConfig);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in creating KVManager.'</span>);</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: distributedKVStore.<span class="hljs-property">Options</span> = {</li><li>          <span class="hljs-attr">createIfMissing</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-attr">backup</span>: <span class="hljs-literal">false</span>,</li><li>          <span class="hljs-attr">autoSync</span>: <span class="hljs-literal">false</span>,</li><li>          <span class="hljs-attr">kvStoreType</span>: distributedKVStore.<span class="hljs-property">KVStoreType</span>.<span class="hljs-property">SINGLE_VERSION</span>,</li><li>          <span class="hljs-attr">securityLevel</span>: distributedKVStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span></li><li>        };</li><li>        kvManager.<span class="hljs-property">getKVStore</span>&lt;distributedKVStore.<span class="hljs-property">SingleKVStore</span>&gt;(<span class="hljs-string">'storeId'</span>, options, <span class="hljs-function">(<span class="hljs-params">err, store: distributedKVStore.SingleKVStore</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (err) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get KVStore. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting KVStore.'</span>);</li><li>          kvStore = store;</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (e) {</li><li>        <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create KVManager. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用关系型数据库实现数据分级">使用关系型数据库实现数据分级<i class="anchor-icon anchor-icon-link" anchorid="使用关系型数据库实现数据分级" tips="复制节点链接"></i></h2>          <p>关系型数据库，通过securityLevel参数设置数据库的安全等级，安全等级具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-e#securitylevel" target="_blank">SecurityLevel</a>枚举。此处以创建安全等级为S3的数据库为例。</p>     <p>具体接口及功能，可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore" target="_blank">关系型数据库</a>。</p>     <div _ngcontent-bnd-c106="" class="highlight-div"><div _ngcontent-bnd-c106="" class="highlight-div-header"><div _ngcontent-bnd-c106="" class="highlight-div-header-left"><div _ngcontent-bnd-c106="" class="handle-button expand-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bnd-c106="" class="highlight-div-header-right"><div _ngcontent-bnd-c106="" class="handle-button ai-button"></div><div _ngcontent-bnd-c106="" class="handle-button line-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bnd-c106="" class="handle-button theme-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bnd-c106="" class="handle-button copy-button"><div _ngcontent-bnd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bnd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onCreate</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">STORE_CONFIG</span>: relationalStore.<span class="hljs-property">StoreConfig</span> = {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">'RdbTest.db'</span>,</li><li>        <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span></li><li>      };</li><li>      store = <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting RdbStore.'</span>)</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get RdbStore. Code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>