<h1 _ngcontent-kdt-c119="" class="doc-title ng-star-inserted" title="基于设备分类和数据分级的访问控制 (C/C++)"> 基于设备分类和数据分级的访问控制 (C/C++) </h1>

<div _ngcontent-kdt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>分布式数据库的访问控制机制确保了数据存储和同步时的安全能力。在创建数据库时，应当基于数据分类分级规范合理地设置数据库的安全标签，确保数据库内容和数据标签的一致性。</p>     <p>当前仅支持使用关系型数据库（C/C++）进行分级访问控制。</p>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <p>分布式数据管理对数据实施分类分级保护，提供基于数据安全标签和设备安全等级的访问控制。</p>     <p>数据安全标签和设备安全等级越高，加密措施和访问控制措施越严格，数据安全性越高。</p>    </div>    <div class="tiledSection">     <h3 id="数据安全标签" class="firsth2">数据安全标签<i class="anchor-icon anchor-icon-link" anchorid="数据安全标签" tips="复制节点链接"></i></h3>          <p>按照数据分类分级规范要求，可将数据分为S1、S2、S3、S4四个安全等级，安全等级具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-relational-store-h#oh_rdb_securitylevel" target="_blank">OH_Rdb_SecurityLevel</a>枚举。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.1" valign="top" width="25%">风险等级</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.2" valign="top" width="25%">风险标准</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.3" valign="top" width="25%">定义</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.4" valign="top" width="25%">样例</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">严重</td>         <td class="cellrowborder" valign="top" width="25%">S4</td>         <td class="cellrowborder" valign="top" width="25%">业界法律法规定义的特殊数据类型，涉及个人的最私密领域的信息或一旦泄露、篡改、破坏、销毁可能会给个人或组织造成重大的不利影响的数据。</td>         <td class="cellrowborder" valign="top" width="25%">政治观点、宗教和哲学信仰、工会成员资格、基因数据、生物信息、健康和性生活状况，性取向等或设备认证鉴权、个人信用卡等财务信息等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">高</td>         <td class="cellrowborder" valign="top" width="25%">S3</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致严峻的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">个人实时精确定位信息、运动轨迹等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">中</td>         <td class="cellrowborder" valign="top" width="25%">S2</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致严重的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">个人的详细通信地址、姓名昵称等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">低</td>         <td class="cellrowborder" valign="top" width="25%">S1</td>         <td class="cellrowborder" valign="top" width="25%">数据的泄露、篡改、破坏、销毁可能会给个人或组织导致有限的不利影响。</td>         <td class="cellrowborder" valign="top" width="25%">性别、国籍、用户申请记录等。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="设备安全等级">设备安全等级<i class="anchor-icon anchor-icon-link" anchorid="设备安全等级" tips="复制节点链接"></i></h3>          <p>根据设备安全能力，比如是否有TEE、是否有安全存储芯片等，将设备安全等级分为SL1、SL2、SL3、SL4、SL5五个等级。例如，手表通常为低安全的SL1设备，手机、平板通常为高安全的SL4设备。</p>     <p>在设备组网时可以通过hidumper -s 3511查看设备安全等级。</p>    </div>    <div class="tiledSection">     <h2 id="跨设备同步访问控制机制">跨设备同步访问控制机制<i class="anchor-icon anchor-icon-link" anchorid="跨设备同步访问控制机制" tips="复制节点链接"></i></h2>          <p>数据跨设备同步时，基于数据安全标签和设备安全等级进行访问控制。数据库的数据安全标签不高于对端设备的设备安全等级时，数据才能同步。具体访问控制矩阵如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="50%">设备安全级别</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50%">可同步的数据安全标签</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">SL1</td>         <td class="cellrowborder" valign="top" width="50%">S1</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL2</td>         <td class="cellrowborder" valign="top" width="50%">S1~S2</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL3</td>         <td class="cellrowborder" valign="top" width="50%">S1~S3</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL4</td>         <td class="cellrowborder" valign="top" width="50%">S1~S4</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SL5</td>         <td class="cellrowborder" valign="top" width="50%">S1~S4</td>        </tr>             </tbody></table></div>     </div>     <p>例如，手表通常为低安全的SL1设备。若创建数据安全标签为S1的数据库，则此数据库数据可以在这些设备间同步；若创建的数据库标签为S2-S4，则不能在这些设备间同步。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>关系型数据库，通过OH_Rdb_SetSecurityLevel接口设置数据库的安全等级。此处以创建安全等级为S3的数据库为例。</p>     <ol>      <li>       <p>CMakeLists.txt中添加以下lib。</p>       <div _ngcontent-kdt-c106="" class="highlight-div"><div _ngcontent-kdt-c106="" class="highlight-div-header"><div _ngcontent-kdt-c106="" class="highlight-div-header-left"><div _ngcontent-kdt-c106="" class="handle-button expand-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kdt-c106="" class="highlight-div-header-right"><div _ngcontent-kdt-c106="" class="handle-button ai-button"></div><div _ngcontent-kdt-c106="" class="handle-button line-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kdt-c106="" class="handle-button theme-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kdt-c106="" class="handle-button copy-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kdt-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libnative_rdb_ndk.z.so</li></ol></pre></div></div></li>      <li>       <p>导入头文件。</p>       <div _ngcontent-kdt-c106="" class="highlight-div"><div _ngcontent-kdt-c106="" class="highlight-div-header"><div _ngcontent-kdt-c106="" class="highlight-div-header-left"><div _ngcontent-kdt-c106="" class="handle-button expand-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kdt-c106="" class="highlight-div-header-right"><div _ngcontent-kdt-c106="" class="handle-button ai-button"></div><div _ngcontent-kdt-c106="" class="handle-button line-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kdt-c106="" class="handle-button theme-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kdt-c106="" class="handle-button copy-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kdt-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"database/rdb/relational_store.h"</span></span></li></ol></pre></div></div></li>      <li>       <p>调用OH_Rdb_SetSecurityLevel接口设置数据库的安全等级。</p>       <div _ngcontent-kdt-c106="" class="highlight-div"><div _ngcontent-kdt-c106="" class="highlight-div-header"><div _ngcontent-kdt-c106="" class="highlight-div-header-left"><div _ngcontent-kdt-c106="" class="handle-button expand-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kdt-c106="" class="highlight-div-header-right"><div _ngcontent-kdt-c106="" class="handle-button ai-button"></div><div _ngcontent-kdt-c106="" class="handle-button line-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kdt-c106="" class="handle-button theme-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kdt-c106="" class="handle-button copy-button"><div _ngcontent-kdt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kdt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>OH_Rdb_ConfigV2 *config = <span class="hljs-title function_">OH_Rdb_CreateConfig</span>();</li><li><span class="hljs-title function_">OH_Rdb_SetDatabaseDir</span>(config, <span class="hljs-string">"/data/storage/el2/database"</span>);</li><li><span class="hljs-title function_">OH_Rdb_SetStoreName</span>(config, <span class="hljs-string">"RdbTest.db"</span>);</li><li><span class="hljs-title function_">OH_Rdb_SetBundleName</span>(config, <span class="hljs-string">"com.example.nativedemo"</span>);</li><li><span class="hljs-title function_">OH_Rdb_SetModuleName</span>(config, <span class="hljs-string">"entry"</span>);</li><li><span class="hljs-comment">// 数据库文件安全等级</span></li><li><span class="hljs-title function_">OH_Rdb_SetSecurityLevel</span>(config, <span class="hljs-attr">OH_Rdb_SecurityLevel</span>::<span class="hljs-variable constant_">S3</span>);</li><li><span class="hljs-title function_">OH_Rdb_SetEncrypted</span>(config, <span class="hljs-literal">false</span>);</li><li><span class="hljs-title function_">OH_Rdb_SetArea</span>(config, <span class="hljs-variable constant_">RDB_SECURITY_AREA_EL2</span>);</li><li>
</li><li>int errCode = <span class="hljs-number">0</span>;</li><li>OH_Rdb_Store *store_ = <span class="hljs-title function_">OH_Rdb_CreateOrOpen</span>(config, &amp;errCode);</li><li><span class="hljs-title function_">OH_Rdb_CloseStore</span>(store_);</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>