<h1 _ngcontent-pwh-c119="" class="doc-title ng-star-inserted" title="基础耗时分析：Time分析"> 基础耗时分析：Time分析 </h1>

<div _ngcontent-pwh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div id="body0000001532505669">    <div class="tiledSection">     <h2 id="section18227219152820">函数耗时分析及优化<i class="anchor-icon anchor-icon-link" anchorid="section18227219152820" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174539__p20645174818226">开发应用或元服务过程中，如果遇到卡顿、加载耗时等性能问题，开发者通常会关注相关函数执行的耗时情况。DevEco Profiler提供的Time场景分析任务，可在应用/元服务运行时，展示热点区域内基于CPU和进程耗时分析的调用栈情况，并提供跳转至相关代码的能力，使开发者更便捷地进行代码优化。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p10135134319105">在设备连接完成后，可按照如下方法查看耗时分析结果：</p>     <ol id="ZH-CN_TOPIC_0000002510174539__ol15179163175016">      <li id="li622118144168"><span>构建应用前请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile">模块级build-profile.json5文件</a>，增加strip字段并赋值为false（strip：是否移除当前模块.so文件中的符号表、调试信息，配置为false代表不移除）。采集函数栈解析符号需要附带符号表信息，无符号表信息可能采集不到函数名称，或ArkTS Callstack泳道无法关联到Native调用栈，因此请按照下图进行配置。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510174539__p130914534015"><span><img height="396.5129" originheight="470" originwidth="564" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.81786347019907894215431787718969:50001231000000:2800:A37B8F49F998CA3F0D82BEF820EB3C53CA954F86596181C9277E423DE722C4DC.png" title="点击放大" width="474.81"></span></p>       <p></p></li>      <li id="li131807311507"><span>创建Time任务并录制相关数据，操作方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording">性能问题定位：深度录制</a>。或在会话区选择<strong>Open File</strong>，导入历史数据。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510174539__p2018213716272"></p>       <p id="ZH-CN_TOPIC_0000002510174539__p103115328285">Time分析任务支持在录制前单击<span><img height="21.945" originheight="22" originwidth="23" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.64279249702344416518556931988760:50001231000000:2800:7C08AF7303017E95569FBC5702038045473C7BC6D9679F7C366EE98E3F219BE6.png" width="22.7297" class="IconPic notEnlarge"></span>指定要录制的泳道：</p>       <ul id="ZH-CN_TOPIC_0000002510174539__zh-cn_topic_0000001532505669_ul149718299401">        <li id="li18410201233111"><strong>User Trace</strong>：用户自定义打点泳道，基于时间轴展示当前时段内用户使用hiTraceMeter接口自定义的打点任务的具体运行情况。</li>        <li id="zh-cn_topic_0000001532505669_li1849752914403"><strong>ArkTS Callstack</strong>：方舟运行时函数调用泳道，基于时间轴展示CPU使用率和虚拟机的执行状态，以及当前调用栈名称和调用类型。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。         <p id="ZH-CN_TOPIC_0000002510174539__p7946109715">调用栈分类从语言层面分为ArkTS、NAPI以及Native，从归属层面分为开发者代码以及系统代码。从这两个方面可以将调用栈类型归类如下：</p>         <ul id="ZH-CN_TOPIC_0000002510174539__ul228117819579">          <li id="li23032695719">ArkTS：程序正在执行ArkTS代码；</li>          <li id="li1331315615577">NAPI：程序正在执行的NAPI代码；</li>          <li id="li153221061574">Native：程序正在执行的Native代码；           <p id="ZH-CN_TOPIC_0000002510174539__p762151643017">其中每一个类型的亮色和灰色分别代表开发者和系统的代码。</p></li>         </ul></li>        <li id="zh-cn_topic_0000001532505669_li1249742913401"><strong>Callstack</strong>：ArkTS和Native混合函数调用泳道。基于时间轴展示各线程的CPU使用率，以及在一段时间内的混合调用栈。调用栈类型会分为开发者或系统的ArkTS以及Native代码两类。由于隐私安全政策，已上架应用市场的应用不支持录制此泳道。         <p id="ZH-CN_TOPIC_0000002510174539__p6473134114316">Callstack基于采样模式采集数据，默认采样间隔是500微秒。耗时小于500微秒的函数，Details区域时间相关数据可能存在误差，可通过录制过程中多次触发该函数，根据其耗时百分比判断是否为热点函数。</p></li>       </ul>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul id="ZH-CN_TOPIC_0000002510174539__ul1349720124341">          <li id="li14497412123414">在任务分析窗口，可以通过“Ctrl+鼠标滚轮”缩放时间轴，通过“Shift+鼠标滚轮”左右移动时间轴。或使用快捷键W/S放大或缩小时间轴，使用A键/D键可以左右移动时间轴。</li>          <li id="li182232025112917">将鼠标悬停在泳道任意位置，可以通过M键添加单点时间标签。</li>          <li id="li1099292513324">鼠标框选要关注的时间段，可以通过“Shift+M”添加时间段时间标签。</li>          <li id="li540422233317">在任务分析窗口，可以通过“Ctrl+, ”向前选中单点时间标签，通过“Ctrl+. ”向后选中单点时间标签。</li>          <li id="li1360912834114">在任务分析窗口，可以通过“Ctrl+[ ”向前选中时间段时间标签，通过“Ctrl+]”向后选中时间段时间标签。</li>          <li id="li17497912103416">将鼠标置于ArkTS Callstack泳道和Callstack泳道任意位置，可查看到对应时间点的CPU使用率。</li>          <li id="li204971112143417">单击任意泳道名称后方的<span><img height="15.96" originheight="20" originwidth="21" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.63747660195164621296225670143274:50001231000000:2800:B7229788D34F3C30217348508A484157DB1C7386DB8AD34335AEB0754CD472E9.png" width="16.571800000000003" class="IconPic notEnlarge"></span>可将其置顶。</li>          <li id="li9869589299">Time分析支持Energy泳道，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-energy">能耗诊断：Energy分析</a>。</li>         </ul>        </div></div></div>       <p></p></li>      <li id="li79601195116"><span>在“ArkTS Callstack”泳道和“ArkTS Callstack”子泳道上长按鼠标左键并拖拽，框选要分析的时间段。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510174539__zh-cn_topic_0000001532505669_p15355151355012"><strong>Details</strong>区域会显示所选时间段内的函数栈耗时分布情况，<strong>Heaviest Stack</strong>区域会展示出“Details”区域选择节点所处的耗时最长的完整调用栈。</p>       <p id="ZH-CN_TOPIC_0000002510174539__zh-cn_topic_0000001532505669_p18625057813">其中函数栈耗时分布有三种展现方式：</p>       <ul id="ZH-CN_TOPIC_0000002510174539__zh-cn_topic_0000001532505669_ul153761722039">        <li id="zh-cn_topic_0000001532505669_li203761121930">默认为Call Tree方式，其中“Weight”字段表示当前函数的总执行时间，“Self”字段表示函数自身的执行时间，两者之差为当前函数所调用的子函数执行时间之和，“Average Duration”字段表示函数自身的平均执行时间，“Category”字段表示函数调用类型。</li>        <li id="zh-cn_topic_0000001532505669_li6893133941219">打开页面下方的<strong>Flame Chart</strong>开关，函数调用栈将以火焰图的形式展示。其中，横轴表示函数的执行时长，纵轴表示调用栈的深度。         <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">           <ul id="ZH-CN_TOPIC_0000002510174539__ul7559194119137">            <li id="li5166181712140">火焰图条块支持搜索，搜索结果不匹配的条块会被置灰。</li>            <li id="li182325426141">“Ctrl+鼠标滚轮”的操作，或单击该区域右上角的<span><img originheight="16" originwidth="18" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.42984653865707642616922780375497:50001231000000:2800:5F05A0BEFB21C5BEA341D36C199DB0421AD874D3982E85686829E9DFC3F099A5.png" class="IconPic notEnlarge" width="18" height="16"></span>、<span><img originheight="18" originwidth="18" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.85889275387524068314429102111034:50001231000000:2800:F97CC0CB3AD2D151E582892147FFB37A2D79BF0008E665168759E02A180F19E3.png" class="IconPic notEnlarge" width="18" height="18"></span>可放大和缩小火焰图的时间轴比例，单击<span><img originheight="18" originwidth="16" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104920.06297184119678845743211988152978:50001231000000:2800:58BA751C2E48075FF53FE6D9BC9C7486121B06B34153723F3F41EA805B39F2FB.png" class="IconPic notEnlarge" width="16" height="18"></span>可恢复时间轴比例为初始状态。</li>            <li id="li15606413139">“Shift+鼠标滚轮”的操作可左右横向调整可视区间，单独操作滚轮可上下纵向调整可视区间。</li>            <li id="li1014616561255">选中节点，单击该区域右上角的<span><img height="17.3698" originheight="24" originwidth="25" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.49485084036271740022192203148423:50001231000000:2800:791B581801274C9E1A7E088FFC2DAD7679404ADE146BF2B57D484EDD7BA61EAE.png" width="17.955000000000002" class="IconPic notEnlarge"></span>，点击添加面包屑。添加面包屑后，该节点成为根节点，耗时占比为100%，子节点的耗时占比相对于该节点重新计算。</li>            <li id="li117842912531">在火焰图中选中任一节点，使用“Alt+鼠标左键”可将该节点左置底并将其占比放大到100%，其上从属节点按同比例放大显示。</li>           </ul>          </div></div></div>         <p id="ZH-CN_TOPIC_0000002510174539__p73991921164617"><span><img height="313.28150000000005" originheight="597" originwidth="1553" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.13324747988703132309015260022978:50001231000000:2800:B9C4439DE4F1A7D773A2C7FE332568233AFF9BCE9284F3885AFDCD3F64BC87D2.png" title="点击放大" width="809.97"></span></p></li>        <li id="li1887351532118">在“ArkTS Callstack”子泳道或“Callstack”子泳道上点击<strong>Unfold CallStack</strong>按钮，可以在时间轴上将函数调用栈以冰锥图的形式展示。其中调用栈的先后顺序与实际调用时序保持一致。         <p id="ZH-CN_TOPIC_0000002510174539__p887361542113"><span><img height="257.9003" originheight="493" originwidth="1556" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.30695369585860704725038122594701:50001231000000:2800:32E594F90AAD77613E8022159952B0E32BA901ADA1E9820385112BE1A0BAA6D2.png" title="点击放大" width="807.3100000000001"></span></p></li>       </ul>       <p></p></li>      <li id="li1621210387200"><span>在<strong>Callstack</strong>泳道上长按鼠标左键并拖拽，框选要分析的时间段。</span>       <p></p>       <ul id="ZH-CN_TOPIC_0000002510174539__ul146992020152119">        <li id="li81666244215"><strong>Summary</strong>列表展示框选时段内，所有Native线程的CPU占用率的峰值、谷值、平均值。</li>        <li id="li4699020162116"><strong>Callstack</strong>列表展示框选时段内，所有Native线程的函数热点。</li>       </ul>       <p id="ZH-CN_TOPIC_0000002510174539__p84011021114619"><span><img height="182.70210000000003" originheight="335" originwidth="1543" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.66733771020768836327169346148505:50001231000000:2800:A0EAD47B766D71D4932BD43AFCCED24FE20F14CFB7A6F1E6F740945E70D22F7B.png" title="点击放大" width="829.9200000000001"></span></p>       <ul id="ZH-CN_TOPIC_0000002510174539__ul14255143202812">        <li id="li2255123172813">悬浮到节点，显示以此节点为根按钮，点击添加面包屑。添加面包屑后，该节点成为根节点，耗时占比为100%，子节点的耗时占比相对于该节点重新计算。</li>       </ul>       <p id="ZH-CN_TOPIC_0000002510174539__p2846155612317"><span><img height="408.0341736694678" originheight="677" originwidth="1534" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.17994777822202021608950258668163:50001231000000:2800:5725230BFBFF53CFD3D81594FD1FB9F92F36B777FD863000B7D76E0ACFBCB047.png" title="点击放大" width="920"></span></p>       <p></p></li>      <li id="li1528511810612"><span>在<strong>Callstack</strong>子泳道上长按鼠标左键并拖拽，框选要展示分析的时间段。</span>       <p></p>       <ul id="ZH-CN_TOPIC_0000002510174539__ul9204540872">        <li id="li1320515401679"><strong>Top Down</strong>页签显示所选时间段内的函数栈耗时分布情况，<strong>Heaviest Stack</strong>区域会展示出“Details”区域选择节点所处的耗时最长的完整调用栈。</li>        <li id="li1420584016713"><strong>Bottom UP</strong>页签显示函数列表，展开任一函数节点可查看其调用方及每个调用方的耗时。</li>       </ul>       <p id="ZH-CN_TOPIC_0000002510174539__p5834195402520"><span><img height="343.9912" originheight="911" originwidth="2151" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.23568417647824148396639015140808:50001231000000:2800:519105A27204372F02E5211B76DD4D35EEF7787430F1A3F0E11D675380EB1EFA.png" title="点击放大" width="807.3100000000001"></span></p>       <p></p></li>      <li id="li33515403112"><span>（可选）在<strong>Details</strong>中双击需要优化的节点（例如耗时超过预期），可快速跳转至对应工程源码，为开发者节省定位代码路径的时间。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul id="ZH-CN_TOPIC_0000002510174539__ul383318131581">          <li id="li138331113105813">Release应用暂不支持跳转到用户侧Native代码。</li>          <li id="li2833171317580">静态链接的系统库无法支持源码跳转。如libunwind.a，在编译过程中该系统库会以静态链接的方式集成。该系统库的符号信息在调用栈中会被识别成用户侧定义的函数，实际上无法跳转到源码。</li>         </ul>        </div></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1916494112203">多实例函数热点分析<i class="anchor-icon anchor-icon-link" anchorid="section1916494112203" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174539__p31643417208">在应用开发过程中，可能存在一些耗时操作，则需要引入Worker线程或者TaskPool任务池来协同处理。这些线程也可能会像主线程一样存在性能问题，所以需要同时对这些子线程进行性能调优。其中，主线程以及每一个Work线程或者TaskPool工作线程，都会对应一个方舟实例，通过连接这些方舟实例，开启性能采样，从而可以获取更全面的采样信息。</p>     <ul id="ZH-CN_TOPIC_0000002510174539__ul14164141202014">      <li id="li01641341182011">父泳道内可以看到被选择进程的CPU使用率，框选后展示此时段内录制到的所有方舟实例的函数调用栈信息。</li>      <li id="li3164144192014">子泳道框选后展示此时段内录制到的该方舟实例的函数调用栈信息。</li>     </ul>     <p id="ZH-CN_TOPIC_0000002510174539__p1440302134610"><span><img height="372.2649859943978" originheight="622" originwidth="1546" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.01950670166383341844219266204264:50001231000000:2800:435A0AEAEE287370C3E442B107264A524A9432408A942D87BAAB80FB6A5B7B63.png" title="点击放大" width="920"></span></p>    </div>    <div class="tiledSection">     <h2 id="section186881175012">离线符号解析<i class="anchor-icon anchor-icon-link" anchorid="section186881175012" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174539__p33431435101512">DevEco Profiler提供离线符号解析能力，基于携带符号表信息的so库进行分析，可把符号地址解析为具体函数名称，便于定位函数位置。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p4228244145911">对于有so库路径和偏移地址的采样数据，如图所示，通过导入对应的携带符号表信息的so库进行解析，补充release so库中缺失的符号表信息（包括系统so库，用户自编译的so库，三方库）。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p5404162144613"><span><img height="429.79719887955184" originheight="727" originwidth="1563" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.05060232301047922041365235413104:50001231000000:2800:69A2117FAA39BCFF1BBB46E60D469A6DD329AF161B4C4F7FFE99B9EFC962293E.png" title="点击放大" width="920"></span></p>     <p id="ZH-CN_TOPIC_0000002510174539__p16669706367">您可以通过点击工具栏<span><img height="20.9475" originheight="19" originwidth="19" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.91241303701206506298965064758434:50001231000000:2800:288E59C33CB6C548F79B69111E7A656A3B0036DBEC889BC5E053541FFB0A03E5.png" width="20.9475" class="IconPic notEnlarge"></span>按钮，导入包含debug信息的so库。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul id="ZH-CN_TOPIC_0000002510174539__ul720692811918">        <li id="li15385123018198">离线导入携带符号表信息的so库，需要严格保证与release版本的so库保持同一优化等级（如-O1, -O2, -O3等）。可以在CMakeLists.txt文件中查看或配置编译优化等级。</li>        <li id="li20206132841916">离线导入携带符号表信息的so库，需要尽可能与release版本的so库编译选项保持一致，防止so库起始地址不一致，影响解析正确性。</li>       </ul>      </div></div></div>     <p id="ZH-CN_TOPIC_0000002510174539__p1406182154618"><span><img height="428.2767507002801" originheight="723" originwidth="1560" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.86592314277891398809264414537984:50001231000000:2800:128862015ECECF975E1AC926A78B293947DC889BCCD120FBADD7772115E04234.png" title="点击放大" width="920"></span></p>    </div>    <div class="tiledSection">     <h2 id="section1977218292919">查询自定义打点信息<i class="anchor-icon anchor-icon-link" anchorid="section1977218292919" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174539__p1894103313716">相较于异步调度，DevEco Profiler当前基于采样分析的Time任务更善于分析同步性能问题。如开发者需要分析异步调度延时等问题，可先在ArkTS代码中进行自定义打点，当应用/元服务在Time分析过程中触发打点后，DevEco Profiler会将这些打点的Trace数据解析后，以任务方块形式呈现在“User Trace”泳道中。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p9659114494713">您可以在“User Trace”子泳道上长按鼠标左键并拖拽，框选要展示分析的时间段，获取该时间段内的用户打点信息。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p1838511402310">单击User Trace泳道的“options”下拉列表，可以设置是按照Task Name维度还是Thread ID维度显示。</p>     <p id="ZH-CN_TOPIC_0000002510174539__p1856120543416"><span><img originheight="99" originwidth="397" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.05385531559276031992573670780593:50001231000000:2800:E2EE53A88944B03F51B869016B0AF74C384AD0327C3A873BB511DEE5B5C07164.png" width="397" height="99"></span></p>     <ul id="ZH-CN_TOPIC_0000002510174539__ul1921812481920">      <li id="li15123618151315">Statistics页签：显示当前任务泳道在所选时间段内的打点任务统计信息，包括任务的名称、同一任务执行的次数、平均持续时长、最长持续时间和最短持续时间。通过这些统计信息，开发者可直观地了解打点任务的执行频率、持续时间偏差等，方便定位。</li>      <li id="li12535143391815">User Trace页签：将所选时间段内的所有任务都一一列举出来，包括任务的ID、名称、起始/结束时间、持续时长等。</li>     </ul>     <p id="ZH-CN_TOPIC_0000002510174539__p1711395410346">同时，您也可以单击“User Trace”子泳道中的任意一个任务块，“Details”区域将展示该任务块的详细信息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p id="ZH-CN_TOPIC_0000002510174539__p25401713103011">此外，用户自定义打点信息，还可以在Frame分析、Network分析任务中查看到。</p>      </div></div></div>     <p id="ZH-CN_TOPIC_0000002510174539__p1741092117460"><span><img height="267.064" originheight="466" originwidth="1355" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104921.81765490255434418125286442365166:50001231000000:2800:AE3F79520209E8D21D483967D1A8ADC758468FA2D704063510672557AA7E142F.png" title="点击放大" width="770.07"></span></p>    </div>   </div></div>