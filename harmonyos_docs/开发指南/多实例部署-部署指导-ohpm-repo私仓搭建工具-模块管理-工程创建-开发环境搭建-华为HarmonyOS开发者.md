<h1 _ngcontent-hoy-c119="" class="doc-title ng-star-inserted" title="多实例部署"> 多实例部署 </h1>

<div _ngcontent-hoy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001749437800"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510173707__ul1222911452173"><li id="li16229045161719">ohpm-repo私仓不允许在Linux或macOS系统中使用root用户启动，请使用普通用户安装运行。</li><li id="li14972652101712">只有db存储为mysql且store存储为sftp或者custom时，才支持多实例方式部署。本章节多实例部署以db存储为mysql，store存储为sftp为例。</li></ul> </div></div></div> <div class="tiledSection"><h2 id="zh-cn_topic_0000001792216437_环境准备">环境准备<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_环境准备" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002510173707__ol11126163020350"><li id="li2115205413344">准备mysql数据库服务；</li><li id="li101151554143415">准备至少一个sftp存储服务，ohpm-repo最大支持连接3个sftp服务；</li><li id="li312653020359">安装Node.js18.x及以上版本。</li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510173707__ul92693264351"><li id="li1426942693513">确保sftp服务端口能够被外部机器访问。</li><li id="li6269826133510">sftp服务的读写用户应该指定相同的存储根目录。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="zh-cn_topic_0000001792216437_安装私仓工具">安装ohpm-repo工具<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_安装私仓工具" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002510173707__ol57361682368"><li id="li77363819367">解压ohpm-repo工具包<p id="ZH-CN_TOPIC_0000002510173707__p192901916203615"><span><img originheight="276" originwidth="262" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.94756835707962631715362987934382:50001231000000:2800:6575246DE9B647176630CB3466777DC9243549A825DD6DD1EF74EC06FA0F0415.png" class="notEnlarge" width="262" height="276"></span></p> </li><li id="li1932916201314">请将ohpm-repo工具包解压目录中bin目录的路径配置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-faq#section24117279211">系统环境变量</a>path中，执行如下查询命令:<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792256157_screen1454857881171146" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo -v</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792256157_p2084915518171146">终端输出版本号（如：2.0.0），则表示安装包解压无问题。如有报错，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-faq#section82-执行命令-ohpm-repo-command报错-ohpm-repo-不存在或者-command-命令不存在">FAQ</a>解决。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__p20805710123314">针对Linux和Mac系统，建议使用bash作为命令行界面。</p> </div></div></div> </li><li id="li773614816362">进入ohpm-repo解压目录的conf目录中，修改配置文件config.yaml：<ul id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_ul271847576171146"><li id="li1443721713301">检查<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_listen">listen</a>配置，默认配置为localhost:8088 ，表示仅支持监听本机地址；如果希望其他机器通过ip/域名访问，则建议修改listen配置为ohpm-repo部署机器的ip地址：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792256157_screen114479211171146" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">listen:</span> <span class="hljs-string">&lt;部署ohpm-repo机器的ip&gt;:8088</span></li></ol></pre></div></div> </li><li id="li146065312305">检查<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_deploy_root">deploy_root</a>配置：如果选择不配置，会存储在默认地址中。禁止配置该路径配置为ohpm-repo解压根目录。</li><li id="zh-cn_topic_0000001792216437_li1092029127171146"><div class="p" id="ZH-CN_TOPIC_0000002510173707__p188711225173611">数据存储db模块使用mysql：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen1993349301171146" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">db:</span>                         </li><li>  <span class="hljs-attr">type:</span> <span class="hljs-string">mysql</span></li><li>  <span class="hljs-attr">config:</span></li><li>    <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span></li><li>    <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span></li><li>    <span class="hljs-attr">username:</span> <span class="hljs-string">"tctAdmin"</span></li><li>    <span class="hljs-attr">password:</span> <span class="hljs-string">"password"</span></li><li>    <span class="hljs-attr">database:</span> <span class="hljs-string">"repo"</span></li></ol></pre></div></div> </div> </li><li id="zh-cn_topic_0000001792216437_li1197975340171146"><div class="p" id="ZH-CN_TOPIC_0000002510173707__p107624297360">文件存储store模块使用sftp，sftp配置最多只能设置3个：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen2000641938171146" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">store:</span>                               </li><li>  <span class="hljs-attr">type:</span> <span class="hljs-string">sftp</span>                         </li><li>  <span class="hljs-attr">config:</span></li><li>    <span class="hljs-attr">location:</span></li><li>      <span class="hljs-bullet">-</span>      </li><li>        <span class="hljs-attr">name:</span> <span class="hljs-string">test_one_sftp</span>          </li><li>        <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>           </li><li>        <span class="hljs-attr">port:</span> <span class="hljs-number">22</span>                     </li><li>        <span class="hljs-attr">read_username:</span> <span class="hljs-string">"read"</span>   </li><li>        <span class="hljs-attr">read_password:</span> <span class="hljs-string">"password"</span> </li><li>        <span class="hljs-attr">write_username:</span> <span class="hljs-string">"write"</span>   </li><li>        <span class="hljs-attr">write_password:</span> <span class="hljs-string">"password"</span> </li><li>        <span class="hljs-attr">path:</span> <span class="hljs-string">/source22</span> </li><li>      <span class="hljs-bullet">-</span>  </li><li>        <span class="hljs-attr">name:</span> <span class="hljs-string">test_two_sftp</span></li><li>        <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span></li><li>        <span class="hljs-attr">port:</span> <span class="hljs-number">24</span></li><li>        <span class="hljs-attr">read_username:</span> <span class="hljs-string">"read"</span></li><li>        <span class="hljs-attr">read_password:</span> <span class="hljs-string">"password"</span></li><li>        <span class="hljs-attr">write_username:</span> <span class="hljs-string">"write"</span></li><li>        <span class="hljs-attr">write_password:</span> <span class="hljs-string">"password"</span></li><li>        <span class="hljs-attr">path:</span> <span class="hljs-string">/source24</span></li><li>    <span class="hljs-comment">#server: http://localhost:8088</span></li></ol></pre></div></div> </div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__p103145511120">1、ohpm-repo文件的存储路径为： &lt;sftp服务器配置的存储根目录&gt; +&lt;store配置的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_li1275312401171146">path</a>路径&gt;，其中path只支持相对路径，必须以/开头。例如sftp服务器存储根目录为/user/sftp/data，store中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_li1275312401171146">path</a>配置的路径为/source，故最终ohpm-repo文件存储路径为/user/sftp/data/source。</p> <p id="ZH-CN_TOPIC_0000002510173707__p0244181131210">2、多实例部署ohpm-repo时，必须配置反向代理服务器，转发客户端请求到部署的多个ohpm-repo实例服务器中，故<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_store">store.config.server</a>必须手动配置为反向代理服务器的域名/ip地址，且需要配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#section1074004784011">use_reverse_proxy</a>值为true。</p> </div></div></div> </li></ul> </li></ol><ol id="ZH-CN_TOPIC_0000002510173707__ol37368814363" start="4"><li id="li167369814364">进入ohpm-repo解压目录的bin目录下，执行安装命令:<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen1380894440171146" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo install </li></ol></pre></div></div> <div class="p" id="ZH-CN_TOPIC_0000002510173707__p650732713811"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__p166011215175717">不配置参数--config，则默认使用ohpm-repo解压目录中conf目录内自带的配置文件config.yaml。</p> </div></div></div> </div> <p id="ZH-CN_TOPIC_0000002510173707__p46311322388">安装成功日志信息如下：</p> <p id="ZH-CN_TOPIC_0000002510173707__p8724173793818"><span><img height="171.98496000000003" originheight="248" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.28817049784399643115069152019291:50001231000000:2800:7A4E3A0BF0E706959F41FD3135B75E7DED101FC6E71C886F4BF327EE57430468.png" title="点击放大" width="758.1"></span></p> </li><li id="li177361383364">安装成功后，必须根据给出的提示信息刷新环境变量，针对Windows系统和Linux/Mac系统，有不同处理方式：<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_ul725011383597"><li id="zh-cn_topic_0000001792216437_li1125123875914">Windows系统： 关闭当前窗口，重新开启一个窗口。</li><li id="zh-cn_topic_0000001792216437_li17251438195912">Linux系统或Mac系统： 在命令行中执行刷新命令：当shell为bash时执行<em>source ~/.bashrc</em> 或者 .<strong><em> </em></strong><em>~/.bashrc</em> ；当shell为zsh时，执行<em>source ~/.zshrc</em> 或者 .<em> ~/.zshrc</em> 。</li></ul> </div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="zh-cn_topic_0000001792216437_部署首个节点">部署首个节点<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_部署首个节点" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1393730712171146">进入ohpm-repo解压目录的bin目录中，命令行启动ohpm-repo。</p> <div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen521826741171146" data-highlighted="yes"><ol class="linenums"><li>ohpm<span class="hljs-operator">-</span>repo <span class="hljs-keyword">start</span> </li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p612560005171146">启动成功日志信息如下：</p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p2120753509171146"><span><img height="102.0243" originheight="120" originwidth="894" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.91769612704911999516206982050091:50001231000000:2800:52DE86963505DCC6BB2358D78D16675722B6EB07579DA0F79531A10FD638E0E2.png" title="点击放大" width="760.095"></span></p> </div> <div class="tiledSection"><h2 id="zh-cn_topic_0000001792216437_打包和部署">打包和部署<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_打包和部署" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p913400747171146">为帮助更方便地完成多实例部署，已提供打包和部署命令。</p> </div> <div class="tiledSection"><h3 id="zh-cn_topic_0000001792216437_打包" class="firsth2">打包<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_打包" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p195198944171146">在完成了多实例配置并首次启动过ohpm-repo服务实例的机器上，执行ohpm-repo pack &lt;deploy_root&gt;。</p> <div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen1355804606171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ohpm</span>-<span class="hljs-variable">repo</span> <span class="hljs-variable">pack</span> <span class="hljs-variable">D</span>:\<span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span></li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p112217464915">该命令用来打包备份ohpm-repo的&lt;deploy_root&gt;/conf，&lt;deploy_root&gt;/meta目录，并在命令行工作目录下生成压缩包。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1216159109171146">打包成功日志信息如下：</p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p236216701171146"><span><img height="57.627836" originheight="60" originwidth="808" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.77825285450720235527351363370281:50001231000000:2800:630E0B5E624F083180D015FF08106DA06DB74241378F8DFB2D6DD53A58B4C860.png" title="点击放大" width="776.0550000000001"></span></p> </div> <div class="tiledSection"><h3 id="zh-cn_topic_0000001792216437_部署">部署<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_部署" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1809759910171146">将pack命令的产物拷贝到其他机器中。在解压ohpm-repo压缩包后，使用ohpm-repo deploy &lt;file_path&gt;命令部署新的实例。</p> <div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen287755479171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ohpm</span>-<span class="hljs-variable">repo</span> <span class="hljs-variable">deploy</span> <span class="hljs-variable">D</span>:\<span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span>\<span class="hljs-title class_">bin</span>\<span class="hljs-title class_">pack_1695805599689</span>.<span class="hljs-title class_">zip</span> --<span class="hljs-title class_">deploy_root</span> <span class="hljs-title class_">D</span>:\<span class="hljs-title class_">new</span>-<span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span>\<span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span>-<span class="hljs-title class_">deploy</span></li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_ul552821417171146"><li id="zh-cn_topic_0000001792216437_li524133130171146">&lt;file_path&gt;： 参数指定备份压缩包地址。</li><li id="zh-cn_topic_0000001792216437_li985930659171146">--deploy_root： 指定部署根目录，用于存储ohpm-repo启动时生成的文件，默认使用 &lt;现有用户home目录&gt;/ohpm-repo。</li></ul> </div></div></div> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1876891894171146">部署成功日志信息如下：</p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p785991014171146"><span><img height="130.96177500000002" originheight="175" originwidth="1097" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.18809324624997171472372705596611:50001231000000:2800:B9925AEACE5AE3BF8F6748E26CD7AEFB6505576435D9155F8A938D9354573FC8.png" title="点击放大" width="820.9425"></span></p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1461114893171146">部署成功后可执行ohpm-repo start启动ohpm-repo。</p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1503551931171146"><span><img height="110.448121" originheight="120" originwidth="894" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.66719546797455730751299084472856:50001231000000:2800:A60DCC7DF8AFD31B2902F36AF685E50399B3484EC378477D52BA6E7E129EABAA.png" title="点击放大" width="822.9375"></span></p> </div> <div class="tiledSection"><h2 id="zh-cn_topic_0000001792216437_配置自动重启可选">配置自动重启（可选）<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_配置自动重启可选" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p963688733171146">为ohpm-repo实例配置系统重启时自动重启的功能。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p174598265217">在进行该配置前需要将ohpm-repo工具bin目录配置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-faq#section24117279211">系统环境变量</a>path中。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="zh-cn_topic_0000001792216437_linux" class="firsth2">Linux<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_linux" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510173707__ol1948113111396"><li id="li948173193911">在ohpm-repo工具的bin目录下创建自动运行脚本run-repo.sh：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen828508683171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">touch</span> run-repo.sh</li></ol></pre></div></div> </li><li id="li5481163143915">写入下面内容，保存并关闭文件：<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__p1496750183914">当mysql或sftp服务与ohpm-repo部署在同一服务器上时，请将mysql和sftp的启动命令放在ohpm-repo start命令之前。</p> </div></div></div> <div class="p" id="ZH-CN_TOPIC_0000002510173707__p14910193953918"><div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen482521609171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#!/bin/bash</span></li><li>ohpm-repo start</li></ol></pre></div></div> </div> </li><li id="li16481163114393">将该脚本设置为可执行文件：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen514839332171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">chmod</span> +x run-repo.sh</li></ol></pre></div></div> </li><li id="li74811031153919">使用linux的定时任务工具crontab重启自动执行脚本。编辑当前用户的crontab配置：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen1064574007171146" data-highlighted="yes"><ol class="linenums"><li>crontab -e</li></ol></pre></div></div> </li><li id="li134811531113913">当前用户的crontab配置写入下面内容，保存并关闭文件：<div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen60425574171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@reboot</span> /bin/sh run-repo.<span class="hljs-property">sh</span> &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span></li></ol></pre></div></div> </li></ol> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1972404586171146">其中run-repo.sh表示要执行的脚本路径；&gt;/dev/null 2&gt;&amp;1表示将输出重定向到空设备，即不输出任何信息。</p> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p1689455239171146">现在，每次系统启动时，都会自动执行run-repo.sh脚本中的命令。</p> </div> <div class="tiledSection"><h3 id="zh-cn_topic_0000001792216437_windows">Windows<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000001792216437_windows" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510173707__ol12961439194010"><li id="li3296163994013">新建run-repo.bat文件，写入下面内容：<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173707__p7107574414">当mysql或sftp服务与ohpm-repo部署在同一服务器上时，请将mysql和sftp的启动命令放在ohpm-repo start命令之前。</p> </div></div></div> <div class="p" id="ZH-CN_TOPIC_0000002510173707__p95151851164018"><div _ngcontent-hoy-c106="" class="highlight-div"><div _ngcontent-hoy-c106="" class="highlight-div-header"><div _ngcontent-hoy-c106="" class="highlight-div-header-left"><div _ngcontent-hoy-c106="" class="handle-button expand-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hoy-c106="" class="highlight-div-header-right"><div _ngcontent-hoy-c106="" class="handle-button ai-button"></div><div _ngcontent-hoy-c106="" class="handle-button line-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hoy-c106="" class="handle-button theme-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hoy-c106="" class="handle-button copy-button"><div _ngcontent-hoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_screen687262036171146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@echo</span> off</li><li><span class="hljs-keyword">call</span> ohpm<span class="hljs-operator">-</span>repo <span class="hljs-keyword">start</span></li><li>exit</li></ol></pre></div></div> </div> </li><li id="li9296123954012">按下win+R，输入shell:startup，回车：弹出启动文件框；将run-repo.bat文件剪切到启动文件夹下即可。<p id="ZH-CN_TOPIC_0000002510173707__p8386145719405"><span><img height="152.345249" originheight="119" originwidth="624" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104726.32089367302742962304952014440653:50001231000000:2800:9B3BC05A167735BBDE0F3A33E41145066E64430708E3DDE8E8F4BC687F316E7B.png" title="点击放大" width="798.9975000000001"></span></p> </li></ol> <p id="ZH-CN_TOPIC_0000002510173707__zh-cn_topic_0000001792216437_p372767085171146">现在，每次系统启动时，都会自动执行run-repo.bat脚本中的命令。</p> </div> </div> <div></div></div>