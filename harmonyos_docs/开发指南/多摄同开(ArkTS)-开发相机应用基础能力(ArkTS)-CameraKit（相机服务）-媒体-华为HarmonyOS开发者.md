<h1 _ngcontent-qhi-c119="" class="doc-title ng-star-inserted" title="多摄同开(ArkTS)"> 多摄同开(ArkTS) </h1>

<div _ngcontent-qhi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 18开始支持多摄同开，即应用同时开启前置/后置相机进行拍照和录像。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>由于多摄同开需要前置/后置相机同时运行，所以对于相机功能有较大限制。当前版本仅支持以下七项基础功能，请勿对多摄同开开启的相机进行超出以下七种基础功能范围之外的查询、设置和使能。</p>      <ol>       <li>闪光灯。</li>       <li>曝光。</li>       <li>变焦。</li>       <li>曝光补偿。</li>       <li>对焦。</li>       <li>防抖。</li>       <li>色彩空间。</li>      </ol>     </div></div></div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera</a>。</p>     <p>Context获取方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>     <ol>      <li>       <p>需要导入相机框架、媒体库、图片等相关领域依赖。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getcameradevice18" target="_blank">getCameraDevice</a>获取对应的前置和后置相机。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSupportedCamerasFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>)</li><li>{</li><li>  <span class="hljs-keyword">let</span> cameras = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>
</li><li>  <span class="hljs-comment">// 如果相机数量少于2，说明只存在单侧相机，返回。</span></li><li>  <span class="hljs-keyword">if</span> (cameras.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) {</li><li>   <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 获取逻辑后置和逻辑前置。</span></li><li>  <span class="hljs-keyword">let</span> curCameraDeviceBack = cameraManager.<span class="hljs-title function_">getCameraDevice</span>(camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_BACK</span>, camera.<span class="hljs-property">CameraType</span>.<span class="hljs-property">CAMERA_TYPE_DEFAULT</span>);</li><li>  <span class="hljs-keyword">let</span> curCameraDeviceFront = cameraManager.<span class="hljs-title function_">getCameraDevice</span>(camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_FRONT</span>, camera.<span class="hljs-property">CameraType</span>.<span class="hljs-property">CAMERA_TYPE_DEFAULT</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>获取对应的并发能力集。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getcameraconcurrentinfos18" target="_blank">getCameraConcurrentInfos</a>获取相机的输出并发能力信息数组<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraconcurrentinfo18" target="_blank">CameraConcurrentInfo</a>，数组内部包含相机在对应并发模式下支持的模式和输出能力。若<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getcameraconcurrentinfos18" target="_blank">getCameraConcurrentInfos</a>接口返回空数组，则表明当前设备不支持并发功能。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSupportedOutputCapabilityFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager, curCameraDeviceFront: camera.CameraDevice, curCameraDeviceBack: camera.CameraDevice</span>)</li><li>{</li><li>  <span class="hljs-comment">// 检查当前相机是否支持拍照模式，获取原始能力集。</span></li><li>  <span class="hljs-keyword">let</span> sceneModes = cameraManager.<span class="hljs-title function_">getSupportedSceneModes</span>(curCameraDeviceFront);</li><li>  <span class="hljs-keyword">if</span> (sceneModes === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> isSupported = sceneModes.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">sceneMode: camera.SceneMode</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> sceneMode === camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>;</li><li>  });</li><li>  <span class="hljs-keyword">if</span> (!isSupported) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> cameraOutputCapability = cameraManager.<span class="hljs-title function_">getSupportedOutputCapability</span>(curCameraDeviceFront, camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>);</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">deviceArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = [curCameraDeviceFront, curCameraDeviceBack];</li><li>
</li><li>  <span class="hljs-comment">// 获取并发能力集。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">concurrentInfo</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraConcurrentInfo</span>&gt; = cameraManager.<span class="hljs-title function_">getCameraConcurrentInfos</span>(deviceArray);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (concurrentInfo.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>   <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 用并发能力集替换原始能力集。</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; concurrentInfo.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-keyword">if</span> (concurrentInfo[i].<span class="hljs-property">device</span>.<span class="hljs-property">cameraPosition</span> == camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_FRONT</span>) {</li><li>      cameraOutputCapability = concurrentInfo[i].<span class="hljs-property">outputCapabilities</span>[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-keyword">break</span>;</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>确定预览输出流。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPreviewOutputFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraOutputCapability: camera.CameraOutputCapability, surfaceId: <span class="hljs-built_in">string</span></span>)</li><li>{</li><li>  <span class="hljs-comment">// 此处创建预览输出流以format：1003，size：1920*1080的previewProfile为例。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">previewProfileObj</span>: camera.<span class="hljs-property">Profile</span> = {</li><li>    <span class="hljs-attr">format</span>: <span class="hljs-number">1003</span>,</li><li>    <span class="hljs-attr">size</span>: {</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span></li><li>    }</li><li>  };</li><li>  <span class="hljs-comment">// 查询对应previewProfile是否存在。</span></li><li>  <span class="hljs-keyword">let</span> previewProfiles = cameraOutputCapability.<span class="hljs-property">previewProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (previewProfiles.<span class="hljs-property">length</span> &lt; <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> index = previewProfiles.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">previewProfile: camera.Profile</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> previewProfile.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> === previewProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> &amp;&amp;</li><li>    previewProfile.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> === previewProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> &amp;&amp;</li><li>    previewProfile.<span class="hljs-property">format</span> === previewProfileObj.<span class="hljs-property">format</span>;</li><li>  });</li><li>  <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建previewOutput输出对象。</span></li><li>  <span class="hljs-keyword">let</span> previewOutput = cameraManager.<span class="hljs-title function_">createPreviewOutput</span>(previewProfileObj, surfaceId);</li><li>  <span class="hljs-keyword">if</span> (previewOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>确定拍照输出流。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoOutputFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraOutputCapability: camera.CameraOutputCapability</span>)</li><li>{</li><li> <span class="hljs-comment">// 此处创建拍照输出流以format：2000，size：1920*1080的photoProfile为例。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoProfileObj</span>: camera.<span class="hljs-property">Profile</span> = {</li><li>    <span class="hljs-attr">format</span>: <span class="hljs-number">2000</span>,</li><li>    <span class="hljs-attr">size</span>: {</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span></li><li>    }</li><li>  };</li><li>  <span class="hljs-comment">// 查询对应photoProfile是否存在。</span></li><li>  <span class="hljs-keyword">let</span> photoProfiles = cameraOutputCapability.<span class="hljs-property">photoProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (photoProfiles.<span class="hljs-property">length</span> &lt; <span class="hljs-number">1</span>) {</li><li>   <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> index = photoProfiles.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">photoProfile: camera.Profile</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> photoProfile.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> === photoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> &amp;&amp;</li><li>    photoProfile.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> === photoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> &amp;&amp;</li><li>    photoProfile.<span class="hljs-property">format</span> === photoProfileObj.<span class="hljs-property">format</span>;</li><li>  });</li><li>  <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>(photoProfileObj);</li><li>  <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>确定录像输出流。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAVRecorder</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;media.<span class="hljs-property">AVRecorder</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">avRecorder</span>: media.<span class="hljs-property">AVRecorder</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    avRecorder = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVRecorder</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createAVRecorder error'</span>)</li><li>  }</li><li>  <span class="hljs-keyword">return</span> avRecorder;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">initFd</span>(<span class="hljs-params">context: common.Context</span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-keyword">let</span> filePath = filesDir + <span class="hljs-string">`/<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>.mp4`</span>;</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'filePath'</span>, filePath);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fileIo.<span class="hljs-property">File</span> = fileIo.<span class="hljs-title function_">openSync</span>(filePath, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  <span class="hljs-keyword">return</span> file.<span class="hljs-property">fd</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">prepareAVRecorder</span>(<span class="hljs-params">videoProfileObj: camera.VideoProfile, curCameraDevice: camera.CameraDevice, avRecorder: media.AVRecorder, context: common.Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> fd = <span class="hljs-title function_">initFd</span>(context);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">videoConfig</span>: media.<span class="hljs-property">AVRecorderConfig</span> = {</li><li>    <span class="hljs-attr">audioSourceType</span>: media.<span class="hljs-property">AudioSourceType</span>.<span class="hljs-property">AUDIO_SOURCE_TYPE_MIC</span>,</li><li>    <span class="hljs-attr">videoSourceType</span>: media.<span class="hljs-property">VideoSourceType</span>.<span class="hljs-property">VIDEO_SOURCE_TYPE_SURFACE_YUV</span>,</li><li>    <span class="hljs-attr">profile</span>: {</li><li>      <span class="hljs-attr">audioBitrate</span>: <span class="hljs-number">48000</span>,</li><li>      <span class="hljs-attr">audioChannels</span>: <span class="hljs-number">2</span>,</li><li>      <span class="hljs-attr">audioCodec</span>: media.<span class="hljs-property">CodecMimeType</span>.<span class="hljs-property">AUDIO_AAC</span>,</li><li>      <span class="hljs-attr">audioSampleRate</span>: <span class="hljs-number">48000</span>,</li><li>      <span class="hljs-attr">fileFormat</span>: media.<span class="hljs-property">ContainerFormatType</span>.<span class="hljs-property">CFT_MPEG_4</span>,</li><li>      <span class="hljs-attr">videoBitrate</span>: <span class="hljs-number">512000</span>,</li><li>      <span class="hljs-attr">videoCodec</span>: media.<span class="hljs-property">CodecMimeType</span>.<span class="hljs-property">VIDEO_AVC</span>,</li><li>      <span class="hljs-attr">videoFrameWidth</span>: videoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">width</span>,</li><li>      <span class="hljs-attr">videoFrameHeight</span>: videoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">height</span>,</li><li>      <span class="hljs-attr">videoFrameRate</span>: videoProfileObj.<span class="hljs-property">frameRateRange</span>.<span class="hljs-property">min</span></li><li>    },</li><li>    <span class="hljs-attr">url</span>: <span class="hljs-string">`fd://<span class="hljs-subst">${fd.toString()}</span>`</span>,</li><li>    <span class="hljs-attr">rotation</span>: curCameraDevice?.<span class="hljs-property">cameraOrientation</span></li><li>  };</li><li>  <span class="hljs-keyword">await</span> avRecorder?.<span class="hljs-title function_">prepare</span>(videoConfig).<span class="hljs-title function_">catch</span>((<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`prepareAVRecorder prepare err`</span>);</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getVideoOutputFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraOutputCapability: camera.CameraOutputCapability, concurrentInfo: <span class="hljs-built_in">Array</span>&lt;camera.CameraConcurrentInfo&gt;, curCameraDeviceFront: camera.CameraDevice, context: common.Context</span>)</li><li>{</li><li> <span class="hljs-comment">// 此处创建录像输出流以format：1003，size：1920*1080的videoProfile为例。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">videoProfileObj</span>: camera.<span class="hljs-property">VideoProfile</span> = {</li><li>    <span class="hljs-attr">format</span>: <span class="hljs-number">1003</span>,</li><li>    <span class="hljs-attr">size</span>: {</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span></li><li>    },</li><li>    <span class="hljs-attr">frameRateRange</span>: {</li><li>      <span class="hljs-attr">min</span>: <span class="hljs-number">30</span>,</li><li>      <span class="hljs-attr">max</span>: <span class="hljs-number">60</span></li><li>    }</li><li>  };</li><li>
</li><li>  <span class="hljs-comment">// 替换相应能力集。</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; concurrentInfo.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-keyword">if</span> (concurrentInfo[i].<span class="hljs-property">device</span>.<span class="hljs-property">cameraPosition</span> == camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_FRONT</span>) {</li><li>      cameraOutputCapability = concurrentInfo[i].<span class="hljs-property">outputCapabilities</span>[<span class="hljs-number">1</span>];</li><li>      <span class="hljs-keyword">break</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">let</span> videoProfiles = cameraOutputCapability.<span class="hljs-property">videoProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (videoProfiles.<span class="hljs-property">length</span> &lt; <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> index = videoProfiles.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">videoProfile: camera.VideoProfile</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> videoProfile.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> === videoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> &amp;&amp;</li><li>      videoProfile.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> === videoProfileObj.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> &amp;&amp;</li><li>      videoProfile.<span class="hljs-property">format</span> === videoProfileObj.<span class="hljs-property">format</span> &amp;&amp;</li><li>      videoProfile.<span class="hljs-property">frameRateRange</span>.<span class="hljs-property">min</span> &lt;= <span class="hljs-number">60</span> &amp;&amp;</li><li>      videoProfile.<span class="hljs-property">frameRateRange</span>.<span class="hljs-property">max</span> &lt;= <span class="hljs-number">60</span>;</li><li>  });</li><li>  <span class="hljs-keyword">if</span> (index === -<span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  videoProfileObj = videoProfiles[index];</li><li>  <span class="hljs-keyword">let</span> avRecorder = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createAVRecorder</span>();</li><li>  <span class="hljs-keyword">if</span> (avRecorder === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">prepareAVRecorder</span>(videoProfileObj, curCameraDeviceFront, avRecorder, context);</li><li>  <span class="hljs-keyword">let</span> videoSurfaceId = <span class="hljs-keyword">await</span> avRecorder.<span class="hljs-title function_">getInputSurface</span>();</li><li>  <span class="hljs-keyword">let</span> videoOutput = cameraManager.<span class="hljs-title function_">createVideoOutput</span>(videoProfileObj, videoSurfaceId);</li><li>  <span class="hljs-keyword">if</span> (videoOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>打开相机。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-camerainput#open18" target="_blank">open</a>以多摄同开状态打开指定相机。在使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-camerainput#open18" target="_blank">open</a>接口前，请先查询接口是否支持并发能力集，并优先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getcameraconcurrentinfos18" target="_blank">getCameraConcurrentInfos</a>方法，获取多摄同开状态下的相机并发能力集。请勿在未查询并发能力集的情况下使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-camerainput#open18" target="_blank">open</a>，否则会导致打开相机失败。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initCamera</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraDevice: camera.CameraDevice</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraInput = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraDevice);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'createCameraInputFn success'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createCameraInputFn failed`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (cameraInput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> isOpenSuccess = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>
</li><li>    <span class="hljs-comment">// 当前版本支持camera.CameraConcurrentType.CAMERA_LIMITED_CAPABILITY模式并发打开相机。</span></li><li>    <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>(camera.<span class="hljs-property">CameraConcurrentType</span>.<span class="hljs-property">CAMERA_LIMITED_CAPABILITY</span>);</li><li>    isOpenSuccess = <span class="hljs-literal">true</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createCameraInput failed`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (!isOpenSuccess) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>会话流程。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-comment">// 监听捕获会话错误变化。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onSessionErrorChange</span>(<span class="hljs-params">session: camera.PhotoSession | camera.VideoSession</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, (<span class="hljs-attr">captureSessionError</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'onCaptureSessionErrorChange error'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">handlePhotoAssetCb</span>: <span class="hljs-function">(<span class="hljs-params">photoAsset: photoAccessHelper.PhotoAsset</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {</li><li>};</li><li>
</li><li><span class="hljs-comment">// 监听拍照事件。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">photoOutputCallBack</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>
</li><li>    <span class="hljs-comment">// 监听拍照开始。</span></li><li>    photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureStartWithInfo'</span>, (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">captureStartInfo</span>: camera.<span class="hljs-property">CaptureStartInfo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 监听拍照帧输出捕获。</span></li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'frameShutter'</span>, (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">frameShutterInfo</span>: camera.<span class="hljs-property">FrameShutterInfo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  });</li><li>
</li><li> <span class="hljs-comment">// 监听拍照结束。</span></li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureEnd'</span>, (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">captureEndInfo</span>: camera.<span class="hljs-property">CaptureEndInfo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 监听拍照异常。</span></li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, (<span class="hljs-attr">data</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  });</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAssetAvailable'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, photoAsset: photoAccessHelper.PhotoAsset</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (photoAsset === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-title function_">handlePhotoAssetCb</span>(photoAsset);</li><li>  });</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 会话流程。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sessionFlowFn</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraInput: camera.CameraInput,</span></li><li><span class="hljs-params">  previewOutput: camera.PreviewOutput, photoOutput: camera.PhotoOutput | <span class="hljs-literal">undefined</span>, videoOutput: camera.VideoOutput | <span class="hljs-literal">undefined</span>, curSceneMode: camera.SceneMode</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: camera.<span class="hljs-property">PhotoSession</span> | camera.<span class="hljs-property">VideoSession</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>
</li><li>    <span class="hljs-comment">// 创建CaptureSession实例。</span></li><li>    <span class="hljs-keyword">if</span> (curSceneMode === camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) {</li><li>      session = cameraManager.<span class="hljs-title function_">createSession</span>(curSceneMode) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (curSceneMode === camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_VIDEO</span>) {</li><li>      session = cameraManager.<span class="hljs-title function_">createSession</span>(curSceneMode) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">VideoSession</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (session === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-title function_">onSessionErrorChange</span>(session);</li><li>
</li><li>    <span class="hljs-comment">// 开始配置会话。</span></li><li>    session.<span class="hljs-title function_">beginConfig</span>();</li><li>
</li><li>    <span class="hljs-comment">// 向会话中添加相机输入流。</span></li><li>    session.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>
</li><li>    <span class="hljs-comment">// 向会话中添加预览输出流。</span></li><li>    session.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (curSceneMode === camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) {</li><li>      <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>
</li><li>      <span class="hljs-comment">// 拍照监听事件。</span></li><li>      <span class="hljs-title function_">photoOutputCallBack</span>(photoOutput);</li><li>
</li><li>      <span class="hljs-comment">// 向会话中添加拍照输出流。</span></li><li>      session.<span class="hljs-title function_">addOutput</span>(photoOutput);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (curSceneMode === camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_VIDEO</span>) {</li><li>      <span class="hljs-keyword">if</span> (videoOutput === <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>
</li><li>      <span class="hljs-comment">// 向会话中添加录像输出流。</span></li><li>      session.<span class="hljs-title function_">addOutput</span>(videoOutput);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 提交配置信息。</span></li><li>    <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">commitConfig</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`sessionFlowFn fail`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>拍照，通过步骤8中配置的photoOutput使用前置或后置相机进行拍照。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">takePicture</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">if</span> (photoOutput) {</li><li>    <span class="hljs-keyword">await</span> photoOutput.<span class="hljs-title function_">capture</span>();</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'photoOutput is undefined or null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>录制。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> isRecording = <span class="hljs-literal">false</span>;</li><li>
</li><li><span class="hljs-comment">// 启动录制。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startVideo</span>(<span class="hljs-params">videoOutput: camera.VideoOutput, avRecorder: media.AVRecorder</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> videoOutput?.<span class="hljs-title function_">start</span>();</li><li>    <span class="hljs-keyword">await</span> avRecorder?.<span class="hljs-title function_">start</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`startVideo err`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 停止录制。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopVideo</span>(<span class="hljs-params">videoOutput: camera.VideoOutput, avRecorder: media.AVRecorder</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">if</span> (isRecording) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">if</span> (avRecorder) {</li><li>      <span class="hljs-keyword">await</span> avRecorder.<span class="hljs-title function_">stop</span>();</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (videoOutput) {</li><li>      <span class="hljs-keyword">await</span> videoOutput.<span class="hljs-title function_">stop</span>();</li><li>    }</li><li>    isRecording = <span class="hljs-literal">false</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`stopVideo err`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在多摄同开状态下，前/后置相机可配置的能力示例如下（当前版本仅支持本文开头部分所示的七项基础功能）。</p>       <div _ngcontent-qhi-c106="" class="highlight-div"><div _ngcontent-qhi-c106="" class="highlight-div-header"><div _ngcontent-qhi-c106="" class="highlight-div-header-left"><div _ngcontent-qhi-c106="" class="handle-button expand-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qhi-c106="" class="highlight-div-header-right"><div _ngcontent-qhi-c106="" class="handle-button ai-button"></div><div _ngcontent-qhi-c106="" class="handle-button line-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qhi-c106="" class="handle-button theme-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qhi-c106="" class="handle-button copy-button"><div _ngcontent-qhi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qhi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 闪光灯。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasFlashFn</span>(<span class="hljs-params">flashMode: camera.FlashMode, session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">void</span> {</li><li>
</li><li>  <span class="hljs-comment">// 检测是否有闪光灯。</span></li><li>  <span class="hljs-keyword">let</span> hasFlash = session?.<span class="hljs-title function_">hasFlash</span>();</li><li>
</li><li>  <span class="hljs-comment">// 检测闪光灯模式是否支持。</span></li><li>  <span class="hljs-keyword">let</span> isFlashModeSupported = session?.<span class="hljs-title function_">isFlashModeSupported</span>(flashMode);</li><li>
</li><li>  <span class="hljs-comment">// 设置闪光灯模式。</span></li><li>  <span class="hljs-keyword">if</span> (isFlashModeSupported) {</li><li>    session?.<span class="hljs-title function_">setFlashMode</span>(flashMode);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 曝光。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasExposureFn</span>(<span class="hljs-params">ExposeureMode: camera.ExposureMode, session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">void</span> {</li><li>
</li><li>  <span class="hljs-comment">// 检测曝光模式是否支持。</span></li><li>  <span class="hljs-keyword">let</span> hasFlash = session?.<span class="hljs-title function_">isExposureModeSupported</span>(<span class="hljs-title class_">ExposeureMode</span>);</li><li>
</li><li>  <span class="hljs-comment">// 设置曝光模式。</span></li><li>  <span class="hljs-keyword">if</span> (hasFlash) {</li><li>    session?.<span class="hljs-title function_">setExposureMode</span>(<span class="hljs-title class_">ExposeureMode</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取可变焦距范围。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getZoomRatioRange</span>(<span class="hljs-params">session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">zoomRatioRange</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-keyword">if</span> (session !== <span class="hljs-literal">undefined</span>) {</li><li>    zoomRatioRange = session.<span class="hljs-title function_">getZoomRatioRange</span>();</li><li>  }</li><li>  <span class="hljs-keyword">return</span> zoomRatioRange;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 变焦。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setZoomRatioFn</span>(<span class="hljs-params">zoomRatio: <span class="hljs-built_in">number</span>, session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">void</span> {</li><li>
</li><li>  <span class="hljs-comment">// 获取支持的变焦范围。</span></li><li>  <span class="hljs-keyword">let</span> zoomRatioRange = <span class="hljs-title function_">getZoomRatioRange</span>();</li><li>  <span class="hljs-keyword">try</span> {</li><li>    session?.<span class="hljs-title function_">setZoomRatio</span>(zoomRatio);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setZoomRatioFn fail`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 曝光补偿。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setExposureBiasFn</span>(<span class="hljs-params">exposureBias: <span class="hljs-built_in">number</span>, session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">void</span> {</li><li>
</li><li>  <span class="hljs-comment">// 查询曝光补偿范围。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">biasRangeArray</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; | <span class="hljs-literal">undefined</span> = [];</li><li>  biasRangeArray = session?.<span class="hljs-title function_">getExposureBiasRange</span>();</li><li>
</li><li>  <span class="hljs-comment">// 设置曝光补偿。</span></li><li>  session?.<span class="hljs-title function_">setExposureBias</span>(exposureBias);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 对焦模式。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setFocusMode</span>(<span class="hljs-params">focusMode: camera.FocusMode, session: camera.PhotoSession | camera.VideoSession | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">void</span> {</li><li>
</li><li>  <span class="hljs-comment">// 检测对焦模式是否支持。</span></li><li>  <span class="hljs-keyword">let</span> isSupported = session?.<span class="hljs-title function_">isFocusModeSupported</span>(focusMode);</li><li>
</li><li>  <span class="hljs-comment">// 设置对焦模式。</span></li><li>  <span class="hljs-keyword">if</span> (!isSupported) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  session?.<span class="hljs-title function_">setFocusMode</span>(focusMode);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>