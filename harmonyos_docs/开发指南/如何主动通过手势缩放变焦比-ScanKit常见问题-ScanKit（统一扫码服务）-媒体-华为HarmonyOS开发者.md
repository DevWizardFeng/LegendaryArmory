<h1 _ngcontent-nug-c119="" class="doc-title ng-star-inserted" title="如何主动通过手势缩放变焦比"> 如何主动通过手势缩放变焦比 </h1>

<div _ngcontent-nug-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p><strong>问题现象</strong></p> <p>自定义界面扫码如何主动通过手势缩放相机流。</p> <p><strong>解决措施</strong></p> <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-combined-gestures" target="_blank">组合手势</a>接口设置变焦比setZoom(zoomValue : number): void。</p> <p>参考下面示例代码，手势缩放跟随和手势缩放结束接口中都可以设置变焦比变化：</p> <div _ngcontent-nug-c106="" class="highlight-div"><div _ngcontent-nug-c106="" class="highlight-div-header"><div _ngcontent-nug-c106="" class="highlight-div-header-left"><div _ngcontent-nug-c106="" class="handle-button expand-button"><div _ngcontent-nug-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nug-c106="" class="highlight-div-header-right"><div _ngcontent-nug-c106="" class="handle-button ai-button"></div><div _ngcontent-nug-c106="" class="handle-button line-button"><div _ngcontent-nug-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nug-c106="" class="handle-button theme-button"><div _ngcontent-nug-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nug-c106="" class="handle-button copy-button"><div _ngcontent-nug-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nug-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[Scan Sample]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">MIN_ZOOM_RATIO</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 例如：变焦比最小限制为1</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">MAX_ZOOM_RATIO</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">4</span>; <span class="hljs-comment">// 例如：变焦比最大限制为4</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">baseZoom</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 当前的变焦比</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">zoomRatio</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 操作后的变焦比</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 绑定手势</span></li><li>    }.<span class="hljs-title function_">gesture</span>(<span class="hljs-title class_">PinchGesture</span>({ <span class="hljs-attr">fingers</span>: <span class="hljs-number">2</span> })</li><li>      .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">(<span class="hljs-params">_: GestureEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// 捏合手势开始</span></li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Pinch start'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pinchGestureStart</span>();</li><li>      })</li><li>      .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (event &amp;&amp; event.<span class="hljs-property">scale</span>) {</li><li>          <span class="hljs-comment">// 捏合手势更新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pinchGestureUpdate</span>(event.<span class="hljs-property">scale</span>);</li><li>        }</li><li>      })</li><li>      .<span class="hljs-title function_">onActionEnd</span>(<span class="hljs-function">(<span class="hljs-params">_: GestureEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// 捏合手势结束</span></li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Pinch end'</span>);</li><li>      })</li><li>    )</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取当前的变焦比。</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} 当前的变焦比。</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">getZoom</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">let</span> zoom = <span class="hljs-number">1</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      zoom = customScan.<span class="hljs-title function_">getZoom</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`getZoom end, zoom: <span class="hljs-subst">${zoom}</span>`</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to getZoom. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error?.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> zoom;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 设置变焦比。</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">zoomRatio</span> - 要设置的变焦比。</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">setZoom</span>(<span class="hljs-attr">zoomRatio</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      customScan.<span class="hljs-title function_">setZoom</span>(zoomRatio);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setZoom end, zoomRatio: <span class="hljs-subst">${zoomRatio}</span>`</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to setZoom. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error?.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 处理捏合手势的开始事件，记录初始变焦比。</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">pinchGestureStart</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseZoom</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getZoom</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">zoomRatio</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseZoom</span>;</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`pinchGestureStart. baseZoom: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.baseZoom}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 处理捏合手势的更新事件，根据手势缩放比例更新当前变焦比。</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">scale</span> - 当前捏合手势的缩放比例。</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pinchGestureUpdate</span>(<span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`pinchGestureUpdate. scale: <span class="hljs-subst">${scale}</span>`</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">tmpZoom</span>: <span class="hljs-built_in">number</span> = scale * <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseZoom</span>;</li><li>    <span class="hljs-keyword">if</span> (scale &gt; <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">if</span> (tmpZoom &lt;= <span class="hljs-variable constant_">MAX_ZOOM_RATIO</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateZoom</span>(tmpZoom);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">if</span> (tmpZoom &lt; <span class="hljs-variable constant_">MIN_ZOOM_RATIO</span>) {</li><li>        tmpZoom = <span class="hljs-variable constant_">MIN_ZOOM_RATIO</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateZoom</span>(tmpZoom);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 更新当前变焦比，如果变化大于阈值0.01则进行设置。</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">tmpZoom</span> - 临时计算的变焦比。</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">updateZoom</span>(<span class="hljs-attr">tmpZoom</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(tmpZoom - <span class="hljs-variable language_">this</span>.<span class="hljs-property">zoomRatio</span>) &gt; <span class="hljs-number">0.01</span>) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`updateZoom. tmpZoom: <span class="hljs-subst">${tmpZoom}</span>`</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">zoomRatio</span> = tmpZoom;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setZoom</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zoomRatio</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div></div></div>