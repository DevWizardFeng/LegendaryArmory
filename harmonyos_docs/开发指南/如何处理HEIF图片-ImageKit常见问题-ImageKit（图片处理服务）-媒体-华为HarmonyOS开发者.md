<h1 _ngcontent-tes-c119="" class="doc-title ng-star-inserted" title="如何处理HEIF图片"> 如何处理HEIF图片 </h1>

<div _ngcontent-tes-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="heif图片介绍">HEIF图片介绍<i class="anchor-icon anchor-icon-link" anchorid="heif图片介绍" tips="复制节点链接"></i></h2>          <p>HEIF图片（High Efficiency Image File Format，HEIF，也称高效图像文件格式），是一个用于单张图像或图像序列的文件格式。它由动态影像专家小组（MPEG）开发，并在MPEG-H Part 12（ISO/IEC 23008-12）中定义。</p>     <p>目前主流的HEIF图片均使用HEVC(H.265)编码，这也是系统当前支持的HEIF图片。HEIF图片在压缩效率上具有明显优势，能够在保证图像质量的同时显著减小文件体积，通常比JPEG节省约50%的存储空间。</p>     <p>系统从API12开始支持HEIF图片的编解码与显示，如果应用基于系统Image Kit、ArkUI Image组件、ArkWeb等模块实现图片处理功能，则可以像处理JPEG、PNG等格式的图片一样，处理HEIF图片。</p>     <p>HEIF图片解码可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-decoding">图片解码指南（ArkTS）</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-source-c">图片解码指南（C/C++）</a>。</p>     <p>HEIF图片显示可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-graphics-display">ArkUI Image组件图片显示</a>。</p>     <p>HEIF图片编码可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-encoding">图片编码指南（ArkTS）</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-packer-c">图片编码指南（C/C++）</a>。</p>     <p>ArkWeb图片上传可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-file-upload">使用Web组件上传文件</a>。</p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="上传heif图片时提示不支持的格式" class="firsth2">上传HEIF图片时提示：“不支持的格式”<i class="anchor-icon anchor-icon-link" anchorid="上传heif图片时提示不支持的格式" tips="复制节点链接"></i></h3>          <p>一般是由于应用对后缀名为.heic、.heif、.HEIC、.HEIF的图片文件做了过滤限制。</p>     <p>对于使用系统图片处理能力的应用，只需要解除过滤限制，即可正常上传、显示HEIF图片。</p>     <p>如果应用没有使用系统提供的图片处理能力，则可能需要做更多适配，一个可选的方案是将HEIF图片转码成JPEG图片。</p>    </div>    <div class="tiledSection">     <h3 id="担心使用heif格式图片存在兼容性问题需使用jpeg或png格式的图片如何操作">担心使用HEIF格式图片存在兼容性问题，需使用JPEG或PNG格式的图片，如何操作<i class="anchor-icon anchor-icon-link" anchorid="担心使用heif格式图片存在兼容性问题需使用jpeg或png格式的图片如何操作" tips="复制节点链接"></i></h3>          <p>可以借助Image Kit的图片编解码能力，将HEIF图片转码成JPEG图片，示例代码如下：</p>     <div _ngcontent-tes-c106="" class="highlight-div"><div _ngcontent-tes-c106="" class="highlight-div-header"><div _ngcontent-tes-c106="" class="highlight-div-header-left"><div _ngcontent-tes-c106="" class="handle-button expand-button"><div _ngcontent-tes-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tes-c106="" class="highlight-div-header-right"><div _ngcontent-tes-c106="" class="handle-button ai-button"></div><div _ngcontent-tes-c106="" class="handle-button line-button"><div _ngcontent-tes-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tes-c106="" class="handle-button theme-button"><div _ngcontent-tes-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tes-c106="" class="handle-button copy-button"><div _ngcontent-tes-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tes-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">reEncoding</span>(<span class="hljs-params">context : Context, fd : <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-comment">// 首先获取图片文件的fd，创建ImageSource。</span></li><li>    <span class="hljs-keyword">const</span> imageSource : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fd);</li><li>    <span class="hljs-comment">// 创建ImagePacker，以便调用图片编码接口。</span></li><li>    <span class="hljs-keyword">const</span> imagePackerApi = image.<span class="hljs-title function_">createImagePacker</span>();</li><li>    <span class="hljs-comment">// 配置图片编码选项：</span></li><li>    <span class="hljs-comment">// format应使用标准的mimetype格式，如："image/jpeg"、"image/png"、"image/heic"；</span></li><li>    <span class="hljs-comment">// quality推荐设置为80，在保证较好的图片质量的同时，可以使编码后的图片文件体积更小；</span></li><li>    <span class="hljs-comment">// needsPackProperties参数，用于控制编码时是否保存图片属性信息。默认值为false，即不保存。</span></li><li>    <span class="hljs-keyword">let</span> packOpts : image.<span class="hljs-property">PackingOption</span> = { <span class="hljs-attr">format</span>:<span class="hljs-string">"image/jpeg"</span>, <span class="hljs-attr">quality</span>:<span class="hljs-number">80</span>, <span class="hljs-attr">needsPackProperties</span>:<span class="hljs-literal">false</span> };</li><li>    <span class="hljs-comment">// 指定图片编码文件的存放路径。</span></li><li>    <span class="hljs-keyword">const</span> filePath : <span class="hljs-built_in">string</span> = context.<span class="hljs-property">cacheDir</span> + <span class="hljs-string">"/result.jpg"</span>;</li><li>    <span class="hljs-keyword">let</span> file = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>    imagePackerApi.<span class="hljs-title function_">packToFile</span>(imageSource, file.<span class="hljs-property">fd</span>, packOpts).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeed to pack the image.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to pack the image. And the error is: '</span> + error);</li><li>    }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">()=&gt;</span>{</li><li>        fs.<span class="hljs-title function_">closeSync</span>(file.<span class="hljs-property">fd</span>);</li><li>    })</li><li>}</li></ol></pre></div></div>     <p>使用CAPI完成图片转码的流程也是类似的，首先创建ImageSource和ImagePacker示例，然后指定编码参数，调用图片编码接口完成转码。详细示例代码可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-packer-c">使用Image_NativeModule完成图片编码</a>。</p>    </div>   </div>   <div></div></div>