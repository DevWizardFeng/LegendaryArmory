<h1 _ngcontent-omr-c119="" class="doc-title ng-star-inserted" title="媒体数据解析"> 媒体数据解析 </h1>

<div _ngcontent-omr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>开发者可以调用本模块的Native API接口，完成媒体数据的解封装相关操作，即从比特流数据中取出音频、视频、字幕等媒体sample，获得DRM相关信息。</p>    <p>当前支持的数据输入类型有：远程连接(http协议)和文件描述符(fd)。</p>    <p>当前支持的解封装格式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avcodec-support-formats#媒体数据解析">AVCodec支持的格式</a>。</p>    <p><strong>适用场景</strong>：</p>    <ul>     <li>      <p>播放</p>      <p>播放媒体文件时，需要先对媒体流进行解封装，然后使用解封装获取的sample进行解码和播放。</p></li>     <li>      <p>音视频编辑</p>      <p>编辑媒体文件时，需要先对媒体流进行解封装，获取到指定sample进行编辑。</p></li>     <li>      <p>媒体文件格式转换（转封装）</p>      <p>媒体文件格式转换时，需要先对媒体流进行解封装，然后按需将媒体流封装至新的格式文件内。</p></li>    </ul>    <div class="tiledSection">     <h2 id="开发指导">开发指导<i class="anchor-icon anchor-icon-link" anchorid="开发指导" tips="复制节点链接"></i></h2>          <p>详细的API说明参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avdemuxer" target="_blank">AVDemuxer</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource" target="_blank">AVSource</a></p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>调用解封装能力解析网络播放路径，需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>：ohos.permission.INTERNET</li>        <li>调用解封装能力解析本地文件，需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">向用户申请授权</a>：ohos.permission.READ_MEDIA</li>        <li>如果使用ResourceManager.getRawFd打开HAP资源文件描述符，使用方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getrawfd9" target="_blank">ResourceManager API参考</a></li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="在-cmake-脚本中链接动态库" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在-cmake-脚本中链接动态库" tips="复制节点链接"></i></h3>          <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_codecbase.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_avdemuxer.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_avsource.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_core.so)</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>上述'sample'字样仅为示例，此处由开发者根据实际工程目录自定义。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>添加头文件。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avdemuxer.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avsource.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcodec_base.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avformat.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avbuffer.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>创建资源管理实例。</p>       <p>开发者HAP中使用open获取fd时，filepath需要转换为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory#应用沙箱路径和真实物理路径的对应关系">沙箱路径</a>，才能获取沙盒资源。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建文件操作符 fd，打开时对文件实例必须有读权限（filePath 为待解封装文件路径，需预置文件，保证路径指向的文件存在）。</span></li><li>std::string filePath = <span class="hljs-string">"test.mp4"</span>;</li><li><span class="hljs-type">int32_t</span> fd = <span class="hljs-built_in">open</span>(filePath.<span class="hljs-built_in">c_str</span>(), O_RDONLY);</li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">stat</span> fileStatus {};</li><li><span class="hljs-type">int64_t</span> fileSize = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span>(filePath.<span class="hljs-built_in">c_str</span>(), &amp;fileStatus) == <span class="hljs-number">0</span>) {</li><li>   fileSize = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int64_t</span>&gt;(fileStatus.st_size);</li><li>} <span class="hljs-keyword">else</span> {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get stat failed"</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 为 fd 资源文件创建 source 资源实例, 传入 offset 不为文件起始位置或 size 不为文件大小时，可能会因不能获取完整数据导致 source 创建失败、或后续解封装失败等问题。</span></li><li>OH_AVSource *source = <span class="hljs-built_in">OH_AVSource_CreateWithFD</span>(fd, <span class="hljs-number">0</span>, fileSize);</li><li><span class="hljs-keyword">if</span> (source == <span class="hljs-literal">nullptr</span>) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"create source failed"</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 为 uri 资源文件创建 source 资源实例（可选）。</span></li><li><span class="hljs-comment">// OH_AVSource *source = OH_AVSource_CreateWithURI(uri);</span></li><li>
</li><li><span class="hljs-comment">// 为自定义数据源创建 source 资源实例（可选）。使用该方式前，需要先实现AVSourceReadAt接口函数实现。</span></li><li><span class="hljs-comment">// 当使用OH_AVSource_CreateWithDataSource时需要补充g_filePath。</span></li><li><span class="hljs-comment">// g_filePath = filePath ;</span></li><li><span class="hljs-comment">// OH_AVDataSource dataSource = {fileSize, AVSourceReadAt};</span></li><li><span class="hljs-comment">// OH_AVSource *source = OH_AVSource_CreateWithDataSource(&amp;dataSource);</span></li></ol></pre></div></div>       <p>AVSourceReadAt接口函数，需要放在创建资源管理实例前实现：</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 添加头文件。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span></li></ol></pre></div></div>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">g_filePath</span>;</li><li>
</li><li><span class="hljs-keyword">enum</span> <span class="hljs-title class_">MediaDataSourceError</span> : <span class="hljs-title class_">int32_t</span> {</li><li>   <span class="hljs-variable">SOURCE_ERROR_IO</span> = -<span class="hljs-number">2</span>,</li><li>   <span class="hljs-variable">SOURCE_ERROR_EOF</span> = -<span class="hljs-number">1</span></li><li>};</li><li>
</li><li><span class="hljs-variable">int32_t</span> <span class="hljs-title function_">AVSourceReadAt</span>(<span class="hljs-variable">OH_AVBuffer</span> *<span class="hljs-variable">data</span>, <span class="hljs-variable">int32_t</span> <span class="hljs-variable">length</span>, <span class="hljs-variable">int64_t</span> <span class="hljs-variable">pos</span>)</li><li>{</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">data</span> == <span class="hljs-variable">nullptr</span>) {</li><li>      <span class="hljs-title function_">printf</span>(<span class="hljs-string">"AVSourceReadAt : data is nullptr!\n"</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">MediaDataSourceError</span>::<span class="hljs-title class_">SOURCE_ERROR_IO</span>;</li><li>   }</li><li>
</li><li>   <span class="hljs-variable">std</span>::<span class="hljs-title class_">ifstream</span> <span class="hljs-title class_">infile</span>(<span class="hljs-title class_">g_filePath</span>, <span class="hljs-variable">std</span>::<span class="hljs-variable">ofstream</span>::<span class="hljs-title class_">binary</span>);</li><li>   <span class="hljs-keyword">if</span> (!<span class="hljs-variable">infile</span>.<span class="hljs-title function_">is_open</span>()) {</li><li>      <span class="hljs-title function_">printf</span>(<span class="hljs-string">"AVSourceReadAt : open file failed! file:%s\n"</span>, <span class="hljs-variable">g_filePath</span>.<span class="hljs-title function_">c_str</span>());</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">MediaDataSourceError</span>::<span class="hljs-title class_">SOURCE_ERROR_IO</span>;  <span class="hljs-comment">// 打开文件失败。</span></li><li>   }</li><li>
</li><li>   <span class="hljs-variable">infile</span>.<span class="hljs-title function_">seekg</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">std</span>::<span class="hljs-title class_">ios</span>::<span class="hljs-title class_">end</span>);</li><li>   <span class="hljs-variable">int64_t</span> <span class="hljs-variable">fileSize</span> = <span class="hljs-variable">infile</span>.<span class="hljs-title function_">tellg</span>();</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">pos</span> &gt;= <span class="hljs-variable">fileSize</span>) {</li><li>      <span class="hljs-title function_">printf</span>(<span class="hljs-string">"AVSourceReadAt : pos over or equals file size!\n"</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">MediaDataSourceError</span>::<span class="hljs-title class_">SOURCE_ERROR_EOF</span>;  <span class="hljs-comment">// pos已经是文件末尾位置，无法读取。</span></li><li>   }</li><li>
</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">pos</span> + <span class="hljs-variable">length</span> &gt; <span class="hljs-variable">fileSize</span>) {</li><li>      <span class="hljs-variable">length</span> = <span class="hljs-variable">fileSize</span> - <span class="hljs-variable">pos</span>;    <span class="hljs-comment">// pos+length长度超过文件大小时，读取从pos到文件末尾的数据。</span></li><li>   }</li><li>
</li><li>   <span class="hljs-variable">infile</span>.<span class="hljs-title function_">seekg</span>(<span class="hljs-variable">pos</span>, <span class="hljs-variable">std</span>::<span class="hljs-title class_">ios</span>::<span class="hljs-title class_">beg</span>);</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-title function_">printf</span>(<span class="hljs-string">"AVSourceReadAt : raed length less than zero!\n"</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">MediaDataSourceError</span>::<span class="hljs-title class_">SOURCE_ERROR_IO</span>;</li><li>   }</li><li>   <span class="hljs-variable">char</span>* <span class="hljs-variable">buffer</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">char</span>[<span class="hljs-variable">length</span>];</li><li>   <span class="hljs-variable">infile</span>.<span class="hljs-title function_">read</span>(<span class="hljs-variable">buffer</span>, <span class="hljs-variable">length</span>);</li><li>   <span class="hljs-variable">infile</span>.<span class="hljs-title function_">close</span>();</li><li>
</li><li>   <span class="hljs-title function_">memcpy</span>(<span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">char</span> *&gt;(<span class="hljs-title function_">OH_AVBuffer_GetAddr</span>(<span class="hljs-variable">data</span>)),</li><li>      <span class="hljs-variable">buffer</span>, <span class="hljs-variable">length</span>);</li><li>   <span class="hljs-variable">delete</span>[] <span class="hljs-variable">buffer</span>;</li><li>
</li><li>   <span class="hljs-keyword">return</span> <span class="hljs-variable">length</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>创建解封装器实例。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 为资源实例创建对应的解封装器。</span></li><li>OH_AVDemuxer *demuxer = <span class="hljs-built_in">OH_AVDemuxer_CreateWithSource</span>(source);</li><li><span class="hljs-keyword">if</span> (demuxer == <span class="hljs-literal">nullptr</span>) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"create demuxer failed"</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avdemuxer-h#demuxer_mediakeysysteminfocallback" target="_blank">DRM信息监听函数</a>（可选，若非DRM码流或已获得<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drm-drm-mediakeysysteminfo" target="_blank">DRM信息</a>，可跳过此步）。</p>       <p>设置DRM信息监听的接口，回调函数支持返回解封装器实例，适用于多个解封装器场景。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// DRM信息监听回调OnDrmInfoChangedWithObj实现。</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">OnDrmInfoChangedWithObj</span><span class="hljs-params">(OH_AVDemuxer *demuxer, DRM_MediaKeySystemInfo *drmInfo)</span></li><li>{</li><li>   <span class="hljs-comment">// 解析DRM信息，包括数量、DRM类型及对应pssh。</span></li><li>}</li><li>
</li><li><span class="hljs-type">Demuxer_MediaKeySystemInfoCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> &amp;OnDrmInfoChangedWithObj;</li><li><span class="hljs-type">Drm_ErrCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_AVDemuxer_SetDemuxerMediaKeySystemInfoCallback(demuxer, callback);</li></ol></pre></div></div>       <p>在监听到DRM信息后，也可主动调用获取DRM信息(uuid及对应pssh)接口。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>DRM_MediaKeySystemInfo mediaKeySystemInfo;</li><li><span class="hljs-built_in">OH_AVDemuxer_GetMediaKeySystemInfo</span>(demuxer, &amp;mediaKeySystemInfo);</li></ol></pre></div></div>       <p>在获取、解析DRM信息后，需创建对应DRM解决方案的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/drm-c-dev-guide">MediaKeySystem、MediaKeySession</a>，获取DRM许可证等。并根据需要设置音频解密配置(详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-decoding#开发步骤">音频解码开发指南开发步骤</a>第4步)、设置视频解密配置（详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/video-decoding#surface模式">视频解码开发指南开发步骤Surface模式</a>第5步或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/video-decoding#buffer模式">Buffer模式</a>第4步），实现DRM内容解密。</p></li>      <li>       <p>获取文件信息。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取文件用户自定义属性（可选，若用户无需获取自定义属性，可跳过此步）。</span></li><li><span class="hljs-comment">// 从文件 source 获取用户自定义属性信息。</span></li><li>OH_AVFormat *customMetadataFormat = <span class="hljs-built_in">OH_AVSource_GetCustomMetadataFormat</span>(source);</li><li><span class="hljs-keyword">if</span> (customMetadataFormat == <span class="hljs-literal">nullptr</span>) {</li><li>   <span class="hljs-comment">// 需释放前置流程资源，参考第10步。</span></li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get custom metadata format failed"</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 注意事项：</span></li><li><span class="hljs-comment">// 1. customKey需与封装时写入的key完全一致（含完整命名层级），</span></li><li><span class="hljs-comment">//    示例key仅为演示，实际应替换为用户自定义的字符串。</span></li><li><span class="hljs-comment">//    例：封装时写入key为"com.openharmony.custom.meta.abc.efg"，</span></li><li><span class="hljs-comment">//       获取时必须使用完整key，截断使用"com.openharmony.custom.meta.abc"会失败。</span></li><li><span class="hljs-comment">// 2. value类型需与封装时数据类型匹配，示例为string类型。其余类型需调用对应接口，支持int/float类型；API version 20起，支持buffer类型。</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *customKey = <span class="hljs-string">"com.openharmony.custom.meta.string"</span>; <span class="hljs-comment">// 替换为实际封装时使用的完整key。</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *customValue;</li><li><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetStringValue</span>(customMetadataFormat, customKey, &amp;customValue)) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get custom metadata from custom metadata format failed"</span>);</li><li>}</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(customMetadataFormat);</li><li>customMetadataFormat = <span class="hljs-literal">nullptr</span>;</li><li>
</li><li><span class="hljs-comment">// 获取文件轨道数（可选，若用户已知轨道信息，可跳过此步）。</span></li><li><span class="hljs-comment">// 从文件 source 信息获取文件轨道数，用户可通过该接口获取文件级别属性，具体支持信息参考附表 1。</span></li><li>OH_AVFormat *sourceFormat = <span class="hljs-built_in">OH_AVSource_GetSourceFormat</span>(source);</li><li><span class="hljs-keyword">if</span> (sourceFormat == <span class="hljs-literal">nullptr</span>) {</li><li>   <span class="hljs-comment">// 需释放前置流程资源，参考第10步。</span></li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get source format failed"</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">int32_t</span> trackCount = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetIntValue</span>(sourceFormat, OH_MD_KEY_TRACK_COUNT, &amp;trackCount)) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track count from source format failed"</span>);</li><li>}</li><li><span class="hljs-keyword">if</span> (trackCount == <span class="hljs-number">0</span>) {</li><li>   <span class="hljs-comment">// 文件中无轨道，需根据业务做其他处理。</span></li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"no track"</span>);</li><li>}</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(sourceFormat);</li><li>sourceFormat = <span class="hljs-literal">nullptr</span>;</li></ol></pre></div></div></li>      <li>       <p>获取轨道index及信息（可选，若用户已知轨道信息，可跳过此步）。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint32_t</span> audioTrackIndex = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">uint32_t</span> videoTrackIndex = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int32_t</span> w = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int32_t</span> h = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int64_t</span> bitRate = <span class="hljs-number">0</span>; <span class="hljs-comment">// 配置比特率，单位为bps。</span></li><li><span class="hljs-type">double</span> frameRate = <span class="hljs-number">0.0</span>;</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* mimetype = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">uint8_t</span> *codecConfig = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">size_t</span> bufferSize = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int32_t</span> trackType;</li><li><span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> index = <span class="hljs-number">0</span>; index &lt; (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(trackCount)); index++) {</li><li>   <span class="hljs-comment">// 获取轨道信息，用户可通过该接口获取对应轨道级别属性，具体支持信息参考附表 2。</span></li><li>   OH_AVFormat *trackFormat = <span class="hljs-built_in">OH_AVSource_GetTrackFormat</span>(source, index);</li><li>   <span class="hljs-keyword">if</span> (trackFormat == <span class="hljs-literal">nullptr</span>) {</li><li>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track format failed"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetIntValue</span>(trackFormat, OH_MD_KEY_TRACK_TYPE, &amp;trackType)) {</li><li>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track type from track format failed"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-keyword">if</span> (trackType == OH_MediaType::MEDIA_TYPE_AUXILIARY) {</li><li>      <span class="hljs-type">const</span> <span class="hljs-type">char</span> *referenceType;</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetStringValue</span>(trackFormat, OH_MD_KEY_TRACK_REFERENCE_TYPE, &amp;referenceType)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get reference type from auxiliary track failed"</span>);</li><li>      }</li><li>      <span class="hljs-type">int32_t</span>* referenceIds;</li><li>      <span class="hljs-type">size_t</span> referenceIdsCount;</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetIntBuffer</span>(trackFormat, OH_MD_KEY_TRACK_REFERENCE_TYPE, &amp;referenceIds, &amp;referenceIdsCount)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get reference track ids from auxiliary track failed"</span>);</li><li>      }</li><li>      <span class="hljs-comment">// 根据辅助轨类型处理轨道参考关系。</span></li><li>   }</li><li>   <span class="hljs-built_in">static_cast</span>&lt;OH_MediaType&gt;(trackType) == OH_MediaType::MEDIA_TYPE_AUD ? audioTrackIndex = index : videoTrackIndex = index;</li><li>   <span class="hljs-comment">// 获取视频轨宽高。</span></li><li>   <span class="hljs-keyword">if</span> (trackType == OH_MediaType::MEDIA_TYPE_VID) {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetIntValue</span>(trackFormat, OH_MD_KEY_WIDTH, &amp;w)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track width from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetIntValue</span>(trackFormat, OH_MD_KEY_HEIGHT, &amp;h)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track height from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetLongValue</span>(trackFormat, OH_MD_KEY_BITRATE, &amp;bitRate)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track bitRate from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetDoubleValue</span>(trackFormat, OH_MD_KEY_FRAME_RATE, &amp;frameRate)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track frameRate from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetStringValue</span>(trackFormat, OH_MD_KEY_CODEC_MIME, &amp;mimetype)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track mimetype from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">OH_AVFormat_GetBuffer</span>(trackFormat, OH_MD_KEY_CODEC_CONFIG, &amp;codecConfig, &amp;bufferSize)) {</li><li>         <span class="hljs-built_in">printf</span>(<span class="hljs-string">"get track codecConfig from track format failed"</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">" track width%d, track height：%d, track bitRate：%ld, track frameRate：%f, track mimetype：%s\n"</span>, w, h, bitRate, frameRate, mimetype);</li><li>   }</li><li>   <span class="hljs-built_in">OH_AVFormat_Destroy</span>(trackFormat);</li><li>   trackFormat = <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>添加解封装轨道。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span>(<span class="hljs-built_in">OH_AVDemuxer_SelectTrackByID</span>(demuxer, audioTrackIndex) != AV_ERR_OK){</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"select audio track failed: %d"</span>, audioTrackIndex);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-keyword">if</span>(<span class="hljs-built_in">OH_AVDemuxer_SelectTrackByID</span>(demuxer, videoTrackIndex) != AV_ERR_OK){</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"select video track failed: %d"</span>, videoTrackIndex);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 取消选择轨道（可选）。</span></li><li><span class="hljs-comment">// OH_AVDemuxer_UnselectTrackByID(demuxer, audioTrackIndex);</span></li></ol></pre></div></div></li>      <li>       <p>调整轨道到指定时间点（可选）。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 调整轨道到指定时间点，后续从该时间点进行解封装。</span></li><li><span class="hljs-comment">// 注意：</span></li><li><span class="hljs-comment">// 1. mpegts、mpg 格式文件使用OH_AVDemuxer_SeekToTime功能时，跳转到的位置可能为非关键帧。可在跳转后调用OH_AVDemuxer_ReadSampleBuffer，通过获取到的OH_AVCodecBufferAttr判断当前帧是否为关键帧。若非关键帧影响应用侧显示等功能，可在跳转后循环读取，获取到后续第一帧关键帧后，再进行解码等处理。</span></li><li><span class="hljs-comment">// 2. ogg格式文件使用OH_AVDemuxer_SeekToTime功能时，会跳转到传入时间millisecond所在时间间隔(秒)的起始处，可能会导致一定数量的帧误差。</span></li><li><span class="hljs-comment">// 3. demuxer的seek处理只针对解码行为一致的码流进行处理，如果seek后需要解码器重新配置参数，或者需要重新送入参数集的数据才可以正确解码的码流，seek后可能会出现花屏、解码卡死等问题。</span></li><li><span class="hljs-built_in">OH_AVDemuxer_SeekToTime</span>(demuxer, <span class="hljs-number">0</span>, OH_AVSeekMode::SEEK_MODE_CLOSEST_SYNC);</li></ol></pre></div></div></li>      <li>       <p>开始解封装，循环获取sample（以含音频、视频两轨的文件为例）。</p>       <p>BufferAttr包含的属性：</p>       <ul>        <li>size：sample尺寸；</li>        <li>offset：数据在AVBuffer中的偏移，一般为0；</li>        <li>pts：文件封装的显示时间戳；</li>        <li>flags：sample属性。</li>       </ul>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.8.2.9.4.1.3.1.1" valign="top" width="50%">flag</th>           <th align="left" class="cellrowborder" id="mcps1.3.8.2.9.4.1.3.1.2" valign="top" width="50%">描述</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_NONE</td>           <td class="cellrowborder" valign="top" width="50%">默认。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_EOS</td>           <td class="cellrowborder" valign="top" width="50%">结尾sample，数据为空。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_SYNC_FRAME</td>           <td class="cellrowborder" valign="top" width="50%">IDR帧或I帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_INCOMPLETE_FRAME</td>           <td class="cellrowborder" valign="top" width="50%">非完整的sample，一般由于buffer过小，无法拷贝完整的sample。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_CODEC_DATA</td>           <td class="cellrowborder" valign="top" width="50%">含参数集信息的帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_DISCARD</td>           <td class="cellrowborder" valign="top" width="50%">可丢弃的帧。</td>          </tr>                 </tbody></table></div>       </div>       <p>OH_AVDemuxer_ReadSampleBuffer接口本身可能存在耗时久，取决于文件IO，建议以异步方式进行调用。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 为每个线程定义处理函数。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ReadTrackSamples</span><span class="hljs-params">(OH_AVDemuxer *demuxer, <span class="hljs-type">uint32_t</span> trackIndex, <span class="hljs-type">int32_t</span> buffer_size,</span></span></li><li><span class="hljs-function">                      std::atomic&lt;<span class="hljs-type">bool</span>&gt;&amp; isEnd, std::atomic&lt;<span class="hljs-type">bool</span>&gt;&amp; threadFinished)</span></li><li><span class="hljs-function"></span>{</li><li>   <span class="hljs-comment">// 创建缓冲区。</span></li><li>   OH_AVBuffer *buffer = <span class="hljs-built_in">OH_AVBuffer_Create</span>(buffer_size);</li><li>   <span class="hljs-keyword">if</span> (buffer == <span class="hljs-literal">nullptr</span>) {</li><li>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Create buffer failed for track %d\n"</span>, trackIndex);</li><li>      threadFinished.<span class="hljs-built_in">store</span>(<span class="hljs-literal">true</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   OH_AVCodecBufferAttr info;</li><li>   <span class="hljs-type">int32_t</span> ret;</li><li>
</li><li>   <span class="hljs-keyword">while</span> (!isEnd.<span class="hljs-built_in">load</span>()) {</li><li>      ret = <span class="hljs-built_in">OH_AVDemuxer_ReadSampleBuffer</span>(demuxer, trackIndex, buffer);</li><li>      <span class="hljs-keyword">if</span> (ret == AV_ERR_OK) {</li><li>            <span class="hljs-built_in">OH_AVBuffer_GetBufferAttr</span>(buffer, &amp;info);</li><li>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Track %d sample size: %d\n"</span>, trackIndex, info.size);</li><li>            <span class="hljs-comment">// 检查EOS标志。</span></li><li>            <span class="hljs-keyword">if</span> (info.flags == OH_AVCodecBufferFlags::AVCODEC_BUFFER_FLAGS_EOS) {</li><li>               isEnd.<span class="hljs-built_in">store</span>(<span class="hljs-literal">true</span>);</li><li>            }</li><li>            <span class="hljs-comment">// 处理缓冲区数据（这里可以根据需要实现解码逻辑）。</span></li><li>      } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Read sample failed for track %d\n"</span>, trackIndex);</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>   }</li><li>   <span class="hljs-comment">// 销毁缓冲区。</span></li><li>   <span class="hljs-built_in">OH_AVBuffer_Destroy</span>(buffer);</li><li>   buffer = <span class="hljs-literal">nullptr</span>;</li><li>   threadFinished.<span class="hljs-built_in">store</span>(<span class="hljs-literal">true</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 根据需求计算合适的缓冲区大小。</span></li><li><span class="hljs-type">int32_t</span> audioBufferSize = <span class="hljs-number">4096</span>;  <span class="hljs-comment">// 典型音频缓冲区大小。</span></li><li><span class="hljs-type">int32_t</span> videoBufferSize = w * h * <span class="hljs-number">3</span> &gt;&gt; <span class="hljs-number">1</span>;  <span class="hljs-comment">// 原始视频缓冲区大小。</span></li><li>
</li><li><span class="hljs-comment">// 创建原子变量用于线程通信。</span></li><li>std::atomic&lt;<span class="hljs-type">bool</span>&gt; audioIsEnd{<span class="hljs-literal">false</span>}, videoIsEnd{<span class="hljs-literal">false</span>}; <span class="hljs-comment">// 表示流是否结束。</span></li><li>std::atomic&lt;<span class="hljs-type">bool</span>&gt; audioThreadFinished{<span class="hljs-literal">false</span>}, videoThreadFinished{<span class="hljs-literal">false</span>}; <span class="hljs-comment">// 表示线程是否暂停。</span></li><li>
</li><li><span class="hljs-comment">// 创建线程。</span></li><li><span class="hljs-function">std::thread <span class="hljs-title">audioThread</span><span class="hljs-params">(ReadTrackSamples, demuxer, audioTrackIndex, audioBufferSize,</span></span></li><li><span class="hljs-function">                        std::ref(audioIsEnd), std::ref(audioThreadFinished))</span>;</li><li><span class="hljs-function">std::thread <span class="hljs-title">videoThread</span><span class="hljs-params">(ReadTrackSamples, demuxer, videoTrackIndex, videoBufferSize,</span></span></li><li><span class="hljs-function">                        std::ref(videoIsEnd), std::ref(videoThreadFinished))</span>;</li><li>audioThread.<span class="hljs-built_in">join</span>();</li><li>videoThread.<span class="hljs-built_in">join</span>();</li></ol></pre></div></div></li>      <li>       <p>销毁解封装实例。</p>       <div _ngcontent-omr-c106="" class="highlight-div"><div _ngcontent-omr-c106="" class="highlight-div-header"><div _ngcontent-omr-c106="" class="highlight-div-header-left"><div _ngcontent-omr-c106="" class="handle-button expand-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-omr-c106="" class="highlight-div-header-right"><div _ngcontent-omr-c106="" class="handle-button ai-button"></div><div _ngcontent-omr-c106="" class="handle-button line-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-omr-c106="" class="handle-button theme-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-omr-c106="" class="handle-button copy-button"><div _ngcontent-omr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-omr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 需要用户调用 OH_AVSource_Destroy 接口成功后，手动将实例置为nullptr，对同一实例重复调用 OH_AVSource_Destroy 会导致程序错误。</span></li><li><span class="hljs-keyword">if</span> (<span class="hljs-built_in">OH_AVSource_Destroy</span>(source) != AV_ERR_OK) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"destroy source pointer error"</span>);</li><li>}</li><li>source = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 需要用户调用 OH_AVDemuxer_Destroy 接口成功后，手动将实例置为nullptr，对同一实例重复调用 OH_AVDemuxer_Destroy 会导致程序错误。</span></li><li><span class="hljs-keyword">if</span> (<span class="hljs-built_in">OH_AVDemuxer_Destroy</span>(demuxer) != AV_ERR_OK) {</li><li>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">"destroy demuxer pointer error"</span>);</li><li>}</li><li>demuxer = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">close</span>(fd);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="附表">附表<i class="anchor-icon anchor-icon-link" anchorid="附表" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="文件级别属性支持范围" class="firsth2">文件级别属性支持范围<i class="anchor-icon anchor-icon-link" anchorid="文件级别属性支持范围" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>正常解析时才可以获取对应属性数据，如果文件信息错误或缺失，将导致解析异常，无法获取数据。</p>       <p>当前GBK格式字符集数据会转换为UTF8提供，其他类型字符集如果需要转换为UTF8格式使用，需要调用方自行转换，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/icu4c" target="_blank">icu4c</a>。</p>       <p>数据类型及详细取值范围参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-codecbase#媒体数据键值对" target="_blank">媒体数据键值对</a>。</p>      </div></div></div>     <p><strong>表1</strong> 文件级别属性支持范围</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_TITLE</td>         <td class="cellrowborder" valign="top" width="50%">文件标题的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_ARTIST</td>         <td class="cellrowborder" valign="top" width="50%">文件艺术家的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_ALBUM</td>         <td class="cellrowborder" valign="top" width="50%">文件专辑的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_ALBUM_ARTIST</td>         <td class="cellrowborder" valign="top" width="50%">文件专辑艺术家的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_DATE</td>         <td class="cellrowborder" valign="top" width="50%">文件日期的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_COMMENT</td>         <td class="cellrowborder" valign="top" width="50%">文件注释的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_GENRE</td>         <td class="cellrowborder" valign="top" width="50%">文件流派的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_COPYRIGHT</td>         <td class="cellrowborder" valign="top" width="50%">文件版权的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_LANGUAGE</td>         <td class="cellrowborder" valign="top" width="50%">文件语言的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_DESCRIPTION</td>         <td class="cellrowborder" valign="top" width="50%">文件描述的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_LYRICS</td>         <td class="cellrowborder" valign="top" width="50%">文件歌词的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_TRACK_COUNT</td>         <td class="cellrowborder" valign="top" width="50%">文件轨道数量的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_DURATION</td>         <td class="cellrowborder" valign="top" width="50%">文件时长的键</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_MD_KEY_START_TIME</td>         <td class="cellrowborder" valign="top" width="50%">文件起始时间的键</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="轨道级别属性支持范围">轨道级别属性支持范围<i class="anchor-icon anchor-icon-link" anchorid="轨道级别属性支持范围" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>正常解析时才可以获取对应属性数据；如果文件信息错误或缺失，将导致解析异常，无法获取数据。</p>       <p>辅助轨属性范围与实际媒体类型（音频、视频）保持一致。</p>       <p>数据类型及详细取值范围参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-codecbase#媒体数据键值对" target="_blank">媒体数据键值对</a>。</p>      </div></div></div>     <p><strong>表2</strong> 轨道级别属性支持范围</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.1" valign="top" width="16.666666666666664%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.2" valign="top" width="16.666666666666664%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.3" valign="top" width="16.666666666666664%">视频轨支持</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.4" valign="top" width="16.666666666666664%">音频轨支持</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.5" valign="top" width="16.666666666666664%">字幕轨支持</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.7.1.6" valign="top" width="16.666666666666664%">辅助轨支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_CODEC_MIME</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">码流编解码器类型的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_TRACK_TYPE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">码流媒体类型的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_TRACK_START_TIME</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">码流起始时间的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_BITRATE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">码流比特率的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_LANGUAGE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">码流语言类型的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_CODEC_CONFIG</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">编解码器特定数据的键，视频中表示传递参数集，音频中表示传递解码器的参数配置信息。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_WIDTH</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流宽度的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_HEIGHT</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流高度的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_FRAME_RATE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流帧率的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_ROTATION</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流旋转角度的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_VIDEO_SAR</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流样本长宽比的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_PROFILE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流编码档次，只针对h265码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_RANGE_FLAG</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流视频YUV值域标志的键，只针对h265码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_COLOR_PRIMARIES</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流视频色域的键，只针对h265码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_TRANSFER_CHARACTERISTICS</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流视频传递函数的键，只针对h265码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_MATRIX_COEFFICIENTS</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频矩阵系数的键，只针对h265码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_VIDEO_IS_HDR_VIVID</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">视频流标记是否为HDR Vivid的键，只针对HDR Vivid码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_AUD_SAMPLE_RATE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">音频流采样率的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_AUD_CHANNEL_COUNT</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">音频流通道数的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_CHANNEL_LAYOUT</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">音频流所需编码通道布局的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_AUDIO_SAMPLE_FORMAT</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">音频流样本格式的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_AAC_IS_ADTS</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">aac格式的键，只针对aac码流使用。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_BITS_PER_CODED_SAMPLE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">音频流每个编码样本位数的键。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_REFERENCE_TRACK_IDS</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">媒体文件轨道间参考、被参考关系。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_TRACK_REFERENCE_TYPE</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">媒体文件辅助轨类型。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="16.666666666666664%">OH_MD_KEY_TRACK_DESCRIPTION</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">媒体文件辅助轨描述信息。</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">-</td>         <td class="cellrowborder" valign="top" width="16.666666666666664%">√</td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>