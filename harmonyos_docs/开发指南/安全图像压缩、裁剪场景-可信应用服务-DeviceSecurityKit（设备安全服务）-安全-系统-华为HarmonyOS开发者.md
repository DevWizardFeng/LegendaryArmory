<h1 _ngcontent-txs-c119="" class="doc-title ng-star-inserted" title="安全图像压缩、裁剪场景"> 安全图像压缩、裁剪场景 </h1>

<div _ngcontent-txs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1393224216108">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1393224216108" tips="复制节点链接"></i></h2>          <p>在安全图像支持压缩、裁剪场景中，通过创建证明密钥、打开证明会话的方式，对从<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-securecamera">安全摄像头</a>获取的图像数据进行压缩、裁剪处理并重新签名，降低安全摄像头的原始图像大小，同时也能确保图像数据的真实性和完整性。</p>    </div>    <div class="tiledSection">     <h2 id="section104414218221">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section104414218221" tips="复制节点链接"></i></h2>          <p>该特性需要设备支持安全摄像头功能，其支持的设备范围与安全摄像头场景保持一致。开发者可以参考安全摄像头场景的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-securecamera#section104414218221">约束与限制</a>，判断设备是否支持安全摄像头。</p>    </div>    <div class="tiledSection">     <h2 id="section1847163365117">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1847163365117" tips="复制节点链接"></i></h2>          <p><span><img height="716.2857844511178" originheight="1090" originwidth="1400" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115043.54788638925890175756429478434966:50001231000000:2800:AB78751DAA36CFFA0B183843A61B48142AA4EB44F40D061FA7B5913591DCA53F.jpg" title="点击放大" width="920"></span></p>    </div>    <div class="tiledSection">     <h2 id="section31055391019">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section31055391019" tips="复制节点链接"></i></h2>          <p>接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="64.64%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="35.36%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="64.64%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section81796536265" target="_blank">createAttestKey</a>(options: AttestOptions): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="35.36%">          <p>创建证明密钥。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="64.64%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section166716269293" target="_blank">initializeAttestContext</a>(userData: string, options: AttestOptions): Promise&lt;AttestReturnResult&gt;</p></td>         <td class="cellrowborder" valign="top" width="35.36%">          <p>初始化证明会话。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="64.64%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18667940102912" target="_blank">finalizeAttestContext</a>(options: AttestOptions): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="35.36%">          <p>结束证明会话。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="64.64%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section19260221152819" target="_blank">destroyAttestKey</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="35.36%">          <p>销毁证明密钥。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="64.64%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section4271646181318" target="_blank">procSecImageTransform</a>(srcSecImage: ArrayBuffer, Options: SecImageProcOptions): Promise&lt;SecImageBuffer&gt;</p></td>         <td class="cellrowborder" valign="top" width="35.36%">          <p>处理安全图像压缩、裁剪操作</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section57895438144">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section57895438144" tips="复制节点链接"></i></h2>          <ol>      <li><span>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-securecamera">安全摄像头开发指导</a>，获取安全图像。</span></li>      <li><span>创建证明密钥和初始化证明会话。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>只有创建证明密钥成功后，才能初始化证明会话。</li>          <li>证明密钥的有效期为7天，为了避免反复创建证明密钥，建议先调用初始化证明会话，如果初始化失败，再去销毁、创建证明密钥，然后重新初始化证明密钥。</li>          <li>调用initializeAttestContext初始化证明会话时，userData的长度必须在16到127 Bytes之间。</li>         </ul>        </div></div></div>       <div class="p">        <div _ngcontent-txs-c106="" class="highlight-div"><div _ngcontent-txs-c106="" class="highlight-div-header"><div _ngcontent-txs-c106="" class="highlight-div-header-left"><div _ngcontent-txs-c106="" class="handle-button expand-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-txs-c106="" class="highlight-div-header-right"><div _ngcontent-txs-c106="" class="handle-button ai-button"></div><div _ngcontent-txs-c106="" class="handle-button line-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-txs-c106="" class="handle-button theme-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-txs-c106="" class="handle-button copy-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-txs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建证明密钥的参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">createProperties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_ALGORITHM</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestKeyAlg</span>.<span class="hljs-property">ATTEST_ALG_ECC</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_KEY_SIZE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestKeySize</span>.<span class="hljs-property">ATTEST_ECC_KEY_SIZE_256</span></li><li>  }</li><li>];</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">createOptions</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: createProperties</li><li>};</li><li><span class="hljs-comment">// 初始化证明会话的参数</span></li><li><span class="hljs-keyword">const</span> userData = <span class="hljs-string">"trusted_app_service_demo"</span>; <span class="hljs-comment">// 示例值，实际值请自行生成，长度在16到127 Bytes之间</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">initProperties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_TYPE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestType</span>.<span class="hljs-property">ATTEST_TYPE_SECIMAGE_PROCESS</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_ID</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-number">0</span>) <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">此参数在安全图像压缩、裁剪场景下不生效</span></span></li><li>  }</li><li>];</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">initOptions</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: initProperties</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">certChainList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 创建证明密钥</span></li><li>  <span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">createAttestKey</span>(createOptions);</li><li>  <span class="hljs-comment">// 初始化证明会话</span></li><li>  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">initializeAttestContext</span>(userData, initOptions);</li><li>  certChainList = result.<span class="hljs-property">certChains</span>;</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">const</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to initialize attest context, message:<span class="hljs-subst">${error.message}</span>, code:<span class="hljs-subst">${error.code}</span>`</span>);</li><li>}</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>请求对安全图像进行压缩、裁剪处理</span>       <p></p>       <ul>        <li>以压缩场景为例：         <div _ngcontent-txs-c106="" class="highlight-div"><div _ngcontent-txs-c106="" class="highlight-div-header"><div _ngcontent-txs-c106="" class="highlight-div-header-left"><div _ngcontent-txs-c106="" class="handle-button expand-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-txs-c106="" class="highlight-div-header-right"><div _ngcontent-txs-c106="" class="handle-button ai-button"></div><div _ngcontent-txs-c106="" class="handle-button line-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-txs-c106="" class="handle-button theme-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-txs-c106="" class="handle-button copy-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-txs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> srcSecImageBuffer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>);<span class="hljs-comment">// 实际使用请替换为Camera Kit获取到的安全图像buffer</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">SecImageProcParams</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_PROC_OPERATION</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcOperation</span>.<span class="hljs-property">SECIMAGE_COMPRESSION</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_SRC_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像压缩、裁剪命令输入的原始图像格式都为：YUV420 NV21 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_DEST_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_JPEG</span>, <span class="hljs-comment">// 安全图像压缩命令返回的图像格式为：JPEG 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_COMPRESSION_QUALITY</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-number">90</span>, <span class="hljs-comment">// 实际使用请替换为业务场景需要的压缩质量</span></li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">procParams</span>: trustedAppService.<span class="hljs-property">SecImageProcParamsArray</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">procSecImageTransform</span>(srcSecImageBuffer, procParams).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">SecImageBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> returnSecImageBuffer = returnResult.<span class="hljs-property">secImage</span>;</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to process secureImage cropping, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div></li>       </ul>       <div class="p">        <ul>         <li>以裁剪场景为例：          <div _ngcontent-txs-c106="" class="highlight-div"><div _ngcontent-txs-c106="" class="highlight-div-header"><div _ngcontent-txs-c106="" class="highlight-div-header-left"><div _ngcontent-txs-c106="" class="handle-button expand-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-txs-c106="" class="highlight-div-header-right"><div _ngcontent-txs-c106="" class="handle-button ai-button"></div><div _ngcontent-txs-c106="" class="handle-button line-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-txs-c106="" class="handle-button theme-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-txs-c106="" class="handle-button copy-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-txs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> srcSecImageBuffer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>);<span class="hljs-comment">// 实际使用请替换为Camera Kit获取到的安全图像buffer</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">SecImageProcParams</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_PROC_OPERATION</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcOperation</span>.<span class="hljs-property">SECIMAGE_CROPPING</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_SRC_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像压缩、裁剪命令输入的原始图像格式都为：YUV420 NV21 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_DEST_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像裁剪命令返回的图像格式为：YUV420 NV21 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_CROP_REGION</span>,</li><li>    <span class="hljs-attr">value</span>: { x : <span class="hljs-number">0</span>, y ： <span class="hljs-number">0</span>, width : <span class="hljs-number">320</span>, height : <span class="hljs-number">240</span> }, <span class="hljs-comment">// 实际使用请替换为业务场景需要的裁剪区域范围</span></li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">procParams</span>: trustedAppService.<span class="hljs-property">SecImageProcParamsArray</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">procSecImageTransform</span>(srcSecImageBuffer, procParams).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">SecImageBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> returnSecImageBuffer = returnResult.<span class="hljs-property">secImage</span>;</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to process secureImage cropping, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div></li>        </ul>       </div>       <p></p></li>      <li><span>结束证明会话。</span>       <p></p>       <div _ngcontent-txs-c106="" class="highlight-div"><div _ngcontent-txs-c106="" class="highlight-div-header"><div _ngcontent-txs-c106="" class="highlight-div-header-left"><div _ngcontent-txs-c106="" class="handle-button expand-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-txs-c106="" class="highlight-div-header-right"><div _ngcontent-txs-c106="" class="handle-button ai-button"></div><div _ngcontent-txs-c106="" class="handle-button line-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-txs-c106="" class="handle-button theme-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-txs-c106="" class="handle-button copy-button"><div _ngcontent-txs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-txs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 结束证明会话的参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">finalProperties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_TYPE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestType</span>.<span class="hljs-property">ATTEST_TYPE_SECIMAGE_PROCESS</span></li><li>  }</li><li>];</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">finalOptions</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: finalProperties,</li><li>};</li><li><span class="hljs-comment">// 结束证明会话</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">finalizeAttestContext</span>(finalOptions);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">const</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to finalize attest context, message:<span class="hljs-subst">${error.message}</span>, code:<span class="hljs-subst">${error.code}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <p>如果需要销毁证明密钥，请在结束证明会话后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section19260221152819" target="_blank">destroyAttestKey</a>接口。由于安全摄像头、安全地理位置和安全图像压缩、裁剪共用同一个证明密钥，销毁前需要保证其余场景功能未在使用该证明密钥。</p>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>