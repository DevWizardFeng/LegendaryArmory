<h1 _ngcontent-xrh-c119="" class="doc-title ng-star-inserted" title="安全配置指南"> 安全配置指南 </h1>

<div _ngcontent-xrh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000002140605530"><p id="ZH-CN_TOPIC_0000002510293659__p790123813594">为了保障用户在使用ohpm-repo过程中更加安全可靠，我们收集如下推荐安全配置项，用户可以根据自己的需要采纳配置。</p> <div class="tiledSection"><h2 id="section778835455512">最小权限启动<i class="anchor-icon anchor-icon-link" anchorid="section778835455512" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510293659__p6342161775620">为降低风险，提高系统的稳定性和可维护性，ohpm-repo必须使用非root权限进行启动部署。</p> </div> <div class="tiledSection"><h2 id="section1491141335817">加密连接和监听具体地址<i class="anchor-icon anchor-icon-link" anchorid="section1491141335817" tips="复制节点链接"></i></h2><div class="p" id="ZH-CN_TOPIC_0000002510293659__p829622142918">默认情况下，listen的配置值为http://localhost:8088，即使用HTTP协议，监听地址为localhost。为了数据传输更加安全，我们建议listen配置的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#li146761718065">监听地址</a>使用具体机器ip，通信协议使用更安全的HTTPS，或者在ohpm-repo之上使用HTTPS<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#li1128831818389">反向代理</a> ；当使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-custom-auth-plugin">自定义认证插件</a>或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-storageplugin">自定义存储插件</a>时，如果存在网络通信，通信协议也建议使用HTTPS。<div _ngcontent-xrh-c106="" class="highlight-div"><div _ngcontent-xrh-c106="" class="highlight-div-header"><div _ngcontent-xrh-c106="" class="highlight-div-header-left"><div _ngcontent-xrh-c106="" class="handle-button expand-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrh-c106="" class="highlight-div-header-right"><div _ngcontent-xrh-c106="" class="handle-button ai-button"></div><div _ngcontent-xrh-c106="" class="handle-button line-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrh-c106="" class="handle-button theme-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrh-c106="" class="handle-button copy-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrh-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510293659__screen867614181667" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">listen:</span> <span class="hljs-string">https://&lt;ohpm-repo部署机器ip&gt;:8088</span></li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section12437163685816">多实例部署<i class="anchor-icon anchor-icon-link" anchorid="section12437163685816" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510293659__p1978271213476">ohpm-repo用于存储私有仓库三方包数据，为了避免数据丢失，且保证ohpm-repo的高可用性，推荐<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_db">元数据存储</a>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_li1552633682171146">mysql</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_store">包数据存储</a>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#li620610378133">自定义存储插件</a>，通过使用负载均衡，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-deploy-multiple-instances">部署ohpm-repo多个实例</a>。</p> <p id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_p2057571770171146"><strong>Mysql存储</strong></p> <ul id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_ul1159195053171146"><li id="zh-cn_topic_0000001745376470_li1552633682171146">type: 插件名称，配置为mysql。</li><li id="zh-cn_topic_0000001745376470_li1377775477171146">config: 插件配置，具体为：<ul id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_ul127784455171146"><li id="zh-cn_topic_0000001745376470_li53645056171146">host: 数据库主机地址。</li><li id="zh-cn_topic_0000001745376470_li1025901731171146">port: 数据库端口。</li><li id="zh-cn_topic_0000001745376470_li1702363664171146">username: 数据库的用户名。</li><li id="zh-cn_topic_0000001745376470_li1521344984171146">password: 数据库的用户密码（请配置明文, 最终在部署目录中会转换为密文）。</li><li id="zh-cn_topic_0000001745376470_li1690557596171146">database: 数据库名。</li></ul> </li></ul> <p id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_p1933504320171146">参考配置如下：</p> <div _ngcontent-xrh-c106="" class="highlight-div"><div _ngcontent-xrh-c106="" class="highlight-div-header"><div _ngcontent-xrh-c106="" class="highlight-div-header-left"><div _ngcontent-xrh-c106="" class="handle-button expand-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrh-c106="" class="highlight-div-header-right"><div _ngcontent-xrh-c106="" class="handle-button ai-button"></div><div _ngcontent-xrh-c106="" class="handle-button line-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrh-c106="" class="handle-button theme-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrh-c106="" class="handle-button copy-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrh-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_screen1795155211171146" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">db:</span>                         </li><li>  <span class="hljs-attr">type:</span> <span class="hljs-string">mysql</span></li><li>  <span class="hljs-attr">config:</span></li><li>    <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span></li><li>    <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span></li><li>    <span class="hljs-attr">username:</span> <span class="hljs-string">"tctAdmin"</span></li><li>    <span class="hljs-attr">password:</span> <span class="hljs-string">"password"</span></li><li>    <span class="hljs-attr">database:</span> <span class="hljs-string">"repo"</span></li></ol></pre></div></div> </div> <p id="ZH-CN_TOPIC_0000002510293659__p178391539181320"><strong>自定义存储</strong></p> <p id="ZH-CN_TOPIC_0000002510293659__p82061737121310">使用自定义插件存储，具体配置为：</p> <ul id="ZH-CN_TOPIC_0000002510293659__ul16206163712134"><li id="li620610378133">type: 插件名称，为custom，是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-storageplugin">自定义存储插件</a>类型。</li><li id="li112061537101311">config: 插件配置，具体为：<ul id="ZH-CN_TOPIC_0000002510293659__ul379919141515"><li id="li879915115152">export_name：待书写插件export的类名。</li><li id="li167452311150">plugin_path：插件的绝对路径或者相对于ohpm-repo软件包的路径，建议将插件放在软件包的plugins目录下。</li><li id="li1811167141811">custom_field：自定义字段，通过引入ohpm-repo解压包中libs/common/getStorageConfigInfo.js的getStorageConfigInfo方法获取自定义字段的值。</li><li id="li139751735171917">server: 本地仓库下载地址。<ul id="ZH-CN_TOPIC_0000002510293659__ul297513359194"><li id="li149758353193">当配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration">listen</a>的host不为0.0.0.0时，则默认取listen的完整格式，例如listen为127.0.0.1:8088，故server默认值为https://127.0.0.1:8088；</li><li id="li17975183518192">如果配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration">listen</a>的host为0.0.0.0，则server中的host默认为localhost，如https://localhost:8088。建议手动修改host为本机的ip/域名，例如listen为0.0.0.0:8088，故server需配置为https://&lt;本机ip/域名&gt;:8088；</li><li id="li2975143541914">如果需要通过反向代理来访问ohpm-repo服务，则该字段须配置为反向代理服务器的域名地址。多实例部署ohpm-repo时必须配置反向代理服务器，且需要配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#section1074004784011">use_reverse_proxy</a>值为true。</li></ul> </li></ul> </li></ul> <p id="ZH-CN_TOPIC_0000002510293659__p77741655102012">参考配置如下：</p> <div _ngcontent-xrh-c106="" class="highlight-div"><div _ngcontent-xrh-c106="" class="highlight-div-header"><div _ngcontent-xrh-c106="" class="highlight-div-header-left"><div _ngcontent-xrh-c106="" class="handle-button expand-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrh-c106="" class="highlight-div-header-right"><div _ngcontent-xrh-c106="" class="handle-button ai-button"></div><div _ngcontent-xrh-c106="" class="handle-button line-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrh-c106="" class="handle-button theme-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrh-c106="" class="handle-button copy-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrh-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510293659__screen732416183213" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">store:</span></li><li>  <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span>                                            </li><li>  <span class="hljs-attr">config:</span></li><li>    <span class="hljs-attr">export_name:</span> <span class="hljs-string">"MyStorage"</span>                              </li><li>    <span class="hljs-attr">plugin_path:</span> <span class="hljs-string">"plugins/storagePlugin/MyStorage"</span>        </li><li>    <span class="hljs-attr">custom_field:</span> <span class="hljs-string">"test"</span>                                  </li><li>    <span class="hljs-comment">#server: https://localhost:8088</span></li></ol></pre></div></div> <div class="tiledSection"><h2 id="section1539715432589">禁止匿名访问<i class="anchor-icon anchor-icon-link" anchorid="section1539715432589" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510293659__p5879551153115">在默认设置下，ohpm-repo仓库中的所有包信息均可供任意用户自由查看，且包文件也支持任意用户下载。为了避免不相关的人访问ohpm-repo，我们建议在ohpm-repo管理界面的<strong>系统设置&gt;系统安全</strong>页面，关闭匿名访问功能（默认保持开启）。关闭后，只有在.ohpmrc文件中正确<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-certification#li168806431480">配置仓库只读或读写AccessToken</a>的用户才能够通过ohpm工具下载三方包，只有登录ohpm-repo账户，才能够访问ohpm-repo管理界面。</p> <p id="ZH-CN_TOPIC_0000002510293659__p1556382214398"><span><img height="351.532965" originheight="796" originwidth="1461" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104722.30646919185745726216440791723845:50001231000000:2800:C934911B7CDAF376517E7DA614209803A50D326EA10A050D99D18E3AAED692AE.png" title="点击放大" width="635.4075"></span></p> <p id="ZH-CN_TOPIC_0000002510293659__p176901532105813"></p> </div> <div class="tiledSection"><h2 id="section105288456581">用户访问频率控制<i class="anchor-icon anchor-icon-link" anchorid="section105288456581" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510293659__p12500435423">为了避免恶意用户频繁对仓库进行访问操作，我们在配置文件中设置配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_server">user_rate_limit</a>，默认单个用户访问接口的频率为100次/秒，配置范围为 (0, 10000]。</p> <div _ngcontent-xrh-c106="" class="highlight-div"><div _ngcontent-xrh-c106="" class="highlight-div-header"><div _ngcontent-xrh-c106="" class="highlight-div-header-left"><div _ngcontent-xrh-c106="" class="handle-button expand-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrh-c106="" class="highlight-div-header-right"><div _ngcontent-xrh-c106="" class="handle-button ai-button"></div><div _ngcontent-xrh-c106="" class="handle-button line-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrh-c106="" class="handle-button theme-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrh-c106="" class="handle-button copy-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrh-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510293659__zh-cn_topic_0000001745376470_screen26709028171146" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">user_rate_limit:</span> <span class="hljs-number">100</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section19339114685810">用户上传次数控制<i class="anchor-icon anchor-icon-link" anchorid="section19339114685810" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510293659__p197888311354">为了避免恶意用户频繁发布三方包，我们在配置文件中设置配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-configuration#zh-cn_topic_0000001745376470_server">upload_max_times</a>，默认单个用户24小时内上传次数限制为100次，配置范围为 (0, 100000]，用户可以根据自身业务需要修改此配置值，如改为1000次。</p> <div _ngcontent-xrh-c106="" class="highlight-div"><div _ngcontent-xrh-c106="" class="highlight-div-header"><div _ngcontent-xrh-c106="" class="highlight-div-header-left"><div _ngcontent-xrh-c106="" class="handle-button expand-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrh-c106="" class="highlight-div-header-right"><div _ngcontent-xrh-c106="" class="handle-button ai-button"></div><div _ngcontent-xrh-c106="" class="handle-button line-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrh-c106="" class="handle-button theme-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrh-c106="" class="handle-button copy-button"><div _ngcontent-xrh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrh-c106="" class="highlight-scroll-div"><pre class="yaml prettyprint linenums hljs language-yaml" id="ZH-CN_TOPIC_0000002510293659__screen25202441665" hw-language="yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">upload_max_times:</span> <span class="hljs-number">1000</span></li></ol></pre></div></div> </div> </div> <div></div></div>