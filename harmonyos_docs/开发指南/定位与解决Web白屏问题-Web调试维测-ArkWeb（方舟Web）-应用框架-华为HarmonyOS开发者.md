<h1 _ngcontent-kqk-c119="" class="doc-title ng-star-inserted" title="定位与解决Web白屏问题"> 定位与解决Web白屏问题 </h1>

<div _ngcontent-kqk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Web页面出现白屏的原因众多，本文列举了若干常见白屏问题的排查步骤，供开发者快速定位。</p>    <ol>     <li>首先排查权限和网络状态。</li>     <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-debugging-with-devtools">使用DevTools工具调试前端页面</a>定位具体报错类型（跨域、资源404、JS异常）。</li>     <li>在复杂布局场景中，排查渲染模式及组件约束条件的问题。</li>     <li>处理H5代码兼容性问题。</li>     <li>从日志中排查生命周期和网络加载相关关键字。</li>     <li>检查是否开启坚盾守护模式，坚盾守护模式开启后相关限制见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-secure-shield-mode#arkweb限制的html5特性">坚盾守护模式</a>。</li>    </ol>    <div class="tiledSection">     <h2 id="检查权限和网络状态">检查权限和网络状态<i class="anchor-icon anchor-icon-link" anchorid="检查权限和网络状态" tips="复制节点链接"></i></h2>          <p>如果应用未开启联网或文件访问权限或者设备网络状态不佳，将导致Web组件加载失败或页面元素缺失，进而引起白屏。</p>     <ul>      <li>       <p>验证设备的网络状态，包括是否已连接网络，设备自带的浏览器能否正常访问网页等（在线页面场景）。</p></li>      <li>       <p>确保应用已添加网络权限：ohos.permission.INTERNET（在线页面必需）。</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在module.json5中添加相关权限</span></li><li><span class="hljs-string">"requestPermissions"</span>:[</li><li>   {</li><li>      <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.INTERNET"</span></li><li>   }</li><li>]</li></ol></pre></div></div></li>      <li>       <p>开启相关权限：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.3.3.3.2.1.3.1.1" valign="top" width="50%">名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.3.3.3.2.1.3.1.2" valign="top" width="50%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#domstorageaccess" target="_blank">domStorageAccess</a></td>           <td class="cellrowborder" valign="top" width="50%">DOM Storage API权限，若不开启，无法使用localStorage存储数据，任何调用localStorage的代码都将失效，依赖本地存储的功能会异常。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a></td>           <td class="cellrowborder" valign="top" width="50%">‌若不开启，文件读写功能完全被阻断，依赖文件的模块会崩溃。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#imageaccess" target="_blank">imageAccess</a></td>           <td class="cellrowborder" valign="top" width="50%">设置是否允许自动加载图片资源。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#onlineimageaccess" target="_blank">onlineImageAccess</a></td>           <td class="cellrowborder" valign="top" width="50%">设置是否允许从网络加载图片资源（通过HTTP和HTTPS访问的资源）。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#javascriptaccess" target="_blank">javaScriptAccess</a></td>           <td class="cellrowborder" valign="top" width="50%">设置是否允许执行JavaScript脚本。</td>          </tr>                 </tbody></table></div>       </div>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">imageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onlineImageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>修改<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setcustomuseragent10" target="_blank">UserAgent</a>后再观察页面是否恢复正常。</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">customUserAgent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">' DemoApp'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>      .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onControllerAttached"</span>);</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-keyword">let</span> userAgent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getUserAgent</span>() + <span class="hljs-variable language_">this</span>.<span class="hljs-property">customUserAgent</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setCustomUserAgent</span>(userAgent);</li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用devtools工具进行页面内容验证">使用DevTools工具进行页面内容验证<i class="anchor-icon anchor-icon-link" anchorid="使用devtools工具进行页面内容验证" tips="复制节点链接"></i></h2>          <p>在确保网络与权限配置无误后，若仍出现白屏，则应利用DevTools工具调试前端页面以及监听Web相关错误上报接口，来定位具体报错类型。</p>     <ol>      <li>       <p>查阅控制台的错误信息，定位具体的资源加载失败问题。资源加载失败会导致页面元素缺失，布局紊乱，图片和动画效果失效等，严重时可能导致渲染进程崩溃，页面呈现空白。如图所示，依次排查：</p>       <p>（1）元素是否完整，html元素、结构是否正确。</p>       <p>（2）控制台是否有报错。</p>       <p>（3）网络里面是否有资源加载时间特别长等。</p>       <p><span><img originheight="383" originwidth="1513" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114735.21455738049586012644022746662067:50001231000000:2800:F188C9B5C428F79DB18923F658FAAA031734FE9CDDC9FEB42723A3963380FEF4.png" width="920" height="232.8883013879709"></span></p></li>      <li>       <p>检查控制台，确认是否存在因MixedContent策略或CORS策略导致的异常，或JS错误等。可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-cross-origin">解决Web组件本地资源跨域问题</a>。为了提高安全性，ArkWeb内核禁止file协议和resource协议访问跨域请求。因此，在使用Web组件加载本地离线资源的时候，Web组件会拦截file协议和resource协议的跨域访问。Web组件无法访问本地跨域资源时，DevTools控制台会显示报错信息：</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>Access to script at 'xxx' from origin 'xxx' has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes:   http, arkweb, data, chrome-extension, chrome, https, chrome-untrusted.</li></ol></pre></div></div>       <p>有如下两种解决方法：</p>       <p>方法一：</p>       <p>开发者应使用http或https协议替代file或resource协议，确保Web组件能够成功访问跨域资源。替代的URL域名应为自定义构造，仅限于个人或组织使用，以防止与互联网上的实际域名冲突。此外，开发者需要利用Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oninterceptrequest9" target="_blank">onInterceptRequest</a>方法，对本地资源进行拦截和相应替换。</p>       <p>以下结合示例说明如何使用http或者https等协议解决本地资源跨域访问失败的问题。其中，index.html和js/script.js文件置于工程的rawfile目录下。当使用resource协议访问index.html时，js/script.js文件因跨域而被拦截，无法加载。在示例中，使用https://www.example.com/域名替换了原有的resource协议，同时利用onInterceptRequest接口替换资源，确保js/script.js文件可以成功加载，从而解决跨域拦截问题。</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-comment">// 构造域名和本地文件的映射表</span></li><li>  schemeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([</li><li>    [<span class="hljs-string">"https://www.example.com/index.html"</span>, <span class="hljs-string">"index.html"</span>],</li><li>    [<span class="hljs-string">"https://www.example.com/js/script.js"</span>, <span class="hljs-string">"js/script.js"</span>],</li><li>  ])</li><li>  <span class="hljs-comment">// 构造本地文件和构造返回的格式mimeType</span></li><li>  mimeTypeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([</li><li>    [<span class="hljs-string">"index.html"</span>, <span class="hljs-string">'text/html'</span>],</li><li>    [<span class="hljs-string">"js/script.js"</span>, <span class="hljs-string">"text/javascript"</span>]</li><li>  ])</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 针对本地index.html,使用http或者https协议代替file协议或者resource协议，并且构造一个属于自己的域名。</span></li><li>        <span class="hljs-comment">// 本例中构造www.example.com为例。</span></li><li>        <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">"https://www.example.com/index.html"</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span> })</li><li>          .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">geolocationAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>          .<span class="hljs-title function_">onInterceptRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (!event) {</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 此处匹配自己想要加载的本地离线资源，进行资源拦截替换，绕过跨域</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">schemeMap</span>.<span class="hljs-title function_">has</span>(event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>())) {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">rawfileName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">schemeMap</span>.<span class="hljs-title function_">get</span>(event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>())!;</li><li>              <span class="hljs-keyword">let</span> mimeType = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mimeTypeMap</span>.<span class="hljs-title function_">get</span>(rawfileName);</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> mimeType === <span class="hljs-string">'string'</span>) {</li><li>                <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebResourceResponse</span>();</li><li>                <span class="hljs-comment">// 构造响应数据，如果本地文件在rawfile下，可以通过如下方式设置</span></li><li>                response.<span class="hljs-title function_">setResponseData</span>($rawfile(rawfileName));</li><li>                response.<span class="hljs-title function_">setResponseEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>                response.<span class="hljs-title function_">setResponseMimeType</span>(mimeType);</li><li>                response.<span class="hljs-title function_">setResponseCode</span>(<span class="hljs-number">200</span>);</li><li>                response.<span class="hljs-title function_">setReasonMessage</span>(<span class="hljs-string">'OK'</span>);</li><li>                response.<span class="hljs-title function_">setResponseIsReady</span>(<span class="hljs-literal">true</span>);</li><li>                <span class="hljs-keyword">return</span> response;</li><li>              }</li><li>            }</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- main/resources/rawfile/index.html --&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">crossorigin</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./js/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/resources/rawfile/js/script.js</span></li><li><span class="hljs-keyword">const</span> body = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</li><li><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);</li><li>element.<span class="hljs-property">textContent</span> = <span class="hljs-string">'success'</span>;</li><li>body.<span class="hljs-title function_">appendChild</span>(element);</li></ol></pre></div></div>       <p>方法二：</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setpathallowinguniversalaccess12" target="_blank">setPathAllowingUniversalAccess</a>设置一个路径列表。当使用file协议访问该列表中的资源时，允许进行跨域访问本地文件。此外，一旦设置了路径列表，file协议将仅限于访问列表内的资源(此时，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>的行为将会被此接口行为覆盖)。路径列表中的路径应符合以下任一路径格式：</p>       <p>1.应用文件目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.filesDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/files/example</li>        <li>/data/storage/el2/base/haps/entry/files/example</li>       </ul>       <p>2.应用资源目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.resourceDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el1/bundle/entry/resource/resfile</li>        <li>/data/storage/el1/bundle/entry/resource/resfile/example</li>       </ul>       <p>3.从API version 21开始，还包括了应用缓存目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.cacheDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/cache</li>        <li>/data/storage/el2/base/haps/entry/cache/example</li>        <li>设置的目录路径中，不允许包含cache/web，否则会抛出异常码401。如果设置目录路径是cache，cache/web也不允许访问。</li>       </ul>       <p>4.从API version 21开始，还包括了应用临时目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.tempDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/temp</li>        <li>/data/storage/el2/base/haps/entry/temp/example</li>       </ul>       <p>当路径列表中的任一路径不满足上述条件时，系统将抛出异常码401，并判定路径列表设置失败。如果路径列表设置为空，file协议的可访问范围将遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>规则，具体示例如下。</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// 设置允许可以跨域访问的路径列表</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPathAllowingUniversalAccess</span>([</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span>,</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/example"</span></li><li>            ])</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">"file://"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span> + <span class="hljs-string">"/index.html"</span>)</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- main/resources/resfile/index.html --&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFile</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-javascript">            <span class="hljs-keyword">var</span> file = <span class="hljs-string">"file:///data/storage/el1/bundle/entry/resources/resfile/js/script.js"</span>;</span></li><li><span class="language-javascript">      <span class="hljs-comment">// 使用file协议通过XMLHttpRequest跨域访问本地js文件。</span></span></li><li><span class="language-javascript">            <span class="hljs-keyword">var</span> xmlHttpReq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){</span></li><li><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"readyState:"</span> + xmlHttpReq.<span class="hljs-property">readyState</span>);</span></li><li><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"status:"</span> + xmlHttpReq.<span class="hljs-property">status</span>);</span></li><li><span class="language-javascript">                <span class="hljs-keyword">if</span>(xmlHttpReq.<span class="hljs-property">readyState</span> == <span class="hljs-number">4</span>){</span></li><li><span class="language-javascript">                    <span class="hljs-keyword">if</span> (xmlHttpReq.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>) {</span></li><li><span class="language-javascript">                <span class="hljs-comment">// 如果ets侧正确设置路径列表，则此处能正常获取资源</span></span></li><li><span class="language-javascript">                        <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>);</span></li><li><span class="language-javascript">                        element.<span class="hljs-property">textContent</span> = <span class="hljs-string">"load "</span> + file + <span class="hljs-string">" success"</span>;</span></li><li><span class="language-javascript">                    } <span class="hljs-keyword">else</span> {</span></li><li><span class="language-javascript">                <span class="hljs-comment">// 如果ets侧不设置路径列表，则此处会触发CORS跨域检查错误</span></span></li><li><span class="language-javascript">                        <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>);</span></li><li><span class="language-javascript">                        element.<span class="hljs-property">textContent</span> = <span class="hljs-string">"load "</span> + file + <span class="hljs-string">" failed"</span>;</span></li><li><span class="language-javascript">                    }</span></li><li><span class="language-javascript">                }</span></li><li><span class="language-javascript">            }</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-title function_">open</span>(<span class="hljs-string">"GET"</span>, file);</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>);</span></li><li><span class="language-javascript">        }</span></li><li><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page"</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"example"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"getFile()"</span>&gt;</span>loadFile<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/resources/resfile/js/script.js</span></li><li><span class="hljs-keyword">const</span> body = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</li><li><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);</li><li>element.<span class="hljs-property">textContent</span> = <span class="hljs-string">'success'</span>;</li><li>body.<span class="hljs-title function_">appendChild</span>(element);</li></ol></pre></div></div></li>      <li>       <p>查看onErrorReceive、onHttpErrorReceive、onSslErrorEvent、onHttpAuthRequest、onClientAuthenticationRequest等错误上报接口是否有被调用。请根据返回的错误码，对照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-neterrorlist" target="_blank">网络协议栈错误列表</a>进行排查。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.4.3.3.2.1.3.1.1" valign="top" width="50%">名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.4.3.3.2.1.3.1.2" valign="top" width="50%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onerrorreceive" target="_blank">onErrorReceive</a></td>           <td class="cellrowborder" valign="top" width="50%">资源加载失败会上报该回调，比如访问内核不支持的scheme， 会报302(UNKNOWN_URL_SCHEME)。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onhttperrorreceive" target="_blank">onHttpErrorReceive</a></td>           <td class="cellrowborder" valign="top" width="50%">服务器返回HTTP错误码，这类问题一般需要跟服务器进行联调。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onhttpauthrequest9" target="_blank">onHttpAuthRequest</a></td>           <td class="cellrowborder" valign="top" width="50%">服务器返回407需要端侧提供用户名密码认证，如果不正确处理，可能会导致加载异常、白屏。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onclientauthenticationrequest9" target="_blank">onClientAuthenticationRequest</a></td>           <td class="cellrowborder" valign="top" width="50%">服务器向端侧请求证书，如果不正确处理，会导致页面加载异常。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onsslerrorevent12" target="_blank">onSslErrorEvent</a></td>           <td class="cellrowborder" valign="top" width="50%">证书错误，需要应用根据证书错误信息进行排查，是证书配错了？还是过期了。</td>          </tr>                 </tbody></table></div>       </div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="复杂的布局与渲染模式导致白屏">复杂的布局与渲染模式导致白屏<i class="anchor-icon anchor-icon-link" anchorid="复杂的布局与渲染模式导致白屏" tips="复制节点链接"></i></h2>          <p>若页面使用了复杂布局或渲染模式，需注意其应用场景和约束条件，不当使用可能导致布局混乱或白屏。</p>     <p>Web组件提供了两种渲染模式，能够根据不同的容器大小进行适配，从而满足使用场景中对容器尺寸的需求，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-render-mode">Web组件渲染模式</a>。在使用过程中需要注意以下几点：</p>     <ul>      <li>异步渲染模式下（renderMode: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-e#rendermode12" target="_blank">RenderMode</a>.ASYNC_RENDER），Web组件的宽高不能超过7,680px（物理像素），超过会导致白屏。</li>     </ul>     <p>Web组件提供了自适应页面布局的能力，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-fit-content"> Web组件大小自适应页面内容布局</a>，使用时也需要注意以下约束条件：</p>     <ul>      <li>       <p>配置同步渲染模式：webSetting({renderingMode: WebRenderingMode.SYNCHRONOUS})。</p></li>      <li>       <p>关闭滚动效果：webSetting({overScrollMode: OverScrollMode.NEVER})。</p></li>      <li>       <p>此模式下不支持动态调整组件高度，确保页面高度固定。</p></li>      <li>       <p>避免在FIT_CONTENT模式下启用键盘避让属性RESIZE_CONTENT，以免导致布局失效。</p></li>      <li>       <p>css样式height：&lt;number&gt; vh和Web组件大小自适应页面布局存在计算冲突，请检查height：&lt;number&gt; vh是否是由body节点而内的第一个高度css样式。如以下结构，id为2的dom节点高度将为0，导致白屏。</p>       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"1"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"2"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 100vh"</span>&gt;</span>子dom<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"3"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 20px"</span>&gt;</span>子dom<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li></ol></pre></div></div>       <p>解决此白屏问题的参考方案如下：</p>       <ul>        <li>子dom使用具体高度样式撑开父元素。         <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"1"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"2"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 20px"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"3"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 20px"</span>&gt;</span>子dom<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li></ol></pre></div></div></li>        <li>父元素使用实际高度样式。         <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"1"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"2"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 20px"</span>&gt;</span>子dom<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span> = <span class="hljs-string">"3"</span> <span class="hljs-attr">style</span> = <span class="hljs-string">"height: 20px"</span>&gt;</span>子dom<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li></ol></pre></div></div></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="处理h5代码兼容性">处理H5代码兼容性<i class="anchor-icon anchor-icon-link" anchorid="处理h5代码兼容性" tips="复制节点链接"></i></h2>          <p>兼容性问题处理不当也会导致页面白屏。</p>     <ul>      <li>特殊协议拦截。</li>      <li>若H5页面调用tel:、mailto:等协议导致白屏，需通过onInterceptRequest拦截并调用系统拨号能力：       <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>.onInterceptRequest((event) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (event.request.url.startsWith(<span class="hljs-string">'tel:'</span>)) {</li><li>        <span class="hljs-comment">// 调用系统拨号能力</span></li><li>        call.makeCall({ phoneNumber: <span class="hljs-string">'123456'</span> });</li><li>        <span class="hljs-keyword">return</span> { responseCode: <span class="hljs-number">404</span> }; <span class="hljs-comment">// 阻止默认行为</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> null;</li><li>})</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="监控内存与生命周期">监控内存与生命周期<i class="anchor-icon anchor-icon-link" anchorid="监控内存与生命周期" tips="复制节点链接"></i></h2>          <p>内存达到阈值会导致渲染进程被终止，从而引发白屏现象；同样，渲染进程创建失败或非正常销毁也会导致白屏。可从日志中排查原因。检查Web组件是否与WebController正确绑定，或是否因过早释放导致白屏。关注日志中与Render进程相关的信息：是否存在内存泄漏使渲染内存不足。关键字“MEMORY_PRESSURE_LEVEL_CRITICAL”表明内存已达到阈值，此情形下Web可能遭遇黑屏、花屏或闪屏等异常状况，需排查是否存在内存泄漏问题。Render进程是否成功启动或异常退出。</p>     <p>下面列举一些日志中的关键字和对应的情况说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.3.1.1" valign="top" width="50%">日志关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">StartRenderProcess failed</td>         <td class="cellrowborder" valign="top" width="50%">渲染render进程启动失败。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MEMORY_PRESSURE_LEVEL_CRITICAL</td>         <td class="cellrowborder" valign="top" width="50%">整机内存压力达到阈值，继续使用可能造成黑屏、闪屏白屏等问题。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">crashpad SandboxedHandler::HandlerCrash, received signo = xxx</td>         <td class="cellrowborder" valign="top" width="50%">渲染render进程crash，会造成白屏、Web组件卡死等问题。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">SharedContextState context lost via Skia OOM</td>         <td class="cellrowborder" valign="top" width="50%">共享内存不足，会导致应用闪退、花屏卡死等问题。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">CreateNativeViewGLSurfaceEGLOhos::normal surface</td>         <td class="cellrowborder" valign="top" width="50%">创建egl surface成功，如果没有该日志打印则会造成白屏问题。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">INFO: request had no response within 5 seconds</td>         <td class="cellrowborder" valign="top" width="50%">网络超时。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">final url: ***, error_code xxx(net::ERR_XXX)</td>         <td class="cellrowborder" valign="top" width="50%">主资源加载报错。</td>        </tr>             </tbody></table></div>     </div>     <p>下面说明一下Web组件网络加载过程中的关键日志，正常情况下一个Web组件的加载过程应该包含这些关键节点：</p>     <p><span><img originheight="477" originwidth="1467" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114735.70796922662938450686817648654119:50001231000000:2800:0946ACD2D2929B6586350DF92C07A4D583951AB817C5A7684BC58216D7F09CFF.png" width="920" height="299.1411042944785"></span></p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.3.1.1" valign="top" width="50%">日志关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">NWebRenderMain start</td>         <td class="cellrowborder" valign="top" width="50%">子进程启动。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>RendererMain startup 、</p>          <p>render thread init</p></td>         <td class="cellrowborder" valign="top" width="50%">子进程初始化开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">event_message: WillProcessNavigationResponse source_id xxx navigation_handle id: xxx</td>         <td class="cellrowborder" valign="top" width="50%">收到主资源的response。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">event_message: commit navigation in main frame, routing_id: 4, url: ***</td>         <td class="cellrowborder" valign="top" width="50%">Commit到子进程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>RenderFrameImpl::CommitNavigation、</p>          <p>event_message: page load start</p></td>         <td class="cellrowborder" valign="top" width="50%">子进程收到commit。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>NWebHandlerDelegate::OnNavigationEntryCommitted、</p>          <p>event_message: Commit source_id xxx</p></td>         <td class="cellrowborder" valign="top" width="50%">主进程收到DidCommitNavigation。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">event_message: load_timing_info errpr_code:0,...</td>         <td class="cellrowborder" valign="top" width="50%">主资源加载完成，以及各阶段耗时。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">event_message: MarkFirstContentfulPaint</td>         <td class="cellrowborder" valign="top" width="50%">标记解析到有可显示内容的元素。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">NWebHandlerDelegate::OnPageVisible</td>         <td class="cellrowborder" valign="top" width="50%">第一帧展示。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">NWebHandlerDelegate::OnFirstContentfulPaint</td>         <td class="cellrowborder" valign="top" width="50%">第一帧有内容展示。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">event_message: content load finished</td>         <td class="cellrowborder" valign="top" width="50%">页面解析完成。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>event_message: page load finished、</p>          <p>NWebHandlerDelegate::OnLoadEnd、</p>          <p>NWebHandlerDelegate::MainFrame OnLoadEnd、</p>          <p>NWebHandlerDelegate::OnFirstMeaningfulPaint</p></td>         <td class="cellrowborder" valign="top" width="50%">页面以及子资源加载完成。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="设备的webview默认加载进程不一致导致加载h5页面白屏">设备的WebView默认加载进程不一致导致加载H5页面白屏<i class="anchor-icon anchor-icon-link" anchorid="设备的webview默认加载进程不一致导致加载h5页面白屏" tips="复制节点链接"></i></h2>          <p><strong>问题：</strong></p>     <p>用WebView加载H5在Phone上表现正常，但是在Table/PC/2in1上白屏。</p>     <p><strong>原因：</strong></p>     <p>Table/PC/2in1的WebView默认采用多进程加载，iframe默认使用子进程加载。主进程加载完成后，若子进程尚未加载完成，会导致白屏现象。</p>     <p><strong>解决方案：</strong></p>     <p>通过setRenderProcessMode()设置WebView渲染模式为单进程加载。</p>     <div _ngcontent-kqk-c106="" class="highlight-div"><div _ngcontent-kqk-c106="" class="highlight-div-header"><div _ngcontent-kqk-c106="" class="highlight-div-header-left"><div _ngcontent-kqk-c106="" class="handle-button expand-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kqk-c106="" class="highlight-div-header-right"><div _ngcontent-kqk-c106="" class="handle-button ai-button"></div><div _ngcontent-kqk-c106="" class="handle-button line-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kqk-c106="" class="handle-button theme-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kqk-c106="" class="handle-button copy-button"><div _ngcontent-kqk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kqk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>webview<span class="hljs-selector-class">.WebviewController</span><span class="hljs-selector-class">.setRenderProcessMode</span>(webview.RenderProcessMode.SINGLE);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>