<h1 _ngcontent-ufc-c119="" class="doc-title ng-star-inserted" title="实名信息验证/授权场景"> 实名信息验证/授权场景 </h1>

<div _ngcontent-ufc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>从5.1.1(19)版本开始，新增支持实名信息验证/授权场景。</p>     <p>例如应用/元服务登录、注册或账户认证等操作，开发者需要验证或获取用户实名信息时可接入实名信息验证/授权能力。</p>     <p>支持商户模型：不涉及</p>     <p>实名信息验证授权页面展示：</p>     <div class="tablenoborder">      <div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab">               <tbody><tr>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="25%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114535.08897897496810841877141482520198:50001231000000:2800:1D194CF9B5E667E9C4B7F6F731666A2406B273D370089176298581D2F40E4957.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="25%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114535.75653771191935101897818187805403:50001231000000:2800:2C606EA1ED4212CFD5E9F764FB4AC0FF9CFE69E758FADD9EA91A8CCA27AA47AC.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="25%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114535.76378442242054444198922181279650:50001231000000:2800:03B5EB8FBB0D7BB8FDE7EEBA876B7C5D9E23C13B1CFA838055C4C57415C37BD5.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td align="center" class="cell-norowborder" style="border: none;" valign="top" width="25%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114535.17828284818040416622641709084438:50001231000000:2800:889CE6528914F1B690BFDE3732A43786EBDB31C0C90BA5BF089BACE2C95DC701.png" title="点击放大" width="204.91310000000001"></span></p></td>        </tr>        <tr>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="25%">          <p>实名信息验证页面</p></td>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="25%">          <p>实名信息授权（无授权信息）页面</p></td>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="25%">          <p>实名信息授权（有授权信息）页面</p></td>         <td align="center" class="cellrowborder" style="border: none;" valign="top" width="25%">          <p>密码验证页面</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1255816408300">接入流程<i class="anchor-icon anchor-icon-link" anchorid="section1255816408300" tips="复制节点链接"></i></h2>          <p>华为支付实名信息验证授权接入流程如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="25.85%">          <p>步骤</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="74.15%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25.85%">          <p>开发准备</p></td>         <td class="cellrowborder" valign="top" width="74.15%">          <p>请先完成开发准备后再进行下面的开发接入。</p>          <ul>           <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-config-app-identity-info">端侧应用配置</a></li>           <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-real-name-preparations">用户信息验证授权接入准备</a></li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25.85%">          <p>接入实名信息验证/授权</p></td>         <td class="cellrowborder" valign="top" width="74.15%">          <p>根据实名信息验证/授权场景<a href="/consumer/cn/doc/harmonyos-guides/payment-real-name-verification#section9187179113620">开发步骤</a>完成接入。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1818915573916">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1818915573916" tips="复制节点链接"></i></h2>          <p>开发者通过接入Payment Kit实名信息验证授权能力，可以简便快捷地实现用户实名信息验证或获取用户授权后的实名信息（可二选一）。具体接入流程如下：</p>     <p><span><img height="747.3722222222223" originheight="788" originwidth="970" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114535.07072686718259029581064830209392:50001231000000:2800:3E63FB55800D2255A01FBA8AF6DBAD1E231C80FB70E13CE282F36AEB2AC8F528.png" title="点击放大" width="920"></span></p>    </div>    <div class="tiledSection">     <h3 id="section149923125013" class="firsth2">实名信息验证<i class="anchor-icon anchor-icon-link" anchorid="section149923125013" tips="复制节点链接"></i></h3>          <ol>      <li>开发者客户端收集用户实名信息请求开发者服务端发起实名信息预验证。</li>      <li>开发者服务端请求Payment Kit服务端<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-verification-preverify" target="_blank">实名信息预验证</a>接口获取预验证ID（preVerifyId）。</li>      <li>Payment Kit服务端返回预验证ID给开发者服务端。</li>      <li>开发者服务端返回预验证信息给开发者客户端。</li>      <li>开发者客户端使用预验证ID调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-realnameservice#section11356145173918" target="_blank">startRealNameVerification</a>接口拉起实名信息验证页面。</li>      <li>Payment Kit客户端展示验证信息。</li>      <li>用户同意授权实名信息校验，Payment Kit客户端请求Payment Kit服务端处理校验。</li>      <li>Payment Kit服务端完成校验处理并返回校验结果给Payment Kit客户端展示给用户。</li>      <li>Payment Kit客户端同步返回<strong>实名信息验证ID</strong>给开发者客户端。</li>      <li>开发者客户端使用实名信息校验ID请求开发者服务端查询实名信息校验结果。</li>      <li>开发者服务端请求Payment Kit服务端<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-verification-result" target="_blank">实名信息验证结果查询</a>接口查询验证结果。</li>      <li>Payment Kit服务端返回实名信息验证结果给开发者服务端。</li>      <li>开发者服务端将实名信息验证结果返回给开发者客户端，开发者客户端根据验证结果进行下一步业务处理。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section6843984506">实名信息授权<i class="anchor-icon anchor-icon-link" anchorid="section6843984506" tips="复制节点链接"></i></h3>          <ol>      <li>开发者客户端如需要获取用户实名信息，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-realnameservice#section35893164119" target="_blank">startRealNameAuth</a>接口拉起实名信息授权页面。</li>      <li>Payment Kit客户端给用户展示实名信息授权页面。</li>      <li>用户同意获取实名信息授权，Payment Kit客户端请求Payment Kit服务端校验授权处理</li>      <li>Payment Kit服务端完成校验处理并返回授权校验结果给Payment Kit客户端展示给用户。</li>      <li>Payment Kit客户端同步返回<strong>实名信息授权ID</strong>给开发者客户端。</li>      <li>开发者客户端使用实名信息授权ID请求开发者服务端查询实名信息。</li>      <li>开发者服务端请求Payment Kit服务端<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-auth-result" target="_blank">实名信息授权结果查询</a>接口查询用户实名信息授权结果及用户信息。</li>      <li>Payment Kit服务端会使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-real-name-preparations#section275114519198">开发者上传的公钥证书</a>进行隐私信息加密后返回给开发者服务端。</li>      <li>开发者服务端使用配对的私钥证书进行解密后获取到用户实名信息。</li>      <li>开发者服务端将用户实名信息返回给开发者客户端，开发者客户端根据业务需要，进行下一步处理。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section5906121818412">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5906121818412" tips="复制节点链接"></i></h2>          <p>拉起用户实名信息验证授权页面接口。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-realnameservice#section11356145173918" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.3.1.1" valign="top" width="49.96%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.3.1.2" valign="top" width="50.03999999999999%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.96%">          <p>startRealNameVerification(context: common.UIAbilityContext | common.UIExtensionContext, preVerifyId: string): Promise&lt;string&gt;;</p></td>         <td class="cellrowborder" valign="top" width="50.03999999999999%">          <p>拉起用户实名信息验证页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.96%">          <p>startRealNameAuth(context: common.UIAbilityContext | common.UIExtensionContext): Promise&lt;string&gt;;</p></td>         <td class="cellrowborder" valign="top" width="50.03999999999999%">          <p>拉起用户实名信息授权页面。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section9187179113620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9187179113620" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section13180123511" class="firsth2">实名信息验证<i class="anchor-icon anchor-icon-link" anchorid="section13180123511" tips="复制节点链接"></i></h3>          <ol>      <li><strong>发起实名信息预验证（服务器开发）</strong>       <p>为保证API接口请求的安全性和可靠性需要获取应用级凭证，构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1552810310615" target="_blank">PayDevAuth</a>作为开放API接口请求头后再发起请求。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1552810310615" target="_blank">PayDevAuth</a>定义示例代码如下：</p>       <div _ngcontent-ufc-c106="" class="highlight-div"><div _ngcontent-ufc-c106="" class="highlight-div-header"><div _ngcontent-ufc-c106="" class="highlight-div-header-left"><div _ngcontent-ufc-c106="" class="handle-button expand-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufc-c106="" class="highlight-div-header-right"><div _ngcontent-ufc-c106="" class="handle-button ai-button"></div><div _ngcontent-ufc-c106="" class="handle-button line-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufc-c106="" class="handle-button theme-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufc-c106="" class="handle-button copy-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Data</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayDevAuth</span> {</li><li>    <span class="hljs-comment">// 应用ID</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> clientId;</li><li>    <span class="hljs-comment">// 应用级token</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> accessToken;</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> traceId;</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> time;</li><li>    <span class="hljs-comment">// 开发者加密公钥ID。用于华为对接口响应敏感字段加密</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> developerEncKeyId;</li><li>    <span class="hljs-comment">// 华为加密公钥ID。用于开发者对接口请求敏感字段加密</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> petalpayEncKeyId;</li><li>    <span class="hljs-comment">// 开发者验签公钥ID。用于华为对开发者加签的请求报文验签</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> developerSignKeyId;</li><li>    <span class="hljs-comment">// 华为验签公钥ID。用于开发者对华为加签的响应报文验签</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> petalpaySignKeyId;</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> headerSign;</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> bodySign;</li><li>}</li></ol></pre></div></div>       <p>构建请求头信息示例代码如下：</p>       <div _ngcontent-ufc-c106="" class="highlight-div"><div _ngcontent-ufc-c106="" class="highlight-div-header"><div _ngcontent-ufc-c106="" class="highlight-div-header-left"><div _ngcontent-ufc-c106="" class="handle-button expand-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufc-c106="" class="highlight-div-header-right"><div _ngcontent-ufc-c106="" class="handle-button ai-button"></div><div _ngcontent-ufc-c106="" class="handle-button line-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufc-c106="" class="handle-button theme-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufc-c106="" class="handle-button copy-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取accessToken</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getaccessToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> clientId, <span class="hljs-built_in">String</span> clientSecret</span>) {</li><li>    <span class="hljs-title class_">HashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>    params.<span class="hljs-title function_">put</span>(<span class="hljs-string">"grant_type"</span>, <span class="hljs-string">"client_credentials"</span>);</li><li>    params.<span class="hljs-title function_">put</span>(<span class="hljs-string">"client_id"</span>, clientId);</li><li>    params.<span class="hljs-title function_">put</span>(<span class="hljs-string">"client_secret"</span>, clientSecret);</li><li>    <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>    headers.<span class="hljs-title function_">put</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/x-www-form-urlencoded"</span>);</li><li>    <span class="hljs-comment">// restfulClient为http请求客户端对象，请自行实现相关对象及方法的处理逻辑。</span></li><li>    <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&gt; atRspResponseEntity = restfulClient.<span class="hljs-title function_">postForEntity</span>(</li><li>        <span class="hljs-string">"https://oauth-login.cloud.huawei.com/oauth2/v3/token"</span>, params, <span class="hljs-literal">null</span>, headers, <span class="hljs-title class_">Map</span>.<span class="hljs-property">class</span>);</li><li>     <span class="hljs-keyword">return</span> (<span class="hljs-title class_">String</span>) atRspResponseEntity.<span class="hljs-title function_">getBody</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"access_token"</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 构建PayDevAuth请求头</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">buildPayMercAuth</span>(<span class="hljs-params">HashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; body</span>) {</li><li>    <span class="hljs-comment">// 对body进行排序拼接</span></li><li>    <span class="hljs-title class_">String</span> bodyStr = <span class="hljs-title class_">SignStringUtil</span>.<span class="hljs-title function_">signString</span>(body);</li><li>    <span class="hljs-comment">// 构建 PayDevAuth 请求头</span></li><li>    <span class="hljs-title class_">PayDevAuth</span> payDevAuth = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PayDevAuth</span>();</li><li>    payDevAuth.<span class="hljs-title function_">setTraceId</span>(<span class="hljs-string">"tid"</span> + <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());</li><li>    payDevAuth.<span class="hljs-title function_">setTime</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());</li><li>    <span class="hljs-comment">// 获取accessToken</span></li><li>    payDevAuth.<span class="hljs-title function_">setAccessToken</span>(<span class="hljs-title function_">getAccessToken</span>(<span class="hljs-string">"clientId"</span>, <span class="hljs-string">"clientSecret"</span>));</li><li>    <span class="hljs-comment">// 获取签名priKey</span></li><li>    <span class="hljs-title class_">String</span> priKey = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-comment">// 请求体签名</span></li><li>    <span class="hljs-title class_">String</span> bodySign = <span class="hljs-title class_">Sm2Utils</span>.<span class="hljs-title function_">sign</span>(<span class="hljs-title class_">Objects</span>.requireNonNull(priKey, <span class="hljs-string">"The signing private key can’t null"</span>), bodyStr);</li><li>    payDevAuth.<span class="hljs-title function_">setBodySign</span>(bodySign);</li><li>    <span class="hljs-comment">// 请求头签名</span></li><li>    <span class="hljs-title class_">String</span> headerStr = <span class="hljs-title class_">ToStringUtil</span>.<span class="hljs-title function_">signString</span>(payDevAuth);</li><li>    <span class="hljs-title class_">String</span> headerSign = <span class="hljs-title class_">Sm2Utils</span>.<span class="hljs-title function_">sign</span>(priKey, headerStr);</li><li>    payDevAuth.<span class="hljs-title function_">setHeaderSign</span>(headerSign);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-title function_">obj2Json</span>(payDevAuth);</li><li>}</li></ol></pre></div></div>       <div class="p">        请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-verification-preverify" target="_blank">实名信息预验证</a>接口获取预验证ID后返回给端侧拉起实名信息验证页面。以下示例代码仅供参考：        <div _ngcontent-ufc-c106="" class="highlight-div"><div _ngcontent-ufc-c106="" class="highlight-div-header"><div _ngcontent-ufc-c106="" class="highlight-div-header-left"><div _ngcontent-ufc-c106="" class="handle-button expand-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufc-c106="" class="highlight-div-header-right"><div _ngcontent-ufc-c106="" class="handle-button ai-button"></div><div _ngcontent-ufc-c106="" class="handle-button line-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufc-c106="" class="handle-button theme-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufc-c106="" class="handle-button copy-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPreVerifyId</span>(<span class="hljs-title class_">String</span> clientId, <span class="hljs-title class_">String</span> clientSecret, <span class="hljs-title class_">String</span> credentialIdNo, <span class="hljs-title class_">String</span> realName, <span class="hljs-title class_">String</span> openId)</li><li>    throws <span class="hljs-title class_">NoSuchAlgorithmException</span> {</li><li>    <span class="hljs-title class_">HashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>    body.<span class="hljs-title function_">put</span>(<span class="hljs-string">"credentialType"</span>, <span class="hljs-string">"01"</span>);</li><li>    <span class="hljs-comment">// 人脸核身实人验证场景，credentialIdNo、realName入参需要使用SM2方式加密（参见</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-real-name-preparations#li1492418137419"><span class="hljs-comment">SM2加密示例代码</span></a><span class="hljs-comment">）</span></li><li>    body.<span class="hljs-title function_">put</span>(<span class="hljs-string">"credentialIdNo"</span>, <span class="hljs-title function_">getHashStr</span>(credentialIdNo));</li><li>    body.<span class="hljs-title function_">put</span>(<span class="hljs-string">"realName"</span>, <span class="hljs-title function_">getHashStr</span>(realName));</li><li>    body.<span class="hljs-title function_">put</span>(<span class="hljs-string">"openId"</span>, openId);</li><li>    <span class="hljs-title class_">HashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>    header.<span class="hljs-title function_">put</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json;charset=UTF-8"</span>);</li><li>    header.<span class="hljs-title function_">put</span>(<span class="hljs-string">"payDevAuth"</span>, <span class="hljs-title function_">buildPayMercAuth</span>(body));</li><li>    <span class="hljs-comment">// restfulClient为http请求客户端对象，请自行实现postForEntity请求方法。</span></li><li>    <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&gt; responseEntity = restfulClient.<span class="hljs-title function_">postForEntity</span>(</li><li>        <span class="hljs-string">"https://petalpay-developer.cloud.huawei.com.cn/api/v1/realname/verification/preverify"</span>, <span class="hljs-literal">null</span>, body, header, <span class="hljs-title class_">Map</span>.<span class="hljs-property">class</span>);</li><li>    <span class="hljs-keyword">return</span> (<span class="hljs-title class_">String</span>) responseEntity.<span class="hljs-title function_">getBody</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"preVerifyId"</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getHashStr</span>(<span class="hljs-title class_">String</span> input) throws <span class="hljs-title class_">NoSuchAlgorithmException</span> {</li><li>    byte[] encodedhash = <span class="hljs-title class_">MessageDigest</span>.<span class="hljs-title function_">getInstance</span>(<span class="hljs-string">"SHA-256"</span>)</li><li>        .<span class="hljs-title function_">digest</span>(input.<span class="hljs-title function_">getBytes</span>(java.<span class="hljs-property">nio</span>.<span class="hljs-property">charset</span>.<span class="hljs-property">StandardCharsets</span>.<span class="hljs-property">UTF_8</span>));</li><li>    <span class="hljs-title class_">StringBuilder</span> hexString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();</li><li>    <span class="hljs-keyword">for</span> (byte b : encodedhash) {</li><li>        <span class="hljs-title class_">String</span> hex = <span class="hljs-title class_">Integer</span>.<span class="hljs-title function_">toHexString</span>(<span class="hljs-number">0xff</span> &amp; b);</li><li>        <span class="hljs-keyword">if</span> (hex.<span class="hljs-title function_">length</span>() == <span class="hljs-number">1</span>) {</li><li>            hexString.<span class="hljs-title function_">append</span>(<span class="hljs-string">'0'</span>);</li><li>        }</li><li>        hexString.<span class="hljs-title function_">append</span>(hex);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> hexString.<span class="hljs-title function_">toString</span>();</li><li>}</li></ol></pre></div></div>       </div></li>      <li><strong>拉起实名信息验证（端侧开发）</strong>       <div class="p">        开发者客户端使用后端服务返回的预验证ID作为参数调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-realnameservice#section11356145173918" target="_blank">startRealNameVerification</a>接口拉起用户实名信息验证页面。当接口通过.then()方法返回时，则表示当前接口请求成功，通过.catch()方法返回表示接口请求失败。当此次请求有异常时，可通过<strong>error.code</strong>获取错误码，错误码相关信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-error-code" target="_blank">错误码</a>。示例代码如下：        <div _ngcontent-ufc-c106="" class="highlight-div"><div _ngcontent-ufc-c106="" class="highlight-div-header"><div _ngcontent-ufc-c106="" class="highlight-div-header-left"><div _ngcontent-ufc-c106="" class="handle-button expand-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufc-c106="" class="highlight-div-header-right"><div _ngcontent-ufc-c106="" class="handle-button ai-button"></div><div _ngcontent-ufc-c106="" class="handle-button line-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufc-c106="" class="handle-button theme-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufc-c106="" class="handle-button copy-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { realNameService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PaymentKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li> </li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-title function_">requestStartVerifyRealNameInfoPromise</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// use your own preVerifyId</span></li><li>    <span class="hljs-keyword">let</span> preVerifyId = <span class="hljs-string">''</span>;</li><li>    realNameService.<span class="hljs-title function_">startRealNameVerification</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, preVerifyId)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">verifyResultId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// verify success</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`succeeded in verifying, verifyResultId: <span class="hljs-subst">${verifyResultId}</span>`</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// failed to verify</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`failed to verify, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  }</li><li> </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'requestStartVerifyRealNameInfoPromise'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestStartVerifyRealNameInfoPromise</span>();</li><li>        })</li><li>      }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       </div></li>      <li><strong>查询实名信息验证结果（服务器开发）</strong>       <p>请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-verification-result" target="_blank">实名信息验证结果查询</a>接口获取实名信息验证结果返回给客户端。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section147319293488">实名信息授权<i class="anchor-icon anchor-icon-link" anchorid="section147319293488" tips="复制节点链接"></i></h3>          <ol>      <li><strong>拉起实名信息授权（端侧开发）</strong>       <div class="p">        开发者客户端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-realnameservice#section35893164119" target="_blank">startRealNameAuth</a>接口拉起用户实名信息授权页面。当接口通过.then()方法返回时，则表示当前接口请求成功，通过.catch()方法返回表示接口请求失败。当此次请求有异常时，可通过<strong>error.code</strong>获取错误码，错误码相关信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-error-code" target="_blank">错误码</a>。示例代码如下：        <div _ngcontent-ufc-c106="" class="highlight-div"><div _ngcontent-ufc-c106="" class="highlight-div-header"><div _ngcontent-ufc-c106="" class="highlight-div-header-left"><div _ngcontent-ufc-c106="" class="handle-button expand-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufc-c106="" class="highlight-div-header-right"><div _ngcontent-ufc-c106="" class="handle-button ai-button"></div><div _ngcontent-ufc-c106="" class="handle-button line-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufc-c106="" class="handle-button theme-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufc-c106="" class="handle-button copy-button"><div _ngcontent-ufc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { realNameService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PaymentKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li> </li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-title function_">requestStartRealNameAuthPromise</span>(<span class="hljs-params"></span>) {</li><li>    realNameService.<span class="hljs-title function_">startRealNameAuth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">realNameAuthId: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// authorize success</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`succeeded in authorizing, realNameAuthId: <span class="hljs-subst">${realNameAuthId}</span>`</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// failed to authorise</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`failed to authorise, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  }</li><li> </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'requestStartRealNameAuthPromise'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestStartRealNameAuthPromise</span>();</li><li>        })</li><li>      }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       </div></li>      <li><strong>查询实名信息授权结果（服务器开发）</strong>       <p>请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-api-common-verification-result" target="_blank">实名信息授权结果查询</a>接口获取实名信息并使用publicKeyId配对的SM2私钥证书进行实名信息解密，根据业务需要返回给客户端。</p></li>     </ol>    </div>   </div>   <div></div></div>