<h1 _ngcontent-wdm-c119="" class="doc-title ng-star-inserted" title="实现一个输入法应用"> 实现一个输入法应用 </h1>

<div _ngcontent-wdm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod-extension-ability" target="_blank">InputMethodExtensionAbility</a>提供了onCreate()和onDestroy()生命周期回调，根据需要重写对应的回调方法。InputMethodExtensionAbility的生命周期如下：</p>    <ul>     <li>      <p><strong>onCreate()</strong></p>      <p>服务被首次创建时触发该回调，开发者可以在此进行一些初始化的操作，例如注册公共事件监听等。</p>      <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">        <p>如果服务已创建，再次启动该InputMethodExtensionAbility不会触发onCreate()回调。</p>       </div></div></div></li>     <li>      <p><strong>onDestroy()</strong></p>      <p>当不再使用服务且准备将该实例销毁时，触发该回调。开发者可以在该回调中清理资源，如注销监听等。</p></li>    </ul>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>开发者在实现一个输入法应用时，需要在DevEco Studio工程中新建一个InputMethodExtensionAbility，具体步骤如下：</p>     <ol>      <li>       <p>在工程Module对应的ets目录下，右键选择“New &gt; Directory”，新建一个目录，并命名为InputMethodExtensionAbility。</p></li>      <li>       <p>在InputMethodExtensionAbility目录下，右键选择“New &gt; File”，新建四个文件，分别为KeyboardController.ts、InputMethodService.ts、Index.ets以及KeyboardKeyData.ts。目录如下：</p></li>     </ol>     <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>/src/main/</li><li>├── ets/InputMethodExtensionAbility</li><li>│       └──model/KeyboardController.ts            <span class="hljs-comment"># 显示键盘</span></li><li>│       └──InputMethodService.ts                <span class="hljs-comment"># 自定义类继承InputMethodExtensionAbility并加上需要的生命周期回调</span></li><li>│       └──pages</li><li>│         └── Index.ets                        <span class="hljs-comment"># 绘制键盘，添加输入删除功能</span></li><li>│         └── KeyboardKeyData.ts                <span class="hljs-comment"># 键盘属性定义</span></li><li>├── resources/base/profile/main_pages.json</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="文件介绍">文件介绍<i class="anchor-icon anchor-icon-link" anchorid="文件介绍" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>InputMethodService.ts文件。</p>       <p>在InputMethodService.ts文件中，增加导入InputMethodExtensionAbility的依赖包，自定义类继承InputMethodExtensionAbility并加上需要的生命周期回调。</p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> keyboardController <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/KeyboardController'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InputMethodExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InputDemoService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InputMethodExtensionAbility</span> {</li><li>
</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">void</span> {</li><li>    keyboardController.<span class="hljs-title function_">onCreate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>); <span class="hljs-comment">// 初始化窗口并注册对输入法框架的事件监听</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onDestroy."</span>);</li><li>    keyboardController.<span class="hljs-title function_">onDestroy</span>(); <span class="hljs-comment">// 销毁窗口并去注册事件监听</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>KeyboardController.ts文件。KeyboardController中除创建输入法窗口，设置输入法事件监听，实现文本插入、删除之外，还可以获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethodengine#getsystempanelcurrentinsets21" target="_blank">输入法键盘与系统面板的偏移区域</a>，输入法系统面板在不同设备上存在差异，当设备有系统面板时，输入法软键盘相对系统面板的偏移区域如图所示：</p>       <p><span><img originheight="596" originwidth="949" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114714.54321985668442531495176359241645:50001231000000:2800:3DCDBD5957E90B19A097A6AA1E5D7432DEBD8550861FC65D9A900434A41DF0F0.png" width="920" height="577.7871443624869"></span></p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { display } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { inputMethodEngine, <span class="hljs-title class_">InputMethodExtensionContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 调用输入法框架的getInputMethodAbility方法获取实例，并由此实例调用输入法框架功能接口</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">inputMethodAbility</span>: inputMethodEngine.<span class="hljs-property">InputMethodAbility</span> = inputMethodEngine.<span class="hljs-title function_">getInputMethodAbility</span>();</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyboardController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mContext</span>: <span class="hljs-title class_">InputMethodExtensionContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 保存InputMethodExtensionAbility中的context属性</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">panel</span>: inputMethodEngine.<span class="hljs-property">Panel</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textInputClient</span>: inputMethodEngine.<span class="hljs-property">InputClient</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">keyboardController</span>: inputMethodEngine.<span class="hljs-property">KeyboardController</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">InputMethodExtensionContext</span>): <span class="hljs-built_in">void</span></li><li>  {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span> = context;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initWindow</span>(); <span class="hljs-comment">// 初始化窗口</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerListener</span>(); <span class="hljs-comment">// 注册对输入法框架的事件监听</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> <span class="hljs-comment">// 应用生命周期销毁</span></li><li>  {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unRegisterListener</span>(); <span class="hljs-comment">// 去注册事件监听</span></li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>) { <span class="hljs-comment">// 销毁窗口</span></li><li>      inputMethodAbility.<span class="hljs-title function_">destroyPanel</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span>.<span class="hljs-title function_">destroy</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">insertText</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textInputClient</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textInputClient</span>.<span class="hljs-title function_">insertText</span>(text);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteForward</span>(<span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textInputClient</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textInputClient</span>.<span class="hljs-title function_">deleteForward</span>(length);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initWindow</span>(): <span class="hljs-built_in">void</span> <span class="hljs-comment">// 初始化窗口</span></li><li>  {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span> === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> dis = display.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li>    <span class="hljs-keyword">let</span> dWidth = dis.<span class="hljs-property">width</span>;</li><li>    <span class="hljs-keyword">let</span> dHeight = dis.<span class="hljs-property">height</span>;</li><li>    <span class="hljs-keyword">let</span> keyHeightRate = <span class="hljs-number">0.47</span>;</li><li>    <span class="hljs-keyword">let</span> keyHeight = dHeight * keyHeightRate;</li><li>    <span class="hljs-keyword">let</span> nonBarPosition = dHeight - keyHeight;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">panelInfo</span>: inputMethodEngine.<span class="hljs-property">PanelInfo</span> = {</li><li>      <span class="hljs-attr">type</span>: inputMethodEngine.<span class="hljs-property">PanelType</span>.<span class="hljs-property">SOFT_KEYBOARD</span>,</li><li>      <span class="hljs-attr">flag</span>: inputMethodEngine.<span class="hljs-property">PanelFlag</span>.<span class="hljs-property">FLG_FIXED</span></li><li>    };</li><li>    inputMethodAbility.<span class="hljs-title function_">createPanel</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mContext</span>, panelInfo).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">inputPanel</span>: inputMethodEngine.<span class="hljs-property">Panel</span>) =&gt; {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span> = inputPanel;</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>) {</li><li>        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>.<span class="hljs-title function_">resize</span>(dWidth, keyHeight);</li><li>        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, nonBarPosition);</li><li>        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>.<span class="hljs-title function_">setUiContent</span>(<span class="hljs-string">'InputMethodExtensionAbility/pages/Index'</span>);</li><li>        <span class="hljs-comment">// 获取输入法键盘与系统面板偏移区域大小，实际开发中可以根据实际情况判断是否需要实现</span></li><li>        <span class="hljs-keyword">let</span> defaultDisplay = display.<span class="hljs-title function_">getDefaultDisplaySync</span>();</li><li>        <span class="hljs-keyword">if</span> (defaultDisplay !== <span class="hljs-literal">undefined</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">panel</span>.<span class="hljs-title function_">getSystemPanelCurrentInsets</span>(defaultDisplay.<span class="hljs-property">id</span>)</li><li>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">insets: inputMethodEngine.SystemPanelInsets</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`getSystemPanelCurrentInsets success, insets is { left: <span class="hljs-subst">${insets.left}</span>, right: <span class="hljs-subst">${insets.right}</span>, bottom: <span class="hljs-subst">${insets.bottom}</span> }`</span>);</li><li>            })</li><li>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getSystemPanelCurrentInsets failed, code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>        }</li><li>      }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPanel, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">registerListener</span>(): <span class="hljs-built_in">void</span></li><li>  {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerInputListener</span>(); <span class="hljs-comment">// 注册对输入法框架服务的监听</span></li><li>    <span class="hljs-comment">// 注册隐藏键盘事件监听等</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">registerInputListener</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 注册开始输入的事件监听</span></li><li>    inputMethodAbility.<span class="hljs-title function_">on</span>(<span class="hljs-string">'inputStart'</span>, <span class="hljs-function">(<span class="hljs-params">kbController, textInputClient</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textInputClient</span> = textInputClient; <span class="hljs-comment">// 此为输入法客户端实例，由此调用输入法框架提供给输入法应用的功能接口</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">keyboardController</span> = kbController;</li><li>    })</li><li>    inputMethodAbility.<span class="hljs-title function_">on</span>(<span class="hljs-string">'inputStop'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputStopCallback</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">inputStopCallback</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onDestroy</span>(); <span class="hljs-comment">// 销毁KeyboardController</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">unRegisterListener</span>(): <span class="hljs-built_in">void</span> {</li><li>    inputMethodAbility.<span class="hljs-title function_">off</span>(<span class="hljs-string">'inputStart'</span>);</li><li>    inputMethodAbility.<span class="hljs-title function_">off</span>(<span class="hljs-string">'inputStop'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputStopCallback</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">const</span> keyboardController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyboardController</span>();</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> keyboardController;</li></ol></pre></div></div></li>      <li>       <p>KeyboardKeyData.ts文件。</p>       <p>定义软键盘的按键显示内容。</p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> sourceListType {</li><li>  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>,</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">numberSourceListData</span>: sourceListType[] = [</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'1'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'2'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'3'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'4'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'5'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'6'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'7'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'8'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'9'</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">content</span>: <span class="hljs-string">'0'</span></li><li>  }</li><li>]</li></ol></pre></div></div></li>      <li>       <p>Index.ets文件。</p>       <p>主要描绘了具体按键功能。如按下数字键，就会将数字内容在输入框中打印出来，按下删除键，就会将内容删除。</p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="ets prettyprint linenums hljs language-cangjie" hw-language="ets" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">numberSourceListData</span>, <span class="hljs-variable">sourceListType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./KeyboardKeyData'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">keyboardController</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../model/KeyboardController'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">keyItem</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">keyValue</span>: <span class="hljs-title class_">sourceListType</span> = <span class="hljs-variable">numberSourceListData</span>[<span class="hljs-number">0</span>];</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">keyBgc</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"#fff"</span></li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">keyFontColor</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"#000"</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Flex</span>({ <span class="hljs-variable">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-title class_">Column</span>,</li><li>        <span class="hljs-variable">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-title class_">Center</span>, <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">Center</span> }) {</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyValue</span>.<span class="hljs-variable">content</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyFontColor</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyBgc</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">6</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"8%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"65%"</span>)</li><li>    .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>      <span class="hljs-variable">keyboardController</span>.<span class="hljs-title function_">insertText</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyValue</span>.<span class="hljs-variable">content</span>);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 删除组件</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">deleteItem</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">keyBgc</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"#fff"</span></li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">keyFontColor</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"#000"</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Flex</span>({ <span class="hljs-variable">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-title class_">Column</span>,</li><li>        <span class="hljs-variable">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-title class_">Center</span>, <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">Center</span> }) {</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-string">"删除"</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyFontColor</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">keyBgc</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"13%"</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">6</span>)</li><li>    .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>      <span class="hljs-variable">keyboardController</span>.<span class="hljs-title function_">deleteForward</span>(<span class="hljs-number">1</span>);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 数字键盘</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">numberMenu</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">numberList</span>: <span class="hljs-title class_">sourceListType</span>[] = <span class="hljs-variable">numberSourceListData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Flex</span>({ <span class="hljs-variable">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-title class_">Column</span>, <span class="hljs-variable">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-title class_">Center</span>, <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">SpaceEvenly</span> }) {</li><li>      <span class="hljs-title function_">Flex</span>({ <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">SpaceBetween</span> }) {</li><li>        <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">numberList</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">sourceListType</span>) =&gt; { <span class="hljs-comment">// 数字键盘第一行</span></li><li>          <span class="hljs-title function_">keyItem</span>({ <span class="hljs-variable">keyValue</span>: <span class="hljs-title class_">item</span> })</li><li>        }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">sourceListType</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">content</span>);</li><li>      }</li><li>      .<span class="hljs-title function_">padding</span>({ <span class="hljs-variable">top</span>: <span class="hljs-string">"2%"</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"96%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"25%"</span>)</li><li>
</li><li>      <span class="hljs-title function_">Flex</span>({ <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">SpaceBetween</span> }) {</li><li>        <span class="hljs-title function_">deleteItem</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"96%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"25%"</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">numberList</span>: <span class="hljs-title class_">sourceListType</span>[] = <span class="hljs-variable">numberSourceListData</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Stack</span>() {</li><li>      <span class="hljs-title function_">Flex</span>({</li><li>        <span class="hljs-variable">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-title class_">Column</span>,</li><li>        <span class="hljs-variable">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-title class_">Center</span>,</li><li>        <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">End</span></li><li>      }) {</li><li>            <span class="hljs-title function_">Flex</span>({</li><li>              <span class="hljs-variable">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-title class_">Column</span>,</li><li>              <span class="hljs-variable">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-title class_">Center</span>,</li><li>              <span class="hljs-variable">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-title class_">SpaceBetween</span></li><li>            }) {</li><li>              <span class="hljs-title function_">numberMenu</span>({</li><li>                <span class="hljs-variable">numberList</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">numberList</span></li><li>              })</li><li>            }</li><li>            .<span class="hljs-title function_">align</span>(<span class="hljs-variable">Alignment</span>.<span class="hljs-variable">End</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">"75%"</span>)</li><li>          }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">align</span>(<span class="hljs-variable">Alignment</span>.<span class="hljs-variable">End</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#cdd0d7"</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">0</span> }).<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">99999</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>main_pages.json文件。对应ets/InputMethodExtensionAbility/pages/路径下键盘的绘制页面。</p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="JSON prettyprint linenums hljs language-JSON" hw-language="JSON" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-string">"InputMethodExtensionAbility/pages/Index"</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>在工程Module对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中注册InputMethodExtensionAbility，type标签需要设置为“inputMethod”，srcEntry标签表示当前InputMethodExtensionAbility组件所对应的代码路径。</p>       <div _ngcontent-wdm-c106="" class="highlight-div"><div _ngcontent-wdm-c106="" class="highlight-div-header"><div _ngcontent-wdm-c106="" class="highlight-div-header-left"><div _ngcontent-wdm-c106="" class="handle-button expand-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wdm-c106="" class="highlight-div-header-right"><div _ngcontent-wdm-c106="" class="handle-button ai-button"></div><div _ngcontent-wdm-c106="" class="handle-button line-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wdm-c106="" class="handle-button theme-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wdm-c106="" class="handle-button copy-button"><div _ngcontent-wdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wdm-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    ...</li><li>    <span class="hljs-attr">"extensionAbilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inputMethod"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"InputMethodExtensionAbility"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:app_icon"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/InputMethodExtensionAbility/InputMethodService.ts"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inputMethod"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"exported"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <p>为了降低InputMethodExtensionAbility能力被三方应用滥用的风险，现通过基础访问模式的功能约束对输入法应用进行安全管控。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>严格遵从基础访问模式的功能约束。在此模式下，开发者应仅提供基础打字功能，不应提供任何形式与网络交互相关的功能。系统会逐步增加基础访问模式的安全管控能力，包括但不限于：以独立进程和沙箱的方式运行Extension进程；禁止Extension进程创建子进程；进程间通信与网络访问等。因此未遵从此约定可能会导致功能异常。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="示例效果图">示例效果图<i class="anchor-icon anchor-icon-link" anchorid="示例效果图" tips="复制节点链接"></i></h2>          <p><span><img originheight="792" originwidth="429" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114714.38911758103636391922894063388159:50001231000000:2800:39847955E7BBF55179183F0E319AA6C021C0D8530095E8818B84CD96E96FAAAF.png" width="429" height="792"></span></p>    </div>   </div>   <div></div></div>