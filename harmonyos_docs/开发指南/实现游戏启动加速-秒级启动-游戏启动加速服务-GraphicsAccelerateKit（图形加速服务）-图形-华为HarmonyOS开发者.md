<h1 _ngcontent-yyy-c119="" class="doc-title ng-star-inserted" title="实现游戏启动加速"> 实现游戏启动加速 </h1>

<div _ngcontent-yyy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section189935413013">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section189935413013" tips="复制节点链接"></i></h2><p><span><img originheight="574" originwidth="866" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114406.71142696870506632201510683676890:50001231000000:2800:0AF0EACE4B714954CE3ED870FC5BD77A768F655EEFBBBFDFED2B9E649AFEBACE.png" width="866" height="574"></span></p> <ol><li>用户启动游戏。</li><li>游戏在onCreate生命周期中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetsupportedprocesscache12" target="_blank">setSupportedProcessCache</a>方法，设置游戏支持缓存后快速启动。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>部分机型不支持设置进程资源的缓存，因此在调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetsupportedprocesscache12" target="_blank">setSupportedProcessCache</a>接口时需加try catch捕获异常。</p> </div></div></div> </li><li>用户上划退出游戏。</li><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-launchacceleration#section81101219425" target="_blank">isLaunchMirrorEnabled</a>方法，向游戏启动加速服务查询游戏内存镜像功能是否使能。</li><li>游戏启动加速服务向游戏返回使能结果。</li><li>游戏根据使能结果执行不同的处理逻辑。若使能，游戏先切换场景，系统在退出游戏前自动制作内存镜像，制作内存镜像大概需要4s。若未使能，系统将直接退出游戏进程。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>建议开发者切换场景时，将场景切换至游戏登录界面并设置最大超时时间5s，若场景切换超时，则调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetsupportedprocesscache12" target="_blank">setSupportedProcessCache</a>方法，取消游戏支持缓存后快速启动。</p> </div></div></div> </li><li>用户再次启动游戏。</li><li>游戏根据是否有内存镜像启动游戏。若有内存镜像，游戏直接进入内存镜像界面。若没有内存镜像，游戏正常启动。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>根据上架审核规则，建议游戏秒级启动时增加游戏健康公告闪屏，然后再进入内存镜像界面，详细操作可参考<a href="https://developer.huawei.com/consumer/cn/codelabsPortal/carddetails/tutorials_LaunchAcceleration-ArkTS" target="_blank">Codelab</a>示例工程。</p> </div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section1212682065918">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1212682065918" tips="复制节点链接"></i></h2><p>具体API说明请详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-launchacceleration" target="_blank">接口文档</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="53.769999999999996%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="46.23%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="53.769999999999996%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-launchacceleration#section81101219425" target="_blank">isLaunchMirrorEnabled</a>(): boolean</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p>查询游戏的内存镜像功能是否使能。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section85767016101">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section85767016101" tips="复制节点链接"></i></h2><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本节主要介绍秒级启动的核心流程，完整的开发步骤和注意事项请参见<a href="https://developer.huawei.com/consumer/cn/codelabsPortal/carddetails/tutorials_LaunchAcceleration-ArkTS" target="_blank">Codelab开发指导</a>。</p> </div></div></div> <ol><li>导入Graphics Accelerate Kit模块。<div _ngcontent-yyy-c106="" class="highlight-div"><div _ngcontent-yyy-c106="" class="highlight-div-header"><div _ngcontent-yyy-c106="" class="highlight-div-header-left"><div _ngcontent-yyy-c106="" class="handle-button expand-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyy-c106="" class="highlight-div-header-right"><div _ngcontent-yyy-c106="" class="handle-button ai-button"></div><div _ngcontent-yyy-c106="" class="handle-button line-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyy-c106="" class="handle-button theme-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyy-c106="" class="handle-button copy-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyy-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { launchAcceleration } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li></ol></pre></div></div> </li><li>游戏启动时，在onCreate生命周期中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetsupportedprocesscache12" target="_blank">setSupportedProcessCache</a>方法，设置游戏支持缓存后快速启动。<div _ngcontent-yyy-c106="" class="highlight-div"><div _ngcontent-yyy-c106="" class="highlight-div-header"><div _ngcontent-yyy-c106="" class="highlight-div-header-left"><div _ngcontent-yyy-c106="" class="handle-button expand-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyy-c106="" class="highlight-div-header-right"><div _ngcontent-yyy-c106="" class="handle-button ai-button"></div><div _ngcontent-yyy-c106="" class="handle-button line-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyy-c106="" class="handle-button theme-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyy-c106="" class="handle-button copy-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyy-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.GraphicsGame.LaunchAcceleration"</span>)) {  <span class="hljs-comment">//兼容性：通过canIUse()校验设备是否支持启动加速服务</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setSupportedProcessCache</span>(<span class="hljs-literal">true</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> code = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setSupportedProcessCache fail, code: <span class="hljs-subst">${code}</span>, msg: <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li>游戏退出时，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-launchacceleration#section81101219425" target="_blank">isLaunchMirrorEnabled</a>方法，查询游戏内存镜像功能是否使能。若使能，游戏先切换场景，游戏需在onWindowStageWillDestroy生命周期中进行场景切换，建议开发者将场景切换至游戏登录界面，并在onDestroy生命周期中取消游戏引擎的销毁步骤，系统在退出游戏前自动制作内存镜像，制作内存镜像大概需要4s。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>游戏启动加速服务制作游戏内存镜像需要4s，请勿在4s内退出游戏并再次进入游戏，否则无法加载内存镜像进行启动加速。</li><li>游戏本次基于内存镜像启动加速，若在10s内上划退出，下一次启动不会加速，因为系统DFR（Design for Reliability，可靠性设计）保护机制，防止游戏快启后无法使用。</li><li>系统将结合当前设备的游戏热度、内存镜像数、当日磁盘换出量综合判定是否使能内存镜像功能。</li></ul> </div></div></div> <div _ngcontent-yyy-c106="" class="highlight-div"><div _ngcontent-yyy-c106="" class="highlight-div-header"><div _ngcontent-yyy-c106="" class="highlight-div-header-left"><div _ngcontent-yyy-c106="" class="handle-button expand-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyy-c106="" class="highlight-div-header-right"><div _ngcontent-yyy-c106="" class="handle-button ai-button"></div><div _ngcontent-yyy-c106="" class="handle-button line-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyy-c106="" class="handle-button theme-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyy-c106="" class="handle-button copy-button"><div _ngcontent-yyy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyy-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onWindowStageWillDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.GraphicsGame.LaunchAcceleration"</span>)) {  <span class="hljs-comment">//兼容性：通过canIUse()校验设备是否支持启动加速服务</span></li><li>    <span class="hljs-keyword">let</span> enable = launchAcceleration.<span class="hljs-title function_">isLaunchMirrorEnabled</span>()</li><li>    <span class="hljs-keyword">if</span> (enable) {</li><li>      <span class="hljs-comment">// 切换场景的代码逻辑</span></li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.GraphicsGame.LaunchAcceleration"</span>)) {  <span class="hljs-comment">//兼容性：通过canIUse()校验设备是否支持启动加速服务</span></li><li>    <span class="hljs-keyword">let</span> enable = launchAcceleration.<span class="hljs-title function_">isLaunchMirrorEnabled</span>()</li><li>    <span class="hljs-keyword">if</span> (!enable) {</li><li>      <span class="hljs-comment">// 若未使能，才进行游戏引擎的销毁</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>