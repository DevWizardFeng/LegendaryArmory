<h1 _ngcontent-oqw-c119="" class="doc-title ng-star-inserted" title="实现音频耳返"> 实现音频耳返 </h1>

<div _ngcontent-oqw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>实现音频耳返的功能，可将音频实时传输到耳机中，让用户可以实时听到自己或者其他相关声音。</p>    <p>常用于K歌类应用，将录制的人声和背景音乐实时送到耳机中，使用户通过反馈即时调整，获得更好的使用体验。</p>    <div class="tiledSection">     <h2 id="使用前提">使用前提<i class="anchor-icon anchor-icon-link" anchorid="使用前提" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>开发者可使用OHAudio提供的播放和录制能力相结合，将录制获取的音频数据作为播放的音频输入，实现耳返功能。</p>       <p>实现参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-playback">使用OHAudio开发音频播放功能</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-recording">使用OHAudio开发音频录制功能</a>。</p></li>      <li>       <p>当前仅支持通过有线耳机实现耳返功能。音频由有线耳机采集并播放。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发指导">开发指导<i class="anchor-icon anchor-icon-link" anchorid="开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="创建音频录制" class="firsth2">创建音频录制<i class="anchor-icon anchor-icon-link" anchorid="创建音频录制" tips="复制节点链接"></i></h3>          <p>通过OHAudio提供OH_AudioStreamBuilder接口，遵循构造器设计模式，构建录制音频流。指定对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiostream-base-h#oh_audiostream_type" target="_blank">OH_AudioStream_Type</a>, 设置为AUDIOSTREAM_TYPE_CAPTURER。</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioStreamBuilder* builder;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_Create</span>(&amp;builder, AUDIOSTREAM_TYPE_CAPTURER);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="创建音频播放">创建音频播放<i class="anchor-icon anchor-icon-link" anchorid="创建音频播放" tips="复制节点链接"></i></h3>          <p>通过OHAudio提供OH_AudioStreamBuilder接口，遵循构造器设计模式，构建播放音频流。指定对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiostream-base-h#oh_audiostream_type" target="_blank">OH_AudioStream_Type</a>, AUDIOSTREAM_TYPE_RENDERER。</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioStreamBuilder* builder;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_Create</span>(&amp;builder, AUDIOSTREAM_TYPE_RENDERER);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置低时延模式">设置低时延模式<i class="anchor-icon anchor-icon-link" anchorid="设置低时延模式" tips="复制节点链接"></i></h3>          <p>为了实现更好的耳返功能，需要使得音频从录制到播放保持较低的时延，当设备支持低时延通路时，开发者需要使用低时延模式来进行录制和播放。</p>     <p>在创建音频录制构造器时调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiostreambuilder-h#oh_audiostreambuilder_setlatencymode" target="_blank">OH_AudioStreamBuilder_SetLatencyMode()</a>设置低时延模式，播放和录制均按如下方式设置为低时延模式。</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioStream_LatencyMode latencyMode = AUDIOSTREAM_LATENCY_MODE_FAST;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetLatencyMode</span>(builder, latencyMode);</li></ol></pre></div></div>     <p>为实现实时耳返功能，需创建一个公共缓存区用于存储录制的数据，并及时从该缓存区获取数据写入播放构造器。</p>    </div>    <div class="tiledSection">     <h3 id="定义公共缓存和录制播放函数">定义公共缓存和录制、播放函数<i class="anchor-icon anchor-icon-link" anchorid="定义公共缓存和录制播放函数" tips="复制节点链接"></i></h3>          <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建一块公共缓存buffer，用于写入录制数据和读取播放数据。</span></li><li>
</li><li><span class="hljs-comment">// 自定义读入录制数据函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnReadData</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioCapturer* capturer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* buffer,</span></li><li><span class="hljs-function">        <span class="hljs-type">int32_t</span> length)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 从buffer中取出length长度的录音数据，放在创建好的公共缓存buffer中，用于供renderer进行读取。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 自定义写入数据函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnWriteData</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioRenderer* renderer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* buffer,</span></li><li><span class="hljs-function">        <span class="hljs-type">int32_t</span> length)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 从公共缓存buffer中读取数据，并按length长度写入buffer。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li></ol></pre></div></div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>应用的公共缓存大小不应设置过大，以避免增加耳返时延，影响用户体验。开发者应根据时延要求和抗抖动要求，选择合适的缓存大小，确保用户体验。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="设置音频流参数">设置音频流参数<i class="anchor-icon anchor-icon-link" anchorid="设置音频流参数" tips="复制节点链接"></i></h3>          <p>以录制流参数设置为例：</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置音频采样率。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetSamplingRate</span>(builder, <span class="hljs-number">48000</span>);</li><li><span class="hljs-comment">// 设置音频声道。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetChannelCount</span>(builder, <span class="hljs-number">2</span>);</li><li><span class="hljs-comment">// 设置音频采样格式。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetSampleFormat</span>(builder, AUDIOSTREAM_SAMPLE_S16LE);</li><li><span class="hljs-comment">// 设置音频流的编码类型。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetEncodingType</span>(builder, AUDIOSTREAM_ENCODING_TYPE_RAW);</li><li><span class="hljs-comment">// 设置输出音频流的工作场景。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetRendererInfo</span>(builder, AUDIOSTREAM_SOURCE_TYPE_MIC);</li></ol></pre></div></div>     <p>对于播放流，除了音频流的工作场景外，其余设置为和录制流相同的参数。</p>     <p>工作场景参数设置如下：</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetRendererInfo</span>(builder, AUDIOSTREAM_USAGE_MUSIC);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置录制回调函数">设置录制回调函数<i class="anchor-icon anchor-icon-link" anchorid="设置录制回调函数" tips="复制节点链接"></i></h3>          <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 自定义读入数据函数。</span></li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnReadData</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">    OH_AudioCapturer* capturer,</span></li><li><span class="hljs-function">    <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">    <span class="hljs-type">void</span>* buffer,</span></li><li><span class="hljs-function">    <span class="hljs-type">int32_t</span> length)</span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 从buffer中取出length长度的录音数据。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-comment">// 自定义音频流事件函数。</span></li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnStreamEvent</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">    OH_AudioCapturer* capturer,</span></li><li><span class="hljs-function">    <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">    OH_AudioStream_Event event)</span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 根据event表示的音频流事件信息，更新录制器状态和界面。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-comment">// 自定义音频中断事件函数。</span></li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnInterruptEvent</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">    OH_AudioCapturer* capturer,</span></li><li><span class="hljs-function">    <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">    OH_AudioInterrupt_ForceType type,</span></li><li><span class="hljs-function">    OH_AudioInterrupt_Hint hint)</span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 根据type和hint表示的音频中断信息，更新录制器状态和界面。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-comment">// 自定义异常回调函数。</span></li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnError</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">    OH_AudioCapturer* capturer,</span></li><li><span class="hljs-function">    <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">    OH_AudioStream_Result error)</span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 根据error表示的音频异常信息，做出相应的处理。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li>OH_AudioCapturer_Callbacks callbacks;</li><li>
</li><li><span class="hljs-comment">// 配置回调函数。</span></li><li>callbacks.OH_AudioCapturer_OnReadData = MyOnReadData;</li><li>callbacks.OH_AudioCapturer_OnStreamEvent = MyOnStreamEvent;</li><li>callbacks.OH_AudioCapturer_OnInterruptEvent = MyOnInterruptEvent;</li><li>callbacks.OH_AudioCapturer_OnError = MyOnError;</li><li>
</li><li><span class="hljs-comment">// 设置音频输入流的回调。</span></li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetCapturerCallback</span>(builder, callbacks, <span class="hljs-literal">nullptr</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置播放回调函数">设置播放回调函数<i class="anchor-icon anchor-icon-link" anchorid="设置播放回调函数" tips="复制节点链接"></i></h3>          <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>    <span class="hljs-comment">// 自定义写入数据函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnWriteData</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioRenderer* renderer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* buffer,</span></li><li><span class="hljs-function">        <span class="hljs-type">int32_t</span> length)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 从公共缓存BUFFER中读取数据，并按length长度写入buffer。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 自定义音频流事件函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnStreamEvent</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioRenderer* renderer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        OH_AudioStream_Event event)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 根据event表示的音频流事件信息，更新播放器状态和界面。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 自定义音频中断事件函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnInterruptEvent</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioRenderer* renderer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        OH_AudioInterrupt_ForceType type,</span></li><li><span class="hljs-function">        OH_AudioInterrupt_Hint hint)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 根据type和hint表示的音频中断信息，更新播放器状态和界面。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 自定义异常回调函数。</span></li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyOnError</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">        OH_AudioRenderer* renderer,</span></li><li><span class="hljs-function">        <span class="hljs-type">void</span>* userData,</span></li><li><span class="hljs-function">        OH_AudioStream_Result error)</span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-comment">// 根据error表示的音频异常信息，做出相应的处理。</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>
</li><li>    OH_AudioRenderer_Callbacks callbacks;</li><li>
</li><li>    <span class="hljs-comment">// 配置回调函数。</span></li><li>    callbacks.OH_AudioRenderer_OnWriteData = MyOnWriteData;</li><li>    callbacks.OH_AudioRenderer_OnStreamEvent = MyOnStreamEvent;</li><li>    callbacks.OH_AudioRenderer_OnInterruptEvent = MyOnInterruptEvent;</li><li>    callbacks.OH_AudioRenderer_OnError = MyOnError;</li><li>
</li><li>    <span class="hljs-comment">// 设置输出音频流的回调。</span></li><li>    <span class="hljs-built_in">OH_AudioStreamBuilder_SetRendererCallback</span>(builder, callbacks, <span class="hljs-literal">nullptr</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="构造录制音频流">构造录制音频流<i class="anchor-icon anchor-icon-link" anchorid="构造录制音频流" tips="复制节点链接"></i></h3>          <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioCapturer* audioCapturer;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_GenerateCapturer</span>(builder, &amp;audioCapturer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="构造播放音频流">构造播放音频流<i class="anchor-icon anchor-icon-link" anchorid="构造播放音频流" tips="复制节点链接"></i></h3>          <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioRenderer* audioRenderer;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_GenerateRenderer</span>(builder, &amp;audioRenderer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用音频流">使用音频流<i class="anchor-icon anchor-icon-link" anchorid="使用音频流" tips="复制节点链接"></i></h3>          <p>以录制为例，开发者可以使用以下接口控制音频流的开始、暂停、停止和释放。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>在实现耳返功能时，开发者需同时控制录制流和播放流，确保两者同步。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.3.1.1" valign="top" width="50%">接口</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_AudioStream_Result <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_start" target="_blank">OH_AudioRenderer_Start</a>(OH_AudioRenderer* renderer)</td>         <td class="cellrowborder" valign="top" width="50%">开始播放。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_AudioStream_Result <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_pause" target="_blank">OH_AudioRenderer_Pause</a>(OH_AudioRenderer* renderer)</td>         <td class="cellrowborder" valign="top" width="50%">暂停播放。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_AudioStream_Result <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_stop" target="_blank">OH_AudioRenderer_Stop</a>(OH_AudioRenderer* renderer)</td>         <td class="cellrowborder" valign="top" width="50%">停止播放。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_AudioStream_Result <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_flush" target="_blank">OH_AudioRenderer_Flush</a>(OH_AudioRenderer* renderer)</td>         <td class="cellrowborder" valign="top" width="50%">释放缓存数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_AudioStream_Result <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_release" target="_blank">OH_AudioRenderer_Release</a>(OH_AudioRenderer* renderer)</td>         <td class="cellrowborder" valign="top" width="50%">释放播放实例。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="释放构造器">释放构造器<i class="anchor-icon anchor-icon-link" anchorid="释放构造器" tips="复制节点链接"></i></h3>          <p>构造器不再使用时，采用如下方式释放资源。</p>     <div _ngcontent-oqw-c106="" class="highlight-div"><div _ngcontent-oqw-c106="" class="highlight-div-header"><div _ngcontent-oqw-c106="" class="highlight-div-header-left"><div _ngcontent-oqw-c106="" class="handle-button expand-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oqw-c106="" class="highlight-div-header-right"><div _ngcontent-oqw-c106="" class="handle-button ai-button"></div><div _ngcontent-oqw-c106="" class="handle-button line-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oqw-c106="" class="handle-button theme-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oqw-c106="" class="handle-button copy-button"><div _ngcontent-oqw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oqw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioStreamBuilder_Destroy</span>(builder);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>