<h1 _ngcontent-rjp-c119="" class="doc-title ng-star-inserted" title="实现音频输出设备路由切换"> 实现音频输出设备路由切换 </h1>

<div _ngcontent-rjp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>当应用进行音频输出时，系统会根据音频流类型选择对应的输出设备（STREAM_USAGE_MUSIC：扬声器发声；STREAM_USAGE_VOICE_COMMUNICATION：听筒发声）。如果系统提供的默认输出设备不满足应用需求，应用可通过AVCastPicker或setDefaultOutputDevice实现音频输出设备路由切换。</p>    <div class="tiledSection">     <h2 id="媒体类应用实现输出设备路由切换">媒体类应用实现输出设备路由切换<i class="anchor-icon anchor-icon-link" anchorid="媒体类应用实现输出设备路由切换" tips="复制节点链接"></i></h2>          <p>应用可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-multimedia-avcastpicker#avcastpicker" target="_blank">AVCastPicker</a>投播组件进行媒体类应用输出设备路由切换。</p>    </div>    <div class="tiledSection">     <h2 id="通话类应用实现输出设备路由切换">通话类应用实现输出设备路由切换<i class="anchor-icon anchor-icon-link" anchorid="通话类应用实现输出设备路由切换" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="外接设备路由切换" class="firsth2">外接设备路由切换<i class="anchor-icon anchor-icon-link" anchorid="外接设备路由切换" tips="复制节点链接"></i></h3>          <p>应用可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-switch-call-devices">AVCastPicker通话组件</a>进行通话类应用外接输出设备路由切换。</p>    </div>    <div class="tiledSection">     <h3 id="内置听筒和扬声器路由切换">内置听筒和扬声器路由切换<i class="anchor-icon anchor-icon-link" anchorid="内置听筒和扬声器路由切换" tips="复制节点链接"></i></h3>          <p>如果未连接外设，语音通话场景系统默认听筒发声，其他场景系统默认扬声器发声；如果连接了外设，系统默认通过外接设备发声。</p>     <p>调用setDefaultOutputDevice设置音频输出设备后，如需取消，可将参数设为audio.DeviceType.DEFAULT，将音频输出设备选择权交还给系统。</p>     <ol>      <li>       <p>从API version 12开始，应用可使用AudioRenderer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#setdefaultoutputdevice12" target="_blank">setDefaultOutputDevice</a>设置听筒和扬声器路由切换，调用前需要先获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-f#audiocreateaudiorenderer8" target="_blank">AudioRenderer</a>实例。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>由于AudioRenderer是流级别，调用本接口设置的默认音频输出设备仅对当前流生效。</li>          <li>本接口优先级低于AudioSessionManager的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setdefaultoutputdevice20" target="_blank">setDefaultOutputDevice</a>。如果使用AudioSessionManager的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setdefaultoutputdevice20" target="_blank">setDefaultOutputDevice</a>设置了默认音频输出设备，本接口的设置将不会生效。</li>         </ul>        </div></div></div>       <div _ngcontent-rjp-c106="" class="highlight-div"><div _ngcontent-rjp-c106="" class="highlight-div-header"><div _ngcontent-rjp-c106="" class="highlight-div-header-left"><div _ngcontent-rjp-c106="" class="handle-button expand-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rjp-c106="" class="highlight-div-header-right"><div _ngcontent-rjp-c106="" class="handle-button ai-button"></div><div _ngcontent-rjp-c106="" class="handle-button line-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rjp-c106="" class="handle-button theme-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rjp-c106="" class="handle-button copy-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rjp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为本机扬声器。</span></li><li>audioRenderer.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">SPEAKER</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in setting default output device.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set default output device. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为系统默认输出设备，即取消应用设置的默认设备，交由系统选择设备。</span></li><li>audioRenderer.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">DEFAULT</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in setting default output device.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set default output device. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>从API version 20开始，应用可使用AudioSessionManager的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setdefaultoutputdevice20" target="_blank">setDefaultOutputDevice</a>设置听筒和扬声器路由切换。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>由于AudioSessionManager是应用级设置，调用本接口设置默认音频输出设备，会对当前应用所有适用范围内的音频流生效，且会覆盖AudioRenderer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#setdefaultoutputdevice12" target="_blank">setDefaultOutputDevice</a>接口设置的默认音频输出设备信息。</p>        </div></div></div>       <div _ngcontent-rjp-c106="" class="highlight-div"><div _ngcontent-rjp-c106="" class="highlight-div-header"><div _ngcontent-rjp-c106="" class="highlight-div-header-left"><div _ngcontent-rjp-c106="" class="handle-button expand-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rjp-c106="" class="highlight-div-header-right"><div _ngcontent-rjp-c106="" class="handle-button ai-button"></div><div _ngcontent-rjp-c106="" class="handle-button line-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rjp-c106="" class="handle-button theme-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rjp-c106="" class="handle-button copy-button"><div _ngcontent-rjp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rjp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;  <span class="hljs-comment">// 导入audio模块。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();  <span class="hljs-comment">// 需要先创建AudioManager实例。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioSessionManager = audioManager.<span class="hljs-title function_">getSessionManager</span>();  <span class="hljs-comment">// 再调用AudioManager的方法创建AudioSessionManager实例。</span></li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为本机扬声器。</span></li><li>audioSessionManager.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">SPEAKER</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in setting default output device.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set default output device. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为系统默认输出设备，即取消应用设置的默认设备，交由系统选择设备。</span></li><li>audioSessionManager.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">DEFAULT</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in setting default output device.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set default output device. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>