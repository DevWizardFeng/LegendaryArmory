<h1 _ngcontent-jrs-c119="" class="doc-title ng-star-inserted" title="宿主应用发起分享需使用精细化的utd类型"> 宿主应用发起分享需使用精细化的utd类型 </h1>

<div _ngcontent-jrs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>utd类型指分享数据的数据类型，精准的数据类型有助于帮助宿主应用匹配到精确的目标应用，让分享内容更好的传递。</p> <p>当构造分享数据时，推荐宿主应用填写精准的utd类型，可通过以下两种方式获取：</p> <ul><li>根据给定的文件后缀名和所归属的标准化数据类型查询标准化数据类型的ID。参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-uniformtypedescriptor#uniformtypedescriptorgetuniformdatatypebyfilenameextension11" target="_blank">uniformTypeDescriptor.getUniformDataTypeByFilenameExtension</a>。<div _ngcontent-jrs-c106="" class="highlight-div"><div _ngcontent-jrs-c106="" class="highlight-div-header"><div _ngcontent-jrs-c106="" class="highlight-div-header-left"><div _ngcontent-jrs-c106="" class="handle-button expand-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jrs-c106="" class="highlight-div-header-right"><div _ngcontent-jrs-c106="" class="handle-button ai-button"></div><div _ngcontent-jrs-c106="" class="handle-button line-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jrs-c106="" class="handle-button theme-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jrs-c106="" class="handle-button copy-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor <span class="hljs-keyword">as</span> utd } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { systemShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> utdTypeId = utd.<span class="hljs-title function_">getUniformDataTypeByFilenameExtension</span>(<span class="hljs-string">'.jpg'</span>, utd.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">IMAGE</span>);</li><li>  <span class="hljs-keyword">if</span> (utdTypeId) {</li><li>    <span class="hljs-comment">// 构造ShareData，需配置一条有效数据信息</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">shareData</span>: systemShare.<span class="hljs-property">SharedData</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">SharedData</span>({</li><li>      <span class="hljs-attr">utd</span>: utdTypeId,</li><li>      <span class="hljs-attr">uri</span>: <span class="hljs-string">'file://.../xxx.jpg'</span></li><li>    });</li><li>    <span class="hljs-comment">// 构建ShareController</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">controller</span>: systemShare.<span class="hljs-property">ShareController</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">ShareController</span>(shareData);</li><li>    <span class="hljs-comment">// 获取UIAbility上下文对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = uiContext.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-comment">// 进行分享面板显示</span></li><li>    controller.<span class="hljs-title function_">show</span>(context, {</li><li>      <span class="hljs-attr">previewMode</span>: systemShare.<span class="hljs-property">SharePreviewMode</span>.<span class="hljs-property">DEFAULT</span>,</li><li>      <span class="hljs-attr">selectionMode</span>: systemShare.<span class="hljs-property">SelectionMode</span>.<span class="hljs-property">SINGLE</span></li><li>    });</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to getUniformDataTypeByFilenameExtension. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span> `</span>);</li><li>}</li></ol></pre></div></div> </li><li>根据给定的MIME类型和所归属的标准化数据类型查询标准化数据类型的ID。参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-uniformtypedescriptor#uniformtypedescriptorgetuniformdatatypebymimetype11" target="_blank">uniformTypeDescriptor.getUniformDataTypeByMIMEType</a>。<div _ngcontent-jrs-c106="" class="highlight-div"><div _ngcontent-jrs-c106="" class="highlight-div-header"><div _ngcontent-jrs-c106="" class="highlight-div-header-left"><div _ngcontent-jrs-c106="" class="handle-button expand-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jrs-c106="" class="highlight-div-header-right"><div _ngcontent-jrs-c106="" class="handle-button ai-button"></div><div _ngcontent-jrs-c106="" class="handle-button line-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jrs-c106="" class="handle-button theme-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jrs-c106="" class="handle-button copy-button"><div _ngcontent-jrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor <span class="hljs-keyword">as</span> utd } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { systemShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> utdTypeId = utd.<span class="hljs-title function_">getUniformDataTypeByMIMEType</span>(<span class="hljs-string">'image/jpeg'</span>, utd.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">IMAGE</span>);</li><li>  <span class="hljs-keyword">if</span> (utdTypeId) {</li><li>    <span class="hljs-comment">// 构造ShareData，需配置一条有效数据信息</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">shareData</span>: systemShare.<span class="hljs-property">SharedData</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">SharedData</span>({</li><li>      <span class="hljs-attr">utd</span>: utdTypeId,</li><li>      <span class="hljs-attr">uri</span>: <span class="hljs-string">'file://.../xxx.jpg'</span></li><li>    });</li><li>    <span class="hljs-comment">// 构建ShareController</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">controller</span>: systemShare.<span class="hljs-property">ShareController</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">ShareController</span>(shareData);</li><li>    <span class="hljs-comment">// 获取UIAbility上下文对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = uiContext.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-comment">// 进行分享面板显示</span></li><li>    controller.<span class="hljs-title function_">show</span>(context, {</li><li>      <span class="hljs-attr">previewMode</span>: systemShare.<span class="hljs-property">SharePreviewMode</span>.<span class="hljs-property">DEFAULT</span>,</li><li>      <span class="hljs-attr">selectionMode</span>: systemShare.<span class="hljs-property">SelectionMode</span>.<span class="hljs-property">SINGLE</span></li><li>    });</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to getUniformDataTypeByMIMEType. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span> `</span>);</li><li>}</li></ol></pre></div></div> </li></ul> </div> <div></div></div>