<h1 _ngcontent-wts-c119="" class="doc-title ng-star-inserted" title="密钥证明介绍及算法规格"> 密钥证明介绍及算法规格 </h1>

<div _ngcontent-wts-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>HUKS为密钥提供合法性证明能力，主要应用于非对称密钥的公钥的证明。</p> <p>基于PKI证书链技术，HUKS可以为存储在HUKS中的非对称密钥对的公钥签发证书，证明其公钥的合法性。业务可以通过系统提供的根CA证书，逐级验证HUKS签发的密钥证明证书，来确保证书中的公钥以及对应的私钥，确实来自合法的硬件设备，且存储管理在HUKS中。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ol><li>当调用方为系统服务且APL等级为normal时，暂不支持密钥证明，此种情况下，processName与APL字段将置空。</li><li>密钥证明功能在模拟器场景不支持。</li><li>轻量级智能穿戴不支持密钥证明功能。</li><li>支持生成密钥和导入密钥进行密钥证明，业务方在服务器侧需要通过业务证书中的密钥来源字段校验密钥来源是否符合预期。</li></ol>  </div></div></div> <p>密钥证明扩展域段为Asn.1 DER标准编码格式，数据结构定义如下：</p> <div _ngcontent-wts-c106="" class="highlight-div"><div _ngcontent-wts-c106="" class="highlight-div-header"><div _ngcontent-wts-c106="" class="highlight-div-header-left"><div _ngcontent-wts-c106="" class="handle-button expand-button"><div _ngcontent-wts-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wts-c106="" class="highlight-div-header-right"><div _ngcontent-wts-c106="" class="handle-button ai-button"></div><div _ngcontent-wts-c106="" class="handle-button line-button"><div _ngcontent-wts-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wts-c106="" class="handle-button theme-button"><div _ngcontent-wts-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wts-c106="" class="handle-button copy-button"><div _ngcontent-wts-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wts-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-go" data-highlighted="yes"><ol class="linenums"><li>KeyAttestation ::= SEQUENCE {</li><li>  version            AttestationVersion DEFAULT v1,</li><li>  claim1             AttestationClaim,</li><li>  claim2             AttestationClaim,</li><li>  claim3             AttestationClaim,</li><li>  ... ...</li><li>}</li><li>AttestationVersion ::= INTEGER { v1(<span class="hljs-number">0</span>) }</li><li>AttestationClaim ::= SEQUENCE {</li><li>  securityLevel      SecurityLevel,</li><li>  <span class="hljs-keyword">type</span>               AttestationType,</li><li>  value              AttestationValue</li><li>}</li><li>SecurityLevel ::= INTEGER</li><li>AttestationType ::= OBJECT IDENTIFIER</li><li>AttestationValue ::= ANY -- DEFINED BY AttestationType</li><li>ApplicationIDType ::= SEQUENCE {</li><li>  <span class="hljs-keyword">type</span>               OBJECT IDENTIFIER,</li><li>  value              OCT_STR</li><li>}</li></ol></pre></div></div> <p>常用AttestationClaim类型取值说明：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.1.5.1.1" valign="top" width="25%">type（OID）取值</th> <th align="left" class="cellrowborder" id="mcps1.3.7.1.5.1.2" valign="top" width="25%">value的数据类型</th> <th align="left" class="cellrowborder" id="mcps1.3.7.1.5.1.3" valign="top" width="25%">securityLevel</th> <th align="left" class="cellrowborder" id="mcps1.3.7.1.5.1.4" valign="top" width="25%">Claim说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">1.3.6.1.4.1.2011.2.376.2.1.4</td> <td class="cellrowborder" valign="top" width="25%">OCT_STR</td> <td class="cellrowborder" valign="top" width="25%">保留字段，暂不使用</td> <td class="cellrowborder" valign="top" width="25%">应用输入的挑战值Challenge。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">1.3.6.1.4.1.2011.2.376.2.1.3</td> <td class="cellrowborder" valign="top" width="25%">ApplicationIDType</td> <td class="cellrowborder" valign="top" width="25%">保留字段，暂不使用</td> <td class="cellrowborder" valign="top" width="25%">应用ID。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">1.3.6.1.4.1.2011.2.376.2.1.5</td> <td class="cellrowborder" valign="top" width="25%">OCT_STR</td> <td class="cellrowborder" valign="top" width="25%">保留字段，暂不使用</td> <td class="cellrowborder" valign="top" width="25%">密钥来源，生成或者导入。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">1.3.6.1.4.1.2011.2.376.2.2.4.8</td> <td class="cellrowborder" valign="top" width="25%">UTF8_STR</td> <td class="cellrowborder" valign="top" width="25%">保留字段，暂不使用</td> <td class="cellrowborder" valign="top" width="25%">产品型号Model。从API 20开始支持。</td> </tr>  </tbody></table></div> </div> <p>ApplicationIDType类型取值说明：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.1.3.1.1" valign="top" width="50%">type（OID）取值</th> <th align="left" class="cellrowborder" id="mcps1.3.9.1.3.1.2" valign="top" width="50%">value取值说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">1.3.6.1.4.1.2011.2.376.2.1.3.1</td> <td class="cellrowborder" valign="top" width="50%"><p>样例：{appId:"xxx", bundleName:"xxx", appIdentifier:"xxx", appMode:"xxx"}</p> <p>其中appIdentifier、appMode从API 20开始支持。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">1.3.6.1.4.1.2011.2.376.2.1.3.2</td> <td class="cellrowborder" valign="top" width="50%"><p>样例：{processName:"xxx", APL:"system_basic | system_core"} </p> <p>APL为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限机制中的基本概念">系统服务等级</a>。</p> </td> </tr>  </tbody></table></div> </div> <p>密钥证明过程如下：</p> <ol><li><p>业务将指定密钥别名和需要证明的密钥属性的标签传入HUKS。</p>  </li><li><p>调用HUKS为应用生成一个依次由根CA证书、设备CA证书、设备证书、密钥证书组成的X.509证书链。</p>  </li><li><p>将证书链传输至受信任的服务器，并在服务器上解析和验证证书链的有效性和单个证书是否吊销。</p>  </li></ol> <p>当前提供了匿名密钥证明的方式，不会泄露设备信息，没有权限管理。面向所有应用开放。为了保护用户设备信息，三方应用开发者只能使用匿名密钥证明。</p> <p>当前模拟器支持匿名证书，调试环境中使用的证书非真实设备证书，云侧需要区分该场景，避免误用。</p>  <div class="tiledSection"><h2 id="支持的算法">支持的算法<i class="anchor-icon anchor-icon-link" anchorid="支持的算法" tips="复制节点链接"></i></h2><p>以下为密钥证明支持的规格说明。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.3.1.4.1.1" valign="top" width="33.33333333333333%">算法</th> <th align="left" class="cellrowborder" id="mcps1.3.14.3.1.4.1.2" valign="top" width="33.33333333333333%">备注</th> <th align="left" class="cellrowborder" id="mcps1.3.14.3.1.4.1.3" valign="top" width="33.33333333333333%">API级别</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">RSA</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">支持Padding为PSS与PKCS1_V1_5的密钥</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">11+</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">ECC</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">11+</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">X25519</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">16+</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">ED25519</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">16+</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">SM2</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">11+</td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>