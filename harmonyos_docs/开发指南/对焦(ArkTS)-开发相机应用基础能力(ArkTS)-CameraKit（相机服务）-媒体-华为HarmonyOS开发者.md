<h1 _ngcontent-xpg-c119="" class="doc-title ng-star-inserted" title="对焦(ArkTS)"> 对焦(ArkTS) </h1>

<div _ngcontent-xpg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>相机框架提供对设备对焦的能力，业务应用可以根据使用场景进行对焦模式和对焦点的设置。</p> <div class="tiledSection"><h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2><p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p> <ol><li><p>导入相关接口，导入方法如下。</p> <div _ngcontent-xpg-c106="" class="highlight-div"><div _ngcontent-xpg-c106="" class="highlight-div-header"><div _ngcontent-xpg-c106="" class="highlight-div-header-left"><div _ngcontent-xpg-c106="" class="handle-button expand-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xpg-c106="" class="highlight-div-header-right"><div _ngcontent-xpg-c106="" class="handle-button ai-button"></div><div _ngcontent-xpg-c106="" class="handle-button line-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xpg-c106="" class="handle-button theme-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xpg-c106="" class="handle-button copy-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xpg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div> </li><li><p>在设置对焦模式前，需要先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-focusquery#isfocusmodesupported11" target="_blank">isFocusModeSupported</a>检查设备是否支持指定的焦距模式。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要在Session调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#commitconfig11" target="_blank">commitConfig</a>完成配流之后调用。</p> </div></div></div> <div _ngcontent-xpg-c106="" class="highlight-div"><div _ngcontent-xpg-c106="" class="highlight-div-header"><div _ngcontent-xpg-c106="" class="highlight-div-header-left"><div _ngcontent-xpg-c106="" class="handle-button expand-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xpg-c106="" class="highlight-div-header-right"><div _ngcontent-xpg-c106="" class="handle-button ai-button"></div><div _ngcontent-xpg-c106="" class="handle-button line-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xpg-c106="" class="handle-button theme-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xpg-c106="" class="handle-button copy-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xpg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">isFocusModeSupported</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">status</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 以检查是否支持自动对焦模式为例。</span></li><li>    status = photoSession.<span class="hljs-title function_">isFocusModeSupported</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_AUTO</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 失败返回错误码error.code并处理。</span></li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`The isFocusModeSupported call failed. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> status;</li><li>}</li></ol></pre></div></div> </li><li><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-focus#setfocusmode11" target="_blank">setFocusMode</a>设置对焦模式。</p> <div class="p">若设置为自动对焦模式，支持调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-focus#setfocuspoint11" target="_blank">setFocusPoint</a>设置对焦点，根据对焦点执行一次自动对焦。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要在Session调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#commitconfig11" target="_blank">commitConfig</a>完成配流之后调用。</p> </div></div></div> <div _ngcontent-xpg-c106="" class="highlight-div"><div _ngcontent-xpg-c106="" class="highlight-div-header"><div _ngcontent-xpg-c106="" class="highlight-div-header-left"><div _ngcontent-xpg-c106="" class="handle-button expand-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xpg-c106="" class="highlight-div-header-right"><div _ngcontent-xpg-c106="" class="handle-button ai-button"></div><div _ngcontent-xpg-c106="" class="handle-button line-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xpg-c106="" class="handle-button theme-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xpg-c106="" class="handle-button copy-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xpg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setFocusMode</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">focusPoint</span>: camera.<span class="hljs-property">Point</span> = {<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1</span>};</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 设置自动对焦模式。</span></li><li>    photoSession.<span class="hljs-title function_">setFocusMode</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_AUTO</span>);</li><li>    <span class="hljs-comment">// 设置对焦点。</span></li><li>    photoSession.<span class="hljs-title function_">setFocusPoint</span>(focusPoint);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 失败返回错误码error.code并处理。</span></li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`The setFocusMode and setFocusPoint call failed. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </li></ol> </div> <div class="tiledSection"><h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2><p>在相机应用开发过程中，可以随时监听相机聚焦的状态变化。</p> <p>通过注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession#onfocusstatechange11" target="_blank">focusStateChange</a>的回调函数获取监听结果，仅当自动对焦模式时，且相机对焦状态发生改变时触发该事件。</p> <div _ngcontent-xpg-c106="" class="highlight-div"><div _ngcontent-xpg-c106="" class="highlight-div-header"><div _ngcontent-xpg-c106="" class="highlight-div-header-left"><div _ngcontent-xpg-c106="" class="handle-button expand-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xpg-c106="" class="highlight-div-header-right"><div _ngcontent-xpg-c106="" class="handle-button ai-button"></div><div _ngcontent-xpg-c106="" class="handle-button line-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xpg-c106="" class="handle-button theme-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xpg-c106="" class="handle-button copy-button"><div _ngcontent-xpg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xpg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onFocusStateChange</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>): <span class="hljs-built_in">void</span> {</li><li>  photoSession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'focusStateChange'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, focusState: camera.FocusState</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`focusStateChange error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`focusStateChange focusState: <span class="hljs-subst">${focusState}</span>`</span>);</li><li>    <span class="hljs-comment">// 为保证对焦功能的用户体验，在自动对焦成功后，可将对焦模式设置为连续自动对焦,以满足复杂拍摄场景的对焦需求。</span></li><li>    <span class="hljs-keyword">if</span> (focusState === camera.<span class="hljs-property">FocusState</span>.<span class="hljs-property">FOCUS_STATE_FOCUSED</span>) {</li><li>      photoSession.<span class="hljs-title function_">setFocusMode</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_CONTINUOUS_AUTO</span>);</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>