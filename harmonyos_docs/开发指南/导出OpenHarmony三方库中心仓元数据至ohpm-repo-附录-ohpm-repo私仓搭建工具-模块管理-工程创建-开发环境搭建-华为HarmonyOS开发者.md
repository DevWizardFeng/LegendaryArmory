<h1 _ngcontent-cjv-c119="" class="doc-title ng-star-inserted" title="导出OpenHarmony三方库中心仓元数据至ohpm-repo"> 导出OpenHarmony三方库中心仓元数据至ohpm-repo </h1>

<div _ngcontent-cjv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001886627853"><p id="ZH-CN_TOPIC_0000002478173746__p14768122714416">支持通过export_pkginfo和batch_download命令，将OpenHarmony三方库中心仓中所有包批量导出，并能够通过batch_publish命令将导出的库批量上传至部署的ohpm-repo实例中。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002478173746__p167371053172617">开始执行下面的命令之前，请确保已经执行过ohpm-repo install和ohpm-repo start命令。</p> </div></div></div> <div class="tiledSection"><h2 id="section5715177104519">获取所有已上架的包列表<i class="anchor-icon anchor-icon-link" anchorid="section5715177104519" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478173746__p986521918209">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-export-pkginfo">export_pkginfo</a> 命令，导出OpenHarmony三方库中心仓已上架的包列表。</p> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" id="ZH-CN_TOPIC_0000002478173746__screen4396161819173" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo export_pkginfo <span class="hljs-attr">--public-registry</span> &lt;OpenHarmony三方库中心仓registry地址&gt; <span class="hljs-attr">--http-proxy</span> &lt;可选配置代理地址&gt;</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478173746__p13935153420171">执行结果</p> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173746__screen18199072583" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">PS</span> <span class="hljs-variable">C</span>:\<span class="hljs-title class_">Users</span>\<span class="hljs-title class_">xxxxx</span>\<span class="hljs-title class_">Desktop</span>&gt; <span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span> <span class="hljs-title class_">export_pkginfo</span>  --<span class="hljs-keyword">public</span>-<span class="hljs-title class_">registry</span> <span class="hljs-title class_">https</span>:<span class="hljs-comment">//ohpm.openharmony.cn/ohpm/</span></li><li>...</li><li>[<span class="hljs-variable">xxxx</span>-<span class="hljs-variable">xx</span>-<span class="hljs-variable">xxTxx</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46.664</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">DEFAULT</span> - <span class="hljs-variable">Export</span> <span class="hljs-number">912</span> <span class="hljs-variable">packages</span> <span class="hljs-variable">names</span> <span class="hljs-variable">success</span>: <span class="hljs-title class_">save</span> <span class="hljs-title class_">to</span> <span class="hljs-string">"C:\Users\xxxxx\Desktop\pkgInfo_1712069506662.json"</span>.</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478173746__p269511585611"></p> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-perl" id="ZH-CN_TOPIC_0000002478173746__screen10126192771518" data-highlighted="yes"><ol class="linenums"><li>// pkgInfo_1712069506662.json中记录着公仓的包列表</li><li>{</li><li>  <span class="hljs-string">"packageNameArray"</span>: [</li><li>    <span class="hljs-string">"@ohos/lottie-turbo@1.0.0"</span>,</li><li>    <span class="hljs-string">"@ohos/lottie-turbo@1.0.0-rc.0"</span>,</li><li>    <span class="hljs-string">"@ohos/lottie-turbo@1.0.0-rc.1"</span>,</li><li>    ...</li><li>  ]</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section198364121219">批量下载三方包<i class="anchor-icon anchor-icon-link" anchorid="section198364121219" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478173746__p115261617384">执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-batch-download">batch_download</a>命令将上一步生成的pkgInfo_xxx.json文件中记录的包全部下载。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002478173746__p718333511114">若只需要下载中心仓的部分包，可以手动修改pkgInfo_xxx.json文件，此时该命令只会批量下载pkgInfo_xxx.json文件中指定的包。</p> </div></div></div> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" id="ZH-CN_TOPIC_0000002478173746__screen6664184791119" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml">ohpm-repo batch_download <span class="hljs-tag">&lt;<span class="hljs-name">pkgInfo_xxx.json文件地址</span>&gt;</span> --public-registry <span class="hljs-tag">&lt;<span class="hljs-name">OpenHarmony三方库中心仓registry地址</span>&gt;</span> --http-proxy <span class="hljs-tag">&lt;<span class="hljs-name">配置代理地址</span>&gt;</span> --not-use-proxy <span class="hljs-tag">&lt;<span class="hljs-name">配置不使用代理</span>&gt;</span></span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478173746__p169051028181314">执行结果</p> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173746__screen893418329131" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">PS</span> <span class="hljs-variable">C</span>:\<span class="hljs-title class_">Users</span>\<span class="hljs-title class_">xxxxx</span>\<span class="hljs-title class_">Desktop</span>&gt; <span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span> <span class="hljs-title class_">batch_download</span> <span class="hljs-title class_">C</span>:\<span class="hljs-title class_">Users</span>\<span class="hljs-title class_">xxxxx</span>\<span class="hljs-title class_">Desktop</span>\<span class="hljs-title class_">pkgInfo_1712069506662</span>.<span class="hljs-title class_">json</span> --<span class="hljs-keyword">public</span>-<span class="hljs-title class_">registry</span> <span class="hljs-title class_">https</span>:<span class="hljs-comment">//ohpm.openharmony.cn/ohpm/</span></li><li>...</li><li>[<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">02</span><span class="hljs-variable">T23</span>:<span class="hljs-number">16</span>:<span class="hljs-number">59.217</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">A</span> <span class="hljs-variable">total</span> <span class="hljs-variable">of</span> <span class="hljs-number">912</span> <span class="hljs-keyword">package</span>(<span class="hljs-variable">s</span>) <span class="hljs-variable">successfully</span> <span class="hljs-variable">obtain</span> <span class="hljs-variable">download</span> <span class="hljs-variable">url</span>.</li><li>[<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">02</span><span class="hljs-variable">T23</span>:<span class="hljs-number">16</span>:<span class="hljs-number">59.217</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">A</span> <span class="hljs-variable">total</span> <span class="hljs-variable">of</span> <span class="hljs-number">912</span> <span class="hljs-keyword">package</span>(<span class="hljs-variable">s</span>) <span class="hljs-variable">are</span> <span class="hljs-variable">successfully</span> <span class="hljs-variable">downloaded</span>.</li><li>[<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">02</span><span class="hljs-variable">T23</span>:<span class="hljs-number">16</span>:<span class="hljs-number">59.217</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">A</span> <span class="hljs-variable">total</span> <span class="hljs-variable">of</span> <span class="hljs-number">912</span> <span class="hljs-keyword">package</span>(<span class="hljs-variable">s</span>) <span class="hljs-variable">are</span> <span class="hljs-variable">converted</span> <span class="hljs-variable">successfully</span>.</li><li>[<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">02</span><span class="hljs-variable">T23</span>:<span class="hljs-number">16</span>:<span class="hljs-number">59.217</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">Packing</span> <span class="hljs-variable">the</span> .<span class="hljs-variable">zip</span> <span class="hljs-variable">file</span>. . .</li><li>[<span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">02</span><span class="hljs-variable">T23</span>:<span class="hljs-number">16</span>:<span class="hljs-number">59.475</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">save</span> <span class="hljs-variable">the</span> .<span class="hljs-variable">zip</span> <span class="hljs-variable">file</span> <span class="hljs-variable">to</span> : <span class="hljs-string">"C:\Users\xxxxx\Desktop\batch_download_1712071006796.zip"</span>.</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478173746__p849710852215"></p> </div> <div class="tiledSection"><h2 id="section1358171714230">批量上传<i class="anchor-icon anchor-icon-link" anchorid="section1358171714230" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478173746__p1897322616245">执行batch_publish命令将上一步生成的batch_download_xxx.zip压缩包中全部包批量上传到ohpm-repo。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ol id="ZH-CN_TOPIC_0000002478173746__ol18327115061811"><li id="li9327195061810">batch_download_xxx.zip文件中存在pkgInfo.json文件，其中记录了每个包的 文件名、包名、组织、上传者、Tag标签，用于在批量上传时准确指定ohpm-repo的数据库中某用户为某包的真实上传用户，同时将包的Tag标签一起上传。</li><li id="li13274502188">假设某个中心仓包的组织为A，如需为其指定ohpm-repo的数据库中某用户为其真实上传用户，但ohpm-repo实例中不存在A组织时，执行batch_download命令后该包的真实上传用户将设定为空，并且提醒用户手动创建A组织。执行批量上传时，也会提醒A组织在ohpm-repo实例中不存在，需要先手动创建A组织。如果需要自动添加组织，使用batch_publish命令的可选参数--force，将会选取一个管理员用户作为A组织负责人，自动创建A组织后进行该包的上传。</li><li id="li118419126193">从ohpm-repo 5.3.0版本开始，ohpm-repo支持配置多个仓库。通过batch_download下载下来的包如果执行batch_publish命令，默认上传到ohpm-repo仓库名为ohpm的仓库中，如果不存在仓库名为ohpm仓库，将报错，可通过batch_publish的选项 --target-repo重新指定需要上传的仓库名。</li></ol> </div></div></div> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" id="ZH-CN_TOPIC_0000002478173746__screen855314211359" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo batch_publish &lt;batch_download_xxx<span class="hljs-selector-class">.zip</span>文件地址&gt; <span class="hljs-attr">--force</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478173746__p1683321815357">执行结果</p> <div _ngcontent-cjv-c106="" class="highlight-div"><div _ngcontent-cjv-c106="" class="highlight-div-header"><div _ngcontent-cjv-c106="" class="highlight-div-header-left"><div _ngcontent-cjv-c106="" class="handle-button expand-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjv-c106="" class="highlight-div-header-right"><div _ngcontent-cjv-c106="" class="handle-button ai-button"></div><div _ngcontent-cjv-c106="" class="handle-button line-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjv-c106="" class="handle-button theme-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjv-c106="" class="handle-button copy-button"><div _ngcontent-cjv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173746__screen6695237124920" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">PS</span> <span class="hljs-variable">C</span>:\<span class="hljs-title class_">Users</span>\<span class="hljs-title class_">xxxxx</span>\<span class="hljs-title class_">Desktop</span>&gt; <span class="hljs-title class_">ohpm</span>-<span class="hljs-title class_">repo</span> <span class="hljs-title class_">batch_publish</span> <span class="hljs-title class_">C</span>:\<span class="hljs-title class_">Users</span>\<span class="hljs-title class_">xxxxx</span>\<span class="hljs-title class_">Desktop</span>\<span class="hljs-title class_">batch_download_1712071006796</span>.<span class="hljs-title class_">zip</span> --<span class="hljs-title class_">force</span></li><li>...</li><li>[<span class="hljs-variable">xxxx</span>-<span class="hljs-variable">xx</span>-<span class="hljs-variable">xxTxx</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29.100</span>] [<span class="hljs-variable">INFO</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">all</span> <span class="hljs-number">912</span> <span class="hljs-keyword">package</span>(<span class="hljs-variable">s</span>) <span class="hljs-variable">are</span> <span class="hljs-variable">successfully</span> <span class="hljs-variable">published</span></li><li>[<span class="hljs-variable">xxxx</span>-<span class="hljs-variable">xx</span>-<span class="hljs-variable">xxTxx</span>:<span class="hljs-number">50</span>:<span class="hljs-number">29.101</span>] [<span class="hljs-variable">WARN</span>] <span class="hljs-variable">default</span> - <span class="hljs-variable">You</span> <span class="hljs-variable">are</span> <span class="hljs-variable">using</span> <span class="hljs-string">"filedb"</span> <span class="hljs-variable">to</span> <span class="hljs-variable">store</span> <span class="hljs-variable">data</span>. <span class="hljs-variable">If</span> <span class="hljs-variable">you</span> <span class="hljs-variable">have</span> <span class="hljs-variable">already</span> <span class="hljs-variable">started</span> <span class="hljs-variable">a</span> <span class="hljs-variable">repository</span> <span class="hljs-variable">service</span>, <span class="hljs-variable">please</span> <span class="hljs-variable">run</span> `<span class="hljs-variable">ohpm</span>-<span class="hljs-variable">repo</span> <span class="hljs-variable">restart</span>` <span class="hljs-variable">to</span> <span class="hljs-variable">restart</span> <span class="hljs-variable">the</span> <span class="hljs-variable">service</span>.</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002478173746__p2777339125210">如果ohpm-repo实例的数据存储类型为filedb，请执行ohpm-repo restart命令重启ohpm-repo服务，以便刷新ohpm-repo实例缓存中的数据。该操作会影响正在使用ohpm-repo服务的用户，请提前告知。</p> </div></div></div> </div> </div> <div></div></div>