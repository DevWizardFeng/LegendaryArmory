<h1 _ngcontent-mgh-c119="" class="doc-title ng-star-inserted" title="展示数字商品"> 展示数字商品 </h1>

<div _ngcontent-mgh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>数字商品服务为接入消耗型/非消耗型、非续期订阅商品、自动续期订阅商品购买能力的应用提供向用户展示可供购买的商品信息列表的能力。</p> <div class="tiledSection"><h2 id="section15821561815">前提条件<i class="anchor-icon anchor-icon-link" anchorid="section15821561815" tips="复制节点链接"></i></h2><p>当前登录的华为账号所在服务地支持数字商品服务。</p> </div> <div class="tiledSection"><h2 id="section18025220100">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section18025220100" tips="复制节点链接"></i></h2><ol><li>判断当前登录的华为账号所在的服务地是否支持数字商品服务应用内支付。<p>在使用应用内支付之前，应用需要向IAP Kit发送<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section192192415554" target="_blank">queryEnvironmentStatus</a>请求，以此判断用户当前登录的华为账号所在服务地是否在IAP Kit支持结算的国家/地区中。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>当前IAP Kit支持结算的国家/地区仅包括中国境内（不包含中国香港、中国澳门、中国台湾）。</p> </div></div></div> <div _ngcontent-mgh-c106="" class="highlight-div"><div _ngcontent-mgh-c106="" class="highlight-div-header"><div _ngcontent-mgh-c106="" class="highlight-div-header-left"><div _ngcontent-mgh-c106="" class="handle-button expand-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgh-c106="" class="highlight-div-header-right"><div _ngcontent-mgh-c106="" class="handle-button ai-button"></div><div _ngcontent-mgh-c106="" class="handle-button line-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgh-c106="" class="handle-button theme-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgh-c106="" class="handle-button copy-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { iap } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IAPKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryEnvironmentStatus</span> {</li><li>  <span class="hljs-title function_">queryEnvironmentStatus</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-title class_">UIContext</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    iap.<span class="hljs-title function_">queryEnvironmentStatus</span>(context).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// 请求成功</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in querying environment status.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 请求失败</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to query environment status. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol><ol start="2"><li>查询商品信息。<p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section55531442102518" target="_blank">queryProducts</a>来获取在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>上配置的商品信息。发起请求时，需在请求参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section1033653365917" target="_blank">QueryProductsParameter</a>中携带相关的商品ID，并根据实际配置指定其productType，订阅型商品指定其productType为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section59035422210" target="_blank">iap.ProductType.AUTORENEWABLE</a>。</p> <div class="p">当接口请求成功时，IAP Kit将返回商品信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section346874219313" target="_blank">Product</a>的列表。 应用可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section346874219313" target="_blank">Product</a>包含的商品价格、名称和描述等信息，向用户展示可供购买的商品列表。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section55531442102518" target="_blank">queryProducts</a>每次只能查询一种类型的商品，单次查询请勿超过200条。</p> </div></div></div> <div _ngcontent-mgh-c106="" class="highlight-div"><div _ngcontent-mgh-c106="" class="highlight-div-header"><div _ngcontent-mgh-c106="" class="highlight-div-header-left"><div _ngcontent-mgh-c106="" class="handle-button expand-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgh-c106="" class="highlight-div-header-right"><div _ngcontent-mgh-c106="" class="handle-button ai-button"></div><div _ngcontent-mgh-c106="" class="handle-button line-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgh-c106="" class="handle-button theme-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgh-c106="" class="handle-button copy-button"><div _ngcontent-mgh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { iap } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IAPKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Queryproducts</span> {</li><li>  <span class="hljs-title function_">queryProducts</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">queryProductParam</span>: iap.<span class="hljs-property">QueryProductsParameter</span> = {</li><li>      <span class="hljs-comment">// iap.ProductType.CONSUMABLE：消耗型商品;</span></li><li>      <span class="hljs-comment">// iap.ProductType.NONCONSUMABLE：非消耗型商品;</span></li><li>      <span class="hljs-comment">// productType: iap.ProductType.AUTORENEWABLE;订阅型商品</span></li><li>      <span class="hljs-attr">productType</span>: iap.<span class="hljs-property">ProductType</span>.<span class="hljs-property">CONSUMABLE</span>,</li><li>      <span class="hljs-comment">// 查询的商品必须是开发者在AppGallery Connect网站配置的商品</span></li><li>      <span class="hljs-attr">productIds</span>: [<span class="hljs-string">'ohos_consume_001'</span>]</li><li>    };</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-title class_">UIContext</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    iap.<span class="hljs-title function_">queryProducts</span>(context, queryProductParam).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 请求成功</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in querying products.'</span>);</li><li>      <span class="hljs-comment">// 展示商品信息</span></li><li>      <span class="hljs-comment">// ...</span></li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 请求失败</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to query products. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </li></ol> </div> </div> <div></div></div>