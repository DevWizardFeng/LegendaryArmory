<h1 _ngcontent-bvj-c119="" class="doc-title ng-star-inserted" title="平台类商户合单支付场景"> 平台类商户合单支付场景 </h1>

<div _ngcontent-bvj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>从4.1.0(11)版本开始，新增支持平台类商户合单支付场景。</p>     <p>用户在商户开发的APP应用/元服务上购买了一个旅行套餐，包含机票、保险、酒店等这几个不同的产品对应不同的收单商户，但用户是一次支付。平台类商户通过接入合单支付将多个不同商户的订单合到同一订单下发起支付。</p>     <p>支持商户模型：平台类商户</p>     <p>华为支付收银台合单支付展示：</p>     <div class="tablenoborder">      <div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab">               <tbody><tr>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.73038988724459819233470281318977:50001231000000:2800:1D6EB1713AC917F34DD3A8FAE7441F606A832C186CD0527BE4948252A1F7FCDC.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p><span><img height="425.6" originheight="1027" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.87145922083173990345522542138096:50001231000000:2800:8D36EDAA09B9F82DA78C6083CFA14C07273A6994B5D73CF3150A749F981E3CDD.png" title="点击放大" width="204.71359999999999"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.15852532406578366935991813905360:50001231000000:2800:3786FD0FC7B35EC394A7CCA492511BC0A26A32A7A6649C0D87A122243E64E2C6.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td class="cellrowborder" style="border: none;" valign="top" width="7.519248075192481%">&nbsp;&nbsp;</td>        </tr>        <tr>         <td align="center" class="cellrowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p>支付方式选择页面</p></td>         <td align="center" class="cellrowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p>订单详情页面</p></td>         <td align="center" class="cellrowborder" style="border: none;" valign="top" width="30.826917308269174%">          <p>支付结果展示页面</p></td>         <td class="cellrowborder" style="border: none;" valign="top" width="7.519248075192481%">&nbsp;&nbsp;</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1818915573916">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1818915573916" tips="复制节点链接"></i></h2>          <p>开发者通过接入Payment Kit合单支付，可以将多个子订单合并到同一个主订单里完成支付。具体接入流程如下：</p>     <p><span><img height="544.1161111111111" originheight="676" originwidth="1143" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114522.87593457565487728090355719055077:50001231000000:2800:741C1F09E09B05217ACD32424F7A1EC51B523CD4C081C8F631C318F19FD92D58.png" title="点击放大" width="920"></span></p>     <ol>      <li>商户客户端请求商户服务端创建合单支付订单。</li>      <li>商户服务器通过调用Payment Kit服务端<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-app-prepay" target="_blank">平台类商户合单支付预下单</a>接口。</li>      <li>Payment Kit服务端返回预支付ID（prepayId）给商户服务端。</li>      <li>商户服务端组建订单信息参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>返回给客户端。</li>      <li>商户客户端使用orderStr作为入参调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起Payment Kit支付收银台。</li>      <li>Payment Kit客户端展示支付收银台，通过支付收银台可查看多个订单详情信息。</li>      <li>用户在Payment Kit客户端收银台完成支付操作后。</li>      <li>Payment Kit服务端受理支付，异步处理支付订单。</li>      <li>Payment Kit服务端同步返回支付结果信息给Payment Kit客户端。</li>      <li>Payment Kit客户端展示支付结果页。</li>      <li>用户关闭支付结果页后Payment Kit客户端会返回支付状态给商户客户端。</li>      <li>Payment Kit服务端异步处理支付完成后，会调用商户预下单时通过callbackUrl传递的回调接口返回支付结果信息给商户服务器。</li>      <li>商户服务器收到支付结果回调响应后，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">SM2验签方式</a>对支付结果进行验签。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section5906121818412">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5906121818412" tips="复制节点链接"></i></h2>          <p>接口返回值有两种返回形式：Promise和AsyncCallback。Promise和AsyncCallback只是返回方式不一样，功能相同。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>requestPayment(context:common.UIAbilityContext, orderStr: string): Promise&lt;void&gt;;</p></td>         <td class="cellrowborder" rowspan="2" valign="top" width="50%">          <p>拉起Payment Kit支付收银台。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top">          <p>requestPayment(context:common.UIAbilityContext, orderStr: string, callback: AsyncCallback&lt;void&gt;): void;</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section9187179113620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9187179113620" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section126982401468" class="firsth2">预下单（服务器开发）<i class="anchor-icon anchor-icon-link" anchorid="section126982401468" tips="复制节点链接"></i></h3>          <ol>      <li>开发者按照商户模型调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-app-prepay" target="_blank">平台类商户合单支付预下单</a>接口获取预支付ID（prepayId）。       <p>为保证支付订单的安全性和可靠性需要对请求body和请求头PayMercAuth对象内的入参排序拼接进行签名，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section174821258151218" target="_blank">签名规则</a>。</p></li>      <li>构建合单订单信息参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>并返回给客户端。业务接口请求示例代码可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect#section5626882242">业务接口请求</a>。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section19371156173617">拉起华为支付收银台（端侧开发）<i class="anchor-icon anchor-icon-link" anchorid="section19371156173617" tips="复制节点链接"></i></h3>          <p>使用服务端返回的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起Payment Kit支付收银台。合单支付拉起支付收银台与商户基础支付场景处理逻辑一致，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-payment-process#section19371156173617">这里</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section6767324125513">支付结果回调通知（服务器开发）<i class="anchor-icon anchor-icon-link" anchorid="section6767324125513" tips="复制节点链接"></i></h3>          <p>支付成功后华为支付服务器会调用开发者提供回调接口，将支付信息返回给开发者的服务器，回调详细信息按商户模式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-notify" target="_blank">平台类商户合单支付结果回调通知</a>。</p>     <div class="p">      为保证信息合法性，商户服务器需要对返回的支付信息进行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">SM2验签</a>，验签注意事项：      <ol>       <li>需直接使用通知的完整内容进行验签。</li>       <li>验签前需要对返回数据进行排序拼接，sign字段是签名值，排序拼接后的待验签内容需要排除sign字段。</li>       <li>验签公钥使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-certificates-config#section14253153941510">华为支付证书</a>。</li>      </ol>     </div>    </div>    <div class="tiledSection">     <h2 id="section2207214587">延伸和拓展<i class="anchor-icon anchor-icon-link" anchorid="section2207214587" tips="复制节点链接"></i></h2>          <p>当开发者完成上述能力之后，可以调用以下API接口完成订单其他相关操作。</p>    </div>    <div class="tiledSection">     <h3 id="section99363593143" class="firsth2">平台类商户<i class="anchor-icon anchor-icon-link" anchorid="section99363593143" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-query-order" target="_blank">查询合单支付订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-refund" target="_blank">申请退款</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-combined-query-refund" target="_blank">查询退款订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-agent-query-trade-bill" target="_blank">查询对账单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-agent-query-settle-bill" target="_blank">查询结算账单</a>。</p>    </div>   </div>   <div></div></div>