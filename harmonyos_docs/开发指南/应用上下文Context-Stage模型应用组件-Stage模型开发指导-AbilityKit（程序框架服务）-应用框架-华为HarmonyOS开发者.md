<h1 _ngcontent-pji-c119="" class="doc-title ng-star-inserted" title="应用上下文Context"> 应用上下文Context </h1>

<div _ngcontent-pji-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>是应用中对象的上下文，其提供了应用的一些基础信息，例如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager" target="_blank">resourceManager</a>（资源管理）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-bundlemanager-applicationinfo" target="_blank">applicationInfo</a>（当前应用信息）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-contextconstant#areamode" target="_blank">area</a>（文件分区）等。</p>    </div>    <div class="tiledSection">     <h2 id="不同类型context的对比">不同类型Context的对比<i class="anchor-icon anchor-icon-link" anchorid="不同类型context的对比" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>组件和各种<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-extensionability" target="_blank">ExtensionAbility</a>派生类组件都有各自不同的Context类。分别有基类Context、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-abilitystagecontext" target="_blank">AbilityStageContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>等Context。各类Context的继承和持有关系详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#不同类型context的继承和持有关系" target="_blank">不同类型Context的继承和持有关系</a>。</p>     <p>不同类型Context的获取方式与使用场景说明，如下表所示。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>不同类型的Context具有不同的能力，不可相互替代或强行转换。例如，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>绑定了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetfontsizescale13" target="_blank">setFontSizeScale</a>方法，但<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>中没有此方法。因此，即使将UIAbilityContext强行转换为ApplicationContext，也无法调用setFontSizeScale方法。</p>      </div></div></div>     <p><strong>表1</strong> 不同类型Context的说明</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.6.1.5.1.1" valign="top" width="25%">Context类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.6.1.5.1.2" valign="top" width="25%">说明</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.6.1.5.1.3" valign="top" width="25%">获取方式</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.6.1.5.1.4" valign="top" width="25%">使用场景</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a></td>         <td class="cellrowborder" valign="top" width="25%">应用的全局上下文，提供应用级别的信息和能力。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 从API version 14开始，可以直接使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-application#applicationgetapplicationcontext14" target="_blank">getApplicationContext</a>获取。</p>          <p>- API version 14以前版本，只能使用其他Context实例的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#getapplicationcontext" target="_blank">getApplicationContext</a>方法获取。</p></td>         <td class="cellrowborder" valign="top" width="25%">          <p>- <a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取基本信息">获取当前应用的基本信息</a>。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用级别的文件路径</a>。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取和修改加密分区">获取和修改加密分区</a>。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#监听应用前后台变化">监听应用前后台变化</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-abilitystagecontext" target="_blank">AbilityStageContext</a></td>         <td class="cellrowborder" valign="top" width="25%">模块级别的上下文，提供模块级别的信息和能力。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 如果需要获取当前AbilityStage的Context，可以直接通过AbilityStage实例获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#属性" target="_blank">context</a>属性。</p>          <p>- 如果需要获取同一应用中其他Module的Context，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-application#applicationcreatemodulecontext12" target="_blank">createModuleContext</a>方法。</p></td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 获取当前模块的基本信息。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取模块级别的文件路径</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a></td>         <td class="cellrowborder" valign="top" width="25%">UIAbility组件对应的上下文，提供UIAbility对外的信息和能力。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 通过UIAbility实例直接获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#属性" target="_blank">context</a>属性。</p>          <p>- 在UIAbility的窗口中加载的UI组件实例，需要使用@ohos.arkui.UIContext提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#gethostcontext12" target="_blank">getHostContext</a>方法。</p></td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 获取当前UIAbility的基本信息。</p>          <p>- 启动其他应用或元服务、连接/断连系统应用创建的ServiceExtensionAbility等。</p>          <p>- 销毁自身的UIAbility。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a></td>         <td class="cellrowborder" valign="top" width="25%">ExtensionAbility组件对应的上下文，每种类型的ExtensionContext提供不同的信息和能力。</td>         <td class="cellrowborder" valign="top" width="25%">通过ExtensionAbility实例直接获取Context属性。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>不同类型的ExtensionAbility对应的Context提供的能力不同。以输入法上下文<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod-extension-context" target="_blank">InputMethodExtensionContext</a>为例，主要提供如下能力：</p>          <p>- 获取InputMethodExtensionAbility的基本信息。</p>          <p>- 销毁当前输入法。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext" target="_blank">UIContext</a></td>         <td class="cellrowborder" valign="top" width="25%">ArkUI的UI实例上下文，提供UI操作相关的能力。与上述其他类型的Context无直接关系。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 在UI组件内获取UIContext，直接使用组件内置的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-api#getuicontext" target="_blank">getUIContext</a>方法。</p>          <p>- 在存在Window实例的情况下，使用@ohos.window提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getuicontext10" target="_blank">getUIContext</a>方法。</p></td>         <td class="cellrowborder" valign="top" width="25%">          <p>主要用于UI实例中UI相关操作，例如：</p>          <p>- 获取当前UI实例的字体。</p>          <p>- 显示不同类型的弹框。</p>          <p>- 设置软键盘弹出时UI避让模式。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="context的获取方式">Context的获取方式<i class="anchor-icon anchor-icon-link" anchorid="context的获取方式" tips="复制节点链接"></i></h2>          <p>开发者如果需要通过Context获取应用资源、应用路径等信息，或者使用Context提供的方法来实现应用跳转、设置环境变量、清理数据、获取权限等操作，需要先获取对应的Context。本节分别介绍不同类型Context的获取方式与使用场景。</p>    </div>    <div class="tiledSection">     <h3 id="获取applicationcontext应用的全局上下文" class="firsth2">获取ApplicationContext（应用的全局上下文）<i class="anchor-icon anchor-icon-link" anchorid="获取applicationcontext应用的全局上下文" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>在基类Context的基础上提供了监听应用内应用组件的生命周期的变化、监听系统内存变化、监听应用内系统环境变化、设置应用语言、设置应用颜色模式、清除应用自身数据的同时撤销应用向用户申请的权限等能力，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-extensionability" target="_blank">ExtensionAbility</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage" target="_blank">AbilityStage</a>中均可以获取。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取abilitystagecontext模块级别的上下文">获取AbilityStageContext（模块级别的上下文）<i class="anchor-icon anchor-icon-link" anchorid="获取abilitystagecontext模块级别的上下文" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-abilitystagecontext" target="_blank">AbilityStageContext</a>和基类Context相比，额外提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-bundlemanager-hapmoduleinfo" target="_blank">HapModuleInfo</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>等信息。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityStage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbilityStage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbilityStage</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> abilityStageContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取本应用中其他module的context模块级别的上下文">获取本应用中其他Module的Context（模块级别的上下文）<i class="anchor-icon anchor-icon-link" anchorid="获取本应用中其他module的context模块级别的上下文" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-application#applicationcreatemodulecontext12" target="_blank">createModuleContext</a>方法，获取本应用中其他Module的Context。获取到其他Module的Context之后，即可获取到相应Module的资源信息。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, application } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> storageEventCall = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storageEventCall)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_Context {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">//...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-comment">//...</span></li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">moduleName2</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'entry'</span>;</li><li>            application.<span class="hljs-title function_">createModuleContext</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, moduleName2)</li><li>              .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: common.Context</span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`CreateModuleContext success, data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>`</span>);</li><li>                <span class="hljs-keyword">if</span> (data !== <span class="hljs-literal">null</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: (<span class="hljs-string">'成功获取Context'</span>)</li><li>                  });</li><li>                }</li><li>              })</li><li>              .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`CreateModuleContext failed, err code:<span class="hljs-subst">${err.code}</span>, err msg: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>              });</li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">//...</span></li><li>      }</li><li>      <span class="hljs-comment">//...</span></li><li>    }</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取uiabilitycontextuiability组件的上下文">获取UIAbilityContext（UIAbility组件的上下文）<i class="anchor-icon anchor-icon-link" anchorid="获取uiabilitycontextuiability组件的上下文" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>和基类<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>相比，额外提供abilityInfo、currentHapModuleInfo等属性。通过UIAbilityContext可以获取UIAbility的相关配置信息，如包代码路径、Bundle名称、Ability名称和应用程序需要的环境状态等属性信息，也可以获取操作UIAbility实例的方法（如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#startability" target="_blank">startAbility()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#connectserviceextensionability" target="_blank">connectServiceExtensionAbility()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#terminateself" target="_blank">terminateSelf()</a>等）。</p>     <ul>      <li>       <p>在UIAbility中可以通过this.context获取UIAbility实例的上下文信息。</p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取UIAbility实例的上下文</span></li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在页面中获取UIAbility实例的上下文信息。</p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>; <span class="hljs-comment">// 导入依赖资源context模块</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_EventHub {</li><li>  <span class="hljs-comment">// 定义context变量</span></li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">startAbilityTest</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>      <span class="hljs-comment">// Want参数信息</span></li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(want);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 页面展示</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p>也可以在导入依赖资源context模块后，在具体使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>前进行变量定义。</p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_UIAbilityComponentsBasicUsage {</li><li>  <span class="hljs-title function_">startAbilityTest</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>      <span class="hljs-comment">// Want参数信息</span></li><li>    };</li><li>    context.<span class="hljs-title function_">startAbility</span>(want);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 页面展示</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当业务完成后，开发者如果想要终止当前<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>实例，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#terminateself" target="_blank">terminateSelf()</a>方法实现。</p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_UIAbilityComponentsBasicUsage {</li><li>  <span class="hljs-comment">// 页面展示</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">//...</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'FuncAbilityB'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>          <span class="hljs-keyword">try</span> {</li><li>            context.<span class="hljs-title function_">terminateSelf</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>                <span class="hljs-comment">// 处理业务逻辑错误</span></li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`terminateSelf failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>                <span class="hljs-keyword">return</span>;</li><li>              }</li><li>              <span class="hljs-comment">// 执行正常业务</span></li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`terminateSelf succeed.`</span>);</li><li>            });</li><li>          } <span class="hljs-keyword">catch</span> (err) {</li><li>            <span class="hljs-comment">// 捕获同步的参数错误</span></li><li>            <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>            <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`terminateSelf failed, code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>.`</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="获取extensionabilitycontext-extensionability组件的上下文">获取ExtensionAbilityContext (ExtensionAbility组件的上下文)<i class="anchor-icon anchor-icon-link" anchorid="获取extensionabilitycontext-extensionability组件的上下文" tips="复制节点链接"></i></h3>          <p>获取特定场景<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>。以FormExtensionContext为例，表示卡片服务的上下文环境，继承自ExtensionContext，提供卡片服务相关的接口能力。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FormExtensionAbility</span>, formBindingData } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFormExtensionAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onAddForm</span>(<span class="hljs-params">want: Want</span>) {</li><li>    <span class="hljs-keyword">let</span> formExtensionContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">dataObj1</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-string">'temperature'</span>: <span class="hljs-string">'11c'</span>,</li><li>      <span class="hljs-string">'time'</span>: <span class="hljs-string">'11:00'</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">obj1</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(dataObj1);</li><li>    <span class="hljs-keyword">return</span> obj1;</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="context的典型使用场景">Context的典型使用场景<i class="anchor-icon anchor-icon-link" anchorid="context的典型使用场景" tips="复制节点链接"></i></h2>          <p>本章节通过以下具体场景来介绍Context的用法：</p>     <ul>      <li><a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取基本信息">获取基本信息</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#获取和修改加密分区">获取和修改加密分区</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#监听应用前后台变化">监听应用前后台变化</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/application-context-stage#监听uiability生命周期变化">监听UIAbility生命周期变化</a></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="获取基本信息" class="firsth2">获取基本信息<i class="anchor-icon anchor-icon-link" anchorid="获取基本信息" tips="复制节点链接"></i></h3>          <p>继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>的不同类型Context，默认会继承父类的方法和属性，还会拥有自己独立的方法与属性。</p>     <p>通过Context属性可以获取当前应用、模块、UIAbility或ExtensionAbility的基本信息（例如资源管理对象、应用程序信息等），下面以UIAbility的信息获取为例：</p>     <p>如果需要跨包获取资源对象，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access#资源访问">资源访问</a>。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取ResourceManager（资源管理）</span></li><li>    <span class="hljs-keyword">let</span> resourceManager = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-comment">// 获取applicationInfo（当前应用信息）</span></li><li>    <span class="hljs-keyword">let</span> applicationInfo = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-property">applicationInfo</span>;</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取应用文件路径">获取应用文件路径<i class="anchor-icon anchor-icon-link" anchorid="获取应用文件路径" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">基类Context</a>提供了获取应用文件路径的能力，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-abilitystagecontext" target="_blank">AbilityStageContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>均继承该能力。不同类型的Context获取的路径可能存在差异。</p>     <ul>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>可以获取应用级的文件路径。该路径用于存放应用全局信息，路径下的文件会跟随应用的卸载而删除。</p></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-abilitystagecontext" target="_blank">AbilityStageContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>，可以获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-package-overview">Module</a>级的文件路径。该路径用于存放Module相关信息，路径下的文件会跟随<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp">HSP</a>的卸载而删除。HAP/HSP的卸载不会影响应用级路径下的文件，除非该应用的HAP/HSP已全部卸载。</p>       <ul>        <li>UIAbilityContext：可以获取UIAbility所在Module的文件路径。</li>        <li>ExtensionContext：可以获取ExtensionAbility所在Module的文件路径。</li>        <li>AbilityStageContext：由于AbilityStageContext创建时机早于UIAbilityContext和ExtensionContext，通常用于在AbilityStage中获取文件路径。</li>       </ul></li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>应用文件路径属于应用沙箱路径，具体请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory">应用沙箱目录</a>。</p>      </div></div></div>     <p><strong>表1</strong> 不同级别Context获取的应用文件路径说明</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.1" valign="top" width="25%">属性</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.2" valign="top" width="25%">说明</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.3" valign="top" width="25%">ApplicationContext获取的路径</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.4" valign="top" width="25%">AbilityStageContext、UIAbilityContext、ExtensionContext获取的路径</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">bundleCodeDir</td>         <td class="cellrowborder" valign="top" width="25%">安装包目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el1/bundle</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el1/bundle</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">cacheDir</td>         <td class="cellrowborder" valign="top" width="25%">缓存目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/cache</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/<strong>haps/&lt;module-name&gt;</strong>/cache</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">filesDir</td>         <td class="cellrowborder" valign="top" width="25%">文件目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/files</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/<strong>haps/&lt;module-name&gt;</strong>/files</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">preferencesDir</td>         <td class="cellrowborder" valign="top" width="25%">preferences目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/preferences</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/<strong>haps/&lt;module-name&gt;</strong>/preferences</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">tempDir</td>         <td class="cellrowborder" valign="top" width="25%">临时目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/temp</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/base/<strong>haps/&lt;module-name&gt;</strong>/temp</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">databaseDir</td>         <td class="cellrowborder" valign="top" width="25%">数据库目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/database</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/&lt;加密等级&gt;/database/<strong>&lt;module-name&gt;</strong></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">distributedFilesDir</td>         <td class="cellrowborder" valign="top" width="25%">分布式文件目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el2/distributedFiles</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el2/distributedFiles/</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">resourceDir<sup>11+</sup></td>         <td class="cellrowborder" valign="top" width="25%">          <p>资源目录。</p>          <p><strong>说明：</strong></p>          <p>需要开发者手动在\&lt;module-name&gt;\resource路径下创建resfile目录。</p></td>         <td class="cellrowborder" valign="top" width="25%">不涉及</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el1/bundle/<strong>&lt;module-name&gt;</strong>/resources/resfile</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">cloudFileDir<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="25%">云文件目录。</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el2/cloud</td>         <td class="cellrowborder" valign="top" width="25%">&lt;路径前缀&gt;/el2/cloud/</td>        </tr>             </tbody></table></div>     </div>     <p>本节以使用ApplicationContext获取cacheDir和filesDir为例，分别介绍如何获取应用缓存目录，以及如何获取应用文件目录，并用于新建文件和读写文件。</p>     <ul>      <li>       <p><strong>获取应用缓存目录</strong></p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[Page_Context]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'create file'</span>)</li><li>            <span class="hljs-comment">// ...</span></li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>              <span class="hljs-comment">// 获取应用缓存路径</span></li><li>              <span class="hljs-keyword">let</span> cacheDir = applicationContext.<span class="hljs-property">cacheDir</span>;</li><li>            })</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p><strong>获取应用文件目录</strong></p>       <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo, <span class="hljs-title class_">ReadOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[Page_Context]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'create file'</span>)</li><li>            <span class="hljs-comment">// ...</span></li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>              <span class="hljs-comment">// 获取应用文件路径</span></li><li>              <span class="hljs-keyword">let</span> filesDir = applicationContext.<span class="hljs-property">filesDir</span>;</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`filePath: <span class="hljs-subst">${filesDir}</span>`</span>);</li><li>              <span class="hljs-comment">// 文件不存在时创建并打开文件，文件存在时打开文件</span></li><li>              <span class="hljs-keyword">let</span> file = fileIo.<span class="hljs-title function_">openSync</span>(filesDir + <span class="hljs-string">'/test.txt'</span>, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>              <span class="hljs-comment">// 写入一段内容至文件</span></li><li>              <span class="hljs-keyword">let</span> writeLen = fileIo.<span class="hljs-title function_">writeSync</span>(file.<span class="hljs-property">fd</span>, <span class="hljs-string">"Try to write str."</span>);</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`The length of str is: <span class="hljs-subst">${writeLen}</span>`</span>);</li><li>              <span class="hljs-comment">// 创建一个大小为1024字节的ArrayBuffer对象，用于存储从文件中读取的数据</span></li><li>              <span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">1024</span>);</li><li>              <span class="hljs-comment">// 设置读取的偏移量和长度</span></li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">readOptions</span>: <span class="hljs-title class_">ReadOptions</span> = {</li><li>                <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>,</li><li>                <span class="hljs-attr">length</span>: arrayBuffer.<span class="hljs-property">byteLength</span></li><li>              };</li><li>              <span class="hljs-comment">// 读取文件内容到ArrayBuffer对象中，并返回实际读取的字节数</span></li><li>              <span class="hljs-keyword">let</span> readLen = fileIo.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, arrayBuffer, readOptions);</li><li>              <span class="hljs-comment">// 将ArrayBuffer对象转换为Buffer对象，并转换为字符串输出</span></li><li>              <span class="hljs-keyword">let</span> buf = buffer.<span class="hljs-title function_">from</span>(arrayBuffer, <span class="hljs-number">0</span>, readLen);</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`the content of file: <span class="hljs-subst">${buf.toString()}</span>`</span>);</li><li>              <span class="hljs-comment">// 关闭文件</span></li><li>              fileIo.<span class="hljs-title function_">closeSync</span>(file);</li><li>            })</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="获取和修改加密分区">获取和修改加密分区<i class="anchor-icon anchor-icon-link" anchorid="获取和修改加密分区" tips="复制节点链接"></i></h3>          <p>应用文件加密是一种保护数据安全的方法，可以使得文件在未经授权访问的情况下得到保护。在不同的场景下，应用需要不同程度的文件保护。</p>     <p>在实际应用中，开发者需要根据不同场景的需求选择合适的加密分区，从而保护应用数据的安全。通过合理使用不同级别的加密分区，可以有效提升应用数据的安全性。关于不同分区的权限说明，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-contextconstant" target="_blank">ContextConstant</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-contextconstant#areamode" target="_blank">AreaMode</a>。</p>     <ul>      <li>EL1：对于私有文件，如闹铃、壁纸等，应用可以将这些文件放到设备级加密分区（EL1）中，以保证在用户输入密码前就可以被访问。</li>      <li>EL2：对于更敏感的文件，如个人隐私信息等，应用可以将这些文件放到更高级别的加密分区（EL2）中，以保证更高的安全性。</li>      <li>EL3：对于应用中的记录步数、文件下载、音乐播放，需要在锁屏时读写和创建新文件，放在（EL3）的加密分区比较合适。</li>      <li>EL4：对于用户安全信息相关的文件，锁屏时不需要读写文件、也不能创建文件，放在（EL4）的加密分区更合适。</li>      <li>EL5：对于用户隐私敏感数据文件，锁屏后默认不可读写，如果锁屏后需要读写文件，则锁屏前可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-screenlockfilemanager#screenlockfilemanageracquireaccess" target="_blank">acquireAccess</a>接口申请继续读写文件，或者锁屏后也需要创建新文件且可读写，放在（EL5）的应用级加密分区更合适。</li>     </ul>     <p>要实现获取和设置当前加密分区，可以通过读写<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>的area属性来实现。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, contextConstant, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>    <span class="hljs-comment">// 存储普通信息前，切换到EL1设备级加密</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL1</span>; <span class="hljs-comment">// 切换area</span></li><li>    <span class="hljs-comment">// 存储普通信息</span></li><li>
</li><li>    <span class="hljs-comment">// 存储敏感信息前，切换到EL2用户级加密</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL2</span>; <span class="hljs-comment">// 切换area</span></li><li>    <span class="hljs-comment">// 存储敏感信息</span></li><li>
</li><li>    <span class="hljs-comment">// 存储敏感信息前，切换到EL3用户级加密</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL3</span>; <span class="hljs-comment">// 切换area</span></li><li>    <span class="hljs-comment">// 存储敏感信息</span></li><li>
</li><li>    <span class="hljs-comment">// 存储敏感信息前，切换到EL4用户级加密</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL4</span>; <span class="hljs-comment">// 切换area</span></li><li>    <span class="hljs-comment">// 存储敏感信息</span></li><li>
</li><li>    <span class="hljs-comment">// 存储敏感信息前，切换到EL5应用级加密</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL5</span>; <span class="hljs-comment">// 切换area</span></li><li>    <span class="hljs-comment">// 存储敏感信息</span></li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { contextConstant, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_Context {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">//...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">//...</span></li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-comment">//...</span></li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 存储普通信息前，切换到EL1设备级加密</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> === contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL2</span>) { <span class="hljs-comment">// 获取area</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL1</span>; <span class="hljs-comment">// 修改area</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'SwitchToEL1'</span></li><li>              });</li><li>            }</li><li>            <span class="hljs-comment">// 存储普通信息</span></li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">//...</span></li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-comment">//...</span></li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 存储敏感信息前，切换到EL2用户级加密</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> === contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL1</span>) { <span class="hljs-comment">// 获取area</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">area</span> = contextConstant.<span class="hljs-property">AreaMode</span>.<span class="hljs-property">EL2</span>; <span class="hljs-comment">// 修改area</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'SwitchToEL2'</span></li><li>              });</li><li>            }</li><li>            <span class="hljs-comment">// 存储敏感信息</span></li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">//...</span></li><li>      }</li><li>      <span class="hljs-comment">//...</span></li><li>    }</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听应用前后台变化">监听应用前后台变化<i class="anchor-icon anchor-icon-link" anchorid="监听应用前后台变化" tips="复制节点链接"></i></h3>          <p>开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>的相关能力，监听应用的前后台变化。当应用前后台切换时，可以收到相应回调函数的通知，从而执行一些依赖前后台的方法，或者进行应用前后台切换频率等数据统计。</p>     <p>以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>中的使用为例进行说明。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">ApplicationStateChangeCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LifecycleAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">applicationStateChangeCallback</span>: <span class="hljs-title class_">ApplicationStateChangeCallback</span> = {</li><li>      <span class="hljs-title function_">onApplicationForeground</span>(<span class="hljs-params"></span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'applicationStateChangeCallback onApplicationForeground'</span>);</li><li>      },</li><li>      <span class="hljs-title function_">onApplicationBackground</span>(<span class="hljs-params"></span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'applicationStateChangeCallback onApplicationBackground'</span>);</li><li>      }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 1.获取applicationContext</span></li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 2.通过applicationContext注册应用前后台状态监听</span></li><li>      applicationContext.<span class="hljs-title function_">on</span>(<span class="hljs-string">'applicationStateChange'</span>, applicationStateChangeCallback);</li><li>    } <span class="hljs-keyword">catch</span> (paramError) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${(paramError <span class="hljs-keyword">as</span> BusinessError).code}</span>, <span class="hljs-subst">${(paramError <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Register applicationStateChangeCallback'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听uiability生命周期变化">监听UIAbility生命周期变化<i class="anchor-icon anchor-icon-link" anchorid="监听uiability生命周期变化" tips="复制节点链接"></i></h3>          <p>开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>监听UIAbility生命周期变化。当<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>生命周期变化时，如UIAbility创建、切换至前/后台、销毁等情况，UIAbility会收到相应回调函数的通知，从而执行依赖UIAbility生命周期的方法，也可以统计指定页面停留时间和访问频率等信息。</p>     <p>每次注册回调函数时，都会返回一个监听生命周期的ID，此ID会自增1。以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>中的使用为例进行说明。</p>     <div _ngcontent-pji-c106="" class="highlight-div"><div _ngcontent-pji-c106="" class="highlight-div-header"><div _ngcontent-pji-c106="" class="highlight-div-header-left"><div _ngcontent-pji-c106="" class="handle-button expand-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pji-c106="" class="highlight-div-header-right"><div _ngcontent-pji-c106="" class="handle-button ai-button"></div><div _ngcontent-pji-c106="" class="handle-button line-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pji-c106="" class="handle-button theme-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pji-c106="" class="handle-button copy-button"><div _ngcontent-pji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">AbilityLifecycleCallback</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span>  { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[LifecycleAbility]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LifecycleAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// 定义生命周期ID</span></li><li>  <span class="hljs-attr">lifecycleId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 定义生命周期回调对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">abilityLifecycleCallback</span>: <span class="hljs-title class_">AbilityLifecycleCallback</span> = {</li><li>      <span class="hljs-comment">// 当UIAbility创建时被调用</span></li><li>      <span class="hljs-title function_">onAbilityCreate</span>(<span class="hljs-params">uiAbility</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onAbilityCreate uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当窗口创建时被调用</span></li><li>      <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">uiAbility, windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageCreate uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageCreate windowStage: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(windowStage)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当窗口处于活动状态时被调用</span></li><li>      <span class="hljs-title function_">onWindowStageActive</span>(<span class="hljs-params">uiAbility, windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageActive uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageActive windowStage: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(windowStage)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当窗口处于非活动状态时被调用</span></li><li>      <span class="hljs-title function_">onWindowStageInactive</span>(<span class="hljs-params">uiAbility, windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageInactive uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageInactive windowStage: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(windowStage)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当窗口被销毁时被调用</span></li><li>      <span class="hljs-title function_">onWindowStageDestroy</span>(<span class="hljs-params">uiAbility, windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageDestroy uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageDestroy windowStage: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(windowStage)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当UIAbility被销毁时被调用</span></li><li>      <span class="hljs-title function_">onAbilityDestroy</span>(<span class="hljs-params">uiAbility</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onAbilityDestroy uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当UIAbility从后台转到前台时触发回调</span></li><li>      <span class="hljs-title function_">onAbilityForeground</span>(<span class="hljs-params">uiAbility</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onAbilityForeground uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当UIAbility从前台转到后台时触发回调</span></li><li>      <span class="hljs-title function_">onAbilityBackground</span>(<span class="hljs-params">uiAbility</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onAbilityBackground uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 当UIAbility迁移时被调用</span></li><li>      <span class="hljs-title function_">onAbilityContinue</span>(<span class="hljs-params">uiAbility</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onAbilityContinue uiAbility.launchWant: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(uiAbility.launchWant)}</span>`</span>);</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 获取应用上下文</span></li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 注册应用内生命周期回调</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifecycleId</span> = applicationContext.<span class="hljs-title function_">on</span>(<span class="hljs-string">'abilityLifecycle'</span>, abilityLifecycleCallback);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to register applicationContext. Code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>
</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`register callback number: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.lifecycleId}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-comment">//...</span></li><li>  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取应用上下文</span></li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 取消应用内生命周期回调</span></li><li>      applicationContext.<span class="hljs-title function_">off</span>(<span class="hljs-string">'abilityLifecycle'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lifecycleId</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to unregister applicationContext. Code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>