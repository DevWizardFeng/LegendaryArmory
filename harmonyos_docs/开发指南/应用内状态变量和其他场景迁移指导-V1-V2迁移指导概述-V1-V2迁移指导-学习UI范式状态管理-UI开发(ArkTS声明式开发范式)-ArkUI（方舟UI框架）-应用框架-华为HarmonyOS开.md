<h1 _ngcontent-psg-c119="" class="doc-title ng-star-inserted" title="应用内状态变量和其他场景迁移指导"> 应用内状态变量和其他场景迁移指导 </h1>

<div _ngcontent-psg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本文档主要介绍应用内状态变量和其他场景迁移场景，包含以下场景。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.3.1.1" valign="top" width="50%">V1装饰器名/场景</th>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.3.1.2" valign="top" width="50%">V2装饰器名</th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a></td>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage">AppStorage</a></td>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-appstoragev2">AppStorageV2</a></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-environment">Environment</a></td>        <td class="cellrowborder" valign="top" width="50%">调用Ability接口获取系统环境变量</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-persiststorage">PersistentStorage</a></td>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-persistencev2">PersistenceV2</a></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">存量迁移场景</td>        <td class="cellrowborder" valign="top" width="50%">@ObservedV2、@Trace、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">滑动组件场景</td>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-modifier">Modifier</a></td>        <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>、@ObservedV2、@Trace</td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="各装饰器迁移示例">各装饰器迁移示例<i class="anchor-icon anchor-icon-link" anchorid="各装饰器迁移示例" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="localstorage-observedv2trace" class="firsth2">LocalStorage-&gt;@ObservedV2/@Trace<i class="anchor-icon anchor-icon-link" anchorid="localstorage-observedv2trace" tips="复制节点链接"></i></h3>          <p><strong>迁移规则</strong></p>     <p>LocalStorage的目的是实现页面间的状态变量共享。由于V1状态变量和View层耦合，开发者难以自主实现页面间状态变量的共享，因此框架提供了该能力。</p>     <p>状态管理V2将状态变量的观察能力内嵌到数据本身，不再和View层耦合。因此，不再需要类似LocalStorage的能力，可以使用创建@ObservedV2和@Trace装饰类的实例，开发者需自行import和export，实现状态变量的页面间共享。</p>     <p><strong>示例</strong></p>     <p><strong>基本场景</strong></p>     <p>V1:</p>     <p>通过windowStage.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#loadcontent9" target="_blank">loadContent</a>和this.getUIContext().<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getsharedlocalstorage12" target="_blank">getSharedLocalStorage</a>接口实现页面间的状态变量共享。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'count'</span>: <span class="hljs-number">47</span> };</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">para</span>);</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Page1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在下面的示例中，使用@LocalStorageLink，可以将开发者本地的修改同步回LocalStorage中。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page1.ets</span></li><li><span class="hljs-comment">// 预览器上不支持获取页面共享的LocalStorage实例。</span></li><li><span class="hljs-meta">@Entry</span>({ <span class="hljs-attr">useSharedStorage</span>: <span class="hljs-literal">true</span> })</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push to Page2'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page2'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page2.ets</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page2Builder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page2</span>()</li><li>}</li><li>
</li><li><span class="hljs-comment">// Page2组件获得了父亲Page1组件的LocalStorage实例</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">const</span> storage = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getSharedLocalStorage</span>();</li><li>            <span class="hljs-keyword">if</span> (storage) {</li><li>              storage.<span class="hljs-title function_">set</span>(<span class="hljs-string">'count'</span>, <span class="hljs-number">20</span>);</li><li>            }</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用Navigation时，需要添加配置系统路由表文件src/main/resources/base/profile/route_map.json，并替换pageSourceFile为Page2页面的路径，并且在module.json5中添加："routerMap": "$profile:route_map"。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"routerMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/Page2.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2Builder"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"LocalStorage example"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <p>V2:</p>     <ul>      <li>声明@ObservedV2装饰的MyStorage类，并import到需要使用的页面中。</li>      <li>声明被@Trace的属性作为页面间共享的可观察的数据。</li>     </ul>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// storage.ets</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorage</span> {</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">singleton_</span>: <span class="hljs-title class_">MyStorage</span>;</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">instance</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">MyStorage</span>.<span class="hljs-property">singleton_</span>) {</li><li>      <span class="hljs-title class_">MyStorage</span>.<span class="hljs-property">singleton_</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorage</span>();</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MyStorage</span>.<span class="hljs-property">singleton_</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">47</span>;</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page1.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./storage'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">MyStorage</span>.<span class="hljs-title function_">instance</span>();</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storage.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push to Page2'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page2'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page2.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./storage'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page2Builder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page2</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">MyStorage</span>.<span class="hljs-title function_">instance</span>();</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storage.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用Navigation时，需要添加配置系统路由表文件src/main/resources/base/profile/route_map.json，并替换pageSourceFile为Page2页面的路径，并且在module.json5中添加："routerMap": "$profile:route_map"。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"routerMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/Page2.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2Builder"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"description"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"LocalStorage example"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <p>如果开发者需要实现类似于@LocalStorageProp的效果，但希望本地的修改不同步回LocalStorage中，可参考以下示例：</p>     <ul>      <li>在Page1中改变count值，由于count被@LocalStorageProp装饰的，因此其更改仅在本地生效，不会同步到LocalStorage。</li>      <li>点击push to Page2，跳转到Page2。由于在Page1中改变count值不会同步到LocalStorage，因此Page2中的Text组件仍显示初始值47。</li>      <li>点击change Storage Count，调用LocalStorage的setOrCreate，改变count对应的值，并通知所有绑定该key的变量。</li>     </ul>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page1.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li>storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, <span class="hljs-number">47</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, storage.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'count'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span> + <span class="hljs-number">100</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push to Page2'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page2'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page2.ets</span></li><li><span class="hljs-keyword">import</span> { storage } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Page1'</span></li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page2Builder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page2</span>()</li><li>}</li><li>
</li><li><span class="hljs-comment">// Page2组件获得了父亲Page1组件的LocalStorage实例</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, storage.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'count'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span> + <span class="hljs-number">100</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在V2中，可以借助@Local和@Monitor实现类似的效果。</p>     <ul>      <li>@Local装饰的count变量为组件本地的值，其改变不会同步回storage。</li>      <li>@Monitor监听storage.count的变化，当storage.count改变时，在@Monitor的回调里改变本地@Local的值。</li>     </ul>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page1.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./storage'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">MyStorage</span>.<span class="hljs-title function_">instance</span>();</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'storage.count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Page1 <span class="hljs-subst">${mon.value()?.before}</span> to <span class="hljs-subst">${mon.value()?.now}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span> += <span class="hljs-number">100</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push to Page2'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page2'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page2.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./storage'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page2Builder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page2</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">MyStorage</span>.<span class="hljs-title function_">instance</span>();</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'storage.count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Page2 <span class="hljs-subst">${mon.value()?.before}</span> to <span class="hljs-subst">${mon.value()?.now}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span> += <span class="hljs-number">100</span>;</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>自定义组件接收LocalStorage实例场景</strong></p>     <p>为了配合Navigation的场景，LocalStorage支持作为自定义组件的入参，传递给以当前自定义组件为根节点的所有子自定义组件。</p>     <p>对于该场景，V2可以使用创建多个全局@ObservedV2和@Trace装饰类的实例进行替代。</p>     <p>V1:</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageA</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageA.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageB</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageB.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-string">'PropB'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageC</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageC.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropC'</span>, <span class="hljs-string">'PropC'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-comment">// 传递不同的LocalStorage实例</span></li><li>      <span class="hljs-title class_">PageOneStack</span>({}, localStorageA)</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title class_">PageTwoStack</span>({}, localStorageB)</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageThree'</span>) {</li><li>      <span class="hljs-title class_">PageThreeStack</span>({}, localStorageC)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">//将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageOneStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'PropA'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>        <span class="hljs-comment">// 显示'PropA'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropA}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageTwoStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-title class_">PropB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'Hello'，当前LocalStorage实例localStorageB没有PropA对应的值，使用本地默认值'Hello'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>        <span class="hljs-comment">// 显示'PropB'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropB}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageThree'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageThreeStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropC'</span>) <span class="hljs-title class_">PropC</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'pageThreeStack'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'Hello'，当前LocalStorage实例localStorageC没有PropA对应的值，使用本地默认值'Hello'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>        <span class="hljs-comment">// 显示'PropC'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropC}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageOne'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageThree'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NavigationContentMsgStack</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropA}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>声明@ObservedV2装饰的class代替LocalStorage。其中LocalStorage的key可以用@Trace装饰的属性代替。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// storage.ets</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorageA</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">propA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">propA?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">propA</span> = propA ? propA : <span class="hljs-variable language_">this</span>.<span class="hljs-property">propA</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorageB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MyStorageA</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">propB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">propB: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">propB</span> = propB;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorageC</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MyStorageA</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">propC</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">propC: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">propC</span> = propC;</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在pageOneStack、pageTwoStack和pageThreeStack组件内分别创建MyStorageA、MyStorageB、MyStorageC的实例，并通过@Param传递给其子组件NavigationContentMsgStack，从而实现类似LocalStorage实例在子组件树上共享的能力。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyStorageA</span>, <span class="hljs-title class_">MyStorageB</span>, <span class="hljs-title class_">MyStorageC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./storage'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-title function_">pageOneStack</span>()</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title function_">pageTwoStack</span>()</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageThree'</span>) {</li><li>      <span class="hljs-title function_">pageThreeStack</span>()</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">//将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct pageOneStack {</li><li>  <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storageA</span>: <span class="hljs-title class_">MyStorageA</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorageA</span>(<span class="hljs-string">'PropA'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'PropA'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageA</span> })</li><li>        <span class="hljs-comment">// 显示'PropA'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageA.propA}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct pageTwoStack {</li><li>  <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storageB</span>: <span class="hljs-title class_">MyStorageB</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorageB</span>(<span class="hljs-string">'PropB'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'Hello'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageB</span> })</li><li>        <span class="hljs-comment">// 显示'PropB'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageB.propB}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageThree'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct pageThreeStack {</li><li>  <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storageC</span>: <span class="hljs-title class_">MyStorageC</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorageC</span>(<span class="hljs-string">'PropC'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 显示'Hello'</span></li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageC</span> })</li><li>        <span class="hljs-comment">// 显示'PropC'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageC.propC}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageOne'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageThree'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NavigationContentMsgStack</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorageA</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storage.propA}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="appstorage-appstoragev2">AppStorage-&gt;AppStorageV2<i class="anchor-icon anchor-icon-link" anchorid="appstorage-appstoragev2" tips="复制节点链接"></i></h3>          <p>上一小节中，对于创建全局@ObserveV2和@Trace装饰实例的改造不适用于跨Ability的数据共享，可以使用AppStorageV2替代。</p>     <p>V1:</p>     <p>AppStorage与应用进程绑定，支持跨<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability" target="_blank">Ability</a>数据共享。</p>     <p>在下面的示例中，使用@StorageLink，可以使得开发者本地的修改同步回AppStorage中。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility Index.ets</span></li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility1'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility1'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility1 Index1.ets</span></li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index1</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2:</p>     <p>可以使用AppStorageV2实现跨Ability共享。</p>     <p>如下面示例：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorage</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">MyStorage</span>, <span class="hljs-string">'storage'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorage</span>())!;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storage.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility1'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility1'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorage</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index1</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">MyStorage</span>, <span class="hljs-string">'storage'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorage</span>())!;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storage.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>++;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>            <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>            <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span></li><li>          };</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>        })</li><li>      }</li><li>    }</li><li>}</li></ol></pre></div></div>     <p>如果开发者需要实现类似于@StorageProp的效果，希望本地的修改不同步回AppStorage，而AppStorage的变化能够通知到使用@StorageProp装饰器的组件，可以参考以下示例对比。</p>     <p>V1：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility Index.ets</span></li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'count'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span> + <span class="hljs-number">100</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility1'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility1'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility1 Index1.ets</span></li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index1</span> {</li><li>  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'count'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span> + <span class="hljs-number">100</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2:</p>     <p>开发者可以使用@Monitor和@Local实现类似效果，示例如下。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorage</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">MyStorage</span>, <span class="hljs-string">'storage'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorage</span>())!;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'storage.count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Index1 <span class="hljs-subst">${mon.value()?.before}</span> to <span class="hljs-subst">${mon.value()?.now}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span> += <span class="hljs-number">100</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility1'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility1'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStorage</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index1</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">MyStorage</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">MyStorage</span>, <span class="hljs-string">'storage'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyStorage</span>())!;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'storage.count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Index1 <span class="hljs-subst">${mon.value()?.before}</span> to <span class="hljs-subst">${mon.value()?.now}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`EntryAbility1 count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Storage Count'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">count</span> += <span class="hljs-number">100</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Jump to EntryAbility'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>: <span class="hljs-title class_">Want</span> = {</li><li>          <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>, <span class="hljs-comment">// 替换成AppScope/app.json5里的bundleName</span></li><li>          <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span></li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="environment-调用ability接口直接获取系统环境变量">Environment-&gt;调用Ability接口直接获取系统环境变量<i class="anchor-icon anchor-icon-link" anchorid="environment-调用ability接口直接获取系统环境变量" tips="复制节点链接"></i></h3>          <p>V1中，开发者可以通过Environment来获取环境变量，但Environment获取的结果无法直接使用，需要配合AppStorage才能得到对应环境变量的值。</p>     <p>在切换V2的过程中，开发者无需再通过Environment来获取环境变量，可以直接通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#uiabilitycontext-1" target="_blank">UIAbilityContext的config属性</a>获取系统环境变量。</p>     <p>V1:</p>     <p>以languageCode为例。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 将设备languageCode存入AppStorage中</span></li><li><span class="hljs-title class_">Environment</span>.<span class="hljs-title function_">envProp</span>(<span class="hljs-string">'languageCode'</span>, <span class="hljs-string">'en'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'languageCode'</span>) <span class="hljs-attr">languageCode</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'en'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 输出当前设备的languageCode</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">languageCode</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2:</p>     <p>封装Env类型来传递多个系统环境变量。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Env.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Env</span> {</li><li>  <span class="hljs-attr">language</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">fontSizeScale</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">fontWeightScale</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> <span class="hljs-attr">env</span>: <span class="hljs-title class_">Env</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Env</span>();</li></ol></pre></div></div>     <p>在onCreate里获取需要的系统环境变量：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { env } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Env'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    env.<span class="hljs-property">language</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">language</span>;</li><li>    env.<span class="hljs-property">colorMode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">colorMode</span>;</li><li>    env.<span class="hljs-property">fontSizeScale</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">fontSizeScale</span>;</li><li>    env.<span class="hljs-property">fontWeightScale</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">fontWeightScale</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在页面中获取当前Env的值。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { env } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Env'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 输出当前设备的环境变量</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`languageCode: <span class="hljs-subst">${env.language}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`colorMode: <span class="hljs-subst">${env.colorMode}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`fontSizeScale: <span class="hljs-subst">${env.fontSizeScale}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`fontWeightScale: <span class="hljs-subst">${env.fontWeightScale}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="persistentstorage-persistencev2">PersistentStorage-&gt;PersistenceV2<i class="anchor-icon anchor-icon-link" anchorid="persistentstorage-persistencev2" tips="复制节点链接"></i></h3>          <p>V1中PersistentStorage提供了持久化UI数据的能力，而V2则提供了更加方便使用的PersistenceV2接口来替代它。</p>     <ul>      <li>PersistentStorage持久化的触发时机依赖AppStorage的观察能力，且与AppStorage耦合，开发者无法自主选择写入或读取持久化数据的时机。</li>      <li>PersistentStorage使用序列化和反序列化，并没有传入类型，所以在持久化后，会丢失其类型，且对象的属性方法不能持久化。</li>     </ul>     <p>对于PersistenceV2：</p>     <ul>      <li>与PersistenceV2关联的@ObservedV2对象，其@Trace属性的变化，会触发整个关联对象的自动持久化。</li>      <li>开发者也可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#save" target="_blank">PersistenceV2.save</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-persistencev2#使用globalconnect存储数据">PersistenceV2.globalConnect</a>接口来手动触发持久化写入和读取。</li>     </ul>     <p>V1:</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">data</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ZhangSan'</span>;</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'numProp'</span>, <span class="hljs-number">47</span>);</li><li><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'dataProp'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title function_">data</span>());</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'numProp'</span>) <span class="hljs-attr">numProp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">48</span>;</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'dataProp'</span>) <span class="hljs-attr">dataProp</span>: data = <span class="hljs-keyword">new</span> <span class="hljs-title function_">data</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`numProp: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numProp}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">numProp</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>
</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`dataProp.name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dataProp.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataProp</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`dataProp.id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dataProp.id}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataProp</span>.<span class="hljs-property">id</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>
</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2:</p>     <p>下面的案例展示了：</p>     <ul>      <li>将PersistentStorage的持久化数据迁移到V2的PersistenceV2中。V2对被@Trace标记的数据可以自动持久化，对于非@Trace数据，需要手动调用save进行持久化。</li>      <li>示例中的move函数和需要显示的组件放在了一个ets中，开发者可以定义自己的move函数，并放入合适的位置进行统一迁移操作。</li>     </ul>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 迁移到globalConnect</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PersistenceV2</span>, <span class="hljs-title class_">Type</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 接受序列化失败的回调</span></li><li><span class="hljs-title class_">PersistenceV2</span>.<span class="hljs-title function_">notifyOnError</span>(<span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, reason: <span class="hljs-built_in">string</span>, msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error key: <span class="hljs-subst">${key}</span>, reason: <span class="hljs-subst">${reason}</span>, message: <span class="hljs-subst">${msg}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ZhangSan'</span>;</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">V2Data</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-title class_">Id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sample</span> {</li><li>  <span class="hljs-comment">// 对于复杂对象需要@Type修饰，确保序列化成功</span></li><li>  <span class="hljs-meta">@Type</span>(V2Data)</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">V2</span>: V2Data = <span class="hljs-keyword">new</span> <span class="hljs-title function_">V2Data</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// 用于判断是否完成数据迁移的辅助数据</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageState</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">isCompleteMoving</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">move</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> movingState = <span class="hljs-title class_">PersistenceV2</span>.<span class="hljs-title function_">globalConnect</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">StorageState</span>, <span class="hljs-attr">defaultCreator</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageState</span>()})!;</li><li>  <span class="hljs-keyword">if</span> (!movingState.<span class="hljs-property">isCompleteMoving</span>) {</li><li>    <span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'numProp'</span>, <span class="hljs-number">47</span>);</li><li>    <span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'dataProp'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>());</li><li>    <span class="hljs-keyword">let</span> num = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'numProp'</span>)!;</li><li>    <span class="hljs-keyword">let</span> V1Data = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">Data</span>&gt;(<span class="hljs-string">'dataProp'</span>)!;</li><li>    <span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">deleteProp</span>(<span class="hljs-string">'numProp'</span>);</li><li>    <span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">deleteProp</span>(<span class="hljs-string">'dataProp'</span>);</li><li>
</li><li>    <span class="hljs-comment">// V2创建对应数据</span></li><li>    <span class="hljs-keyword">let</span> migrate = <span class="hljs-title class_">PersistenceV2</span>.<span class="hljs-title function_">globalConnect</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">Sample</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'connect2'</span>, <span class="hljs-attr">defaultCreator</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>()})!;  <span class="hljs-comment">// 使用默认构造函数也可以</span></li><li>    <span class="hljs-comment">// 赋值数据，@Trace修饰的会自动保存，对于非@Trace对象，也可以调用save保存，如：PersistenceV2.save('connect2');</span></li><li>    migrate.<span class="hljs-property">num</span> = num;</li><li>    migrate.<span class="hljs-property">V2</span>.<span class="hljs-property">name</span> = V1Data.<span class="hljs-property">name</span>;</li><li>    migrate.<span class="hljs-property">V2</span>.<span class="hljs-property">Id</span> = V1Data.<span class="hljs-property">id</span>;</li><li>
</li><li>    <span class="hljs-comment">// 将迁移标志设置为true</span></li><li>    movingState.<span class="hljs-property">isCompleteMoving</span> = <span class="hljs-literal">true</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-title function_">move</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">refresh</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-comment">// 使用key:connect2存入数据</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">p</span>: <span class="hljs-title class_">Sample</span> = <span class="hljs-title class_">PersistenceV2</span>.<span class="hljs-title function_">globalConnect</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">Sample</span>, <span class="hljs-attr">key</span>:<span class="hljs-string">'connect2'</span>, <span class="hljs-attr">defaultCreator</span>:<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>()})!;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({<span class="hljs-attr">space</span>: <span class="hljs-number">5</span>}) {</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`numProp: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.p.num}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">p</span>.<span class="hljs-property">num</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>
</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`dataProp.name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.p.V2.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">p</span>.<span class="hljs-property">V2</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-comment">// 应用退出时会保存当前结果。重新启动后，会显示上一次的保存结果</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`dataProp.id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.p.V2.Id}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">p</span>.<span class="hljs-property">V2</span>.<span class="hljs-property">Id</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="v1现有功能向v2的逐步迁移场景">V1现有功能向V2的逐步迁移场景<i class="anchor-icon anchor-icon-link" anchorid="v1现有功能向v2的逐步迁移场景" tips="复制节点链接"></i></h2>          <p>对于已经使用V1开发的大型应用，通常难以一次性从V1迁移到V2，而是需要分批次、分组件地逐步迁移，这就必然会带来V1和V2的混用。</p>     <p>这种场景，通常父组件使用状态管理V1，而迁移的子组件使用状态管理V2。为了模拟这种场景，我们举出以下示例：</p>     <ul>      <li>父组件是@Component，数据源是@LocalStorageLink。</li>      <li>子组件是@ComponentV2，使用@Param接受数据源的数据。</li>     </ul>     <p>可以通过以下策略进行迁移：</p>     <ul>      <li>声明一个@ObservedV2装饰的class来封装V1的数据。</li>      <li>在@Component和@ComponentV2之间，定义一个桥接的@Component自定义组件。</li>      <li>在桥接层：       <ul>        <li>V1-&gt;V2的数据同步，可通过@Watch的监听触发@ObservedV2装饰的class的属性的赋值。</li>        <li>V2-&gt;V1的数据同步，可通过在@ObservedV2装饰的class里声明Monitor，通过LocalStorage的API反向通知给V1状态变量。</li>       </ul></li>     </ul>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">V1StorageData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'V1OldComponent'</span></li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'title'</span>)</li><li>  <span class="hljs-title function_">onStrChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${path}</span> changed from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>)</li><li>      <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'title'</span>) {</li><li>        storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'title'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>);</li><li>      }</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">v1Data</span>: V1StorageData = <span class="hljs-keyword">new</span> <span class="hljs-title function_">V1StorageData</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct V1OldComponent {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'title'</span>) <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'V1OldComponent'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V1OldComponent: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.title}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'new value from V1OldComponent'</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 定义一个桥接的\@Component自定义组件，用于V1和V2的变量相互同步</span></li><li>      <span class="hljs-title class_">Bridge</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Bridge</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'title'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'titleWatch'</span>) <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Bridge'</span>;</li><li>
</li><li>  <span class="hljs-title function_">titleWatch</span>(<span class="hljs-params"></span>) {</li><li>    v1Data.<span class="hljs-property">title</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NewV2Component</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NewV2Component</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`NewV2Component: <span class="hljs-subst">${v1Data.title}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          v1Data.<span class="hljs-property">title</span> = <span class="hljs-string">'NewV2Component'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="其他迁移场景">其他迁移场景<i class="anchor-icon anchor-icon-link" anchorid="其他迁移场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="滑动组件" class="firsth2">滑动组件<i class="anchor-icon anchor-icon-link" anchorid="滑动组件" tips="复制节点链接"></i></h3>          <p><strong>List</strong></p>     <p>开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#childrenmainsize12" target="_blank">ChildrenMainSize</a>来设置List的子组件在主轴方向的大小信息。</p>     <p>V1：</p>     <p>在状态管理V1中，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰观察其api调用。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ListExample</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">ListScroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListScroller</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">listSpace</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">listChildrenSize</span>: <span class="hljs-title class_">ChildrenMainSize</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChildrenMainSize</span>(<span class="hljs-number">100</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Default'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-property">childDefaultSize</span> += <span class="hljs-number">10</span>;</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'splice 5'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>]);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update 5'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-title function_">update</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listSpace</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> }) {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`item-`</span> + item)</li><li>          }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">childrenMainSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>) <span class="hljs-comment">// 10</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>在状态管理V2中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>只能观察本身的变化，无法观察第一层的变化，而由于ChildrenMainSize定义在框架中，开发者无法使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>来标注ChildrenMainSize的属性。可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>替代。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ListExample</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">ListScroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListScroller</span>();</li><li>  <span class="hljs-attr">listSpace</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-comment">// 使用makeObserved的能力来观测ChildrenMainSize</span></li><li>  <span class="hljs-attr">listChildrenSize</span>: <span class="hljs-title class_">ChildrenMainSize</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChildrenMainSize</span>(<span class="hljs-number">100</span>));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Default'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-property">childDefaultSize</span> += <span class="hljs-number">10</span>;</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'splice 5'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>]);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update 5'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-title function_">update</span>(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listSpace</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> }) {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`item-`</span> + item)</li><li>          }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">childrenMainSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>) <span class="hljs-comment">// 10</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>WaterFlow</strong></p>     <p>开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-waterflow#sections12" target="_blank">WaterFlowSections</a>来设置WaterFlow瀑布流分组信息。</p>     <p>需要注意的是，数组arr的长度需要与WaterFlowSections的所有SectionOptions的itemsCount总和一致，否则WaterFlow无法处理，导致UI不刷新。</p>     <p>以下两个示例请按照'push option' -&gt; 'splice option' -&gt; 'update option'的顺序进行点击。</p>     <p>V1：</p>     <p>在状态管理V1中，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰观察其api调用。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WaterFlowSample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">colors</span>: <span class="hljs-title class_">Color</span>[] = [<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sections</span>: <span class="hljs-title class_">WaterFlowSections</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WaterFlowSections</span>();</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">9</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);</li><li>  <span class="hljs-attr">oneColumnSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">4</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">columnsGap</span>: <span class="hljs-string">'5vp'</span>,</li><li>    <span class="hljs-attr">rowsGap</span>: <span class="hljs-number">10</span>,</li><li>  };</li><li>  <span class="hljs-attr">twoColumnSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">2</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>  };</li><li>  <span class="hljs-attr">lastSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">3</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">3</span>,</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">sectionOptions</span>: <span class="hljs-title class_">SectionOptions</span>[] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">oneColumnSection</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">twoColumnSection</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastSection</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sectionOptions);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr.length}</span>`</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">1</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">1</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">push</span>(section);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-number">100</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'splice option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">8</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>, [section]);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">10</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">8</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">update</span>(<span class="hljs-number">1</span>, section);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">WaterFlow</span>({ <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>, <span class="hljs-attr">sections</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span> }) {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">FlowItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>              .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span>[item % <span class="hljs-number">6</span>])</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>          }</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>在状态管理V2中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>只能观察本身的变化，无法观察第一层的变化，由于WaterFlowSections定义在框架中，开发者无法使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>标注其属性，此时可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>替代。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">WaterFlowSample</span> {</li><li>  <span class="hljs-attr">colors</span>: <span class="hljs-title class_">Color</span>[] = [<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>, <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>];</li><li>  <span class="hljs-comment">// 使用makeObserved的能力来观测WaterFlowSections</span></li><li>  <span class="hljs-attr">sections</span>: <span class="hljs-title class_">WaterFlowSections</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WaterFlowSections</span>());</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">9</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);</li><li>  <span class="hljs-attr">oneColumnSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">4</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">columnsGap</span>: <span class="hljs-string">'5vp'</span>,</li><li>    <span class="hljs-attr">rowsGap</span>: <span class="hljs-number">10</span>,</li><li>  };</li><li>  <span class="hljs-attr">twoColumnSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">2</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>  };</li><li>  <span class="hljs-attr">lastSection</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>    <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">3</span>,</li><li>    <span class="hljs-attr">crossCount</span>: <span class="hljs-number">3</span>,</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">sectionOptions</span>: <span class="hljs-title class_">SectionOptions</span>[] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">oneColumnSection</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">twoColumnSection</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastSection</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sectionOptions);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr.length}</span>`</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">1</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">1</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">push</span>(section);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-number">100</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'splice option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">8</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>, [section]);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">10</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update option'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">section</span>: <span class="hljs-title class_">SectionOptions</span> = {</li><li>          <span class="hljs-attr">itemsCount</span>: <span class="hljs-number">8</span>,</li><li>          <span class="hljs-attr">crossCount</span>: <span class="hljs-number">2</span>,</li><li>        };</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span>.<span class="hljs-title function_">update</span>(<span class="hljs-number">1</span>, section);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">1</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">WaterFlow</span>({ <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>, <span class="hljs-attr">sections</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sections</span> }) {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">FlowItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>              .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span>[item % <span class="hljs-number">6</span>])</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>          }</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="modifier">Modifier<i class="anchor-icon anchor-icon-link" anchorid="modifier" tips="复制节点链接"></i></h3>          <p><strong>attributeModifier</strong></p>     <p>开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier#attributemodifier" target="_blank">attributeModifier</a>动态设置组件的属性方法。</p>     <p>V1：</p>     <p>在状态管理V1中，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰观察其变化。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {</li><li>  <span class="hljs-attr">isDark</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span>) {</li><li>      instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">AttributeDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">MyButtonModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Button'</span>)</li><li>          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">isDark</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">isDark</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>在状态管理V2中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>只能观察本身的变化，无法观察第一层的变化，如果要观察attributeModifier的属性变化，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>替代。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {</li><li>  <span class="hljs-attr">isDark</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span>) {</li><li>      instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">AttributeDemo</span> {</li><li>  <span class="hljs-comment">// 使用makeObserved的能力观测attributeModifier的属性this.modifier</span></li><li>  <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">MyButtonModifier</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>());</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Button'</span>)</li><li>          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">isDark</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">isDark</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>CommonModifier</strong></p>     <p>动态设置组件的属性类。以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier#自定义modifier" target="_blank">CommonModifier</a>为例。</p>     <p>V1：</p>     <p>在状态管理V1中，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰观察其变化。</p>     <p>具体实例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CommonModifier</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CommonModifier</span> {</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">CommonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">super</span>.<span class="hljs-property">applyNormalAttribute</span>?.(instance);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup1</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">8</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup2</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dashed</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">8</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyImage1</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">CommonModifier</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 此处'app.media.app_icon'仅作示例，请开发者自行替换，否则imageSource创建失败会导致后续无法正常执行。</span></li><li>    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.app_icon'</span>))</li><li>      .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">myModifier</span>: <span class="hljs-title class_">CommonModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>);</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>($r(<span class="hljs-string">'app.string.EntryAbility_label'</span>))</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'onClick'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>++;</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup1</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup1'</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup2</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup2'</span>);</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">MyImage1</span>({ <span class="hljs-attr">modifier</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>在状态管理V2中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>只能观察本身的变化，无法观察第一层的变化，又因为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier#自定义modifier" target="_blank">CommonModifier</a>在框架内是通过其属性触发刷新，此时可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>替代。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span>, <span class="hljs-title class_">CommonModifier</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CommonModifier</span> {</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">CommonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">super</span>.<span class="hljs-property">applyNormalAttribute</span>?.(instance);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup1</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">8</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup2</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dashed</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">8</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyImage1</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">CommonModifier</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 此处'app.media.app_icon'仅作示例，请开发者自行替换，否则imageSource创建失败会导致后续无法正常执行。</span></li><li>    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.app_icon'</span>))</li><li>      .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 使用makeObserved的能力来观测CommonModifier</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">myModifier</span>: <span class="hljs-title class_">CommonModifier</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>));</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>($r(<span class="hljs-string">'app.string.EntryAbility_label'</span>))</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'onClick'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>++;</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup1</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup1'</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup2</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup2'</span>);</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">MyImage1</span>({ <span class="hljs-attr">modifier</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>组件Modifier</strong></p>     <p>动态设置组件的属性类。以Text组件为例。</p>     <p>V1：</p>     <p>在状态管理V1中，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰观察其变化。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextModifier</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">TextModifier</span> {</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">TextModifier</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">super</span>.<span class="hljs-property">applyNormalAttribute</span>?.(instance);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup1</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup2</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyImage1</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">TextModifier</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Test'</span>)</li><li>        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>($r(<span class="hljs-string">'app.string.EntryAbility_label'</span>))</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'onClick'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>++;</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup1</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup1'</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup2</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup2'</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">myModifier</span>: <span class="hljs-title class_">TextModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>);</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">MyImage1</span>({ <span class="hljs-attr">modifier</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace whole'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>但在状态管理V2中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>只能观察本身的变化，无法观察第一层的变化，此时可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a>替代。</p>     <p>具体示例如下：</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span>, <span class="hljs-title class_">TextModifier</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">TextModifier</span> {</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">TextModifier</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">super</span>.<span class="hljs-property">applyNormalAttribute</span>?.(instance);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup1</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">setGroup2</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyImage1</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">TextModifier</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Test'</span>)</li><li>        .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>($r(<span class="hljs-string">'app.string.EntryAbility_label'</span>))</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'onClick'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>++;</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> % <span class="hljs-number">2</span> === <span class="hljs-number">1</span>) {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup1</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup1'</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            (<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyModifier</span>).<span class="hljs-title function_">setGroup2</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Modifier'</span>, <span class="hljs-string">'setGroup2'</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 使用makeObserved的能力观测TextModifier</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">myModifier</span>: <span class="hljs-title class_">TextModifier</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>));</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">MyImage1</span>({ <span class="hljs-attr">modifier</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace whole'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myModifier</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeObserved</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModifier</span>().<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>));</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>AttributeUpdater</strong></p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-extension-attributeupdater">AttributeUpdater</a>可以将属性直接设置给组件，无需标记为状态变量即可直接触发UI更新。</p>     <p>V1：</p>     <p>在状态管理V1中，开发者希望通过修改MyButtonModifier的flag来改变绑定在Button上的属性。由于状态管理V1的@State装饰器支持自身及第一层对象属性的观察能力，因此只需用@State装饰AttributeUpdater，即可监听其变化并触发属性更新。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AttributeUpdater</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AttributeUpdater</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {</li><li>  <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">initializeModifier</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff2787d9'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>      instance.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      instance.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">10</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">MyButtonModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Button'</span>)</li><li>          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Update'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">flag</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2：</p>     <p>与状态管理V1不同，状态管理V2的@Local仅观察自身变化，因此MyButtonModifier需添加@ObservedV2装饰器，flag需要被@Trace装饰，并且需要在组件创建过程中读取flag以建立其与Button组件的联系。在AttributeUpdater场景中，需在initializeModifier中读取flag（如示例所示），否则无法建立关联。</p>     <div _ngcontent-psg-c106="" class="highlight-div"><div _ngcontent-psg-c106="" class="highlight-div-header"><div _ngcontent-psg-c106="" class="highlight-div-header-left"><div _ngcontent-psg-c106="" class="handle-button expand-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-psg-c106="" class="highlight-div-header-right"><div _ngcontent-psg-c106="" class="handle-button ai-button"></div><div _ngcontent-psg-c106="" class="handle-button line-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-psg-c106="" class="handle-button theme-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-psg-c106="" class="handle-button copy-button"><div _ngcontent-psg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-psg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AttributeUpdater</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyButtonModifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AttributeUpdater</span>&lt;<span class="hljs-title class_">ButtonAttribute</span>&gt; {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">initializeModifier</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// initializeModifier会在组件初始化阶段回调，需要在这个地方触发下flag的读，使其建立Button组件的关联。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;</li><li>    instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff2787d9'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ButtonAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>      instance.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      instance.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">10</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 状态管理V2装饰器仅观察本层，即当前可以观察到modifier整体赋值的变化。</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">modifier</span>: <span class="hljs-title class_">MyButtonModifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyButtonModifier</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Button'</span>)</li><li>          .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Update'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">modifier</span>.<span class="hljs-property">flag</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>