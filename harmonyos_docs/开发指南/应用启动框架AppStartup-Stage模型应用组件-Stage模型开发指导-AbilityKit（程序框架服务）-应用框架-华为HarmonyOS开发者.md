<h1 _ngcontent-jbu-c119="" class="doc-title ng-star-inserted" title="应用启动框架AppStartup"> 应用启动框架AppStartup </h1>

<div _ngcontent-jbu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>应用启动时通常需要执行一系列初始化启动任务，如果将启动任务都放在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>生命周期中，那么只能在主线程中依次执行，不但影响应用的启动速度，而且当启动任务过多时，任务之间复杂的依赖关系还会使得代码难以维护。</p>     <p>AppStartup提供了一种简单高效的应用启动方式，可以支持任务的异步启动，加快应用启动速度。同时，通过在一个配置文件中统一设置多个启动任务的执行顺序以及依赖关系，让执行启动任务的代码变得更加简洁清晰、容易维护。</p>    </div>    <div class="tiledSection">     <h2 id="运行机制">运行机制<i class="anchor-icon anchor-icon-link" anchorid="运行机制" tips="复制节点链接"></i></h2>          <p>启动框架支持以自动模式或手动模式执行启动任务，默认采用自动模式。在构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ability-terminology#abilitystage">AbilityStage</a>过程中开始加载开发者配置的启动任务，并执行自动模式的启动任务。开发者也可以在AbilityStage创建完后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupmanager#startupmanagerrun" target="_blank">startupManager.run</a>方法，执行手动模式的启动任务。</p>     <p><strong>图1</strong> 启动框架执行时机</p>     <p><span><img originheight="739" originwidth="784" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114854.62165663243067538892373914466269:50001231000000:2800:1C35655B2FB027688C3D6090384C50F644787C1BF0FA3AFE331D188643FCD14D.png" width="784" height="739"></span></p>    </div>    <div class="tiledSection">     <h2 id="支持的范围">支持的范围<i class="anchor-icon anchor-icon-link" anchorid="支持的范围" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>HAP：entry类型的HAP支持以自动和手动模式启动。从API version 20开始，feature类型的HAP支持以自动和手动模式启动。</p></li>      <li>       <p>HSP/HAR: 从API version 18开始，支持在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp">HSP</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package">HAR</a>中配置启动任务。HSP和HAR的启动任务、so预加载任务无法主动配置为自动模式，但可以被HAP中自动模式的启动任务、so预加载任务拉起。</p></li>      <li>       <p>启动框架从API 18开始支持配置so预加载任务，so文件开发可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">Node-API</a>创建Native C++工程。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>使用启动框架必须在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中开启启动框架。</p></li>      <li>       <p>ExtensionAbility组件启动场景单一，使用启动框架会带来额外开销，因此不支持ExtensionAbility组件启动时拉起启动框架。</p></li>      <li>       <p>启动任务之间或so预加载任务之间不允许存在循环依赖。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发流程">开发流程<i class="anchor-icon anchor-icon-link" anchorid="开发流程" tips="复制节点链接"></i></h2>          <ol>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动框架配置文件">定义启动框架配置文件</a>：在资源文件目录下创建并定义启动框架配置文件。</p>       <ol>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#创建启动框架配置文件">创建启动框架配置文件</a>：在资源文件目录下创建启动框架配置文件，并在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5</a>配置文件中引用。</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动参数配置">定义启动参数配置</a>：在启动框架配置文件中添加启动参数的配置信息。</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>：在启动框架配置文件中添加启动任务的配置信息</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义预加载so任务配置">定义预加载so任务配置</a>：在启动框架配置文件中添加预加载so任务的配置信息。</li>       </ol></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动参数">设置启动参数</a>：在启动参数文件中，设置超时时间和启动任务的监听器等参数。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/app-startup#为每个待初始化功能组件添加启动任务">为每个待初始化功能组件添加启动任务</a>：通过实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startuptask" target="_blank">StartupTask</a>接口，启动框架将会按顺序执行初始化流程。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/app-startup#可选操作">可选操作</a>：开发者可以在复杂场景下更精细地控制启动框架的行为。</p>       <ul>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#hsp与har中使用启动框架">HSP与HAR中使用启动框架</a>：在HSP与HAR中配置启动任务、so预加载任务。实现跨模块的启动任务依赖管理，提升大型应用的启动效率和代码可维护性。</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#修改启动模式">修改启动模式</a>：将启动任务、so预加载任务修改为手动模式，灵活控制任务执行时机，避免不必要的启动开销。</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#添加任务匹配规则">添加任务匹配规则</a>：根据场景通过匹配规则过滤启动任务。精准控制任务执行范围，避免加载无关任务。</li>        <li><a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动任务调度阶段">设置启动任务调度阶段</a>：设置启动任务的调度阶段，提前执行任务，节省启动时间。</li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="定义启动框架配置文件">定义启动框架配置文件<i class="anchor-icon anchor-icon-link" anchorid="定义启动框架配置文件" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="创建启动框架配置文件" class="firsth2">创建启动框架配置文件<i class="anchor-icon anchor-icon-link" anchorid="创建启动框架配置文件" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>的“resources/base/profile”路径下，新建启动框架配置文件。文件名可以自定义，本文以"startup_config.json"为例。</p></li>      <li>       <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>的appStartup标签中，添加启动框架配置文件的索引。</p>       <p>module.json5示例代码如下。</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"appStartup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:startup_config"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启动框架的配置文件</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="定义启动参数配置">定义启动参数配置<i class="anchor-icon anchor-icon-link" anchorid="定义启动参数配置" tips="复制节点链接"></i></h3>          <p>在启动框架配置文件startup_config.json中，可以添加启动参数的配置信息。</p>     <ol>      <li>       <p>在“ets/startup”路径下，创建启动参数配置文件。本例中的文件名为StartupConfig.ets。</p></li>      <li>       <p>在启动框架配置文件startup_config.json中，添加启动参数配置文件的相关信息。</p>       <p>startup_config.json文件示例如下：</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-comment">// 启动任务</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"appPreloadHintStartupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-comment">// 预加载so任务</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span> <span class="hljs-comment">// 启动参数的配置</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>     <p><strong>表1</strong> startup_config.json配置文件标签说明</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.5.1.1" valign="top" width="25%">属性名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.5.1.2" valign="top" width="25%">含义</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.5.1.3" valign="top" width="25%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.5.1.4" valign="top" width="25%">是否可缺省</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">startupTasks</td>         <td class="cellrowborder" valign="top" width="25%">启动任务配置信息，详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>。</td>         <td class="cellrowborder" valign="top" width="25%">对象数组</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为空。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">appPreloadHintStartupTasks</td>         <td class="cellrowborder" valign="top" width="25%">预加载so任务配置信息，详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义预加载so任务配置">定义预加载so任务配置</a>。</td>         <td class="cellrowborder" valign="top" width="25%">对象数组</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为空。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">configEntry</td>         <td class="cellrowborder" valign="top" width="25%">          <p>启动参数配置文件所在路径。详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动参数">设置启动参数</a>。</p>          <p><strong>说明：</strong></p>          <p>- HSP、HAR中不允许配置configEntry字段。</p>          <p>- 如果应用开启了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-filename-obfuscation">文件名混淆</a>，则需要将文件路径添加到保留白名单中。具体操作详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation">ArkGuard混淆原理及功能</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-keep-file-name">-keep-file-name</a>部分。</p></td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="定义启动任务配置">定义启动任务配置<i class="anchor-icon anchor-icon-link" anchorid="定义启动任务配置" tips="复制节点链接"></i></h3>          <p>假设当前应用启动框架共包含6个启动任务，任务之间的依赖关系如下图所示。为了便于并发执行启动任务，单个启动任务文件包含的启动任务应尽量单一，本例中每个启动任务对应一个启动任务文件。</p>     <p><strong>图2</strong> 启动任务依赖关系图</p>     <p><span><img originheight="233" originwidth="600" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114854.62856463696940342469726156886636:50001231000000:2800:B5EE5AA9B5246F69199663DC9EEF5F2A3AC6026080A7D8C7575F7135C4F41565.png" width="600" height="233"></span></p>     <ol>      <li>       <p>在“ets/startup”路径下，依次创建6个启动任务文件。文件名称必须确保唯一性。本例中的6个文件名分别为StartupTask_001.ets~StartupTask_006.ets。</p></li>      <li>       <p>在启动框架配置文件startup_config.json中，添加启动任务配置。</p>       <p>startup_config.json文件示例如下：</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_001"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_001.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"StartupTask_002"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"StartupTask_003"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_002"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_002.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"StartupTask_003"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"StartupTask_004"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_003"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_003.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"StartupTask_004"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_004"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_004.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_005"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_005.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"StartupTask_006"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mainThread"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_006"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_006.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mainThread"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"appPreloadHintStartupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-comment">// 预加载so任务</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>     <p><strong>表2</strong> startupTasks标签说明</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.1" valign="top" width="25%">属性名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.2" valign="top" width="25%">含义</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.3" valign="top" width="25%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.4" valign="top" width="25%">是否可缺省</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">name</td>         <td class="cellrowborder" valign="top" width="25%">启动任务名称，可自定义，推荐与类名保持一致。</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">srcEntry</td>         <td class="cellrowborder" valign="top" width="25%">          <p>启动任务对应的文件路径。</p>          <p><strong>说明：</strong></p>          <p>如果应用开启了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-filename-obfuscation">文件名混淆</a>，则需要将文件路径添加到保留白名单中。具体操作详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation">ArkGuard混淆原理及功能</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-keep-file-name">-keep-file-name</a>部分。</p></td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">dependencies</td>         <td class="cellrowborder" valign="top" width="25%">启动任务依赖的其他启动任务的类名数组。</td>         <td class="cellrowborder" valign="top" width="25%">对象数组</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为空。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">excludeFromAutoStart</td>         <td class="cellrowborder" valign="top" width="25%">          <p>是否排除自动模式，详细介绍可以查看<a href="/consumer/cn/doc/harmonyos-guides/app-startup#修改启动模式">修改启动模式</a>。</p>          <p>- true：手动模式。</p>          <p>- false：自动模式。</p>          <p><strong>说明：</strong></p>          <p>HSP、HAR中startupTask里的excludeFromAutoStart标签必须配置为true。</p></td>         <td class="cellrowborder" valign="top" width="25%">布尔值</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">runOnThread</td>         <td class="cellrowborder" valign="top" width="25%">          <p>执行初始化所在的线程。</p>          <p>- mainThread：在主线程中执行。</p>          <p>- taskPool：在异步线程中执行。</p></td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为mainThread。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">waitOnMainThread</td>         <td class="cellrowborder" valign="top" width="25%">          <p>主线程是否需要等待启动框架执行。当runOnThread取值为taskPool时，该字段生效。</p>          <p>- true：主线程等待启动框架执行完之后，才会加载应用首页。</p>          <p>- false：主线程不等待启动任务执行。</p></td>         <td class="cellrowborder" valign="top" width="25%">布尔值</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为true。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">matchRules</td>         <td class="cellrowborder" valign="top" width="25%">          <p>该字段用于筛选需要以自动模式启动的启动任务，加速应用启动过程。适用于快速拉起某个页面的场景，例如，通过桌面卡片、通知或意图调用等方式触发的页面跳转，实现功能服务的一步直达体验。操作指导详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#添加任务匹配规则">添加任务匹配规则</a>。</p>          <p><strong>说明：</strong></p>          <p>- 从API version 20开始，支持该字段。当前仅支持在HAP中配置该字段。</p>          <p>- 该字段的优先级高于excludeFromAutoStart。如果所有启动任务均匹配失败，则按任务的excludeFromAutoStart配置处理。</p></td>         <td class="cellrowborder" valign="top" width="25%">对象</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">schedulerPhase</td>         <td class="cellrowborder" valign="top" width="25%">          <p>启动任务的调度阶段。操作指导详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动任务调度阶段">设置启动任务调度阶段</a>。</p>          <p>- preAbilityStageLoad：启动任务及其依赖任务在AbilityStage模块加载前调度执行。</p>          <p>- postAbilityStageLoad：启动任务及其依赖任务在AbilityStage模块加载后调度执行。</p>          <p><strong>说明：</strong></p>          <p>- 从API version 21开始，支持该字段。当前仅支持在HAP中配置该字段。</p>          <p>- 这里的AbilityStage模块加载指的是AbilityStage.ets文件及其所依赖模块的加载。关于模块加载的详细介绍，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-principle#模块化运行加载流程">模块化运行加载流程</a>。</p></td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为postAbilityStageLoad。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="定义预加载so任务配置">定义预加载so任务配置<i class="anchor-icon anchor-icon-link" anchorid="定义预加载so任务配置" tips="复制节点链接"></i></h3>          <p>假设当前应用启动框架共包含6个so预加载任务，任务之间的依赖关系如下图所示。不建议应用在so文件的加载回调中运行代码逻辑，so文件的加载不宜过长，否则会影响主线程的运行。</p>     <p><strong>图3</strong> so预加载任务依赖关系图</p>     <p><span><img originheight="232" originwidth="600" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114854.22688537752512840936102685620502:50001231000000:2800:3E5D6C2ED1F454408E4AF7F0B5226075A82C7CB0AD0802CE7D4FDBCA711659D3.png" width="600" height="232"></span></p>     <ol>      <li>       <p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">Node-API</a>创建so文件。本例中的6个so文件名称分别为libentry_001.so~libentry_006.so。</p></li>      <li>       <p>在启动框架配置文件startup_config.json中，添加预加载so任务配置。</p>       <p>startup_config.json文件示例如下：</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-comment">// 启动任务</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"appPreloadHintStartupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_001"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_001.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"libentry_002"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"libentry_003"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_002"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_002.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"libentry_003"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"libentry_004"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_003"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_003.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"libentry_004"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_004"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_004.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_005"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_005.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"libentry_006"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_006"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_006.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>     <p><strong>表3</strong> appPreloadHintStartupTasks标签说明</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" valign="top" width="25%">属性名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" valign="top" width="25%">含义</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" valign="top" width="25%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" valign="top" width="25%">是否可缺省</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">name</td>         <td class="cellrowborder" valign="top" width="25%">预加载so文件名。</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">srcEntry</td>         <td class="cellrowborder" valign="top" width="25%">带后缀预加载so文件名。</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">dependencies</td>         <td class="cellrowborder" valign="top" width="25%">预加载任务依赖的其他预加载任务的so名数组。</td>         <td class="cellrowborder" valign="top" width="25%">对象数组</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为空。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">excludeFromAutoStart</td>         <td class="cellrowborder" valign="top" width="25%">          <p>是否排除自动模式，详细介绍可以查看<a href="/consumer/cn/doc/harmonyos-guides/app-startup#修改启动模式">修改启动模式</a>。</p>          <p>- true：手动模式。</p>          <p>- false：自动模式。</p>          <p><strong>说明：</strong></p>          <p>HSP、HAR中appPreloadHintStartupTask的excludeFromAutoStart标签必须配置为true。</p></td>         <td class="cellrowborder" valign="top" width="25%">布尔值</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省，缺省值为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">runOnThread</td>         <td class="cellrowborder" valign="top" width="25%">          <p>执行预加载所在的线程。</p>          <p>- taskPool：在异步线程中执行。</p>          <p><strong>说明：</strong></p>          <p>so预加载只允许在taskPool线程执行。</p></td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">该标签不可缺省。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">matchRules</td>         <td class="cellrowborder" valign="top" width="25%">          <p>该字段用于筛选需要以自动模式启动的预加载so任务，加速应用启动过程。适用于快速拉起某个页面的场景，例如，通过桌面卡片、通知或意图调用等方式触发的页面跳转，实现功能服务的一步直达体验。操作指导详见<a href="/consumer/cn/doc/harmonyos-guides/app-startup#添加任务匹配规则">添加任务匹配规则</a>。</p>          <p><strong>说明：</strong></p>          <p>- 从API version 20开始，支持该字段。当前仅支持在HAP中配置该字段。</p>          <p>- 该字段的优先级高于excludeFromAutoStart。如果所有预加载so任务均匹配失败，则按任务的excludeFromAutoStart配置处理。</p></td>         <td class="cellrowborder" valign="top" width="25%">对象</td>         <td class="cellrowborder" valign="top" width="25%">该标签可缺省。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="设置启动参数">设置启动参数<i class="anchor-icon anchor-icon-link" anchorid="设置启动参数" tips="复制节点链接"></i></h2>          <p>在启动参数配置文件（本文为“ets/startup/StartupConfig.ets”文件）中，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupconfigentry" target="_blank">StartupConfigEntry</a>接口实现启动框架公共参数的配置，包括超时时间和启动任务的监听器等参数，其中需要用到如下接口：</p>     <ul>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupconfig" target="_blank">StartupConfig</a>：用于设置任务超时时间和启动框架的监听器。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startuplistener" target="_blank">StartupListener</a>：用于监听启动任务是否执行成功。</li>     </ul>     <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StartupConfig</span>, <span class="hljs-title class_">StartupConfigEntry</span>, <span class="hljs-title class_">StartupListener</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStartupConfigEntry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">StartupConfigEntry</span> {</li><li>  <span class="hljs-title function_">onConfig</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`onConfig`</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">onCompletedCallback</span> = (<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">void</span>&gt;</span>) =&gt; {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`onCompletedCallback`</span>);</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'onCompletedCallback: %{public}d, message: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`onCompletedCallback: success.`</span>);</li><li>      }</li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">startupListener</span>: <span class="hljs-title class_">StartupListener</span> = {</li><li>      <span class="hljs-string">'onCompleted'</span>: onCompletedCallback</li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">StartupConfig</span> = {</li><li>      <span class="hljs-string">'timeoutMs'</span>: <span class="hljs-number">10000</span>,</li><li>      <span class="hljs-string">'startupListener'</span>: startupListener</li><li>    };</li><li>    <span class="hljs-keyword">return</span> config;</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="为每个待初始化功能组件添加启动任务">为每个待初始化功能组件添加启动任务<i class="anchor-icon anchor-icon-link" anchorid="为每个待初始化功能组件添加启动任务" tips="复制节点链接"></i></h2>          <p>上述操作中已完成启动框架配置文件、启动参数的配置，还需要在每个功能组件对应的启动任务文件中，通过实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startuptask" target="_blank">StartupTask</a>来添加启动任务。其中，需要用到下面的两个方法：</p>     <ul>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startuptask#init" target="_blank">init</a>：启动任务初始化。当该任务依赖的启动任务全部执行完毕，即onDependencyCompleted完成调用后，才会执行init方法对该任务进行初始化。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startuptask#ondependencycompleted" target="_blank">onDependencyCompleted</a>：当前任务依赖的启动任务执行完成时，调用该方法。</li>     </ul>     <p>下面以<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">startup_config.json</a>中的StartupTask_001.ets文件为例，示例代码如下。开发者需要分别为每个待初始化功能组件添加启动任务。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>由于StartupTask采用了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable#sendable协议">Sendable协议</a>，在继承该接口时，必须添加Sendable注解。</p>      </div></div></div>     <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StartupTask</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StartupTask_001</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">StartupTask</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">context: common.AbilityStageContext</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'StartupTask_001 init.'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'StartupTask_001'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDependencyCompleted</span>(<span class="hljs-attr">dependence</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">result</span>: <span class="hljs-title class_">Object</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'StartupTask_001 onDependencyCompleted, dependence: %{public}s, result: %{public}s'</span>,</li><li>      dependence, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="可选操作">可选操作<i class="anchor-icon anchor-icon-link" anchorid="可选操作" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="hsp与har中使用启动框架" class="firsth2">HSP与HAR中使用启动框架<i class="anchor-icon anchor-icon-link" anchorid="hsp与har中使用启动框架" tips="复制节点链接"></i></h3>          <p>通常大型应用会有多个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp">HSP</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package">HAR</a>，本节将提供一个应用示例，以展示如何在HSP包和HAR包中使用启动框架。该示例应用包括两个HSP包（hsp1、hsp2）和一个HAR包（har1），并且包含启动任务和so预加载任务。</p>     <p>开发步骤如下：</p>     <ol>      <li>       <p>除<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>外，在HSP包和HAR包的“resources/base/profile”目录下创建启动框架配置文件，不同模块可以使用相同文件名，本文以"startup_config.json"为例。</p></li>      <li>       <p>分别在各个模块的启动框架配置文件startup_config.json中， 添加对应的配置信息。</p>       <p>假设当前应用存在的启动任务与so预加载任务如下表所示。</p>       <p><strong>表4</strong> 应用启动任务与so预加载任务说明</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.14.4.2.4.1.4.1.1" valign="top" width="33.33333333333333%">模块</th>           <th align="left" class="cellrowborder" id="mcps1.3.14.4.2.4.1.4.1.2" valign="top" width="33.33333333333333%">启动任务</th>           <th align="left" class="cellrowborder" id="mcps1.3.14.4.2.4.1.4.1.3" valign="top" width="33.33333333333333%">so预加载任务</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">entry</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">HAP_Task_01</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">libentry_01</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">hsp1</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>HSP1_Task_01</p>            <p>HSP1_Task_02</p></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>libhsp1_01</p>            <p>libhsp1_02</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">hsp2</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">HSP2_Task_01</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">libhsp2_01</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">har</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">HAR1_Task_01</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">libhar1_01</td>          </tr>                 </tbody></table></div>       </div>       <p><strong>图4</strong> 启动任务与so预加载依赖关系图</p>       <p><span><img originheight="490" originwidth="452" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114855.48520687309315841599583242372897:50001231000000:2800:D898B71804AAE7B74F8F794DAEB8445123243BDEE2355C5A643EFB70DD3551BC.png" width="452" height="490"></span></p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>的startup_config.json可参考<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>，HSP与HAR的startup_config.json文件无法配置"configEntry"字段，以hsp1包配置文件为例，示例如下：</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HSP1_Task_01"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/HSP1_Task_01.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"HSP1_Task_02"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"HAR1_Task_01"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"appPreloadHintStartupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libhsp1_01"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libhsp1_01.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"libhsp1_02"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-string">"libhar1_01"</span></li><li>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>分别在各个模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>的appStartup标签中，添加启动框架配置文件的索引。</p>       <p>hsp1、hsp2以及har1的module.json5示例代码如下。</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hsp1"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shared"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"appStartup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:startup_config"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启动框架的配置文件</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hsp2"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"shared"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"appStartup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:startup_config"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启动框架的配置文件</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"har1"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"har"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"appStartup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:startup_config"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 启动框架的配置文件</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>     <p>其余步骤请参考<a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动参数">设置启动参数</a>和<a href="/consumer/cn/doc/harmonyos-guides/app-startup#为每个待初始化功能组件添加启动任务">为每个待初始化功能组件添加启动任务</a>章节进行配置。</p>    </div>    <div class="tiledSection">     <h3 id="修改启动模式">修改启动模式<i class="anchor-icon anchor-icon-link" anchorid="修改启动模式" tips="复制节点链接"></i></h3>          <p>AppStartup分别提供了自动和手动两种方式来执行启动任务，entry模块中默认采用自动模式，开发者可以根据需要修改为手动模式，HSP与HAR只能配置为手动模式。</p>     <ul>      <li>自动模式：当AbilityStage完成创建后，自动执行启动任务。</li>      <li>手动模式：在UIAbility完成创建后手动调用，来执行启动任务与so预加载任务。对于某些使用频率不高的模块，不需要应用最开始启动时就进行初始化。开发者可以选择将该部分启动任务修改为手动模式，在应用启动完成后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupmanager#startupmanagerrun" target="_blank">startupManager.run</a>方法来执行启动任务与so预加载任务。</li>     </ul>     <p>下面以UIAbility的onCreate生命周期中为例，介绍如何采用手动模式来启动任务，示例代码如下。</p>     <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span>, startupManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>    <span class="hljs-keyword">let</span> startParams = [<span class="hljs-string">'StartupTask_005'</span>, <span class="hljs-string">'StartupTask_006'</span>];</li><li>    <span class="hljs-keyword">try</span> {</li><li>      startupManager.<span class="hljs-title function_">run</span>(startParams).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`StartupTest startupManager run then, startParams = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(startParams)}</span>.`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`StartupTest promise catch error, error = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>.`</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`StartupTest promise catch error, startParams = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(startParams)}</span>.`</span>);</li><li>      })</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> errMsg = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> errCode = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Startup catch error, errCode= <span class="hljs-subst">${errCode}</span>.`</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Startup catch error, errMsg= <span class="hljs-subst">${errMsg}</span>.`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>     <p>开发者还可以在页面加载完成后，在页面中调用启动框架手动模式，示例代码如下。</p>     <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { startupManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"手动模式"</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">startParams1</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"StartupTask_006"</span>];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">startParams2</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"libentry_006"</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'AppStartup'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (!startupManager.<span class="hljs-title function_">isStartupTaskInitialized</span>(<span class="hljs-string">"StartupTask_006"</span>) ) { <span class="hljs-comment">// 判断是否已经完成初始化</span></li><li>            startupManager.<span class="hljs-title function_">run</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startParams1</span>)</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (!startupManager.<span class="hljs-title function_">isStartupTaskInitialized</span>(<span class="hljs-string">"libentry_006"</span>) ) {</li><li>            startupManager.<span class="hljs-title function_">run</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startParams2</span>)</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">alignRules</span>({</li><li>          <span class="hljs-attr">center</span>: {<span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>},</li><li>          <span class="hljs-attr">middle</span>: {<span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>}</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加任务匹配规则">添加任务匹配规则<i class="anchor-icon anchor-icon-link" anchorid="添加任务匹配规则" tips="复制节点链接"></i></h3>          <p>在通过卡片、通知、意图调用等方式拉起某个页面时，为了实现功能服务一步直达，可以通过添加matchRules匹配规则，仅加载与当前场景相关的部分启动任务，无需加载全部默认的自动启动任务，以提高启动性能。</p>     <p>可以通过以下两种方式添加匹配规则：</p>     <ul>      <li>       <p>通过matchRules中的uris、actions、insightIntents字段，根据UIAbility启动时的uri、action或意图名称，匹配不同场景启动任务及预加载so任务。</p></li>      <li>       <p>如果上述方式不能满足需求，可以通过matchRules中的customization自定义匹配规则。</p>       <p><strong>表5</strong> matchRules标签说明</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.16.4.2.3.1.6.1.1" valign="top" width="20%">属性名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.16.4.2.3.1.6.1.2" valign="top" width="20%">含义</th>           <th align="left" class="cellrowborder" id="mcps1.3.16.4.2.3.1.6.1.3" valign="top" width="20%">数据类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.16.4.2.3.1.6.1.4" valign="top" width="20%">是否可缺省</th>           <th align="left" class="cellrowborder" id="mcps1.3.16.4.2.3.1.6.1.5" valign="top" width="20%">适用场景</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="20%">uris</td>           <td class="cellrowborder" valign="top" width="20%">表示自动模式执行的任务的uri取值范围。当UIAbility启动时，会将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-want" target="_blank">Want</a>中携带的uri属性，与此处配置的uris数组取值进行匹配。格式为scheme://host/path，uri中的其它内容会被忽略（如port、fragment等）。</td>           <td class="cellrowborder" valign="top" width="20%">字符串数组</td>           <td class="cellrowborder" valign="top" width="20%">可缺省，缺省值为空。</td>           <td class="cellrowborder" valign="top" width="20%">通过特定uri拉起UIAbility的场景。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">actions</td>           <td class="cellrowborder" valign="top" width="20%">表示自动模式执行的任务的action取值范围。当UIAbility启动时，会将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-want" target="_blank">Want</a>中携带的action属性，与此处配置的actions数组取值进行匹配。</td>           <td class="cellrowborder" valign="top" width="20%">字符串数组</td>           <td class="cellrowborder" valign="top" width="20%">可缺省，缺省值为空。</td>           <td class="cellrowborder" valign="top" width="20%">通过特定action拉起UIAbility的场景。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">insightIntents</td>           <td class="cellrowborder" valign="top" width="20%">表示自动模式执行的任务的意图名称取值范围。当UIAbility启动时，会将意图名称与此处配置的insightIntents数组取值进行匹配。</td>           <td class="cellrowborder" valign="top" width="20%">字符串数组</td>           <td class="cellrowborder" valign="top" width="20%">可缺省，缺省值为空。</td>           <td class="cellrowborder" valign="top" width="20%">通过特定意图名称拉起UIAbility的场景。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">customization</td>           <td class="cellrowborder" valign="top" width="20%">            <p>表示自动模式执行的任务的自定义规则取值范围。通过实现StartupConfigEntry的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupconfigentry#onrequestcustommatchrule20" target="_blank">onRequestCustomMatchRule</a>接口返回自定义规则值。当UIAbility启动时，会将自定义规则值与此处配置的customization数组取值进行匹配。</p>            <p><strong>说明：</strong></p>            <p>仅支持startupTasks中的任务配置。</p></td>           <td class="cellrowborder" valign="top" width="20%">字符串数组</td>           <td class="cellrowborder" valign="top" width="20%">可缺省，缺省值为空。</td>           <td class="cellrowborder" valign="top" width="20%">如果使用uris、actions、insightIntents字段无法满足要求，可以使用customization自定义规则。</td>          </tr>                 </tbody></table></div>       </div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>uris、insightIntents、actions、customization任一属性匹配成功即为任务匹配成功。</li>          <li>匹配成功的任务及其依赖任务都将在自动模式执行。</li>          <li>所有任务均匹配失败，则按任务的excludeFromAutoStart配置处理。</li>         </ul>        </div></div></div></li>     </ul>     <p>下面以uri匹配（action和意图名称类似）和customization匹配来举例，介绍如何实现添加任务匹配规则来筛选启动任务。</p>     <p><strong>场景1：uri匹配</strong></p>     <p>假定需要用户点击通知消息跳转到通知详情页面时，仅自动执行StartupTask_004和libentry_006任务。若启动通知详情UIAbility时Want中的uri属性为test://com.example.startupdemo/notification，可以通过uri匹配。示例如下：</p>     <ol>      <li>       <p>对<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>步骤中的startup_config.json文件进行修改，增加StartupTask_004任务和libentry_006任务的matchRules配置。</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_004"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_004.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"matchRules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"uris"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"test://com.example.startupdemo/notification"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"appPreloadHintStartupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_006"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry_006.so"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"matchRules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"uris"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"test://com.example.startupdemo/notification"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>     <p><strong>场景2：customization匹配</strong></p>     <p>假定需要用户点击天气卡片跳转到天气界面时，仅自动执行StartupTask_006启动任务和excludeFromAutoStart=false配置的预加载so任务。若启动天气UIAbility时Want中传入的自定义参数fromType为card，可以通过customization匹配。示例如下：</p>     <ol>      <li>       <p>对<a href="/consumer/cn/doc/harmonyos-guides/app-startup#设置启动参数">设置启动参数</a>步骤中的MyStartupConfigEntry.ets文件进行修改，新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-appstartup-startupconfigentry#onrequestcustommatchrule20" target="_blank">onRequestCustomMatchRule</a>方法。</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StartupConfig</span>, <span class="hljs-title class_">StartupConfigEntry</span>, <span class="hljs-title class_">StartupListener</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStartupConfigEntry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">StartupConfigEntry</span> {</li><li>
</li><li>  <span class="hljs-comment">// onConfig ...</span></li><li>
</li><li>  <span class="hljs-title function_">onRequestCustomMatchRule</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">if</span> (want?.<span class="hljs-property">parameters</span>?.<span class="hljs-property">fromType</span> == <span class="hljs-string">'card'</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-string">'ruleCard'</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</li><li>  }</li><li>
</li><li>}</li></ol></pre></div></div></li>      <li>       <p>对<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>步骤中的startup_config.json文件进行修改，增加StartupTask_006任务的matchRules配置。预加载so任务不支持customization字段，按任务原有的excludeFromAutoStart配置处理。</p>       <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_006"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_006.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mainThread"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"excludeFromAutoStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"matchRules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"customization"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"ruleCard"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="设置启动任务调度阶段">设置启动任务调度阶段<i class="anchor-icon anchor-icon-link" anchorid="设置启动任务调度阶段" tips="复制节点链接"></i></h3>          <p>从API version 21开始，支持设置启动任务调度阶段。启动任务默认在AbilityStage模块加载后、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#oncreate" target="_blank">AbilityStage.onCreate</a>生命周期之前开始执行。对于大型应用，AbilityStage模块的加载可能耗时较长，开发者可以将启动任务的schedulerPhase字段配置为preAbilityStageLoad，使启动任务在AbilityStage模块加载前被调度，并在异步线程中与AbilityStage模块加载并发执行，从而缩短应用启动时间。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>由于启动任务在AbilityStage模块加载前被调度执行，改变了原有的执行顺序。如果启动任务依赖于AbilityStage模块的加载，可能会导致运行结果不符合预期，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-module-side-effects">模块加载副作用及优化</a>对依赖部分进行适配。</p>      </div></div></div>     <p>例如，应用首页需要通过网络请求获取Feed流数据，且希望该任务能在异步线程中与AbilityStage模块加载并发执行。假设网络请求任务为<a href="/consumer/cn/doc/harmonyos-guides/app-startup#定义启动任务配置">定义启动任务配置</a>步骤中的StartupTask_004，开发步骤如下：</p>     <ol>      <li>配置任务在AbilityStage模块加载前调度执行。在startup_config.json文件中，将StartupTask_004任务的schedulerPhase字段设为preAbilityStageLoad。</li>      <li>配置任务在异步线程中与AbilityStage模块加载并发执行。将StartupTask_004任务的runOnThread设为taskPool，waitOnMainThread设为false。</li>     </ol>     <div _ngcontent-jbu-c106="" class="highlight-div"><div _ngcontent-jbu-c106="" class="highlight-div-header"><div _ngcontent-jbu-c106="" class="highlight-div-header-left"><div _ngcontent-jbu-c106="" class="handle-button expand-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jbu-c106="" class="highlight-div-header-right"><div _ngcontent-jbu-c106="" class="handle-button ai-button"></div><div _ngcontent-jbu-c106="" class="handle-button line-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jbu-c106="" class="handle-button theme-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jbu-c106="" class="handle-button copy-button"><div _ngcontent-jbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jbu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"startupTasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"StartupTask_004"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupTask_004.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"runOnThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"taskPool"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"waitOnMainThread"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"schedulerPhase"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"preAbilityStageLoad"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"configEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/startup/StartupConfig.ets"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>   </div>   <div></div></div>