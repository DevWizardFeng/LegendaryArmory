<h1 _ngcontent-kdq-c119="" class="doc-title ng-star-inserted" title="应用布局适配智慧多窗"> 应用布局适配智慧多窗 </h1>

<div _ngcontent-kdq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1990231914451">应用布局适配智慧多窗的意义<i class="anchor-icon anchor-icon-link" anchorid="section1990231914451" tips="复制节点链接"></i></h2><p>由于应用从全屏进入智慧多窗（悬浮窗/分屏）模式后，窗口尺寸、宽高比例会发生变化，所以需要开发者适配应用窗口在不同尺寸、不同比例下的自适应布局，以确保应用窗口在各种形态下都能呈现出最佳的视觉效果，提供更好的用户体验。</p> </div> <div class="tiledSection"><h3 id="section118151423134611" class="firsth2">悬浮窗的比例<i class="anchor-icon anchor-icon-link" anchorid="section118151423134611" tips="复制节点链接"></i></h3><p>不同设备支持悬浮窗的比例如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.1.4.1.1" valign="top" width="33.33333333333333%"><p>设备</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.4.1.2" valign="top" width="33.33333333333333%"><p>竖向悬浮窗宽高比</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.4.1.3" valign="top" width="33.33333333333333%"><p>横向悬浮窗宽高比</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>手机</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>3:4.575</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>16:9</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>折叠屏手机展开态</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>9:16</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>16:9</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>顶部窗口控制条的避让区域不包含在应用布局区域内，窗口高度去除避让区域的32vp为应用布局区域的高度。</li><li>手机：悬浮窗模式下，应用窗口真实宽度为屏幕宽度。竖向时，高度根据宽高比3 : 4.575动态调整；横向时，高度根据宽高比16 : 9动态调整（该比例超出屏幕时，以当前全屏屏幕比例计算）。</li><li>折叠屏手机展开态：悬浮窗模式下，应用窗口真实宽度为折叠屏手机折叠态时的屏幕宽度。竖向时，高度根据宽高比9 : 16动态调整；横向时，高度根据宽高比16 : 9动态调整。</li></ul> </div></div></div> </div> <div class="tiledSection"><h3 id="section4402545164612">分屏的比例<i class="anchor-icon anchor-icon-link" anchorid="section4402545164612" tips="复制节点链接"></i></h3><p>目前支持两种分屏样式：“上下分屏”和“左右分屏”。</p> <p><span><img height="270.3225" originheight="3351" originwidth="6480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114917.63025998915902892742022295474148:50001231000000:2800:94E92EC15F8D207BF4CA60417C494CEBAC1E873D03ED533F5EAE0B3AD7DD9845.jpg" title="点击放大" width="523.6875"></span></p> <p>分屏比例指的是分屏下两应用间尺寸的比例，调整分屏比例会调整应用窗口的大小。</p> <p>默认形成分屏后分屏比例为1:1，拖动中间的分屏条可以改变分屏比例档位。手机“上下分屏”可调节档位1:2、1:1、2:1，“左右分屏”可调节档位为1:1。手机折叠屏展开态可调节档位只有1:1。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.1" valign="top" width="30.72%"><p>设备</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.2" valign="top" width="33.589999999999996%"><p>默认分屏比例</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.3" valign="top" width="35.69%"><p>分屏可调节档位</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="30.72%"><p>手机</p> </td> <td class="cellrowborder" valign="top" width="33.589999999999996%"><p>1:1</p> </td> <td class="cellrowborder" valign="top" width="35.69%"><p>“上下分屏”: 1:1, 1:2, 2:1</p> <p>“左右分屏”: 1:1</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="30.72%"><p>手机折叠屏展开态</p> </td> <td class="cellrowborder" valign="top" width="33.589999999999996%"><p>1:1</p> </td> <td class="cellrowborder" valign="top" width="35.69%"><p>“上下分屏”和 “左右分屏”: 1:1</p> </td> </tr>  </tbody></table></div> </div> <p>应用布局可以通过自适应布局和响应式布局来更新自身布局，避免出现截断、挤压、堆叠等现象。</p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout" target="_blank">自适应布局</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout" target="_blank">响应式布局</a></li></ul> </div> <div class="tiledSection"><h2 id="section185481329133318">应用布局适配智慧多窗的方案<i class="anchor-icon anchor-icon-link" anchorid="section185481329133318" tips="复制节点链接"></i></h2><p>无论是悬浮窗还是分屏，当应用进入智慧多窗模式时，应用的窗口尺寸发生变化，所以应用需要根据不同的窗口尺寸调整自身布局。</p> <p>主要可以通过窗口的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowsizechange7" target="_blank">on('windowSizeChange')</a>方法实现对窗口尺寸大小变化的监听。再根据窗口的尺寸变化，更新调整自身应用布局以实现适配。</p> </div> <p>主要步骤和示例如下：</p> <ol><li><span>在onWindowStageCreate方法中，获取Window对象。</span></li><li><span>通过getWindowProperties方法返回值中的windowRect获取窗口尺寸，写入AppStorage中用于UI侧窗口尺寸的首次初始化赋值。</span></li><li><span>使用on('windowSizeChange')注册窗口尺寸变化时的监听，并写入AppStorage中供UI侧布局使用。</span></li><li><span>UI侧通过@StorageLink绑定窗口尺寸后，AppStorage中属性key值对应的数据一旦改变，UI侧会同步修改。</span></li><li><span>@StorageLink装饰的数据本身是状态变量，所以窗口尺寸发生变化时，会引起组件的重新渲染，开发者可以根据最新的窗口尺寸动态调整应用布局。</span></li></ol> <div _ngcontent-kdq-c106="" class="highlight-div"><div _ngcontent-kdq-c106="" class="highlight-div-header"><div _ngcontent-kdq-c106="" class="highlight-div-header-left"><div _ngcontent-kdq-c106="" class="handle-button expand-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kdq-c106="" class="highlight-div-header-right"><div _ngcontent-kdq-c106="" class="handle-button ai-button"></div><div _ngcontent-kdq-c106="" class="handle-button line-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kdq-c106="" class="handle-button theme-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kdq-c106="" class="handle-button copy-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kdq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onWindowStageCreate.'</span>);</li><li>    windowStage.<span class="hljs-title function_">getMainWindow</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowClass</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 获取窗口尺寸，存入AppStorage</span></li><li>      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'winWidth'</span>, windowClass.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">windowRect</span>.<span class="hljs-property">width</span>);</li><li>      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'winHeight'</span>, windowClass.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">windowRect</span>.<span class="hljs-property">height</span>);</li><li>      <span class="hljs-comment">// 监听窗口尺寸变化</span></li><li>      windowClass.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-function">(<span class="hljs-params">windowSize</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'winWidth'</span>, windowSize.<span class="hljs-property">width</span>);</li><li>        <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'winHeight'</span>, windowSize.<span class="hljs-property">height</span>);</li><li>      });</li><li>    });</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load the content. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in loading the content.'</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> <div _ngcontent-kdq-c106="" class="highlight-div"><div _ngcontent-kdq-c106="" class="highlight-div-header"><div _ngcontent-kdq-c106="" class="highlight-div-header-left"><div _ngcontent-kdq-c106="" class="handle-button expand-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kdq-c106="" class="highlight-div-header-right"><div _ngcontent-kdq-c106="" class="handle-button ai-button"></div><div _ngcontent-kdq-c106="" class="handle-button line-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kdq-c106="" class="handle-button theme-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kdq-c106="" class="handle-button copy-button"><div _ngcontent-kdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kdq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-comment">// 初始化参数，这里会初始化为AppStorage中存储的值</span></li><li>  <span class="hljs-variable">@StorageLink</span>(<span class="hljs-string">'winWidth'</span>) <span class="hljs-attribute">winWidth</span>: number = <span class="hljs-number">1260</span>;</li><li>  <span class="hljs-variable">@StorageLink</span>(<span class="hljs-string">'winHeight'</span>) <span class="hljs-attribute">winHeight</span>: number = <span class="hljs-number">2224</span>;</li><li>
</li><li>  <span class="hljs-selector-tag">aboutToAppear</span>() {</li><li>    <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">'Current window size. width: '</span> + this.winWidth + <span class="hljs-string">', height: '</span> + this.winHeight);</li><li>  }</li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>() {</li><li>      <span class="hljs-comment">// 根据winWidth、winHeight动态调整应用布局</span></li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-built_in">size</span>({</li><li>      <span class="hljs-attribute">width</span>: this.<span class="hljs-built_in">getUIContext</span>().<span class="hljs-built_in">px2vp</span>(this.winWidth),</li><li>      <span class="hljs-attribute">height</span>: this.<span class="hljs-built_in">getUIContext</span>().<span class="hljs-built_in">px2vp</span>(this.winHeight)</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div></div></div>