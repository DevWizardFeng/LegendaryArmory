<h1 _ngcontent-bit-c119="" class="doc-title ng-star-inserted" title="应用接入AVSession场景介绍"> 应用接入AVSession场景介绍 </h1>

<div _ngcontent-bit-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>音视频应用在实现音视频功能的同时，需要接入媒体会话即AVSession Kit，下文将提供一些典型的接入AVSession的展示和控制场景，方便开发者根据场景进行适配。</p>    <p>对于不同的场景，将会在系统的播控中心看到不同的UI呈现。同时，在不同的场景下，应用的接入处理也需要遵循不同的规范约束。</p>    <div class="tiledSection">     <h2 id="哪些场景下需要接入avsession">哪些场景下需要接入AVSession<i class="anchor-icon anchor-icon-link" anchorid="哪些场景下需要接入avsession" tips="复制节点链接"></i></h2>          <p>AVSession会对后台的音频播放、VOIP通话做约束，所以通常来说，长音频应用、听书类应用、长视频应用、VOIP类应用等都需要接入AVSession。当应用在没有创建接入AVSession的情况下进行了上述业务，那么系统会在检测到应用后台时，停止对应的音频播放，静音通话声音，以达到约束应用行为的目的。这种约束，应用上架前在本地就可以验证。</p>     <p>对于其他使用到音频播放的应用，比如游戏、直播等场景，接入AVSession只是可选，取决于应用是否有后台播放的使用诉求。若应用需要后台播放，那么接入AVSession仍然是必须的，否则业务的正常功能会受到限制。</p>     <p>当应用需要实现后台播放等功能时，需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/background-task-overview">BackgroundTasks Kit</a>（后台任务管理）的能力，申请对应的长时任务，避免进入挂起（Suspend）状态。</p>    </div>    <div class="tiledSection">     <h2 id="接入流程">接入流程<i class="anchor-icon anchor-icon-link" anchorid="接入流程" tips="复制节点链接"></i></h2>          <p>应用接入AVSession流程分为如下几个步骤：</p>     <ol>      <li>确定应用需要创建的会话类型，<a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#创建不同类型的会话">创建对应的会话</a>，不同类型决定了播控中心展示的控制模板样式。</li>      <li>按需<a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#创建后台任务">创建后台任务</a>。</li>      <li><a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#设置元数据">设置必要的元数据（Metadata）</a>，以在播控中心展示相应的信息，包括不限于：当前媒体的ID（assetId），上一首媒体的ID（previousAssetId），下一首媒体的ID（nextAssetId），标题（title），专辑作者（author），专辑名称（album），词作者（writer），媒体时长（duration）等属性。</li>      <li><a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#设置播放状态">设置播放相关的状态</a>，包括不限于：当前媒体的播放状态（state）、播放位置（position）、播放倍速（speed）、缓冲时间（bufferedTime）、循环模式（loopMode）、是否收藏（isFavorite）、正在播放的媒体Id（activeItemId）、自定义媒体数据（extras）等属性。</li>      <li>按需<a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#注册控制命令">注册不同的控制命令</a>，包括不限于：播放/暂停、上下一首、快进快退、收藏、循环模式、进度条。</li>      <li>应用退出或者无对应业务时，注销会话。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="创建不同类型的会话">创建不同类型的会话<i class="anchor-icon anchor-icon-link" anchorid="创建不同类型的会话" tips="复制节点链接"></i></h2>          <p>AVSession在构造方法中支持不同的类型参数，由 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-t#avsessiontype10" target="_blank">AVSessionType</a> 定义，不同的类型代表了不同场景的控制能力，对于播控中心来说，会展示不同的控制模版。</p>     <ul>      <li>       <p>audio类型，播控中心的控制样式为：收藏，上一首，播放/暂停，下一首，循环模式。</p></li>      <li>       <p>video类型，播控中心的控制样式为：快退，上一首，播放/暂停，下一首，快进。</p></li>      <li>       <p>voice_call类型，通话类型。</p></li>     </ul>     <p>使用代码示例：</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>以下示例代码仅展示创建AVSession对象的接口调用，应用在真正使用时，需要确保AVSession对象实例在应用后台播放业务活动期间一直存在，避免被系统回收、释放，导致后台发声时被系统管控。</p>      </div></div></div>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-comment">// 开始创建并激活媒体会话。</span></li><li>          <span class="hljs-comment">// 创建session。</span></li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>          <span class="hljs-comment">// 激活接口要在元数据、控制命令注册完成之后再执行。</span></li><li>          <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">activate</span>();</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`session create done : sessionId : <span class="hljs-subst">${session.sessionId}</span>`</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="创建后台任务">创建后台任务<i class="anchor-icon anchor-icon-link" anchorid="创建后台任务" tips="复制节点链接"></i></h2>          <p>当应用需要实现后台播放等功能时，需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/background-task-overview">BackgroundTasks Kit</a>（后台任务管理）的能力，申请对应的长时任务，避免进入挂起（Suspend）状态。</p>     <p>对媒体类播放来说，需要申请<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundmode" target="_blank">AUDIO_PLAYBACK BackgroundMode</a>的长时任务。</p>    </div>    <div class="tiledSection">     <h2 id="设置元数据">设置元数据<i class="anchor-icon anchor-icon-link" anchorid="设置元数据" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="通用元数据" class="firsth2">通用元数据<i class="anchor-icon anchor-icon-link" anchorid="通用元数据" tips="复制节点链接"></i></h3>          <p>应用可以通过setAVMetadata把会话的一些元数据信息设置给系统，从而在播控中心界面进行展示，包括不限制：当前媒体的ID（assetId），上一首媒体的ID（previousAssetId），下一首媒体的ID（nextAssetId），标题（title），专辑作者（author），专辑名称（album），词作者（writer），媒体时长（duration）等。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>            <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>            <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-string">'audio'</span>);</li><li>            <span class="hljs-comment">// 设置必要的媒体信息。</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>              <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-comment">// 由应用指定，用于标识应用媒体库里的媒体。</span></li><li>              <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>              <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>              <span class="hljs-attr">artist</span>: <span class="hljs-string">'ARTIST'</span>,</li><li>            };</li><li>            session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            });</li><li>          } <span class="hljs-keyword">catch</span> (err) {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`AVSession create Error: Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            }</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="歌词">歌词<i class="anchor-icon anchor-icon-link" anchorid="歌词" tips="复制节点链接"></i></h3>          <p>对于长音频来说，播控中心提供了歌词的展示页面，对于应用来说，接入也比较简单，只需要把歌词内容设置给系统。播控中心会解析歌词内容，并根据播放进度进行同步的刷新。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 把歌词信息设置给AVSession。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>            <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>,</li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>            <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>            <span class="hljs-comment">// LRC中有两类元素：一种是时间标签+歌词，一种是ID标签。</span></li><li>            <span class="hljs-comment">// 例如：[00:25.44]xxx\r\n[00:26.44]xxx\r\n。</span></li><li>            <span class="hljs-attr">lyric</span>: <span class="hljs-string">"lrc格式歌词内容"</span>,</li><li>            <span class="hljs-comment">// singleLyricText字段存储单条歌词文本，不包含时间戳。</span></li><li>            <span class="hljs-comment">// 例如："单条歌词内容"。</span></li><li>            <span class="hljs-attr">singleLyricText</span>: <span class="hljs-string">"单条歌词内容"</span>,</li><li>          };</li><li>          session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="历史歌单">历史歌单<i class="anchor-icon anchor-icon-link" anchorid="历史歌单" tips="复制节点链接"></i></h3>          <p>针对音乐/听书类应用，播控中心提供一系列快捷播放能力，包括一键启动冷启动续播、以及历史歌单功能，其中歌单功能中支持显示的音频媒体内容有：音乐歌单、有声书专辑、播客专辑等。视频媒体内容、直播类媒体内容暂不支持歌单。应用在端侧注册并适配后台启动模式的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-habit-rec-access-programme" target="_blank">播放意图</a>，即可实现接入上述功能。接入后的体验自检，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/quick-playback" target="_blank">快捷播放</a>。</p>     <p>开发者可参考下述示例，完成注册播放意图、设置歌单信息、实现意图启动播放。</p>     <p><strong>注册播放意图</strong></p>     <p>应用按照播放业务，选择PlayMusicList意图（音乐类应用）或者PlayAudio意图（听书类应用）其一注册。编辑对应的意图配置PROJECT_HOME/entry/src/main/resources/base/profile/insight_intent.json文件，实现播放意图注册。</p>     <p>注册示例如下：</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-comment">// 应用支持的意图列表</span></li><li>  <span class="hljs-string">"insightIntents"</span>: [</li><li>    {</li><li>      <span class="hljs-comment">// 意图名称</span></li><li>      <span class="hljs-comment">// 名称应当遵循意图框架规范，当前仅支持预置垂域意图，不允许自定义</span></li><li>      <span class="hljs-comment">// 应用内意图名称唯一，不允许出现相同的名称定义</span></li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayMusicList"</span>, <span class="hljs-comment">// 音乐类PlayMusicList，听书或有声书类PlayAudio</span></li><li>      <span class="hljs-comment">// 意图所属的垂域</span></li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">"MusicDomain"</span>, <span class="hljs-comment">// 音乐类MusicDomain，听书或有声书类AudioDomain</span></li><li>      <span class="hljs-comment">// 意图版本号</span></li><li>      <span class="hljs-comment">// 插件引用意图时会校验该版本号，只有和插件定义的版本号一致才能正常调用</span></li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.1"</span>,</li><li>      <span class="hljs-comment">// 意图调用代码逻辑入口</span></li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-comment">// 意图所在module、ability，以及代码相对路径入口</span></li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// UIAbility支持前后台两种执行模式</span></li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span>, <span class="hljs-comment">// 播控一键冷启动、历史歌单功能需要应用支持意图后台启动</span></li><li>          <span class="hljs-string">"foreground"</span></li><li>        ]</li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div>     <p><strong>设置歌单信息</strong></p>     <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-avsession#setavmetadata10" target="_blank">setAVMetadata</a>接口设置当前播放的歌单（专辑）信息，歌单（专辑）信息由下面几个字段组成：</p>     <ul>      <li>avQueueName: 歌单的名称，接入歌单必选</li>      <li>avQueueId: 歌单的唯一标识id，接入歌单必选</li>      <li>avQueueImage: 歌单的图片资源，接入歌单必选</li>     </ul>     <p>系统媒体信息根据应用上报实时刷新，若应用接入歌单功能，则确保在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-i#avmetadata10" target="_blank">AVMetadata</a>中一直携带歌单数据。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li> </li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>);</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setListener</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>  <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>  <span class="hljs-comment">// 将歌单信息设置给AVSession</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>  <span class="hljs-comment">// 下面内容均由应用设置</span></li><li>  <span class="hljs-attr">assetId</span>: <span class="hljs-string">'musicid123'</span>,</li><li>  <span class="hljs-attr">avQueueName</span>: <span class="hljs-string">'myQueue'</span>,</li><li>  <span class="hljs-attr">avQueueId</span>: <span class="hljs-string">'myQueue123'</span>,</li><li>  <span class="hljs-attr">avQueueImage</span>: <span class="hljs-string">"PIXELMAP_OBJECT"</span>,</li><li>  };</li><li>  session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  });</li><li>  <span class="hljs-comment">// 上报播放状态，参考播放状态</span></li><li>}</li></ol></pre></div></div>     <p><strong>实现意图启动播放</strong></p>     <p>当应用接入歌单功能后，用户在系统播控中心界面可以播放应用的歌单，也可以在应用进程释放后，通过系统播控中心再次冷启动应用后台播放。</p>     <ul>      <li>用户触发歌单播放时，系统会将歌单的唯一标识id传回应用，应用可以在意图调用接口中，通过解析意图参数(intentParam)中的entityId，获取到歌单的id，实现对应歌单的播放。</li>      <li>用户触发播控冷启动播放时，系统会在意图参数(intentParam)的包含空歌单id，即解析出得的entityId为空字符串，<strong>由应用来决定播放内容</strong>，可以实现为续播上一次的播放内容。</li>      <li><strong>系统会在后台冷启动应用的播放，需要在播放前先设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-i#avmetadata10" target="_blank">AVMetadata</a>，注册<a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#注册控制命令">播控控制回调</a>，并申请播音长时任务。</strong></li>     </ul>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent, <span class="hljs-title class_">InsightIntentExecutor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 意图调用样例</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsightIntentExecutorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InsightIntentExecutor</span> {</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * override 执行后台启动UIAbility意图</span></li><li><span class="hljs-comment">     *</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> intentName 意图名称</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> intentParam 意图参数</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@returns</span> 意图调用结果</span></li><li><span class="hljs-comment">     */</span></li><li>    <span class="hljs-keyword">async</span> <span class="hljs-title function_">onExecuteInUIAbilityBackgroundMode</span>(<span class="hljs-attr">intentName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">intentParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;):</li><li>      <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>      <span class="hljs-comment">// 根据意图名称分发处理逻辑</span></li><li>      <span class="hljs-keyword">switch</span> (intentName) {</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'PlayMusicList'</span>:</li><li>          <span class="hljs-comment">// PlayMusicList参照如下解析方式</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">entityId</span>: <span class="hljs-built_in">string</span> = (intentParam.<span class="hljs-property">items</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">object</span>&gt;)?.[<span class="hljs-number">0</span>]?.[<span class="hljs-string">'entityId'</span>];</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">playFunc</span>(entityId);</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'PlayAudio'</span>:</li><li>          <span class="hljs-comment">// PlayAudio参照如下解析方式</span></li><li>          <span class="hljs-keyword">let</span> data = intentParam <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">playFunc</span>(data.<span class="hljs-property">entityId</span>);</li><li>        <span class="hljs-attr">default</span>:</li><li>          <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({</li><li>        <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'unknown intent'</span></li><li>        }</li><li>      } <span class="hljs-keyword">as</span> insightIntent.<span class="hljs-property">ExecuteResult</span>)</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * 实现调用播放功能</span></li><li><span class="hljs-comment">     *</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> entityId 播放内容id</span></li><li><span class="hljs-comment">     */</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">playFunc</span>(<span class="hljs-attr">entityId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>      <span class="hljs-comment">// entityId 不为空，表示用户指定内容（歌单/专辑）播放</span></li><li>      <span class="hljs-comment">// entityId 为空（entityId.length == 0），由应用自行决定播放内容，续播历史内容或者是推荐内容</span></li><li>      <span class="hljs-comment">// 此时是后台拉起应用播放，除了初始化播放资源，还需要设置AVMetadata，注册播控控制回调，并申请播音长时任务</span></li><li>      <span class="hljs-comment">// TODO 实现具体的播放业务</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({</li><li>        <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'Intent execute succeed'</span></li><li>        }</li><li>      } <span class="hljs-keyword">as</span> insightIntent.<span class="hljs-property">ExecuteResult</span>)</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="媒体资源金标">媒体资源金标<i class="anchor-icon anchor-icon-link" anchorid="媒体资源金标" tips="复制节点链接"></i></h3>          <p>对于长音频，播控中心提供了媒体资源金标（即应用媒体音频音源的标识）的展示，目前只支持展示Audio Vivid标识。</p>     <p>对于应用来说，接入只需要在AVMetadata中通知系统，当前播放音频的音源标识，播控就会同步展示。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 把媒体音源信息设置给AVSession。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>            <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>,</li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>            <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>            <span class="hljs-comment">// 标识该媒体音源是Audio Vivid。</span></li><li>            <span class="hljs-attr">displayTags</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">DisplayTag</span>.<span class="hljs-property">TAG_AUDIO_VIVID</span>,</li><li>          };</li><li>          session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置播放状态">设置播放状态<i class="anchor-icon anchor-icon-link" anchorid="设置播放状态" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="通用播放状态" class="firsth2">通用播放状态<i class="anchor-icon anchor-icon-link" anchorid="通用播放状态" tips="复制节点链接"></i></h3>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-avsession#setavplaybackstate10" target="_blank">setAVPlaybackState</a>。把当前的播放状态设置给系统，以在播控中心界面进行展示。</p>     <p>播放状态一般是在资源播放后会进行变化的内容，包括：当前媒体的播放状态（state）、播放位置（position）、播放倍速（speed）、缓冲时间（bufferedTime）、循环模式（loopMode）、是否收藏（isFavorite）、正在播放的媒体Id（activeItemId）、自定义媒体数据（extras）等。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-string">'audio'</span>);</li><li>
</li><li>          <span class="hljs-comment">// 播放器逻辑··· 引发媒体信息与播放状态的变更。</span></li><li>          <span class="hljs-comment">// 简单设置一个播放状态 - 暂停 未收藏。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">playbackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>            <span class="hljs-attr">state</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_PAUSE</span>,</li><li>            <span class="hljs-attr">isFavorite</span>: <span class="hljs-literal">false</span></li><li>          };</li><li>          session.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVPlaybackState successfully`</span>);</li><li>            }</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="进度条">进度条<i class="anchor-icon anchor-icon-link" anchorid="进度条" tips="复制节点链接"></i></h3>          <p>应用如果支持在播控中心展示进度，那么在媒体资源播放中，需要设置资源的时长、播放状态（暂停、播放）、播放位置、倍速，播控中心会使用这些信息进行进度的展示：</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 设置媒体资源时长。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>            <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>,</li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>            <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>            <span class="hljs-attr">duration</span>: <span class="hljs-number">23000</span>, <span class="hljs-comment">// 资源的时长，以ms为单位。</span></li><li>          };</li><li>          session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>
</li><li>          <span class="hljs-comment">// 设置状态： 播放状态，进度位置，播放倍速，缓存的时间。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">playbackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>            <span class="hljs-attr">state</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_PLAY</span>, <span class="hljs-comment">// 播放状态。</span></li><li>            <span class="hljs-attr">position</span>: {</li><li>              <span class="hljs-attr">elapsedTime</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 已经播放的位置，以ms为单位。</span></li><li>              <span class="hljs-attr">updateTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>(), <span class="hljs-comment">// 应用更新当前位置时的时间戳，以ms为单位。</span></li><li>            },</li><li>            <span class="hljs-attr">speed</span>: <span class="hljs-number">1.0</span>, <span class="hljs-comment">// 可选，默认是1.0，播放的倍速，按照应用内支持的speed进行设置，系统不做校验。</span></li><li>            <span class="hljs-attr">bufferedTime</span>: <span class="hljs-number">14000</span>, <span class="hljs-comment">// 可选，资源缓存的时间，以ms为单位。</span></li><li>          };</li><li>          session.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVPlaybackState successfully`</span>);</li><li>            }</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>系统的播控中心会根据应用设置的信息自行进行播放进度的计算，而不需要应用实时更新播放进度；</p>     <p>但是应用需要如下状态发生变化的时候，再更新AVPlaybackState，否则系统会发生计算错误：</p>     <ul>      <li>state</li>      <li>position</li>      <li>speed</li>     </ul>     <p>应用在真实播放开始时，再上报进度起始position；若播放存在buffer状态，可以先上报播放状态为AVSessionManager.PlaybackState.PLAYBACK_STATE_BUFFERING，来通知系统不刷新进度。</p>     <p>关于进度条有一些特殊情况需要处理：</p>     <ol>      <li>       <p>歌曲支持试听</p>       <p>（1）应用不需要设置完整的歌曲时长，则只需要设置歌曲的试听时长。当应用仅设置歌曲的试听时长而不是完整时长，用户在播控中心触发进度控制时，应用收到的时长也是VIP试听时长内的相对时间戳位置，而不是完整歌曲的绝对时间戳位置，应用需要重新计算歌曲从零开始的绝对时间戳进行实际响应处理。</p>       <p>（2）如果应用设置完整歌曲时长，但需要系统支持试听片段，也可以在播放时上报起始进度position，当收到的seek指令超过试听片段时，上报试听截止position，系统播控的进度会跟随回弹。</p></li>      <li>       <p>歌曲不支持试听</p>       <p>如果歌曲不支持试听，那么理论上应用内也不支持播放，这时可以把 duration 设置为 -1，以通知系统不显示实际的时长。</p></li>      <li>       <p>广告等内容的时长设置</p>       <p>对于有前贴广告、后贴广告的资源来说，建议这么处理：</p>       <ul>        <li>播放广告时，单独设置广告的时长 duration。</li>        <li>当进入到正片播放的时候，则重新设置一次新的时长，以与广告进行区分。</li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="注册控制命令">注册控制命令<i class="anchor-icon anchor-icon-link" anchorid="注册控制命令" tips="复制节点链接"></i></h2>          <p>应用接入AVSession，可以通过注册不同的控制命令来实现播控中心界面上的控制操作，即通过on接口注册不同的控制命令参数，即可实现对应的功能。</p>     <p>具体的接口参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-avsession#onplay10" target="_blank">接口注册</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>创建AVSession后，请先注册应用支持的控制命令，再激活 Session。</p>      </div></div></div>     <p>媒体资源支持的控制命令列表：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.3.1.1" valign="top" width="50%">控制命令</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.3.1.2" valign="top" width="50%">功能说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">play</td>         <td class="cellrowborder" valign="top" width="50%">播放命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">pause</td>         <td class="cellrowborder" valign="top" width="50%">暂停命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">stop</td>         <td class="cellrowborder" valign="top" width="50%">停止命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">playNext</td>         <td class="cellrowborder" valign="top" width="50%">播放下一首命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">playPrevious</td>         <td class="cellrowborder" valign="top" width="50%">播放上一首命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">fastForward</td>         <td class="cellrowborder" valign="top" width="50%">快进命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">rewind</td>         <td class="cellrowborder" valign="top" width="50%">快退命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">playFromAssetId</td>         <td class="cellrowborder" valign="top" width="50%">根据某个资源id进行播放命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">seek</td>         <td class="cellrowborder" valign="top" width="50%">跳转命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setSpeed</td>         <td class="cellrowborder" valign="top" width="50%">设置播放速率命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setLoopMode</td>         <td class="cellrowborder" valign="top" width="50%">设置循环模式命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">toggleFavorite</td>         <td class="cellrowborder" valign="top" width="50%">设置是否收藏命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">skipToQueueItem</td>         <td class="cellrowborder" valign="top" width="50%">设置播放列表其中某项被选中播放的命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">handleKeyEvent</td>         <td class="cellrowborder" valign="top" width="50%">设置按键事件的命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">commonCommand</td>         <td class="cellrowborder" valign="top" width="50%">设置自定义控制命令。</td>        </tr>             </tbody></table></div>     </div>     <p>通话类应用支持的控制：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.3.1.1" valign="top" width="50%">控制命令</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.3.1.2" valign="top" width="50%">功能说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">answer</td>         <td class="cellrowborder" valign="top" width="50%">接听电话的命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">hangUp</td>         <td class="cellrowborder" valign="top" width="50%">通话挂断的命令。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">toggleCallMute</td>         <td class="cellrowborder" valign="top" width="50%">通话静音或解除静音的命令。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="不支持命令的处理" class="firsth2">不支持命令的处理<i class="anchor-icon anchor-icon-link" anchorid="不支持命令的处理" tips="复制节点链接"></i></h3>          <p>系统支持的控制命令对于不支持的控制，比如应用不支持“上一首”的命令处理，只需要使用off 接口注销对应的控制命令，系统的播控中心会相应的对该控制界面进行置灰处理，以明确告知用户此控制命令不支持。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 取消指定session下的相关监听。</span></li><li>          session.<span class="hljs-title function_">off</span>(<span class="hljs-string">'play'</span>);</li><li>          session.<span class="hljs-title function_">off</span>(<span class="hljs-string">'pause'</span>);</li><li>          session.<span class="hljs-title function_">off</span>(<span class="hljs-string">'stop'</span>);</li><li>          session.<span class="hljs-title function_">off</span>(<span class="hljs-string">'playNext'</span>);</li><li>          session.<span class="hljs-title function_">off</span>(<span class="hljs-string">'playPrevious'</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="快进快退">快进快退<i class="anchor-icon anchor-icon-link" anchorid="快进快退" tips="复制节点链接"></i></h3>          <p>系统支持三种快进/快退的时长，应用可以通过接口进行设置；同时注册快进/快退的回调命令，以响应控制。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>应用注册快进/快退及上/下一首资源切换的命令时，在播控中心的显示存在实际差异。</p>      </div></div></div>     <ul>      <li>       <p><strong>当AVSessionType是audio时：</strong></p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.2.1.4.1.1" valign="top" width="33.33333333333333%">应用注册的事件组合</th>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.2.1.4.1.2" valign="top" width="33.33333333333333%">播放中心显示按钮</th>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.2.1.4.1.3" valign="top" width="33.33333333333333%">按钮是否可用</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">未注册任何事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“上一首”、“下一首”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">所有按钮置灰，无法点击。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册上一首/下一首事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“上一首”、“下一首”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>注册上一首事件 →“上一首”按钮可用。</p>            <p>注册下一首事件 →“下一首”按钮可用。</p>            <p>未注册对应事件的按钮不可用。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册快进/快退事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“上一首”、“下一首”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">所有按钮置灰，无法点击。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册上一首/下一首及快进/快退事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“上一首”、“下一首”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>注册上一首事件 →“上一首”按钮可用。</p>            <p>注册下一首事件 →“下一首”按钮可用。</p>            <p>未注册对应事件的按钮不可用。</p></td>          </tr>                 </tbody></table></div>       </div></li>      <li>       <p><strong>当AVSessionType是video时：</strong></p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.2.2.1.4.1.1" valign="top" width="33.33333333333333%">应用注册的事件组合</th>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.2.2.1.4.1.2" valign="top" width="33.33333333333333%">播放中心显示按钮</th>           <th align="left" class="cellrowborder" id="mcps1.3.17.4.2.2.1.4.1.3" valign="top" width="33.33333333333333%">按钮是否可用</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">未注册任何事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“快进”、“快退”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">所有按钮置灰，无法点击。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册上一首/下一首事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“上一首”、“下一首”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>注册上一首事件 →“上一首”按钮可用。</p>            <p>注册下一首事件 →“下一首”按钮可用。</p>            <p>未注册对应事件的按钮不可用。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册快进/快退事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“快进”、“快退”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>注册快进事件 →“快进”按钮可用。</p>            <p>注册快退事件 →“快退”按钮可用。</p>            <p>未注册对应事件的按钮不可用。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">注册上一首/下一首及快进/快退事件</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">“快进”、“快退”</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>注册快进事件 →“快进”按钮可用。</p>            <p>注册快退事件 →“快退”按钮可用。</p>            <p>未注册对应事件的按钮不可用。</p></td>          </tr>                 </tbody></table></div>       </div>       <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 设置支持的快进快退的时长设置给AVSession。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>            <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-comment">// 由应用指定，用于标识应用媒体库里的媒体。</span></li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>            <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>            <span class="hljs-attr">skipIntervals</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">SkipIntervals</span>.<span class="hljs-property">SECONDS_10</span>,</li><li>          };</li><li>          session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>
</li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'fastForward'</span>, <span class="hljs-function">(<span class="hljs-params">time ?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on fastForward , do fastForward task`</span>);</li><li>            <span class="hljs-comment">// do some tasks ···</span></li><li>          });</li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'rewind'</span>, <span class="hljs-function">(<span class="hljs-params">time ?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on rewind , do rewind task`</span>);</li><li>            <span class="hljs-comment">// do some tasks ···</span></li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="收藏">收藏<i class="anchor-icon anchor-icon-link" anchorid="收藏" tips="复制节点链接"></i></h3>          <p>音乐类应用实现收藏功能，那么需要注册收藏的控制响应<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-avsession#ontogglefavorite10" target="_blank">on('toggleFavorite')</a>。</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'toggleFavorite'</span>, <span class="hljs-function">(<span class="hljs-params">assetId</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on toggleFavorite `</span>);</li><li>            <span class="hljs-comment">// 应用收到收藏命令，进行收藏处理。</span></li><li>
</li><li>            <span class="hljs-comment">// 应用内完成或者取消收藏，把新的收藏状态设置给AVSession。</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">playbackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>              <span class="hljs-attr">isFavorite</span>: <span class="hljs-literal">true</span>,</li><li>            };</li><li>            session.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVPlaybackState successfully`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`SetAVPlaybackState BusinessError: code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            });</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="循环模式">循环模式<i class="anchor-icon anchor-icon-link" anchorid="循环模式" tips="复制节点链接"></i></h3>          <p>针对音乐类应用，系统的播控中心界面会默认展示循环模式的控制操作，目前系统支持四种固定的循环模式控制，参考: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-e#loopmode10" target="_blank">LoopMode</a>。</p>     <p>播控中心支持固定的四种循环模式的切换，即： 随机播放、顺序播放、单曲循环、列表循环。应用收到循环模式切换的指令并切换后，需要向系统上报切换后的LoopMode。</p>     <p>若应用内支持的LoopMode不在系统固定的四个循环模式内，需要选择四个固定循环模式其一向系统上报，由应用自定。</p>     <p>实现参考：</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          <span class="hljs-comment">// 应用启动时/内部切换循环模式，需要把应用内的当前的循环模式设置给AVSession。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">playBackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>            <span class="hljs-attr">loopMode</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">LoopMode</span>.<span class="hljs-property">LOOP_MODE_SINGLE</span>,</li><li>          };</li><li>          session.<span class="hljs-title function_">setAVPlaybackState</span>(playBackState).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`set AVPlaybackState successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>
</li><li>          <span class="hljs-comment">// 应用注册循环模式的控制监听。</span></li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'setLoopMode'</span>, <span class="hljs-function">(<span class="hljs-params">mode</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on setLoopMode <span class="hljs-subst">${mode}</span>`</span>);</li><li>            <span class="hljs-comment">// 应用收到设置循环模式的指令后，应用自定下一个模式，切换完毕后通过AVPlaybackState上报切换后的LoopMode。</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">playBackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>              <span class="hljs-attr">loopMode</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">LoopMode</span>.<span class="hljs-property">LOOP_MODE_SINGLE</span>,</li><li>            };</li><li>            session.<span class="hljs-title function_">setAVPlaybackState</span>(playBackState).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`set AVPlaybackState successfully`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            });</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="进度控制">进度控制<i class="anchor-icon anchor-icon-link" anchorid="进度控制" tips="复制节点链接"></i></h3>          <p>应用如果支持进度显示，进一步也可以支持进度控制。应用需要响应seek的控制命令，那么当用户在播控中心的界面上进行拖动操作时，应用就会收到对应的回调。参考实现：</p>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-comment">// 假设已经创建了一个session，如何创建session可以参考之前的案例。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>
</li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'seek'</span>, <span class="hljs-function">(<span class="hljs-params">position: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on seek , the time is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(position)}</span>`</span>);</li><li>
</li><li>            <span class="hljs-comment">// 由于应用内seek可能会触发较长的缓冲等待，可以先把状态设置为 Buffering。</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">playbackState</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVPlaybackState</span> = {</li><li>              <span class="hljs-attr">state</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_BUFFERING</span>, <span class="hljs-comment">// 缓冲状态。</span></li><li>            };</li><li>            session.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (err) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVPlaybackState successfully`</span>);</li><li>              }</li><li>            });</li><li>
</li><li>            <span class="hljs-comment">// 应用响应seek命令，使用应用内播放器完成seek实现。</span></li><li>
</li><li>            <span class="hljs-comment">// 应用内更新新的位置后，也需要同步更新状态给系统。</span></li><li>            playbackState.<span class="hljs-property">state</span> = <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">PlaybackState</span>.<span class="hljs-property">PLAYBACK_STATE_PLAY</span>; <span class="hljs-comment">// 播放状态。</span></li><li>            playbackState.<span class="hljs-property">position</span> = {</li><li>              <span class="hljs-attr">elapsedTime</span>: position, <span class="hljs-comment">// 已经播放的位置，以ms为单位。</span></li><li>              <span class="hljs-attr">updateTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>(), <span class="hljs-comment">// 应用更新当前位置的时间戳，以ms为单位。</span></li><li>            }</li><li>            session.<span class="hljs-title function_">setAVPlaybackState</span>(playbackState, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (err) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVPlaybackState. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVPlaybackState successfully`</span>);</li><li>              }</li><li>            });</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="适配媒体通知">适配媒体通知<i class="anchor-icon anchor-icon-link" anchorid="适配媒体通知" tips="复制节点链接"></i></h2>          <p>当前系统不直接向应用提供主动发送媒体控制通知的接口，那么当应用正确接入媒体播控中心并进入播放状态时，系统会自动发送通知，同时在通知和锁屏界面进行展示。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>通知中心、锁屏下的播控卡片的展示，由系统进行发送，并控制相应的生命周期。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="适配蓝牙按键与有线按键事件">适配蓝牙按键与有线按键事件<i class="anchor-icon anchor-icon-link" anchorid="适配蓝牙按键与有线按键事件" tips="复制节点链接"></i></h2>          <p>当前系统不直接向应用提供监听多模按键事件的接口，应用如需要监听蓝牙与有线耳机的媒体按键事件，可以通过注册AVSession的控制指令来实现。AVSession提供了如下两种实现方式：</p>     <ul>      <li>       <p>方式一（推荐使用）：</p>       <div class="p">        按照应用业务需求，正确接入媒体播控中心，<a href="/consumer/cn/doc/harmonyos-guides/avsession-access-scene#注册控制命令">注册需要的控制指令</a>并实现对应的功能。AVSession会监听多模按键事件，将其转换为AVSession的控制指令发送回应用。应用无须区分不同的按键事件，按照AVSession的回调处理即可。按照此方式接入播放暂停，也等同于适配了蓝牙耳机的佩戴检测，在双耳佩戴与摘下时也会收到如下播放暂停控制指令。目前支持转换的AVSession控制指令如下：         <div class="tablenoborder">         <div class="tbBox"><table class="layoutFixed idpTab">          <thead>           <tr>            <th align="left" class="cellrowborder" id="mcps1.3.22.3.1.2.2.1.3.1.1" valign="top" width="50%">控制命令</th>            <th align="left" class="cellrowborder" id="mcps1.3.22.3.1.2.2.1.3.1.2" valign="top" width="50%">功能说明</th>           </tr>          </thead>                     <tbody><tr>            <td class="cellrowborder" valign="top" width="50%">play</td>            <td class="cellrowborder" valign="top" width="50%">播放命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">pause</td>            <td class="cellrowborder" valign="top" width="50%">暂停命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">stop</td>            <td class="cellrowborder" valign="top" width="50%">停止命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">playNext</td>            <td class="cellrowborder" valign="top" width="50%">播放下一首命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">playPrevious</td>            <td class="cellrowborder" valign="top" width="50%">播放上一首命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">fastForward</td>            <td class="cellrowborder" valign="top" width="50%">快进命令。</td>           </tr>           <tr>            <td class="cellrowborder" valign="top" width="50%">rewind</td>            <td class="cellrowborder" valign="top" width="50%">快退命令。</td>           </tr>                   </tbody></table></div>        </div>       </div></li>     </ul>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>            <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>            <span class="hljs-comment">// 设置必要的媒体信息，务必设置，否则接收不到控制事件。</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>              <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-comment">// 由应用指定，用于标识应用媒体库里的媒体。</span></li><li>              <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>              <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>              <span class="hljs-attr">artist</span>: <span class="hljs-string">'ARTIST'</span></li><li>            };</li><li>            session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            });</li><li>            <span class="hljs-comment">// 一般在监听器中会对播放器做相应逻辑处理。</span></li><li>            <span class="hljs-comment">// 处理完后需要通过set接口同步播放相关信息，参考上面的用例。</span></li><li>            session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'play'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on play , do play task`</span>);</li><li>              <span class="hljs-comment">// 如暂不支持该指令，请勿注册；或在注册后但暂不使用时，通过session.off('play')取消监听。</span></li><li>              <span class="hljs-comment">// 处理完毕后，请使用setAVPlayState上报播放状态。</span></li><li>            });</li><li>            session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'pause'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on pause , do pause task`</span>);</li><li>              <span class="hljs-comment">// 如暂不支持该指令，请勿注册；或在注册后但暂不使用时，通过session.off('pause')取消监听。</span></li><li>              <span class="hljs-comment">// 处理完毕后，请使用setAVPlayState上报播放状态。</span></li><li>            });</li><li>          } <span class="hljs-keyword">catch</span> (err) {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`AVSession create Error: Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            }</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>       <p>方式二：</p>       <p>通过AVSession注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession-avsession#onhandlekeyevent10" target="_blank">HandleMediaKeyEvent</a>指令。该回调接口会直接转发媒体按键事件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-keyevent" target="_blank">KeyEvent</a>。应用需要自行识别按键事件的类型，并响应事件实现对应的功能。目前支持转发的按键事件类型如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.22.5.1.3.1.3.1.1" valign="top" width="50%">按键类型(<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-keycode#keycode" target="_blank">KeyCode</a>)</th>           <th align="left" class="cellrowborder" id="mcps1.3.22.5.1.3.1.3.1.2" valign="top" width="50%">功能说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_PLAY_PAUSE</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：播放/暂停</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_STOP</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：停止</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_NEXT</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：下一首</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_PREVIOUS</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：上一首</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_REWIND</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：快退</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_FAST_FORWARD</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：快进</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_PLAY</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：播放</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">KEYCODE_MEDIA_PAUSE</td>           <td class="cellrowborder" valign="top" width="50%">多媒体键：暂停</td>          </tr>                 </tbody></table></div>       </div></li>     </ul>     <div _ngcontent-bit-c106="" class="highlight-div"><div _ngcontent-bit-c106="" class="highlight-div-header"><div _ngcontent-bit-c106="" class="highlight-div-header-left"><div _ngcontent-bit-c106="" class="handle-button expand-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bit-c106="" class="highlight-div-header-right"><div _ngcontent-bit-c106="" class="handle-button ai-button"></div><div _ngcontent-bit-c106="" class="handle-button line-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bit-c106="" class="handle-button theme-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bit-c106="" class="handle-button copy-button"><div _ngcontent-bit-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bit-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSessionType</span> = <span class="hljs-string">'audio'</span>;</li><li>          <span class="hljs-keyword">let</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-keyword">type</span>);</li><li>          <span class="hljs-comment">// 设置必要的媒体信息，务必设置，否则接收不到按键事件。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">metadata</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVMetadata</span> = {</li><li>            <span class="hljs-attr">assetId</span>: <span class="hljs-string">'0'</span>, <span class="hljs-comment">// 由应用指定，用于标识应用媒体库里的媒体。</span></li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'TITLE'</span>,</li><li>            <span class="hljs-attr">mediaImage</span>: <span class="hljs-string">'IMAGE'</span>,</li><li>            <span class="hljs-attr">artist</span>: <span class="hljs-string">'ARTIST'</span></li><li>          };</li><li>          session.<span class="hljs-title function_">setAVMetadata</span>(metadata).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SetAVMetadata successfully`</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set AVMetadata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          });</li><li>          session.<span class="hljs-title function_">on</span>(<span class="hljs-string">'handleKeyEvent'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 解析keycode，应用需要根据keycode对播放器做相应逻辑处理。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on handleKeyEvent, keyCode=<span class="hljs-subst">${event.key.code}</span>`</span>);</li><li>          });</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ol>        <li>方式一与方式二均需正确设置媒体信息AVMetadata并注册相应控制接口，否则会无法接收到控制指令与按键事件。</li>        <li>方式一与方式二，选择其一接入即可，无须同时接入，系统推荐按照方式一接入。</li>       </ol>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitee.com/harmonyos_samples/media-provider" target="_blank">媒体会话-提供方</a></li>     </ul>    </div>   </div>   <div></div></div>