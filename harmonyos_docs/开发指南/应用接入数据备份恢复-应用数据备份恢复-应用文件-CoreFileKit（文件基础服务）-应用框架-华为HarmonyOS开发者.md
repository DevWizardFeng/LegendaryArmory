<h1 _ngcontent-lfb-c119="" class="doc-title ng-star-inserted" title="应用接入数据备份恢复"> 应用接入数据备份恢复 </h1>

<div _ngcontent-lfb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>应用接入数据备份恢复需要通过BackupExtensionAbility实现。</p>    <p>BackupExtensionAbility，是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/stage-model-development-overview">Stage模型</a>中扩展组件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/extensionability-overview">ExtensionAbility</a>的派生类。开发者可以通过修改配置文件定制备份恢复框架的行为，包括是否允许备份恢复，备份哪些文件等。</p>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>备份恢复扩展能力关键接口如下表所示。API的接口使用指导请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-application-backupextensionability#backupextensionability" target="_blank">BackupExtensionAbility API参考</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-backupextensioncontext" target="_blank">BackupExtensionContext API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">onBackup(): void</td>         <td class="cellrowborder" valign="top" width="50%">数据备份准备阶段，迁移备份数据前回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onBackupEx(backupInfo: string): string | Promise&lt;string&gt;</td>         <td class="cellrowborder" valign="top" width="50%">数据备份准备阶段，迁移备份数据前回调，支持传递备份信息和返回备份结果。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onRestore(bundleVersion: BundleVersion): void</td>         <td class="cellrowborder" valign="top" width="50%">数据恢复阶段，备份数据迁移完成后回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onRestoreEx(bundleVersion: BundleVersion, restoreInfo: string): string | Promise&lt;string&gt;</td>         <td class="cellrowborder" valign="top" width="50%">数据恢复阶段，备份数据迁移完成后回调，支持传递恢复信息和返回恢复结果。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onRelease(scenario: number): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">          <p>备份或恢复完成时的特殊处理，备份或恢复完成时回调。</p>          <p><strong>说明</strong>：从API version 20开始支持该接口。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>当备份恢复时，所有待备份文件及目录的路径不得超过4095字节，否则将导致未定义行为。</li>      <li>当备份目录时，应用进程必须拥有读取该目录及其所有子目录的权限（DAC中的r），否则将导致备份失败。</li>      <li>当备份文件时，应用进程必须拥有搜索该文件所有祖父级目录的权限（DAC中的x），否则将导致备份失败。</li>      <li>当备份恢复时，所有待备份恢复的文件及目录不支持相对路径(../)和软链接。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>在应用配置文件module.json5中注册extensionAbilities相关配置</p>       <p>新增"extensionAbilities"字段，其中注册类型"type"设置为"backup"，元数据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-bundlemanager-metadata" target="_blank">"metadata"</a>新增一个"name"为"ohos. extension. backup"的条目。</p>       <p>BackupExtensionAbility配置文件示例：</p>       <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"extensionAbilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:ServiceExtAbility"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:icon"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BackupExtensionAbility"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"backup"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"exported"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>                <span class="hljs-punctuation">{</span></li><li>                    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.extension.backup"</span><span class="hljs-punctuation">,</span></li><li>                    <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:backup_config"</span></li><li>                <span class="hljs-punctuation">}</span></li><li>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-comment">// 在BackupExtension.ets文件里自定义继承BackupExtensionAbility，重写其中的onBackup/onBackupEx和</span></li><li>            <span class="hljs-comment">// onRestore/onRestoreEx方法，推荐使用onBackupEx/onRestoreEx。</span></li><li>            <span class="hljs-comment">// 如果没有特殊要求可以空实现，则备份恢复服务会按照统一的备份恢复数据规则进行备份恢复。</span></li><li>            <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/BackupExtension/BackupExtension.ets"</span></li><li>        <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>新增元数据资源配置文件</p>       <p>在元数据资源配置文件中，定义备份恢复时需要传输的文件。元数据资源配置文件名称需要与module.json5中"metadata.resource"例如"backup_config.json"名称保持一致，其保存位置在工程的resources/base/profile文件夹下。</p>       <p>元数据资源配置文件示例：</p>       <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"allowToBackupRestore"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"includes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"/data/storage/el2/base/files/users/"</span></li><li>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"excludes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"/data/storage/el2/base/files/users/hidden/"</span></li><li>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"fullBackupOnly"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"restoreDeps"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>开发者可以在BackupExtension.ets文件中自定义类继承的BackupExtensionAbility，通过重写其onBackup/onBackupEx和onRestore/onRestoreEx方法，使其达到在备份预加工应用数据或者在恢复阶段加工待恢复文件。</p>       <p>如果没有特殊要求可以空实现，则备份恢复服务会按照统一的备份恢复数据规则进行备份恢复。</p>       <p>下面的示例展示了一个空实现的BackupExtension.ets文件：</p>       <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//onBackup &amp;&amp; onRestore</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BackupExtensionAbility</span>, <span class="hljs-title class_">BundleVersion</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> {hilog} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">`FileBackupExtensionAbility`</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BackupExtension</span> <span class="hljs-keyword">extends</span>  <span class="hljs-title class_ inherited__">BackupExtensionAbility</span> {</li><li>  <span class="hljs-comment">//onBackup</span></li><li>  <span class="hljs-keyword">async</span> onBackup ()   {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onBackup ok`</span>);</li><li>  }</li><li>  <span class="hljs-comment">//onRestore</span></li><li>  <span class="hljs-keyword">async</span> onRestore (bundleVersion : <span class="hljs-title class_">BundleVersion</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onRestore end`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//onBackupEx &amp;&amp; onRestoreEx</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BackupExtensionAbility</span>, <span class="hljs-title class_">BundleVersion</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ErrorInfo</span> {</li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>,</li><li>  <span class="hljs-attr">errorCode</span>: <span class="hljs-built_in">number</span>,</li><li>  <span class="hljs-attr">errorInfo</span>: <span class="hljs-built_in">string</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BackupExt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BackupExtensionAbility</span> {</li><li>  <span class="hljs-comment">//onBackupEx</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onBackupEx</span>(<span class="hljs-attr">backupInfo</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onBackupEx ok`</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">errorInfo</span>: <span class="hljs-title class_">ErrorInfo</span> = {</li><li>      <span class="hljs-attr">type</span>: <span class="hljs-string">"ErrorInfo"</span>,</li><li>      <span class="hljs-attr">errorCode</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">errorInfo</span>: <span class="hljs-string">"app diy error info"</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(errorInfo);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// onRestoreEx</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onRestoreEx</span>(bundleVersion : <span class="hljs-title class_">BundleVersion</span>, <span class="hljs-attr">restoreInfo</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onRestoreEx begin`</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">errorInfo</span>: <span class="hljs-title class_">ErrorInfo</span> = {</li><li>      <span class="hljs-attr">type</span>: <span class="hljs-string">"ErrorInfo"</span>,</li><li>      <span class="hljs-attr">errorCode</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">errorInfo</span>: <span class="hljs-string">"app diy error info"</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(errorInfo);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>从API 20开始，开发者如需在应用备份恢复完成后执行一些特殊操作，例如清理备份或恢复时应用创建的临时文件，可以在BackupExtension.ets文件中自定义类继承的BackupExtensionAbility，通过重写其onRelease方法，当备份或恢复完成时，会执行onRelease方法以执行开发者自定义的行为。</p>       <p>onRelease具有超时机制，应用若在5秒内未完成onRelease操作，将触发备份恢复结束时的应用进程退出流程。</p>       <p>下面的示例展示了需要清理临时文件目录时onRelease的实现：</p>       <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BackupExtensionAbility</span>, fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">SCENARIO_BACKUP</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">SCENARIO_RESTORE</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li><span class="hljs-comment">// 需要清理的临时目录</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'/data/storage/el2/base/.temp/'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BackupExt</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BackupExtensionAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onRelease</span>(<span class="hljs-attr">scenario</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">if</span> (scenario == <span class="hljs-variable constant_">SCENARIO_BACKUP</span>) {</li><li>        <span class="hljs-comment">// 备份场景，应用自行实现处理，以清理备份产生的临时文件为例</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onRelease begin`</span>);</li><li>        <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">rmdir</span>(filePath);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onRelease end, rmdir succeed`</span>);</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (scenario == <span class="hljs-variable constant_">SCENARIO_RESTORE</span>) {</li><li>        <span class="hljs-comment">// 恢复场景，应用自行实现处理，以清理恢复产生的临时文件为例</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onRelease begin`</span>);</li><li>        <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">rmdir</span>(filePath);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onRelease end, rmdir succeed`</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onRelease failed with error. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="元数据资源配置文件说明" class="firsth2">元数据资源配置文件说明<i class="anchor-icon anchor-icon-link" anchorid="元数据资源配置文件说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.1" valign="top" width="25%">属性名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.2" valign="top" width="25%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.4" valign="top" width="25%">含义</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">allowToBackupRestore</td>         <td class="cellrowborder" valign="top" width="25%">布尔值</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">是否允许备份恢复，默认为false。true为允许备份恢复，false为不允许备份恢复。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">includes</td>         <td class="cellrowborder" valign="top" width="25%">字符串数组</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>应用沙箱中需要备份的文件和目录。</p>          <p>当模式串以非/开始时，表示一个相对于根路径的相对路径。</p>          <p>includes支持的路径清单列表如下述代码段内容所示，当配置includes时请确保配置路径范围包含在其中，<strong>不支持备份el3、el4路径</strong>。</p>          <p>当includes已配置时，备份恢复框架会采用开发者配置的模式串，否则将会采用下述代码段内容作为默认值。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">excludes</td>         <td class="cellrowborder" valign="top" width="25%">字符串数组</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>includes中无需备份的例外项。格式同includes。</p>          <p>在配置excludes时，请确保其范围在includes的子集中。</p>          <p>当excludes已配置时，备份恢复框架会采用开发者配置的模式串，否则将会采用<strong>空数组</strong>作为默认值。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">fullBackupOnly</td>         <td class="cellrowborder" valign="top" width="25%">布尔值</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">是否使用应用默认恢复目录，默认值为false。当值为true时，恢复数据时会通过临时路径进行缓存，临时路径可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-backupextensioncontext#属性" target="_blank">backupDir</a>获取。当值为false或者不配置该字段时，恢复数据会以'/'为根目录解压数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">restoreDeps</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%"><strong>不推荐使用</strong>，应用恢复时依赖其他应用数据，默认值为""，需要配置依赖应用名称。当前仅支持最多一个依赖项。配置的依赖仅在一次恢复任务上下文生效，如果一次恢复任务中没有检测到依赖应用，则忽略该依赖描述继续执行恢复任务。<strong>依赖应用未恢复或者恢复失败都会导致本应用恢复失败</strong>。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">extraInfo</td>         <td class="cellrowborder" valign="top" width="25%">json串</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">额外信息可通过该字段传递。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p><strong>有关fullBackupOnly字段的说明</strong></p>       <ul>        <li>当fullBackupOnly为false时，恢复数据会以 <strong>/</strong> 为根目录解压数据，同路径下的同名文件会被覆盖。</li>        <li>当fullBackupOnly为true时，恢复数据会以临时目录为根目录解压数据，开发者需要在OnRestore/OnRestoreEx内自行实现恢复数据的逻辑，进行最终的恢复。</li>       </ul>       <p>开发者可根据自身的业务场景，选择对应的恢复数据方式。</p>       <p>示例：</p>       <p>假设应用的数据备份路径为：<strong>data/storage/el2/base/files/A/</strong> 。那么在恢复时，如果配置了fullBackupOnly为false，数据会被直接解压到：<strong>/data/storage/el2/base/files/A/</strong> 目录下；如果配置了fullBackupOnly为true，数据则会被解压到：<strong>临时路径<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-backupextensioncontext" target="_blank">backupDir</a> + /restore/data/storage/el2/base/files/A/</strong> 目录下。</p>      </div></div></div>     <p><strong>includes支持的路径清单列表如下：</strong></p>     <div _ngcontent-lfb-c106="" class="highlight-div"><div _ngcontent-lfb-c106="" class="highlight-div-header"><div _ngcontent-lfb-c106="" class="highlight-div-header-left"><div _ngcontent-lfb-c106="" class="handle-button expand-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lfb-c106="" class="highlight-div-header-right"><div _ngcontent-lfb-c106="" class="handle-button ai-button"></div><div _ngcontent-lfb-c106="" class="handle-button line-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lfb-c106="" class="handle-button theme-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lfb-c106="" class="handle-button copy-button"><div _ngcontent-lfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lfb-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"includes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-string">"data/storage/el1/database/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el1/base/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el1/base/preferences/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el1/base/haps/*/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el1/base/haps/*/preferences/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/database/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/base/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/base/preferences/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/base/haps/*/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/base/haps/*/preferences/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el2/distributedfiles/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el5/database/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el5/base/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el5/base/preferences/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el5/base/haps/*/files/"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-string">"data/storage/el5/base/haps/*/preferences/"</span></li><li>    <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>   </div>   <div></div></div>