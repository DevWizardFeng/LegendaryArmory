<h1 _ngcontent-cjg-c119="" class="doc-title ng-star-inserted" title="应用接入状态栏"> 应用接入状态栏 </h1>

<div _ngcontent-cjg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>应用接入状态栏之后，状态栏会显示应用自定义的图标，图标提供左键显示自定义弹窗以及右键显示菜单的功能；应用退出时，状态栏图标会随着应用进程的销毁而消失。</p>    <div class="tiledSection">     <h2 id="section14970106181011">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section14970106181011" tips="复制节点链接"></i></h2>          <p>以下列出应用接入状态栏的相关API，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager" target="_blank">接口文档</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>DeskTop Extension Kit（桌面拓展服务）相关API仅在2in1设备上生效。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <caption>        <b>表1 </b>应用接入状态栏相关功能接口介绍       </caption>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.2.3.1.1" valign="top" width="49.94%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.2.3.1.2" valign="top" width="50.06%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section665018220561" target="_blank">addToStatusBar</a>(context: common.Context, statusBarItem: StatusBarItem): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>添加应用图标到状态栏。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section8931134111810" target="_blank">removeFromStatusBar</a>(context: common.Context): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>移除状态栏的应用图标。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1797215174100" target="_blank">updateQuickOperationHeight</a>(context: common.Context, height: number): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>更新状态栏图标左键弹窗应用定制区域的高度。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section188071452172811" target="_blank">updateStatusBarMenu</a>(context: common.Context, statusBarGroupMenus: StatusBarGroupMenu[]): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>更新接入状态栏图标的右键菜单内容。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1728610265620" target="_blank">updateStatusBarIcon</a>(context: common.Context, statusBarIcon: StatusBarIcon): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>更新状态栏图标。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section18493519506" target="_blank">on</a>(type: 'statusBarIconClick', callback: Callback&lt;emitter.EventData&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>监听状态栏图标点击事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section896154419154" target="_blank">off</a>(type: 'statusBarIconClick', callback?: Callback&lt;emitter.EventData&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>注销状态栏图标点击事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section10893144462716" target="_blank">on</a>(type: 'rightMenuClick', callback: Callback&lt;emitter.EventData&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>监听状态栏右键菜单点击事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section5394166163416" target="_blank">off</a>(type: 'rightMenuClick', callback?: Callback&lt;emitter.EventData&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>注销状态栏右键菜单点击事件。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1697015212156">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1697015212156" tips="复制节点链接"></i></h2>          <ol>      <li><span>导入相关模块。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { statusBarManager, <span class="hljs-title class_">StatusBarViewExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeskTopExtensionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIExtensionContentSession</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { emitter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>新建一个MyStatusBarViewAbility.ets文件（例如在entry/src/main/ets/statusbarviewextensionability文件夹下），同时新建一个StatusBarPage的页面（例如在entry/src/main/ets/pages目录下），该页面用于在状态栏图标的左键业务弹窗中显示，然后构建自定义的StatusBarViewExtensionAbility。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'MyStatusBarViewExtAbility'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStatusBarViewAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">StatusBarViewExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onCreate`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionCreate</span>(<span class="hljs-params">want: Want, session: UIExtensionContentSession</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onSessionCreate, want: <span class="hljs-subst">${want.abilityName}</span>`</span>);</li><li>    <span class="hljs-comment">// pages/StatusBarPage为状态栏图标左键业务弹窗显示的页面</span></li><li>    session.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/StatusBarPage'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onForeground`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onBackground`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionDestroy</span>(<span class="hljs-params">session: UIExtensionContentSession</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onSessionDestroy`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onDestroy`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在MyStatusBarViewAbility所在模块下的module.json5文件中配置状态栏扩展Ability的信息。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"extensionAbilities"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"MyStatusBarViewAbility"</span>,</li><li>    <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:startIcon"</span>,</li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"statusBar"</span>,</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"statusBarView"</span>,</li><li>    <span class="hljs-string">"exported"</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-comment">// 此处为MyStatusBarViewAbility类所在的文件路径</span></li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/statusbarviewextensionability/MyStatusBarViewAbility.ets"</span></li><li>  }</li><li>]</li></ol></pre></div></div>       <p></p></li>      <li><span>在对应模块的rawfile文件夹（例如entry/src/main/resources/rawfile）下预置两张24<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-pixel-units" target="_blank">vp</a> * 24vp尺寸的图片（例如本示例中testWhite.png和testBlack.png两张图片），在页面组件内(如：index.ets)配置应用接入状态栏显示的图标信息。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-keyword">if</span> (!context) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getHostContext failed'</span>);</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 获取resourceManager资源管理器</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = context.<span class="hljs-property">resourceManager</span>;</li><li>
</li><li><span class="hljs-comment">// 创建white pixelMap，需在资源rawfile文件夹中预置testWhite.png图片，图片大小为24vp * 24vp</span></li><li><span class="hljs-keyword">const</span> whiteFileData = resourceMgr.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-string">'testWhite.png'</span>);</li><li><span class="hljs-keyword">const</span> whiteBuffer = whiteFileData.<span class="hljs-property">buffer</span>;</li><li><span class="hljs-keyword">const</span> whiteImageSource = image.<span class="hljs-title function_">createImageSource</span>(whiteBuffer);</li><li><span class="hljs-keyword">let</span> whitePixelMap = <span class="hljs-keyword">await</span> whiteImageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li><span class="hljs-comment">// 创建black pixelMap，需在资源rawfile文件夹中预置testBlack.png图片，图片大小为24vp * 24vp</span></li><li><span class="hljs-keyword">const</span> blackFileData = resourceMgr.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-string">'testBlack.png'</span>);</li><li><span class="hljs-keyword">const</span> blackBuffer = blackFileData.<span class="hljs-property">buffer</span>;</li><li><span class="hljs-keyword">const</span> blackImageSource = image.<span class="hljs-title function_">createImageSource</span>(blackBuffer);</li><li><span class="hljs-keyword">let</span> blackPixelMap = <span class="hljs-keyword">await</span> blackImageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li><span class="hljs-comment">// 构建图标信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">icon</span>: statusBarManager.<span class="hljs-property">StatusBarIcon</span> = {</li><li>  <span class="hljs-attr">white</span>: whitePixelMap,</li><li>  <span class="hljs-attr">black</span>: blackPixelMap</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>配置状态栏左键点击弹窗相关信息。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建左键业务弹窗信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">operation</span>: statusBarManager.<span class="hljs-property">QuickOperation</span> = {</li><li>  <span class="hljs-comment">// 此处abilityName为上述配置的module.json5中配置的自定义StatusBarViewExtensionAbility名称</span></li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"MyStatusBarViewAbility"</span>,</li><li>  <span class="hljs-attr">title</span>: <span class="hljs-string">"测试Demo"</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,</li><li>  <span class="hljs-comment">// 可缺省</span></li><li>  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'entry'</span></li><li>};</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）配置状态栏右键菜单内容信息，可在状态栏图标的右键菜单中增加自定义菜单选项。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建右键菜单项内容</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenus</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarSubMenuItem</span>&gt; = [];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenuItemAction</span>: statusBarManager.<span class="hljs-property">StatusBarMenuAction</span> = {</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"EntryAbility"</span></li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenu</span>: statusBarManager.<span class="hljs-property">StatusBarSubMenuItem</span> = {</li><li>  <span class="hljs-attr">subTitle</span>: <span class="hljs-string">"子菜单项"</span>,</li><li>  <span class="hljs-attr">menuAction</span>: subMenuItemAction</li><li>}</li><li>subMenus.<span class="hljs-title function_">push</span>(subMenu);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">statusBarMenuItems</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarMenuItem</span>&gt; = [];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">menuItem</span>: statusBarManager.<span class="hljs-property">StatusBarMenuItem</span> = {</li><li>  <span class="hljs-attr">title</span>: <span class="hljs-string">"一级菜单项"</span>,</li><li>  <span class="hljs-comment">// 一级menuAction和subMenu两项不可都缺省</span></li><li>  <span class="hljs-attr">subMenu</span>: subMenus</li><li>};</li><li>statusBarMenuItems.<span class="hljs-title function_">push</span>(menuItem);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">statusBarGroupMenus</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarGroupMenu</span>&gt; = [];</li><li>statusBarGroupMenus.<span class="hljs-title function_">push</span>(statusBarMenuItems);</li></ol></pre></div></div>       <p></p></li>      <li><span>整合配置信息，接入状态栏，显示应用图标。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建添加到状态栏的图标详细信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">item</span>: statusBarManager.<span class="hljs-property">StatusBarItem</span> = {</li><li>  <span class="hljs-attr">icons</span>: icon,</li><li>  <span class="hljs-attr">quickOperation</span>: operation,</li><li>  <span class="hljs-comment">// 该参数可选</span></li><li>  <span class="hljs-attr">statusBarGroupMenu</span>: statusBarGroupMenus</li><li>};</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  statusBarManager.<span class="hljs-title function_">addToStatusBar</span>(context, item);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`addToStatusBar failed. error code: <span class="hljs-subst">${error.code}</span>, error message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）应用接入状态栏之后，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section188071452172811" target="_blank">updateStatusBarMenu</a>接口更新状态栏的右键菜单。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建右键菜单项内容</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenus</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarSubMenuItem</span>&gt; = [];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenuItemAction</span>: statusBarManager.<span class="hljs-property">StatusBarMenuAction</span> = {</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"EntryAbility"</span></li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subMenu</span>: statusBarManager.<span class="hljs-property">StatusBarSubMenuItem</span> = {</li><li>  <span class="hljs-attr">subTitle</span>: <span class="hljs-string">"二级菜单项"</span>,</li><li>  <span class="hljs-attr">menuAction</span>: subMenuItemAction</li><li>}</li><li>subMenus.<span class="hljs-title function_">push</span>(subMenu);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">statusBarMenuItems</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarMenuItem</span>&gt; = [];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">menuItem</span>: statusBarManager.<span class="hljs-property">StatusBarMenuItem</span> = {</li><li>  <span class="hljs-attr">title</span>: <span class="hljs-string">"一级菜单项"</span>,</li><li>  <span class="hljs-comment">// 一级menuAction和subMenu两项不可都缺省</span></li><li>  <span class="hljs-attr">subMenu</span>: subMenus</li><li>};</li><li>statusBarMenuItems.<span class="hljs-title function_">push</span>(menuItem);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">statusBarGroupMenus</span>: <span class="hljs-title class_">Array</span>&lt;statusBarManager.<span class="hljs-property">StatusBarGroupMenu</span>&gt; = [];</li><li>statusBarGroupMenus.<span class="hljs-title function_">push</span>(statusBarMenuItems);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-keyword">if</span> (!context) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getHostContext failed'</span>);</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  statusBarManager.<span class="hljs-title function_">updateStatusBarMenu</span>(context, statusBarGroupMenus);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`updateStatusBarMenu failed. error code: <span class="hljs-subst">${error.code}</span>, error message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）应用接入状态栏之后，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1797215174100" target="_blank">updateQuickOperationHeight</a>接口更新状态栏图标左键业务弹窗的高度。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-keyword">if</span> (!context) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getHostContext failed'</span>);</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> height = <span class="hljs-number">200</span>;</li><li>statusBarManager.<span class="hljs-title function_">updateQuickOperationHeight</span>(context, height);</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）应用接入状态栏之后，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1728610265620" target="_blank">updateStatusBarIcon</a>接口将状态栏中对应的应用图标进行更改。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-keyword">if</span> (!context) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getHostContext failed'</span>);</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 获取resourceManager资源管理器</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = context.<span class="hljs-property">resourceManager</span>;</li><li>
</li><li><span class="hljs-comment">// 创建white pixelMap，需在资源rawfile文件夹中预置testWhite.png图片，图片大小为24vp * 24vp</span></li><li><span class="hljs-keyword">const</span> whiteFileData = resourceMgr.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-string">'testWhite.png'</span>);</li><li><span class="hljs-keyword">const</span> whiteBuffer = whiteFileData.<span class="hljs-property">buffer</span>;</li><li><span class="hljs-keyword">const</span> whiteImageSource = image.<span class="hljs-title function_">createImageSource</span>(whiteBuffer);</li><li><span class="hljs-keyword">let</span> whitePixelMap = <span class="hljs-keyword">await</span> whiteImageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li><span class="hljs-comment">// 创建black pixelMap，需在资源rawfile文件夹中预置testBlack.png图片，图片大小为24vp * 24vp</span></li><li><span class="hljs-keyword">const</span> blackFileData = resourceMgr.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-string">'testBlack.png'</span>);</li><li><span class="hljs-keyword">const</span> blackBuffer = blackFileData.<span class="hljs-property">buffer</span>;</li><li><span class="hljs-keyword">const</span> blackImageSource = image.<span class="hljs-title function_">createImageSource</span>(blackBuffer);</li><li><span class="hljs-keyword">let</span> blackPixelMap = <span class="hljs-keyword">await</span> blackImageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li><span class="hljs-comment">// 构建图标信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">icons</span>: statusBarManager.<span class="hljs-property">StatusBarIcon</span> = {</li><li>  <span class="hljs-attr">white</span>: whitePixelMap,</li><li>  <span class="hljs-attr">black</span>: blackPixelMap</li><li>}</li><li>statusBarManager.<span class="hljs-title function_">updateStatusBarIcon</span>(context, icons);</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）应用接入状态栏之后，且未指定图标<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1139214183436" target="_blank">QuickOperation</a>的abilityName可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section18493519506" target="_blank">on</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section896154419154" target="_blank">off</a>接口自定义状态栏图标左键业务。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> onStatusBarIconClick = <span class="hljs-function">(<span class="hljs-params">eventData: emitter.EventData</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 自定义图标点击业务</span></li><li>  <span class="hljs-keyword">let</span> data = eventData.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-keyword">if</span> (data) {</li><li>    <span class="hljs-keyword">switch</span> (data[<span class="hljs-string">'iconClickType'</span>]) {</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-string">'leftClickType'</span>:</li><li>        <span class="hljs-comment">// 自定义左键点击业务</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-attr">default</span>:</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 监听状态栏图标点击事件</span></li><li>statusBarManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'statusBarIconClick'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onStatusBarIconClick</span>);</li><li>
</li><li><span class="hljs-comment">// 注销状态栏图标点击事件</span></li><li>statusBarManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'statusBarIconClick'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onStatusBarIconClick</span>);</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）应用接入状态栏之后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section188071452172811" target="_blank">updateStatusBarMenu</a>接口，指定菜单<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section1196811528487" target="_blank">StatusBarMenuAction</a>的notifyOnly使能和menuCode菜单项标识，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section18493519506" target="_blank">on</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/statusbar-extension-manager#section896154419154" target="_blank">off</a>接口自定义状态栏图标右键菜单点击业务。</span>       <p></p>       <div _ngcontent-cjg-c106="" class="highlight-div"><div _ngcontent-cjg-c106="" class="highlight-div-header"><div _ngcontent-cjg-c106="" class="highlight-div-header-left"><div _ngcontent-cjg-c106="" class="handle-button expand-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjg-c106="" class="highlight-div-header-right"><div _ngcontent-cjg-c106="" class="handle-button ai-button"></div><div _ngcontent-cjg-c106="" class="handle-button line-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjg-c106="" class="handle-button theme-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjg-c106="" class="handle-button copy-button"><div _ngcontent-cjg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> onRightMenuClick = <span class="hljs-function">(<span class="hljs-params">eventData: emitter.EventData</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 自定义图标右键菜单点击业务</span></li><li>  <span class="hljs-keyword">let</span> data = eventData.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-keyword">if</span> (data) {</li><li>    <span class="hljs-keyword">let</span> menuCode = data[<span class="hljs-string">'menuCode'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-comment">// 处理点击菜单项业务</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 监听状态栏图标右键菜单点击事件</span></li><li>statusBarManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'rightMenuClick'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRightMenuClick</span>);</li><li>
</li><li><span class="hljs-comment">// 注销状态栏图标右键菜单点击事件</span></li><li>statusBarManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'rightMenuClick'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRightMenuClick</span>);</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section5896204116453">完整示例代码<i class="anchor-icon anchor-icon-link" anchorid="section5896204116453" tips="复制节点链接"></i></h2>          <p>完整示例代码请参见<a href="https://gitcode.com/harmonyos_samples/status-bar-extension-kit-samplecode" target="_blank">状态栏开放服务</a>。</p>    </div>   </div>   <div></div></div>