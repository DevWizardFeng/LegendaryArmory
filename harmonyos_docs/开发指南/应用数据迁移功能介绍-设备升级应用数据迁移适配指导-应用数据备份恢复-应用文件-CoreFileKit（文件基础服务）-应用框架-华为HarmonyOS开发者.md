<h1 _ngcontent-mdy-c119="" class="doc-title ng-star-inserted" title="应用数据迁移功能介绍"> 应用数据迁移功能介绍 </h1>

<div _ngcontent-mdy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section665018483017">使用场景<i class="anchor-icon anchor-icon-link" anchorid="section665018483017" tips="复制节点链接"></i></h2><p>终端设备从HarmonyOS 3.1 Release API 9及之前版本（简称HarmonyOS）升级到HarmonyOS NEXT Developer Preview1及之后版本（简称HarmonyOS NEXT）时，原HarmonyOS中运行的APK应用，升级后需要切换为HarmonyOS NEXT中的HarmonyOS应用。APK应用的部分数据需要转换并迁移到指定位置后，才能被HarmonyOS应用访问。HarmonyOS NEXT提供了“数据迁移框架”和“备份恢复框架”，为开发者提供应用数据的迁移和转换能力。开发者完成适配，APK应用切换为HarmonyOS应用后，可继承原APK应用中适配HarmonyOS应用的数据。</p> <p>如下图所示，应用需要的数据，包含云端服务器中的数据，本地应用沙箱中的数据和本地公共媒体库中的数据。为了应用的数据可以继承，开发者需要保证云端数据定义兼容APK应用和HarmonyOS应用，确保系统升级后同一账号下的数据可识别。</p> <p><span><img height="374.0887345517841" originheight="614" originwidth="1510" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114906.63886117181839060876068717782138:50001231000000:2800:7D53AF7BFD781B189903ADEA90ED51470F982C5179740A8E6500DFC5D337DD5B.png" title="点击放大" width="920"></span></p> </div> <div class="tiledSection"><h2 id="section86834191317">数据迁移机制<i class="anchor-icon anchor-icon-link" anchorid="section86834191317" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section15273195313295" class="firsth2">应用沙箱数据迁移机制<i class="anchor-icon anchor-icon-link" anchorid="section15273195313295" tips="复制节点链接"></i></h3><p>终端设备从HarmonyOS升级到HarmonyOS NEXT后，APK应用沙箱数据被搬迁到中间目录。针对应用沙箱数据，HarmonyOS NEXT提供“数据迁移框架”统一调度应用数据迁移任务。</p> <p>应用数据迁移任务需要执行的步骤包括：应用安装，数据迁移和数据恢复。</p> <ol><li><strong>应用安装步骤：</strong><ol><li>“数据迁移框架”向华为应用市场发送HarmonyOS应用下载和安装请求。</li><li>华为应用市场下载并安装HarmonyOS应用。</li></ol> </li><li><strong>数据迁移步骤：</strong><p>在HarmonyOS应用安装完成之后，“数据迁移框架”将应用沙箱数据从中间目录搬迁到备份恢复目录。</p> </li><li><strong>数据恢复步骤：</strong><ol><li>在应用数据搬迁到备份恢复目录后，“数据迁移框架”向“备份恢复框架”发送应用数据恢复请求。</li><li>“备份恢复框架”拉起应用的“BackupExtensionAbility”独立进程，启动应用数据恢复。</li><li>应用通过“BackupExtensionAbility”从备份恢复目录加载APK应用的数据，处理后保存到HarmonyOS应用沙箱中，完成应用数据恢复。</li><li>“备份恢复框架”在应用数据恢复完成后，清空备份恢复目录。</li></ol> </li></ol> <p>后续HarmonyOS应用通过访问HarmonyOS应用沙箱获取应用的数据。</p> <p><span><img height="361.73037037037034" originheight="600" originwidth="1526" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114906.40502032574483012763342529902145:50001231000000:2800:B3F4E7A1F05361ECBAF0F1EDD4D6912763A9E36CCD2780F348B5E6635C31A6DB.png" title="点击放大" width="920"></span></p> </div> <div class="tiledSection"><h3 id="section78231291291">公共媒体库中数据迁移机制<i class="anchor-icon anchor-icon-link" anchorid="section78231291291" tips="复制节点链接"></i></h3><p>公共媒体库中的数据，在终端设备从HarmonyOS升级到HarmonyOS NEXT后，会整体搬迁直接继承。应用可以使用HarmonyOS NEXT提供的API，访问公共媒体库中的数据。媒体库的使用指导可以参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-overview" target="_blank">媒体文件管理服务</a>。</p> <p><span><img originheight="350" originwidth="851" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114906.96315629365819320189907769281619:50001231000000:2800:8CA8D116C1CDA7F1CABCE313FFD7BA8F67A7E43EF1ED095F916956A6BCD5182E.png" width="851" height="350"></span></p> </div> </div> <div></div></div>