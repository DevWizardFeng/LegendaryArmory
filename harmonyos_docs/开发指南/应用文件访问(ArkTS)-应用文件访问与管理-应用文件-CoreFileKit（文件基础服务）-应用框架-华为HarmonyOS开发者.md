<h1 _ngcontent-ovd-c119="" class="doc-title ng-star-inserted" title="应用文件访问(ArkTS)"> 应用文件访问(ArkTS) </h1>

<div _ngcontent-ovd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>应用需要对应用文件目录下的应用文件进行查看、创建、读写、删除、移动、复制、获取属性等访问操作，下文介绍具体方法。</p>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>开发者通过基础文件操作接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs" target="_blank">ohos.file.fs</a>）实现应用文件访问能力，主要功能如下表所示。</p>     <p><strong>表1</strong> 基础文件操作接口功能，其中“√”表示支持，“-”表示不区分同步和异步。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.6.1.1" valign="top" width="20%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.6.1.2" valign="top" width="20%">功能</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.6.1.3" valign="top" width="20%">接口类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.6.1.4" valign="top" width="20%">支持同步</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.6.1.5" valign="top" width="20%">支持异步</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="20%">access</td>         <td class="cellrowborder" valign="top" width="20%">检查文件是否存在</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">close</td>         <td class="cellrowborder" valign="top" width="20%">关闭文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">copyFile</td>         <td class="cellrowborder" valign="top" width="20%">复制文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">createStream</td>         <td class="cellrowborder" valign="top" width="20%">基于文件路径打开文件流</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">listFile</td>         <td class="cellrowborder" valign="top" width="20%">列出文件夹下所有文件名</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">mkdir</td>         <td class="cellrowborder" valign="top" width="20%">创建目录</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">moveFile</td>         <td class="cellrowborder" valign="top" width="20%">移动文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">open</td>         <td class="cellrowborder" valign="top" width="20%">打开文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">read</td>         <td class="cellrowborder" valign="top" width="20%">从文件读取数据</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">rename</td>         <td class="cellrowborder" valign="top" width="20%">重命名文件或文件夹</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">rmdir</td>         <td class="cellrowborder" valign="top" width="20%">删除整个目录</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">stat</td>         <td class="cellrowborder" valign="top" width="20%">获取文件详细属性信息</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">unlink</td>         <td class="cellrowborder" valign="top" width="20%">删除单个文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">write</td>         <td class="cellrowborder" valign="top" width="20%">将数据写入文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">Stream.close</td>         <td class="cellrowborder" valign="top" width="20%">关闭文件流</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">Stream.flush</td>         <td class="cellrowborder" valign="top" width="20%">刷新文件流</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">Stream.write</td>         <td class="cellrowborder" valign="top" width="20%">将数据写入流文件</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">Stream.read</td>         <td class="cellrowborder" valign="top" width="20%">从流文件读取数据</td>         <td class="cellrowborder" valign="top" width="20%">方法</td>         <td class="cellrowborder" valign="top" width="20%">√</td>         <td class="cellrowborder" valign="top" width="20%">√</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">File.fd</td>         <td class="cellrowborder" valign="top" width="20%">获取文件描述符</td>         <td class="cellrowborder" valign="top" width="20%">属性</td>         <td class="cellrowborder" valign="top" width="20%">-</td>         <td class="cellrowborder" valign="top" width="20%">-</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">OpenMode</td>         <td class="cellrowborder" valign="top" width="20%">设置文件打开标签</td>         <td class="cellrowborder" valign="top" width="20%">属性</td>         <td class="cellrowborder" valign="top" width="20%">-</td>         <td class="cellrowborder" valign="top" width="20%">-</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">Filter</td>         <td class="cellrowborder" valign="top" width="20%">设置文件过滤配置项</td>         <td class="cellrowborder" valign="top" width="20%">类型</td>         <td class="cellrowborder" valign="top" width="20%">-</td>         <td class="cellrowborder" valign="top" width="20%">-</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>使用基础文件操作接口时，耗时较长的操作，例如：read、write等，建议使用异步接口，避免应用崩溃。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="开发示例">开发示例<i class="anchor-icon anchor-icon-link" anchorid="开发示例" tips="复制节点链接"></i></h2>          <p>在对应用文件开始访问前，开发者需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a>。以从UIAbilityContext获取HAP级别的文件路径为例进行说明，UIAbilityContext的获取方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>     <p>下面介绍几种常用操作示例。</p>    </div>    <div class="tiledSection">     <h3 id="新建并读写一个文件" class="firsth2">新建并读写一个文件<i class="anchor-icon anchor-icon-link" anchorid="新建并读写一个文件" tips="复制节点链接"></i></h3>          <p>以下示例代码演示了如何新建一个文件并对其读写。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// pages/xxx.ets</span></li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs, <span class="hljs-title class_">ReadOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createFile</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-comment">// 文件不存在时创建并打开文件，文件存在时打开文件</span></li><li>  <span class="hljs-keyword">let</span> file = fs.<span class="hljs-title function_">openSync</span>(filesDir + <span class="hljs-string">'/test.txt'</span>, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  <span class="hljs-comment">// 写入一段内容至文件</span></li><li>  <span class="hljs-keyword">let</span> writeLen = fs.<span class="hljs-title function_">writeSync</span>(file.<span class="hljs-property">fd</span>, <span class="hljs-string">"Try to write str."</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The length of str is: "</span> + writeLen);</li><li>  <span class="hljs-comment">// 创建一个大小为1024字节的ArrayBuffer对象，用于存储从文件中读取的数据</span></li><li>  <span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">1024</span>);</li><li>  <span class="hljs-comment">// 设置读取的偏移量和长度</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">readOptions</span>: <span class="hljs-title class_">ReadOptions</span> = {</li><li>    <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">length</span>: arrayBuffer.<span class="hljs-property">byteLength</span></li><li>  };</li><li>  <span class="hljs-comment">// 读取文件内容到ArrayBuffer对象中，并返回实际读取的字节数</span></li><li>  <span class="hljs-keyword">let</span> readLen = fs.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, arrayBuffer, readOptions);</li><li>  <span class="hljs-comment">// 将ArrayBuffer对象转换为Buffer对象，并转换为字符串输出</span></li><li>  <span class="hljs-keyword">let</span> buf = buffer.<span class="hljs-title function_">from</span>(arrayBuffer, <span class="hljs-number">0</span>, readLen);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"the content of file: "</span> + buf.<span class="hljs-title function_">toString</span>());</li><li>  <span class="hljs-comment">// 关闭文件</span></li><li>  fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="读取文件内容并写入到另一个文件">读取文件内容并写入到另一个文件<i class="anchor-icon anchor-icon-link" anchorid="读取文件内容并写入到另一个文件" tips="复制节点链接"></i></h3>          <p>以下示例代码演示了如何从一个文件读写内容到另一个文件。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// pages/xxx.ets</span></li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs, <span class="hljs-title class_">ReadOptions</span>, <span class="hljs-title class_">WriteOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">readWriteFile</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-comment">// 打开文件</span></li><li>  <span class="hljs-keyword">let</span> srcFile = fs.<span class="hljs-title function_">openSync</span>(filesDir + <span class="hljs-string">'/test.txt'</span>, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  <span class="hljs-keyword">let</span> destFile = fs.<span class="hljs-title function_">openSync</span>(filesDir + <span class="hljs-string">'/destFile.txt'</span>, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  <span class="hljs-comment">// 读取源文件内容并写入至目的文件</span></li><li>  <span class="hljs-keyword">let</span> bufSize = <span class="hljs-number">4096</span>;</li><li>  <span class="hljs-keyword">let</span> readSize = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(bufSize);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">readOptions</span>: <span class="hljs-title class_">ReadOptions</span> = {</li><li>    <span class="hljs-attr">offset</span>: readSize,</li><li>    <span class="hljs-attr">length</span>: bufSize</li><li>  };</li><li>  <span class="hljs-keyword">let</span> readLen = fs.<span class="hljs-title function_">readSync</span>(srcFile.<span class="hljs-property">fd</span>, buf, readOptions);</li><li>  <span class="hljs-keyword">while</span> (readLen &gt; <span class="hljs-number">0</span>) {</li><li>    readSize += readLen;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">writeOptions</span>: <span class="hljs-title class_">WriteOptions</span> = {</li><li>      <span class="hljs-attr">length</span>: readLen</li><li>    };</li><li>    fs.<span class="hljs-title function_">writeSync</span>(destFile.<span class="hljs-property">fd</span>, buf, writeOptions);</li><li>    readOptions.<span class="hljs-property">offset</span> = readSize;</li><li>    readLen = fs.<span class="hljs-title function_">readSync</span>(srcFile.<span class="hljs-property">fd</span>, buf, readOptions);</li><li>  }</li><li>  <span class="hljs-comment">// 关闭文件</span></li><li>  fs.<span class="hljs-title function_">closeSync</span>(srcFile);</li><li>  fs.<span class="hljs-title function_">closeSync</span>(destFile);</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>使用读写接口时，需注意可选项参数offset的设置。对于已存在且读写过的文件，文件偏移指针默认在上次读写操作的终止位置。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="以流的形式读写文件">以流的形式读写文件<i class="anchor-icon anchor-icon-link" anchorid="以流的形式读写文件" tips="复制节点链接"></i></h3>          <p>以下示例代码演示了如何使用流接口读取test.txt的文件内容并写入到destFile.txt文件中。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// pages/xxx.ets</span></li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs, <span class="hljs-title class_">ReadOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readWriteFileWithStream</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-comment">// 创建并打开输入文件流</span></li><li>  <span class="hljs-keyword">let</span> inputStream = fs.<span class="hljs-title function_">createStreamSync</span>(filesDir + <span class="hljs-string">'/test.txt'</span>, <span class="hljs-string">'r+'</span>);</li><li>  <span class="hljs-comment">// 创建并打开输出文件流</span></li><li>  <span class="hljs-keyword">let</span> outputStream = fs.<span class="hljs-title function_">createStreamSync</span>(filesDir + <span class="hljs-string">'/destFile.txt'</span>, <span class="hljs-string">"w+"</span>);</li><li>
</li><li>  <span class="hljs-keyword">let</span> bufSize = <span class="hljs-number">4096</span>;</li><li>  <span class="hljs-keyword">let</span> readSize = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(bufSize);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">readOptions</span>: <span class="hljs-title class_">ReadOptions</span> = {</li><li>    <span class="hljs-attr">offset</span>: readSize,</li><li>    <span class="hljs-attr">length</span>: bufSize</li><li>  };</li><li>  <span class="hljs-comment">// 以流的形式读取源文件内容并写入到目标文件</span></li><li>  <span class="hljs-keyword">let</span> readLen = <span class="hljs-keyword">await</span> inputStream.<span class="hljs-title function_">read</span>(buf, readOptions);</li><li>  readSize += readLen;</li><li>  <span class="hljs-keyword">while</span> (readLen &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">const</span> writeBuf = readLen &lt; bufSize ? buf.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, readLen) : buf;</li><li>    <span class="hljs-keyword">await</span> outputStream.<span class="hljs-title function_">write</span>(writeBuf);</li><li>    readOptions.<span class="hljs-property">offset</span> = readSize;</li><li>    readLen = <span class="hljs-keyword">await</span> inputStream.<span class="hljs-title function_">read</span>(buf, readOptions);</li><li>    readSize += readLen;</li><li>  }</li><li>  <span class="hljs-comment">// 关闭文件流</span></li><li>  inputStream.<span class="hljs-title function_">closeSync</span>();</li><li>  outputStream.<span class="hljs-title function_">closeSync</span>();</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>使用流接口时，需注意流的及时关闭。同时流的异步接口应严格遵循异步接口使用规范，避免同步、异步接口混用。流接口不支持并发读写。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="查看文件列表">查看文件列表<i class="anchor-icon anchor-icon-link" anchorid="查看文件列表" tips="复制节点链接"></i></h3>          <p>以下示例代码演示了如何查看文件列表。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs, <span class="hljs-title class_">Filter</span>, <span class="hljs-title class_">ListFileOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-comment">// 查看文件列表</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getListFile</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">listFileOption</span>: <span class="hljs-title class_">ListFileOptions</span> = {</li><li>    <span class="hljs-attr">recursion</span>: <span class="hljs-literal">false</span>,</li><li>    <span class="hljs-attr">listNum</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">filter</span>: {</li><li>      <span class="hljs-attr">suffix</span>: [<span class="hljs-string">".png"</span>, <span class="hljs-string">".jpg"</span>, <span class="hljs-string">".txt"</span>],</li><li>      <span class="hljs-attr">displayName</span>: [<span class="hljs-string">"test*"</span>],</li><li>      <span class="hljs-attr">fileSizeOver</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">lastModifiedAfter</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">getTime</span>()</li><li>    }</li><li>  };</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-keyword">let</span> files = fs.<span class="hljs-title function_">listFileSync</span>(filesDir, listFileOption);</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`The name of file: <span class="hljs-subst">${files[i]}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用文件流">使用文件流<i class="anchor-icon anchor-icon-link" anchorid="使用文件流" tips="复制节点链接"></i></h3>          <p>以下示例代码演示了如何使用文件可读流，文件可写流。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// pages/xxx.ets</span></li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileWithReadable</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-comment">// 创建文件可读流</span></li><li>  <span class="hljs-keyword">const</span> rs = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">`<span class="hljs-subst">${filesDir}</span>/read.txt`</span>);</li><li>  <span class="hljs-comment">// 创建文件可写流</span></li><li>  <span class="hljs-keyword">const</span> ws = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">`<span class="hljs-subst">${filesDir}</span>/write.txt`</span>);</li><li>  <span class="hljs-comment">// 暂停模式拷贝文件。在拷贝数据时，将原始数据暂停，然后将数据复制到另一个位置，适用于对数据完整性和一致性要求较高的场景</span></li><li>  rs.<span class="hljs-title function_">on</span>(<span class="hljs-string">'readable'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> data = rs.<span class="hljs-title function_">read</span>();</li><li>    <span class="hljs-keyword">if</span> (!data) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    ws.<span class="hljs-title function_">write</span>(data);</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyFileWithData</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-comment">// 创建文件可读流</span></li><li>  <span class="hljs-keyword">const</span> rs = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">`<span class="hljs-subst">${filesDir}</span>/read.txt`</span>);</li><li>  <span class="hljs-comment">// 创建文件可写流</span></li><li>  <span class="hljs-keyword">const</span> ws = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">`<span class="hljs-subst">${filesDir}</span>/write.txt`</span>);</li><li>  <span class="hljs-comment">// 流动模式拷贝文件。数据的读取和写入是同时进行的，不需要暂停原始数据的访问，适用于对数据实时性要求较高的场景</span></li><li>  rs.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">emitData</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> data = emitData?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">if</span> (!data) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    ws.<span class="hljs-title function_">write</span>(data <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>);</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用文件哈希流">使用文件哈希流<i class="anchor-icon anchor-icon-link" anchorid="使用文件哈希流" tips="复制节点链接"></i></h3>          <p>哈希流是一种数据传输和存储技术，可以将任意长度的数据转换为固定长度的哈希值来验证数据的完整性和一致性。以下代码演示了如何使用文件哈希处理接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-hash" target="_blank">ohos.file.hash</a>）来处理文件哈希流。</p>     <div _ngcontent-ovd-c106="" class="highlight-div"><div _ngcontent-ovd-c106="" class="highlight-div-header"><div _ngcontent-ovd-c106="" class="highlight-div-header-left"><div _ngcontent-ovd-c106="" class="handle-button expand-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovd-c106="" class="highlight-div-header-right"><div _ngcontent-ovd-c106="" class="handle-button ai-button"></div><div _ngcontent-ovd-c106="" class="handle-button line-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovd-c106="" class="handle-button theme-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovd-c106="" class="handle-button copy-button"><div _ngcontent-ovd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// pages/xxx.ets</span></li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { hash } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 获取应用文件路径，请在组件内获取context</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">hashFileWithStream</span>(<span class="hljs-params">context: common.UIAbilityContext</span>) {</li><li>  <span class="hljs-keyword">let</span> filesDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-keyword">const</span> filePath = <span class="hljs-string">`<span class="hljs-subst">${filesDir}</span>/test.txt`</span>;</li><li>  <span class="hljs-comment">// 创建文件可读流</span></li><li>  <span class="hljs-keyword">const</span> rs = fs.<span class="hljs-title function_">createReadStream</span>(filePath);</li><li>  <span class="hljs-comment">// 创建哈希流</span></li><li>  <span class="hljs-keyword">const</span> hs = hash.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">'sha256'</span>);</li><li>  rs.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">emitData</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> data = emitData?.<span class="hljs-property">data</span>;</li><li>    hs.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(data?.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">string</span></span>) =&gt;</span> x.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>))).<span class="hljs-property">buffer</span>);</li><li>  });</li><li>  rs.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-keyword">const</span> hashResult = hs.<span class="hljs-title function_">digest</span>();</li><li>    <span class="hljs-keyword">const</span> fileHash = <span class="hljs-keyword">await</span> hash.<span class="hljs-title function_">hash</span>(filePath, <span class="hljs-string">'sha256'</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`hashResult: <span class="hljs-subst">${hashResult}</span>, fileHash: <span class="hljs-subst">${fileHash}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>