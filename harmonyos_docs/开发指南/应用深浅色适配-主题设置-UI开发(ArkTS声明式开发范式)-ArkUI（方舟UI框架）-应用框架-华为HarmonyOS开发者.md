<h1 _ngcontent-qkf-c119="" class="doc-title ng-star-inserted" title="应用深浅色适配"> 应用深浅色适配 </h1>

<div _ngcontent-qkf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>当前系统存在深浅色两种显示模式，为了给用户更好的使用体验，应用应适配深浅色模式。从应用与系统配置关联的角度来看，适配深浅色模式可以分为下面两种情况：</p>     <p><a href="/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#应用跟随系统的深浅色模式">应用跟随系统的深浅色模式</a></p>     <p><a href="/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#应用主动设置深浅色模式">应用主动设置深浅色模式</a></p>    </div>    <div class="tiledSection">     <h2 id="应用跟随系统的深浅色模式">应用跟随系统的深浅色模式<i class="anchor-icon anchor-icon-link" anchorid="应用跟随系统的深浅色模式" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>颜色适配</p>       <ul>        <li>         <p>自定义资源实现</p>         <p>resources目录下增加深色模式限定词目录（命名为dark）并新建color.json文件，可显示深色模式颜色资源的配置。详细请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access">资源分类与访问</a>。</p>         <p>图1 resources目录结构示意</p>         <p><span><img originheight="278" originwidth="229" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114754.04799234397633631054879398440974:50001231000000:2800:1E598A81C3D1E13B2AE14D9B4C386AD38E479AA74E543FE94B560DD5352CF347.png" class="notEnlarge" width="229" height="278"></span></p>         <p>例如，开发者可在这两个color.json中定义同名配色定义并赋予不同的色值。</p>         <p>base/element/color.json文件：</p>         <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_title_color"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#000000"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>         <p>dark/element/color.json文件：</p>         <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_title_color"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FFFFFF"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>        <li>         <p>通过系统资源实现</p>         <p>开发者可直接使用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access#系统资源">系统预置资源</a>，即分层参数，同一资源ID在设备类型、深浅色等不同配置下有不同的取值。通过使用系统资源，不同的开发者可以开发出具有相同视觉风格的应用，不需要自定义两份颜色资源，在深浅色模式下也会自动切换成不同的颜色值。例如，开发者可调用系统资源中的文本主要配色来定义应用内文本颜色。</p>         <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Text</span>(<span class="hljs-string">'使用系统定义配色'</span>)</li><li>  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'sys.color.ohos_id_color_text_primary'</span>))</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>图片资源适配</p>       <p>采用资源限定词目录的方式。参照颜色适配的方法，需要将深色模式下对应的同名图片放到 dark/media 目录下，再通过$r的方式加载图片资源的key值，系统做深浅色模式切换时，会自动加载对应资源文件中的value值。</p>       <p>对于 SVG 格式的一些简单图标，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-graphics-display#显示矢量图">fillColor</a>属性配合系统资源改变图片的绘制颜色。不通过两套图片资源的方式，也可以实现深浅色模式适配。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.pic_svg'</span>))</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>  .<span class="hljs-title function_">fillColor</span>($r(<span class="hljs-string">'sys.color.ohos_id_color_text_primary'</span>))</li></ol></pre></div></div></li>      <li>       <p>Web组件适配</p>       <p>Web组件支持对前端页面进行深色模式配置，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-set-dark-mode">Web组件深色模式</a>进行相关配置。</p></li>      <li>       <p>"自定义节点"适配</p>       <p>自定义节点BuilderNode和ComponentContent需手动传递系统环境变化事件，触发节点的全量更新，详细请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#updateconfiguration12" target="_blank">BuilderNode系统环境变化更新</a>。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 记录创建的自定义节点对象</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">builderNodeMap</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt;&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFrameCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FrameCallback</span> {</li><li>  <span class="hljs-title function_">onFrame</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title function_">updateColorMode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateColorMode</span>(<span class="hljs-params"></span>) {</li><li>  builderNodeMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, index</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 通知BuilderNode环境变量改变，触发深浅色切换</span></li><li>    value.<span class="hljs-title function_">updateConfiguration</span>();</li><li>  })</li><li>}</li><li><span class="hljs-comment">// ... other code ...</span></li><li><span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li><span class="hljs-comment">// ... other code ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">postFrameCallback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFrameCallback</span>());</li><li><span class="hljs-comment">// ... other code ...</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>应用监听深浅色模式切换事件</p>       <p>应用可以主动监听系统深浅色模式变化，进行其他类型的资源初始化等自定义逻辑。应用使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#setcolormode18" target="_blank">setColorMode</a>手动设置深浅色的情况下，将不会收到onConfigurationUpdate回调。除此之外，无论应用是否跟随系统深浅色模式变化，该监听方式均可生效。</p>       <p>a. 在 AbilityStage 的 onCreate() 生命周期中获取APP当前的颜色模式并保存到 AppStorage。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentColorMode'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">colorMode</span>);</li><li>}</li></ol></pre></div></div>       <p>b. 在AbilityStage的onConfigurationUpdate()生命周期中获取最新更新的颜色模式并刷新到AppStorage。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'currentColorMode'</span>, newConfig.<span class="hljs-property">colorMode</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'the newConfig.colorMode is %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'currentColorMode'</span>)) ?? <span class="hljs-string">''</span>);</li><li>}</li></ol></pre></div></div>       <p>c. 在Page中通过 @StorageProp + @Watch 方式获取当前最新颜色并监听设备深色模式变化。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'currentColorMode'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onColorModeChange'</span>) <span class="hljs-attr">currentMode</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;</li></ol></pre></div></div>       <p>d. 在 aboutToAppear 初始化函数中根据当前最新颜色模式刷新状态变量。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentMode</span> == <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>) {</li><li>    <span class="hljs-comment">//当前为浅色模式，资源初始化逻辑</span></li><li>  }<span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">//当前为深色模式，资源初始化逻辑</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p>e. 在 @Watch 回调函数中执行同样的适配逻辑。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onColorModeChange</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentMode</span> == <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>) {</li><li>    <span class="hljs-comment">//当前为浅色模式，资源初始化逻辑</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">//当前为深色模式，资源初始化逻辑</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>局部深浅色适配</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-with-theme" target="_blank">WithTheme</a>可以设置三种<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-foreground-blur-style#themecolormode枚举说明" target="_blank">颜色模式</a>，分别为：跟随系统深浅色模式、固定使用浅色模式和固定使用深色模式。</p>       <p>在WithTheme作用范围内，组件的样式资源值将依据指定模式，读取对应的深浅色模式系统和应用资源值。这表明，在WithTheme作用范围内，组件的配色将根据指定的深浅模式进行调整。详情请参阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/theme_skinning#设置应用页面局部深浅色">设置应用页面局部深浅色</a>。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="应用主动设置深浅色模式">应用主动设置深浅色模式<i class="anchor-icon anchor-icon-link" anchorid="应用主动设置深浅色模式" tips="复制节点链接"></i></h2>          <p>应用默认配置为跟随系统切换深浅色模式，如不希望应用跟随系统深浅色模式变化，可主动设置应用的深浅色风格。设置后，应用的深浅色模式固定，不会随系统改变。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>应用未专门适配深色模式，直接跟随系统切换可能遇到深色模式下的显示异常，也可考虑使用该方法将本应用固定为浅色模式。</p>      </div></div></div>     <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="系统判定应用深浅色模式的规则">系统判定应用深浅色模式的规则<i class="anchor-icon anchor-icon-link" anchorid="系统判定应用深浅色模式的规则" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>如果应用调用上述setColorMode接口主动设置了深浅色，则以接口效果优先。</p></li>      <li>       <p>应用没有调用setColorMode接口时：</p>       <ul>        <li>         <p>如果应用工程dark目录下有深色资源，则系统组件在深色模式下会自动切换成为深色。</p></li>        <li>         <p>如果应用工程dark目录下没有任何深色资源，则系统组件在深色模式下仍会保持浅色体验。</p>         <p><span><img originheight="151" originwidth="364" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114754.31649532984703359164989828410446:50001231000000:2800:E4BEFC6F8C54F1D32FCCFD339537979DD0896FCC069F5EEE126E66C19BEE7E07.png" width="364" height="151"></span></p></li>       </ul></li>     </ol>     <p>如果应用全部都是由系统组件/系统颜色开发，且想要跟随系统切换深浅色模式时，请参考以下示例修改代码来保证应用体验。</p>     <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="深浅色模式的使用建议与注意事项">深浅色模式的使用建议与注意事项<i class="anchor-icon anchor-icon-link" anchorid="深浅色模式的使用建议与注意事项" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>建议方法</p>       <p>当应用跟随系统深色或浅色模式时，建议采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#onconfigurationupdate" target="_blank">AbilityStage的监听回调</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">Ability的监听回调</a>方式，主动监听系统深浅色模式变化。一旦颜色模式发生变化，应通过绑定状态变量等方法，执行特定的业务逻辑。</p></li>      <li>       <p>不推荐方法</p>       <p>开发者在使用资源时，未采用监听系统深浅色模式变化的方式，而是在属性设置中，通过函数返回值实现深浅色切换。例如以下写法：</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">getResource</span>() : <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-comment">// 获取系统颜色模式</span></li><li>  <span class="hljs-keyword">if</span> (colorMode == <span class="hljs-string">"dark"</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"#FF000000"</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"#FFFFFFFF"</span></li><li>  }</li><li>}</li><li><span class="hljs-comment">// ... other code ...</span></li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// ... other code ...</span></li><li>  <span class="hljs-title class_">Button</span>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getResource</span>())</li><li>  <span class="hljs-comment">// ... other code ...</span></li><li>}</li></ol></pre></div></div>       <p>这种方式依赖于切换流程中重新执行属性设置代码，随着系统的发展和性能优化，并不能确保所有属性代码均被重新执行。因为在大部分热更新场景中，重新执行全部页面构建和属性设置代码显然是冗余的。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="优化深浅色模式切换开销">优化深浅色模式切换开销<i class="anchor-icon anchor-icon-link" anchorid="优化深浅色模式切换开销" tips="复制节点链接"></i></h2>          <p>默认情况下，深浅色模式的切换需要执行全量重绘，包括重新设置所有组件的属性，性能开销会随着应用UI的复杂度线性增加。</p>     <p>从API version 20开始，系统提供了一种高性能的深浅色切换流程，开发者可通过新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#metadata标签">metadata</a>配置项开启该能力，从而实现深浅色切换时的开销更小。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>配置此metadata时，必须确保在属性设置中，没有通过函数返回值实现深浅色切换。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdsnavigation" target="_blank">HdsNavigation</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdsnavdestination" target="_blank">HdsNavDestination</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdstabs" target="_blank">HdsTabs</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdslistitemcard" target="_blank">HdsListItemCard</a>四个高级组件暂未适配，这些高级组件的颜色相关属性均需使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#onconfigurationupdate" target="_blank">AbilityStage的监听回调</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">Ability的监听回调</a>方式来处理。</p>      </div></div></div>     <ol>      <li>       <p>通过metadata开启深浅色切换优化选项。</p>       <p>优化深浅色模式切换开销，需在module.json5文件中新增metadata字段，同时需对部分组件的属性进行适配。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"metadata"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"configColorModeChangePerformanceInArkUI"</span>,</li><li>    <span class="hljs-string">"value"</span>: <span class="hljs-string">"true"</span></li><li>  }</li><li>]</li></ol></pre></div></div></li>      <li>       <p>应用的自定义行为需要正确适配。</p>       <p>开启深浅色切换优化选项后，深浅色切换不会全量重新执行前端代码和属性设置，仅会更新、重绘必要的属性，如果开发者之前在属性设置中通过函数适配深浅色更新将不会生效，这种情况需要开启优化流程前进行正确适配，可参考<a href="/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#深浅色模式的使用建议与注意事项">深浅色模式的使用建议与注意事项</a>进行适配。以下是三个典型的适配场景：</p></li>     </ol>     <ul>      <li>       <p>根据实时读取的深浅色模式返回不同资源值。</p>       <p>开启深浅色切换优化选项后，可以采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#onconfigurationupdate" target="_blank">AbilityStage的监听回调</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">Ability的监听回调</a>方式，主动监听系统深浅色模式变化，更新对应文本的文字颜色，示例代码如下：</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>
</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'colorMode'</span>, newConfig.<span class="hljs-property">colorMode</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MainPage</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'colorMode'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'colorModeChange'</span>) <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span> = <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-title class_">Resource</span> = $r(<span class="hljs-string">"app.color.color_light"</span>);</li><li>
</li><li>  <span class="hljs-title function_">colorModeChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">colorMode</span> === <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = $r(<span class="hljs-string">"app.color.color_light"</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = $r(<span class="hljs-string">"app.color.color_night"</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'fontColor'</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>根据判断自定义主题模式返回不同资源值。</p>       <p>开启深浅色切换优化选项后，需要将Text中文本内容和文本颜色与状态变量进行绑定，在接收到深浅色切换事件后通过状态变量更新实现组件属性的更新，示例代码如下：</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ResourceTheme.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ThemeMode</span> {</li><li>  mode1 = <span class="hljs-number">0</span>,</li><li>  mode2</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceTheme</span> {</li><li>  <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getColor</span>();</li><li>  <span class="hljs-attr">themeMode</span>: <span class="hljs-title class_">ThemeMode</span> = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">mode1</span>;</li><li>
</li><li>  <span class="hljs-title function_">setThemeMode</span>(<span class="hljs-params">mode: ThemeMode</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span> = mode</li><li>  }</li><li>  <span class="hljs-title function_">getThemeMode</span>(): <span class="hljs-title class_">ThemeMode</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span></li><li>  }</li><li>  <span class="hljs-title function_">getColor</span>(): <span class="hljs-title class_">ResourceColor</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span> === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">mode1</span>) {</li><li>      <span class="hljs-keyword">return</span> $r(<span class="hljs-string">"app.color.color_light"</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> $r(<span class="hljs-string">"app.color.color_night"</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ResourceTheme</span>, <span class="hljs-title class_">ThemeMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ResourceTheme'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MainPage</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'colorMode'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'colorModeChange'</span>) <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span> = <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>;</li><li>  resourceTheme = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceTheme</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-title class_">ResourceColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">getColor</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textContent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">getThemeMode</span>().<span class="hljs-title function_">toString</span>();</li><li>
</li><li>  <span class="hljs-title function_">colorModeChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">colorMode</span> === <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">setThemeMode</span>(<span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">mode1</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">setThemeMode</span>(<span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">mode2</span>)</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">getThemeMode</span>().<span class="hljs-title function_">toString</span>()</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceTheme</span>.<span class="hljs-title function_">getColor</span>()</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'ThemeMode is '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">textContent</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>根据读取的成员变量值返回不同资源值。</p>       <p>开启深浅色切换优化选项后，需要将文本文字颜色属性与状态变量绑定。在深浅色切换时通过回调函数更新状态变量，从而实现仅在下一次深浅色切换时发生属性更新的效果，示例代码如下：</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MainPage</span> {</li><li>  <span class="hljs-attr">mode</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'colorMode'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'colorModeChange'</span>) <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span> = <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-title class_">Resource</span> = $r(<span class="hljs-string">"app.color.color_light"</span>);</li><li>
</li><li>  <span class="hljs-title function_">colorModeChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mode</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span> $r(<span class="hljs-string">"app.color.color_light"</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> $r(<span class="hljs-string">"app.color.color_night"</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change mode'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">mode</span>++</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'fontColor'</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="利用反色能力快速适配深色模式">利用反色能力快速适配深色模式<i class="anchor-icon anchor-icon-link" anchorid="利用反色能力快速适配深色模式" tips="复制节点链接"></i></h2>          <p>从API version 20开始，对于有大量存量代码，之前已经通过<a href="/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#应用跟随系统的深浅色模式">资源配置</a>模式或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-with-theme" target="_blank">主题</a>方式，实现部分深色模式适配。可使用系统提供的反色能力，快速实现全量深色模式适配。</p>     <p>这种方式虽然管理上不如资源配置和主题方式精细可控，但适配工作量更低，应用包也不会因为大量的资源配置而膨胀，同时也能够带来一定程度上可以接受的视觉效果。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>反色能力需在<a href="/consumer/cn/doc/harmonyos-guides/ui-dark-light-color-adaptation#优化深浅色模式切换开销">优化深浅色模式切换开销</a>使用的前提下使用。</p>      </div></div></div>     <ol>      <li>       <p>使用反色能力。</p>       <p>从API version 20开始，ArkUI开发框架新增了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_setforcedarkconfig" target="_blank">OH_ArkUI_SetForceDarkConfig</a>接口，提供反色能力。该功能可根据开发者自定义的反色算法，在深浅色切换时自动对颜色属性进行反色。反色能力只有在颜色属性设置为非资源值时生效，若通过$r设置颜色属性，则优先生效资源文件中配置的颜色值。</p>       <p>在应用开发时，可能会涉及到多个颜色属性的设置，当该属性不存在深色模式颜色资源的配置时，使用该能力可以快速实现深色模式的适配。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>1.调用OH_ArkUI_SetForceDarkConfig前，需确保已加载过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-h#oh_arkui_querymoduleinterfacebyname" target="_blank">OH_ArkUI_QueryModuleInterfaceByName(ARKUI_NATIVE_NODE, "ArkUI_NativeNodeAPI_1")</a>。</p>         <p>2.OH_ArkUI_SetForceDarkConfig接口一定要在节点创建前的UI线程中调用。<strong>页面创建完成后，不支持通过该接口动态修改应用的反色能力生效状态。</strong></p>         <p>3.OH_ArkUI_SetForceDarkConfig接口仅支持进程级生效，暂不支持不同实例使用不同的反色算法。</p>         <p>4.OH_ArkUI_SetForceDarkConfig接口仅支持CAPI接口，考虑到反色算法在深浅色切换时会被频繁调用，采用C-API接口可以避免存在大量的跨语言调用开销。</p>         <p>5.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-methods-datepicker-dialog" target="_blank">DatePickerDialog</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-methods-timepicker-dialog" target="_blank">TimePickerDialog</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-methods-calendarpicker-dialog" target="_blank">CalendarPickerDialog</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-methods-textpicker-dialog" target="_blank">TextPickerDialog</a>由于不存在实体节点，无法使能反色算法。</p>         <p>6.TextArea中NODE_BORDER_COLOR、NODE_TEXT_RADIAL_GRADIENT及NODE_TEXT_LINEAR_GRADIENT等属性无法使能反色算法。</p>        </div></div></div>       <p>本示例展示OH_ArkUI_SetForceDarkConfig接口的基础使用方式，自定义反色算法根据开发者实际场景进行设置，便于深浅色切换时展示不同的颜色值。</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_ArkUI_SetForceDarkConfig</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">true</span>, ArkUI_NodeType::ARKUI_NODE_UNDEFINED, <span class="hljs-literal">nullptr</span>); <span class="hljs-comment">// 对所有组件使用x系统默认反色算法，即三原色取反。</span></li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// page1 ArkTs侧创建组件使用反色能力。</span></li><li><span class="hljs-comment">// 前置已默认对所有组件使用默认反色算法，深浅色切换时会对文本的文字颜色进行反色，浅色模式下展示为黑色字体，深色模式下展示为白色字体。</span></li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// ... other code ...</span></li><li>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"测试反色算法"</span>)</li><li>    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>  <span class="hljs-comment">// ... other code ...</span></li><li>}</li></ol></pre></div></div>       <p>OH_ArkUI_SetForceDarkConfig接口不同入参效果如下：</p>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开发者自定义的反色算法函数。</span></li><li><span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">colorInvertFunc</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> color)</span> </span>{</li><li>  <span class="hljs-keyword">return</span> ~color;</li><li>}</li><li><span class="hljs-built_in">OH_ArkUI_SetForceDarkConfig</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">true</span>, ArkUI_NodeType::ARKUI_NODE_UNDEFINED, colorInvertFunc); <span class="hljs-comment">// 对所有组件使用自定义反色算法。</span></li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_ArkUI_SetForceDarkConfig</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">false</span>, ArkUI_NodeType::ARKUI_NODE_UNDEFINED, <span class="hljs-literal">nullptr</span>); <span class="hljs-comment">// 对所有组件停用反色能力，深浅色切换使用系统原始逻辑。</span></li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_ArkUI_SetForceDarkConfig</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">true</span>, ArkUI_NodeType::ARKUI_NODE_TEXT, <span class="hljs-literal">nullptr</span>); <span class="hljs-comment">// 仅对文本组件使用默认反色算法。</span></li></ol></pre></div></div>       <div _ngcontent-qkf-c106="" class="highlight-div"><div _ngcontent-qkf-c106="" class="highlight-div-header"><div _ngcontent-qkf-c106="" class="highlight-div-header-left"><div _ngcontent-qkf-c106="" class="handle-button expand-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qkf-c106="" class="highlight-div-header-right"><div _ngcontent-qkf-c106="" class="handle-button ai-button"></div><div _ngcontent-qkf-c106="" class="handle-button line-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qkf-c106="" class="handle-button theme-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qkf-c106="" class="handle-button copy-button"><div _ngcontent-qkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开发者自定义的反色算法函数。</span></li><li><span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">colorInvertFunc</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> color)</span> </span>{</li><li>  <span class="hljs-keyword">return</span> ~color;</li><li>}</li><li><span class="hljs-built_in">OH_ArkUI_SetForceDarkConfig</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">true</span>, ArkUI_NodeType::ARKUI_NODE_TEXT, colorInvertFunc); <span class="hljs-comment">// 仅对文本组件使用自定义反色算法。</span></li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>           <p>不支持全局禁用反色能力的同时仅对某类组件使用反色算法。</p></li>          <li>           <p>不支持全局使用反色能力的同时仅对某类组件禁用反色算法。</p></li>         </ul>        </div></div></div></li>      <li>       <p>反色算法生效优先级说明。</p>       <p>a. 使用开发者深色模式颜色资源的配置。</p>       <p>b. 使用开发者为本进程中指定组件配置的反色算法。</p>       <p>c. 使用开发者为本进程中所有组件配置的反色算法。</p></li>      <li>       <p>反色能力逃生通道。</p>       <p>从API version 21开始，基于开发者当前实现，开发者可以通过主动设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-allow-force-dark#allowforcedark" target="_blank">allowForceDark</a>属性，禁用指定组件的自动反色能力，维持深浅色切换时的原有逻辑，即使用主题或资源值切换。</p></li>     </ol>    </div>   </div>   <div></div></div>