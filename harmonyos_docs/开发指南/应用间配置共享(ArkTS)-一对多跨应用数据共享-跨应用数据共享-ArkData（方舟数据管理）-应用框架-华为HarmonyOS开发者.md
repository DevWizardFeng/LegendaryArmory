<h1 _ngcontent-sgo-c119="" class="doc-title ng-star-inserted" title="应用间配置共享 (ArkTS)"> 应用间配置共享 (ArkTS) </h1>

<div _ngcontent-sgo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>应用间配置共享通过集中管理公共配置信息，在不同应用间共享配置，提升协作效率。</p>     <p>从API version 20开始，支持应用间配置共享。</p>    </div>    <div class="tiledSection">     <h2 id="运作机制">运作机制<i class="anchor-icon anchor-icon-link" anchorid="运作机制" tips="复制节点链接"></i></h2>          <p>应用间配置共享运作机制如下所示：</p>     <ol>      <li><strong>配置发布方（即数据提供方）</strong>：负责提供默认共享配置项，并能动态修改配置项信息。当前支持静态配置和动态配置两种配置方式。       <ul>        <li><strong>静态配置</strong>：应用包在安装时提供的默认共享配置项（不依赖应用启动即生效）。</li>        <li><strong>动态配置</strong>：配置发布方通过调用相关接口可以动态新增、删除或修改配置项（不依赖应用升级）。</li>       </ul></li>      <li><strong>配置访问方（即数据访问方）</strong>：可通过调用接口获取配置信息、或者监听/取消监听配置变化。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <p>一个应用最多可以发布32个配置项，这个数量是静态配置与动态配置的总和。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>以下接口为应用间配置共享的相关接口。详细接口和说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-datashare#datasharecreatedataproxyhandle20" target="_blank">应用间配置共享接口</a>。</p>    </div>    <div class="tiledSection">     <h3 id="公共接口" class="firsth2">公共接口<i class="anchor-icon anchor-icon-link" anchorid="公共接口" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">createDataProxyHandle(): Promise&lt;DataProxyHandle&gt;</td>         <td class="cellrowborder" valign="top" width="50%">创建数据代理操作句柄，可用于订阅、发布、获取等操作。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="配置发布方接口">配置发布方接口<i class="anchor-icon anchor-icon-link" anchorid="配置发布方接口" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">publish(data: ProxyData[], config: DataProxyConfig): Promise&lt;DataProxyResult[]&gt;</td>         <td class="cellrowborder" valign="top" width="50%">发布或修改配置项。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">delete(uris: string[], config: DataProxyConfig): Promise&lt;DataProxyResult[]&gt;</td>         <td class="cellrowborder" valign="top" width="50%">删除配置项。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="配置访问方接口">配置访问方接口<i class="anchor-icon anchor-icon-link" anchorid="配置访问方接口" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">get(uris: string[], config: DataProxyConfig): Promise&lt;DataProxyGetResult[]&gt;</td>         <td class="cellrowborder" valign="top" width="50%">获取配置项信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">on(event: 'dataChange', uris: string[], config: DataProxyConfig, callback: AsyncCallback&lt;DataProxyChangeInfo[]&gt;): DataProxyResult[]</td>         <td class="cellrowborder" valign="top" width="50%">监听配置项变化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">off(event: 'dataChange', uris: string[], config: DataProxyConfig, callback?: AsyncCallback&lt;DataProxyChangeInfo[]&gt;): DataProxyResult[]</td>         <td class="cellrowborder" valign="top" width="50%">取消监听配置项变化。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="配置发布方">配置发布方<i class="anchor-icon anchor-icon-link" anchorid="配置发布方" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="modulejson5-配置" class="firsth2">module.json5 配置<i class="anchor-icon anchor-icon-link" anchorid="modulejson5-配置" tips="复制节点链接"></i></h3>          <p>配置发布方需要配置module.json5文件中的crossAppSharedConfig字段，通过crossAppSharedConfig字段引用shared_config.json文件，shared_config.json为共享配置文件，定义了应用希望与其他应用共享的配置项。共享配置文件需放置在工程resources/base/profile目录下，并通过$资源访问方式引用。</p>     <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"crossAppSharedConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:shared_config"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <p>共享配置文件shared_config.json的文件名"shared_config"可自定义，根节点名称为crossAppSharedConfig，为对象数组，标识当前共享配置项的数量。（一个应用最多可以发布32个配置项，这个数量是静态配置项与动态配置项的总和。静态配置项数量超过32时，只解析前32个符合crossAppSharedConfig字段配置说明要求的配置项，其余配置项不生效。）</p>     <p>crossAppSharedConfig字段配置说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.1" valign="top" width="25%">属性名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.2" valign="top" width="25%">含义</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.3" valign="top" width="25%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.4" valign="top" width="25%">必填</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">uri</td>         <td class="cellrowborder" valign="top" width="25%">共享配置项的全局唯一标识。固定格式为"datashareproxy://{bundleName}/{path}"，其中bundleName为配置发布方应用的bundleName，path可随意填写，但同一应用内不允许重复。uri最大长度为256字节。</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">value</td>         <td class="cellrowborder" valign="top" width="25%">共享配置项的值，最大长度为4096字节。</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">allowList</td>         <td class="cellrowborder" valign="top" width="25%">允许访问该共享配置项的应用程序列表。数组最大长度为256，超过256的部分不生效。数组中每个元素为应用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/common_problem_of_application#什么是appidentifier">appIdentifier</a>，单个appIdentifier为只包含数字的字符串，最大长度为128字节，超过128字节的appIdentifier不会生效。可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-bundlemanager#bundlemanagergetbundleinfoforself" target="_blank">getBundleInfoForSelf</a>接口来获取当前应用的appIdentifier。</td>         <td class="cellrowborder" valign="top" width="25%">字符串数组</td>         <td class="cellrowborder" valign="top" width="25%">是</td>        </tr>             </tbody></table></div>     </div>     <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"crossAppSharedConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"uri"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"datashareproxy://com.example.example/key1"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SHARED_CONFIG_DEMO1"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"allowList"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"6917573629901742292"</span><span class="hljs-punctuation">]</span></li><li>        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"uri"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"datashareproxy://com.example.example/key2"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"SHARED_CONFIG_DEMO2"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"allowList"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"6917573298752100864"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"6917573298752100864"</span><span class="hljs-punctuation">]</span></li><li>        <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="静态配置">静态配置<i class="anchor-icon anchor-icon-link" anchorid="静态配置" tips="复制节点链接"></i></h3>          <p>应用包在安装时提供的默认共享配置项，即在应用安装过程中，预先定义并设置好的共享配置项，这些配置项不依赖应用的启动即可生效。</p>    </div>    <div class="tiledSection">     <h3 id="动态配置">动态配置<i class="anchor-icon anchor-icon-link" anchorid="动态配置" tips="复制节点链接"></i></h3>          <p>可通过调用publish接口或delete接口，动态新增、删除或修改配置项。</p>     <ul>      <li>       <p>通过调用publish接口发布或修改配置项。</p>       <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { dataShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publish</span>(<span class="hljs-params"></span>) {</li><li>  dataShare.<span class="hljs-title function_">createDataProxyHandle</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dsProxyHelper</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">newConfigData</span>: dataShare.<span class="hljs-property">ProxyData</span>[] = [{</li><li>      <span class="hljs-attr">uri</span>: <span class="hljs-string">'datashareproxy://com.example.app1/config1'</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-string">'Value1'</span>,</li><li>      <span class="hljs-attr">allowList</span>: [<span class="hljs-string">'com.example.app2'</span>, <span class="hljs-string">'com.example.app3'</span>],</li><li>    }, {</li><li>      <span class="hljs-attr">uri</span>: <span class="hljs-string">'datashareproxy://com.example.app1/config2'</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-string">'Value2'</span>,</li><li>      <span class="hljs-attr">allowList</span>: [<span class="hljs-string">'com.example.app3'</span>, <span class="hljs-string">'com.example.app4'</span>],</li><li>    },];</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: dataShare.<span class="hljs-property">DataProxyConfig</span> = {</li><li>      <span class="hljs-attr">type</span>: dataShare.<span class="hljs-property">DataProxyType</span>.<span class="hljs-property">SHARED_CONFIG</span>,</li><li>    };</li><li>    dsProxyHelper.<span class="hljs-title function_">publish</span>(newConfigData, config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results: dataShare.DataProxyResult[]</span>) =&gt;</span> {</li><li>      results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`URI: <span class="hljs-subst">${result.uri}</span>, Result: <span class="hljs-subst">${result.result}</span>`</span>);</li><li>      });</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error publishing config:'</span>, error);</li><li>    });</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error creating DataProxyHandle:'</span>, error);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过调用delete接口删除配置项。</p>       <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { dataShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteShareConfig</span>(<span class="hljs-params"></span>) {</li><li>  dataShare.<span class="hljs-title function_">createDataProxyHandle</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dsProxyHelper</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">urisToDelete</span>: <span class="hljs-built_in">string</span>[] =</li><li>      [<span class="hljs-string">'datashareproxy://com.example.app1/config1'</span>, <span class="hljs-string">'datashareproxy://com.example.app1/config2'</span>,];</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: dataShare.<span class="hljs-property">DataProxyConfig</span> = {</li><li>      <span class="hljs-attr">type</span>: dataShare.<span class="hljs-property">DataProxyType</span>.<span class="hljs-property">SHARED_CONFIG</span>,</li><li>    };</li><li>    dsProxyHelper.<span class="hljs-title function_">delete</span>(urisToDelete, config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results: dataShare.DataProxyResult[]</span>) =&gt;</span> {</li><li>      results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`URI: <span class="hljs-subst">${result.uri}</span>, Result: <span class="hljs-subst">${result.result}</span>`</span>);</li><li>      });</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error deleting config:'</span>, error);</li><li>    });</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error creating DataProxyHandle:'</span>, error);</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="配置访问方">配置访问方<i class="anchor-icon anchor-icon-link" anchorid="配置访问方" tips="复制节点链接"></i></h2>          <p>配置访问方可以通过调用get、on或off接口来获取配置信息或监听/取消监听配置变化。</p>    </div>    <div class="tiledSection">     <h3 id="获取配置项信息" class="firsth2">获取配置项信息<i class="anchor-icon anchor-icon-link" anchorid="获取配置项信息" tips="复制节点链接"></i></h3>          <p>使用get接口获取配置信息。</p>     <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { dataShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) {</li><li>  dataShare.<span class="hljs-title function_">createDataProxyHandle</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dsProxyHelper</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">urisToGet</span>: <span class="hljs-built_in">string</span>[] =</li><li>      [<span class="hljs-string">'datashareproxy://com.example.app1/config1'</span>, <span class="hljs-string">'datashareproxy://com.example.app1/config2'</span>,];</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: dataShare.<span class="hljs-property">DataProxyConfig</span> = {</li><li>      <span class="hljs-attr">type</span>: dataShare.<span class="hljs-property">DataProxyType</span>.<span class="hljs-property">SHARED_CONFIG</span>,</li><li>    };</li><li>    dsProxyHelper.<span class="hljs-title function_">get</span>(urisToGet, config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results: dataShare.DataProxyGetResult[]</span>) =&gt;</span> {</li><li>      results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`URI: <span class="hljs-subst">${result.uri}</span>, Result: <span class="hljs-subst">${result.result}</span>, AllowList: <span class="hljs-subst">${result.allowList}</span>`</span>);</li><li>      });</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error getting config:'</span>, error);</li><li>    });</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error creating DataProxyHandle:'</span>, error);</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听取消监听配置变化">监听/取消监听配置变化<i class="anchor-icon anchor-icon-link" anchorid="监听取消监听配置变化" tips="复制节点链接"></i></h3>          <p>使用on接口监听配置变化，使用off接口取消监听配置变化。</p>     <div _ngcontent-sgo-c106="" class="highlight-div"><div _ngcontent-sgo-c106="" class="highlight-div-header"><div _ngcontent-sgo-c106="" class="highlight-div-header-left"><div _ngcontent-sgo-c106="" class="handle-button expand-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sgo-c106="" class="highlight-div-header-right"><div _ngcontent-sgo-c106="" class="handle-button ai-button"></div><div _ngcontent-sgo-c106="" class="handle-button line-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sgo-c106="" class="handle-button theme-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sgo-c106="" class="handle-button copy-button"><div _ngcontent-sgo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sgo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { dataShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">watchConfigChanges</span>(<span class="hljs-params"></span>) {</li><li>  dataShare.<span class="hljs-title function_">createDataProxyHandle</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dsProxyHelper</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">uris</span>: <span class="hljs-built_in">string</span>[] =</li><li>      [<span class="hljs-string">'datashareproxy://com.example.app1/config1'</span>, <span class="hljs-string">'datashareproxy://com.example.app1/config2'</span>,];</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: dataShare.<span class="hljs-property">DataProxyConfig</span> = {</li><li>      <span class="hljs-attr">type</span>: dataShare.<span class="hljs-property">DataProxyType</span>.<span class="hljs-property">SHARED_CONFIG</span>,</li><li>    };</li><li>    <span class="hljs-keyword">const</span> callback = (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>&lt;<span class="hljs-built_in">void</span>&gt;, <span class="hljs-attr">changes</span>: dataShare.<span class="hljs-property">DataProxyChangeInfo</span>[]): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'err:'</span>, err);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        changes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">change</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Change Type: <span class="hljs-subst">${change.<span class="hljs-keyword">type</span>}</span>, URI: <span class="hljs-subst">${change.uri}</span>, Value: <span class="hljs-subst">${change.value}</span>`</span>);</li><li>        });</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 监听配置变化</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">listenResults</span>: dataShare.<span class="hljs-property">DataProxyResult</span>[] = dsProxyHelper.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataChange'</span>, uris, config, callback);</li><li>    listenResults.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`URI: <span class="hljs-subst">${result.uri}</span>, Result: <span class="hljs-subst">${result.result}</span>`</span>);</li><li>    });</li><li>    <span class="hljs-comment">// 取消监听配置变化</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">unListenResults</span>: dataShare.<span class="hljs-property">DataProxyResult</span>[] = dsProxyHelper.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataChange'</span>, uris, config, callback);</li><li>    unListenResults.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`URI: <span class="hljs-subst">${result.uri}</span>, Result: <span class="hljs-subst">${result.result}</span>`</span>);</li><li>    });</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error creating DataProxyHandle:'</span>, error);</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>