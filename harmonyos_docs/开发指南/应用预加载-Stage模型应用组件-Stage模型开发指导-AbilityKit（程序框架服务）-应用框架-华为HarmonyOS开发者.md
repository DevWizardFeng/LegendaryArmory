<h1 _ngcontent-ecg-c119="" class="doc-title ng-star-inserted" title="应用预加载"> 应用预加载 </h1>

<div _ngcontent-ecg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>从API version 20开始，提供应用预加载机制。该机制会根据用户的使用习惯，在系统资源充足时提前加载应用至特定阶段。当用户启动应用时，由于此前已完成了应用的部分加载，所需的启动时间会缩短，有助于提升用户体验和应用竞争力。</p>     <p>该机制尤其适用于因加载大量资源而启动耗时较长的应用，例如大型游戏应用和大型办公应用。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>当前仅支持2in1设备。</p></li>      <li>       <p>仅支持entry模块的AbilityStage和UIAbility预加载。无论预加载到哪种阶段，entry模块必须配置入口UIAbility，详见<a href="/consumer/cn/doc/harmonyos-guides/preload-application#开发步骤">开发步骤</a>中步骤2。</p></li>      <li>       <p>应用配置预加载后，实际是否进行预加载以及具体的预加载时机，均由系统根据用户习惯等信息来综合决定。开发者无法对此进行干预。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="运行机制">运行机制<i class="anchor-icon anchor-icon-link" anchorid="运行机制" tips="复制节点链接"></i></h2>          <p>当系统资源充足时，系统将应用加载到特定阶段，提升启动速度。当前支持预加载到三种阶段。开发者可以根据应用冷启动各阶段耗时情况，选择其中的一种。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在应用预加载过程中不会显示任何界面，因此在预加载的任何阶段不应包含与界面显示、界面交互或依赖用户可见的相关操作，同时应确保用户正式启动应用后，所有功能正常运行且体验不受影响。</p>      </div></div></div>     <ul>      <li>       <p>processCreated：进程创建完成阶段。开发者配置此阶段后，预加载机制会创建空进程并初始化Application，但是不会触发任何生命周期回调。</p></li>      <li>       <p>abilityStageCreated：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage" target="_blank">AbilityStage</a>创建完成阶段。开发者配置此阶段后，预加载机制会创建空进程并初始化Application，随后触发entry模块<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage" target="_blank">AbilityStage</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#oncreate" target="_blank">onCreate</a>回调。</p></li>      <li>       <p>windowStageCreated：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-windowstage" target="_blank">WindowStage</a>创建完成阶段。开发者配置此阶段后，预加载机制会创建空进程并初始化Application，随后触发entry模块<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage" target="_blank">AbilityStage</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#oncreate" target="_blank">onCreate</a>回调。接着会拉起entry模块的入口UIAbility，并触发其<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>回调和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onwindowstagecreate" target="_blank">onWindowStageCreate</a>回调。开发者可以在UIAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>回调中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilityconstant#launchreason" target="_blank">launchParam.launchReason</a>的枚举值获取启动原因。枚举值为PRELOAD表示当前UIAbility是由预加载机制启动的。</p></li>     </ul>     <p><span><img originheight="150" originwidth="1190" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114856.46379109595422842444407517854125:50001231000000:2800:2C175C78D4BABC7FFC280A3B0B88992EEE142786A4E341FA47DD191C845352B5.png" width="920" height="115.96638655462185"></span></p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>声明应用支持预加载到的阶段。</p>       <p>以windowStageCreated阶段为例，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file">app.json5配置文件</a>中配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file#配置文件标签">appPreloadPhase</a>标签。</p>       <div _ngcontent-ecg-c106="" class="highlight-div"><div _ngcontent-ecg-c106="" class="highlight-div-header"><div _ngcontent-ecg-c106="" class="highlight-div-header-left"><div _ngcontent-ecg-c106="" class="handle-button expand-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecg-c106="" class="highlight-div-header-right"><div _ngcontent-ecg-c106="" class="handle-button ai-button"></div><div _ngcontent-ecg-c106="" class="handle-button line-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecg-c106="" class="handle-button theme-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecg-c106="" class="handle-button copy-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"bundleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.demo.preloadtest"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"vendor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"example"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"versionCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000000</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"versionName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:layered_image"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:app_name"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"appPreloadPhase"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"windowStageCreated"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>配置入口UIAbility（新建工程默认已自动配置）。</p>       <ol>        <li>         <p>以EntryAbility为例，在entry模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中，设置mainElement为EntryAbility，且EntryAbility的skills标签下面的entities中添加"entity.system.home"、actions中添加"ohos.want.action.home"。</p></li>        <li>         <p>当<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file">app.json5配置文件</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file#配置文件标签">appPreloadPhase</a>配置为windowStageCreated时，需要在entry模块的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中配置EntryAbility的launchType标签为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-launch-type#singleton启动模式">singleton</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-launch-type#specified启动模式">specified</a>。</p></li>       </ol>       <div _ngcontent-ecg-c106="" class="highlight-div"><div _ngcontent-ecg-c106="" class="highlight-div-header"><div _ngcontent-ecg-c106="" class="highlight-div-header-left"><div _ngcontent-ecg-c106="" class="handle-button expand-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecg-c106="" class="highlight-div-header-right"><div _ngcontent-ecg-c106="" class="handle-button ai-button"></div><div _ngcontent-ecg-c106="" class="handle-button line-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecg-c106="" class="handle-button theme-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecg-c106="" class="handle-button copy-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"mainElement"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"launchType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"singleton"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"entities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>              <span class="hljs-string">"entity.system.home"</span></li><li>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>              <span class="hljs-string">"ohos.want.action.home"</span></li><li>            <span class="hljs-punctuation">]</span></li><li>          <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span></li><li>        <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>（可选）获取UIAbility启动原因。</p>       <p>仅当appPreloadPhase配置为windowStageCreated时，开发者可在UIAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>生命周期回调中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilityconstant#launchreason" target="_blank">launchParam.launchReason</a>的枚举值获取启动原因。枚举值为PRELOAD表示当前UIAbility是由预加载机制启动的。</p>       <div _ngcontent-ecg-c106="" class="highlight-div"><div _ngcontent-ecg-c106="" class="highlight-div-header"><div _ngcontent-ecg-c106="" class="highlight-div-header-left"><div _ngcontent-ecg-c106="" class="handle-button expand-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecg-c106="" class="highlight-div-header-right"><div _ngcontent-ecg-c106="" class="handle-button ai-button"></div><div _ngcontent-ecg-c106="" class="handle-button line-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecg-c106="" class="handle-button theme-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecg-c106="" class="handle-button copy-button"><div _ngcontent-ecg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`EntryAbility onCreate, LaunchReason:<span class="hljs-subst">${launchParam.launchReason}</span>`</span>);</li><li>    <span class="hljs-comment">// 判断是否是预加载启动</span></li><li>    <span class="hljs-keyword">let</span> isPreloadStart = launchParam.<span class="hljs-property">launchReason</span> === <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchReason</span>.<span class="hljs-property">PRELOAD</span>;</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>