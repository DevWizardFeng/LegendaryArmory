<h1 _ngcontent-ynw-c119="" class="doc-title ng-star-inserted" title="开发Hvigor插件"> 开发Hvigor插件 </h1>

<div _ngcontent-ynw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001778674577"><p id="ZH-CN_TOPIC_0000002478174404__p92621420141610">Hvigor允许开发者实现自己的插件，开发者可以定义自己的构建逻辑，并与他人共享。</p> <p id="ZH-CN_TOPIC_0000002478174404__p161309351185">Hvigor主要提供了两种方式来实现插件：基于hvigorfile脚本开发插件、基于typescript项目开发。</p> <p id="ZH-CN_TOPIC_0000002478174404__p44571655665">关于插件开发的具体实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-custom-hvigor-plugin" target="_blank">定制hvigor插件开发实践</a>。</p> <div class="tiledSection"><h2 id="section552855418188">基于hvigorfile脚本开发<i class="anchor-icon anchor-icon-link" anchorid="section552855418188" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174404__p18671183612816">基于hvigorfile.ts脚本开发的方式，其优点是可实现快速开发，直接编辑工程或模块下hvigorfile.ts即可编写插件代码，不足之处是在多个项目中，无法方便的进行插件代码的复用和共享分发。</p> <p id="ZH-CN_TOPIC_0000002478174404__p18761115420349"></p> <ol id="ZH-CN_TOPIC_0000002478174404__ol59082415408"><li id="li66364165418"><span>导入模块依赖，更多接口请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-apis">扩展构建API</a>。</span><p></p><div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174404__screen4517183216416" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hvigorfile.ts</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HvigorPlugin</span>, <span class="hljs-title class_">HvigorNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hvigor'</span>;</li></ol></pre></div></div> <p></p></li><li id="li189042418406"><span>编写插件代码，实现HvigorPlugin接口。</span><p></p><div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174404__screen1590410115371" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">// </span></span><span class="hljs-comment">hvigorfile.ts</span></li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">customPlugin</span></span><span class="">(<span class="hljs-params"></span>)</span><span class="">: </span><span class=""><span class="hljs-title class_">HvigorPlugin</span> </span><span class="">{</span></li><li>  <span class="hljs-keyword">return</span> <span class="">{</span></li><li>    <span class=""><span class="hljs-attr">pluginId</span></span><span class="">: </span><span class=""><span class="hljs-string">'customPlugin'</span></span><span class="">,</span></li><li>    <span class=""><span class="hljs-title function_">apply</span></span><span class="">(</span><span class=""><span class="hljs-params">node</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">HvigorNode</span></span><span class="">) </span><span class="">{</span></li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">插件主体</span></span></li><li>      <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">log</span></span><span class="">(</span><span class=""><span class="hljs-string">'hello customPlugin!'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span></li><li><span class="">  }</span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p></li><li id="li1332113273712"><span>在导出声明中使用插件。</span><p></p><div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002478174404__screen12911958193813" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hvigorfile.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="">{</span></li><li>  <span class="">system</span><span class="">: </span><span class="">appTasks</span><span class="">,</span></li><li>  <span class="">plugins</span><span class="">:</span><span class="">[</span></li><li>    <span class=""><span class="hljs-built_in">customPlugin</span></span><span class="">()  </span><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">应用自定义</span></span><span class=""><span class="hljs-comment">Plugin</span></span></li><li>  <span class="">]</span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p></li><li id="li167421155113717"><span>执行Hvigor命令。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p5691102216435">执行Hvigor命令时，在Hvigor生命周期配置阶段执行插件中的apply方法。</p> <p id="ZH-CN_TOPIC_0000002478174404__p14862112710496"><span><img originheight="133" originwidth="513" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104907.93547596553301402491118745553681:50001231000000:2800:F0BE9E91D82491461C4DF2CAFAD6525687FDDBF62BAF2FD10DFEC57FE48C74EE.png" width="513" height="133"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section1825121193616">基于typescript项目开发<i class="anchor-icon anchor-icon-link" anchorid="section1825121193616" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174404__p6363135134711">基于typescript项目开发较好地弥补了上一小节中使用hvigorfile脚本方式编写插件代码不易复用和共享分发的问题。因此通常情况下推荐此方式开发。</p> </div> <div class="tiledSection"><h3 id="section1243715533156" class="firsth2">初始化typescript项目<i class="anchor-icon anchor-icon-link" anchorid="section1243715533156" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174404__ol34061818131013"><li id="li73777163615"><span>创建一个空目录。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p16781122163710">在命令行工具中使用cd命令进入空目录下。</p> <p></p></li><li id="li106051115182416"><span>安装typescript模块。</span><p></p><div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002478174404__screen19748135258" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 全局安装TypeScript</span></li><li>npm install typescript -g</li></ol></pre></div></div> <p></p></li><li id="li159271027101512"><span>初始化npm项目。</span><p></p><div class="p" id="ZH-CN_TOPIC_0000002478174404__p134713917385">执行如下命令，根据命令行指示配置项目。初始化完成后会生成package.json文件。<div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" id="ZH-CN_TOPIC_0000002478174404__screen16296103518178" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化一个npm项目</span></li><li>npm <span class="hljs-keyword">init</span></li></ol></pre></div></div> </div> <p></p></li><li id="li19866424191516"><span>生成typescript配置文件。</span><p></p><div class="p" id="ZH-CN_TOPIC_0000002478174404__p6211557195218">执行如下命令生成tsconfig.json文件。<div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" id="ZH-CN_TOPIC_0000002478174404__screen111917233012" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化typeScript配置文件</span></li><li>tsc --<span class="hljs-keyword">init</span></li></ol></pre></div></div> </div> <p id="ZH-CN_TOPIC_0000002478174404__p7250424104311"><span><img height="99.042041" originheight="108" originwidth="248" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104907.05856582693575603578190702504075:50001231000000:2800:7C23AA496E5EA1B6414D1DAF3182C3F2AE24DE73BD1B3286B072D8871C2CBD32.png" width="227.43" class="notEnlarge"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section627771916612">开发插件<i class="anchor-icon anchor-icon-link" anchorid="section627771916612" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002478174404__ol1771012490454"><li id="li34334575309"><span>配置npm镜像仓库地址，用于安装@ohos/hvigor插件。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p144266342329">在工程目录下创建.npmrc文件，配置如下信息：</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" id="ZH-CN_TOPIC_0000002478174404__screen139252268336" data-highlighted="yes"><ol class="linenums"><li>registry=<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/repo.huaweicloud.com/repository</span><span class="hljs-regexp">/npm/</span></li><li><span class="hljs-variable">@ohos</span><span class="hljs-symbol">:registry=https</span><span class="hljs-symbol">://repo</span>.harmonyos.com/npm/</li></ol></pre></div></div> <p></p></li><li id="li1242815218469"><span>添加依赖声明。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p9876113512477">打开package.json添加devDependencies配置。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174404__screen549711276479" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"devDependencies"</span>: {</li><li>    <span class="hljs-string">"@ohos/hvigor"</span>: <span class="hljs-string">"5.2.2"</span></li><li>}</li></ol></pre></div></div> <p></p></li><li id="li15890313476"><span>安装依赖。</span><p></p><div class="p" id="ZH-CN_TOPIC_0000002478174404__p18882225115219">执行如下命令安装依赖。<div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174404__screen755605345015" data-highlighted="yes"><ol class="linenums"><li>npm install</li></ol></pre></div></div> </div> <p></p></li><li id="li6178335145018"><span>编写插件代码。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p1567912795811">在src/plugin目录下创建custom-plugin.ts文件，编写插件代码，更多接口请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-apis">扩展构建API</a>。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174404__screen35943384711" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> type <span class="">{ </span><span class=""><span class="hljs-title class_">HvigorNode</span></span><span class="">, </span><span class=""><span class="hljs-title class_">HvigorPlugin</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@ohos/hvigor'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">customPlugin</span></span><span class="">(<span class="hljs-params"></span>)</span><span class="">: </span><span class=""><span class="hljs-title class_">HvigorPlugin</span> </span><span class="">{</span></li><li>  <span class="hljs-keyword">return</span> <span class="">{</span></li><li>    <span class=""><span class="hljs-attr">pluginId</span></span><span class="">: </span><span class=""><span class="hljs-string">'customPlugin'</span></span><span class="">,</span></li><li>    <span class=""><span class="hljs-title function_">apply</span></span><span class="">(</span><span class=""><span class="hljs-params">node</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">HvigorNode</span></span><span class="">) </span><span class="">{</span></li><li>      <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">log</span></span><span class="">(</span><span class=""><span class="hljs-string">'hello customPlugin!'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span></li><li><span class="">  }</span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p></li><li id="li14621114141117"><span>添加配置。如果插件代码中没有export function，跳过该步骤。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p135143172116">在package.json文件中增加type配置，使用ESM语法。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" id="ZH-CN_TOPIC_0000002478174404__screen2709945161311" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span></li></ol></pre></div></div> <p></p></li><li id="li99318812543"><span>导出插件。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p63658128592">创建index.ts文件，并在该文件中声明插件方法的导出。由于.ts最终会编译成.js文件，因此需要导出.js文件。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174404__screen522854119012" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> { customPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/plugin/custom-plugin.js'</span>;</li></ol></pre></div></div> <p></p></li></ol> <div class="tiledSection"><h3 id="section855411147">发布插件<i class="anchor-icon anchor-icon-link" anchorid="section855411147" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002478174404__p20509142411810">typescript项目本质上是一种npm项目，插件发布流程遵循npm发布规范。详情请查询npm官方资料。</p> <p id="ZH-CN_TOPIC_0000002478174404__p2161182192312"></p> <p id="ZH-CN_TOPIC_0000002478174404__p1892772582219">发布npm包流程：</p> <ol id="ZH-CN_TOPIC_0000002478174404__ol107619288543"><li id="li57611287541"><span>配置registry。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p1265965355515">打开工程目录下的.npmrc文件，配置您需要发布的镜像仓库。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" id="ZH-CN_TOPIC_0000002478174404__screen133051339125915" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">registry</span>=[npm镜像仓库地址]</li></ol></pre></div></div> <p></p></li><li id="li5702194032812"><span>生成AccessToken。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p1119313387293">执行如下命令，注册并登录npm仓库，在工程目录下.npmrc文件中自动生成token信息。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174404__screen617218547293" data-highlighted="yes"><ol class="linenums"><li>npm login</li></ol></pre></div></div> <p></p></li><li id="li1344853102615"><span>编译npm包。</span><p></p><div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174404__screen57001703274" data-highlighted="yes"><ol class="linenums"><li>tsc</li></ol></pre></div></div> <p></p></li><li id="li15682153712814"><span>发布npm包。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p13682173713282">执行如下命令，将npm项目打包并发布至镜像仓库。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174404__screen14682137172810" data-highlighted="yes"><ol class="linenums"><li>npm publish</li></ol></pre></div></div> <p></p></li></ol> <div class="tiledSection"><h3 id="section60171414358">使用插件<i class="anchor-icon anchor-icon-link" anchorid="section60171414358" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002478174404__ol65781913192120"><li id="li779916526256"><span>添加依赖。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p18390045261">在工程下hvigor/hvigor-config.json5中添加自定义插件依赖，依赖项支持离线插件配置。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174404__screen57997854913" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"dependencies"</span></span><span class="">: </span><span class="">{</span></li><li>  <span class=""><span class="hljs-string">"custom-plugin"</span></span><span class="">: </span><span class=""><span class="hljs-string">"1.0.0"</span>   </span><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">添加自定义插件依赖</span></span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p></li><li id="li294314528245"><span>安装依赖。</span><p></p><ul id="ZH-CN_TOPIC_0000002478174404__ul104581228252"><li id="li9458102192517">方式1：执行编辑区右上角<strong>Sync</strong><strong> Now</strong>或执行菜单<strong>File -&gt; Sync and Refresh Project</strong>进行工程Sync后，DevEco Studio将会根据hvigor-config.json5中的依赖配置自动安装。</li><li id="li64581325251">方式2：使用hvigorw命令行工具执行任一命令，命令行工具会自动执行安装构建依赖。<div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174404__screen1174720116364" data-highlighted="yes"><ol class="linenums"><li>hvigorw --<span class="hljs-built_in">sync</span></li></ol></pre></div></div> </li></ul> <p></p></li><li id="li16595161813361"><span>导入插件。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p4444307389">根据插件编写时基于的node节点，确定导入的节点所在的hvigorfile.ts文件，在hvigorfile.ts中导入插件。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174404__screen14820143019476" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'custom-plugin'</span>;</li></ol></pre></div></div> <p></p></li><li id="li19712113044817"><span>使用插件。</span><p></p><p id="ZH-CN_TOPIC_0000002478174404__p1418215331771">将自定义插件添加到export default的plugins中。</p> <div _ngcontent-ynw-c106="" class="highlight-div"><div _ngcontent-ynw-c106="" class="highlight-div-header"><div _ngcontent-ynw-c106="" class="highlight-div-header-left"><div _ngcontent-ynw-c106="" class="handle-button expand-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynw-c106="" class="highlight-div-header-right"><div _ngcontent-ynw-c106="" class="handle-button ai-button"></div><div _ngcontent-ynw-c106="" class="handle-button line-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynw-c106="" class="handle-button theme-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynw-c106="" class="handle-button copy-button"><div _ngcontent-ynw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002478174404__screen1966954044914" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="">{</span></li><li>  <span class="">system</span><span class="">: </span><span class="">appTasks</span><span class="">,</span></li><li>  <span class="">plugins</span><span class="">:</span><span class="">[</span></li><li>    <span class=""><span class="hljs-built_in">customPlugin</span></span><span class="">()  </span><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">应用自定义插件</span></span></li><li>  <span class="">]</span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p></li></ol> </div> <div></div></div>