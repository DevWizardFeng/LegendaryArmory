<h1 _ngcontent-vcv-c119="" class="doc-title ng-star-inserted" title="开发准备"> 开发准备 </h1>

<div _ngcontent-vcv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1482715172316">软件要求<i class="anchor-icon anchor-icon-link" anchorid="section1482715172316" tips="复制节点链接"></i></h2>          <ul>      <li>推荐使用Windows 10及以上版本、MacOS 11及以上版本安装应用开发环境DevEco Studio。</li>      <li>推荐DevEco Studio版本：DevEco Studio 6.0.0 Release及以上。</li>      <li>推荐HarmonyOS SDK版本：HarmonyOS 6.0.0 Release SDK及以上。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section143821139152310">硬件要求<i class="anchor-icon anchor-icon-link" anchorid="section143821139152310" tips="复制节点链接"></i></h2>          <p>开发者可根据实际的开发语言，选择对应接口判断当前设备是否支持AR Engine。接口的调用参考如下方式：</p>     <div class="p">      ArkTS（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section07524457283" target="_blank">ARViewContext.init</a>）：      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { arViewController, <span class="hljs-title class_">ARView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AREngine'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ARTest</span> {</li><li>  <span class="hljs-meta">@State</span> arContext?: arViewController.<span class="hljs-property">ARViewContext</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">RelativeContainer</span>() {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span>) {</li><li>          <span class="hljs-title class_">ARView</span>({ <span class="hljs-attr">context</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span> })</li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initARView</span>()</li><li>    })</li><li>    .<span class="hljs-title function_">onWillDisappear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span>?.<span class="hljs-title function_">destroy</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initARView</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-keyword">new</span> arViewController.<span class="hljs-title class_">ARViewContext</span>()</li><li>    context.<span class="hljs-title function_">init</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span> = context;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in initializing ARView.`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to init context. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>     </div>     <div class="p">      C/C++（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga47713cb18234569e03b5216b6c8442d3" target="_blank">HMS_AREngine_ARSession_Create</a>）：      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ar/ar_engine_core.h"</span> </span></li><li>
</li><li><span class=""><span class="hljs-function"><span class="hljs-type">bool</span> </span></span><span class=""><span class="hljs-function"><span class="hljs-title">isSupportAREngine</span></span></span><span class="hljs-function"><span class="hljs-params">()</span> </span>{</li><li>    AREngine_ARSession *arSession = <span class=""><span class="hljs-literal">nullptr</span></span>;</li><li>    <span class=""><span class="hljs-keyword">if</span></span>(<span class=""><span class="hljs-built_in">HMS_AREngine_ARSession_Create</span></span>(<span class=""><span class="hljs-literal">nullptr</span></span>, <span class=""><span class="hljs-literal">nullptr</span></span>, &amp;arSession) == <span class="">ARENGINE_ERROR_DEVICE_NOT_SUPPORTED</span>){</li><li>        <span class=""><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span>;</li><li>    }</li><li>    <span class=""><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></span>;</li><li>}</li></ol></pre></div></div>     </div>    </div>    <p>若对应接口返回错误码为801或ARENGINE_ERROR_DEVICE_NOT_SUPPORTED，则表示AR Engine不支持当前设备。</p>    <div class="tiledSection">     <h2 id="section121347402251">环境搭建<i class="anchor-icon anchor-icon-link" anchorid="section121347402251" tips="复制节点链接"></i></h2>          <p>请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-dev-overview" target="_blank">应用开发准备</a>完成基本准备工作。</p>    </div>    <div class="tiledSection">     <h2 id="section12219144310509">申请权限<i class="anchor-icon anchor-icon-link" anchorid="section12219144310509" tips="复制节点链接"></i></h2>          <p>在开发AR应用时，需要先申请相机相关权限，确保应用拥有访问相机硬件及其他功能的权限，需要的权限如下表。在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则" target="_blank">权限使用的基本原则</a>。</p>     <ul>      <li>使用相机拍摄前，需要申请<strong>ohos.permission.CAMERA</strong>相机权限。</li>      <li>当需要使用加速计感知设备运动状态时，需要申请<strong>ohos.permission.ACCELEROMETER</strong>加速计权限。</li>      <li>当需要陀螺仪感知设备位姿信息时，需要申请<strong>ohos.permission.GYROSCOPE</strong>陀螺仪权限。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section148162301428">前置准备<i class="anchor-icon anchor-icon-link" anchorid="section148162301428" tips="复制节点链接"></i></h2>          <p>推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation" target="_blank">组件导航(Navigation) (推荐)</a>作为页面路由，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation" target="_blank">Navigation</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation#页面生命周期" target="_blank">页面生命周期</a>所示方法。</p>    </div>    <p>开发者需先创建首页，通过首页选择进入AR Engine场景。</p>    <ol>     <li><span>导入所需模块。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">PermissionRequestResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>      <p></p></li>     <li><span>创建一个基础的页面，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation" target="_blank">组件导航(Navigation) (推荐)</a>。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Entry</span></li><li><span class="hljs-variable">@Component</span></li><li>struct Selector {</li><li>  pageInfo: NavPathStack = new NavPathStack();</li><li>
</li><li>  <span class="hljs-selector-tag">build</span>(): <span class="hljs-selector-tag">void</span> {</li><li>    <span class="hljs-selector-tag">Navigation</span>(this.pageInfo) {</li><li>
</li><li>    }</li><li>    .<span class="hljs-built_in">mode</span>(NavigationMode.Stack)</li><li>    .<span class="hljs-built_in">hideTitleBar</span>(true)</li><li>    .<span class="hljs-built_in">hideBackButton</span>(true)</li><li>    .<span class="hljs-built_in">hideToolBar</span>(true)</li><li>  }</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>创建sampleButton，封装Button及权限校验功能，使用@Builder装饰，并配置routerMap进行页面跳转。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Selector {</li><li>  pageInfo: NavPathStack = new NavPathStack();</li><li>  <span class="hljs-keyword">private</span> hasPermission: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> context: Context = <span class="hljs-keyword">this</span>.getUIContext().getHostContext() <span class="hljs-keyword">as</span> Context;</li><li>
</li><li>  build(): void {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  sampleButton(sampleName: string): void {</li><li>    Button(sampleName, { type: ButtonType.Normal, stateEffect: <span class="hljs-literal">true</span> })</li><li>      .borderRadius(<span class="hljs-number">8</span>)</li><li>      .width(<span class="hljs-string">'50%'</span>)</li><li>      .height(<span class="hljs-string">'5%'</span>)</li><li>      .onClick(async () =&gt; {</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hasPermission) {</li><li>          <span class="hljs-keyword">this</span>.hasPermission = await requestPermissionOnSetting(<span class="hljs-keyword">this</span>.context);</li><li>          <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hasPermission) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>        }</li><li>        <span class="hljs-keyword">this</span>.pageInfo.clear();</li><li>        <span class="hljs-keyword">this</span>.pageInfo.pushDestinationByName(sampleName, <span class="hljs-literal">null</span>);</li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>创建requestPermissionOnSetting方法用于校验在进入AR场景时是否已经获取相机权限。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li>struct <span class="hljs-title class_">Selector</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestPermissionOnSetting</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">requestResult</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionOnSetting</span>(context, [<span class="hljs-string">'ohos.permission.CAMERA'</span>])</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: abilityAccessCtrl.GrantStatus[]</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'data:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>      <span class="hljs-keyword">if</span> (data[<span class="hljs-number">0</span>] === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>) {</li><li>        requestResult = <span class="hljs-literal">true</span>;</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'data:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>    })</li><li>  <span class="hljs-keyword">return</span> requestResult;</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>在页面上创建按钮，用于进入AR场景。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">build</span>(): void {</li><li>  <span class="hljs-built_in">Navigation</span>(this.pageInfo) {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      this<span class="hljs-selector-class">.sampleButton</span>('ARWorld'); <span class="hljs-comment">// 进入ARWorld场景</span></li><li>    }</li><li>    <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.SpaceEvenly)</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>  <span class="hljs-selector-class">.mode</span>(NavigationMode.Stack)</li><li>  <span class="hljs-selector-class">.hideTitleBar</span>(true)</li><li>  <span class="hljs-selector-class">.hideBackButton</span>(true)</li><li>  <span class="hljs-selector-class">.hideToolBar</span>(true)</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>在onAppear中配置应用首次启动时的权限校验方法requestPermissionOnFirstStartup。</span>      <p></p>      <div _ngcontent-vcv-c106="" class="highlight-div"><div _ngcontent-vcv-c106="" class="highlight-div-header"><div _ngcontent-vcv-c106="" class="highlight-div-header-left"><div _ngcontent-vcv-c106="" class="handle-button expand-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vcv-c106="" class="highlight-div-header-right"><div _ngcontent-vcv-c106="" class="handle-button ai-button"></div><div _ngcontent-vcv-c106="" class="handle-button line-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vcv-c106="" class="handle-button theme-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vcv-c106="" class="handle-button copy-button"><div _ngcontent-vcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vcv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li>struct <span class="hljs-title class_">Selector</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sampleButton</span>(<span class="hljs-string">'ARWorld'</span>);</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestPermissionOnFirstStartup</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">sampleButton</span>(<span class="hljs-attr">sampleName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> { </li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">requestPermissionOnFirstStartup</span>(): <span class="hljs-built_in">void</span> {</li><li>    abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>()</li><li>      .<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, [<span class="hljs-string">'ohos.permission.CAMERA'</span>])</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: PermissionRequestResult</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">grantStatus</span>: <span class="hljs-built_in">number</span>[] = data.<span class="hljs-property">authResults</span>;</li><li>        <span class="hljs-keyword">if</span> (grantStatus[<span class="hljs-number">0</span>] === <span class="hljs-number">0</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span> = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting requestPermission.'</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span> = <span class="hljs-literal">false</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get requestPermission, user rejected.'</span>);</li><li>        }</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>      <p></p></li>    </ol>   </div>   <div></div></div>