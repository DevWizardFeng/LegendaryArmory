<h1 _ngcontent-eul-c119="" class="doc-title ng-star-inserted" title="开发函数"> 开发函数 </h1>

<div _ngcontent-eul-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001655887038"><p id="ZH-CN_TOPIC_0000002179498020__p4306123173111">函数创建并配置完成后，您便可以开始编写函数业务代码了。</p> <ol id="ZH-CN_TOPIC_0000002179498020__ol139674817316"><li id="li1396712815314">打开函数入口文件，编写函数代码。关于开发函数代码的更详细信息，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-develop-function-nodejs" target="_blank">开发函数</a>。<p id="ZH-CN_TOPIC_0000002179498020__p9261119134618">此处我们以函数“my-cloud-function”为例，构造一个用于返回时间戳的函数。</p> <div _ngcontent-eul-c106="" class="highlight-div"><div _ngcontent-eul-c106="" class="highlight-div-header"><div _ngcontent-eul-c106="" class="highlight-div-header-left"><div _ngcontent-eul-c106="" class="handle-button expand-button"><div _ngcontent-eul-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eul-c106="" class="highlight-div-header-right"><div _ngcontent-eul-c106="" class="handle-button ai-button"></div><div _ngcontent-eul-c106="" class="handle-button line-button"><div _ngcontent-eul-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eul-c106="" class="handle-button theme-button"><div _ngcontent-eul-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eul-c106="" class="handle-button copy-button"><div _ngcontent-eul-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eul-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002179498020__screen208151023612" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Describe the basic method of Cloud Functions</span></li><li><span class="hljs-comment"> */</span></li><li>
</li><li><span class="hljs-keyword">let</span> myHandler = <span class="hljs-keyword">function</span>(<span class="hljs-params">event, context, callback, logger</span>){</li><li>    <span class="hljs-comment">// example of display environment variables</span></li><li>    <span class="hljs-keyword">let</span> env1 = context.<span class="hljs-property">env</span>.<span class="hljs-property">env1</span>;</li><li>
</li><li>    <span class="hljs-comment">// example of display logs</span></li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Test info log"</span>);</li><li>    logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"Test warn log"</span>);</li><li>    logger.<span class="hljs-title function_">debug</span>(<span class="hljs-string">"Test debug log"</span>);</li><li>    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Test error log"</span>);</li><li>
</li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"--------Start-------"</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</li><li>        <span class="hljs-keyword">let</span> endTime = startTime;</li><li>        <span class="hljs-keyword">let</span> interval = <span class="hljs-number">0</span>;</li><li>        startTime = process.<span class="hljs-title function_">uptime</span>() * <span class="hljs-number">1000</span>;</li><li>
</li><li>        <span class="hljs-comment">// print input parameters and environment variables</span></li><li>        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"request: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event.<span class="hljs-property">request</span>));</li><li>        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"env1: "</span> + env1);</li><li>
</li><li>        endTime = process.<span class="hljs-title function_">uptime</span>() * <span class="hljs-number">1000</span>;</li><li>        interval = endTime - startTime;</li><li>        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"intervalTime: "</span> + interval);</li><li>        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"--------Finished-------"</span>);</li><li>
</li><li>        <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">new</span> context.<span class="hljs-title class_">HTTPResponse</span>(context.<span class="hljs-property">env</span>, {</li><li>            <span class="hljs-string">"res-type"</span>: <span class="hljs-string">"context.env"</span>,</li><li>            <span class="hljs-string">"faas-content-type"</span>: <span class="hljs-string">"json"</span>,</li><li>        }, <span class="hljs-string">"application/json"</span>, <span class="hljs-string">"200"</span>);</li><li>        res.<span class="hljs-property">body</span> = {<span class="hljs-string">"intervalTime"</span>: interval};</li><li>        <span class="hljs-title function_">callback</span>(res);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"--------Error-------"</span>);</li><li>        logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error: "</span> + error);</li><li>        <span class="hljs-title function_">callback</span>(error);</li><li>    }</li><li>};</li><li>
</li><li><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">myHandler</span> = myHandler;</li></ol></pre></div></div> <div class="p" id="ZH-CN_TOPIC_0000002179498020__p0512118184912"><div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002179498020__p49421911134718">云函数与云函数之间是相互独立的，部署至云侧时，只会部署所选云函数目录下的文件，不可在一个云函数中通过import '../anotherDirectory/xxx'的方式引入依赖。如果有多个云函数公共的配置，建议存储在云数据库中，通过云数据库Server API类查询出公共配置；也可以将多个云函数整合成一个云对象，将公共配置变成云对象的私有配置。</p> </div></div></div> </div> <p id="ZH-CN_TOPIC_0000002179498020__p57110212321"></p> </li></ol><ol id="ZH-CN_TOPIC_0000002179498020__ol164645303511" start="2"><li id="li723411241618">（可选）如函数存在依赖关系，可在“package.json”文件的“dependencies”下添加需要的依赖，然后点击右上角“Sync Now”。<div class="p" id="ZH-CN_TOPIC_0000002179498020__p56091249612"><a name="ZH-CN_TOPIC_0000002179498020__li723411241618"></a><a name="li723411241618"></a>下文以添加“@hw-agconnect/cloud-server”依赖为例进行说明，请添加实际业务所需的依赖。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002179498020__p633795719491">右击“package.json”文件，选择“Run 'npm install'”菜单，也可以实现依赖包安装。</p> </div></div></div> </div> <p id="ZH-CN_TOPIC_0000002179498020__p1660921551216"><span><img originheight="429" originwidth="1110" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104747.94491792580922060943933844911414:50001231000000:2800:353C654F150ECFEEB4BDADE90F8CFDC21C9B0A0824DB9484D6B6B93B7E076FE3.png" width="920" height="355.56756756756755"></span></p> <p id="ZH-CN_TOPIC_0000002179498020__p457019445447">所有安装的依赖包都会存储在当前函数的“node_modules”目录下。</p> <p id="ZH-CN_TOPIC_0000002179498020__p16364521086"><span><img originheight="411" originwidth="642" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104747.13866501915423534893366356500207:50001231000000:2800:1774290E8FAA2873537BBE92AE959B244C0DDE759624D139F363E940D71844DA.png" width="642" height="411"></span></p> </li></ol> </div> <div></div></div>