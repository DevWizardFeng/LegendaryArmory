<h1 _ngcontent-wsp-c119="" class="doc-title ng-star-inserted" title="开发指导(ArkTS)"> 开发指导(ArkTS) </h1>

<div _ngcontent-wsp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1163717446567">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1163717446567" tips="复制节点链接"></i></h2>          <p><span><img originheight="671" originwidth="953" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114556.63608932756726406578318732494382:50001231000000:2800:7CD28BDE17EC15A7ECAFF0359BCE15130C93BAD23E17DA3630338D4349A8E067.png" width="920" height="647.7649527806925"></span></p>     <ol>      <li>游戏启动后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section131971556806" target="_blank">gamePerformance.init</a>接口对游戏场景感知进行初始化。</li>      <li>初始化成功后，游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section17453143012584" target="_blank">gamePerformance.on</a>接口注册设备状态变化事件监听，订阅设备状态变化通知。</li>      <li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section225333655719" target="_blank">gamePerformance.updateGameInfo</a>接口向游戏场景感知上报游戏信息（包信息、配置信息、场景信息和网络信息等）。</li>      <li>游戏场景感知广播游戏信息给终端系统。</li>      <li>终端系统根据游戏信息进行系统资源调度。</li>      <li>终端系统会将设备状态变化通知游戏场景感知。</li>      <li>游戏场景感知向游戏客户端反馈设备状态变化。</li>      <li>如不再需要订阅，游戏可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section3614173614593" target="_blank">gamePerformance.off</a>接口取消设备状态变化事件监听。</li>      <li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section106164517195" target="_blank">gamePerformance.getDeviceInfoByScope</a>接口向游戏场景感知主动查询设备状态信息。</li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Mali系列GPU不支持采集GPU信息，调用订阅和查询设备状态信息接口时无法获取设备GPU信息。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section1451724123520">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1451724123520" tips="复制节点链接"></i></h2>          <p>具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="53.879999999999995%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="46.12%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section131971556806" target="_blank">init</a>(gamePackageInfo: GamePackageInfo): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>游戏初始化接口，对游戏场景感知进行初始化，通过Promise对象获取返回值。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section17453143012584" target="_blank">on</a>(type: 'deviceStateChanged', callback: Callback&lt;DeviceInfo&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅设备状态变化接口，主要用于监听deviceStateChanged（设备状态变化）事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section060864914495" target="_blank">on</a>(type: 'deviceStateChanged', callback: Callback&lt;DeviceInfo&gt;, scope: Array&lt;DeviceInfoType&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>按需订阅设备状态变化接口。主要用于监听deviceStateChanged（设备状态变化）事件，支持传入参数指定订阅的设备状态信息类型。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section225333655719" target="_blank">updateGameInfo</a>&lt;T extends BaseGameInfo&gt;(gameInfo: T): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏信息接口，主要用于上报游戏信息（包信息、配置信息、场景信息和网络信息等），通过Promise对象获取返回值。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section3614173614593" target="_blank">off</a>(type: 'deviceStateChanged', callback?: Callback&lt;DeviceInfo&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅设备状态变化接口，主要用于取消监听deviceStateChanged（设备状态变化）事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section106164517195" target="_blank">getDeviceInfoByScope</a>(scope: Array&lt;DeviceInfoParameter&gt;): Promise&lt;DeviceInfo&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>查询设备状态信息接口。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section261511019465">接入步骤<i class="anchor-icon anchor-icon-link" anchorid="section261511019465" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section10465717173919" class="firsth2">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section10465717173919" tips="复制节点链接"></i></h3>          <p>导入Game Service Kit及公共模块。</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { gamePerformance } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GameServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section8810153223912">初始化<i class="anchor-icon anchor-icon-link" anchorid="section8810153223912" tips="复制节点链接"></i></h3>          <p>导入相关模块后，需先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section131971556806" target="_blank">init</a>接口对游戏场景感知进行初始化。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>init接口是调用其他接口的前提，如果未初始化或初始化失败，将无法调用其他接口。</p>      </div></div></div>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">gamePackageInfo</span>: gamePerformance.<span class="hljs-property">GamePackageInfo</span> = {</li><li>  <span class="hljs-attr">messageType</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.demo"</span>, <span class="hljs-comment">// 仅示例，请替换为实际的游戏包名</span></li><li>  <span class="hljs-attr">appVersion</span>: <span class="hljs-string">"1.0"</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  gamePerformance.<span class="hljs-title function_">init</span>(gamePackageInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 初始化成功</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Succeeded in initializing.`</span>);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 初始化失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to initialize. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1911494910398">订阅设备状态变化<i class="anchor-icon anchor-icon-link" anchorid="section1911494910398" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section17453143012584" target="_blank">on</a>接口可以订阅设备状态变化事件，获取设备状态变化的通知（如设备温控档位）。</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onDeviceStateChange</span>(<span class="hljs-params">data:gamePerformance.DeviceInfo</span>) {</li><li>  <span class="hljs-comment">// 设备信息详情</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`device state changed. tempLevel is <span class="hljs-subst">${data.tempLevel}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 订阅deviceStateChanged事件</span></li><li><span class="hljs-keyword">try</span> {</li><li>  gamePerformance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'deviceStateChanged'</span>, onDeviceStateChange);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 订阅失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to subscribe. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>     <p>目前支持订阅GPU和温度变化趋势两种类型的设备状态数据，也可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section060864914495" target="_blank">on</a>接口按需订阅，如只订阅GPU数据：</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onDeviceStateChange</span>(<span class="hljs-params">data:gamePerformance.DeviceInfo</span>) {</li><li>  <span class="hljs-comment">// data中仅含有gpuInfo</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`device state changed. tempLevel is <span class="hljs-subst">${data.tempLevel}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 订阅deviceStateChanged事件</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">types</span>:<span class="hljs-title class_">Array</span>&lt;gamePerformance.<span class="hljs-property">DeviceInfoType</span>&gt; = [gamePerformance.<span class="hljs-property">DeviceInfoType</span>.<span class="hljs-property">GPU</span>];</li><li>  gamePerformance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'deviceStateChanged'</span>, onDeviceStateChange, types);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 订阅失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to subscribe. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section6522106194016">上报游戏信息<i class="anchor-icon anchor-icon-link" anchorid="section6522106194016" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section225333655719" target="_blank">updateGameInfo</a>接口上报游戏信息（包信息、配置信息、场景信息和网络信息等）。若需上报自定义数据，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section72524718166" target="_blank">addGameCustomData</a>接口。</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 以更新游戏场景信息为例</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">gameSceneInfo</span>: gamePerformance.<span class="hljs-property">GameSceneInfo</span> = {</li><li>  <span class="hljs-attr">messageType</span>: <span class="hljs-number">2</span>,</li><li>  <span class="hljs-attr">sceneID</span>: <span class="hljs-number">7</span>,</li><li>  <span class="hljs-attr">importanceLevel</span>: <span class="hljs-number">4</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  gamePerformance.<span class="hljs-title function_">updateGameInfo</span>(gameSceneInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 更新游戏场景信息成功</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Succeeded in updating.`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 更新游戏场景信息失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to update. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section170652064015">取消订阅设备状态<i class="anchor-icon anchor-icon-link" anchorid="section170652064015" tips="复制节点链接"></i></h3>          <p>如不再需要订阅，则可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section3614173614593" target="_blank">off</a>接口取消订阅设备状态。</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onDeviceStateChange</span>(<span class="hljs-params">data:gamePerformance.DeviceInfo</span>) {</li><li>  <span class="hljs-comment">// 设备信息详情</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`device state changed. tempLevel is <span class="hljs-subst">${data.tempLevel}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 取消订阅deviceStateChanged事件</span></li><li><span class="hljs-keyword">try</span> {</li><li>  gamePerformance.<span class="hljs-title function_">off</span>(<span class="hljs-string">'deviceStateChanged'</span>, onDeviceStateChange);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 取消订阅失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to unsubscribe. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 取消deviceStateChanged事件的全部订阅</span></li><li><span class="hljs-keyword">try</span> {</li><li>  gamePerformance.<span class="hljs-title function_">off</span>(<span class="hljs-string">"deviceStateChanged"</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 取消订阅失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to unsubscribe. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section13901037174010">查询设备状态信息<i class="anchor-icon anchor-icon-link" anchorid="section13901037174010" tips="复制节点链接"></i></h3>          <p>除订阅设备状态变化的方式外，也可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameperformance#section106164517195" target="_blank">getDeviceInfoByScope</a>接口主动查询设备状态：</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 查询设备状态</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">gpuParam</span>: gamePerformance.<span class="hljs-property">DeviceInfoParameter</span> = {</li><li>    <span class="hljs-attr">deviceInfoType</span>: gamePerformance.<span class="hljs-property">DeviceInfoType</span>.<span class="hljs-property">GPU</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">thermalParam</span>: gamePerformance.<span class="hljs-property">DeviceInfoParameter</span> = {</li><li>    <span class="hljs-attr">deviceInfoType</span>: gamePerformance.<span class="hljs-property">DeviceInfoType</span>.<span class="hljs-property">THERMAL</span>     </li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">gameInfos</span>: <span class="hljs-title class_">Array</span>&lt;gamePerformance.<span class="hljs-property">DeviceInfoParameter</span>&gt; = [gpuParam, thermalParam];</li><li>  gamePerformance.<span class="hljs-title function_">getDeviceInfoByScope</span>(gameInfos).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">deviceInfo:gamePerformance.DeviceInfo</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Succeeded in querying device info. tempLevel is <span class="hljs-subst">${deviceInfo.tempLevel}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 查询失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to query. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>     <p>主动查询接口同样支持按需查询，如只查询温度变化趋势数据：</p>     <div _ngcontent-wsp-c106="" class="highlight-div"><div _ngcontent-wsp-c106="" class="highlight-div-header"><div _ngcontent-wsp-c106="" class="highlight-div-header-left"><div _ngcontent-wsp-c106="" class="handle-button expand-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsp-c106="" class="highlight-div-header-right"><div _ngcontent-wsp-c106="" class="handle-button ai-button"></div><div _ngcontent-wsp-c106="" class="handle-button line-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsp-c106="" class="handle-button theme-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsp-c106="" class="handle-button copy-button"><div _ngcontent-wsp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 只查询设备温度数据</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">thermalParam</span>: gamePerformance.<span class="hljs-property">DeviceInfoParameter</span> = {</li><li>    <span class="hljs-attr">deviceInfoType</span>: gamePerformance.<span class="hljs-property">DeviceInfoType</span>.<span class="hljs-property">THERMAL</span>     </li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">gameInfos</span>: <span class="hljs-title class_">Array</span>&lt;gamePerformance.<span class="hljs-property">DeviceInfoParameter</span>&gt; = [thermalParam];</li><li>  gamePerformance.<span class="hljs-title function_">getDeviceInfoByScope</span>(gameInfos).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">deviceInfo:gamePerformance.DeviceInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 此处的查询结果中将不含有gpuInfo</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Succeeded in querying device info. tempLevel is <span class="hljs-subst">${deviceInfo.tempLevel}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-comment">// 查询失败</span></li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'demo'</span>, <span class="hljs-string">`Failed to query. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>查询温度变化趋势需要历史数据作为计算依据，调用该接口时请保证设备已启动至少一分钟，否则会返回1010300003错误。</p>      </div></div></div>    </div>   </div>   <div></div></div>