<h1 _ngcontent-ncw-c119="" class="doc-title ng-star-inserted" title="开发指导(ArkTS)"> 开发指导(ArkTS) </h1>

<div _ngcontent-ncw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1163717446567">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1163717446567" tips="复制节点链接"></i></h2>          <p><span><img originheight="750" originwidth="939" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114556.35132237601912478849885324233473:50001231000000:2800:40544FFF01063F66BBDAC9FB3C5C0331613A3C05C67D41A59B1A36E6F24D7C03.png" width="920" height="734.8242811501598"></span></p>     <ol>      <li>发送端和接收端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section131971556806" target="_blank">create</a>创建游戏近场快传服务。</li>      <li>创建成功后，游戏客户端调用以下接口注册监听。       <ul>        <li>注册连接通知监听接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section17453143012584" target="_blank">on</a>('connectNotify')</li>        <li>（发送端选择绑定接收端情况下需调用）注册发现结果事件监听接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section766518402463" target="_blank">on</a>('discovery')</li>        <li>注册收到包信息监听接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1959517425315" target="_blank">on</a>('receivePackageInfo')</li>        <li>注册传输通知监听接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section05583466314" target="_blank">on</a>('transferNotify')</li>        <li>注册错误事件监听接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section122432503314" target="_blank">on</a>('error')</li>       </ul></li>      <li>接收端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section225333655719" target="_blank">publishNearbyGame</a>发布自身近场快传服务。</li>      <li>绑定接收端，支持如下两种方式。       <ul>        <li>自动绑定：         <p>发送端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section52391745713" target="_blank">autoBindNearbyGame</a>自动绑定附近设备（搜索并绑定附近10米内第一个发现的近场快传服务）。</p>         <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">           <p>自动绑定操作2分钟内有效，超时需重新调用接口。</p>          </div></div></div></li>        <li>选择绑定：         <p>发送端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section16687197125918" target="_blank">discoveryNearbyGame</a>发现附近设备，发现操作完成后将收到discovery事件回调，获得可绑定的设备列表供玩家选择，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13279659901" target="_blank">bindNearbyGame</a>接口绑定玩家选定的接收端设备。</p>         <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">           <p>发现操作2分钟内有效，超时需重新调用接口。</p>          </div></div></div></li>       </ul></li>      <li>接收端收到UIAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncollaborate18" target="_blank">onCollaborate</a>回调后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section106164517195" target="_blank">acceptCollaboration</a>接受协同。</li>      <li>接收端收到建链成功connectNotify事件回调。</li>      <li>接收端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section12490112992612" target="_blank">sendPackageInfo</a>发送自身文件信息，如版本信息、包信息。</li>      <li>发送端收到receivePackageInfo事件回调。</li>      <li>发送端比较版本并调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section78288285293" target="_blank">replyPackageInfoResult</a>上报对比结果。</li>      <li>如发送端对比结果为需要发送，则调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1227711101118" target="_blank">transferPackageData</a>向接收端发送需要传输的资源包。</li>      <li>接收端可在transferNotify回调中获取当前已传输的包体大小、包体总大小、传输速率、传输剩余时间等信息，传输完成可获取已接收资源包的存储目录，对传输完成的资源文件做处理。</li>      <li>处理传输完成的资源文件后，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13373155416" target="_blank">destroy</a>销毁服务。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>destroy接口会清除已接收数据，请确保对已接收数据做好处理或转移后再调用该接口。</li>          <li>每次调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section131971556806" target="_blank">create</a>接口会自动清理自身历史数据。</li>         </ul>        </div></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1451724123520">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1451724123520" tips="复制节点链接"></i></h2>          <p>具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="53.879999999999995%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="46.12%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section131971556806" target="_blank">create</a>(createParameters: CreateParameters): Promise&lt;CreateResult&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>创建游戏近场快传服务。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section17453143012584" target="_blank">on</a>(type: 'connectNotify', callback: Callback&lt;ConnectNotification&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅连接通知事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section3614173614593" target="_blank">off</a>(type: 'connectNotify', callback?: Callback&lt;ConnectNotification&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅连接通知事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section766518402463" target="_blank">on</a>(type: 'discovery', callback: Callback&lt;DiscoveryResult&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅发现结果事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section10671640104614" target="_blank">off</a>(type: 'discovery', callback?: Callback&lt;DiscoveryResult&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅发现结果事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1959517425315" target="_blank">on</a>(type: 'receivePackageInfo', callback: Callback&lt;PackageInfo&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅收到包信息事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1359944210319" target="_blank">off</a>(type: 'receivePackageInfo', callback?: Callback&lt;PackageInfo&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅收到包信息事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section05583466314" target="_blank">on</a>(type: 'transferNotify', callback: Callback&lt;TransferNotification&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅传输通知事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section65611146153113" target="_blank">off</a>(type: 'transferNotify', callback?: Callback&lt;TransferNotification&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅传输通知事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section122432503314" target="_blank">on</a>(type: 'error', callback: Callback&lt;ReturnResult&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>订阅错误事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section20246850163115" target="_blank">off</a>(type: 'error', callback?: Callback&lt;ReturnResult&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消订阅错误事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section225333655719" target="_blank">publishNearbyGame</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>发布近场快传服务。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section52391745713" target="_blank">autoBindNearbyGame</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>自动绑定近场快传服务。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section16687197125918" target="_blank">discoveryNearbyGame</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>发现近场快传服务。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13279659901" target="_blank">bindNearbyGame</a>(bindParameters: BindParameters): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>绑定指定近场快传服务。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section106164517195" target="_blank">acceptCollaboration</a>(acceptParameters: Record&lt;string, object&gt;): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>接受协同。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section12490112992612" target="_blank">sendPackageInfo</a>(packageInfo: PackageInfo): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>接收端发送自身文件信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section78288285293" target="_blank">replyPackageInfoResult</a>(packageInfoResult: PackageInfoResult): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>上报包信息对比结果。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1227711101118" target="_blank">transferPackageData</a>(packageData: PackageData): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>传输包数据。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13373155416" target="_blank">destroy</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>销毁游戏近场快传服务。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section261511019465">接入步骤<i class="anchor-icon anchor-icon-link" anchorid="section261511019465" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section10465717173919" class="firsth2">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section10465717173919" tips="复制节点链接"></i></h3>          <p>导入Game Service Kit及公共模块。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { gameNearbyTransfer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GameServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1047803318509">申请权限<i class="anchor-icon anchor-icon-link" anchorid="section1047803318509" tips="复制节点链接"></i></h3>          <p>申请ohos.permission.DISTRIBUTED_DATASYNC权限用于设备发现，详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization" target="_blank">向用户申请授权</a>。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="">atManager </span><span class="">= </span><span class="">abilityAccessCtrl</span><span class="">.</span><span class=""><span class="hljs-title function_">createAtManager</span></span><span class="">()</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class="">uiAbilityContext </span><span class="">= </span><span class=""><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() </span><span class="hljs-keyword">as</span> <span class="">common</span><span class="">.</span><span class=""><span class="hljs-property">UIAbilityContext</span></span><span class="">;</span></li><li><span class="hljs-keyword">try</span> <span class="">{</span></li><li>  <span class="">atManager</span><span class="">.</span><span class=""><span class="hljs-title function_">requestPermissionsFromUser</span></span><span class="">(</span><span class="">uiAbilityContext</span><span class="">, </span><span class="">[</span><span class=""><span class="hljs-string">'ohos.permission.DISTRIBUTED_DATASYNC'</span></span><span class="">])</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'nearby'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'data: '</span> </span><span class="">+ </span><span class=""><span class="hljs-title class_">JSON</span></span><span class="">.</span><span class=""><span class="hljs-title function_">stringify</span></span><span class="">(</span><span class="">data</span><span class="">))</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">object</span></span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'nearby'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'err: '</span> </span><span class="">+ </span><span class=""><span class="hljs-title class_">JSON</span></span><span class="">.</span><span class=""><span class="hljs-title function_">stringify</span></span><span class="">(</span><span class="">err</span><span class="">))</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span></li><li><span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>  <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">);</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section8810153223912">创建游戏近场快传服务并注册相关回调<i class="anchor-icon anchor-icon-link" anchorid="section8810153223912" tips="复制节点链接"></i></h3>          <p>导入相关模块后，需先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section131971556806" target="_blank">create</a>接口创建游戏近场快传服务，然后注册各回调事件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section131971556806" target="_blank">create</a>接口是调用其他接口的前提，如果未创建游戏近场快传服务或创建失败，将无法调用其他接口。</p>      </div></div></div>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li>public <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> uiAbilityContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">initParam</span>: gameNearbyTransfer.<span class="hljs-property">CreateParameters</span> = {</li><li>    <span class="hljs-attr">abilityName</span>: uiAbilityContext.<span class="hljs-property">abilityInfo</span>.<span class="hljs-property">name</span>,</li><li>    <span class="hljs-attr">context</span>: uiAbilityContext,</li><li>    <span class="hljs-attr">moduleName</span>: uiAbilityContext.<span class="hljs-property">abilityInfo</span>.<span class="hljs-property">moduleName</span>,</li><li>    <span class="hljs-attr">needShowSystemUI</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 是否展示系统UI，true为展示，false为不展示，默认为false</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    gameNearbyTransfer.<span class="hljs-title function_">create</span>(initParam).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">createResult</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'create success'</span> + createResult.<span class="hljs-property">localDeviceName</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerCallback</span>();</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'create error'</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>);</li><li>    })</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'error'</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 注册监听</span></li><li><span class="">public </span><span class=""><span class="hljs-title function_">registerCallback</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class="hljs-keyword">try</span> <span class="">{</span></li><li>    <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'connectNotify'</span></span><span class="">, </span><span class="">connectNotifyCallBack</span><span class="">)</span><span class="">;</span></li><li>    <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'receivePackageInfo'</span></span><span class="">, </span><span class="">receivePackageInfoCallBack</span><span class="">)</span><span class="">;</span></li><li>    <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'transferNotify'</span></span><span class="">, </span><span class="">transferNotifyCallBack</span><span class="">)</span><span class="">;</span></li><li>    <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'error'</span></span><span class="">, </span><span class="">errorCallBack</span><span class="">)</span><span class="">;</span></li><li>  <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span>;</li><li>  <span class="">}</span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">connectNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">ConnectNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">连接状态回调，接收端收到建链成功回调后，在此处调用</span></span><span class=""><span class="hljs-comment">sendPackageInfo</span></span><span class=""><span class="hljs-comment">接口发送自身文件信息，如版本信息、包信息</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">receivePackageInfoCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">PackageInfo</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">接收包信息回调，发送端收到接收端发送的版本信息后进行对比，根据对比结果决定是否需要传输资源包数据。</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">transferNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">TransferNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">传输回调，处理传输进度信息</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">errorCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">ReturnResult</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">异常信息回调，处理相关异常信息</span></span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1096819541823">接收端接受协同<i class="anchor-icon anchor-icon-link" anchorid="section1096819541823" tips="复制节点链接"></i></h3>          <p>接收端实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncollaborate18" target="_blank">onCollaborate</a>回调，回调中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section106164517195" target="_blank">acceptCollaboration</a>接口接受协同。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">EntryAbility</span> </span><span class="hljs-keyword">extends</span> <span class=""><span class="hljs-title class_ inherited__">UIAbility</span> </span><span class="">{</span> </li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">协同回调</span></span></li><li>  <span class=""><span class="hljs-title function_">onCollaborate</span></span><span class="">(</span><span class=""><span class="hljs-attr">wantParam</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Record</span></span><span class="">&lt;</span><span class=""><span class="hljs-built_in">string</span></span><span class="">, </span><span class=""><span class="hljs-title class_">Object</span></span><span class="">&gt;</span><span class="">)</span><span class="">: </span><span class=""><span class="hljs-title class_">AbilityConstant</span></span><span class="">.</span><span class=""><span class="hljs-property">CollaborateResult</span> </span><span class="">{</span></li><li>    <span class="hljs-keyword">try</span> <span class="">{</span></li><li>    <span class="">  gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">acceptCollaboration</span></span><span class="">(</span><span class="">wantParam</span><span class="">)</span><span class="">;</span></li><li><span class="">    } </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>      <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span>;</li><li><span class="">    }</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class="hljs-string">'[nearby]</span><span class=""><span class="hljs-string">'</span>, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'onCollaborate: accept collaborate'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="hljs-keyword">return</span> <span class=""><span class="hljs-title class_">AbilityConstant</span></span><span class="">.</span><span class=""><span class="hljs-property">CollaborateResult</span></span><span class="">.</span><span class=""><span class="hljs-property">ACCEPT</span></span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1911494910398">接收端发布自身游戏近场快传服务<i class="anchor-icon anchor-icon-link" anchorid="section1911494910398" tips="复制节点链接"></i></h3>          <p>接收端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section225333655719" target="_blank">publishNearbyGame</a>接口发布自身游戏近场快传服务。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> <span class="">{</span></li><li>  <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">publishNearbyGame</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'publishNearbyGame success'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">BusinessError</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'publishNearbyGame error'</span></span><span class=""> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span></li><li><span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>  <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span>;</li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section874410391279">发送端绑定接收端游戏近场快传服务<i class="anchor-icon anchor-icon-link" anchorid="section874410391279" tips="复制节点链接"></i></h3>          <p>发送端绑定接收端游戏近场快传服务支持如下两种方式：</p>     <ul>      <li>方式一：自动绑定       <p>发送端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section52391745713" target="_blank">autoBindNearbyGame</a>接口自动绑定接收端近场快传服务。</p>       <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> <span class="">{</span></li><li>  <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">autoBindNearbyGame</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'autoBindNearbyGame success'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">BusinessError</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'autoBindNearbyGame error'</span></span><span class=""> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span></li><li><span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>  <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span>;</li><li><span class="">}</span></li></ol></pre></div></div></li>     </ul>     <ul>      <li>方式二：选择绑定       <ol>        <li>发送端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section766518402463" target="_blank">on</a>('discovery')接口注册“发现设备”结果事件监听。         <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> <span class="">{</span></li><li>  <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'discovery'</span></span><span class="">, </span><span class="">discoveryCallBack</span><span class="">)</span><span class="">;</span></li><li><span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>  <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">discoveryCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">DiscoveryResult</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">获取到发现的设备 展示设备列表</span></span></li><li>  <span class="">callback</span><span class="">.</span><span class=""><span class="hljs-property">nearbyGameDevices</span></span><span class="">.</span><span class=""><span class="hljs-title function_">forEach</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">device</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">gameNearbyTransfer</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">NearbyGameDevice</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">, </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">number</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span>    </li><li><span class="">  }</span><span class="">)</span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div></li>        <li>发送端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section16687197125918" target="_blank">discoveryNearbyGame</a>发现附近设备。         <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> <span class="">{</span></li><li>  <span class="">gameNearbyTransfer</span><span class="">.</span><span class=""><span class="hljs-title function_">discoveryNearbyGame</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'discoveryNearbyGame success'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">BusinessError</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'discoveryNearbyGame error'</span></span><span class=""> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>)</span><span class="">;</span></li><li>  <span class="">}</span><span class="">)</span></li><li><span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class="">err</span><span class="">) </span><span class="">{</span></li><li>  <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span>;</li><li><span class="">}</span></li></ol></pre></div></div></li>        <li>“发现设备”操作完成后将收到discovery事件回调，获得发现的设备列表供玩家选择，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13279659901" target="_blank">bindNearbyGame</a>接口绑定玩家选定的接收端设备。         <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class=""><span class="hljs-title function_">bindNearbyGame</span></span><span class="">(</span><span class=""><span class="hljs-variable">deviceInfo</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">NearbyGameDevice</span></span><span class="">) </span><span class="">{</span></li><li>  <span class="hljs-keyword">try</span> <span class="">{</span></li><li>    <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">bindInfo</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">BindParameters</span> </span><span class="">= </span><span class="">{</span></li><li>      <span class=""><span class="hljs-variable">deviceId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">deviceInfo</span></span><span class="">.</span><span class=""><span class="hljs-title class_">deviceId</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-variable">networkId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">deviceInfo</span></span><span class="">.</span><span class=""><span class="hljs-title class_">networkId</span></span></li><li>    <span class="">}</span><span class="">;</span></li><li>    <span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title function_">bindNearbyGame</span></span><span class="">(</span><span class=""><span class="hljs-variable">bindInfo</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li><span class="">      <span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">,</span> <span class=""><span class="hljs-string">'bindNearbyGame success'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-keyword">catch</span></span><span class="">((</span><span class=""><span class="hljs-variable">err</span></span><span class="">: </span><span class=""><span class="hljs-title class_">BusinessError</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li><span class="">      <span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'bindNearbyGame error'</span></span><span class=""> + (<span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">Error</span>).<span class="hljs-variable">message</span>)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span></li><li>  <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class=""><span class="hljs-variable">err</span></span><span class="">) </span><span class="">{</span></li><li><span class="">    <span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'bindNearbyGame error'</span> + (<span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">Error</span>).<span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div></li>       </ol></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="section6522106194016">接收端发送自身文件信息<i class="anchor-icon anchor-icon-link" anchorid="section6522106194016" tips="复制节点链接"></i></h3>          <p>收到建链成功回调后，接收端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section12490112992612" target="_blank">sendPackageInfo</a>接口发送自身文件，如版本信息、包信息。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class=""><span class="hljs-title function_">connectNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">ConnectNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">connectState</span> </span><span class="">== </span><span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-variable">ConnectState</span></span><span class="">.</span><span class=""><span class="hljs-variable">CONNECTED</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">连接成功回调</span></span><span class="hljs-comment">，判断当前是否为接收端。若当前设备为接收端，请设置为true，否则请设置为false。</span></li><li>    <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">isReceive</span> </span><span class="">= </span><span class="hljs-keyword">true</span><span class="">;</span></li><li>    <span class="hljs-keyword">if</span> <span class="">(</span><span class="">!</span><span class=""><span class="hljs-variable">isReceive</span></span><span class="">) </span><span class="">{</span></li><li>      <span class="hljs-keyword">return</span><span class="">;</span></li><li>    <span class="">}</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">接收端收到连接回调后需要处理</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">发送资源包信息给发送端</span></span></li><li>    <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">packageInfo</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PackageInfo</span> </span><span class="">= </span><span class="">{</span></li><li>      <span class=""><span class="hljs-variable">name</span></span><span class="">: </span><span class=""><span class="hljs-string">'com.huawei.xxxx'</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-variable">files</span></span><span class="">: </span><span class="">[]</span><span class="">,</span></li><li>      <span class=""><span class="hljs-variable">version</span></span><span class="">: </span><span class=""><span class="hljs-string">'1.1.0'</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-variable">extraData</span></span><span class="">: </span><span class=""><span class="hljs-string">'extraData'</span></span></li><li>    <span class="">}</span><span class="">;</span></li><li>    <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">fileInfo</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">FileInfo</span> </span><span class="">= </span><span class="">{</span></li><li>      <span class=""><span class="hljs-variable">path</span></span><span class="">: </span><span class=""><span class="hljs-string">"/xxx/xxxx/files/data.zip"</span></span><span class="">,</span>  <span class="hljs-comment">// 使用沙箱路径，详情请参见</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">。</span></li><li>      <span class=""><span class="hljs-variable">hash</span></span><span class="">: </span><span class=""><span class="hljs-string">'fileHash'</span> </span><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">可选</span></span></li><li>    <span class="">}</span><span class="">;</span></li><li>    <span class=""><span class="hljs-variable">packageInfo</span></span><span class="">.</span><span class=""><span class="hljs-variable">files</span></span><span class="">?.</span><span class=""><span class="hljs-title function_">push</span></span><span class="">(</span><span class=""><span class="hljs-variable">fileInfo</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="hljs-keyword">try</span> <span class="">{</span></li><li>      <span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title function_">sendPackageInfo</span></span><span class="">(</span><span class=""><span class="hljs-variable">packageInfo</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'sendPackageInfo success'</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-keyword">catch</span></span><span class="">((</span><span class=""><span class="hljs-variable">err</span></span><span class="">: </span><span class=""><span class="hljs-title class_">BusinessError</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'sendPackageInfo error'</span></span><span class=""> + (<span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">Error</span>).<span class="hljs-variable">message</span>)</span><span class="">;</span></li><li>      <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class=""><span class="hljs-variable">err</span></span><span class="">) </span><span class="">{</span></li><li>      <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class=""><span class="hljs-variable">err</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span></li><li><span class="">  }</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section170652064015">发送端对比后传输资源包<i class="anchor-icon anchor-icon-link" anchorid="section170652064015" tips="复制节点链接"></i></h3>          <p>发送端收到接收端发送的版本信息后进行对比，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section78288285293" target="_blank">replyPackageInfoResult</a>上报对比结果，根据对比结果决定是否需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section1227711101118" target="_blank">transferPackageData</a>接口发送资源包数据。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class=""><span class="hljs-title function_">receivePackageInfoCallBack</span></span><span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PackageInfo</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">比较版本</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">决定是否需要发送资源包</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">也可以比较文件</span></span><span class=""><span class="hljs-comment">hash</span></span></li><li>  <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">packageInfoResult</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PackageInfoResult</span> </span><span class="">= </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable">packageInfoResultCode</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PackageInfoResultCode</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PACKAGE_AVAILABLE_COMPARED</span></span></li><li>  <span class="">}</span><span class="">;</span></li><li>  <span class="hljs-keyword">try</span> <span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">上报对比结果</span></span></li><li>    <span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title function_">replyPackageInfoResult</span></span><span class="">(</span><span class=""><span class="hljs-variable">packageInfoResult</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">packageData</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PackageData</span> </span><span class="">= </span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">name</span></span><span class="">: </span><span class=""><span class="hljs-string">'com.huawei.gamenearbydemo'</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">version</span></span><span class="">: </span><span class="hljs-string">'1.0.0'</span><span class="">,</span></li><li>        <span class="hljs-variable">files</span>: [{</li><li>          <span class="hljs-variable">srcPath</span>: <span class="hljs-string">'/data/xxxx/a.zip'</span>, <span class="hljs-comment">// srcPath是需要发送文件的沙箱路径，详情请参见</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">。</span></li><li>          <span class="hljs-variable">destPath</span>: <span class="hljs-string">'xxxx/a.zip'</span>       <span class="hljs-comment">// destPath是接收文件的自定义路径，完整的沙箱路径是</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section116223815415" target="_blank"><span class="hljs-comment">fileStoragePath</span></a><span class="hljs-comment">+destPath，详情请参见</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">。</span></li><li>        }] </li><li>      <span class="">}</span></li><li>      <span class="hljs-keyword">try</span> <span class="">{</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">发送资源包</span></span></li><li>        <span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title function_">transferPackageData</span></span><span class="">(</span><span class=""><span class="hljs-variable">packageData</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>          <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">发送成功</span></span></li><li>        <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-keyword">catch</span></span><span class="">((</span><span class=""><span class="hljs-variable">err</span></span><span class="">: </span><span class=""><span class="hljs-title class_">BusinessError</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>          <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">发送异常</span></span></li><li>          <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class=""><span class="hljs-variable">err</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span>          </li><li>        <span class="">}</span><span class="">)</span><span class="">;</span></li><li>      <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class=""><span class="hljs-variable">err</span></span><span class="">) </span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class=""><span class="hljs-variable">err</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="">}</span></li><li><span class="">    }</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-keyword">catch</span></span><span class="">((</span><span class=""><span class="hljs-variable">err</span></span><span class="">: </span><span class=""><span class="hljs-title class_">BusinessError</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">上报异常</span></span></li><li>      <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class=""><span class="hljs-variable">err</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span><span class="">;</span></li><li>  <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span><span class=""><span class="hljs-variable">err</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'[nearby]'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'error'</span> </span><span class="">+ </span><span class="">(</span><span class=""><span class="hljs-variable">err</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-variable">message</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section13901037174010">处理资源包传输进度信息<i class="anchor-icon anchor-icon-link" anchorid="section13901037174010" tips="复制节点链接"></i></h3>          <p>发送端和接收端在传输回调中处理传输进度信息。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class=""><span class="hljs-title function_">transferNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">: </span><span class=""><span class="hljs-title class_">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-title class_">TransferNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">transferState</span> </span><span class="">== </span><span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-variable">TransferState</span></span><span class="">.</span><span class=""><span class="hljs-variable">SEND_PROCESS</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">处理发送进度</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">如显示进度条和速率</span></span></li><li>  <span class="">}</span></li><li>  <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">transferState</span> </span><span class="">== </span><span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-variable">TransferState</span></span><span class="">.</span><span class=""><span class="hljs-variable">SEND_FINISH</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">发送完成</span></span></li><li>  <span class="">}</span></li><li>  <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">transferState</span> </span><span class="">== </span><span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-variable">TransferState</span></span><span class="">.</span><span class=""><span class="hljs-variable">RECEIVE_PROCESS</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">处理接收进度</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">如显示进度条和速率</span></span></li><li>  <span class="">}</span></li><li>  <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">transferState</span> </span><span class="">== </span><span class=""><span class="hljs-variable">gameNearbyTransfer</span></span><span class="">.</span><span class=""><span class="hljs-variable">TransferState</span></span><span class="">.</span><span class=""><span class="hljs-variable">RECEIVE_FINISH</span></span><span class="">) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">接收完成</span></span><span class=""><span class="hljs-comment">,</span></span><span class=""><span class="hljs-comment">获取到资源包存储的沙箱路径</span></span></li><li>    <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">fileStoragePath</span> </span><span class="">= </span><span class=""><span class="hljs-variable">callback</span></span><span class="">.</span><span class=""><span class="hljs-variable">fileStoragePath</span></span><span class="">;</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">对</span></span><span class=""><span class="hljs-comment">fileStoragePath</span></span><span class=""><span class="hljs-comment">下的文件做处理</span></span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section749293514317">处理已接收资源包后销毁服务<i class="anchor-icon anchor-icon-link" anchorid="section749293514317" tips="复制节点链接"></i></h3>          <p>对已接收数据做好处理或转移后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-nearbytransfer#section13373155416" target="_blank">destroy</a>接口销毁服务。若服务销毁后再次使用近场快传服务，需重新<a href="/consumer/cn/doc/harmonyos-guides/gameservice-nearbytransfer-access-procedure#section8810153223912">创建游戏近场快传服务并注册相关回调</a>。</p>     <div _ngcontent-ncw-c106="" class="highlight-div"><div _ngcontent-ncw-c106="" class="highlight-div-header"><div _ngcontent-ncw-c106="" class="highlight-div-header-left"><div _ngcontent-ncw-c106="" class="handle-button expand-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ncw-c106="" class="highlight-div-header-right"><div _ngcontent-ncw-c106="" class="handle-button ai-button"></div><div _ngcontent-ncw-c106="" class="handle-button line-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ncw-c106="" class="handle-button theme-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ncw-c106="" class="handle-button copy-button"><div _ngcontent-ncw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ncw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li>public <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 取消回调注册</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unregisterCallback</span>();</li><li>  <span class="hljs-comment">// 销毁服务</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    gameNearbyTransfer.<span class="hljs-title function_">destroy</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'destroy success'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'destroy error'</span> <span class="">+ </span><span class="">(</span><span class="">err </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Error</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'error'</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li><li>
</li><li>public <span class="hljs-title function_">unregisterCallback</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    gameNearbyTransfer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'connectNotify'</span>, connectNotifyCallBack);</li><li>    gameNearbyTransfer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'receivePackageInfo'</span>, receivePackageInfoCallBack);</li><li>    gameNearbyTransfer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'transferNotify'</span>, transferNotifyCallBack);</li><li>    gameNearbyTransfer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'error'</span>, errorCallBack);</li><li>    <span class="hljs-comment">// 发送端选择手动绑定接收端且已订阅discovery事件</span></li><li>    gameNearbyTransfer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'discovery'</span>, discoveryCallBack);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'[nearby]'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'error'</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">Error</span>).<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">connectNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">ConnectNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">连接状态回调，接收端收到建链成功回调后，在此处调用</span></span><span class=""><span class="hljs-comment">sendPackageInfo</span></span><span class=""><span class="hljs-comment">接口发送自身文件信息，如版本信息、包信息</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">receivePackageInfoCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">PackageInfo</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">接收包信息回调，发送端收到接收端发送的版本信息后进行对比，根据对比结果决定是否需要传输资源包数据。</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">transferNotifyCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">TransferNotification</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">传输回调，处理传输进度信息</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">errorCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">ReturnResult</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">异常信息回调，处理相关异常信息</span></span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">discoveryCallBack</span></span><span class="">(</span><span class=""><span class="hljs-params">callback</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params">gameNearbyTransfer</span></span><span class=""><span class="hljs-params">.</span></span><span class=""><span class="hljs-params">DiscoveryResult</span></span><span class="">) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">获取到发现的设备 展示设备列表</span></span></li><li>  <span class="">callback</span><span class="">.</span><span class=""><span class="hljs-property">nearbyGameDevices</span></span><span class="">.</span><span class=""><span class="hljs-title function_">forEach</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">device</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">gameNearbyTransfer</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">NearbyGameDevice</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">, </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">number</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li><span class="">  }</span><span class="">)</span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div>    </div>   </div>   <div></div></div>