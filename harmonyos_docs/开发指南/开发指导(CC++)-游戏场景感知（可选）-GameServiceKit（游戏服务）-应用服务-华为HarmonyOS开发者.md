<h1 _ngcontent-drf-c119="" class="doc-title ng-star-inserted" title="开发指导(C/C++)"> 开发指导(C/C++) </h1>

<div _ngcontent-drf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1163717446567">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1163717446567" tips="复制节点链接"></i></h2>          <p><span><img originheight="671" originwidth="953" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114606.82084856249191783944679542459355:50001231000000:2800:036ECFB9F918DF687D8D961B7363FE2D3168AA0979323A5A38B8769C637885B7.png" width="920" height="647.7649527806925"></span></p>     <ol>      <li>游戏启动后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga1045d9d8f4e7972b44ff95571afca8f9" target="_blank">HMS_GamePerformance_Init</a>接口对游戏场景感知进行初始化。</li>      <li>初始化成功后，游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gaa73a9464dbe4a973e7aed559835adbc6" target="_blank">HMS_GamePerformance_RegisterThermalLevelChangedCallback</a>接口注册设备状态变化事件监听，订阅设备状态变化通知。</li>      <li>游戏调用以下接口向游戏场景感知上报各种游戏信息。       <ul>        <li>包信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga317ba7027076ce06ae73a6188bc3b129" target="_blank">HMS_GamePerformance_UpdatePackageInfo</a></li>        <li>配置信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga6fe77ea4f43939333c7c3b07e1204448" target="_blank">HMS_GamePerformance_UpdateConfigInfo</a></li>        <li>场景信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gad9504bae5e5b570e55bdf7f84a7a05bf" target="_blank">HMS_GamePerformance_UpdateSceneInfo</a></li>        <li>网络信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga29ff530f9f37560359fdd0d28ba6275b" target="_blank">HMS_GamePerformance_UpdateNetInfo</a></li>        <li>玩家信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga71c7be26b9531af9bcd807e3255c4e6f" target="_blank">HMS_GamePerformance_UpdatePlayerInfo</a></li>       </ul></li>      <li>游戏场景感知广播游戏信息给终端系统。</li>      <li>终端系统根据游戏信息进行系统资源调度。</li>      <li>终端系统会将设备状态变化通知游戏场景感知。</li>      <li>游戏场景感知向游戏客户端反馈设备状态变化。</li>      <li>如不再需要订阅，游戏可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga306734f0bee9af7697b5fbfa19bafec0" target="_blank">HMS_GamePerformance_UnregisterThermalLevelChangedCallback</a>接口或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga0f2cf9152a9421d00bb0c03683b3f57d" target="_blank">HMS_GamePerformance_UnregisterAllThermalLevelChangedCallbacks</a>接口取消设备状态变化事件监听。</li>      <li>游戏调用以下接口向游戏场景感知主动查询设备状态信息。       <ul>        <li>设备GPU信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga93f67c2befdb52f4b59893a7a300f292" target="_blank">HMS_GamePerformance_QueryGpuInfo</a></li>        <li>设备温控档位和温升趋势信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gab7cb47e0dc3cce1169a8104827f7edb7" target="_blank">HMS_GamePerformance_QueryThermalInfo</a></li>       </ul></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Mali系列GPU不支持采集GPU信息，调用订阅和查询设备状态信息接口时无法获取设备GPU信息。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section1451724123520">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1451724123520" tips="复制节点链接"></i></h2>          <p>具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-c" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="53.879999999999995%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="46.12%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga1045d9d8f4e7972b44ff95571afca8f9" target="_blank">HMS_GamePerformance_Init</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga9ba0e813bb05d37656f9973a35fa0411" target="_blank">GamePerformance_InitParameters</a> *initParameters)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>游戏初始化接口，对游戏场景感知进行初始化。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gaa73a9464dbe4a973e7aed559835adbc6" target="_blank">HMS_GamePerformance_RegisterThermalLevelChangedCallback</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga3ebb81788405856534d8fb3cd6194ca4" target="_blank">GamePerformance_DeviceInfoType</a> *types[], size_t size, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga94e7e85a3f0ad0b495b2c525a15ebc8e" target="_blank">GamePerformance_ThermalLevelChangedCallback</a> callback, void *userData)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>注册温度变化回调接口，当达到触发点时，将调用回调函数。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga317ba7027076ce06ae73a6188bc3b129" target="_blank">HMS_GamePerformance_UpdatePackageInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gab57ecb4bce0af8b741ef4aa069df2d87" target="_blank">GamePerformance_PackageInfo</a> *packageInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏包信息接口，用于上报游戏包信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga6fe77ea4f43939333c7c3b07e1204448" target="_blank">HMS_GamePerformance_UpdateConfigInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gab05a6dca6b3570c3b45d74a9cb8ffdc9" target="_blank">GamePerformance_ConfigInfo</a> *configInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏配置信息接口，用于上报游戏配置信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gad9504bae5e5b570e55bdf7f84a7a05bf" target="_blank">HMS_GamePerformance_UpdateSceneInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga64047fc82c0783c507e34e10c735e4d7" target="_blank">GamePerformance_SceneInfo</a> *sceneInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏场景信息接口，用于上报游戏场景信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga29ff530f9f37560359fdd0d28ba6275b" target="_blank">HMS_GamePerformance_UpdateNetInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gaba275a8588101424676258ffa7217097" target="_blank">GamePerformance_NetInfo</a> *netInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏网络信息接口，用于上报游戏网络信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga71c7be26b9531af9bcd807e3255c4e6f" target="_blank">HMS_GamePerformance_UpdatePlayerInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga804b472fc080d73a2ce23da927ffd842" target="_blank">GamePerformance_PlayerInfo</a> *playerInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>更新游戏玩家信息接口，用于上报游戏玩家信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga306734f0bee9af7697b5fbfa19bafec0" target="_blank">HMS_GamePerformance_UnregisterThermalLevelChangedCallback</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga94e7e85a3f0ad0b495b2c525a15ebc8e" target="_blank">GamePerformance_ThermalLevelChangedCallback</a> callback)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消注册指定温度变化回调接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga0f2cf9152a9421d00bb0c03683b3f57d" target="_blank">HMS_GamePerformance_UnregisterAllThermalLevelChangedCallbacks</a> (void)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>取消注册所有温度变化回调接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gab7cb47e0dc3cce1169a8104827f7edb7" target="_blank">HMS_GamePerformance_QueryThermalInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga0e825c8963101d40a987d4057033c788" target="_blank">GamePerformance_ThermalInfoQueryParameters</a> *parameters, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga6767ea8a1d76ed32db95dc0d3a265a8a" target="_blank">GamePerformance_ThermalInfo</a> **thermalInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>查询温度信息接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="53.879999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga615243fda2406a6f9cd3a406874b6316" target="_blank">GamePerformance_ErrorCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga93f67c2befdb52f4b59893a7a300f292" target="_blank">HMS_GamePerformance_QueryGpuInfo</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gae85f740f82b3ca3f7ec9892d2f81a113" target="_blank">GamePerformance_GpuInfo</a> **gpuInfo)</p></td>         <td class="cellrowborder" valign="top" width="46.12%">          <p>查询GPU信息接口。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section6371255162016">接入步骤<i class="anchor-icon anchor-icon-link" anchorid="section6371255162016" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1930155395119" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="section1930155395119" tips="复制节点链接"></i></h3>          <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_include_directories</span>(entry PUBLIC ${HMOS_SDK_NATIVE}/sysroot/usr/include)</li><li><span class="hljs-built_in">target_link_directories</span>(entry PUBLIC ${HMOS_SDK_NATIVE}/sysroot/usr/lib/aarch64-linux-ohos)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libgame_performance.z.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1950011420318">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section1950011420318" tips="复制节点链接"></i></h3>          <p>导入Game Service Kit。</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;GameServiceKit/game_performance.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section149441945104812">初始化<i class="anchor-icon anchor-icon-link" anchorid="section149441945104812" tips="复制节点链接"></i></h3>          <p>导入相关模块后，需先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga1045d9d8f4e7972b44ff95571afca8f9" target="_blank">HMS_GamePerformance_Init</a>接口对游戏场景感知进行初始化。</p>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>HMS_GamePerformance_Init接口是调用其他接口的前提，如果未初始化或初始化失败，将无法调用其他接口。</p>     </div></div></div>    <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建初始化参数 </span></li><li><span class="hljs-title class_">GamePerformance</span>_InitParameters *initParameters = <span class="hljs-variable constant_">NULL</span>; </li><li><span class="hljs-title function_">HMS_GamePerformance_CreateInitParameters</span>(&amp;initParameters);</li><li>
</li><li><span class="hljs-comment">// 设置参数，所有SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode appVersionSetCode = <span class="hljs-title function_">HMS_GamePerformance_InitParameters_SetAppVersion</span>(initParameters, <span class="hljs-string">"1.0"</span>);</li><li>
</li><li><span class="hljs-comment">// 所有SetXXX接口，如果参数设置错误，将会返回错误码401；为确保参数设置无误，建议接收返回值并判断错误码</span></li><li><span class="hljs-keyword">if</span> (appVersionSetCode != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li><span class="hljs-title function_">HMS_GamePerformance_InitParameters_SetBundleName</span>(initParameters, <span class="hljs-string">"com.example.demo"</span>); </li><li> </li><li><span class="hljs-comment">// 初始化</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_Init</span>(initParameters);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyInitParameters</span>(&amp;initParameters);</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section2023034211481">注册温度变化回调<i class="anchor-icon anchor-icon-link" anchorid="section2023034211481" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gaa73a9464dbe4a973e7aed559835adbc6" target="_blank">HMS_GamePerformance_RegisterThermalLevelChangedCallback</a>接口可以注册温度变化回调，获取设备状态信息的通知（如温控档位、温升趋势、GPU负载等）。</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 定义回调函数</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onThermalLevelChanged</span>(<span class="hljs-params">GamePerformance_DeviceInfo *deviceInfo, <span class="hljs-built_in">void</span> *userData</span>) {</li><li>    <span class="hljs-comment">// 获取gpu负载等级（须订阅设备信息类型：GAME_PERFORMANCE_DEVICEINFO_TYPE_GPU）</span></li><li>    (<span class="hljs-built_in">void</span>) userData;</li><li>    <span class="hljs-title class_">GamePerformance</span>_GpuInfo *gpuInfo = <span class="hljs-variable constant_">NULL</span>;</li><li>    <span class="hljs-title function_">HMS_GamePerformance_DeviceInfo_GetGpuInfo</span>(deviceInfo, &amp;gpuInfo);</li><li>    int32_t gpuloadLevel = -<span class="hljs-number">1</span>;</li><li>    int32_t vertexLevel = -<span class="hljs-number">1</span>;</li><li>    int32_t fragmentLoadLevel = -<span class="hljs-number">1</span>;</li><li>    int32_t bandwidthLoadLevel = -<span class="hljs-number">1</span>;</li><li>    int32_t textureLoadLevel = -<span class="hljs-number">1</span>;</li><li>    int32_t currentFrequency = -<span class="hljs-number">1</span>;</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetGpuLoadLevel</span>(gpuInfo, &amp;gpuloadLevel);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetVertexLoadLevel</span>(gpuInfo, &amp;vertexLevel);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetFragmentLoadLevel</span>(gpuInfo, &amp;fragmentLoadLevel);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetBandwidthLoadLevel</span>(gpuInfo, &amp;bandwidthLoadLevel);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetTextureLoadLevel</span>(gpuInfo, &amp;textureLoadLevel);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetCurrentFrequency</span>(gpuInfo, &amp;currentFrequency);</li><li>
</li><li>    <span class="hljs-comment">// 获取温度相关信息（须订阅设备信息类型：GAME_PERFORMANCE_DEVICEINFO_TYPE_THERMAL）</span></li><li>    <span class="hljs-title class_">GamePerformance</span>_ThermalInfo *thermalInfo = <span class="hljs-variable constant_">NULL</span>;</li><li>    <span class="hljs-title function_">HMS_GamePerformance_DeviceInfo_GetThermalInfo</span>(deviceInfo, &amp;thermalInfo);</li><li>    int32_t margin = <span class="hljs-title class_">INT32</span>_MIN;</li><li>    int32_t trend = <span class="hljs-title class_">INT32</span>_MIN;</li><li>    int32_t level = -<span class="hljs-number">1</span>;</li><li>    <span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalMargin</span>(thermalInfo, &amp;margin);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalTrend</span>(thermalInfo, &amp;trend);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalLevel</span>(thermalInfo, &amp;level);</li><li>
</li><li>    <span class="hljs-comment">// 使用完释放内存</span></li><li>    <span class="hljs-title function_">HMS_GamePerformance_DestroyGpuInfo</span>(&amp;gpuInfo);</li><li>    <span class="hljs-title function_">HMS_GamePerformance_DestroyThermalInfo</span>(&amp;thermalInfo);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 注册回调</span></li><li><span class="hljs-built_in">void</span> <span class="hljs-title function_">registerCallback</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 按需订阅设备信息类型</span></li><li>    int size = <span class="hljs-number">2</span>; <span class="hljs-comment">// 订阅的设备信息类型的数量，即下文array数组的长度</span></li><li>    <span class="hljs-title class_">GamePerformance</span>_DeviceInfoType **array = (<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType **)<span class="hljs-title function_">malloc</span>(<span class="hljs-title function_">sizeof</span>(<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType *) * size);</li><li>    <span class="hljs-keyword">if</span> (array == <span class="hljs-variable constant_">NULL</span>) {</li><li>        <span class="hljs-comment">// 异常处理</span></li><li>    }</li><li>    array[<span class="hljs-number">0</span>] = (<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType *)<span class="hljs-title function_">malloc</span>(<span class="hljs-title function_">sizeof</span>(<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType));</li><li>    array[<span class="hljs-number">1</span>] = (<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType *)<span class="hljs-title function_">malloc</span>(<span class="hljs-title function_">sizeof</span>(<span class="hljs-title class_">GamePerformance</span>_DeviceInfoType));</li><li>    <span class="hljs-keyword">if</span> (!array[<span class="hljs-number">0</span>] || !array[<span class="hljs-number">1</span>]) {</li><li>        <span class="hljs-comment">// 异常处理</span></li><li>    }</li><li>    *(array[<span class="hljs-number">0</span>]) = <span class="hljs-variable constant_">GAME_PERFORMANCE_DEVICEINFO_TYPE_GPU</span>;</li><li>    *(array[<span class="hljs-number">1</span>]) = <span class="hljs-variable constant_">GAME_PERFORMANCE_DEVICEINFO_TYPE_THERMAL</span>;</li><li>    <span class="hljs-built_in">void</span> *userData = (<span class="hljs-built_in">void</span> *)<span class="hljs-string">"mydata"</span>; <span class="hljs-comment">// 用户自定义任意类型，callback透传返回</span></li><li>    <span class="hljs-title class_">GamePerformance</span>_ErrorCode ret =</li><li>        <span class="hljs-title function_">HMS_GamePerformance_RegisterThermalLevelChangedCallback</span>(array, size, onThermalLevelChanged, userData);</li><li>    <span class="hljs-title function_">free</span>(array);</li><li>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>        <span class="hljs-comment">// 异常处理</span></li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section312014395493">取消注册指定温度变化回调<i class="anchor-icon anchor-icon-link" anchorid="section312014395493" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga306734f0bee9af7697b5fbfa19bafec0" target="_blank">HMS_GamePerformance_UnregisterThermalLevelChangedCallback</a>接口可以取消注册指定温度变化回调。</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 取消注册</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UnregisterThermalLevelChangedCallback</span>(onThermalLevelChanged);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section12256692587">取消注册所有温度变化回调<i class="anchor-icon anchor-icon-link" anchorid="section12256692587" tips="复制节点链接"></i></h3>          <p>可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga0f2cf9152a9421d00bb0c03683b3f57d" target="_blank">HMS_GamePerformance_UnregisterAllThermalLevelChangedCallbacks</a>接口可以取消注册所有温度变化回调。</p>    </div>    <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 取消所有注册的函数</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UnregisterAllThermalLevelChangedCallbacks</span>();</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section17318926114911">上报游戏包信息<i class="anchor-icon anchor-icon-link" anchorid="section17318926114911" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga317ba7027076ce06ae73a6188bc3b129" target="_blank">HMS_GamePerformance_UpdatePackageInfo</a>接口上报游戏包信息。</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">GamePerformance</span>_PackageInfo *packageInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_CreatePackageInfo</span>(&amp;packageInfo);</li><li>
</li><li><span class="hljs-comment">// SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-comment">// 设置必选参数</span></li><li><span class="hljs-title function_">HMS_GamePerformance_PackageInfo_SetBundleName</span>(packageInfo, <span class="hljs-string">"com.example.demo"</span>);  </li><li><span class="hljs-title function_">HMS_GamePerformance_PackageInfo_SetAppVersion</span>(packageInfo, <span class="hljs-string">"1.0"</span>);</li><li>
</li><li><span class="hljs-comment">// 按需设置可选参数</span></li><li><span class="hljs-title function_">HMS_GamePerformance_PackageInfo_SetEngineType</span>(packageInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_ENGINE_TYPE_COCOS</span>);  </li><li><span class="hljs-title function_">HMS_GamePerformance_PackageInfo_SetEngineVersion</span>(packageInfo, <span class="hljs-string">"2.0"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_PackageInfo_SetGameType</span>(packageInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_GAME_TYPE_FPS</span>);  </li><li>
</li><li><span class="hljs-comment">// 上报游戏包信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UpdatePackageInfo</span>(packageInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyPackageInfo</span>(&amp;packageInfo);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section17802105113812">上报游戏配置信息<i class="anchor-icon anchor-icon-link" anchorid="section17802105113812" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga6fe77ea4f43939333c7c3b07e1204448" target="_blank">HMS_GamePerformance_UpdateConfigInfo</a>接口上报游戏配置信息。</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">GamePerformance</span>_ConfigInfo *configInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_CreateConfigInfo</span>(&amp;configInfo);</li><li>
</li><li><span class="hljs-comment">// 如需多次上报，若使用同一个实例上报，只需通过set方法更新参数即可（同一个实例将保留上一次设置的数据）</span></li><li><span class="hljs-comment">// SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-comment">// 按需设置下列可选字段</span></li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetMaxPictureQualityLevel</span>(configInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_PQL_BALANCED</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetCurrentPictureQualityLevel</span>(configInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_PQL_HD</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetMaxFrameRate</span>(configInfo, <span class="hljs-number">120</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetCurrentFrameRate</span>(configInfo, <span class="hljs-number">60</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetMaxResolution</span>(configInfo, <span class="hljs-string">"1260*2720"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetCurrentResolution</span>(configInfo, <span class="hljs-string">"1260*2720"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetAntiAliasingEnabled</span>(configInfo, <span class="hljs-literal">true</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetShadowEnabled</span>(configInfo, <span class="hljs-literal">true</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetMultithreadingEnabled</span>(configInfo, <span class="hljs-literal">true</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetParticleEnabled</span>(configInfo, <span class="hljs-literal">true</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_ConfigInfo_SetHdModeEnabled</span>(configInfo, <span class="hljs-literal">true</span>);</li><li>
</li><li><span class="hljs-comment">// 上报游戏配置信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UpdateConfigInfo</span>(configInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyConfigInfo</span>(&amp;configInfo);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section72101642164316">上报游戏场景信息<i class="anchor-icon anchor-icon-link" anchorid="section72101642164316" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gad9504bae5e5b570e55bdf7f84a7a05bf" target="_blank">HMS_GamePerformance_UpdateSceneInfo</a>接口上报游戏场景信息。</p>    </div>    <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-title class_">GamePerformance</span>_SceneInfo *sceneInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_CreateSceneInfo</span>(&amp;sceneInfo);</li><li>
</li><li><span class="hljs-comment">// 如需多次上报，若使用同一个实例上报，只需通过set方法更新参数即可（同一个实例将保留上一次设置的数据）</span></li><li><span class="hljs-comment">// 设置必选字段</span></li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetSceneID</span>(sceneInfo, <span class="hljs-number">1</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetImportanceLevel</span>(sceneInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_SIL_LEVEL1</span>);</li><li>
</li><li><span class="hljs-comment">// 按需设置下列可选字段</span></li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetDescription</span>(sceneInfo, <span class="hljs-string">"this is description of scene"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetSubSceneID</span>(sceneInfo, <span class="hljs-string">"20101020304"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetSubDescription</span>(sceneInfo, <span class="hljs-string">"this is description of subScene"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetSceneFrequency</span>(sceneInfo, <span class="hljs-number">2</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetSceneTime</span>(sceneInfo, <span class="hljs-number">15</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetRecommendedCpuLevel</span>(sceneInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_CPU_LEVEL_HIGH</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetRecommendedGpuLevel</span>(sceneInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_GPU_LEVEL_HIGH</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetRecommendedDdrLevel</span>(sceneInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_DDR_LEVEL_HIGH</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetKeyThread</span>(sceneInfo, <span class="hljs-string">"render"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetDrawCallCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetVertexCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetTriangleCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetShaderCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetTextureCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetMeshCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetChannelCount</span>(sceneInfo, <span class="hljs-number">100</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_SceneInfo_SetParticipantCount</span>(sceneInfo, <span class="hljs-number">5</span>);</li><li>
</li><li><span class="hljs-comment">// 上报游戏场景信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UpdateSceneInfo</span>(sceneInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroySceneInfo</span>(&amp;sceneInfo);</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section16915171034520">上报游戏网络信息<i class="anchor-icon anchor-icon-link" anchorid="section16915171034520" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga29ff530f9f37560359fdd0d28ba6275b" target="_blank">HMS_GamePerformance_UpdateNetInfo</a>接口上报游戏网络信息。</p>    </div>    <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-title class_">GamePerformance</span>_NetInfo *netInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_CreateNetInfo</span>(&amp;netInfo);</li><li>
</li><li><span class="hljs-comment">// 如需多次上报，若使用同一个实例上报，只需通过set方法更新参数即可（同一个实例将保留上一次设置的数据）</span></li><li><span class="hljs-comment">// 设置必选字段</span></li><li><span class="hljs-title function_">HMS_GamePerformance_NetInfo_SetTotalLatency</span>(netInfo, <span class="hljs-number">60</span>);</li><li>
</li><li><span class="hljs-comment">// 按需设置下列可选字段</span></li><li><span class="hljs-title function_">HMS_GamePerformance_NetInfo_SetNetLoad</span>(netInfo, <span class="hljs-variable constant_">GAME_PERFORMANCE_NET_LOAD_HEAVY</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_NetInfo_SetUplinkLatency</span>(netInfo, <span class="hljs-number">10</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_NetInfo_SetDownlinkLatency</span>(netInfo, <span class="hljs-number">20</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_NetInfo_SetServerLatency</span>(netInfo, <span class="hljs-number">30</span>);</li><li>
</li><li><span class="hljs-comment">// 上报游戏网络信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UpdateNetInfo</span>(netInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyNetInfo</span>(&amp;netInfo);</li></ol></pre></div></div>    <p></p>    <div class="tiledSection">     <h3 id="section15569122814517">上报游戏玩家信息<i class="anchor-icon anchor-icon-link" anchorid="section15569122814517" tips="复制节点链接"></i></h3>          <p>初始化成功后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga71c7be26b9531af9bcd807e3255c4e6f" target="_blank">HMS_GamePerformance_UpdatePlayerInfo</a>接口上报游戏玩家信息。</p>    </div>    <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// SetXXX接口的第二个参数均为示例，请替换成实际参数</span></li><li><span class="hljs-title class_">GamePerformance</span>_PlayerInfo *playerInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_CreatePlayerInfo</span>(&amp;playerInfo);</li><li>
</li><li><span class="hljs-comment">// 下列三个参数至少设置一个</span></li><li><span class="hljs-title function_">HMS_GamePerformance_PlayerInfo_SetGamePlayerId</span>(playerInfo, <span class="hljs-string">"43JIOdok74***3980sd9453"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_PlayerInfo_SetTeamPlayerId</span>(playerInfo, <span class="hljs-string">"s2546dgs38***374dgwa5g3"</span>);</li><li><span class="hljs-title function_">HMS_GamePerformance_PlayerInfo_SetThirdOpenId</span>(playerInfo, <span class="hljs-string">"k854Cs367***937efwhi03"</span>);</li><li>
</li><li><span class="hljs-comment">// 上报游戏玩家信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_UpdatePlayerInfo</span>(playerInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyPlayerInfo</span>(&amp;playerInfo);</li></ol></pre></div></div>    <p></p>    <div class="tiledSection">     <h3 id="section12803101194718">查询GPU信息<i class="anchor-icon anchor-icon-link" anchorid="section12803101194718" tips="复制节点链接"></i></h3>          <p>除订阅设备状态变化的方式外，也可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#ga93f67c2befdb52f4b59893a7a300f292" target="_blank">HMS_GamePerformance_QueryGpuInfo</a>接口主动查询设备GPU信息：</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 查询GPU信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_GpuInfo *gpuInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_QueryGpuInfo</span>(&amp;gpuInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取指标数据值</span></li><li>int32_t gpuloadLevel = -<span class="hljs-number">1</span>;</li><li>int32_t bandwidth = -<span class="hljs-number">1</span>;</li><li>int32_t currentFrequency = -<span class="hljs-number">1</span>;</li><li>int32_t fragmentLoadLevel = -<span class="hljs-number">1</span>;</li><li>int32_t textureLoadLevel = -<span class="hljs-number">1</span>;</li><li>int32_t vertexLoadLevel = -<span class="hljs-number">1</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetGpuLoadLevel</span>(gpuInfo, &amp;gpuloadLevel);</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetBandwidthLoadLevel</span>(gpuInfo, &amp;bandwidth);</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetCurrentFrequency</span>(gpuInfo, &amp;currentFrequency);</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetFragmentLoadLevel</span>(gpuInfo, &amp;fragmentLoadLevel);</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetTextureLoadLevel</span>(gpuInfo, &amp;textureLoadLevel);</li><li><span class="hljs-title function_">HMS_GamePerformance_GpuInfo_GetVertexLoadLevel</span>(gpuInfo, &amp;vertexLoadLevel);</li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyGpuInfo</span>(&amp;gpuInfo);</li></ol></pre></div></div>     <p></p>    </div>    <div class="tiledSection">     <h3 id="section78701243203710">查询温度信息<i class="anchor-icon anchor-icon-link" anchorid="section78701243203710" tips="复制节点链接"></i></h3>          <p>除订阅设备状态变化的方式外，也可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice_game_performance#gab7cb47e0dc3cce1169a8104827f7edb7" target="_blank">HMS_GamePerformance_QueryThermalInfo</a>接口主动查询设备温控档位和温升趋势：</p>     <div _ngcontent-drf-c106="" class="highlight-div"><div _ngcontent-drf-c106="" class="highlight-div-header"><div _ngcontent-drf-c106="" class="highlight-div-header-left"><div _ngcontent-drf-c106="" class="handle-button expand-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drf-c106="" class="highlight-div-header-right"><div _ngcontent-drf-c106="" class="handle-button ai-button"></div><div _ngcontent-drf-c106="" class="handle-button line-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drf-c106="" class="handle-button theme-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drf-c106="" class="handle-button copy-button"><div _ngcontent-drf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drf-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 查询温度和温升趋势</span></li><li><span class="hljs-title class_">GamePerformance</span>_ThermalInfo *thermalInfo = <span class="hljs-variable constant_">NULL</span>;</li><li><span class="hljs-title class_">GamePerformance</span>_ThermalInfoQueryParameters *parameters = <span class="hljs-variable constant_">NULL</span>;</li><li>
</li><li><span class="hljs-comment">// 创建查询参数</span></li><li><span class="hljs-title function_">HMS_GamePerformance_CreateThermalInfoQueryParameters</span>(&amp;parameters);</li><li>
</li><li><span class="hljs-comment">// 设置是否预测温升趋势； true：将查询温升趋势预测信息； false:不会查询温升趋势预测信息； 默认：false</span></li><li><span class="hljs-title function_">HMS_GamePerformance_ThermalInfoQueryParameters_SetNeedsPrediction</span>(parameters, <span class="hljs-literal">true</span>); </li><li>
</li><li><span class="hljs-comment">// needsPrediction=true时选填（false时无需设置该参数）。若设置目标温度等级, 将以该温度等级作为目标温度等级进行温升趋势预测；若不设置，将使用系统默认档位进行预测。</span></li><li><span class="hljs-title function_">HMS_GamePerformance_ThermalInfoQueryParameters_SetTargetThermalLevel</span>(parameters, <span class="hljs-number">4</span>); </li><li>
</li><li><span class="hljs-comment">// 查询温度信息</span></li><li><span class="hljs-title class_">GamePerformance</span>_ErrorCode ret = <span class="hljs-title function_">HMS_GamePerformance_QueryThermalInfo</span>(parameters, &amp;thermalInfo);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-variable constant_">GAME_PERFORMANCE_SUCCESS</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li>int32_t margin = <span class="hljs-title class_">INT32</span>_MIN;</li><li>int32_t trend = <span class="hljs-title class_">INT32</span>_MIN;</li><li>int32_t level = -<span class="hljs-number">1</span>;</li><li><span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalLevel</span>(thermalInfo, &amp;level);</li><li><span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalMargin</span>(thermalInfo, &amp;margin); <span class="hljs-comment">// needsPrediction=true时,返回有效值</span></li><li><span class="hljs-title function_">HMS_GamePerformance_ThermalInfo_GetThermalTrend</span>(thermalInfo, &amp;trend); <span class="hljs-comment">// needsPrediction=true时,返回有效值</span></li><li>
</li><li><span class="hljs-comment">// 使用完释放内存</span></li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyThermalInfo</span>(&amp;thermalInfo);</li><li><span class="hljs-title function_">HMS_GamePerformance_DestroyThermalInfoQueryParameters</span>(&amp;parameters);</li></ol></pre></div></div>     <p></p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>查询温度变化趋势需要历史数据作为计算依据，调用该接口时请保证设备已启动至少一分钟，否则会返回1010300001错误。</p>      </div></div></div>    </div>   </div>   <div></div></div>