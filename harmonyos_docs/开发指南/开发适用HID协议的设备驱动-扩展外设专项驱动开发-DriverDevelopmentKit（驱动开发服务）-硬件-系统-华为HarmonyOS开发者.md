<h1 _ngcontent-yiy-c119="" class="doc-title ng-star-inserted" title="开发适用HID协议的设备驱动"> 开发适用HID协议的设备驱动 </h1>

<div _ngcontent-yiy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2>          <p>HID DDK（HID Driver Development Kit）是为开发者提供的HID设备驱动程序开发套件，支持开发者基于用户态，在应用层开发HID设备驱动。提供了一系列主机侧访问设备的接口，包括创建设备、向设备发送事件、销毁设备、打开关闭设备、读取写入报告、获取设备信息等。</p>     <p>凡是采用USB总线，通过HID协议传输数据的设备，或者通过扩展外设驱动创建虚拟设备，来实现与非标设备的信息交互都可以使用HID DDK开发设备驱动。</p>    </div>    <div class="tiledSection">     <h3 id="基本概念" class="firsth2">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h3>          <p>在进行HID DDK开发前，开发者应了解以下基本概念：</p>     <ul>      <li>       <p><strong>HID</strong></p>       <p>HID（Human Interface Device），中文意思是“人机接口设备”。它是一类用于实现人与计算机或其他电子设备交互的硬件设备。HID 设备的主要功能是将用户的输入（如按键、点击、移动等）转换为数据信号，并将这些信号发送给主机设备（如计算机、平板、游戏机等），从而实现用户对设备的控制和操作。</p></li>      <li>       <p><strong>DDK</strong></p>       <p>DDK（Driver Development Kit）是HarmonyOS基于扩展外设框架，为开发者提供的驱动应用开发的工具包，可针对非标USB串口设备，开发对应的驱动。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="实现原理">实现原理<i class="anchor-icon anchor-icon-link" anchorid="实现原理" tips="复制节点链接"></i></h3>          <p>非标外设应用通过扩展外设管理服务获取HID设备的ID，通过RPC将ID和要操作的动作下发给HID设备驱动应用，驱动应用通过调用HID DDK接口可创建、销毁HID设备，以及对HID设备发送事件，获取HID报文，解析报文等，DDK接口使用HDI服务将指令下发至内核驱动，内核驱动使用指令与设备通信。</p>     <p><strong>图1</strong> HID DDK调用原理</p>     <p><span><img originheight="641" originwidth="930" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115040.57700609558755863889367906337907:50001231000000:2800:CE98053DF9EB52359437535C4A0044E151220E1B06813723FC89D9129043B4BE.png" width="920" height="634.1075268817204"></span></p>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>HID DDK开放API支持非标HID类外设扩展驱动开发场景。</p></li>      <li>       <p>HID DDK开放API仅允许DriverExtensionAbility生命周期内使用。</p></li>      <li>       <p>使用HID DDK开放API需要在module.json5中声明匹配的ACL权限，例如ohos.permission.ACCESS_DDK_HID。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Hid_CreateDevice(Hid_Device *hidDevice, Hid_EventProperties *hidEventProperties)</td>         <td class="cellrowborder" valign="top" width="50%">创建HID设备。请在设备使用完后使用OH_Hid_DestroyDevice销毁设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Hid_EmitEvent(int32_t deviceId, const Hid_EmitItem items[], uint16_t length)</td>         <td class="cellrowborder" valign="top" width="50%">向指定deviceId的HID设备发送事件。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Hid_DestroyDevice(int32_t deviceId)</td>         <td class="cellrowborder" valign="top" width="50%">销毁指定deviceId的HID设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Init(void)</td>         <td class="cellrowborder" valign="top" width="50%">初始化HID DDK。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Release(void)</td>         <td class="cellrowborder" valign="top" width="50%">释放HID DDK。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Open(uint64_t deviceId, uint8_t interfaceIndex, Hid_DeviceHandle **dev)</td>         <td class="cellrowborder" valign="top" width="50%">打开deviceId和interfaceIndex指定的设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Close(Hid_DeviceHandle **dev)</td>         <td class="cellrowborder" valign="top" width="50%">关闭设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Write(Hid_DeviceHandle *dev, uint8_t *data, uint32_t length, uint32_t *bytesWritten)</td>         <td class="cellrowborder" valign="top" width="50%">向设备写入报告。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_ReadTimeout(Hid_DeviceHandle *dev, uint8_t *data, uint32_t buffSize, int timeout, uint32_t *bytesRead)</td>         <td class="cellrowborder" valign="top" width="50%">在指定的超时时间内从设备读取报告。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_Read(Hid_DeviceHandle *dev, uint8_t *data, uint32_t buffSize, uint32_t *bytesRead)</td>         <td class="cellrowborder" valign="top" width="50%">从设备读取报告，默认为阻塞模式（阻塞等待直到有数据可读取），可以调用OH_Hid_SetNonBlocking改变模式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_SetNonBlocking(Hid_DeviceHandle *dev, int nonblock)</td>         <td class="cellrowborder" valign="top" width="50%">设置设备读取模式为非阻塞。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetRawInfo(Hid_DeviceHandle *dev, Hid_RawDevInfo *rawDevInfo)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备原始信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetRawName(Hid_DeviceHandle *dev, char *data, uint32_t buffSize)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备原始名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetPhysicalAddress(Hid_DeviceHandle *dev, char *data, uint32_t buffSize)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备物理地址。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetRawUniqueId(Hid_DeviceHandle *dev, uint8_t *data, uint32_t buffSize)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备原始唯一标识符。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_SendReport(Hid_DeviceHandle *dev, Hid_ReportType reportType, const uint8_t *data, uint32_t length)</td>         <td class="cellrowborder" valign="top" width="50%">向设备发送报告。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetReport(Hid_DeviceHandle *dev, Hid_ReportType reportType, uint8_t *data, uint32_t buffSize)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备报告。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int32_t OH_Hid_GetReportDescriptor(Hid_DeviceHandle *dev, uint8_t *buf, uint32_t buffSize, uint32_t *bytesRead)</td>         <td class="cellrowborder" valign="top" width="50%">获取设备报告描述符。</td>        </tr>             </tbody></table></div>     </div>     <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-hidddk" target="_blank">HID DDK</a>。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="hid基础驱动能力开发" class="firsth2">HID基础驱动能力开发<i class="anchor-icon anchor-icon-link" anchorid="hid基础驱动能力开发" tips="复制节点链接"></i></h3>          <p>以下步骤描述了如何使用 <strong>HID DDK</strong>开发HID设备驱动：</p>     <p><strong>添加动态链接库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libhid.z.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hid/hid_ddk_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hid/hid_ddk_types.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>创建设备。</p>       <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_CreateDevice</strong> 接口创建HID设备，成功返回设备deviceId，失败返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-hid-ddk-types-h#hid_ddkerrcode" target="_blank">错误码</a>。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建HID设备属性</span></li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">Hid_DeviceProp</span>&gt; <span class="hljs-title class_">deviceProp</span> = {<span class="hljs-variable">HID_PROP_DIRECT</span>}; <span class="hljs-comment">// 需要引入头文件 #include &lt;vector&gt;</span></li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">deviceName</span> = <span class="hljs-string">"keyboard"</span>; <span class="hljs-comment">// 需要引入头文件 #include &lt;string&gt;</span></li><li><span class="hljs-variable">Hid_Device</span> <span class="hljs-variable">hidDevice</span> = {</li><li>    .<span class="hljs-variable">deviceName</span> = <span class="hljs-variable">deviceName</span>.<span class="hljs-title function_">c_str</span>(),</li><li>    .<span class="hljs-variable">vendorId</span> = <span class="hljs-number">0x6006</span>,</li><li>    .<span class="hljs-variable">productId</span> = <span class="hljs-number">0x6006</span>,</li><li>    .<span class="hljs-variable">version</span> = <span class="hljs-number">1</span>,</li><li>    .<span class="hljs-variable">bustype</span> = <span class="hljs-number">3</span>,</li><li>    .<span class="hljs-variable">properties</span> = <span class="hljs-variable">deviceProp</span>.<span class="hljs-title function_">data</span>(),</li><li>    .<span class="hljs-variable">propLength</span> = (<span class="hljs-variable">uint16_t</span>)<span class="hljs-variable">deviceProp</span>.<span class="hljs-title function_">size</span>()</li><li>};</li><li><span class="hljs-comment">// 构建HID设备关注的事件属性</span></li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">Hid_EventType</span>&gt; <span class="hljs-title class_">eventType</span> = {<span class="hljs-variable">HID_EV_ABS</span>, <span class="hljs-variable">HID_EV_KEY</span>, <span class="hljs-variable">HID_EV_SYN</span>, <span class="hljs-variable">HID_EV_MSC</span>};</li><li><span class="hljs-variable">Hid_EventTypeArray</span> <span class="hljs-variable">eventTypeArray</span> = {.<span class="hljs-variable">hidEventType</span> = <span class="hljs-variable">eventType</span>.<span class="hljs-title function_">data</span>(), .<span class="hljs-variable">length</span> = (<span class="hljs-variable">uint16_t</span>)<span class="hljs-variable">eventType</span>.<span class="hljs-title function_">size</span>()};</li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">Hid_KeyCode</span>&gt; <span class="hljs-title class_">keyCode</span> = {<span class="hljs-variable">HID_BTN_TOOL_PEN</span>, <span class="hljs-variable">HID_BTN_TOOL_RUBBER</span>, <span class="hljs-variable">HID_BTN_TOUCH</span>, <span class="hljs-variable">HID_BTN_STYLUS</span>, <span class="hljs-variable">HID_BTN_RIGHT</span>};</li><li><span class="hljs-variable">Hid_KeyCodeArray</span> <span class="hljs-variable">keyCodeArray</span> = {.<span class="hljs-variable">hidKeyCode</span> = <span class="hljs-variable">keyCode</span>.<span class="hljs-title function_">data</span>(), .<span class="hljs-variable">length</span> = (<span class="hljs-variable">uint16_t</span>)<span class="hljs-variable">keyCode</span>.<span class="hljs-title function_">size</span>()};</li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">Hid_MscEvent</span>&gt; <span class="hljs-title class_">mscEvent</span> = {<span class="hljs-variable">HID_MSC_SCAN</span>};</li><li><span class="hljs-variable">Hid_MscEventArray</span> <span class="hljs-variable">mscEventArray</span> = {.<span class="hljs-variable">hidMscEvent</span> = <span class="hljs-variable">mscEvent</span>.<span class="hljs-title function_">data</span>(), .<span class="hljs-variable">length</span> = (<span class="hljs-variable">uint16_t</span>)<span class="hljs-variable">mscEvent</span>.<span class="hljs-title function_">size</span>()};</li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">Hid_AbsAxes</span>&gt; <span class="hljs-title class_">absAxes</span> = {<span class="hljs-variable">HID_ABS_X</span>, <span class="hljs-variable">HID_ABS_Y</span>, <span class="hljs-variable">HID_ABS_PRESSURE</span>};</li><li><span class="hljs-variable">Hid_AbsAxesArray</span> <span class="hljs-variable">absAxesArray</span> = {.<span class="hljs-variable">hidAbsAxes</span> = <span class="hljs-variable">absAxes</span>.<span class="hljs-title function_">data</span>(), .<span class="hljs-variable">length</span> = (<span class="hljs-variable">uint16_t</span>)<span class="hljs-variable">absAxes</span>.<span class="hljs-title function_">size</span>()};</li><li><span class="hljs-variable">Hid_EventProperties</span> <span class="hljs-variable">hidEventProp</span> = {</li><li>    .<span class="hljs-variable">hidEventTypes</span> = <span class="hljs-variable">eventTypeArray</span>,</li><li>    .<span class="hljs-variable">hidKeys</span> = <span class="hljs-variable">keyCodeArray</span>,</li><li>    .<span class="hljs-variable">hidAbs</span> = <span class="hljs-variable">absAxesArray</span>,</li><li>    .<span class="hljs-variable">hidMiscellaneous</span> = <span class="hljs-variable">mscEventArray</span></li><li>    };</li><li>    <span class="hljs-comment">// 创建设备并获取到deviceId</span></li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">deviceId</span> = <span class="hljs-title function_">OH_Hid_CreateDevice</span>(&amp;<span class="hljs-title class_">hidDevice</span>, &amp;<span class="hljs-title class_">hidEventProp</span>);</li></ol></pre></div></div></li>      <li>       <p>向指定deviceId的HID设备发送事件。</p>       <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_EmitEvent</strong> 向指定的deviceId的设备发送事件。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建需要发送事件</span></li><li>Hid_EmitItem event = {.type = HID_EV_MSC, .code = HID_MSC_SCAN, .value = <span class="hljs-number">0x000d0042</span>};</li><li>std::vector&lt;Hid_EmitItem&gt; itemVec;</li><li>itemVec.<span class="hljs-built_in">push_back</span>(event);</li><li><span class="hljs-comment">// 向指定deviceId的HID设备发送事件</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_EmitEvent</span>(deviceId, itemVec.<span class="hljs-built_in">data</span>(), (<span class="hljs-type">uint16_t</span>)itemVec.<span class="hljs-built_in">size</span>());</li></ol></pre></div></div></li>      <li>       <p>释放资源。</p>       <p>在所有请求处理完毕，程序退出前，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_DestroyDevice</strong> 接口销毁HID设备。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 销毁HID设备</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_DestroyDevice</span>(deviceId);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="hid报文通信驱动能力开发">HID报文通信驱动能力开发<i class="anchor-icon anchor-icon-link" anchorid="hid报文通信驱动能力开发" tips="复制节点链接"></i></h3>          <p>以下步骤描述了如何使用 <strong>HID DDK</strong> 开发HID报文通信驱动：</p>     <p><strong>添加动态链接库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libhid.z.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hid/hid_ddk_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hid/hid_ddk_types.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>初始化DDK。</p>       <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Init</strong> 初始化HID DDK。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化HID DDK</span></li><li><span class="hljs-built_in">OH_Hid_Init</span>();</li></ol></pre></div></div></li>      <li>       <p>打开设备。</p>       <p>初始化HID DDK后，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Open</strong> 打开HID设备。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint64_t</span> deviceId = <span class="hljs-number">0x100000003</span>;</li><li><span class="hljs-type">uint8_t</span> interfaceIndex1 = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">uint8_t</span> interfaceIndex2 = <span class="hljs-number">1</span>;</li><li>Hid_DeviceHandle *dev = <span class="hljs-literal">NULL</span>;</li><li>Hid_DeviceHandle *devFeature = <span class="hljs-literal">NULL</span>;</li><li><span class="hljs-comment">// 打开deviceId和interfaceIndex1指定的HID设备（一般为/dev/hidraw0设备文件）</span></li><li><span class="hljs-built_in">OH_Hid_Open</span>(deviceId, interfaceIndex1, &amp;dev);</li><li><span class="hljs-comment">// 打开deviceId和interfaceIndex2指定的HID设备（一般为/dev/hidraw1设备文件）</span></li><li><span class="hljs-built_in">OH_Hid_Open</span>(deviceId, interfaceIndex2, &amp;devFeature);</li></ol></pre></div></div></li>      <li>       <p>向HID设备写入/发送报告（HID设备与主机之间交换的数据包）（可选）。</p>       <ul>        <li>         <p>当报告类型为HID_OUTPUT_REPORT（输出报告）时，支持如下两种写入/发送方式。</p>         <ul>          <li>           <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Write</strong> 向HID设备写入一个输出报告。</p>           <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data[] = {<span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>};</li><li><span class="hljs-type">uint32_t</span> bytesWritten = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 写入报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_Write</span>(dev, data, <span class="hljs-built_in">sizeof</span>(data), &amp;bytesWritten);</li></ol></pre></div></div></li>          <li>           <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_SendReport</strong> 向HID设备发送一个输出报告。</p>           <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data1[<span class="hljs-number">2</span>] = {<span class="hljs-number">0x00</span>};</li><li><span class="hljs-comment">// 指定报告编号</span></li><li>data1[<span class="hljs-number">0</span>] = <span class="hljs-number">0x02</span>;</li><li><span class="hljs-comment">// 设置报告数据</span></li><li>data1[<span class="hljs-number">1</span>] = <span class="hljs-number">0x02</span>;</li><li>
</li><li><span class="hljs-comment">// 发送输出报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_SendReport</span>(dev, HID_OUTPUT_REPORT, data1, <span class="hljs-built_in">sizeof</span>(data1));</li></ol></pre></div></div></li>         </ul></li>        <li>         <p>当报告类型为HID_FEATURE_REPORT（特性报告）时，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_SendReport</strong> 向HID设备发送一个特性报告。</p>         <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data2[<span class="hljs-number">2</span>] = {<span class="hljs-number">0x00</span>};</li><li><span class="hljs-comment">// 指定报告编号</span></li><li>data2[<span class="hljs-number">0</span>] = <span class="hljs-number">0x02</span>;</li><li><span class="hljs-comment">// 设置报告数据</span></li><li>data2[<span class="hljs-number">1</span>] = <span class="hljs-number">0x02</span>;</li><li>
</li><li><span class="hljs-comment">// 发送特性报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_SendReport</span>(devFeature, HID_FEATURE_REPORT, data2, <span class="hljs-built_in">sizeof</span>(data2));</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>从HID设备读取报告（可选）。</p>       <ul>        <li>         <p>当报告类型为HID_INPUT_REPORT（输入报告）时，支持如下三种读取方式。</p>         <ul>          <li>           <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Read</strong> 或者 <strong>OH_Hid_ReadTimeout</strong> 以阻塞模式从HID设备读取一个输入报告。</p>           <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data3[<span class="hljs-number">9</span>] = {<span class="hljs-number">0x00</span>};</li><li><span class="hljs-type">uint32_t</span> bytesRead = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 从HID设备读取报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_Read</span>(dev, data3, <span class="hljs-built_in">sizeof</span>(data3), &amp;bytesRead);</li><li>
</li><li><span class="hljs-type">uint8_t</span> data4[<span class="hljs-number">9</span>] = {<span class="hljs-number">0x00</span>};</li><li><span class="hljs-comment">// 在指定的超时时间内从HID设备读取报告</span></li><li>ret = <span class="hljs-built_in">OH_Hid_ReadTimeout</span>(dev, data4, <span class="hljs-built_in">sizeof</span>(data4), <span class="hljs-number">10000</span>, &amp;bytesRead);</li></ol></pre></div></div></li>          <li>           <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_SetNonBlocking</strong> 和 <strong>OH_Hid_Read</strong> 以非阻塞模式从HID设备读取一个输入报告。</p>           <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 1启用非阻塞，0禁用非阻塞</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_SetNonBlocking</span>(dev, <span class="hljs-number">1</span>);</li><li>
</li><li><span class="hljs-comment">// 本示例执行时，设备可能没有数据，因此需要等待用户输入</span></li><li><span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 需引入头文件 #include &lt;unistd.h&gt;</span></li><li><span class="hljs-type">uint8_t</span> data5[<span class="hljs-number">9</span>] = {<span class="hljs-number">0</span>};</li><li><span class="hljs-type">uint32_t</span> bytesRead = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 从HID设备读取报告</span></li><li>ret = <span class="hljs-built_in">OH_Hid_Read</span>(dev, data5, <span class="hljs-built_in">sizeof</span>(data5), &amp;bytesRead);</li></ol></pre></div></div></li>          <li>           <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_GetReport</strong> 从HID设备读取一个输入报告。</p>           <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data6[<span class="hljs-number">9</span>] = {<span class="hljs-number">0</span>};</li><li><span class="hljs-comment">// 指定报告编号</span></li><li>data6[<span class="hljs-number">0</span>] = <span class="hljs-number">0x00</span>;</li><li>
</li><li><span class="hljs-comment">// 读取输入报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_GetReport</span>(dev, HID_INPUT_REPORT, data6, <span class="hljs-built_in">sizeof</span>(data6));</li></ol></pre></div></div></li>         </ul></li>        <li>         <p>当报告类型为HID_FEATURE_REPORT（特性报告）时，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_GetReport</strong> 从HID设备读取一个特性报告。</p>         <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> data7[<span class="hljs-number">8</span>] = {<span class="hljs-number">0</span>};</li><li><span class="hljs-comment">// 指定报告编号</span></li><li>data7[<span class="hljs-number">0</span>] = <span class="hljs-number">0x07</span>;</li><li>
</li><li><span class="hljs-comment">// 读取特性报告</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_GetReport</span>(devFeature, HID_FEATURE_REPORT, data7, <span class="hljs-built_in">sizeof</span>(data7));</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>获取设备原始信息、原始名称、物理地址、原始唯一标识符（可选）。</p>       <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_GetRawInfo</strong> 获取HID设备原始信息，使用 <strong>OH_Hid_GetRawName</strong> 获取HID设备原始名称，使用 <strong>OH_Hid_GetPhysicalAddress</strong> 获取HID设备物理地址，使用 <strong>OH_Hid_GetRawUniqueId</strong> 获取HID设备原始唯一标识符。这些信息可被上层应用引用，例如在界面中展示设备信息等。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> Hid_RawDevInfo rawDevInfo;</li><li>int32_t ret = OH_Hid_GetRawInfo(dev, &amp;rawDevInfo);</li><li>
</li><li><span class="hljs-built_in">char</span> rawName[<span class="hljs-number">1024</span>] = {<span class="hljs-number">0</span>};</li><li>ret = OH_Hid_GetRawName(dev, rawName, <span class="hljs-keyword">sizeof</span>(rawName));</li><li>
</li><li><span class="hljs-built_in">char</span> physicalAddress[<span class="hljs-number">1024</span>] = {<span class="hljs-number">0</span>};</li><li>ret = OH_Hid_GetPhysicalAddress(dev, physicalAddress, <span class="hljs-keyword">sizeof</span>(physicalAddress));</li><li>
</li><li>uint8_t uniqueIdData[<span class="hljs-number">64</span>] = {<span class="hljs-number">0</span>};</li><li>ret = OH_Hid_GetRawUniqueId(dev, uniqueIdData, <span class="hljs-keyword">sizeof</span>(uniqueIdData));</li></ol></pre></div></div></li>      <li>       <p>获取报告描述符（可选）。</p>       <p>使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_GetReportDescriptor</strong> 获取HID设备报告描述符。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint8_t</span> desData[<span class="hljs-number">1024</span>] = {<span class="hljs-number">0</span>};</li><li><span class="hljs-type">uint32_t</span> bytesRead = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Hid_GetReportDescriptor</span>(dev, desData, <span class="hljs-built_in">sizeof</span>(desData), &amp;bytesRead);</li></ol></pre></div></div></li>      <li>       <p>关闭设备。</p>       <p>在所有请求处理完毕后，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Close</strong> 关闭设备。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 关闭设备</span></li><li><span class="hljs-built_in">OH_Hid_Close</span>(&amp;dev);</li><li><span class="hljs-built_in">OH_Hid_Close</span>(&amp;devFeature);</li></ol></pre></div></div></li>      <li>       <p>释放DDK。</p>       <p>在关闭HID设备后，使用 <strong>hid_ddk_api.h</strong> 的 <strong>OH_Hid_Release</strong> 释放HID DDK。</p>       <div _ngcontent-yiy-c106="" class="highlight-div"><div _ngcontent-yiy-c106="" class="highlight-div-header"><div _ngcontent-yiy-c106="" class="highlight-div-header-left"><div _ngcontent-yiy-c106="" class="handle-button expand-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yiy-c106="" class="highlight-div-header-right"><div _ngcontent-yiy-c106="" class="handle-button ai-button"></div><div _ngcontent-yiy-c106="" class="handle-button line-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yiy-c106="" class="handle-button theme-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yiy-c106="" class="handle-button copy-button"><div _ngcontent-yiy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yiy-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放HID DDK</span></li><li><span class="hljs-built_in">OH_Hid_Release</span>();</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>