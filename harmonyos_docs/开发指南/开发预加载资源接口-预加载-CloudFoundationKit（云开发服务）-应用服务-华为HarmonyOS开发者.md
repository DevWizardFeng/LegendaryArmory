<h1 _ngcontent-cjy-c119="" class="doc-title ng-star-inserted" title="开发预加载资源接口"> 开发预加载资源接口 </h1>

<div _ngcontent-cjy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>使用预加载服务之前，开发者需要完成云侧接口的开发，以提供预加载所需的资源数据。华为提供两种方式供开发者选择：云函数和开发者服务器，开发者可根据实际业务需要进行选择。</p> <div class="tiledSection"><h2 id="section9541171320564">云函数<i class="anchor-icon anchor-icon-link" anchorid="section9541171320564" tips="复制节点链接"></i></h2><p>开发者需要先按照云函数接口规范开发函数，然后在AGC云端创建函数，并可测试函数运行是否正常。流程如下：</p> </div> <p><span><img height="239.8522" originheight="578" originwidth="1923" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114606.86458661066868324964152860255437:50001231000000:2800:FA21C7095294AB9CB878EFF4383E7B39681779A4C99B906B5935F8F1F0F2694A.png" title="点击放大" width="798"></span></p> <ol><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-develop-function">开发函数</a>：按照云函数接口规范开发函数。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-create-and-config-function">创建函数</a>：函数业务代码开发完成后，即可在AGC云端创建函数。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-test-function">测试函数</a>：对函数进行测试，以确保函数代码运行正常。</li></ol> <div class="tiledSection"><h3 id="section2052219319614" class="firsth2">云函数接口规范<i class="anchor-icon anchor-icon-link" anchorid="section2052219319614" tips="复制节点链接"></i></h3> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.1" valign="top"><p>API名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.2" valign="top"><p>说明</p> </th> <th align="left" class="cellrowborder" colspan="2" id="mcps1.3.5.2.1.6.1.3" valign="top"><p>参数</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.4" valign="top"><p>返回值</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top"><p>自定义</p> </td> <td class="cellrowborder" valign="top"><p>获取预加载数据接口</p> </td> <td class="cellrowborder" colspan="2" valign="top"><ul><li>安装预加载：<p>event.body.appId：应用ID，获取方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-view-app-info-0000002282674569" target="_blank">查看应用信息</a>。</p> </li><li>周期性预加载<ul><li>event.body.appId：应用ID。</li><li>event.body.token：可选，注册周期性预加载任务时开发者自行传入的用户级认证信息，长度不超过2048个字符。</li><li>event.body.params：可选，注册周期性预加载任务时开发者自行传入的自定义参数，长度不超过1024个字符。</li></ul> </li></ul> </td> <td class="cellrowborder" valign="top"><p>自定义JSON字符串</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section63313919126">示例<i class="anchor-icon anchor-icon-link" anchorid="section63313919126" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/agc-harmonyos-clouddev-devprocess" target="_blank">端云一体化工程</a>预加载云函数示例如下。其中，axios依赖库为网络请求库，需要在“cloudfunctions/云函数名称/package.json”的“dependencies”中添加axios的1.7.7或以上版本依赖。</p> <ul><li>安装预加载<div _ngcontent-cjy-c106="" class="highlight-div"><div _ngcontent-cjy-c106="" class="highlight-div-header"><div _ngcontent-cjy-c106="" class="highlight-div-header-left"><div _ngcontent-cjy-c106="" class="handle-button expand-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjy-c106="" class="highlight-div-header-right"><div _ngcontent-cjy-c106="" class="handle-button ai-button"></div><div _ngcontent-cjy-c106="" class="handle-button line-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjy-c106="" class="handle-button theme-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjy-c106="" class="handle-button copy-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjy-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> myHandler = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">event, context, callback, logger</span>) {</li><li>  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"event:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event));</li><li>  <span class="hljs-keyword">let</span> env1 = context.<span class="hljs-property">env</span>.<span class="hljs-property">env1</span>; <span class="hljs-comment">// 环境变量</span></li><li>  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"env1: "</span> + env1)</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> body = event.<span class="hljs-property">body</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">body</span>) : event;</li><li>    <span class="hljs-keyword">let</span> appId = body.<span class="hljs-property">appId</span>;</li><li>
</li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"appId: "</span> + appId);</li><li>
</li><li>    <span class="hljs-comment">// http请求示例，请按照实际业务修改</span></li><li>    <span class="hljs-keyword">let</span> url = <span class="hljs-string">'https://example.com/prefetchApi'</span>;  <span class="hljs-comment">// 页面资源数据的请求url</span></li><li>    <span class="hljs-keyword">let</span> headers = { <span class="hljs-string">'k1'</span>: <span class="hljs-string">'v1'</span> };  <span class="hljs-comment">// 请求header</span></li><li>    <span class="hljs-keyword">let</span> res;  <span class="hljs-comment">// 返回数据</span></li><li>    <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(url, {}, { headers })  <span class="hljs-comment">// http post请求</span></li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {</li><li>        res = response.<span class="hljs-property">data</span>;</li><li>      })</li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"--------Finished-------"</span>);</li><li>    <span class="hljs-title function_">callback</span>(res);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"--------Error-------"</span>);</li><li>    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error: "</span> + error);</li><li>    <span class="hljs-title function_">callback</span>(error);</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-keyword">export</span> { myHandler };</li></ol></pre></div></div> </li><li>周期性预加载<div _ngcontent-cjy-c106="" class="highlight-div"><div _ngcontent-cjy-c106="" class="highlight-div-header"><div _ngcontent-cjy-c106="" class="highlight-div-header-left"><div _ngcontent-cjy-c106="" class="handle-button expand-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjy-c106="" class="highlight-div-header-right"><div _ngcontent-cjy-c106="" class="handle-button ai-button"></div><div _ngcontent-cjy-c106="" class="handle-button line-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjy-c106="" class="handle-button theme-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjy-c106="" class="handle-button copy-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjy-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> myHandler = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">event, context, callback, logger</span>) {</li><li>  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"event:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event));</li><li>  <span class="hljs-keyword">let</span> env1 = context.<span class="hljs-property">env</span>.<span class="hljs-property">env1</span>; <span class="hljs-comment">// 环境变量</span></li><li>  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"env1: "</span> + env1)</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> body = event.<span class="hljs-property">body</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">body</span>) : event;</li><li>    <span class="hljs-keyword">let</span> appId = body.<span class="hljs-property">appId</span>;</li><li>    <span class="hljs-keyword">let</span> token = body.<span class="hljs-property">token</span>;</li><li>    <span class="hljs-keyword">let</span> paramsStr = body.<span class="hljs-property">params</span>; <span class="hljs-comment">// 如果需要解析json结构paramsStr中的参数，需要使用 let params = JSON.parse(paramsStr);</span></li><li>
</li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"appId: "</span> + appId + <span class="hljs-string">",token:"</span> + token + <span class="hljs-string">",params:"</span> + paramsStr);</li><li>
</li><li>    <span class="hljs-comment">// http请求示例，请按照实际业务修改</span></li><li>    <span class="hljs-keyword">let</span> url = <span class="hljs-string">'https://example.com/prefetchApi'</span>;  <span class="hljs-comment">// 页面资源数据的请求url</span></li><li>    <span class="hljs-keyword">let</span> headers = { <span class="hljs-string">'k1'</span>: <span class="hljs-string">'v1'</span> };  <span class="hljs-comment">// 请求header</span></li><li>    <span class="hljs-keyword">let</span> res;  <span class="hljs-comment">// 返回数据</span></li><li>    <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(url, {}, { headers })  <span class="hljs-comment">// http post请求</span></li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {</li><li>        res = response.<span class="hljs-property">data</span>;</li><li>      })</li><li>    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"--------Finished-------"</span>);</li><li>    <span class="hljs-title function_">callback</span>(res);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"--------Error-------"</span>);</li><li>    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error: "</span> + error);</li><li>    <span class="hljs-title function_">callback</span>(error);</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-keyword">export</span> { myHandler };</li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section238883895811">开发者服务器<i class="anchor-icon anchor-icon-link" anchorid="section238883895811" tips="复制节点链接"></i></h2><p>申请开通开发者服务器权限之后，开发者使用自己的服务器自行开发和实现预加载资源接口，接口需遵循开发者服务器接口规范。</p> </div> <div class="tiledSection"><h3 id="section83701164150" class="firsth2">开发者服务器接口规范<i class="anchor-icon anchor-icon-link" anchorid="section83701164150" tips="复制节点链接"></i></h3> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.2.1.7.1.1" valign="top"><p>API/PATH名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.7.1.2" valign="top"><p>说明</p> </th> <th align="left" class="cellrowborder" colspan="2" id="mcps1.3.8.2.1.7.1.3" valign="top"><p>参数</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.7.1.4" valign="top"><p>请求方式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.7.1.5" valign="top"><p>返回值</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top"><p>自定义</p> </td> <td class="cellrowborder" valign="top"><p>获取预加载数据接口</p> </td> <td class="cellrowborder" colspan="2" valign="top"><ul><li>安装预加载<p>appId：应用ID，获取方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-view-app-info-0000002282674569" target="_blank">查看应用信息</a>。</p> </li><li>周期性预加载<ul><li>appId：应用ID。</li><li>token：可选，注册周期性预加载任务时开发者自行传入的用户级认证信息，长度不超过2048个字符。</li><li>params：可选，注册周期性预加载任务时开发者自行传入的自定义参数，长度不超过1024个字符。</li></ul> </li></ul> </td> <td class="cellrowborder" valign="top"><p>GET</p> </td> <td class="cellrowborder" valign="top"><p>自定义JSON字符串</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1996911325152">示例<i class="anchor-icon anchor-icon-link" anchorid="section1996911325152" tips="复制节点链接"></i></h3><p>定义名称为prefetchData的接口，示例如下：</p> <div _ngcontent-cjy-c106="" class="highlight-div"><div _ngcontent-cjy-c106="" class="highlight-div-header"><div _ngcontent-cjy-c106="" class="highlight-div-header-left"><div _ngcontent-cjy-c106="" class="handle-button expand-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjy-c106="" class="highlight-div-header-right"><div _ngcontent-cjy-c106="" class="handle-button ai-button"></div><div _ngcontent-cjy-c106="" class="handle-button line-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjy-c106="" class="handle-button theme-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjy-c106="" class="handle-button copy-button"><div _ngcontent-cjy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>https://www.example.com/prefetchData?appId=1234&amp;token=xxxx&amp;params=yyyy</li></ol></pre></div></div> </div> </div> <div></div></div>