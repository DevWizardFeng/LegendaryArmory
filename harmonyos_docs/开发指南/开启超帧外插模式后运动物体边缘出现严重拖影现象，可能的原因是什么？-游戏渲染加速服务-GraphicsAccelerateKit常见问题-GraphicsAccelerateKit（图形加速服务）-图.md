<h1 _ngcontent-hbs-c119="" class="doc-title ng-star-inserted" title="开启超帧外插模式后运动物体边缘出现严重拖影现象，可能的原因是什么？"> 开启超帧外插模式后运动物体边缘出现严重拖影现象，可能的原因是什么？ </h1>

<div _ngcontent-hbs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>由于外插模式需要标记模板缓冲（Stencil Buffer）的第8位用于区分静态物体和动态物体，即静态物体模板值第8位标记成0，动态物体模板值第8位标记成1，模板缓冲的低7位模板值开发者可自行设置。如果标记错误或漏标记，可能会在动态物体边缘产生严重的拖影现象。</p> <p><strong>现象描述</strong></p> <p>Demo中运动角色出现头身分离等严重拖影现象。</p> <p class="msonormal"><span><img height="336.49" originheight="363" originwidth="750" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114406.91735473838027715905009513220406:50001231000000:2800:4B91990477A67602D16BBDFEDC37BB2241273BA3A49C86FEC57930D4F9E1A955.png" title="点击放大" width="694.26"></span></p> <p><strong>原因分析</strong></p> <p>通过抓帧查看模板缓冲中的模板值，发现头发区域模板值为0，身体区域模板值为0x80。由于角色头、身均属于运动目标区域，应该将所有运动物体区域的模板值第8位标记为1。错误的头部区域模板值导致超帧效果出现头身分离的严重拖影现象。</p> <p class="msonormal"><span><img height="307.23" originheight="326" originwidth="735" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114406.36431255581120640551568369279933:50001231000000:2800:184B26A2FAB3B5CD62E811921F48545028A7EB0753F285B2E42D6775279056CC.png" title="点击放大" width="694.26"></span></p> <p><strong>处理步骤</strong></p> <p>基于分析结论，造成头身分离拖影现象的主要原因是运动区域模板值未统一标记为1xxx xxxx。因此将运动角色头发和面部区域的模板值统一改为0x80，保持和身体模板值一致，头身分离的拖影现象消失，效果如下图所示。</p> <p class="msonormal"><span><img height="323.19" originheight="347" originwidth="750" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114406.60395484650984417350511196475798:50001231000000:2800:8008354EB43F84F2E9EF44E37C0EF887FB1F1ED1518E4ABF1173FFFB664B80BC.png" title="点击放大" width="696.9200000000001"></span></p> <p><strong>代码示例</strong></p> <p>检查动态物体材质Shader中的模板值是否设置正确，即静态物体模板值标记为0xxx xxxx，动态物体模板值标记为1xxx xxxx。</p> <div _ngcontent-hbs-c106="" class="highlight-div"><div _ngcontent-hbs-c106="" class="highlight-div-header"><div _ngcontent-hbs-c106="" class="highlight-div-header-left"><div _ngcontent-hbs-c106="" class="handle-button expand-button"><div _ngcontent-hbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hbs-c106="" class="highlight-div-header-right"><div _ngcontent-hbs-c106="" class="handle-button ai-button"></div><div _ngcontent-hbs-c106="" class="handle-button line-button"><div _ngcontent-hbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hbs-c106="" class="handle-button theme-button"><div _ngcontent-hbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hbs-c106="" class="handle-button copy-button"><div _ngcontent-hbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hbs-c106="" class="highlight-scroll-div"><pre class="cs prettyprint linenums hljs language-csharp" hw-language="cs" data-highlighted="yes"><ol class="linenums"><li>Shader <span class=""><span class="hljs-string">"Standard_with_stencil"</span></span></li><li>{</li><li>    Properties</li><li>    {</li><li>        <span class=""><span class="hljs-comment">/* ... */</span></span></li><li>        _LightingStencilRef(<span class=""><span class="hljs-string">"Lighting Stencil Reference"</span></span>, Float) = <span class=""><span class="hljs-number">128</span></span> <span class=""><span class="hljs-comment">// 将动态物体材质模板值改为1xxx xxxx，消除头身分离现象</span></span></li><li>        [<span class="hljs-meta">Enum(UnityEngine.Rendering.CompareFunction)</span>] _LightingStencilComp(<span class=""><span class="hljs-string">"Lighting Stencil Comparison"</span></span>, Float) = <span class=""><span class="hljs-number">8</span></span></li><li>        _StencilReadMask(<span class=""><span class="hljs-string">"Stencil Read Mask"</span></span>, Float) = <span class=""><span class="hljs-number">255</span></span>   </li><li>        _StencilWriteMask(<span class=""><span class="hljs-string">"Stencil Write Mask"</span></span>, Float) = <span class=""><span class="hljs-number">255</span></span></li><li>    }</li><li>    SubShader</li><li>    {</li><li>        <span class=""><span class="hljs-comment">/* ... */</span></span></li><li>        Pass</li><li>        {</li><li>            <span class=""><span class="hljs-comment">/* ... */</span></span></li><li>            Stencil</li><li>            {</li><li>                Ref[_LightingStencilRef]</li><li>                Comp[_LightingStencilComp] </li><li>                ReadMask[_StencilReadMask]</li><li>                WriteMask[_StencilWriteMask]</li><li>                Pass Replace</li><li>            }</li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>不同管线的Shader中需要配置模板值的Pass不同，如下：</p> <ul><li>团结引擎URP管线<p>在每个有DepthOnly或DepthNormals的Pass中，即出现Tags {"LightMode" = "DepthOnly" }或Tags {"LightMode" = "DepthNormals" }的Pass，配置模板值。</p> </li></ul> <ul><li>团结引擎Build-in管线<p>在每个有ForwardBase或ForwardAdd的Pass中，即出现Tags {"LightMode" = "ForwardBase" }或Tags {"LightMode" = "ForwardAdd" }的Pass，配置模板值。</p> </li></ul> </div></div></div> </div> <div></div></div>