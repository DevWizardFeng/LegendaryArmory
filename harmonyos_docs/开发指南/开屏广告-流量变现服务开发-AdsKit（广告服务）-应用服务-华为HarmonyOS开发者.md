<h1 _ngcontent-mng-c119="" class="doc-title ng-star-inserted" title="开屏广告"> 开屏广告 </h1>

<div _ngcontent-mng-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section498473910110">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section498473910110" tips="复制节点链接"></i></h2><p>开屏广告是一种在应用启动时且在应用主界面显示之前需要被展示的广告。您需要预先为App设计一张开屏默认的Slogan图片，确保在未获得到开屏广告之前展示默认的Slogan，提供良好的用户体验。</p> <p>开屏广告分为全屏开屏广告、半屏开屏广告，其中全屏开屏广告展示形式为广告铺满整个页面；半屏开屏广告展示形式会根据媒体页面自定义布局渲染广告、icon和版权信息，一般情况下建议将icon和版权信息展示在广告下方。</p> <p><span><img originheight="661" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114631.52825881098503877056254947455927:50001231000000:2800:E2D0A66E15E66139B949E6E6C61E1423F44E0C31124FB2DFF22B6E4848B6448A.png" width="320" height="661"></span> </p> <p></p> </div> <div class="tiledSection"><h2 id="section53851483543">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section53851483543" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#loadad" target="_blank">loadAd</a>(adParam: AdRequestParams, adOptions: AdOptions, listener: AdLoadListener): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>请求单广告位广告，通过AdRequestParams、AdOptions进行广告请求参数设置，通过AdLoadListener监听广告请求回调。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-adcomponent" target="_blank">AdComponent</a>({ads: advertising.Advertisement[], displayOptions: advertising.AdDisplayOptions, interactionListener: advertising.AdInteractionListener, @BuilderParam adRenderer?: () =&gt; void, @Prop rollPlayState?: number})</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>展示广告，通过AdDisplayOptions进行广告展示参数设置，通过AdInteractionListener监听广告状态回调。</p> <p><strong>说明：</strong>为了保证广告能正确展示，该接口必须和请求广告接口配套使用。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section168851557181012">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section168851557181012" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section76516341458" class="firsth2">请求广告<i class="anchor-icon anchor-icon-link" anchorid="section76516341458" tips="复制节点链接"></i></h3></div> <ol><li><span>导入相关模块。</span><p></p><div _ngcontent-mng-c106="" class="highlight-div"><div _ngcontent-mng-c106="" class="highlight-div-header"><div _ngcontent-mng-c106="" class="highlight-div-header-left"><div _ngcontent-mng-c106="" class="handle-button expand-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mng-c106="" class="highlight-div-header-right"><div _ngcontent-mng-c106="" class="handle-button ai-button"></div><div _ngcontent-mng-c106="" class="handle-button line-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mng-c106="" class="handle-button theme-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mng-c106="" class="handle-button copy-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mng-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, common, <span class="hljs-title class_">PermissionRequestResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { advertising, identifier } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AdsKit'</span>;</li><li><span class="hljs-keyword">import</span> { router, <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>获取OAID。</span><p></p><p>若需提升广告推送精准度，可以在请求参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adrequestparams" target="_blank">AdRequestParams</a>中添加oaid属性。</p> <p>如何获取OAID参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/oaid-service" target="_blank">获取OAID信息</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用以下示例中提供的测试广告位时，必须先获取OAID信息。</p> </div></div></div> <p></p></li><li><span>请求单广告位广告。</span><p></p><p>需要创建一个AdLoader对象，通过AdLoader的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#loadad" target="_blank">loadAd</a>方法请求广告，最后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adloadlistener" target="_blank">AdLoadListener</a>来监听广告的加载状态。测试开屏广告时，需要使用专门的测试广告位来获取测试开屏广告，示例代码中提供了两种开屏广告类型对应的广告位：半屏开屏（图片）（testq6zq98hecj）和全屏开屏（视频）（testd7c5cewoj6），测试广告位ID仅作为调试使用，不可用于广告变现。</p> <p>请求广告关键参数如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.2.3.1.5.1.1" valign="top" width="17.18%"><p>请求广告参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.2.3.1.5.1.2" valign="top" width="10.93%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.2.3.1.5.1.3" valign="top" width="9.9%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.2.3.1.5.1.4" valign="top" width="61.99%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="17.18%"><p>adType</p> </td> <td class="cellrowborder" valign="top" width="10.93%"><p>number</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>请求广告类型，开屏广告类型为1。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.18%"><p>adId</p> </td> <td class="cellrowborder" valign="top" width="10.93%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>广告位ID。</p> <ul><li>如果仅调测广告，可使用测试广告位ID：testq6zq98hecj半屏开屏（图片）和testd7c5cewoj6全屏开屏（视频）。</li><li>如果要接入正式广告，则需要申请正式的广告位ID。可在应用发布前进入<a href="https://developer.huawei.com/consumer/cn/monetize" target="_blank">流量变现官网</a>，点击“开始变现”，登录<a href="https://developer.huawei.com/consumer/cn/service/ads/publisher/html/index.html?lang=zh" target="_blank">鲸鸿动能媒体服务平台</a>进行申请，具体操作详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/monetize/zhanshiweichuangjian-0000001132700049" target="_blank">展示位创建</a>。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.18%"><p>adCount</p> </td> <td class="cellrowborder" valign="top" width="10.93%"><p>number</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>广告数量。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.18%"><p>orientation</p> </td> <td class="cellrowborder" valign="top" width="10.93%"><p>number</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>媒体请求广告的屏幕方向。1表示竖屏，0表示横屏，不设置则默认为1。当前未上架横屏开屏素材，若设置请求屏幕方向为横屏则不展示开屏广告。如果媒体设置应用固定横屏展示，但该参数未设置或者设置为1，则展示效果会受影响。</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.2.4.1.4.1.1" valign="top" width="15.770000000000001%"><p>返回广告参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.2.4.1.4.1.2" valign="top" width="15.43%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.2.4.1.4.1.3" valign="top" width="68.8%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15.770000000000001%"><p>isFullScreen</p> </td> <td class="cellrowborder" valign="top" width="15.43%"><p>boolean</p> </td> <td class="cellrowborder" valign="top" width="68.8%"><p>标识返回的广告是否为全屏，true为全屏广告，false为半屏广告。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>1、如果超时没有请求到广告，应用自行跳转到默认首页。</p> <p>2、为保证开屏展示效果，建议开发者在请求广告前，设置屏幕方向为竖屏。</p> </div></div></div> <div _ngcontent-mng-c106="" class="highlight-div"><div _ngcontent-mng-c106="" class="highlight-div-header"><div _ngcontent-mng-c106="" class="highlight-div-header-left"><div _ngcontent-mng-c106="" class="handle-button expand-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mng-c106="" class="highlight-div-header-right"><div _ngcontent-mng-c106="" class="handle-button ai-button"></div><div _ngcontent-mng-c106="" class="handle-button line-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mng-c106="" class="handle-button theme-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mng-c106="" class="handle-button copy-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mng-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ad</span>: advertising.<span class="hljs-property">Advertisement</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-comment">// 是否超时</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isTimeOut</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// 超时时间(单位毫秒)，开发者可根据实际情况修改</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timeOutDuration</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1000</span>;</li><li>  <span class="hljs-comment">// 超时index</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timeOutIndex</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 开启全屏模式沉浸页面</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">true</span>);</li><li>    <span class="hljs-comment">// 设置屏幕方向为竖屏</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">PORTRAIT</span>);</li><li>    <span class="hljs-comment">// 调用loadAd加载广告</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 关闭全屏模式，开发者可根据实际情况修改</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">false</span>);</li><li>    <span class="hljs-comment">// 设置屏幕方向为默认值，开发者可根据实际情况修改</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">UNSPECIFIED</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-attr">isLayoutFullScreen</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">win</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>      <span class="hljs-keyword">await</span> win.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(isLayoutFullScreen);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to set window layout. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-attr">orientation</span>: <span class="hljs-title class_">Orientation</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">win</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>      <span class="hljs-keyword">await</span> win.<span class="hljs-title function_">setPreferredOrientation</span>(orientation);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to set preferred orientation. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadAd</span>(<span class="hljs-attr">adId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-comment">// 广告请求参数</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adRequestParams</span>: advertising.<span class="hljs-property">AdRequestParams</span> = {</li><li>      <span class="hljs-comment">// 广告位ID</span></li><li>      <span class="hljs-attr">adId</span>: adId,</li><li>      <span class="hljs-comment">// 开屏广告类型</span></li><li>      <span class="hljs-attr">adType</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-comment">// 请求的广告数量</span></li><li>      <span class="hljs-attr">adCount</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-comment">// 开放匿名设备标识符</span></li><li>      <span class="hljs-attr">oaid</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestOAID</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>    };</li><li>    <span class="hljs-comment">// 广告请求回调监听</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adLoadListener</span>: advertising.<span class="hljs-property">AdLoadListener</span> = {</li><li>      <span class="hljs-attr">onAdLoadFailure</span>: <span class="hljs-function">(<span class="hljs-params">errorCode: <span class="hljs-built_in">number</span>, errorMsg: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to load ad. Code is <span class="hljs-subst">${errorCode}</span>, message is <span class="hljs-subst">${errorMsg}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-attr">onAdLoadSuccess</span>: <span class="hljs-function">(<span class="hljs-params">ads: <span class="hljs-built_in">Array</span>&lt;advertising.Advertisement&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timeOutIndex</span>);</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isTimeOut</span>) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in loading ad'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ad</span> = ads[<span class="hljs-number">0</span>];</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 广告配置参数，开发者可根据项目实际情况设置</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adOptions</span>: advertising.<span class="hljs-property">AdOptions</span> = {};</li><li>    <span class="hljs-comment">// 创建AdLoader广告对象</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adLoader</span>: advertising.<span class="hljs-property">AdLoader</span> = <span class="hljs-keyword">new</span> advertising.<span class="hljs-title class_">AdLoader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>    <span class="hljs-comment">// 启动超时定时器</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">timeOutHandler</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用广告请求接口</span></li><li>      adLoader.<span class="hljs-title function_">loadAd</span>(adRequestParams, adOptions, adLoadListener);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to load ad. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">timeOutHandler</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTimeOut</span> = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 超时处理</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeOutIndex</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTimeOut</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeToHome</span>();</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Load ad time out'</span>);</li><li>    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeOutDuration</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">routeToHome</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 开发者可根据项目实际情况修改超时之后要跳转的目标页面</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">replaceUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/Index'</span> }, router.<span class="hljs-property">RouterMode</span>.<span class="hljs-property">Single</span>)</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to route to home. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>      });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestOAID</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-comment">// 向用户请求授权广告跨应用关联访问权限</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">isPermissionGranted</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">PermissionRequestResult</span> =</li><li>      <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, [<span class="hljs-string">'ohos.permission.APP_TRACKING_CONSENT'</span>]);</li><li>    isPermissionGranted = result.<span class="hljs-property">authResults</span>[<span class="hljs-number">0</span>] === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to request permission. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (isPermissionGranted) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in requesting permission'</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> oaid = <span class="hljs-keyword">await</span> identifier.<span class="hljs-title function_">getOAID</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting OAID'</span>);</li><li>      <span class="hljs-keyword">return</span> oaid;</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get OAID. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to request permission. User rejected'</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div> <p></p></li></ol> <div class="tiledSection"><h3 id="section1233381115719">展示广告<i class="anchor-icon anchor-icon-link" anchorid="section1233381115719" tips="复制节点链接"></i></h3></div> <ol><li><span>导入相关模块。</span><p></p><div _ngcontent-mng-c106="" class="highlight-div"><div _ngcontent-mng-c106="" class="highlight-div-header"><div _ngcontent-mng-c106="" class="highlight-div-header-left"><div _ngcontent-mng-c106="" class="handle-button expand-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mng-c106="" class="highlight-div-header-right"><div _ngcontent-mng-c106="" class="handle-button ai-button"></div><div _ngcontent-mng-c106="" class="handle-button line-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mng-c106="" class="handle-button theme-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mng-c106="" class="handle-button copy-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mng-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AdComponent</span>, advertising } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AdsKit'</span>;</li><li><span class="hljs-keyword">import</span> { router } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>展示广告。</span><p></p><p>展示广告通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adinteractionlistener" target="_blank">AdInteractionListener</a>监听广告状态回调，涉及的回调状态如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.2.2.2.1.4.1.1" valign="top" width="17.1%"><p>回调状态</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.2.1.4.1.2" valign="top" width="17.130000000000003%"><p>说明</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.2.1.4.1.3" valign="top" width="65.77%"><p>使用建议</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="17.1%"><p>onAdOpen</p> </td> <td class="cellrowborder" valign="top" width="17.130000000000003%"><p>打开广告。</p> </td> <td class="cellrowborder" valign="top" width="65.77%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.1%"><p>onAdClick</p> </td> <td class="cellrowborder" valign="top" width="17.130000000000003%"><p>点击广告。</p> </td> <td class="cellrowborder" valign="top" width="65.77%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.1%"><p>onAdClose</p> </td> <td class="cellrowborder" valign="top" width="17.130000000000003%"><p>关闭广告。</p> </td> <td class="cellrowborder" valign="top" width="65.77%"><p>广告倒计时结束、用户点击跳过按钮或广告从后台返回时触发，需要跳转到应用首页。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.1%"><p>onAdFail</p> </td> <td class="cellrowborder" valign="top" width="17.130000000000003%"><p>广告加载失败。</p> </td> <td class="cellrowborder" valign="top" width="65.77%"><p>广告展示失败时触发，需要跳转到应用首页。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>1、请求到广告之前需要展示默认的Slogan图片。</p> <p>2、由请求广告中获取的isFullScreen参数判断展示全屏或者半屏广告。</p> <p>3、目前只支持展示竖屏广告。</p> </div></div></div> <div _ngcontent-mng-c106="" class="highlight-div"><div _ngcontent-mng-c106="" class="highlight-div-header"><div _ngcontent-mng-c106="" class="highlight-div-header-left"><div _ngcontent-mng-c106="" class="handle-button expand-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mng-c106="" class="highlight-div-header-right"><div _ngcontent-mng-c106="" class="handle-button ai-button"></div><div _ngcontent-mng-c106="" class="handle-button line-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mng-c106="" class="handle-button theme-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mng-c106="" class="handle-button copy-button"><div _ngcontent-mng-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mng-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ad</span>: advertising.<span class="hljs-property">Advertisement</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-comment">// 广告展示参数</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">adDisplayOptions</span>: advertising.<span class="hljs-property">AdDisplayOptions</span> = {</li><li>    <span class="hljs-comment">// 是否静音</span></li><li>    <span class="hljs-attr">mute</span>: <span class="hljs-literal">true</span></li><li>  };</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-comment">// 展示开发者自定义Slogan图片</span></li><li>      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.slogan'</span>))</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">0</span>)</li><li>      <span class="hljs-comment">// 展示开发者自定义icon、应用名称、版权信息</span></li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.video'</span>))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">8</span>)</li><li>          <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.video'</span>))</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#1A1A1A'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">8</span> })</li><li>
</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.copyright'</span>))</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#1A1A1A'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">9</span>)</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">alignRules</span>({ <span class="hljs-attr">bottom</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Bottom</span> } })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'13%'</span>)</li><li>
</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">ad</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">ad</span>.<span class="hljs-property">isFullScreen</span>) {</li><li>          <span class="hljs-comment">// 全屏开屏广告</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">splashFullScreen</span>()</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-comment">// 半屏开屏广告</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">splashHalfScreen</span>()</li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 半屏开屏广告</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">splashHalfScreen</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">AdComponent</span>({</li><li>      <span class="hljs-attr">ads</span>: [<span class="hljs-variable language_">this</span>.<span class="hljs-property">ad</span>!],</li><li>      <span class="hljs-attr">displayOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">adDisplayOptions</span>,</li><li>      <span class="hljs-attr">interactionListener</span>: {</li><li>        <span class="hljs-attr">onStatusChanged</span>: <span class="hljs-function">(<span class="hljs-params">status: <span class="hljs-built_in">string</span>, ad: advertising.Advertisement, data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">switch</span> (status) {</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdOpen'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdOpen'</span>);</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdClick'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdClick'</span>);</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdClose'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdClose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeToHome</span>();</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdFail'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdFail'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeToHome</span>();</li><li>              <span class="hljs-keyword">break</span>;</li><li>          }</li><li>        }</li><li>      }</li><li>    })</li><li>      .<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'87%'</span>)</li><li>      <span class="hljs-comment">// 自定义组件动画</span></li><li>      .<span class="hljs-title function_">transition</span>(<span class="hljs-title class_">TransitionEffect</span>.<span class="hljs-property">OPACITY</span>.<span class="hljs-title function_">animation</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">Friction</span>}))</li><li>      .<span class="hljs-title function_">alignRules</span>({ <span class="hljs-attr">top</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Top</span> } })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 全屏开屏广告</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">splashFullScreen</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">AdComponent</span>({</li><li>      <span class="hljs-attr">ads</span>: [<span class="hljs-variable language_">this</span>.<span class="hljs-property">ad</span>!],</li><li>      <span class="hljs-attr">displayOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">adDisplayOptions</span>,</li><li>      <span class="hljs-attr">interactionListener</span>: {</li><li>        <span class="hljs-attr">onStatusChanged</span>: <span class="hljs-function">(<span class="hljs-params">status: <span class="hljs-built_in">string</span>, ad: advertising.Advertisement, data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">switch</span> (status) {</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdOpen'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdOpen'</span>);</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdClick'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdClick'</span>);</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdClose'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdClose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeToHome</span>();</li><li>              <span class="hljs-keyword">break</span>;</li><li>            <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdFail'</span>:</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdFail'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeToHome</span>();</li><li>              <span class="hljs-keyword">break</span>;</li><li>          }</li><li>        }</li><li>      }</li><li>    })</li><li>      .<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">routeToHome</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 开发者可根据项目实际情况修改超时之后要跳转的目标页面</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">replaceUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/Index'</span> }, router.<span class="hljs-property">RouterMode</span>.<span class="hljs-property">Single</span>)</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to route to home. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>      });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li></ol></pre></div></div> <p></p></li></ol> </div> <div></div></div>