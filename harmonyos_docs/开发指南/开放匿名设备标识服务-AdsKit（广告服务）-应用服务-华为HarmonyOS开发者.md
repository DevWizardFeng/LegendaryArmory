<h1 _ngcontent-umh-c119="" class="doc-title ng-star-inserted" title="开放匿名设备标识服务"> 开放匿名设备标识服务 </h1>

<div _ngcontent-umh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="获取oaid信息">获取OAID信息<i class="anchor-icon anchor-icon-link" anchorid="获取oaid信息" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="场景介绍" class="firsth2">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h3><p>开放匿名设备标识符（Open Anonymous Device Identifier, OAID，以下简称OAID）：是一种非永久性设备标识符，基于开放匿名设备标识符，可在保护用户个人数据隐私安全的前提下，向用户提供个性化广告，同时三方监测平台也可以向广告主提供转化归因分析。</p> <p>媒体App、广告平台、三方监测平台等开发者，可获取设备上的OAID，您可基于OAID进行个性化广告推荐或广告转化归因分析。</p> <p>OAID是基于华为自有算法生成的32位类UUID（Universally Unique Identifier）标识符，格式为xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx。</p> <p>OAID的特性：</p> <ul><li>OAID是设备级标识符，同一台设备上不同的App获取到的OAID值一样。</li><li>OAID的获取受应用的“跨应用关联访问权限”开关影响：当应用的“跨应用关联访问权限”开关开启时，该应用可获取到非全0的有效OAID；当应用的“跨应用关联访问权限”开关关闭时，该应用仅能获取到全0的OAID。</li><li>同一台设备上首个应用开启应用“跨应用关联访问权限”开关时，会首次生成OAID。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>设置项“跨应用关联访问权限”在HarmonyOS NEXT Developer Beta5及更早版本名称为“应用跟踪访问权限”。</p> </div></div></div> </li></ul> <p>OAID会在下述场景中发生变化：</p> <ul><li>用户将设备恢复出厂设置。</li><li>用户操作重置OAID。</li></ul> </div> <div class="tiledSection"><h3 id="section13969498128">约束和限制<i class="anchor-icon anchor-icon-link" anchorid="section13969498128" tips="复制节点链接"></i></h3><p>开放匿名设备标识服务能力支持Phone、Tablet、PC/2in1设备，并且从6.0.0（20）版本开始，新增支持TV设备。</p> </div> <div class="tiledSection"><h3 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-oaid#identifiergetoaid" target="_blank">getOAID</a>(): Promise&lt;string&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取OAID，通过Promise异步返回结果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-oaid#identifiergetoaid-1" target="_blank">getOAID</a>(callback: AsyncCallback&lt;string&gt;):  void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取OAID，通过Callback异步回调返回值。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如调用getOAID接口需要申请ohos.permission.APP_TRACKING_CONSENT权限，且“要求应用请求关联”保持关闭状态。存在如下三种情况：</p> <p>1.如应用已配置ohos.permission.APP_TRACKING_CONSENT权限，且“跨应用关联访问权限”为“允许”，则返回OAID。</p> <p>2.如应用已配置ohos.permission.APP_TRACKING_CONSENT权限，且“跨应用关联访问权限”为“禁止”，则返回00000000-0000-0000-0000-000000000000。</p> <p>3.如应用未配置ohos.permission.APP_TRACKING_CONSENT权限，则返回00000000-0000-0000-0000-000000000000。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3><ol><li><p>在模块的module.json5文件中，申请跨应用关联权限<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/permissions-for-all-user#ohospermissionapp_tracking_consent" target="_blank">ohos.permission.APP_TRACKING_CONSENT</a>，该权限为user_grant权限，当申请的权限为user_grant权限时，reason，abilities标签必填，配置方式参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#在配置文件中声明权限" target="_blank">requestPermissions标签说明</a>，示例代码如下所示：</p> <div _ngcontent-umh-c106="" class="highlight-div"><div _ngcontent-umh-c106="" class="highlight-div-header"><div _ngcontent-umh-c106="" class="highlight-div-header-left"><div _ngcontent-umh-c106="" class="handle-button expand-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umh-c106="" class="highlight-div-header-right"><div _ngcontent-umh-c106="" class="handle-button ai-button"></div><div _ngcontent-umh-c106="" class="handle-button line-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umh-c106="" class="handle-button theme-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umh-c106="" class="handle-button copy-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-string">"requestPermissions"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.APP_TRACKING_CONSENT"</span>,</li><li>        <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:reason"</span>,</li><li>        <span class="hljs-string">"usedScene"</span>: {</li><li>          <span class="hljs-string">"abilities"</span>: [</li><li>            <span class="hljs-string">"EntryFormAbility"</span></li><li>          ],</li><li>          <span class="hljs-string">"when"</span>: <span class="hljs-string">"inuse"</span></li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li><p>应用在需要获取OAID信息时，应通过调用requestPermissionsFromUser接口获取对应权限。<strong>说明：</strong>其中context的获取方式参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#context的获取方式" target="_blank">各类Context的获取方式</a>。示例代码如下所示：</p> <p></p> <div _ngcontent-umh-c106="" class="highlight-div"><div _ngcontent-umh-c106="" class="highlight-div-header"><div _ngcontent-umh-c106="" class="highlight-div-header-left"><div _ngcontent-umh-c106="" class="handle-button expand-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umh-c106="" class="highlight-div-header-right"><div _ngcontent-umh-c106="" class="handle-button ai-button"></div><div _ngcontent-umh-c106="" class="handle-button line-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umh-c106="" class="handle-button theme-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umh-c106="" class="handle-button copy-button"><div _ngcontent-umh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umh-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">PermissionRequestResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { identifier } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AdsKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestOAID</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-comment">// 向用户请求授权广告跨应用关联访问权限</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">isPermissionGranted</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">PermissionRequestResult</span> =</li><li>      <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, [<span class="hljs-string">'ohos.permission.APP_TRACKING_CONSENT'</span>]);</li><li>    isPermissionGranted = result.<span class="hljs-property">authResults</span>[<span class="hljs-number">0</span>] === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to request permission. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (isPermissionGranted) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in requesting permission'</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> oaid = <span class="hljs-keyword">await</span> identifier.<span class="hljs-title function_">getOAID</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting OAID'</span>);</li><li>      <span class="hljs-keyword">return</span> oaid;</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get OAID. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to request permission. User rejected'</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>