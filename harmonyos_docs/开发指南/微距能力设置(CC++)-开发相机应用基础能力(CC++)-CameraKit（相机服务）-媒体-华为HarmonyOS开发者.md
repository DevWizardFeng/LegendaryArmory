<h1 _ngcontent-two-c119="" class="doc-title ng-star-inserted" title="微距能力设置(C/C++)"> 微距能力设置(C/C++) </h1>

<div _ngcontent-two-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 19开始，支持设置微距能力。微距能力是指通过光学设计与算法优化，实现近距离对焦并清晰捕捉微小物体细节的相机功能。</p>    <div class="tiledSection">     <h2 id="zh-cn_topic_0000002507328063_开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000002507328063_开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入NDK接口。选择系统提供的NDK接口能力，导入NDK接口的方法如下。</p>       <div _ngcontent-two-c106="" class="highlight-div"><div _ngcontent-two-c106="" class="highlight-div-header"><div _ngcontent-two-c106="" class="highlight-div-header-left"><div _ngcontent-two-c106="" class="handle-button expand-button"><div _ngcontent-two-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-two-c106="" class="highlight-div-header-right"><div _ngcontent-two-c106="" class="handle-button ai-button"></div><div _ngcontent-two-c106="" class="handle-button line-button"><div _ngcontent-two-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-two-c106="" class="handle-button theme-button"><div _ngcontent-two-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-two-c106="" class="handle-button copy-button"><div _ngcontent-two-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-two-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入NDK接口头文件。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_input.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/capture_session.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_manager.h"</span></span></li></ol></pre></div></div></li>      <li>       <p>在CMake脚本中链接相关动态库。</p>       <div _ngcontent-two-c106="" class="highlight-div"><div _ngcontent-two-c106="" class="highlight-div-header"><div _ngcontent-two-c106="" class="highlight-div-header-left"><div _ngcontent-two-c106="" class="handle-button expand-button"><div _ngcontent-two-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-two-c106="" class="highlight-div-header-right"><div _ngcontent-two-c106="" class="handle-button ai-button"></div><div _ngcontent-two-c106="" class="handle-button line-button"><div _ngcontent-two-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-two-c106="" class="handle-button theme-button"><div _ngcontent-two-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-two-c106="" class="handle-button copy-button"><div _ngcontent-two-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-two-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC</li><li>    libace_napi.z.so</li><li>    libohcamera.so</li><li>    libhilog_ndk.z.so</li><li>)</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-capture-session-h#oh_capturesession_ismacrosupported" target="_blank">OH_CaptureSession_IsMacroSupported()</a>方法，检测当前设备是否支持微距能力。</p>       <div _ngcontent-two-c106="" class="highlight-div"><div _ngcontent-two-c106="" class="highlight-div-header"><div _ngcontent-two-c106="" class="highlight-div-header-left"><div _ngcontent-two-c106="" class="handle-button expand-button"><div _ngcontent-two-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-two-c106="" class="highlight-div-header-right"><div _ngcontent-two-c106="" class="handle-button ai-button"></div><div _ngcontent-two-c106="" class="handle-button line-button"><div _ngcontent-two-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-two-c106="" class="handle-button theme-button"><div _ngcontent-two-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-two-c106="" class="handle-button copy-button"><div _ngcontent-two-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-two-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">IsMacroSupported</span><span class="hljs-params">(Camera_CaptureSession* captureSession)</span></span></li><li><span class="hljs-function"></span>{</li><li>     <span class="hljs-comment">// 判断设备是否支持微距能力。</span></li><li>     <span class="hljs-type">bool</span> isMacroSupported = <span class="hljs-literal">false</span>;</li><li>     <span class="hljs-keyword">if</span> (captureSession == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"captureSession is nullptr."</span>);</li><li>        <span class="hljs-keyword">return</span> isMacroSupported;</li><li>     }</li><li>     Camera_ErrorCode ret = <span class="hljs-built_in">OH_CaptureSession_IsMacroSupported</span>(captureSession, &amp;isMacroSupported);</li><li>     <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_IsMacroSupported failed."</span>);</li><li>     }</li><li>     <span class="hljs-keyword">if</span> (isMacroSupported) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Support macro capability."</span>);</li><li>     } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"No Support macro capability."</span>);</li><li>     }</li><li>    <span class="hljs-keyword">return</span> isMacroSupported;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-capture-session-h#oh_capturesession_enablemacro" target="_blank">OH_CaptureSession_EnableMacro()</a>方法开启或关闭微距能力。</p>       <div _ngcontent-two-c106="" class="highlight-div"><div _ngcontent-two-c106="" class="highlight-div-header"><div _ngcontent-two-c106="" class="highlight-div-header-left"><div _ngcontent-two-c106="" class="handle-button expand-button"><div _ngcontent-two-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-two-c106="" class="highlight-div-header-right"><div _ngcontent-two-c106="" class="handle-button ai-button"></div><div _ngcontent-two-c106="" class="handle-button line-button"><div _ngcontent-two-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-two-c106="" class="handle-button theme-button"><div _ngcontent-two-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-two-c106="" class="handle-button copy-button"><div _ngcontent-two-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-two-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">EnableMacro</span><span class="hljs-params">(Camera_CaptureSession* captureSession, <span class="hljs-type">bool</span> enabled)</span></span></li><li><span class="hljs-function"> </span>{</li><li>     <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IsMacroSupported</span>(captureSession)) {</li><li>         Camera_ErrorCode ret = <span class="hljs-built_in">OH_CaptureSession_EnableMacro</span>(captureSession, enabled);</li><li>         <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>             <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_EnableMacro failed."</span>);</li><li>         }</li><li>     }</li><li> }</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="zh-cn_topic_0000002507328063_状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="zh-cn_topic_0000002507328063_状态监听" tips="复制节点链接"></i></h2>          <p>从API version 20开始，支持监听微距能力是否发生改变。</p>     <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-capture-session-h#oh_capturesession_registermacrostatuschangecallback" target="_blank">OH_CaptureSession_RegisterMacroStatusChangeCallback()</a>函数注册回调，返回监听结果。</p>     <div _ngcontent-two-c106="" class="highlight-div"><div _ngcontent-two-c106="" class="highlight-div-header"><div _ngcontent-two-c106="" class="highlight-div-header-left"><div _ngcontent-two-c106="" class="handle-button expand-button"><div _ngcontent-two-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-two-c106="" class="highlight-div-header-right"><div _ngcontent-two-c106="" class="handle-button ai-button"></div><div _ngcontent-two-c106="" class="handle-button line-button"><div _ngcontent-two-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-two-c106="" class="handle-button theme-button"><div _ngcontent-two-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-two-c106="" class="handle-button copy-button"><div _ngcontent-two-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-two-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">void</span> <span class="hljs-title function_">MacroStatusCallback</span><span class="hljs-params">(Camera_CaptureSession* captureSession, bool isMacroDetected)</span></li><li>{</li><li>     <span class="hljs-keyword">if</span> (isMacroDetected) {</li><li>         OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Entering macro mode"</span>);</li><li>     }</li><li>     <span class="hljs-keyword">else</span> {</li><li>         OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Not entering macro mode"</span>);</li><li>     }</li><li>     </li><li>}</li><li>
</li><li> <span class="hljs-comment">// 注册回调函数。</span></li><li> Camera_ErrorCode <span class="hljs-title function_">RegisterMacroStatusCallback</span><span class="hljs-params">(Camera_CaptureSession* captureSession)</span></li><li> {</li><li>     <span class="hljs-type">Camera_ErrorCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_CaptureSession_RegisterMacroStatusChangeCallback(captureSession, MacroStatusCallback);</li><li>     <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>         OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"OH_CaptureSession_RegisterMacroStatusChangeCallback failed."</span>);</li><li>     }</li><li>     <span class="hljs-keyword">return</span> ret;</li><li> }</li><li>
</li><li> <span class="hljs-comment">// 解注册。</span></li><li> Camera_ErrorCode <span class="hljs-title function_">UnregisterMacroStatusCallback</span><span class="hljs-params">(Camera_CaptureSession* captureSession)</span></li><li> {</li><li>     <span class="hljs-type">Camera_ErrorCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_CaptureSession_UnregisterMacroStatusChangeCallback(captureSession, MacroStatusCallback);</li><li>     <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>         OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"OH_CaptureSession_UnregisterMacroStatusChangeCallback failed."</span>);</li><li>     }</li><li>     <span class="hljs-keyword">return</span> ret;</li><li> }</li></ol></pre></div></div>    </div>   </div>   <div></div></div>