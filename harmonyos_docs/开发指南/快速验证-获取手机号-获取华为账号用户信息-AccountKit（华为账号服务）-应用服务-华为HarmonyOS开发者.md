<h1 _ngcontent-fpn-c119="" class="doc-title ng-star-inserted" title="快速验证"> 快速验证 </h1>

<div _ngcontent-fpn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section175151155165314">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section175151155165314" tips="复制节点链接"></i></h2>          <p>当应用对获取的手机号时效性要求不高时，可使用Account Kit提供的手机号授权与快速验证能力，向用户发起手机号授权申请，经用户同意授权后，获取到手机号并为用户提供相应服务。以下对Account Kit提供的手机号授权与快速验证能力进行介绍，快速验证手机号功能还可使用场景化控件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/scenario-fusion-button-getphonenumber" target="_blank">快速验证手机号Button</a>进行实现。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>对用户选择的华为账号绑定的手机号或者新增的手机号进行验证，<strong>不保证是实时的验证</strong>，<strong>仅首次需要用户授权</strong>。</p>      </div></div></div>     <div class="fignone">      <span class="figcap"><b>图1 </b>手机端快速验证手机号流程（请以实际效果为准）</span>      <p><span><img height="552.482" originheight="3184" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114652.27226161757451291559677154256585:50001231000000:2800:7C5AEDDFB82957AF89EA6B4FEF1D03E9BF76D8644DD2F43D40FDD609DA3F4CE1.png" title="点击放大" width="267.33000000000004"></span></p>      <p></p>     </div>     <div class="fignone">      <span class="figcap"><b>图2 </b>Wearable设备快速验证手机号（请以实际效果为准）</span>     </div>     <p><span><img height="420.812" originheight="1196" originwidth="756" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114652.93899043967734317400859910077247:50001231000000:2800:E97A164A22BC95B479950096104DAD73C57F5C65B6F0E7A350F93115346112C5.png" title="点击放大" width="266"></span></p>     <p></p>    </div>    <div class="tiledSection">     <h2 id="section780017795414">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section780017795414" tips="复制节点链接"></i></h2>          <p><span><img height="375.06" originheight="723" originwidth="1008" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114652.06277773717737708394255101011452:50001231000000:2800:8DECA458E04EE10751D3AA788B654C28F67D36E2A02CB14A41C106719AA2C2CB.png" title="点击放大" width="523.6875"></span></p>     <p>流程说明：</p>     <ol>      <li>应用通过传对应scope和permission调用授权API，如果已授权则直接返回临时登录凭证Authorization Code；如果未授权则拉起授权页，在用户确认授权后，返回Authorization Code。</li>      <li>将Authorization Code传给应用服务端，使用Client ID、Client Secret、Authorization Code从华为服务器中获取Access Token，再使用Access Token请求获取用户信息。</li>      <li>从用户信息中获取到手机号、UnionID、OpenID。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1274163417495">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1274163417495" tips="复制节点链接"></i></h2>          <p>获取快速验证手机号关键接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication" target="_blank">API参考</a>。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.1" valign="top" width="58.03%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.2" valign="top" width="41.97%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="58.03%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section610319714214" target="_blank">createAuthorizationWithHuaweiIDRequest</a>(): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165" target="_blank">AuthorizationWithHuaweiIDRequest</a></p></td>        <td class="cellrowborder" valign="top" width="41.97%">         <p>获取授权接口，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165" target="_blank">AuthorizationWithHuaweiIDRequest</a>传入返回手机号的scope：phone及返回Authorization Code的permission：serviceauthcode，即可获取到Authorization Code。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="58.03%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section9716526428" target="_blank">constructor</a>(context?: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-common#context" target="_blank">common.Context</a>)</p></td>        <td class="cellrowborder" valign="top" width="41.97%">         <p>创建授权请求Controller。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="58.03%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section3975181884311" target="_blank">executeRequest</a>(request: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348" target="_blank">AuthenticationRequest</a>): Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515" target="_blank">AuthenticationResponse</a>&gt;</p></td>        <td class="cellrowborder" valign="top" width="41.97%">         <p>通过Promise方式执行授权操作。</p></td>       </tr>           </tbody></table></div>    </div>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p>上述接口需在页面或自定义组件生命周期内调用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section2011736191112">开发前提<i class="anchor-icon anchor-icon-link" anchorid="section2011736191112" tips="复制节点链接"></i></h2>          <p>1、在进行代码开发前，请先确认您已完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-preparations">开发准备</a>工作。</p>     <ul>      <li>若未配置签名和指纹，将报错<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-1">1001500001 应用指纹证书校验失败</a>。</li>      <li>若未完成“获取您的手机号”权限申请，将报错<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-2">1001502014 应用未申请scopes或permissions权限</a>。</li>     </ul>     <p>2、设备需要登录华为账号，若未登录则拉起登录页面。</p>    </div>    <div class="tiledSection">     <h2 id="section21391934175414">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section21391934175414" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1065112135518" class="firsth2">客户端开发<i class="anchor-icon anchor-icon-link" anchorid="section1065112135518" tips="复制节点链接"></i></h3>          <ol>      <li>导入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication" target="_blank">authentication</a>模块及相关公共模块。       <div _ngcontent-fpn-c106="" class="highlight-div"><div _ngcontent-fpn-c106="" class="highlight-div-header"><div _ngcontent-fpn-c106="" class="highlight-div-header-left"><div _ngcontent-fpn-c106="" class="handle-button expand-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpn-c106="" class="highlight-div-header-right"><div _ngcontent-fpn-c106="" class="handle-button ai-button"></div><div _ngcontent-fpn-c106="" class="handle-button line-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpn-c106="" class="handle-button theme-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpn-c106="" class="handle-button copy-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpn-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>创建授权请求并设置参数。       <div _ngcontent-fpn-c106="" class="highlight-div"><div _ngcontent-fpn-c106="" class="highlight-div-header"><div _ngcontent-fpn-c106="" class="highlight-div-header-left"><div _ngcontent-fpn-c106="" class="handle-button expand-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpn-c106="" class="highlight-div-header-right"><div _ngcontent-fpn-c106="" class="handle-button ai-button"></div><div _ngcontent-fpn-c106="" class="handle-button line-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpn-c106="" class="handle-button theme-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpn-c106="" class="handle-button copy-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpn-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">创建授权请求，并设置参数</span></span></li><li><span class=""><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</span></li><li><span class=""><span class="hljs-comment">// 获取手机号需要传如下scope，传参数之前需要先申请对应scope权限，否则会返回</span></span><span class="hljs-comment">1001502014错误码</span></li><li><span class="">authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'phone'</span>];</span></li><li><span class=""><span class="hljs-comment">// 获取authorizationCode需传如下permission</span></span></li><li><span class="">authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'serviceauthcode'</span>];</span></li><li><span class="hljs-comment">// 用户是否需要登录授权，该值为true且用户未登录或未授权时，会拉起用户登录或授权页面</span></li><li><span class="">authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</span></li><li><span class=""><span class="hljs-comment">// 用于防跨站点请求伪造</span></span></li><li><span class="">authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();</span></li></ol></pre></div></div></li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section620452019185" target="_blank">AuthenticationController</a>对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section3975181884311" target="_blank">executeRequest</a>方法执行授权请求，并处理授权结果，从授权结果中解析出Authorization Code，之后将Authorization Code传给应用服务端处理。       <div _ngcontent-fpn-c106="" class="highlight-div"><div _ngcontent-fpn-c106="" class="highlight-div-header"><div _ngcontent-fpn-c106="" class="highlight-div-header-left"><div _ngcontent-fpn-c106="" class="handle-button expand-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpn-c106="" class="highlight-div-header-right"><div _ngcontent-fpn-c106="" class="handle-button ai-button"></div><div _ngcontent-fpn-c106="" class="handle-button line-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpn-c106="" class="handle-button theme-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpn-c106="" class="handle-button copy-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpn-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 执行请求</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(authRequest).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">AuthorizationWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = authorizationWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; authRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to authorize. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in authentication.'</span>);</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDCredential = authorizationWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> authorizationCode = authorizationWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-comment">// 开发者处理</span><span class=""><span class="hljs-comment">authorizationCode</span></span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">dealAllError</span>(err);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li></ol></pre></div></div>       <p></p>       <div _ngcontent-fpn-c106="" class="highlight-div"><div _ngcontent-fpn-c106="" class="highlight-div-header"><div _ngcontent-fpn-c106="" class="highlight-div-header-left"><div _ngcontent-fpn-c106="" class="handle-button expand-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpn-c106="" class="highlight-div-header-right"><div _ngcontent-fpn-c106="" class="handle-button ai-button"></div><div _ngcontent-fpn-c106="" class="handle-button line-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpn-c106="" class="handle-button theme-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpn-c106="" class="handle-button copy-button"><div _ngcontent-fpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpn-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain userInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在应用快速验证手机号场景下，涉及UI交互时，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取用户信息失败，请尝试使用其他方式登录</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section380015370555">服务端开发<i class="anchor-icon anchor-icon-link" anchorid="section380015370555" tips="复制节点链接"></i></h3>          <ol>      <li>应用服务端使用Client ID、Client Secret、Authorization Code调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section1085901313579" target="_blank">获取用户级凭证接口</a>向华为账号服务器请求获取Access Token、Refresh Token。</li>      <li>使用Access Token调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-get-user-info-get-phone#section2520125725115" target="_blank">获取用户信息接口</a>获取用户信息，从用户信息中获取用户手机号、UnionID、OpenID。       <p><strong>Access Token过期处理</strong></p>       <div class="p">        由于Access Token的有效期仅为60分钟，当Access Token失效或者即将失效时（可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-get-user-info-get-nickname-and-avatar#section15782984912" target="_blank">REST API错误码</a>判断），可以使用Refresh Token（有效期180天）通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token#section1085901313579" target="_blank">刷新用户级凭证接口</a>向华为账号服务器请求获取新的Access Token。        <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">          <ol>           <li>当Access Token失效时，若您不使用Refresh Token向账号服务器请求获取新的Access Token，账号的授权信息将会失效，导致使用Access Token的功能都会失败。</li>           <li>当Access Token非正常失效（如修改密码、退出账号、删除设备）时，业务可重新登录授权获取Authorization Code，向账号服务器请求获取新的Access Token。</li>          </ol>         </div></div></div>       </div>       <p><strong>Refresh Token过期处理</strong></p>       <p>由于Refresh Token的有效期为180天，当Refresh Token失效后（可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token#section1394417423453" target="_blank">REST API错误码</a>判断），应用服务端需要通知客户端，重新调用授权接口，请求用户重新授权。</p></li>     </ol>    </div>   </div>   <div></div></div>