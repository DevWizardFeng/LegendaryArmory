<h1 _ngcontent-wap-c119="" class="doc-title ng-star-inserted" title="性能优化实验特性"> 性能优化实验特性 </h1>

<div _ngcontent-wap-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000002269610993"><p id="ZH-CN_TOPIC_0000002510174353__p7107201613486">为了打造更敏捷流畅的使用体验，新版本的Hvigor带来了一系列的编译构建性能优化实验特性，这些优化特性将显著提高工程的编译速度，降低峰值内存占用等。由于部分优化方案仍处于试验性阶段，您可能在这些特性中体验到效率的提升，也可能在特定场景中遇到待完善的问题，因此，这些特性提供了开关，用户可以根据业务需求开启后使用。</p> <div class="tiledSection"><h2 id="section95571022144613">优化任务增量判断<i class="anchor-icon anchor-icon-link" anchorid="section95571022144613" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p7584116529"><strong>优化方案：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul14584611525"><li id="li13584910524">优化前：在执行增量任务时，需要多次调用任务的输入输出方法。</li><li id="li1158420118525">优化后：执行增量任务时，会缓存输入输出方法的结果，后续再次调用时会直接读取缓存结果，减少多次调用的开销。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p745613137522"><strong>优化结果：</strong>减少编译时间。</p> <p id="ZH-CN_TOPIC_0000002510174353__p933792118449"><strong>开启方式：</strong>在hvigor-config.json5中添加以下字段，开启任务增量判断优化。从DevEco Studio 5.1.1 Beta1版本开始支持。</p> <div _ngcontent-wap-c106="" class="highlight-div"><div _ngcontent-wap-c106="" class="highlight-div-header"><div _ngcontent-wap-c106="" class="highlight-div-header-left"><div _ngcontent-wap-c106="" class="handle-button expand-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wap-c106="" class="highlight-div-header-right"><div _ngcontent-wap-c106="" class="handle-button ai-button"></div><div _ngcontent-wap-c106="" class="handle-button line-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wap-c106="" class="handle-button theme-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wap-c106="" class="handle-button copy-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wap-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174353__screen133732134414" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"properties"</span>: {</li><li>  <span class="hljs-string">"hvigor.incremental.optimization"</span>: <span class="hljs-keyword">true</span></li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174353__p1647512423484"><strong>可能影响：</strong>如果用户在自定义任务的增量输入/输出判断中引用了全局变量，在任务执行时这些变量可能会改变，如果改变，会导致下一次构建时，相关任务增量判断失效，任务重新执行。</p> </div> <div class="tiledSection"><h2 id="section09371546164610">优化任务调度<i class="anchor-icon anchor-icon-link" anchorid="section09371546164610" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p12239173419520"><strong>优化方案：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul112392034185214"><li id="li10239173445218">优化前：任务调度时，待执行队列中的任务依次执行，增量构建的执行时间受到CompileArkTs任务开始执行时间的影响，CompileArkTs任务越晚执行，构建时间可能越长。</li><li id="li5239123417527">优化后：通过优先执行CompileArkTs及其依赖的任务，能够尽早启动编译任务CompileArkTs，从而减少构建时间。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p1225024135215"><strong>优化结果：</strong>减少编译时间。</p> <p id="ZH-CN_TOPIC_0000002510174353__p8337021204419"><strong>开启方式：</strong>在hvigor-config.json5中添加以下字段，开启任务调度优化。从DevEco Studio 5.1.1 Beta1版本开始支持。</p> <div _ngcontent-wap-c106="" class="highlight-div"><div _ngcontent-wap-c106="" class="highlight-div-header"><div _ngcontent-wap-c106="" class="highlight-div-header-left"><div _ngcontent-wap-c106="" class="handle-button expand-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wap-c106="" class="highlight-div-header-right"><div _ngcontent-wap-c106="" class="handle-button ai-button"></div><div _ngcontent-wap-c106="" class="handle-button line-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wap-c106="" class="handle-button theme-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wap-c106="" class="handle-button copy-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wap-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174353__screen289023884415" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"properties"</span>: {</li><li>  <span class="hljs-string">"hvigor.task.schedule.optimization"</span>: <span class="hljs-keyword">true</span></li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174353__p93781430141820"><strong>可能影响：</strong>无影响。</p> </div> <div class="tiledSection"><h2 id="section1131619813214">文件写入磁盘<i class="anchor-icon anchor-icon-link" anchorid="section1131619813214" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p526011578523"><strong>优化方案：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul1626055795215"><li id="li326020573524">优化前：ArkTS代码编译时，单文件解析完成后会缓存在内存中。</li><li id="li17260257145213">优化后：ArkTS代码编译时，在单文件解析完成后会写入磁盘，可以降低编译过程的峰值内存。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p1749815918527"><strong>优化结果：</strong>减少内存占用。</p> <p id="ZH-CN_TOPIC_0000002510174353__p43345441547"><strong>开启方式：</strong>在hvigor-config.json5中添加以下字段开启。</p> <div _ngcontent-wap-c106="" class="highlight-div"><div _ngcontent-wap-c106="" class="highlight-div-header"><div _ngcontent-wap-c106="" class="highlight-div-header-left"><div _ngcontent-wap-c106="" class="handle-button expand-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wap-c106="" class="highlight-div-header-right"><div _ngcontent-wap-c106="" class="handle-button ai-button"></div><div _ngcontent-wap-c106="" class="handle-button line-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wap-c106="" class="handle-button theme-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wap-c106="" class="handle-button copy-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wap-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174353__screen033713215448" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"properties"</span>: {</li><li>  <span class="hljs-string">"ohos.arkCompile.singleFileEmit"</span>: <span class="hljs-keyword">true</span></li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174353__p4334204465420"><strong>可能影响：</strong>单文件解析后写入磁盘的时序被提前，可能导致用户自定义源码插桩插件在文件写入磁盘后执行，无法生效。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510174353__ul17431101119575"><li id="li16431101185720">仅在debug模式下生效。</li><li id="li190761215719">当进行代码覆盖率编译时，该字段不生效。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section11117155101617">优化编译中间产物生成<i class="anchor-icon anchor-icon-link" anchorid="section11117155101617" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p83817135539"><strong>优化方案：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul8381131325313"><li id="li1138131395315">优化前：ArkTS代码编译时，会把ets/ts代码编译成中间态的js代码。</li><li id="li123811413145312">优化后：ArkTS代码编译时，不会再生成中间态的js代码。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p1765911835315"><strong>优化结果：</strong>减少编译时间和内存占用。</p> <p id="ZH-CN_TOPIC_0000002510174353__p104545451166"><strong>开启方式：</strong>在hvigor-config.json5中添加以下字段开启。</p> <div _ngcontent-wap-c106="" class="highlight-div"><div _ngcontent-wap-c106="" class="highlight-div-header"><div _ngcontent-wap-c106="" class="highlight-div-header-left"><div _ngcontent-wap-c106="" class="handle-button expand-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wap-c106="" class="highlight-div-header-right"><div _ngcontent-wap-c106="" class="handle-button ai-button"></div><div _ngcontent-wap-c106="" class="handle-button line-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wap-c106="" class="handle-button theme-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wap-c106="" class="handle-button copy-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wap-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174353__screen44541145151613" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"properties"</span>: {</li><li>  <span class="hljs-string">"ohos.arkCompile.noEmitJs"</span>: <span class="hljs-keyword">true</span></li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174353__p1454345181615"><strong>可能影响：</strong>无影响。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174353__p3271104715">以下场景均不支持该字段，配置后也会生成中间态的js代码：</p> <ul id="ZH-CN_TOPIC_0000002510174353__ul62730575"><li id="li6272001078">FA模型。</li><li id="li62712015716">覆盖率测试。</li><li id="li122770376"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-har#section19788284410">在release模式下，开启混淆构建包含js中间码的HAR</a>。</li><li id="li3275014713">LiteWearable设备对应的工程。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section730523404612">增量判断模块级跳过<i class="anchor-icon anchor-icon-link" anchorid="section730523404612" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p1214385510610"><strong>使用场景</strong></p> <p id="ZH-CN_TOPIC_0000002510174353__p27501857266">从DevEco Studio 6.0.0 Beta3版本开始，如果有频繁修改代码进行增量构建的需求，可开启开关优化增量编译速度。</p> <p id="ZH-CN_TOPIC_0000002510174353__p1988243518278"><strong>使用约束</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul1981173922716"><li id="li198143932716">开启开关前，需要进行一次全量构建，确保构建产物build目录存在。</li><li id="li98441649132811">开启开关后，仅支持修改模块src目录下的内容，如果修改src目录以外的其他内容，可能导致修改不生效或编译问题。</li><li id="li1921417227391">不支持预览和Local Test。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p20828152215615"><strong>优化方案：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul3828102255620"><li id="li18281322155610">优化前：各模块所有任务都需要进行增量判断。</li><li id="li1782815225565">优化后：开启开关后，修改模块src目录下的内容，构建时，未修改的模块不会进行增量判断。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p482822219569"><strong>优化结果：</strong>减少增量构建编译时间。</p> <p id="ZH-CN_TOPIC_0000002510174353__p4828122205613"><strong>开启方式：</strong>点击<strong>File &gt; </strong><strong>Settings</strong>（macOS为<strong>DevEco Studio &gt; Preferences/Settings</strong>）<strong> &gt; Build, Execution, Deployment &gt; Build Tools &gt; Hvigor</strong>，勾选<strong>Enable module level incremental skip for incremental build</strong>。</p> <p id="ZH-CN_TOPIC_0000002510174353__p168283221568"><strong>可能影响：</strong>不满足使用约束条件的，可能会导致开关失效或者编译问题。</p> </div> <div class="tiledSection"><h2 id="section11663628141317">通过Hvigor执行ohpm install<i class="anchor-icon anchor-icon-link" anchorid="section11663628141317" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p18491134514816">从DevEco Studio 6.0.0 Beta3版本开始，Settings中增加一个开关<strong>Enable ohpm execution by hvigor</strong>，该开关有两个使用场景，具体如下。</p> <p id="ZH-CN_TOPIC_0000002510174353__p4846158181012"><strong>开启方式：</strong>点击<strong>File &gt; </strong><strong>Settings</strong>（macOS为<strong>DevEco Studio &gt; Preferences/Settings</strong>）<strong> &gt; Build, Execution, Deployment &gt; Build Tools &gt; Hvigor</strong>，勾选<strong>Enable ohpm execution by hvigor</strong>。</p> <p id="ZH-CN_TOPIC_0000002510174353__p56639282136"><strong>使用场景</strong>一</p> <p id="ZH-CN_TOPIC_0000002510174353__p12819125293518">开启开关后，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-api#section14183309272">excludeNodeByName方法</a>排除一个不存在的模块。</p> <ol id="ZH-CN_TOPIC_0000002510174353__ol11220150143615"><li id="li72202016367">按照以上方式开启开关<strong>Enable ohpm execution by hvigor</strong>。</li><li id="li5134103320366">在工程级build-profile.json5的module字段下，添加工程中不存在的模块，如testModule。<p id="ZH-CN_TOPIC_0000002510174353__p18526959194520"><span><img originheight="414" originwidth="891" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104916.28664367967251605476865583985113:50001231000000:2800:7991F948DB23867B6A6AB045B799FAB60512B097EB79F7F60D81F63F8E2DA1B6.png" width="891" height="414"></span></p> </li><li id="li356712024712">调用excludeNodeByName方法，排除不存在的模块testModule。<p id="ZH-CN_TOPIC_0000002510174353__p103320241110"><span><img originheight="351" originwidth="1024" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104916.62483839227221961493409008572321:50001231000000:2800:573E28929D22C4E13414B50D4AC2E44A8E555284EDBF098C7FA799611175C519.png" width="920" height="315.3515625"></span></p> </li><li id="li9597413233">执行构建成功。</li></ol> <p id="ZH-CN_TOPIC_0000002510174353__p4783947171314"><strong>使用场景二</strong></p> <p id="ZH-CN_TOPIC_0000002510174353__p627613504138">调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-build-expanding-context#section18789410129">setDependenciesOpt</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-build-expanding-context#section469812496459">setOverrides</a>等方法动态修改oh-package.json5中的依赖信息后，执行sync或build等操作时，DevEco Studio会执行两次ohpm install操作，开启开关后，Hvigor仅执行一次ohpm install，可提升构建的效率。</p> <p id="ZH-CN_TOPIC_0000002510174353__p1904204305116"><span><img originheight="251" originwidth="1121" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104916.01229070153956577324193883673643:50001231000000:2800:8EEC6AA6B7CB0917E7545408DA1C4DD5574C7FE9444BA2DB89A8068BDD0CADEE.png" width="920" height="205.99464763603925"></span></p> </div> <div class="tiledSection"><h2 id="section324586847">通过IClang提升C++增量编译效率<i class="anchor-icon anchor-icon-link" anchorid="section324586847" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174353__p13778184191010"><strong>使用场景</strong></p> <p id="ZH-CN_TOPIC_0000002510174353__p1919712341101">从DevEco Studio 6.0.1 Beta1版本开始，如果需要频繁修改某个cpp源文件，可开启IClang相关的开关，提升C++增量编译效率。IClang是一项C++函数级增量编译优化技术，详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/bisheng-compiler#section8221174018112" target="_blank">毕昇编译器</a>。</p> <p id="ZH-CN_TOPIC_0000002510174353__p9554155141019"><strong>使用约束</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul7434173683213"><li id="li74343368327">仅支持在debug编译模式下使用。</li><li id="li112871244113219">需要使用毕昇编译器进行编译，即工程级build-profile.json5的nativeCompiler配置为BiSheng。</li><li id="li1993164514235">首次修改cpp文件时，IClang会将该文件识别为频繁修改的目标文件，并为其生成缓存。因此，当第二次修改cpp文件并进行增量编译时，才会提升编译效率。</li><li id="li146921855101914">修改头文件的内容或头文件的导入语句，包括顺序、语句间的空行或任何格式上的调整，都会导致缓存失效，无法提升编译效率。</li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p19155183719395"><strong>开启方式：</strong></p> <ul id="ZH-CN_TOPIC_0000002510174353__ul444693815393"><li id="li134468380394">方式一：点击<strong>File &gt; </strong><strong>Settings</strong>（macOS为<strong>DevEco Studio &gt; Preferences/Settings</strong>）<strong> &gt; Build, Execution, Deployment &gt; Build Tools &gt; Hvigor</strong>，勾选<strong>Enable C++ function level incremental compilation</strong>。</li><li id="li312964313396">方式二：模块级build-profile.json5的cppFlags、cFlags配置"-iclang"参数。<div _ngcontent-wap-c106="" class="highlight-div"><div _ngcontent-wap-c106="" class="highlight-div-header"><div _ngcontent-wap-c106="" class="highlight-div-header-left"><div _ngcontent-wap-c106="" class="handle-button expand-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wap-c106="" class="highlight-div-header-right"><div _ngcontent-wap-c106="" class="handle-button ai-button"></div><div _ngcontent-wap-c106="" class="handle-button line-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wap-c106="" class="handle-button theme-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wap-c106="" class="handle-button copy-button"><div _ngcontent-wap-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wap-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174353__screen139032052204013" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"buildOption"</span>: {</li><li>  <span class="hljs-string">"externalNativeOptions"</span>: {</li><li>    <span class="hljs-string">"cppFlags"</span>: <span class="hljs-string">"-iclang"</span>,</li><li>    <span class="hljs-string">"cFlags"</span>: <span class="hljs-string">"-iclang"</span>,</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ul> <p id="ZH-CN_TOPIC_0000002510174353__p35661322123912"><strong>可能影响：</strong>build-profile.json5文件会纳入项目版本管理，在该文件中增加-iclang参数后，项目其他开发人员会被动开启该实验特性。因此请在充分验证功能正确性后，再通过配置文件上传到代码仓。</p> </div> </div> <div></div></div>