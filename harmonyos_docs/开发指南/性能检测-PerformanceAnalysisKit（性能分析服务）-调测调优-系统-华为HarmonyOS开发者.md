<h1 _ngcontent-vid-c119="" class="doc-title ng-star-inserted" title="性能检测"> 性能检测 </h1>

<div _ngcontent-vid-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section177613183414">启动耗时事件检测<i class="anchor-icon anchor-icon-link" anchorid="section177613183414" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h2 id="section11820823433">简介<i class="anchor-icon anchor-icon-link" anchorid="section11820823433" tips="复制节点链接"></i></h2></div> <p>启动耗时事件是用于度量应用启动过程在系统可感知阶段耗时的事件，主要是针对用户可感知的应用启动过程进行性能度量，包括桌面启动、状态栏启动、最近任务列表启动等场景。开发者订阅此时间可以获取到启动过程中关键阶段耗时。</p> <div class="tiledSection"><h3 id="section11783110154319" class="firsth2">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section11783110154319" tips="复制节点链接"></i></h3></div> <p>启动事件统计时间起点为用户点击屏幕，默认结束点为启动动效完成，使用者可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#reportdrawncompleted10" target="_blank">reportDrawCompleted</a>接口根据实际情况传入定制结束时间。</p> <p><span><img height="212.4675" originheight="539" originwidth="1328" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115018.65712756603377445762920985684007:50001231000000:2800:AE6C40A233C085EF27A40D82DED7C416E233F52BD9E03029DE0DDE7EE30F88F8.png" title="点击放大" width="523.6875"></span></p> <p>icon_input_time：用户点击屏幕时间点</p> <p><span style="color: rgb(25,25,25);">animation_finish_time：系统定义的启动耗时，开发者无法干预，该时间为手指离开屏幕到启动动效结束的时间</span>。</p> <p><span style="color: rgb(25,25,25);">extend_time</span>：开发者定制的启动耗时，<span style="color: rgb(25,25,25);">该时间为</span>手指离开屏幕到开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiextensioncontext#reportdrawncompleted12" target="_blank">reportDrawnCompleted</a>接口的时间。开发者可以根据业务需要在合适的时机调用reportDrawnCompleted接口<span style="color: rgb(25,25,25);">，不调用或手指离开屏幕后5s未调用则该指标大小为0</span>。</p> <div class="tiledSection"><h3 id="section13772327184312">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section13772327184312" tips="复制节点链接"></i></h3></div> <p>1.启动事件是指用户操作的应用启动，不包括进程自动重启等情况。</p> <p>2.启动时间为行为类事件，触发后即上报不受阈值限制。</p> <div class="tiledSection"><h3 id="section19608165419442">事件获取方式<i class="anchor-icon anchor-icon-link" anchorid="section19608165419442" tips="复制节点链接"></i></h3><p>可以通过订阅HiAppEvent获取启动耗时事件及其相关信息，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-intro" target="_blank">HiAppEvent介绍</a>。参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-app-launch-arkts" target="_blank">订阅启动耗时事件（ArkTS）</a>完成启动耗时事件订阅。</p> </div> <div class="tiledSection"><h2 id="section191899590502">滑动事件检测<i class="anchor-icon anchor-icon-link" anchorid="section191899590502" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h2 id="section548154211434">简介<i class="anchor-icon anchor-icon-link" anchorid="section548154211434" tips="复制节点链接"></i></h2></div> <p>滑动丢帧事件用于检测列表滑动过程中产生的卡顿，订阅此事件后，会在列表滑动中出现超过50ms的卡顿时上报故障事件。</p> <div class="tiledSection"><h3 id="section1486813734416" class="firsth2">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1486813734416" tips="复制节点链接"></i></h3></div> <p>1.计算方法：</p> <p>当列表滑动过程中应用主线程或者RenderService绘制流程中出现卡顿时上报此事件。</p> <p>其中滑动过程从手势识别为滑动开始到页面滑动停止结束。从应用主线程和RenderService绘制分别计算卡顿时长。</p> <p></p> <p>2.上报阈值：</p> <p>最大单帧耗时超过50ms则为滑动丢帧，具体规则为max_render_frametime或max_app_frametime超过50ms时会触发该事件上报。</p> <p><span><img originheight="315" originwidth="654" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115018.95922448604543071377086215205872:50001231000000:2800:331C2BC17446BA9C43DBEE8B00C707AE6F2AE2080B23F9345453C3FAE89BAFA5.png" width="654" height="315"></span></p> <div class="tiledSection"><h3 id="section173321617144417">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section173321617144417" tips="复制节点链接"></i></h3></div> <p>滑动单帧耗时不超过50ms时不会触发上报。</p> <p></p> <div class="tiledSection"><h2 id="section1271011512433">滑动丢帧日志采集机制<i class="anchor-icon anchor-icon-link" anchorid="section1271011512433" tips="复制节点链接"></i></h2></div> <p>滑动丢帧事件会触发主线程的调用栈采集</p> <p></p> <p>1、启动时间</p> <p>滑动丢帧的采样栈功能仅在滑动过程中开启</p> <p></p> <p>2、采栈时间</p> <p>在滑动过程中如果应用主线程出现了达到上报阈值的卡顿后触发采栈。</p> <p></p> <div class="tiledSection"><h2 id="section1672625734315">滑动丢帧事件日志规格<i class="anchor-icon anchor-icon-link" anchorid="section1672625734315" tips="复制节点链接"></i></h2></div> <p>1、日志老化规格</p> <p>一般情况，栈文件的大小为7-10KB。应用沙箱内的watchdog目录最大保存10M内容，超出后，需要用户手动清理文件。目录地址：/data/storage/el2/log/watchdog/。</p> <p>若用户未主动清理，系统会触发清理。</p> <p></p> <p>2、事件里如何获取日志</p> <p>从external_logs中获取日志路径</p> <p></p> <p>3、采样栈的格式</p> <p>抓栈功能目前只支持ARM64架构，抓栈结果为解析后的混合栈信息，包含native帧和JS帧。此日志为避免过度消耗系统资源，一个进程一天至多采集一次。</p> <p>抓栈结果部分示例如下：</p> <p><span><img originheight="225" originwidth="1259" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115018.24305072643386615082096137964213:50001231000000:2800:12EE79D022CAF6A8DA9AF4D7B77D91F208574B81221DE74368EB1CF2BE734F94.png" width="920" height="164.41620333598092"></span></p> <p>此采样栈包含在滑动出现超过50ms卡顿时应用主线程调用信息，由于一般滑动卡顿过程较短，因此在出现问题时采集了一次调用栈。可根据同一场景卡顿上报的采样栈数据进行聚类，以判断该场景下滑动卡顿的具体根因。采样栈具体解析方法详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines#日志规格" target="_blank">主线程超时调用栈日志规格</a>。</p> <div class="tiledSection"><h3 id="section1071134213489" class="firsth2">日志获取方式<i class="anchor-icon anchor-icon-link" anchorid="section1071134213489" tips="复制节点链接"></i></h3><p>HiAppEvent给开发者提供了故障订阅接口，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-intro" target="_blank">HiAppEvent介绍</a>。参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-scroll-jank-arkts" target="_blank">订阅滑动丢帧事件（ArkTS）</a>完成滑动丢帧事件订阅。</p> </div> </div> <div></div></div>