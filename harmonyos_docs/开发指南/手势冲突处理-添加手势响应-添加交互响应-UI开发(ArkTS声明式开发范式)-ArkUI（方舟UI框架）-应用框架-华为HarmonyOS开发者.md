<h1 _ngcontent-uey-c119="" class="doc-title ng-star-inserted" title="手势冲突处理"> 手势冲突处理 </h1>

<div _ngcontent-uey-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>手势冲突是指多个手势识别器在同一组件或重叠区域同时识别时产生竞争，导致识别结果不符合预期。常见冲突场景包括：</p>    <ul>     <li>同一组件上的多手势（如按钮同时添加点击与长按手势）。</li>     <li>父子组件的同类型手势识别器。</li>     <li>系统默认手势与自定义手势（如scroll滑动手势与子组件点击手势冲突）。</li>    </ul>    <p>干预手势处理可有效解决冲突，除控制组件响应热区和命中测试模式外，主要通过以下三种方式：<a href="/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-gesture-judge#自定义手势判定">自定义手势判定</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-gesture-judge#手势并行动态控制">手势并行动态控制</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-gesture-judge#阻止手势参与识别">阻止手势参与识别</a>。</p>    <div class="tiledSection">     <h2 id="自定义手势判定">自定义手势判定<i class="anchor-icon anchor-icon-link" anchorid="自定义手势判定" tips="复制节点链接"></i></h2>          <p>自定义手势判定是指在系统判定阈值已满足的条件下，应用可自行判断是否应拦截该手势，使该手势识别失败，从而将识别成功的机会留给其他手势。</p>     <p><strong>图1</strong> 自定义手势判定流程图</p>     <p><span><img originheight="297" originwidth="989" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114939.18248786065799834047775796220020:50001231000000:2800:38AF3C4BC9DE3D7824FB5CFF854973CBC3B6CF63DDDF0B1A0AEC83A5393F35C7.png" width="920" height="276.27906976744185"></span></p>     <p>自定义手势判定涉及以下接口。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.3.1.1" valign="top" width="50%"><strong>接口</strong></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.3.1.2" valign="top" width="50%"><strong>说明</strong></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-customize-judge#ongesturejudgebegin" target="_blank">onGestureJudgeBegin</a></td>         <td class="cellrowborder" valign="top" width="50%">用于手势拦截，是通用事件。在手势满足系统触发阈值场景下，回调给应用判断是否拦截手势。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-blocking-enhancement#ongesturerecognizerjudgebegin" target="_blank">onGestureRecognizerJudgeBegin</a></td>         <td class="cellrowborder" valign="top" width="50%">          <p>用于手势拦截、获取手势识别器和设置手势识别器开闭状态。是onGestureJudgeBegin接口的能力扩展，可以代替onGestureJudgeBegin接口。</p>          <p>获取手势识别器时，会获取一次交互中手势响应链上的所有手势识别器，以及当前即将触发成功的手势识别器，此时可以设置手势的激活状态。</p></td>        </tr>             </tbody></table></div>     </div>     <p>以下示例中，Image和Stack两个组件位于同一区域。长按Stack组件的上半部分可触发挂载在Stack组件上的长按手势，长按Stack组件的下半部分则会响应Image组件的拖拽操作。</p>     <p><strong>图2</strong> 示例图</p>     <p><span><img originheight="193" originwidth="231" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114939.31897176997151103298953638837357:50001231000000:2800:D3662E47E89DDBB7F060D24D41972D29CC1A2E57267BFAF52EBCB8801B40F913.png" class="notEnlarge" width="231" height="193"></span></p>     <ol>      <li>       <p>Image组件设置拖拽。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'sys.media.ohos_app_icon'</span>))</li><li>  .<span class="hljs-title function_">draggable</span>(<span class="hljs-literal">true</span>)</li><li>  .<span class="hljs-title function_">onDragStart</span>(<span class="hljs-function">()=&gt;</span>{</li><li>    promptAction.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">"Drag 下半区蓝色区域，Image响应"</span> });</li><li>  })</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'200vp'</span>)</li></ol></pre></div></div></li>      <li>       <p>Stack组件设置手势。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Stack</span>() {}</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'200vp'</span>)</li><li>  .<span class="hljs-title function_">hitTestBehavior</span>(<span class="hljs-title class_">HitTestMode</span>.<span class="hljs-property">Transparent</span>)</li><li>  .<span class="hljs-title function_">gesture</span>(<span class="hljs-title class_">GestureGroup</span>(<span class="hljs-title class_">GestureMode</span>.<span class="hljs-property">Parallel</span>,</li><li>    <span class="hljs-title class_">LongPressGesture</span>()</li><li>      .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {</li><li>        promptAction.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">"LongPressGesture 长按上半区 红色区域，红色区域响应"</span> });</li><li>      })</li><li>      .<span class="hljs-title function_">tag</span>(<span class="hljs-string">"longpress"</span>)</li><li>  ))</li></ol></pre></div></div></li>      <li>       <p>Stack组件设置拦截。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">onGestureJudgeBegin</span>(<span class="hljs-function">(<span class="hljs-params">gestureInfo: GestureInfo, event: BaseGestureEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 如果是长按类型手势，判断点击的位置是否在上半区</span></li><li>  <span class="hljs-keyword">if</span> (gestureInfo.<span class="hljs-property">type</span> == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">LONG_PRESS_GESTURE</span>) {</li><li>    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">fingerList</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; event.<span class="hljs-property">fingerList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">localY</span> &lt; <span class="hljs-number">100</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">REJECT</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>})</li></ol></pre></div></div></li>      <li>       <p>代码完整示例。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromptAction</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li> <span class="hljs-meta">@Entry</span></li><li> <span class="hljs-meta">@Component</span></li><li> struct <span class="hljs-title class_">Index</span> {</li><li>   <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>   <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>();</li><li>
</li><li>   <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>       <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>         <span class="hljs-comment">//  $r('app.string.Drag_instructions') 需要替换为开发者所需的资源文件</span></li><li>         <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.Drag_instructions'</span>)).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'0xffdd00'</span>)</li><li>         <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span> }) {</li><li>           <span class="hljs-title class_">Column</span>() {</li><li>             <span class="hljs-comment">// 模拟上半区和下半区</span></li><li>             <span class="hljs-title class_">Stack</span>().<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100vp'</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>             <span class="hljs-title class_">Stack</span>().<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100vp'</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>           }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'200vp'</span>)</li><li>
</li><li>           <span class="hljs-comment">// Stack的下半区是绑定了滑动手势的图像区域。</span></li><li>           <span class="hljs-comment">//  $r('sys.media.ohos_app_icon') 需要替换为开发者所需的资源文件</span></li><li>           <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'sys.media.ohos_app_icon'</span>))</li><li>             .<span class="hljs-title function_">draggable</span>(<span class="hljs-literal">true</span>)</li><li>             .<span class="hljs-title function_">onDragStart</span>(<span class="hljs-function">() =&gt;</span> {</li><li>               <span class="hljs-comment">//  $r('app.string.Allow_dragging_prompt') 需要替换为开发者所需的资源文件</span></li><li>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: $r(<span class="hljs-string">'app.string.Allow_dragging_prompt'</span>) });</li><li>             })</li><li>             .<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'200vp'</span>)</li><li>           <span class="hljs-comment">// Stack的上半区是绑定了长按手势的浮动区域。</span></li><li>           <span class="hljs-title class_">Stack</span>() {</li><li>           }</li><li>           .<span class="hljs-title function_">width</span>(<span class="hljs-string">'200vp'</span>)</li><li>           .<span class="hljs-title function_">height</span>(<span class="hljs-string">'200vp'</span>)</li><li>           .<span class="hljs-title function_">hitTestBehavior</span>(<span class="hljs-title class_">HitTestMode</span>.<span class="hljs-property">Transparent</span>)</li><li>           .<span class="hljs-title function_">gesture</span>(<span class="hljs-title class_">GestureGroup</span>(<span class="hljs-title class_">GestureMode</span>.<span class="hljs-property">Parallel</span>,</li><li>             <span class="hljs-title class_">LongPressGesture</span>()</li><li>               .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {</li><li>                 <span class="hljs-comment">//  $r('app.string.Stop_dragging_prompt') 需要替换为开发者所需的资源文件</span></li><li>                 <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: $r(<span class="hljs-string">'app.string.Stop_dragging_prompt'</span>) });</li><li>               })</li><li>               .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'longpress'</span>)</li><li>           ))</li><li>           .<span class="hljs-title function_">onGestureJudgeBegin</span>(<span class="hljs-function">(<span class="hljs-params">gestureInfo: GestureInfo, event: BaseGestureEvent</span>) =&gt;</span> {</li><li>             <span class="hljs-comment">// 如果是长按类型手势，判断点击的位置是否在上半区</span></li><li>             <span class="hljs-keyword">if</span> (gestureInfo.<span class="hljs-property">type</span> == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">LONG_PRESS_GESTURE</span>) {</li><li>               <span class="hljs-keyword">if</span> (event.<span class="hljs-property">fingerList</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; event.<span class="hljs-property">fingerList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">localY</span> &lt; <span class="hljs-number">100</span>) {</li><li>                 <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>               } <span class="hljs-keyword">else</span> {</li><li>                 <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">REJECT</span>;</li><li>               }</li><li>             };</li><li>             <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>           })</li><li>         }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>       }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>     }</li><li>   }</li><li> }</li></ol></pre></div></div>       <p><span><img originheight="235" originwidth="275" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114939.81930204825207899662868065017671:50001231000000:2800:15F19C729109757EA175436D68E0535323E6D7881394DD1DFE70D85C4868D049.jpg" class="notEnlarge" width="275" height="235"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="手势并行动态控制">手势并行动态控制<i class="anchor-icon anchor-icon-link" anchorid="手势并行动态控制" tips="复制节点链接"></i></h2>          <p>手势并行动态控制指的是手势已经成功识别，但是开发者仍然可以通过调用API接口控制手势回调是否能够响应。</p>     <p><strong>图3</strong> 手势并行动态控制流程图</p>     <p><span><img originheight="435" originwidth="3122" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114939.14859455523331855957158431025497:50001231000000:2800:C17FCF958802A10A25F2F4D88E33AE0B5E44981996E6D32C54861E0D6E986415.png" width="920" height="128.1870595771941"></span></p>     <p>手势并行动态控制的前提是手势识别成功，如果手势不成功则不会产生手势回调响应。</p>     <ol>      <li>       <p>业务手势作业流：指真正触发UI变化的业务手势，比如使页面滚动的PanGesture，触发点击的TapGesture等。</p></li>      <li>       <p>监听手势作业流：指在监听手势运行的过程中，应根据上下文的业务状态变化动态控制手势识别器的开闭，例如判断组件嵌套滚动过程中是否已滑至边缘。这一监听事件可借助一个使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-binding#parallelgesture并行手势绑定方法">并行手势绑定方式</a>的PanGesture实现，或者采用Touch事件来完成。</p></li>      <li>       <p>设置手势并行：此步骤并非必需，典型场景是在嵌套滚动中，设置外部组件的滚动手势与内部的滚动手势并行。</p></li>      <li>       <p>动态开闭手势：指通过手势识别器的setEnabled方法，控制手势是否响应用户回调。</p></li>     </ol>     <p>手势并行动态控制涉及以下接口。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.8.1.3.1.1" valign="top" width="50%"><strong>接口</strong></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.8.1.3.1.2" valign="top" width="50%"><strong>说明</strong></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-blocking-enhancement#shouldbuiltinrecognizerparallelwith" target="_blank">shouldBuiltInRecognizerParallelWith</a></td>         <td class="cellrowborder" valign="top" width="50%">用于设置系统组件内置手势与其他手势并行。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-blocking-enhancement#ongesturerecognizerjudgebegin" target="_blank">onGestureRecognizerJudgeBegin</a></td>         <td class="cellrowborder" valign="top" width="50%">用于手势拦截，获取手势识别器，初始化手势识别器开闭状态。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-binding#parallelgesture并行手势绑定方法">parallelGesture</a></td>         <td class="cellrowborder" valign="top" width="50%">可使开发者定义的手势，与比他优先级高的手势并行。</td>        </tr>             </tbody></table></div>     </div>     <p>以下示例是两个Scroll组件的嵌套滚动场景，使用手势控制的api去控制外部组件和内部组件的嵌套滚动联动。</p>     <ol>      <li>       <p>使用shouldBuiltInRecognizerParallelWith接口设置外部Scroll组件的PanGesture手势与内部Scroll组件的PanGesture手势并行。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">shouldBuiltInRecognizerParallelWith</span>(<span class="hljs-function">(<span class="hljs-params">current: GestureRecognizer, others: <span class="hljs-built_in">Array</span>&lt;GestureRecognizer&gt;</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; others.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-keyword">let</span> target = others[i].<span class="hljs-title function_">getEventTargetInfo</span>();</li><li>    <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"inner"</span> &amp;&amp; others[i].<span class="hljs-title function_">isBuiltIn</span>() &amp;&amp; others[i].<span class="hljs-title function_">getType</span>() == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">PAN_GESTURE</span>) { <span class="hljs-comment">// 找到将要组成并行手势的识别器</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span> = current; <span class="hljs-comment">// 保存当前组件的识别器</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span> = others[i]; <span class="hljs-comment">// 保存将要组成并行手势的识别器</span></li><li>      <span class="hljs-keyword">return</span> others[i]; <span class="hljs-comment">// 返回和当前手势将要组成并行手势的识别器</span></li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>})</li></ol></pre></div></div></li>      <li>       <p>使用onGestureRecognizerJudgeBegin接口获取到Scroll组件的PanGesture手势识别器，同时根据内外Scroll组件的边界条件，设置内外手势的开闭状态。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">onGestureRecognizerJudgeBegin</span>(<span class="hljs-function">(<span class="hljs-params">event: BaseGestureEvent, current: GestureRecognizer, others: <span class="hljs-built_in">Array</span>&lt;GestureRecognizer&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 在识别器即将要成功时，根据当前组件状态，设置识别器使能状态</span></li><li>  <span class="hljs-keyword">let</span> target = current.<span class="hljs-title function_">getEventTargetInfo</span>();</li><li>  <span class="hljs-keyword">if</span> (target &amp;&amp; target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"outer"</span> &amp;&amp; current.<span class="hljs-title function_">isBuiltIn</span>() &amp;&amp; current.<span class="hljs-title function_">getType</span>() == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">PAN_GESTURE</span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; others.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">let</span> target = others[i].<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>      <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span> &amp;&amp; target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"inner"</span>) { <span class="hljs-comment">// 找到响应链上对应并行的识别器</span></li><li>        <span class="hljs-keyword">let</span> panEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">PanGestureEvent</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>        <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isEnd</span>()) { <span class="hljs-comment">// 根据当前组件状态以及移动方向动态控制识别器使能状态</span></li><li>          <span class="hljs-keyword">if</span> (panEvent &amp;&amp; panEvent.<span class="hljs-property">offsetY</span> &lt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>          }</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isBegin</span>()) {</li><li>          <span class="hljs-keyword">if</span> (panEvent.<span class="hljs-property">offsetY</span> &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>          }</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>})</li></ol></pre></div></div></li>      <li>       <p>设置监听手势，监听Scroll组件状态，动态调整手势开闭状态，控制手势回调是否触发，从而控制Scroll是否滚动。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">parallelGesture</span>( <span class="hljs-comment">// 绑定一个Pan手势作为动态控制器</span></li><li>  <span class="hljs-title class_">PanGesture</span>()</li><li>    .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>)=&gt;</span>{</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">getState</span>() != <span class="hljs-title class_">GestureRecognizerState</span>.<span class="hljs-property">SUCCESSFUL</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">getState</span>() != <span class="hljs-title class_">GestureRecognizerState</span>.<span class="hljs-property">SUCCESSFUL</span>) { <span class="hljs-comment">// 如果识别器状态不是SUCCESSFUL，则不做控制</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">let</span> target = <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>      <span class="hljs-keyword">let</span> currentTarget = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>      <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span> &amp;&amp; currentTarget <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>        <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isEnd</span>()) { <span class="hljs-comment">// 在移动过程中实时根据当前组件状态，控制识别器的开闭状态</span></li><li>          <span class="hljs-keyword">if</span> ((event.<span class="hljs-property">offsetY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span>) &lt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            <span class="hljs-keyword">if</span> (currentTarget.<span class="hljs-title function_">isEnd</span>()) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>            }</li><li>          }</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isBegin</span>()) {</li><li>          <span class="hljs-keyword">if</span> ((event.<span class="hljs-property">offsetY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span>) &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            <span class="hljs-keyword">if</span> (currentTarget.<span class="hljs-title function_">isBegin</span>()) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span> = event.<span class="hljs-property">offsetY</span></li><li>  })</li><li>)</li></ol></pre></div></div></li>      <li>       <p>代码完整示例。</p>       <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">FatherControlChild</span> {</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-attr">scroller2</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">childRecognizer</span>: <span class="hljs-title class_">GestureRecognizer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GestureRecognizer</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentRecognizer</span>: <span class="hljs-title class_">GestureRecognizer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GestureRecognizer</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">lastOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">TopStart</span> }) {</li><li>      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) { <span class="hljs-comment">// 外部滚动容器</span></li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Scroll Area"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>          <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller2</span>) { <span class="hljs-comment">// 内部滚动容器</span></li><li>            <span class="hljs-title class_">Column</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Scroll Area2"</span>)</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>                .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>                  <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>                    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>                    .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>                    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>                    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>                }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>              }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            }</li><li>          }</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">"inner"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">800</span>)</li><li>        }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">"outer"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">600</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>) <span class="hljs-comment">// 滚动方向纵向</span></li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>) <span class="hljs-comment">// 滚动条常驻显示</span></li><li>      .<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>) <span class="hljs-comment">// 滚动条颜色</span></li><li>      .<span class="hljs-title function_">scrollBarWidth</span>(<span class="hljs-number">10</span>) <span class="hljs-comment">// 滚动条宽度</span></li><li>      .<span class="hljs-title function_">edgeEffect</span>(<span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-property">None</span>)</li><li>      .<span class="hljs-title function_">shouldBuiltInRecognizerParallelWith</span>(<span class="hljs-function">(<span class="hljs-params">current: GestureRecognizer, others: <span class="hljs-built_in">Array</span>&lt;GestureRecognizer&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; others.<span class="hljs-property">length</span>; i++) {</li><li>          <span class="hljs-keyword">let</span> target = others[i].<span class="hljs-title function_">getEventTargetInfo</span>();</li><li>          <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"inner"</span> &amp;&amp; others[i].<span class="hljs-title function_">isBuiltIn</span>() &amp;&amp;</li><li>            others[i].<span class="hljs-title function_">getType</span>() == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">PAN_GESTURE</span>) { <span class="hljs-comment">// 找到将要组成并行手势的识别器</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span> = current; <span class="hljs-comment">// 保存当前组件的识别器</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span> = others[i]; <span class="hljs-comment">// 保存将要组成并行手势的识别器</span></li><li>            <span class="hljs-keyword">return</span> others[i]; <span class="hljs-comment">// 返回和当前手势将要组成并行手势的识别器</span></li><li>          }</li><li>        }</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>      })</li><li>      .<span class="hljs-title function_">onGestureRecognizerJudgeBegin</span>(<span class="hljs-function">(<span class="hljs-params">event: BaseGestureEvent, current: GestureRecognizer,</span></span></li><li><span class="hljs-function">        others: <span class="hljs-built_in">Array</span>&lt;GestureRecognizer&gt;</span>) =&gt; { <span class="hljs-comment">// 在识别器即将要成功时，根据当前组件状态，设置识别器使能状态</span></li><li>        <span class="hljs-keyword">let</span> target = current.<span class="hljs-title function_">getEventTargetInfo</span>();</li><li>        <span class="hljs-keyword">if</span> (target &amp;&amp; target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"outer"</span> &amp;&amp; current.<span class="hljs-title function_">isBuiltIn</span>() &amp;&amp;</li><li>          current.<span class="hljs-title function_">getType</span>() == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">PAN_GESTURE</span>) {</li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; others.<span class="hljs-property">length</span>; i++) {</li><li>            <span class="hljs-keyword">let</span> target = others[i].<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>            <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span> &amp;&amp; target.<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"inner"</span>) { <span class="hljs-comment">// 找到响应链上对应并行的识别器</span></li><li>              <span class="hljs-keyword">let</span> panEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">PanGestureEvent</span>;</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>              <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isEnd</span>()) { <span class="hljs-comment">// 根据当前组件状态以及移动方向动态控制识别器使能状态</span></li><li>                <span class="hljs-keyword">if</span> (panEvent &amp;&amp; panEvent.<span class="hljs-property">offsetY</span> &lt; <span class="hljs-number">0</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>                }</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isBegin</span>()) {</li><li>                <span class="hljs-keyword">if</span> (panEvent.<span class="hljs-property">offsetY</span> &gt; <span class="hljs-number">0</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>                }</li><li>              }</li><li>            }</li><li>          }</li><li>        }</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">GestureJudgeResult</span>.<span class="hljs-property">CONTINUE</span>;</li><li>      })</li><li>      .<span class="hljs-title function_">parallelGesture</span>( <span class="hljs-comment">// 绑定一个Pan手势作为动态控制器</span></li><li>        <span class="hljs-title class_">PanGesture</span>()</li><li>          .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>?.<span class="hljs-title function_">getState</span>() != <span class="hljs-title class_">GestureRecognizerState</span>.<span class="hljs-property">SUCCESSFUL</span> ||</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>?.<span class="hljs-title function_">getState</span>() != <span class="hljs-title class_">GestureRecognizerState</span>.<span class="hljs-property">SUCCESSFUL</span>) { <span class="hljs-comment">// 如果识别器状态不是SUCCESSFUL，则不做控制</span></li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-keyword">let</span> target = <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>            <span class="hljs-keyword">let</span> currentTarget = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">getEventTargetInfo</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ScrollableTargetInfo</span>;</li><li>            <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span> &amp;&amp; currentTarget <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ScrollableTargetInfo</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>              <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isEnd</span>()) { <span class="hljs-comment">// 在移动过程中实时根据当前组件状态，控制识别器的开闭状态</span></li><li>                <span class="hljs-keyword">if</span> ((event.<span class="hljs-property">offsetY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span>) &lt; <span class="hljs-number">0</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>                  <span class="hljs-keyword">if</span> (currentTarget.<span class="hljs-title function_">isEnd</span>()) {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>                  }</li><li>                }</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">isBegin</span>()) {</li><li>                <span class="hljs-keyword">if</span> ((event.<span class="hljs-property">offsetY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span>) &gt; <span class="hljs-number">0</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">childRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>)</li><li>                  <span class="hljs-keyword">if</span> (currentTarget.<span class="hljs-title function_">isBegin</span>()) {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>);</li><li>                  } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRecognizer</span>.<span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">true</span>);</li><li>                  }</li><li>                }</li><li>              }</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastOffset</span> = event.<span class="hljs-property">offsetY</span>;</li><li>          })</li><li>      )</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="阻止手势参与识别">阻止手势参与识别<i class="anchor-icon anchor-icon-link" anchorid="阻止手势参与识别" tips="复制节点链接"></i></h2>          <p>手势识别基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-interaction-basic-principles#触摸测试">触摸测试</a>的响应链结果进行，因此在用户按下时，通过控制响应链中手势识别器的参与状态，实现高效的动态干预手势处理。</p>     <p>从API version 20开始，可以结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-blocking-enhancement#ontouchtestdone20" target="_blank">onTouchTestDone</a>接口来阻止手势参与识别。完成触摸测试后，系统通过该接口回调返回所有手势识别器对象。应用可根据类型、组件标识或关联组件信息筛选识别器，并通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-common#preventbegin20" target="_blank">preventBegin</a>接口主动禁用特定识别器。</p>     <p>根据手势类型进行禁用：</p>     <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>  .<span class="hljs-title function_">onTouchTestDone</span>(<span class="hljs-function">(<span class="hljs-params">event, recognizers</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; recognizers.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">let</span> recognizer = recognizers[i];</li><li>      <span class="hljs-comment">// 根据类型禁用所有滑动手势</span></li><li>      <span class="hljs-keyword">if</span> (recognizer.<span class="hljs-title function_">getType</span>() == <span class="hljs-title class_">GestureControl</span>.<span class="hljs-property">GestureType</span>.<span class="hljs-property">PAN_GESTURE</span>) {</li><li>        recognizer.<span class="hljs-title function_">preventBegin</span>();</li><li>      }</li><li>    }</li><li>  })</li></ol></pre></div></div>     <p>根据手势所归属的组件禁用：</p>     <p>组件需要提前通过通用属性<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-component-id#id" target="_blank">id</a>配置组件标识。</p>     <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>  .<span class="hljs-title function_">onTouchTestDone</span>(<span class="hljs-function">(<span class="hljs-params">event, recognizers</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; recognizers.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">let</span> recognizer = recognizers[i];</li><li>      <span class="hljs-comment">// 禁用掉标识为myID的组件上的所有手势</span></li><li>      <span class="hljs-keyword">if</span> (recognizer.<span class="hljs-title function_">getEventTargetInfo</span>().<span class="hljs-title function_">getId</span>() == <span class="hljs-string">"myID"</span>) {</li><li>        recognizer.<span class="hljs-title function_">preventBegin</span>();</li><li>      }</li><li>    }</li><li>  })</li></ol></pre></div></div>     <p>根据是否系统内置手势禁用：</p>     <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>  .<span class="hljs-title function_">onTouchTestDone</span>(<span class="hljs-function">(<span class="hljs-params">event, recognizers</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; recognizers.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">let</span> recognizer = recognizers[i];</li><li>      <span class="hljs-comment">// 禁用掉所有系统内置的手势</span></li><li>      <span class="hljs-keyword">if</span> (recognizer.<span class="hljs-title function_">isBuiltIn</span>()) {</li><li>        recognizer.<span class="hljs-title function_">preventBegin</span>();</li><li>      }</li><li>    }</li><li>  })</li></ol></pre></div></div>     <p>根据具体情况组合使用这些条件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>系统由内向外执行节点上的onTouchTestDone回调。</p>      </div></div></div>     <p>在NDK中onTouchTestDone与preventBegin对应的接口分别为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-gesture-h#oh_arkui_settouchtestdonecallback" target="_blank">OH_ArkUI_SetTouchTestDoneCallback</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-gesture-h#oh_arkui_preventgesturerecognizerbegin" target="_blank">OH_ArkUI_PreventGestureRecognizerBegin</a>，它们的使用方式及功能与ArkTS接口一致。</p>     <p>以下通过一个简化的视频播放界面交互为例来说明具体的用法：</p>     <p>父容器（video_layer）绑定了多种手势：</p>     <ul>      <li>点击：控制暂停/播放。</li>      <li>双击：切换全屏。</li>      <li>长按：快进。</li>      <li>上下滑动：调节亮度。</li>      <li>左右滑动：调整进度。</li>     </ul>     <p>其内部下方的Slider组件（progress_layer）未绑定长按手势，导致用户长按Slider时会触发父容器的快进手势，不符合预期。</p>     <p>解决方案：在Slider上注册onTouchTestDone回调，通过该回调禁用非Slider组件的手势识别器，即可解决冲突。</p>     <p>以下为完整示例代码：</p>     <div _ngcontent-uey-c106="" class="highlight-div"><div _ngcontent-uey-c106="" class="highlight-div-header"><div _ngcontent-uey-c106="" class="highlight-div-header-left"><div _ngcontent-uey-c106="" class="handle-button expand-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uey-c106="" class="highlight-div-header-right"><div _ngcontent-uey-c106="" class="handle-button ai-button"></div><div _ngcontent-uey-c106="" class="handle-button line-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uey-c106="" class="handle-button theme-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uey-c106="" class="handle-button copy-button"><div _ngcontent-uey-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uey-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">progress</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">496000</span>; <span class="hljs-comment">// 初始进度，秒</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">27490000</span>; <span class="hljs-comment">// 总时长，秒</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">currentWidth</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'100%'</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">currentHeight</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'100%'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentPosX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentPosY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentFullScreenState</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">normalPlayTimer</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isPlaying</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">fastForwardTimer</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 启动一个周期性定时器每隔一秒刷新一次进度</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startNormalPlayTimer</span>();</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">startNormalPlayTimer</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">normalPlayTimer</span> != -<span class="hljs-number">1</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopNormalPlayTimer</span>()</li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">normalPlayTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> + <span class="hljs-number">1000</span></li><li>    }, <span class="hljs-number">1000</span>);</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">stopNormalPlayTimer</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">normalPlayTimer</span> == -<span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    };</li><li>    <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">normalPlayTimer</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">normalPlayTimer</span> = -<span class="hljs-number">1</span>;</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">startFastForwardTimer</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">fastForwardTimer</span> != -<span class="hljs-number">1</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopFastForwardTimer</span>();</li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fastForwardTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> + <span class="hljs-number">100000</span>;</li><li>    }, <span class="hljs-number">100</span>);</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">stopFastForwardTimer</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">fastForwardTimer</span> == -<span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    };</li><li>    <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fastForwardTimer</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fastForwardTimer</span> = -<span class="hljs-number">1</span>;</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">showMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: message, <span class="hljs-attr">alignment</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span> });</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">resetPosInfo</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosX</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosY</span> = <span class="hljs-number">0</span>;</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">toggleFullScreenState</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFullScreenState</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFullScreenState</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFullScreenState</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentWidth</span> = <span class="hljs-string">'100%'</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHeight</span> = <span class="hljs-string">'100%'</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentWidth</span> = <span class="hljs-string">'100%'</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHeight</span> = <span class="hljs-string">'50%'</span>;</li><li>    };</li><li>    <span class="hljs-comment">//  $r('app.string.Play_full_screen') 需要替换为开发者所需的资源文件</span></li><li>    <span class="hljs-comment">//  $r('app.string.Exit_play_full_screen') 需要替换为开发者所需的资源文件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFullScreenState</span></li><li>      ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Play_full_screen'</span>).<span class="hljs-property">id</span>)</li><li>      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Exit_play_full_screen'</span>).<span class="hljs-property">id</span>));</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">togglePlayAndPause</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span>;</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopNormalPlayTimer</span>();</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-comment">// 重新启动</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startNormalPlayTimer</span>();</li><li>    };</li><li>    <span class="hljs-comment">//  $r('app.string.stop_playing') 需要替换为开发者所需的资源文件</span></li><li>    <span class="hljs-comment">//  $r('app.string.Continue_playing') 需要替换为开发者所需的资源文件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span></li><li>      ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.stop_playing'</span>).<span class="hljs-property">id</span>)</li><li>      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Continue_playing'</span>).<span class="hljs-property">id</span>));</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">doFastForward</span>(<span class="hljs-attr">start</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!start) { <span class="hljs-comment">// 停止快进，恢复正常播放</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopFastForwardTimer</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startNormalPlayTimer</span>();</li><li>      <span class="hljs-comment">//  $r('app.string.Cancel_FastForwarding') 需要替换为开发者所需的资源文件</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Cancel_FastForwarding'</span>).<span class="hljs-property">id</span>));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    };</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopNormalPlayTimer</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startFastForwardTimer</span>();</li><li>    <span class="hljs-comment">//  $r('app.string.Start_FastForwarding') 需要替换为开发者所需的资源文件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Start_FastForwarding'</span>).<span class="hljs-property">id</span>));</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">updateBrightness</span>(<span class="hljs-attr">start</span>: <span class="hljs-built_in">boolean</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">BaseGestureEvent</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> newY = event.<span class="hljs-property">fingerList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">localY</span>;</li><li>    <span class="hljs-keyword">if</span> (start) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosY</span> = newY;</li><li>      <span class="hljs-comment">//  $r('app.string.Start_adjusting_brightness') 需要替换为开发者所需的资源文件</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span></li><li>        .<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Start_adjusting_brightness'</span>).<span class="hljs-property">id</span>));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    };</li><li>    <span class="hljs-keyword">let</span> offsetY = newY - <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosY</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(offsetY) &gt; <span class="hljs-number">10</span>) {</li><li>      <span class="hljs-comment">//  $r('app.string.Reduce_brightness') 需要替换为开发者所需的资源文件</span></li><li>      <span class="hljs-comment">//  $r('app.string.Increase_brightness') 需要替换为开发者所需的资源文件</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>((offsetY &gt; <span class="hljs-number">0</span>)</li><li>        ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Reduce_brightness'</span>).<span class="hljs-property">id</span>)</li><li>        : <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Increase_brightness'</span>).<span class="hljs-property">id</span>))</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosY</span> = newY;</li><li>    };</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">updateProgress</span>(<span class="hljs-attr">start</span>: <span class="hljs-built_in">boolean</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">BaseGestureEvent</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> newX = event.<span class="hljs-property">fingerList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">localX</span>;</li><li>    <span class="hljs-keyword">if</span> (start) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosX</span> = newX;</li><li>      <span class="hljs-comment">//  $r('app.string.Adjust_schedule') 需要替换为开发者所需的资源文件</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showMessage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span></li><li>        .<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Adjust_schedule'</span>).<span class="hljs-property">id</span>));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    };</li><li>    <span class="hljs-keyword">let</span> offsetX = newX - <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosX</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> + offsetX * <span class="hljs-number">10000</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPosX</span> = newX;</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-comment">//  $r('app.string.Playback_progress') 需要替换为开发者所需的资源文件</span></li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.Playback_progress'</span>).<span class="hljs-property">id</span>) + <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>
</li><li>        <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>          <span class="hljs-title class_">Slider</span>({</li><li>            <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span>,</li><li>            <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,</li><li>            <span class="hljs-attr">max</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">total</span>,</li><li>            <span class="hljs-attr">style</span>: <span class="hljs-title class_">SliderStyle</span>.<span class="hljs-property">OutSet</span></li><li>          })</li><li>            .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span>, mode: SliderChangeMode</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">progress</span> = value;</li><li>            })</li><li>            .<span class="hljs-title function_">id</span>(<span class="hljs-string">'progress_layer'</span>)</li><li>            .<span class="hljs-title function_">onTouchTestDone</span>(<span class="hljs-function">(<span class="hljs-params">event, allRecognizers: <span class="hljs-built_in">Array</span>&lt;GestureRecognizer&gt;</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; allRecognizers.<span class="hljs-property">length</span>; i++) {</li><li>                <span class="hljs-keyword">let</span> recognizer = allRecognizers[i];</li><li>                <span class="hljs-keyword">let</span> inspectorInfo = recognizer.<span class="hljs-title function_">getEventTargetInfo</span>().<span class="hljs-title function_">getId</span>();</li><li>                <span class="hljs-keyword">if</span> (inspectorInfo !== <span class="hljs-string">'progress_layer'</span>) {</li><li>                  <span class="hljs-comment">// 用户操作到进度条区域时，禁用掉所有非progress_layer上的手势</span></li><li>                  recognizer.<span class="hljs-title function_">preventBegin</span>();</li><li>                };</li><li>              };</li><li>            })</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">5</span> })</li><li>            .<span class="hljs-title function_">trackColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>            .<span class="hljs-title function_">blockColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>            .<span class="hljs-title function_">selectedColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>            .<span class="hljs-title function_">trackThickness</span>(<span class="hljs-number">2</span>)</li><li>            .<span class="hljs-title function_">flexShrink</span>(<span class="hljs-number">1</span>)</li><li>            .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">flexShrink</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'id_progress_view'</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">id</span>(<span class="hljs-string">'video_layer'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#E0E0E0'</span>)</li><li>    .<span class="hljs-title function_">gesture</span>(</li><li>      <span class="hljs-title class_">GestureGroup</span>(<span class="hljs-title class_">GestureMode</span>.<span class="hljs-property">Exclusive</span>,</li><li>        <span class="hljs-title class_">PanGesture</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">PanDirection</span>.<span class="hljs-property">Vertical</span>, <span class="hljs-attr">distance</span>: <span class="hljs-number">10</span> })</li><li>          .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'pan_for_brightness_control'</span>)</li><li>          .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateBrightness</span>(<span class="hljs-literal">true</span>, event);</li><li>          })</li><li>          .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateBrightness</span>(<span class="hljs-literal">false</span>, event);</li><li>          }),</li><li>        <span class="hljs-title class_">PanGesture</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">PanDirection</span>.<span class="hljs-property">Horizontal</span>, <span class="hljs-attr">distance</span>: <span class="hljs-number">10</span> })</li><li>          .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'pan_for_play_progress_control'</span>)</li><li>          .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProgress</span>(<span class="hljs-literal">true</span>, event);</li><li>          })</li><li>          .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProgress</span>(<span class="hljs-literal">false</span>, event);</li><li>          }),</li><li>
</li><li>        <span class="hljs-title class_">LongPressGesture</span>()</li><li>          .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'long_press_for_fast_forward_control'</span>)</li><li>          .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doFastForward</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 开始快进</span></li><li>          })</li><li>          .<span class="hljs-title function_">onActionEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doFastForward</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 停止快进</span></li><li>          })</li><li>          .<span class="hljs-title function_">onActionCancel</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doFastForward</span>(<span class="hljs-literal">false</span>);</li><li>          }),</li><li>
</li><li>        <span class="hljs-title class_">TapGesture</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> })</li><li>          .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'double_tap_on_video'</span>)</li><li>          .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleFullScreenState</span>();</li><li>          }),</li><li>
</li><li>        <span class="hljs-title class_">TapGesture</span>()</li><li>          .<span class="hljs-title function_">tag</span>(<span class="hljs-string">'single_tap_on_video'</span>)</li><li>          .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">togglePlayAndPause</span>();</li><li>          })</li><li>      )</li><li>    )</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentWidth</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentHeight</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="697" originwidth="353" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114939.40558960351348245543694851799409:50001231000000:2800:458F2A0B3025E522D5F69610E1FEFC74C138B5BE027E64E7CBB09B834C4C4074.gif" width="353" height="697"></span></p>    </div>   </div>   <div></div></div>