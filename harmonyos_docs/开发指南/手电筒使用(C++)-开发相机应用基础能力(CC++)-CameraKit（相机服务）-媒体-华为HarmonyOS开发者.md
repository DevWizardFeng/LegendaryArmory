<h1 _ngcontent-mqh-c119="" class="doc-title ng-star-inserted" title="手电筒使用(C++)"> 手电筒使用(C++) </h1>

<div _ngcontent-mqh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>通过操作设备启用手电筒功能，可使设备的手电筒保持常亮状态。</p>    <p>在使用相机应用并操作手电筒功能时，存在以下几种情况说明：</p>    <ul>     <li>当使用后置相机并设置闪光灯模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-h#camera_flashmode" target="_blank">Camera_FlashMode</a>关闭时，手电筒功能无法启用。</li>     <li>当使用前置相机时，手电筒可以正常启用并保持常亮状态。</li>     <li>从前置相机切换至后置相机时，如果手电筒原本处于开启状态，它将会被自动关闭。</li>    </ul>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入NDK接口。选择系统提供的NDK接口能力，导入NDK接口的方法如下。</p>       <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入NDK接口头文件。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_input.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/capture_session.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_manager.h"</span></span></li></ol></pre></div></div></li>      <li>       <p>在CMake脚本中链接相关动态库。</p>       <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC</li><li>    libace_napi.z.so</li><li>    libohcamera.so</li><li>    libhilog_ndk.z.so</li><li>)</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_istorchsupported" target="_blank">OH_CameraManager_IsTorchSupported()</a>方法，检测当前设备是否支持手电筒。</p>       <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">IsTorchSupported</span><span class="hljs-params">(Camera_Manager* cameraManager)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 判断设备是否支持手电筒模式。</span></li><li>    <span class="hljs-type">bool</span> isTorchSupported = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">if</span> (cameraManager == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"cameraManager is nullptr."</span>);</li><li>        <span class="hljs-keyword">return</span> isTorchSupported;</li><li>    }</li><li>    Camera_ErrorCode ret = <span class="hljs-built_in">OH_CameraManager_IsTorchSupported</span>(cameraManager, &amp;isTorchSupported);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_IsTorchSupported failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isTorchSupported) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"isTorchSupported success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"isTorchSupported failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> isTorchSupported;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_istorchsupportedbytorchmode" target="_blank">OH_CameraManager_IsTorchSupportedByTorchMode()</a>方法，检测当前设备是否支持指定的手电筒模式。</p>       <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">IsTorchSupportedByTorchMode</span><span class="hljs-params">(Camera_Manager* cameraManager, Camera_TorchMode torchMode)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">bool</span> torchModeSupported = <span class="hljs-literal">false</span>;</li><li>    Camera_ErrorCode ret = <span class="hljs-built_in">OH_CameraManager_IsTorchSupportedByTorchMode</span>(cameraManager, torchMode, &amp;torchModeSupported);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>         <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_IsTorchSupported failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (torchModeSupported) {</li><li>         <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"isTorchModeSupported success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>         <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"isTorchModeSupported failed. %{public}d "</span>, ret);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> torchModeSupported;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_settorchmode" target="_blank">OH_CameraManager_SetTorchMode()</a>方法，设置当前设备的手电筒模式。</p>       <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li>Camera_ErrorCode <span class="hljs-title function_">SetTorchMode</span><span class="hljs-params">(Camera_Manager* cameraManager, Camera_TorchMode torchMode)</span></li><li>{</li><li>    <span class="hljs-comment">// 在torchMode支持的情况下进行设置手电筒模式。</span></li><li>    <span class="hljs-type">Camera_ErrorCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_CameraManager_SetTorchMode(cameraManager, torchMode);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"OH_CameraManager_SetTorchMode failed. %{public}d "</span>, ret);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        OH_LOG_INFO(LOG_APP, <span class="hljs-string">"OH_CameraManager_SetTorchMode success."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听手电筒状态，包括手电筒打开、手电筒关闭、手电筒不可用、手电筒恢复可用。手电筒状态发生变化，可通过回调函数获取状态的变化。</p>     <p>注册torchStatus事件，回调会返回监听结果，callback返回Camera_TorchStatusInfo参数，参数的具体内容可参考相机管理器回调接口实例<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-torchstatusinfo" target="_blank">Camera_TorchStatusInfo</a>。</p>     <div _ngcontent-mqh-c106="" class="highlight-div"><div _ngcontent-mqh-c106="" class="highlight-div-header"><div _ngcontent-mqh-c106="" class="highlight-div-header-left"><div _ngcontent-mqh-c106="" class="handle-button expand-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mqh-c106="" class="highlight-div-header-right"><div _ngcontent-mqh-c106="" class="handle-button ai-button"></div><div _ngcontent-mqh-c106="" class="handle-button line-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mqh-c106="" class="handle-button theme-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mqh-c106="" class="handle-button copy-button"><div _ngcontent-mqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mqh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">void</span> <span class="hljs-title function_">TorchStatusCallback</span><span class="hljs-params">(Camera_Manager *cameraManager, Camera_TorchStatusInfo* torchStatus)</span></li><li>{</li><li>   OH_LOG_INFO(LOG_APP, <span class="hljs-string">"TorchStatusCallback is called."</span>);</li><li>}</li><li>Camera_ErrorCode <span class="hljs-title function_">RegisterTorchStatusCallback</span><span class="hljs-params">(Camera_Manager *cameraManager)</span></li><li>{</li><li>    <span class="hljs-type">Camera_ErrorCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_CameraManager_RegisterTorchStatusCallback(cameraManager, TorchStatusCallback);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>       OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"OH_CameraManager_RegisterTorchStatusCallback failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>