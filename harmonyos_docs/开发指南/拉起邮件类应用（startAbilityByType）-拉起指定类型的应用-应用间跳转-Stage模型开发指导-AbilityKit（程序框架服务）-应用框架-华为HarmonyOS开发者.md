<h1 _ngcontent-oym-c119="" class="doc-title ng-star-inserted" title="拉起邮件类应用（startAbilityByType）"> 拉起邮件类应用（startAbilityByType） </h1>

<div _ngcontent-oym-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本章节介绍如何拉起邮件类应用扩展面板。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>如果拉起方的参数为mailto协议字符串，可以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/start-email-apps-by-mailto">使用mailto方式拉起邮件应用</a>。邮件应用会解析收到的mailto协议字符串，并填充发件人、收件人、邮件内容等信息。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="邮件类应用扩展面板参数说明">邮件类应用扩展面板参数说明<i class="anchor-icon anchor-icon-link" anchorid="邮件类应用扩展面板参数说明" tips="复制节点链接"></i></h2>          <p>startAbilityByType接口中type字段为mail，对应的wantParam参数：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">email</td>         <td class="cellrowborder" valign="top" width="25%">string[ ]</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">收件人邮箱地址（支持多个且以逗号分隔）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">cc</td>         <td class="cellrowborder" valign="top" width="25%">string[ ]</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">抄收人邮箱地址（支持多个且以逗号分隔）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">bcc</td>         <td class="cellrowborder" valign="top" width="25%">string[ ]</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">密送人邮箱地址（支持多个且以逗号分隔）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">subject</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">邮件主题。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">body</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">邮件内容。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ability.params.stream</td>         <td class="cellrowborder" valign="top" width="25%">string[ ]</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">邮件附件（附件的uri地址列表）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ability.want.params.uriPermissionFlag</td>         <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-wantconstant#flags" target="_blank">wantConstant.Flags</a></td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">给邮件附件赋予至少读权限。邮件附件参数存在时，该参数也必须要传。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">sceneType</td>         <td class="cellrowborder" valign="top" width="25%">number</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">意图场景，表明本次请求对应的操作意图。1：发邮件。默认为1。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>邮件类应用扩展面板中的类型为string的参数，都要经过encodeURI编码。</p></li>        <li>         <p>邮件类应用扩展面板中的类型为string[]的参数，数组中的元素都要经过encodeURI编码。</p></li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="拉起方开发步骤">拉起方开发步骤<i class="anchor-icon anchor-icon-link" anchorid="拉起方开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入相关模块。</p>       <div _ngcontent-oym-c106="" class="highlight-div"><div _ngcontent-oym-c106="" class="highlight-div-header"><div _ngcontent-oym-c106="" class="highlight-div-header-left"><div _ngcontent-oym-c106="" class="handle-button expand-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oym-c106="" class="highlight-div-header-right"><div _ngcontent-oym-c106="" class="handle-button ai-button"></div><div _ngcontent-oym-c106="" class="handle-button line-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oym-c106="" class="handle-button theme-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oym-c106="" class="handle-button copy-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oym-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, wantConstant } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>构造接口参数并调用startAbilityByType接口。</p>       <div _ngcontent-oym-c106="" class="highlight-div"><div _ngcontent-oym-c106="" class="highlight-div-header"><div _ngcontent-oym-c106="" class="highlight-div-header-left"><div _ngcontent-oym-c106="" class="handle-button expand-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oym-c106="" class="highlight-div-header-right"><div _ngcontent-oym-c106="" class="handle-button ai-button"></div><div _ngcontent-oym-c106="" class="handle-button line-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oym-c106="" class="handle-button theme-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oym-c106="" class="handle-button copy-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oym-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>    <span class="hljs-meta">@State</span> <span class="hljs-attr">hideAbility</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hideAbility'</span></li><li>
</li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hideAbility</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>                    .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>                    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>                        <span class="hljs-keyword">let</span> <span class="hljs-attr">wantParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {</li><li>                            <span class="hljs-string">'sceneType'</span>: <span class="hljs-number">1</span>,</li><li>                            <span class="hljs-string">'email'</span>: [<span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>), <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>)], <span class="hljs-comment">// 收件人邮箱地址，多值以逗号分隔，对数组内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'cc'</span>: [<span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>), <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>)], <span class="hljs-comment">// 抄收人邮箱地址，多值以逗号分隔，对数组内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'bcc'</span>: [<span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>), <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'xxx@example.com'</span>)], <span class="hljs-comment">// 密送人邮箱地址，多值以逗号分隔，对数组内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'subject'</span>: <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'邮件主题'</span>), <span class="hljs-comment">// 邮件主题，对内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'body'</span>: <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'邮件正文'</span>), <span class="hljs-comment">// 邮件正文，对内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'ability.params.stream'</span>: [<span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'附件uri1'</span>), <span class="hljs-built_in">encodeURI</span>(<span class="hljs-string">'附件uri2'</span>)], <span class="hljs-comment">// 附件uri，多值以逗号分隔，对数组内容使用encodeURI()方法进行url编码</span></li><li>                            <span class="hljs-string">'ability.want.params.uriPermissionFlag'</span>: wantConstant.<span class="hljs-property">Flags</span>.<span class="hljs-property">FLAG_AUTH_READ_URI_PERMISSION</span></li><li>                        };</li><li>                        <span class="hljs-keyword">let</span> <span class="hljs-attr">abilityStartCallback</span>: common.<span class="hljs-property">AbilityStartCallback</span> = {</li><li>                            <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">code: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span>, message: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onError code <span class="hljs-subst">${code}</span> name: <span class="hljs-subst">${name}</span> message: <span class="hljs-subst">${message}</span>`</span>);</li><li>                            },</li><li>                            <span class="hljs-attr">onResult</span>: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>                                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onResult result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>                            }</li><li>                        }</li><li>
</li><li>                        context.<span class="hljs-title function_">startAbilityByType</span>(<span class="hljs-string">"mail"</span>, wantParam, abilityStartCallback,</li><li>                            <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>                                <span class="hljs-keyword">if</span> (err) {</li><li>                                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`startAbilityByType fail, err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>                                } <span class="hljs-keyword">else</span> {</li><li>                                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success`</span>);</li><li>                                }</li><li>                            });</li><li>                    });</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>}</li></ol></pre></div></div>       <p>效果示例图：</p>       <p><span><img originheight="726" originwidth="328" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114921.97776017389668593683133762915482:50001231000000:2800:68E6C7445E486DB30B80FF75C809ECB1B8CBBE07ABC791A953EE651BB364E22C.png" width="328" height="726"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="目标方开发步骤">目标方开发步骤<i class="anchor-icon anchor-icon-link" anchorid="目标方开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>在module.json5中新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#skills标签">linkFeature</a>属性并设置声明当前应用支持的特性功能，从而系统可以从设备已安装应用中找到当前支持该特性的应用，取值范围如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.2.1.3.1.1" valign="top" width="50%">取值</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.2.1.3.1.2" valign="top" width="50%">含义</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">ComposeMail</td>           <td class="cellrowborder" valign="top" width="50%">声明应用支持撰写邮件功能</td>          </tr>                 </tbody></table></div>       </div>       <div _ngcontent-oym-c106="" class="highlight-div"><div _ngcontent-oym-c106="" class="highlight-div-header"><div _ngcontent-oym-c106="" class="highlight-div-header-left"><div _ngcontent-oym-c106="" class="handle-button expand-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oym-c106="" class="highlight-div-header-right"><div _ngcontent-oym-c106="" class="handle-button ai-button"></div><div _ngcontent-oym-c106="" class="handle-button line-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oym-c106="" class="handle-button theme-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oym-c106="" class="handle-button copy-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oym-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-punctuation">{</span></li><li>          <span class="hljs-attr">"uris"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>              <span class="hljs-punctuation">{</span></li><li>              <span class="hljs-attr">"scheme"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mailto"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 这里仅示意，应用需确保这里声明的uri能被外部正常拉起</span></li><li>              <span class="hljs-attr">"host"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span></li><li>              <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span></li><li>              <span class="hljs-attr">"linkFeature"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ComposeMail"</span> <span class="hljs-comment">// 声明应用支持撰写邮件功能</span></li><li>              <span class="hljs-punctuation">}</span></li><li>            <span class="hljs-punctuation">]</span></li><li>          <span class="hljs-punctuation">}</span></li><li>      <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>解析面板传过来的参数并做对应处理。</p>       <div _ngcontent-oym-c106="" class="highlight-div"><div _ngcontent-oym-c106="" class="highlight-div-header"><div _ngcontent-oym-c106="" class="highlight-div-header-left"><div _ngcontent-oym-c106="" class="handle-button expand-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oym-c106="" class="highlight-div-header-right"><div _ngcontent-oym-c106="" class="handle-button ai-button"></div><div _ngcontent-oym-c106="" class="handle-button line-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oym-c106="" class="handle-button theme-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oym-c106="" class="handle-button copy-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oym-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">UIAbility</span>.<span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span></li></ol></pre></div></div>       <p>在参数<strong>want.parameters</strong>中会携带Caller方传入的参数（与调用方传入的有些差异），如下表所示：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.4.1.5.1.1" valign="top" width="25%">参数名</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.4.1.5.1.2" valign="top" width="25%">类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.4.1.5.1.3" valign="top" width="25%">必填</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.4.1.5.1.4" valign="top" width="25%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="25%">email</td>           <td class="cellrowborder" valign="top" width="25%">string[ ]</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">收件人邮箱地址（支持多个且以逗号分隔）。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">cc</td>           <td class="cellrowborder" valign="top" width="25%">string[ ]</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">抄收人邮箱地址（支持多个且以逗号分隔）。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">bcc</td>           <td class="cellrowborder" valign="top" width="25%">string[ ]</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">密送人邮箱地址（支持多个且以逗号分隔）。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">subject</td>           <td class="cellrowborder" valign="top" width="25%">string</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">邮件主题。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">body</td>           <td class="cellrowborder" valign="top" width="25%">string</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">邮件内容。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">stream</td>           <td class="cellrowborder" valign="top" width="25%">string[ ]</td>           <td class="cellrowborder" valign="top" width="25%">否</td>           <td class="cellrowborder" valign="top" width="25%">邮件附件列表（附件的uri地址列表）。</td>          </tr>                 </tbody></table></div>       </div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>           <p>目标方接收的类型为string的参数，都要经过decodeURI解码。</p></li>          <li>           <p>目标方接收的类型为string[]的参数，数组中的元素都要经过decodeURI解码。</p></li>         </ul>        </div></div></div></li>     </ol>     <p><strong>完整示例：</strong></p>     <div _ngcontent-oym-c106="" class="highlight-div"><div _ngcontent-oym-c106="" class="highlight-div-header"><div _ngcontent-oym-c106="" class="highlight-div-header-left"><div _ngcontent-oym-c106="" class="handle-button expand-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oym-c106="" class="highlight-div-header-right"><div _ngcontent-oym-c106="" class="handle-button ai-button"></div><div _ngcontent-oym-c106="" class="handle-button line-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oym-c106="" class="handle-button theme-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oym-c106="" class="handle-button copy-button"><div _ngcontent-oym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oym-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'MailTarget1.EntryAbility'</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>    <span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-attr">cc</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-attr">bcc</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-attr">subject</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-attr">body</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-attr">stream</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">undefined</span>;</li><li>    </li><li>    <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onCreate, want=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(want)}</span>`</span>);</li><li>        <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">onCreate</span>(want, launchParam);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseWant</span>(want);</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onNewWant</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onNewWant, want=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(want)}</span>`</span>);</li><li>        <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">onNewWant</span>(want, launchParam);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseWant</span>(want);</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'windowStage is null'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">terminateSelf</span>();</li><li>            <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadPage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">parseWant</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">void</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decodeStringArr</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">email</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[]);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cc</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decodeStringArr</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">cc</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[]);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">bcc</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decodeStringArr</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">bcc</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[]);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">subject</span> = <span class="hljs-built_in">decodeURI</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">subject</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);<span class="hljs-comment">// 使用decodeURI()方法对邮件主题进行url解码，其他字段处理方法相同</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">body</span> = <span class="hljs-built_in">decodeURI</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">body</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);<span class="hljs-comment">// 使用decodeURI()方法对邮件内容进行url解码，其他字段处理方法相同</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stream</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">decodeStringArr</span>(want.<span class="hljs-property">parameters</span>?.<span class="hljs-property">stream</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[]);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 使用decodeURI()方法对string数组内容进行解码</span></li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">decodeStringArr</span>(<span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">string</span>[] {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">target</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>        source?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {</li><li>            target.<span class="hljs-title function_">push</span>(<span class="hljs-built_in">decodeURI</span>(e));</li><li>        })</li><li>        <span class="hljs-keyword">return</span> target;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">loadPage</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>({</li><li>            <span class="hljs-string">"email"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span>,</li><li>            <span class="hljs-string">"cc"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cc</span>,</li><li>            <span class="hljs-string">"bcc"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bcc</span>,</li><li>            <span class="hljs-string">"subject"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">subject</span>,</li><li>            <span class="hljs-string">"body"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">body</span>,</li><li>            <span class="hljs-string">"stream"</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">stream</span></li><li>        } <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;);</li><li>
</li><li>        windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/ComposeMailPage'</span>, storage);</li><li>
</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onDestroy`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageCreate`</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span> = windowStage;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadPage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onWindowStageDestroy`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onForeground`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onBackground`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>