<h1 _ngcontent-ydv-c119="" class="doc-title ng-star-inserted" title="拍照(ArkTS)"> 拍照(ArkTS) </h1>

<div _ngcontent-ydv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>拍照是相机的最重要功能之一，拍照模块基于相机复杂的逻辑，为了保证用户拍出的照片质量，在中间步骤可以设置分辨率、闪光灯、焦距、照片质量及旋转角度等信息。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入image接口。创建拍照输出流的SurfaceId以及拍照输出的数据，都需要用到系统提供的image接口能力，导入image接口的方法如下。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建拍照输出流。</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>中的photoProfiles属性，可获取当前设备支持的拍照输出流，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createphotooutput11" target="_blank">createPhotoOutput</a>方法传入支持的某一个输出流及步骤一获取的SurfaceId创建拍照输出流。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoOutput</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraOutputCapability: camera.CameraOutputCapability</span>): camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoProfilesArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = cameraOutputCapability.<span class="hljs-property">photoProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (!photoProfilesArray || photoProfilesArray.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"photoProfilesArray is null or []"</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOutput</span>: camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>(photoProfilesArray[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPhotoOutput. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> photoOutput;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>设置拍照photoAvailable的回调，并将拍照的buffer保存为图片。</p>       <p>Context获取方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>       <p>如需要在图库中看到所保存的图片、视频资源，需要将其保存到媒体库，保存方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-savebutton">保存媒体库资源</a>。</p>       <p>需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#onphotoavailable11" target="_blank">photoOutput.on('photoAvailable')</a>接口获取到buffer时，将buffer在安全控件中保存到媒体库。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setPhotoOutputCb</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>) {</li><li><span class="hljs-comment">// 设置回调之后，调用photoOutput的capture方法，就会将拍照的buffer回传到回调中。</span></li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAvailable'</span>, (<span class="hljs-attr">errCode</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">photo</span>: camera.<span class="hljs-property">Photo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getPhoto start'</span>);</li><li>     <span class="hljs-keyword">if</span> (errCode || photo === <span class="hljs-literal">undefined</span>) {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getPhoto failed, err: ${errCode}'</span>);</li><li>       <span class="hljs-keyword">return</span>;</li><li>     }</li><li>     <span class="hljs-keyword">let</span> <span class="hljs-attr">imageObj</span>: image.<span class="hljs-property">Image</span> = photo.<span class="hljs-property">main</span>;</li><li>     imageObj.<span class="hljs-title function_">getComponent</span>(image.<span class="hljs-property">ComponentType</span>.<span class="hljs-property">JPEG</span>, (<span class="hljs-attr">errCode</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">component</span>: image.<span class="hljs-property">Component</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getComponent start'</span>);</li><li>       <span class="hljs-keyword">if</span> (errCode || component === <span class="hljs-literal">undefined</span>) {</li><li>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getComponent failed'</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>       }</li><li>       <span class="hljs-keyword">let</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span>;</li><li>       <span class="hljs-keyword">if</span> (component.<span class="hljs-property">byteBuffer</span>) {</li><li>         buffer = component.<span class="hljs-property">byteBuffer</span>;</li><li>       } <span class="hljs-keyword">else</span> {</li><li>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'byteBuffer is null'</span>);</li><li>         <span class="hljs-keyword">return</span>;</li><li>       }</li><li>       <span class="hljs-comment">// 如需要在图库中看到所保存的图片、视频资源，请使用用户无感的安全控件创建媒体资源。</span></li><li>
</li><li>      <span class="hljs-comment">// buffer处理结束后需要释放该资源，如果未正确释放资源会导致后续拍照获取不到buffer。</span></li><li>      imageObj.<span class="hljs-title function_">release</span>();</li><li>    });</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>参数配置。</p>       <p>配置相机的参数可以调整拍照的一些功能，包括闪光灯、变焦、焦距等。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">configuringSession</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// 判断设备是否支持闪光灯。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">flashStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    flashStatus = photoSession.<span class="hljs-title function_">hasFlash</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to hasFlash. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Returned with the flash light support status: <span class="hljs-subst">${flashStatus}</span>`</span>);</li><li>  <span class="hljs-keyword">if</span> (flashStatus) {</li><li>    <span class="hljs-comment">// 判断是否支持自动闪光灯模式。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">flashModeStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      flashModeStatus = photoSession?.<span class="hljs-title function_">isFlashModeSupported</span>(camera.<span class="hljs-property">FlashMode</span>.<span class="hljs-property">FLASH_MODE_AUTO</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to check whether the flash mode is supported. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (flashModeStatus) {</li><li>      <span class="hljs-comment">// 设置自动闪光灯模式。</span></li><li>      <span class="hljs-keyword">try</span> {</li><li>        photoSession?.<span class="hljs-title function_">setFlashMode</span>(camera.<span class="hljs-property">FlashMode</span>.<span class="hljs-property">FLASH_MODE_AUTO</span>);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set the flash mode. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// 判断是否支持连续自动变焦模式。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">focusModeStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    focusModeStatus = photoSession?.<span class="hljs-title function_">isFocusModeSupported</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_CONTINUOUS_AUTO</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to check whether the focus mode is supported. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (focusModeStatus) {</li><li>    <span class="hljs-comment">// 设置连续自动变焦模式。</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>      photoSession?.<span class="hljs-title function_">setFocusMode</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_CONTINUOUS_AUTO</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set the focus mode. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// 获取相机支持的可变焦距比范围。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">zoomRatioRange</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-keyword">try</span> {</li><li>    zoomRatioRange = photoSession?.<span class="hljs-title function_">getZoomRatioRange</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get the zoom ratio range. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (zoomRatioRange.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span> ) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 设置可变焦距比。</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession?.<span class="hljs-title function_">setZoomRatio</span>(zoomRatioRange[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set the zoom ratio value. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>触发拍照。</p>       <p>通过photoOutput的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#capture-2" target="_blank">capture</a>方法，执行拍照任务。该方法有两个参数，第一个参数为拍照设置参数的setting，setting中可以设置照片的质量和旋转角度，第二参数为回调函数。</p>       <p>获取拍照旋转角度的方法为，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput" target="_blank">PhotoOutput</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#getphotorotation12" target="_blank">getPhotoRotation</a>方法获取rotation实际的值。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>图片地理位置信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagergetcurrentlocation" target="_blank">Location</a>，使用方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#capture-3" target="_blank">capture</a>示例。</p>        </div></div></div>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">capture</span>(<span class="hljs-params">captureLocation: camera.Location, photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">settings</span>: camera.<span class="hljs-property">PhotoCaptureSetting</span> = {</li><li>    <span class="hljs-attr">quality</span>: camera.<span class="hljs-property">QualityLevel</span>.<span class="hljs-property">QUALITY_LEVEL_HIGH</span>,  <span class="hljs-comment">// 设置图片质量高。</span></li><li>    <span class="hljs-attr">rotation</span>: camera.<span class="hljs-property">ImageRotation</span>.<span class="hljs-property">ROTATION_0</span>,  <span class="hljs-comment">// 设置图片旋转角度的camera.ImageRotation.ROTATION_0是通过说明中获取拍照角度的getPhotoRotation方法获取的值进行设置。</span></li><li>    <span class="hljs-attr">location</span>: captureLocation,  <span class="hljs-comment">// 设置图片地理位置。</span></li><li>    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment">// 设置镜像使能开关(默认关)。</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput.<span class="hljs-title function_">capture</span>(settings, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to capture the photo. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Callback invoked to indicate the photo capture request success.'</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`capture call failed. error: <span class="hljs-subst">${error}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听拍照输出流状态，包括拍照流开始、拍照帧的开始与结束、拍照输出流的错误。</p>     <ul>      <li>       <p>通过注册固定的captureStart回调函数获取监听拍照开始结果，photoOutput创建成功时即可监听，相机设备已经准备开始这次拍照时触发，该事件返回此次拍照的captureId。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureStart</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureStartWithInfo'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, captureStartInfo: camera.CaptureStartInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture started, captureId : <span class="hljs-subst">${captureStartInfo.captureId}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的captureEnd回调函数获取监听拍照结束结果，photoOutput创建成功时即可监听，该事件返回结果为拍照完全结束后的相关信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#captureendinfo" target="_blank">CaptureEndInfo</a>。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureEnd</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureEnd'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, captureEndInfo: camera.CaptureEndInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture end, captureId : <span class="hljs-subst">${captureEndInfo.captureId}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`frameCount : <span class="hljs-subst">${captureEndInfo.frameCount}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的captureReady回调函数获取监听可拍下一张结果，photoOutput创建成功时即可监听，当下一张可拍时触发，该事件返回结果为下一张可拍的相关信息。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureReady</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureReady'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture ready`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的error回调函数获取监听拍照输出流的错误结果。回调返回拍照输出接口使用错误时的对应错误码，错误码类型参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#cameraerrorcode" target="_blank">Camera错误码</a>。</p>       <div _ngcontent-ydv-c106="" class="highlight-div"><div _ngcontent-ydv-c106="" class="highlight-div-header"><div _ngcontent-ydv-c106="" class="highlight-div-header-left"><div _ngcontent-ydv-c106="" class="handle-button expand-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydv-c106="" class="highlight-div-header-right"><div _ngcontent-ydv-c106="" class="handle-button ai-button"></div><div _ngcontent-ydv-c106="" class="handle-button line-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydv-c106="" class="handle-button theme-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydv-c106="" class="handle-button copy-button"><div _ngcontent-ydv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputError</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Photo output error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>