<h1 _ngcontent-kfr-c119="" class="doc-title ng-star-inserted" title="拖拽事件"> 拖拽事件 </h1>

<div _ngcontent-kfr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkUI开发框架针对拖拽事件提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_PRE_DRAG</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DRAG_START</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DROP</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DRAG_ENTER</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DRAG_MOVE</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DRAG_LEAVE</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_DRAG_END</a>等组件事件，当拖拽在不同的阶段时会触发对应的组件事件，完成对应的数据处理操作，实现期望的拖拽交互能力。</p>    <div class="tiledSection">     <h2 id="通用拖拽">通用拖拽<i class="anchor-icon anchor-icon-link" anchorid="通用拖拽" tips="复制节点链接"></i></h2>          <p>ArkUI提供了使用C和C++开发拖拽功能的能力，开发者可调用C API实现拖拽功能。以下以Image组件为例，详细介绍C API实现拖拽功能的基本步骤，以及在开发过程中需要注意的事项。</p>     <ol>      <li>       <p>组件拖拽设置。</p>       <p>获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-h#oh_arkui_getmoduleinterface" target="_blank">Node-API</a>，创建节点等操作均需通过Node-API完成。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>ArkUI_NativeNodeAPI_1 *nodeAPI = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_ArkUI_GetModuleInterface</span>(ARKUI_NATIVE_NODE, ArkUI_NativeNodeAPI_1, nodeAPI);</li></ol></pre></div></div>       <p>创建Image节点，并设置draggable和其它相关属性。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">auto</span> image = nodeAPI-&gt;<span class="hljs-built_in">createNode</span>(ARKUI_NODE_IMAGE);</li><li>ArkUI_AttributeItem NODE_IMAGE_SRC_Item = {.string = <span class="hljs-string">"/pages/common/1111.png"</span>}; <span class="hljs-comment">// 图片存放于pages/common文件夹</span></li><li>ArkUI_NumberValue imageWidthValue[] = {<span class="hljs-number">100</span>};</li><li>ArkUI_AttributeItem imageWidthItem = {imageWidthValue, <span class="hljs-number">1</span>};</li><li>ArkUI_NumberValue imageHeightValue[] = {<span class="hljs-number">100</span>};</li><li>ArkUI_AttributeItem imageHeightItem = {imageHeightValue, <span class="hljs-number">1</span>};</li><li>ArkUI_NumberValue marginValue[] = {<span class="hljs-number">20</span>};</li><li>ArkUI_AttributeItem marginItem = {marginValue, <span class="hljs-number">1</span>};</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(image, NODE_WIDTH, &amp;imageWidthItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(image, NODE_HEIGHT, &amp;imageHeightItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(image, NODE_IMAGE_SRC, &amp;NODE_IMAGE_SRC_Item);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(image, NODE_MARGIN, &amp;marginItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEvent</span>(image, NODE_ON_DRAG_START, <span class="hljs-number">1</span>, <span class="hljs-literal">nullptr</span>);</li><li><span class="hljs-keyword">auto</span> returnValue1 = <span class="hljs-built_in">OH_ArkUI_SetNodeDraggable</span>(image, <span class="hljs-literal">true</span>);</li></ol></pre></div></div></li>      <li>       <p>自定义拖拽预览和背板图。</p>       <p>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-pixelmap-native-h#oh_pixelmapnative_createpixelmap" target="_blank">pixelMap</a>，设置pixelMap的宽高等各项属性。设置Image节点的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drag-and-drop-h#函数" target="_blank">dragPreviewOption</a>，可用于设置跟手图的圆角、角标等。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-comment">// 创建pixelMap</span></li><li>  <span class="hljs-type">uint8_t</span> data[<span class="hljs-number">960000</span>];</li><li>  <span class="hljs-type">size_t</span> dataSize = <span class="hljs-number">960000</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize; i++) {</li><li>    data[i] = i + <span class="hljs-number">1</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 创建参数结构体实例，并设置参数</span></li><li>  OH_Pixelmap_InitializationOptions *createOpts;</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_Create</span>(&amp;createOpts);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetWidth</span>(createOpts, <span class="hljs-number">400</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetHeight</span>(createOpts, <span class="hljs-number">600</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetPixelFormat</span>(createOpts, PIXEL_FORMAT_BGRA_8888);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetAlphaType</span>(createOpts, PIXELMAP_ALPHA_TYPE_UNKNOWN);</li><li>  <span class="hljs-comment">// 创建Pixelmap实例</span></li><li>  OH_PixelmapNative *pixelmap = <span class="hljs-literal">nullptr</span>;</li><li>  <span class="hljs-built_in">OH_PixelmapNative_CreatePixelmap</span>(data, dataSize, createOpts, &amp;pixelmap);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Rotate</span>(pixelmap, <span class="hljs-number">45</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Opacity</span>(pixelmap, <span class="hljs-number">0.1</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Scale</span>(pixelmap, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Translate</span>(pixelmap, <span class="hljs-number">50.0</span>, <span class="hljs-number">10.0</span>);</li><li>  <span class="hljs-built_in">OH_ArkUI_SetNodeDragPreview</span>(image, pixelmap);</li><li>  <span class="hljs-keyword">auto</span> *previewOptions = <span class="hljs-built_in">OH_ArkUI_CreateDragPreviewOption</span>();</li><li>  <span class="hljs-keyword">auto</span> returnValue2 = <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetNumberBadgeEnabled</span>(previewOptions, <span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">auto</span> returnValue3 = <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetBadgeNumber</span>(previewOptions, <span class="hljs-number">10</span>);</li><li>  <span class="hljs-keyword">auto</span> returnValue4 = <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetDefaultRadiusEnabled</span>(previewOptions, <span class="hljs-literal">true</span>);</li><li>  <span class="hljs-built_in">OH_ArkUI_SetNodeDragPreviewOption</span>(image, previewOptions);</li></ol></pre></div></div></li>      <li>       <p>设置相关事件。</p>       <p>C API的事件通过统一的回调来接收，当收到事件时通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">eventType</a>进行区分。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEventReceiver</span>([](ArkUI_NodeEvent *event) {</li><li>  <span class="hljs-keyword">auto</span> eventType = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetEventType</span>(event);</li><li>  <span class="hljs-keyword">auto</span> targetId = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetTargetId</span>(event);</li><li>  <span class="hljs-keyword">auto</span> *dragEvent = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetDragEvent</span>(event);</li><li>  <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                <span class="hljs-string">"targetId=%{public}d,eventType=%{public}d,"</span>, targetId,</li><li>                eventType);</li><li>  <span class="hljs-keyword">switch</span> (eventType) {</li><li>    <span class="hljs-keyword">case</span> NODE_ON_CLICK: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"ARKUI_NODE_BUTTON click! dragable"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_PRE_DRAG: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>, <span class="hljs-string">"NODE_ON_PRE_DRAG EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DRAG_START: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"NODE_ON_DRAG_START EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DROP: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>, <span class="hljs-string">"NODE_ON_DROP EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DRAG_ENTER: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"NODE_ON_DRAG_ENTER EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DRAG_MOVE: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"NODE_ON_DRAG_MOVE EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DRAG_LEAVE: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"NODE_ON_DRAG_LEAVE EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DRAG_END: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>, <span class="hljs-string">"NODE_ON_DRAG_END EventReceiver"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>处理NODE_ON_DRAG_START事件。</p>       <p>在NODE_ON_DRAG_START事件中，应用可以执行起拖阶段所需的操作，通常涉及处理起拖过程的数据。例如，创建UdmfRecord，将用于拖拽图片所需的数据 imageUri以fileUri类型添加到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-oh-udmfrecord" target="_blank">UdmfRecord</a>中，接着将UdmfRecord设置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-oh-udmfdata" target="_blank">udmfData</a>中，最后将UdmfData设置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-dragevent" target="_blank">DragEvent</a>中。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">case</span> NODE_ON_DRAG_START: {</li><li>  <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                <span class="hljs-string">"NODE_ON_DRAG_START EventReceiver"</span>);</li><li>  OH_UdmfRecord *record = <span class="hljs-built_in">OH_UdmfRecord_Create</span>();</li><li>  <span class="hljs-type">int</span> returnValue;</li><li>  OH_UdsFileUri *imageValue = <span class="hljs-built_in">OH_UdsFileUri_Create</span>();</li><li>  returnValue = <span class="hljs-built_in">OH_UdsFileUri_SetFileUri</span>(imageValue, <span class="hljs-string">"/pages/common/1111.png"</span>);</li><li>  returnValue = <span class="hljs-built_in">OH_UdmfRecord_AddFileUri</span>(record, imageValue);</li><li>  OH_UdmfData *data = <span class="hljs-built_in">OH_UdmfData_Create</span>();</li><li>  returnValue = <span class="hljs-built_in">OH_UdmfData_AddRecord</span>(data, record);</li><li>  returnValue = <span class="hljs-built_in">OH_ArkUI_DragEvent_SetData</span>(dragEvent, data);</li><li>  <span class="hljs-keyword">break</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>处理NODE_ON_DROP事件。</p>       <p>在NODE_ON_DROP事件中，应用可以执行与落入阶段相关的操作，通常需要获取拖拽过程中传递的数据。例如，引用&lt;database/udmf/udmf_meta.h&gt;头文件，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-oh-udmfdata" target="_blank">udmfData</a>，判断是否存在所需的数据类型，从<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-oh-udmfrecord" target="_blank">UdmfRecord</a>中提取相应的数据，最后销毁指针。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">case</span> NODE_ON_DROP: {</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                  <span class="hljs-string">"NODE_ON_DROP EventReceiver"</span>);</li><li>    <span class="hljs-comment">// 获取UDMF data</span></li><li>    <span class="hljs-type">int</span> returnValue;</li><li>    <span class="hljs-comment">// 创建OH_UdmfData对象</span></li><li>    OH_UdmfData *data = <span class="hljs-built_in">OH_UdmfData_Create</span>();</li><li>    returnValue = <span class="hljs-built_in">OH_ArkUI_DragEvent_GetUdmfData</span>(dragEvent, data);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                  <span class="hljs-string">"OH_ArkUI_DragEvent_GetUdmfData returnValue = %{public}d"</span>, returnValue);</li><li>    <span class="hljs-comment">// 判断OH_UdmfData是否有对应的类型</span></li><li>    <span class="hljs-type">bool</span> resultUdmf = <span class="hljs-built_in">OH_UdmfData_HasType</span>(data, UDMF_META_GENERAL_FILE);</li><li>    <span class="hljs-keyword">if</span> (resultUdmf) {</li><li>        <span class="hljs-comment">// 获取OH_UdmfData的记录</span></li><li>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordsCount = <span class="hljs-number">0</span>;</li><li>        OH_UdmfRecord **records = <span class="hljs-built_in">OH_UdmfData_GetRecords</span>(data, &amp;recordsCount);</li><li>        <span class="hljs-comment">// 获取records中的元素</span></li><li>        <span class="hljs-type">int</span> returnStatus;</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; recordsCount; i++) {</li><li>            <span class="hljs-comment">// 从OH_UdmfRecord中获取文件类型数据</span></li><li>            OH_UdsFileUri *imageValue = <span class="hljs-built_in">OH_UdsFileUri_Create</span>();</li><li>            returnStatus = <span class="hljs-built_in">OH_UdmfRecord_GetFileUri</span>(records[i], imageValue);</li><li>            <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fileUri = <span class="hljs-built_in">OH_UdsFileUri_GetFileUri</span>(imageValue);</li><li>            <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                          <span class="hljs-string">"dragTest OH_UdmfRecord_GetPlainText "</span></li><li>                          <span class="hljs-string">"returnStatus= %{public}d "</span></li><li>                          <span class="hljs-string">"fileUri= %{public}s"</span>,</li><li>                          returnStatus, fileUri);</li><li>            <span class="hljs-comment">// 使用结束后销毁指针</span></li><li>            <span class="hljs-built_in">OH_UdsFileUri_Destroy</span>(imageValue);</li><li>        }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"OH_UdmfData_HasType not contain UDMF_META_GENERAL_FILE"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">break</span>;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="dragaction主动发起拖拽">DragAction主动发起拖拽<i class="anchor-icon anchor-icon-link" anchorid="dragaction主动发起拖拽" tips="复制节点链接"></i></h2>          <p>除了通用拖拽以外，ArkUI还提供了使用C API实现主动发起拖拽的能力。以下以文本拖拽为例，详细介绍C-API实现主动发起拖拽的基本步骤，以及在开发过程中需要注意的事项。</p>     <ol>      <li>       <p>节点注册事件。</p>       <p>创建Button节点，设置按钮相关属性，同时需要注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">NODE_ON_TOUCH_INTERCEPT</a>事件。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// buttonTouch作为targetId，用于区分不同target的事件。</span></li><li><span class="hljs-keyword">enum</span> {</li><li>  buttonTouch</li><li>};</li><li>
</li><li>ArkUI_NativeNodeAPI_1 *nodeAPI = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_ArkUI_GetModuleInterface</span>(ARKUI_NATIVE_NODE, ArkUI_NativeNodeAPI_1, nodeAPI);</li><li><span class="hljs-keyword">auto</span> button = nodeAPI-&gt;<span class="hljs-built_in">createNode</span>(ARKUI_NODE_BUTTON);</li><li>ArkUI_AttributeItem NODE_Button_SRC_Item = {.string = <span class="hljs-string">"button"</span>};</li><li>ArkUI_NumberValue buttonWidthValue[] = {<span class="hljs-number">200</span>};</li><li>ArkUI_AttributeItem buttonWidthItem = {buttonWidthValue, <span class="hljs-number">1</span>};</li><li>ArkUI_NumberValue buttonHeightValue[] = {<span class="hljs-number">100</span>};</li><li>ArkUI_AttributeItem buttonHeightItem = {buttonHeightValue, <span class="hljs-number">1</span>};</li><li>ArkUI_NumberValue marginValue[] = {<span class="hljs-number">20</span>};</li><li>ArkUI_AttributeItem marginItem = {marginValue, <span class="hljs-number">1</span>};</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(button, NODE_WIDTH, &amp;buttonWidthItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(button, NODE_HEIGHT, &amp;buttonHeightItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(button, NODE_MARGIN, &amp;marginItem);</li><li>nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(button, NODE_BUTTON_LABEL, &amp;NODE_Button_SRC_Item);</li><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEvent</span>(button, NODE_ON_TOUCH_INTERCEPT, buttonTouch, <span class="hljs-literal">nullptr</span>);</li></ol></pre></div></div></li>      <li>       <p>接收NODE_ON_TOUCH_INTERCEPT事件。</p>       <p>DragAction主动发起拖拽需通过事件触发，在NODE_ON_TOUCH_INTERCEPT事件中执行发起拖拽所需的操作，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeevent_gettargetid" target="_blank">targetId</a>区分不同按钮触发的事件。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEventReceiver</span>([](ArkUI_NodeEvent *event) {</li><li>  <span class="hljs-keyword">auto</span> eventType = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetEventType</span>(event);</li><li>  <span class="hljs-keyword">auto</span> targetId = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetTargetId</span>(event);</li><li>  ArkUI_NodeHandle node = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetNodeHandle</span>(event);</li><li>  <span class="hljs-keyword">auto</span> *dragEvent = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetDragEvent</span>(event);</li><li>  <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                <span class="hljs-string">"targetId=%{public}d,eventType=%{public}d,"</span>, targetId,</li><li>                eventType);</li><li>  <span class="hljs-keyword">switch</span> (eventType) {</li><li>    <span class="hljs-keyword">case</span> NODE_ON_TOUCH_INTERCEPT: {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                      <span class="hljs-string">"ARKUI_NODE_BUTTON touch intercept"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">case</span> NODE_ON_DROP: {</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>, <span class="hljs-string">"NODE_ON_DROP EventReceiver"</span>);</li><li>    }</li><li>  }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>起拖阶段设置。</p>       <p>在NODE_ON_TOUCH_INTERCEPT事件中，需要对DragAction进行相关设置。为了主动发起拖拽，需要创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-pixelmap-native-h#oh_pixelmapnative_createpixelmap" target="_blank">pixelMap</a>，设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drag-and-drop-h#函数" target="_blank">dragPreviewOption</a>和跟手点，并将拖拽过程中的文本数据设置到DragAction中。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">case</span> NODE_ON_TOUCH_INTERCEPT: {</li><li>  <span class="hljs-comment">// 设置pixelMap</span></li><li>  <span class="hljs-type">uint8_t</span> data[<span class="hljs-number">960000</span>];</li><li>  <span class="hljs-type">size_t</span> dataSize = <span class="hljs-number">960000</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize; i++) {</li><li>      data[i] = i + <span class="hljs-number">1</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 创建参数结构体实例，并设置参数</span></li><li>  OH_Pixelmap_InitializationOptions *createOpts;</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_Create</span>(&amp;createOpts);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetWidth</span>(createOpts, <span class="hljs-number">200</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetHeight</span>(createOpts, <span class="hljs-number">300</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetPixelFormat</span>(createOpts, PIXEL_FORMAT_BGRA_8888);</li><li>  <span class="hljs-built_in">OH_PixelmapInitializationOptions_SetAlphaType</span>(createOpts, PIXELMAP_ALPHA_TYPE_UNKNOWN);</li><li>  <span class="hljs-comment">// 创建Pixelmap实例</span></li><li>  OH_PixelmapNative *pixelmap = <span class="hljs-literal">nullptr</span>;</li><li>  <span class="hljs-built_in">OH_PixelmapNative_CreatePixelmap</span>(data, dataSize, createOpts, &amp;pixelmap);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Rotate</span>(pixelmap, <span class="hljs-number">90.0</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Opacity</span>(pixelmap, <span class="hljs-number">0.2</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Scale</span>(pixelmap, <span class="hljs-number">0.8</span>, <span class="hljs-number">1.0</span>);</li><li>  <span class="hljs-built_in">OH_PixelmapNative_Flip</span>(pixelmap, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);</li><li>  std::vector&lt;OH_PixelmapNative *&gt; pixelVector;</li><li>  pixelVector.<span class="hljs-built_in">push_back</span>(pixelmap);</li><li>  <span class="hljs-type">int</span> returnValue;</li><li>  <span class="hljs-keyword">switch</span> (targetId) {</li><li>    <span class="hljs-keyword">case</span> buttonTouch: {</li><li>      <span class="hljs-comment">// 创建DragAction</span></li><li>      <span class="hljs-keyword">auto</span> action1 = <span class="hljs-built_in">OH_ArkUI_CreateDragActionWithNode</span>(node);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_CreateDragActionWithNode returnValue = %{public}p"</span>, action1);</li><li>      returnValue =</li><li>          <span class="hljs-built_in">OH_ArkUI_DragAction_SetPixelMaps</span>(action1, pixelVector.<span class="hljs-built_in">data</span>(), pixelVector.<span class="hljs-built_in">size</span>());</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetPixelMaps returnValue = %{public}d"</span>, returnValue);</li><li>      <span class="hljs-comment">// 设置DragPreviewOption</span></li><li>      <span class="hljs-keyword">auto</span> *previewOptions1 = <span class="hljs-built_in">OH_ArkUI_CreateDragPreviewOption</span>();</li><li>      <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetScaleMode</span>(</li><li>          previewOptions1, ArkUI_DragPreviewScaleMode::ARKUI_DRAG_PREVIEW_SCALE_DISABLED);</li><li>      <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetDefaultShadowEnabled</span>(previewOptions1, <span class="hljs-literal">true</span>);</li><li>      <span class="hljs-built_in">OH_ArkUI_DragPreviewOption_SetDefaultRadiusEnabled</span>(previewOptions1, <span class="hljs-literal">true</span>);</li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_DragAction_SetDragPreviewOption</span>(action1, previewOptions1);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetDragPreviewOption returnValue = %{public}d"</span>,</li><li>                    returnValue);</li><li>      <span class="hljs-comment">// 设置pointerId</span></li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_DragAction_SetPointerId</span>(action1, <span class="hljs-number">0</span>); <span class="hljs-comment">// -1 0 10</span></li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetPointerId returnValue = %{public}d"</span>, returnValue);</li><li>      <span class="hljs-comment">// 设置touchPoint</span></li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_DragAction_SetTouchPointX</span>(action1, <span class="hljs-number">200</span>); <span class="hljs-comment">// -1 0 200</span></li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetTouchPointX returnValue = %{public}d"</span>, returnValue);</li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_DragAction_SetTouchPointY</span>(action1, <span class="hljs-number">200</span>); <span class="hljs-comment">// -1 0 200</span></li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetTouchPointY returnValue = %{public}d"</span>, returnValue);</li><li>      <span class="hljs-comment">// 设置unifiedData</span></li><li>      <span class="hljs-comment">// 创建OH_UdmfRecord对象</span></li><li>      OH_UdmfRecord *record = <span class="hljs-built_in">OH_UdmfRecord_Create</span>();</li><li>      <span class="hljs-comment">// 向OH_UdmfRecord中添加纯文本类型数据</span></li><li>      OH_UdsPlainText *plainText = <span class="hljs-built_in">OH_UdsPlainText_Create</span>();</li><li>      <span class="hljs-type">int</span> returnStatus;</li><li>      <span class="hljs-built_in">OH_UdsPlainText_SetAbstract</span>(plainText, <span class="hljs-string">"this is plainText Abstract example"</span>);</li><li>      <span class="hljs-built_in">OH_UdsPlainText_SetContent</span>(plainText, <span class="hljs-string">"this is plainText Content example"</span>);</li><li>      returnStatus = <span class="hljs-built_in">OH_UdmfRecord_AddPlainText</span>(record, plainText);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"dragTest OH_UdmfRecord_AddPlainText returnStatus = %{public}d"</span>, returnStatus);</li><li>      <span class="hljs-comment">// 创建OH_UdmfData对象</span></li><li>      OH_UdmfData *data = <span class="hljs-built_in">OH_UdmfData_Create</span>();</li><li>      <span class="hljs-comment">// 向OH_UdmfData中添加OH_UdmfRecord</span></li><li>      returnStatus = <span class="hljs-built_in">OH_UdmfData_AddRecord</span>(data, record);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"dragTest OH_UdmfData_AddRecord returnStatus = %{public}d"</span>, returnStatus);</li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_DragAction_SetData</span>(action1, data);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_DragAction_SetData returnValue = %{public}d"</span>, returnValue);</li><li>      <span class="hljs-comment">// startDrag</span></li><li>      returnValue = <span class="hljs-built_in">OH_ArkUI_StartDrag</span>(action1);</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_ArkUI_StartDrag returnValue = %{public}d"</span>, returnValue);</li><li>      <span class="hljs-built_in">OH_ArkUI_DragAction_Dispose</span>(action1);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>处理NODE_ON_DROP事件。</p>       <p>在NODE_ON_DROP事件中，应用可以执行与落入阶段相关的操作。通常情况下，需要从DragEvent中获取拖拽过程中传递的数据，DragAction中的拖拽数据也需要通过DragEvent获取。</p>       <div _ngcontent-kfr-c106="" class="highlight-div"><div _ngcontent-kfr-c106="" class="highlight-div-header"><div _ngcontent-kfr-c106="" class="highlight-div-header-left"><div _ngcontent-kfr-c106="" class="handle-button expand-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kfr-c106="" class="highlight-div-header-right"><div _ngcontent-kfr-c106="" class="handle-button ai-button"></div><div _ngcontent-kfr-c106="" class="handle-button line-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kfr-c106="" class="handle-button theme-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kfr-c106="" class="handle-button copy-button"><div _ngcontent-kfr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kfr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">case</span> NODE_ON_DROP: {</li><li>  <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>, <span class="hljs-string">"NODE_ON_DROP EventReceiver"</span>);</li><li>  <span class="hljs-comment">// 获取UDMF data</span></li><li>  <span class="hljs-type">int</span> returnValue;</li><li>  <span class="hljs-comment">// 创建OH_UdmfData对象</span></li><li>  OH_UdmfData *data = <span class="hljs-built_in">OH_UdmfData_Create</span>();</li><li>  returnValue = <span class="hljs-built_in">OH_ArkUI_DragEvent_GetUdmfData</span>(dragEvent, data);</li><li>  <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                <span class="hljs-string">"OH_ArkUI_DragEvent_GetUdmfData returnValue = %{public}d"</span>, returnValue);</li><li>  <span class="hljs-comment">// 判断OH_UdmfData是否有对应的类型</span></li><li>  <span class="hljs-type">bool</span> resultUdmf = <span class="hljs-built_in">OH_UdmfData_HasType</span>(data, UDMF_META_PLAIN_TEXT);</li><li>  <span class="hljs-keyword">if</span> (resultUdmf) {</li><li>      <span class="hljs-comment">// 获取OH_UdmfData的记录</span></li><li>      <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordsCount = <span class="hljs-number">0</span>;</li><li>      OH_UdmfRecord **records = <span class="hljs-built_in">OH_UdmfData_GetRecords</span>(data, &amp;recordsCount);</li><li>      <span class="hljs-comment">// 获取records中的元素</span></li><li>      <span class="hljs-type">int</span> returnStatus;</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; recordsCount; i++) {</li><li>          <span class="hljs-comment">// 从OH_UdmfRecord中获取纯文本类型数据</span></li><li>          OH_UdsPlainText *plainTextValue = <span class="hljs-built_in">OH_UdsPlainText_Create</span>();</li><li>          returnStatus = <span class="hljs-built_in">OH_UdmfRecord_GetPlainText</span>(records[i], plainTextValue);</li><li>          <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                        <span class="hljs-string">"dragTest OH_UdmfRecord_GetPlainText "</span></li><li>                        <span class="hljs-string">"returnStatus= %{public}d"</span>,</li><li>                        returnStatus);</li><li>          <span class="hljs-keyword">auto</span> getAbstract = <span class="hljs-built_in">OH_UdsPlainText_GetAbstract</span>(plainTextValue);</li><li>          <span class="hljs-keyword">auto</span> getContent = <span class="hljs-built_in">OH_UdsPlainText_GetContent</span>(plainTextValue);</li><li>          <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                        <span class="hljs-string">"OH_UdsPlainText_GetAbstract = "</span></li><li>                        <span class="hljs-string">"%{public}s, OH_UdsPlainText_GetContent = "</span></li><li>                        <span class="hljs-string">"%{public}s"</span>,</li><li>                        getAbstract, getContent);</li><li>          <span class="hljs-comment">// 使用结束后销毁指针</span></li><li>          <span class="hljs-built_in">OH_UdsPlainText_Destroy</span>(plainTextValue);</li><li>      }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"dragTest"</span>,</li><li>                    <span class="hljs-string">"OH_UdmfData_HasType not contain UDMF_META_PLAIN_TEXT"</span>);</li><li>  }</li><li>  <span class="hljs-built_in">OH_UdmfData_Destroy</span>(data);</li><li>  <span class="hljs-keyword">break</span>;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>