<h1 _ngcontent-svh-c119="" class="doc-title ng-star-inserted" title="指定密钥参数生成非对称密钥对(ArkTS)"> 指定密钥参数生成非对称密钥对(ArkTS) </h1>

<div _ngcontent-svh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>以RSA、ECC、SM2为例，根据指定的密钥参数，生成非对称密钥对（KeyPair），并获取密钥参数属性。</p>    <p>该对象可用于后续的加解密等操作。获取的密钥参数属性可用于存储或运输。</p>    <div class="tiledSection">     <h2 id="指定密钥参数生成rsa公钥">指定密钥参数生成RSA公钥<i class="anchor-icon anchor-icon-link" anchorid="指定密钥参数生成rsa公钥" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>。</p>     <ol>      <li>       <p>构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#rsacommonparamsspec10" target="_blank">RSACommonParamsSpec</a>对象，用于指定RSA算法中公私钥包含的公共参数（n）。</p>       <p>RSACommonParamsSpec是AsyKeySpec的子类。需要通过参数algName指定算法'RSA'；指定密钥参数类型AsyKeySpecType.COMMON_PARAMS_SPEC，表示是公私钥中包含的公共参数。</p>       <p>使用密钥参数生成密钥时，用到的bigint类型需要以大端模式输入，且必须为正数。</p></li>      <li>       <p>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#rsapubkeyspec10" target="_blank">RSAPubKeySpec</a>对象，用于指定RSA算法中公钥包含的参数（n, pk）。</p>       <p>RSAPubKeySpec是AsyKeySpec的子类。通过参数algName指定算法'RSA'；指定密钥参数类型AsyKeySpecType.PUBLIC_KEY_SPEC，表示是公钥中包含的参数。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygeneratorbyspec10" target="_blank">cryptoFramework.createAsyKeyGeneratorBySpec</a>，将RSAPubKeySpec对象传入，创建非对称密钥生成器（AsyKeyGeneratorBySpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatepubkey10" target="_blank">AsyKeyGeneratorBySpec.generatePubKey</a>，获得指定的公钥（PubKey）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getasykeyspec10" target="_blank">PubKey.getAsyKeySpec</a>，获取模数n和公钥pk（即公钥指数e）。</p></li>     </ol>     <ul>      <li>       <p>以使用callback方式根据密钥参数生成RSA公钥为例：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-comment">// RSA公钥密钥参数生成函数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaPubKeySpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span></span>): cryptoFramework.<span class="hljs-property">RSAPubKeySpec</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'RSA'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaPubKeySpec</span>: cryptoFramework.<span class="hljs-property">RSAPubKeySpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'RSA'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">PUBLIC_KEY_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaPubKeySpec;</li><li>}</li><li><span class="hljs-comment">// 根据密钥参数构造RSA公钥规范对象。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048PubKeySpec</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25'</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x010001'</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaPubKeySpec</span>(nIn, eIn);</li><li>}</li><li><span class="hljs-comment">// 将RSA公钥规格与预期值进行比较。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">compareRsaPubKeyBySpec</span>(<span class="hljs-params">rsaKeySpec: cryptoFramework.RSAPubKeySpec, n: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, e: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'string'</span> || <span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'string'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is string'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'number'</span> || <span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'number'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is number'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (rsaKeySpec.<span class="hljs-property">params</span>.<span class="hljs-property">n</span> !== n) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (rsaKeySpec.<span class="hljs-property">pk</span> !== e) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li><span class="hljs-comment">// 根据RSA公钥规格生成RSA公钥，获取密钥规格，并与预期值进行比较。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">rsaUsePubKeySpecGetCallback</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> rsaPubKeySpec = <span class="hljs-title function_">genRsa2048PubKeySpec</span>();</li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaPubKeySpec);</li><li>  rsaGeneratorSpec.<span class="hljs-title function_">generatePubKey</span>(<span class="hljs-function">(<span class="hljs-params">error, key</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'generate pubKey error'</span> + <span class="hljs-string">'error code: '</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">'error message'</span> + error.<span class="hljs-property">message</span>);</li><li>    }</li><li>    <span class="hljs-keyword">let</span> pubKey = key;</li><li>    <span class="hljs-keyword">let</span> nBN = pubKey.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">RSA_N_BN</span>);</li><li>    <span class="hljs-keyword">let</span> eBN = pubKey.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">RSA_PK_BN</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">compareRsaPubKeyBySpec</span>(rsaPubKeySpec, nBN, eBN) !== <span class="hljs-literal">true</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error pub key big number'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'n, e in the pubKey are same as the spec.'</span>);</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步返回结果（调用方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatepubkeysync12" target="_blank">generatePubKeySync</a>）：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-comment">// RSA公钥密钥参数生成函数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaPubKeySpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span></span>): cryptoFramework.<span class="hljs-property">RSAPubKeySpec</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'RSA'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaPubKeySpec</span>: cryptoFramework.<span class="hljs-property">RSAPubKeySpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'RSA'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">PUBLIC_KEY_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaPubKeySpec;</li><li>}</li><li><span class="hljs-comment">// 根据密钥参数构造RSA公钥规范对象。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048PubKeySpec</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25'</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x010001'</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaPubKeySpec</span>(nIn, eIn);</li><li>}</li><li><span class="hljs-comment">// 将RSA公钥规格与预期值进行比较。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">compareRsaPubKeyBySpec</span>(<span class="hljs-params">rsaKeySpec: cryptoFramework.RSAPubKeySpec, n: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, e: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'string'</span> || <span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'string'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is string'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'number'</span> || <span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'number'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is number'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (rsaKeySpec.<span class="hljs-property">params</span>.<span class="hljs-property">n</span> !== n) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (rsaKeySpec.<span class="hljs-property">pk</span> !== e) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li><span class="hljs-comment">// 根据RSA公钥规格生成RSA公钥，获取密钥规格，并与预期值进行比较。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">rsaUsePubKeySpecGetSync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> rsaPubKeySpec = <span class="hljs-title function_">genRsa2048PubKeySpec</span>();</li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaPubKeySpec);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> pubKey = rsaGeneratorSpec.<span class="hljs-title function_">generatePubKeySync</span>();</li><li>    <span class="hljs-keyword">if</span> (pubKey !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">let</span> nBN = pubKey.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">RSA_N_BN</span>);</li><li>      <span class="hljs-keyword">let</span> eBN = pubKey.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">RSA_PK_BN</span>);</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">compareRsaPubKeyBySpec</span>(rsaPubKeySpec, nBN, eBN) !== <span class="hljs-literal">true</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error pub key big number'</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'n, e in the pubKey are same as the spec.'</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'get pub key result fail!'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`get pub key result fail, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="指定密钥参数生成ecc密钥对">指定密钥参数生成ECC密钥对<i class="anchor-icon anchor-icon-link" anchorid="指定密钥参数生成ecc密钥对" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#ecc">非对称密钥生成和转换规格：ECC</a>。</p>     <ol>      <li>       <p>构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#ecccommonparamsspec10" target="_blank">ECCCommonParamsSpec</a>对象，用于指定ECC算法中公私钥包含的公共参数。</p>       <p>ECCCommonParamsSpec是AsyKeySpec的子类。需要通过参数algName指定算法'ECC'；指定密钥参数类型AsyKeySpecType.COMMON_PARAMS_SPEC，表示是公私钥中包含的公共参数。</p>       <p>使用密钥参数生成密钥时，用到的bigint类型需要以大端模式输入，且必须为正数。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygeneratorbyspec10" target="_blank">cryptoFramework.createAsyKeyGeneratorBySpec</a>，将ECCCommonParamsSpec对象传入，创建非对称密钥生成器（AsyKeyGeneratorBySpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypair10" target="_blank">AsyKeyGeneratorBySpec.generateKeyPair</a>，得到随机生成的密钥对（KeyPair）。</p></li>      <li>       <p>分别传入密钥对中的私钥和公钥，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getasykeyspec10-1" target="_blank">PriKey.getAsyKeySpec</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getasykeyspec10" target="_blank">PubKey.getAsyKeySpec</a>，获取ECC算法中私钥和公钥的各种密钥参数。</p></li>     </ol>     <ul>      <li>       <p>以使用Promise方式根据密钥参数生成ECC密钥为例：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 打印bigint信息。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-params">bnName: <span class="hljs-built_in">string</span>, bnValue: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> bnValue === <span class="hljs-string">'string'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is string'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> bnValue === <span class="hljs-string">'number'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is number'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(bnName + <span class="hljs-string">':'</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Decimal: '</span> + bnValue.<span class="hljs-title function_">toString</span>());</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Hexadecimal: '</span> + bnValue.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>));</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Length (bits): '</span> + bnValue.<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>).<span class="hljs-property">length</span>);</li><li>}</li><li><span class="hljs-comment">// 根据关键规范构造EccCommonSpec结构体。EccCommonSpec结构体定义了ECC私钥和公钥的公共参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genEccCommonSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">ECCCommonParamsSpec</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">fieldFp</span>: cryptoFramework.<span class="hljs-property">ECFieldFp</span> = {</li><li>    <span class="hljs-attr">fieldType</span>: <span class="hljs-string">'Fp'</span>,</li><li>    <span class="hljs-attr">p</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xffffffffffffffffffffffffffffffff000000000000000000000001'</span>)</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">G</span>: cryptoFramework.<span class="hljs-property">Point</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21'</span>),</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34'</span>)</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">eccCommonSpec</span>: cryptoFramework.<span class="hljs-property">ECCCommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'ECC'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span>,</li><li>    <span class="hljs-attr">field</span>: fieldFp,</li><li>    <span class="hljs-attr">a</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xfffffffffffffffffffffffffffffffefffffffffffffffffffffffe'</span>),</li><li>    <span class="hljs-attr">b</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4'</span>),</li><li>    <span class="hljs-attr">g</span>: G,</li><li>    <span class="hljs-attr">n</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d'</span>),</li><li>    <span class="hljs-attr">h</span>: <span class="hljs-number">1</span></li><li>  }</li><li>  <span class="hljs-keyword">return</span> eccCommonSpec;</li><li>}</li><li><span class="hljs-comment">// 打印ECC密钥规格。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">showEccSpecDetailInfo</span>(<span class="hljs-params">key: cryptoFramework.PubKey | cryptoFramework.PriKey, keyType: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'show detail of '</span> + keyType + <span class="hljs-string">':'</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> p = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FP_P_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- p'</span>, p); <span class="hljs-comment">// length is 224, hex : ffffffffffffffffffffffffffffffff000000000000000000000001</span></li><li>    <span class="hljs-keyword">let</span> a = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_A_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- a'</span>, a); <span class="hljs-comment">// length is 224, hex : fffffffffffffffffffffffffffffffefffffffffffffffffffffffe</span></li><li>    <span class="hljs-keyword">let</span> b = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_B_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- b'</span>, b); <span class="hljs-comment">// length is 224, hex : b4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4</span></li><li>    <span class="hljs-keyword">let</span> gX = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_G_X_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- gX'</span>, gX); <span class="hljs-comment">// length is 224, hex : b70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21</span></li><li>    <span class="hljs-keyword">let</span> gY = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_G_Y_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- gY'</span>, gY); <span class="hljs-comment">// length is 224, hex : bd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34</span></li><li>    <span class="hljs-keyword">let</span> n = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_N_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- n'</span>, n); <span class="hljs-comment">// length is 224, hex : ffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d</span></li><li>    <span class="hljs-keyword">let</span> h = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_H_NUM</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- h: '</span> + h); <span class="hljs-comment">// key h: 1</span></li><li>    <span class="hljs-keyword">let</span> fieldType = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FIELD_TYPE_STR</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- field type: '</span> + fieldType); <span class="hljs-comment">// key field type: Fp</span></li><li>    <span class="hljs-keyword">let</span> fieldSize = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FIELD_SIZE_NUM</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- field size: '</span> + fieldSize); <span class="hljs-comment">// key field size: 224</span></li><li>    <span class="hljs-keyword">let</span> curveName = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_CURVE_NAME_STR</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- curve name: '</span> + curveName); <span class="hljs-comment">// key curve name: NID_secp224r1</span></li><li>    <span class="hljs-keyword">if</span> (keyType === <span class="hljs-string">'priKey'</span>) {</li><li>      <span class="hljs-keyword">let</span> sk = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_SK_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- sk'</span>, sk);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyType === <span class="hljs-string">'pubKey'</span>) {</li><li>      <span class="hljs-keyword">let</span> pkX = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_PK_X_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- pkX'</span>, pkX);</li><li>      <span class="hljs-keyword">let</span> pkY = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_PK_Y_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- pkY'</span>, pkY);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getAsyKeySpec error'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getAsyKeySpec failed, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-comment">// 根据EccCommonSpec实例生成ECC密钥对，获取密钥规格。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">testEccUseCommKeySpecGet</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> commKeySpec = <span class="hljs-title function_">genEccCommonSpec</span>(); <span class="hljs-comment">// 使用参数属性，构造ECC公私钥公共密钥参数对象。</span></li><li>    <span class="hljs-keyword">let</span> generatorBySpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(commKeySpec); <span class="hljs-comment">// 使用密钥参数对象创建生成器。</span></li><li>    <span class="hljs-keyword">let</span> keyPairPromise = generatorBySpec.<span class="hljs-title function_">generateKeyPair</span>(); <span class="hljs-comment">// Generates an ECC key pair.</span></li><li>    keyPairPromise.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">keyPair</span> =&gt;</span> { <span class="hljs-comment">// 使用生成器创建ECC密钥对。</span></li><li>      <span class="hljs-title function_">showEccSpecDetailInfo</span>(keyPair.<span class="hljs-property">priKey</span>, <span class="hljs-string">'priKey'</span>); <span class="hljs-comment">// 对私钥获取相关密钥参数属性。</span></li><li>      <span class="hljs-title function_">showEccSpecDetailInfo</span>(keyPair.<span class="hljs-property">pubKey</span>, <span class="hljs-string">'pubKey'</span>); <span class="hljs-comment">// 对公钥获取相关密钥参数属性。</span></li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 逻辑错误等异步异常在此捕获。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'generateComm error'</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error code: '</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">', message is: '</span> + error.<span class="hljs-property">message</span>);</li><li>    })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 参数错误等同步异常在此捕获。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'testEccUseCommSpec error'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ecc comm spec failed, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步返回结果（调用方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypairsync12" target="_blank">generateKeyPairSync</a>）：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-params">bnName: <span class="hljs-built_in">string</span>, bnValue: <span class="hljs-built_in">bigint</span> | <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> bnValue === <span class="hljs-string">'string'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is string'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> bnValue === <span class="hljs-string">'number'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'type is number'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(bnName + <span class="hljs-string">':'</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Decimal: '</span> + bnValue.<span class="hljs-title function_">toString</span>());</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Hexadecimal: '</span> + bnValue.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>));</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'. Length (bits): '</span> + bnValue.<span class="hljs-title function_">toString</span>(<span class="hljs-number">2</span>).<span class="hljs-property">length</span>);</li><li>}</li><li><span class="hljs-comment">// 根据关键规范构造EccCommonSpec结构体。EccCommonSpec结构体定义了ECC私钥和公钥的公共参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genEccCommonSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">ECCCommonParamsSpec</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">fieldFp</span>: cryptoFramework.<span class="hljs-property">ECFieldFp</span> = {</li><li>    <span class="hljs-attr">fieldType</span>: <span class="hljs-string">'Fp'</span>,</li><li>    <span class="hljs-attr">p</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xffffffffffffffffffffffffffffffff000000000000000000000001'</span>)</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">G</span>: cryptoFramework.<span class="hljs-property">Point</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21'</span>),</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34'</span>)</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">eccCommonSpec</span>: cryptoFramework.<span class="hljs-property">ECCCommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'ECC'</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span>,</li><li>    <span class="hljs-attr">field</span>: fieldFp,</li><li>    <span class="hljs-attr">a</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xfffffffffffffffffffffffffffffffefffffffffffffffffffffffe'</span>),</li><li>    <span class="hljs-attr">b</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4'</span>),</li><li>    <span class="hljs-attr">g</span>: G,</li><li>    <span class="hljs-attr">n</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d'</span>),</li><li>    <span class="hljs-attr">h</span>: <span class="hljs-number">1</span></li><li>  }</li><li>  <span class="hljs-keyword">return</span> eccCommonSpec;</li><li>}</li><li><span class="hljs-comment">// 打印ECC密钥规格。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">showEccSpecDetailInfo</span>(<span class="hljs-params">key: cryptoFramework.PubKey | cryptoFramework.PriKey, keyType: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'show detail of '</span> + keyType + <span class="hljs-string">':'</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> p = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FP_P_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- p'</span>, p); <span class="hljs-comment">// length is 224, hex : ffffffffffffffffffffffffffffffff000000000000000000000001</span></li><li>    <span class="hljs-keyword">let</span> a = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_A_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- a'</span>, a); <span class="hljs-comment">// length is 224, hex : fffffffffffffffffffffffffffffffefffffffffffffffffffffffe</span></li><li>    <span class="hljs-keyword">let</span> b = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_B_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- b'</span>, b); <span class="hljs-comment">// length is 224, hex : b4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4</span></li><li>    <span class="hljs-keyword">let</span> gX = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_G_X_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- gX'</span>, gX); <span class="hljs-comment">// length is 224, hex : b70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21</span></li><li>    <span class="hljs-keyword">let</span> gY = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_G_Y_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- gY'</span>, gY); <span class="hljs-comment">// length is 224, hex : bd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34</span></li><li>    <span class="hljs-keyword">let</span> n = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_N_BN</span>);</li><li>    <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- n'</span>, n); <span class="hljs-comment">// length is 224, hex : ffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d</span></li><li>    <span class="hljs-keyword">let</span> h = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_H_NUM</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- h: '</span> + h); <span class="hljs-comment">// key h: 1</span></li><li>    <span class="hljs-keyword">let</span> fieldType = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FIELD_TYPE_STR</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- field type: '</span> + fieldType); <span class="hljs-comment">// key field type: Fp</span></li><li>    <span class="hljs-keyword">let</span> fieldSize = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_FIELD_SIZE_NUM</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- field size: '</span> + fieldSize); <span class="hljs-comment">// key field size: 224</span></li><li>    <span class="hljs-keyword">let</span> curveName = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_CURVE_NAME_STR</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'--- curve name: '</span> + curveName); <span class="hljs-comment">// key curve name: NID_secp224r1</span></li><li>    <span class="hljs-keyword">if</span> (keyType === <span class="hljs-string">'priKey'</span>) {</li><li>      <span class="hljs-keyword">let</span> sk = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_SK_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- sk'</span>, sk);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyType === <span class="hljs-string">'pubKey'</span>) {</li><li>      <span class="hljs-keyword">let</span> pkX = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_PK_X_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- pkX'</span>, pkX);</li><li>      <span class="hljs-keyword">let</span> pkY = key.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_PK_Y_BN</span>);</li><li>      <span class="hljs-title function_">showBigIntInfo</span>(<span class="hljs-string">'--- pkY'</span>, pkY);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getAsyKeySpec failed, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-comment">// 根据EccCommonSpec实例生成ECC密钥对，获取密钥规格。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">testEccUseCommKeySpecGetSync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> commKeySpec = <span class="hljs-title function_">genEccCommonSpec</span>(); <span class="hljs-comment">// 使用参数属性，构造ECC公私钥公共密钥参数对象。</span></li><li>    <span class="hljs-keyword">let</span> generatorBySpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(commKeySpec); <span class="hljs-comment">// 使用密钥参数对象创建生成器。</span></li><li>    <span class="hljs-keyword">let</span> keyPair = generatorBySpec.<span class="hljs-title function_">generateKeyPairSync</span>(); <span class="hljs-comment">// Generates an ECC key pair.</span></li><li>    <span class="hljs-keyword">if</span> (keyPair !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-title function_">showEccSpecDetailInfo</span>(keyPair.<span class="hljs-property">priKey</span>, <span class="hljs-string">'priKey'</span>); <span class="hljs-comment">// 对私钥获取相关密钥参数属性。</span></li><li>      <span class="hljs-title function_">showEccSpecDetailInfo</span>(keyPair.<span class="hljs-property">pubKey</span>, <span class="hljs-string">'pubKey'</span>); <span class="hljs-comment">// 对公钥获取相关密钥参数属性。</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'get key pair result fail!'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-comment">// 逻辑错误等异常在此捕获。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`get key pair result fail, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="根据椭圆曲线名生成sm2密钥对">根据椭圆曲线名生成SM2密钥对<i class="anchor-icon anchor-icon-link" anchorid="根据椭圆曲线名生成sm2密钥对" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#sm2">非对称密钥生成和转换规格：SM2</a>。</p>     <ol>      <li>       <p>构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#ecccommonparamsspec10" target="_blank">ECCCommonParamsSpec</a>对象，用于指定非对称公共密钥参数。根据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#genecccommonparamsspec11" target="_blank">genECCCommonParamsSpec</a>接口传入相应的NID字符串名称生成相应的非对称公共密钥参数。</p>       <p>使用密钥参数生成密钥时，用到的bigint类型需要以大端模式输入，且必须为正数。</p></li>      <li>       <p>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#ecckeypairspec10" target="_blank">ECCKeyPairSpec</a>对象，并且algName设置为SM2，用于指定SM2算法中密钥对包含的参数。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygeneratorbyspec10" target="_blank">cryptoFramework.createAsyKeyGeneratorBySpec</a>，将ECCKeyPairSpec对象传入，创建非对称密钥生成器。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypair10" target="_blank">AsyKeyGeneratorBySpec.generateKeyPair</a>，得到各项数据与密钥参数一致的密钥对（KeyPair）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getasykeyspec10-1" target="_blank">PriKey.getAsyKeySpec</a>，获取SM2算法中椭圆曲线参数。</p></li>     </ol>     <ul>      <li>       <p>以使用Promise方式根据椭圆曲线名生成SM2密钥为例：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genSM2KeyPairSpec</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> sm2CommonParamsSpec = cryptoFramework.<span class="hljs-property">ECCKeyUtil</span>.<span class="hljs-title function_">genECCCommonParamsSpec</span>(<span class="hljs-string">'NID_sm2'</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">sm2KeyPairSpec</span>: cryptoFramework.<span class="hljs-property">ECCKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"SM2"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span>,</li><li>    <span class="hljs-attr">params</span>: sm2CommonParamsSpec,</li><li>    <span class="hljs-attr">sk</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x6330B599ECD23ABDC74B9A5B7B5E00E553005F72743101C5FAB83AEB579B7074'</span>),</li><li>    <span class="hljs-attr">pk</span>: {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x67F3B850BDC0BA5D3A29D8A0883C4B17612AB84F87F18E28F77D824A115C02C4'</span>),</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xD48966CE754BBBEDD6501A1385E1B205C186E926ADED44287145E8897D4B2071'</span>)</li><li>    },</li><li>  };</li><li>  <span class="hljs-keyword">return</span> sm2KeyPairSpec;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sm2Test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> sm2KeyPairSpec = <span class="hljs-title function_">genSM2KeyPairSpec</span>();</li><li>  <span class="hljs-keyword">let</span> generatorBySpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(sm2KeyPairSpec);</li><li>  <span class="hljs-keyword">let</span> keyPair = <span class="hljs-keyword">await</span> generatorBySpec.<span class="hljs-title function_">generateKeyPair</span>();</li><li>  <span class="hljs-keyword">let</span> sm2CurveName = keyPair.<span class="hljs-property">priKey</span>.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_CURVE_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ECC_CURVE_NAME_STR: '</span> + sm2CurveName); <span class="hljs-comment">// NID_sm2</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步返回结果（调用方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypairsync12" target="_blank">generateKeyPairSync</a>）：</p>       <div _ngcontent-svh-c106="" class="highlight-div"><div _ngcontent-svh-c106="" class="highlight-div-header"><div _ngcontent-svh-c106="" class="highlight-div-header-left"><div _ngcontent-svh-c106="" class="handle-button expand-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-svh-c106="" class="highlight-div-header-right"><div _ngcontent-svh-c106="" class="handle-button ai-button"></div><div _ngcontent-svh-c106="" class="handle-button line-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-svh-c106="" class="handle-button theme-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-svh-c106="" class="handle-button copy-button"><div _ngcontent-svh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-svh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genSM2KeyPairSpec</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> sm2CommonParamsSpec = cryptoFramework.<span class="hljs-property">ECCKeyUtil</span>.<span class="hljs-title function_">genECCCommonParamsSpec</span>(<span class="hljs-string">'NID_sm2'</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">sm2KeyPairSpec</span>: cryptoFramework.<span class="hljs-property">ECCKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"SM2"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span>,</li><li>    <span class="hljs-attr">params</span>: sm2CommonParamsSpec,</li><li>    <span class="hljs-attr">sk</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x6330B599ECD23ABDC74B9A5B7B5E00E553005F72743101C5FAB83AEB579B7074'</span>),</li><li>    <span class="hljs-attr">pk</span>: {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0x67F3B850BDC0BA5D3A29D8A0883C4B17612AB84F87F18E28F77D824A115C02C4'</span>),</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">'0xD48966CE754BBBEDD6501A1385E1B205C186E926ADED44287145E8897D4B2071'</span>)</li><li>    },</li><li>  };</li><li>  <span class="hljs-keyword">return</span> sm2KeyPairSpec;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">sm2TestSync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> sm2KeyPairSpec = <span class="hljs-title function_">genSM2KeyPairSpec</span>();</li><li>  <span class="hljs-keyword">let</span> generatorBySpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(sm2KeyPairSpec);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> keyPair = generatorBySpec.<span class="hljs-title function_">generateKeyPairSync</span>();</li><li>    <span class="hljs-keyword">if</span> (keyPair !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">let</span> sm2CurveName = keyPair.<span class="hljs-property">priKey</span>.<span class="hljs-title function_">getAsyKeySpec</span>(cryptoFramework.<span class="hljs-property">AsyKeySpecItem</span>.<span class="hljs-property">ECC_CURVE_NAME_STR</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ECC_CURVE_NAME_STR: '</span> + sm2CurveName); <span class="hljs-comment">// NID_sm2</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'get key pair result fail!'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`get key pair result fail, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>