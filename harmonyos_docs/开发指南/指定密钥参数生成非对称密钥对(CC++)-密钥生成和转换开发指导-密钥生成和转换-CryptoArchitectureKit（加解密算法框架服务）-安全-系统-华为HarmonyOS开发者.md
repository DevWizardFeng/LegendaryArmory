<h1 _ngcontent-ljb-c119="" class="doc-title ng-star-inserted" title="指定密钥参数生成非对称密钥对(C/C++)"> 指定密钥参数生成非对称密钥对(C/C++) </h1>

<div _ngcontent-ljb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>以RSA、ECC、SM2为例，根据指定的密钥参数，生成非对称密钥对（KeyPair），并获取密钥参数属性。</p>    <p>该对象可用于后续的加解密等操作。获取的密钥参数属性可用于存储或运输。</p>    <div class="tiledSection">     <h2 id="指定密钥参数生成rsa密钥对">指定密钥参数生成RSA密钥对<i class="anchor-icon anchor-icon-link" anchorid="指定密钥参数生成rsa密钥对" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>。</p>     <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_create" target="_blank">OH_CryptoAsymKeySpec_Create</a>，指定算法名为"RSA"， 密钥参数类型为CRYPTO_ASYM_KEY_KEY_PAIR_SPEC，创建参数对象（keySpec）。</p></li>      <li>       <p>指定uint8_t类型的RSA密钥对数据（pk、sk、n），分别封装成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_setparam" target="_blank">OH_CryptoAsymKeySpec_SetParam</a>，指定参数类型分别为CRYPTO_RSA_E_DATABLOB（pk）、CRYPTO_RSA_D_DATABLOB（sk）、CRYPTO_RSA_N_DATABLOB（n）, 依次传入封装后的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>，设置参数对象（keySpec）。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>pk、sk、n均要以大端模式输入，且必须为正数。</p>        </div></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_create" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_Create</a>，将参数对象（keySpec）传入，创建非对称密钥生成器（generatorSpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_genkeypair" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair</a>，生成RSA密钥对（keyPair）。</p></li>      <li>       <p>分别传入密钥对中的私钥和公钥，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkey_getparam" target="_blank">OH_CryptoPrivKey_GetParam</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptopubkey_getparam" target="_blank">OH_CryptoPubKey_GetParam</a>，获取RSA算法中私钥和公钥的各种密钥参数。</p></li>     </ol>     <div _ngcontent-ljb-c106="" class="highlight-div"><div _ngcontent-ljb-c106="" class="highlight-div-header"><div _ngcontent-ljb-c106="" class="highlight-div-header-left"><div _ngcontent-ljb-c106="" class="handle-button expand-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ljb-c106="" class="highlight-div-header-right"><div _ngcontent-ljb-c106="" class="handle-button ai-button"></div><div _ngcontent-ljb-c106="" class="handle-button line-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ljb-c106="" class="handle-button theme-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ljb-c106="" class="handle-button copy-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ljb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"CryptoArchitectureKit/crypto_architecture_kit.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> OH_Crypto_ErrCode <span class="hljs-title">GetRsaKeyParams</span><span class="hljs-params">(OH_CryptoKeyPair *keyCtx, Crypto_DataBlob *pubKeyData,</span></span></li><li><span class="hljs-function">                                         Crypto_DataBlob *dataN)</span></li><li><span class="hljs-function"></span>{</li><li>    OH_CryptoPubKey *pubKey = <span class="hljs-built_in">OH_CryptoKeyPair_GetPubKey</span>(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (pubKey == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    OH_Crypto_ErrCode ret = <span class="hljs-built_in">OH_CryptoPubKey_GetParam</span>(pubKey, CRYPTO_RSA_E_DATABLOB, pubKeyData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">OH_CryptoPubKey_GetParam</span>(pubKey, CRYPTO_RSA_N_DATABLOB, dataN);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">FreeRsaKeyParams</span><span class="hljs-params">(Crypto_DataBlob *pubKeyData, Crypto_DataBlob *dataN)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(pubKeyData);</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(dataN);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">ConvertHex</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span>* dest, <span class="hljs-type">size_t</span> count, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* src)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> i;</li><li>    <span class="hljs-type">int</span> value;</li><li>
</li><li>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; count &amp;&amp; <span class="hljs-built_in">sscanf</span>(src + i * <span class="hljs-number">2</span>, <span class="hljs-string">"%2x"</span>, &amp;value) == <span class="hljs-number">1</span>; i++) {</li><li>        dest[i] = value;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> i;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> OH_Crypto_ErrCode <span class="hljs-title">doTestRsaGenKeyPairBySpec</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    std::string nStr = <span class="hljs-string">"9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25"</span>;</li><li>    std::string eStr = <span class="hljs-string">"010001"</span>;</li><li>    <span class="hljs-type">uint8_t</span> n[<span class="hljs-number">1024</span>] = {};</li><li>    <span class="hljs-type">uint8_t</span> e[<span class="hljs-number">20</span>] = {};</li><li>    <span class="hljs-type">size_t</span> nLen = <span class="hljs-built_in">ConvertHex</span>(n, nStr.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>, nStr.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-type">size_t</span> eLen = <span class="hljs-built_in">ConvertHex</span>(e, eStr.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>, eStr.<span class="hljs-built_in">c_str</span>());</li><li>    Crypto_DataBlob nData = {.data = n, .len = nLen};</li><li>    Crypto_DataBlob eData = {.data = e, .len = eLen};</li><li>
</li><li>    OH_CryptoAsymKeySpec *keySpec = <span class="hljs-literal">nullptr</span>;</li><li>    OH_Crypto_ErrCode ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_Create</span>(<span class="hljs-string">"RSA"</span>, CRYPTO_ASYM_KEY_PUBLIC_KEY_SPEC, &amp;keySpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetParam</span>(keySpec, CRYPTO_RSA_E_DATABLOB, &amp;eData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetParam</span>(keySpec, CRYPTO_RSA_N_DATABLOB, &amp;nData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoAsymKeyGeneratorWithSpec *generatorSpec = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Create</span>(keySpec, &amp;generatorSpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    OH_CryptoKeyPair *keyPair = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair</span>(generatorSpec, &amp;keyPair);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    Crypto_DataBlob dataE = {.data = <span class="hljs-literal">nullptr</span>, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataN = {.data = <span class="hljs-literal">nullptr</span>, .len = <span class="hljs-number">0</span>};</li><li>    ret = <span class="hljs-built_in">GetRsaKeyParams</span>(keyPair, &amp;dataE, &amp;dataN);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">FreeRsaKeyParams</span>(&amp;dataE, &amp;dataN);</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-built_in">FreeRsaKeyParams</span>(&amp;dataE, &amp;dataN);</li><li>    <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="指定密钥参数生成ecc密钥对">指定密钥参数生成ECC密钥对<i class="anchor-icon anchor-icon-link" anchorid="指定密钥参数生成ecc密钥对" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#ecc">非对称密钥生成和转换规格：ECC</a>。</p>     <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_create" target="_blank">OH_CryptoAsymKeySpec_Create</a>，指定算法名为"ECC"， 密钥参数类型为CRYPTO_ASYM_KEY_COMMON_PARAMS_SPEC，创建参数对象（keySpec）。</p></li>      <li>       <p>指定uint8_t类型的ECC公私钥包含的公共参数（p、a、b、gx、gy、n、h），分别封装成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_setparam" target="_blank">OH_CryptoAsymKeySpec_SetParam</a>，指定参数类型分别为CRYPTO_ECC_FP_P_DATABLOB（p）、CRYPTO_ECC_A_DATABLOB（a）、CRYPTO_ECC_B_DATABLOB（b）、CRYPTO_ECC_G_X_DATABLOB（gx）、CRYPTO_ECC_G_Y_DATABLOB（gy）、CRYPTO_ECC_N_DATABLOB（n）、CRYPTO_ECC_H_INT（h）, 依次传入封装后的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>，设置到参数对象（keySpec）。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>p、a、b、gx、gy、n、h均要以大端模式输入，且必须为正数。</p>        </div></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_create" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_Create</a>，将参数对象（keySpec）传入，创建非对称密钥生成器（generatorSpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_genkeypair" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair</a>，生成ECC密钥对（keyPair）。</p></li>      <li>       <p>分别传入密钥对中的私钥和公钥，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkey_getparam" target="_blank">OH_CryptoPrivKey_GetParam</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptopubkey_getparam" target="_blank">OH_CryptoPubKey_GetParam</a>，获取ECC算法中私钥和公钥的各种密钥参数。</p></li>     </ol>     <div _ngcontent-ljb-c106="" class="highlight-div"><div _ngcontent-ljb-c106="" class="highlight-div-header"><div _ngcontent-ljb-c106="" class="highlight-div-header-left"><div _ngcontent-ljb-c106="" class="handle-button expand-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ljb-c106="" class="highlight-div-header-right"><div _ngcontent-ljb-c106="" class="handle-button ai-button"></div><div _ngcontent-ljb-c106="" class="handle-button line-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ljb-c106="" class="handle-button theme-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ljb-c106="" class="handle-button copy-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ljb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li>#include <span class="hljs-string">"CryptoArchitectureKit/crypto_architecture_kit.h"</span></li><li>#include &lt;string&gt;</li><li>
</li><li>static OH_Crypto_ErrCode GetEccKeyParams(OH_CryptoKeyPair *keyCtx, Crypto_DataBlob *pubKeyXData,</li><li>                                         Crypto_DataBlob *pubKeyYData, Crypto_DataBlob *privKeyData)</li><li>{</li><li>    OH_CryptoPubKey *pubKey = OH_CryptoKeyPair_GetPubKey(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (pubKey == nullptr) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    OH_Crypto_ErrCode ret = OH_CryptoPubKey_GetParam(pubKey, CRYPTO_ECC_PK_X_DATABLOB, pubKeyXData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPubKey_GetParam(pubKey, CRYPTO_ECC_PK_Y_DATABLOB, pubKeyYData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoPrivKey *privKey = OH_CryptoKeyPair_GetPrivKey(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (privKey == nullptr) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_SK_DATABLOB, privKeyData);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li><li>
</li><li>static void FreeEccKeyParams(Crypto_DataBlob *pubKeyXData, Crypto_DataBlob *pubKeyYData, Crypto_DataBlob *privKeyData)</li><li>{</li><li>    OH_Crypto_FreeDataBlob(pubKeyXData);</li><li>    OH_Crypto_FreeDataBlob(pubKeyYData);</li><li>    OH_Crypto_FreeDataBlob(privKeyData);</li><li>}</li><li>
</li><li>static OH_Crypto_ErrCode GetEccCommonParams(OH_CryptoKeyPair *keyCtx, Crypto_DataBlob *pData,</li><li>                                         Crypto_DataBlob *aData, Crypto_DataBlob *bData, Crypto_DataBlob *gxData,</li><li>                                         Crypto_DataBlob *gyData, Crypto_DataBlob *nData, Crypto_DataBlob *hData)</li><li>{</li><li>    OH_CryptoPrivKey *privKey = OH_CryptoKeyPair_GetPrivKey(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (privKey == nullptr) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    OH_Crypto_ErrCode ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_FP_P_DATABLOB, pData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_A_DATABLOB, aData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_B_DATABLOB, bData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_G_X_DATABLOB, gxData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_G_Y_DATABLOB, gyData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_N_DATABLOB, nData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoPrivKey_GetParam(privKey, CRYPTO_ECC_H_INT, hData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li><li>
</li><li>static void FreeEccCommonParams(Crypto_DataBlob *pData, Crypto_DataBlob *aData, Crypto_DataBlob *bData,</li><li>                                Crypto_DataBlob *gxData, Crypto_DataBlob *gyData, Crypto_DataBlob *nData,</li><li>                                Crypto_DataBlob *hData)</li><li>{</li><li>    OH_Crypto_FreeDataBlob(pData);</li><li>    OH_Crypto_FreeDataBlob(aData);</li><li>    OH_Crypto_FreeDataBlob(bData);</li><li>    OH_Crypto_FreeDataBlob(gxData);</li><li>    OH_Crypto_FreeDataBlob(gyData);</li><li>    OH_Crypto_FreeDataBlob(nData);</li><li>    OH_Crypto_FreeDataBlob(hData);</li><li>}</li><li>
</li><li>size_t ConvertHex(uint8_t* dest, size_t count, <span class="hljs-keyword">const</span> char* src)</li><li>{</li><li>    size_t i;</li><li>    int value;</li><li>
</li><li>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; count &amp;&amp; sscanf(src + i * <span class="hljs-number">2</span>, <span class="hljs-string">"%2x"</span>, &amp;value) == <span class="hljs-number">1</span>; i++) {</li><li>        dest[i] = value;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> i;</li><li>}</li><li>
</li><li>static OH_Crypto_ErrCode doTestEccGenKeyPairBySpec()</li><li>{</li><li>    std::string pStr = <span class="hljs-string">"ffffffffffffffffffffffffffffffff000000000000000000000001"</span>;</li><li>    std::string gxStr = <span class="hljs-string">"b70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21"</span>;</li><li>    std::string gyStr = <span class="hljs-string">"bd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"</span>;</li><li>    std::string aStr = <span class="hljs-string">"fffffffffffffffffffffffffffffffefffffffffffffffffffffffe"</span>;</li><li>    std::string bStr = <span class="hljs-string">"b4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4"</span>;</li><li>    std::string nStr = <span class="hljs-string">"ffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d"</span>;</li><li>    uint8_t p[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t gx[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t gy[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t a[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t b[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t n[<span class="hljs-number">256</span>] = {};</li><li>    uint8_t h[] = {<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x01</span>}; <span class="hljs-comment">// 1 大端序</span></li><li>    size_t pLen = ConvertHex(p, pStr.size() / <span class="hljs-number">2</span>, pStr.c_str());</li><li>    size_t gxLen = ConvertHex(gx, gxStr.size() / <span class="hljs-number">2</span>, gxStr.c_str());</li><li>    size_t gyLen = ConvertHex(gy, gyStr.size() / <span class="hljs-number">2</span>, gyStr.c_str());</li><li>    size_t aLen = ConvertHex(a, aStr.size() / <span class="hljs-number">2</span>, aStr.c_str());</li><li>    size_t bLen = ConvertHex(b, bStr.size() / <span class="hljs-number">2</span>, bStr.c_str());</li><li>    size_t nLen = ConvertHex(n, nStr.size() / <span class="hljs-number">2</span>, nStr.c_str());</li><li>    Crypto_DataBlob pData = {.<span class="hljs-keyword">data</span> = p, .len = pLen};</li><li>    Crypto_DataBlob aData = {.<span class="hljs-keyword">data</span> = a, .len = aLen};</li><li>    Crypto_DataBlob bData = {.<span class="hljs-keyword">data</span> = b, .len = bLen};</li><li>    Crypto_DataBlob gxData = {.<span class="hljs-keyword">data</span> = gx, .len = gxLen};</li><li>    Crypto_DataBlob gyData = {.<span class="hljs-keyword">data</span> = gy, .len = gyLen};</li><li>    Crypto_DataBlob nData = {.<span class="hljs-keyword">data</span> = n, .len = nLen};</li><li>    Crypto_DataBlob hData = {.<span class="hljs-keyword">data</span> = h, .len = sizeof(h)};</li><li>
</li><li>    OH_CryptoAsymKeySpec *keySpec = nullptr;</li><li>    OH_Crypto_ErrCode ret = OH_CryptoAsymKeySpec_Create(<span class="hljs-string">"ECC"</span>, CRYPTO_ASYM_KEY_COMMON_PARAMS_SPEC, &amp;keySpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_FP_P_DATABLOB, &amp;pData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_A_DATABLOB, &amp;aData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_B_DATABLOB, &amp;bData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_G_X_DATABLOB, &amp;gxData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_G_Y_DATABLOB, &amp;gyData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_N_DATABLOB, &amp;nData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = OH_CryptoAsymKeySpec_SetParam(keySpec, CRYPTO_ECC_H_INT, &amp;hData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoAsymKeyGeneratorWithSpec *generatorSpec = nullptr;</li><li>    ret = OH_CryptoAsymKeyGeneratorWithSpec_Create(keySpec, &amp;generatorSpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    OH_CryptoKeyPair *keyPair = nullptr;</li><li>    ret = OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair(generatorSpec, &amp;keyPair);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        OH_CryptoAsymKeyGeneratorWithSpec_Destroy(generatorSpec);</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    Crypto_DataBlob dataPkX = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataPkY = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataSk = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    ret = GetEccKeyParams(keyPair, &amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        FreeEccKeyParams(&amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>        OH_CryptoKeyPair_Destroy(keyPair);</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        OH_CryptoAsymKeyGeneratorWithSpec_Destroy(generatorSpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    FreeEccKeyParams(&amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>    Crypto_DataBlob dataP = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataA = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataB = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataGx = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataGy = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataN = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataH = {.<span class="hljs-keyword">data</span> = nullptr, .len = <span class="hljs-number">0</span>};</li><li>    ret = GetEccCommonParams(keyPair, &amp;dataP, &amp;dataA, &amp;dataB, &amp;dataGx, &amp;dataGy, &amp;dataN, &amp;dataH);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        FreeEccCommonParams(&amp;dataP, &amp;dataA, &amp;dataB, &amp;dataGx, &amp;dataGy, &amp;dataN, &amp;dataH);</li><li>        OH_CryptoKeyPair_Destroy(keyPair);</li><li>        OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>        OH_CryptoAsymKeyGeneratorWithSpec_Destroy(generatorSpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    FreeEccCommonParams(&amp;dataP, &amp;dataA, &amp;dataB, &amp;dataGx, &amp;dataGy, &amp;dataN, &amp;dataH);</li><li>    OH_CryptoKeyPair_Destroy(keyPair);</li><li>    OH_CryptoAsymKeySpec_Destroy(keySpec);</li><li>    OH_CryptoAsymKeyGeneratorWithSpec_Destroy(generatorSpec);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="根据椭圆曲线名生成sm2密钥对">根据椭圆曲线名生成SM2密钥对<i class="anchor-icon anchor-icon-link" anchorid="根据椭圆曲线名生成sm2密钥对" tips="复制节点链接"></i></h2>          <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#sm2">非对称密钥生成和转换规格：SM2</a>。</p>     <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_create" target="_blank">OH_CryptoAsymKeySpec_Create</a>，指定算法名为"SM2"， 密钥参数类型为CRYPTO_ASYM_KEY_KEY_PAIR_SPEC，创建密钥参数对象（keySpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_geneccommonparamsspec" target="_blank">OH_CryptoAsymKeySpec_GenEcCommonParamsSpec</a>，指定曲线为"NID_sm2"， 生成SM2公共参数对象（sm2CommonSpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_setcommonparamsspec" target="_blank">OH_CryptoAsymKeySpec_SetCommonParamsSpec</a>，将生成SM2公共参数对象（sm2CommonSpec）设置到密钥参数对象（keySpec）。</p></li>      <li>       <p>指定uint8_t类型的SM2密钥对数据（pkx、pky、sk），分别封装成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeyspec_setparam" target="_blank">OH_CryptoAsymKeySpec_SetParam</a>，指定参数类型分别为CRYPTO_ECC_PK_X_DATABLOB（pkx）、CRYPTO_ECC_PK_Y_DATABLOB（pky）、CRYPTO_ECC_SK_DATABLOB（sk）, 依次传入封装后的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-cryptocommonapi-crypto-datablob" target="_blank">Crypto_DataBlob</a>，设置到参数对象（keySpec）。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>pkx、pky、sk均要以大端模式输入，且必须为正数。</p>        </div></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_create" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_Create</a>，将参数对象（keySpec）传入，创建非对称密钥生成器（generatorSpec）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygeneratorwithspec_genkeypair" target="_blank">OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair</a>，生成SM2密钥对（keyPair）。</p></li>      <li>       <p>分别传入密钥对中的私钥和公钥，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkey_getparam" target="_blank">OH_CryptoPrivKey_GetParam</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptopubkey_getparam" target="_blank">OH_CryptoPubKey_GetParam</a>，获取SM2算法中私钥和公钥的各种密钥参数。</p></li>     </ol>     <div _ngcontent-ljb-c106="" class="highlight-div"><div _ngcontent-ljb-c106="" class="highlight-div-header"><div _ngcontent-ljb-c106="" class="highlight-div-header-left"><div _ngcontent-ljb-c106="" class="handle-button expand-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ljb-c106="" class="highlight-div-header-right"><div _ngcontent-ljb-c106="" class="handle-button ai-button"></div><div _ngcontent-ljb-c106="" class="handle-button line-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ljb-c106="" class="handle-button theme-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ljb-c106="" class="handle-button copy-button"><div _ngcontent-ljb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ljb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"CryptoArchitectureKit/crypto_architecture_kit.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> OH_Crypto_ErrCode <span class="hljs-title">GetEccKeyParams</span><span class="hljs-params">(OH_CryptoKeyPair *keyCtx, Crypto_DataBlob *pubKeyXData,</span></span></li><li><span class="hljs-function">                                         Crypto_DataBlob *pubKeyYData, Crypto_DataBlob *privKeyData)</span></li><li><span class="hljs-function"></span>{</li><li>    OH_CryptoPubKey *pubKey = <span class="hljs-built_in">OH_CryptoKeyPair_GetPubKey</span>(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (pubKey == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    OH_Crypto_ErrCode ret = <span class="hljs-built_in">OH_CryptoPubKey_GetParam</span>(pubKey, CRYPTO_ECC_PK_X_DATABLOB, pubKeyXData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoPubKey_GetParam</span>(pubKey, CRYPTO_ECC_PK_Y_DATABLOB, pubKeyYData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoPrivKey *privKey = <span class="hljs-built_in">OH_CryptoKeyPair_GetPrivKey</span>(keyCtx);</li><li>    <span class="hljs-keyword">if</span> (privKey == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoPrivKey_GetParam</span>(privKey, CRYPTO_ECC_SK_DATABLOB, privKeyData);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">FreeEccKeyParams</span><span class="hljs-params">(Crypto_DataBlob *pubKeyXData, Crypto_DataBlob *pubKeyYData, Crypto_DataBlob *privKeyData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(pubKeyXData);</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(pubKeyYData);</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(privKeyData);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">ConvertHex</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span>* dest, <span class="hljs-type">size_t</span> count, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* src)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> i;</li><li>    <span class="hljs-type">int</span> value;</li><li>
</li><li>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; count &amp;&amp; <span class="hljs-built_in">sscanf</span>(src + i * <span class="hljs-number">2</span>, <span class="hljs-string">"%2x"</span>, &amp;value) == <span class="hljs-number">1</span>; i++) {</li><li>        dest[i] = value;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> i;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> OH_Crypto_ErrCode <span class="hljs-title">doTestSm2GenKeyPairBySpec</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    std::string pkXStr = <span class="hljs-string">"67F3B850BDC0BA5D3A29D8A0883C4B17612AB84F87F18E28F77D824A115C02C4"</span>;</li><li>    std::string pkYStr = <span class="hljs-string">"D48966CE754BBBEDD6501A1385E1B205C186E926ADED44287145E8897D4B2071"</span>;</li><li>    std::string skStr = <span class="hljs-string">"6330B599ECD23ABDC74B9A5B7B5E00E553005F72743101C5FAB83AEB579B7074"</span>;</li><li>    <span class="hljs-type">uint8_t</span> pkX[<span class="hljs-number">256</span>] = {};</li><li>    <span class="hljs-type">uint8_t</span> pkY[<span class="hljs-number">256</span>] = {};</li><li>    <span class="hljs-type">uint8_t</span> sk[<span class="hljs-number">256</span>] = {};</li><li>    <span class="hljs-type">size_t</span> pkXLen = <span class="hljs-built_in">ConvertHex</span>(pkX, pkXStr.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>, pkXStr.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-type">size_t</span> pkYLen = <span class="hljs-built_in">ConvertHex</span>(pkY, pkYStr.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>, pkYStr.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-type">size_t</span> skLen = <span class="hljs-built_in">ConvertHex</span>(sk, skStr.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span>, skStr.<span class="hljs-built_in">c_str</span>());</li><li>    Crypto_DataBlob pkXData = {.data = pkX, .len = pkXLen};</li><li>    Crypto_DataBlob pkYData = {.data = pkY, .len = pkYLen};</li><li>    Crypto_DataBlob skData = {.data = sk, .len = skLen};</li><li>
</li><li>    OH_CryptoAsymKeySpec *keySpec = <span class="hljs-literal">nullptr</span>;</li><li>    OH_Crypto_ErrCode ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_Create</span>(<span class="hljs-string">"SM2"</span>, CRYPTO_ASYM_KEY_KEY_PAIR_SPEC, &amp;keySpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    OH_CryptoAsymKeySpec *sm2CommonSpec = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_GenEcCommonParamsSpec</span>(<span class="hljs-string">"NID_sm2"</span>, &amp;sm2CommonSpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetCommonParamsSpec</span>(keySpec, sm2CommonSpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetParam</span>(keySpec, CRYPTO_ECC_PK_X_DATABLOB, &amp;pkXData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetParam</span>(keySpec, CRYPTO_ECC_PK_Y_DATABLOB, &amp;pkYData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeySpec_SetParam</span>(keySpec, CRYPTO_ECC_SK_DATABLOB, &amp;skData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoAsymKeyGeneratorWithSpec *generatorSpec = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Create</span>(keySpec, &amp;generatorSpec);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    OH_CryptoKeyPair *keyPair = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_GenKeyPair</span>(generatorSpec, &amp;keyPair);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    Crypto_DataBlob dataPkX = {.data = <span class="hljs-literal">nullptr</span>, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataPkY = {.data = <span class="hljs-literal">nullptr</span>, .len = <span class="hljs-number">0</span>};</li><li>    Crypto_DataBlob dataSk = {.data = <span class="hljs-literal">nullptr</span>, .len = <span class="hljs-number">0</span>};</li><li>    ret = <span class="hljs-built_in">GetEccKeyParams</span>(keyPair, &amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">FreeEccKeyParams</span>(&amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-built_in">FreeEccKeyParams</span>(&amp;dataPkX, &amp;dataPkY, &amp;dataSk);</li><li>    <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeyGeneratorWithSpec_Destroy</span>(generatorSpec);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(sm2CommonSpec);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeySpec_Destroy</span>(keySpec);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>