<h1 _ngcontent-coh-c119="" class="doc-title ng-star-inserted" title="振动开发指导(C/C++)"> 振动开发指导(C/C++) </h1>

<div _ngcontent-coh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>当设备需要设置不同的振动效果时，可以调用Vibrator模块，例如：设备的按键可以设置不同强度和不同时长的振动，闹钟和来电可以设置不同强度和时长的单次或周期振动。</p>     <p>详细的接口介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-vibrator" target="_blank">Vibrator接口</a>。</p>    </div>    <div class="tiledSection">     <h2 id="函数说明">函数说明<i class="anchor-icon anchor-icon-link" anchorid="函数说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OHOS::Sensors::OH_Vibrator_PlayVibration(int32_t duration, Vibrator_Attribute attribute)</td>         <td class="cellrowborder" valign="top" width="50%">控制马达在指定时间内持续振动。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OHOS::Sensors::OH_Vibrator_PlayVibrationCustom(Vibrator_FileDescription fileDescription, Vibrator_Attribute vibrateAttribute)</td>         <td class="cellrowborder" valign="top" width="50%">播放自定义振动序列。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OHOS::Sensors::OH_Vibrator_Cancel()</td>         <td class="cellrowborder" valign="top" width="50%">停止马达振动。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="振动效果说明">振动效果说明<i class="anchor-icon anchor-icon-link" anchorid="振动效果说明" tips="复制节点链接"></i></h2>          <p>目前支持两类振动效果，如下所示。</p>    </div>    <div class="tiledSection">     <h3 id="固定时长振动" class="firsth2">固定时长振动<i class="anchor-icon anchor-icon-link" anchorid="固定时长振动" tips="复制节点链接"></i></h3>          <p>传入一个固定时长，马达按照默认强度和频率触发振动。</p>    </div>    <div class="tiledSection">     <h3 id="自定义振动">自定义振动<i class="anchor-icon anchor-icon-link" anchorid="自定义振动" tips="复制节点链接"></i></h3>          <p>自定义振动提供给用户设计自己所需振动效果的能力，用户可通过自定义振动配置文件，并遵循相应规则编排所需振动形式，使能更加开放的振感交互体验。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>新建一个Native C++工程。</p>       <p><span><img originheight="1015" originwidth="1633" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115048.87922645839691006157567817031186:50001231000000:2800:E1F82CE1728F4AB5EFB3A932C56B57324CB2ACDC599E7B94B020BEDD00D5E2AB.png" width="920" height="571.830985915493"></span></p></li>      <li>       <p>控制设备上的振动器，需要申请权限ohos.permission.VIBRATE。具体配置方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.VIBRATE"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">]</span></li></ol></pre></div></div></li>      <li>       <p>CMakeLists.txt文件中引入动态依赖库。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libace_napi.z.so)</li><li>target_link_libraries(entry PUBLIC libhilog_ndk.z.so)</li><li>target_link_libraries(entry PUBLIC libohvibrator.z.so)</li></ol></pre></div></div></li>      <li>       <p>导入模块。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sensors/vibrator.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>定义常量。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">const</span> <span class="hljs-type">int</span> GLOBAL_RESMGR = <span class="hljs-number">0xFF00</span>;</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">"[NativeVibratorTest]"</span>;</li><li>constexpr <span class="hljs-type">int32_t</span> TIME_WAIT_FOR_OP = <span class="hljs-number">2</span>;</li></ol></pre></div></div></li>      <li>       <p>控制马达在指定时间内持续振动和停止马达振动。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">Vibration_Test</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>    Vibrator_Attribute vibrateAttribute;</li><li>    vibrateAttribute.usage = VIBRATOR_USAGE_ALARM;</li><li>
</li><li>    <span class="hljs-type">int32_t</span> ret = OH_Vibrator_PlayVibration(<span class="hljs-number">0</span>, vibrateAttribute); <span class="hljs-comment">// 控制马达在指定时间内持续振动。</span></li><li>    OH_LOG_Print(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"Vibration successful"</span>);</li><li>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">return</span> nullptr;</li><li>    }</li><li>    <span class="hljs-built_in">std</span>::this_thread::sleep_for(<span class="hljs-built_in">std</span>::chrono::milliseconds(TIME_WAIT_FOR_OP));</li><li>    ret = OH_Vibrator_Cancel(); <span class="hljs-comment">// 停止马达振动。</span></li><li>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">return</span> nullptr;</li><li>    }</li><li>    napi_value result = nullptr;</li><li>    napi_create_int32(env, ret, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>播放自定义振动序列。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">VibrationCustom_Test</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>    <span class="hljs-type">int32_t</span> ret = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">int32_t</span> fd = open(<span class="hljs-string">"/data/test/vibrator/coin_drop.json"</span>, O_RDONLY);</li><li>    OH_LOG_Print(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"Test fd:%{public}d"</span>, fd);</li><li>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat64</span> <span class="hljs-title">statbuf</span> =</span> { <span class="hljs-number">0</span> };</li><li>    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {</li><li>        OH_LOG_Print(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"File open failed"</span>);</li><li>        <span class="hljs-keyword">return</span> nullptr;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (fstat64(fd, &amp;statbuf) == <span class="hljs-number">0</span>) {</li><li>        Vibrator_FileDescription fileDescription = {</li><li>            .fd = fd,</li><li>            .offset = <span class="hljs-number">0</span>,</li><li>            .length = statbuf.st_size</li><li>        };</li><li>        Vibrator_Attribute vibrateAttribute = {</li><li>            .usage = VIBRATOR_USAGE_RING</li><li>        };</li><li>        ret = OH_Vibrator_PlayVibrationCustom(fileDescription, vibrateAttribute); <span class="hljs-comment">// 播放自定义振动序列。</span></li><li>        OH_LOG_Print(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"Vibratecustom successful"</span>);</li><li>        <span class="hljs-type">bool</span> isSuccess = ((ret == <span class="hljs-number">0</span>) || (ret == UNSUPPORTED));</li><li>        <span class="hljs-keyword">if</span> (isSuccess == <span class="hljs-literal">true</span>) {</li><li>            close(fd);</li><li>            <span class="hljs-keyword">return</span> nullptr;</li><li>        }</li><li>    }</li><li>    <span class="hljs-built_in">std</span>::this_thread::sleep_for(<span class="hljs-built_in">std</span>::chrono::milliseconds(TIME_WAIT_FOR_OP));</li><li>    close(fd);</li><li>    OH_Vibrator_Cancel(); <span class="hljs-comment">// 停止马达振动。</span></li><li>    napi_value result = nullptr;</li><li>    napi_create_int32(env, ret, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在types/libentry路径下index.d.ts文件中引入Napi接口。</p>       <div _ngcontent-coh-c106="" class="highlight-div"><div _ngcontent-coh-c106="" class="highlight-div-header"><div _ngcontent-coh-c106="" class="highlight-div-header-left"><div _ngcontent-coh-c106="" class="handle-button expand-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-coh-c106="" class="highlight-div-header-right"><div _ngcontent-coh-c106="" class="handle-button ai-button"></div><div _ngcontent-coh-c106="" class="handle-button line-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-coh-c106="" class="handle-button theme-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-coh-c106="" class="handle-button copy-button"><div _ngcontent-coh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-coh-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>export <span class="hljs-type">const</span> vibration_Test: () =&gt; number;</li><li>export <span class="hljs-type">const</span> vibrationCustom_Test: () =&gt; number;</li></ol></pre></div></div></li>      <li>       <p>编写Js用例调用接口。</p></li>     </ol>    </div>   </div>   <div></div></div>