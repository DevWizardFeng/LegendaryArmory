<h1 _ngcontent-vtv-c119="" class="doc-title ng-star-inserted" title="授权持久化(C/C++)"> 授权持久化(C/C++) </h1>

<div _ngcontent-vtv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>应用通过Picker获取临时授权，临时授权在应用退出后或者设备重启后会清除。如果应用重启或者设备重启后需要直接访问之前已访问过的文件，则对文件进行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/file-persistpermission#场景介绍">持久化授权</a>。FileShare提供了支持基于uri的文件及目录授予持久化权限、权限激活、权限查询等方法。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>接口的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-file-share-h" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_PersistPermission(const FileShare_PolicyInfo *policies, unsigned int policyNum, FileShare_PolicyErrorResult **result, unsigned int *resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">对所选择的多个文件或目录uri持久化授权。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_RevokePermission(const FileShare_PolicyInfo *policies, unsigned int policyNum, FileShare_PolicyErrorResult **result, unsigned int *resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">对所选择的多个文件或目录uri取消持久化授权。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_ActivatePermission(const FileShare_PolicyInfo *policies, unsigned int policyNum, FileShare_PolicyErrorResult **result, unsigned int *resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">使能多个已经永久授权过的文件或目录uri。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_DeactivatePermission(const FileShare_PolicyInfo *policies, unsigned int policyNum, FileShare_PolicyErrorResult **result, unsigned int *resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">取消使能授权过的多个文件或目录uri。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_CheckPersistentPermission(const FileShare_PolicyInfo *policies, unsigned int policyNum, bool **result, unsigned int *resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">校验所选择的多个文件或目录uri的持久化权限结果。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_FileShare_ReleasePolicyErrorResult(FileShare_PolicyErrorResult *errorResult, unsigned int resultNum)</td>         <td class="cellrowborder" valign="top" width="50%">释放FileShare_PolicyErrorResult内存。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>使用文件分享的相关接口，需确认设备具有以下系统能力：SystemCapability.FileManagement.AppFileService.FolderAuthorization。</p></li>      <li>       <p>在调用文件分享的相关接口前，需要申请权限："ohos.permission.FILE_ACCESS_PERSIST"，申请方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/determine-application-mode">访问控制-申请应用权限</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>以下步骤描述了如何使用FileShare提供的Native API接口。</p>     <p><strong>添加动态链接库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(sample PUBLIC libohfileshare.so)</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filemanagement/fileshare/oh_file_share.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>创建FileShare_PolicyInfo实例,调用OH_FileShare_PersistPermission接口，设置uri的持久化授权，接口入参policyNum最大上限为500。       <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">POLICY_NUM</span> = <span class="hljs-number">2</span>;</li><li><span class="hljs-variable">char</span> <span class="hljs-variable">strTestPath1</span>[] = <span class="hljs-string">"file://com.example.fileshare/data/storage/el2/base/files/test1.txt"</span>;</li><li><span class="hljs-variable">char</span> <span class="hljs-variable">strTestPath2</span>[] = <span class="hljs-string">"file://com.example.fileshare/data/storage/el2/base/files/test2.txt"</span>;</li><li><span class="hljs-variable">FileShare_PolicyInfo</span> <span class="hljs-variable">policy</span>[<span class="hljs-variable">POLICY_NUM</span>] = {</li><li>    {<span class="hljs-variable">strTestPath1</span>, <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">unsigned</span> <span class="hljs-title class_">int</span>&gt;(<span class="hljs-title function_">strlen</span>(<span class="hljs-variable">strTestPath1</span>)), <span class="hljs-variable">FileShare_OperationMode</span>::<span class="hljs-title class_">READ_MODE</span>},</li><li>    {<span class="hljs-variable">strTestPath2</span>, <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">unsigned</span> <span class="hljs-title class_">int</span>&gt;(<span class="hljs-title function_">strlen</span>(<span class="hljs-variable">strTestPath2</span>)), <span class="hljs-variable">FileShare_OperationMode</span>::<span class="hljs-title class_">WRITE_MODE</span>}};</li><li><span class="hljs-variable">FileShare_PolicyErrorResult</span>* <span class="hljs-variable">result</span> = <span class="hljs-variable">nullptr</span>;</li><li><span class="hljs-variable">uint32_t</span> <span class="hljs-variable">resultNum</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-variable">auto</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_FileShare_PersistPermission</span>(<span class="hljs-variable">policy</span>, <span class="hljs-variable">POLICY_NUM</span>, &amp;<span class="hljs-title class_">result</span>, &amp;<span class="hljs-title class_">resultNum</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">ERR_OK</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> == <span class="hljs-variable">ERR_EPERM</span> &amp;&amp; <span class="hljs-variable">result</span> != <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">uint32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">resultNum</span>; <span class="hljs-title class_">i</span>++) {</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error uri: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">uri</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error code: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">code</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error message: "</span> &lt;&lt; <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">message</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-title function_">OH_FileShare_ReleasePolicyErrorResult</span>(<span class="hljs-variable">result</span>, <span class="hljs-variable">resultNum</span>);</li></ol></pre></div></div></li>      <li>调用OH_FileShare_ActivatePermission接口，激活已授权过的uri，接口入参policyNum最大上限为500。       <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">auto</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_FileShare_ActivatePermission</span>(<span class="hljs-variable">policy</span>, <span class="hljs-variable">POLICY_NUM</span>, &amp;<span class="hljs-title class_">result</span>, &amp;<span class="hljs-title class_">resultNum</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">ERR_OK</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> == <span class="hljs-variable">ERR_EPERM</span> &amp;&amp; <span class="hljs-variable">result</span> != <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">uint32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">resultNum</span>; <span class="hljs-title class_">i</span>++) {</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error uri: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">uri</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error code: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">code</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error message: "</span> &lt;&lt; <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">message</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-title function_">OH_FileShare_ReleasePolicyErrorResult</span>(<span class="hljs-variable">result</span>, <span class="hljs-variable">resultNum</span>);</li></ol></pre></div></div></li>      <li>调用OH_FileShare_DeactivatePermission接口，停止已启用授权过uri的访问权限，接口入参policyNum最大上限为500。       <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">auto</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_FileShare_DeactivatePermission</span>(<span class="hljs-variable">policy</span>, <span class="hljs-variable">POLICY_NUM</span>, &amp;<span class="hljs-title class_">result</span>, &amp;<span class="hljs-title class_">resultNum</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">ERR_OK</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> == <span class="hljs-variable">ERR_EPERM</span> &amp;&amp; <span class="hljs-variable">result</span> != <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">uint32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">resultNum</span>; <span class="hljs-title class_">i</span>++) {</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error uri: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">uri</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error code: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">code</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error message: "</span> &lt;&lt; <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">message</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-title function_">OH_FileShare_ReleasePolicyErrorResult</span>(<span class="hljs-variable">result</span>, <span class="hljs-variable">resultNum</span>);</li></ol></pre></div></div></li>      <li>调用OH_FileShare_RevokePermission接口，撤销已经授权的uri持久化权限，接口入参policyNum最大上限为500。       <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">auto</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_FileShare_RevokePermission</span>(<span class="hljs-variable">policy</span>, <span class="hljs-variable">POLICY_NUM</span>, &amp;<span class="hljs-title class_">result</span>, &amp;<span class="hljs-title class_">resultNum</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">ERR_OK</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> == <span class="hljs-variable">ERR_EPERM</span> &amp;&amp; <span class="hljs-variable">result</span> != <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-keyword">for</span>(<span class="hljs-variable">uint32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">resultNum</span>; <span class="hljs-title class_">i</span>++) {</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error uri: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">uri</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error code: "</span> &lt;&lt;  <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">code</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>            <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span> &lt;&lt; <span class="hljs-string">"error message: "</span> &lt;&lt; <span class="hljs-title class_">result</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">message</span> &lt;&lt; <span class="hljs-variable">std</span>::<span class="hljs-title class_">endl</span>;</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-title function_">OH_FileShare_ReleasePolicyErrorResult</span>(<span class="hljs-variable">result</span>, <span class="hljs-variable">resultNum</span>);</li></ol></pre></div></div></li>      <li>调用OH_FileShare_CheckPersistentPermission接口，检查uri持久化权限，接口入参policyNum最大上限为500。       <div _ngcontent-vtv-c106="" class="highlight-div"><div _ngcontent-vtv-c106="" class="highlight-div-header"><div _ngcontent-vtv-c106="" class="highlight-div-header-left"><div _ngcontent-vtv-c106="" class="handle-button expand-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vtv-c106="" class="highlight-div-header-right"><div _ngcontent-vtv-c106="" class="handle-button ai-button"></div><div _ngcontent-vtv-c106="" class="handle-button line-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vtv-c106="" class="handle-button theme-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vtv-c106="" class="handle-button copy-button"><div _ngcontent-vtv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vtv-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">bool</span> *result = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-keyword">auto</span> ret = <span class="hljs-built_in">OH_FileShare_CheckPersistentPermission</span>(policy, POLICY_NUM, &amp;result, &amp;resultNum);</li><li><span class="hljs-keyword">if</span> (result != <span class="hljs-literal">nullptr</span> &amp;&amp; resultNum &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; resultNum &amp;&amp; resultNum &lt;= POLICY_NUM; i++) {</li><li>        std::cout &lt;&lt; <span class="hljs-string">"uri: "</span> &lt;&lt;  policy[i].uri &lt;&lt; std::endl;</li><li>        std::cout &lt;&lt; <span class="hljs-string">"result: "</span> &lt;&lt;  result[i] &lt;&lt; std::endl;</li><li>    }</li><li>}</li><li>std::cout &lt;&lt; <span class="hljs-string">"retCode: "</span> &lt;&lt;  ret &lt;&lt; std::endl;</li><li><span class="hljs-built_in">free</span>(result);</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>