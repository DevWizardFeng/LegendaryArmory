<h1 _ngcontent-vyd-c119="" class="doc-title ng-star-inserted" title="授权持久化"> 授权持久化 </h1>

<div _ngcontent-vyd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>应用通过Picker获取临时授权，临时授权在应用退出后或者设备重启后会清除。如果应用重启或者设备重启后需要直接访问之前已访问过的文件，则对文件进行持久化授权。</p>    </div>    <div class="tiledSection">     <h2 id="通过picker获取临时授权并进行授权持久化">通过Picker获取临时授权并进行授权持久化<i class="anchor-icon anchor-icon-link" anchorid="通过picker获取临时授权并进行授权持久化" tips="复制节点链接"></i></h2>          <p>通过Picker选择文件或文件夹进行临时授权，然后应用可以按需通过文件分享接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-fileshare" target="_blank">ohos.fileshare</a>）进行持久化授权。</p>     <p>1.应用仅临时需要访问公共目录的数据，例如：通讯类应用需要发送用户的文件或者图片。应用调用Picker的(<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-picker#select-3" target="_blank">select</a>)接口选择需要发送的文件或者图片，此时应用获取到是该文件的临时访问权限，应用重启或者设备重启后，再次访问该文件则仍需使用Picker进行文件选择。</p>     <p>2.应用如果需要长期访问某个文件或目录时，可以通过Picker选择文件或文件夹进行临时授权，然后利用persistPermission接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-fileshare#filesharepersistpermission11" target="_blank">ohos.fileshare.persistPermission</a>）对授权进行持久化（在授权方同意被持久化的情况下），例如：文档编辑类应用本次编辑完一个用户文件，期望在历史记录中可以直接选中打开，无需再拉起Picker进行选择授权。</p>     <p>可使用canIUse接口，确认设备是否具有以下系统能力：SystemCapability.FileManagement.AppFileService.FolderAuthorization。</p>     <div _ngcontent-vyd-c106="" class="highlight-div"><div _ngcontent-vyd-c106="" class="highlight-div-header"><div _ngcontent-vyd-c106="" class="highlight-div-header-left"><div _ngcontent-vyd-c106="" class="handle-button expand-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vyd-c106="" class="highlight-div-header-right"><div _ngcontent-vyd-c106="" class="handle-button ai-button"></div><div _ngcontent-vyd-c106="" class="handle-button line-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vyd-c106="" class="handle-button theme-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vyd-c106="" class="handle-button copy-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (!<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.FileManagement.AppFileService.FolderAuthorization'</span>)) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'this api is not supported on this device'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div>     <p><strong>需要权限</strong></p>     <p>ohos.permission.FILE_ACCESS_PERSIST，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/determine-application-mode">访问控制-申请应用权限</a>。</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vyd-c106="" class="highlight-div"><div _ngcontent-vyd-c106="" class="highlight-div-header"><div _ngcontent-vyd-c106="" class="highlight-div-header-left"><div _ngcontent-vyd-c106="" class="handle-button expand-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vyd-c106="" class="highlight-div-header-right"><div _ngcontent-vyd-c106="" class="handle-button ai-button"></div><div _ngcontent-vyd-c106="" class="handle-button line-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vyd-c106="" class="handle-button theme-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vyd-c106="" class="handle-button copy-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { picker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">persistPermissionExample</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-title class_">DocumentSelectOptions</span> = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentSelectOptions</span>();</li><li>        <span class="hljs-keyword">let</span> documentPicker = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentViewPicker</span>();</li><li>        <span class="hljs-keyword">let</span> uris = <span class="hljs-keyword">await</span> documentPicker.<span class="hljs-title function_">select</span>(<span class="hljs-title class_">DocumentSelectOptions</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policyInfo</span>: fileShare.<span class="hljs-property">PolicyInfo</span> = {</li><li>            <span class="hljs-attr">uri</span>: uris[<span class="hljs-number">0</span>],</li><li>            <span class="hljs-attr">operationMode</span>: fileShare.<span class="hljs-property">OperationMode</span>.<span class="hljs-property">READ_MODE</span>,</li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policies</span>: <span class="hljs-title class_">Array</span>&lt;fileShare.<span class="hljs-property">PolicyInfo</span>&gt; = [policyInfo];</li><li>        fileShare.<span class="hljs-title function_">persistPermission</span>(policies).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"persistPermission successfully"</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError&lt;<span class="hljs-built_in">Array</span>&lt;fileShare.PolicyErrorResult&gt;&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"persistPermission failed with error message: "</span> + err.<span class="hljs-property">message</span> + <span class="hljs-string">", error code: "</span> + err.<span class="hljs-property">code</span>);</li><li>            <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> == <span class="hljs-number">13900001</span> &amp;&amp; err.<span class="hljs-property">data</span>) {</li><li>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; err.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>; i++) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error code : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">code</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error uri : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">uri</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error reason : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">message</span>));</li><li>                }</li><li>            }</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`persistPermission failed with err, Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ol>        <li>持久化授权文件信息建议应用在本地存储数据，供后续按需激活持久化文件。</li>        <li>持久化授权的数据存储在系统的数据库中，应用或者设备重启后需要激活已持久化的授权才可以正常使用<a href="/consumer/cn/doc/harmonyos-guides/file-persistpermission#激活已经持久化的权限访问文件或目录">激活持久化授权</a>。</li>        <li>持久化权限接口(可以使用canIUse接口进行校验能力是否可用)，且需要申请对应的权限。</li>        <li>应用在卸载时会将之前的授权数据全部清除，重新安装后需要重新授权。</li>       </ol>      </div></div></div>     <p><strong>备注</strong>：C/C++持久化授权接口说明及开发指南具体参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/native-fileshare-guidelines">OH_FileShare_PersistPermission持久化授权接口</a>。</p>     <p>3.可以通过revokePermission接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-fileshare#filesharerevokepermission11" target="_blank">ohos.fileshare.revokePermission</a>）对已持久化的文件取消授权，同时更新应用存储的数据以删除最近访问数据。</p>     <p><strong>需要权限</strong></p>     <p>ohos.permission.FILE_ACCESS_PERSIST，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/determine-application-mode">访问控制-申请应用权限</a>。</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vyd-c106="" class="highlight-div"><div _ngcontent-vyd-c106="" class="highlight-div-header"><div _ngcontent-vyd-c106="" class="highlight-div-header-left"><div _ngcontent-vyd-c106="" class="handle-button expand-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vyd-c106="" class="highlight-div-header-right"><div _ngcontent-vyd-c106="" class="handle-button ai-button"></div><div _ngcontent-vyd-c106="" class="handle-button line-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vyd-c106="" class="handle-button theme-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vyd-c106="" class="handle-button copy-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { picker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">revokePermissionExample</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> uri = <span class="hljs-string">"file://docs/storage/Users/username/tmp.txt"</span>;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policyInfo</span>: fileShare.<span class="hljs-property">PolicyInfo</span> = {</li><li>            <span class="hljs-attr">uri</span>: uri,</li><li>            <span class="hljs-attr">operationMode</span>: fileShare.<span class="hljs-property">OperationMode</span>.<span class="hljs-property">READ_MODE</span>,</li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policies</span>: <span class="hljs-title class_">Array</span>&lt;fileShare.<span class="hljs-property">PolicyInfo</span>&gt; = [policyInfo];</li><li>        fileShare.<span class="hljs-title function_">revokePermission</span>(policies).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"revokePermission successfully"</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError&lt;<span class="hljs-built_in">Array</span>&lt;fileShare.PolicyErrorResult&gt;&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"revokePermission failed with error message: "</span> + err.<span class="hljs-property">message</span> + <span class="hljs-string">", error code: "</span> + err.<span class="hljs-property">code</span>);</li><li>            <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> == <span class="hljs-number">13900001</span> &amp;&amp; err.<span class="hljs-property">data</span>) {</li><li>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; err.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>; i++) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error code : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">code</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error uri : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">uri</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error reason : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">message</span>));</li><li>                }</li><li>            }</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`revokePermission failed with err, Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ol>        <li>示例中的URI来源自应用存储的持久化数据中。</li>        <li>建议按照使用需求去激活对应的持久化权限，不要盲目的全量激活。</li>        <li>持久化权限接口(可以使用canIUse接口进行校验能力是否可用)，且需要申请对应的权限。</li>       </ol>      </div></div></div>     <p><strong>备注</strong>：C/C++去持久化授权接口说明及开发指南具体参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/native-fileshare-guidelines">OH_FileShare_RevokePermission去持久化授权接口</a>。</p>    </div>    <div class="tiledSection">     <h2 id="激活已经持久化的权限访问文件或目录">激活已经持久化的权限访问文件或目录<i class="anchor-icon anchor-icon-link" anchorid="激活已经持久化的权限访问文件或目录" tips="复制节点链接"></i></h2>          <p>对于应用已经持久化的授权，应用每次启动时实际未加载到内存中，需要应用按需进行手动激活已持久化授权的权限，通过activatePermission接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-fileshare#fileshareactivatepermission11" target="_blank">ohos.fileshare.activatePermission</a>）对已经持久化授权的权限进行使能操作，否则已经持久化授权的权限仍存在不能使用的情况。</p>     <p><strong>需要权限</strong></p>     <p>ohos.permission.FILE_ACCESS_PERSIST，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/determine-application-mode">访问控制-申请应用权限</a>。</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vyd-c106="" class="highlight-div"><div _ngcontent-vyd-c106="" class="highlight-div-header"><div _ngcontent-vyd-c106="" class="highlight-div-header-left"><div _ngcontent-vyd-c106="" class="handle-button expand-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vyd-c106="" class="highlight-div-header-right"><div _ngcontent-vyd-c106="" class="handle-button ai-button"></div><div _ngcontent-vyd-c106="" class="handle-button line-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vyd-c106="" class="handle-button theme-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vyd-c106="" class="handle-button copy-button"><div _ngcontent-vyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { picker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">activatePermissionExample</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> uri = <span class="hljs-string">"file://docs/storage/Users/username/tmp.txt"</span>;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policyInfo</span>: fileShare.<span class="hljs-property">PolicyInfo</span> = {</li><li>            <span class="hljs-attr">uri</span>: uri,</li><li>            <span class="hljs-attr">operationMode</span>: fileShare.<span class="hljs-property">OperationMode</span>.<span class="hljs-property">READ_MODE</span>,</li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">policies</span>: <span class="hljs-title class_">Array</span>&lt;fileShare.<span class="hljs-property">PolicyInfo</span>&gt; = [policyInfo];</li><li>        fileShare.<span class="hljs-title function_">activatePermission</span>(policies).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"activatePermission successfully"</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError&lt;<span class="hljs-built_in">Array</span>&lt;fileShare.PolicyErrorResult&gt;&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"activatePermission failed with error message: "</span> + err.<span class="hljs-property">message</span> + <span class="hljs-string">", error code: "</span> + err.<span class="hljs-property">code</span>);</li><li>            <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> == <span class="hljs-number">13900001</span> &amp;&amp; err.<span class="hljs-property">data</span>) {</li><li>                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; err.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>; i++) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error code : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">code</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error uri : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">uri</span>));</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error reason : "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err.<span class="hljs-property">data</span>[i].<span class="hljs-property">message</span>));</li><li>                    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">data</span>[i].<span class="hljs-property">code</span> == fileShare.<span class="hljs-property">PolicyErrorCode</span>.<span class="hljs-property">PERMISSION_NOT_PERSISTED</span>) {</li><li>                        <span class="hljs-comment">//可以选择进行持久化后再激活。</span></li><li>                    }</li><li>                }</li><li>            }</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`activatePermission failed with err, Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ol>        <li>示例中的URI来源自应用存储的持久化数据中。</li>        <li>建议按照使用需求去激活对应的持久化权限，不要盲目的全量激活。</li>        <li>如果激活失败显示未持久化的权限可以按照示例进行持久化。</li>        <li>持久化权限接口可以使用canIUse接口进行校验能力是否可用，且需要申请对应的权限。</li>       </ol>      </div></div></div>     <p><strong>备注</strong>：C/C++持久化授权激活接口说明及开发指南具体参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/native-fileshare-guidelines">OH_FileShare_ActivatePermission持久化授权激活接口</a>。</p>    </div>   </div>   <div></div></div>