<h1 _ngcontent-evg-c119="" class="doc-title ng-star-inserted" title="接入全局取色"> 接入全局取色 </h1>

<div _ngcontent-evg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>接入全局取色功能，用户可以使用手指或者手写笔操作取色器在屏幕上移动，在目标位置抬起手指/抬起手写笔，会生成该位置色值对应的图像信息。</p>    <div class="tiledSection">     <h2 id="section1620318908">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1620318908" tips="复制节点链接"></i></h2>          <p>在应用中拉起全局取色，效果如下：</p>     <p><span><img height="327.18" originheight="1600" originwidth="2560" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115034.13023406815176326521566862560545:50001231000000:2800:94E54A2318B2635A47253A967B85C62F01A04E3B36A5CF6D809B943E55060DDB.png" title="点击放大" width="523.6875"></span></p>     <p>支持获取当前屏幕上选中位置的色值和色域空间。</p>    </div>    <div class="tiledSection">     <h2 id="section6138152262312">限制与约束<i class="anchor-icon anchor-icon-link" anchorid="section6138152262312" tips="复制节点链接"></i></h2>          <p>全局取色能力支持设备：Tablet、PC/2in1，并且从5.1.1(19)版本开始，新增支持设备：Phone（只支持部分机型）。</p>    </div>    <div class="tiledSection">     <h2 id="section193671730192415">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section193671730192415" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>int32_t <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-imagefeaturepicker-c#ga4c202f3df255013b9920f26027065176" target="_blank">HMS_GCP_StartColorPicker</a> (int32_t initialPosX, int32_t initialPosY, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-imagefeaturepicker-c#gac06acd25757a5a72f4f8d0aec5821a52" target="_blank">HMS_GCP_OnResult</a> onResultCallback, void *userData)</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>启动取色器。此API用于启动取色器，在取色器移动时不显示色值。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>int32_t <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-imagefeaturepicker-c#ga8b044a1cfcd3b6eb8461e70c66d2c578" target="_blank">HMS_GCP_StartColorPickerWithColorValue</a> (int32_t initialPosX, int32_t initialPosY, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-imagefeaturepicker-c#gac06acd25757a5a72f4f8d0aec5821a52" target="_blank">HMS_GCP_OnResult</a> onResultCallback, void *userData)</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>启动取色器。此API用于启动取色器，在取色器移动时显示色值。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section175011055153620">接入步骤<i class="anchor-icon anchor-icon-link" anchorid="section175011055153620" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section5362542578" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="section5362542578" tips="复制节点链接"></i></h3>          <div _ngcontent-evg-c106="" class="highlight-div"><div _ngcontent-evg-c106="" class="highlight-div-header"><div _ngcontent-evg-c106="" class="highlight-div-header-left"><div _ngcontent-evg-c106="" class="handle-button expand-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-evg-c106="" class="highlight-div-header-right"><div _ngcontent-evg-c106="" class="handle-button ai-button"></div><div _ngcontent-evg-c106="" class="handle-button line-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-evg-c106="" class="handle-button theme-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-evg-c106="" class="handle-button copy-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-evg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-built_in">target_link_libraries</span></span>(entry <span class="">PUBLIC </span>libace_napi.z.so libcolorpicker_ndk.z.so  libhilog_ndk.z.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section2664315183914">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section2664315183914" tips="复制节点链接"></i></h3>          <div _ngcontent-evg-c106="" class="highlight-div"><div _ngcontent-evg-c106="" class="highlight-div-header"><div _ngcontent-evg-c106="" class="highlight-div-header-left"><div _ngcontent-evg-c106="" class="handle-button expand-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-evg-c106="" class="highlight-div-header-right"><div _ngcontent-evg-c106="" class="handle-button ai-button"></div><div _ngcontent-evg-c106="" class="handle-button line-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-evg-c106="" class="handle-button theme-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-evg-c106="" class="handle-button copy-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-evg-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color_picker/native_gcp_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section125858112455">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section125858112455" tips="复制节点链接"></i></h3>          <p>native_gcp_api.h提供HMS_GCP_StartColorPicker()和HMS_GCP_StartColorPickerWithColorValue()两种方式启动全局取色功能。</p>     <p>通过调用HMS_GCP_StartColorPicker()，实现启动取色器。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>该启动方法不支持实时显示色值。</p>      </div></div></div>     <div _ngcontent-evg-c106="" class="highlight-div"><div _ngcontent-evg-c106="" class="highlight-div-header"><div _ngcontent-evg-c106="" class="highlight-div-header-left"><div _ngcontent-evg-c106="" class="handle-button expand-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-evg-c106="" class="highlight-div-header-right"><div _ngcontent-evg-c106="" class="handle-button ai-button"></div><div _ngcontent-evg-c106="" class="handle-button line-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-evg-c106="" class="handle-button theme-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-evg-c106="" class="handle-button copy-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-evg-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-type">void</span> </span><span class="hljs-title function_">onSuccessCallback</span><span class="hljs-params">(</span><span class=""><span class="hljs-params"><span class="hljs-type">void</span> </span></span><span class="hljs-params">*userData</span><span class=""><span class="hljs-params">, </span></span><span class="hljs-params">HMS_GCP_PickedColorInfo pickedColorInfo</span><span class=""><span class="hljs-params">, <span class="hljs-type">const</span> </span></span><span class="hljs-params"><span class="hljs-type">int32_t</span> code)</span> {</li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked code is: %{public}d"</span></span><span class="">, </span>code)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Red is: %{public}d"</span></span><span class="">, </span>pickedColorInfo.color.red)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Green is:%{public}d "</span></span><span class="">, </span>pickedColorInfo.color.green)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Blue is: %{public}d"</span></span><span class="">, </span>pickedColorInfo.color.blue)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Alpha is:%{public}d "</span></span><span class="">, </span>pickedColorInfo.color.alpha)<span class="">;</span></li><li><span class="">    delete </span>userData<span class="">;</span></li><li>}</li><li><span class=""><span class="hljs-type">void</span> </span><span class="hljs-title function_">startPick</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-type">int32_t</span> posX = <span class=""><span class="hljs-number">200</span></span><span class="">;</span></li><li>    <span class="hljs-type">int32_t</span> posY = <span class=""><span class="hljs-number">200</span></span><span class="">;</span></li><li><span class="">    <span class="hljs-type">void</span> </span>*userData = <span class="">nullptr;</span></li><li>    HMS_GCP_StartColorPicker(posX<span class="">, </span>posY<span class="">, </span>onSuccessCallback<span class="">, </span>userData)<span class="">;</span></li><li>}</li></ol></pre></div></div>     <p></p>     <p>通过调用HMS_GCP_StartColorPickerWithColorValue()，实现启动取色器。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>该启动方法支持实时显示色值。</p>      </div></div></div>     <div _ngcontent-evg-c106="" class="highlight-div"><div _ngcontent-evg-c106="" class="highlight-div-header"><div _ngcontent-evg-c106="" class="highlight-div-header-left"><div _ngcontent-evg-c106="" class="handle-button expand-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-evg-c106="" class="highlight-div-header-right"><div _ngcontent-evg-c106="" class="handle-button ai-button"></div><div _ngcontent-evg-c106="" class="handle-button line-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-evg-c106="" class="handle-button theme-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-evg-c106="" class="handle-button copy-button"><div _ngcontent-evg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-evg-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-type">void</span> </span><span class="hljs-title function_">onSuccessCallback</span><span class="hljs-params">(</span><span class=""><span class="hljs-params"><span class="hljs-type">void</span> </span></span><span class="hljs-params">*userData</span><span class=""><span class="hljs-params">, </span></span><span class="hljs-params">HMS_GCP_PickedColorInfo pickedColorInfo</span><span class=""><span class="hljs-params">, <span class="hljs-type">const</span> </span></span><span class="hljs-params"><span class="hljs-type">int32_t</span> code)</span> {</li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked code is: %{public}d"</span></span><span class="">, </span>code)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Red is: %{public}d"</span></span><span class="">, </span>pickedColorInfo.color.red)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Green is:%{public}d "</span></span><span class="">, </span>pickedColorInfo.color.green)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Blue is: %{public}d"</span></span><span class="">, </span>pickedColorInfo.color.blue)<span class="">;</span></li><li>    OH_LOG_Print(LOG_APP<span class="">, </span>LOG_INFO<span class="">, </span><span class=""><span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">"penkit"</span></span><span class="">, </span><span class=""><span class="hljs-string">"picked Alpha is:%{public}d "</span></span><span class="">, </span>pickedColorInfo.color.alpha)<span class="">;</span></li><li><span class="">    delete </span>userData<span class="">;</span></li><li>}</li><li><span class=""><span class="hljs-type">void</span> </span><span class="hljs-title function_">startPickWithColorValue</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-type">int32_t</span> posX = <span class=""><span class="hljs-number">200</span></span><span class="">;</span></li><li>    <span class="hljs-type">int32_t</span> posY = <span class=""><span class="hljs-number">200</span></span><span class="">;</span></li><li><span class="">    <span class="hljs-type">void</span> </span>*userData = <span class="">nullptr;</span></li><li>    HMS_GCP_StartColorPickerWithColorValue(posX<span class="">, </span>posY<span class="">, </span>onSuccessCallback<span class="">, </span>userData)<span class="">;</span></li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>