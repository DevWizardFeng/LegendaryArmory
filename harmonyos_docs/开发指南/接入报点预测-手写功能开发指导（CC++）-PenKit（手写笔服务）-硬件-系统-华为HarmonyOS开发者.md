<h1 _ngcontent-pmw-c119="" class="doc-title ng-star-inserted" title="接入报点预测"> 接入报点预测 </h1>

<div _ngcontent-pmw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从6.0.0(20)开始，报点预测新增C API接口。</p>    <p>接入报点预测功能，可以优化应用中手写效果的绘制跟手性，提升应用中手写笔书写场景的跟手体验。</p>    <div class="tiledSection">     <h2 id="section1367743632616">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1367743632616" tips="复制节点链接"></i></h2>          <p>在应用的自定义界面中，获取到界面的触摸事件，通过调用报点预测的接口，可以得到预测的下一个报点的位置信息。</p>     <p><span><img height="262.34250000000003" originheight="468" originwidth="934" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115040.00140163578979411342041005016684:50001231000000:2800:7C5026E3076216894821D4092612C4402CAB66FFEAF790BB8A0401DB176AE5FD.png" title="点击放大" width="523.6875"></span></p>    </div>    <div class="tiledSection">     <h2 id="section74371658112517">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section74371658112517" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>int32_t <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-handwrite-c#section3513132112183" target="_blank">HMS_HandWrite_GetPredictPoint</a>(const <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-handwrite-struct-historicalpoint" target="_blank">HandWrite_HistoricalPoint</a> *event, int32_t size, float *predictPointX, float *predictPointY)</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>获取预测点。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section256702372513">接入步骤<i class="anchor-icon anchor-icon-link" anchorid="section256702372513" tips="复制节点链接"></i></h2>          <p>报点预测功能的历史点，通常需要在自定义渲染（XComponent）上注册触摸事件回调获得，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/napi-xcomponent-guidelines" target="_blank">自定义渲染开发指南</a>，获得历史触摸点。</p>    </div>    <div class="tiledSection">     <h3 id="section1292917114294" class="firsth2">在CMake脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="section1292917114294" tips="复制节点链接"></i></h3>          <div _ngcontent-pmw-c106="" class="highlight-div"><div _ngcontent-pmw-c106="" class="highlight-div-header"><div _ngcontent-pmw-c106="" class="highlight-div-header-left"><div _ngcontent-pmw-c106="" class="handle-button expand-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmw-c106="" class="highlight-div-header-right"><div _ngcontent-pmw-c106="" class="handle-button ai-button"></div><div _ngcontent-pmw-c106="" class="handle-button line-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmw-c106="" class="handle-button theme-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmw-c106="" class="handle-button copy-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="">target_include_directories</span>(entry <span class="">PUBLIC</span> <span class="hljs-variable">${HMOS_SDK_NATIVE}</span>/sysroot/usr/include) <span class="hljs-comment"># 当编译过程中报点预测头文件缺失时尝试加入此命令</span></li><li><span class="">target_link_directories</span>(entry <span class="">PUBLIC </span><span class="hljs-variable">${HMOS_SDK_NATIVE}</span>/sysroot/usr/lib/aarch64-linux-ohos) <span class="hljs-comment"># 当编译过程中报点预测API链接异常时尝试加入此命令</span></li><li><span class="">target_link_libraries</span>(entry <span class="">PUBLIC</span> libace_napi.z.so libhilog_ndk.z.so libhandwrite_ndk.z.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section621191923019">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section621191923019" tips="复制节点链接"></i></h3>          <div _ngcontent-pmw-c106="" class="highlight-div"><div _ngcontent-pmw-c106="" class="highlight-div-header"><div _ngcontent-pmw-c106="" class="highlight-div-header-left"><div _ngcontent-pmw-c106="" class="handle-button expand-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmw-c106="" class="highlight-div-header-right"><div _ngcontent-pmw-c106="" class="handle-button ai-button"></div><div _ngcontent-pmw-c106="" class="handle-button line-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmw-c106="" class="handle-button theme-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmw-c106="" class="handle-button copy-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmw-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ace/xcomponent/native_interface_xcomponent.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;handwrite/native_handwrite_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section270312426553">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section270312426553" tips="复制节点链接"></i></h3>          <div class="p">      <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/pen-handwrite-headerfile-declare" target="_blank">native_handwrite_api.h</a>提供HMS_HandWrite_GetPredictPoint()接口获取预测点。      <div _ngcontent-pmw-c106="" class="highlight-div"><div _ngcontent-pmw-c106="" class="highlight-div-header"><div _ngcontent-pmw-c106="" class="highlight-div-header-left"><div _ngcontent-pmw-c106="" class="handle-button expand-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmw-c106="" class="highlight-div-header-right"><div _ngcontent-pmw-c106="" class="handle-button ai-button"></div><div _ngcontent-pmw-c106="" class="handle-button line-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmw-c106="" class="handle-button theme-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmw-c106="" class="handle-button copy-button"><div _ngcontent-pmw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmw-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ace/xcomponent/native_interface_xcomponent.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;handwrite/native_handwrite_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DispatchTouchEvent</span><span class="hljs-params">(OH_NativeXComponent *xcomponent</span></span><span class=""><span class="hljs-function"><span class="hljs-params">, <span class="hljs-type">void</span> </span></span></span><span class="hljs-function"><span class="hljs-params">*window)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int32_t</span> historicalPointSize = <span class="hljs-number">0</span>;</li><li>    OH_NativeXComponent_HistoricalPoint *historicalPoints = <span class=""><span class="hljs-literal">nullptr</span>;</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">OH_NativeXComponent_GetHistoricalPoints</span>(xcomponent, window, &amp;historicalPointSize, &amp;historicalPoints) !=</li><li>        OH_NATIVEXCOMPONENT_RESULT_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, <span class="hljs-number">0x0000</span>, <span class="hljs-string">"PenKit"</span>, <span class="hljs-string">"failed to get historical points"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-function">std::vector&lt;HandWrite_HistoricalPoint&gt; <span class="hljs-title">handWriteHisPoints</span><span class="hljs-params">(historicalPointSize)</span></span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; historicalPointSize; ++i) {</li><li>        handWriteHisPoints[i].x = historicalPoints[i].x;</li><li>        handWriteHisPoints[i].y = historicalPoints[i].y;</li><li>        handWriteHisPoints[i].timeStamp = historicalPoints[i].timeStamp;</li><li>        handWriteHisPoints[i].force = historicalPoints[i].force;</li><li>    }</li><li>
</li><li>    <span class="hljs-type">float</span> predictPointX = <span class="hljs-number">0.0f</span>;</li><li>    <span class="hljs-type">float</span> predictPointY = <span class="hljs-number">0.0f</span>;</li><li>    <span class="hljs-type">int32_t</span> errcode = <span class="hljs-built_in">HMS_HandWrite_GetPredictPoint</span>(handWriteHisPoints.<span class="hljs-built_in">data</span>(), historicalPointSize, &amp;predictPointX, &amp;predictPointY);</li><li>
</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0x0000</span>, <span class="hljs-string">"PenKit"</span>, <span class="hljs-string">"error code is %{public}d"</span>, errcode);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0x0000</span>, <span class="hljs-string">"PenKit"</span>, <span class="hljs-string">"predict point is (%{public}f, %{public}f)"</span>, predictPointX, predictPointY);</li><li>}</li></ol></pre></div></div>     </div>    </div>   </div>   <div></div></div>