<h1 _ngcontent-ssn-c119="" class="doc-title ng-star-inserted" title="接入方案"> 接入方案 </h1>

<div _ngcontent-ssn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section17801556155512">方案概述<i class="anchor-icon anchor-icon-link" anchorid="section17801556155512" tips="复制节点链接"></i></h2><p>位置感知推荐能力支持开发者云侧共享位置信息与关联推荐的内容，结合实时位置、设备状态与习惯标签完成系统智慧决策，在小艺建议智慧推荐更符合用户诉求的内容信息。</p> <p><span><img height="433.33594500000004" originheight="1758" originwidth="2940" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114241.50145429766696910181015358183629:50001231000000:2800:A1E3231889D71D62C170D3A8B0B73B54FE1F71E28EAF7C867A9FDC3CD79235F0.png" title="点击放大" width="724.692794"></span></p> </div> <div class="tiledSection"><h2 id="section61942593012">开通近场服务权限<i class="anchor-icon anchor-icon-link" anchorid="section61942593012" tips="复制节点链接"></i></h2><p>近场服务是华为软硬协同解决方案中的关键能力环节，旨在帮助商家触达更多HarmonyOS用户，并为这些用户提供更精准、更优质的服务。开通近场服务的步骤详情参考：<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-xiaoyi-create-formalstate-service-0000002349016144" target="_blank">近场服务-申请开通权限</a>。</p> </div> <div class="tiledSection"><h2 id="section19453611411">意图声明<i class="anchor-icon anchor-icon-link" anchorid="section19453611411" tips="复制节点链接"></i></h2><p>以“搜索旅游攻略”特性为例，开发者首先要注册“查看旅游攻略”（viewTravelGuides），其他意图见<a href="https://developer.huawei.com/consumer/cn/doc/service/intents-schema-0000001901962713" target="_blank">各垂域意图Schema</a>。</p> <p>开发者需要编辑对应的意图配置insight_intent.json文件实现意图声明。insight_intent.json文件需要放置在任意一个module下面的指定目录：src/main/resources/base/profile/insight_intent.json，并且整个工程中只能存在一个insight_intent.json文件。</p> <div _ngcontent-ssn-c106="" class="highlight-div"><div _ngcontent-ssn-c106="" class="highlight-div-header"><div _ngcontent-ssn-c106="" class="highlight-div-header-left"><div _ngcontent-ssn-c106="" class="handle-button expand-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ssn-c106="" class="highlight-div-header-right"><div _ngcontent-ssn-c106="" class="handle-button ai-button"></div><div _ngcontent-ssn-c106="" class="handle-button line-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ssn-c106="" class="handle-button theme-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ssn-c106="" class="handle-button copy-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ssn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// 应用支持的意图列表</span></span></li><li><span class="">  <span class="hljs-comment">// 必须声明应用支持插件包含的必选意图，应用上架时会进行校验</span></span></li><li>  <span class=""><span class="hljs-string">"insightIntents"</span></span><span class="">: [</span></li><li><span class="">    {</span></li><li>      <span class=""><span class="hljs-comment">// 意图名称</span></span></li><li><span class="">      <span class="hljs-comment">// 名称应当遵循意图框架规范，当前仅支持预置垂域意图，不允许自定义</span></span></li><li><span class="">      <span class="hljs-comment">// 应用内意图名称唯一，不允许出现相同的名称定义</span></span></li><li>      <span class=""><span class="hljs-string">"intentName"</span></span><span class="">: </span><span class=""><span class="hljs-string">"ViewTravelGuides"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-comment">// 意图所属的垂域</span></span></li><li>      <span class=""><span class="hljs-string">"domain"</span></span><span class="">: </span><span class=""><span class="hljs-string">"TravelDomain"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-comment">// 意图版本号</span></span></li><li><span class="">      <span class="hljs-comment">// 插件引用意图时会校验该版本号，只有和插件定义的版本号一致才能正常调用</span></span></li><li>      <span class=""><span class="hljs-string">"intentVersion"</span></span><span class="">: </span><span class=""><span class="hljs-string">"1.0.1"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-comment">// 意图调用逻辑入口</span></span></li><li>      <span class=""><span class="hljs-string">"srcEntry"</span></span><span class="">: </span><span class=""><span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"uiAbility"</span></span><span class="">: {</span></li><li>        <span class=""><span class="hljs-comment">// 意图所在ability</span></span></li><li>        <span class=""><span class="hljs-string">"ability"</span></span><span class="">: </span><span class=""><span class="hljs-string">"EntryAbility"</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-comment">// UIAbility支持前后台两种执行模式</span></span></li><li>        <span class=""><span class="hljs-string">"executeMode"</span></span><span class="">: [</span></li><li>          <span class=""><span class="hljs-string">"background"</span></span><span class="">,</span></li><li>          <span class=""><span class="hljs-string">"foreground"</span></span></li><li>        <span class="">]</span></li><li><span class="">      }</span></li><li><span class="">    }</span></li><li><span class="">  ]</span></li><li><span class="">}</span></li></ol></pre></div></div> <p></p> </div> <div class="tiledSection"><h2 id="section146314184504">端侧前台意图调用<i class="anchor-icon anchor-icon-link" anchorid="section146314184504" tips="复制节点链接"></i></h2><p>开发者需自己实现InsightIntentExecutor，并在对应回调实现打开落地页（点击推荐卡片跳转的界面，如旅游攻略落地页）的能力，ViewTravelGuides的意图调用字段定义见查看旅游攻略（ViewTravelGuides）。</p> <p>步骤如下：</p> <ol><li>继承InsightIntentExecutor；</li><li>重写对应方法，例如目标拉起前台页面，则可重写onExecuteInUIAbilityForegroundMode方法；</li><li>通过意图名称，识别查看旅游攻略意图(ViewTravelGuides)，在对应的方法中传递意图参数（param），并拉起对应落地页（点击推荐卡片跳转的界面，如旅游攻略落地页）。</li></ol> <div _ngcontent-ssn-c106="" class="highlight-div"><div _ngcontent-ssn-c106="" class="highlight-div-header"><div _ngcontent-ssn-c106="" class="highlight-div-header-left"><div _ngcontent-ssn-c106="" class="handle-button expand-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ssn-c106="" class="highlight-div-header-right"><div _ngcontent-ssn-c106="" class="handle-button ai-button"></div><div _ngcontent-ssn-c106="" class="handle-button line-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ssn-c106="" class="handle-button theme-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ssn-c106="" class="handle-button copy-button"><div _ngcontent-ssn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ssn-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">insightIntent</span><span class="">, </span><span class=""><span class="hljs-title class_">InsightIntentExecutor</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable language_">window</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.ArkUI'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-title class_">BusinessError</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.BasicServicesKit'</span></span><span class="">;</span></li><li><span class=""><span class="hljs-comment">/**</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment"> * 意图调用样例 */</span></span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">InsightIntentExecutorImpl</span> </span><span class="hljs-keyword">extends</span> <span class=""><span class="hljs-title class_ inherited__">InsightIntentExecutor</span> </span><span class="">{</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class=""><span class="hljs-variable constant_">VIEW_TRAVEL_GUIDES</span> </span><span class="">= </span><span class=""><span class="hljs-string">'ViewTravelGuides'</span></span><span class="">;</span></li><li>  <span class=""><span class="hljs-comment">/**</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * override 执行前台UIAbility意图</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   *</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> name 意图名称</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> param 意图参数</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> pageLoader 窗口</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> 意图调用结果</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   */</span></span></li><li>  <span class=""><span class="hljs-title function_">onExecuteInUIAbilityForegroundMode</span></span><span class="">(</span><span class=""><span class="hljs-attr">name</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">, </span><span class=""><span class="hljs-attr">param</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Record</span></span><span class="">&lt;</span><span class=""><span class="hljs-built_in">string</span></span><span class="">, </span><span class=""><span class="hljs-title class_">Object</span></span><span class="">&gt;</span><span class="">, </span><span class=""><span class="hljs-attr">pageLoader</span></span><span class="">: </span><span class=""><span class="hljs-variable language_">window</span></span><span class="">.</span><span class=""><span class="hljs-property">WindowStage</span></span><span class="">)</span><span class="">:</span></li><li>    <span class=""><span class="hljs-title class_">Promise</span></span><span class="">&lt;</span><span class="">insightIntent</span><span class="">.</span><span class=""><span class="hljs-property">ExecuteResult</span></span><span class="">&gt;</span> <span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// 根据意图名称分发处理逻辑，</span></span><span class=""><span class="hljs-comment">接入方可根据实际业务实现页面跳转</span></span></li><li>    <span class="hljs-keyword">switch</span> <span class="">(</span><span class="">name</span><span class="">) </span><span class="">{</span></li><li>      <span class="hljs-keyword">case</span> <span class=""><span class="hljs-title class_">InsightIntentExecutorImpl</span></span><span class="">.</span><span class=""><span class="hljs-property">VIEW_TRAVEL_GUIDES</span></span><span class="">:</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-title function_">viewTravelGuides</span></span><span class="">(</span><span class="">param</span><span class="">, </span><span class="">pageLoader</span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-attr">default</span><span class="">:</span></li><li>        <span class="hljs-keyword">break</span><span class="">;</span></li><li>    <span class="">}</span></li><li>    <span class="hljs-keyword">return</span> <span class=""><span class="hljs-title class_">Promise</span></span><span class="">.</span><span class=""><span class="hljs-title function_">resolve</span></span><span class="">(</span><span class="">{</span></li><li>      <span class=""><span class="hljs-attr">code</span></span><span class="">: -</span><span class=""><span class="hljs-number">1</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-attr">result</span></span><span class="">: </span><span class="">{</span></li><li>        <span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'unknown intent'</span></span></li><li>      <span class="">}</span></li><li><span class="">    } </span><span class="hljs-keyword">as</span> <span class="">insightIntent</span><span class="">.</span><span class=""><span class="hljs-property">ExecuteResult</span></span><span class="">)</span></li><li>  <span class="">}</span></li><li>  <span class=""><span class="hljs-comment">/**</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * 实现调用查看旅游攻略功能</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   *</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> param 意图参数</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> pageLoader 窗口</span></span><span class="hljs-comment"></span></li><li><span class="hljs-comment"></span><span class=""><span class="hljs-comment">   */</span></span></li><li>  <span class="hljs-keyword">private</span> <span class=""><span class="hljs-title function_">viewTravelGuides</span></span><span class="">(</span><span class=""><span class="hljs-attr">param</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Record</span></span><span class="">&lt;</span><span class=""><span class="hljs-built_in">string</span></span><span class="">, </span><span class=""><span class="hljs-title class_">Object</span></span><span class="">&gt;</span><span class="">, </span><span class=""><span class="hljs-attr">pageLoader</span></span><span class="">: </span><span class=""><span class="hljs-variable language_">window</span></span><span class="">.</span><span class=""><span class="hljs-property">WindowStage</span></span><span class="">)</span><span class="">: </span><span class=""><span class="hljs-title class_">Promise</span></span><span class="">&lt;</span><span class="">insightIntent</span><span class="">.</span><span class=""><span class="hljs-property">ExecuteResult</span></span><span class="">&gt;</span> <span class="">{</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Promise</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">, </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">reject</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">TODO 实现意图调用，loadContent的入参为旅游攻略落地页路径，例如：pages/TravelGuidePage</span></span></li><li>      <span class="">pageLoader</span><span class="">.</span><span class=""><span class="hljs-title function_">loadContent</span></span><span class="">(</span><span class=""><span class="hljs-string">'pages/TravelGuidePage'</span></span><span class="">)</span></li><li>        <span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>          <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">entityId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span> </span><span class="">= </span><span class="">(</span><span class="">param</span><span class="">.</span><span class=""><span class="hljs-property">items</span> </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-title class_">Array</span></span><span class="">&lt;</span><span class=""><span class="hljs-built_in">object</span></span><span class="">&gt;</span><span class="">)</span><span class="">?.</span><span class="">[</span><span class=""><span class="hljs-number">0</span></span><span class="">]</span><span class="">?.</span><span class="">[</span><span class=""><span class="hljs-string">'entityId'</span></span><span class="">]</span><span class="">;</span></li><li>          <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">TODO 调用成功的情况，此处可以打印日志</span></span></li><li>          <span class=""><span class="hljs-title function_">resolve</span></span><span class="">(</span><span class="">{</span></li><li>            <span class=""><span class="hljs-attr">code</span></span><span class="">: </span><span class=""><span class="hljs-number">0</span></span><span class="">,</span></li><li>            <span class=""><span class="hljs-attr">result</span></span><span class="">: </span><span class="">{</span></li><li>              <span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'Intent execute succeed'</span></span></li><li>            <span class="">}</span></li><li><span class="">          }</span><span class="">)</span><span class="">;</span></li><li>        <span class="">}</span><span class="">)</span></li><li>        <span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">BusinessError</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>          <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">TODO 调用失败的情况</span></span></li><li>          <span class=""><span class="hljs-title function_">resolve</span></span><span class="">(</span><span class="">{</span></li><li>            <span class=""><span class="hljs-attr">code</span></span><span class="">: -</span><span class=""><span class="hljs-number">1</span></span><span class="">,</span></li><li>            <span class=""><span class="hljs-attr">result</span></span><span class="">: </span><span class="">{</span></li><li>              <span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'Intent execute failed'</span></span></li><li>            <span class="">}</span></li><li><span class="">          }</span><span class="">)</span></li><li>        <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div> </div> </div> <div></div></div>