<h1 _ngcontent-okx-c119="" class="doc-title ng-star-inserted" title="推送卡片刷新消息"> 推送卡片刷新消息 </h1>

<div _ngcontent-okx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section6464021617">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section6464021617" tips="复制节点链接"></i></h2>          <p>如今衣食住行娱乐影音应用占据了大多数人的手机，一部手机可以满足日常大多需求，但对需要经常查看或进行简单操作的应用来说，总需要用户点开应用体验较繁琐。针对此种场景，HarmonyOS提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/form-kit" target="_blank">Form Kit（卡片开发服务）</a>，您可以将应用的重要信息或操作前置到卡片，以达到服务直达、减少体验层级的目的。</p>     <p>面对需要实时更新信息的应用卡片，Push Kit向开发者提供了卡片刷新服务。应用通过集成Push Kit后获取Push Token，基于Push Kit的系统级通道，便可以在合适场景向用户即时推送卡片内容，从而提升用户的感知度和活跃度。</p>     <p><span><img height="287.28000000000003" originheight="384" originwidth="699" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114550.61331558762114617182904497513706:50001231000000:2800:835C524B6C98C464247088F1E54C4A951CCF3A4AC86232E0A58F32A59C0FA1C5.png" title="点击放大" width="523.6875"></span></p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>推送卡片刷新消息仅支持Phone、Tablet、PC/2in1设备。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section12906123716391">频控规则<i class="anchor-icon anchor-icon-link" anchorid="section12906123716391" tips="复制节点链接"></i></h2>          <p><strong>调测阶段</strong>，每个项目每日全网最多可推送<span id="ZH-CN_TOPIC_0000002368705832__zh-cn_topic_0000002368705820_text54316313257">1000</span>条测试消息。发送测试消息需设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">testMessage</a>为true。</p>     <p><strong>正式发布阶段</strong>，单设备单应用下每日推送消息总条数受<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-msg-freq-control#section993063213715" target="_blank">设备消息频控</a>限制，系统会根据现网使用场景和流量进行管控，不合理的使用场景系统会进行频控。</p>     <p>单张服务卡片刷新消息受应用是否上架影响：</p>     <ul>      <li>已上架：单设备单应用下单张卡片每日限制发送2条消息。</li>      <li>未上架：单设备单应用下单张卡片每日限制发送5条消息。</li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>不论是测试消息还是正式消息，卡片刷新消息单次发送仅能携带一个Token。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section17903738421">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section17903738421" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section770842444511" class="firsth2">开发卡片<i class="anchor-icon anchor-icon-link" anchorid="section770842444511" tips="复制节点链接"></i></h3>          <p>推送卡片刷新消息前，您需先完成本地卡片的开发。</p>     <ol>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-ui-widget-creation" target="_blank">创建一个ArkTS卡片</a>，完成本地服务卡片的创建。</span></li>      <li><span>在项目模块级别下的<strong>src/main/resources/base/profile/form_config.json</strong>中配置dataProxyEnabled字段为<strong>true</strong>，开启卡片代理刷新功能。</span>       <p></p>       <div _ngcontent-okx-c106="" class="highlight-div"><div _ngcontent-okx-c106="" class="highlight-div-header"><div _ngcontent-okx-c106="" class="highlight-div-header-left"><div _ngcontent-okx-c106="" class="handle-button expand-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-okx-c106="" class="highlight-div-header-right"><div _ngcontent-okx-c106="" class="handle-button ai-button"></div><div _ngcontent-okx-c106="" class="handle-button line-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-okx-c106="" class="handle-button theme-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-okx-c106="" class="handle-button copy-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-okx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class=""><span class="hljs-attr">"forms"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-punctuation">[</span></span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class=""><span class="hljs-attr">"name"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"widget"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"src"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"./ets/widget/pages/WidgetCard.ets"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"uiSyntax"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"arkts"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"window"</span></span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class=""><span class="hljs-attr">"designWidth"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-number">720</span></span><span class="hljs-punctuation">,</span></li><li>        <span class=""><span class="hljs-attr">"autoDesignWidth"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-literal"><span class="hljs-keyword">true</span></span></span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"colorMode"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"auto"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"isDefault"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-literal"><span class="hljs-keyword">true</span></span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"updateEnabled"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-literal"><span class="hljs-keyword">true</span></span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"updateDuration"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-number">1</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"scheduledUpdateTime"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"10:30"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"defaultDimension"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-string">"2*2"</span></span><span class="hljs-punctuation">,</span></li><li>      <span class=""><span class="hljs-attr">"supportDimensions"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-punctuation">[</span></span><span class=""><span class="hljs-string">"2*2"</span></span><span class=""><span class="hljs-punctuation">]</span></span><span class="hljs-punctuation">,</span></li><li><strong>      <span class=""><span class="hljs-attr">"dataProxyEnabled"</span></span><span class="hljs-punctuation">:</span> <span class=""><span class="hljs-literal"><span class="hljs-keyword">true</span></span></span></strong></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class=""><span class="hljs-punctuation">]</span></span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <p></p></li>      <li><span>在卡片生命周期管理文件（下以EntryFormAbility为例）的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonaddform" target="_blank">onAddForm</a>()回调中获取<strong>formId</strong>，定义需要在卡片页面文件（下以WidgetCard为例）中和通过Push Kit要刷新的字段，如下以<strong>text_key</strong>和<strong>image_key</strong>为例。</span>       <p></p>       <div _ngcontent-okx-c106="" class="highlight-div"><div _ngcontent-okx-c106="" class="highlight-div-header"><div _ngcontent-okx-c106="" class="highlight-div-header-left"><div _ngcontent-okx-c106="" class="handle-button expand-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-okx-c106="" class="highlight-div-header-right"><div _ngcontent-okx-c106="" class="handle-button ai-button"></div><div _ngcontent-okx-c106="" class="handle-button line-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-okx-c106="" class="handle-button theme-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-okx-c106="" class="handle-button copy-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-okx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/entryformability/EntryFormAbility.ets</span></li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ formBindingData, formInfo, <span class="hljs-title class_">FormExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</span></li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onAddForm</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formBindingData.<span class="hljs-property">FormBindingData</span> {</li><li>    <span class="hljs-comment">// 获取formId</span></li><li>    <span class="hljs-keyword">const</span> formId = want.<span class="hljs-property">parameters</span>![formInfo.<span class="hljs-property">FormParam</span>.<span class="hljs-property">IDENTITY_KEY</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>
</li><li>    <span class="hljs-comment">// 定义需要在WidgetCard中刷新的字段</span></li><li>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateFormData</span> {</li><li>      <span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>      <span class="hljs-attr">text_key</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>      <span class="hljs-attr">image_key</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">CreateFormData</span> = {</li><li>      <span class="hljs-attr">formId</span>: formId,</li><li>      <span class="hljs-attr">text_key</span>: <span class="hljs-string">'默认文本'</span>,</li><li>      <span class="hljs-attr">image_key</span>: <span class="hljs-string">''</span></li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">bindingData</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(obj);</li><li>
</li><li>    <span class="hljs-comment">// 定义需要通过Push Kit代理刷新的字段，每个key均需要在上面bindingData中定义</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">text_key</span>: formBindingData.<span class="hljs-property">ProxyData</span> = {</li><li>      <span class="hljs-attr">key</span>: <span class="hljs-string">'text_key'</span>,</li><li>      <span class="hljs-attr">subscriberId</span>: formId</li><li>    };</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">image_key</span>: formBindingData.<span class="hljs-property">ProxyData</span> = {</li><li>      <span class="hljs-attr">key</span>: <span class="hljs-string">'image_key'</span>,</li><li>      <span class="hljs-attr">subscriberId</span>: formId</li><li>    };</li><li>    bindingData.<span class="hljs-property">proxies</span> = [text_key, image_key];</li><li>    <span class="hljs-keyword">return</span> bindingData;</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>卡片页面文件（ <strong>下以src/main/ets/widget/pages/WidgetCard.ets为例</strong>）中，创建<strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage" target="_blank">LocalStorage</a></strong>变量并与<strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#entry" target="_blank">@Entry</a></strong>装饰器绑定，使用<strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorageprop" target="_blank">@LocalStorageProp</a></strong>装饰器创建key-value的变量。</span>       <p></p>       <div class="p">        本文创建了formId、text和image三个变量，对应的key为<strong>formId</strong>、<strong>text_key</strong>和<strong>image_key</strong>，需要注意的是卡片页面布局中image对应的组件是Image图片组件，图片组件传递的变量必须以<strong> memory://</strong> 开头。        <div _ngcontent-okx-c106="" class="highlight-div"><div _ngcontent-okx-c106="" class="highlight-div-header"><div _ngcontent-okx-c106="" class="highlight-div-header-left"><div _ngcontent-okx-c106="" class="handle-button expand-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-okx-c106="" class="highlight-div-header-right"><div _ngcontent-okx-c106="" class="handle-button ai-button"></div><div _ngcontent-okx-c106="" class="handle-button line-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-okx-c106="" class="handle-button theme-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-okx-c106="" class="handle-button copy-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-okx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/widget/pages/WidgetCard.ets</span></li><li><span class="hljs-comment">// 定义页面级的UI状态存储LocalStorage</span></li><li><span class="hljs-keyword">const</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-comment">// 绑定</span></li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WidgetCard</span> {</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'formId'</span>) <span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'text_key'</span>) <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'image_key'</span>) <span class="hljs-attr">image</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span> }) {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>() {</li><li>          <span class="hljs-comment">// Span是Text组件的子组件，用于显示行内文本</span></li><li>          <span class="hljs-title class_">Span</span>(<span class="hljs-string">'formID:'</span>)</li><li>          <span class="hljs-title class_">Span</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">formId</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>() {</li><li>          <span class="hljs-title class_">Span</span>(<span class="hljs-string">'文本:'</span>)</li><li>          <span class="hljs-title class_">Span</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-keyword">if</span> <span class="">(</span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">image</span></span><span class="">) </span><span class="">{</span></li><li>          <span class=""><span class="hljs-title class_">Image</span></span><span class="">(</span><span class=""><span class="hljs-string">'memory://'</span> </span><span class="">+ </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">image</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">height</span></span><span class="">(</span><span class=""><span class="hljs-number">80</span></span><span class="">)</span></li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title function_">postCardAction</span>(<span class="hljs-variable language_">this</span>, {</li><li>        <span class="hljs-attr">action</span>: <span class="hljs-string">'router'</span>,</li><li>        <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'MainAbility'</span>, <span class="hljs-comment">// 请配置为应用实际的abilityName</span></li><li>      });</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>       </div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1244514431471">推送卡片刷新消息<i class="anchor-icon anchor-icon-link" anchorid="section1244514431471" tips="复制节点链接"></i></h3>          <ol>      <li><span>参见指导<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>。</span></li>      <li><span>（可选）建议您将<strong>formId</strong>、<strong>pushToken</strong>等信息上报到应用服务端，用于向应用发送卡片刷新消息。</span>       <p></p>       <div _ngcontent-okx-c106="" class="highlight-div"><div _ngcontent-okx-c106="" class="highlight-div-header"><div _ngcontent-okx-c106="" class="highlight-div-header-left"><div _ngcontent-okx-c106="" class="handle-button expand-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-okx-c106="" class="highlight-div-header-right"><div _ngcontent-okx-c106="" class="handle-button ai-button"></div><div _ngcontent-okx-c106="" class="handle-button line-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-okx-c106="" class="handle-button theme-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-okx-c106="" class="handle-button copy-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-okx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 以下为伪代码</span></li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</span></li><li><span class="hljs-keyword">import</span> { pushService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class=""><span class="hljs-keyword">import</span> </span><span class="">{ formInfo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</span></li><li>
</li><li><span class=""><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveFormInfo</span></span><span class="">(<span class="hljs-params">want: Want</span></span><span class="">)</span><span class="">:</span><span class=""> <span class="hljs-title class_">Promise</span></span><span class="">&lt;</span><span class=""><span class="hljs-built_in">void</span></span><span class="">&gt;</span><span class=""> {</span></li><li>  <span class="hljs-keyword">try</span> <span class="">{</span></li><li>    <span class="hljs-keyword">const</span> <span class="">formId </span><span class="">= </span><span class="">want</span><span class="">.</span><span class=""><span class="hljs-property">parameters</span></span><span class="">!</span><span class="">[</span><span class="">formInfo</span><span class="">.</span><span class=""><span class="hljs-property">FormParam</span></span><span class="">.</span><span class=""><span class="hljs-property">IDENTITY_KEY</span></span><span class="">] </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li>    <span class="hljs-keyword">const</span> <span class="">moduleName </span><span class="">= </span><span class="">want</span><span class="">.</span><span class=""><span class="hljs-property">moduleName</span></span><span class="">;</span></li><li>    <span class="hljs-keyword">const</span> <span class="">abilityName </span><span class="">= </span><span class="">want</span><span class="">.</span><span class=""><span class="hljs-property">abilityName</span></span><span class="">;</span></li><li>    <span class="hljs-keyword">const</span> <span class="">formName </span><span class="">= </span><span class="">want</span><span class="">.</span><span class=""><span class="hljs-property">parameters</span></span><span class="">!</span><span class="">[</span><span class="">formInfo</span><span class="">.</span><span class=""><span class="hljs-property">FormParam</span></span><span class="">.</span><span class=""><span class="hljs-property">NAME_KEY</span></span><span class="">] </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li>    <span class="hljs-keyword">const</span> <span class=""><span class="hljs-attr">push</span></span><span class=""><span class="hljs-attr">Token</span>: <span class="hljs-built_in">string</span> </span><span class="">= </span><span class="hljs-keyword">await</span> <span class="">pushService</span><span class="">.</span><span class=""><span class="hljs-title function_">getToken</span></span><span class="">()</span><span class="">;</span></li><li>
</li><li>    <span class="hljs-comment">// 将formId, moduleName, abilityName, formName, pushToken 上报到应用服务端</span></li><li>  <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span>err<span class="">) </span><span class="">{</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'</span><span class=""><span class="hljs-string">Failed to save form info:</span></span><span class="hljs-string"> %{public}d %{public}s'</span>, e.<span class="hljs-property">code</span>, e.<span class="hljs-property">message</span>);</li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>       <p></p></li>      <li id="li29441751145417"><span>应用服务端调用REST API推送卡片刷新消息，消息详情可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-intro" target="_blank">场景化消息API接口功能介绍</a>，请求示例如下：</span>       <p></p>       <div _ngcontent-okx-c106="" class="highlight-div"><div _ngcontent-okx-c106="" class="highlight-div-header"><div _ngcontent-okx-c106="" class="highlight-div-header-left"><div _ngcontent-okx-c106="" class="handle-button expand-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-okx-c106="" class="highlight-div-header-right"><div _ngcontent-okx-c106="" class="handle-button ai-button"></div><div _ngcontent-okx-c106="" class="handle-button line-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-okx-c106="" class="handle-button theme-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-okx-c106="" class="handle-button copy-button"><div _ngcontent-okx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-okx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Request URL</span></li><li>POST <span class="hljs-string">"https://push-api.cloud.huawei.com/v3/</span><strong><span class="hljs-string">[projectId]</span></strong><span class="hljs-string">/messages:send"</span></li><li>
</li><li><span class="hljs-comment">// Request Header</span></li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>Authorization<span class="hljs-punctuation">:</span> Bearer eyJr*****OiIx---****.eyJh*****iJodHR--***.QRod*****<span class="hljs-number">4</span>Gp---**** </li><li><strong>push-type<span class="hljs-punctuation">:</span> <span class="hljs-number">1</span></strong></li><li>
</li><li><span class="hljs-comment">// Request Body</span></li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"payload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"moduleName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"entry"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"abilityName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryFormAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"formName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"widget"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"formId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">423434262</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">123456</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"formData"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"text_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"刷新文本内容"</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"images"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"keyName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image_key"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://***.png"</span><strong><span class="hljs-punctuation">,</span></strong></li><li>        <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-string">"MAMzLg**********lPW"</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"pushOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>     <span class="hljs-attr">"testMessage"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <ul>        <li>[projectId]：项目ID，登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“开发与服务”，在项目列表中选择对应的项目，左侧导航栏选择“项目设置”，在该页面获取。</li>        <li>Authorization：JWT格式字符串，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-struct#section20573634202313" target="_blank">Authorization</a>获取。</li>        <li>push-type：1表示服务卡片刷新场景。</li>        <li>moduleName：项目模块级别下的 <strong>src/main/module.json5</strong> 中的 <strong>module </strong>标签下的<strong>name</strong>值。         <p><span><img height="217.023149" originheight="254" originwidth="788" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.37536157831754550029570033843821:50001231000000:2800:F75AE154F909F1BDE3B702393A3AFA0A6CC5811D61B84D3690349FEF664FD090.png" title="点击放大" width="673.3125"></span></p></li>        <li>abilityName：项目模块级别下的<strong>src/main/module.json5</strong>中的<strong>extensionAbilities</strong>标签下的服务卡片的ability名称。         <p><span><img height="223.53376500000002" originheight="292" originwidth="873" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.03716173089823549475074663968074:50001231000000:2800:417703DE288EADE84F8F33FB7D65488502E434E3FDFC313EEC3293C505751A01.png" title="点击放大" width="668.325"></span></p></li>        <li>formName：项目模块级别下的<strong>src/main/resources/base/profile/form_config.json</strong>中的<strong>forms</strong>标签下的服务卡片的名称。下图以卡片配置文件form_config为例：         <p><span><img height="282.004289" originheight="344" originwidth="842" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.34194097251656387708194282248062:50001231000000:2800:79054555D48C27FF61B85868059C06E60BD060F9547364C05BA6D13B9288C255.png" title="点击放大" width="690.27"></span></p></li>        <li>version：当前卡片刷新消息的版本号，新的卡片刷新消息的版本号需<strong>大于</strong>当前卡片刷新消息版本号，否则会刷新失败。详情参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section6471174713249" target="_blank">version</a>。</li>        <li>formId：服务卡片的实例ID，当卡片的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonaddform" target="_blank">onAddForm</a>()方法被调用时（卡片使用方添加卡片至桌面）进行获取。最大值为<strong>2^31-1</strong>。</li>        <li>formData：填写待刷新服务卡片的业务数据，该数据来源于项目模块级别下的<strong>src/main/ets/widget/pages/WidgetCard.ets</strong>文件下的声明式范式组件名称。下图以卡片页面文件WidgetCard为例：         <p><span><img height="261.07767" originheight="316" originwidth="961" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.94261253989152765932357391736885:50001231000000:2800:4FD5703185F02487A4824E6CC4C3E3A428FEC5DF65D226CEC3E0E8B0AA407B8E.png" title="点击放大" width="794.01"></span></p></li>        <li>images：待刷新服务卡片业务数据中的图片数据，其中keyName为您服务卡片中图片控件的key值，url为图片的地址，下图以卡片页面文件<strong>WidgetCard</strong>为例：         <p><span><img height="188.20431000000002" originheight="254" originwidth="910" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.07692546062674162947937440151920:50001231000000:2800:D1781E0F37D662FBD4193517F7B4F06253C4AAE343631C272C6B74EE325B8CCE.png" title="点击放大" width="674.3100000000001"></span></p>         <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">           <p>推送服务禁止推送包含敏感信息的图片。</p>           <p>支持图片的格式为PNG、JPG、JPEG，图片文件最大为512KB，图片长*宽&lt;12800像素。</p>          </div></div></div></li>        <li>require：图片刷新策略控制，<span class="parmvalue">“0”</span>表示如果图片下载失败，仅刷新文字；<span class="parmvalue">“1”</span>表示如果图片下载失败，则不进行刷新操作。</li>        <li>token：Push Token，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>获取。</li>        <li>testMessage：（选填）测试消息标识，true表示测试消息。每个项目每天限制发送1000条测试消息，单次推送仅能发送一个Token。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">testMessage</a>。</li>       </ul>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>