<h1 _ngcontent-eep-c119="" class="doc-title ng-star-inserted" title="推送后台消息"> 推送后台消息 </h1>

<div _ngcontent-eep-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section2067843610519">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section2067843610519" tips="复制节点链接"></i></h2>          <p>后台消息用于内容不频繁更新的场景，不会显示通知、播放铃声或改变应用角标。终端设备接收到后台消息后，如果应用进程在前台则将消息内容传给应用；如果应用进程不在前台则缓存消息，等待应用启动后再传给应用。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>终端缓存消息默认仅缓存最新的一条消息，最多缓存7天。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section842412232016">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section842412232016" tips="复制节点链接"></i></h2>          <p>推送后台消息能力支持Phone、Tablet、PC/2in1。并且从5.1.0(18)版本开始新增支持Wearable设备。从5.1.1(19)版本开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section51901553202810">频控规则<i class="anchor-icon anchor-icon-link" anchorid="section51901553202810" tips="复制节点链接"></i></h2>          <p><strong>调测阶段</strong>，每个项目每日全网最多可推送<span id="ZH-CN_TOPIC_0000002368705844__zh-cn_topic_0000002368705820_text54316313257">1000</span>条测试消息。发送测试消息需设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section418321011212" target="_blank">testMessage</a>为true。</p>     <p><strong>正式发布阶段</strong>，单设备单应用下每日推送消息总条数受<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-msg-freq-control#section993063213715" target="_blank">设备消息频控</a>限制，系统会根据现网使用场景和流量进行管控，不合理的使用场景系统会进行频控。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>后台消息优先级较低，建议每小时不超过2条，否则消息可能会被丢弃。</li>        <li>后台消息推送会受设备电量状态、系统休眠、用户使用行为等影响，消息可能不会及时下发。</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section8986919144115">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section8986919144115" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开发者希望在应用进程不在前台时，可根据实际情况选择消息缓存的策略。</p>       <ul>        <li>开发者仅需缓存终端侧的最新一条消息，可不执行步骤2~步骤4。</li>        <li>若开发者需缓存终端侧更多消息，可参考开发步骤2~步骤4开发适配端侧数据库并开启数据代理写入，Push Kit将后台消息写入数据库中，当您的应用进程在前台时，需要自行读取数据库中的消息。</li>       </ul>      </div></div></div>     <ol>      <li><span>参见指导<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>。</span></li>      <li><span>（可选）应用客户端参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/data-persistence-by-rdb-store" target="_blank">指导</a>新建一个数据库（如<strong>pushmessage.db</strong>），并严格按照如下格式创建一张数据表（如<strong>t_push_message</strong>）。</span>       <p></p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.1.1.4.1.1" valign="top" width="33.333333333333336%">            <p>字段名称</p></th>           <th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.1.1.4.1.2" valign="top" width="29.010101010101014%">            <p>字段类型</p></th>           <th align="left" class="cellrowborder" id="mcps1.3.4.3.2.2.1.1.4.1.3" valign="top" width="37.65656565656566%">            <p>说明</p></th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>id</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>INTEGER</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>自增主键。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>message_id</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>消息id。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>push_type</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>场景类型。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>message_action</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>INTEGER</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>消息动作。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>message</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>消息内容，结构体如下：</p>            <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"data"</span><span class=""><span class="hljs-punctuation">:</span></span> <span class="hljs-string">"消息体中的extraData"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>field1</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>扩展字段1</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>field2</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>扩展字段2</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>field3</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>扩展字段3</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>field4</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>扩展字段4</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>field5</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>TEXT</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>扩展字段5</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.333333333333336%">            <p>create_time</p></td>           <td class="cellrowborder" valign="top" width="29.010101010101014%">            <p>INTEGER</p></td>           <td class="cellrowborder" valign="top" width="37.65656565656566%">            <p>消息写入数据库的时间戳，单位毫秒（ms）。</p></td>          </tr>                 </tbody></table></div>       </div>       <p></p></li>      <li><span>（可选）在项目模块级目录的 src/main/resources/base/profile/ 下创建 <strong>PushMessage.json</strong> 文件，文件内容如下：</span>       <p></p>       <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"path"</span><span class=""><span class="hljs-punctuation">:</span></span> <span class="hljs-string">"pushmessage/t_push_message"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"type"</span><span class=""><span class="hljs-punctuation">:</span></span> <span class="hljs-string">"rdb"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"scope"</span><span class=""><span class="hljs-punctuation">:</span></span> <span class="hljs-string">"application"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <ul>        <li>path：值为步骤2中创建的数据表路径，格式为<strong>[数据库名称]/[数据表名称]</strong>（如pushmessage/t_push_message）。</li>        <li>type：固定值为 <strong>rdb</strong>，表示关系型数据库。</li>        <li>scope：表示数据库的范围，可填 <strong>application</strong>（应用级）或<strong>module</strong>（hap模块级）。</li>       </ul>       <p></p></li>      <li><span>（可选）在项目模块级目录的 src/main/module.json5 文件添加 <strong>proxyData</strong> 如下配置：</span>       <p></p>       <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class=""><span class="hljs-attr">"module"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class="hljs-punctuation">{</span></li><li>    <span class=""><span class="hljs-attr">"proxyData"</span></span><span class=""><span class="hljs-punctuation">:</span></span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span></li><li>      <span class=""><span class="hljs-attr">"uri"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"datashareproxy://{bundleName}/PushMessage"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>      <span class=""><span class="hljs-attr">"requiredWritePermission"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"ohos.permission.WRITE_PRIVACY_PUSH_DATA"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>      <span class=""><span class="hljs-attr">"metadata"</span></span><span class=""><span class="hljs-punctuation">:</span></span><span class="hljs-punctuation">{</span></li><li>        <span class=""><span class="hljs-attr">"name"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"dataProperties"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>        <span class=""><span class="hljs-attr">"resource"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"$profile:PushMessage"</span></span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <ul>        <li>uri：固定格式为 datashareproxy://{bundleName}/PushMessage，请将<strong>{bundleName}</strong>替换为您应用的bundleName，PushMessage为固定名称，请勿随意更改。</li>        <li>requiredWritePermission：固定值为 <strong>ohos.permission.WRITE_PRIVACY_PUSH_DATA</strong>，推送服务需要使用该权限往数据库里写入后台消息数据。</li>        <li>metadata：扩展配置，name固定值为<strong>dataProperties</strong>，resource固定格式为<strong>$profile:文件名称</strong>，文件名称固定为<strong>PushMessage</strong>。</li>       </ul>       <p></p></li>      <li><span>在项目中现有的UIAbility类（以PushMessageAbility为例）的onCreate()中，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section125883044911" target="_blank">receiveMessage</a>()方法接收后台消息。注意，您仅能使用UIAbility接收后台消息。</span>       <p></p>       <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/abilities/PushMessageAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { pushService, pushCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 此处以PushMessageAbility为例，接收后台消息内容</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushMessageAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      pushService.<span class="hljs-title function_">receiveMessage</span>(<span class="hljs-string">'BACKGROUND'</span>, <span class="hljs-variable language_">this</span>, <span class="hljs-function">(<span class="hljs-params">data: pushCommon.PushPayload</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// process message，并建议对Callback进行try-catch</span></li><li>        <span class="hljs-keyword">try</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Receive background message'</span>);</li><li>        } <span class="hljs-keyword">catch</span> (e) {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">errRes</span>: <span class="hljs-title class_">BusinessError</span> = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to process data: %{public}d %{public}s'</span>, errRes.<span class="hljs-property">code</span>, errRes.<span class="hljs-property">message</span>);</li><li>        }</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to get background message: %{public}d %{public}s'</span>, e.<span class="hljs-property">code</span>, e.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在项目工程的 src/main/module.json5文件的abilities模块的<strong>skills</strong>标签中配置<strong>actions</strong>内容为<strong>action.ohos.push.listener</strong>（有且只能有一个ability定义该action，<strong>若同时添加uris参数，则uris内容需为空</strong>）。</span>       <p></p>       <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>  <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PushMessageAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/abilities/PushMessageAbility.ets"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"launchType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"singleton"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"startWindowIcon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:startIcon"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"startWindowBackground"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$color:start_window_background"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"exported"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-comment">// 保持现有skill对象不变</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"com.app.action"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-comment">// 新增一个独立的skill对象，配置actions参数</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"action.ohos.push.listener"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">]</span></li></ol></pre></div></div>       <p></p></li>      <li><span>应用服务端调用REST API推送后台消息，消息详情可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-intro" target="_blank">场景化消息API接口功能介绍</a>，请求示例如下：</span>       <p></p>       <div _ngcontent-eep-c106="" class="highlight-div"><div _ngcontent-eep-c106="" class="highlight-div-header"><div _ngcontent-eep-c106="" class="highlight-div-header-left"><div _ngcontent-eep-c106="" class="handle-button expand-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eep-c106="" class="highlight-div-header-right"><div _ngcontent-eep-c106="" class="handle-button ai-button"></div><div _ngcontent-eep-c106="" class="handle-button line-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eep-c106="" class="handle-button theme-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eep-c106="" class="handle-button copy-button"><div _ngcontent-eep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eep-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Request URL</span></li><li>POST <span class="hljs-string">"https://push-api.cloud.huawei.com/v3/</span><strong><span class="hljs-string">[projectId]</span></strong><span class="hljs-string">/messages:send"</span></li><li>
</li><li><span class="hljs-comment">// Request Header</span></li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>Authorization<span class="hljs-punctuation">:</span> Bearer eyJr*****OiIx---****.eyJh*****iJodHR--***.QRod*****<span class="hljs-number">4</span>Gp---****</li><li><strong>push-type<span class="hljs-punctuation">:</span> <span class="hljs-number">6</span></strong></li><li>
</li><li><span class="hljs-comment">// Request Body</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"payload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"extraData"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"携带的额外数据"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"proxyData"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ENABLE"</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"MAMzLg**********lPW"</span><span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li><li>
</li></ol></pre></div></div>       <ul>        <li>[projectId]：项目ID，登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“开发与服务”，在项目列表中选择对应的项目，左侧导航栏选择“项目设置”，在该页面获取。</li>        <li>Authorization：JWT格式字符串，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-struct#section20573634202313" target="_blank">Authorization</a>获取。</li>        <li>push-type：6表示后台消息场景。</li>        <li>token：Push Token，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-get-token">获取Push Token</a>获取。</li>        <li>extraData：携带的额外数据，字符串类型。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section056120245274" target="_blank">extraData</a>。</li>        <li>proxyData（选填）：进程不存在时是否开启数据代理静默写入到应用自身缓存，当前只能传全大写"ENABLE"开启代理。若您不希望开启代理写入，请不要在消息体中填写此字段。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section056120245274" target="_blank">proxyData</a>。</li>       </ul>       <p></p>       <p>当设备中的应用进程在前台时会直接拉起应用并将数据传递，您可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section125883044911" target="_blank">receiveMessage</a>()方法中获取消息数据。</p>       <p>当应用进程不在前台且<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section056120245274" target="_blank">proxyData</a>为“ENABLE”时，推送服务将后台消息写入到数据库中，建议您在应用进程在前台时将数据库中数据迁移到您业务数据库中（<strong>避免数据库大小无限制增长</strong>）。当应用进程不在前台且无<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-scenariozed-api-request-param#section056120245274" target="_blank">proxyData</a>时则为缓存消息（<strong>发送多条消息时仅缓存最新的一条</strong>），等下次应用进程在前台时调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>()接口，Push Kit将重新发送缓存消息，您可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section125883044911" target="_blank">receiveMessage</a>()方法获取消息数据。</p>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>