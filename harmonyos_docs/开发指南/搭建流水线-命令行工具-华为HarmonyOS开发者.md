<h1 _ngcontent-awu-c119="" class="doc-title ng-star-inserted" title="搭建流水线"> 搭建流水线 </h1>

<div _ngcontent-awu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div id="body0000001672412437">    <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_p2048622016315">除了使用DevEco Studio一键式构建应用/元服务外，还可以使用命令行工具来调用Hvigor任务进行构建。通过命令行的方式构建应用或元服务，可用于构筑CI（Continuous Integration）流水线，按照计划时间自动化地构建HAP/APP、签名、安装运行等操作。</p>    <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_p898144215913">通过命令行方式构建应用或元服务，可在Windows、Linux和macOS下调用相应命令来执行，本文将以Linux系统为例进行讲解，包括准备构建环境、构建HAP、签名运行等操作。在调用命令行任务上，Windows/macOS系统与Linux系统没有区别，仅在搭建构建环境上存在差异。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul id="ZH-CN_TOPIC_0000002478174392__ul1241285317144">       <li id="li10412953181411">如果开发者所使用的电脑处于完全无网络的环境中，搭建构建环境请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-command-line-building-app#section15767113454814">无网络流水线搭建</a>。</li>       <li id="li124124531142">HarmonyOS SDK已嵌入命令行工具中，无需额外下载配置。</li>       <li id="li7972653209">请在执行命令行之前，保证当前工程是可信任的，确保安全编译。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="section1165991652412">系统平台要求<i class="anchor-icon anchor-icon-link" anchorid="section1165991652412" tips="复制节点链接"></i></h2>          <ul id="ZH-CN_TOPIC_0000002478174392__ul7733042111212">      <li id="li1035554816212">       <p id="ZH-CN_TOPIC_0000002478174392__p1935516484214">Linux：64位操作系统</p></li>      <li id="li546454911219">       <p id="ZH-CN_TOPIC_0000002478174392__p164643493210">GLIBC：2.28或更高版本</p></li>      <li id="li86651650323">       <p id="ZH-CN_TOPIC_0000002478174392__p1266512502218">内存：推荐使用16GB及以上，最小8GB</p></li>      <li id="li18688163212212">       <p id="ZH-CN_TOPIC_0000002478174392__p151158331521">硬盘：100GB及以上</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section4649436515">预置条件<i class="anchor-icon anchor-icon-link" anchorid="section4649436515" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section195447475220" class="firsth2">配置JDK<i class="anchor-icon anchor-icon-link" anchorid="section195447475220" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_ol178571992312">      <li id="zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_li585719163115"><span>下载JDK，支持JDK 17版本。</span></li>      <li id="zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_li11941123032719"><span>在Terminal里，进入JDK软件包目录，执行如下命令，解压已经下载好的安装包，其中jdk-17.0.6_linux-x64_bin.tar.gz为软件包名称，请根据实际配置进行修改。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_screen3876198143515" data-highlighted="yes"><ol class="linenums"><li>tar -xvf jdk-17.0.6_linux-x64_bin.tar.gz</li></ol></pre></div></div>       <p></p></li>      <li id="zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_li5102193834115"><span>配置JDK环境变量。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen651618113551" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">#jdk</span></li><li><span class="hljs-built_in">export</span> JAVA_HOME=/opt/jdk-17.0.6_linux-x64_bin</li><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin</li></ol></pre></div></div>       <p></p></li>      <li id="zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_li142101145194415"><span>执行如下命令，检查JDK安装结果。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_screen1221174594417" data-highlighted="yes"><ol class="linenums"><li>java -version</li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__p15841554124116"><span><img originheight="73" originwidth="714" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104945.71025025830608984078061944270683:50001231000000:2800:8F5FF86452A0C0EBA68CA75BE443154BBB0AC1DFA7199113EF4CB0B1227B8A4B.png" width="714" height="73"></span></p>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section88316312414">获取命令行工具<i class="anchor-icon anchor-icon-link" anchorid="section88316312414" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol2811564183">      <li id="li15720731135412"><span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-commandline-get#section21298572437" target="_blank">命令行工具获取</a>。其他系统(Windows/macOS)请根据实际情况下载对应版本。</span></li>      <li id="li1689675035111"><span>解压该压缩包，在sdk-linux-xxx/commandline目录下找到命令行工具压缩包commandline-tools-linux-xxx.zip。</span></li>      <li id="zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_li01006010354"><span>执行如下命令，解压命令行工具，工具名称请根据实际情况进行修改。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001267524528_zh-cn_topic_0000001178812816_screen1013321112483" data-highlighted="yes"><ol class="linenums"><li>unzip commandline-tools-linux-x64-<span class="hljs-number">5.0</span><span class="hljs-number">.3</span>.XXX.<span class="hljs-built_in">zip</span></li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__p63916491101"><span><img originheight="40" originwidth="548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104945.86433525705091585834066384096076:50001231000000:2800:607B55D1E3A67029D1C5BBE7376B94403EB835CDF93C2F992B5798EBDD3ABA31.png" width="548" height="40"></span></p>       <p id="ZH-CN_TOPIC_0000002478174392__p2323144734012">将解压后所在的路径定义为COMMANDLINE_TOOL_DIR，在后续配置Node、hdc、hvigor、ohpm工具环境变量时使用。</p>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section159168531288">配置Node.js环境变量<i class="anchor-icon anchor-icon-link" anchorid="section159168531288" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p618112521583">命令行工具包含了配套的Node.js，按照以下步骤配置环境变量。</p>     <ol id="ZH-CN_TOPIC_0000002478174392__ol19862191311111">      <li id="li158621113191116"><span>配置Node.js环境变量。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen18862713111116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># Linux系统</span></li><li><span class="hljs-built_in">export</span> NODE_HOME=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/tool/node</li><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$NODE_HOME</span>/bin</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002478174392__p1143015243252">不同系统的Node.js所在路径不同，Windows存放在tool/node目录下，Linux和macOS存放在tool/node/bin目录下。</p>        </div></div></div>       <p></p></li>      <li id="li1509826104519"><span>执行如下命令，查询Node.js版本信息，确认配置成功。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__screen850932684518" data-highlighted="yes"><ol class="linenums"><li>node -v</li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__p15467849105113"><span><img originheight="48" originwidth="424" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104946.64229325371449440704828650464964:50001231000000:2800:A223E05C0C1EC43DD29B83DBB101E4B52F4796C056AD262741B59FA5E8A03BE2.png" width="424" height="48"></span></p>       <p></p></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p id="ZH-CN_TOPIC_0000002478174392__p29698161639">建议使用命令行工具中自带的Node.js工具，若另外单独下载配置其他版本的Node.js，请确保不低于v18.0.0版本。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section6767112163710">配置hdc环境变量<i class="anchor-icon anchor-icon-link" anchorid="section6767112163710" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p3641113318277">hdc命令行工具是调试HarmonyOS应用/元服务的工具，该工具存放在命令行工具自带的sdk下的toolchains目录中。为方便使用hdc命令行工具，请将其添加到环境变量中。</p>     <ol id="ZH-CN_TOPIC_0000002478174392__ol5896101315347">      <li id="li3896111310341"><span>请先完成<a href="/consumer/cn/doc/harmonyos-guides/ide-command-line-building-app#section88316312414">获取命令行工具</a>。</span></li>      <li id="li1435118161347"><span>添加hdc路径到环境变量，指令如下。</span>       <p></p>       <div class="p" id="ZH-CN_TOPIC_0000002478174392__p16824102617278">        hdc工具存放路径示例：${COMMANDLINE_TOOL_DIR}/command-line-tools/sdk/default/openharmony/toolchains。        <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen158243267279" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">export</span> HDC_HOME=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/sdk/default/openharmony/toolchains</li><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HDC_HOME</span></li></ol></pre></div></div>       </div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1411782572213">配置hvigor环境变量<i class="anchor-icon anchor-icon-link" anchorid="section1411782572213" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol9681746112213">      <li id="li1027112523228"><span>请先完成<a href="/consumer/cn/doc/harmonyos-guides/ide-command-line-building-app#section88316312414">获取命令行工具</a>。</span></li>      <li id="li62711152162216"><span>添加hvigorw路径到PATH环境变量，指令如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen1627116524225" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/bin:<span class="hljs-variable">$PATH</span></li></ol></pre></div></div>       <p></p></li>      <li id="li12271115210227"><span>切换到工程根目录，执行如下命令，查询Hvigor版本信息，确认安装成功。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__screen9271115242211" data-highlighted="yes"><ol class="linenums"><li>hvigorw -v</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section75799484512">配置npm镜像仓库<i class="anchor-icon anchor-icon-link" anchorid="section75799484512" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p208121410164717">若您的工程在hvigor/hvigor-config.json5文件中依赖npm三方组件，流水线中则需要配置npm镜像地址，编译时才能正确地下载它。</p>     <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen139072315461" data-highlighted="yes"><ol class="linenums"><li>npm config <span class="hljs-built_in">set</span> registry https://repo.huaweicloud.com/repository/npm/</li><li>npm config <span class="hljs-built_in">set</span> <span class="hljs-string">"@ohos:registry"</span> https://repo.harmonyos.com/npm/</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section31761291258">安装ohpm<i class="anchor-icon anchor-icon-link" anchorid="section31761291258" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol4714144511012">      <li id="li1395091183020"><span>请先完成<a href="/consumer/cn/doc/harmonyos-guides/ide-command-line-building-app#section88316312414">获取命令行工具</a>。</span></li>      <li id="li161033210312"><span>添加ohpm路径到环境变量，指令如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen561017324317" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/bin:<span class="hljs-variable">$PATH</span></li></ol></pre></div></div>       <p></p></li>      <li id="li02247551607"><span>执行如下命令，查询ohpm版本信息，确认安装成功。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__screen1889656133713" data-highlighted="yes"><ol class="linenums"><li>ohpm -v</li></ol></pre></div></div>       <p></p></li>      <li id="li1715804133710"><span>配置仓库地址（可指定多个地址，','号分割），指令如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen411812107445" data-highlighted="yes"><ol class="linenums"><li>ohpm config <span class="hljs-built_in">set</span> registry https://ohpm.openharmony.cn/ohpm/</li><li>ohpm config <span class="hljs-built_in">set</span> strict_ssl <span class="hljs-literal">false</span></li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1478651816216">安装libGL1库<i class="anchor-icon anchor-icon-link" anchorid="section1478651816216" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p372211234720">在linux系统的构建场景下，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile-app#section2095319147103">纹理压缩</a>功能需要安装libGL1库。例如Ubuntu/Debian上安装libgl1-mesa-dev，CentOS/RHEL上安装mesa-libGL-devel。</p>     <p id="ZH-CN_TOPIC_0000002478174392__p1629025374716">以libgl1-mesa-dev为例，执行以下命令安装，其他系统请替换成实际的包名。</p>     <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478174392__screen176816143488" data-highlighted="yes"><ol class="linenums"><li>apt install -y libgl1-mesa-dev</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1726434202115">构建应用<i class="anchor-icon anchor-icon-link" anchorid="section1726434202115" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section6668338152110" class="firsth2">安装工程及模块依赖<i class="anchor-icon anchor-icon-link" anchorid="section6668338152110" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p1351414159444">使用命令行进行构建前，需要分别进入工程及各个模块下执行ohpm install命令，安装<strong>工程及各个模块</strong>依赖的三方库。</p>     <ol id="ZH-CN_TOPIC_0000002478174392__ol17623184852119">      <li id="li15623648132113"><span>定义ohpm安装函数，示例如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen6580195810486" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># 切换到指定目录$1并执行ohpm install指令</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">ohpm_install</span></span>() {     </li><li>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$1</span>              <span class="hljs-comment"># $1：函数第一个参数, 必须是路径     </span></li><li>    ohpm install --all <span class="hljs-comment"># 安装所有依赖</span></li><li>}</li></ol></pre></div></div>       <p></p></li>      <li id="li1360715294418"><span>定义变量 <strong>PROJECT_PATH</strong>，表示工程目录路径，示例如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" id="ZH-CN_TOPIC_0000002478174392__screen930155465715" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">PROJECT_PATH</span>=xxx/xxx/project_name  <span class="hljs-comment"># 工程路径</span></li></ol></pre></div></div>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p id="ZH-CN_TOPIC_0000002478174392__p412021911816">工程目录不要存放在隐藏目录下，即工程路径的每一级目录中不要以.开头，例如xxx/.xxx/project，否则构建时可能会将模块中的代码和配置文件等作为资源打包进产物中，不会进行混淆或加密。</p>        </div></div></div>       <p></p></li>      <li id="li11976111154417"><span>安装工程及各个模块的三方库依赖，示例如下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen3833414971" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># 根据业务情况安装ohpm三方库依赖</span></li><li>ohpm_install <span class="hljs-string">"<span class="hljs-variable">${PROJECT_PATH}</span>"</span></li><li>...</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section2139155011217">执行Hvigor命令进行构建<i class="anchor-icon anchor-icon-link" anchorid="section2139155011217" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol38879288236">      <li id="li16742121602413"><span>使用hvigorw命令行工具执行构建命令。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-shell" id="ZH-CN_TOPIC_0000002478174392__screen12243158102511" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_"># </span><span class="language-bash">根据业务情况，执行相应的构建命令, 示例如下</span></li><li><span class="hljs-meta prompt_"></span></li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">clean工程</span></li><li>hvigorw clean --no-daemon</li><li><span class="hljs-meta prompt_"></span></li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">构建Hap, 生成产物：<span class="hljs-variable">${PROJECT_PATH}</span>/{moduleName}/build/{productName}/outputs/{targetName}/xxx.hap</span></li><li>hvigorw assembleHap --mode module -p product=default -p buildMode=debug --no-daemon</li><li><span class="hljs-meta prompt_"></span></li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">构建Hsp, 生成产物：<span class="hljs-variable">${PROJECT_PATH}</span>/{moduleName}/build/{productName}/outputs/{targetName}/(xxx.har | xxx.hsp)</span></li><li>hvigorw assembleHsp --mode module -p module=library@default -p product=default --no-daemon</li><li><span class="hljs-meta prompt_"></span></li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">构建Har, 生成产物：<span class="hljs-variable">${PROJECT_PATH}</span>/{moduleName}/build/{productName}/outputs/{targetName}/outputs/xxx.har</span></li><li>hvigorw assembleHar --mode module -p module=library1@default -p product=default --no-daemon</li><li><span class="hljs-meta prompt_"></span></li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">构建App, 生成产物: <span class="hljs-variable">${PROJECT_PATH}</span>/build/outputs/{productName}/xxx.app</span></li><li>hvigorw assembleApp --mode project -p product=default -p buildMode=debug --no-daemon</li></ol></pre></div></div>       <ul id="ZH-CN_TOPIC_0000002478174392__ul048919954812">        <li id="li1748959194816">如果在非daemon模式下，需要修改node内存配置，可在hvigorw文件中取消第15行的注释，并配置对应的数值。如将node内存配置为10240，示例如下：         <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" id="ZH-CN_TOPIC_0000002478174392__screen74898911484" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">NODE_OPTS</span>=<span class="hljs-string">"--max-old-space-size=10240"</span></li></ol></pre></div></div></li>        <li id="li1648949164818">如果是在daemon模式下，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-daemon#section327617383145">设置守护进程内存</a>。</li>        <li id="li8489498481">本文使用Linux作为流水线构建环境，Linux环境会对大小写敏感，如果您的代码引用中有大小写错误（例如代码中import funcA from './aaa'，而实际文件为AAA.ets），而且开发环境是Windows或者Mac，那么有可能出现Windows或者Mac环境下编译通过，而Linux环境下编译不通过的现象。通过在项目级的build-profile.json5文件中配置caseSensitiveCheck为true来打开大小写敏感，保持Windows或者Mac环境编译与Linux环境编译结果一致。         <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174392__screen19489695489" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">// build-profile.json5</span></span><span class=""><span class="hljs-comment">文件</span></span></li><li>{</li><li><span class="">    <span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,</span></li><li><span class="">    <span class="hljs-string">"compatibleSdkVersion"</span></span><span class="">: </span><span class=""><span class="hljs-string">"6.0.1(21)"</span></span><span class="">,</span></li><li><span class="">    <span class="hljs-string">"runtimeOS"</span></span><span class="">: </span><span class=""><span class="hljs-string">"HarmonyOS"</span></span><span class="">,</span></li><li><span class="">    <span class="hljs-string">"buildOption"</span></span><span class="">: </span>{</li><li>      <span class=""><span class="hljs-string">"strictMode"</span></span><span class="">: </span>{</li><li>    <span class="">    <span class="hljs-string">"caseSensitiveCheck"</span> </span><span class="">: <span class="hljs-keyword">true</span></span></li><li>      }</li><li>    }</li><li>}</li></ol></pre></div></div></li>       </ul>       <p></p></li>      <li id="li1819520159544"><span>构建命令完成后，工程或模块下build目录中会生成相应的hap/hsp/har/app编译产物。</span></li>     </ol>     <p id="ZH-CN_TOPIC_0000002478174392__p202371023172818"></p>     <p id="ZH-CN_TOPIC_0000002478174392__p14364142135612">编译构建常见的任务和扩展参数如下，更多关于Hvigor命令行参数详见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-commandline#section16300629103">常用命令</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table id="table721616441534" class="layoutFixed idpTab">       <caption>        <b>表1 </b>HarmonyOS应用构建常用扩展参数       </caption>       <thead>        <tr id="ZH-CN_TOPIC_0000002478174392__row142166446316">         <th align="left" class="cellrowborder" id="mcps1.3.16.5.2.3.1.1" valign="top" width="41.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p62168441533">选项</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.5.2.3.1.2" valign="top" width="58.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p22169444312">说明</p></th>        </tr>       </thead>               <tbody><tr id="ZH-CN_TOPIC_0000002478174392__row52161544134">         <td class="cellrowborder" valign="top" width="41.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p102163442032">-p buildMode={debug | release}</p></td>         <td class="cellrowborder" valign="top" width="58.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p193771118991">采用debug/release模式进行编译构建。</p>          <p id="ZH-CN_TOPIC_0000002478174392__p0216144539">缺省时：构建Hap/Hsp/Har时为debug模式，构建App时为release模式。</p>          <p id="ZH-CN_TOPIC_0000002478174392__p13713184711218">关于构建模式的详细说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-compilation-options-customizing-guide#section192461528194916">指定构建模式</a>。针对HAR构建，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-har">构建HAR</a>。</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row1026019231169">         <td class="cellrowborder" valign="top" width="41.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p17260202381611">-p product={ProductName}</p></td>         <td class="cellrowborder" valign="top" width="58.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p1426092313165">指定product进行编译, 编译product下配置的module target。</p>          <p id="ZH-CN_TOPIC_0000002478174392__p390851342218">缺省时：默认为default。</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row17216114419315">         <td class="cellrowborder" valign="top" width="41.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p22160442036">-p module={ModuleName}@{TargetName}</p></td>         <td class="cellrowborder" valign="top" width="58.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p12216134417317">指定模块及target进行编译，可指定多个相同类型的模块进行编译以逗号分割；TargetName不指定时默认为default。</p>          <p id="ZH-CN_TOPIC_0000002478174392__p7930030182016">限制：此参数需要与--mode module参数搭配使用。</p>          <p id="ZH-CN_TOPIC_0000002478174392__p147883179134">缺省时：执行AssembleHap任务会编译工程下所有模块，默认指定target为default。</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row14848195812158">         <td class="cellrowborder" valign="top" width="41.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p47028510165">-p ohos-test-coverage={true | false}</p></td>         <td class="cellrowborder" valign="top" width="58.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p98481658121517">执行测试框架代码覆盖率插桩编译。</p></td>        </tr>             </tbody></table></div>     </div>     <div class="tablenoborder">      <div class="tbBox"><table id="table12350416172719" class="layoutFixed idpTab">       <caption>        <b>表2 </b>HarmonyOS应用编译构建相关任务       </caption>       <thead>        <tr id="ZH-CN_TOPIC_0000002478174392__row93504164277">         <th align="left" class="cellrowborder" id="mcps1.3.16.6.2.3.1.1" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p7350131613277">选项</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.6.2.3.1.2" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p2350416112710">说明</p></th>        </tr>       </thead>               <tbody><tr id="ZH-CN_TOPIC_0000002478174392__row1935071692719">         <td class="cellrowborder" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p1835071692719">clean</p></td>         <td class="cellrowborder" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p113501616122717">清理构建产物</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row1435061619274">         <td class="cellrowborder" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p73501716112720">assembleHap</p></td>         <td class="cellrowborder" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p17288746102811">构建Hap应用</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row103501164273">         <td class="cellrowborder" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p18201746193017">assembleApp</p></td>         <td class="cellrowborder" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p119471252113019">构建App应用</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row1497683862919">         <td class="cellrowborder" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p73501416102713">assembleHsp</p></td>         <td class="cellrowborder" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p2035016169279">构建Hsp包</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002478174392__row8350181662710">         <td class="cellrowborder" valign="top" width="42.33%">          <p id="ZH-CN_TOPIC_0000002478174392__p9977183818299">assembleHar</p></td>         <td class="cellrowborder" valign="top" width="57.67%">          <p id="ZH-CN_TOPIC_0000002478174392__p69771638112919">构建Har包</p></td>        </tr>             </tbody></table></div>     </div>     <p id="ZH-CN_TOPIC_0000002478174392__p11999551545"></p>     <p id="ZH-CN_TOPIC_0000002478174392__p168881552212"></p>    </div>    <div class="tiledSection">     <h2 id="section2261131713228">运行应用<i class="anchor-icon anchor-icon-link" anchorid="section2261131713228" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section6103553181714" class="firsth2">准备申请签名所需文件<i class="anchor-icon anchor-icon-link" anchorid="section6103553181714" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p206946102188">准备好申请签名所需3个文件：密钥（.p12文件）、数字证书（.cer文件）、Profile（.p7b文件）。</p>     <p id="ZH-CN_TOPIC_0000002478174392__p47732035151814"></p>     <p id="ZH-CN_TOPIC_0000002478174392__a7bff8ccd5e844c868d564902799c439a"><strong>生成密钥和证书请求文件</strong></p>     <p id="ZH-CN_TOPIC_0000002478174392__p207969446324">使用JDK携带的Keytool工具生成密钥和证书请求文件。</p>     <ol id="ZH-CN_TOPIC_0000002478174392__ol6104132513330">      <li id="zh-cn_topic_0000001058015911_la996f2c8ce594df98eaadeacfafdea10"><span>参考<a href="/consumer/cn/doc/harmonyos-guides/ide-command-line-building-app#section195447475220">配置JDK</a>步骤配置环境变量后，打开命令行终端，执行如下命令，生成密钥库文件。例如，生成的密钥库名称为demo.p12，存储到path目录下。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_s77de713d421441b6b455e65df50ab9bd" data-highlighted="yes"><ol class="linenums"><li>keytool -genkeypair -<span class="hljs-built_in">alias</span> <span class=""><span class="hljs-string">"demo_key"</span></span> -keyalg EC -sigalg SHA256withECDSA -dname <span class="hljs-string">"C=</span><span class=""><span class="hljs-string">CN</span></span><span class="hljs-string">,O=</span><span class=""><span class="hljs-string">HUAWEI</span></span><span class="hljs-string">,OU=</span><span class=""><span class="hljs-string">HUAWEI IDE</span></span><span class="hljs-string">,CN=demo_key"</span>  -keystore <span class="">/path/demo.p12</span> -storetype pkcs12 -validity <span class="">9125</span> -storepass <span class="">123456Abc</span> -keypass <span class="">123456Abc</span></li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_a77ad0876b23943afb803417d4a8d5210">关于该命令中需要修改的参数说明如下，其余参数不需要修改：</p>       <ul id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_uedf1db622466471a92a840ccabda6a74">        <li id="zh-cn_topic_0000001058015911_lb9687b3d269e46cda11ad7ba10e932af"><strong>alias</strong>：密钥的别名信息，用于标识密钥名称。</li>        <li id="zh-cn_topic_0000001058015911_lc1865215fe484185bfe1b4a07b31ad0f"><strong>dname</strong>：证书基本信息。         <ul id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_ud751496ef61647b59182989d567889a3">          <li id="zh-cn_topic_0000001058015911_l52a69ba286de463c80eb437adbbedde6">C：国家/地区代码，如CN。</li>          <li id="zh-cn_topic_0000001058015911_ldaa8f5fac97e42c9a424f7886f4aeb44">O：组织名称，如HUAWEI。</li>          <li id="zh-cn_topic_0000001058015911_lab6d5fe3417341aa8f2dfa9eda621396">OU：组织单位名称，如HUAWEI IDE。</li>          <li id="zh-cn_topic_0000001058015911_l08833111318947b1b6fa27944b486f91">CN：名字与姓氏，建议与别名一致。</li>         </ul></li>        <li id="li172114552486"><strong>keystore</strong>：密钥库文件，请将"/path/demo.p12"修改为实际路径。</li>        <li id="zh-cn_topic_0000001058015911_l2cc4d8f871074bb590450bca7d694fb7"><strong>validity</strong>：证书有效期，例如设置为9125（25年）。</li>        <li id="zh-cn_topic_0000001058015911_l046c19b17f8a4765b4f94d48dc609128"><strong>storepass</strong>：设置密钥库密码，必须由大写字母、小写字母、数字和特殊符号中的两种以上字符的组合，长度至少为8位。请记住该密码，后续签名配置需要使用。</li>        <li id="zh-cn_topic_0000001058015911_l71a8029bd1554bd09f6efe55c877df1e"><strong>keypass</strong>：设置密钥的密码，请与<strong>storepass</strong>保持一致。</li>       </ul>       <p></p></li>      <li id="zh-cn_topic_0000001058015911_l5060db08504d4bf0a4527de09813ece5"><span>执行如下命令，执行后需要输入<strong>storepass</strong>密码，生成<strong>密钥</strong>和<strong>证书请求文件</strong>。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_s9c1db4e5581b43059de04c11ddaced79" data-highlighted="yes"><ol class="linenums"><li>keytool -certreq -<span class="hljs-built_in">alias</span> <span class=""><span class="hljs-string">"demo_key"</span></span> -keystore <span class="">/path/demo.p12</span> -storetype pkcs12 -file <span class="">/path/demo.csr</span></li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_a58fdac5a6d2b414693b2c27a7c473e8b">生成证书请求文件的参数说明如下：</p>       <ul id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001058015911_u881c360d632040f7ae8fa3cfe125ea5c">        <li id="zh-cn_topic_0000001058015911_ldbe21be2c93944cca1ffbca3fdf87690"><strong>alias</strong>：与上一步骤中输入的<strong>alias</strong>保持一致。</li>        <li id="li18240132620914"><strong>keystore</strong>：与上一步骤中输入的<strong>keystore</strong>保持一致。</li>        <li id="zh-cn_topic_0000001058015911_lb8229cda5f5d423389fb57ce8da9c44b"><strong>file</strong>：生成的证书请求文件名称，后缀为.csr，请将"/path/demo.csr"修改为实际路径。</li>       </ul>       <p></p></li>     </ol>     <p id="ZH-CN_TOPIC_0000002478174392__p31061681217"><strong>申请调试</strong><strong>数字证书和Profil</strong><strong>e</strong><strong>文件</strong></p>     <p id="ZH-CN_TOPIC_0000002478174392__p61994236229">生成证书请求文件后，在AppGallery Connect中申请、下载调试数字证书和Profile文件，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section081822416419">申请调试证书</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section89479413571">申请Profile文件和添加权限信息</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section103321051433">对HAP/APP进行签名<i class="anchor-icon anchor-icon-link" anchorid="section103321051433" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_p1391721165417">通过Hvigor打包生成的HAP不会携带签名信息，如果要在真机设备上运行HAP，需要使用签名工具对HAP进行签名。</p>     <ol id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_ol991621175412">      <li id="zh-cn_topic_0000001178812816_li209112218547"><span>准备好签名工具hap_sign_tool.jar，在${COMMANDLINE_TOOL_DIR}/command-line-tools/sdk/default/openharmony/toolchains/lib下。</span></li>      <li id="zh-cn_topic_0000001178812816_li16915219547"><span>在签名工具目录下，使用如下命令进行签名。详细的签名工具指导请参考<a href="https://gitee.com/openharmony/developtools_hapsigner" target="_blank">Hap包签名工具</a>。</span>       <p></p>       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen9539175572714" data-highlighted="yes"><ol class="linenums"><li>java <span class="">-jar</span> hap-sign-tool.jar sign-app <span class="">-keyAlias</span> <span class=""><span class="hljs-string">"demo_key"</span></span> <span class="">-signAlg</span> <span class=""><span class="hljs-string">"SHA256withECDSA"</span></span> <span class="">-mode</span> <span class=""><span class="hljs-string">"localSign"</span></span> <span class="">-appCertFile</span> <span class=""><span class="hljs-string">"/path/demo.cer</span></span><span class=""><span class="hljs-string">"</span></span> <span class="">-profileFile</span> <span class=""><span class="hljs-string">"</span></span><span class=""><span class="hljs-string">/path/</span></span><span class="hljs-string">demo</span><span class=""><span class="hljs-string">.p7b"</span></span> <span class="">-inFile</span> <span class=""><span class="hljs-string">"/path/hap-unsigned.hap"</span></span> <span class="">-keystoreFile</span> <span class=""><span class="hljs-string">"/path/demo.p12</span></span><span class=""><span class="hljs-string">"</span></span> <span class="">-outFile</span> <span class=""><span class="hljs-string">"/path/</span></span><span class=""><span class="hljs-string">hap</span></span><span class=""><span class="hljs-string">-signed.hap"</span></span> <span class="">-keyPwd</span> <span class=""><span class="hljs-string">"123456Abc"</span></span> <span class="">-keystorePwd</span> <span class=""><span class="hljs-string">"123456Abc"</span></span></li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_p1591102110545">关于该命令中需要修改的参数说明如下，其余参数不需要修改：</p>       <ul id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_ul39242113540">        <li id="li17667336297"><strong>keyAlias</strong>：密钥别名。</li>        <li id="li4185115118295"><strong>appCertFile</strong>：申请的调试证书文件，格式为.cer。</li>        <li id="li182756255312"><strong>profileFile</strong>：申请的调试Profile文件，格式为.p7b。</li>        <li id="li2254556122915"><strong>inFile</strong>：通过Hvigor打包生成的未携带签名信息的HAP。</li>        <li id="li78731119307"><strong>keystoreFile</strong>：密钥库文件，格式为.p12。</li>        <li id="li0415181283011"><strong>outFile</strong>：经过签名后生成的携带签名信息的HAP。</li>        <li id="li168739401315"><strong>keyPwd</strong>：密钥密码。</li>        <li id="li15612946143119"><strong>keystorePwd</strong>：密钥库密码。</li>       </ul>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002478174392__p1829615390171">如果要对APP进行签名，只需将<strong>inFile</strong>和<strong>outFile</strong>参数修改为APP包即可。</p>        </div></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1518833762214">运行应用<i class="anchor-icon anchor-icon-link" anchorid="section1518833762214" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_p389171118591">通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc" target="_blank">hdc工具</a>将HAP推送到真机设备上进行安装，需要注意的是，推送的HAP必须是携带签名信息的，否则会导致HAP安装失败。</p>     <div class="p" id="ZH-CN_TOPIC_0000002478174392__p132971711522">      推送HAP的命令如下：      <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__zh-cn_topic_0000001178812816_screen158941110598" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># 将打包好的hap包推送至设备中</span></li><li>hdc file send <span class="hljs-string">"{PROJECT_PATH}/entry/build/default/outputs/default/entry-default-signed.hap"</span> <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span></li><li><span class="hljs-comment"># 安装hap包</span></li><li>hdc shell bm install -p <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span></li><li><span class="hljs-comment"># 删除hap包</span></li><li>hdc shell <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span></li></ol></pre></div></div>     </div>     <p id="ZH-CN_TOPIC_0000002478174392__p7696154311212">在设备上运行HAP的命令如下：</p>     <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" id="ZH-CN_TOPIC_0000002478174392__screen1461193422215" data-highlighted="yes"><ol class="linenums"><li>hdc shell aa start -<span class="hljs-selector-tag">a</span> EntryAbility -<span class="hljs-selector-tag">b</span> com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.myapplication</span> -m entry</li></ol></pre></div></div>     <p id="ZH-CN_TOPIC_0000002478174392__p8255144582118"></p>    </div>    <div class="tiledSection">     <h2 id="section14397105115226">示例脚本<i class="anchor-icon anchor-icon-link" anchorid="section14397105115226" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p id="ZH-CN_TOPIC_0000002478174392__p158883418516">此脚本无法直接运行，仅供参考，业务要根据自己的情况来进行适配。</p>      </div></div></div>     <div class="p" id="ZH-CN_TOPIC_0000002478174392__p1765331152316">      <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen19372135316174" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#!/bin/bash</span></li><li><span class="hljs-built_in">set</span> -ex</li><li>
</li><li>JAVA_HOME=xxx <span class="hljs-comment">#指定JDK的安装目录</span></li><li>COMMANDLINE_TOOL_DIR=xxx <span class="hljs-comment">#命令行工具的安装目录</span></li><li>
</li><li><span class="hljs-comment">#配置hvigor、ohpm环境变量</span></li><li><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/bin:<span class="hljs-variable">$PATH</span></li><li>
</li><li><span class="hljs-comment">#下载并配置JDK</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">init_JDK</span></span>() {</li><li>  <span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">${JAVA_HOME}</span>"</span> ]; <span class="hljs-keyword">then</span> </li><li>     <span class="hljs-built_in">mkdir</span> <span class="hljs-string">"<span class="hljs-variable">${JAVA_HOME}</span>"</span></li><li>  <span class="hljs-keyword">fi</span></li><li>  <span class="hljs-built_in">cd</span> <span class="hljs-variable">${JAVA_HOME}</span></li><li>  wget --no-check-certificate -q <span class="hljs-string">"<span class="hljs-variable">${jdk下载路径}</span>"</span> -O jdk-linux.tar.xz <span class="hljs-comment">#下载jdk，需要替换jdk下载路径</span></li><li>  tar -vxf jdk-linux.tar.xz</li><li>  JDK_DIR=xxx <span class="hljs-comment">#jdk压缩包文件里面的目录</span></li><li>  <span class="hljs-built_in">cd</span> <span class="hljs-variable">${JDK_DIR}</span></li><li>  <span class="hljs-built_in">mv</span> -f ./* .[^.]* ../</li><li>  <span class="hljs-built_in">cd</span> ..</li><li>  <span class="hljs-built_in">rm</span> -rf JDK_DIR jdk-linux.tar.xz</li><li>  <span class="hljs-built_in">export</span> JAVA_HOME=<span class="hljs-variable">${JAVA_HOME}</span></li><li>  <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span></li><li>  java -version</li><li>}</li><li>
</li><li><span class="hljs-comment">#配置hdc环境变量</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">init_hdc</span></span>() {</li><li>  <span class="hljs-built_in">export</span> HDC_HOME=<span class="hljs-variable">${COMMANDLINE_TOOL_DIR}</span>/command-line-tools/sdk/default/openharmony/toolchains <span class="hljs-comment">#设置hdc工具的环境变量，hdc工具在toolchains所在路径下</span></li><li>  <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$HDC_HOME</span>:<span class="hljs-variable">$PATH</span></li><li>}</li><li>
</li><li><span class="hljs-comment"># 安装ohpm, 若镜像中已存在ohpm，则无需重新安装</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">init_ohpm</span></span>() {</li><li>    ohpm -v</li><li>    <span class="hljs-comment"># 配置ohpm仓库地址</span></li><li>    ohpm config <span class="hljs-built_in">set</span> registry https://ohpm.openharmony.cn/ohpm/</li><li>}</li><li>
</li><li><span class="hljs-comment"># 初始化相关路径</span></li><li>PROJECT_PATH=xxx  <span class="hljs-comment"># 工程目录</span></li><li><span class="hljs-comment"># 进入package目录安装依赖</span></li><li><span class="hljs-keyword">function</span> ohpm_install {</li><li>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">$1</span></li><li>    ohpm install</li><li>}</li><li><span class="hljs-comment"># 环境适配</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">buildHAP</span></span>() {</li><li>    <span class="hljs-comment"># 根据业务情况安装ohpm三方库依赖</span></li><li>    ohpm_install <span class="hljs-string">"<span class="hljs-variable">${PROJECT_PATH}</span>"</span></li><li>    ohpm_install <span class="hljs-string">"<span class="hljs-variable">${PROJECT_PATH}</span>/entry"</span></li><li>    ohpm_install <span class="hljs-string">"<span class="hljs-variable">${PROJECT_PATH}</span>/xxx"</span></li><li>    <span class="hljs-comment"># 根据业务情况，采用对应的构建命令，可以参考DevEco Studio构建日志中的命令</span></li><li>    <span class="hljs-built_in">cd</span> <span class="hljs-variable">${PROJECT_PATH}</span></li><li>    hvigorw clean --no-daemon</li><li>    hvigorw assembleHap --mode module -p product=default -p debuggable=<span class="hljs-literal">false</span> --no-daemon <span class="hljs-comment"># 流水线构建命令建议末尾加上--no-daemon</span></li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">install_hap</span></span>() {</li><li>    hdc file send <span class="hljs-string">"<span class="hljs-variable">${PROJECT_PATH}</span>/entry/build/default/outputs/default/entry-default-signed.hap"</span> <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span></li><li>    hdc shell bm install -p <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span> </li><li>    hdc shell <span class="hljs-built_in">rm</span> -rf <span class="hljs-string">"data/local/tmp/entry-default-signed.hap"</span></li><li>    hdc shell aa start -a MainAbility -b com.example.myapplication -m entry</li><li>}</li><li>
</li><li><span class="hljs-comment"># 使用ohpm发布har</span></li><li><span class="hljs-keyword">function</span> upload_har {</li><li>  ohpm publish pkg.har</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> main {</li><li>  <span class="hljs-built_in">local</span> startTime=$(<span class="hljs-built_in">date</span> <span class="hljs-string">'+%s'</span>)</li><li>  init_JDK</li><li>  init_hdc</li><li>  init_ohpm</li><li>  buildHAP</li><li>  install_hap</li><li>  upload_har</li><li>  <span class="hljs-built_in">local</span> endTime=$(<span class="hljs-built_in">date</span> <span class="hljs-string">'+%s'</span>)</li><li>  <span class="hljs-built_in">local</span> elapsedTime=$(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$endTime</span> - <span class="hljs-variable">$startTime</span>)</li><li>  <span class="hljs-built_in">echo</span> <span class="hljs-string">"build success in <span class="hljs-variable">${elapsedTime}</span>s..."</span></li><li>}</li><li>main</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section15767113454814">无网络流水线搭建<i class="anchor-icon anchor-icon-link" anchorid="section15767113454814" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002478174392__p1076113416368">如果开发者使用的电脑处于完全无网络的环境中，可参考以下步骤搭建流水线环境。</p>    </div>    <div class="tiledSection">     <h3 id="section93009019316" class="firsth2">安装pnpm插件<i class="anchor-icon anchor-icon-link" anchorid="section93009019316" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol106431640275">      <li id="li15643940974">请在可访问网络的电脑上创建一个空文件夹，在文件夹中创建一个package.json文件，在文件中填写如下内容：       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174392__screen11531135221219" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"dependencies"</span>: {</li><li>    <span class="hljs-string">"pnpm"</span>: <span class="hljs-string">"8.13.1"</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li id="li153125215121">先配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-environment-config#zh-cn_topic_0000001056725590_li358362302311">环境变量</a>，再打开<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-commandline-get">命令行工具</a>，在文件夹下执行 npm install 命令，会生成node_modules文件夹。       <p id="ZH-CN_TOPIC_0000002478174392__p13158162521512"><span><img originheight="243" originwidth="294" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104946.03139381193161706513339450446294:50001231000000:2800:ED87CBA62CB253878E1AC1F92C3A1E218C7C4B2458908D8562947C67B70F9CE1.png" class="notEnlarge" width="294" height="243"></span></p></li>      <li id="li186441640131517">将node_modules文件夹和package.json文件拷贝到无网络电脑的C:\Users\<em>用户名目录</em>\.hvigor\wrapper\tools下（若当前无该目录，请手动创建）。</li>      <li id="li0505181842016">在无网络电脑上执行如下命令，设置npm离线模式：       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174392__screen8606723172019" data-highlighted="yes"><ol class="linenums"><li>npm config <span class=""><span class="hljs-built_in">set</span></span> offline <span class="hljs-literal">true</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section14107194092011">安装npm依赖插件<i class="anchor-icon anchor-icon-link" anchorid="section14107194092011" tips="复制节点链接"></i></h3>          <ol id="ZH-CN_TOPIC_0000002478174392__ol47642454221">      <li id="li16764104532214">请在可访问网络的电脑上创建一个空文件夹，在文件夹中创建一个package.json文件，配置npm依赖，示例如下：       <div _ngcontent-awu-c106="" class="highlight-div"><div _ngcontent-awu-c106="" class="highlight-div-header"><div _ngcontent-awu-c106="" class="highlight-div-header-left"><div _ngcontent-awu-c106="" class="handle-button expand-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-awu-c106="" class="highlight-div-header-right"><div _ngcontent-awu-c106="" class="handle-button ai-button"></div><div _ngcontent-awu-c106="" class="handle-button line-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-awu-c106="" class="handle-button theme-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-awu-c106="" class="handle-button copy-button"><div _ngcontent-awu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-awu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174392__screen4189165314437" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"dependencies"</span>: {</li><li>    <span class="hljs-string">"ajv"</span>: <span class="hljs-string">"latest"</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li id="li01891253174319">打开<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-commandline-get">命令行工具</a>，在文件夹下执行 npm install 命令，会生成node_modules文件夹。       <p id="ZH-CN_TOPIC_0000002478174392__p4292114615343"><span><img originheight="162" originwidth="420" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104946.25233052899882141990654799691247:50001231000000:2800:FB4E5388A23E7C39BB273F125BE8AAA763D6651F9255F029C778B6A3610BF8FA.png" width="420" height="162"></span></p></li>      <li id="li6509625144412">将node_modules文件夹拷贝到无网络电脑的工程根目录下。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section3262144662113">安装ohpm依赖插件<i class="anchor-icon anchor-icon-link" anchorid="section3262144662113" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p2037113516222">请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-no-network#section208435578175">安装三方库</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section211813115522">安装libGL1库<i class="anchor-icon anchor-icon-link" anchorid="section211813115522" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478174392__p570382512521">在linux系统的构建场景下，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile-app#section2095319147103">纹理压缩</a>功能需要安装libGL1库。</p>     <p id="ZH-CN_TOPIC_0000002478174392__p5604122911516">请在可访问网络的电脑上下载libGL1库，例如Ubuntu/Debian下载libgl1-mesa-dev，CentOS/RHEL下载mesa-libGL-devel，并将安装包拷贝到无网络电脑中进行安装。</p>    </div>   </div></div>