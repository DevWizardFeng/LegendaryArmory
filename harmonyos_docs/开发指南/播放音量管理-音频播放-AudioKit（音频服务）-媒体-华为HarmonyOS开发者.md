<h1 _ngcontent-sba-c119="" class="doc-title ng-star-inserted" title="播放音量管理"> 播放音量管理 </h1>

<div _ngcontent-sba-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供播放音量管理能力，包括对<strong>系统音量</strong>、<strong>应用音量</strong>和<strong>音频流音量</strong>的管理。</p>    <p><strong>系统音量</strong>是由HarmonyOS系统全局管理的音量设置，适用于所有应用程序和设备。HarmonyOS系统将音频分为不同的流类型，每种流类型有独立的系统音量控制。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>系统音量可以通过物理音量按键或系统设置界面调节。在设置界面中，用户可以单独调整上述每种系统音量的大小。</p>     </div></div></div>    <p>常见的流类型以及对应的系统音量如下所示。</p>    <ul>     <li>媒体音量：用于音乐、视频、游戏等媒体播放。</li>     <li>通话音量：用于语音通话。</li>     <li>铃声音量：用于来电铃声。</li>     <li>闹钟音量：用于闹钟提醒。</li>    </ul>    <p><strong>应用音量</strong>是HarmonyOS提供给三方应用用来控制该应用下所有音频流音量的一种音量类型。三方应用设置应用音量之后，该应用中起的所有音频流默认使用该音量大小。另外具有系统应用权限的应用可以通过UID单独调整指定应用的音量。</p>    <p><strong>音频流音量</strong>是由应用独立控制的音量设置，仅影响该应用中指定的音频流输出音量大小。例如：媒体播放器可以独立控制其播放音量，而不影响系统音量以及该应用中的其他类型流音量。</p>    <p>系统音量、应用音量和音频流音量的关系如下所示。</p>    <ul>     <li>      <p>层级关系：系统音量是全局的，应用音量和音频流音量是局部的。</p>      <p>应用音量和音频流音量的调整范围受系统音量的限制。例如：系统媒体音量设置为50%，应用音量设置为100%，应用程序的最终输出音量只能达到50%。</p>      <p>音频流音量是对应用音量的更精细化控制。设置了应用音量的三方应用，还可以继续通过音频流音量对指定的音频流进行更加精细化的控制。</p></li>     <li>      <p>协同关系：应用最终的输出音量是由系统音量、应用音量和音频流音量共同决定的。例如：系统媒体音量设置为50%，应用音量设置为50%，应用程序中对媒体音频流设置音频流音量为100%，则该音频流最终输出的音量为25%。</p></li>    </ul>    <p>HarmonyOS通过系统音量，应用音量和音频流音量协同的方式实现应用对音量的精确控制。</p>    <div class="tiledSection">     <h2 id="系统音量">系统音量<i class="anchor-icon anchor-icon-link" anchorid="系统音量" tips="复制节点链接"></i></h2>          <p>管理系统音量的接口由AudioVolumeManager提供，在使用之前，需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiomanager#getvolumemanager9" target="_blank">getVolumeManager()</a>获取AudioVolumeManager实例。</p>     <p>通过AudioVolumeManager只能获取音量信息及监听音量变化，不能主动调节系统音量。如果应用需要调节系统音量，可以<a href="/consumer/cn/doc/harmonyos-guides/volume-management#使用音量面板调节系统音量">使用音量面板调节系统音量</a>。</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-keyword">let</span> audioVolumeManager = audioManager.<span class="hljs-title function_">getVolumeManager</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取音量信息" class="firsth2">获取音量信息<i class="anchor-icon anchor-icon-link" anchorid="获取音量信息" tips="复制节点链接"></i></h3>          <p>管理系统音量的接口由AudioVolumeManager提供，在使用之前，需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiomanager#getvolumemanager9" target="_blank">getVolumeManager()</a>获取AudioVolumeManager实例。</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-keyword">let</span> audioVolumeManager = audioManager.<span class="hljs-title function_">getVolumeManager</span>();</li></ol></pre></div></div>     <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiovolumemanager" target="_blank">AudioVolumeManager</a>获取指定流类型的音量信息。</p>     <p>示例代码如下所示：</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 获取指定流的音量。</span></li><li>audioVolumeManager.<span class="hljs-title function_">getVolumeByStream</span>(audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>);</li><li>
</li><li><span class="hljs-comment">// 获取指定流的最小音量。</span></li><li>audioVolumeManager.<span class="hljs-title function_">getMinVolumeByStream</span>(audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>);</li><li>
</li><li><span class="hljs-comment">// 获取指定流的最大音量。</span></li><li>audioVolumeManager.<span class="hljs-title function_">getMaxVolumeByStream</span>(audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听系统音量变化">监听系统音量变化<i class="anchor-icon anchor-icon-link" anchorid="监听系统音量变化" tips="复制节点链接"></i></h3>          <p>通过设置监听事件，可以监听系统音量的变化：</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>audioVolumeManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'streamVolumeChange'</span>, audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-function">(<span class="hljs-params">streamVolumeEvent: audio.StreamVolumeEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`StreamUsagem: <span class="hljs-subst">${streamVolumeEvent.streamUsage}</span> `</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Volume level: <span class="hljs-subst">${streamVolumeEvent.volume}</span> `</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Whether to updateUI: <span class="hljs-subst">${streamVolumeEvent.updateUi}</span> `</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用音量面板调节系统音量">使用音量面板调节系统音量<i class="anchor-icon anchor-icon-link" anchorid="使用音量面板调节系统音量" tips="复制节点链接"></i></h3>          <p>应用无法直接调节系统音量，可以通过系统音量面板，让用户通过界面操作来调节音量。当用户通过应用内音量面板调节音量时，系统会展示音量提示界面，显性地提示用户系统音量发生改变。</p>     <p>系统提供了ArkTS组件AVVolumePanel（音量面板），应用可以创建该组件，具体样例和介绍请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-multimedia-avvolumepanel" target="_blank">AVVolumePanel参考文档</a>。</p>    </div>    <div class="tiledSection">     <h2 id="应用音量">应用音量<i class="anchor-icon anchor-icon-link" anchorid="应用音量" tips="复制节点链接"></i></h2>          <p>管理应用音量的接口由AudioVolumeManager提供，在使用之前，需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiomanager#getvolumemanager9" target="_blank">getVolumeManager()</a>获取AudioVolumeManager实例。</p>     <p>当<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#audiovolumemode19" target="_blank">音量模式</a>设置为APP_INDIVIDUAL时，可通过下面示例接口设置、查询应用音量。</p>    </div>    <div class="tiledSection">     <h3 id="调节应用音量" class="firsth2">调节应用音量<i class="anchor-icon anchor-icon-link" anchorid="调节应用音量" tips="复制节点链接"></i></h3>          <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-keyword">let</span> audioVolumeManager = audioManager.<span class="hljs-title function_">getVolumeManager</span>();</li><li>
</li><li><span class="hljs-comment">// 设置应用的音量（范围为0到100）。</span></li><li>audioVolumeManager.<span class="hljs-title function_">setAppVolumePercentage</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`set app volume success.`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 查询应用音量。</span></li><li>audioVolumeManager.<span class="hljs-title function_">getAppVolumePercentage</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`app volume is <span class="hljs-subst">${value}</span>.`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 监听应用音量变化，on方法和off方法传入callback参数一致，off方法取消对应on方法订阅的监听。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">appVolumeChangeCallback</span> = (<span class="hljs-params">volumeEvent: audio.VolumeEvent</span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`VolumeType of stream: <span class="hljs-subst">${volumeEvent.volumeType}</span> `</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Volume level: <span class="hljs-subst">${volumeEvent.volume}</span> `</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Whether to updateUI: <span class="hljs-subst">${volumeEvent.updateUi}</span> `</span>);</li><li>};</li><li>audioVolumeManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'appVolumeChange'</span>, appVolumeChangeCallback);</li><li>audioVolumeManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'appVolumeChange'</span>, appVolumeChangeCallback);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="音频流音量">音频流音量<i class="anchor-icon anchor-icon-link" anchorid="音频流音量" tips="复制节点链接"></i></h2>          <p>管理音频流音量的接口是AVPlayer或AudioRenderer的setVolume()方法，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-f#mediacreateavplayer9" target="_blank">AVPlayer</a>设置音频流音量的示例代码如下：</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> volume = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// 指定的音量大小，取值范围为[0.00-1.00]，1表示最大音量。</span></li><li>avPlayer.<span class="hljs-title function_">setVolume</span>(volume);</li></ol></pre></div></div>     <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-f#audiocreateaudiorenderer8" target="_blank">AudioRenderer</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#setvolume9" target="_blank">setVolume</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#getvolume12" target="_blank">getVolume</a>接口分别完成音频流音量的设置和获取。</p>     <p>示例代码如下所示：</p>     <div _ngcontent-sba-c106="" class="highlight-div"><div _ngcontent-sba-c106="" class="highlight-div-header"><div _ngcontent-sba-c106="" class="highlight-div-header-left"><div _ngcontent-sba-c106="" class="handle-button expand-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sba-c106="" class="highlight-div-header-right"><div _ngcontent-sba-c106="" class="handle-button ai-button"></div><div _ngcontent-sba-c106="" class="handle-button line-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sba-c106="" class="handle-button theme-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sba-c106="" class="handle-button copy-button"><div _ngcontent-sba-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sba-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 设置音频流音量。</span></li><li>audioRenderer.<span class="hljs-title function_">setVolume</span>(<span class="hljs-number">0.5</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {  <span class="hljs-comment">// 音量范围为[0.0-1.0]。</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Invoke setVolume succeeded.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Invoke setVolume failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 获取音频流音量。</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = audioRenderer.<span class="hljs-title function_">getVolume</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Indicate that the volume is obtained <span class="hljs-subst">${value}</span>.`</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to obtain the volume, error <span class="hljs-subst">${error}</span>.`</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>