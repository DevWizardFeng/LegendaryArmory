<h1 _ngcontent-atl-c119="" class="doc-title ng-star-inserted" title="支付并签约场景"> 支付并签约场景 </h1>

<div _ngcontent-atl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>从4.1.0(11)版本开始，新增支持支付并签约场景。</p>     <p>用户在商户APP应用/元服务选购完不同的商品确认订单后，跳转至用户支付并签约确认页面，用户完成支付并签约后，后续再次购买商品时，商户可以直接发起代扣，减少用户拉起收银台、输入支付密码等相关操作。</p>     <p>支持商户模型：直连商户、服务商</p>     <p>华为支付支付并签约页面展示：</p>     <div class="tablenoborder">      <div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab">               <tbody><tr>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="33.5%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114548.00792552157920822005596400059333:50001231000000:2800:DD1DD9B24457A4F4599428341D7652AE1628BAF901F61F562AE161A74D5B0C32.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="33.5%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114549.17692888426363694806124820079602:50001231000000:2800:5ABD1CB2039870B7377779F78C7F4F2A1E444391542A957228FFF30F14861EEB.png" title="点击放大" width="204.91310000000001"></span></p></td>         <td class="cell-norowborder" style="border: none;" valign="top" width="33%">&nbsp;&nbsp;</td>        </tr>        <tr>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33.5%">          <p>支付并签约确认页面</p></td>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33.5%">          <p>结果展示页面</p></td>         <td class="cellrowborder" style="border: none;" valign="top" width="33%">&nbsp;&nbsp;</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1914115355610">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1914115355610" tips="复制节点链接"></i></h2>          <p>开发者通过接入Payment Kit 提供的支付并签约能力，可以让用户在支付完成后快速与商户建立签约代扣的关系。具体接入流程如下：</p>     <p><span><img height="678.04" originheight="695" originwidth="943" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114549.19647534220368295309058256547922:50001231000000:2800:C544192653FD7F8E683DC3C1E19402AD611954A3BD1D4CE361CC2FFEE4F1664D.png" title="点击放大" width="920"></span></p>     <ol>      <li>商户客户端请求商户服务端创建商品订单。</li>      <li>商户服务端调用Payment Kit服务端<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-prepay" target="_blank">直连商户预下单</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-prepay" target="_blank">服务商预下单</a>接口。</li>      <li>Payment Kit服务端返回预支付ID（prepayId）给商户服务端。</li>      <li>商户服务端组建订单信息参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>返回给商户客户端。</li>      <li>商户客户端使用orderStr调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起Payment Kit支付收银台。</li>      <li>Payment Kit客户端展示支付收银台。</li>      <li>用户通过收银台完成支付并签约。</li>      <li>Payment Kit服务端处理支付并同步返回支付受理成功结果给Payment Kit客户端。</li>      <li>Payment Kit异步处理支付完成并回调支付结果给商户服务端（支付失败场景不会有支付结果回调通知）。商户服务端需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">SM2验签方式</a>对支付结果进行验签。</li>      <li>Payment Kit服务端处理签约并同步返回签约受理成功结果给Payment Kit客户端。</li>      <li>Payment Kit服务端异步处理签约完成后回调签约结果给商户服务端（取消签约和签约失败场景不会有回调结果通知）。商户服务端需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">SM2验签方式</a>对签约结果进行验签。</li>      <li>Payment Kit客户端展示结果页。</li>      <li>用户关闭结果页后Payment Kit客户端会返回支付状态给商户客户端。</li>      <li>商户客户端进行后续处理操作。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section888155551">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section888155551" tips="复制节点链接"></i></h2>          <p>接口返回值有两种返回形式：Promise和AsyncCallback。Promise和AsyncCallback只是返回方式不一样，功能相同。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>requestPayment(context:common.UIAbilityContext, orderStr: string): Promise&lt;void&gt;;</p></td>         <td class="cellrowborder" rowspan="2" valign="top" width="50%">          <p>拉起Payment Kit支付收银台。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top">          <p>requestPayment(context:common.UIAbilityContext, orderStr: string, callback: AsyncCallback&lt;void&gt;): void;</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section20469337195710">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section20469337195710" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section099217442406" class="firsth2">预下单（服务器开发）<i class="anchor-icon anchor-icon-link" anchorid="section099217442406" tips="复制节点链接"></i></h3>          <ol>      <li>按照商户模型调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-prepay" target="_blank">直连商户预下单</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-prepay" target="_blank">服务商预下单</a>接口获取预支付ID（prepayId）。       <p>为保证支付订单的安全性和可靠性需要对请求body和请求头PayMercAuth对象内的入参排序拼接进行签名，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section174821258151218" target="_blank">签名规则</a>。</p></li>      <li>构建订单信息参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>返回给客户端，业务接口请求示例代码可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect#section5626882242">业务接口请求</a>。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section096046124213">拉起华为支付收银台（端侧开发）<i class="anchor-icon anchor-icon-link" anchorid="section096046124213" tips="复制节点链接"></i></h3>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起Payment Kit支付收银台。</p>     <p>支付并签约拉起支付收银台与商户基础支付场景处理逻辑一致，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-payment-process#section19371156173617">这里</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section666084045417">支付并签约结果处理（服务器开发）<i class="anchor-icon anchor-icon-link" anchorid="section666084045417" tips="复制节点链接"></i></h3>          <p>商户在构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-prepay" target="_blank">直连商户预下单</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-prepay" target="_blank">服务商预下单</a>请求参数时，传入一个callbackUrl。在完成支付并签约后，华为支付服务器将以POST方式调用callbackUrl，将支付并签约的结果返回给商户服务器。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>如果用户没有提前登录，系统会自动拉起华为账号登录页面让用户登录。</li>        <li>支付并签约接口请求成功不代表支付或签约成功，建议不要以客户端签约收银台返回作为用户支付并签约的最终结果，需以服务器接收到的结果通知或者查询API返回为准。</li>       </ul>      </div></div></div>    </div>    <p>为保证信息合法性，商户服务器需要对返回的支付信息进行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">SM2验签</a>，验签注意事项：</p>    <ol>     <li>需直接使用通知的完整内容进行验签。</li>     <li>验签前需要对返回数据进行排序拼接，sign字段是签名值，排序拼接后的待验签内容需要排除sign字段。</li>     <li>验签公钥使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-certificates-config#section14253153941510">华为支付证书</a>。</li>    </ol>    <div class="tiledSection">     <h2 id="section2207214587">延伸和拓展<i class="anchor-icon anchor-icon-link" anchorid="section2207214587" tips="复制节点链接"></i></h2>          <p>当开发者完成上述支付并签约接入操作之后还可以调用以下API接口完成订单相关操作。</p>    </div>    <div class="tiledSection">     <h3 id="section166835210620" class="firsth2">直连商户<i class="anchor-icon anchor-icon-link" anchorid="section166835210620" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-query-order" target="_blank">查询支付订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas--refund" target="_blank">申请退款</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-query-refund" target="_blank">查询退款订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-sign-query" target="_blank">查询签约订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pas-withhold-unsign" target="_blank">申请解约</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-query-trade-bill" target="_blank">查询对账单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-query-settle-bill" target="_blank">查询结算账单</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section155724462615">服务商<i class="anchor-icon anchor-icon-link" anchorid="section155724462615" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-query-order" target="_blank">查询支付订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-refund" target="_blank">申请退款</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-query-refund" target="_blank">查询退款订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-sign-query" target="_blank">查询签约订单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-pas-unsign" target="_blank">申请解约</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-agent-query-trade-bill" target="_blank">查询对账单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-partner-agent-query-settle-bill" target="_blank">查询结算账单</a>。</p>    </div>    <p></p>   </div>   <div></div></div>