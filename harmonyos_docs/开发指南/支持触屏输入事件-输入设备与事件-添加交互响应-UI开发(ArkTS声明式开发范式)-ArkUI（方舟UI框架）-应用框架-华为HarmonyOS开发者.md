<h1 _ngcontent-oji-c119="" class="doc-title ng-star-inserted" title="支持触屏输入事件"> 支持触屏输入事件 </h1>

<div _ngcontent-oji-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><span><img originheight="353" originwidth="714" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114901.64225282003106319279457489501643:50001231000000:2800:F1C730AE467F45ED1C263930E65FDDA8AF9B3E2884B062FC1C21F5E017068CA6.png" width="714" height="353"></span></p>    <p>触屏设备是最常见的输入设备，几乎所有手持类终端设备都支持用户通过触控操作。触摸事件也是应用开发者最常处理的事件类型之一。</p>    <p>需要注意的是，对于其他类型的输入设备上的类似触控行为的操作，系统为了交互一致性，也会将其转换为触摸事件派发给应用，如按下<strong>鼠标</strong>左键点击、滑动，既可以接收到Touch事件，也可以接收到鼠标事件。如果要将其与触屏设备产生的触摸事件进行区分，可以通过事件中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-settings#sourcetype枚举说明8" target="_blank">SourceType</a>进行判断。</p>    <div class="tiledSection">     <h2 id="触摸事件">触摸事件<i class="anchor-icon anchor-icon-link" anchorid="触摸事件" tips="复制节点链接"></i></h2>          <p>触摸事件可以通过通用属性<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#ontouch" target="_blank">onTouch</a>在组件上接收，该回调响应遵循命中测试规则</p>     <p>触摸事件的上报频率会由系统降采样到与屏幕刷新率一致，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-interaction-development-guide-touch-screen#重采样与历史点">重采样与历史点</a>章节。</p>     <p>对于支持多点触控的输入设备，使用多根手指同时操作可以产生多个触点，全部的触点信息可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明" target="_blank">touches</a>成员得到，而changedTouches会给出当前事件上报时，是哪些触点在产生变化。</p>     <p>其他更多的事件信息可以从<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明" target="_blank">TouchEvent</a>的基类<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-customize-judge#baseevent8" target="_blank">BaseEvent</a>中获得。</p>    </div>    <div class="tiledSection">     <h2 id="阻止冒泡">阻止冒泡<i class="anchor-icon anchor-icon-link" anchorid="阻止冒泡" tips="复制节点链接"></i></h2>          <p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-interaction-basic-principles#事件冒泡">事件冒泡</a>了解冒泡机制，以下是一个简单示例，实现了只要点击在子组件区域内，就阻止父组件接收触摸事件：</p>     <div _ngcontent-oji-c106="" class="highlight-div"><div _ngcontent-oji-c106="" class="highlight-div-header"><div _ngcontent-oji-c106="" class="highlight-div-header-left"><div _ngcontent-oji-c106="" class="handle-button expand-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oji-c106="" class="highlight-div-header-right"><div _ngcontent-oji-c106="" class="handle-button ai-button"></div><div _ngcontent-oji-c106="" class="handle-button line-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oji-c106="" class="handle-button theme-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oji-c106="" class="handle-button copy-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oji-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Column</span>() { <span class="hljs-comment">// 父组件</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"  如果点中了我，就阻止父组件收到触摸事件  "</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">"40%"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Brown</span>)</li><li>          .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event:TouchEvent</span>)=&gt;</span>{</li><li>            event.<span class="hljs-title function_">stopPropagation</span>() <span class="hljs-comment">// 子组件优先接收到触摸事件后，阻止父组件接收事件</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">End</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event:TouchEvent</span>)=&gt;</span>{</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"touch event received on parent"</span>)</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>对事件的冒泡进行控制不会影响手势对触摸事件的接收与处理，因此需要分别考虑这两者。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="重采样与历史点">重采样与历史点<i class="anchor-icon anchor-icon-link" anchorid="重采样与历史点" tips="复制节点链接"></i></h2>          <p>基础事件的上报频率与具体的输入设备类型有关，但一般频率都是非常高的，如触屏一般每5~7ms即上报一个点，而对于一些高精度鼠标，上报频率最高可达到每1ms上报一次。由于对输入事件的响应是为了UI界面的变化来产生对用户操作的响应，因此将如此之高的基础事件上报给应用，多数情况下是冗余的，为此系统会对两帧之间所收到的基础事件进行重采样，只在帧内上报一次给应用，重采样是针对每个触点单独进行的，不同触点会单独进行重采样。</p>     <p><span><img originheight="447" originwidth="1304" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114901.36426672597092655315508211090221:50001231000000:2800:C2E2CC2133A20581AD1BB5878672258AF09439CF7A1E295C4F13655E25A4488B.png" width="920" height="315.3680981595092"></span></p>     <ul>      <li>按下时产生的事件会立即上报给应用；</li>      <li>帧内的move报点并不会立即下发，而是会在送显帧到来时重采样合并后上报；</li>      <li>抬起时产生的事件会立即上报给应用，并在上报之前先将还未处理的move事件上报；</li>     </ul>     <p>重采样会合并同一个触点在同一帧内多次上报的move事件，并通过算法尽可能计算出一个合适的坐标上报给应用，因此经过重采样后的坐标信息，与底层设备真实上报的点会存在细微的差异，这些差异是有益的，经过重采样后的点通常具备更好的平顺性。</p>     <p>重采样之前的所有原始点信息也都保留下来上报给了应用，如果需要直接处理它们，则可通过getHistoricalPoints(): Array来获取。</p>     <p>以下是一个简单示例：</p>     <div _ngcontent-oji-c106="" class="highlight-div"><div _ngcontent-oji-c106="" class="highlight-div-header"><div _ngcontent-oji-c106="" class="highlight-div-header-left"><div _ngcontent-oji-c106="" class="handle-button expand-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oji-c106="" class="highlight-div-header-right"><div _ngcontent-oji-c106="" class="handle-button ai-button"></div><div _ngcontent-oji-c106="" class="handle-button line-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oji-c106="" class="handle-button theme-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oji-c106="" class="handle-button copy-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oji-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event: TouchEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// 从event中获取历史点</span></li><li>          <span class="hljs-keyword">let</span> allHistoricalPoints = event.<span class="hljs-title function_">getHistoricalPoints</span>();</li><li>          <span class="hljs-keyword">if</span> (allHistoricalPoints.<span class="hljs-property">length</span> != <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> point <span class="hljs-keyword">of</span> allHistoricalPoints) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"historical point: ["</span> + point.<span class="hljs-property">touchObject</span>.<span class="hljs-property">windowX</span> + <span class="hljs-string">", "</span> + point.<span class="hljs-property">touchObject</span>.<span class="hljs-property">windowY</span> + <span class="hljs-string">"]"</span>)</li><li>            }</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="多指信息">多指信息<i class="anchor-icon anchor-icon-link" anchorid="多指信息" tips="复制节点链接"></i></h2>          <p>在支持多指触控的触屏设备上，上报的事件中同时包含了窗口所有按压手指的信息，可以通过<strong>touches</strong>获取，如下：</p>     <div _ngcontent-oji-c106="" class="highlight-div"><div _ngcontent-oji-c106="" class="highlight-div-header"><div _ngcontent-oji-c106="" class="highlight-div-header-left"><div _ngcontent-oji-c106="" class="handle-button expand-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oji-c106="" class="highlight-div-header-right"><div _ngcontent-oji-c106="" class="handle-button ai-button"></div><div _ngcontent-oji-c106="" class="handle-button line-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oji-c106="" class="handle-button theme-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oji-c106="" class="handle-button copy-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oji-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentFingerCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">allFingerIds</span>: <span class="hljs-built_in">number</span>[] = []</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event: TouchEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> != <span class="hljs-title class_">SourceType</span>.<span class="hljs-property">TouchScreen</span>) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-comment">// clear数组</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">allFingerIds</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">allFingerIds</span>.<span class="hljs-property">length</span>)</li><li>          <span class="hljs-comment">// 从event中获取所有触点信息</span></li><li>          <span class="hljs-keyword">let</span> allFingers = event.<span class="hljs-property">touches</span>;</li><li>          <span class="hljs-keyword">if</span> (allFingers.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFingerCount</span> == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-comment">// 第1根手指按下</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"fingers start to press down"</span>)</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFingerCount</span> = allFingers.<span class="hljs-property">length</span></li><li>          }</li><li>          <span class="hljs-keyword">if</span> (allFingers.<span class="hljs-property">length</span> != <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> finger <span class="hljs-keyword">of</span> allFingers) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">allFingerIds</span>.<span class="hljs-title function_">push</span>(finger.<span class="hljs-property">id</span>)</li><li>            }</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"current all fingers : "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">allFingerIds</span>.<span class="hljs-title function_">toString</span>())</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> == <span class="hljs-title class_">TouchType</span>.<span class="hljs-property">Up</span> &amp;&amp; event.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span> == <span class="hljs-number">1</span>) {</li><li>            <span class="hljs-comment">// 所有手指都已抬起</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"all fingers already up"</span>)</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFingerCount</span> = <span class="hljs-number">0</span></li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>不同触点通过id区分，id按照接触屏幕的顺序依次递增，与物理上的触点（手指）并无严格顺序对应关系。并且这些触点在<strong>touches</strong>数组中并非按照编号大小顺序排列，请不要依赖顺序进行访问，另外，直到所有触点全部离开屏幕之前，期间抬起的触点对应的编号，会在有触点按下时自动复用。</p>     <p>以下是上面的示例在如下操作序列时产生的日志输出情况：</p>     <p><span><img originheight="376" originwidth="373" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114901.69201841402701155837449822114046:50001231000000:2800:7AF85B7402C1DC56A5D69A5EE4D73F510E80C4E5D5E8B6639C381245DBB00D99.png" width="373" height="376"></span></p>     <p>按下手指① -&gt; 按下手指② -&gt; 按下手指③ -&gt; 抬起手指② -&gt; 抬起手指③ -&gt; 按下手指② -&gt; 抬起手指① -&gt; 抬起手指③</p>     <div _ngcontent-oji-c106="" class="highlight-div"><div _ngcontent-oji-c106="" class="highlight-div-header"><div _ngcontent-oji-c106="" class="highlight-div-header-left"><div _ngcontent-oji-c106="" class="handle-button expand-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oji-c106="" class="highlight-div-header-right"><div _ngcontent-oji-c106="" class="handle-button ai-button"></div><div _ngcontent-oji-c106="" class="handle-button line-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oji-c106="" class="handle-button theme-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oji-c106="" class="handle-button copy-button"><div _ngcontent-oji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oji-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-selector-tag">fingers</span> <span class="hljs-selector-tag">start</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">press</span> <span class="hljs-selector-tag">down</span>   <span class="hljs-comment">// 按下手指①</span></li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span>,<span class="hljs-number">1</span>      <span class="hljs-comment">// 按下手指②</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>    <span class="hljs-comment">// 按下手指③</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span>,<span class="hljs-number">2</span>      <span class="hljs-comment">// 抬起手指②</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span>        <span class="hljs-comment">// 抬起手指③</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">0</span>,<span class="hljs-number">1</span>      <span class="hljs-comment">// 按下手指③</span></li><li>  ... ...</li><li>  <span class="hljs-selector-tag">current</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span>: <span class="hljs-number">1</span>        <span class="hljs-comment">// 抬起手指①</span></li><li>  ... ...</li><li>  <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">fingers</span> <span class="hljs-selector-tag">already</span> <span class="hljs-selector-tag">up</span>        <span class="hljs-comment">// 抬起手指③</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="触控笔">触控笔<i class="anchor-icon anchor-icon-link" anchorid="触控笔" tips="复制节点链接"></i></h2>          <p>触控笔操作触摸屏与通过手指操作类似，都会产生触摸事件，可以通过sourceTool进行区分。而对于一些主动式电容笔，上报的触摸事件中，还会包含笔接触屏幕时的夹角信息，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-gesture-customize-judge#baseevent8" target="_blank">BaseEvent</a>。</p>     <ul>      <li>tiltX：触控笔在设备平面上的投影与设备平面X轴的夹角。</li>      <li>tiltY：触控笔在设备平面上的投影与设备平面Y轴的夹角。</li>      <li>rollAngle：触控笔与设备平面的夹角。</li>     </ul>    </div>   </div>   <div></div></div>