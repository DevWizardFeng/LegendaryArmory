<h1 _ngcontent-mlq-c119="" class="doc-title ng-star-inserted" title="支持键盘输入事件"> 支持键盘输入事件 </h1>

<div _ngcontent-mlq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>物理按键产生的按键事件为非指向性事件，与触摸等指向性事件不同，其事件并没有坐标位置信息，所以其会按照一定次序向获焦组件进行派发，大多数文字输入场景下，按键事件都会优先派发给输入法进行处理，以便其处理文字的联想和候选词，应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeypreime12" target="_blank">onKeyPreIme</a>提前感知事件。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>一些系统按键产生的事件并不会传递给UI组件，如电源键。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="按键事件数据流">按键事件数据流<i class="anchor-icon anchor-icon-link" anchorid="按键事件数据流" tips="复制节点链接"></i></h2>          <p><span><img originheight="414" originwidth="351" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114933.12623162058450490971248884855465:50001231000000:2800:B781E3AF859060EDBE6587BAB57D80048C0B548701DF024FC48F30D04D41BB46.png" width="351" height="414"></span></p>     <p>按键事件由外设键盘等设备触发，经驱动和多模处理转换后发送给当前获焦的窗口，窗口获取到事件后，会尝试分发三次事件。三次分发的优先顺序如下，一旦事件被消费，则跳过后续分发流程。</p>     <ol>      <li>首先分发给ArkUI框架用于触发获焦组件绑定的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeypreime12" target="_blank">onKeyPreIme</a>回调和页面快捷键。</li>      <li>再向输入法分发，输入法会消费按键用作输入。</li>      <li>再次将事件发给ArkUI框架，用于响应<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeyeventdispatch15" target="_blank">onKeyEventDispatch</a>事件、获焦组件绑定的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeyevent" target="_blank">onKeyEvent</a>回调以及走焦。</li>     </ol>     <p>因此，当某输入框组件获焦，且打开了输入法，此时大部分按键事件均会被输入法消费。例如字母键会被输入法用来往输入框中输入对应字母字符、方向键会被输入法用来切换选中备选词。如果在此基础上给输入框组件绑定了快捷键，那么快捷键会优先响应事件，事件也不再会被输入法消费。</p>     <p>按键事件到ArkUI框架之后，会先找到完整的节点获焦链。从叶子节点到根节点，逐一发送按键事件，若有子组件可以处理则优先给子组件处理，若子组件无法处理，则进行冒泡寻找父组件进行处理。</p>     <p>Web组件的KeyEvent流程与上述过程有所不同。在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#onkeypreime12" target="_blank">onKeyPreIme</a>返回false时，Web组件不会匹配快捷键。而在第三次按键派发过程中，Web组件会将未消费的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#keyevent对象说明" target="_blank">KeyEvent</a>通过ReDispatch重新派发回ArkUI，在ReDispatch中再执行匹配快捷键等操作。</p>    </div>    <div class="tiledSection">     <h2 id="onkeyevent--onkeypreime">onKeyEvent &amp; onKeyPreIme<i class="anchor-icon anchor-icon-link" anchorid="onkeyevent--onkeypreime" tips="复制节点链接"></i></h2>          <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span>): T</li><li><span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">KeyEvent</span>, <span class="hljs-built_in">boolean</span>&gt;): T</li><li><span class="hljs-title function_">onKeyPreIme</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">KeyEvent</span>, <span class="hljs-built_in">boolean</span>&gt;): T</li><li><span class="hljs-title function_">onKeyEventDispatch</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">KeyEvent</span>, <span class="hljs-built_in">boolean</span>&gt;): T</li></ol></pre></div></div>     <p>上述四种方法的区别仅在于触发的时机（见<a href="/consumer/cn/doc/harmonyos-guides/arkts-interaction-development-guide-keyboard#按键事件数据流">按键事件数据流</a>）。其中onKeyPreIme的返回值决定了该按键事件后续是否会被继续分发给页面快捷键、输入法、onKeyEventDispatch和onKeyEvent。</p>     <p>当绑定方法的组件处于获焦状态下，外设键盘的按键事件会触发该方法，回调参数为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-key#keyevent对象说明" target="_blank">KeyEvent</a>，可由该参数获得当前按键事件的按键行为（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-appendix-enums#keytype" target="_blank">KeyType</a>）、键码（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-keycode#keycode" target="_blank">keyCode</a>）、按键英文名称（keyText）、事件来源设备类型（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-appendix-enums#keysource" target="_blank">KeySource</a>）、事件来源设备id（deviceId）、元键按压状态（metaKey）、时间戳（timestamp）、阻止冒泡设置（stopPropagation）。</p>     <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">KeyEventExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'onKeyEvent'</span>)</li><li>        .<span class="hljs-title function_">defaultFocus</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">140</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">70</span>)</li><li>        .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event?: KeyEvent</span>) =&gt;</span> { <span class="hljs-comment">// 给Button设置onKeyEvent事件</span></li><li>          <span class="hljs-keyword">if</span>(event){</li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> = <span class="hljs-string">'Down'</span>;</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Up</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> = <span class="hljs-string">'Up'</span>;</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span> = <span class="hljs-string">'Button: \n'</span> +</li><li>            <span class="hljs-string">'KeyType:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> + <span class="hljs-string">'\n'</span> +</li><li>            <span class="hljs-string">'KeyCode:'</span> + event.<span class="hljs-property">keyCode</span> + <span class="hljs-string">'\n'</span> +</li><li>            <span class="hljs-string">'KeyText:'</span> + event.<span class="hljs-property">keyText</span>;</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnText</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event?: KeyEvent</span>) =&gt;</span> { <span class="hljs-comment">// 给父组件Column设置onKeyEvent事件</span></li><li>      <span class="hljs-keyword">if</span>(event){</li><li>        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> = <span class="hljs-string">'Down'</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Up</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> = <span class="hljs-string">'Up'</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnText</span> = <span class="hljs-string">'Column: \n'</span> +</li><li>        <span class="hljs-string">'KeyType:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> + <span class="hljs-string">'\n'</span> +</li><li>        <span class="hljs-string">'KeyCode:'</span> + event.<span class="hljs-property">keyCode</span> + <span class="hljs-string">'\n'</span> +</li><li>        <span class="hljs-string">'KeyText:'</span> + event.<span class="hljs-property">keyText</span>;</li><li>      }</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上述示例中给组件Button和其父容器Column绑定onKeyEvent。应用打开页面加载后，组件树上第一个可获焦的非容器组件自动获焦，设置Button为当前页面的默认焦点，由于Button是Column的子节点，Button获焦也同时意味着Column获焦。获焦机制见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-events-focus-event">焦点事件</a>。</p>     <p><span><img originheight="259" originwidth="306" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114933.97904838225457329219025833327108:50001231000000:2800:CB10B0141FC8C28268EC8BAD7968EF25770933095E7A27036C41A425F5A0923F.gif" width="306" height="259"></span></p>     <p>打开应用后，依次在键盘上按这些按键：空格、回车、左Ctrl、左Shift、字母A、字母Z。</p>     <ol>      <li>       <p>由于onKeyEvent事件默认是冒泡的，所以Button和Column的onKeyEvent都可以响应。</p></li>      <li>       <p>每个按键都有2次回调，分别对应KeyType.Down和KeyType.Up，表示按键被按下、然后抬起。</p></li>     </ol>     <p>如果要阻止冒泡，即仅Button响应键盘事件，Column不响应，在Button的onKeyEvent回调中加入event.stopPropagation()方法即可，如下：</p>     <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">KeyEventExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'onKeyEvent'</span>)</li><li>        .<span class="hljs-title function_">defaultFocus</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">140</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">70</span>)</li><li>        .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event?: KeyEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// 通过stopPropagation阻止事件冒泡</span></li><li>          <span class="hljs-keyword">if</span>(event){</li><li>            <span class="hljs-keyword">if</span>(event.<span class="hljs-property">stopPropagation</span>){</li><li>              event.<span class="hljs-title function_">stopPropagation</span>();</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> = <span class="hljs-string">'Down'</span>;</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Up</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> = <span class="hljs-string">'Up'</span>;</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span> = <span class="hljs-string">'Button: \n'</span> +</li><li>              <span class="hljs-string">'KeyType:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonType</span> + <span class="hljs-string">'\n'</span> +</li><li>              <span class="hljs-string">'KeyCode:'</span> + event.<span class="hljs-property">keyCode</span> + <span class="hljs-string">'\n'</span> +</li><li>              <span class="hljs-string">'KeyText:'</span> + event.<span class="hljs-property">keyText</span>;</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnText</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event?: KeyEvent</span>) =&gt;</span> { <span class="hljs-comment">// 给父组件Column设置onKeyEvent事件</span></li><li>      <span class="hljs-keyword">if</span>(event){</li><li>        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> = <span class="hljs-string">'Down'</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Up</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> = <span class="hljs-string">'Up'</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnText</span> = <span class="hljs-string">'Column: \n'</span> +</li><li>          <span class="hljs-string">'KeyType:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span> + <span class="hljs-string">'\n'</span> +</li><li>          <span class="hljs-string">'KeyCode:'</span> + event.<span class="hljs-property">keyCode</span> + <span class="hljs-string">'\n'</span> +</li><li>          <span class="hljs-string">'KeyText:'</span> + event.<span class="hljs-property">keyText</span>;</li><li>      }</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="218" originwidth="273" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114933.75370387553582918788741351373939:50001231000000:2800:57ADECFFF24EE53A5C0B911A1FBCC048E933B671604A39466FF4BD00443AAAD6.gif" class="notEnlarge" width="273" height="218"></span></p>     <p>使用OnKeyPreIme屏蔽在输入框中使用方向左键。</p>     <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeyCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.InputKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PreImeEventExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">buttonType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Search</span>({</li><li>        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">"Search..."</span></li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"40vp"</span>)</li><li>        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">radius</span>:<span class="hljs-string">"20vp"</span> })</li><li>        .<span class="hljs-title function_">onKeyPreIme</span>(<span class="hljs-function">(<span class="hljs-params">event:KeyEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">keyCode</span> == <span class="hljs-title class_">KeyCode</span>.<span class="hljs-property">KEYCODE_DPAD_LEFT</span>) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="147" originwidth="273" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114934.54728608298731702268925746168482:50001231000000:2800:540A95EDADB7FE43D53AE0EBAA4BE868774DA639A8129B46325C76EF18DE3E09.gif" class="notEnlarge" width="273" height="147"></span></p>     <p>使用onKeyEventDispatch分发按键事件到子组件，子组件使用onKeyEvent。</p>     <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'[Sample_Eventproject]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0xF811</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUNDLE</span> = <span class="hljs-string">'Eventproject_'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'button1'</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'button1'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">70</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">30</span> })</li><li>          .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-variable constant_">BUNDLE</span> + <span class="hljs-string">'button1'</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'button2'</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'button2'</span>)</li><li>          .<span class="hljs-title function_">onKeyEvent</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-variable constant_">BUNDLE</span> + <span class="hljs-string">'button2'</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">'Row1'</span>)</li><li>      .<span class="hljs-title function_">onKeyEventDispatch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        context.<span class="hljs-title function_">getFocusController</span>().<span class="hljs-title function_">requestFocus</span>(<span class="hljs-string">'button1'</span>);</li><li>        <span class="hljs-keyword">return</span> context.<span class="hljs-title function_">dispatchKeyEvent</span>(<span class="hljs-string">'button1'</span>, event);</li><li>      })</li><li>
</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">onKeyEventDispatch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> == <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) {</li><li>        <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        context.<span class="hljs-title function_">getFocusController</span>().<span class="hljs-title function_">requestFocus</span>(<span class="hljs-string">'Row1'</span>);</li><li>        <span class="hljs-keyword">return</span> context.<span class="hljs-title function_">dispatchKeyEvent</span>(<span class="hljs-string">'Row1'</span>, event);</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="82" originwidth="188" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114934.93994031309377604885295533067196:50001231000000:2800:2A12BF5A899BDA7E8295856AF4F3C557D5D9A2060DB446076811A76C0B4DB67B.jpg" class="notEnlarge" width="188" height="82"></span></p>     <p>使用OnKeyPreIme实现回车提交（建议使用物理键盘）。</p>     <div _ngcontent-mlq-c106="" class="highlight-div"><div _ngcontent-mlq-c106="" class="highlight-div-header"><div _ngcontent-mlq-c106="" class="highlight-div-header-left"><div _ngcontent-mlq-c106="" class="handle-button expand-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mlq-c106="" class="highlight-div-header-right"><div _ngcontent-mlq-c106="" class="handle-button ai-button"></div><div _ngcontent-mlq-c106="" class="handle-button line-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mlq-c106="" class="handle-button theme-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mlq-c106="" class="handle-button copy-button"><div _ngcontent-mlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mlq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextAreaDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextAreaController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextAreaController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Submissions: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>)</li><li>      <span class="hljs-title class_">TextArea</span>({ <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>, <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> })</li><li>        .<span class="hljs-title function_">onKeyPreIme</span>(<span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(event)}</span>`</span>);</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">keyCode</span> === <span class="hljs-number">2054</span> &amp;&amp; event.<span class="hljs-property">type</span> === <span class="hljs-title class_">KeyType</span>.<span class="hljs-property">Down</span>) { <span class="hljs-comment">// 回车键物理码</span></li><li>            <span class="hljs-keyword">const</span> hasCtrl = event?.<span class="hljs-property">getModifierKeyState</span>?.([<span class="hljs-string">'Ctrl'</span>]);</li><li>            <span class="hljs-keyword">if</span> (hasCtrl) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Line break'</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Submissions：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>;</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">''</span>;</li><li>              event.<span class="hljs-title function_">stopPropagation</span>();</li><li>            }</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = value</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="180" originwidth="600" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114934.64311460803196605032211266240932:50001231000000:2800:54893F92D9B838878B6A68F3127F2F81C43C2A4B920B6F4E0474B80BBA1C5877.png" width="600" height="180"></span></p>     <p>在输入框中输入内容后回车。</p>     <p><span><img originheight="180" originwidth="600" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114934.71562976502696966264794312609037:50001231000000:2800:8333E626A8B79B789233F0A733C88D69C679CB46035CA6CF03BD93BFFE6BC5D2.png" width="600" height="180"></span></p>    </div>   </div>   <div></div></div>