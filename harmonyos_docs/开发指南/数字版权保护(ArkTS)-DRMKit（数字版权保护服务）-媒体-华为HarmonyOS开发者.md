<h1 _ngcontent-pal-c119="" class="doc-title ng-star-inserted" title="数字版权保护(ArkTS)"> 数字版权保护(ArkTS) </h1>

<div _ngcontent-pal-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>开发者可以调用DRM Kit的ArkTS接口实现DRM证书管理、DRM许可证管理、DRM节目授权、DRM节目解密等数字版权保护功能。</p>    <p>DRM Kit提供MediaKeySystem实现DRM证书管理、DRM许可证管理功能，并管理MediaKeySession实例；MediaKeySession实现DRM节目授权，并可支持Media Kit或Media Kit/AVCodec Kit实现DRM节目解密以实现DRM节目播放。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm" target="_blank">DRM API</a>。</p>     <ol>      <li>       <p>导入DRM Kit接口。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { drm } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DrmKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>导入BusinessError模块抛出Drm Kit接口的错误码。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-f#drmgetmediakeysystems12" target="_blank">getMediaKeySystems</a>，获取设备支持的DRM解决方案名称和唯一标识的列表。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">description</span>: drm.<span class="hljs-property">MediaKeySystemDescription</span>[] = drm.<span class="hljs-title function_">getMediaKeySystems</span>();</li></ol></pre></div></div>       <p>如果获取结果数组为空，说明该设备中不存在支持的DRM解决方案。</p></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-f#drmismediakeysystemsupported" target="_blank">isMediaKeySystemSupported</a>，查询设备是否支持对应DRM解决方案名称、媒体类型、安全保护级别的DRM解决方案。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">isSupported</span>: <span class="hljs-built_in">boolean</span> = drm.<span class="hljs-title function_">isMediaKeySystemSupported</span>(<span class="hljs-string">"com.wiseplay.drm"</span>, <span class="hljs-string">"video/mp4"</span>, drm.<span class="hljs-property">ContentProtectionLevel</span>.<span class="hljs-property">CONTENT_PROTECTION_LEVEL_SW_CRYPTO</span>);</li></ol></pre></div></div>       <p>如果查询结果为false，说明该设备不支持对应的DRM解决方案。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-f#drmcreatemediakeysystem" target="_blank">createMediaKeySystem</a>，创建MediaKeySystem实例。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">mediaKeySystem</span>: drm.<span class="hljs-property">MediaKeySystem</span> = drm.<span class="hljs-title function_">createMediaKeySystem</span>(<span class="hljs-string">"com.wiseplay.drm"</span>);</li></ol></pre></div></div>       <p>如果创建失败则返回undefined，说明该设备不支持该DRM解决方案。</p></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#onkeysystemrequired" target="_blank">on('keySystemRequired')</a>，设置MediaKeySystem状态监听事件。</p>       <p>通过注册keySystemRequired回调函数监听设备DRM证书请求事件。该事件在需要设备DRM证书时触发，此时建议完成设备DRM证书请求与处理流程。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySystem.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keySystemRequired'</span>, <span class="hljs-function">(<span class="hljs-params">eventInfo: drm.EventInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'keySystemRequired'</span> + <span class="hljs-string">'extra:'</span> + eventInfo.<span class="hljs-property">extraInfo</span> + <span class="hljs-string">' data:'</span> + eventInfo.<span class="hljs-property">info</span>);</li><li>    <span class="hljs-comment">// 设备DRM证书请求与处理。</span></li><li>});</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#getcertificatestatus" target="_blank">getCertificateStatus</a>，获取设备DRM证书状态。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">certificateStatus</span>: drm.<span class="hljs-property">CertificateStatus</span> = mediaKeySystem.<span class="hljs-title function_">getCertificateStatus</span>();</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#generatekeysystemrequest" target="_blank">generateKeySystemRequest</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#processkeysystemresponse" target="_blank">processKeySystemResponse</a>，生成设备DRM证书请求与处理设备DRM证书响应。</p>       <p>如果设备DRM证书状态不是drm.CertificateStatus.CERT_STATUS_PROVISIONED，可以生成设备DRM证书请求，处理设备DRM证书响应。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span>(certificateStatus != drm.<span class="hljs-property">CertificateStatus</span>.<span class="hljs-property">CERT_STATUS_PROVISIONED</span>) {</li><li>    mediaKeySystem.<span class="hljs-title function_">generateKeySystemRequest</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">drmRequest</span>: drm.<span class="hljs-property">ProvisionRequest</span>) =&gt; {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"generateKeySystemRequest success"</span>, drmRequest.<span class="hljs-property">data</span>, drmRequest.<span class="hljs-property">defaultURL</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"generateKeySystemRequest err end"</span>, err.<span class="hljs-property">code</span>);</li><li>    });</li><li>} <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The certificate already exists."</span>);</li><li>}</li><li><span class="hljs-comment">// 将设备DRM证书请求返回的drmRequest.data通过网络请求发送给DRM证书服务获取设备DRM证书响应，并处理。</span></li><li><span class="hljs-keyword">let</span> provisionResponseByte = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]); <span class="hljs-comment">// 设备DRM证书响应。</span></li><li>mediaKeySystem.<span class="hljs-title function_">processKeySystemResponse</span>(provisionResponseByte).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"processKeySystemResponse success"</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"processKeySystemResponse err end"</span>, err.<span class="hljs-property">code</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#createmediakeysession" target="_blank">createMediaKeySession</a>，创建MediaKeySession实例。</p>       <p>创建该DRM解决方案默认内容保护级别的MediaKeySession实例。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">mediaKeySession</span>: drm.<span class="hljs-property">MediaKeySession</span> = mediaKeySystem.<span class="hljs-title function_">createMediaKeySession</span>();</li></ol></pre></div></div></li>      <li>       <p>（可选）设置MediaKeySession状态监听事件。</p>       <p>监听MediaKeySession实例的事件，包括媒体密钥请求事件、媒体密钥过期事件、媒体密钥有效期更新事件、媒体密钥变换事件等。</p>       <ul>        <li>         <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#onkeyrequired" target="_blank">on('keyRequired')</a>接口监听媒体密钥请求事件，此时建议完成媒体密钥请求与处理流程。</p>         <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyRequired'</span>, <span class="hljs-function">(<span class="hljs-params">eventInfo: drm.EventInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'keyRequired'</span> + <span class="hljs-string">'info:'</span> + eventInfo.<span class="hljs-property">info</span> + <span class="hljs-string">' extraInfo:'</span> + eventInfo.<span class="hljs-property">extraInfo</span>);</li><li>    <span class="hljs-comment">// 媒体密钥请求与处理。</span></li><li>});</li></ol></pre></div></div></li>        <li>         <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#onkeyexpired" target="_blank">on('keyExpired')</a>接口监听媒体密钥过期事件。</p>         <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyExpired'</span>, <span class="hljs-function">(<span class="hljs-params">eventInfo: drm.EventInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'keyExpired'</span> + <span class="hljs-string">'info:'</span> + eventInfo.<span class="hljs-property">info</span> + <span class="hljs-string">' extraInfo:'</span> + eventInfo.<span class="hljs-property">extraInfo</span>);</li><li>});</li></ol></pre></div></div></li>        <li>         <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#onexpirationupdate" target="_blank">on('expirationUpdate')</a>接口监听媒体密钥有效期更新事件。</p>         <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'expirationUpdate'</span>, <span class="hljs-function">(<span class="hljs-params">eventInfo: drm.EventInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'expirationUpdate'</span> + <span class="hljs-string">'info:'</span> + eventInfo.<span class="hljs-property">info</span> + <span class="hljs-string">' extraInfo:'</span> + eventInfo.<span class="hljs-property">extraInfo</span>);</li><li>});</li></ol></pre></div></div></li>        <li>         <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#onkeyschange" target="_blank">on('keysChange')</a>接口监听媒体密钥变换事件。</p>         <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keysChange'</span>, <span class="hljs-function">(<span class="hljs-params">keyInfo : drm.KeysInfo[], newKeyAvailable:<span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keyInfo.<span class="hljs-property">length</span>; i++){</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'keysChange'</span> + <span class="hljs-string">'info:'</span> + keyInfo[i].<span class="hljs-property">keyId</span> + <span class="hljs-string">' extraInfo:'</span> + keyInfo[i].<span class="hljs-property">value</span>);</li><li>    }</li><li>});</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#requiresecuredecodermodule" target="_blank">requireSecureDecoderModule</a>，查询是否需要安全解码。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">status</span>: <span class="hljs-built_in">boolean</span> = mediaKeySession.requireSecureDecoderModule(<span class="hljs-string">"video/avc"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`requireSecureDecoderModule ERROR: <span class="hljs-subst">${error}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#generatemediakeyrequest" target="_blank">generateMediaKeyRequest</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#processmediakeyresponse" target="_blank">processMediaKeyResponse</a>，生成媒体密钥请求与处理媒体密钥响应。</p>       <p>获取到DRM节目中的DRM信息时，可以生成媒体密钥请求，处理媒体密钥响应，以请求许可证完成DRM节目授权。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 根据DRM解决方案要求，基于DRM信息中的pssh生成initData。</span></li><li><span class="hljs-keyword">let</span> initData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]);</li><li><span class="hljs-comment">// 根据DRM解决方案要求设置可选数据的值。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">optionalData</span>:drm.<span class="hljs-property">OptionsData</span>[] = [{</li><li>    <span class="hljs-attr">name</span>: <span class="hljs-string">"optionalDataName"</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-string">"optionalDataValue"</span></li><li>}];</li><li><span class="hljs-comment">// 在线媒体密钥请求和响应。</span></li><li>mediaKeySession.<span class="hljs-title function_">generateMediaKeyRequest</span>(<span class="hljs-string">"video/mp4"</span>, initData, drm.<span class="hljs-property">MediaKeyType</span>.<span class="hljs-property">MEDIA_KEY_TYPE_ONLINE</span>, optionalData).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">licenseRequest</span>: drm.<span class="hljs-property">MediaKeyRequest</span>) =&gt; {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"generateMediaKeyRequest success"</span>, licenseRequest.<span class="hljs-property">mediaKeyRequestType</span>, licenseRequest.<span class="hljs-property">data</span>, licenseRequest.<span class="hljs-property">defaultURL</span>);</li><li>   <span class="hljs-comment">// 将媒体密钥请求返回的licenseRequest.data通过网络请求发送给DRM服务获取媒体密钥响应，并处理。</span></li><li>   <span class="hljs-keyword">let</span> licenseResponse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]); <span class="hljs-comment">// 媒体密钥响应。</span></li><li>   mediaKeySession.<span class="hljs-title function_">processMediaKeyResponse</span>(licenseResponse).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">mediaKeyId: <span class="hljs-built_in">Uint8Array</span></span>) =&gt;</span> {</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"processMediaKeyResponse success"</span>);</li><li>   }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"processMediaKeyResponse err end"</span>, err.<span class="hljs-property">code</span>);</li><li>  });</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"generateMediaKeyRequest err end"</span>, err.<span class="hljs-property">code</span>);</li><li>});</li><li><span class="hljs-comment">// 离线媒体密钥请求和响应。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">offlineMediaKeyId</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li>mediaKeySession.<span class="hljs-title function_">generateMediaKeyRequest</span>(<span class="hljs-string">"video/mp4"</span>, initData, drm.<span class="hljs-property">MediaKeyType</span>.<span class="hljs-property">MEDIA_KEY_TYPE_OFFLINE</span>, optionalData).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">licenseRequest: drm.MediaKeyRequest</span>) =&gt;</span> {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"generateMediaKeyRequest success"</span>, licenseRequest.<span class="hljs-property">mediaKeyRequestType</span>, licenseRequest.<span class="hljs-property">data</span>, licenseRequest.<span class="hljs-property">defaultURL</span>);</li><li>   <span class="hljs-comment">// 将媒体密钥请求返回的licenseRequest.data通过网络请求发送给DRM服务获取媒体密钥响应，并处理。</span></li><li>   <span class="hljs-keyword">let</span> licenseResponse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]); <span class="hljs-comment">// 媒体密钥响应。</span></li><li>   mediaKeySession.<span class="hljs-title function_">processMediaKeyResponse</span>(licenseResponse).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">mediaKeyId: <span class="hljs-built_in">Uint8Array</span></span>) =&gt;</span> {</li><li>     offlineMediaKeyId = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(mediaKeyId);</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"processMediaKeyResponse success"</span>);</li><li>   }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"processMediaKeyResponse err end"</span>, err.<span class="hljs-property">code</span>);</li><li>  });</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err:BusinessError</span>) =&gt;</span>{</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"generateMediaKeyRequest err end"</span>, err.<span class="hljs-property">code</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#restoreofflinemediakeys" target="_blank">restoreOfflineMediaKey</a>，恢复离线媒体密钥。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>mediaKeySession.<span class="hljs-title function_">restoreOfflineMediaKeys</span>(offlineMediaKeyId).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"restoreOfflineMediaKeys success."</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`restoreOfflineMediaKeys: ERROR: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysession#checkmediakeystatus" target="_blank">checkMediaKeyStatus</a>，检查媒体密钥状态。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">mediaKeyStatus</span>: drm.<span class="hljs-property">MediaKeyStatus</span>[]</li><li><span class="hljs-keyword">try</span> {</li><li>  mediaKeyStatus = mediaKeySession.<span class="hljs-title function_">checkMediaKeyStatus</span>()</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`checkMediaKeyStatus: ERROR: <span class="hljs-subst">${error}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>（可选）调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#getofflinemediakeyids" target="_blank">getOfflineMediaKeyIds</a>获取离线媒体密钥标识列表，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#getofflinemediakeystatus" target="_blank">getOfflineMediaKeyStatus</a>获取离线媒体密钥状态，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-drm-mediakeysystem#clearofflinemediakeys" target="_blank">clearOfflineMediaKeys</a>删除离线媒体密钥。</p>       <p>媒体密钥标识用于对离线媒体密钥的管理。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">offlineMediaKeyIds</span>: <span class="hljs-title class_">Uint8Array</span>[] = mediaKeySystem.<span class="hljs-title function_">getOfflineMediaKeyIds</span>();</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">offlineMediaKeyStatus</span>: drm.<span class="hljs-property">OfflineMediaKeyStatus</span> = mediaKeySystem.<span class="hljs-title function_">getOfflineMediaKeyStatus</span>(offlineMediaKeyIds[<span class="hljs-number">0</span>]);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getOfflineMediaKeyStatus ERROR: <span class="hljs-subst">${error}</span>`</span>);</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  mediaKeySystem.<span class="hljs-title function_">clearOfflineMediaKeys</span>(offlineMediaKeyIds[<span class="hljs-number">0</span>]);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`clearOfflineMediaKeys ERROR: <span class="hljs-subst">${error}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>销毁MediaKeySession实例。</p>       <p>完成加密媒体解密，MediaKeySession实例不再使用时，销毁MediaKeySession实例。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// MediaKeySession实例使用完需要进行资源释放。</span></li><li>mediaKeySession.<span class="hljs-title function_">destroy</span>();</li></ol></pre></div></div></li>      <li>       <p>销毁MediaKeySystem实例。</p>       <p>完成DRM功能使用，MediaKeySystem实例不再使用，销毁MediaKeySystem实例。</p>       <div _ngcontent-pal-c106="" class="highlight-div"><div _ngcontent-pal-c106="" class="highlight-div-header"><div _ngcontent-pal-c106="" class="highlight-div-header-left"><div _ngcontent-pal-c106="" class="handle-button expand-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pal-c106="" class="highlight-div-header-right"><div _ngcontent-pal-c106="" class="handle-button ai-button"></div><div _ngcontent-pal-c106="" class="handle-button line-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pal-c106="" class="handle-button theme-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pal-c106="" class="handle-button copy-button"><div _ngcontent-pal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// MediaKeySystem实例使用完需要进行资源释放。</span></li><li>mediaKeySystem.<span class="hljs-title function_">destroy</span>();</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>