<h1 _ngcontent-sbu-c119="" class="doc-title ng-star-inserted" title="数据库备份与恢复 (ArkTS)"> 数据库备份与恢复 (ArkTS) </h1>

<div _ngcontent-sbu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>如果操作或存储的过程中出现问题，开发者可以使用恢复功能，将数据库恢复到之前的状态，重新对数据库进行操作。</p>     <p>在数据库被篡改、删除、或者设备断电场景下，数据库可能会因为数据丢失、数据损坏、脏数据等而不可用，可以通过数据库的备份恢复能力将数据库恢复至可用状态。</p>     <p>键值型数据库和关系型数据库均支持对数据库的备份和恢复。另外，键值型数据库还支持删除数据库备份，以释放本地存储空间。</p>    </div>    <div class="tiledSection">     <h2 id="键值型数据库备份恢复与删除">键值型数据库备份、恢复与删除<i class="anchor-icon anchor-icon-link" anchorid="键值型数据库备份恢复与删除" tips="复制节点链接"></i></h2>          <p>键值型数据库，通过backup接口实现数据库备份，通过restore接口实现数据库恢复，通过deletebackup接口删除数据库备份。具体接口及功能，可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributedkvstore" target="_blank">分布式键值数据库</a>。</p>     <ol>      <li>       <p>创建数据库。</p>       <p>(1) 创建kvManager。</p>       <p>(2) 配置数据库参数。</p>       <p>(3) 创建kvStore。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">ConfigurationConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { distributedKVStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">kvManager</span>: distributedKVStore.<span class="hljs-property">KVManager</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">kvStore</span>: distributedKVStore.<span class="hljs-property">SingleKVStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">kvManagerConfig</span>: distributedKVStore.<span class="hljs-property">KVManagerConfig</span> = {</li><li>      <span class="hljs-attr">context</span>: context,</li><li>      <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.datamanagertest'</span></li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      kvManager = distributedKVStore.<span class="hljs-title function_">createKVManager</span>(kvManagerConfig);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in creating KVManager.'</span>);</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: distributedKVStore.<span class="hljs-property">Options</span> = {</li><li>          <span class="hljs-attr">createIfMissing</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">true</span>,</li><li>          <span class="hljs-attr">backup</span>: <span class="hljs-literal">false</span>,</li><li>          <span class="hljs-attr">autoSync</span>: <span class="hljs-literal">false</span>,</li><li>          <span class="hljs-attr">kvStoreType</span>: distributedKVStore.<span class="hljs-property">KVStoreType</span>.<span class="hljs-property">SINGLE_VERSION</span>,</li><li>          <span class="hljs-attr">securityLevel</span>: distributedKVStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span></li><li>        };</li><li>        kvManager.<span class="hljs-property">getKVStore</span>&lt;distributedKVStore.<span class="hljs-property">SingleKVStore</span>&gt;(<span class="hljs-string">'storeId'</span>, options, <span class="hljs-function">(<span class="hljs-params">err, store: distributedKVStore.SingleKVStore</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (err) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get KVStore. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting KVStore.'</span>);</li><li>          kvStore = store;</li><li>          <span class="hljs-keyword">if</span> (kvStore !== <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-comment">// 进行后续操作</span></li><li>            <span class="hljs-comment">// ...</span></li><li>          }</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (e) {</li><li>        <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create KVManager. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用put()方法插入数据。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span> = <span class="hljs-string">'key_test_string'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span> = <span class="hljs-string">'value_test_string'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Fail to put data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in putting data.'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用backup()方法备份数据。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> backupFile = <span class="hljs-string">'BK001'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">backup</span>(backupFile, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Fail to backup data.code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in backing up data.'</span>);</li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用delete()方法删除数据（模拟意外删除、篡改场景）。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">delete</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Fail to delete data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in deleting data.'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用restore()方法恢复数据。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">restore</span>(backupFile, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Fail to restore data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in restoring data.'</span>);</li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当本地设备存储空间有限或需要重新备份时，还可使用deleteBackup()方法删除备份，释放存储空间。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> files = [backupFile];</li><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">deleteBackup</span>(files).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeed in deleting Backup. Data:filename is <span class="hljs-subst">${data[<span class="hljs-number">0</span>]}</span>,result is <span class="hljs-subst">${data[<span class="hljs-number">1</span>]}</span>.`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Fail to delete Backup. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="关系型数据库备份">关系型数据库备份<i class="anchor-icon anchor-icon-link" anchorid="关系型数据库备份" tips="复制节点链接"></i></h2>          <p>数据库操作或者存储过程中，有可能会因为各种原因发生非预期的数据库异常的情况，可以根据需要使用关系型数据库的备份能力，以便在数据库异常时，可靠高效地恢复数据保证业务数据正常使用。</p>     <p>关系型数据库支持手动备份和自动备份（仅系统应用可用）两种方式。</p>    </div>    <div class="tiledSection">     <h3 id="手动备份" class="firsth2">手动备份<i class="anchor-icon anchor-icon-link" anchorid="手动备份" tips="复制节点链接"></i></h3>          <p>手动备份：通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-rdbstore#backup" target="_blank">backup</a>接口实现数据库手动备份。示例如下：</p>     <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onCreate</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>
</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">STORE_CONFIG</span>: relationalStore.<span class="hljs-property">StoreConfig</span> = {</li><li>      <span class="hljs-attr">name</span>: <span class="hljs-string">'RdbTest.db'</span>,</li><li>      <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span>,</li><li>      <span class="hljs-attr">allowRebuild</span>: <span class="hljs-literal">true</span></li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      store = <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>);</li><li>      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">executeSql</span>(<span class="hljs-string">'CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB)'</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting RdbStore.'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get RdbStore. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!store) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">       * "Backup.db"为备份数据库文件名，默认在RdbStore同路径下备份。</span></li><li><span class="hljs-comment">       * 也可指定绝对路径："/data/storage/el2/database/Backup.db"，文件路径需要存在，不会自动创建目录。</span></li><li><span class="hljs-comment">       */</span></li><li>      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">backup</span>(<span class="hljs-string">"Backup.db"</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in backing up RdbStore.`</span>);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to backup RdbStore. Code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="关系型数据库异常重建">关系型数据库异常重建<i class="anchor-icon anchor-icon-link" anchorid="关系型数据库异常重建" tips="复制节点链接"></i></h2>          <p>在创建或使用关系型数据库的过程中，抛出14800011异常错误码说明数据库出现异常，可以删除数据库后恢复数据。</p>     <p>需要通过在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-i#storeconfig" target="_blank">StoreConfig</a>中配置allowRebuild参数为true以设置数据库在出现异常时自动删库。数据库重建成功后为空库，需要开发者重新建表并且使用提前备份好的数据进行数据恢复，备份操作可见<a href="/consumer/cn/doc/harmonyos-guides/data-backup-and-restore#关系型数据库备份">关系型数据库备份</a>，数据恢复可见<a href="/consumer/cn/doc/harmonyos-guides/data-backup-and-restore#关系型数据库数据恢复">关系型数据库恢复</a>。</p>     <p>若数据库异常前已配置StoreConfig中的allowRebuild为true，则数据库出现异常时将自动删库。</p>     <p>若数据库异常前未配置StoreConfig中的allowRebuild或allowRebuild配置为false，则需将其配置为true再次进行开库。具体示例如下：</p>     <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onCreate</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">STORE_CONFIG</span>: relationalStore.<span class="hljs-property">StoreConfig</span> = {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">'RdbTest.db'</span>,</li><li>        <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span>,</li><li>        <span class="hljs-attr">allowRebuild</span>: <span class="hljs-literal">true</span></li><li>      };</li><li>      store = <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>);</li><li>      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">executeSql</span>(<span class="hljs-string">'CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB)'</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting RdbStore.'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get RdbStore. Code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="关系型数据库数据恢复">关系型数据库数据恢复<i class="anchor-icon anchor-icon-link" anchorid="关系型数据库数据恢复" tips="复制节点链接"></i></h2>          <p>针对数据库出现异常的情况，在数据库重建成功后，需要用提前备份好的数据进行数据恢复。</p>     <p>恢复方式分以下两种，手动备份恢复和自动备份恢复（仅系统应用可用）。</p>    </div>    <div class="tiledSection">     <h3 id="恢复手动备份数据" class="firsth2">恢复手动备份数据<i class="anchor-icon anchor-icon-link" anchorid="恢复手动备份数据" tips="复制节点链接"></i></h3>          <p>关系型数据库通过调用backup接口可以实现<a href="/consumer/cn/doc/harmonyos-guides/data-backup-and-restore#手动备份">手动备份数据库</a>，通过restore接口可以实现手动恢复数据库。</p>     <p>具体恢复过程和关键示例代码片段如下，完整示例代码请结合关系型数据库的备份、重建等上下文进行实现。</p>     <ol>      <li>       <p>抛出数据库异常错误码。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> predicates = <span class="hljs-keyword">new</span> relationalStore.<span class="hljs-title class_">RdbPredicates</span>(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (store != <span class="hljs-literal">undefined</span>) {</li><li>  (store <span class="hljs-keyword">as</span> relationalStore.<span class="hljs-property">RdbStore</span>).<span class="hljs-title function_">query</span>(predicates, [<span class="hljs-string">"ID"</span>, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"AGE"</span>, <span class="hljs-string">"SALARY"</span>, <span class="hljs-string">"CODES"</span>]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: relationalStore.ResultSet</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> resultSet = result;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">/* ...</span></li><li><span class="hljs-comment">         业务的增删改逻辑</span></li><li><span class="hljs-comment">         ...</span></li><li><span class="hljs-comment">      */</span></li><li>      <span class="hljs-comment">// 抛出异常</span></li><li>      <span class="hljs-keyword">if</span> (resultSet?.<span class="hljs-property">rowCount</span> == -<span class="hljs-number">1</span>) {</li><li>        resultSet ?.<span class="hljs-title function_">isColumnNull</span>(<span class="hljs-number">0</span>);</li><li>      }</li><li>      <span class="hljs-comment">// todo resultSet.goToFirstRow(), resultSet.count等其它接口也会抛异常</span></li><li>      <span class="hljs-keyword">while</span> (resultSet.<span class="hljs-title function_">goToNextRow</span>()) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(resultSet.<span class="hljs-title function_">getRow</span>()))</li><li>      }</li><li>      resultSet.<span class="hljs-title function_">close</span>();</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> === <span class="hljs-number">14800011</span>) {</li><li>           <span class="hljs-comment">// 执行下文的步骤，即关闭结果集之后进行数据的恢复</span></li><li>        }</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>    }</li><li>  })</li><li>}</li></ol></pre></div></div></li>      <li>       <p>关闭所有打开着的结果集。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取所有打开着的结果集</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">resultSets</span>: <span class="hljs-title class_">Array</span>&lt;relationalStore.<span class="hljs-property">ResultSet</span>&gt; = [];</li><li><span class="hljs-comment">// 使用resultSet.close()方法关闭所有打开着的结果集</span></li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> resultSet <span class="hljs-keyword">of</span> resultSets) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    resultSet.<span class="hljs-title function_">close</span>();</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">code</span> !== <span class="hljs-number">14800014</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Code:<span class="hljs-subst">${e.code}</span>, message:<span class="hljs-subst">${e.message}</span>`</span>);</li><li>      }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用restore接口恢复数据。</p>       <div _ngcontent-sbu-c106="" class="highlight-div"><div _ngcontent-sbu-c106="" class="highlight-div-header"><div _ngcontent-sbu-c106="" class="highlight-div-header-left"><div _ngcontent-sbu-c106="" class="handle-button expand-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sbu-c106="" class="highlight-div-header-right"><div _ngcontent-sbu-c106="" class="handle-button ai-button"></div><div _ngcontent-sbu-c106="" class="handle-button line-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sbu-c106="" class="handle-button theme-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sbu-c106="" class="handle-button copy-button"><div _ngcontent-sbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sbu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onCreate</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">STORE_CONFIG</span>: relationalStore.<span class="hljs-property">StoreConfig</span> = {</li><li>      <span class="hljs-attr">name</span>: <span class="hljs-string">"RdbTest.db"</span>,</li><li>      <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span>,</li><li>      <span class="hljs-attr">allowRebuild</span>: <span class="hljs-literal">true</span></li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">       * "Backup.db"为备份数据库文件名，默认在当前 store 所在路径下查找备份文件 Backup.db。</span></li><li><span class="hljs-comment">       * 如在备份时指定了绝对路径："/data/storage/el2/database/Backup.db", 需要传入绝对路径。</span></li><li><span class="hljs-comment">       */</span></li><li>      <span class="hljs-keyword">let</span> backupFilePath = context.<span class="hljs-property">databaseDir</span> + <span class="hljs-string">'/rdb/Backup.db'</span>;</li><li>      <span class="hljs-keyword">const</span> backupExist = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">access</span>(backupFilePath);</li><li>      <span class="hljs-keyword">if</span> (!backupExist) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Backup is not exist."</span>);</li><li>        <span class="hljs-comment">// todo 开库建表</span></li><li>        <span class="hljs-comment">// todo 自行生成数据</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Code:<span class="hljs-subst">${e.code}</span>, message:<span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      store = <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>);</li><li>      <span class="hljs-comment">// 调用restore接口恢复数据</span></li><li>      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">restore</span>(<span class="hljs-string">"Backup.db"</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Restore from backup success."</span>)</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">const</span> err = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get RdbStore. Code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/data-base-upgrade" target="_blank">数据库的备份与恢复</a></li>     </ul>    </div>   </div>   <div></div></div>