<h1 _ngcontent-cgw-c119="" class="doc-title ng-star-inserted" title="文本转语音"> 文本转语音 </h1>

<div _ngcontent-cgw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Core Speech Kit支持将一篇不超过10000字数的中英文文本（简体中文、繁体中文、数字、英文）合成为语音，并以选定音色进行播报。</p>    <p>开发者可对播报的策略进行设置，包括单词播报、数字播报、静音停顿、汉字发音策略。</p>    <div class="tiledSection">     <h2 id="section1384112112520">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1384112112520" tips="复制节点链接"></i></h2>          <p>手机/平板等设备在无网状态下，系统应用无障碍（屏幕朗读）接入文本转语音能力，为视障人士或不方便阅读场景提供播报能力。</p>    </div>    <div class="tiledSection">     <h2 id="section2020122517405">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2020122517405" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%">          <p>AI能力</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%">          <p>约束</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>文本转语音（中国境内版本）</p></td>         <td class="cellrowborder" valign="top" width="50%">          <ul>           <li>支持的语种类型：中文、英文。（简体中文、繁体中文、中文语境下的英文）</li>           <li>支持的音色类型：聆小珊女声音色、英语（美国）劳拉女声音色、凌飞哲男声音色。</li>           <li>文本长度：不超过10000字数。</li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section174753641217">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section174753641217" tips="复制节点链接"></i></h2>          <ol>      <li><span>在使用文本转语音时，将实现文本转语音相关的类添加至工程。</span>       <p></p>       <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { textToSpeech } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreSpeechKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>调用createEngine接口，创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section185526396124" target="_blank">TextToSpeechEngine</a>实例。</span>       <p></p>       <p>createEngine接口提供了两种调用形式，当前以其中一种作为示例，其他方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech" target="_blank">API参考</a>。</p>       <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">ttsEngine</span>: textToSpeech.<span class="hljs-property">TextToSpeechEngine</span>;</li><li>
</li><li><span class="hljs-comment">// 设置创建引擎参数</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">extraParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {<span class="hljs-string">"style"</span>: <span class="hljs-string">'interaction-broadcast'</span>, <span class="hljs-string">"locate"</span>: <span class="hljs-string">'CN'</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">'EngineName'</span>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">initParamsInfo</span>: textToSpeech.<span class="hljs-property">CreateEngineParams</span> = {</li><li>  <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,</li><li>  <span class="hljs-attr">person</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">online</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-attr">extraParams</span>: extraParam</li><li>};</li><li>
</li><li><span class="hljs-comment">// 调用createEngine方法</span></li><li>textToSpeech.<span class="hljs-title function_">createEngine</span>(initParamsInfo, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, textToSpeechEngine: textToSpeech.TextToSpeechEngine</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (!err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in creating engine'</span>);</li><li>    <span class="hljs-comment">// 接收创建引擎的实例</span></li><li>    ttsEngine = textToSpeechEngine;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create engine. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>  }</li><li>});</li></ol></pre></div></div>       <p></p></li>      <li><span>得到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section185526396124" target="_blank">TextToSpeechEngine</a>实例对象后，实例化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section7843122735210" target="_blank">SpeakParams</a>对象、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section115395631614" target="_blank">SpeakListener</a>对象，并传入待合成及播报的文本originalText，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section140216144119" target="_blank">speak</a>接口进行播报。</span>       <p></p>       <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置speak的回调信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">speakListener</span>: textToSpeech.<span class="hljs-property">SpeakListener</span> = {</li><li>  <span class="hljs-comment">// 开始播报回调</span></li><li>  <span class="hljs-title function_">onStart</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.StartResponse</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onStart, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>  },</li><li>  <span class="hljs-comment">// 合成完成及播报完成回调</span></li><li>  <span class="hljs-title function_">onComplete</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.CompleteResponse</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onComplete, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>  },</li><li>  <span class="hljs-comment">// 停止播报回调</span></li><li>  <span class="hljs-title function_">onStop</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.StopResponse</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onStop, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>  },</li><li>  <span class="hljs-comment">// 返回音频流</span></li><li>  <span class="hljs-title function_">onData</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, audio: <span class="hljs-built_in">ArrayBuffer</span>, response: textToSpeech.SynthesisResponse</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onData, requestId: <span class="hljs-subst">${requestId}</span> sequence: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span> audio: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(audio)}</span>`</span>);</li><li>  },</li><li>  <span class="hljs-comment">// 错误回调</span></li><li>  <span class="hljs-title function_">onError</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, errorCode: <span class="hljs-built_in">number</span>, errorMessage: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onError, requestId: <span class="hljs-subst">${requestId}</span> errorCode: <span class="hljs-subst">${errorCode}</span> errorMessage: <span class="hljs-subst">${errorMessage}</span>`</span>);</li><li>  }</li><li>};</li><li><span class="hljs-comment">// 设置回调</span></li><li>ttsEngine.<span class="hljs-title function_">setListener</span>(speakListener);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">originalText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello HarmonyOS'</span>;</li><li><span class="hljs-comment">// 设置播报相关参数</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">extraParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {<span class="hljs-string">"queueMode"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"speed"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"volume"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"pitch"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"languageContext"</span>: <span class="hljs-string">'zh-CN'</span>,  </li><li><span class="hljs-string">"audioType"</span>: <span class="hljs-string">"pcm"</span>, <span class="hljs-string">"soundChannel"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"playType"</span>: <span class="hljs-number">1</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">speakParams</span>: textToSpeech.<span class="hljs-property">SpeakParams</span> = {</li><li>  <span class="hljs-attr">requestId</span>: <span class="hljs-string">'123456'</span>, <span class="hljs-comment">// requestId在同一实例内仅能用一次，请勿重复设置</span></li><li>  <span class="hljs-attr">extraParams</span>: extraParam</li><li>};</li><li><span class="hljs-comment">// 调用播报方法</span></li><li><span class="hljs-comment">// 开发者可以通过修改speakParams主动</span><a href="/consumer/cn/doc/harmonyos-guides/texttospeech-guide#section137481719163910"><span class="hljs-comment">设置播报策略</span></a></li><li>ttsEngine.<span class="hljs-title function_">speak</span>(originalText, speakParams);</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）当需要停止合成及播报时，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section14433919171116" target="_blank">stop</a>接口。</span>       <p></p>       <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li>ttsEngine.<span class="hljs-title function_">stop</span>();</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）当需要查询文本转语音服务是否处于忙碌状态时，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section35361720111113" target="_blank">isBusy</a>接口。</span>       <p></p>       <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li>ttsEngine.<span class="hljs-title function_">isBusy</span>();</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）当需要查询支持的语种音色信息时，可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech#section813761871119" target="_blank">listVoices</a>接口。</span>       <p></p>       <div class="p">        listVoices接口提供了两种调用形式，当前以其中一种作为示例，其他方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/hms-ai-texttospeech" target="_blank">API参考</a>。        <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript " data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在组件中声明并初始化字符串voiceInfo</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">voiceInfo</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li><span class="hljs-comment">// 设置查询相关参数</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">voicesQuery</span>: textToSpeech.<span class="hljs-property">VoiceQuery</span> = {</li><li>  <span class="hljs-attr">requestId</span>: <span class="hljs-string">'12345678'</span>, <span class="hljs-comment">// requestId在同一实例内仅能用一次，请勿重复设置</span></li><li>  <span class="hljs-attr">online</span>: <span class="hljs-number">1</span></li><li>};</li><li><span class="hljs-comment">// 调用listVoices方法，以callback返回</span></li><li>ttsEngine.<span class="hljs-title function_">listVoices</span>(voicesQuery, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, voiceInfo: textToSpeech.VoiceInfo[]</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (!err) {</li><li>    <span class="hljs-comment">// 接收目前支持的语种音色等信息</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">voiceInfo</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(voiceInfo);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in listing voices, voiceInfo is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.voiceInfo}</span>`</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to list voices. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>});</li></ol></pre></div></div>       </div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section137481719163910">设置播报策略<i class="anchor-icon anchor-icon-link" anchorid="section137481719163910" tips="复制节点链接"></i></h2>          <p>由于不同场景下，模型自动判断所选择的播报策略可能与实际需求不同，此章节提供对于播报策略进行主动设置的方法。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>以下取值说明均为有效取值，若所使用的数值在有效取值之外则播报结果可能与预期不符，并产生错误的播报结果。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section02091207435" class="firsth2">设置单词播报方式<i class="anchor-icon anchor-icon-link" anchorid="section02091207435" tips="复制节点链接"></i></h3>          <p>文本格式：[hN] (N=0/1/2)</p>     <p>N取值说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.3.1.1" valign="top" width="49.96%">          <p>取值</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.3.1.2" valign="top" width="50.03999999999999%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.96%">          <p>0</p></td>         <td class="cellrowborder" valign="top" width="50.03999999999999%">          <p>智能判断单词播放方式。默认值为0。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.96%">          <p>1</p></td>         <td class="cellrowborder" valign="top" width="50.03999999999999%">          <p>逐个字母进行播报。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.96%">          <p>2</p></td>         <td class="cellrowborder" valign="top" width="50.03999999999999%">          <p>以单词方式进行播报。</p></td>        </tr>             </tbody></table></div>     </div>     <p>文本示例：</p>     <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"hello[h1] world"</span></li></ol></pre></div></div>     <p>hello使用单词发音，world及后续单词将会逐个字母进行发音。</p>    </div>    <div class="tiledSection">     <h3 id="section458571015431">设置数字播报策略<i class="anchor-icon anchor-icon-link" anchorid="section458571015431" tips="复制节点链接"></i></h3>          <p>格式：[nN] (N=0/1/2)</p>     <p>N取值说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.1" valign="top" width="49.94%">          <p>取值</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.2" valign="top" width="50.06%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p>0</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>智能判断数字处理策略。默认值为0。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p>1</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>作为号码逐个数字播报。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p>2</p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>作为数值播报。超过18位数字不支持，自动按逐个数字进行播报。</p></td>        </tr>             </tbody></table></div>     </div>     <p>文本示例：</p>     <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>"<span class="hljs-selector-attr">[n2]</span><span class="hljs-number">123</span><span class="hljs-selector-attr">[n1]</span><span class="hljs-number">456</span><span class="hljs-selector-attr">[n0]</span>"</li></ol></pre></div></div>     <p>其中，123将会按照数值播报，456则会按照号码播报，而后的文本中的数字，均会自动判断。</p>    </div>    <div class="tiledSection">     <h3 id="section6116920155613">插入静音停顿<i class="anchor-icon anchor-icon-link" anchorid="section6116920155613" tips="复制节点链接"></i></h3>          <p>格式：[pN]</p>     <p>描述：N为无符号整数，单位为ms。</p>     <p>文本示例：</p>     <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"你好[p500]小艺"</span></li></ol></pre></div></div>     <p>该句播报时，将会在“你好”后插入500ms的静音停顿。</p>    </div>    <div class="tiledSection">     <h3 id="section11387449152019">指定汉字发音<i class="anchor-icon anchor-icon-link" anchorid="section11387449152019" tips="复制节点链接"></i></h3>          <p>汉字的声调，通过在拼音后接一位数字1~5分别表示阴平、阳平、上声、去声和轻声5个声调。</p>     <p>格式：[=MN]</p>     <p>描述：M表示拼音，N表示声调。</p>     <p>N取值说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.3.1.1" valign="top" width="50%">          <p>取值</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.3.1.2" valign="top" width="50%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>1</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>阴平</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>2</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>阳平</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>3</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>上声</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>4</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>去声</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>5</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>轻声</p></td>        </tr>             </tbody></table></div>     </div>     <p>文本示例：</p>     <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"着[=zhuo2]手"</span></li></ol></pre></div></div>     <p>“着”字将读作“zhuó”。</p>    </div>    <div class="tiledSection">     <h2 id="section56481271497">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section56481271497" tips="复制节点链接"></i></h2>          <p>点击按钮，播报一段文本。</p>    </div>    <div class="tiledSection">     <h3 id="section13823102512012" class="firsth2">Index.ets<i class="anchor-icon anchor-icon-link" anchorid="section13823102512012" tips="复制节点链接"></i></h3>          <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { textToSpeech } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreSpeechKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromptAction</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TreeMap</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">PcmPlayer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./PcmPlayer'</span>;</li><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Context</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'TtsDemo'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">ttsEngine</span>: textToSpeech.<span class="hljs-property">TextToSpeechEngine</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">bufferLength</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">engineCreated</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li><span class="hljs-comment">// 定义一个函数来拼接ArrayBuffer</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">concatenateArrayBuffers</span>(<span class="hljs-params">buffers: <span class="hljs-built_in">ArrayBuffer</span>[]</span>): <span class="hljs-title class_">ArrayBuffer</span> {</li><li>  <span class="hljs-keyword">const</span> totalLength = buffers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, buffer</span>) =&gt;</span> sum + buffer.<span class="hljs-property">byteLength</span>, <span class="hljs-number">0</span>);</li><li>  <span class="hljs-keyword">const</span> concatenatedBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(totalLength);</li><li>  <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> buffer <span class="hljs-keyword">of</span> buffers) {</li><li>    <span class="hljs-keyword">const</span> uint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(concatenatedBuffer, offset, uint8Array.<span class="hljs-property">length</span>).<span class="hljs-title function_">set</span>(uint8Array);</li><li>    offset += uint8Array.<span class="hljs-property">length</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> concatenatedBuffer;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">createCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">originalText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"\n\t\t古人学问无遗力，少壮工夫老始成；\n\t\t"</span> + <span class="hljs-string">"纸上得来终觉浅，绝知此事要躬行。\n\t\t"</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getPromptAction</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">pcmData</span>: <span class="hljs-title class_">TreeMap</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">Uint8Array</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">pcmPlayer</span>: <span class="hljs-title class_">PcmPlayer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PcmPlayer</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Scroll</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">TextArea</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Please enter tts original text'</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.originalText}</span>`</span> })</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">focusable</span>(<span class="hljs-literal">false</span>)</li><li>            .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">color</span>: <span class="hljs-number">0x317AE7</span>, <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">style</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span> })</li><li>            .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalText</span> = value;</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"original text: "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">originalText</span>);</li><li>            })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"CreateEngine"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AE7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            engineCreated = <span class="hljs-literal">true</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">createCount</span>++;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`createByCallback：createCount:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.createCount}</span>`</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createByCallback</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>              <span class="hljs-attr">message</span>: <span class="hljs-string">'CreateEngine success!'</span>,</li><li>              <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>            });</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"speak"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AE7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (engineCreated) {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">speak</span>();</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'start speaking'</span>,</li><li>                  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>                });</li><li>              } <span class="hljs-keyword">catch</span> (err)  {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'start speaking failed'</span>,</li><li>                    <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>                  });</li><li>                }</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'The engine has not been created'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"speakOnData"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AE7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (engineCreated) {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">speakOnData</span>();</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'start speakOnData'</span>,</li><li>                  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>                });</li><li>              } <span class="hljs-keyword">catch</span> (err) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'start speakOnData failed'</span>,</li><li>                  <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>                });</li><li>              }</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'The engine has not been created'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"stop"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AE7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">isBusy</span>: <span class="hljs-built_in">boolean</span> = ttsEngine.<span class="hljs-title function_">isBusy</span>();</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">isPlaying</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">isPlaying</span>();</li><li>              <span class="hljs-keyword">if</span> (isBusy) {</li><li>                ttsEngine.<span class="hljs-title function_">stop</span>();</li><li>              }</li><li>              <span class="hljs-keyword">if</span> (isPlaying) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">stop</span>()</li><li>              }</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'stop!'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            } <span class="hljs-keyword">catch</span> (err) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'stop failed'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"isBusy"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AE7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">isBusy</span>: <span class="hljs-built_in">boolean</span> = ttsEngine.<span class="hljs-title function_">isBusy</span>();</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">isPlaying</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">isPlaying</span>();</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'isBusy :'</span> + isBusy);</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'isPlaying :'</span> + isPlaying);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'speak isBusy :'</span> + isBusy + <span class="hljs-string">'\nspeakOnData isBusy :'</span> + isPlaying,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            } <span class="hljs-keyword">catch</span> (err) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'isBusy failed'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"shutdown"</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#0x317AA7"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"80%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">release</span>()</li><li>              ttsEngine.<span class="hljs-title function_">shutdown</span>();</li><li>              engineCreated = <span class="hljs-literal">false</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'shutdown success!'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            } <span class="hljs-keyword">catch</span> (err) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">promptAction</span>.<span class="hljs-title function_">showToast</span>({</li><li>                <span class="hljs-attr">message</span>: <span class="hljs-string">'shutdown failed'</span>,</li><li>                <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>              });</li><li>            }</li><li>          })</li><li>
</li><li>        }</li><li>        .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建引擎，通过callback形式返回</span></li><li>  <span class="hljs-comment">// 当引擎不存在、引擎资源不存在、初始化超时，返回错误码1002300005，引擎创建失败</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">createByCallback</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 设置创建引擎参数</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">extraParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = { <span class="hljs-string">"style"</span>: <span class="hljs-string">'interaction-broadcast'</span>, <span class="hljs-string">"locate"</span>: <span class="hljs-string">'CN'</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">'EngineName'</span> }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">initParamsInfo</span>: textToSpeech.<span class="hljs-property">CreateEngineParams</span> = {</li><li>      <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,</li><li>      <span class="hljs-attr">person</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">online</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-attr">extraParams</span>: extraParam</li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用createEngine方法</span></li><li>      textToSpeech.<span class="hljs-title function_">createEngine</span>(initParamsInfo, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, textToSpeechEngine: textToSpeech.TextToSpeechEngine</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (!err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'createEngine is success'</span>);</li><li>          <span class="hljs-comment">// 接收创建引擎的实例</span></li><li>          ttsEngine = textToSpeechEngine;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>.`</span>)</li><li>        }</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> message = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createEngine failed, error code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>.`</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 调用speak播报方法</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">speak</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">speakListener</span>: textToSpeech.<span class="hljs-property">SpeakListener</span> = {</li><li>      <span class="hljs-comment">// 开始播报回调</span></li><li>      <span class="hljs-title function_">onStart</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.StartResponse</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onStart, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 完成播报回调</span></li><li>      <span class="hljs-title function_">onComplete</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.CompleteResponse</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onComplete, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 停止播报完成回调，调用stop方法并完成时会触发此回调</span></li><li>      <span class="hljs-title function_">onStop</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, response: textToSpeech.StopResponse</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onStop, requestId: <span class="hljs-subst">${requestId}</span> response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 返回音频流</span></li><li>      <span class="hljs-title function_">onData</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, audio: <span class="hljs-built_in">ArrayBuffer</span>, response: textToSpeech.SynthesisResponse</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onData, requestId: <span class="hljs-subst">${requestId}</span> sequence: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span> audio: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(audio)}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-comment">// 错误回调，播报过程发生错误时触发此回调</span></li><li>      <span class="hljs-title function_">onError</span>(<span class="hljs-params">requestId: <span class="hljs-built_in">string</span>, errorCode: <span class="hljs-built_in">number</span>, errorMessage: <span class="hljs-built_in">string</span></span>) {</li><li>        <span class="hljs-keyword">if</span> (errorCode === <span class="hljs-number">1002300007</span>) {</li><li>          engineCreated = <span class="hljs-literal">false</span></li><li>        }</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onError, requestId: <span class="hljs-subst">${requestId}</span> errorCode: <span class="hljs-subst">${errorCode}</span> errorMessage: <span class="hljs-subst">${errorMessage}</span>`</span>);</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 设置回调</span></li><li>    ttsEngine.<span class="hljs-title function_">setListener</span>(speakListener);</li><li>    <span class="hljs-comment">// 设置播报相关参数</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">extraParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {<span class="hljs-string">"queueMode"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"speed"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"volume"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"pitch"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"languageContext"</span>: <span class="hljs-string">'zh-CN'</span>, <span class="hljs-string">"audioType"</span>: <span class="hljs-string">"pcm"</span>, <span class="hljs-string">"soundChannel"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"playType"</span>:<span class="hljs-number">1</span>}</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">speakParams</span>: textToSpeech.<span class="hljs-property">SpeakParams</span> = {</li><li>      <span class="hljs-attr">requestId</span>: <span class="hljs-string">'123456'</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-comment">// requestId在同一实例内仅能用一次，请勿重复设置</span></li><li>      <span class="hljs-attr">extraParams</span>: extraParam</li><li>    };</li><li>    <span class="hljs-comment">// 调用speak播报方法</span></li><li>    ttsEngine.<span class="hljs-title function_">speak</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">originalText</span>, speakParams);</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">private</span> onStart = <span class="hljs-keyword">async</span> (<span class="hljs-attr">utteranceId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">response</span>: textToSpeech.<span class="hljs-property">StartResponse</span>) =&gt; {</li><li>    bufferLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 初始化音频数据映射</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onStart | utteranceId: <span class="hljs-subst">${ utteranceId }</span>, response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onData = <span class="hljs-keyword">async</span> (<span class="hljs-attr">utteranceId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">audio</span>: <span class="hljs-title class_">ArrayBuffer</span>, <span class="hljs-attr">response</span>: textToSpeech.<span class="hljs-property">SynthesisResponse</span>) =&gt; {</li><li>    <span class="hljs-comment">// 将ArrayBuffer转换为Uint8Array</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uint8Array</span>: <span class="hljs-title class_">Uint8Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(audio);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmData</span>.<span class="hljs-title function_">set</span>(response.<span class="hljs-property">sequence</span>, uint8Array)</li><li>    bufferLength += <span class="hljs-number">1</span></li><li>    <span class="hljs-keyword">let</span> str = <span class="hljs-string">""</span></li><li>    <span class="hljs-comment">// 或者使用循环打印每个元素</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8Array.<span class="hljs-property">length</span>; i++) {</li><li>      str = str + (<span class="hljs-string">","</span>+uint8Array[i]);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onData | utteranceId: <span class="hljs-subst">${utteranceId}</span>, sequence: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.sequence)}</span>, length: <span class="hljs-subst">${uint8Array.length}</span>, audio: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(str)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onComplete = <span class="hljs-keyword">async</span> (<span class="hljs-attr">utteranceId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">response</span>: textToSpeech.<span class="hljs-property">CompleteResponse</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">buffers</span>: <span class="hljs-title class_">ArrayBuffer</span>[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>
</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`pcmData len: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.pcmData.length}</span>`</span>)</li><li>    <span class="hljs-comment">// 遍历Map，将ArrayBuffer添加到数组中</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmData</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">Uint8Array</span>, key: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>      buffers.<span class="hljs-title function_">push</span>(value.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>))</li><li>    })</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`buffers len: <span class="hljs-subst">${buffers.length}</span>`</span>)</li><li>
</li><li>    <span class="hljs-comment">// 按照顺序拼接所有的ArrayBuffer</span></li><li>    <span class="hljs-keyword">let</span> audioData = <span class="hljs-title function_">concatenateArrayBuffers</span>(buffers);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`audioData len: <span class="hljs-subst">${audioData.byteLength}</span>`</span>)</li><li>
</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span></li><li>    <span class="hljs-keyword">let</span> path = context.<span class="hljs-property">filesDir</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${path}</span>/my.pcm`</span></li><li>    <span class="hljs-keyword">let</span> os = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">createStream</span>(filePath, <span class="hljs-string">"w+"</span>)</li><li>    <span class="hljs-keyword">await</span> os.<span class="hljs-title function_">write</span>(audioData)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-property">file</span> = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>    <span class="hljs-comment">// 播放音频流</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`playAudio start`</span>)</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">prepare</span>(audio.<span class="hljs-property">AudioSamplingRate</span>.<span class="hljs-property">SAMPLE_RATE_16000</span>)</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pcmPlayer</span>.<span class="hljs-title function_">play</span>(audioData)</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`playAudio end`</span>)</li><li>
</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onComplete | utteranceId: <span class="hljs-subst">${utteranceId}</span>, response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 调用speakOnData播报方法</span></li><li>  <span class="hljs-comment">// 未初始化引擎时调用speak方法，返回错误码1002300007，合成及播报失败</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">speakOnData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 设置播报相关参数</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">extraParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {<span class="hljs-string">"queueMode"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"speed"</span>: <span class="hljs-number">1.2</span>, <span class="hljs-string">"volume"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"pitch"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"languageContext"</span>: <span class="hljs-string">'zh-CN'</span>, <span class="hljs-string">"audioType"</span>: <span class="hljs-string">"pcm"</span>, <span class="hljs-string">"soundChannel"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"playType"</span>:<span class="hljs-number">0</span>}</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">speakParams</span>: textToSpeech.<span class="hljs-property">SpeakParams</span> = {</li><li>      <span class="hljs-attr">requestId</span>: <span class="hljs-string">'1234567'</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),</li><li>      <span class="hljs-attr">extraParams</span>: extraParam</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span>{</li><li>      <span class="hljs-comment">// 创建回调对象</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">speakListener</span>: textToSpeech.<span class="hljs-property">SpeakListener</span> = {</li><li>        <span class="hljs-comment">// 开始识别成功回调</span></li><li>        <span class="hljs-attr">onStart</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onStart</span>,</li><li>        <span class="hljs-comment">// 识别完成回调</span></li><li>        <span class="hljs-attr">onComplete</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onComplete</span>,</li><li>        <span class="hljs-comment">// 停止播报回调</span></li><li>        <span class="hljs-title function_">onStop</span>(<span class="hljs-params">utteranceId: <span class="hljs-built_in">string</span>, response: textToSpeech.StopResponse</span>) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'speakListener onStop: '</span> + <span class="hljs-string">' utteranceId: '</span> + utteranceId + <span class="hljs-string">' response: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response));</li><li>        },</li><li>        <span class="hljs-comment">// 返回音频流</span></li><li>        <span class="hljs-attr">onData</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onData</span>,</li><li>        <span class="hljs-comment">// 错误回调</span></li><li>        <span class="hljs-title function_">onError</span>(<span class="hljs-params">utteranceId: <span class="hljs-built_in">string</span>, errorCode: <span class="hljs-built_in">number</span>, errorMessage: <span class="hljs-built_in">string</span></span>) {</li><li>          <span class="hljs-keyword">if</span> (errorCode === <span class="hljs-number">1002300007</span>) {</li><li>            engineCreated = <span class="hljs-literal">false</span></li><li>          }</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'speakListener onError: '</span> + <span class="hljs-string">' utteranceId: '</span> + utteranceId + <span class="hljs-string">' errorCode: '</span> + errorCode + <span class="hljs-string">' errorMessage: '</span> + errorMessage);</li><li>        }</li><li>      };</li><li>      <span class="hljs-comment">// 设置回调</span></li><li>      ttsEngine.<span class="hljs-title function_">setListener</span>(speakListener);</li><li>      <span class="hljs-keyword">try</span>{</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`speakListener before speak`</span>)</li><li>        <span class="hljs-comment">// 调用speak播报方法</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1</span>; i++) {</li><li>          ttsEngine?.<span class="hljs-title function_">speak</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">originalText</span>, speakParams);</li><li>        }</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`speakListener after speak`</span>)</li><li>      }<span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> message = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>        <span class="hljs-keyword">let</span> code = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`speakListener speak failed, error code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>.`</span>)</li><li>      }</li><li>    }<span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> message = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`speakListener setListener failed, error code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>.`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section4463361903">PcmPlayer.ets<i class="anchor-icon anchor-icon-link" anchorid="section4463361903" tips="复制节点链接"></i></h3>          <div _ngcontent-cgw-c106="" class="highlight-div"><div _ngcontent-cgw-c106="" class="highlight-div-header"><div _ngcontent-cgw-c106="" class="highlight-div-header-left"><div _ngcontent-cgw-c106="" class="handle-button expand-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgw-c106="" class="highlight-div-header-right"><div _ngcontent-cgw-c106="" class="handle-button ai-button"></div><div _ngcontent-cgw-c106="" class="handle-button line-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgw-c106="" class="handle-button theme-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgw-c106="" class="handle-button copy-button"><div _ngcontent-cgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'PCM_audio'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Options</span> {</li><li>  offset?: <span class="hljs-built_in">number</span>;</li><li>  length?: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PcmPlayer</span> {</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> writeDataCallback = <span class="hljs-function">(<span class="hljs-params">buffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {</li><li>      <span class="hljs-attr">offset</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bufferSize</span>,</li><li>      <span class="hljs-attr">length</span>: buffer.<span class="hljs-property">byteLength</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      fs.<span class="hljs-title function_">readSync</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">file</span>?.<span class="hljs-property">fd</span>, buffer, options);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">bufferSize</span> += buffer.<span class="hljs-property">byteLength</span>;</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">audioDataSize</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">bufferSize</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>?.<span class="hljs-title function_">off</span>(<span class="hljs-string">'writeData'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stop</span>()</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'reading file success'</span>);</li><li>      <span class="hljs-comment">// 系统会判定buffer有效，正常播放。</span></li><li>      <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">VALID</span>;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Reading file failed, error code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>.`</span>)</li><li>      <span class="hljs-comment">// 系统会判定buffer无效，不播放。</span></li><li>      <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">INVALID</span>;</li><li>    }</li><li>  };</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 缓存大小</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">bufferSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 音频总大小</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">audioDataSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 播放器</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">renderModel</span>: audio.<span class="hljs-property">AudioRenderer</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 播放状态</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">audioStreamInfo</span>: audio.<span class="hljs-property">AudioStreamInfo</span> = {</li><li>    <span class="hljs-attr">samplingRate</span>: audio.<span class="hljs-property">AudioSamplingRate</span>.<span class="hljs-property">SAMPLE_RATE_16000</span>, <span class="hljs-comment">// 采样率</span></li><li>    <span class="hljs-attr">channels</span>: audio.<span class="hljs-property">AudioChannel</span>.<span class="hljs-property">CHANNEL_1</span>, <span class="hljs-comment">// 通道</span></li><li>    <span class="hljs-attr">sampleFormat</span>: audio.<span class="hljs-property">AudioSampleFormat</span>.<span class="hljs-property">SAMPLE_FORMAT_S16LE</span>, <span class="hljs-comment">// 采样格式</span></li><li>    <span class="hljs-attr">encodingType</span>: audio.<span class="hljs-property">AudioEncodingType</span>.<span class="hljs-property">ENCODING_TYPE_RAW</span> <span class="hljs-comment">// 编码格式</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">audioRendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>    <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_ACCESSIBILITY</span>, <span class="hljs-comment">// 音频流使用类型</span></li><li>    <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">audioRendererOptions</span>: audio.<span class="hljs-property">AudioRendererOptions</span> = {</li><li>    <span class="hljs-attr">streamInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioStreamInfo</span>,</li><li>    <span class="hljs-attr">rendererInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRendererInfo</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">prepare</span>(<span class="hljs-params">sampleRate: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRendererOptions</span>.<span class="hljs-property">streamInfo</span>.<span class="hljs-property">samplingRate</span> = sampleRate;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRendererOptions</span>.<span class="hljs-property">rendererInfo</span>.<span class="hljs-property">usage</span> = audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">release</span>();</li><li>    }</li><li>    <span class="hljs-keyword">let</span> renderModel = <span class="hljs-keyword">await</span> audio.<span class="hljs-title function_">createAudioRenderer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">audioRendererOptions</span>);</li><li>    <span class="hljs-keyword">if</span> (!renderModel) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`failed to create audio renderer`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"creating AudioRenderer success"</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> = renderModel;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bufferSize</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">getBufferSize</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">play</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioDataSize</span> = data.<span class="hljs-property">byteLength</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'writeData'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">writeDataCallback</span>);</li><li>      <span class="hljs-comment">// 启动渲染</span></li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">start</span>();</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"start AudioRenderer success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Renderer begin stop'</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 只有渲染器状态为running或paused的时候才可以停止</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span> !== audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RUNNING</span></li><li>      &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span> !== audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_PAUSED</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Renderer is not running or paused'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// 停止渲染</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Renderer stopped'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">release</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 渲染器状态不是released状态，才能release</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span> === audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RELEASED</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Renderer already released'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-title function_">release</span>(); <span class="hljs-comment">// 释放资源</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> = <span class="hljs-literal">null</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Renderer released'</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 判断当前渲染状态</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> running返回true，否则返回false</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">isPlaying</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"player.state:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span> == audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RUNNING</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取当前渲染状态</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> running返回true，否则返回false</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getRenderState</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"player.state:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderModel</span>.<span class="hljs-property">state</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_INVALID</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取音频渲染器的最小缓冲区大小</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getBufferSize</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bufferSize</span>;</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>