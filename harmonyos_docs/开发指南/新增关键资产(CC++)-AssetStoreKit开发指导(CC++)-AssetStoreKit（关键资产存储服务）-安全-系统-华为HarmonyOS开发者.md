<h1 _ngcontent-cxo-c119="" class="doc-title ng-star-inserted" title="新增关键资产(C/C++)"> 新增关键资产(C/C++) </h1>

<div _ngcontent-cxo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="接口介绍">接口介绍<i class="anchor-icon anchor-icon-link" anchorid="接口介绍" tips="复制节点链接"></i></h2>          <p>可通过API文档查看新增关键资产的接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-api-h#oh_asset_add" target="_blank">OH_Asset_Add</a>的详细介绍。</p>     <p>在新增关键资产时，关键资产属性的内容参数如下表所示：</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>下表中“ASSET_TAG_ALIAS”和名称包含“ASSET_TAG_DATA_LABEL”的关键资产属性，用于存储业务自定义信息，其内容不会被加密，请勿存放敏感个人数据。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.1" valign="top" width="25%">属性名称（Asset_Tag）</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.2" valign="top" width="25%">属性内容（Asset_Value）</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.3" valign="top" width="25%">是否必选</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_SECRET</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-1024字节。</td>         <td class="cellrowborder" valign="top" width="25%">必选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产明文。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_ALIAS</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-256字节。</td>         <td class="cellrowborder" valign="top" width="25%">必选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产别名，每条关键资产的唯一索引。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_ACCESSIBILITY</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint32_t，取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-type-h#asset_accessibility" target="_blank">Asset_Accessibility</a>。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">基于锁屏状态的访问控制，默认值为ASSET_ACCESSIBILITY_DEVICE_FIRST_UNLOCKED，即首次解锁后可访问。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_REQUIRE_PASSWORD_SET</td>         <td class="cellrowborder" valign="top" width="25%">类型为bool。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">是否仅在设置了锁屏密码的情况下，可访问关键资产。为true时，表示仅在用户设置了锁屏密码的情况下，关键资产才允许被访问；为false时，表示无论用户是否设置锁屏密码，关键资产均允许被访问。默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_AUTH_TYPE</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint32_t，取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-type-h#asset_authtype" target="_blank">Asset_AuthType</a>。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">访问关键资产所需的用户认证类型，默认值为ASSET_AUTH_TYPE_NONE，即访问关键资产前无需用户认证。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_SYNC_TYPE</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint32_t，取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-type-h#asset_synctype" target="_blank">Asset_SyncType</a>。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产支持的同步类型，默认值为ASSET_SYNC_TYPE_NEVER，即不允许同步该关键资产。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_IS_PERSISTENT</td>         <td class="cellrowborder" valign="top" width="25%">类型为bool。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>在应用卸载时是否需要保留关键资产。为true时表示应用卸载后，应用存储的关键资产将被保留；为false时表示应用卸载后，应用存储的关键资产将被删除。默认值为false。</p>          <p><strong>注意：</strong> 设置此属性时，需<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">申请权限</a>ohos.permission.STORE_PERSISTENT_DATA。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_CRITICAL_1</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且有完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_CRITICAL_2</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且有完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_CRITICAL_3</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且有完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_CRITICAL_4</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且有完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_1</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且无完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_2</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且无完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_3</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且无完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_4</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">          <p>关键资产附属信息，内容由业务自定义且无完整性保护。</p>          <p><strong>说明：</strong> API12前长度为1-512字节。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_LOCAL_1<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产附属的本地信息，内容由业务自定义且无完整性保护，该项信息不会进行同步。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_LOCAL_2<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产附属的本地信息，内容由业务自定义且无完整性保护，该项信息不会进行同步。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_LOCAL_3<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产附属的本地信息，内容由业务自定义且无完整性保护，该项信息不会进行同步。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_DATA_LABEL_NORMAL_LOCAL_4<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为1-2048字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产附属的本地信息，内容由业务自定义且无完整性保护，该项信息不会进行同步。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_CONFLICT_RESOLUTION</td>         <td class="cellrowborder" valign="top" width="25%">类型为uint32_t，取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-type-h#asset_conflictresolution" target="_blank">Asset_ConflictResolution</a>。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">新增关键资产时的冲突（如：别名相同）处理策略，默认值为ASSET_CONFLICT_THROW_ERROR，即抛出异常，由业务进行后续处理。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_REQUIRE_ATTR_ENCRYPTED<sup>14+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为bool。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">是否加密业务自定义附属信息。为true时表示业务自定义附属信息加密存储，为false时表示业务自定义附属信息不加密存储。默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_GROUP_ID<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint8[]，长度为7-127字节。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">待新增的关键资产所属群组，默认新增不属于任何群组的关键资产。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ASSET_TAG_WRAP_TYPE<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="25%">类型为uint32_t，取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-asset-type-h#asset_wraptype" target="_blank">Asset_WrapType</a>。</td>         <td class="cellrowborder" valign="top" width="25%">可选</td>         <td class="cellrowborder" valign="top" width="25%">关键资产支持的加密导入导出类型，默认值为ASSET_WRAP_TYPE_NEVER，即不允许加密导入导出关键资产。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="约束和限制">约束和限制<i class="anchor-icon anchor-icon-link" anchorid="约束和限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>基于别名的访问</p>       <p>关键资产以密文的形式存储在ASSET数据库中，以业务身份和别名作为索引。业务需保证每条关键资产的别名唯一。</p></li>      <li>       <p>业务自定义数据存储</p>       <ul>        <li>         <p>ASSET为业务预留了12个关键资产自定义属性，名称以"ASSET_TAG_DATA_LABEL"开头。对于超过12个自定义属性的情况，业务可以将多段数据按照一定的格式（如JSON）拼接到同一个ASSET属性中。</p></li>        <li>         <p>ASSET对部分属性会进行完整性保护，这部分属性名称以"ASSET_TAG_DATA_LABEL_CRITICAL"开头，且写入后不支持更新。</p></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="代码示例">代码示例<i class="anchor-icon anchor-icon-link" anchorid="代码示例" tips="复制节点链接"></i></h2>          <p>新增密码为demo_pwd、别名为demo_alias、附属信息为demo_label的关键资产。用户首次解锁设备后，该关键资产可被访问。</p>     <p>在指定群组中新增一条关键资产的示例代码详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/asset-native-group-access-control#新增群组关键资产">新增群组关键资产</a>。</p>     <ol>      <li>       <p>在CMake脚本中链接相关动态库。</p>       <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libasset_ndk.z.so)</li></ol></pre></div></div></li>      <li>       <p>参考如下示例代码，进行业务功能开发。</p>       <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"asset/asset_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">AddAsset</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *SECRET = <span class="hljs-string">"demo_pwd"</span>;</li><li>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ALIAS = <span class="hljs-string">"demo_alias"</span>;</li><li>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span> *LABEL = <span class="hljs-string">"demo_label"</span>;</li><li>
</li><li>    Asset_Blob secret = {(<span class="hljs-type">uint32_t</span>)(<span class="hljs-built_in">strlen</span>(SECRET)), (<span class="hljs-type">uint8_t</span> *)SECRET};</li><li>    Asset_Blob alias = {(<span class="hljs-type">uint32_t</span>)(<span class="hljs-built_in">strlen</span>(ALIAS)), (<span class="hljs-type">uint8_t</span> *)ALIAS};</li><li>    Asset_Blob label = {(<span class="hljs-type">uint32_t</span>)(<span class="hljs-built_in">strlen</span>(LABEL)), (<span class="hljs-type">uint8_t</span> *)LABEL};</li><li>    Asset_Attr attr[] = {</li><li>        {.tag = ASSET_TAG_ACCESSIBILITY, .value.u32 = ASSET_ACCESSIBILITY_DEVICE_FIRST_UNLOCKED},</li><li>        {.tag = ASSET_TAG_SECRET, .value.blob = secret},</li><li>        {.tag = ASSET_TAG_ALIAS, .value.blob = alias},</li><li>        {.tag = ASSET_TAG_DATA_LABEL_NORMAL_1, .value.blob = label},</li><li>    };</li><li>
</li><li>    <span class="hljs-type">int32_t</span> addResult = OH_Asset_Add(attr, <span class="hljs-keyword">sizeof</span>(attr) / <span class="hljs-keyword">sizeof</span>(attr[<span class="hljs-number">0</span>]));</li><li>    napi_value ret;</li><li>    napi_create_int32(env, addResult, &amp;ret);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>