<h1 _ngcontent-iut-c119="" class="doc-title ng-star-inserted" title="方舟字节码函数命名规则"> 方舟字节码函数命名规则 </h1>

<div _ngcontent-iut-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>本文介绍字节码文件中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-bytecode-file-format#method">Method</a>的name_off字段指向的字符串的命名规则，该命名规则从方舟字节码文件版本12.0.4.0开始生效。</p> </div>  <div class="tiledSection"><h2 id="入口函数">入口函数<i class="anchor-icon anchor-icon-link" anchorid="入口函数" tips="复制节点链接"></i></h2><p>模块加载时被执行的函数，名称固定为func_main_0。</p> </div>  <div class="tiledSection"><h2 id="非入口函数">非入口函数<i class="anchor-icon anchor-icon-link" anchorid="非入口函数" tips="复制节点链接"></i></h2><p>其他函数在字节码文件中的名称结构如下：</p> <div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>#前缀#原函数名</li></ol></pre></div></div> <p>下面的章节将会详细介绍前缀和原函数名。</p> </div>  <div class="tiledSection"><h3 id="前缀" class="firsth2">前缀<i class="anchor-icon anchor-icon-link" anchorid="前缀" tips="复制节点链接"></i></h3><p>前缀包含函数定义时所在的作用域信息，具体包括以下几个部分：</p> <ul><li>作用域标签</li><li>作用域名称</li><li>重名序号</li></ul> <p>前缀的结构为：</p> <div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>&lt;作用域标签<span class="hljs-number">1</span>&gt;&lt;作用域名称<span class="hljs-number">1</span>&gt;[&lt;重名序号&gt;]&lt;作用域标签<span class="hljs-number">2</span>&gt;&lt;作用域名称<span class="hljs-number">2</span>&gt;&lt;[重名序号]&gt;...&lt;作用域标签n&gt;&lt;作用域名称n&gt;[&lt;重名序号&gt;]&lt;作用域标签n+<span class="hljs-number">1</span>&gt;</li></ol></pre></div></div> <p>其中&lt;&gt;仅为便于阅读的分割标识，并不包含在实际的前缀中，[]表示可以为空。仅当出现重名作用域时才需要[&lt;重名序号&gt;]，即[&lt;重名序号&gt;]可以为空。最后一个作用域标签是本函数所对应的标签。</p> <p><strong>作用域标签</strong></p> <p>作用域标签表示作用域的类型。作用域和对应的作用域标签如下表所示，其他的作用域不会被记录进函数名中：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.9.1.4.1.1" valign="top" width="33.33333333333333%">作用域</th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.4.1.2" valign="top" width="33.33333333333333%">作用域标签</th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">class</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">~</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">class关键字定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">实例函数</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">&gt;</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">类的实例成员函数定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">静态函数</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">&lt;</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">类的静态成员函数定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">构造函数</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">=</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">类的构造函数定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">普通函数</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">*</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">除了以上类型的其它所有函数定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">namespace/module</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">&amp;</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">namespace或module关键字定义的作用域。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">enum</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">%</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">enum关键字定义的作用域。</td> </tr>  </tbody></table></div> </div> <p><strong>作用域名称</strong></p> <p>源代码中定义作用域时所使用的名称。匿名则为空字符串。为了降低字节码体积，方舟编译器会对较长的作用域名称进行优化，此时作用域名称以@十六进制数字的形式体现。这个数字代表作用域名称的字符串在一个字符串数组中的索引：在字节码文件中源代码对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-bytecode-file-format#class">Class</a>中有一个名为scopeNames的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-bytecode-file-format#field">field</a>, 这个field的值是指向一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-bytecode-file-format#literalarray">LiteralArray</a>的偏移，这个LiteralArray存储的是一个字符串数组。十六进制数字就是代表作用域名称在这个数组中的索引。原函数名不会转换为索引。</p> <p>例子：</p> <div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// test1.ts</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">longFuncName</span>(<span class="hljs-params"></span>) {                  <span class="hljs-comment">// longFuncName的函数名为"#*#longFuncName"，其中"longFuncName"是原函数名，不会转换为索引。</span></li><li>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"></span>) { }                       <span class="hljs-comment">// A的函数名"#*@0*#A"，其中"@0"表示在其对应LiteralArray中，索引为0的字符串，此时这个字符串是"longFuncName"。即这个函数原本的名称为"#*longFuncName*#A"</span></li><li>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"></span>) { }                       <span class="hljs-comment">// B的函数名"#*@0*#B"</span></li><li>}</li></ol></pre></div></div> <p><strong>重名序号</strong></p> <p>如果源码中相同作用域下出现了同名的实体，同名的名称后会加上重名序号，重名序号以^十六进制数字的形式表示。出现重名时，第一个不编号（即重名序号为空），从第二个开始编号，编号从1开始。</p> <p>例子：</p> <div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">namespace</span> A {</li><li>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"></span>) { }                      <span class="hljs-comment">// bar的函数名为"#&amp;A*#bar"</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">namespace</span> A {</li><li>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) { }                      <span class="hljs-comment">// foo的函数名为"#&amp;A^1*#foo"，其中"^1" 为重名序号</span></li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="原函数名">原函数名<i class="anchor-icon anchor-icon-link" anchorid="原函数名" tips="复制节点链接"></i></h3><p>原函数名代表函数在源代码中的名字，匿名函数的名称为空字符串。同样的，如果源码中相同作用域下出现了同名的函数，重名的名称后面会加上重名序号（包括匿名函数）。</p> <div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {};                           <span class="hljs-comment">// 原函数名为"foo"</span></li><li><span class="hljs-function">() =&gt;</span> { };                                   <span class="hljs-comment">// 原函数名为""</span></li><li><span class="hljs-function">() =&gt;</span> { };                                   <span class="hljs-comment">// 原函数名为"^1"</span></li></ol></pre></div></div> <p><strong>特殊情况</strong></p> <ol><li>如果匿名函数被赋值给一个变量，该变量名即为函数名。例如：<div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">a</span> = (<span class="hljs-params"></span>) =&gt; {}                            <span class="hljs-comment">// 原函数名为"a"</span></li></ol></pre></div></div>  </li><li>如果匿名函数在对象字面量中定义并且被赋值给了一个字面量属性：</li></ol> <ul><li>如果属性名中不包含\和.，则其原函数名即为该属性名。<div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// test2.ts</span></li><li><span class="hljs-keyword">let</span> B = {</li><li>    b : <span class="hljs-function">() =&gt;</span> {}                            <span class="hljs-comment">// 原函数名为"b"</span></li><li>}</li></ol></pre></div></div>  </li><li>如果属性名包含\，.，为防止二义性，其原函数名会按照匿名函数命名。<div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// test3.ts</span></li><li><span class="hljs-keyword">let</span> a = {</li><li>    <span class="hljs-string">"a.b#c^2"</span>: <span class="hljs-function">() =&gt;</span> {},                     <span class="hljs-comment">// 原函数名为""</span></li><li>    <span class="hljs-string">"x\\y#"</span>: <span class="hljs-function">() =&gt;</span> {}                       <span class="hljs-comment">// 原函数名为"^1"</span></li><li>}</li></ol></pre></div></div>  </li></ul> <p><strong>开发者应尽量避免使用除字母、数字、下划线以外的字符命名函数，以免出现二义性。</strong></p> </div>  <div class="tiledSection"><h2 id="示例">示例<i class="anchor-icon anchor-icon-link" anchorid="示例" tips="复制节点链接"></i></h2><div _ngcontent-iut-c106="" class="highlight-div"><div _ngcontent-iut-c106="" class="highlight-div-header"><div _ngcontent-iut-c106="" class="highlight-div-header-left"><div _ngcontent-iut-c106="" class="handle-button expand-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iut-c106="" class="highlight-div-header-right"><div _ngcontent-iut-c106="" class="handle-button ai-button"></div><div _ngcontent-iut-c106="" class="handle-button line-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iut-c106="" class="handle-button theme-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iut-c106="" class="handle-button copy-button"><div _ngcontent-iut-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iut-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">namespace</span> A {                               <span class="hljs-comment">// namespace在字节码中的函数名为"#&amp;#A"</span></li><li>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {                               <span class="hljs-comment">// 构造函数在字节码中的函数名为"#&amp;A~B=#B"</span></li><li>        <span class="hljs-title function_">m</span>(<span class="hljs-params"></span>) {                               <span class="hljs-comment">// 函数m在字节码中的函数名为"#&amp;A~B&gt;#m"</span></li><li>            <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {}                 <span class="hljs-comment">// 匿名函数在字节码中的函数名为"#&amp;A~B&gt;m*#"</span></li><li>        }</li><li>        <span class="hljs-keyword">static</span> <span class="hljs-title function_">s</span>(<span class="hljs-params"></span>) {}                       <span class="hljs-comment">// 静态函数s在字节码中的函数名为"#&amp;A~B&lt;#s"</span></li><li>    }</li><li>    <span class="hljs-keyword">enum</span> E {                                <span class="hljs-comment">// enum在字节码中的函数名为"#&amp;A%#E"</span></li><li>
</li><li>    }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>