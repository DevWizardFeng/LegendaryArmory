<h1 _ngcontent-pjh-c119="" class="doc-title ng-star-inserted" title="时域AI超分"> 时域AI超分 </h1>

<div _ngcontent-pjh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>XEngine Kit提供时域AI超分能力，利用相机的抖动获取不同位置的采样信息，融合时域实现超采样率和超分辨率功能，并利用神经网络达到抗锯齿效果，建议超分倍率为[1.25, 2.0]。</p> <div class="tiledSection"><h2 id="section1311530595">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section1311530595" tips="复制节点链接"></i></h2><ul><li>支持的设备类型：Phone，从5.1.0(18)版本开始新增支持Tablet、PC/2in1、TV设备。</li><li>可通过以下方式查询相关扩展特性是否支持：<p>- 对于OpenGL ES，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga76f9695fa41c6664e949cdba586699c0" target="_blank">HMS_XEG_GetString</a> 扩展特性查询接口进行查询。</p> <p>- 对于Vulkan，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga686e40e383c8e946b36c11b4073e77c3" target="_blank">HMS_XEG_EnumerateDeviceExtensionProperties</a>扩展特性查询接口进行查询。</p> <p>如查询结果包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gaa19b427b3716d24b5f92be5be2aa3d9a" target="_blank">XEG_TEMPORAL_UPSCALE_EXTENSION_NAME</a>，则表示支持该特性，若查询结果未包含，则表示不支持该特性。</p> </li></ul> </div> <div class="tiledSection"><h2 id="section297614137247">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section297614137247" tips="复制节点链接"></i></h2><p>以下接口为OpenGL ES和Vulkan时域AI超分设置接口，如需使用更丰富的设置和查询接口，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine" target="_blank">接口文档</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>const GLubyte * HMS_XEG_GetString (GLenum name)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>XEngine OpenGL ES扩展特性查询接口。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>GL_APICALL void GL_APIENTRY HMS_XEG_TemporalUpscaleParameter(GLenum pname, const GLvoid *param);</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>设置时域AI超分输入参数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>GL_APICALL void GL_APIENTRY HMS_XEG_RenderTemporalUpscale(</p> <p>GLuint inputTexture,</p> <p>GLuint depthTexture,</p> <p>GLuint motionVectorTexture,</p> <p>GLuint dynamicMaskTexture,</p> <p>GLfloat jitterX,</p> <p>GLfloat jitterY</p> <p>);</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>执行时域AI超分渲染命令。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>VKAPI_ATTR VkResult VKAPI_CALL HMS_XEG_EnumerateDeviceExtensionProperties (VkPhysicalDevice physicalDevice, uint32_t * pPropertyCount, XEG_ExtensionProperties * pProperties)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>XEngine Vulkan扩展特性查询接口。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>VKAPI_ATTR VkResult VKAPI_CALL HMS_XEG_CreateTemporalUpscale (VkDevice device, XEG_TemporalUpscaleCreateInfo * pTemporalUpscaleInfo, XEG_TemporalUpscale * pTemporalUpscale)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>创建XEG_TemporalUpscale对象。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>VKAPI_ATTR void VKAPI_CALL HMS_XEG_CmdRenderTemporalUpscale (VkCommandBuffer commandBuffer, XEG_TemporalUpscale temporalUpscale, XEG_TemporalUpscaleDescription * pDescription)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>执行时域AI超分渲染命令。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>VKAPI_ATTR void VKAPI_CALL HMS_XEG_DestroyTemporalUpscale (XEG_TemporalUpscale temporalUpscale)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>销毁XEG_TemporalUpscale对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1171182142612">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1171182142612" tips="复制节点链接"></i></h2></div> <p>本章以OpenGL ES和Vulkan图像API集成为例，说明XEngine集成操作过程。</p> <div class="tiledSection"><h3 id="section79201052326" class="firsth2">配置项目<i class="anchor-icon anchor-icon-link" anchorid="section79201052326" tips="复制节点链接"></i></h3><p>编译HAP时，Native层so编译需要依赖NDK中的libxengine.so。</p> <ul><li>头文件引用<div class="p">按需引用XEngine的头文件，如使用OpenGL ES时域AI超分。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_gles_extension.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_gles_temporal_upscale.h&gt;</span></span></li></ol></pre></div></div> </div> <div class="p">按需引用XEngine的头文件，如使用Vulkan时域AI超分。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"xengine/xeg_vulkan_temporal_upscale.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"xengine/xeg_vulkan_extension.h"</span></span></li></ol></pre></div></div> </div> </li><li>编写CMakeLists.txt<p>按需引用XEngine的CMakeLists，如使用OpenGL ES时域AI超分功能，CMakeLists.txt部分示例代码如下，完整示例代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-gles-demo-cpp" target="_blank">Demo（GPU加速引擎-GLES）</a>。</p> <div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    xengine-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    xengine</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    EGL-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    EGL</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    GLES-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    GLESv3</li><li>)</li><li>
</li><li><span class="hljs-built_in">target_link_libraries</span>(nativerender PUBLIC</li><li>${EGL-lib} ${GLES-lib} ${xengine-lib})</li></ol></pre></div></div> <p>按需引用XEngine的CMakeLists，如使用Vulkan时域AI超分功能，CMakeLists.txt部分示例代码如下，完整示例代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-vulkan-temporal-upscale-demo-cpp" target="_blank">Demo（GPU加速引擎-Vulkan）</a>。</p> <div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    hilog-lib</li><li>    # Specifies the name of the NDK library that</li><li>    <span class="hljs-meta"># you want CMake to locate.</span></li><li>    hilog_ndk.z</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    libace-lib</li><li>    # Specifies the name of the NDK library that</li><li>    <span class="hljs-meta"># you want CMake to locate.</span></li><li>    ace_ndk.z</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    libnapi-lib</li><li>    # Specifies the name of the NDK library that</li><li>    <span class="hljs-meta"># you want CMake to locate.</span></li><li>    ace_napi.z</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    libuv-lib</li><li>    # Specifies the name of the NDK library that</li><li>    <span class="hljs-meta"># you want CMake to locate.</span></li><li>    uv</li><li>)</li><li><span class="hljs-built_in">add_library</span>(libassimp SHARED IMPORTED)</li><li><span class="hljs-built_in">set_target_properties</span>(</li><li>        libassimp</li><li>        PROPERTIES</li><li>        IMPORTED_LOCATION</li><li>        ${CMAKE_CURRENT_SOURCE_DIR}/libs/arm64-v8a/libassimp.so</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li># Sets the name of the path variable.</li><li>xengine-lib</li><li># Specifies the name of the NDK library that</li><li><span class="hljs-meta"># you want CMake to locate.</span></li><li>xengine</li><li>)</li><li><span class="hljs-built_in">target_link_libraries</span>(nativerender PUBLIC</li><li>    ${hilog-lib} ${libace-lib} ${libnapi-lib} ${libuv-lib} libnative_window.so libc++.a libktx librawfile.z.so libassimp ${xengine-lib})</li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section1636910468365">集成XEngine时域AI超分（OpenGL ES）<i class="anchor-icon anchor-icon-link" anchorid="section1636910468365" tips="复制节点链接"></i></h3><p>使用EGL和OpenGL ES图形API搭建图像渲染管线并集成时域AI超分在Native层实现，渲染结果通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-xcomponent-V5" target="_blank">XComponent</a>组件显示到屏幕。</p> <p>本节阐述OpenGL ES图形API的时域AI超分的使用，详细代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-gles-demo-cpp" target="_blank">Demo（GPU加速引擎-GLES）</a>。</p> <p>在调用XEngine Kit能力前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/syscap-V5#判断-api-是否可以使用" target="_blank">Syscap</a>查询您的目标设备是否支持SystemCapability.Graphic.XEngine系统能力。</p> <ol><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga76f9695fa41c6664e949cdba586699c0" target="_blank">HMS_XEG_GetString</a>接口，获取XEngine支持的扩展信息，只有在支持XEG_TEMPORAL_UPSCALE_EXTENSION_NAME扩展时才可以使用时域AI超分的相关接口。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 查询XEngine支持的GLES扩展信息</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* extensions = (<span class="hljs-type">const</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">HMS_XEG_GetString</span>(XEG_EXTENSIONS);</li><li><span class="hljs-comment">// 检查是否支持时域AI超分</span></li><li><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strstr</span>(extensions, XEG_TEMPORAL_UPSCALE_EXTENSION_NAME)) {</li><li>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// return error</span></li><li>}</li></ol></pre></div></div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#hms_xeg_temporalupscaleparameter" target="_blank">HMS_XEG_TemporalUpscaleParameter</a>接口，对时域AI超分的参数赋值。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// m_lowResWidth与m_lowResHeight分别为用户自定义的渲染宽度与渲染高度，此处以800*600分辨率为例</span></li><li><span class="hljs-type">uint32_t</span> m_lowResWidth = <span class="hljs-number">800</span>;</li><li><span class="hljs-type">uint32_t</span> m_lowResHeight = <span class="hljs-number">600</span>;</li><li><span class="hljs-comment">// 设置相机抖动的周期数，此处以8为例</span></li><li>GLuint jitterNum = <span class="hljs-number">8</span>;</li><li>
</li><li>GLsizei inputeSize[<span class="hljs-number">2</span>] = {<span class="hljs-built_in">static_cast</span>&lt;GLsizei&gt;(m_lowResWidth), <span class="hljs-built_in">static_cast</span>&lt;GLsizei&gt;(m_lowResHeight)};</li><li><span class="hljs-comment">// 设置超分输入纹理的真实宽高</span></li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_INPUT_SIZE, inputeSize);</li><li>
</li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_JITTER_NUM, &amp;jitterNum);</li><li>
</li><li><span class="hljs-comment">// 设置是否存在深度反转，此处为不存在深度反转</span></li><li>GLboolean isDepthReversed = GL_FALSE;</li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_DEPTH_REVERSED, &amp;isDepthReversed);</li><li>
</li><li><span class="hljs-comment">// 设置是否重置历史帧数据，true表示重置，false表示不重置。在历史帧未使用超分，并且当前帧开始使用超分的情况下建议设置为true</span></li><li>GLboolean resetHistory = GL_TRUE;</li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_RESET_HISTORY, &amp;resetHistory);</li><li>
</li><li><span class="hljs-comment">// 设置画面偏向当前帧（鬼影少但可能存在闪烁）还是历史帧（鬼影多但是更稳定）的平衡程度。此处以0.5为例</span></li><li>GLfloat steadyLevel = <span class="hljs-number">0.5</span>;</li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_STEADY_LEVEL, &amp;steadyLevel);</li></ol></pre></div></div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#hms_xeg_rendertemporalupscale" target="_blank">HMS_XEG_RenderTemporalUpscale</a>接口进行超分，每帧都需要调用。</span><p></p><p>其中，参数jitterX和jitterY分别为相机在X方向和Y方向的抖动，是一个类似Halton的低差异序列。</p> <p>本例使用Halton算法计算Jitter值：使用Halton算法生成一个[0, 1]的序列，再减去0.5使序列范围保持在[-0.5, 0.5]，最后除以输入图像的分辨率，得到UV坐标下的Jitter值。</p> <ol><li>根据Halton算法生成每帧需要的相机抖动（Jitter）。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Halton算法示例</span></li><li><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GetHaltonSequence</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> index, <span class="hljs-type">uint32_t</span> base)</span> </span>{</li><li>    <span class="hljs-type">float</span> result = <span class="hljs-number">0.0</span>;</li><li>    <span class="hljs-type">float</span> fraction = <span class="hljs-number">1.0</span> / base;</li><li>    <span class="hljs-keyword">while</span> (index &gt; <span class="hljs-number">0</span>) {</li><li>        result += fraction * (index % base);</li><li>        index /= base;</li><li>        fraction /= base;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// 当前帧数，需要每帧+1，用于确定当前帧使用的Jitter值，使Jitter值在JitterNum范围内轮转</span></li><li><span class="hljs-comment">// glm 为第三方库中声明的命名空间，具体实现请在完整示例代码中entry\src\main\cpp\3rdParty\glm中搜索查看</span></li><li><span class="hljs-type">uint64_t</span> frameNum = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// jitterX与jitterY分别为相机在X和Y方向上的抖动</span></li><li><span class="hljs-type">float</span> jitterX = <span class="hljs-number">0.0</span>;</li><li><span class="hljs-type">float</span> jitterY = <span class="hljs-number">0.0</span>;</li><li><span class="hljs-function">glm</span><strong><span class="hljs-function">::</span></strong><span class="hljs-function">mat4 <span class="hljs-title">GetJitterMat</span><span class="hljs-params">()</span> </span>{</li><li>    glm<strong>::</strong>mat4 jitterMat;</li><li>    <span class="hljs-comment">// 此处需要保证生成的低差异序列长度与jitterNum保持一致，且在[-0.5, 0.5]的范围内</span></li><li>    jitterX <strong>=</strong> <span class="hljs-built_in">GetHaltonSequence</span>((frameNum <strong>%</strong> jitterNum) <strong>+</strong> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <strong>-</strong> <span class="hljs-number">0.5</span>;</li><li>    jitterY <strong>=</strong> <span class="hljs-built_in">GetHaltonSequence</span>((frameNum <strong>%</strong> jitterNum) <strong>+</strong> <span class="hljs-number">1</span>, <span class="hljs-number">3</span>) <strong>-</strong> <span class="hljs-number">0.5</span>;</li><li>    <span class="hljs-comment">// m_lowResWidth与m_lowResHeight为步骤2中的输入图像的宽度和高度</span></li><li>    jitterX <strong>=</strong> jitterX  <strong>/</strong> m_lowResWidth;</li><li>    jitterY <strong>=</strong> jitterY <strong>/</strong> m_lowResHeight;</li><li>    jitterMat <strong>=</strong> glm<strong>::</strong><span class="hljs-built_in">translate</span>(<em>glm</em><strong>::</strong><span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), glm<strong>::</strong><span class="hljs-built_in">vec3</span>(jitterX, jitterY, <span class="hljs-number">0.0</span>));</li><li>    <strong><span class="hljs-keyword">return</span></strong> jitterMat;</li><li>}</li></ol></pre></div></div> </li><li>调用时域AI超分渲染接口。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 这里表示第一帧使用超分的情况下设置resetHistory为true，否则设置为false</span></li><li>GLboolean resetHistory = frameNum == <span class="hljs-number">0</span> ? GL_TRUE : GL_FALSE;</li><li><span class="hljs-built_in">HMS_XEG_TemporalUpscaleParameter</span>(XEG_TEMPORAL_UPSCALE_RESET_HISTORY, &amp;resetHistory);</li><li>
</li><li><span class="hljs-comment">// m_upscaleFBO为用户自定义创建的超分后的framebuffer</span></li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_upscaleFBO;</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_highResWidth;</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_highResHeight;</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_lowLightColorTexture;</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_lowGboDepth;</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_motionVectorTexture, m_dynamicMaskTexture;</li><li>
</li><li><span class="hljs-built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, m_upscaleFBO);</li><li><span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, m_highResWidth, m_highResHeight);</li><li><span class="hljs-built_in">glScissor</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, m_highResWidth, m_highResHeight);</li><li>
</li><li><span class="hljs-comment">// m_lowLightColorTexture为超分输入纹理。</span></li><li><span class="hljs-comment">// m_lowGboDepth为深度纹理。</span></li><li><span class="hljs-comment">// m_motionVectorTexture为运动矢量图像。运动矢量的计算方式为当前渲染像素的NDC坐标的XY值减去上一帧的NDC坐标的XY值。</span></li><li><span class="hljs-comment">// m_dynamicMaskTexture为物体的动态遮罩图像，格式需要是GL_RED或其兼容格式。R通道的合法值为0.0、0.2或1.0，其中0.0表示静态物体，0.2表示运动物体如人物，1.0表示特效或半透明物体。</span></li><li><span class="hljs-comment">// jitterX 相机在X方向上的抖动。</span></li><li><span class="hljs-comment">// jitterY 相机在Y方向上的抖动。</span></li><li><span class="hljs-built_in">HMS_XEG_RenderTemporalUpscale</span>(m_lowLightColorTexture, m_lowGboDepth, m_motionVectorTexture, m_dynamicMaskTexture,</li><li>                             <span class="hljs-number">-0.5</span>*jitterX, <span class="hljs-number">-0.5</span>*j<strong>itterY);</strong></li></ol></pre></div></div> </li></ol> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section10411120113710">集成XEngine时域AI超分（Vulkan）<i class="anchor-icon anchor-icon-link" anchorid="section10411120113710" tips="复制节点链接"></i></h3><p>使用Vulkan图形API搭建图像渲染管线，并集成时域AI超分在Native层实现，渲染结果通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件显示到屏幕。</p> <p>本节阐述Vulkan图形API的时域AI超分使用</p> <p>在调用XEngine Kit能力前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/syscap#判断-api-是否可以使用" target="_blank">Syscap</a>查询您的目标设备是否支持SystemCapability.Graphic.XEngine系统能力。</p> <ol><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga686e40e383c8e946b36c11b4073e77c3" target="_blank">HMS_XEG_EnumerateDeviceExtensionProperties</a>接口，获取XEngine支持的扩展信息，只有在支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gaa19b427b3716d24b5f92be5be2aa3d9a" target="_blank">XEG_TEMPORAL_UPSCALE_EXTENSION_NAME</a>扩展时才可以使用时域AI超分的相关接口。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// physicalDevice为Vulkan物理设备，用户需进行初始化</span></li><li>VkPhysicalDevice physicalDevice;</li><li><span class="hljs-comment">// 查询XEngine支持的Vulkan扩展列表</span></li><li>std::vector&lt;std::string&gt; supportedExtensions;</li><li><span class="hljs-type">uint32_t</span> pPropertyCount;</li><li><span class="hljs-built_in">HMS_XEG_EnumerateDeviceExtensionProperties</span>(physicalDevice, &amp;pPropertyCount, <span class="hljs-literal">nullptr</span>);</li><li><span class="hljs-keyword">if</span> (pPropertyCount &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-function">std::vector&lt;XEG_ExtensionProperties&gt; <span class="hljs-title">pProperties</span><span class="hljs-params">(pPropertyCount)</span></span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">HMS_XEG_EnumerateDeviceExtensionProperties</span>(physicalDevice, &amp;pPropertyCount,</li><li>        &amp;pProperties.<span class="hljs-built_in">front</span>()) == VK_SUCCESS) {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> ext : pProperties) {</li><li>            supportedExtensions.<span class="hljs-built_in">push_back</span>(ext.extensionName);</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-comment">// 查询是否支持时域AI超分</span></li><li><span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">find</span>(supportedExtensions.<span class="hljs-built_in">begin</span>(), supportedExtensions.<span class="hljs-built_in">end</span>(), XEG_TEMPORAL_UPSCALE_EXTENSION_NAME) ==</li><li>    supportedExtensions.<span class="hljs-built_in">end</span>()) {</li><li>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">//return error;</span></li><li>}</li></ol></pre></div></div> <p></p></li><li><span>声明实例句柄。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>XEG_TemporalUpscale xegTemporalUpscale;</li></ol></pre></div></div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gaabc22178ef18b1a2e1d56074328eb398" target="_blank">HMS_XEG_CreateTemporalUpscale</a>接口，创建时域AI超分实例。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 渲染宽高和超分后宽高均为用户自定义参数，这里将以800*600的分辨率进行1.5倍超分到1200*900的分辨率为例</span></li><li><span class="hljs-type">uint32_t</span> lowResWidth = <span class="hljs-number">800</span>;</li><li><span class="hljs-type">uint32_t</span> lowResHeight = <span class="hljs-number">600</span>;</li><li><span class="hljs-type">uint32_t</span> highResWidth = <span class="hljs-number">1200</span>;</li><li><span class="hljs-type">uint32_t</span> highResHeight = <span class="hljs-number">900</span>;</li><li><span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> jitterNum = <span class="hljs-number">8</span>;</li><li><span class="hljs-comment">// Vulkan逻辑设备，用户需进行初始化</span></li><li>VkDevice device;</li><li><span class="hljs-comment">// XEG_TemporalUpscaleCreateInfo为创建XEG_TemporalUpscale对象所需信息</span></li><li>XEG_TemporalUpscaleCreateInfo createInfo;</li><li><span class="hljs-comment">// 指定输入图像的大小，即低分辨率图像的尺寸</span></li><li>createInfo.inputSize = {lowResWidth, lowResHeight};</li><li><span class="hljs-comment">// 指定输出图像的大小，即高分辨率图像的尺寸</span></li><li>createInfo.outputSize = {highResWidth, highResHeight};</li><li><span class="hljs-comment">// 指定输出图像的颜色格式</span></li><li>createInfo.outputFormat = VK_FORMAT_R8G8B8A8_UNORM;</li><li><span class="hljs-comment">// jitterNum为相机抖动的周期数</span></li><li>createInfo.jitterNum = jitterNum;</li><li><span class="hljs-comment">// 指定了深度值是否反转</span></li><li>createInfo.isDepthReversed = <span class="hljs-literal">true</span>;</li><li>VkResult res = <span class="hljs-built_in">HMS_XEG_CreateTemporalUpscale</span>(device, &amp;createInfo, &amp;xegTemporalUpscale);</li><li><span class="hljs-keyword">if</span> (res != VK_SUCCESS) {</li><li>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">//return error;</span></li><li>}</li></ol></pre></div></div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gab17d5b6bc07ed933f5ef0e951b4b6d9f" target="_blank">HMS_XEG_CmdRenderTemporalUpscale</a>接口下发超分，每帧都需要调用。</span><p></p><p>其中，参数jitterX和jitterY分别为相机在X方向和Y方向的抖动，是一个类似Halton的低差异序列。</p> <div class="p">本例使用Halton算法计算Jitter值：使用Halton算法生成一个[0, 1]的序列，再减去0.5使序列范围保持在[-0.5, 0.5]，最后除以输入图像的分辨率，得到UV坐标下的Jitter值。<ol><li>根据Halton算法生成每帧需要的相机抖动（Jitter）。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Halton算法示例</span></li><li><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">GetHaltonSequence</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> index, <span class="hljs-type">uint32_t</span> base)</span> </span>{</li><li>    <span class="hljs-type">float</span> result = <span class="hljs-number">0.0</span>;</li><li>    <span class="hljs-type">float</span> fraction = <span class="hljs-number">1.0</span> / base;</li><li>    <span class="hljs-keyword">while</span> (index &gt; <span class="hljs-number">0</span>) {</li><li>        result += fraction * (index % base);</li><li>        index /= base;</li><li>        fraction /= base;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> </li><li>调用时域AI超分渲染接口。<div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 当前帧数，需要每帧+1，用于确定当前帧使用的Jitter值，使Jitter值在JitterNum范围内轮转</span></li><li><span class="hljs-type">uint64_t</span> frameNum = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// jitterX与jitterY分别为相机在X和Y方向上的抖动</span></li><li><span class="hljs-type">float</span> jitterX = <span class="hljs-number">0.0</span>;</li><li><span class="hljs-type">float</span> jitterY = <span class="hljs-number">0.0</span>;</li><li><span class="hljs-comment">// 定义XEG_TemporalUpscaleDescription对象xegDescription</span></li><li>XEG_TemporalUpscaleDescription xegDescription;</li><li><span class="hljs-comment">// inputImageView为用户创建的超分输入图像的vkImageView</span></li><li>VkImageView inputImageView = VK_NULL_HANDLE;</li><li><span class="hljs-comment">// depthImageView为用户创建的深度图像vkImageView</span></li><li>VkImageView motionVectorImageView= VK_NULL_HANDLE;</li><li><span class="hljs-comment">// motionVectorImageView为用户创建的运动矢量图像vkImageView</span></li><li>VkImageView depthImageView = VK_NULL_HANDLE;</li><li><span class="hljs-comment">// dynamicMaskImageView为用户创建的物体动态遮罩图像vkImageView</span></li><li>VkImageView dynamicMaskImageView = VK_NULL_HANDLE;</li><li><span class="hljs-comment">// outputImageView为用户创建的超分输出图像vkImageView</span></li><li>VkImageView outputImageView = VK_NULL_HANDLE;</li><li><span class="hljs-comment">// commandBuffer为命令缓冲区，用户需进行初始化</span></li><li>VkCommandBuffer commandBuffer = VK_NULL_HANDLE;</li><li>xegDescription.inputImage = inputImageView;</li><li>xegDescription.depthImage = depthImageView;</li><li>xegDescription.motionVectorImage = motionVectorImageView;</li><li>xegDescription.dynamicMaskImage = dynamicMaskImageView;</li><li>xegDescription.outputImage = outputImageView;</li><li><span class="hljs-comment">// 此处需要保证生成的低差异序列长度与jitterNum保持一致，且在[-0.5, 0.5]的范围内</span></li><li>jitterX = <span class="hljs-built_in">GetHaltonSequence</span>((frameNum % jitterNum) + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>) - <span class="hljs-number">0.5</span>;</li><li>jitterY = <span class="hljs-built_in">GetHaltonSequence</span>((frameNum % jitterNum) + <span class="hljs-number">1</span>, <span class="hljs-number">3</span>) - <span class="hljs-number">0.5</span>;</li><li><span class="hljs-comment">// lowResWidth与lowResHeight为步骤3中的输入图像的宽度和高度</span></li><li>jitterX = jitterX / lowResWidth;</li><li>jitterY = jitterY / lowResHeight;</li><li>xegDescription.jitterX = -jitterX;</li><li>xegDescription.jitterY = -jitterY;</li><li><span class="hljs-comment">// resetHistory为选择是否重置历史帧数据，true表示重置，false则表示不重置，此处以true为例</span></li><li>xegDescription.resetHistory = (frameNum == <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;</li><li><span class="hljs-comment">// steadyLevel为画面偏向当前帧还是历史帧的平衡程度，取值范围为[0.0, 1.0]，此处以平衡程度为0.5为例</span></li><li>xegDescription.steadyLevel = <span class="hljs-number">0.5</span>;</li><li><span class="hljs-built_in">HMS_XEG_CmdRenderTemporalUpscale</span>(commandBuffer, xegTemporalUpscale, &amp;xegDescription);</li></ol></pre></div></div> </li></ol> </div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gae66c277da73be92ad06ebba62b97490b" target="_blank">HMS_XEG_DestroyTemporalUpscale</a>接口销毁实例。</span><p></p><div _ngcontent-pjh-c106="" class="highlight-div"><div _ngcontent-pjh-c106="" class="highlight-div-header"><div _ngcontent-pjh-c106="" class="highlight-div-header-left"><div _ngcontent-pjh-c106="" class="handle-button expand-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pjh-c106="" class="highlight-div-header-right"><div _ngcontent-pjh-c106="" class="handle-button ai-button"></div><div _ngcontent-pjh-c106="" class="handle-button line-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pjh-c106="" class="handle-button theme-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pjh-c106="" class="handle-button copy-button"><div _ngcontent-pjh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pjh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (xegTemporalUpscale) {</li><li>    <span class="hljs-built_in">HMS_XEG_DestroyTemporalUpscale</span>(xegTemporalUpscale);</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> </div> <div></div></div>