<h1 _ngcontent-uuv-c119="" class="doc-title ng-star-inserted" title="普通数据搬运"> 普通数据搬运 </h1>

<div _ngcontent-uuv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section23823mcpsimp">函数功能<i class="anchor-icon anchor-icon-link" anchorid="section23823mcpsimp" tips="复制节点链接"></i></h2><p>普通数据搬运接口，适用于连续和不连续数据搬运。</p> </div> <div class="tiledSection"><h2 id="section23826mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section23826mcpsimp" tips="复制节点链接"></i></h2><ul><li>源操作数为GlobalTensor，目的操作数为LocalTensor<div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 支持连续和不连续 </span></li><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; dstLocal, <span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; srcGlobal, <span class="hljs-type">const</span> DataCopyParams&amp; repeatParams)</span></span>; </li><li> </li><li><span class="hljs-comment">// 支持连续 </span></li><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; dstLocal, <span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; srcGlobal, <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> calCount)</span></span>;</li></ol></pre></div></div> <p>该原型接口支持的数据通路和数据类型如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>数据通路和数据类型（源操作数为GlobalTensor，目的操作数为LocalTensor）</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.2.4.1.1" valign="top" width="13.270000000000001%"><p>支持型号</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.2.4.1.2" valign="top" width="25.629999999999995%"><p>数据通路（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tposition">TPosition</a>章节中表1表达）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.2.4.1.3" valign="top" width="61.1%"><p>源操作数和目的操作数的数据类型 (两者保持一致)</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="25.629999999999995%"><p>GM-&gt;L1</p> </td> <td class="cellrowborder" valign="top" width="61.1%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="25.629999999999995%"><p>GM-&gt;L1</p> </td> <td class="cellrowborder" valign="top" width="61.1%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="25.629999999999995%"><p>GM-&gt;UB</p> </td> <td class="cellrowborder" valign="top" width="61.1%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.270000000000001%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="25.629999999999995%"><p>GM-&gt;UB</p> </td> <td class="cellrowborder" valign="top" width="61.1%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr>  </tbody></table></div> </div> </li></ul> <ul><li>源操作数和目的操作数都为LocalTensor<div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 支持连续和不连续</span></li><li> <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li> <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; dstLocal, <span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; srcGlobal, <span class="hljs-type">const</span> DataCopyParams&amp; repeatParams)</span></span>; </li><li>  </li><li> <span class="hljs-comment">// 支持连续</span></li><li> <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li> <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; dstLocal, <span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; srcGlobal, <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> calCount)</span></span>;</li></ol></pre></div></div> <p>该原型接口支持的数据通路和数据类型如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>数据通路和数据类型（源操作数和目的操作数都为LocalTensor）</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.2.4.1.1" valign="top" width="16.259999999999998%"><p>支持型号</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.2.4.1.2" valign="top" width="23.65%"><p>数据通路（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tposition#zh-cn_topic_0000002083616850__table5376122715308">表1</a>表达）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.2.4.1.3" valign="top" width="60.089999999999996%"><p>源操作数和目的操作数的数据类型 (两者保持一致)</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;UB</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;UB</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;BT</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;BT</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;PT</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;PT</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;FB</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>L1-&gt;FB</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>UB-&gt;L1</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16.259999999999998%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="23.65%"><p>UB-&gt;L1</p> </td> <td class="cellrowborder" valign="top" width="60.089999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr>  </tbody></table></div> </div> </li></ul> <ul><li>源操作数为LocalTensor，目的操作数为GlobalTensor<div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 支持连续和不连续 </span></li><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor &lt;T&gt;&amp; dstGlobal, <span class="hljs-type">const</span> LocalTensor &lt;T&gt;&amp; srcLocal, <span class="hljs-type">const</span> DataCopyParams&amp; repeatParams)</span></span>; </li><li><span class="hljs-comment">// 支持连续 </span></li><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; </li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor &lt;T&gt;&amp; dstGlobal, <span class="hljs-type">const</span> LocalTensor &lt;T&gt;&amp; srcLocal, <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> calCount)</span></span>;</li></ol></pre></div></div> <p>该原型接口支持的数据通路和数据类型如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表3 </b>数据通路和数据类型（源操作数为LocalTensor，目的操作数为GlobalTensor）</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.2.4.1.1" valign="top" width="15.58%"><p>支持型号</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.2.4.1.2" valign="top" width="24.72%"><p>数据通路（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tposition#zh-cn_topic_0000002083616850__table5376122715308">表1</a>表达）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.2.4.1.3" valign="top" width="59.699999999999996%"><p>源操作数和目的操作数的数据类型 (两者保持一致)</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15.58%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="24.72%"><p>L1-&gt;GM</p> </td> <td class="cellrowborder" valign="top" width="59.699999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.58%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="24.72%"><p>L1-&gt;GM</p> </td> <td class="cellrowborder" valign="top" width="59.699999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.58%"><p>Kirin9020系列处理器</p> </td> <td class="cellrowborder" valign="top" width="24.72%"><p>UB-&gt;GM</p> </td> <td class="cellrowborder" valign="top" width="59.699999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.58%"><p>KirinX90系列处理器</p> </td> <td class="cellrowborder" valign="top" width="24.72%"><p>UB-&gt;GM</p> </td> <td class="cellrowborder" valign="top" width="59.699999999999996%"><p>int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr>  </tbody></table></div> </div> </li></ul> <ul><li>源操作数和目的操作数都为LocalTensor，支持源操作数和目的操作数类型不一致<div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> dst_T, <span class="hljs-keyword">typename</span> src_T&gt; </li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopy</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;dst_T&gt;&amp; dstLocal, <span class="hljs-type">const</span> LocalTensor&lt;src_T&gt;&amp; srcLocal, <span class="hljs-type">const</span> DataCopyParams&amp; repeatParams)</span></span>;</li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section24156mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section24156mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表4 </b>普通数据搬运接口参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.1" valign="top" width="15%"><p>参数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.2" valign="top" width="10%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.3" valign="top" width="75%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>dstLocal，dstGlobal</p> </td> <td class="cellrowborder" valign="top" width="10%"><p>输出</p> </td> <td class="cellrowborder" valign="top" width="75%"><p>目的操作数，类型为LocalTensor或GlobalTensor。<strong>当dstLocal位于C2时，起始地址要求64B对齐；dstLocal位于C2PIPE2GM时，起始地址要求128B对齐；其他情况均为32字节对齐。</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>srcLocal，srcGlobal</p> </td> <td class="cellrowborder" valign="top" width="10%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="75%"><p>源操作数，类型为LocalTensor或GlobalTensor。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>repeatParams</p> </td> <td class="cellrowborder" valign="top" width="10%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="75%"><p>搬运参数，DataCopyParams类型，定义如下，具体参数说明请参考<a href="/consumer/cn/doc/harmonyos-guides/cannkit-common-data-movement#zh-cn_topic_0000002123870305__d1e46069">表5</a>。</p> <div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DataCopyParams</span> { </li><li>     <span class="hljs-type">uint16_t</span> blockCount = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint16_t</span> blockLen = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint16_t</span> srcStride = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint16_t</span> dstStride = <span class="hljs-number">0</span>; </li><li> };</li></ol></pre></div></div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>calCount</p> </td> <td class="cellrowborder" valign="top" width="10%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="75%"><p>参与搬运的元素个数。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>DataCopy的搬运量要求为32byte的倍数，因此使用普通数据搬运接口（连续数据搬运，包含calCount参数）时，calCount * sizeof(T)需要32byte对齐，若不对齐，搬运量将对32byte做向下取整。</p> </div></div></div> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table id="zh-cn_topic_0000002123870305__d1e46069" class="layoutFixed idpTab"><caption><b>表5 </b>DataCopyParams结构体参数定义</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.3.1.1" valign="top" width="15%"><p>参数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.3.1.2" valign="top" width="85%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>blockCount</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令包含的连续传输数据块个数，取值范围：blockCount∈[1, 4095]。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>blockLen</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令每个连续传输数据块长度，单位为datablock(32Bytes)。取值范围：blockLen∈[1, 65535]。</p> <p>特别的，当dstLocal位于C2PIPE2GM时，单位为128B；当dstLocal位于C2时，单位为64B。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>srcStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>源操作数，相邻连续数据块的间隔（前面一个数据块的尾与后面数据块的头的间隔），单位为datablock(32Bytes)。数据类型为uint16_t，srcStride不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>dstStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>目的操作数，相邻连续数据块间的间隔（前面一个数据块的尾与后面数据块的头的间隔），单位为datablock(32Bytes)。数据类型为uint16_t，dstStride不要超出该数据类型的取值范围。</p> <p>特别的，当dstLocal位于C2PIPE2GM时，单位为128B；当dstLocal位于C2时，单位为64B。</p> </td> </tr>  </tbody></table></div> </div> <p>下面的样例呈现了DataCopyParams结构体参数的使用方法，样例中完成了2个连续传输数据块的搬运，每个数据块含有8个datablock，源操作数相邻数据块之间无间隔，目的操作数相邻数据块尾与头之间间隔1个datablock。</p> <p class="msonormal"><span><img height="224.77" originheight="361" originwidth="846" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114326.73475583775180176932033167485699:50001231000000:2800:A948F0E8506FC9A801E8BA40D4E34979174B81A9D2575896B67DC7609621ADFF.png" title="点击放大" width="528.01"></span></p> </div> <div class="tiledSection"><h2 id="section24246mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section24246mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section24254mcpsimp">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section24254mcpsimp" tips="复制节点链接"></i></h2><ul><li>硬件在执行数据搬运时会以datablock作为基本单位，而1 datablock = 32 Byte，故使用者可以尝试通过每次指令处理32Byte整数倍大小的数据来提高指令的执行效率。</li><li>如果执行多个DataCopy指令时，需确保DataCopy的目的地址不存在重叠。</li></ul> </div> <div class="tiledSection"><h2 id="section24260mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section24260mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel_operator.h"</span> </span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">KernelDataCopy</span> { </li><li><span class="hljs-keyword">public</span>: </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-title">KernelDataCopy</span><span class="hljs-params">()</span> </span>{} </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Init</span><span class="hljs-params">(__gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">src0Gm</span></span></em><span class="hljs-function"><span class="hljs-params">, __gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">src1Gm</span></span></em><span class="hljs-function"><span class="hljs-params">, __gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">dstGm</span></span></em><span class="hljs-function"><span class="hljs-params">)</span> </span></li><li><span class="hljs-function">    </span>{ </li><li>        src0Global.<span class="hljs-built_in">SetGlobalBuffer</span>((__gm__ half*)<em>src0Gm</em>); </li><li>        src1Global.<span class="hljs-built_in">SetGlobalBuffer</span>((__gm__ half*)<em>src1Gm</em>); </li><li>        dstGlobal.<span class="hljs-built_in">SetGlobalBuffer</span>((__gm__ half*)<em>dstGm</em>); </li><li>        pipe.<span class="hljs-built_in">InitBuffer</span>(inQueueSrc0, <span class="hljs-number">1</span>, <span class="hljs-number">512</span> * <span class="hljs-built_in">sizeof</span>(half)); </li><li>        pipe.<span class="hljs-built_in">InitBuffer</span>(inQueueSrc1, <span class="hljs-number">1</span>, <span class="hljs-number">512</span> * <span class="hljs-built_in">sizeof</span>(half)); </li><li>        pipe.<span class="hljs-built_in">InitBuffer</span>(outQueueDst, <span class="hljs-number">1</span>, <span class="hljs-number">512</span> * <span class="hljs-built_in">sizeof</span>(half)); </li><li>    } </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span> </span></li><li><span class="hljs-function">    </span>{ </li><li>        <span class="hljs-built_in">CopyIn</span>(); </li><li>        <span class="hljs-built_in">Compute</span>(); </li><li>        <span class="hljs-built_in">CopyOut</span>(); </li><li>    } </li><li><span class="hljs-keyword">private</span>: </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">CopyIn</span><span class="hljs-params">()</span> </span></li><li><span class="hljs-function">    </span>{ </li><li>        AscendC::LocalTensor&lt;half&gt; src0Local = inQueueSrc0.<span class="hljs-built_in">AllocTensor</span>&lt;half&gt;(); </li><li>        AscendC::LocalTensor&lt;half&gt; src1Local = inQueueSrc1.<span class="hljs-built_in">AllocTensor</span>&lt;half&gt;(); </li><li>        AscendC::<span class="hljs-built_in">DataCopy</span>(src0Local, src0Global, <span class="hljs-number">512</span>); </li><li>        AscendC::<span class="hljs-built_in">DataCopy</span>(src1Local, src1Global, <span class="hljs-number">512</span>); </li><li>        inQueueSrc0.<span class="hljs-built_in">EnQue</span>(src0Local); </li><li>        inQueueSrc1.<span class="hljs-built_in">EnQue</span>(src1Local); </li><li>    } </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Compute</span><span class="hljs-params">()</span> </span></li><li><span class="hljs-function">    </span>{ </li><li>        AscendC::LocalTensor&lt;half&gt; src0Local = inQueueSrc0.<span class="hljs-built_in">DeQue</span>&lt;half&gt;(); </li><li>        AscendC::LocalTensor&lt;half&gt; src1Local = inQueueSrc1.<span class="hljs-built_in">DeQue</span>&lt;half&gt;(); </li><li>        AscendC::LocalTensor&lt;half&gt; dstLocal = outQueueDst.<span class="hljs-built_in">AllocTensor</span>&lt;half&gt;(); </li><li>        AscendC::<span class="hljs-built_in">Add</span>(dstLocal, src0Local, src1Local, <span class="hljs-number">512</span>); </li><li>        outQueueDst.<span class="hljs-built_in">EnQue</span>&lt;half&gt;(dstLocal); </li><li>        inQueueSrc0.<span class="hljs-built_in">FreeTensor</span>(src0Local); </li><li>        inQueueSrc1.<span class="hljs-built_in">FreeTensor</span>(src1Local); </li><li>    } </li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">CopyOut</span><span class="hljs-params">()</span> </span></li><li><span class="hljs-function">    </span>{ </li><li>        AscendC::LocalTensor&lt;half&gt; dstLocal = outQueueDst.<span class="hljs-built_in">DeQue</span>&lt;half&gt;(); </li><li>        AscendC::<span class="hljs-built_in">DataCopy</span>(dstGlobal, dstLocal, <span class="hljs-number">512</span>); </li><li>        outQueueDst.<span class="hljs-built_in">FreeTensor</span>(dstLocal); </li><li>    } </li><li><span class="hljs-keyword">private</span>: </li><li>    AscendC::TPipe pipe; </li><li>    AscendC::TQue&lt;AscendC::QuePosition::VECIN, <span class="hljs-number">1</span>&gt; inQueueSrc0, inQueueSrc1; </li><li>    AscendC::TQue&lt;AscendC::QuePosition::VECOUT, <span class="hljs-number">1</span>&gt; outQueueDst; </li><li>    AscendC::GlobalTensor&lt;half&gt; src0Global, src1Global, dstGlobal; </li><li>}; </li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">__global__ __aicore__ <span class="hljs-type">void</span> <span class="hljs-title">data_copy_kernel</span><span class="hljs-params">(__gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">src0Gm</span></span></em><span class="hljs-function"><span class="hljs-params">, __gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">src1Gm</span></span></em><span class="hljs-function"><span class="hljs-params">, __gm__ <span class="hljs-type">uint8_t</span>* </span></span><em><span class="hljs-function"><span class="hljs-params">dstGm</span></span></em><span class="hljs-function"><span class="hljs-params">)</span> </span></li><li><span class="hljs-function"></span>{ </li><li>    KernelDataCopy op; </li><li>    op.<span class="hljs-built_in">Init</span>(<em>src0Gm</em>, <em>src1Gm</em>, <em>dstGm</em>); </li><li>    op.<span class="hljs-built_in">Process</span>(); </li><li>}</li></ol></pre></div></div> <p>结果示例：</p> <div _ngcontent-uuv-c106="" class="highlight-div"><div _ngcontent-uuv-c106="" class="highlight-div-header"><div _ngcontent-uuv-c106="" class="highlight-div-header-left"><div _ngcontent-uuv-c106="" class="handle-button expand-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uuv-c106="" class="highlight-div-header-right"><div _ngcontent-uuv-c106="" class="handle-button ai-button"></div><div _ngcontent-uuv-c106="" class="handle-button line-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uuv-c106="" class="handle-button theme-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uuv-c106="" class="handle-button copy-button"><div _ngcontent-uuv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uuv-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>输入数据(src0Global): [1 2 3 ... 512] </li><li>输入数据(src1Global): [1 2 3 ... 512] </li><li>输出数据(dstGlobal):[2 4 6 ... 1024]</li></ol></pre></div></div> </div> </div> <div></div></div>