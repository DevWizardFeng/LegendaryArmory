<h1 _ngcontent-wgj-c119="" class="doc-title ng-star-inserted" title="智能拍摄跟踪开发指南"> 智能拍摄跟踪开发指南 </h1>

<div _ngcontent-wgj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 20开始，支持使用机械体设备控制器，提供更丰富的拍摄体验，如人脸智能跟踪和自动构图等专业功能，支持第三方应用。</p>    <p>智能拍摄跟踪功能通过机械体设备实现人脸和物体的自动化跟踪，提升拍摄质量和用户体验，助力开发者构建更智能、高效的拍摄解决方案。</p>    <div class="tiledSection">     <h2 id="接口介绍">接口介绍<i class="anchor-icon anchor-icon-link" anchorid="接口介绍" tips="复制节点链接"></i></h2>          <p>机械体设备控制器API的接口使用指导请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-mechanicmanager" target="_blank">MechanicManager API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">on(type: 'attachStateChange', callback: Callback&lt;AttachStateChangeInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>注册attachStateChange事件的回调监听，等待连接状态变化。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">off(type: 'attachStateChange', callback?: Callback&lt;AttachStateChangeInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>取消注册attachStateChange事件的回调监听。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getAttachedMechDevices(): MechInfo[]</td>         <td class="cellrowborder" valign="top" width="50%">          <p>获取已连接的机械体设备列表。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setCameraTrackingEnabled(isEnabled: boolean): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>启用或禁用摄像头跟踪。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getCameraTrackingEnabled(): boolean</td>         <td class="cellrowborder" valign="top" width="50%">          <p>检查是否启用了摄像头跟踪。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">on(type: 'trackingStateChange', callback: Callback&lt;TrackingEventInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>注册trackingStateChange事件的回调监听。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">off(type: 'trackingStateChange', callback?: Callback&lt;TrackingEventInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>取消注册trackingStateChange事件的回调监听。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setCameraTrackingLayout(trackingLayout: CameraTrackingLayout): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>设置摄像头跟踪布局。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getCameraTrackingLayout(): CameraTrackingLayout</td>         <td class="cellrowborder" valign="top" width="50%">          <p>获取此机械设备摄像头跟踪布局。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">on(type: 'rotationAxesStatusChange', callback: Callback&lt;RotationAxesStateChangeInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>注册rotationAxesStatusChange事件的回调监听。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">off(type: 'rotationAxesStatusChange', callback?: Callback&lt;RotationAxesStateChangeInfo&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">          <p>取消注册rotationAxesStatusChange事件的回调监听。</p>          <p><strong>说明</strong>：从API version 20开始支持。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="开发准备" class="firsth2">开发准备<i class="anchor-icon anchor-icon-link" anchorid="开发准备" tips="复制节点链接"></i></h3>          <ol>      <li>支持Mechanic Kit协议的机械体设备。</li>      <li>若要验证智能跟踪功能，主设备的相机驱动必须支持人脸检测。</li>      <li>请将SDK更新到API 20或以上版本，具体操作参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-software-install" target="_blank">更新指南</a>。</li>      <li>请确保机械体设备已通过蓝牙与主设备连接。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="管理设备连接状态">管理设备连接状态<i class="anchor-icon anchor-icon-link" anchorid="管理设备连接状态" tips="复制节点链接"></i></h3>          <p>确保机械体设备连接或断开时，应用能及时响应，支持设备连接状态的动态管理。</p>     <ol>      <li>       <p>导入机械体设备管理模块。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { mechanicManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MechanicKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>获取已连接的机械体列表。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">savedMechanicIds</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li><span class="hljs-keyword">const</span> devices = mechanicManager.<span class="hljs-title function_">getAttachedMechDevices</span>();</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Connected devices:'</span>, devices);</li><li>
</li><li>devices.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">device</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Device ID: <span class="hljs-subst">${device.mechId}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Device Name: <span class="hljs-subst">${device.mechName}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Device Type: <span class="hljs-subst">${device.mechDeviceType}</span>`</span>);</li><li>    </li><li><span class="hljs-comment">//保存设备类型为GIMBAL_DEVICE的设备的MechId</span></li><li>    <span class="hljs-keyword">if</span> (device.<span class="hljs-property">mechDeviceType</span> === mechanicManager.<span class="hljs-property">MechDeviceType</span>.<span class="hljs-property">GIMBAL_DEVICE</span>) {</li><li>    savedMechanicIds.<span class="hljs-title function_">push</span>(device.<span class="hljs-property">mechId</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`GIMBAL_TYPE device saved ID: <span class="hljs-subst">${device.mechId}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Skip non-gimbal devices: <span class="hljs-subst">${device.mechId}</span>`</span>);</li><li>    }</li><li>});</li><li>
</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'List of saved gimbal device IDs:'</span>, savedMechanicIds);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error getting attached devices:'</span>, err);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>监听设备的连接状态变化，以便及时响应。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">attachStateChangeCallback</span> = (<span class="hljs-params">info: mechanicManager.AttachStateChangeInfo</span>) =&gt; {</li><li><span class="hljs-keyword">if</span> (info.<span class="hljs-property">state</span> === mechanicManager.<span class="hljs-property">AttachState</span>.<span class="hljs-property">ATTACHED</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Device attached:'</span>, info.<span class="hljs-property">mechInfo</span>);</li><li>    <span class="hljs-comment">// 执行设备连接的相关操作</span></li><li>    <span class="hljs-title function_">handleDeviceAttached</span>(info.<span class="hljs-property">mechInfo</span>);</li><li>} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (info.<span class="hljs-property">state</span> === mechanicManager.<span class="hljs-property">AttachState</span>.<span class="hljs-property">DETACHED</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Device detached:'</span>, info.<span class="hljs-property">mechInfo</span>);</li><li>    <span class="hljs-comment">// 执行设备断开的相关操作</span></li><li>    <span class="hljs-title function_">handleDeviceDetached</span>(info.<span class="hljs-property">mechInfo</span>);</li><li>}</li><li>};</li><li>
</li><li><span class="hljs-comment">// 注册监听</span></li><li>mechanicManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'attachStateChange'</span>, attachStateChangeCallback);</li></ol></pre></div></div></li>      <li>       <p>处理设备的连接与断开的事件。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeviceAttached</span>(<span class="hljs-params">mechInfo: mechanicManager.MechInfo</span>) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`New device is connected: <span class="hljs-subst">${mechInfo.mechName}</span> (ID: <span class="hljs-subst">${mechInfo.mechId}</span>)`</span>);</li><li>savedMechanicIds.<span class="hljs-title function_">push</span>(mechInfo.<span class="hljs-property">mechId</span>);</li><li><span class="hljs-comment">// To do sth.</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeviceDetached</span>(<span class="hljs-params">mechInfo: mechanicManager.MechInfo</span>) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Device disconnected: <span class="hljs-subst">${mechInfo.mechName}</span> (ID: <span class="hljs-subst">${mechInfo.mechId}</span>)`</span>);</li><li>savedMechanicIds.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> id !== mechInfo.<span class="hljs-property">mechId</span>);</li><li><span class="hljs-comment">// To do sth.</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>取消连接状态的监听。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 取消连接状态的监听</span></li><li>mechanicManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'attachStateChange'</span>, attachStateChangeCallback);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="控制设备智能跟踪拍摄">控制设备智能跟踪拍摄<i class="anchor-icon anchor-icon-link" anchorid="控制设备智能跟踪拍摄" tips="复制节点链接"></i></h3>          <p>启用智能拍摄功能后，设备将自动识别人脸并进行跟踪拍摄。</p>     <ol>      <li>       <p>启用摄像头的智能拍摄功能。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li><span class="hljs-comment">//检查前判断savedMechIds不为空</span></li><li><span class="hljs-comment">// 检查跟踪状态</span></li><li><span class="hljs-keyword">const</span> isEnabled = mechanicManager.<span class="hljs-title function_">getCameraTrackingEnabled</span>();</li><li>
</li><li><span class="hljs-keyword">if</span> (isEnabled == <span class="hljs-literal">false</span>) {</li><li>    <span class="hljs-comment">// 开启摄像头跟踪</span></li><li>    mechanicManager.<span class="hljs-title function_">setCameraTrackingEnabled</span>(<span class="hljs-literal">true</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Camera tracking enabled'</span>);</li><li>}</li><li>
</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Is tracking currently enabled:'</span>, isEnabled);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to enable camera tracking:'</span>, err);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>监听相机跟踪状态的变化。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">trackingStateCallback</span> = (<span class="hljs-params">eventInfo : mechanicManager.TrackingEventInfo</span>) =&gt; {</li><li><span class="hljs-keyword">switch</span> (eventInfo.<span class="hljs-property">event</span>) {</li><li>    <span class="hljs-keyword">case</span> mechanicManager.<span class="hljs-property">TrackingEvent</span>.<span class="hljs-property">CAMERA_TRACKING_USER_ENABLED</span>:</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'The user has enabled camera tracking'</span>);</li><li>    <span class="hljs-title function_">handleTrackingEnabled</span>();</li><li>    <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> mechanicManager.<span class="hljs-property">TrackingEvent</span>.<span class="hljs-property">CAMERA_TRACKING_USER_DISABLED</span>:</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'The user has disabled camera tracking'</span>);</li><li>    <span class="hljs-title function_">handleTrackingDisabled</span>();</li><li>    <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> mechanicManager.<span class="hljs-property">TrackingEvent</span>.<span class="hljs-property">CAMERA_TRACKING_LAYOUT_CHANGED</span>:</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Tracking layout has changed'</span>);</li><li>    <span class="hljs-title function_">handleLayoutChanged</span>();</li><li>    <span class="hljs-keyword">break</span>;</li><li>}</li><li>};</li><li>
</li><li><span class="hljs-comment">// 注册跟踪状态监听</span></li><li>mechanicManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'trackingStateChange'</span>, trackingStateCallback);</li></ol></pre></div></div></li>      <li>       <p>处理跟踪状态变化事件。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTrackingEnabled</span>(<span class="hljs-params"></span>) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Handling camera tracking enable events'</span>);</li><li><span class="hljs-comment">// 可以在此处更新UI状态</span></li><li><span class="hljs-title function_">updateTrackingUI</span>(<span class="hljs-literal">true</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTrackingDisabled</span>(<span class="hljs-params"></span>) {</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Handling camera tracking disabled events'</span>);</li><li><span class="hljs-comment">// 可以在此处更新UI状态</span></li><li><span class="hljs-title function_">updateTrackingUI</span>(<span class="hljs-literal">false</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLayoutChanged</span>(<span class="hljs-params"></span>) {</li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> newLayout = mechanicManager.<span class="hljs-title function_">getCameraTrackingLayout</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'New Tracking Layout:'</span>, newLayout);</li><li>    <span class="hljs-comment">// 根据新布局更新UI</span></li><li>    <span class="hljs-title function_">updateLayoutUI</span>(newLayout);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get new layout:'</span>, err);</li><li>}</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTrackingUI</span>(<span class="hljs-params">enabled: <span class="hljs-built_in">boolean</span></span>) {</li><li><span class="hljs-comment">// 更新UI显示跟踪状态</span></li><li><span class="hljs-comment">// To do sth.</span></li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Update tracking UI status:'</span>, enabled);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateLayoutUI</span>(<span class="hljs-params">layout : mechanicManager.CameraTrackingLayout</span>) {</li><li><span class="hljs-comment">// 更新UI显示布局状态</span></li><li><span class="hljs-comment">// To do sth.</span></li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Update layout UI:'</span>, layout);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>取消跟踪状态变化的监听。</p>       <div _ngcontent-wgj-c106="" class="highlight-div"><div _ngcontent-wgj-c106="" class="highlight-div-header"><div _ngcontent-wgj-c106="" class="highlight-div-header-left"><div _ngcontent-wgj-c106="" class="handle-button expand-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgj-c106="" class="highlight-div-header-right"><div _ngcontent-wgj-c106="" class="handle-button ai-button"></div><div _ngcontent-wgj-c106="" class="handle-button line-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgj-c106="" class="handle-button theme-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgj-c106="" class="handle-button copy-button"><div _ngcontent-wgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 取消跟踪状态监听</span></li><li>mechanicManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'trackingStateChange'</span>, trackingStateCallback);</li><li>
</li><li><span class="hljs-comment">// 或者取消所有跟踪状态监听</span></li><li>mechanicManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'trackingStateChange'</span>);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="调试验证">调试验证<i class="anchor-icon anchor-icon-link" anchorid="调试验证" tips="复制节点链接"></i></h3>          <p>请按照以下步骤调试验证，确保机械体设备管理功能正常：</p>     <p><strong>建立连接</strong></p>     <ol>      <li>确保机械体与开发设备已通过蓝牙配对并连接。</li>      <li>将开发设备放置在机械体设备上。</li>     </ol>     <p><strong>功能验证步骤</strong></p>     <ol>      <li><strong>设备列表查询</strong>：调用 getAttachedMechDevices 接口查询当前已连接的机械体设备列表，验证设备是否正确识别。</li>      <li><strong>智能拍摄跟踪</strong>：调用 setCameraTrackingEnabled 启用摄像头智能跟踪功能，使用 getCameraTrackingEnabled 验证状态，测试设备是否能跟随目标自动旋转。</li>     </ol>     <p><strong>验证结果说明</strong></p>     <ul>      <li>如果 getAttachedMechDevices 返回设备列表，表示设备识别成功。</li>      <li>如果 getCameraTrackingEnabled 返回真，智能拍摄跟踪启用成功。应用打开相机后，画面中出现人脸时，设备会跟随人脸转动。</li>     </ul>    </div>   </div>   <div></div></div>