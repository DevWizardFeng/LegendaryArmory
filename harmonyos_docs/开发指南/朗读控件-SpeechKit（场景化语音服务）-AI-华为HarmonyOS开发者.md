<h1 _ngcontent-sfu-c119="" class="doc-title ng-star-inserted" title="朗读控件"> 朗读控件 </h1>

<div _ngcontent-sfu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section95081927164310">适用场景<i class="anchor-icon anchor-icon-link" anchorid="section95081927164310" tips="复制节点链接"></i></h2>          <p>朗读控件应用广泛，例如在用户不方便或者无法查看屏幕文字的时候，为用户朗读新闻，提供资讯。</p>     <p>本章节将向您介绍如何使用朗读组件，效果如下图所示。</p>     <p><span><img originheight="531" originwidth="1022" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114225.97667268179409142041055916895789:50001231000000:2800:EA718B7457E9A148FDB8A6377AD7D8A3795AD8A42BCE2AB27C35C787A921DB28.png" width="920" height="478.00391389432485"></span></p>    </div>    <div class="tiledSection">     <h2 id="section1070612236242">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1070612236242" tips="复制节点链接"></i></h2>          <p>以下仅列出demo中调用的部分主要接口，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="49.87%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50.129999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section173751154134515" target="_blank">init</a>(context: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-basecontext" target="_blank">common.BaseContext</a>, readParams: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section6129163245310" target="_blank">ReaderParam</a>): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>初始化TextReader。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section143611912403" target="_blank">start</a>(readInfoList: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section129918404172" target="_blank">ReadInfo</a>[], articleId?: string): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>启动TextReader。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p>on(type: string, callback: function): void</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>注册所有事件回调，具体事件类型详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api" target="_blank">API参考</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section6129163245310" target="_blank">ReaderParam</a>(isVoiceBrandVisible: boolean, businessBrandInfo?: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/speech-textreader-api#section472059101210" target="_blank">BusinessBrandInfo</a>, isFastForward?: boolean, keepBackgroundRunning?: boolean, online?: number)</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>朗读参数。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1418318341804">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1418318341804" tips="复制节点链接"></i></h2>          <ol>      <li><span>首先从项目根目录进入/src/main/ets/entryability/EntryAbility.ets文件，将WindowManager添加至工程。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">WindowManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SpeechKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）在onWindowStageCreate(windowStage: window.WindowStage)生命周期方法中，添加setWindowStage方法设置窗口管理器。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onWindowStageCreate'</span>);</li><li>  <span class="hljs-title class_">WindowManager</span>.<span class="hljs-title function_">setWindowStage</span>(windowStage);</li><li>  </li><li>  windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to load the content. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in loading the content. Data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>.`</span> );</li><li>  });</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在onCreate()生命周期方法中，设置应用的颜色模式，使控件颜色模式跟应用的颜色模式保持一致。</span>       <p></p>       <ul>        <li>如果应用想要跟随系统切换深浅色模式，请将颜色模式设置为COLOR_MODE_NOT_SET。</li>        <li>如果应用想要主动配置颜色模式，请将颜色模式设置为COLOR_MODE_LIGHT（浅色）或者COLOR_MODE_DARK（深色）。</li>       </ul>       <p>下面以自动跟随系统切换为例。</p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>从项目根目录进入/src/main/ets/pages/Index.ets文件，在使用朗读控件前，将实现朗读控件和其他相关的类添加至工程。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextReader</span>, <span class="hljs-title class_">TextReaderIcon</span>, <span class="hljs-title class_">ReadStateCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SpeechKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>简单配置页面的布局，加入听筒图标，并且设置onClick点击事件。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 播放状态</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">readState</span>: <span class="hljs-title class_">ReadStateCode</span> = <span class="hljs-title class_">ReadStateCode</span>.<span class="hljs-property">WAITING</span>;</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextReaderIcon</span>({ <span class="hljs-attr">readState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-comment">// 设置点击事件</span></li><li>            <span class="hljs-comment">// ...</span></li><li>        })</li><li>    }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>初始化朗读控件。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 用于显示当前页的按钮状态</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">isInit</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment">* 待加载的文章</span></li><li><span class="hljs-comment">*/</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">readInfoList</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span>[] = [];</li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">selectedReadInfo</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>[<span class="hljs-number">0</span>];</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 加载数据</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">readInfoList</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span>[] = [{</li><li>    <span class="hljs-attr">id</span>: <span class="hljs-string">'001'</span>,</li><li>    <span class="hljs-attr">title</span>: {</li><li>      <span class="hljs-attr">text</span>:<span class="hljs-string">'水调歌头.明月几时有'</span>,</li><li>      <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">true</span></li><li>    },</li><li>    <span class="hljs-attr">author</span>:{</li><li>      <span class="hljs-attr">text</span>:<span class="hljs-string">'宋.苏轼'</span>,</li><li>      <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">true</span></li><li>    },</li><li>    <span class="hljs-attr">date</span>: {</li><li>      <span class="hljs-attr">text</span>:<span class="hljs-string">'2024/01/01'</span>,</li><li>      <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">false</span></li><li>    },</li><li>    <span class="hljs-attr">bodyInfo</span>: <span class="hljs-string">'明月几时有？把酒问青天。'</span></li><li>  }];</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span> = readInfoList;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>[<span class="hljs-number">0</span>];</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 初始化</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">readerParam</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReaderParam</span> = {</li><li>    <span class="hljs-attr">isVoiceBrandVisible</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">businessBrandInfo</span>: {</li><li>      <span class="hljs-attr">panelName</span>: <span class="hljs-string">'小艺朗读'</span>,</li><li>      <span class="hljs-attr">panelIcon</span>: $r(<span class="hljs-string">'app.media.startIcon'</span>)</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()</li><li>    <span class="hljs-keyword">if</span> (context) {</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">init</span>(context, readerParam);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isInit</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setActionListener</span>();</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`TextReader failed to init. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li>onStateChanged = <span class="hljs-function">(<span class="hljs-params">state: TextReader.ReadState</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span>?.<span class="hljs-property">id</span> === state.<span class="hljs-property">id</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> = state.<span class="hljs-property">state</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> = <span class="hljs-title class_">ReadStateCode</span>.<span class="hljs-property">WAITING</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 设置操作监听</span></li><li><span class="hljs-title function_">setActionListener</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stateChange'</span>, <span class="hljs-function">(<span class="hljs-params">state: TextReader.ReadState</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onStateChanged</span>(state);</li><li>  });</li><li>  <span class="hljs-comment">// 在列表页无更多内容时，会显示加载失败，需要设置requestMore监听，调用loadMore函数以获得正确的显示信息。</span></li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'requestMore'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">loadMore</span>([], <span class="hljs-literal">true</span>);</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-comment">// 注销监听，根据业务情况在合适的时机调用</span></li><li><span class="hljs-title function_">releaseActionListener</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'stateChange'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'requestMore'</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）在setActionListener方法中设置更多监听，在用户与控件进行交互时触发回调通知开发者。注销监听，监听结束后进行释放。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置监听</span></li><li><span class="hljs-title function_">setActionListener</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'setArticle'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>) =&gt; { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`setArticle <span class="hljs-subst">${id}</span>`</span>) });</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'clickArticle'</span>, <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> {<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onClickArticle <span class="hljs-subst">${id}</span>`</span>) });</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'clickAuthor'</span>, <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onClickAuthor <span class="hljs-subst">${id}</span>`</span>) });</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'clickNotification'</span>,  <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onClickNotification <span class="hljs-subst">${id}</span>`</span>) });</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'showPanel'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onShowPanel`</span>) });</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'hidePanel'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onHidePanel`</span>) });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li><span class="hljs-comment">// 注销监听</span></li><li><span class="hljs-title function_">releaseActionListener</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'setArticle'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'clickArticle'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'clickAuthor'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'clickNotification'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'showPanel'</span>);</li><li>  <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'hidePanel'</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>启动朗读控件。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">TextReaderIcon</span>({ <span class="hljs-attr">readState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> })</li><li>      <span class="hljs-comment">// ...</span></li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-keyword">await</span> <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">start</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span>?.<span class="hljs-property">id</span>);</li><li>        } <span class="hljs-keyword">catch</span> (err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`TextReader failed to start. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        }</li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li id="li56192364816"><span>（可选）若要配置长时任务，需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file" target="_blank">module.json5配置文件</a>中添加ohos.permission.KEEP_BACKGROUND_RUNNING权限，并且加入backgroundModes选项，然后在readerParam中将keepBackgroundRunning配置为true，确保朗读控件后台播报正常。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.KEEP_BACKGROUND_RUNNING"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>          <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>            <span class="hljs-string">"FormAbility"</span></li><li>          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>          <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inuse"</span></li><li>        <span class="hljs-punctuation">}</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-attr">"backgroundModes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"audioPlayback"</span></li><li>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li><li>
</li><li><span class="hljs-comment">// Index.ets</span></li><li>async init() <span class="hljs-punctuation">{</span></li><li>  const readerParam<span class="hljs-punctuation">:</span> TextReader.ReaderParam = <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    keepBackgroundRunning<span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <p></p></li>      <li><span>（可选）若要在控件使用功能时切换音色，需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file" target="_blank">module.json5配置文件</a>中添加ohos.permission.INTERNET和ohos.permission.GET_NETWORK_INFO权限，确保朗读控件可以正常切换音色。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.INTERNET"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:reason"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.GET_NETWORK_INFO"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:reason"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section22701210512">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section22701210512" tips="复制节点链接"></i></h2>          <p>EntryAbility.ets</p>     <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">ConfigurationConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">WindowManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SpeechKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onCreate'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onDestroy'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onWindowStageCreate'</span>);</li><li>    <span class="hljs-title class_">WindowManager</span>.<span class="hljs-title function_">setWindowStage</span>(windowStage);</li><li>
</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to load the content. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in loading the content. Data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>.`</span> );</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onWindowStageDestroy'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onForeground'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Ability onBackground'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>Index.ets</p>     <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextReader</span>, <span class="hljs-title class_">TextReaderIcon</span>, <span class="hljs-title class_">ReadStateCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SpeechKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 待加载的文章</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">readInfoList</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span>[] = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectedReadInfo</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>[<span class="hljs-number">0</span>];</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 播放状态</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">readState</span>: <span class="hljs-title class_">ReadStateCode</span> = <span class="hljs-title class_">ReadStateCode</span>.<span class="hljs-property">WAITING</span>;</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 用于显示当前页的按钮状态</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isInit</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * 加载数据</span></li><li><span class="hljs-comment">     */</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">readInfoList</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReadInfo</span>[] = [{</li><li>      <span class="hljs-attr">id</span>: <span class="hljs-string">'001'</span>,</li><li>      <span class="hljs-attr">title</span>: {</li><li>        <span class="hljs-attr">text</span>:<span class="hljs-string">'水调歌头.明月几时有'</span>,</li><li>        <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">true</span></li><li>      },</li><li>      <span class="hljs-attr">author</span>:{</li><li>        <span class="hljs-attr">text</span>:<span class="hljs-string">'宋.苏轼'</span>,</li><li>        <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">true</span></li><li>      },</li><li>      <span class="hljs-attr">date</span>: {</li><li>        <span class="hljs-attr">text</span>:<span class="hljs-string">'2024/01/01'</span>,</li><li>        <span class="hljs-attr">isClickable</span>:<span class="hljs-literal">false</span></li><li>      },</li><li>      <span class="hljs-attr">bodyInfo</span>: <span class="hljs-string">'明月几时有？把酒问青天。'</span></li><li>    }];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span> = readInfoList;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>[<span class="hljs-number">0</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 初始化</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">readerParam</span>: <span class="hljs-title class_">TextReader</span>.<span class="hljs-property">ReaderParam</span> = {</li><li>      <span class="hljs-attr">isVoiceBrandVisible</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">businessBrandInfo</span>: {</li><li>        <span class="hljs-attr">panelName</span>: <span class="hljs-string">'小艺朗读'</span>,</li><li>        <span class="hljs-attr">panelIcon</span>: $r(<span class="hljs-string">'app.media.startIcon'</span>)</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()</li><li>      <span class="hljs-keyword">if</span> (context) {</li><li>        <span class="hljs-keyword">await</span> <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">init</span>(context, readerParam);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isInit</span> = <span class="hljs-literal">true</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setActionListener</span>();</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`TextReader failed to init. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 设置操作监听</span></li><li>  <span class="hljs-title function_">setActionListener</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stateChange'</span>, <span class="hljs-function">(<span class="hljs-params">state: TextReader.ReadState</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onStateChanged</span>(state);</li><li>    });</li><li>
</li><li>    <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'requestMore'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">loadMore</span>([], <span class="hljs-literal">true</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  onStateChanged = <span class="hljs-function">(<span class="hljs-params">state: TextReader.ReadState</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span>?.<span class="hljs-property">id</span> === state.<span class="hljs-property">id</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> = state.<span class="hljs-property">state</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> = <span class="hljs-title class_">ReadStateCode</span>.<span class="hljs-property">WAITING</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextReaderIcon</span>({ <span class="hljs-attr">readState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">readState</span> })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">await</span> <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">start</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">readInfoList</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedReadInfo</span>?.<span class="hljs-property">id</span>);</li><li>          } <span class="hljs-keyword">catch</span> (err) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`TextReader failed to start. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section18730101353813">2in1适配步骤<i class="anchor-icon anchor-icon-link" anchorid="section18730101353813" tips="复制节点链接"></i></h2>          <p>2in1设备除了适配<a href="/consumer/cn/doc/harmonyos-guides/speech-textreader-guide#section1418318341804">开发步骤</a>，还需执行以下步骤。如果开发者按照上述开发步骤来适配2in1，将会出现无法拉起播放面板的情况。</p>     <ol>      <li><span>在/src/main/ets/entryability下新建一个ability，用来承载2in1主窗，导入相关依赖。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextReader</span>, <span class="hljs-title class_">WindowManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.SpeechKit'</span>;</li><li><span class="hljs-keyword">import</span> { commonEventManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在新ability中声明一个应用全局的状态变量isReadyToStart，并且通过AppStorage管理此状态变量。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">link</span>: <span class="hljs-title class_">SubscribedAbstractProperty</span>&lt;<span class="hljs-built_in">boolean</span>&gt;= <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">link</span>(<span class="hljs-string">'isReadyToStart'</span>);</li></ol></pre></div></div>       <p></p></li>      <li><span>在Index.ets的aboutToAppear生命周期方法中，创建全局的状态变量isReadyToStart。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'isReadyToStart'</span>, <span class="hljs-literal">false</span>);</li><li>  <span class="hljs-comment">// ...其他配置</span></li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>配置WindowStage。说明：从6.0.0(20)开始使用以下逻辑实现。对于5.1.1(19)及之前版本，使用getContext(this)接口实现。</span>       <p></p>       <ul>        <li>在新ability的onWindowStageCreate生命周期方法中，发送onLoadSubAbility事件。</li>        <li>通过WindowManager.setWindowStage(windowStage)来设置新ability的windowStage。</li>        <li>在onWindowStageCreate中将isReadyToStart设为true。</li>       </ul>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// Main window is created, set main page for this ability</span></li><li>  <span class="hljs-title class_">WindowManager</span>.<span class="hljs-title function_">setWindowStage</span>(windowStage)</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">eventData</span>: emitter.<span class="hljs-property">EventData</span> = {</li><li>    <span class="hljs-attr">data</span>: {</li><li>      <span class="hljs-string">'state'</span>: <span class="hljs-string">'publish'</span></li><li>    }</li><li>  }</li><li>  emitter.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"onLoadSubAbility"</span>, eventData);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">link</span>.<span class="hljs-title function_">set</span>(<span class="hljs-literal">true</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在新ability的onWindowStageDestroy生命周期方法中，将isReadyToStart设为false，同时隐藏面板并停止播放。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">hidePanel</span>();</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">stop</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">link</span>.<span class="hljs-title function_">set</span>(<span class="hljs-literal">false</span>);</li><li>  }<span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onWindowStageDestroy fail , msg: <span class="hljs-subst">${e}</span>`</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在entryability中，onCreate方法需要用eventHub设置'onShowPanel'回调，用来创造新的ability；onShowPanel回调中，首先构造want，然后通过context.startAbility接口创建新的ability。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li>
</li><li>
</li><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...其他配置</span></li><li>  <span class="hljs-keyword">let</span> eventHub = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>;</li><li>  eventHub.<span class="hljs-title function_">on</span>(<span class="hljs-string">'onShowPanel'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onShowPanel</span>);</li><li>}</li><li>
</li><li>onShowPanel = <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>    <span class="hljs-attr">deviceId</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.speechkit'</span>, <span class="hljs-comment">// 需替换成实际应用包名</span></li><li>    <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'SubAbility'</span>,</li><li>    <span class="hljs-attr">parameters</span>: {</li><li>      <span class="hljs-attr">info</span>: <span class="hljs-string">'From EntryAbility onShowPanel'</span></li><li>    }</li><li>  }</li><li>  context?.<span class="hljs-title function_">startAbility</span>(want).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in starting ability'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to start ability. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  })</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在调用start之前根据设备类型进行判断，如果是2in1需要首先发送'onShowPanel'事件构造ability。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { deviceInfo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">if</span> (deviceInfo.<span class="hljs-property">deviceType</span> === <span class="hljs-string">'2in1'</span>) {</li><li>  <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li>  context?.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'onShowPanel'</span>);</li><li>}</li><li><span class="hljs-title class_">TextReader</span>.<span class="hljs-title function_">showPanel</span>();</li></ol></pre></div></div>       <p></p></li>      <li><span>在module.json5中添加ability配置项，max和min的值需要保持一致，固定窗口的大小。</span>       <p></p>       <div _ngcontent-sfu-c106="" class="highlight-div"><div _ngcontent-sfu-c106="" class="highlight-div-header"><div _ngcontent-sfu-c106="" class="highlight-div-header-left"><div _ngcontent-sfu-c106="" class="handle-button expand-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfu-c106="" class="highlight-div-header-right"><div _ngcontent-sfu-c106="" class="handle-button ai-button"></div><div _ngcontent-sfu-c106="" class="handle-button line-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfu-c106="" class="handle-button theme-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfu-c106="" class="handle-button copy-button"><div _ngcontent-sfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"name"</span>: <span class="hljs-string">"SubAbility"</span>, <span class="hljs-comment">// UIAbility组件的名称</span></li><li>  <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/SubAbility.ets"</span>, <span class="hljs-comment">// UIAbility组件的代码路径</span></li><li>  <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:SubAbility_desc"</span>, <span class="hljs-comment">// UIAbility组件的描述信息</span></li><li>  <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>, <span class="hljs-comment">// UIAbility组件的图标</span></li><li>  <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:EntryAbility_label"</span>, <span class="hljs-comment">// UIAbility组件的标签</span></li><li>  <span class="hljs-string">"startWindowIcon"</span>: <span class="hljs-string">"$media:icon"</span>, <span class="hljs-comment">// UIAbility组件启动页面图标资源文件的索引</span></li><li>  <span class="hljs-string">"startWindowBackground"</span>: <span class="hljs-string">"$color:start_window_background"</span>, <span class="hljs-comment">// UIAbility组件启动页面背景颜色资源文件的索引</span></li><li>  <span class="hljs-string">"supportWindowMode"</span>: [<span class="hljs-string">'floating'</span>], <span class="hljs-comment">// 窗口支持悬浮窗显示</span></li><li>  <span class="hljs-string">"maxWindowWidth"</span>: <span class="hljs-number">1158</span>,  <span class="hljs-comment">// 最大窗口宽度</span></li><li>  <span class="hljs-string">"minWindowWidth"</span>: <span class="hljs-number">1158</span>,  <span class="hljs-comment">// 最小窗口宽度</span></li><li>  <span class="hljs-string">"maxWindowHeight"</span>: <span class="hljs-number">772</span>,  <span class="hljs-comment">// 最大窗口高度</span></li><li>  <span class="hljs-string">"minWindowHeight"</span>: <span class="hljs-number">772</span>,  <span class="hljs-comment">// 最小窗口高度</span></li><li> }</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>