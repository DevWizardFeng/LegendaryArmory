<h1 _ngcontent-icq-c119="" class="doc-title ng-star-inserted" title="本地媒体会话概述"> 本地媒体会话概述 </h1>

<div _ngcontent-icq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="交互过程">交互过程<i class="anchor-icon anchor-icon-link" anchorid="交互过程" tips="复制节点链接"></i></h2>          <p>本地媒体会话的数据源均在设备本地，交互过程如图所示。</p>     <p><span><img originheight="983" originwidth="1301" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114422.58992759663030064864315719713311:50001231000000:2800:53C16474D1029B85B15B806D171FA5AEC05067BAF702177DF4165DFCB42662DB.png" width="920" height="695.1268255188317"></span></p>     <p>此过程中涉及两大角色，媒体会话提供方和媒体会话控制方。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>媒体会话控制方为系统应用，三方应用可以成为媒体会话提供方。</p>      </div></div></div>     <p>本地媒体会话中，媒体会话提供方通过媒体会话管理器和媒体会话控制方进行信息交互：</p>     <ol>      <li>       <p>媒体会话提供方通过AVSessionManager创建AVSession对象。</p></li>      <li>       <p>媒体会话提供方通过AVSession对象，设置会话元数据（媒体ID、标题、媒体时长等）、会话播放属性（播放状态、播放倍速、播放位置等）等。</p></li>      <li>       <p>媒体会话控制方通过AVSessionManager创建AVSessionController对象。</p></li>      <li>       <p>媒体会话控制方通过AVSessionController对象可以监听对应会话元数据变化、播放属性变化等。</p></li>      <li>       <p>媒体会话控制方通过AVSessionController对象还可以向媒体会话发送控制命令。</p></li>      <li>       <p>媒体会话提供方通过AVSession对象可以监听来自媒体会话控制方的控制命令，例如：“play”播放、“playNext”播放下一首、“fastForward”快进、 “setSpeed”设置播放倍速等。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="媒体会话管理器">媒体会话管理器<i class="anchor-icon anchor-icon-link" anchorid="媒体会话管理器" tips="复制节点链接"></i></h2>          <p>媒体会话管理器（AVSessionManager），提供了管理AVSession的能力，可以创建AVSession、创建AVSessionController、发送系统控制事件，也支持对AVSession的状态进行监听。</p>     <p>实际上，AVSessionManager与AVSession、AVSessionController对象不同，并不是一个具体的对象，它是媒体会话的根命名域。在实际编程过程中，可以通过如下方式引入：</p>     <div _ngcontent-icq-c106="" class="highlight-div"><div _ngcontent-icq-c106="" class="highlight-div-header"><div _ngcontent-icq-c106="" class="highlight-div-header-left"><div _ngcontent-icq-c106="" class="handle-button expand-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icq-c106="" class="highlight-div-header-right"><div _ngcontent-icq-c106="" class="handle-button ai-button"></div><div _ngcontent-icq-c106="" class="handle-button line-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icq-c106="" class="handle-button theme-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icq-c106="" class="handle-button copy-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li></ol></pre></div></div>     <p>根命名域中的所有方法都可以作为AVSessionManager的方法。</p>     <p>例如，媒体会话提供方通过AVSessionManager创建媒体会话的示例如下所示：</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>以下示例代码仅展示创建AVSession对象的接口调用，应用在真正使用时，需要确保AVSession对象实例在应用后台播放业务活动期间一直存在，避免被系统回收、释放，导致后台发声时被系统管控。</p>      </div></div></div>     <div _ngcontent-icq-c106="" class="highlight-div"><div _ngcontent-icq-c106="" class="highlight-div-header"><div _ngcontent-icq-c106="" class="highlight-div-header-left"><div _ngcontent-icq-c106="" class="handle-button expand-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icq-c106="" class="highlight-div-header-right"><div _ngcontent-icq-c106="" class="handle-button ai-button"></div><div _ngcontent-icq-c106="" class="handle-button line-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icq-c106="" class="handle-button theme-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icq-c106="" class="handle-button copy-button"><div _ngcontent-icq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { avSession <span class="hljs-keyword">as</span> <span class="hljs-title class_">AVSessionManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AVSessionKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-comment">// 创建session。</span></li><li>          <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>;</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-property">AVSession</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AVSessionManager</span>.<span class="hljs-title function_">createAVSession</span>(context, <span class="hljs-string">'SESSION_NAME'</span>, <span class="hljs-string">'audio'</span>);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`session create done : sessionId : <span class="hljs-subst">${session.sessionId}</span>`</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>更多关于AVSessionManager的方法，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-avsession" target="_blank">API文档</a>。</p>    </div>   </div>   <div></div></div>