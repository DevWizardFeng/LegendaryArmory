<h1 _ngcontent-mdf-c119="" class="doc-title ng-star-inserted" title="构建渲染节点"> 构建渲染节点 </h1>

<div _ngcontent-mdf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 20开始，ArkUI开发框架针对NDK接口，提供了直接构建渲染节点的能力，包括节点树操作、属性设置及含动画的自定义绘制。开发者通过调用渲染节点相关能力，可以绕过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#registernodecustomevent" target="_blank">registerNodeCustomEvent</a>的测量布局过程，直接对节点进行绘制并调整其大小和位置。</p>    <ul>     <li>      <p><strong>渲染节点树操作相关的能力</strong> ，例如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-render-h#oh_arkui_rendernodeutils_addrendernode" target="_blank">OH_ArkUI_RenderNodeUtils_AddRenderNode</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-render-h#oh_arkui_rendernodeutils_addchild" target="_blank">OH_ArkUI_RenderNodeUtils_AddChild</a>等接口用于编辑渲染节点树的结构。仅类型为ARKUI_NODE_CUSTOM且无其他子节点的自定义节点（加超链接到nativeNode）能够挂载渲染节点，且最多挂载一个渲染节点。即渲染节点以子树形式挂载在类型为ARKUI_NODE_CUSTOM的叶子自定义节点上。</p></li>     <li>      <p><strong>渲染节点属性设置的能力</strong> ，详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-render-h#函数" target="_blank">函数</a>，查看当前渲染节点支持的属性能力。</p></li>     <li>      <p><strong>自定义绘制能力</strong>，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-render-h#oh_arkui_rendernodeutils_setcontentmodifierondraw" target="_blank">OH_ArkUI_RenderNodeUtils_SetContentModifierOnDraw</a>及其相关接口，同时可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-render-h#oh_arkui_rendernodeutils_setfloatpropertyvalue" target="_blank">OH_ArkUI_RenderNodeUtils_SetFloatPropertyValue</a>这一类绑定在ContentModifier的接口对自定义绘制的内容进行动态修改。</p></li>    </ul>    <div class="tiledSection">     <h2 id="节点挂载与基础属性设置">节点挂载与基础属性设置<i class="anchor-icon anchor-icon-link" anchorid="节点挂载与基础属性设置" tips="复制节点链接"></i></h2>          <p>以下示例创建了一个渲染节点，并进行了基础的节点挂载和属性设置操作。</p>     <ol>      <li>       <p>按照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面</a>创建前置工程。</p></li>      <li>       <p>创建渲染节点能力对象。</p>       <div _ngcontent-mdf-c106="" class="highlight-div"><div _ngcontent-mdf-c106="" class="highlight-div-header"><div _ngcontent-mdf-c106="" class="highlight-div-header-left"><div _ngcontent-mdf-c106="" class="handle-button expand-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mdf-c106="" class="highlight-div-header-right"><div _ngcontent-mdf-c106="" class="handle-button ai-button"></div><div _ngcontent-mdf-c106="" class="handle-button line-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mdf-c106="" class="handle-button theme-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mdf-c106="" class="handle-button copy-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mdf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NativeEntry.cpp</span></li><li><span class="hljs-comment">// 自定义容器组件示例。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_animate.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_render.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/alltypes.h&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_interface.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_color.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_path.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_pen.h&gt;</span></span></li><li>
</li><li>ArkUI_NodeHandle <span class="hljs-title function_">testRenderNode</span><span class="hljs-params">(ArkUI_NativeNodeAPI_1 *nodeAPI)</span> {</li><li>    <span class="hljs-comment">// 创建NDK原有容器逻辑。</span></li><li>    ArkUI_NodeHandle scroll = nodeAPI-&gt;createNode(ARKUI_NODE_SCROLL);</li><li>    ArkUI_NumberValue valueWidth[] = {<span class="hljs-number">400</span>};</li><li>    ArkUI_AttributeItem itemWidth = {valueWidth, <span class="hljs-keyword">sizeof</span>(valueWidth) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_WIDTH, &amp;itemWidth);</li><li>    ArkUI_NumberValue valueHeight[] = {<span class="hljs-number">600</span>};</li><li>    ArkUI_AttributeItem itemHeight = {valueHeight, <span class="hljs-keyword">sizeof</span>(valueHeight) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_HEIGHT, &amp;itemHeight);</li><li>    ArkUI_NodeHandle column = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>    nodeAPI-&gt;setAttribute(column, NODE_WIDTH, &amp;itemWidth);</li><li>    nodeAPI-&gt;setAttribute(column, NODE_HEIGHT, &amp;itemHeight);</li><li>    ArkUI_NodeHandle text = nodeAPI-&gt;createNode(ARKUI_NODE_TEXT);</li><li>    ArkUI_AttributeItem content = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"黄色背景是C-API页面"</span>};</li><li>    nodeAPI-&gt;setAttribute(text, NODE_TEXT_CONTENT, &amp;content);</li><li>    nodeAPI-&gt;addChild(column, text);</li><li>
</li><li>    <span class="hljs-comment">// 创建RenderNode容器 -- NDK侧的Custom组件。</span></li><li>    ArkUI_NodeHandle Custom = nodeAPI-&gt;createNode(ARKUI_NODE_CUSTOM);</li><li>    valueWidth[<span class="hljs-number">0</span>].f32 = <span class="hljs-number">400</span>;</li><li>    nodeAPI-&gt;setAttribute(Custom, NODE_WIDTH, &amp;itemWidth);</li><li>    nodeAPI-&gt;setAttribute(Custom, NODE_HEIGHT, &amp;itemWidth);</li><li>    nodeAPI-&gt;addChild(column, Custom);</li><li>
</li><li>    <span class="hljs-comment">// 节点操作类接口 创建 - 挂载 - 构建树。</span></li><li>    <span class="hljs-comment">// 创建部分。</span></li><li>    <span class="hljs-keyword">auto</span> renderRootNode = OH_ArkUI_RenderNodeUtils_CreateNode();</li><li>    <span class="hljs-keyword">auto</span> firstChildRenderNode = OH_ArkUI_RenderNodeUtils_CreateNode();</li><li>    <span class="hljs-keyword">auto</span> secondChildRenderNode = OH_ArkUI_RenderNodeUtils_CreateNode();</li><li>    <span class="hljs-keyword">auto</span> thirdChildRenderNode = OH_ArkUI_RenderNodeUtils_CreateNode();</li><li>
</li><li>    <span class="hljs-keyword">auto</span> result = OH_ArkUI_RenderNodeUtils_AddRenderNode(Custom, renderRootNode);</li><li>    <span class="hljs-keyword">if</span> (result != ARKUI_ERROR_CODE_NO_ERROR) {</li><li>        <span class="hljs-comment">// 通过错误码判断根节点是否挂载成功。</span></li><li>        <span class="hljs-keyword">return</span> scroll;</li><li>    }</li><li>    </li><li>    OH_ArkUI_RenderNodeUtils_AddChild(renderRootNode, firstChildRenderNode);</li><li>    OH_ArkUI_RenderNodeUtils_AddChild(renderRootNode, secondChildRenderNode);</li><li>    OH_ArkUI_RenderNodeUtils_AddChild(renderRootNode, thirdChildRenderNode);</li><li>    </li><li>    <span class="hljs-comment">// 设置节点尺寸与位置。</span></li><li>    OH_ArkUI_RenderNodeUtils_SetSize(renderRootNode, <span class="hljs-number">500</span>, <span class="hljs-number">500</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetSize(firstChildRenderNode, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetSize(secondChildRenderNode, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetSize(thirdChildRenderNode, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>);</li><li>
</li><li>    OH_ArkUI_RenderNodeUtils_SetPosition(renderRootNode, <span class="hljs-number">300</span>, <span class="hljs-number">100</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetPosition(firstChildRenderNode, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetPosition(secondChildRenderNode, <span class="hljs-number">140</span>, <span class="hljs-number">140</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetPosition(thirdChildRenderNode, <span class="hljs-number">280</span>, <span class="hljs-number">280</span>);</li><li>    </li><li>    <span class="hljs-comment">// 设置颜色，方便通过颜色观察到节点的显示范围。</span></li><li>    OH_ArkUI_RenderNodeUtils_SetBackgroundColor(renderRootNode, <span class="hljs-number">0xFFFFFFFF</span>);</li><li>    OH_ArkUI_RenderNodeUtils_SetBackgroundColor(firstChildRenderNode, <span class="hljs-number">0xFFFF0000</span>); <span class="hljs-comment">// R</span></li><li>    OH_ArkUI_RenderNodeUtils_SetBackgroundColor(secondChildRenderNode, <span class="hljs-number">0xFF00FF00</span>); <span class="hljs-comment">// G</span></li><li>    OH_ArkUI_RenderNodeUtils_SetBackgroundColor(thirdChildRenderNode, <span class="hljs-number">0xFF0000FF</span>); <span class="hljs-comment">// B</span></li><li>    </li><li>    <span class="hljs-comment">// 简单的属性设置示例。</span></li><li>    OH_ArkUI_RenderNodeUtils_SetRotation(secondChildRenderNode, <span class="hljs-number">45</span>, <span class="hljs-number">45</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// xy轴旋转45度，z轴旋转0度</span></li><li>
</li><li>    <span class="hljs-comment">// 边框属性实例。</span></li><li>    <span class="hljs-keyword">auto</span> styleOption = OH_ArkUI_RenderNodeUtils_CreateNodeBorderStyleOption();</li><li>    OH_ArkUI_RenderNodeUtils_SetNodeBorderStyleOptionEdgeStyle(styleOption, ArkUI_BorderStyle::ARKUI_BORDER_STYLE_SOLID,</li><li>                                                               ArkUI_EdgeDirection::ARKUI_EDGE_DIRECTION_ALL);</li><li>    OH_ArkUI_RenderNodeUtils_SetBorderStyle(firstChildRenderNode, styleOption);</li><li>    <span class="hljs-comment">// 结构体使用完成后，销毁释放内存。</span></li><li>    OH_ArkUI_RenderNodeUtils_DisposeNodeBorderStyleOption(styleOption);</li><li>    styleOption = nullptr;</li><li>    </li><li>    <span class="hljs-keyword">auto</span> widthOption = OH_ArkUI_RenderNodeUtils_CreateNodeBorderWidthOption();</li><li>    OH_ArkUI_RenderNodeUtils_SetNodeBorderWidthOptionEdgeWidth(widthOption, <span class="hljs-number">5</span>,</li><li>                                                               ArkUI_EdgeDirection::ARKUI_EDGE_DIRECTION_ALL);</li><li>    OH_ArkUI_RenderNodeUtils_SetBorderWidth(firstChildRenderNode, widthOption);</li><li>    <span class="hljs-comment">// 结构体使用完成后，销毁释放内存。</span></li><li>    OH_ArkUI_RenderNodeUtils_DisposeNodeBorderWidthOption(widthOption);</li><li>    widthOption = nullptr;</li><li>
</li><li>    <span class="hljs-keyword">auto</span> colorOption = OH_ArkUI_RenderNodeUtils_CreateNodeBorderColorOption();</li><li>    OH_ArkUI_RenderNodeUtils_SetNodeBorderColorOptionEdgeColor(colorOption, <span class="hljs-number">0xFF000000</span>,</li><li>                                                               ArkUI_EdgeDirection::ARKUI_EDGE_DIRECTION_ALL);</li><li>    result = OH_ArkUI_RenderNodeUtils_SetBorderColor(firstChildRenderNode, colorOption);</li><li>    <span class="hljs-comment">// 结构体使用完成后，销毁释放内存。</span></li><li>    OH_ArkUI_RenderNodeUtils_DisposeNodeBorderColorOption(colorOption);</li><li>    colorOption = nullptr;</li><li>
</li><li>    nodeAPI-&gt;addChild(scroll, column);</li><li>    <span class="hljs-keyword">return</span> scroll;</li><li>}</li><li>
</li><li> napi_value <span class="hljs-title function_">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {nullptr};</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>    <span class="hljs-keyword">auto</span> *nodeAPI = reinterpret_cast&lt;ArkUI_NativeNodeAPI_1 *&gt;(</li><li>        OH_ArkUI_QueryModuleInterfaceByName(ARKUI_NATIVE_NODE, <span class="hljs-string">"ArkUI_NativeNodeAPI_1"</span>));</li><li>    <span class="hljs-keyword">if</span> (nodeAPI != nullptr) {</li><li>         ArkUI_NodeHandle testNode;</li><li>         testNode = testRenderNode(nodeAPI);</li><li>    }</li><li>
</li><li>    NativeEntry::GetInstance()-&gt;SetRootNode(testNode);</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="自定义绘制及动画">自定义绘制及动画<i class="anchor-icon anchor-icon-link" anchorid="自定义绘制及动画" tips="复制节点链接"></i></h2>          <p>以下示例创建了一个渲染节点，调用自定义绘制能力并附加动画功能。</p>     <ol>      <li>       <p>按照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面</a>创建前置工程。</p></li>      <li>       <p>创建渲染节点能力对象。</p>       <div _ngcontent-mdf-c106="" class="highlight-div"><div _ngcontent-mdf-c106="" class="highlight-div-header"><div _ngcontent-mdf-c106="" class="highlight-div-header-left"><div _ngcontent-mdf-c106="" class="handle-button expand-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mdf-c106="" class="highlight-div-header-right"><div _ngcontent-mdf-c106="" class="handle-button ai-button"></div><div _ngcontent-mdf-c106="" class="handle-button line-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mdf-c106="" class="handle-button theme-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mdf-c106="" class="handle-button copy-button"><div _ngcontent-mdf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mdf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NativeEntry.cpp</span></li><li><span class="hljs-comment">// 自定义容器组件示例。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_animate.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_render.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/alltypes.h&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_interface.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_color.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_path.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_pen.h&gt;</span></span></li><li>
</li><li>ArkUI_NodeHandle <span class="hljs-title function_">testRenderNode2</span><span class="hljs-params">(ArkUI_NativeNodeAPI_1 *nodeAPI, ArkUI_ContextHandle context)</span> {</li><li>
</li><li>    ArkUI_NodeHandle scroll = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>    ArkUI_NumberValue valueWidth[] = {<span class="hljs-number">400</span>};</li><li>    ArkUI_AttributeItem itemWidth = {valueWidth, <span class="hljs-keyword">sizeof</span>(valueWidth) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_WIDTH, &amp;itemWidth);</li><li>    ArkUI_NumberValue valueHeight[] = {<span class="hljs-number">600</span>};</li><li>    ArkUI_AttributeItem itemHeight = {valueHeight, <span class="hljs-keyword">sizeof</span>(valueHeight) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_HEIGHT, &amp;itemHeight);</li><li>    valueHeight[<span class="hljs-number">0</span>].u32 = <span class="hljs-number">0xff00F100</span>;</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_BACKGROUND_COLOR, &amp;itemHeight);</li><li>
</li><li>    ArkUI_NodeHandle column = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>    ArkUI_NodeHandle text = nodeAPI-&gt;createNode(ARKUI_NODE_TEXT);</li><li>    ArkUI_AttributeItem content = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"这是C-API页面"</span>};</li><li>
</li><li>    nodeAPI-&gt;setAttribute(text, NODE_TEXT_CONTENT, &amp;content);</li><li>
</li><li>    ArkUI_NodeHandle Custom = nodeAPI-&gt;createNode(ARKUI_NODE_CUSTOM);</li><li>    <span class="hljs-keyword">auto</span> renderNode = OH_ArkUI_RenderNodeUtils_CreateNode();</li><li>    OH_ArkUI_RenderNodeUtils_AddRenderNode(Custom, renderNode);</li><li>    OH_ArkUI_RenderNodeUtils_SetSize(renderNode, <span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);</li><li>
</li><li>    <span class="hljs-comment">// Property的作用是触发set更新，同步更新modifier的Draw方法。</span></li><li>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimatableUserData</span> {</span></li><li>        ArkUI_FloatAnimatablePropertyHandle width;</li><li>        ArkUI_FloatAnimatablePropertyHandle height;</li><li>        ArkUI_Vector2AnimatablePropertyHandle v2;</li><li>        ArkUI_ColorAnimatablePropertyHandle color;</li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// 设置基础值。</span></li><li>    AnimatableUserData *userData1 = new AnimatableUserData;</li><li>    <span class="hljs-keyword">auto</span> widthAnimProperty = OH_ArkUI_RenderNodeUtils_CreateFloatAnimatableProperty(<span class="hljs-number">1000</span>);</li><li>    userData1-&gt;width = widthAnimProperty;</li><li>    <span class="hljs-keyword">auto</span> heightAnimProperty = OH_ArkUI_RenderNodeUtils_CreateFloatAnimatableProperty(<span class="hljs-number">1000</span>);</li><li>    userData1-&gt;height = heightAnimProperty;</li><li>    <span class="hljs-keyword">auto</span> vectorAnimP = OH_ArkUI_RenderNodeUtils_CreateVector2AnimatableProperty(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>);</li><li>    userData1-&gt;v2 = vectorAnimP;</li><li>    <span class="hljs-keyword">auto</span> colorAnimP = OH_ArkUI_RenderNodeUtils_CreateColorAnimatableProperty(<span class="hljs-number">0xFFFF11FF</span>);</li><li>    userData1-&gt;color = colorAnimP;</li><li>
</li><li>    <span class="hljs-comment">// 关联组件和多个modifier。</span></li><li>    <span class="hljs-keyword">auto</span> animModifier = OH_ArkUI_RenderNodeUtils_CreateContentModifier();</li><li>    OH_ArkUI_RenderNodeUtils_AttachContentModifier(renderNode, animModifier);</li><li>    <span class="hljs-comment">// 关联modifier和property。</span></li><li>    OH_ArkUI_RenderNodeUtils_AttachFloatAnimatableProperty(animModifier, widthAnimProperty);</li><li>    OH_ArkUI_RenderNodeUtils_AttachFloatAnimatableProperty(animModifier, heightAnimProperty);</li><li>    OH_ArkUI_RenderNodeUtils_AttachVector2AnimatableProperty(animModifier, vectorAnimP);</li><li>    OH_ArkUI_RenderNodeUtils_AttachColorAnimatableProperty(animModifier, colorAnimP);</li><li>
</li><li>    <span class="hljs-comment">// 设置自定义绘制内容。</span></li><li>    OH_ArkUI_RenderNodeUtils_SetContentModifierOnDraw(</li><li>        animModifier, userData1, [](ArkUI_DrawContext *context, <span class="hljs-type">void</span> *userData) {</li><li>            AnimatableUserData *data = (AnimatableUserData *)userData;</li><li>            <span class="hljs-type">float</span> width = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-type">float</span> height = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-type">uint32_t</span> color = <span class="hljs-number">0</span>;</li><li>            ArkUI_Vector2AnimatablePropertyHandle v2 = data-&gt;v2;</li><li>            <span class="hljs-comment">// property主要为传值用，这里用x,y来替代width，实际使用时可以通过property来自定义所需参数。</span></li><li>            OH_ArkUI_RenderNodeUtils_GetVector2AnimatablePropertyValue(v2, &amp;width, &amp;height);</li><li>            ArkUI_ColorAnimatablePropertyHandle cp = data-&gt;color;</li><li>            OH_ArkUI_RenderNodeUtils_GetColorAnimatablePropertyValue(cp, &amp;color);</li><li>
</li><li>
</li><li>            <span class="hljs-keyword">auto</span> *canvas1 = OH_ArkUI_DrawContext_GetCanvas(context);</li><li>            OH_Drawing_Canvas *canvas = reinterpret_cast&lt;OH_Drawing_Canvas *&gt;(canvas1);</li><li>            <span class="hljs-keyword">auto</span> path = OH_Drawing_PathCreate();</li><li>            OH_Drawing_PathMoveTo(path, width / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>            OH_Drawing_PathLineTo(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>            OH_Drawing_PathLineTo(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            OH_Drawing_PathLineTo(path, width / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            OH_Drawing_PathLineTo(path, width / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>            OH_Drawing_PathClose(path);</li><li>            <span class="hljs-keyword">auto</span> pen = OH_Drawing_PenCreate();</li><li>            OH_Drawing_PenSetWidth(pen, <span class="hljs-number">10</span>);</li><li>            OH_Drawing_PenSetColor(pen, color);</li><li>            OH_Drawing_CanvasAttachPen(canvas, pen);</li><li>            OH_Drawing_CanvasDrawPath(canvas, path);</li><li>        });</li><li>
</li><li>    <span class="hljs-comment">// 用户自定义参数。</span></li><li>    ArkUI_ContextCallback *update = new ArkUI_ContextCallback;</li><li>    update-&gt;userData = userData1;</li><li>    update-&gt;callback = [](<span class="hljs-type">void</span> *user) {</li><li>        AnimatableUserData *data = (AnimatableUserData *)user;</li><li>        OH_ArkUI_RenderNodeUtils_SetFloatAnimatablePropertyValue(data-&gt;width, <span class="hljs-number">100</span>);</li><li>        OH_ArkUI_RenderNodeUtils_SetFloatAnimatablePropertyValue(data-&gt;height, <span class="hljs-number">100</span>);</li><li>        OH_ArkUI_RenderNodeUtils_SetVector2AnimatablePropertyValue(data-&gt;v2, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>        OH_ArkUI_RenderNodeUtils_SetColorAnimatablePropertyValue(data-&gt;color, <span class="hljs-number">0xFF0011FF</span>);</li><li>    };</li><li>    <span class="hljs-comment">// 执行对应的动画。</span></li><li>    ArkUI_NativeAnimateAPI_1 *animateApi = nullptr;</li><li>    OH_ArkUI_GetModuleInterface(ARKUI_NATIVE_ANIMATE, ArkUI_NativeAnimateAPI_1, animateApi);</li><li>
</li><li>    ArkUI_AnimateCompleteCallback *completeCallback = new ArkUI_AnimateCompleteCallback;</li><li>    completeCallback-&gt;userData = userData1;</li><li>    completeCallback-&gt;type = ARKUI_FINISH_CALLBACK_REMOVED;</li><li>    completeCallback-&gt;callback = [](<span class="hljs-type">void</span> *userData) {</li><li>        AnimatableUserData *data = (AnimatableUserData *)userData;</li><li>    };</li><li>
</li><li>    ArkUI_AnimateOption *option = OH_ArkUI_AnimateOption_Create();</li><li>    OH_ArkUI_AnimateOption_SetDuration(option, <span class="hljs-number">2000</span>);</li><li>    OH_ArkUI_AnimateOption_SetTempo(option, <span class="hljs-number">1.1</span>);</li><li>    OH_ArkUI_AnimateOption_SetCurve(option, ARKUI_CURVE_EASE);</li><li>    OH_ArkUI_AnimateOption_SetDelay(option, <span class="hljs-number">20</span>);</li><li>    OH_ArkUI_AnimateOption_SetIterations(option, <span class="hljs-number">1</span>);</li><li>    OH_ArkUI_AnimateOption_SetPlayMode(option, ARKUI_ANIMATION_PLAY_MODE_REVERSE);</li><li>    ArkUI_ExpectedFrameRateRange *range = new ArkUI_ExpectedFrameRateRange;</li><li>    range-&gt;min = <span class="hljs-number">10</span>;</li><li>    range-&gt;max = <span class="hljs-number">120</span>;</li><li>    range-&gt;expected = <span class="hljs-number">60</span>;</li><li>    OH_ArkUI_AnimateOption_SetExpectedFrameRateRange(option, range);</li><li>        animateApi-&gt;animateTo(context, option, update, completeCallback);</li><li>
</li><li>
</li><li>    nodeAPI-&gt;setAttribute(Custom, NODE_WIDTH, &amp;itemWidth);</li><li>    nodeAPI-&gt;setAttribute(Custom, NODE_HEIGHT, &amp;itemHeight);</li><li>
</li><li>    nodeAPI-&gt;addChild(column, text);</li><li>    nodeAPI-&gt;addChild(column, Custom);</li><li>    nodeAPI-&gt;addChild(scroll, column);</li><li>    <span class="hljs-keyword">return</span> scroll;</li><li>}</li><li>
</li><li> napi_value <span class="hljs-title function_">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {nullptr, nullptr};</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>    <span class="hljs-keyword">auto</span> *nodeAPI = reinterpret_cast&lt;ArkUI_NativeNodeAPI_1 *&gt;(</li><li>        OH_ArkUI_QueryModuleInterfaceByName(ARKUI_NATIVE_NODE, <span class="hljs-string">"ArkUI_NativeNodeAPI_1"</span>));</li><li>    <span class="hljs-keyword">if</span> (nodeAPI != nullptr) {</li><li>         ArkUI_NodeHandle testNode;</li><li>         <span class="hljs-comment">// 获取ets侧传入的context。</span></li><li>         ArkUI_ContextHandle context = nullptr;</li><li>         <span class="hljs-comment">// 通过code判断是否获取成功。</span></li><li>         <span class="hljs-keyword">auto</span> code = OH_ArkUI_GetContextFromNapiValue(env, args[<span class="hljs-number">1</span>], &amp;context);</li><li>         testNode = testRenderNode2(nodeAPI, context);</li><li>    }</li><li>
</li><li>    NativeEntry::GetInstance()-&gt;SetRootNode(testNode);</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>   </li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>