<h1 _ngcontent-qro-c119="" class="doc-title ng-star-inserted" title="构造函数"> 构造函数 </h1>

<div _ngcontent-qro-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section887161844510">功能说明<i class="anchor-icon anchor-icon-link" anchorid="section887161844510" tips="复制节点链接"></i></h2><p>用于创建一个Matmul单核Tiling对象，或者多核Tiling对象，或者BatchMatmul Tiling对象。</p> </div> <div class="tiledSection"><h2 id="section118721418124516">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section118721418124516" tips="复制节点链接"></i></h2><ul><li>带参构造函数，需要传入硬件平台信息，推荐使用这类构造函数来获得更好的兼容性。<ul><li>使用PlatformAscendC类传入信息<div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MatmulApiTiling</span><span class="hljs-params">(<span class="hljs-type">const</span> platform_ascendc::PlatformAscendC&amp; ascendcPlatform)</span></span></li><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MultiCoreMatmulTiling</span><span class="hljs-params">(<span class="hljs-type">const</span> platform_ascendc::PlatformAscendC&amp; ascendcPlatform)</span></span></li><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">BatchMatmulTiling</span><span class="hljs-params">(<span class="hljs-type">const</span> platform_ascendc::PlatformAscendC &amp;ascendcPlatform)</span></span></li></ol></pre></div></div> </li><li>使用PlatformInfo传入信息<p>当platform_ascendc::PlatformAscendC无法在Tiling运行时获取时，需要开发者自己构造PlatformInfo结构体，透传给MatmulApiTiling构造函数。</p> <div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MatmulApiTiling</span><span class="hljs-params">(<span class="hljs-type">const</span> PlatformInfo&amp; platform)</span></span></li><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MultiCoreMatmulTiling</span><span class="hljs-params">(<span class="hljs-type">const</span> PlatformInfo &amp;platform)</span></span></li></ol></pre></div></div> </li></ul> </li><li>无参构造函数<p>支持如下产品型号：</p> <p>Kirin9020系列处理器</p> <div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">MatmulApiTiling</span>()</li><li><span class="hljs-built_in">MultiCoreMatmulTiling</span>()</li><li><span class="hljs-built_in">BatchMatmulTiling</span>()</li></ol></pre></div></div> </li><li>基类构造函数<p>MatmulApiTiling、MultiCoreMatmulTiling和BatchMatmulTiling都继承自基类MatmulApiTilingBase，其构造函数如下。</p> <div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">MatmulApiTilingBase</span>()</li><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MatmulApiTilingBase</span><span class="hljs-params">(<span class="hljs-type">const</span> platform_ascendc::PlatformAscendC&amp; ascendcPlatform)</span></span></li><li><span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MatmulApiTilingBase</span><span class="hljs-params">(<span class="hljs-type">const</span> PlatformInfo&amp; platform)</span></span></li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section88769185455">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section88769185455" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.1" valign="top" width="15%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.4.1.3" valign="top" width="73%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>ascendcPlatform</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>传入硬件平台的信息，PlatformAscendC定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-platformascendc-introduction">PlatformAscendC类简介</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>platform</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>传入硬件版本以及AI Core中各个硬件单元提供的内存大小。PlatformInfo构造时通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-platformascendc-introduction">PlatformAscendC类简介</a>获取。</p> <p>PlatformInfo结构定义如下，socVersion通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-getsocversion">GetSocVersion</a>获取并透传，各类硬件存储空间大小通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-getcorememsize">GetCoreMemSize</a>获取并透传。</p> <div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">PlatformInfo</span> { </li><li>     platform_ascendc::SocVersion socVersion; </li><li>     <span class="hljs-type">uint64_t</span> l1Size = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint64_t</span> l0CSize = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint64_t</span> ubSize = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint64_t</span> l0ASize = <span class="hljs-number">0</span>; </li><li>     <span class="hljs-type">uint64_t</span> l0BSize = <span class="hljs-number">0</span>; </li><li> };</li></ol></pre></div></div> <p>不推荐通过直接填值构造PlatformInfo的方式调用构造函数，例如PlatformInfo(, 1024, 1024, ..);</p> </td> </tr>  </tbody></table></div> </div> <p>在实现Host侧的Tiling函数时，platform_ascendc::PlatformAscendC用于获取一些硬件平台的信息，来支撑Tiling的计算，比如获取硬件平台的核数等信息。PlatformAscendC类提供获取这些平台信息的功能。</p> <p>和platform_ascendc::PlatformAscendC不同的是，PlatformInfo则用于获取芯片版本以及AI Core中各个硬件单元提供的内存大小等只针对单个AI Core的信息。</p> </div> <div class="tiledSection"><h2 id="section2884201834520">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section2884201834520" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section16884418124512">使用样例<i class="anchor-icon anchor-icon-link" anchorid="section16884418124512" tips="复制节点链接"></i></h2><ul><li>无参构造函数<div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 单核Tiling</span></li><li>matmul_tiling::MatmulApiTiling tiling;</li><li>tiling.<span class="hljs-built_in">SetAType</span>(matmul_tiling::TPosition::GM, matmul_tiling::CubeFormat::ND, matmul_tiling::DataType::DT_FLOAT16);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = tiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li><li>
</li><li><span class="hljs-comment">// 多核Tiling</span></li><li>matmul_tiling::MultiCoreMatmulTiling tiling;</li><li>tiling.<span class="hljs-built_in">SetDim</span>(<span class="hljs-number">1</span>);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = tiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li><li>
</li><li><span class="hljs-comment">// BatchMatmul Tiling</span></li><li>matmul_tiling::BatchMatmulTiling bmmTiling;</li><li>bmmTiling.<span class="hljs-built_in">SetAType</span>(matmul_tiling::TPosition::GM, matmul_tiling::CubeFormat::ND, matmul_tiling::DataType::DT_FLOAT16);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = bmmTiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li></ol></pre></div></div> </li><li>带参构造函数<div _ngcontent-qro-c106="" class="highlight-div"><div _ngcontent-qro-c106="" class="highlight-div-header"><div _ngcontent-qro-c106="" class="highlight-div-header-left"><div _ngcontent-qro-c106="" class="handle-button expand-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qro-c106="" class="highlight-div-header-right"><div _ngcontent-qro-c106="" class="handle-button ai-button"></div><div _ngcontent-qro-c106="" class="handle-button line-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qro-c106="" class="handle-button theme-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qro-c106="" class="handle-button copy-button"><div _ngcontent-qro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qro-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 单核Tiling</span></li><li><span class="hljs-keyword">auto</span> ascendcPlatform = platform_ascendc::<span class="hljs-built_in">PlatformAscendC</span>(context-&gt;<span class="hljs-built_in">GetPlatformInfo</span>());</li><li><span class="hljs-function">matmul_tiling::MatmulApiTiling <span class="hljs-title">tiling</span><span class="hljs-params">(ascendcPlatform)</span></span>;</li><li>tiling.<span class="hljs-built_in">SetAType</span>(matmul_tiling::TPosition::GM, matmul_tiling::CubeFormat::ND, matmul_tiling::DataType::DT_FLOAT16);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = tiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li><li>
</li><li><span class="hljs-comment">// 多核Tiling</span></li><li><span class="hljs-keyword">auto</span> ascendcPlatform = platform_ascendc::<span class="hljs-built_in">PlatformAscendC</span>(context-&gt;<span class="hljs-built_in">GetPlatformInfo</span>());</li><li><span class="hljs-function">matmul_tiling::MultiCoreMatmulTiling <span class="hljs-title">tiling</span><span class="hljs-params">(ascendcPlatform)</span></span>;</li><li>tiling.<span class="hljs-built_in">SetDim</span>(<span class="hljs-number">1</span>);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = tiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li><li>
</li><li><span class="hljs-comment">// BatchMatmul Tiling</span></li><li><span class="hljs-keyword">auto</span> ascendcPlatform = platform_ascendc::<span class="hljs-built_in">PlatformAscendC</span>(context-&gt;<span class="hljs-built_in">GetPlatformInfo</span>());</li><li><span class="hljs-function">matmul_tiling::BatchMatmulTiling <span class="hljs-title">bmmTiling</span><span class="hljs-params">(ascendcPlatform)</span></span>;</li><li>bmmTiling.<span class="hljs-built_in">SetAType</span>(matmul_tiling::TPosition::GM, matmul_tiling::CubeFormat::ND, matmul_tiling::DataType::DT_FLOAT16);</li><li><span class="hljs-comment">// ...</span></li><li>optiling::TCubeTiling tilingData;</li><li><span class="hljs-type">int</span> ret = tiling.<span class="hljs-built_in">GetTiling</span>(tilingData);    <span class="hljs-comment">// if ret = -1, gen tiling failed</span></li></ol></pre></div></div> </li></ul> </div> </div> <div></div></div>