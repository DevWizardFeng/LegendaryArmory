<h1 _ngcontent-qht-c119="" class="doc-title ng-star-inserted" title="查询和操作自定义节点"> 查询和操作自定义节点 </h1>

<div _ngcontent-qht-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>NDK提供一系列节点查询、遍历、操作能力，通过使用以下接口，开发者可以高效地访问和操控节点。</p>    <p>以下场景基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面</a>章节，创建前置工程。</p>    <div class="tiledSection">     <h2 id="查询节点uniqueid及通过uniqueid获取节点信息">查询节点uniqueId及通过uniqueId获取节点信息<i class="anchor-icon anchor-icon-link" anchorid="查询节点uniqueid及通过uniqueid获取节点信息" tips="复制节点链接"></i></h2>          <p>uniqueId是系统分配的唯一标识的节点Id。</p>     <p>从API version 20开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getnodeuniqueid" target="_blank">OH_ArkUI_NodeUtils_GetNodeUniqueId</a>接口，可以获取目标节点的uniqueId。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getnodehandlebyuniqueid" target="_blank">OH_ArkUI_NodeUtils_GetNodeHandleByUniqueId</a>接口，可以通过uniqueId获取目标节点的指针。</p>     <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">testNode</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_COLUMN</span>);</li><li><span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {<span class="hljs-number">480</span>};</li><li><span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span> = {<span class="hljs-variable">value</span>, <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">value</span>) / <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">ArkUI_NumberValue</span>)};</li><li><span class="hljs-variable">value</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">f32</span> = <span class="hljs-number">300</span>;</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">testNode</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">item</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">testNode</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, &amp;<span class="hljs-title class_">item</span>);</li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">IdList</span> {</li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">id</span> = -<span class="hljs-number">1</span>;</li><li>};</li><li><span class="hljs-variable">IdList</span> *<span class="hljs-variable">idl</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">IdList</span>;</li><li><span class="hljs-variable">int32_t</span> <span class="hljs-variable">uid</span> = -<span class="hljs-number">1</span>;</li><li><span class="hljs-title function_">OH_ArkUI_NodeUtils_GetNodeUniqueId</span>(<span class="hljs-variable">testNode</span>, &amp;<span class="hljs-title class_">uid</span>);</li><li><span class="hljs-variable">idl</span>-&gt;<span class="hljs-title class_">id</span> = <span class="hljs-variable">uid</span>;</li><li><span class="hljs-variable">auto</span> <span class="hljs-variable">button</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_BUTTON</span>);</li><li><span class="hljs-variable">value</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">f32</span> = <span class="hljs-number">50</span>;</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">item</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, &amp;<span class="hljs-title class_">item</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">addChild</span>(<span class="hljs-title class_">testNode</span>, <span class="hljs-title class_">button</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeEvent</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NODE_ON_CLICK</span>, <span class="hljs-number">1</span>, <span class="hljs-title class_">idl</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeEventReceiver</span>([](<span class="hljs-variable">ArkUI_NodeEvent</span> <span class="hljs-variable">*event</span>) {</li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">targetId</span> = <span class="hljs-title function_">OH_ArkUI_NodeEvent_GetTargetId</span>(<span class="hljs-variable">event</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">targetId</span> == <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">idl</span> = (<span class="hljs-variable">IdList</span> *)<span class="hljs-title function_">OH_ArkUI_NodeEvent_GetUserData</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">Test_Column</span>;</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">ec</span> = <span class="hljs-title function_">OH_ArkUI_NodeUtils_GetNodeHandleByUniqueId</span>(<span class="hljs-variable">idl</span>-&gt;<span class="hljs-title class_">id</span>, &amp;<span class="hljs-title class_">Test_Column</span>);</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">ec</span> == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-title function_">OH_LOG_Print</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-variable">LOG_WARN</span>, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"Manager"</span>,<span class="hljs-string">"GetNodeHandleByUniqueId success"</span>);</li><li>        }</li><li>    }</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过用户id获取节点信息">通过用户id获取节点信息<i class="anchor-icon anchor-icon-link" anchorid="通过用户id获取节点信息" tips="复制节点链接"></i></h2>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getattachednodehandlebyid" target="_blank">OH_ArkUI_NodeUtils_GetAttachedNodeHandleById</a>接口，可以通过用户设置的id获取目标节点的指针。</p>     <ol>      <li>       <p>ArkTS侧接入Native组件。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// GetNodeById.ets</span></li><li><span class="hljs-keyword">import</span> nativeNode <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GetNodeById</span> {</li><li>  <span class="hljs-keyword">private</span> rootSlot = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    nativeNode.<span class="hljs-title function_">createNativeRoot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>)</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>新建GetNodeByIdExample.h文件，在其中创建Text节点并设置id属性，通过OH_ArkUI_NodeUtils_GetAttachedNodeHandleById接口拿到节点。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// GetNodeByIdExample.h</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_GETNODEBYID_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_GETNODEBYID_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUINode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li>namespace NativeModule {</li><li>
</li><li><span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; <span class="hljs-title function_">CreateGetNodeByIdExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-keyword">auto</span> nodeAPI = NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI();</li><li>     </li><li>    <span class="hljs-comment">// 创建传入事件节点结构体</span></li><li>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> {</span></li><li>        ArkUI_NodeHandle node;</li><li>    };</li><li>    A* a = new A;</li><li>    </li><li>    <span class="hljs-comment">// 创建根节点Scroll</span></li><li>    ArkUI_NodeHandle scroll = nodeAPI-&gt;createNode(ARKUI_NODE_SCROLL);</li><li>    ArkUI_NumberValue length_value[] = {{.f32 = <span class="hljs-number">480</span>}};</li><li>    ArkUI_AttributeItem length_item = {length_value, <span class="hljs-keyword">sizeof</span>(length_value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_WIDTH, &amp;length_item);</li><li>    ArkUI_NumberValue length_value1[] = {{.f32 = <span class="hljs-number">650</span>}};</li><li>    ArkUI_AttributeItem length_item1 = {length_value1, <span class="hljs-keyword">sizeof</span>(length_value1) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_HEIGHT, &amp;length_item1);</li><li>    ArkUI_AttributeItem scroll_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Scroll_CAPI"</span>};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_ID, &amp;scroll_id);</li><li>    </li><li>    <span class="hljs-comment">// 创建Column</span></li><li>    ArkUI_NodeHandle column = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>    ArkUI_NumberValue value[] = {<span class="hljs-number">480</span>};</li><li>    ArkUI_AttributeItem item = {value, <span class="hljs-keyword">sizeof</span>(value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(column, NODE_WIDTH, &amp;item);</li><li>    ArkUI_NumberValue column_bc[] = {{.u32 = <span class="hljs-number">0xFFF00BB</span>}};</li><li>    ArkUI_AttributeItem column_item = {column_bc, <span class="hljs-number">1</span>};</li><li>    nodeAPI-&gt;setAttribute(column, NODE_BACKGROUND_COLOR, &amp;column_item);</li><li>    ArkUI_AttributeItem column_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Column_CAPI"</span>};</li><li>    nodeAPI-&gt;setAttribute(column, NODE_ID, &amp;column_id);</li><li>    </li><li>    <span class="hljs-comment">// 创建Text</span></li><li>    ArkUI_NodeHandle text0 = nodeAPI-&gt;createNode(ARKUI_NODE_TEXT);</li><li>    ArkUI_NumberValue text_width[] = {<span class="hljs-number">300</span>};</li><li>    ArkUI_AttributeItem text_item0 = {text_width, <span class="hljs-keyword">sizeof</span>(text_width) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(text0, NODE_WIDTH, &amp;text_item0);</li><li>    ArkUI_NumberValue text_height[] = {<span class="hljs-number">50</span>};</li><li>    ArkUI_AttributeItem text_item1 = {text_height, <span class="hljs-keyword">sizeof</span>(text_height) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(text0, NODE_HEIGHT, &amp;text_item1);</li><li>    ArkUI_AttributeItem text_item = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"示例Text节点"</span>};</li><li>    nodeAPI-&gt;setAttribute(text0, NODE_TEXT_CONTENT, &amp;text_item);</li><li>    ArkUI_NumberValue margin[] = {<span class="hljs-number">10</span>};</li><li>    ArkUI_AttributeItem item_margin = {margin, <span class="hljs-keyword">sizeof</span>(margin) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(text0, NODE_MARGIN, &amp;item_margin);</li><li>    ArkUI_AttributeItem text0_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Text0_CAPI"</span>};</li><li>    nodeAPI-&gt;setAttribute(text0, NODE_ID, &amp;text0_id);</li><li>    a-&gt;node = text0;</li><li>    </li><li>    <span class="hljs-comment">// 创建Row</span></li><li>    ArkUI_NodeHandle row0 = nodeAPI-&gt;createNode(ARKUI_NODE_ROW);</li><li>    ArkUI_NumberValue width_value[] = {{.f32=<span class="hljs-number">330</span>}};</li><li>    ArkUI_AttributeItem width_item = {width_value, <span class="hljs-keyword">sizeof</span>(width_value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_WIDTH, &amp;width_item);</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_MARGIN, &amp;item_margin);</li><li>    </li><li>    <span class="hljs-comment">// 创建Button</span></li><li>    ArkUI_NodeHandle bt0 = nodeAPI-&gt;createNode(ARKUI_NODE_BUTTON);</li><li>    ArkUI_NumberValue btn_width[] = {<span class="hljs-number">150</span>};</li><li>    ArkUI_AttributeItem btn_item0 = {btn_width, <span class="hljs-keyword">sizeof</span>(btn_width) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_WIDTH, &amp;btn_item0);</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_MARGIN, &amp;item_margin);</li><li>    ArkUI_AttributeItem bt0_item = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"GetAttachedNodeHandleById"</span>};</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_BUTTON_LABEL, &amp;bt0_item);</li><li>    nodeAPI-&gt;registerNodeEvent(bt0, NODE_ON_CLICK, <span class="hljs-number">0</span>, a);</li><li>    </li><li>    <span class="hljs-comment">// 注册事件</span></li><li>    <span class="hljs-keyword">auto</span> onClick = [](ArkUI_NodeEvent *event) {</li><li>        ArkUI_NodeHandle node = OH_ArkUI_NodeEvent_GetNodeHandle(event);</li><li>        <span class="hljs-keyword">auto</span> nodeAPI = NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI();</li><li>        </li><li>        <span class="hljs-keyword">if</span> (OH_ArkUI_NodeEvent_GetTargetId(event) == <span class="hljs-number">0</span>) {  <span class="hljs-comment">// GetAttachedNodeHandleById</span></li><li>            A* a = (A*)OH_ArkUI_NodeEvent_GetUserData(event);</li><li>            ArkUI_NodeHandle node = nullptr;</li><li>            <span class="hljs-keyword">auto</span> res = OH_ArkUI_NodeUtils_GetAttachedNodeHandleById(<span class="hljs-string">"Text0_CAPI"</span>, &amp;node);</li><li>            <span class="hljs-keyword">if</span> (node == a-&gt;node) {</li><li>                OH_LOG_Print(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"GetNodeByIdExample"</span>, <span class="hljs-string">"get Text0_CAPI success"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                OH_LOG_Print(LOG_APP, LOG_ERROR, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"GetNodeByIdExample"</span>, <span class="hljs-string">"get Text0_CAPI failed"</span>);</li><li>            }</li><li>        }</li><li>    };</li><li>    nodeAPI-&gt;registerNodeEventReceiver(onClick);</li><li>    </li><li>    <span class="hljs-comment">// 节点添加</span></li><li>    nodeAPI-&gt;addChild(scroll, column);</li><li>    nodeAPI-&gt;addChild(column, text0);</li><li>    nodeAPI-&gt;addChild(column, row0);</li><li>    nodeAPI-&gt;addChild(row0, bt0);</li><li>    </li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::make_shared&lt;ArkUINode&gt;(scroll);</li><li>}</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">//MYAPPLICATION_GETNODEBYID_H</span></span></li></ol></pre></div></div></li>      <li>       <p>在NativeEntry.cpp中，挂载Native节点。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NativeEntry.cpp</span></li><li>
</li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"NativeEntry.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"GetNodeByIdExample.h"</span></span></li><li>
</li><li>
</li><li>namespace NativeModule {</li><li>
</li><li>
</li><li>napi_value <span class="hljs-title function_">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {nullptr};</li><li>
</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>
</li><li>    <span class="hljs-comment">// 获取NodeContent</span></li><li>    ArkUI_NodeContentHandle contentHandle;</li><li>    OH_ArkUI_GetNodeContentFromNapiValue(env, args[<span class="hljs-number">0</span>], &amp;contentHandle);</li><li>    NativeEntry::GetInstance()-&gt;SetContentHandle(contentHandle);</li><li>
</li><li>     <span class="hljs-comment">// 创建节点</span></li><li>    <span class="hljs-keyword">auto</span> node = CreateGetNodeByIdExample();</li><li>
</li><li>
</li><li>    <span class="hljs-comment">// 保持Native侧对象到管理类中，维护生命周期。</span></li><li>    NativeEntry::GetInstance()-&gt;SetRootNode(node);</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>
</li><li>napi_value <span class="hljs-title function_">DestroyNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-comment">// 从管理类中释放Native侧对象。</span></li><li>    NativeEntry::GetInstance()-&gt;DisposeRootNode();</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li></ol></pre></div></div></li>      <li>       <p>运行程序，点击按钮，打印节点获取成功信息。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="移动节点">移动节点<i class="anchor-icon anchor-icon-link" anchorid="移动节点" tips="复制节点链接"></i></h2>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_moveto" target="_blank">OH_ArkUI_NodeUtils_MoveTo</a>接口，可以将Native节点移动到新的父节点下，从而按需改变节点树结构。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当前仅支持以下类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodetype" target="_blank">ArkUI_NodeType</a>进行移动操作：ARKUI_NODE_STACK、ARKUI_NODE_XCOMPONENT、ARKUI_NODE_EMBEDDED_COMPONENT。对于其他类型的节点，移动操作不会生效。</p>      </div></div></div>     <ol>      <li>       <p>ArkTS侧接入Native组件。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// MoveTo.ets</span></li><li><span class="hljs-keyword">import</span> nativeNode <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MoveTo</span> {</li><li>  <span class="hljs-keyword">private</span> rootSlot = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>  </li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    nativeNode.<span class="hljs-title function_">createNativeRoot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>)</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>新建MoveTo.h文件，在其中创建Stack节点，通过OH_ArkUI_NodeUtils_MoveTo接口移动Stack节点。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// MoveToExample.h</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_MOVETO_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_MOVETO_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUINode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li>namespace NativeModule {</li><li>
</li><li><span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; <span class="hljs-title function_">CreateMoveToExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-keyword">auto</span> nodeAPI = NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI();</li><li>     </li><li>    <span class="hljs-comment">// 创建传入事件节点结构体</span></li><li>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> {</span></li><li>        ArkUI_NodeHandle node;</li><li>        ArkUI_NodeHandle targetParent;</li><li>    };</li><li>    A* a = new A;</li><li>     </li><li>    <span class="hljs-comment">// 创建根节点Scroll</span></li><li>    ArkUI_NodeHandle scroll = nodeAPI-&gt;createNode(ARKUI_NODE_SCROLL);</li><li>    ArkUI_NumberValue length_value[] = {{.f32 = <span class="hljs-number">480</span>}};</li><li>    ArkUI_AttributeItem length_item = {length_value, <span class="hljs-keyword">sizeof</span>(length_value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_WIDTH, &amp;length_item);</li><li>    ArkUI_NumberValue length_value1[] = {{.f32 = <span class="hljs-number">650</span>}};</li><li>    ArkUI_AttributeItem length_item1 = {length_value1, <span class="hljs-keyword">sizeof</span>(length_value1) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_HEIGHT, &amp;length_item1);</li><li>    ArkUI_AttributeItem scroll_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Scroll_CAPI"</span>};</li><li>    nodeAPI-&gt;setAttribute(scroll, NODE_ID, &amp;scroll_id);</li><li>    </li><li>    <span class="hljs-comment">// 创建Column</span></li><li>    ArkUI_NodeHandle column = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>    ArkUI_NumberValue value[] = {<span class="hljs-number">480</span>};</li><li>    ArkUI_AttributeItem item = {value, <span class="hljs-keyword">sizeof</span>(value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(column, NODE_WIDTH, &amp;item);</li><li>    ArkUI_AttributeItem column_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Column_CAPI"</span>};</li><li>    nodeAPI-&gt;setAttribute(column, NODE_ID, &amp;column_id);</li><li>    </li><li>    <span class="hljs-comment">// 创建Row</span></li><li>    ArkUI_NumberValue text_height[] = {<span class="hljs-number">50</span>};</li><li>    ArkUI_AttributeItem text_item1 = {text_height, <span class="hljs-keyword">sizeof</span>(text_height) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    ArkUI_NumberValue margin[] = {<span class="hljs-number">10</span>};</li><li>    ArkUI_AttributeItem item_margin = {margin, <span class="hljs-keyword">sizeof</span>(margin) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    ArkUI_NodeHandle row0 = nodeAPI-&gt;createNode(ARKUI_NODE_ROW);</li><li>    ArkUI_NumberValue width_value[] = {{.f32=<span class="hljs-number">330</span>}};</li><li>    ArkUI_AttributeItem width_item = {width_value, <span class="hljs-keyword">sizeof</span>(width_value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_WIDTH, &amp;width_item);</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(row0, NODE_MARGIN, &amp;item_margin);</li><li>    </li><li>    ArkUI_NodeHandle row1 = nodeAPI-&gt;createNode(ARKUI_NODE_ROW);</li><li>    nodeAPI-&gt;setAttribute(row1, NODE_WIDTH, &amp;width_item);</li><li>    nodeAPI-&gt;setAttribute(row1, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(row1, NODE_MARGIN, &amp;item_margin);</li><li>    a-&gt;targetParent = row1;</li><li>    </li><li>    ArkUI_NodeHandle row2 = nodeAPI-&gt;createNode(ARKUI_NODE_ROW);</li><li>    nodeAPI-&gt;setAttribute(row2, NODE_WIDTH, &amp;width_item);</li><li>    nodeAPI-&gt;setAttribute(row2, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(row2, NODE_MARGIN, &amp;item_margin);</li><li>    </li><li>    <span class="hljs-comment">// 创建Stack</span></li><li>    ArkUI_NodeHandle stack0 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    ArkUI_NumberValue stack_value[] = {{.f32=<span class="hljs-number">50</span>}};</li><li>    ArkUI_AttributeItem stack_item1 = {stack_value, <span class="hljs-keyword">sizeof</span>(width_value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(stack0, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack0, NODE_HEIGHT, &amp;stack_item1);</li><li>    ArkUI_NumberValue stack_bc[] = {{.u32 = <span class="hljs-number">0xFFFFB6C1</span>}};</li><li>    ArkUI_AttributeItem stack_item2 = {stack_bc, <span class="hljs-number">1</span>};</li><li>    nodeAPI-&gt;setAttribute(stack0, NODE_BACKGROUND_COLOR, &amp;stack_item2);</li><li>    a-&gt;node = stack0;</li><li>    </li><li>    ArkUI_NodeHandle stack1 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    nodeAPI-&gt;setAttribute(stack1, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack1, NODE_HEIGHT, &amp;stack_item1);</li><li>    ArkUI_NumberValue stack_bc1[] = {{.u32 = <span class="hljs-number">0xFF6495ED</span>}};</li><li>    ArkUI_AttributeItem stack_item3 = {stack_bc1, <span class="hljs-number">1</span>};</li><li>    nodeAPI-&gt;setAttribute(stack1, NODE_BACKGROUND_COLOR, &amp;stack_item3);</li><li>    </li><li>    ArkUI_NodeHandle stack2 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    nodeAPI-&gt;setAttribute(stack2, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack2, NODE_HEIGHT, &amp;stack_item1);</li><li>    ArkUI_NumberValue stack_bc2[] = {{.u32 = <span class="hljs-number">0xFF90EE90</span>}};</li><li>    ArkUI_AttributeItem stack_item4 = {stack_bc2, <span class="hljs-number">1</span>};</li><li>    nodeAPI-&gt;setAttribute(stack2, NODE_BACKGROUND_COLOR, &amp;stack_item4);</li><li>    </li><li>    ArkUI_NodeHandle stack3 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    nodeAPI-&gt;setAttribute(stack3, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack3, NODE_HEIGHT, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack3, NODE_BACKGROUND_COLOR, &amp;stack_item2);</li><li>    </li><li>    ArkUI_NodeHandle stack4 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    nodeAPI-&gt;setAttribute(stack4, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack4, NODE_HEIGHT, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack4, NODE_BACKGROUND_COLOR, &amp;stack_item3);</li><li>    </li><li>    ArkUI_NodeHandle stack5 = nodeAPI-&gt;createNode(ARKUI_NODE_STACK);</li><li>    nodeAPI-&gt;setAttribute(stack5, NODE_WIDTH, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack5, NODE_HEIGHT, &amp;stack_item1);</li><li>    nodeAPI-&gt;setAttribute(stack5, NODE_BACKGROUND_COLOR, &amp;stack_item4);</li><li>    </li><li>    <span class="hljs-comment">// 创建Button</span></li><li>    ArkUI_NodeHandle bt0 = nodeAPI-&gt;createNode(ARKUI_NODE_BUTTON);</li><li>    ArkUI_NumberValue btn_width[] = {<span class="hljs-number">150</span>};</li><li>    ArkUI_AttributeItem btn_item0 = {btn_width, <span class="hljs-keyword">sizeof</span>(btn_width) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_WIDTH, &amp;btn_item0);</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_HEIGHT, &amp;text_item1);</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_MARGIN, &amp;item_margin);</li><li>    ArkUI_AttributeItem bt0_item = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"MoveTo"</span>};</li><li>    nodeAPI-&gt;setAttribute(bt0, NODE_BUTTON_LABEL, &amp;bt0_item);</li><li>    nodeAPI-&gt;registerNodeEvent(bt0, NODE_ON_CLICK, <span class="hljs-number">0</span>, a);</li><li>    </li><li>    <span class="hljs-comment">// 注册事件</span></li><li>    <span class="hljs-keyword">auto</span> onClick = [](ArkUI_NodeEvent *event) {</li><li>        ArkUI_NodeHandle node = OH_ArkUI_NodeEvent_GetNodeHandle(event);</li><li>        <span class="hljs-keyword">auto</span> nodeAPI = NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI();</li><li>        </li><li>        <span class="hljs-keyword">if</span> (OH_ArkUI_NodeEvent_GetTargetId(event) == <span class="hljs-number">0</span>) {  <span class="hljs-comment">// MoveTo</span></li><li>            A* a = (A*)OH_ArkUI_NodeEvent_GetUserData(event);</li><li>            <span class="hljs-keyword">auto</span> res = OH_ArkUI_NodeUtils_MoveTo(a-&gt;node, a-&gt;targetParent, <span class="hljs-number">2</span>);</li><li>        }</li><li>    };</li><li>    nodeAPI-&gt;registerNodeEventReceiver(onClick);</li><li>    </li><li>    <span class="hljs-comment">// 节点添加</span></li><li>    nodeAPI-&gt;addChild(scroll, column);</li><li>    nodeAPI-&gt;addChild(column, row0);</li><li>    nodeAPI-&gt;addChild(column, row1);</li><li>    nodeAPI-&gt;addChild(column, row2);</li><li>    nodeAPI-&gt;addChild(row0, stack0);</li><li>    nodeAPI-&gt;addChild(row0, stack1);</li><li>    nodeAPI-&gt;addChild(row0, stack2);</li><li>    nodeAPI-&gt;addChild(row1, stack3);</li><li>    nodeAPI-&gt;addChild(row1, stack4);</li><li>    nodeAPI-&gt;addChild(row1, stack5);</li><li>    nodeAPI-&gt;addChild(row2, bt0);</li><li>    </li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::make_shared&lt;ArkUINode&gt;(scroll);</li><li>}</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">//MYAPPLICATION_MOVETO_H</span></span></li></ol></pre></div></div></li>      <li>       <p>在NativeEntry.cpp中，挂载Native节点。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NativeEntry.cpp</span></li><li>
</li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"NativeEntry.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"MoveToExample.h"</span></span></li><li>
</li><li>
</li><li>namespace NativeModule {</li><li>
</li><li>
</li><li>napi_value <span class="hljs-title function_">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {nullptr};</li><li>
</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>    </li><li>    <span class="hljs-comment">// 获取NodeContent</span></li><li>    ArkUI_NodeContentHandle contentHandle;</li><li>    OH_ArkUI_GetNodeContentFromNapiValue(env, args[<span class="hljs-number">0</span>], &amp;contentHandle);</li><li>    NativeEntry::GetInstance()-&gt;SetContentHandle(contentHandle);</li><li>
</li><li>
</li><li>    <span class="hljs-comment">// 创建节点</span></li><li>    <span class="hljs-keyword">auto</span> node = CreateMoveToExample();</li><li>
</li><li>
</li><li>    <span class="hljs-comment">// 保持Native侧对象到管理类中，维护生命周期。</span></li><li>    NativeEntry::GetInstance()-&gt;SetRootNode(node);</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>napi_value <span class="hljs-title function_">DestroyNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-comment">// 从管理类中释放Native侧对象。</span></li><li>    NativeEntry::GetInstance()-&gt;DisposeRootNode();</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li></ol></pre></div></div></li>      <li>       <p>运行程序，点击按钮，Stack节点会移动到目标位置。</p>       <p><span><img originheight="232" originwidth="276" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114749.67978863733435989575112991463798:50001231000000:2800:D30CC39BC76A415B7AA9879730E544068CFC62F02A715EA0E22DF50CB5E54CE8.gif" class="notEnlarge" width="276" height="232"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="在当前即时帧触发节点属性更新">在当前即时帧触发节点属性更新<i class="anchor-icon anchor-icon-link" anchorid="在当前即时帧触发节点属性更新" tips="复制节点链接"></i></h2>          <p>从API version 21开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nativemodule_invalidateattributes" target="_blank">OH_ArkUI_NativeModule_InvalidateAttributes</a>接口，在当前帧即时触发节点属性更新，避免组件切换过程中出现闪烁。</p>     <ol>      <li>       <p>ArkTS侧接入Native组件。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.ets</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ImageContent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeContent</span>: <span class="hljs-title class_">NodeContent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 通过C-API创建节点，并添加到管理器nodeContent上</span></li><li>    testNapi.<span class="hljs-title function_">createNativeNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeContent</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 显示nodeContent管理器里存放的Native侧的组件</span></li><li>      <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeContent</span>)</li><li>    }</li><li>  }</li><li>}</li><li> </li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">showParent</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>         <span class="hljs-title class_">Button</span>(<span class="hljs-string">"切换"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>             <span class="hljs-variable language_">this</span>.<span class="hljs-property">showParent</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">showParent</span>;</li><li>         }).<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">showParent</span>) {</li><li>          <span class="hljs-title class_">ImageContent</span>()</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-title class_">ImageContent</span>()</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>新建Attribute_util .h用于设置组件属性。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//</span></li><li><span class="hljs-comment">// Created on 2025/8/14.</span></li><li><span class="hljs-comment">//</span></li><li><span class="hljs-comment">// Node APIs are not fully supported. To solve the compilation error of the interface cannot be found,</span></li><li><span class="hljs-comment">// please include "napi/native_api.h".</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_ATTRIBUTE_UTIL_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_ATTRIBUTE_UTIL_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdint&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">AttributeUtil</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    ArkUI_NativeNodeAPI_1 *api_;</li><li>    ArkUI_NodeHandle node_;</li><li>    <span class="hljs-built_in">AttributeUtil</span>(ArkUI_NodeHandle node, ArkUI_NativeNodeAPI_1 *api) {</li><li>        <span class="hljs-keyword">this</span>-&gt;node_ = node;</li><li>        api_ = api;</li><li>    }</li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">width</span><span class="hljs-params">(<span class="hljs-type">float</span> width)</span> </span>{</li><li>        ArkUI_NumberValue NODE_WIDTH_value[] = {width};</li><li>        ArkUI_AttributeItem NODE_WIDTH_Item = {NODE_WIDTH_value, <span class="hljs-number">1</span>};</li><li>        <span class="hljs-keyword">return</span> api_-&gt;<span class="hljs-built_in">setAttribute</span>(node_, NODE_WIDTH, &amp;NODE_WIDTH_Item);</li><li>    }</li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">height</span><span class="hljs-params">(<span class="hljs-type">float</span> height)</span> </span>{</li><li>        ArkUI_NumberValue NODE_HEIGHT_value[] = {height};</li><li>        ArkUI_AttributeItem NODE_HEIGHT_Item = {NODE_HEIGHT_value, <span class="hljs-number">1</span>};</li><li>        <span class="hljs-keyword">return</span> api_-&gt;<span class="hljs-built_in">setAttribute</span>(node_, NODE_HEIGHT, &amp;NODE_HEIGHT_Item);</li><li>    }</li><li>     <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">imageSrc</span><span class="hljs-params">(std::string src)</span> </span>{</li><li>         ArkUI_AttributeItem NODE_IAMGE_SRC_VALUE = {.string = src.<span class="hljs-built_in">c_str</span>()};</li><li>        <span class="hljs-keyword">return</span> api_-&gt;<span class="hljs-built_in">setAttribute</span>(node_, NODE_IMAGE_SRC , &amp;NODE_IAMGE_SRC_VALUE);</li><li>    }</li><li>    <span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">imageSyncLoad</span><span class="hljs-params">()</span> </span>{</li><li>            ArkUI_NumberValue NODE_TRANSLATE_ITEM_VALUE[] = {{.i32 = <span class="hljs-number">1</span>}};</li><li>          ArkUI_AttributeItem NODE_BORDER_WIDTH_ITEM = {NODE_TRANSLATE_ITEM_VALUE, <span class="hljs-number">1</span>};</li><li>        <span class="hljs-keyword">return</span> api_-&gt;<span class="hljs-built_in">setAttribute</span>(node_, NODE_IMAGE_SYNC_LOAD , &amp;NODE_BORDER_WIDTH_ITEM);</li><li>    }</li><li>};</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYAPPLICATION_ATTRIBUTE_UTIL_H</span></span></li></ol></pre></div></div></li>      <li>       <p>在nai_init.cpp中，挂载Native节点。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"attribute_util.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_interface.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api_types.h&gt;</span></span></li><li>
</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">Add</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {nullptr};</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>    napi_valuetype valuetype0;</li><li>    napi_typeof(env, args[<span class="hljs-number">0</span>], &amp;valuetype0);</li><li>
</li><li>    napi_valuetype valuetype1;</li><li>    napi_typeof(env, args[<span class="hljs-number">1</span>], &amp;valuetype1);</li><li>
</li><li>    <span class="hljs-type">double</span> value0;</li><li>    napi_get_value_double(env, args[<span class="hljs-number">0</span>], &amp;value0);</li><li>
</li><li>    <span class="hljs-type">double</span> value1;</li><li>    napi_get_value_double(env, args[<span class="hljs-number">1</span>], &amp;value1);</li><li>
</li><li>    napi_value sum;</li><li>    napi_create_double(env, value0 + value1, &amp;sum);</li><li>
</li><li>    <span class="hljs-keyword">return</span> sum;</li><li>}</li><li>
</li><li><span class="hljs-type">static</span> ArkUI_NativeNodeAPI_1 *nodeAPI = nullptr;</li><li>
</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">NAPI_Global_createNativeNode</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {nullptr};</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>    ArkUI_NodeContentHandle contentHandle;</li><li>    OH_ArkUI_GetNodeContentFromNapiValue(env, args[<span class="hljs-number">0</span>], &amp;contentHandle);</li><li>    OH_ArkUI_GetModuleInterface(ARKUI_NATIVE_NODE, ArkUI_NativeNodeAPI_1, nodeAPI);</li><li>    <span class="hljs-comment">// 创建Image组件</span></li><li>    <span class="hljs-keyword">auto</span> imageNode = nodeAPI-&gt;createNode(ARKUI_NODE_IMAGE);</li><li>    AttributeUtil <span class="hljs-title function_">imageNodeAttr</span><span class="hljs-params">(imageNode, nodeAPI)</span>;</li><li>    <span class="hljs-comment">// 设置image组件属性</span></li><li>    imageNodeAttr.imageSrc(<span class="hljs-string">"/pages/common/startIcon.png"</span>);</li><li>    imageNodeAttr.imageSyncLoad();</li><li>    imageNodeAttr.width(<span class="hljs-number">100</span>);</li><li>    imageNodeAttr.height(<span class="hljs-number">100</span>);</li><li>    <span class="hljs-comment">// 在当前即时帧触发节点属性更新</span></li><li>    OH_ArkUI_NativeModule_InvalidateAttributes(imageNode);</li><li>    <span class="hljs-comment">// 挂载image组件到组件树</span></li><li>    OH_ArkUI_NodeContent_AddNode(contentHandle, imageNode);</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>EXTERN_C_START</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> {</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"add"</span>, nullptr, Add, nullptr, nullptr, nullptr, napi_default, nullptr},</li><li>        {<span class="hljs-string">"createNativeNode"</span>, nullptr, NAPI_Global_createNativeNode, nullptr, nullptr, nullptr, napi_default, nullptr}};</li><li>    napi_define_properties(env, exports, <span class="hljs-keyword">sizeof</span>(desc) / <span class="hljs-keyword">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = nullptr,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>),</li><li>    .reserved = {<span class="hljs-number">0</span>},</li><li>};</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> { napi_module_register(&amp;demoModule); }</li></ol></pre></div></div></li>      <li>       <p>运行程序，点击按钮，切换图片正常展示。</p>       <p><span><img originheight="202" originwidth="194" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114749.37863032096310366325048552940859:50001231000000:2800:4A6CF074B05BF03ABB02A635066F63A866878EF348C835B425662D83C3D3A01F.png" class="notEnlarge" width="194" height="202"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="用不同的展开模式获取对应下标的子节点">用不同的展开模式获取对应下标的子节点<i class="anchor-icon anchor-icon-link" anchorid="用不同的展开模式获取对应下标的子节点" tips="复制节点链接"></i></h2>          <p>NDK支持通过不同的展开方式获取目标节点下的有效节点信息。例如，在LazyForEach场景下，可以处理存在多个子节点的情况。</p>     <p>从API version 20开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getfirstchildindexwithoutexpand" target="_blank">OH_ArkUI_NodeUtils_GetFirstChildIndexWithoutExpand</a>接口，可以获取目标节点的第一个存在于组件树的节点。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getlastchildindexwithoutexpand" target="_blank">OH_ArkUI_NodeUtils_GetLastChildIndexWithoutExpand</a>接口，可以获取目标节点的最后一个存在于组件树的节点。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getchildwithexpandmode" target="_blank">OH_ArkUI_NodeUtils_GetChildWithExpandMode</a>接口，可以通过不同的节点展开模式获取对应下标的子节点。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>节点展开方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#arkui_expandmode" target="_blank">ArkUI_ExpandMode</a>，此处推荐使用ARKUI_LAZY_EXPAND懒展开方式，智能识别对应场景。</p>      </div></div></div>     <ol>      <li>       <p>通过ArkTS构造LazyForEach及ArkTS的下树节点展开场景。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">ExpandMode</span>, <span class="hljs-title class_">LengthUnit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode "</span>;</li><li>
</li><li><span class="hljs-comment">// BasicDataSource实现了IDataSource接口，用于管理listener监听，以及通知LazyForEach数据更新</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.ADD, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.CHANGE, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.DELETE, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange(</span></li><li>      <span class="hljs-comment">//         [{type: DataOperationType.EXCHANGE, index: {start: from, end: to}}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = []</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data: MyDataSource, scroller: Scroller</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> = scroller;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildData</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">List</span>({ <span class="hljs-attr">scroller</span>: params.<span class="hljs-property">scroller</span> }) {</li><li>    <span class="hljs-title class_">LazyForEach</span>(params.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">ListItem</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(item)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" node appear: "</span> + item)</li><li>            })</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>            .<span class="hljs-title function_">margin</span>({</li><li>              <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,</li><li>              <span class="hljs-attr">bottom</span>: <span class="hljs-number">30</span>,</li><li>              <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>              <span class="hljs-attr">right</span>: <span class="hljs-number">10</span></li><li>            })</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">id</span>(item)</li><li>    }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>  }</li><li>  .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  .<span class="hljs-title function_">listDirection</span>(<span class="hljs-title class_">Axis</span>.<span class="hljs-property">Horizontal</span>)</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`N<span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">dataNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    dataNode.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildData), params);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = dataNode.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">scrollToIndexOptions</span>: <span class="hljs-title class_">ScrollToIndexOptions</span> = {</li><li>      <span class="hljs-attr">extraOffset</span>: {</li><li>        <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">unit</span>: <span class="hljs-title class_">LengthUnit</span>.<span class="hljs-property">VP</span></li><li>      }</li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">6</span>, <span class="hljs-literal">true</span>, <span class="hljs-title class_">ScrollAlign</span>.<span class="hljs-property">START</span>, scrollToIndexOptions);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 获取不展开场景下第一个活跃节点的下标</span></li><li>  <span class="hljs-title function_">getFirstChildIndexWithoutExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> getFirstChildIndexWithoutExpand: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rootNode!.getFirstChildIndexWithoutExpand()}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 获取不展开场景下最后一个活跃节点的下标</span></li><li>  <span class="hljs-title function_">getLastChildIndexWithoutExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> getLastChildIndexWithoutExpand: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rootNode!.getLastChildIndexWithoutExpand()}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 用不展开的方式获取节点</span></li><li>  <span class="hljs-title function_">getChildWithNotExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">NOT_EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND): "</span> + childNode?.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode?.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N9"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>  </li><li>  <span class="hljs-comment">// 以展开的方式获取节点</span></li><li>  <span class="hljs-title function_">getChildWithExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND): "</span> + childNode?.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode?.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N3"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>  </li><li>  <span class="hljs-title function_">getChildWithLazyExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">LAZY_EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND): "</span> + childNode?.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode?.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N3"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">"This is a NodeContainer."</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>            .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getFirstChildIndexWithoutExpand"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getFirstChildIndexWithoutExpand</span>();</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getLastChildIndexWithoutExpand"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getLastChildIndexWithoutExpand</span>();</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithNotExpand"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithNotExpand</span>();</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithExpand"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithExpand</span>();</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithLazyExpand"</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithLazyExpand</span>();</li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>) <span class="hljs-comment">// 滚动方向纵向</span></li><li>    }</li><li>  }</li></ol></pre></div></div></li>      <li>       <p>NDK侧通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_getattachednodehandlebyid" target="_blank">OH_ArkUI_NodeUtils_GetAttachedNodeHandleById</a>接口获取ArkTS组件，并通过懒展开模式获取对应的子组件信息。</p>       <div _ngcontent-qht-c106="" class="highlight-div"><div _ngcontent-qht-c106="" class="highlight-div-header"><div _ngcontent-qht-c106="" class="highlight-div-header-left"><div _ngcontent-qht-c106="" class="handle-button expand-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qht-c106="" class="highlight-div-header-right"><div _ngcontent-qht-c106="" class="handle-button ai-button"></div><div _ngcontent-qht-c106="" class="handle-button line-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qht-c106="" class="handle-button theme-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qht-c106="" class="handle-button copy-button"><div _ngcontent-qht-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qht-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>ArkUI_NodeHandle childNode = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_ArkUI_NodeUtils_GetAttachedNodeHandleById</span>(<span class="hljs-string">"N3"</span>, &amp;childNode);</li><li>
</li><li><span class="hljs-type">uint32_t</span> index = <span class="hljs-number">0</span>;</li><li><span class="hljs-built_in">OH_ArkUI_NodeUtils_GetFirstChildIndexWithoutExpand</span>(childNode, &amp;index);</li><li><span class="hljs-type">uint32_t</span> index1 = <span class="hljs-number">0</span>;</li><li><span class="hljs-built_in">OH_ArkUI_NodeUtils_GetLastChildIndexWithoutExpand</span>(childNode, &amp;index1);</li><li>ArkUI_NodeHandle child = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">OH_ArkUI_NodeUtils_GetChildWithExpandMode</span>(childNode, <span class="hljs-number">3</span>, &amp;child, <span class="hljs-number">0</span>);</li><li><span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, <span class="hljs-number">0xFF00</span>, <span class="hljs-string">"Manager"</span>, <span class="hljs-string">"firstChildIndex - lastChildIndex == %{public}d -- %{public}d, -- getResult= %{public}d"</span>,</li><li>    index, index1, result);</li></ol></pre></div></div></li>      <li>       <p>查看日志打印的对应错误码返回是否正确，以此判断是否成功获取到对应子节点。</p></li>     </ol>    </div>   </div>   <div></div></div>