<h1 _ngcontent-hjl-c119="" class="doc-title ng-star-inserted" title="查询和监听音频输入设备"> 查询和监听音频输入设备 </h1>

<div _ngcontent-hjl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供音频输入设备管理能力，包括查询输入设备信息、监听设备连接状态变化等。具体API说明可参考文档<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audioroutingmanager" target="_blank">AudioRoutingManager</a>。</p>    <div class="tiledSection">     <h2 id="创建audioroutingmanager实例">创建AudioRoutingManager实例<i class="anchor-icon anchor-icon-link" anchorid="创建audioroutingmanager实例" tips="复制节点链接"></i></h2>          <p>在使用AudioRoutingManager管理音频设备前，需要先导入模块并创建实例。</p>     <div _ngcontent-hjl-c106="" class="highlight-div"><div _ngcontent-hjl-c106="" class="highlight-div-header"><div _ngcontent-hjl-c106="" class="highlight-div-header-left"><div _ngcontent-hjl-c106="" class="handle-button expand-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjl-c106="" class="highlight-div-header-right"><div _ngcontent-hjl-c106="" class="handle-button ai-button"></div><div _ngcontent-hjl-c106="" class="handle-button line-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjl-c106="" class="handle-button theme-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjl-c106="" class="handle-button copy-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;  <span class="hljs-comment">// 导入audio模块。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();  <span class="hljs-comment">// 需要先创建AudioManager实例。</span></li><li><span class="hljs-keyword">let</span> audioRoutingManager = audioManager.<span class="hljs-title function_">getRoutingManager</span>();  <span class="hljs-comment">// 再调用AudioManager的方法创建AudioRoutingManager实例。</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="支持的音频输入设备类型">支持的音频输入设备类型<i class="anchor-icon anchor-icon-link" anchorid="支持的音频输入设备类型" tips="复制节点链接"></i></h2>          <p>目前支持的音频输入设备见下表：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.1" valign="top" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.2" valign="top" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.3" valign="top" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">WIRED_HEADSET</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">3</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">有线耳机，带麦克风。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">BLUETOOTH_SCO</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">7</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">蓝牙设备SCO（Synchronous Connection Oriented）连接。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">MIC</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">15</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">麦克风。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">USB_HEADSET</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">22</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">USB耳机，带麦克风。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="获取输入设备信息">获取输入设备信息<i class="anchor-icon anchor-icon-link" anchorid="获取输入设备信息" tips="复制节点链接"></i></h2>          <p>使用getDevices()方法可以获取当前所有输入设备的信息。</p>     <div _ngcontent-hjl-c106="" class="highlight-div"><div _ngcontent-hjl-c106="" class="highlight-div-header"><div _ngcontent-hjl-c106="" class="highlight-div-header-left"><div _ngcontent-hjl-c106="" class="handle-button expand-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjl-c106="" class="highlight-div-header-right"><div _ngcontent-hjl-c106="" class="handle-button ai-button"></div><div _ngcontent-hjl-c106="" class="handle-button line-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjl-c106="" class="handle-button theme-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjl-c106="" class="handle-button copy-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>audioRoutingManager.<span class="hljs-title function_">getDevices</span>(audio.<span class="hljs-property">DeviceFlag</span>.<span class="hljs-property">INPUT_DEVICES_FLAG</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: audio.AudioDeviceDescriptors</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Promise returned to indicate that the device list is obtained.'</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听设备连接状态变化">监听设备连接状态变化<i class="anchor-icon anchor-icon-link" anchorid="监听设备连接状态变化" tips="复制节点链接"></i></h2>          <p>可以设置监听事件来监听设备连接状态的变化，当有设备连接或断开时触发回调：</p>     <div _ngcontent-hjl-c106="" class="highlight-div"><div _ngcontent-hjl-c106="" class="highlight-div-header"><div _ngcontent-hjl-c106="" class="highlight-div-header-left"><div _ngcontent-hjl-c106="" class="handle-button expand-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjl-c106="" class="highlight-div-header-right"><div _ngcontent-hjl-c106="" class="handle-button ai-button"></div><div _ngcontent-hjl-c106="" class="handle-button line-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjl-c106="" class="handle-button theme-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjl-c106="" class="handle-button copy-button"><div _ngcontent-hjl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 监听音频设备状态变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'deviceChange'</span>, audio.<span class="hljs-property">DeviceFlag</span>.<span class="hljs-property">INPUT_DEVICES_FLAG</span>, <span class="hljs-function">(<span class="hljs-params">deviceChanged: audio.DeviceChangeAction</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'device change type : '</span> + deviceChanged.<span class="hljs-property">type</span>);  <span class="hljs-comment">// 设备连接状态变化，0为连接，1为断开连接。</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'device descriptor size : '</span> + deviceChanged.<span class="hljs-property">deviceDescriptors</span>.<span class="hljs-property">length</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'device change descriptor : '</span> + deviceChanged.<span class="hljs-property">deviceDescriptors</span>[<span class="hljs-number">0</span>].<span class="hljs-property">deviceRole</span>);  <span class="hljs-comment">// 设备角色。</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'device change descriptor : '</span> + deviceChanged.<span class="hljs-property">deviceDescriptors</span>[<span class="hljs-number">0</span>].<span class="hljs-property">deviceType</span>);  <span class="hljs-comment">// 设备类型。</span></li><li>});</li><li>
</li><li><span class="hljs-comment">// 取消监听音频设备状态变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'deviceChange'</span>, <span class="hljs-function">(<span class="hljs-params">deviceChanged: audio.DeviceChangeAction</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Should be no callback.'</span>);</li><li>});</li></ol></pre></div></div>    </div>   </div>   <div></div></div>