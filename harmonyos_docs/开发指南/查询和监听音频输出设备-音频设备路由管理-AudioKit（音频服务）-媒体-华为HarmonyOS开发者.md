<h1 _ngcontent-wqs-c119="" class="doc-title ng-star-inserted" title="查询和监听音频输出设备"> 查询和监听音频输出设备 </h1>

<div _ngcontent-wqs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>应用可通过以下两种方式管理全局音频输出设备：</p>    <ul>     <li>通常情况下，可以<a href="/consumer/cn/doc/harmonyos-guides/audio-output-device-management#通过audioroutingmanager查询和监听音频输出设备">通过AudioRoutingManager查询和监听音频输出设备</a>。</li>     <li>从API version 20开始，AudioSessionManager提供了部分输出设备管理的接口，支持<a href="/consumer/cn/doc/harmonyos-guides/audio-output-device-management#通过audiosession查询和监听音频输出设备">通过AudioSession查询和监听音频输出设备</a>，方便在使用AudioSession管理音频焦点的同时管理音频输出。</li>    </ul>    <div class="tiledSection">     <h2 id="通过audioroutingmanager查询和监听音频输出设备">通过AudioRoutingManager查询和监听音频输出设备<i class="anchor-icon anchor-icon-link" anchorid="通过audioroutingmanager查询和监听音频输出设备" tips="复制节点链接"></i></h2>          <p>本模块提供音频输出设备管理能力，包括查询设备信息和监听连接状态变化。具体API说明请参考文档<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audioroutingmanager" target="_blank">AudioRoutingManager</a>。</p>    </div>    <div class="tiledSection">     <h3 id="创建audioroutingmanager实例" class="firsth2">创建AudioRoutingManager实例<i class="anchor-icon anchor-icon-link" anchorid="创建audioroutingmanager实例" tips="复制节点链接"></i></h3>          <p>在使用AudioRoutingManager管理音频设备前，需要先导入模块并创建实例。</p>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;  <span class="hljs-comment">// 导入audio模块。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();  <span class="hljs-comment">// 需要先创建AudioManager实例。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioRoutingManager = audioManager.<span class="hljs-title function_">getRoutingManager</span>();  <span class="hljs-comment">// 再调用AudioManager的方法创建AudioRoutingManager实例。</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="支持的音频输出设备类型">支持的音频输出设备类型<i class="anchor-icon anchor-icon-link" anchorid="支持的音频输出设备类型" tips="复制节点链接"></i></h3>          <p>目前支持的输出设备如下表所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.1" valign="top" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.2" valign="top" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.3" valign="top" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">EARPIECE</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">听筒。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SPEAKER</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">2</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">扬声器。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">WIRED_HEADSET</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">3</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">有线耳机，带麦克风。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">WIRED_HEADPHONES</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">4</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">有线耳机，无麦克风。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">BLUETOOTH_SCO</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">7</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">蓝牙设备SCO（Synchronous Connection Oriented）连接。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">BLUETOOTH_A2DP</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">8</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">蓝牙设备A2DP（Advanced Audio Distribution Profile）连接。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">USB_HEADSET</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">22</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">USB耳机，带麦克风。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="获取输出设备信息">获取输出设备信息<i class="anchor-icon anchor-icon-link" anchorid="获取输出设备信息" tips="复制节点链接"></i></h3>          <p>使用getDevices()方法可以获取当前所有输出设备的信息。</p>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>audioRoutingManager.<span class="hljs-title function_">getDevices</span>(audio.<span class="hljs-property">DeviceFlag</span>.<span class="hljs-property">OUTPUT_DEVICES_FLAG</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: audio.AudioDeviceDescriptors</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Promise returned to indicate that the device list is obtained.'</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听设备连接状态变化">监听设备连接状态变化<i class="anchor-icon anchor-icon-link" anchorid="监听设备连接状态变化" tips="复制节点链接"></i></h3>          <p>设置监听事件以监控设备连接状态的变化，设备连接或断开时触发回调。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>监听设备连接状态变化可以监听到全部的设备连接状态变化，不建议作为应用处理自动暂停的依据。应用如需处理自动暂停相关业务，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-output-device-change#音频流输出设备变更原因">音频流输出设备变更原因</a>。</p>      </div></div></div>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 监听音频设备状态变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'deviceChange'</span>, audio.<span class="hljs-property">DeviceFlag</span>.<span class="hljs-property">OUTPUT_DEVICES_FLAG</span>, <span class="hljs-function">(<span class="hljs-params">deviceChanged: audio.DeviceChangeAction</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device change type : <span class="hljs-subst">${deviceChanged.<span class="hljs-keyword">type</span>}</span>`</span>);  <span class="hljs-comment">// 设备连接状态变化，0为连接，1为断开连接。</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device descriptor size : <span class="hljs-subst">${deviceChanged.deviceDescriptors.length}</span>`</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device change descriptor : <span class="hljs-subst">${deviceChanged.deviceDescriptors[<span class="hljs-number">0</span>].deviceRole}</span>`</span>);  <span class="hljs-comment">// 设备角色。</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device change descriptor : <span class="hljs-subst">${deviceChanged.deviceDescriptors[<span class="hljs-number">0</span>].deviceType}</span>`</span>);  <span class="hljs-comment">// 设备类型。</span></li><li>});</li><li>
</li><li><span class="hljs-comment">// 取消监听音频设备状态变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'deviceChange'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取最高优先级输出设备信息">获取最高优先级输出设备信息<i class="anchor-icon anchor-icon-link" anchorid="获取最高优先级输出设备信息" tips="复制节点链接"></i></h3>          <p>使用getPreferOutputDeviceForRendererInfo()方法, 可以获取当前最高优先级的输出设备。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>最高优先级输出设备表示声音将在此设备输出的设备。</p>      </div></div></div>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>    <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>,<span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>    <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPreferOutputDeviceForRendererInfo</span>(<span class="hljs-params"></span>) {</li><li>  audioRoutingManager.<span class="hljs-title function_">getPreferOutputDeviceForRendererInfo</span>(rendererInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">desc: audio.AudioDeviceDescriptors</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device descriptor: <span class="hljs-subst">${desc}</span>`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Result ERROR: <span class="hljs-subst">${err}</span>`</span>);</li><li>  })</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听最高优先级输出设备变化">监听最高优先级输出设备变化<i class="anchor-icon anchor-icon-link" anchorid="监听最高优先级输出设备变化" tips="复制节点链接"></i></h3>          <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>    <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>    <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li>
</li><li><span class="hljs-comment">// 监听最高优先级输出设备变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'preferOutputDeviceChangeForRendererInfo'</span>, rendererInfo, <span class="hljs-function">(<span class="hljs-params">desc: audio.AudioDeviceDescriptors</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device change descriptor : <span class="hljs-subst">${desc[<span class="hljs-number">0</span>].deviceRole}</span>`</span>);  <span class="hljs-comment">// 设备角色。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`device change descriptor : <span class="hljs-subst">${desc[<span class="hljs-number">0</span>].deviceType}</span>`</span>);  <span class="hljs-comment">// 设备类型。</span></li><li>});</li><li>
</li><li><span class="hljs-comment">// 取消监听最高优先级输出设备变化。</span></li><li>audioRoutingManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'preferOutputDeviceChangeForRendererInfo'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过audiosession查询和监听音频输出设备">通过AudioSession查询和监听音频输出设备<i class="anchor-icon anchor-icon-link" anchorid="通过audiosession查询和监听音频输出设备" tips="复制节点链接"></i></h2>          <p>应用使用播放器的SDK播放音频流，不持有AudioRenderer对象，因此无法灵活控制播放设备的选择和状态监听。从API version 20开始，AudioSession不仅增加了焦点管理功能，还提供了音频输出设备管理功能，包括设置默认输出设备和监听设备变化。请参考以下文档获取更多信息：</p>     <ul>      <li>ArkTS API：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager" target="_blank">AudioSessionManager</a></li>      <li>C API：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h" target="_blank">OH_AudioSessionManager</a></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="创建audiosession实例" class="firsth2">创建AudioSession实例<i class="anchor-icon anchor-icon-link" anchorid="创建audiosession实例" tips="复制节点链接"></i></h3>          <p>在使用AudioSessionManager管理音频设备前，需要先导入模块并创建实例。</p>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;  <span class="hljs-comment">// 导入audio模块。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();  <span class="hljs-comment">// 需要先创建AudioManager实例。</span></li><li>
</li><li><span class="hljs-keyword">let</span> audioSessionManager = audioManager.<span class="hljs-title function_">getSessionManager</span>();  <span class="hljs-comment">// 再调用AudioManager的方法创建AudioSessionManager实例。</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置本机默认音频输出设备">设置本机默认音频输出设备<i class="anchor-icon anchor-icon-link" anchorid="设置本机默认音频输出设备" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setdefaultoutputdevice20" target="_blank">setDefaultOutputDevice</a>可以用于设置本机默认输出设备。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>由于AudioSession是应用级设置，调用本接口设置默认音频输出设备会覆盖AudioRenderer的setDefaultOutputDevice接口设置的音频输出设备信息。</li>        <li>调用setDefaultOutputDevice设置音频输出设备后，如需取消，可将参数设为audio.DeviceType.DEFAULT，将音频设备选择权交还给系统。否则，每次调用activateAudioSession时，应用选择的默认输出设备将生效。</li>       </ul>      </div></div></div>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为本机扬声器。</span></li><li>audioSessionManager.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">SPEAKER</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'setDefaultOutputDevice Success!'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setDefaultOutputDevice Fail: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 设置默认输出设备为默认设备，即取消应用设置的默认设备，交由系统选择设备。</span></li><li>audioSessionManager.<span class="hljs-title function_">setDefaultOutputDevice</span>(audio.<span class="hljs-property">DeviceType</span>.<span class="hljs-property">DEFAULT</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'setDefaultOutputDevice Success!'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setDefaultOutputDevice Fail: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="查询本机默认音频输出设备">查询本机默认音频输出设备<i class="anchor-icon anchor-icon-link" anchorid="查询本机默认音频输出设备" tips="复制节点链接"></i></h3>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#getdefaultoutputdevice20" target="_blank">getDefaultOutputDevice</a>查询本机默认输出设备类型。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>本接口用于查询通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setdefaultoutputdevice20" target="_blank">setDefaultOutputDevice</a>接口设置的输出设备。</p>      </div></div></div>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> deviceType = audioSessionManager.<span class="hljs-title function_">getDefaultOutputDevice</span>();</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getDefaultOutputDevice Success, deviceType: ${deviceType}'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听输出设备变化">监听输出设备变化<i class="anchor-icon anchor-icon-link" anchorid="监听输出设备变化" tips="复制节点链接"></i></h3>          <p>应用可以通过注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#currentoutputdevicechangedevent20" target="_blank">CurrentOutputDeviceChangedEvent</a>监听输出设备的连接状态变化。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>currentOutputDeviceChangedCallback 包含设备变更的原因及推荐的后续操作。应用应根据不同的变更原因进行处理，并按系统推荐的操作继续或停止当前播放。</p>      </div></div></div>     <div _ngcontent-wqs-c106="" class="highlight-div"><div _ngcontent-wqs-c106="" class="highlight-div-header"><div _ngcontent-wqs-c106="" class="highlight-div-header-left"><div _ngcontent-wqs-c106="" class="handle-button expand-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wqs-c106="" class="highlight-div-header-right"><div _ngcontent-wqs-c106="" class="handle-button ai-button"></div><div _ngcontent-wqs-c106="" class="handle-button line-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wqs-c106="" class="handle-button theme-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wqs-c106="" class="handle-button copy-button"><div _ngcontent-wqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wqs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 同一监听事件中，on方法和off方法传入callback参数一致，off方法取消对应on方法订阅的监听。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">currentOutputDeviceChangedCallback</span> = (<span class="hljs-params">currentOutputDeviceChangedEvent: audio.CurrentOutputDeviceChangedEvent</span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`reason of audioSessionStateChanged: <span class="hljs-subst">${currentOutputDeviceChangedEvent.changeReason}</span> `</span>);</li><li>
</li><li>  <span class="hljs-keyword">switch</span> (currentOutputDeviceChangedEvent.<span class="hljs-property">changeReason</span>) {</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_OLD_DEVICE_UNAVAILABLE</span>:</li><li>      <span class="hljs-comment">// 响应设备不可用事件，如果应用处于播放状态，应暂停播放，更新UX界面。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_NEW_DEVICE_AVAILABLE</span>:</li><li>      <span class="hljs-comment">// 应用根据业务情况响应设备可用事件。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_OVERRODE</span>:</li><li>      <span class="hljs-comment">// 应用根据业务情况响应设备强选事件。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_SESSION_ACTIVATED</span>:</li><li>      <span class="hljs-comment">// 应用根据业务情况响应audio session激活时的输出设备信息。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_STREAM_PRIORITY_CHANGED</span>:</li><li>      <span class="hljs-comment">// 应用根据业务情况响应其它更高优先级的音频流触发的设备变更事件。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioStreamDeviceChangeReason</span>.<span class="hljs-property">REASON_UNKNOWN</span>:</li><li>      <span class="hljs-comment">// 应用根据业务情况响应未知原因事件。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>};</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'currentOutputDeviceChanged'</span>, currentOutputDeviceChangedCallback);</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'currentOutputDeviceChanged'</span>, currentOutputDeviceChangedCallback);</li><li>
</li><li><span class="hljs-comment">// 取消该事件的所有监听。</span></li><li>audioSessionManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'currentOutputDeviceChanged'</span>);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>