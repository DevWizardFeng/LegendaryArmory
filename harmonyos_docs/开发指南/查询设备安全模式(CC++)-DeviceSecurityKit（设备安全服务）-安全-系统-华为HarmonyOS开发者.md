<h1 _ngcontent-kty-c119="" class="doc-title ng-star-inserted" title="查询设备安全模式(C/C++)"> 查询设备安全模式(C/C++) </h1>

<div _ngcontent-kty-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section372771910192">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section372771910192" tips="复制节点链接"></i></h2><p>Device Security Kit提供了系统安全模式的查询能力。通过调用Device Security Kit的接口，可以判断设备当前的安全模式（包含普通模式、坚盾守护模式），应用可根据设备当前的安全模式提供差异化的服务。</p> <ul><li>普通模式：操作系统默认模式，适用于绝大部分用户使用。</li><li>坚盾守护模式：提供给高安全需求用户的系统级别安全模式。该模式通过限制设备基础功能，增强安全性，有效抵御远程攻击面的针对性攻击。<p>坚盾守护模式下，操作系统禁止应用申请获取匿名内存可执行权限。</p> <p>应用应当根据系统安全模式进行自主适配，停用即时编译（JIT，Just-in-time compilation）功能或切换为解释执行。</p> </li></ul> </div> <div class="tiledSection"><h2 id="section121141650133414">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section121141650133414" tips="复制节点链接"></i></h2><ol><li><span>在CMakeLists.txt中导入设备安全模式共享库，并链接该库。</span><p></p><div _ngcontent-kty-c106="" class="highlight-div"><div _ngcontent-kty-c106="" class="highlight-div-header"><div _ngcontent-kty-c106="" class="highlight-div-header-left"><div _ngcontent-kty-c106="" class="handle-button expand-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kty-c106="" class="highlight-div-header-right"><div _ngcontent-kty-c106="" class="handle-button ai-button"></div><div _ngcontent-kty-c106="" class="handle-button line-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kty-c106="" class="handle-button theme-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kty-c106="" class="handle-button copy-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kty-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(dsm-lib libdevice_security_mode.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so ${dsm-lib})</li></ol></pre></div></div> <p></p></li><li><span>导入设备安全模式的头文件。</span><p></p><div _ngcontent-kty-c106="" class="highlight-div"><div _ngcontent-kty-c106="" class="highlight-div-header"><div _ngcontent-kty-c106="" class="highlight-div-header-left"><div _ngcontent-kty-c106="" class="handle-button expand-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kty-c106="" class="highlight-div-header-right"><div _ngcontent-kty-c106="" class="handle-button ai-button"></div><div _ngcontent-kty-c106="" class="handle-button line-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kty-c106="" class="handle-button theme-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kty-c106="" class="handle-button copy-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kty-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;DeviceSecurityKit/device_security_mode.h&gt;</span></span></li></ol></pre></div></div> <p></p></li><li><span>调用接口查询设备当前的安全模式。</span><p></p><div _ngcontent-kty-c106="" class="highlight-div"><div _ngcontent-kty-c106="" class="highlight-div-header"><div _ngcontent-kty-c106="" class="highlight-div-header-left"><div _ngcontent-kty-c106="" class="handle-button expand-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kty-c106="" class="highlight-div-header-right"><div _ngcontent-kty-c106="" class="handle-button ai-button"></div><div _ngcontent-kty-c106="" class="handle-button line-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kty-c106="" class="handle-button theme-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kty-c106="" class="handle-button copy-button"><div _ngcontent-kty-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kty-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">IsSecureShieldModeOn</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span></li><li><span class="hljs-function"></span>{</li><li>    DSM_DeviceSecurityMode mode = <span class="hljs-built_in">HMS_DSM_GetDeviceSecurityMode</span>();</li><li>    <span class="hljs-keyword">return</span> mode &amp; DSM_SECURE_SHIELD_MODE;</li><li>}</li></ol></pre></div></div> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>若应用使用到ArkWeb组件，需进一步参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-secure-shield-mode" target="_blank">说明</a>，进行Web特性的兼容性评估。</p> </div></div></div> </div> </div> <div></div></div>