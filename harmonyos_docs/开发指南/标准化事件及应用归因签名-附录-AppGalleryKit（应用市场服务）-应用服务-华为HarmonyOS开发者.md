<h1 _ngcontent-cho-c119="" class="doc-title ng-star-inserted" title="标准化事件及应用归因签名"> 标准化事件及应用归因签名 </h1>

<div _ngcontent-cho-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section5511921112018">标准转化事件信息<i class="anchor-icon anchor-icon-link" anchorid="section5511921112018" tips="复制节点链接"></i></h2></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.1.4.1.1" valign="top" width="33.33333333333333%"><p>定义值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.1.4.1.2" valign="top" width="33.33333333333333%"><p>回传值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.1.4.1.3" valign="top" width="33.33333333333333%"><p>含义说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>安装应用</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>应用安装完成</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>安装应用事件归因结果回传通过白名单方式向合作伙伴开放，默认不回传（白名单开放方式请联系华为运营）。</p> </div></div></div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>激活应用</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>历史首次激活应用</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>启动应用</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>打开应用</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>次日留存</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>次日仍然使用应用</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>付费</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>4</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>在应用内发生付费</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>提交表单</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>5</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>在应用内提交表单</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>授权</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>发生应用的授权</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>注册</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>7</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>注册应用或服务</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>关键页面访问</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>9</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>发生关键页面浏览行为</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>申请</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>14</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>申请服务</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>下单</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>18</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>将购物清单正式生成订单</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>预约</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>21</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>预约商品、内容或服务</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section4208115642013">归因来源签名计算规则<i class="anchor-icon anchor-icon-link" anchorid="section4208115642013" tips="复制节点链接"></i></h2><p>1.按照如下规则（字段顺序及分隔符）拼接待签名的字符串：</p> <div _ngcontent-cho-c106="" class="highlight-div"><div _ngcontent-cho-c106="" class="highlight-div-header"><div _ngcontent-cho-c106="" class="highlight-div-header-left"><div _ngcontent-cho-c106="" class="handle-button expand-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cho-c106="" class="highlight-div-header-right"><div _ngcontent-cho-c106="" class="handle-button ai-button"></div><div _ngcontent-cho-c106="" class="handle-button line-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cho-c106="" class="handle-button theme-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cho-c106="" class="handle-button copy-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cho-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>adTechId+ <span class="hljs-string">'\u2063'</span> + campaignId+ <span class="hljs-string">'\u2063'</span>  + destinationId+ <span class="hljs-string">'\u2063'</span> + serviceTag+ <span class="hljs-string">'\u2063'</span> + mmpIdStr + <span class="hljs-string">'\u2063'</span> + nonce + <span class="hljs-string">'\u2063'</span> + timestamp</li></ol></pre></div></div> <p>其中，mmpIdStr生成规则为：</p> <p>若归因监测平台的数组不为空，则将归因监测平台中的元素以'\u2063'为连接符进行拼接，假设mmpIds中有两个归因监测平台，拼接示例：</p> <div _ngcontent-cho-c106="" class="highlight-div"><div _ngcontent-cho-c106="" class="highlight-div-header"><div _ngcontent-cho-c106="" class="highlight-div-header-left"><div _ngcontent-cho-c106="" class="handle-button expand-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cho-c106="" class="highlight-div-header-right"><div _ngcontent-cho-c106="" class="handle-button ai-button"></div><div _ngcontent-cho-c106="" class="handle-button line-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cho-c106="" class="handle-button theme-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cho-c106="" class="handle-button copy-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cho-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>mmpIdStr = mmpId1 + <span class="hljs-string">'\u2063'</span> + mmpId2</li></ol></pre></div></div> <p>2.使用分发平台在应用归因服务云侧注册角色时，提供的公钥所对应的私钥，对步骤1拼接的字符串进行签名计算（签名算法：SHA256withRSA/PSS；生成密钥位数：RSA3072）。</p> <p>3.接口中字段不为空则参与签名/验签，否则不参与签名/验签。</p> </div> <div class="tiledSection"><h2 id="section5203225132112">生成签名方法<i class="anchor-icon anchor-icon-link" anchorid="section5203225132112" tips="复制节点链接"></i></h2><p>您可以参考如下代码生成签名，也可以自行生成签名。</p> <div _ngcontent-cho-c106="" class="highlight-div"><div _ngcontent-cho-c106="" class="highlight-div-header"><div _ngcontent-cho-c106="" class="highlight-div-header-left"><div _ngcontent-cho-c106="" class="handle-button expand-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cho-c106="" class="highlight-div-header-right"><div _ngcontent-cho-c106="" class="handle-button ai-button"></div><div _ngcontent-cho-c106="" class="handle-button line-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cho-c106="" class="handle-button theme-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cho-c106="" class="handle-button copy-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cho-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">AegRsaSign</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@hw-agconnect/petal-aegis"</span>;  <span class="hljs-comment">//具体引用方法参考本示例代码底部说明</span></li><li>
</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'SignUtil'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">SEPARATOR</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'\u2063'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignUtil</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">genSignContent</span>(<span class="hljs-params">adTechId: <span class="hljs-built_in">string</span>, campaignId: <span class="hljs-built_in">string</span>, destinationId: <span class="hljs-built_in">string</span>, mmpIds: <span class="hljs-built_in">string</span>[], serviceTag: <span class="hljs-built_in">string</span>, nonce: <span class="hljs-built_in">string</span>, timestamp: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-comment">// mmpIdStr = mmpId1 + '\u2063' + mmpId2</span></li><li>    <span class="hljs-comment">// signContent:string= adTechId+ '\u2063' + campaignId+ '\u2063'  + destinationId+ '\u2063' + serviceTag+ '\u2063' + mmpIdStr + '\u2063' + nonce + '\u2063' + timestamp</span></li><li>    <span class="hljs-keyword">let</span> content = <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(adTechId)</li><li>      + <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(campaignId)</li><li>      + <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(destinationId)</li><li>      + <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(serviceTag)</li><li>      + <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">genMmpIds</span>(mmpIds)</li><li>      + <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(nonce)</li><li>      + timestamp;</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>,<span class="hljs-variable constant_">TAG</span>,<span class="hljs-string">`content = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(content)}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span> content;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">addSeparator</span>(<span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> value ? value + <span class="hljs-variable constant_">SEPARATOR</span> : <span class="hljs-string">''</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">genMmpIds</span>(<span class="hljs-params">mmpIds: <span class="hljs-built_in">string</span>[]</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> mmpId <span class="hljs-keyword">of</span> mmpIds) {</li><li>      <span class="hljs-keyword">if</span> (mmpId) {</li><li>        result += <span class="hljs-title class_">SignUtil</span>.<span class="hljs-title function_">addSeparator</span>(mmpId);</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getSign</span>(<span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">privateKey</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">AegRsaSign</span>.<span class="hljs-title function_">ohAegSignRSAWithPSSTextBase64</span>(content, privateKey).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">sign</span>: <span class="hljs-built_in">string</span>) =&gt; {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"getSign success."</span>);</li><li>        <span class="hljs-title function_">resolve</span>(sign);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`getSign failed. code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);      </li><li>      });</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>其中import {AegRsaSign} from "@hw-agconnect/petal-aegis" ， 使用AegRsaSign.ohAegSignRSAWithPSSTextBase64生成签名，使用方法如下:</p> <p>执行安装命令：ohpm i @hw-agconnect/petal-aegis</p> <p>具体的接口使用方法，请参见<a href="https://developer.huawei.com/consumer/cn/doc/AppGallery-connect-References/ohaegsignrsawithpsstextbase64-0000001864508922" target="_blank">ohAegSignRSAWithPSSTextBase64</a>。</p> </div></div></div> </div> </div> <div></div></div>