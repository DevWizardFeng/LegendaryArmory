<h1 _ngcontent-wwh-c119="" class="doc-title ng-star-inserted" title="案例：ArkTS内存泄漏分析"> 案例：ArkTS内存泄漏分析 </h1>

<div _ngcontent-wwh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001883411885"><p id="ZH-CN_TOPIC_0000002478334472__p743816437238">本案例介绍如何判断应用存在ArkTS泄漏，以及如何通过快照对比找出ArkTS内存泄漏的原因。</p> <div class="tiledSection"><h2 id="section15142160162910">初步识别内存问题<i class="anchor-icon anchor-icon-link" anchorid="section15142160162910" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002478334472__ol343717150295"><li id="li11938105618435"><span>使用实时监控功能（详细使用方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/realtime-monitor">性能问题定界：实时监控</a>）对应用的内存资源进行监控。正常操作应用，观察运行过程中的应用内存变化情况。当在一段时间内应用内存没有明显增加或者在内存上涨后又逐渐回落至正常水平，则基本可以排除应用存在内存问题；反之，在一段时间内不断上涨且无回落或者内存占用明显增长超出预期，那么则可初步判断应用可能存在内存问题。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p105419711476"><span><img height="392.3376687116565" originheight="655" originwidth="1544" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104935.51659218145369209470800188879832:50001231000000:2800:37D99E258A0783E8449546CA735997C2031CCEEFBF118B5393C85C8BBD455F37.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li8415612144411"><span>当从实时监控页面初步判断应用可能存在内存问题后，可以使用Memory泳道来抓取应用内存在问题场景下的详细数据以及变化趋势，初步定界问题出现的位置。Allocation或Snapshot模板中均有Memory泳道，使用Allocation或Snapshot模板录制均可。</span></li><li id="li1251093504416"><span>创建模板后，将模板中的其余泳道去除勾选，仅录制Memory泳道的数据。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334472__p2912917205113">其余泳道会开启对内存分配、内存对象等数据的抓取，这些功能会带来额外的开销，可能会对我们初步定界问题产生噪音，影响分析，故先排除录制。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002478334472__p1390961135117"><span><img originheight="230" originwidth="427" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104935.28371513064551414307936100117649:50001231000000:2800:3B96AC8B113A93CD4A02AF36AF78914A65D4D0AC655672D69C5194384C1C22AF.png" width="427" height="230"></span></p> <p></p></li><li id="li9563918174913"><span>点击三角按钮<span><img height="20.136998" originheight="21" originwidth="22" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104935.83316636456069320987285161891093:50001231000000:2800:BF350551C0678534CEDCF4299541FEB2F60EC9B14DEAA265723E7880248C7681.png" width="20.882862" class="IconPic notEnlarge"></span>即开始录制。</span></li><li id="li2068013619454"><span>录制过程中，不断操作应用在问题场景的功能，将问题放大，便于快速定界问题点。</span></li><li id="li24294397545"><span>点击下图中方块按钮或者左侧停止按钮结束录制。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p145825436544"></p> <p id="ZH-CN_TOPIC_0000002478334472__p148241415102620"><span><img height="313.04834355828217" originheight="632" originwidth="1869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104935.03613327932980080628756875841870:50001231000000:2800:96CD255661595858A13BE177EF30810BA782BEFE3A23402EB930C9D092F31606.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li99643131467"><span>录制完成后，展开Memory泳道，其中ArkTS Heap表示方舟虚拟机内存，这部分内存受到方舟虚拟机的管控。Native Heap表示Native内存，主要是应用使用到的一些涉及Native的API所申请的内存以及开发者自己的Native代码所申请使用的堆内存（通常是C/C++），这部分内存需要开发者自行管理申请和释放。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p19991015184616">当ArkTS Heap有明显的上涨，说明在方舟虚拟机内的堆内存上可能存在内存泄漏，可以使用Snapshot模板进行下一步分析；当Native Heap有明显的上涨，说明Native内存上可能存在内存泄漏，可以使用Allocation模板进行下一步分析。</p> <p id="ZH-CN_TOPIC_0000002478334472__p17529105111575"><span><img height="133.54110429447852" originheight="219" originwidth="1544" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.46078224057351398882429170691456:50001231000000:2800:615893922EC30F9F4F03F145C8394528C83810D0832A2FC4B488A5DACA02170C.png" title="点击放大" width="920"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section15386630278">使用Snapshot模板分析ArkTS内存问题<i class="anchor-icon anchor-icon-link" anchorid="section15386630278" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section221410397272" class="firsth2">分析步骤<i class="anchor-icon anchor-icon-link" anchorid="section221410397272" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002478334472__p1634142655014">分析内存泄漏问题步骤如下：</p> <ol id="ZH-CN_TOPIC_0000002478334472__ol1279765425"><li id="li1442518044710">使用Snapshot模板录制数据；</li><li id="li2079719515219">在问题场景前拍摄快照；</li><li id="li147971456215">触发问题场景后，再次拍摄快照；</li><li id="li47971051210">对比两次快照的数据，可快速找到泄漏对象并做进一步分析；</li><li id="li47971455210">当有多个对象在比较视图都存在时，可以重复多次触发问题场景后拍摄快照，分别和问题场景前拍摄的快照进行对比，观察是否有对象出现明显的线性变化趋势，进一步缩小泄漏对象的范围。</li></ol> <div class="tiledSection"><h3 id="section292715574272">录制Snapshot模板数据<i class="anchor-icon anchor-icon-link" anchorid="section292715574272" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002478334472__ol46965533469"><li id="li17696165344611"><span>连接设备后启动应用，点击应用选择框选择需要录制的应用，选择<strong>Snapshot</strong>模板，点击Create Session或双击Snapshot图标即可创建一个Snapshot的录制模板。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p891314559462"></p> <p></p></li><li id="li569610535464"><span>创建模板后，点击三角按钮即开始录制。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p155175818469"><span><img height="170.5442944785276" originheight="283" originwidth="1553" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.28856140848413854378601718816346:50001231000000:2800:EEB2A203B6798667D54424635E6F848DC78C19023A495CA7DC70C206F125E584.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li169675318466"><span>待右侧泳道全部显示recording后则表明正在录制中。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p2644820164712"></p> <p id="ZH-CN_TOPIC_0000002478334472__p172060211295"><span><img height="313.2176687116565" originheight="632" originwidth="1868" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.79187697897290179545764158500162:50001231000000:2800:4393DA403E7A4B0134FD7FB2636CDE5484813B4774AF0A4965178833BE33887B.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li06961453154612"><span>拍摄第一次堆快照作为基准（点击图中①处拍摄按钮，待②处显示出紫色条块表示快照拍摄完成）。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334472__p1780815111552">方舟虚拟机提供了在获取快照前自动GC（Garbage Collection，对堆内存进行垃圾回收）的能力，因此拍摄快照之前不用主动触发GC。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002478334472__p1736317549541"><span><img height="281.9715337423313" originheight="424" originwidth="1397" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.63265935290150703061869963201303:50001231000000:2800:5A1AC2C5E343599A695883331FE01AC616F0B9BF4CE27FBCEF6B6B9B5E3C344F.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li92198271167"><span>多次触发内存泄漏操作。可以操作5，7，11等这种特殊的次数。比如操作了5次对比两个快照发现有很多创建了5次没释放的场景，则可能存在内存泄漏，再操作7次，如果创建了7次那就可以确认发生了泄漏。</span></li><li id="li18772831661"><span>拍摄第二次堆快照。</span></li><li id="li5155539761"><span>点击下图中方块按钮或者左侧停止按钮结束录制。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p315814251474"></p> <p id="ZH-CN_TOPIC_0000002478334472__p179668237716"><span><img height="313.3531288343558" originheight="634" originwidth="1873" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.96829523188196041416225657639987:50001231000000:2800:BCFA371C13834A20561AFD684DDA0764B7870D0C0AA0CB2C1807921EDC32BE10.png" title="点击放大" width="920"></span></p> <p></p></li></ol> <div class="tiledSection"><h3 id="section1960718151287">分析ArkTS Heap<i class="anchor-icon anchor-icon-link" anchorid="section1960718151287" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002478334472__ol7517172213118"><li id="li10517112201114"><span>在每次拍摄堆快照之前，虚拟机都会触发GC，所以理论上堆快照内存在的对象都是当前虚拟机已经无法GC掉的对象。我们可以将两个堆快照进行比较，来查看哪些对象是在触发问题场景时新增了且不能释放的。切换到窗口下方详情区域的“Comparison”页签，将两次快照进行对比。图中数据的含义是以Snapshot2作为基准，Snapshot2对比Snapshot1的数据变化量。</span><p></p><p id="ZH-CN_TOPIC_0000002478334472__p1827282251216"><span><img height="332.76703296703295" originheight="555" originwidth="1545" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.54161263565218219223518142675051:50001231000000:2800:A182D99C07A6070AB52FF6509B15D2782EFA17C1D2F8906A115FDB49FCB8A56F.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li89227351216"><span>优先寻找与触发内存泄漏操作次数强相关、与业务代码强相关的Constructor，首先来分析这些对象是否正常。主要是按照Distance逐渐减小的方式找引用链，可以从references里面一层层去寻找，排查引用链上的可疑对象（一般指与业务代码关联的对象）。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334472__p895716536128">选择一个实例结点，底部搜索栏的Path to GC Root按钮成可点击状态。点击该按钮，系统会计算从GC Roots垃圾收集器根到选定实例对象的最短路径（最短路径是指Distance逐渐-1的路径，最终抵达Distance = 1的结点），并在右侧区域展示。</p> </div></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section87474517134">分析Snapshot数据<i class="anchor-icon anchor-icon-link" anchorid="section87474517134" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section135057191135" class="firsth2">常见对象介绍<i class="anchor-icon anchor-icon-link" anchorid="section135057191135" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478334472__p1441081425118"><strong>JSArray</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p74101814185116">目前所有JSArray展开后为数组里的各个元素：</p> <p id="ZH-CN_TOPIC_0000002478334472__p14825162213256"><span><img originheight="241" originwidth="452" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.29193076591150934000309212894432:50001231000000:2800:C14235819BFB32F1157EB7BFE7328315E9F701BA5F03DED0A2294136FCE516BF.png" width="452" height="241"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p641031465113">其中__proto__：原型对象，所有数组的__proto__应该是一致的；length：内置属性访问器，可以访问数组长度。</p> <p id="ZH-CN_TOPIC_0000002478334472__p13410151445117"><strong>TaggedDict</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p6410214145114">位于(array)标签中，一般为虚拟机内部创建的字典，ArkTS代码层面不可见。</p> <p id="ZH-CN_TOPIC_0000002478334472__p13410161418511"><strong>TaggedArray</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p16410121410512">位于(array)标签中，一般为虚拟机内部创建的数组，ArkTS代码层面不可见。</p> <p id="ZH-CN_TOPIC_0000002478334472__p164101514135111"><strong>COWArray</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p18410414115112">位于(array)标签中，一般为虚拟机内部创建的数组，ArkTS代码层面不可见。</p> <p id="ZH-CN_TOPIC_0000002478334472__p2410141455119"><strong>JSObject</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p741031465114">JSObject展开后为内部的各个属性如下：</p> <p id="ZH-CN_TOPIC_0000002478334472__p1082632232512"><span><img originheight="202" originwidth="445" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.79245398297263081027712993035382:50001231000000:2800:B52DDFEA5E6B14E9B9A31ECEAD1322C187E2DF47CEE5FC39F126098459759249.png" width="445" height="202"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p1741061415113">以下通过具体代码来介绍下实例化对象、声明对象、构造函数间的关系：</p> <div _ngcontent-wwh-c106="" class="highlight-div"><div _ngcontent-wwh-c106="" class="highlight-div-header"><div _ngcontent-wwh-c106="" class="highlight-div-header-left"><div _ngcontent-wwh-c106="" class="handle-button expand-button"><div _ngcontent-wwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wwh-c106="" class="highlight-div-header-right"><div _ngcontent-wwh-c106="" class="handle-button ai-button"></div><div _ngcontent-wwh-c106="" class="handle-button line-button"><div _ngcontent-wwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wwh-c106="" class="handle-button theme-button"><div _ngcontent-wwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wwh-c106="" class="handle-button copy-button"><div _ngcontent-wwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wwh-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478334472__screen08173324417" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// </span><span class=""><span class="hljs-comment">HelloWorldPage</span></span><span class="hljs-comment">.ets</span></li><li><span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">People</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-attr">old</span></span><span class="">: </span><span class=""><span class="hljs-built_in">number</span></span></li><li>  <span class=""><span class="hljs-attr">name</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span></li><li>  <span class="hljs-title function_">constructor</span><span class="">(</span><span class=""><span class="hljs-params">old</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params"><span class="hljs-built_in">number</span></span></span><span class=""><span class="hljs-params">, </span></span><span class=""><span class="hljs-params">name</span></span><span class=""><span class="hljs-params">: </span></span><span class=""><span class="hljs-params"><span class="hljs-built_in">string</span></span></span><span class="">) </span><span class="">{</span></li><li>    <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">old</span> </span><span class="">= </span><span class="">old</span><span class="">;</span></li><li>    <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">name</span> </span><span class="">= </span><span class="">name</span><span class="">;</span></li><li>  <span class="">}</span></li><li>  <span class=""><span class="hljs-title function_">printOld</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">log</span></span><span class="">(</span><span class=""><span class="hljs-string">"old = "</span></span><span class="">, </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">old</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li>  <span class=""><span class="hljs-title function_">printName</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">log</span></span><span class="">(</span><span class=""><span class="hljs-string">"name = "</span></span><span class="">, </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">name</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li><li>
</li><li><span class=""><span class="hljs-meta">@Entry</span></span></li><li><span class=""><span class="hljs-meta">@Component</span></span></li><li>struct <span class=""><span class="hljs-title class_">HelloWorldPage</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-meta">@State</span> </span><span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span> </span><span class="">= </span><span class=""><span class="hljs-string">'Hello World'</span></span><span class="">;</span></li><li>  <span class="hljs-keyword">private</span> <span class=""><span class="hljs-attr">people</span></span><span class="">: </span><span class=""><span class="hljs-title class_">People</span> </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">People</span></span><span class="">(</span><span class=""><span class="hljs-number">20</span></span><span class="">, </span><span class=""><span class="hljs-string">"Tom"</span></span><span class="">)</span><span class="">;</span></li><li>
</li><li>  <span class=""><span class="hljs-title function_">build</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-title class_">Row</span></span><span class="">() </span><span class="">{</span></li><li>      <span class=""><span class="hljs-title class_">Column</span></span><span class="">() </span><span class="">{</span></li><li>        <span class=""><span class="hljs-title class_">Text</span></span><span class="">(</span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span></li><li>          <span class="">.</span><span class=""><span class="hljs-title function_">fontSize</span></span><span class="">(</span><span class=""><span class="hljs-number">50</span></span><span class="">)</span></li><li>          <span class="">.</span><span class=""><span class="hljs-title function_">fontWeight</span></span><span class="">(</span><span class=""><span class="hljs-title class_">FontWeight</span></span><span class="">.</span><span class=""><span class="hljs-property">Bold</span></span><span class="">)</span></li><li>      <span class="">}</span></li><li>      <span class="">.</span><span class=""><span class="hljs-title function_">width</span></span><span class="">(</span><span class=""><span class="hljs-string">'100%'</span></span><span class="">)</span></li><li>    <span class="">}</span></li><li>    <span class="">.</span><span class=""><span class="hljs-title function_">height</span></span><span class="">(</span><span class=""><span class="hljs-string">'100%'</span></span><span class="">)</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478334472__p2041071435119">采集到的snapshot数据如下：</p> <p id="ZH-CN_TOPIC_0000002478334472__p583113223257"><span><img originheight="197" originwidth="833" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.88420695336651037653238387369027:50001231000000:2800:2FB32B505B83EB3CB2D501E3F90AE98E48EFDFD5F2CF208ED8E2BCE8742ED0B4.png" width="833" height="197"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p14410714205111">202169对象对应的是People，其主要声明了对象的属性和方法。</p> <p id="ZH-CN_TOPIC_0000002478334472__p144106143519">实例化对象的__proto__属性指向声明时的对象，声明对象里则会有constructor构造函数。当实例化多个对象时，实例化对象会有多个，但是声明对象和构造函数只有一个。</p> <p id="ZH-CN_TOPIC_0000002478334472__p641041414515"><strong>JSFunction</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p1841018146513">目前所有JSFunction都在(closure)标签中，展开即可看到所有JSFunction：</p> <p id="ZH-CN_TOPIC_0000002478334472__p11832422152515"><span><img height="276.8661" originheight="359" originwidth="783" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.39060573092975762765933952520834:50001231000000:2800:20D79CE79A0B4988DA19E98FEE9DEC5B69A2B91C02F1AA11B94466B0EBF3B6BC.png" title="点击放大" width="598.5"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p1641091414512">每个函数展开后为函数内的各个属性：</p> <p id="ZH-CN_TOPIC_0000002478334472__p88321220257"><span><img originheight="222" originwidth="471" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.93349312912049630392282978897146:50001231000000:2800:9D7470ED98E982B34B8168CFA8F97975211ADC1A2B022250654A7A07D346B7D6.png" width="471" height="222"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p17410131412515">其中HomeObject表示父类对象，即该方法属于哪个对象；_proto_表示原型对象；LexicalEnv表示该函数的闭包上下文；name是内置属性访问器，可获取函数名；FunctionExtraInfo表示额外信息，比如一些napi接口会在这里记录函数地址；ProtoOrHClass表示原型或者隐藏类。</p> <p id="ZH-CN_TOPIC_0000002478334472__p104101314175111">如果函数显示为anonymous()，则表示为匿名函数；如果函数显示为JSFunction()，则表示该函数可能为框架层函数，创建函数的时候未设置函数名。对于这两种函数名不可见的情况，可以通过查看其引用来间接确认其名称：</p> <p id="ZH-CN_TOPIC_0000002478334472__p198331122122518"><span><img originheight="144" originwidth="776" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.41528372370487469275333851090983:50001231000000:2800:BA030F02E643D76FB46DA1DDF7FDBA243CC60A04ABF0131C748CD8D4C002A027.png" width="776" height="144"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p1041021425116"><strong>ArkInternalConstantPool</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p17410714165110">虚拟机创建的常量池，ArkTS代码层面不可见，涉及到的字符串常量会在(array)标签中展示：</p> <p id="ZH-CN_TOPIC_0000002478334472__p13834102217250"><span><img height="244.38750000000002" originheight="282" originwidth="604" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.54139262648329119587165693893366:50001231000000:2800:66E5577FBA34AB684792F7A915335C7ED27C5BD582DDFD71A4BA921C050C4389.png" title="点击放大" width="523.6875"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p1841131425114"><strong>LexicalEnv</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p19411101416513">闭包变量上下文；闭包是一个链状结构，如下所示：</p> <p id="ZH-CN_TOPIC_0000002478334472__p2834132217251"><span><img originheight="180" originwidth="521" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.85035216999046619945117167292668:50001231000000:2800:ED7EC996D4847B7AF34677877E698FC8C4A09736E2E5094C40EE384AAB6D15CB.png" width="521" height="180"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p14411131412511">733这个节点本身是一个闭包数组，其中0号元素是调用者（或者再往上的调用者，以此类推）的闭包；1号元素存储的是调试信息；2号及以后的元素存储的就是闭包传递的变量，上例传递了一个变量。</p> <p id="ZH-CN_TOPIC_0000002478334472__p1541112142519"><strong>InternalAccessor</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p11411141417517">内置属性访问器，会有getter和setter方法，通过getter、setter可以获取、设置该属性。</p> </div> <div class="tiledSection"><h3 id="section1324616318146">分析方法<i class="anchor-icon anchor-icon-link" anchorid="section1324616318146" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478334472__p164111514145117"><strong>查看对象名称</strong></p> <p id="ZH-CN_TOPIC_0000002478334472__p943784474010">对于声明对象，可以通过constructor属性来确定对象名称。</p> <p id="ZH-CN_TOPIC_0000002478334472__p16760144694017"><span><img originheight="196" originwidth="847" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.84426561558580093135413138801581:50001231000000:2800:A03E90FD554DE91421EA2BCAE29EB1FDE5C0721F758C0111C17932E05AF2BDE5.png" width="847" height="196"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p6288105419400">对于实例化对象，一般没有constructor，则需要展开__proto__属性后查找constructor；</p> <p id="ZH-CN_TOPIC_0000002478334472__p203121555104019"><span><img originheight="298" originwidth="862" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104936.28906186095581781505303678827427:50001231000000:2800:7C817C0D8051B1A537978D84F341097BFC6F804FE5875E737A8A7C8DDB16DAD3.png" width="862" height="298"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p14115144518">若对象里有一些标志性属性，可以通过在代码里搜索属性名称来找到具体是哪个对象。</p> <p id="ZH-CN_TOPIC_0000002478334472__p1141141410511">如果对象间有继承关系，则可以继续展开__proto__：</p> <p id="ZH-CN_TOPIC_0000002478334472__p483618220255"><span><img originheight="299" originwidth="859" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104937.79575172440179218986492730588729:50001231000000:2800:5A573F27FD26981420E009CAB5D4082AD8C753317528F7395B6D31AF4EFBFE1F.png" width="859" height="299"></span></p> <p id="ZH-CN_TOPIC_0000002478334472__p204110146516">如上图则表明Man对象继承自People对象。</p> </div> </div> <div></div></div>