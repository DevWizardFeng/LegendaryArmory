<h1 _ngcontent-usm-c119="" class="doc-title ng-star-inserted" title="案例：使用Frame模板分析应用卡顿问题"> 案例：使用Frame模板分析应用卡顿问题 </h1>

<div _ngcontent-usm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000002284193962"><p id="ZH-CN_TOPIC_0000002510294457__p8608161712818">本案例介绍如何判断应用存在卡顿帧，再通过调用栈和trace信息分析应用运行逻辑，找出应用卡顿的原因。</p> <p id="ZH-CN_TOPIC_0000002510294457__p56081117192813">应用卡顿分析基础功能请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-frame">Frame分析</a>。</p> <div class="tiledSection"><h2 id="section876382810381">分析步骤<i class="anchor-icon anchor-icon-link" anchorid="section876382810381" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510294457__p9975135533818">分析应用卡顿类问题步骤如下：</p> <ol id="ZH-CN_TOPIC_0000002510294457__ol119751155143814"><li id="li39759557382">确认是否存在卡顿帧。</li><li id="li14975755133810">若存在卡顿帧，根据调用栈和trace等信息进一步确定问题点。</li></ol> </div> <div class="tiledSection"><h2 id="section116411449153910">分析Frame数据<i class="anchor-icon anchor-icon-link" anchorid="section116411449153910" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1483165342919" class="firsth2">分析应用是否存在卡顿<i class="anchor-icon anchor-icon-link" anchorid="section1483165342919" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002510294457__ol64682021174314"><li id="li846810213433"><span>框选Frame泳道，窗口下方的“Statistics”区域中会以进程维度对选定时间段内的Frame信息进行统计，当Jank Count大于0时，说明存在卡顿帧。</span><p></p><p id="ZH-CN_TOPIC_0000002510294457__p12781201854515"><span><img height="247.247" originheight="473" originwidth="1558" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.04985502091499214363052726377321:50001231000000:2800:8911894145F7B95B845AC3ED5310A8F751D144552FBFA0CAE50022FD5EB4C832.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li16591611124414"><span>找到“Statistics”页签中存在卡顿帧的进程，点击进程名称后方跳转按钮，跳转到“Frame List”页签。</span><p></p><p id="ZH-CN_TOPIC_0000002510294457__p20892249114517"><span><img height="89.1765" originheight="125" originwidth="1180" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.33943556314232334201495455945156:50001231000000:2800:ACB6E206CBC28BEDD7679F764D1C22F1ACAD4054276F623F9D8AD83CB3BE8A02.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li1626912355446"><span>“Frame List”页签会展现该进程对应的Frame列表。在“Frame List”页签中对卡顿丢帧类型（Jank Type）进行升序排序，单击“Frame List”页签中任意一卡顿帧，直接跳转到该帧且泳道上该帧被反选。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510294457__ul2051216454813"><li id="li16956136164813">在“RS Frame”和“App Frame”标签的泳道中，正常完成渲染的帧显示为绿色，出现卡顿的帧显示为红色。</li><li id="li751313494819">AppDeadlineMissed：App侧的卡顿。</li></ul> </div></div></div> <p id="ZH-CN_TOPIC_0000002510294457__p1850911423476"><span><img height="337.80670000000003" originheight="643" originwidth="1545" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.71610520233218455924684971064820:50001231000000:2800:748F15EEAEF75879487843D2B2F00EE2CF71058868AD6BBEF3EF6CF513419F52.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li4171949104416"><span>点选该卡顿帧，窗口下方的“Details”区域中显示卡顿帧的关键信息。右侧应用进程前方跳转按钮可以跳转到应用进程Trace。</span><p></p><ul id="ZH-CN_TOPIC_0000002510294457__ul16181182115511"><li id="li151811021195118">Expected Duration：一帧绘制的期望耗时。与fps的大小有关，如fps为120，对应的Vsync周期为8.3ms，即App侧/Render Service侧的帧耗时，一般需要在8.3ms以内。</li><li id="li1418132117515">Actual Duration：一帧绘制的实际耗时。</li></ul> <p id="ZH-CN_TOPIC_0000002510294457__p4663102816484">如下图，可以看到该帧的期望耗时为8ms 330μs，实际耗时为44ms54μs，远远超过了期望耗时，因此被识别为卡顿帧。</p> <p id="ZH-CN_TOPIC_0000002510294457__p15925123119483"><span><img height="338.4185" originheight="645" originwidth="1547" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.01433007805738796320038687390772:50001231000000:2800:8CD437E92FA9BB30E059AABFBF4B49D857D561D7800458490ECD62A7A8FD8185.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li889514017459"><span>框选该异常帧时间范围，结合ArkTS Callstack泳道、Callstack泳道和Trace等信息进一步分析异常点。</span></li></ol> <div class="tiledSection"><h3 id="section1080019813301">案例：分析应用卡顿原因<i class="anchor-icon anchor-icon-link" anchorid="section1080019813301" tips="复制节点链接"></i></h3></div> <ol id="ZH-CN_TOPIC_0000002510294457__ol15379142162320"><li id="li15379182122311"><span>找到并框选要分析的异常帧，查看ArkTS Callstack泳道分析ArkTS侧耗时函数。优先查看主线程调用栈，即线程号与进程号一致的ArkVM子泳道。可以看到ArkTS侧一些方法的耗时。</span></li><li id="li2717284232"><span>查看下图调用栈，除(program)外，其他调用栈耗时小于一帧绘制的期望耗时8.3ms（被调优的设备fps为120），因此该卡顿帧主要分析调用栈(program)的耗时。</span><p></p><p id="ZH-CN_TOPIC_0000002510294457__p52721115391">(program)代表程序执行进入纯Native代码阶段，该阶段无ArkTS代码执行，也无ArkTS调用Native或者Native调用ArkTS情况，一般很难通过这里分析出有效的信息，需要切换到Callstack泳道看具体的调用栈信息。</p> <p id="ZH-CN_TOPIC_0000002510294457__p1929216982313"><span><img height="269.97670000000005" originheight="513" originwidth="1546" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.13623602553492991273737903794690:50001231000000:2800:069482F133CB0AB155B70B0F9455329ED5E21698EB96F57186A1F92BFECF2AC7.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li63303265233"><span>切换到Callstack泳道，查看Callstack泳道的主线程（线程号与进程号一致）子泳道，滑动观察下方Heaviest Stack区域“%”列中占比最大的函数调用栈，Category中亮色代表开发者调用栈，灰色代表系统调用栈，可以看出下图中耗时主要在系统侧的so，无法识别具体异常原因，接下来进一步分析应用进程Trace。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294457__p4913432165810">也可通过底部的“Call Trees”选择框来隐藏系统调用栈，减少干扰信息。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002510294457__p833512142317"><span><img height="313.17510000000004" originheight="598" originwidth="1551" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.97974380505319840592459244420684:50001231000000:2800:D1D7B89B164432DE22FC7E9B05C7C3CAA92428C87CD82B0D528E1B6BE912CBAA.png" title="点击放大" width="807.3100000000001"></span></p> <p id="ZH-CN_TOPIC_0000002510294457__p39669369230"></p> <p></p></li><li id="li1134164192316"><span>切换到应用进程Trace泳道，查看应用进程Trace，窗口下方详情区可查看到Trace统计信息列表。逐层展开耗时最长的Trace，定位到主要耗时是在3次H:CreateImagePixelMap。接下来进一步分析这3次H:CreateImagePixelMap耗时的原因。</span><p></p><p id="ZH-CN_TOPIC_0000002510294457__p195251421185118"><span><img height="498.2712" originheight="984" originwidth="1598" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.85114717061635473586957598570351:50001231000000:2800:8DE63EC93F2D10BF8FA122239CBDE1E990E59E4F6D12809F93A58C2E88A4E222.png" title="点击放大" width="807.3100000000001"></span></p> <p></p></li><li id="li8946191942410"><span>H:CreateImagePixelMap和图片加载相关，再结合业务代码查看，可以看到是因为同步加载网络图片，建议修改为异步加载。</span><p></p><p id="ZH-CN_TOPIC_0000002510294457__p43591713152419"><span><img height="140.9268" originheight="241" originwidth="1409" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104942.49158882679588380232461468567786:50001231000000:2800:E71820DC48F82702105745F09B814426F8AD9CF4138599FFD8216198E388D3C2.png" title="点击放大" width="807.3100000000001"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294457__p022901961219">一般情况下，图片加载流程会异步进行，以避免阻塞主线程，影响UI交互。不建议图片加载较长时间时使用同步加载。</p> </div></div></div> <p></p></li></ol> <p id="ZH-CN_TOPIC_0000002510294457__p16672633516"></p> <p id="ZH-CN_TOPIC_0000002510294457__p11323173319512"></p> </div> <div></div></div>