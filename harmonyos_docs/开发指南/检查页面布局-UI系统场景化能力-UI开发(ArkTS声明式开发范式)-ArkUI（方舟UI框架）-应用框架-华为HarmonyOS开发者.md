<h1 _ngcontent-vud-c119="" class="doc-title ng-star-inserted" title="检查页面布局"> 检查页面布局 </h1>

<div _ngcontent-vud-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>inspector用于检查页面布局，通过双向定位功能帮助开发者在DevEco Studio中快速定位组件、修改属性和调试组件，以提高开发效率。</p>    <p>ArkUI获取当前显示页面中所有组件的信息，包括组件树的父子结构、尺寸、位置、样式、属性和状态。获取组件树信息后，生成并展示为Inspector组件树。DevEco Studio的使用具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ui-inspector-profiler#inspector调试能力">Inspector调试能力</a>。</p>    <p>inspector针对UI组件的布局或绘制送显完成，还提供了注册与取消监听函数的C API接口，具体使用可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-inspector-component-observer">监听组件布局和绘制送显事件</a>。</p>    <div class="tiledSection">     <h2 id="使用约束">使用约束<i class="anchor-icon anchor-icon-link" anchorid="使用约束" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>不支持动效类组件的控件树实时刷新功能。</p></li>      <li>       <p>支持获取组件的属性和样式，但不支持获取controller和Builder对象。</p></li>      <li>       <p>不支持获取组件的方法、事件。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="uicontext查询组件树和组件信息能力">UIContext查询组件树和组件信息能力<i class="anchor-icon anchor-icon-link" anchorid="uicontext查询组件树和组件信息能力" tips="复制节点链接"></i></h2>          <p>ArkUI提供@ohos.arkui.UIContext(UIContext)扩展能力，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getfilteredinspectortree12" target="_blank">getFilteredInspectorTree</a>获取组件树及组件属性，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getfilteredinspectortreebyid12" target="_blank">getFilteredInspectorTreeById</a>获取指定的组件及其子组件的属性。支持设置过滤条件进行查询。</p>     <p>下述示例，展示了getFilteredInspectorTree和getFilteredInspectorTreeById的基本用法。</p>     <div _ngcontent-vud-c106="" class="highlight-div"><div _ngcontent-vud-c106="" class="highlight-div-header"><div _ngcontent-vud-c106="" class="highlight-div-header-left"><div _ngcontent-vud-c106="" class="handle-button expand-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vud-c106="" class="highlight-div-header-right"><div _ngcontent-vud-c106="" class="handle-button ai-button"></div><div _ngcontent-vud-c106="" class="handle-button line-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vud-c106="" class="handle-button theme-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vud-c106="" class="handle-button copy-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ComponentPage</span> {</li><li>  <span class="hljs-title function_">loopConsole</span>(<span class="hljs-params">inspectorStr: <span class="hljs-built_in">string</span>, i: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`InsTree <span class="hljs-subst">${i}</span>| type: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.parse(inspectorStr).$type}</span>, ID: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.parse(inspectorStr).$ID}</span>`</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr).<span class="hljs-property">$children</span>) {</li><li>      i += <span class="hljs-string">'-'</span>;</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr).<span class="hljs-property">$children</span>.<span class="hljs-property">length</span>; index++) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loopConsole</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr).<span class="hljs-property">$children</span>[index]), i);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Hello World"</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">"TEXT"</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'content'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        <span class="hljs-keyword">let</span> inspectorStr = uiContext.<span class="hljs-title function_">getFilteredInspectorTree</span>([<span class="hljs-string">'content'</span>]);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`InsTree : <span class="hljs-subst">${inspectorStr}</span>`</span>);</li><li>        inspectorStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr));</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loopConsole</span>(inspectorStr, <span class="hljs-string">'-'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'isLayoutInspector'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        <span class="hljs-keyword">let</span> inspectorStr = uiContext.<span class="hljs-title function_">getFilteredInspectorTree</span>([<span class="hljs-string">'isLayoutInspector'</span>]);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`InsTree : <span class="hljs-subst">${inspectorStr}</span>`</span>);</li><li>        inspectorStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr).<span class="hljs-property">content</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loopConsole</span>(inspectorStr, <span class="hljs-string">'-'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getFilteredInspectorTreeById'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-keyword">let</span> inspectorStr = uiContext.<span class="hljs-title function_">getFilteredInspectorTreeById</span>(<span class="hljs-string">'TEXT'</span>, <span class="hljs-number">1</span>, [<span class="hljs-string">"id"</span>, <span class="hljs-string">"src"</span>]);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`result1: <span class="hljs-subst">${inspectorStr}</span>`</span>);</li><li>          inspectorStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr)[<span class="hljs-string">'$children'</span>][<span class="hljs-number">0</span>]);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`result2: <span class="hljs-subst">${inspectorStr}</span>`</span>);</li><li>          inspectorStr = uiContext.<span class="hljs-title function_">getFilteredInspectorTreeById</span>(<span class="hljs-string">'TEXT'</span>, <span class="hljs-number">1</span>, [<span class="hljs-string">"src"</span>]);</li><li>          inspectorStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(inspectorStr)[<span class="hljs-string">'$children'</span>][<span class="hljs-number">0</span>]);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`result3: <span class="hljs-subst">${inspectorStr}</span>`</span>);</li><li>        } <span class="hljs-keyword">catch</span>(e) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getFilteredInspectorTreeById error: <span class="hljs-subst">${e}</span>`</span>);</li><li>        }</li><li>      })</li><li>
</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="布局回调">布局回调<i class="anchor-icon anchor-icon-link" anchorid="布局回调" tips="复制节点链接"></i></h2>          <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-inspector" target="_blank">@ohos.arkui.arkui.inspector(布局回调)</a>提供注册组件布局和组件绘制完成的回调通知能力。</p>     <p>下述示例，展示了布局回调的基本用法。</p>     <div _ngcontent-vud-c106="" class="highlight-div"><div _ngcontent-vud-c106="" class="highlight-div-header"><div _ngcontent-vud-c106="" class="highlight-div-header-left"><div _ngcontent-vud-c106="" class="handle-button expand-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vud-c106="" class="highlight-div-header-right"><div _ngcontent-vud-c106="" class="handle-button ai-button"></div><div _ngcontent-vud-c106="" class="handle-button line-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vud-c106="" class="handle-button theme-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vud-c106="" class="handle-button copy-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inspector } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ImageExample</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span> }) {</li><li>        <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>          <span class="hljs-comment">// 可以替换成本地存在的图片</span></li><li>          <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">110</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">110</span>)</li><li>            .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>            .<span class="hljs-title function_">id</span>(<span class="hljs-string">'IMAGE_ID'</span>)</li><li>        }</li><li>      }</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-number">320</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">360</span>).<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>
</li><li>  <span class="hljs-attr">listener</span>:inspector.<span class="hljs-property">ComponentObserver</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getUIInspector</span>().<span class="hljs-title function_">createComponentObserver</span>(<span class="hljs-string">'IMAGE_ID'</span>)</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">onLayoutComplete</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-built_in">void</span>=():<span class="hljs-function"><span class="hljs-params">void</span>=&gt;</span>{</li><li>      <span class="hljs-comment">// 补充待实现的功能</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">onDrawComplete</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-built_in">void</span>=():<span class="hljs-function"><span class="hljs-params">void</span>=&gt;</span>{</li><li>      <span class="hljs-comment">// 补充待实现的功能</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">onDrawChildrenComplete</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-built_in">void</span>=():<span class="hljs-function"><span class="hljs-params">void</span>=&gt;</span>{</li><li>      <span class="hljs-comment">// 补充待实现的功能</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">FuncLayout</span> = onLayoutComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">FuncDraw</span> = onDrawComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">FuncDrawChildren</span> = onDrawChildrenComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">OffFuncLayout</span> = onLayoutComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">OffFuncDraw</span> = onDrawComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">OffFuncDrawChildren</span> = onDrawChildrenComplete <span class="hljs-comment">// 绑定当前js对象</span></li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'layout'</span>, <span class="hljs-title class_">FuncLayout</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'draw'</span>, <span class="hljs-title class_">FuncDraw</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'drawChildren'</span>, <span class="hljs-title class_">FuncDrawChildren</span>)</li><li>
</li><li>    <span class="hljs-comment">// 通过句柄向对应的查询条件取消注册回调，由开发者自行决定在何时调用。</span></li><li>    <span class="hljs-comment">// this.listener.off('layout', OffFuncLayout)</span></li><li>    <span class="hljs-comment">// this.listener.off('draw', OffFuncDraw)</span></li><li>    <span class="hljs-comment">// this.listener.off('drawChildren', OffFuncDrawChildren)</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="组件标识属性的扩展能力">组件标识属性的扩展能力<i class="anchor-icon anchor-icon-link" anchorid="组件标识属性的扩展能力" tips="复制节点链接"></i></h2>          <p>通过getInspectorByKey、getInspectorTree、sendEventByKey提供组件标识属性扩展能力，具体如下：</p>     <ul>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-component-id#getinspectorbykey9" target="_blank">getInspectorByKey</a>，获取指定id的组件的所有属性。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-component-id#getinspectortree9" target="_blank">getInspectorTree</a>，获取组件树及组件属性。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-component-id#sendeventbykey9" target="_blank">sendEventByKey</a>，给指定id的组件发送事件。</li>     </ul>     <p>下述示例，展示了getInspectorByKey、getInspectorTree和sendEventByKey的基本用法。</p>     <div _ngcontent-vud-c106="" class="highlight-div"><div _ngcontent-vud-c106="" class="highlight-div-header"><div _ngcontent-vud-c106="" class="highlight-div-header-left"><div _ngcontent-vud-c106="" class="handle-button expand-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vud-c106="" class="highlight-div-header-right"><div _ngcontent-vud-c106="" class="handle-button ai-button"></div><div _ngcontent-vud-c106="" class="handle-button line-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vud-c106="" class="handle-button theme-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vud-c106="" class="handle-button copy-button"><div _ngcontent-vud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ComponentPage</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Hello World"</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">"TEXT"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Text is clicked`</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getInspectorByKey'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> result = <span class="hljs-title function_">getInspectorByKey</span>(<span class="hljs-string">"TEXT"</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`result is <span class="hljs-subst">${result}</span>`</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getInspectorTree'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> result = <span class="hljs-title function_">getInspectorTree</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'sendEventByKey'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">sendEventByKey</span>(<span class="hljs-string">"TEXT"</span>, <span class="hljs-number">10</span>, <span class="hljs-string">""</span>);</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>