<h1 _ngcontent-jry-c119="" class="doc-title ng-star-inserted" title="检测环境中的平面"> 检测环境中的平面 </h1>

<div _ngcontent-jry-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section194541956115516">概要<i class="anchor-icon anchor-icon-link" anchorid="section194541956115516" tips="复制节点链接"></i></h2>          <p>从5.0.0(12)开始，AR Engine支持检测环境中的平面能力。</p>     <p>本章节介绍如何通过AR Engine进行平面检测。通过学习本章节，开发者可以检测当前环境中的平面，并在应用中处理这些平面。</p>    </div>    <div class="tiledSection">     <h2 id="section0222145391119">引入AR Engine<i class="anchor-icon anchor-icon-link" anchorid="section0222145391119" tips="复制节点链接"></i></h2>          <p>开发者可参考管理AR会话章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arsession#section1410827131110">引入AR Engine</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section1574219011519">创建ARSession<i class="anchor-icon anchor-icon-link" anchorid="section1574219011519" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002329946662__zh-cn_topic_0000002363785089_p1955711516155">开发者可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arsession">管理AR会话</a>创建ARSession。</p>    </div>    <div class="tiledSection">     <h2 id="section1691145233418">创建平面对象列表<i class="anchor-icon anchor-icon-link" anchorid="section1691145233418" tips="复制节点链接"></i></h2>          <ol>      <li>创建一个平面对象列表planeList，用于存放AR Engine运行过程中检测到的所有平面。       <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackableList *planeList = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_Create</span>(arSession, &amp;planeList);</li></ol></pre></div></div></li>      <li>设置可跟踪对象类型为ARENGINE_TRACKABLE_PLANE。       <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackableType planeTrackedType = ARENGINE_TRACKABLE_PLANE;</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section8991195861712">识别当前环境中的平面<i class="anchor-icon anchor-icon-link" anchorid="section8991195861712" tips="复制节点链接"></i></h2>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a>函数，检测当前环境中的所有平面，并将结果存放在planeList中。</p>     <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_AREngine_ARSession_GetAllTrackables</span>(arSession, planeTrackedType, planeList);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section829065614018">获取平面数量<i class="anchor-icon anchor-icon-link" anchorid="section829065614018" tips="复制节点链接"></i></h2>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gad9729d4436f3d969286f31b33d07513e" target="_blank">HMS_AREngine_ARTrackableList_GetSize</a>函数获取平面数量，结果存放在planeListSize中。</p>     <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> planeListSize = <span class="hljs-number">0</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_GetSize</span>(arSession, planeList, &amp;planeListSize);</li></ol></pre></div></div>     <p>在应用环境中，可能存在0个、1个或多个平面。</p>     <p>当planeListSize等于0时，表示当前环境中不存在平面。</p>     <p>当planeListSize等于1时，表示当前环境中仅存在1个平面。</p>     <p>当planeListSize大于1时，表示当前环境中存在多个平面。</p>    </div>    <div class="tiledSection">     <h2 id="section4891238142419">获取平面实例<i class="anchor-icon anchor-icon-link" anchorid="section4891238142419" tips="复制节点链接"></i></h2>          <p>当存在1个或多个平面时，可以依次遍历planeList获取所有平面对象。</p>     <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; planeListSize; ++i) {</li><li>    <span class="hljs-comment">// 遍历所有平面对象，根据您的应用进行处理。</span></li><li>}</li></ol></pre></div></div>     <p>对于第i个平面，创建并获取可跟踪对象，并将其转化为平面对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga76f9bdb23634312b8488fcbaff4aa9b5" target="_blank">AREngine_ARPlane</a>。</p>     <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">AREngine_ARTrackable</span> *<span class="hljs-variable">arTrackable</span> = <span class="hljs-variable">nullptr</span>;</li><li><span class="hljs-title function_">HMS_AREngine_ARTrackableList_AcquireItem</span>(<span class="hljs-variable">arSession</span>, <span class="hljs-variable">planeList</span>, <span class="hljs-variable">i</span>, &amp;<span class="hljs-title class_">arTrackable</span>);</li><li><span class="hljs-variable">AREngine_ARPlane</span> *<span class="hljs-variable">arPlane</span> = <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">AREngine_ARPlane</span>*&gt;(<span class="hljs-variable">arTrackable</span>);</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>AR Engine中，任何物体都被定义为可跟踪对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga54808ebd1a6ed026494acdd945c4f970" target="_blank">AREngine_ARTrackable</a>。平面也是一种可跟踪对象，开发者可以通过类型转换reinterpret_cast将可跟踪对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga54808ebd1a6ed026494acdd945c4f970" target="_blank">AREngine_ARTrackable</a>转化为平面对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga76f9bdb23634312b8488fcbaff4aa9b5" target="_blank">AREngine_ARPlane</a>。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section2081218568717">销毁平面对象列表<i class="anchor-icon anchor-icon-link" anchorid="section2081218568717" tips="复制节点链接"></i></h2>          <div _ngcontent-jry-c106="" class="highlight-div"><div _ngcontent-jry-c106="" class="highlight-div-header"><div _ngcontent-jry-c106="" class="highlight-div-header-left"><div _ngcontent-jry-c106="" class="handle-button expand-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jry-c106="" class="highlight-div-header-right"><div _ngcontent-jry-c106="" class="handle-button ai-button"></div><div _ngcontent-jry-c106="" class="handle-button line-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jry-c106="" class="handle-button theme-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jry-c106="" class="handle-button copy-button"><div _ngcontent-jry-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jry-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_Destroy</span>(planeList);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>