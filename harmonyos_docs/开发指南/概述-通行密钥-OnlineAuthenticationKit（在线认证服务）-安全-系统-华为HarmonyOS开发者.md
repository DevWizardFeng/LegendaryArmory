<h1 _ngcontent-jme-c119="" class="doc-title ng-star-inserted" title="概述"> 概述 </h1>

<div _ngcontent-jme-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>通行密钥服务主要提供了以下能力：</p> <ul><li>通行密钥注册：支持使用用户身份认证特征（如人脸、指纹、PIN码）作为平台认证器，在本设备上创建应用或网页的通行密钥。</li><li>本地免密认证：支持使用用户身份认证特征（如人脸、指纹、PIN码）作为平台认证器，使用通行密钥在本设备上进行应用或网页的免密认证。</li><li>跨设备扫码认证：支持使用已注册通行密钥的移动设备作为漫游认证器，使用跨设备扫码的方式，在其他设备上进行应用或网页的免密认证。</li></ul> <div class="tiledSection"><h2 id="section192182034346">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section192182034346" tips="复制节点链接"></i></h2><p>具体应用场景如下：</p> </div> <div class="tiledSection"><h3 id="section20979171074710" class="firsth2">注册通行密钥<i class="anchor-icon anchor-icon-link" anchorid="section20979171074710" tips="复制节点链接"></i></h3><p>需要提供方便、快速、安全的本地应用或网页登录方式时，可以使用通行密钥服务的通行密钥注册能力为用户创建通行密钥。</p> <p><span><img height="262.812389" originheight="2538" originwidth="2466" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115030.02418471381251167117603868130347:50001231000000:2800:B5E674A4D8CC903AD39A029687B00CC5A6DCE8B5E81BD56C6F5D6A50E585B8A2.png" title="点击放大" width="255.369044"></span></p> </div> <div class="tiledSection"><h3 id="section42071549114712">使用通行密钥登录本设备的应用或网页账号<i class="anchor-icon anchor-icon-link" anchorid="section42071549114712" tips="复制节点链接"></i></h3><p>用户在登录应用或者网页时，需要验证用户的身份，可以使用通行密钥服务的本地免密认证能力。</p> <p><span><img height="262.60677100000004" originheight="2537" originwidth="3691" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115030.99269947368507409164092109109730:50001231000000:2800:FBD37EC6E6841A2771E80FBB9FD2CF9B2E9A66C2961F58E0DC289A8D0A2B3F06.png" title="点击放大" width="382.05154400000004"></span></p> </div> <div class="tiledSection"><h3 id="section14521958144712">使用跨设备扫码登录其他设备的应用或网页账号<i class="anchor-icon anchor-icon-link" anchorid="section14521958144712" tips="复制节点链接"></i></h3><p>用户在其他设备上登录应用或网页时，需要验证用户的身份，可以使用通行密钥服务的跨设备扫码认证能力。</p> <p><span><img height="269.325" originheight="2538" originwidth="4934" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115030.03640144696440986808541604300334:50001231000000:2800:EA8982785455E6BCD64B543F5093F6E371F76AE15BC48AD9FB25CBBD6CBCA48C.png" title="点击放大" width="523.6875"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>以上使用场景均需要开发者的应用服务器接入FIDO，并部署符合FIDO2标准协议的FIDO服务器。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section1549342112342">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section1549342112342" tips="复制节点链接"></i></h2><p>通行密钥（Passkey）是基于<a href="https://fidoalliance.org/passkeys/" target="_blank">FIDO2标准协议</a>（见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/onlineauthentication-website-disclaimer">网站链接免责声明</a>）实现的一种简单又安全的登录方式。借用通行密钥，用户可使用指纹、人脸或手机解锁PIN码登录应用。相较于传统密码，通行密钥具有更便捷、安全的优势。更多关于FIDO的背景知识，可以参见<a href="https://fidoalliance.org/specifications-overview/" target="_blank">FIDO规范介绍</a>（见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/onlineauthentication-website-disclaimer">网站链接免责声明</a>）。</p> </div> <div class="tiledSection"><h2 id="section1150719113128">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section1150719113128" tips="复制节点链接"></i></h2><div class="p">需满足以下条件，才能使用该功能。<ul><li>开发者的业务需要接入符合FIDO2标准的协议，并部署符合FIDO2标准协议的FIDO服务端。</li><li>移动端设备需要支持生物特征（指纹或3D人脸），查询当前移动端设备是否支持ATL4级别的认证可信等级。<div _ngcontent-jme-c106="" class="highlight-div"><div _ngcontent-jme-c106="" class="highlight-div-header"><div _ngcontent-jme-c106="" class="highlight-div-header-left"><div _ngcontent-jme-c106="" class="handle-button expand-button"><div _ngcontent-jme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jme-c106="" class="highlight-div-header-right"><div _ngcontent-jme-c106="" class="handle-button ai-button"></div><div _ngcontent-jme-c106="" class="handle-button line-button"><div _ngcontent-jme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jme-c106="" class="handle-button theme-button"><div _ngcontent-jme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jme-c106="" class="handle-button copy-button"><div _ngcontent-jme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jme-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span>  <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { userAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UserAuthenticationKit'</span>;</li><li><span class="hljs-comment">// 示例，查询设备人脸识别是否支持ATL4级别的认证可信等级</span></li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用该userAuth接口可能需ohos.permission.ACCESS_BIOMETRIC权限</span></li><li>    userAuth.<span class="hljs-title function_">getAvailableStatus</span>(userAuth.<span class="hljs-property">UserAuthType</span>.<span class="hljs-property">FACE</span>, userAuth.<span class="hljs-property">AuthTrustLevel</span>.<span class="hljs-property">ATL4</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'current auth trust level is supported'</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`current auth trust level is not supported. Code is <span class="hljs-subst">${err?.code}</span>, message is <span class="hljs-subst">${err?.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </li><li>通行密钥服务需要联网以及蓝牙能力，以便提供完整的在线身份校验服务。应用在调用本服务API前，需将通行密钥服务联网、使用蓝牙行为向用户明示，并且取得用户同意。</li><li>根据<a href="https://fidoalliance.org/specifications-overview/" target="_blank">FIDO规范</a>（见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/onlineauthentication-website-disclaimer">网站链接免责声明</a>），通行密钥服务需要将三方应用中的用户昵称及标识符信息上传至网络中继服务器，用于跨设备扫码认证场景，以便实现两台设备的认证数据通信。应用在调用本服务API前，需将收集的个人数据信息向用户明示，并且取得用户同意。</li></ul> </div> </div> <div class="tiledSection"><h2 id="section234019574548">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section234019574548" tips="复制节点链接"></i></h2><p><strong>注册流程介绍</strong></p> <ol><li>应用程序或浏览器集成Online Authentication Kit中的通行密钥模块，向FIDO服务器发起注册请求。</li><li>FIDO服务器将注册信息（如挑战值等）返回给应用程序，应用程序组装注册报文，使用通行密钥服务进行注册。</li><li>通行密钥服务使用认证器验证通过后，会生成一对凭据密钥对，然后用其预置的私钥将生成的公钥及注册信息（如挑战值等）进行签名。</li><li>通行密钥服务返回签名给应用程序。应用程序发给FIDO服务器进行注册。</li><li>FIDO服务器验证签名，保存公钥，并将处理结果返回给应用程序。</li></ol> <p></p> <p><strong>认证流程介绍</strong></p> <ol><li>应用程序或浏览器集成Online Authentication Kit中的通行密钥模块，并向FIDO服务器发起认证请求。</li><li>FIDO服务器将认证信息（如挑战值等）返回给应用程序，应用程序组装认证报文，使用通行密钥服务进行认证。</li><li>通行密钥服务使用认证器验证通过后，用其保存的私钥对认证信息（如挑战值等）进行签名。</li><li>通行密钥服务返回签名给应用程序。应用程序发给FIDO服务器进行认证。</li><li>FIDO服务器验证签名，并将处理结果返回给应用程序。</li></ol> </div> </div> <div></div></div>