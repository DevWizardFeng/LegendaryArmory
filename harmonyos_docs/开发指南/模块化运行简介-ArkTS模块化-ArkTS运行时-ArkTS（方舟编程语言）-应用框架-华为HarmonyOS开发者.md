<h1 _ngcontent-ovl-c119="" class="doc-title ng-star-inserted" title="模块化运行简介"> 模块化运行简介 </h1>

<div _ngcontent-ovl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了解决大型或复杂应用开发过程中，部分代码编译时被多次拷贝导致包体积增大、文件依赖、代码与资源共享困难以及单例和全局变量污染等问题，ArkTS支持应用模块化编译、打包和运行，简化代码的编写与维护。</p>    <p>模块化是将ArkTS/TS/JS模块（一个文件对应一个模块）以及so模块通过编译工具或运行时机制将这些<a href="/consumer/cn/doc/harmonyos-guides/module-principle#模块化运行加载流程">模块加载</a>、解析、组合并执行的过程。</p>    <p>ArkTS支持的模块类型包括ets/ts/js文件、json文件、Native模块。ArkTS中支持<a href="/consumer/cn/doc/harmonyos-guides/module-principle#ecmascript模块">ECMAScript模块规范</a>及<a href="/consumer/cn/doc/harmonyos-guides/module-principle#commonjs模块">CommonJS模块规范</a>，此外，ArkTS也对加载方式进行了拓展，包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-dynamic-import">动态加载</a>、静态加载、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-lazy-import">延迟加载</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/js-apis-load-native-module">同步动态加载Native模块</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/load-module-base-nodeapi">Node-API接口加载文件</a>。</p>    <div class="tiledSection">     <h2 id="模块化运行加载流程">模块化运行加载流程<i class="anchor-icon anchor-icon-link" anchorid="模块化运行加载流程" tips="复制节点链接"></i></h2>          <p>ArkTS模块化运行根据ECMAScript模块规范实现，以后序遍历的方式执行模块：从模块图的最左侧子树开始，执行模块，然后执行它们的同级，然后执行它们的父级。此算法递归运行，直至执行到模块图的根。</p>     <p>以下图为例，每个父节点加载对应子节点，并按import顺序执行同级。模块图文件执行顺序为：D-&gt;F-&gt;G-&gt;E-&gt;B-&gt;I-&gt;H-&gt;C-&gt;A。</p>     <p><span><img originheight="568" originwidth="643" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114750.07605075917803210767569247179259:50001231000000:2800:A7553839A308A93DBB3BD1BA1141C06AD049E079B65B9457C411B27B1682ECDA.png" width="643" height="568"></span></p>     <p>A文件称为入口文件，即执行起点。一些内置的加载接口，如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#loadcontent9" target="_blank">windowStage.loadContent</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation">路由跳转</a>等页面拉起接口（即不是通过import写法拉起的文件），入参文件都会作为入口文件执行。</p>     <p>以A文件为入口，会加载一整套文件，包括A文件及其依赖文件，以及这些文件后续依赖的文件，直到各分支的叶节点。</p>     <p>普通模块在同一线程内只加载一次，而在不同线程中会加载多次，每个线程都会生成新的模块对象。如果需要在进程内只加载一次，请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable-module">共享模块</a>。</p>    </div>    <div class="tiledSection">     <h2 id="arkts支持的模块化规范">ArkTS支持的模块化规范<i class="anchor-icon anchor-icon-link" anchorid="arkts支持的模块化规范" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="ecmascript模块" class="firsth2">ECMAScript模块<i class="anchor-icon anchor-icon-link" anchorid="ecmascript模块" tips="复制节点链接"></i></h3>          <p>ECMAScript模块（ECMAScript Modules，后文称ES Module）是JavaScript自ECMAScript6.0之后，从标准层面（ECMAScript® 2025 Language Specification (tc39.es)）实现的模块功能。其模块功能由两个命令组成：export和import。</p>     <p>ArkTS中export和import用法详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/introduction-to-arkts#模块">ArkTS语言介绍</a>。</p>    </div>    <div class="tiledSection">     <h3 id="commonjs模块">CommonJS模块<i class="anchor-icon anchor-icon-link" anchorid="commonjs模块" tips="复制节点链接"></i></h3>          <p>CommonJS模块是JavaScript社区2009年提出的标准，首先在Node.js采用部分标准并实现。CommonJS将每个文件视为一个模块，通过module变量代表当前模块，module.exports即为该模块对外导出的变量，每个模块还拥有exports变量（exports === module.exports）。</p>     <p>模块导入和模块导出写法参考下表：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.4.1.1" valign="top" width="33.33333333333333%">加载类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.4.1.2" valign="top" width="33.33333333333333%">模块导入</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.4.1.3" valign="top" width="33.33333333333333%">模块导出（不能把module.exports与exports混用）</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">变量</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">const ohos = require('ohos')</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">exports.add = add或module.exports.name = name</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">变量</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">const ohos = require('ohos')</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">module.exports = add</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">函数</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>const ohos = require('ohos')</p>          <p>ohos.fun();</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">exports.fun = function foo () {}或module.exports.fun = function foo () {}</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>CommonJS模块仅适用于第三方包的导出，不支持在工程中创建和使用。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="commonjs与es-module支持规格">CommonJS与ES Module支持规格<i class="anchor-icon anchor-icon-link" anchorid="commonjs与es-module支持规格" tips="复制节点链接"></i></h3>          <p>CommonJS与ES Module互相引用的规格如下表所示，导入和导出语法需遵循各自的模块规范。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.1" valign="top" width="33.33333333333333%">互相引用关系</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.2" valign="top" width="33.33333333333333%">ES Module 导出</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.3" valign="top" width="33.33333333333333%">CommonJS导出</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><strong>ES Module 导入</strong></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><strong>CommonJS导入</strong></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="arkts支持加载的模块类型">ArkTS支持加载的模块类型<i class="anchor-icon anchor-icon-link" anchorid="arkts支持加载的模块类型" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="etstsjs" class="firsth2">ets/ts/js<i class="anchor-icon anchor-icon-link" anchorid="etstsjs" tips="复制节点链接"></i></h3>          <p>加载ets/ts/js模块类型时，需遵循<a href="/consumer/cn/doc/harmonyos-guides/module-principle#ecmascript模块">ECMAScript模块规范</a>及<a href="/consumer/cn/doc/harmonyos-guides/module-principle#commonjs模块">CommonJS模块规范</a>。</p>    </div>    <div class="tiledSection">     <h3 id="json文件">JSON文件<i class="anchor-icon anchor-icon-link" anchorid="json文件" tips="复制节点链接"></i></h3>          <p>JSON（JavaScript Object Notation）是一种轻量级的数据交互格式，采用完全独立于编程语言的文本格式来存储和表示数据。</p>     <p>JSON文件只能使用default方式导入，如下所示：</p>     <div _ngcontent-ovl-c106="" class="highlight-div"><div _ngcontent-ovl-c106="" class="highlight-div-header"><div _ngcontent-ovl-c106="" class="highlight-div-header-left"><div _ngcontent-ovl-c106="" class="handle-button expand-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovl-c106="" class="highlight-div-header-right"><div _ngcontent-ovl-c106="" class="handle-button ai-button"></div><div _ngcontent-ovl-c106="" class="handle-button line-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovl-c106="" class="handle-button theme-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovl-c106="" class="handle-button copy-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> data <span class="hljs-keyword">from</span> <span class="hljs-string">'./example.json'</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="native模块">Native模块<i class="anchor-icon anchor-icon-link" anchorid="native模块" tips="复制节点链接"></i></h3>          <p>Native模块（so）的导入导出与加载ets/ts/js语法规格一致。详情请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-import-native-module">静态方式加载native模块</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Native模块不支持在CommonJS模块中导入。</p>      </div></div></div>     <p>示例：</p>     <div _ngcontent-ovl-c106="" class="highlight-div"><div _ngcontent-ovl-c106="" class="highlight-div-header"><div _ngcontent-ovl-c106="" class="highlight-div-header-left"><div _ngcontent-ovl-c106="" class="handle-button expand-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovl-c106="" class="highlight-div-header-right"><div _ngcontent-ovl-c106="" class="handle-button ai-button"></div><div _ngcontent-ovl-c106="" class="handle-button line-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovl-c106="" class="handle-button theme-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovl-c106="" class="handle-button copy-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// libentry.so对应的index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>     <div _ngcontent-ovl-c106="" class="highlight-div"><div _ngcontent-ovl-c106="" class="highlight-div-header"><div _ngcontent-ovl-c106="" class="highlight-div-header-left"><div _ngcontent-ovl-c106="" class="handle-button expand-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ovl-c106="" class="highlight-div-header-right"><div _ngcontent-ovl-c106="" class="handle-button ai-button"></div><div _ngcontent-ovl-c106="" class="handle-button line-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ovl-c106="" class="handle-button theme-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ovl-c106="" class="handle-button copy-button"><div _ngcontent-ovl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ovl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// test.ets</span></li><li>import { <span class="hljs-keyword">add</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span></li><li><span class="hljs-keyword">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)</li></ol></pre></div></div>    </div>   </div>   <div></div></div>