<h1 _ngcontent-pxq-c119="" class="doc-title ng-star-inserted" title="模型轻量化示例"> 模型轻量化示例 </h1>

<div _ngcontent-pxq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section060635815250">TensorFlow Quant_INT8-8无训练量化Demo<i class="anchor-icon anchor-icon-link" anchorid="section060635815250" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section146371177260" class="firsth2">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section146371177260" tips="复制节点链接"></i></h3><p>请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section025882820347">环境准备</a>，安装TensorFlow及依赖。</p> </div> <div class="tiledSection"><h3 id="section76223355269">模型配置<i class="anchor-icon anchor-icon-link" anchorid="section76223355269" tips="复制节点链接"></i></h3><ul><li>准备量化模型<p>将基线模型的pb文件放入<span class="filepath">“dopt_tf_py3/demo/quant8-8/notrain/tensorflow_mnist/basemodel/”</span>。该路径下中已经放入了mnist基线模型mnist.pb。</p> </li></ul> <ul><li>准备量化输入数据<p>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section977955263419">模型量化</a>，将图片或二进制形式的校准集放入<span class="filepath">“dopt_tf_py3/demo/quant8-8/notrain/tensorflow_mnist/mnist_test/”</span>中。该路径下已经放入了图片校准集。</p> </li></ul> </div> <div class="tiledSection"><h3 id="section19929145711265">模型量化<i class="anchor-icon anchor-icon-link" anchorid="section19929145711265" tips="复制节点链接"></i></h3><p>执行<span class="filepath">“dopt_tf_py3/demo/quant8-8/notrain/tensorflow_mnist/”</span>下run_release.sh即可。</p> <p><span class="filepath">“dopt_tf_py3/demo/quant8-8/notrain/tensorflow_mnist”</span>中存有量化后的pb模型和量化配置文件，运行demo后生成的文件如下图所示：</p> <p><span><img originheight="39" originwidth="101" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114255.67676948176720637745530805602434:50001231000000:2800:B37B43BBC83EDE490C6EA4F1E63DDABE6A19B07B48940D27A0A44CF2111FE063.png" class="notEnlarge" width="101" height="39"></span></p> </div> <div class="tiledSection"><h2 id="section224310556111">PyTorch Quant_INT8-8无训练量化Demo<i class="anchor-icon anchor-icon-link" anchorid="section224310556111" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section69121817215" class="firsth2">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section69121817215" tips="复制节点链接"></i></h3><p>请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section8715155563919">环境准备</a>，安装PyTorch及依赖。</p> </div> <div class="tiledSection"><h3 id="section12001259418">模型配置<i class="anchor-icon anchor-icon-link" anchorid="section12001259418" tips="复制节点链接"></i></h3><ul><li>准备量化模型<p>将基线模型的模型定义文件(.py)以及模型参数文件放入<span class="filepath">“dopt_pytorch_py3/demo/quant8-8/notrain/pytorch_mnist/。”</span></p> <p>该路径下已经放入了mnist基线模型定义文件mnist.py以及模型参数文件mnist.pth。</p> </li></ul> <ul><li>准备量化输入数据<p>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section793161024016">模型量化</a>，将图片或二进制形式的校准集放入<span class="filepath">“dopt_pytorch_py3/demo/quant8-8/notrain/pytorch_mnist/”</span>中。</p> </li></ul> </div> <div class="tiledSection"><h3 id="section020017511419">模型量化<i class="anchor-icon anchor-icon-link" anchorid="section020017511419" tips="复制节点链接"></i></h3><p>执行<span class="filepath">“dopt_pytorch_py3/demo/quant8-8/notrain/pytorch_mnist/”</span>下run_release.sh即可。</p> <p><span class="filepath">“dopt_pytorch_py3/demo/quant8-8/notrain/pytorch_mnist/”</span>中存有PyTorch无训练量化示例文件，如下图所示：</p> <p><span><img originheight="101" originwidth="131" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114255.53312138913982919060115170171118:50001231000000:2800:F9A1A90D8F0260BC132EE0D365DA4B4B25CE02290E422C48664BD73B49C37F02.png" class="notEnlarge" width="131" height="101"></span></p> </div> <div class="tiledSection"><h2 id="section778655215202">ONNX Quant_INT8-8无训练量化Demo<i class="anchor-icon anchor-icon-link" anchorid="section778655215202" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1948012139340" class="firsth2">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section1948012139340" tips="复制节点链接"></i></h3><p>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section2399333123120">环境准备</a>，安装ONNX及依赖。</p> </div> <div class="tiledSection"><h3 id="section29421215143314">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section29421215143314" tips="复制节点链接"></i></h3><p>将dopt_onnx_py3 目录添加到系统环境中，在终端环境执行</p> <div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="python prettyprint linenums hljs language-python" hw-language="python" data-highlighted="yes"><ol class="linenums"><li>python3 ./dopt_so.py \</li><li>    --framework <span class="hljs-number">5</span> \</li><li>    --mode   <span class="hljs-number">0</span> \</li><li>    --model <span class="hljs-string">"./resnet18_matmul.onnx"</span> \          <span class="hljs-comment">## 待量化的ONNX模型</span></li><li>    --cal_conf <span class="hljs-string">"./config.prototxt"</span> \            <span class="hljs-comment">## 校准集配置文件</span></li><li>    --output  <span class="hljs-string">"./resnet18_matmul_quant.onnx"</span> \  <span class="hljs-comment">## 量化后的ONNX文件</span></li><li>    --input_shape   <span class="hljs-built_in">input</span>:<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">128</span>,<span class="hljs-number">128</span> \         <span class="hljs-comment">## 浮点模型输入shape  </span></li><li>    --compress_conf  ./mnist_param              <span class="hljs-comment">## dopt 工具生成的量化文件</span></li></ol></pre></div></div> <p>其中，./config.prototxt配置内容为（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-no-training-and-quantization#section1262217244312">配置文件使用方法</a>）：</p> <div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="python prettyprint linenums hljs language-python" hw-language="python" data-highlighted="yes"><ol class="linenums"><li>strategy: <span class="hljs-string">'Quant_INT8-8'</span></li><li>device: USE_CPU</li><li>preprocess_parameter:</li><li>{</li><li>    input_type: BINARY</li><li>    input_file_path: <span class="hljs-string">'./input1.bin'</span></li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1714955010311">TensorFlow Quant_INT8-8插件式量化Demo<i class="anchor-icon anchor-icon-link" anchorid="section1714955010311" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section13219171112332" class="firsth2">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section13219171112332" tips="复制节点链接"></i></h3><p>请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-plugin-based-quantization#section103814481178">准备TensorFlow环境</a>。安装TensorFlow-gpu 2.8.0版本以及其必要的依赖。</p> </div> <div class="tiledSection"><h3 id="section718611242336">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section718611242336" tips="复制节点链接"></i></h3><div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="python prettyprint linenums hljs language-python" hw-language="python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> sys</li><li>sys.path.append(<span class="hljs-string">".../dopt_tf_py3"</span>) <span class="hljs-comment">## 其中路径为绝对路径</span></li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_config</span>():</li><li>    <span class="hljs-keyword">with</span> tf.Session(config=config) <span class="hljs-keyword">as</span> sess:</li><li>        build_tf_model() <span class="hljs-comment">## 自定义tf模型graph，仅构建拓扑图，不可加载权重</span></li><li>        <span class="hljs-keyword">from</span> dopt.dopt_tf.opt_main <span class="hljs-keyword">import</span> generate_config_file</li><li>        generate_config_file(sess, dst_path=<span class="hljs-string">"./config_gen.json"</span>)</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>():</li><li>    <span class="hljs-keyword">with</span> tf.Session(config=config) <span class="hljs-keyword">as</span> sess:</li><li>        build_tf_model() <span class="hljs-comment">## 自定义tf模型graph，仅构建拓扑图，不可加载权重</span></li><li>        <span class="hljs-keyword">from</span> dopt.dopt_tf.opt_main <span class="hljs-keyword">import</span> optimize_model</li><li>        quant_flag = tf.placeholder(tf.int32)</li><li>        is_train_flag = tf.placeholder(tf.<span class="hljs-built_in">bool</span>, name=<span class="hljs-string">'is_train'</span>)</li><li>        <span class="hljs-comment">## 模型量化，自动在 tf.get_default_graph()上进行改图操作</span></li><li>        optimize_model( </li><li>            sess,</li><li>            <span class="hljs-string">"./config_gen.json"</span>,</li><li>            is_train_flag,</li><li>            quant_flag</li><li>        )</li><li>        <span class="hljs-comment">## 调用完optimize_model之后，加载模型权重</span></li><li>        saver = tf.Saver()</li><li>        saver.restore(ckpt)</li><li>        tf.global_variables_initializer().run()</li><li>        <span class="hljs-comment">## train model</span></li><li>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(...):</li><li>            optimizer = ...</li><li>            feed_dict[is_train_flag] = <span class="hljs-literal">True</span></li><li>            feed_dict[quant_flag] = <span class="hljs-number">1</span></li><li>            sess.run(train_op, feed_dict)</li><li>        <span class="hljs-comment">## eval model</span></li><li>        feed_dict[is_train_flag] = <span class="hljs-literal">False</span></li><li>        feed_dict[quant_flag] = <span class="hljs-number">1</span></li><li>        sess.run(output, feed_dict)</li><li>        evaluate_output(output)</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">calibrate_model</span>():</li><li>    <span class="hljs-keyword">with</span> tf.Session(config=config) <span class="hljs-keyword">as</span> sess:</li><li>        build_tf_model() <span class="hljs-comment">## 自定义tf模型graph，仅构建拓扑图，不可加载权重</span></li><li>        <span class="hljs-keyword">from</span> dopt.dopt_tf.opt_main <span class="hljs-keyword">import</span> optimize_model, set_calibrate_state </li><li>        quant_flag = tf.placeholder(tf.int32)</li><li>        is_train_flag = tf.placeholder(tf.<span class="hljs-built_in">bool</span>, name=<span class="hljs-string">'is_train'</span>)</li><li>        <span class="hljs-comment">## 模型量化，自动在 tf.get_default_graph()上进行改图操作</span></li><li>        optimize_model( </li><li>            sess,</li><li>            <span class="hljs-string">"./config_gen.json"</span>,</li><li>            is_train_flag,</li><li>            quant_flag</li><li>        )</li><li>        <span class="hljs-comment">## 调用完optimize_model之后，加载模型权重</span></li><li>        saver = tf.Saver()</li><li>        saver.restore(ckpt)</li><li>
</li><li>        calibration_mode = <span class="hljs-literal">True</span></li><li>        set_calibrate_state(sess, calibration_mode ) </li><li>        <span class="hljs-comment">## eval model</span></li><li>        feed_dict[is_train_flag] = <span class="hljs-literal">False</span></li><li>        feed_dict[quant_flag] = <span class="hljs-number">1</span></li><li>        sess.run(output, feed_dict)</li><li>        evaluate_output(output)</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_params</span>():</li><li>    <span class="hljs-keyword">with</span> tf.Session(config=config) <span class="hljs-keyword">as</span> sess:</li><li>        build_tf_model()</li><li>        <span class="hljs-keyword">from</span> dopt.dopt_tf.opt_main <span class="hljs-keyword">import</span> generate_final_model</li><li>        generate_final_model(</li><li>            sess,</li><li>            config_file         = <span class="hljs-string">"./config_gen.json"</span>,</li><li>            output_name_list    = [<span class="hljs-string">"output"</span>],</li><li>            ckpt_file           = <span class="hljs-string">"train_ckpt_path"</span>,</li><li>            output_dir          = <span class="hljs-string">"./output_dir"</span></li><li>        )</li><li><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</li><li>    <span class="hljs-comment">## step 1</span></li><li>    <span class="hljs-comment">## 开发者接入，配置修改</span></li><li>    generate_config()</li><li>    </li><li>    <span class="hljs-comment">## step 2</span></li><li>    <span class="hljs-comment">## 训练模型，直至达标</span></li><li>    train_model() <span class="hljs-comment">## 重训练量化模型</span></li><li>    <span class="hljs-comment">## calibrate_model()  ## 校准量化模型</span></li><li>    </li><li>    <span class="hljs-comment">## step 3</span></li><li>    <span class="hljs-comment">## 提取参数，用于后续模型部署</span></li><li>    generate_params()</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section838111291336">PyTorch Quant_INT8-8插件式量化Demo<i class="anchor-icon anchor-icon-link" anchorid="section838111291336" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section932671713348" class="firsth2">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section932671713348" tips="复制节点链接"></i></h3><p>请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-plugin-based-quantization#section461318612307">准备PyTorch环境</a>。安装PyTorch-gpu 1.11版本以及其必要的依赖。</p> </div> <div class="tiledSection"><h3 id="section4613183419513">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section4613183419513" tips="复制节点链接"></i></h3><div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="python prettyprint linenums hljs language-python" hw-language="python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> sys</li><li>sys.path.append(<span class="hljs-string">".../dopt_tf_py3"</span>) <span class="hljs-comment">## 其中路径为绝对路径</span></li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_config</span>():</li><li>    model = build_torch_model()  <span class="hljs-comment">## 开发者待量化的浮点模型</span></li><li>    generate_config_file(model, input_shape, dst_path=<span class="hljs-string">"./config_gen.json"</span>) <span class="hljs-comment"># model：torch.nn.Module， input_shape : "input1:input1.shape;input2:input2.shape"</span></li><li>    <span class="hljs-keyword">return</span> model</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>():</li><li>    model = build_torch_model() <span class="hljs-comment">## 开发者待量化的浮点模型</span></li><li>    <span class="hljs-keyword">from</span> dopt.dopt_torch.opt_main <span class="hljs-keyword">import</span> optimize_model</li><li>    model.load_state_dict(state)  <span class="hljs-comment">## load 浮点模型参数</span></li><li>    </li><li>    <span class="hljs-comment">## 调用optimize model 量化模型</span></li><li>    quanted_model = optimize_model(model, config_path)</li><li>    </li><li>    <span class="hljs-comment">## train model</span></li><li>    quant_loss = get_quant_loss(quant_model)</li><li>    optimizer = torch.optim.SGD(quanted_model.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>) <span class="hljs-comment">## 假设使用SGD优化器</span></li><li>    </li><li>    <span class="hljs-keyword">for</span> input_data, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(...):</li><li>        optimizer.zero_grad()</li><li>        outputs = model(input_data)</li><li>        loss = loss_fn(outputs, label) <span class="hljs-comment">## loss_fn 为原始浮点网络训练loss</span></li><li>        </li><li>        total_loss = loss + quant_weight * quant_loss <span class="hljs-comment">## quant_weight是指量化损失所占比例</span></li><li>        loss.backward()</li><li>        </li><li>        optimizer.step()</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">calibrate_model</span>():</li><li>    model = build_torch_model() <span class="hljs-comment">## 开发者待量化的浮点模型</span></li><li>    <span class="hljs-keyword">from</span> dopt.dopt_torch.opt_main <span class="hljs-keyword">import</span> optimize_model, set_calibrate_state</li><li>    model.load_state_dict(state)  <span class="hljs-comment">## load 浮点模型参数</span></li><li>    </li><li>    <span class="hljs-comment">## 调用optimize model 量化模型</span></li><li>    quanted_model = optimize_model(model, config_path)</li><li>    </li><li>    calibrate_mode = <span class="hljs-literal">True</span></li><li>    set_calibrate_state(model, calibrate_mode)</li><li>    </li><li>    <span class="hljs-keyword">for</span> input_data, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(...):</li><li>        outputs = model(input_data)</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_params</span>():</li><li>    model = build_torch_model()</li><li>    <span class="hljs-keyword">from</span> dopt.dopt_torch.opt_main <span class="hljs-keyword">import</span> generate_final_model</li><li>    generate_final_model(model, </li><li>                        config_file,</li><li>                        pth_file=<span class="hljs-string">"quant.pth"</span>,</li><li>                        output_dir=<span class="hljs-string">"./results_dir"</span>)</li><li>
</li><li><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</li><li>    <span class="hljs-comment">## step 1</span></li><li>    <span class="hljs-comment">## 开发者接入，配置修改</span></li><li>    generate_config()</li><li>    </li><li>    <span class="hljs-comment">## step 2</span></li><li>    <span class="hljs-comment">## 训练模型，直至达标</span></li><li>    train_model()</li><li>    <span class="hljs-comment">## 无训练模式</span></li><li>    <span class="hljs-comment">## calibrate_model() </span></li><li> </li><li>    <span class="hljs-comment">## step 3</span></li><li>    <span class="hljs-comment">## 提取参数，用于后续模型部署</span></li><li>    generate_params()</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1897718597348">TensorFlow NASEA网络结构搜索Demo<i class="anchor-icon anchor-icon-link" anchorid="section1897718597348" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section937619353351" class="firsth2">NASEA分类网络<i class="anchor-icon anchor-icon-link" anchorid="section937619353351" tips="复制节点链接"></i></h3><p>分类网络Demo位于<span class="filepath">“tools_dopt/dopt_tf_py3/demo/nas_ea/ea_cls_imagenet”</span>，包含5个文件，如下图所示：</p> <p><span><img height="110.39" originheight="111" originwidth="171" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114255.48520552905332267377474118571866:50001231000000:2800:CA3E5E77CD811884D0352A72C2451423A9B9ACBD8A53F26433104F4810233BA2.png" width="170.24" class="notEnlarge"></span></p> <ul><li>blocks.so：搜索空间文件</li><li>readme.md：搜索训练指导文件</li><li>run_release.sh：开始搜索的执行脚本</li><li>scen.yaml：配置项</li><li>user_module.py：工具的自定义接口</li></ul> <p>执行步骤：</p> <ol><li><span>准备ImageNet数据集（tfrecord格式），并修改scen.yaml文件中的数据集路径。</span></li><li><span>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section193737375169">环境准备</a>。</span></li><li><span>加载依赖的开源代码：</span><p></p><ol><li>进入分类网络demo目录：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd tools_dopt/dopt_tf_py3/demo/nas_ea/ea_cls_imagenet</li></ol></pre></div></div> </li></ol><ol start="2"><li>下载开源代码：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git clone https://github.com/Tensorflow/models.git</li></ol></pre></div></div> </li></ol><ol start="3"><li>进入开源代码目录：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd models</li></ol></pre></div></div> </li></ol><ol start="4"><li>切换到指定版本：<ul><li>如果TensorFlow版本为1.12.0，执行如下命令：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v1.12.0</li></ol></pre></div></div> </li></ul> <ul><li>如果TensorFlow版本为2.1.0，执行如下命令：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v2.1.0</li></ol></pre></div></div> </li></ul> </li><li>返回分类网络demo目录：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd ..</li></ol></pre></div></div> </li><li>设置PYTHONPATH默认路径：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>export PYTHONPATH=$PYTHONPATH:`pwd`/models/</li></ol></pre></div></div> </li></ol> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>每次打开终端需要重新执行一次上述命令，或添加到“~/.bashrc”文件，并执行“source ~/.bashrc”。</p> </div></div></div> <p></p></li><li><span>配置demo下的scen.yaml文件，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>。scen.yaml中提供了建议参数，开发者可根据实际需求修改。</span></li><li><span>修改demo下的user_module.py文件，模型接口定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section183452511917">TensorFlow用户自定义接口</a>。user_module.py中提供了建议配置，开发者可根据实际需求进行修改。</span></li><li><span>执行脚本run_release.sh，在results下，生成多个model_arch_result_*.py文件。开发者可根据log_classification中提供的信息选择合适的网络结构进行训练。后续训练可参考readme.md中的指导。</span></li></ol> </div> <div class="tiledSection"><h3 id="section21991063613">NASEA检测网络<i class="anchor-icon anchor-icon-link" anchorid="section21991063613" tips="复制节点链接"></i></h3><p>检测网络Demo位于<span class="filepath">“tools_dopt/dopt_tf_py3/demo/nas_ea/ea_det_coco”</span>，包含6个文件，如下图所示：</p> </div> <p><span><img height="136.99" originheight="138" originwidth="202" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114256.37431159296937503106369672347685:50001231000000:2800:94EC22E2364980EB792AB8A51F0F5EE804DE4C7F8497C0C58957C7F77DEAE02A.png" width="200.83" class="notEnlarge"></span></p> <ul><li>blocks.so：搜索空间文件。</li><li>pre_train.yaml：预训练的配置项。</li><li>readme.md：搜索训练指导文件。</li><li>run_release.sh：开始搜索的执行脚本。</li><li>scen.yaml：配置项。</li><li>user_module.py：工具的自定义接口。</li></ul> <p>执行步骤：</p> <ol><li><span>准备数据集，包括用于预训的ImageNet数据集（tfrecord格式）和用于训练的COCO数据集（原始格式）。若有完成预训练的ckpt文件，则不需再准备ImageNet数据集。请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>，修改scen.yaml文件中的数据集路径。</span></li><li><span>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section193737375169">环境准备</a>。</span></li><li><span>加载依赖的开源代码。</span><p></p><ol><li>进入检测网络demo目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd tools_dopt/dopt_tf_py3/demo/nas_ea/ea_det_coco</li></ol></pre></div></div> </li><li>下载开源代码。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git clone https://github.com/pierluigiferrari/ssd_keras.git</li><li>git clone https://github.com/Tensorflow/models.git</li></ol></pre></div></div> </li><li>进入开源代码目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd ssd_keras</li></ol></pre></div></div> </li><li>切换到指定版本。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout -b v0.9.0</li></ol></pre></div></div> </li><li>返回检测网络demo目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd ..</li></ol></pre></div></div> </li><li>进入models开源代码目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd models</li></ol></pre></div></div> </li><li>切换models到指定版本。<p>如果TensorFlow版本为1.12.0，执行如下命令：</p> <div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v1.12.0</li></ol></pre></div></div> <p>如果TensorFlow版本为2.1.0，则执行如下命令：</p> <div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v2.1.0</li></ol></pre></div></div> </li><li>进入models开源代码目录<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd models</li></ol></pre></div></div> </li><li>设置PYTHONPATH默认路径<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>export PYTHONPATH=$PYTHONPATH:`pwd`/models/</li></ol></pre></div></div> </li><li>按照readme.md中的step1~step4步骤，修改相关开源文件。</li></ol> <p></p></li><li><span>配置demo的scen.yaml文件和pre_train.yaml，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>。scen.yaml中提供了建议参数，开发者可根据实际需求修改。</span></li><li><span>修改demo的user_module.py文件，模型接口定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section183452511917">TensorFlow用户自定义接口</a>。user_module.py中提供了建议配置，开发者可根据实际需求进行修改。</span></li><li><span>执行脚本run_release.sh，在results下，生成多个model_arch_result_*.py文件。开发者可根据log_detection中提供的信息选择合适的网络结构进行训练。后续训练可参考readme.md中的指导。</span></li></ol> <div class="tiledSection"><h3 id="section11318185593611">NASEA分割网络<i class="anchor-icon anchor-icon-link" anchorid="section11318185593611" tips="复制节点链接"></i></h3><p>分割网络Demo位于<span class="filepath">“tools_dopt/dopt_tf_py3/demo/nas_ea/ea_seg_voc”</span>，包含 6个文件，如下图所示：</p> </div> <p><span><img height="142.31" originheight="143" originwidth="200" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114256.03470116293662640064163790727978:50001231000000:2800:837375832EA6E0BD26990474EEB691483C1AF87345E12E43A68A243E82BACE54.png" width="199.5" class="notEnlarge"></span></p> <ul><li>blocks.so：搜索空间文件。</li><li>pre_train.yaml：预训练的配置项</li><li>readme.md：搜索训练指导文件。</li><li>run_release.sh：开始搜索的执行脚本。</li><li>scen.yaml：配置项。</li><li>user_module.py：工具的自定义接口。</li></ul> <p>执行步骤：</p> <ol><li><span>准备数据集，包括用于预训练的ImageNet数据集（tfrecord格式）和用于训练的VOC数据集（tfrecord格式）。若有完成预训练的ckpt文件，则不需再准备ImageNet数据集。请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>，修改scen.yaml文件中的数据集路径。</span></li><li><span>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section193737375169">环境准备</a>。</span></li><li><span>加载依赖的开源代码。</span><p></p><ol><li>进入分割网络demo目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd tools_dopt/dopt_tf_py3/demo/nas_ea/ea_seg_voc</li></ol></pre></div></div> </li><li>下载开源代码：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git clone https://github.com/Tensorflow/models.git</li></ol></pre></div></div> </li><li>进入开源代码目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd models</li></ol></pre></div></div> </li><li>切换到指定版本。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v1.13.0</li></ol></pre></div></div> </li><li>返回分割网络demo目录。<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd ..</li></ol></pre></div></div> </li><li>设置PYTHONPATH默认路径：<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>export PYTHONPATH=$PYTHONPATH:`pwd`/models/research:`pwd`/models/research/slim</li></ol></pre></div></div> </li><li>如果TensorFlow版本为2.1.0，需要执行如下命令：<ol class="substepthirdol"><li>创建models_tf2.1，并进入文件夹<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>mkdir models_tf2.1</li><li>cd models_tf2.1</li></ol></pre></div></div> </li><li>下载开源实现<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git clone https://github.com/Tensorflow/models.git</li></ol></pre></div></div> </li><li>进入开源代码路径<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd models</li></ol></pre></div></div> </li><li>切换到指定版本<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>git checkout v2.1.0</li></ol></pre></div></div> </li><li>返回models_tf2.1目录<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>cd ..</li></ol></pre></div></div> </li><li>设置PYTHONPATH默认路径<div _ngcontent-pxq-c106="" class="highlight-div"><div _ngcontent-pxq-c106="" class="highlight-div-header"><div _ngcontent-pxq-c106="" class="highlight-div-header-left"><div _ngcontent-pxq-c106="" class="handle-button expand-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxq-c106="" class="highlight-div-header-right"><div _ngcontent-pxq-c106="" class="handle-button ai-button"></div><div _ngcontent-pxq-c106="" class="handle-button line-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxq-c106="" class="handle-button theme-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxq-c106="" class="handle-button copy-button"><div _ngcontent-pxq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxq-c106="" class="highlight-scroll-div"><pre class="console prettyprint linenums hljs language-shell" hw-language="console" data-highlighted="yes"><ol class="linenums"><li>export PYTHONPATH=$PYTHONPATH:`pwd`/models/</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>每次打开终端需要重新执行一次上述命令，或添加到<span class="filepath">“~/.bashrc”</span>文件，并执行<span class="filepath">“source ~/.bashrc”</span>。</p> </div></div></div> </li></ol> </li><li>修改开源实现，按照readme.md中修改开源实现的步骤，修改相关开源文件。</li></ol> <p></p></li><li><span>配置demo的scen.yaml文件和pre_train.yaml，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>。scen.yaml中提供了建议参数，开发者可根据实际需求修改。</span></li><li><span>修改demo的user_module.py文件，模型接口定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section183452511917">TensorFlow用户自定义接口</a>。user_module.py中提供了建议配置，开发者可根据实际需求进行修改。</span></li><li><span>执行脚本run_release.sh，在results下，生成多个model_arch_result_*.py文件。开发者可根据log_segmentation中提供的信息选择合适的网络结构进行训练。后续训练可参考readme.md中的指导。</span></li></ol> <div class="tiledSection"><h2 id="section10440101511111">PyTorch NASEA网络结构搜索Demo<i class="anchor-icon anchor-icon-link" anchorid="section10440101511111" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1178616381611" class="firsth2">NASEA分类网络<i class="anchor-icon anchor-icon-link" anchorid="section1178616381611" tips="复制节点链接"></i></h3><p>分类网络Demo位于tools_dopt/dopt_pytorch_py3/demo/nas_ea/ea_cls_imagenet_pytorch，包含5个文件，如下：</p> <p><span><img height="106.4" originheight="107" originwidth="130" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114256.05794396712802242349600782269871:50001231000000:2800:239004CFB125F6EAEFDF45333B4A5F0BFB5E1C562A80DCBEB56E03861D4DD87C.png" width="129.01000000000002" class="notEnlarge"></span></p> <ul><li>blocks.so：搜索空间文件</li><li>readme.md：搜索训练指导文件</li><li>run_release.sh：开始搜索的执行脚本</li><li>scen.yaml：配置项</li><li>user_module.py：工具的自定义接口</li></ul> <p>执行步骤：</p> <ol><li><span>准备ImageNet数据集（原始格式），并修改scen.yaml文件中的数据集路径。</span></li><li><span>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section193737375169">环境准备</a>。</span></li><li><span>配置demo下的scen.yaml文件，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>。scen.yaml中提供了建议参数，开发者可根据实际需求修改。</span></li><li><span>修改demo下的user_module.py文件，模型接口定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section56271946125514">PyTorch开发者自定义接口</a>。user_module.py中提供了建议配置，开发者可根据实际需求进行修改。</span></li><li><span>执行脚本run_release.sh，在results下，生成多个model_arch_result_*.py文件。开发者可根据log_classification中提供的信息选择合适的网络结构进行训练。后续训练可参考readme.md中的指导。</span></li></ol> </div> <div class="tiledSection"><h3 id="section176118302048">NASEA分割网络<i class="anchor-icon anchor-icon-link" anchorid="section176118302048" tips="复制节点链接"></i></h3><p>分割网络Demo位于tools_dopt/dopt_pytorch_py3/demo/nas_ea/ea_seg_voc_pytorch，包含 6个文件，如下：</p> <p><span><img height="134.33" originheight="135" originwidth="211" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114256.47621387248248938168238236757231:50001231000000:2800:163FEA9EC2D75CE18789734FF745FC007F6B35B6339F9453969CD1B3D5CBCF78.png" width="210.14000000000001" class="notEnlarge"></span></p> <ul><li>blocks.so：搜索空间文件</li><li>pre_train.yaml：预训练的配置项</li><li>readme.md：搜索训练指导文件</li><li>run_release.sh：开始搜索的执行脚本</li><li>scen.yaml：配置项</li><li>user_module.py：工具的自定义接口</li></ul> <p>执行步骤：</p> <ol><li><span>准备数据集，包括用于预训练的ImageNet数据集（原始格式）和用于训练VOC数据集（原始格式）。若有完成预训练的ckpt文件，则不需再准备ImageNet数据集。请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>，修改scen.yaml文件中的数据集路径。</span></li><li><span>环境准备请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section193737375169">环境准备</a>。</span></li><li><span>加载依赖的开源代码：参考tools_dopt/dopt_pytorch_py3/demo/nas_ea/ea_seg_voc_pytorch/readme.md</span></li><li><span>配置demo下的scen.yaml文件和pre_train.yaml文件，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section9753193220185">搜索参数配置</a>。scen.yaml中提供了建议参数，开发者可根据实际需求修改。</span></li><li><span>修改demo下的user_module.py文件，模型接口定义请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-network-structure-search-training#section56271946125514">PyTorch开发者自定义接口</a>。user_module.py中提供了建议配置，开发者可根据实际需求进行修改。</span></li><li><span>执行脚本run_release.sh，在results下，生成多个model_arch_result_*.py文件。开发者可根据log_segmentation中提供的信息选择合适的网络结构进行训练。后续训练可参考readme.md中的指导。</span></li></ol> </div> </div> <div></div></div>