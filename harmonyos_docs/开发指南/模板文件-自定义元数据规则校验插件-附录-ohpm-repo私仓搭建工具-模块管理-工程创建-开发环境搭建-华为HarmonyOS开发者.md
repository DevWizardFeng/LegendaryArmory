<h1 _ngcontent-mnw-c119="" class="doc-title ng-star-inserted" title="模板文件"> 模板文件 </h1>

<div _ngcontent-mnw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000002190118962"><p id="ZH-CN_TOPIC_0000002478173742__p1913119139464">模板文件中包含自定义元数据规则校验插件需要的三个文件：自定义规则校验函数模板文件checkField.ts，自定义规则校验配置模板文件CustomExtensionValidationConfig.json和ts编译为js的配置模板文件tsconfig.json。</p> <p id="ZH-CN_TOPIC_0000002478173742__p19386194131419">请创建指定名称的文件，并把下方源码拷贝到文件中。</p> <div class="tiledSection"><h2 id="section14072085013">自定义规则校验函数模板文件checkField.ts<i class="anchor-icon anchor-icon-link" anchorid="section14072085013" tips="复制节点链接"></i></h2><div _ngcontent-mnw-c106="" class="highlight-div"><div _ngcontent-mnw-c106="" class="highlight-div-header"><div _ngcontent-mnw-c106="" class="highlight-div-header-left"><div _ngcontent-mnw-c106="" class="handle-button expand-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mnw-c106="" class="highlight-div-header-right"><div _ngcontent-mnw-c106="" class="handle-button ai-button"></div><div _ngcontent-mnw-c106="" class="handle-button line-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mnw-c106="" class="handle-button theme-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mnw-c106="" class="handle-button copy-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mnw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478173742__screen1989488216" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//如果自定义校验规则文件checkField.ts存储在默认位置（ohpm-repo解压根目录的plugins/fieldCheckPlugin文件夹内），插件文件checkField.ts中默认工具类引用地址如下</span></li><li><span class="hljs-keyword">import</span> {</li><li>  <span class="hljs-title class_">FieldDataType</span>,</li><li>  <span class="hljs-title class_">ValidationExtensionRule</span></li><li>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../libs/service/validator/validationExtensionRule/ValidationExtensionRule'</span>;      </li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">UserBasicInfo</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../libs/service/validator/validationExtensionRule/type'</span>;</li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">CustomValidateError</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../libs/service/validator/CustomValidateError'</span>;</li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">OhpmLazyLogger</span> <span class="hljs-keyword">as</span> log} <span class="hljs-keyword">from</span> <span class="hljs-string">'../../libs/packages/log'</span>;</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 自定义规则校验</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> fieldData 字段的取值</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> userInfo 发布三方包用户的信息，包含userName和userRole两部分</span></li><li><span class="hljs-comment"> *    userInfo.userName：发布三方包账户的用户名称</span></li><li><span class="hljs-comment"> *    userInfo.userRole：发布三方包账户的用户角色，1表示为管理员账户，0表示为普通用户</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">checkField</span>: <span class="hljs-title class_">ValidationExtensionRule</span> = (<span class="hljs-attr">fieldData</span>: <span class="hljs-title class_">FieldDataType</span>, <span class="hljs-attr">userInfo</span>: <span class="hljs-title class_">UserBasicInfo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = &lt;<span class="hljs-built_in">string</span>&gt;fieldData;      <span class="hljs-comment">// 待校验字段的值，以name为例</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">userName</span>: <span class="hljs-built_in">string</span> = userInfo.<span class="hljs-property">userName</span>;  <span class="hljs-comment">// 发布三方包账户的用户名称</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">userRole</span>: <span class="hljs-built_in">number</span> = userInfo.<span class="hljs-property">userRole</span>;  <span class="hljs-comment">// 发布三方包账户的用户角色，1表示为管理员账户，0表示为普通用户</span></li><li>  <span class="hljs-comment">// 错误抛出分为两部分：CustomValidateError第一个参数内容将打印在ohpm-repo运行日志中（命令行和ohpm-repo管理界面发布三方包均会打印），第二个参数内容将打印在ohpm-repo管理界面弹窗（仅限ohpm-repo管理界面发布三方包）</span></li><li>  <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'package'</span>) {</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomValidateError</span>(<span class="hljs-string">'Cannot publish package named "package"'</span>,</li><li>      <span class="hljs-string">'不能发布包名为package的包'</span>);</li><li>  }</li><li>  <span class="hljs-comment">// 成功日志打印，日志级别打印可以为：log.trace，log.debug，log.info，log.warn和log.error</span></li><li>  log.<span class="hljs-title function_">info</span>(<span class="hljs-string">'校验成功'</span>);  <span class="hljs-comment">// log.debug('校验成功');</span></li><li> };</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1076523392">自定义规则校验配置模板文件CustomExtensionValidationConfig.json<i class="anchor-icon anchor-icon-link" anchorid="section1076523392" tips="复制节点链接"></i></h2><div _ngcontent-mnw-c106="" class="highlight-div"><div _ngcontent-mnw-c106="" class="highlight-div-header"><div _ngcontent-mnw-c106="" class="highlight-div-header-left"><div _ngcontent-mnw-c106="" class="handle-button expand-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mnw-c106="" class="highlight-div-header-right"><div _ngcontent-mnw-c106="" class="handle-button ai-button"></div><div _ngcontent-mnw-c106="" class="handle-button line-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mnw-c106="" class="handle-button theme-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mnw-c106="" class="handle-button copy-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mnw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173742__screen9765231796" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;被校验字段的名称1&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      }</li><li>    ]</li><li>  },</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;被校验字段的名称2&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1613602518915">ts编译为js的配置模板文件tsconfig.json<i class="anchor-icon anchor-icon-link" anchorid="section1613602518915" tips="复制节点链接"></i></h2><div _ngcontent-mnw-c106="" class="highlight-div"><div _ngcontent-mnw-c106="" class="highlight-div-header"><div _ngcontent-mnw-c106="" class="highlight-div-header-left"><div _ngcontent-mnw-c106="" class="handle-button expand-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mnw-c106="" class="highlight-div-header-right"><div _ngcontent-mnw-c106="" class="handle-button ai-button"></div><div _ngcontent-mnw-c106="" class="handle-button line-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mnw-c106="" class="handle-button theme-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mnw-c106="" class="handle-button copy-button"><div _ngcontent-mnw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mnw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173742__screen1613619251694" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// tsconfig.json 文件指定了编译项目所需的根目录下的文件以及编译选项，编译自定义插件文件 .ts 为 .js文件。</span></li><li>{</li><li>  <span class="hljs-string">"include"</span>: [</li><li>    <span class="hljs-string">"plugins/fieldCheckPlugin/*"</span> <span class="hljs-comment">// 插件文件的位置</span></li><li>  ],</li><li>  <span class="hljs-string">"compilerOptions"</span>: {</li><li>    <span class="hljs-string">"target"</span>: <span class="hljs-string">"es2016"</span>,</li><li>    <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"emitDecoratorMetadata"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span>,</li><li>    <span class="hljs-string">"rootDirs"</span>: [</li><li>      <span class="hljs-string">"./src"</span>,</li><li>      <span class="hljs-string">"./test"</span></li><li>    ],</li><li>    <span class="hljs-string">"typeRoots"</span>: [</li><li>      <span class="hljs-string">"./node_modules/@types"</span></li><li>    ],</li><li>    <span class="hljs-string">"types"</span>: [</li><li>      <span class="hljs-string">"node"</span>,</li><li>    ],</li><li>    <span class="hljs-string">"resolveJsonModule"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"./plugins/outDir"</span>,   <span class="hljs-comment">// 编译后文件输出的位置</span></li><li>    <span class="hljs-string">"esModuleInterop"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"forceConsistentCasingInFileNames"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"alwaysStrict"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"noImplicitReturns"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-keyword">true</span></li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>