<h1 _ngcontent-wfj-c119="" class="doc-title ng-star-inserted" title="模板文件"> 模板文件 </h1>

<div _ngcontent-wfj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001840029409"><p id="ZH-CN_TOPIC_0000002478173744__p11452356164814">模板文件中包含自定义storage插件需要的两个文件：CustomStorage.ts和tsconfig.json。</p> <div class="tiledSection"><h2 id="section3671144204619">插件模板CustomStorage.ts<i class="anchor-icon anchor-icon-link" anchorid="section3671144204619" tips="复制节点链接"></i></h2><div _ngcontent-wfj-c106="" class="highlight-div"><div _ngcontent-wfj-c106="" class="highlight-div-header"><div _ngcontent-wfj-c106="" class="highlight-div-header-left"><div _ngcontent-wfj-c106="" class="handle-button expand-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfj-c106="" class="highlight-div-header-right"><div _ngcontent-wfj-c106="" class="handle-button ai-button"></div><div _ngcontent-wfj-c106="" class="handle-button line-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfj-c106="" class="handle-button theme-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfj-c106="" class="handle-button copy-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478173744__screen067144419466" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">StoragePlugin</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'../libs/plugins/storage/customStorage/StoragePlugin'</span>;  <span class="hljs-comment">// 插件文件CustomStorage.ts存储在默认位置（ohpm-repo解压根目录的plugins文件夹内），StoragePlugin接口类的默认引用地址</span></li><li><span class="hljs-keyword">import</span> {getStorageConfigInfo} <span class="hljs-keyword">from</span> <span class="hljs-string">'../libs/common/getStorageConfigInfo'</span>;           <span class="hljs-comment">// 插件文件CustomStorage.ts存储在默认位置（ohpm-repo解压根目录的plugins文件夹内），getStorageConfigInfo方法的默认引用地址</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomStorage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StoragePlugin</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;{</li><li>    <span class="hljs-comment">// 配置文件中 store 项格式参考</span></li><li>    <span class="hljs-comment">// store:</span></li><li>    <span class="hljs-comment">//   type: custom    // store 存储类型为 custom，即用户自定义</span></li><li>    <span class="hljs-comment">//   config:         // 配置信息：export_name和plugin_path 是必选配置项</span></li><li>    <span class="hljs-comment">//     export_name: ExampleDemo          // 插件类的名字：例如 ExampleDemo</span></li><li>    <span class="hljs-comment">//     plugin_path: ../plugins/storage/customStorage/ExampleDemo.js    // 插件文件的存放位置</span></li><li>    <span class="hljs-comment">//     configInfo1: "info1";             // 自定义配置信息（可选项）</span></li><li>    <span class="hljs-comment">//     configInfo2: "info2";             // 自定义配置信息（可选项）</span></li><li>    <span class="hljs-comment">//     ...</span></li><li>    <span class="hljs-comment">// 通过函数 getStorageConfigInfo() 可以获取到配置文件config.yaml中store.config处自定义配置的信息</span></li><li>    <span class="hljs-keyword">const</span> configStorageInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getStorageConfigInfo</span>();</li><li>    <span class="hljs-comment">//举例说明：当配置文件 store.config处定义 configInfo1和 configInfo2信息，可读取</span></li><li>    <span class="hljs-keyword">const</span> configInfo1 = configStorageInfo.<span class="hljs-property">configInfo1</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>; <span class="hljs-comment">//获取到configInfo1的值为 "info1"</span></li><li>    <span class="hljs-keyword">const</span> configInfo2 = configStorageInfo.<span class="hljs-property">configInfo2</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>; <span class="hljs-comment">//获取到configInfo2的值为: "info2"</span></li><li>  };</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 通过文件的本地路径，把数据保存到指定的 storage 内</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> srcPath： 上传文件的本地路径</span></li><li><span class="hljs-comment">   * </span><span class=""><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> packageInfo: 可选参数，待上传包的详细信息，包含包名（含组织名）和包版本号两部分，包名：packageInfo.packageName，包版本：packageInfo.version.</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> 上传文件 save 后的返回信息： 能够标识文件，方便文件删除和读取</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">save</span>(<span class="hljs-attr">srcPath</span>: <span class="hljs-built_in">string</span>, <span class=""><span class="hljs-attr">packageInfo</span></span>: <span class=""><span class="hljs-built_in">any</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;{</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">savedResponse</span>: <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-keyword">return</span> savedResponse;</li><li>  };</li><li>
</li><li>  <span class="hljs-comment">/** 通过上传文件获得的返回信息，定位文件，进行文件的删除，返回删除结果</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> savedResponse： 上传文件 save 后的返回信息</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> 删除的结果：true 表示删除成功</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">delete</span>(<span class="hljs-attr">savedResponse</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;{</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">isDeleteSuccess</span>: <span class="hljs-built_in">boolean</span>;</li><li>    <span class="hljs-keyword">return</span> isDeleteSuccess;</li><li>  };</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 通过上传文件获得的返回信息，定位文件，进行获取文件内容，数据格式为 Buffer</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> savedResponse 上传文件 save 后的返回信息</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> 获取文件的内容，数据格式为 Buffer</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">download</span>(<span class="hljs-attr">savedResponse</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Buffer</span>&gt;{</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">fileContent</span>: <span class="hljs-title class_">Buffer</span>;</li><li>    <span class="hljs-keyword">return</span> fileContent;</li><li>  };</li><li>
</li><li> <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 根据保存文件生成的结果字符串，获取文件下载url</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> savedResponse 保存文件的结果字符串</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getDownloadUrl</span>(<span class="hljs-attr">savedResponse</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;{</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">fileDownloadUrl</span>: <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-keyword">return</span> fileDownloadUrl;</li><li>  };</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section14188258114612">ts编译的配置文件tsconfig.json<i class="anchor-icon anchor-icon-link" anchorid="section14188258114612" tips="复制节点链接"></i></h2><div _ngcontent-wfj-c106="" class="highlight-div"><div _ngcontent-wfj-c106="" class="highlight-div-header"><div _ngcontent-wfj-c106="" class="highlight-div-header-left"><div _ngcontent-wfj-c106="" class="handle-button expand-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfj-c106="" class="highlight-div-header-right"><div _ngcontent-wfj-c106="" class="handle-button ai-button"></div><div _ngcontent-wfj-c106="" class="handle-button line-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfj-c106="" class="handle-button theme-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfj-c106="" class="handle-button copy-button"><div _ngcontent-wfj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfj-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478173744__screen21887583464" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// tsconfig.json 文件指定了编译项目所需的根目录下的文件以及编译选项，编译自定义插件文件 .ts 为 .js文件。</span></li><li>{</li><li>  <span class="hljs-string">"include"</span>: [</li><li>    <span class="hljs-string">"plugins/*"</span> <span class="hljs-comment">// 插件文件的位置</span></li><li>  ],</li><li>  <span class="hljs-string">"compilerOptions"</span>: {</li><li>    <span class="hljs-string">"target"</span>: <span class="hljs-string">"es2016"</span>,</li><li>    <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"emitDecoratorMetadata"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span>,</li><li>    <span class="hljs-string">"rootDirs"</span>: [</li><li>      <span class="hljs-string">"./src"</span>,</li><li>      <span class="hljs-string">"./test"</span></li><li>    ],</li><li>    <span class="hljs-string">"typeRoots"</span>: [</li><li>      <span class="hljs-string">"./node_modules/@types"</span></li><li>    ],</li><li>    <span class="hljs-string">"types"</span>: [</li><li>      <span class="hljs-string">"node"</span>,</li><li>    ],</li><li>    <span class="hljs-string">"resolveJsonModule"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"./plugins/outDir"</span>,   <span class="hljs-comment">// 编译后文件输出的位置</span></li><li>    <span class="hljs-string">"esModuleInterop"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"forceConsistentCasingInFileNames"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"alwaysStrict"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"noImplicitReturns"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-keyword">true</span></li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>