<h1 _ngcontent-aye-c119="" class="doc-title ng-star-inserted" title="模板文件"> 模板文件 </h1>

<div _ngcontent-aye-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001878572997"><p id="ZH-CN_TOPIC_0000002478333734__p8060118">模板文件中包含自定义auth插件需要的两个文件：CustomAuth.ts和tsconfig.json。</p> <div class="tiledSection"><h2 id="section14072085013">插件模板CustomAuth.ts<i class="anchor-icon anchor-icon-link" anchorid="section14072085013" tips="复制节点链接"></i></h2><div _ngcontent-aye-c106="" class="highlight-div"><div _ngcontent-aye-c106="" class="highlight-div-header"><div _ngcontent-aye-c106="" class="highlight-div-header-left"><div _ngcontent-aye-c106="" class="handle-button expand-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aye-c106="" class="highlight-div-header-right"><div _ngcontent-aye-c106="" class="handle-button ai-button"></div><div _ngcontent-aye-c106="" class="handle-button line-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aye-c106="" class="handle-button theme-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aye-c106="" class="handle-button copy-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aye-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478333734__screen1989488216" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">{AuthPlugin}</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../libs/plugins/auth/AuthPlugin'</span>;  <span class="hljs-comment">// 插件文件CustomAuth.ts存储在默认位置（ohpm-repo解压根目录的plugins文件夹内），默认引用地址</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAuth</span> <span class="hljs-variable">implements</span> <span class="hljs-variable">AuthPlugin</span> {</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 用户认证:根据accessToken的值，返回用户的数据:用户的id，用户的名字，用户所属的组织，用户所创建的组织</span></li><li><span class="hljs-comment">   * @param accessToken 用户的accessToken</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">auth</span>(<span class="hljs-variable">accessToken</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">Promise</span>&lt;{</li><li>    <span class="hljs-title class_">id</span>: <span class="hljs-title class_">string</span>;                         <span class="hljs-comment">// 用户的id，保证唯一性</span></li><li>    <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;                       <span class="hljs-comment">// 用户的名字，保证唯一性</span></li><li>    <span class="hljs-variable">belongGroupList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;     <span class="hljs-comment">// 用户所在的组织，具有发指定组织包的权限</span></li><li>    <span class="hljs-variable">groupAdminList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;      <span class="hljs-comment">// 用户所管理的组织，具有删除指定组织内包的权限</span></li><li>  }&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">id</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">belongGroupList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;, <span class="hljs-variable">groupAdminList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;</li><li>    <span class="hljs-keyword">return</span> {<span class="hljs-variable">id</span>, <span class="hljs-variable">name</span>, <span class="hljs-variable">belongGroupList</span>, <span class="hljs-variable">groupAdminList</span>};</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 用户信息获取:根据只读accessToken的值，返回用户的数据:用户id，用户名字，用户所属的组织，用户所创建的组织</span></li><li><span class="hljs-comment">   * @param accessToken 用户的只读accessToken</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">authWithReadOnly</span>(<span class="hljs-variable">accessToken</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">Promise</span>&lt;{</li><li>    <span class="hljs-title class_">id</span>: <span class="hljs-title class_">string</span>;                         <span class="hljs-comment">// 用户的id，保证唯一性</span></li><li>    <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;                       <span class="hljs-comment">// 用户的名字，保证唯一性</span></li><li>    <span class="hljs-variable">belongGroupList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;     <span class="hljs-comment">// 用户所在的组织，具有发指定组织包的权限</span></li><li>    <span class="hljs-variable">groupAdminList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;      <span class="hljs-comment">// 用户所管理的组织，具有删除指定组织内包的权限</span></li><li>  }&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">id</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">belongGroupList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;, <span class="hljs-variable">groupAdminList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;;</li><li>    <span class="hljs-keyword">return</span> {<span class="hljs-variable">id</span>, <span class="hljs-variable">name</span>, <span class="hljs-variable">belongGroupList</span>, <span class="hljs-variable">groupAdminList</span>};</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 根据用户id,返回用户的名字</span></li><li><span class="hljs-comment">   * @param id 用户的id值</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-variable">id</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">string</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">name</span>;</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section14188258114612">ts编译的配置文件tsconfig.json<i class="anchor-icon anchor-icon-link" anchorid="section14188258114612" tips="复制节点链接"></i></h2><div _ngcontent-aye-c106="" class="highlight-div"><div _ngcontent-aye-c106="" class="highlight-div-header"><div _ngcontent-aye-c106="" class="highlight-div-header-left"><div _ngcontent-aye-c106="" class="handle-button expand-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aye-c106="" class="highlight-div-header-right"><div _ngcontent-aye-c106="" class="handle-button ai-button"></div><div _ngcontent-aye-c106="" class="handle-button line-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aye-c106="" class="handle-button theme-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aye-c106="" class="handle-button copy-button"><div _ngcontent-aye-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aye-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478333734__screen21887583464" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// tsconfig.json 文件指定了编译项目所需的根目录下的文件以及编译选项，编译自定义插件文件.ts为.js文件。</span></li><li>{</li><li>  <span class="hljs-string">"include"</span>: [</li><li>    <span class="hljs-string">"plugins/*"</span> <span class="hljs-comment">// 插件文件的位置</span></li><li>  ],</li><li>  <span class="hljs-string">"compilerOptions"</span>: {</li><li>    <span class="hljs-string">"target"</span>: <span class="hljs-string">"es2016"</span>,</li><li>    <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"emitDecoratorMetadata"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span>,</li><li>    <span class="hljs-string">"rootDirs"</span>: [</li><li>      <span class="hljs-string">"./src"</span>,</li><li>      <span class="hljs-string">"./test"</span></li><li>    ],</li><li>    <span class="hljs-string">"typeRoots"</span>: [</li><li>      <span class="hljs-string">"./node_modules/@types"</span></li><li>    ],</li><li>    <span class="hljs-string">"types"</span>: [</li><li>      <span class="hljs-string">"node"</span>,</li><li>    ],</li><li>    <span class="hljs-string">"resolveJsonModule"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"./plugins/outDir"</span>,   <span class="hljs-comment">// 编译后文件输出的位置</span></li><li>    <span class="hljs-string">"esModuleInterop"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"forceConsistentCasingInFileNames"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"alwaysStrict"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"noImplicitReturns"</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-keyword">true</span></li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>