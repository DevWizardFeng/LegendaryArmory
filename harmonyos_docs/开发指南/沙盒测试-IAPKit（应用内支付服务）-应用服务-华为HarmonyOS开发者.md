<h1 _ngcontent-bmr-c119="" class="doc-title ng-star-inserted" title="沙盒测试"> 沙盒测试 </h1>

<div _ngcontent-bmr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>沙盒测试允许开发者在接入华为应用内支付调测过程中对订单进行虚拟支付。</p>    <p>推荐您在提交数字商品审核前、即商品处于草稿/待提交状态下，使用沙盒测试进行调测。您可以通过设置沙盒测试账户，来模拟真实环境下数字商品的交易过程，在测试期间发现问题可以及时进行修复，这样确保了在商品上架生效以后可以提供给用户稳定流畅的商品购买体验。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>沙盒订单并非真实订单，无法在[开发者中心]-&gt;[我的报表]-&gt;[支付报表]中查询。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section1055471316">配置沙盒测试<i class="anchor-icon anchor-icon-link" anchorid="section1055471316" tips="复制节点链接"></i></h2>          <ul>      <li id="li145164719318">添加测试账号       <p>在进行测试前，需要在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>中的“用户与访问”中添加测试账号，这些测试账号必须是真实的华为账号。开发者在接入IAP Kit沙盒测试时，需要在测试设备上登录已添加的测试账号。添加沙盒测试账号步骤如下：</p>       <ol>        <li>登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“用户与访问”。</li>        <li>左侧导航栏选择“沙盒测试 &gt; 测试账号”，点击“新增”。         <p><span><img height="230.37055555555554" originheight="309" originwidth="1234" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114519.47780913915328553711867988122239:50001231000000:2800:328DC52E3ABBC500C995ADFD5EFB7245F7488166FCDD177571E246D4217F5541.png" title="点击放大" width="920"></span></p></li>        <li>填写测试账号信息后，点击“确认”。         <p><span><img height="332.9505555555556" originheight="374" originwidth="1030" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114519.42918627213077595293800659362391:50001231000000:2800:398BF5AECB16BB3BB02FCBA3632254C60D57320ED253445505310AEA7D907995.png" title="点击放大" width="920"></span></p></li>       </ol>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>此配置需要5~10min才能生效。</p>        </div></div></div></li>     </ul>     <ul>      <li id="li151047103116">构建debug签名的应用       <p>接入的应用必须是debug签名的应用。构建debug签名应用步骤如下：</p>       <p>1.手动签名：您需要在AGC中<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-debug-cert-0000002283256797" target="_blank">申请调试证书</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-add-device-0000002283189937" target="_blank">注册调试设备</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-debug-profile-0000002248181278" target="_blank">申请调试Profile</a>后，再<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section297715173233" target="_blank">手动配置签名信息</a>。</p>       <p>2.在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>中<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-cert-fingerprint-0000002278002933" target="_blank">配置公钥指纹</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section549681919384">沙盒测试能力未生效自检<i class="anchor-icon anchor-icon-link" anchorid="section549681919384" tips="复制节点链接"></i></h2>          <p>如果配置的沙盒账号未生效，可参见<a href="/consumer/cn/doc/harmonyos-guides/iap-sandbox#section1055471316">配置沙盒测试</a>检查当前是否满足沙盒测试的两个条件：</p>     <ul>      <li>是否已在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>添加测试账号。</li>      <li>应用是否是debug签名。</li>     </ul>     <p>此外也可在应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section634215616315" target="_blank">isSandboxActivated</a>接口来检查当前沙盒环境不可用的原因。</p>    </div>    <div class="tiledSection">     <h2 id="section5152112319383">测试消耗型/非消耗型商品购买<i class="anchor-icon anchor-icon-link" anchorid="section5152112319383" tips="复制节点链接"></i></h2>          <p>在满足沙盒测试条件下，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section18798154545516" target="_blank">createPurchase</a>接口拉起收银台，用户按照正常流程完成购买，但实际不会产生真实扣费。</p>     <ul>      <li>沙盒环境下的购买流程与正式环境的购买流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li>      <li>IAP购买成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li>      <li>沙盒环境下购买非消耗型商品，购买之后可以确认发货，之后可以再次测试购买。</li>      <li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示语，支付结果页也有沙盒环境的提示语，如下图所示。</li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>如果未显示截图的提示页面，表示本次交易未进入沙盒测试环境，继续测试会实际扣费，请参照<a href="/consumer/cn/doc/harmonyos-guides/iap-sandbox#section549681919384">沙盒测试能力未生效自检</a>。</p>      </div></div></div>     <p><span><img height="558.6" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.79265490282568946533718276585117:50001231000000:2800:6E69A1080E1E68C5C08AD95517C776BF4D6A5DC4D01EDE1857B449E1F6254E2B.png" title="点击放大" width="263.7257"></span> <span><img height="558.6" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.09512466796720400164266403738018:50001231000000:2800:508982F5F3003B19DF241F58185A36139E253E7778817D2B4EF9064E15E8B5F9.png" title="点击放大" width="263.7257"></span></p>    </div>    <div class="tiledSection">     <h2 id="section67952025102912">测试自动续期订阅商品<i class="anchor-icon anchor-icon-link" anchorid="section67952025102912" tips="复制节点链接"></i></h2>          <p>自动续期订阅商品的购买流程和消耗型/非消耗型商品的购买流程类似，但订阅还有其他细节场景，比如续订成功或失败，续订周期时长。为了帮助开发者快速测试应用的订阅场景，沙盒环境下的订阅续订时间会比正常情况更快，引入“时光机”概念，沙盒环境中的订阅换算时间为10秒/天。比如订阅周期为1周，商品将在首次购买成功70秒后发生续期。</p>     <ul>      <li>沙盒环境下的订阅流程与正式环境的订阅流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li>      <li>IAP扣费成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li>      <li>自动续期处理不需要完成真实扣款，IAP会直接返回成功。</li>      <li>在沙盒测试环境下，订阅首期由用户发起后会自动续期五次（累计共六期），后续需用户手动操作以恢复订阅；若同时涉及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/iap-subscription-functions#section15231185754812">促销场景</a>，系统将优先完成优惠周期内的自动续期，再继续进行六次续期，此场景下总续期次数为优惠周期数与六次续期之和。</li>      <li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示语，支付结果页也有沙盒环境的提示语，如下图所示。</li>     </ul>     <p><span><img height="563.9599" originheight="3053" originwidth="1440" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.20966395624692448999375847560680:50001231000000:2800:8899E017D433A17523F4113CBADBA4675DDD8345D025560C25D7E2CCCC0A2B9A.png" title="点击放大" width="266"></span> <span><img height="563.9599" originheight="3053" originwidth="1440" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.89371328096310716816110297451944:50001231000000:2800:7E0DC830E85EB25805DA4EA6854A286CF9BC95563F5E9B1BBF89D358DA8F60C3.png" title="点击放大" width="266"></span></p>    </div>    <div class="tiledSection">     <h2 id="section31381719195017">测试非续期订阅商品购买<i class="anchor-icon anchor-icon-link" anchorid="section31381719195017" tips="复制节点链接"></i></h2>          <p>在满足沙盒测试条件下，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section18798154545516" target="_blank">createPurchase</a>接口拉起收银台，用户按照正常流程完成购买，但实际不会产生真实扣费。</p>     <ul>      <li>沙盒环境下的购买流程与正式环境的购买流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li>      <li>IAP购买成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li>      <li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示，结果页也有沙盒环境的标志，如下图所示。</li>     </ul>     <p><span><img height="523.2136210000001" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.51597091343624628187758262599337:50001231000000:2800:F9A2FD5F1F311D8A4E1C3148C4826A8446495041F125E0BEE34B72B6FB2F5295.png" title="点击放大" width="266.55594"></span> <span><img height="523.139939" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114520.36313296020482318304468764454148:50001231000000:2800:F7F2FC18896D764F967579A46CDD29FD5799114F7DF48A95B9E61F905EC748DD.png" title="点击放大" width="272.16987"></span></p>    </div>    <div class="tiledSection">     <h2 id="section10270449145612">测试退款请求<i class="anchor-icon anchor-icon-link" anchorid="section10270449145612" tips="复制节点链接"></i></h2>          <p>开发者可以使用沙盒账号，针对在沙盒环境下购买商品产生的订单交易提交退款申请。该退款申请默认跳过退款审核和款项原路退回流程（沙盒环境下不真实扣费），IAP服务器会在沙盒环境中默认自动同意退款申请，同时给开发者服务器发送退款成功事件通知，以便开发者在收到退款事件通知后，测试应用内权益回收等场景。</p>     <p>具体操作步骤如下：</p>     <ol>      <li><span>在应用沙盒测试环境使用沙盒账号购买商品后，在测试设备上“手机设置 &gt; 华为账号 &gt; 付款与账单 &gt; 购买记录”中会自动生成沙盒订单。</span></li>      <li><span>点击待测试退款请求的沙盒订单，跳转至详情页面，点击“对订单有疑问”。</span>       <p></p>       <p><span><img height="547.3083" originheight="745" originwidth="359" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.09519929621521280775002120900872:50001231000000:2800:EE0CB7201EAEACB9CF5AABCB8FACBD45ACF7D8AFDDC03863F21A7D7DAEAEFD1F.png" title="点击放大" width="266"></span></p>       <p></p></li>      <li><span>在“对订单有疑问”页面，点击“申请退款”，选择任意的退款原因和填写任意必填资料后，提交退款申请。</span>       <p></p>       <p><span><img height="549.7289" originheight="2258" originwidth="1092" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.30681005200992592801468182378040:50001231000000:2800:B2C92824C657D839B7D622B8016112617A493CCB9EDCFF231294BF07DABB7744.png" title="点击放大" width="266"></span><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.56011033021950442010497187586811:50001231000000:2800:E41049AB2F846C553DE0E437FE821BD8FD73E2DA3F130A4CD32A0DCD3E5B02D2.png" title="点击放大" width="266"></span></p>       <p></p></li>      <li><span>退款申请提交后，IAP服务器默认跳过退款审核和款项原路退回流程，自动同意该笔退款申请，同时给开发者服务器发送退款成功事件通知（NotificationSubtype：REFUND_TRANSACTION）。如果开发者配置了沙盒环境服务器地址，则该笔通知发送至沙盒环境服务器，详情请参考“<a href="https://developer.huawei.com/consumer/cn/doc/app/parameters-0000001931995692" target="_blank">事件通知配置</a>”。</span></li>      <li><span>开发者收到退款成功事件通知后，在测试环境中模拟应用内对该沙盒账号进行权益回收等操作，以实现测试目的。</span></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section184992239551">清除沙盒账号的购买历史记录<i class="anchor-icon anchor-icon-link" anchorid="section184992239551" tips="复制节点链接"></i></h2>          <p>开发者可以清除沙盒账号的购买历史记录，以便继续使用同一个沙盒账号进行测试。清除购买历史记录后，该测试账号在沙盒环境中产生的所有商品购买记录（包括自动续期订阅和消耗型/非消耗型商品）都将被删除，删除后该账号即可在沙盒环境中重新购买自动续期订阅商品、消耗型/非消耗型商品。清除购买历史记录后无法撤销操作。此操作不会影响生产环境数据。</p>     <p>清除沙盒账号购买历史记录的操作步骤如下：</p>     <ol>      <li><span>登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“用户与访问”。</span>       <p></p>       <p><span><img height="102.7461111111111" originheight="153" originwidth="1370" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.47890598315108975165201014632745:50001231000000:2800:D4A0156C4D881B9F34CD9F835D7E105ACE7B10F94595FB0AAFE201B21056339C.png" title="点击放大" width="920"></span></p>       <p></p>       <p></p></li>      <li><span>左侧导航栏选择“沙盒测试 &gt; 测试账号”，勾选对应的测试账号，点击右上角的“清除购买历史记录”按钮。</span>       <p></p>       <p><span><img height="419.12388888888887" originheight="522" originwidth="1153" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.22373161827255170032122779788002:50001231000000:2800:E770A15D9EC2D5F6EA0BAB72C97DB4A778247E9898896125DAFDB9D8AD34D54D.png" title="点击放大" width="920"></span></p>       <p></p>       <p></p></li>      <li><span>在出现的提示弹窗中，点击“确认”按钮，随后该账号在沙盒环境中产生的购买历史记录将被清除，此操作无法被撤销。如果该沙盒账号的购买次数较多，则清除其购买历史记录可能需要更长时间。</span>       <p></p>       <p><span><img height="273.19530000000003" originheight="298" originwidth="411" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114521.08519674204107700407384385447761:50001231000000:2800:9E8882A9A2CA5422C718F810C5C5C1A5A3F29618741D58C828F85A0C172EB6FF.png" title="点击放大" width="374.74080000000004"></span></p>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section134121448182313">测试商品购买失败场景<i class="anchor-icon anchor-icon-link" anchorid="section134121448182313" tips="复制节点链接"></i></h2>          <p>在满足沙盒测试条件下，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section18798154545516" target="_blank">createPurchase</a>接口拉起收银台。如果当前应用的“中断此测试账号的购买流程”配置项已配置，则用户将会在订单确认购买后被拦截。开发者可以测试该场景下应用的错误处理流程。具体模拟购买失败操作步骤如下：</p>     <ol>      <li><span>开发者在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>上配置“<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-testaccount-0000001146438651#section9546175114555" target="_blank">中断此测试账号的购买流程</a>”。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>当开发者在AppGallery Connect中更改了“中断此测试账号的购买流程”配置，需要等待3~5分钟后可尝试进行商品购买以触发数据刷新。</p>        </div></div></div>       <p></p></li>      <li><span>用户选择购买消耗型/非消耗型/非续期订阅型/自动续期订阅型商品，按照正常流程进行拉起收银台下单。</span></li>      <li><span>当用户确认购买后将会收到“服务暂不可用，请稍后重试”的错误提示，而开发者应用将会收到“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-error-code#section446955461117" target="_blank">1001860056 用户交易被拒绝</a>”的错误。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>若购买结果与预期不一致，可尝试等待1分钟后继续购买。</p>        </div></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section241354812311">测试自动续期订阅型商品续期失败场景<i class="anchor-icon anchor-icon-link" anchorid="section241354812311" tips="复制节点链接"></i></h2>          <p>在满足沙盒测试条件下，当沙盒用户已购买自动续期订阅型商品，则开发者可以在App Gallery Connect中配置“中断此测试账号的购买流程”，模拟沙盒用户续期失败的场景。当沙盒用户持续地续期失败后订阅将会过期，IAP服务器将会向开发者服务器发送用户订阅过期的通知，开发者在收到订阅过期事件通知后，可测试应用内权益回收等场景。</p>     <p>具体操作步骤如下：</p>     <ol>      <li><span>沙盒用户按照正常流程购买自动续期订阅型商品。</span></li>      <li><span>开发者在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>上配置“<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-testaccount-0000001146438651#section9546175114555" target="_blank">中断此测试账号的购买流程</a>”。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>当开发者在AppGallery Connect中更改了“中断此测试账号的购买流程”配置，需要等待3~5分钟后可尝试进行商品购买以触发数据刷新。</p>        </div></div></div>       <p></p></li>      <li><span>在测试设备上“系统设置--&gt;华为帐号-&gt;付款与账单-&gt;订阅-&gt;订阅详情”，预期会出现用户订阅续期异常的提示。</span></li>     </ol>    </div>   </div>   <div></div></div>