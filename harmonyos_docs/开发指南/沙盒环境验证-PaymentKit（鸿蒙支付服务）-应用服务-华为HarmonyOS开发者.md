<h1 _ngcontent-jqs-c119="" class="doc-title ng-star-inserted" title="沙盒环境验证"> 沙盒环境验证 </h1>

<div _ngcontent-jqs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>华为支付提供沙盒环境，开发者无需真实完成商户入网即可开始调试华为支付接入，模拟真实环境下华为支付交易过程，提前介入方案设计和开发联调，提升接入效率。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>沙盒环境当前仅支持部分能力及接口调试，具体可参见<a href="/consumer/cn/doc/harmonyos-guides/payment-sandbox-test#section174659794311">沙盒环境接口请求及支持维度说明</a>。</li>       <li>使用沙盒环境验证支付场景，支付成功不会产生真实扣款。</li>       <li>当前沙盒环境创建的订单与真实环境订单暂无明确的沙盒验证相关标识，开发者应自行将沙盒验证订单与真实订单做区分（如在商户订单号中添加沙盒标识、预下单通过payload字段添加标识等）。</li>       <li>沙盒环境支付订单暂不支持分账，生成、查询及下载账单数据。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="section099243610350">沙盒环境调试配置<i class="anchor-icon anchor-icon-link" anchorid="section099243610350" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1318575016917" class="firsth2">获取沙盒环境配置<i class="anchor-icon anchor-icon-link" anchorid="section1318575016917" tips="复制节点链接"></i></h3>          <p>在沙盒验证前，需要生成沙盒环境配置信息（如商户号、证书ID、用户账号、支付密码等）进行调试，生成沙盒环境配置暂不支持开发者生成，请联系华为工程师获取，相关咨询可<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-service-support">点击此处</a>或者通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/add/13?level2=111" target="_blank">在线工单系统</a>与我们联系。</p>     <p>生成沙盒环境配置信息需提供如下信息：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.1" valign="top" width="15.83%">          <p>配置项</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.2" valign="top" width="9.74%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.3" valign="top" width="74.42999999999999%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="15.83%">          <p>商户模式</p>          <p>(mercNo)</p></td>         <td class="cellrowborder" valign="top" width="9.74%">          <p>是</p></td>         <td class="cellrowborder" valign="top" width="74.42999999999999%">          <p>沙盒验证使用的商户模式。</p>          <ul>           <li>DIRECT：直连（普通）</li>           <li>AGENT：服务商</li>           <li>PLAT_AGENT：平台商户</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="15.83%">          <p>应用ID</p>          <p>(appId)</p></td>         <td class="cellrowborder" valign="top" width="9.74%">          <p>是</p></td>         <td class="cellrowborder" valign="top" width="74.42999999999999%">          <p>应用的AppID（在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站点击“开发与服务”，在项目列表中找到项目，在“项目设置 &gt; 常规”页面的“应用”区域获取“APP ID”的值）。</p>          <p>生成的沙盒验证配置需要与开发者应用关联。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="15.83%">          <p>华为账号</p>          <p>(hwAccount)</p></td>         <td class="cellrowborder" valign="top" width="9.74%">          <p>是</p></td>         <td class="cellrowborder" valign="top" width="74.42999999999999%">          <p>开发者华为账号。用于生成测试用账号及支付密码等测试信息。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section4936111191018">构建debug签名应用<i class="anchor-icon anchor-icon-link" anchorid="section4936111191018" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开发者应用为debug模式，应用相关测试场景才能正常进入沙盒环境。</p>      </div></div></div>     <p>构建debug签名应用步骤如下：</p>     <ol>      <li>参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-cert-0000002270829389" target="_blank">手动签名方式调试HarmonyOS应用/元服务</a>，申请应用调试证书-&gt;注册调试设备-&gt;申请调试Profile。</li>      <li>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section1240072619462" target="_blank">配置签名信息</a>，在DevEco Studio侧配置签名信息。</li>      <li>在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>中<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-cert-fingerprint-0000002278002933" target="_blank">配置应用签名证书指纹</a>。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section174659794311">沙盒环境接口请求及支持维度说明<i class="anchor-icon anchor-icon-link" anchorid="section174659794311" tips="复制节点链接"></i></h2>          <p>REST API请求说明：</p>     <ol>      <li>沙盒环境调试开放API接口请使用以下站点：       <div _ngcontent-jqs-c106="" class="highlight-div"><div _ngcontent-jqs-c106="" class="highlight-div-header"><div _ngcontent-jqs-c106="" class="highlight-div-header-left"><div _ngcontent-jqs-c106="" class="handle-button expand-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqs-c106="" class="highlight-div-header-right"><div _ngcontent-jqs-c106="" class="handle-button ai-button"></div><div _ngcontent-jqs-c106="" class="handle-button line-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqs-c106="" class="handle-button theme-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqs-c106="" class="handle-button copy-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>https://petalpay-developer-sandbox.cloud.huawei.com.cn</li></ol></pre></div></div></li>      <li>沙盒环境REST API 接口请求与真实环境请求方式一致，仅使用的配置不同（参见<a href="/consumer/cn/doc/harmonyos-guides/payment-sandbox-test#section099243610350">沙盒环境调试配置</a>），API接口调用请参见REST API<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview" target="_blank">公共说明</a>以及对应的API接口说明。</li>     </ol>     <p>沙盒调试支持调试的能力维度如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" colspan="2" id="mcps1.3.6.5.1.4.1.1" valign="top">          <p>操作层面</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.4.1.2" valign="top">          <p>能力维度描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" colspan="2" valign="top">          <p>用户</p></td>         <td class="cellrowborder" valign="top">          <p><strong>用户登录</strong>：支持用户在支付过程中使用华为账号进行登录操作。</p>          <p><strong>银行卡支付</strong>：支持用户在华为支付收银台选择银行卡支付（测试配置默认绑定测试银行卡，暂不支持用户主动绑卡）。</p>          <p><strong>余额支付</strong>：支持用户在华为支付收银台选择余额支付（<span style="color: rgb(34,34,34);">预置余额，暂不支持充值，支付后不会产生扣费</span>）。</p>          <p><strong>密码支付</strong>：支持用户在华为支付收银台通过输入密码完成支付（不支持修改用户支付密码）。</p></td>        </tr>        <tr>         <td class="cellrowborder" colspan="2" valign="top">          <p>商户（开发者）</p></td>         <td class="cellrowborder" valign="top">          <p><strong>拉起支付收银台：</strong>支持商户应用/元服务通过预下单接口获取预支付ID（prepayId）构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>参数调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起华为支付收银台。</p>          <p><strong>调用REST API接口查询订单、退款等操作：</strong></p>          <ul>           <li><strong>直连商户：</strong>            <ul>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-prepay" target="_blank">预下单</a>：商户可以通过本接口提交华为支付订单信息，同时获取华为支付预交易订单号。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-pay-notify" target="_blank">支付结果回调通知</a>：用户支付完成后，华为支付服务器通过开发者请求预下单接口时入参传递的回调通知URL（callbackUrl）向开发者的服务器发送支付关键事件通知。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-query-order" target="_blank">查询支付订单</a>：商户可以通过本接口查询某笔交易订单状态。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-service--refund" target="_blank">申请退款</a>：商户可以调用此接口将订单金额退换给用户。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-refund-notify" target="_blank">退款结果通知</a>：用户支付完成后，华为支付服务器通过开发者请求申请退款接口时入参传递的回调通知URL（callbackUrl）向开发者的服务器发送支付关键事件通知。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-query-refund" target="_blank">查询退款订单</a>：商户调用退款申请成功后，商户可以调用此接口查询退款订单状态。</li>            </ul></li>           <li><strong>平台类商户/服务商：</strong>            <ul>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-prepay" target="_blank">预下单</a>：平台类商户/服务商可通过本接口提交华为支付订单信息，同时获取华为支付预交易订单号。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-pay-notify" target="_blank">支付结果回调通知</a>：用户支付完成后，华为支付服务器通过开发者请求预下单接口时入参传递的回调通知URL（callbackUrl）向开发者的服务器发送支付关键事件通知。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-query-order" target="_blank">查询支付订单</a>：平台类商户/服务商可通过本接口查询某笔交易订单状态。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-refund" target="_blank">申请退款</a>：平台类商户/服务商可调用此接口将订单金额退换给用户。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-refund-notify" target="_blank">退款结果通知</a>：用户支付完成后，华为支付服务器通过开发者请求申请退款接口时入参传递的回调通知URL（callbackUrl）向开发者的服务器发送支付关键事件通知。</li>             <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agentmerc-query-refund" target="_blank">查询退款订单</a>：调用退款申请成功后，平台类商户/服务商可调用此接口查询退款订单状态。</li>            </ul></li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section17578205510508">验证商户基础支付场景<i class="anchor-icon anchor-icon-link" anchorid="section17578205510508" tips="复制节点链接"></i></h2>          <p><strong>支持商户模型：</strong>直连商户、平台类商户、服务商</p>     <ol>      <li>在满足沙盒验证条件（已获取<a href="/consumer/cn/doc/harmonyos-guides/payment-sandbox-test#section099243610350">沙盒环境调试配置</a>）下，开发者可以使用沙盒环境配置调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-prepay" target="_blank">直连商户预下单</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-agent-prepay" target="_blank">平台类商户/服务商预下单</a>获取预支付ID（prepayId）构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section192192415554" target="_blank">requestPayment</a>接口拉起Payment Kit支付收银台（开发步骤可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-payment-process#section9187179113620">商户基础支付场景</a>）。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>沙盒环境下的支付流程与正式环境的支付流程一致，相关配置信息（如mercNo、authId等）需要替换为沙盒环境的站点及配置。</li>          <li>使用沙盒环境时，构建的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>中需要传递沙盒环境标识sandbox_flag。示例如下：           <div _ngcontent-jqs-c106="" class="highlight-div"><div _ngcontent-jqs-c106="" class="highlight-div-header"><div _ngcontent-jqs-c106="" class="highlight-div-header-left"><div _ngcontent-jqs-c106="" class="handle-button expand-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqs-c106="" class="highlight-div-header-right"><div _ngcontent-jqs-c106="" class="handle-button ai-button"></div><div _ngcontent-jqs-c106="" class="handle-button line-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqs-c106="" class="handle-button theme-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqs-c106="" class="handle-button copy-button"><div _ngcontent-jqs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{<span class="hljs-string">"app_id"</span>:<span class="hljs-string">"101831***"</span>,<span class="hljs-string">"merc_no"</span>:<span class="hljs-string">"101610000***"</span>,<span class="hljs-string">"prepay_id"</span>:<span class="hljs-string">"12507011723580897591704***"</span>,<span class="hljs-string">"timestamp"</span>:<span class="hljs-string">"1751361838042"</span>,<span class="hljs-string">"noncestr"</span>:<span class="hljs-string">"6f18060eee669126b98e474407cc0682"</span>,<span class="hljs-string">"sign"</span>:<span class="hljs-string">"OeS+xINxcEoClk+WlsLdnZqL0aIJ5qV734StxULDIgnwz8********************qURxBMzdT2NqdwNefGfrcB5kWVic0RuLz8wqrUPoQBrcl83VVzw59jmgrupitpHMD9sHDpja92H4AMP2SBOdFR2a58qexJves26iTO2f2hsSKFSUEUlHYEW/bgZmVv83GOTo4wIaIbN94gBjkou0kBInTqP2Ht0R9gzVCdB0pYLK+PM4nCY72TkeglyuYHjzD6GlqKMO3UZmuUoqYi8="</span>,<span class="hljs-string">"auth_id"</span>:<span class="hljs-string">"101610000031***"</span>,<strong><span class="hljs-string">"reserved"</span>:<span class="hljs-string">"{\"sandbox_flag\": true}"</span></strong>}</li></ol></pre></div></div></li>          <li>如果用户没有提前登录，系统会拉起华为账号登录页面让用户登录，请使用沙盒环境用户账户进行登录。</li>         </ul>        </div></div></div></li>      <li>用户按照正常流程完成支付（实际不会产生真实扣费）后，开发者可以收到回调通知，需要完成回调事件处理。开发者也可以主动请求订单查询、申请退款等接口，以完成订单查询、退款等整个支付流程的闭环。       <p>沙盒环境拉起支付收银台完成订单支付与正常环境支付流程体验一致，页面示例参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-payment-process#section1880231055910">商户基础支付场景</a>所示。</p></li>     </ol>    </div>   </div>   <div></div></div>