<h1 _ngcontent-wus-c119="" class="doc-title ng-star-inserted" title="测试数字商品服务"> 测试数字商品服务 </h1>

<div _ngcontent-wus-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>沙盒测试允许开发者在接入数字商品服务的调测过程中无需真实付款即可完成数字商品的购买等相关测试。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>沙盒订单并非真实订单，无法在[开发者中心]-&gt;[我的报表]-&gt;[支付报表]中查询。</p> </div></div></div> <div class="tiledSection"><h2 id="section1055471316">配置沙盒测试<i class="anchor-icon anchor-icon-link" anchorid="section1055471316" tips="复制节点链接"></i></h2><ul><li>设置测试账号<p>在进行测试前，需要在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>中的“用户与访问”中添加测试账号，这些测试账号都是真实的华为账号。开发者在HarmonyOS上接入IAP沙盒测试时，需要在测试设备上登录已配置的测试账号。添加沙盒测试账号步骤如下：</p> <ol><li>登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“用户与访问”。</li><li>左侧导航栏选择“沙盒测试 &gt; 测试账号”，点击“新增”。<p><span><img height="56.8575" originheight="207" originwidth="1902" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114631.74758022306539313795520719343986:50001231000000:2800:C29743E9C4A9DAD9C4E891ED5BB5C1FCE48F66DC79CF7AA24AE5CBE9714458B0.png" title="点击放大" width="523.6875"></span></p> <p></p> </li><li>填写测试账号信息后，点击“确认”。<p><span><img height="375.06" originheight="406" originwidth="566" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114631.98547517705046360441105454733255:50001231000000:2800:04C5F7303023A2DE4828B9B3EA841B9BB8CB4823875275AB3AEF4062519755A0.png" title="点击放大" width="523.6875"></span></p> <p></p> </li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>沙盒测试账号必须填写已注册、真实的华为账号。添加完成之后需要5~10min才能生效。使用时请检查当前的账号是否支持沙盒测试。</p> </div></div></div> </li></ul> <ul><li>构建debug签名的应用<p>接入的应用必须是debug签名的应用。构建debug签名应用步骤如下：</p> </li></ul> <ol><li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-debug-app-0000001914423098" target="_blank">手动签名方式调试HarmonyOS应用/元服务</a>，申请应用调试证书-&gt;注册调试设备-&gt;申请调试Profile。</span></li><li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-publish-app#section280162182818" target="_blank">配置签名信息</a>，在DevEco Studio侧配置签名信息。</span></li><li><span>在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>中<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-signature-info-0000001628566748#section5181019153511" target="_blank">配置应用签名证书指纹</a>。</span></li></ol> </div> <div class="tiledSection"><h2 id="section549681919384">沙盒测试能力未生效自检<i class="anchor-icon anchor-icon-link" anchorid="section549681919384" tips="复制节点链接"></i></h2><p>如果配置的沙盒账号未生效，可参见<a href="/consumer/cn/doc/harmonyos-guides/store-iap-sandbox#section1055471316">配置沙盒测试</a>检查当前是否满足沙盒测试的两个条件：</p> <ul><li>是否已在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>添加测试账号。</li><li>应用是否是debug签名。</li></ul> <p>此外也可在应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section634215616315" target="_blank">isSandboxActivated</a>接口来检查当前沙盒环境不可用的原因。</p> </div> <div class="tiledSection"><h2 id="section5152112319383">测试消耗/非消耗型商品购买<i class="anchor-icon anchor-icon-link" anchorid="section5152112319383" tips="复制节点链接"></i></h2><p>在满足沙盒测试条件下，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section18798154545516" target="_blank">createPurchase</a>接口拉起收银台，跳过实际支付环节，直接购买成功。</p> <ul><li>沙盒环境下的购买流程与正式环境的购买流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li><li>购买成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li><li>沙盒环境下购买非消耗型商品，购买之后可以确认发货以完成购买，之后可以再次购买，以方便测试。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>正式环境下，非消耗型商品仅允许用户购买一次，不能重复购买。</p> </div></div></div> </li><li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示，结果页也有沙盒环境的标志，如下图所示。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果未显示截图的提示页面，表示本次交易未进入沙盒测试环境，继续测试会实际扣费，请检查当前是否满足沙盒测试的两个条件。开发者也可在应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section634215616315" target="_blank">isSandboxActivated</a>接口来检查当前沙盒环境不可用的原因。</p> </div></div></div>  <div class="tablenoborder"><div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab"><tbody><tr><td class="nocellnorowborder" style="border: none;" valign="top" width="50%"><p><span><img height="439.75292900000005" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.03119292234064674703241671529767:50001231000000:2800:1D5759DE8E8A8FAC2E7AAD4321CBB21C2E6EF1346AD9F894F4BCA8D195A84F0D.png" title="点击放大" width="207.48000000000002"></span></p> </td> <td class="cell-norowborder" style="border: none;" valign="top" width="50%"><p><span><img height="437.64514500000007" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.50946505069059823472736526517058:50001231000000:2800:6B775918C5281A3639E1577CD00E3628B87F0835920073370D2ECCC934B68B07.png" title="点击放大" width="206.48250000000002"></span></p> </td> </tr> <tr><td class="row-nocellborder" style="border: none;" valign="top" width="50%">&nbsp;&nbsp;</td> <td class="cellrowborder" style="border: none;" valign="top" width="50%">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section67952025102912">测试自动续期订阅商品<i class="anchor-icon anchor-icon-link" anchorid="section67952025102912" tips="复制节点链接"></i></h2><p>自动续期订阅商品的购买流程和消耗型/非消耗型商品的购买流程类似，但订阅还有其他细节场景，比如续订成功或失败，续订周期时长。为了帮助开发者快速测试应用的订阅场景，沙盒环境下的订阅续订时间会比正常情况更快，引入“<strong>时光机</strong>”概念，沙盒环境中的订阅换算时间为10秒/天。比如订阅周期为1周，商品将在首次购买成功70秒后发生续期。</p> <ul><li>沙盒环境下的订阅流程与正式环境的订阅流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li><li>IAP扣费成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li><li>自动续期处理不需要完成真实扣款，IAP会直接返回成功。</li><li>订阅在沙盒场景下会自动续期5次(一共6期)，5次之后需要用户主动发起恢复订阅。</li><li>在沙盒测试环境下，订阅首期由用户发起后会自动续期五次（累计共六期），后续需用户手动操作以恢复订阅；若同时涉及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/iap-subscription-functions#section15231185754812" target="_blank">促销场景</a>，系统将优先完成优惠周期内的自动续期，再继续进行六次续期，此场景下总续期次数为优惠周期数与六次续期之和。</li><li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示，结果页也有沙盒环境的标志，如下图所示。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab"><tbody><tr><td class="nocellnorowborder" style="border: none;" valign="top" width="35.97%"><p><span><img height="441.99131900000003" originheight="3053" originwidth="1440" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.93393113617573603047926208456443:50001231000000:2800:0C307A0CEF1E85569C044EFC41EB5246F64E67B80237FA91140221F129EBA624.png" title="点击放大" width="208.47750000000002"></span></p> </td> <td class="cell-norowborder" style="border: none;" valign="top" width="64.03%"><p><span><img height="446.218591" originheight="3053" originwidth="1440" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.48043031603488253766528940289959:50001231000000:2800:AADFBBF5CA974B0B630692CA0C78F5B36CB674FE5E4C26E784AFFC7696C744B7.png" title="点击放大" width="210.47250000000003"></span></p> </td> </tr> <tr><td class="row-nocellborder" style="border: none;" valign="top" width="35.97%">&nbsp;&nbsp;</td> <td class="cellrowborder" style="border: none;" valign="top" width="64.03%">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section14529172515456">测试非续期订阅商品购买<i class="anchor-icon anchor-icon-link" anchorid="section14529172515456" tips="复制节点链接"></i></h2><p>在满足沙盒测试条件下，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-iap#section18798154545516" target="_blank">createPurchase</a>接口拉起收银台，用户按照正常流程完成购买，但实际不会产生真实扣费。</p> <ul><li>沙盒环境下的购买流程与正式环境的购买流程一致，仍需要完成绑定付款方式，但该过程不会真实扣费。</li><li>IAP购买成功后的收据信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/iap-data-model#section260562820380" target="_blank">PurchaseOrderPayload</a>中，会携带值为"SANDBOX"的environment字段，标识此次购买为沙盒测试的记录。</li><li>沙盒测试拉起收银台时，会在收银台展示沙盒测试提示，结果页也有沙盒环境的标志，如下图所示。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab"><tbody><tr><td class="nocellnorowborder" style="border: none;" valign="top" width="38.73%"><p><span><img height="435.53044500000004" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.60076747463849641697691961003446:50001231000000:2800:7B2D91DACF6AF8688B0598850E43DC11EA08893558CCFB292C30101DD982DEA9.png" title="点击放大" width="205.485"></span></p> </td> <td class="cell-norowborder" style="border: none;" valign="top" width="61.27%"><p><span><img height="422.841181" originheight="3264" originwidth="1540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.97357776802714597425845152606261:50001231000000:2800:75963ADB32C0724150402CCDAA396AEC2F42A32F49FEDE6938FFAE7D9B0F630F.png" title="点击放大" width="199.5"></span></p> </td> </tr> <tr><td class="row-nocellborder" style="border: none;" valign="top" width="38.73%">&nbsp;&nbsp;</td> <td class="cellrowborder" style="border: none;" valign="top" width="61.27%">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section21091858175214">清除沙盒账号的购买历史记录<i class="anchor-icon anchor-icon-link" anchorid="section21091858175214" tips="复制节点链接"></i></h2><p>开发者可以清除沙盒账号的购买历史记录，以便继续使用同一个沙盒账号进行测试。清除购买历史记录后，该测试账号在沙盒环境中产生的所有商品购买记录（包括自动续期订阅和消耗型/非消耗型商品）都将被删除，删除后该账号即可在沙盒环境中重新购买自动续期订阅商品、消耗型/非消耗型商品。清除购买历史记录后无法撤销操作。此操作不会影响生产环境数据。</p> <p>清除沙盒账号购买历史记录的操作步骤如下：</p> <ol><li><span>登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>网站，选择“用户与访问”。<span><img height="157.4055" originheight="335" originwidth="1904" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114632.32928247430899658228054475403893:50001231000000:2800:58024CC0F871862B307DB7E457D31D710478D180C2FBD33BF735FE2D68D4FC8B.png" title="点击放大" width="894.7575"></span> </span></li><li><span>左侧导航栏选择“沙盒测试 &gt; 测试账号”，勾选对应的测试账号，点击右上角的“清除购买历史记录”按钮。<span><img height="98.956123" originheight="204" originwidth="1863" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114633.89680027702661434167523579905902:50001231000000:2800:035E8A5DF2D78E94372FE5F97E5EF0A8220CA4253362BF1FE2CA3D05DA31B92C.png" title="点击放大" width="903.735"></span></span></li><li><span>在出现的提示弹窗中，点击“确认”按钮，随后该账号在沙盒环境中产生的购买历史记录将被清除，此操作无法被撤销。如果该沙盒账号的购买次数较多，则清除其购买历史记录可能需要更长时间。</span><p> </p><div class="tablenoborder"><div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab"><tbody><tr><td class="cell-norowborder" style="border: none;" valign="top" width="100%"><p><span><img originheight="298" originwidth="411" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114633.88707483399739540165258839078508:50001231000000:2800:34D541436FB57A23E65D3A95627A4DE74BF635865C578A215130FE18B40D442F.png" width="411" height="298"></span></p> </td> </tr> <tr><td class="cellrowborder" style="border: none;" valign="top" width="100%">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> <p></p></li></ol> </div> </div> <div></div></div>