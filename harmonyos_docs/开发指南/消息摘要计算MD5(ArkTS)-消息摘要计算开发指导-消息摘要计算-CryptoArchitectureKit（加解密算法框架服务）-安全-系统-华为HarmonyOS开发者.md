<h1 _ngcontent-icj-c119="" class="doc-title ng-star-inserted" title="消息摘要计算MD5(ArkTS)"> 消息摘要计算MD5(ArkTS) </h1>

<div _ngcontent-icj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-message-digest-overview#支持的算法与规格">消息摘要计算算法规格</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 12开始，轻量级智能穿戴设备支持消息摘要的计算与操作。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>在调用update接口传入数据时，可以<a href="/consumer/cn/doc/harmonyos-guides/crypto-generate-message-digest-md5#摘要算法一次性传入">一次性传入所有数据</a>，也可以把数据人工分段，然后<a href="/consumer/cn/doc/harmonyos-guides/crypto-generate-message-digest-md5#分段摘要算法">分段update</a>。对于同一段数据而言，计算结果没有差异。对于数据量较大的数据，开发者可以根据实际需求选择是否分段传入。</p>     <p>下面分别提供两种方式的示例代码。</p>    </div>    <div class="tiledSection">     <h3 id="摘要算法一次性传入" class="firsth2">摘要算法（一次性传入）<i class="anchor-icon anchor-icon-link" anchorid="摘要算法一次性传入" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatemd" target="_blank">cryptoFramework.createMd</a>，指定摘要算法MD5，生成摘要实例（Md）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-6" target="_blank">Md.update</a>，传入自定义消息，进行摘要更新计算。单次update长度没有限制。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#digest" target="_blank">Md.digest</a>，获取摘要计算结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getmdlength" target="_blank">Md.getMdLength</a>，获取摘要计算长度，单位为字节。</p></li>     </ol>     <ul>      <li>       <p>以使用await方式单次传入数据，获取摘要计算结果为例：</p>       <div _ngcontent-icj-c106="" class="highlight-div"><div _ngcontent-icj-c106="" class="highlight-div-header"><div _ngcontent-icj-c106="" class="highlight-div-header-left"><div _ngcontent-icj-c106="" class="handle-button expand-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icj-c106="" class="highlight-div-header-right"><div _ngcontent-icj-c106="" class="handle-button ai-button"></div><div _ngcontent-icj-c106="" class="handle-button line-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icj-c106="" class="handle-button theme-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icj-c106="" class="handle-button copy-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doMd</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> mdAlgName = <span class="hljs-string">'MD5'</span>; <span class="hljs-comment">// 摘要算法名。</span></li><li>  <span class="hljs-keyword">let</span> message = <span class="hljs-string">'mdTestMessage'</span>; <span class="hljs-comment">// 待摘要的数据。</span></li><li>  <span class="hljs-keyword">let</span> md = cryptoFramework.<span class="hljs-title function_">createMd</span>(mdAlgName);</li><li>  <span class="hljs-comment">// 数据量较少时，可以只做一次update，将数据全部传入，接口未对入参长度做限制。</span></li><li>  <span class="hljs-keyword">await</span> md.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(message, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) });</li><li>  <span class="hljs-keyword">let</span> mdResult = <span class="hljs-keyword">await</span> md.<span class="hljs-title function_">digest</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Md result:'</span> + mdResult.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> mdLen = md.<span class="hljs-title function_">getMdLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md len: "</span> + mdLen);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>以使用同步方式单次传入数据，获取摘要计算结果为例：</p>       <div _ngcontent-icj-c106="" class="highlight-div"><div _ngcontent-icj-c106="" class="highlight-div-header"><div _ngcontent-icj-c106="" class="highlight-div-header-left"><div _ngcontent-icj-c106="" class="handle-button expand-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icj-c106="" class="highlight-div-header-right"><div _ngcontent-icj-c106="" class="handle-button ai-button"></div><div _ngcontent-icj-c106="" class="handle-button line-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icj-c106="" class="handle-button theme-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icj-c106="" class="handle-button copy-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doMdBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> mdAlgName = <span class="hljs-string">'MD5'</span>; <span class="hljs-comment">// 摘要算法名。</span></li><li>  <span class="hljs-keyword">let</span> message = <span class="hljs-string">'mdTestMessage'</span>; <span class="hljs-comment">// 待摘要的数据。</span></li><li>  <span class="hljs-keyword">let</span> md = cryptoFramework.<span class="hljs-title function_">createMd</span>(mdAlgName);</li><li>  <span class="hljs-comment">// 数据量较少时，可以只做一次update，将数据全部传入，接口未对入参长度做限制。</span></li><li>  md.<span class="hljs-title function_">updateSync</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(message, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) });</li><li>  <span class="hljs-keyword">let</span> mdResult = md.<span class="hljs-title function_">digestSync</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[Sync]:Md result:'</span> + mdResult.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> mdLen = md.<span class="hljs-title function_">getMdLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md len: "</span> + mdLen);</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="分段摘要算法">分段摘要算法<i class="anchor-icon anchor-icon-link" anchorid="分段摘要算法" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatemd" target="_blank">cryptoFramework.createMd</a>，指定摘要算法MD5，生成摘要实例（Md）。</p></li>      <li>       <p>传入自定义消息，将一次传入数据量设置为20字节，多次调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-7" target="_blank">Md.update</a>，进行摘要更新计算。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#digest-1" target="_blank">Md.digest</a>，获取摘要计算结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getmdlength" target="_blank">Md.getMdLength</a>，获取摘要计算长度，单位为字节。</p></li>     </ol>     <ul>      <li>       <p>以使用await方式分段传入数据，获取摘要计算结果为例：</p>       <div _ngcontent-icj-c106="" class="highlight-div"><div _ngcontent-icj-c106="" class="highlight-div-header"><div _ngcontent-icj-c106="" class="highlight-div-header-left"><div _ngcontent-icj-c106="" class="handle-button expand-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icj-c106="" class="highlight-div-header-right"><div _ngcontent-icj-c106="" class="handle-button ai-button"></div><div _ngcontent-icj-c106="" class="handle-button line-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icj-c106="" class="handle-button theme-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icj-c106="" class="handle-button copy-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doLoopMd</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> mdAlgName = <span class="hljs-string">"MD5"</span>; <span class="hljs-comment">// 摘要算法名。</span></li><li>  <span class="hljs-keyword">let</span> md = cryptoFramework.<span class="hljs-title function_">createMd</span>(mdAlgName);</li><li>  <span class="hljs-comment">// 假设信息总共43字节，根据utf-8解码后，也是43字节。</span></li><li>  <span class="hljs-keyword">let</span> messageText = <span class="hljs-string">"aaaaa.....bbbbb.....ccccc.....ddddd.....eee"</span>;</li><li>  <span class="hljs-keyword">let</span> messageData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(messageText, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> updateLength = <span class="hljs-number">20</span>; <span class="hljs-comment">// 假设以20字节为单位进行分段update，实际并无要求。</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; messageData.<span class="hljs-property">length</span>; i += updateLength) {</li><li>    <span class="hljs-keyword">let</span> updateMessage = messageData.<span class="hljs-title function_">subarray</span>(i, i + updateLength);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">updateMessageBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: updateMessage };</li><li>    <span class="hljs-keyword">await</span> md.<span class="hljs-title function_">update</span>(updateMessageBlob);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> mdOutput = <span class="hljs-keyword">await</span> md.<span class="hljs-title function_">digest</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md result: "</span> + mdOutput.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> mdLen = md.<span class="hljs-title function_">getMdLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md len: "</span> + mdLen);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>以使用同步方式分段传入数据，获取摘要计算结果为例：</p>       <div _ngcontent-icj-c106="" class="highlight-div"><div _ngcontent-icj-c106="" class="highlight-div-header"><div _ngcontent-icj-c106="" class="highlight-div-header-left"><div _ngcontent-icj-c106="" class="handle-button expand-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icj-c106="" class="highlight-div-header-right"><div _ngcontent-icj-c106="" class="handle-button ai-button"></div><div _ngcontent-icj-c106="" class="handle-button line-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icj-c106="" class="handle-button theme-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icj-c106="" class="handle-button copy-button"><div _ngcontent-icj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doLoopMdBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> mdAlgName = <span class="hljs-string">"MD5"</span>; <span class="hljs-comment">// 摘要算法名。</span></li><li>  <span class="hljs-keyword">let</span> md = cryptoFramework.<span class="hljs-title function_">createMd</span>(mdAlgName);</li><li>  <span class="hljs-comment">// 假设信息总共43字节，根据utf-8解码后，也是43字节。</span></li><li>  <span class="hljs-keyword">let</span> messageText = <span class="hljs-string">"aaaaa.....bbbbb.....ccccc.....ddddd.....eee"</span>;</li><li>  <span class="hljs-keyword">let</span> messageData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(messageText, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> updateLength = <span class="hljs-number">20</span>; <span class="hljs-comment">// 假设以20字节为单位进行分段update，实际并无要求。</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; messageData.<span class="hljs-property">length</span>; i += updateLength) {</li><li>    <span class="hljs-keyword">let</span> updateMessage = messageData.<span class="hljs-title function_">subarray</span>(i, i + updateLength);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">updateMessageBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: updateMessage };</li><li>    md.<span class="hljs-title function_">updateSync</span>(updateMessageBlob);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> mdOutput = md.<span class="hljs-title function_">digestSync</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"[Sync]:md result: "</span> + mdOutput.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> mdLen = md.<span class="hljs-title function_">getMdLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md len: "</span> + mdLen);</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>