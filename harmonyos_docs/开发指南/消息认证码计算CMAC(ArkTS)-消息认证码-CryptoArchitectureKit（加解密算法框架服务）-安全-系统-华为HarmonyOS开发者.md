<h1 _ngcontent-chr-c119="" class="doc-title ng-star-inserted" title="消息认证码计算CMAC(ArkTS)"> 消息认证码计算CMAC(ArkTS) </h1>

<div _ngcontent-chr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>CMAC通过使用分组密码（如AES）和一个密钥生成认证码，确保消息在传输过程中未被篡改。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>在调用update接口传入数据时，可以<a href="/consumer/cn/doc/harmonyos-guides/crypto-compute-cmac#cmac一次性传入数据">一次性传入所有数据</a>，也可以把数据人工分段，然后<a href="/consumer/cn/doc/harmonyos-guides/crypto-compute-cmac#分段cmac">分段update</a>。对于同一段数据而言，是否分段，计算结果没有差异。对于数据量较大的数据，开发者可以根据实际需求选择是否分段传入。</p>     <p>下面分别提供两种方式的示例代码。</p>    </div>    <div class="tiledSection">     <h3 id="cmac一次性传入数据" class="firsth2">CMAC（一次性传入数据）<i class="anchor-icon anchor-icon-link" anchorid="cmac一次性传入数据" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatemac18" target="_blank">cryptoFramework.createMac</a>，指定消息认证码算法为CMAC，指定对称算法为AES128，生成消息认证码实例（Mac）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatesymkeygenerator" target="_blank">cryptoFramework.createSymKeyGenerator</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#convertkey-1" target="_blank">SymKeyGenerator.convertKey</a>，生成密钥算法为AES256的对称密钥（SymKey）。</p>       <p>生成对称密钥的详细开发指导，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-convert-binary-data-to-sym-key">指定二进制数据生成对称密钥</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-6" target="_blank">Mac.init</a>，指定共享对称密钥（SymKey），初始化Mac对象。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-8" target="_blank">Mac.update</a>，传入自定义消息，进行消息认证码计算。单次update的长度没有限制。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#dofinal-2" target="_blank">Mac.doFinal</a>，获取Mac计算结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getmaclength" target="_blank">Mac.getMacLength</a>，获取Mac长度，单位为字节。</p></li>     </ol>     <ul>      <li>       <p>以使用await方式一次性传入数据，获取消息认证码计算结果为例：</p>       <div _ngcontent-chr-c106="" class="highlight-div"><div _ngcontent-chr-c106="" class="highlight-div-header"><div _ngcontent-chr-c106="" class="highlight-div-header-left"><div _ngcontent-chr-c106="" class="handle-button expand-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chr-c106="" class="highlight-div-header-right"><div _ngcontent-chr-c106="" class="handle-button ai-button"></div><div _ngcontent-chr-c106="" class="handle-button line-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chr-c106="" class="handle-button theme-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chr-c106="" class="handle-button copy-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">genSymKeyByData</span>(<span class="hljs-params">symKeyData: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">symKeyBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: symKeyData };</li><li>  <span class="hljs-keyword">let</span> aesGenerator = cryptoFramework.<span class="hljs-title function_">createSymKeyGenerator</span>(<span class="hljs-string">'AES128'</span>);</li><li>  <span class="hljs-keyword">let</span> symKey = <span class="hljs-keyword">await</span> aesGenerator.<span class="hljs-title function_">convertKey</span>(symKeyBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'convertKey success'</span>);</li><li>  <span class="hljs-keyword">return</span> symKey;</li><li>}</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doCmac</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 把字符串按utf-8解码为Uint8Array，使用固定的128位的密钥，即16字节。</span></li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"12345678abcdefgh"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> key = <span class="hljs-keyword">await</span> <span class="hljs-title function_">genSymKeyByData</span>(keyData);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">CmacSpec</span> = {</li><li>      <span class="hljs-attr">algName</span>: <span class="hljs-string">"CMAC"</span>,</li><li>      <span class="hljs-attr">cipherName</span>: <span class="hljs-string">"AES128"</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> message = <span class="hljs-string">'cmacTestMessage'</span>; <span class="hljs-comment">// 待进行CMAC的数据。</span></li><li>  <span class="hljs-keyword">let</span> mac = cryptoFramework.<span class="hljs-title function_">createMac</span>(spec);</li><li>  <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">init</span>(key);</li><li>  <span class="hljs-comment">// 数据量不多时，可以一次性更新，将所有数据传入，接口没有入参长度限制。</span></li><li>  <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(message, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) });</li><li>  <span class="hljs-keyword">let</span> macResult = <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">doFinal</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'CMAC result:'</span> + macResult.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> macLen = mac.<span class="hljs-title function_">getMacLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'CMAC len:'</span> + macLen);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>以使用同步方式一次性传入数据，获取消息认证码计算结果为例：</p>       <div _ngcontent-chr-c106="" class="highlight-div"><div _ngcontent-chr-c106="" class="highlight-div-header"><div _ngcontent-chr-c106="" class="highlight-div-header-left"><div _ngcontent-chr-c106="" class="handle-button expand-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chr-c106="" class="highlight-div-header-right"><div _ngcontent-chr-c106="" class="handle-button ai-button"></div><div _ngcontent-chr-c106="" class="handle-button line-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chr-c106="" class="handle-button theme-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chr-c106="" class="handle-button copy-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genSymKeyByData</span>(<span class="hljs-params">symKeyData: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">symKeyBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: symKeyData };</li><li>  <span class="hljs-keyword">let</span> aesGenerator = cryptoFramework.<span class="hljs-title function_">createSymKeyGenerator</span>(<span class="hljs-string">'AES128'</span>);</li><li>  <span class="hljs-keyword">let</span> symKey =  aesGenerator.<span class="hljs-title function_">convertKeySync</span>(symKeyBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[Sync]convertKey success'</span>);</li><li>  <span class="hljs-keyword">return</span> symKey;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doCmacBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 把字符串按utf-8解码为Uint8Array，使用固定的128位的密钥，即16字节。</span></li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"12345678abcdefgh"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> key = <span class="hljs-title function_">genSymKeyByData</span>(keyData);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">CmacSpec</span> = {</li><li>      <span class="hljs-attr">algName</span>: <span class="hljs-string">"CMAC"</span>,</li><li>      <span class="hljs-attr">cipherName</span>: <span class="hljs-string">"AES128"</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> message = <span class="hljs-string">'cmacTestMessage'</span>; <span class="hljs-comment">// 待进行CMAC的数据。</span></li><li>  <span class="hljs-keyword">let</span> mac = cryptoFramework.<span class="hljs-title function_">createMac</span>(spec);</li><li>  mac.<span class="hljs-title function_">initSync</span>(key);</li><li>  <span class="hljs-comment">// 数据量不大时，可以一次性更新，将所有数据传入，接口没有入参长度限制。</span></li><li>  mac.<span class="hljs-title function_">updateSync</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(message, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) });</li><li>  <span class="hljs-keyword">let</span> macResult = mac.<span class="hljs-title function_">doFinalSync</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[Sync]CMAC result:'</span> + macResult.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> macLen = mac.<span class="hljs-title function_">getMacLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'CMAC len:'</span> + macLen);</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="分段cmac">分段CMAC<i class="anchor-icon anchor-icon-link" anchorid="分段cmac" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatemac18" target="_blank">cryptoFramework.createMac</a>，指定消息认证码算法CMAC，对称算法AES256，生成消息认证码实例（Mac）。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatesymkeygenerator" target="_blank">cryptoFramework.createSymKeyGenerator</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#convertkey-1" target="_blank">SymKeyGenerator.convertKey</a>，生成密钥算法为AES256的对称密钥（SymKey）。</p>       <p>生成对称密钥的详细开发指导，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-convert-binary-data-to-sym-key">指定二进制数据生成对称密钥</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-7" target="_blank">Mac.init</a>，指定共享对称密钥（SymKey），初始化Mac对象。</p></li>      <li>       <p>传入自定义消息，设置每次传入数据量为20字节，多次调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-9" target="_blank">Mac.update</a>，计算消息认证码。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#dofinal-3" target="_blank">Mac.doFinal</a>，获取Mac计算结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getmaclength" target="_blank">Mac.getMacLength</a>，获取Mac消息认证码的长度，单位为字节。</p></li>     </ol>     <ul>      <li>       <p>以使用await方式分段传入数据，获取消息认证码计算结果为例。</p>       <div _ngcontent-chr-c106="" class="highlight-div"><div _ngcontent-chr-c106="" class="highlight-div-header"><div _ngcontent-chr-c106="" class="highlight-div-header-left"><div _ngcontent-chr-c106="" class="handle-button expand-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chr-c106="" class="highlight-div-header-right"><div _ngcontent-chr-c106="" class="handle-button ai-button"></div><div _ngcontent-chr-c106="" class="handle-button line-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chr-c106="" class="handle-button theme-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chr-c106="" class="handle-button copy-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">genSymKeyByData</span>(<span class="hljs-params">symKeyData: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">symKeyBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: symKeyData };</li><li>  <span class="hljs-keyword">let</span> aesGenerator = cryptoFramework.<span class="hljs-title function_">createSymKeyGenerator</span>(<span class="hljs-string">'AES128'</span>);</li><li>  <span class="hljs-keyword">let</span> symKey = <span class="hljs-keyword">await</span> aesGenerator.<span class="hljs-title function_">convertKey</span>(symKeyBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'convertKey success'</span>);</li><li>  <span class="hljs-keyword">return</span> symKey;</li><li>}</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doLoopCmac</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 把字符串按utf-8解码为Uint8Array，使用固定的128位的密钥，即16字节。</span></li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"12345678abcdefgh"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> key = <span class="hljs-keyword">await</span> <span class="hljs-title function_">genSymKeyByData</span>(keyData);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">CmacSpec</span> = {</li><li>      <span class="hljs-attr">algName</span>: <span class="hljs-string">"CMAC"</span>,</li><li>      <span class="hljs-attr">cipherName</span>: <span class="hljs-string">"AES128"</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> mac = cryptoFramework.<span class="hljs-title function_">createMac</span>(spec);</li><li>  <span class="hljs-comment">// 假设消息共43字节，根据UTF-8解码后，仍是43字节。</span></li><li>  <span class="hljs-keyword">let</span> messageText = <span class="hljs-string">"aaaaa......bbbbb......ccccc......ddddd......eee"</span>;</li><li>  <span class="hljs-keyword">let</span> messageData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(messageText, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> updateLength = <span class="hljs-number">20</span>; <span class="hljs-comment">// 假设以20字节为单位进行分段update，实际并无具体要求。</span></li><li>  <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">init</span>(key);</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; messageData.<span class="hljs-property">length</span>; i += updateLength) {</li><li>    <span class="hljs-keyword">let</span> updateMessage = messageData.<span class="hljs-title function_">subarray</span>(i, i + updateLength);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">updateMessageBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: updateMessage };</li><li>    <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">update</span>(updateMessageBlob);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> macOutput = <span class="hljs-keyword">await</span> mac.<span class="hljs-title function_">doFinal</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"CMAC result: "</span> + macOutput.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> macLen = mac.<span class="hljs-title function_">getMacLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'CMAC len:'</span> + macLen);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>以使用同步方式分段传入数据，获取消息认证码计算结果为例。</p>       <div _ngcontent-chr-c106="" class="highlight-div"><div _ngcontent-chr-c106="" class="highlight-div-header"><div _ngcontent-chr-c106="" class="highlight-div-header-left"><div _ngcontent-chr-c106="" class="handle-button expand-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chr-c106="" class="highlight-div-header-right"><div _ngcontent-chr-c106="" class="handle-button ai-button"></div><div _ngcontent-chr-c106="" class="handle-button line-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chr-c106="" class="handle-button theme-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chr-c106="" class="handle-button copy-button"><div _ngcontent-chr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genSymKeyByData</span>(<span class="hljs-params">symKeyData: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">symKeyBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: symKeyData };</li><li>  <span class="hljs-keyword">let</span> aesGenerator = cryptoFramework.<span class="hljs-title function_">createSymKeyGenerator</span>(<span class="hljs-string">'AES128'</span>);</li><li>  <span class="hljs-keyword">let</span> symKey = aesGenerator.<span class="hljs-title function_">convertKeySync</span>(symKeyBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[Sync]convertKey success'</span>);</li><li>  <span class="hljs-keyword">return</span> symKey;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doLoopCmacBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 把字符串按utf-8解码为Uint8Array，使用固定的128位的密钥，即16字节。</span></li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"12345678abcdefgh"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> key = <span class="hljs-title function_">genSymKeyByData</span>(keyData);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">CmacSpec</span> = {</li><li>      <span class="hljs-attr">algName</span>: <span class="hljs-string">"CMAC"</span>,</li><li>      <span class="hljs-attr">cipherName</span>: <span class="hljs-string">"AES128"</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> mac = cryptoFramework.<span class="hljs-title function_">createMac</span>(spec);</li><li>  <span class="hljs-comment">// 假设信息共43字节，utf-8解码后仍为43字节。</span></li><li>  <span class="hljs-keyword">let</span> messageText = <span class="hljs-string">"aaaaa.....bbbbb.....ccccc.....ddddd.....eee"</span>;</li><li>  <span class="hljs-keyword">let</span> messageData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(messageText, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> updateLength = <span class="hljs-number">20</span>; <span class="hljs-comment">// 假设以20字节为单位进行分段update，实际没有具体要求。</span></li><li>  mac.<span class="hljs-title function_">initSync</span>(key);</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; messageData.<span class="hljs-property">length</span>; i += updateLength) {</li><li>    <span class="hljs-keyword">let</span> updateMessage = messageData.<span class="hljs-title function_">subarray</span>(i, i + updateLength);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">updateMessageBlob</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: updateMessage };</li><li>    mac.<span class="hljs-title function_">updateSync</span>(updateMessageBlob);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> macOutput = mac.<span class="hljs-title function_">doFinalSync</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"[Sync]CMAC result: "</span> + macOutput.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> macLen = mac.<span class="hljs-title function_">getMacLength</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'CMAC len:'</span> + macLen);</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>