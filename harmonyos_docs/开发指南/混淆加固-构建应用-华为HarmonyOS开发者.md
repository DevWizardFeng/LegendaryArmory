<h1 _ngcontent-wcn-c119="" class="doc-title ng-star-inserted" title="混淆加固"> 混淆加固 </h1>

<div _ngcontent-wcn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001731754312"><p id="ZH-CN_TOPIC_0000002478174588__p17665914307">DevEco Studio原先默认开启源码混淆功能，会对API 10及以上的Stage工程，且编译模式是release时，自动进行简单的源码混淆，仅对参数名和局部变量名进行混淆。</p> <p id="ZH-CN_TOPIC_0000002478174588__p1669920309">从DevEco Studio NEXT Developer Beta3（5.0.3.600）版本开始，新建工程及模块默认关闭源码混淆功能，如果在模块级build-profile.json5配置文件中开启源码混淆，则混淆规则配置文件obfuscation-rules.txt中默认开启推荐的混淆规则，包含-enable-property-obfuscation、-enable-toplevel-obfuscation、-enable-filename-obfuscation、-enable-export-obfuscation四项混淆项，开发者可进一步在obfuscation-rules.txt文件中选择开启的混淆项，关于混淆项的介绍请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#混淆选项" target="_blank">混淆规则</a>。</p> <div class="tiledSection"><h2 id="section127684441468">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section127684441468" tips="复制节点链接"></i></h2><ul id="ZH-CN_TOPIC_0000002478174588__ul18960191113020"><li id="li119607111305">仅支持Stage工程。</li><li id="li179619163010">在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-compilation-options-customizing-guide#section192461528194916">构建模式</a>为release模式时生效。</li><li id="li89611183014">模块及模块依赖的HAR和HSP均未关闭混淆。</li></ul> </div> <div class="tiledSection"><h2 id="section88021016154414">字段说明<i class="anchor-icon anchor-icon-link" anchorid="section88021016154414" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174588__p2047617289454">可在模块级build-profile.json5文件中进行源码混淆相关配置。obfuscation字段说明如下：</p>  <div class="tablenoborder"><div class="tbBox"><table id="table13470631185911" class="layoutFixed idpTab"><thead><tr id="ZH-CN_TOPIC_0000002478174588__row14702031145918"><th align="left" class="cellrowborder" colspan="2" id="mcps1.3.4.3.1.6.1.1" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p19470173111597">配置项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.6.1.2" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p104709319596">类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.6.1.3" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p61211939161620">是否必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.6.1.4" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p547033116596">说明</p> </th> </tr> </thead> <tbody><tr id="ZH-CN_TOPIC_0000002478174588__row1847033185912"><td class="cellrowborder" colspan="2" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p9184243125915">ruleOptions</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p15183843115912">对象</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p1412133915164">否</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p1418315436590">混淆规则配置。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174588__row547116317599"><td class="cellrowborder" rowspan="2" valign="top" width="10.231023102310232%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="11.75117511751175%"><p id="ZH-CN_TOPIC_0000002478174588__p5182343105910">enable</p> </td> <td class="cellrowborder" valign="top" width="11.891189118911893%"><p id="ZH-CN_TOPIC_0000002478174588__p1318284311591">布尔值</p> </td> <td class="cellrowborder" valign="top" width="7.520752075207521%"><p id="ZH-CN_TOPIC_0000002478174588__p5121163951615">是</p> </td> <td class="cellrowborder" valign="top" width="58.6058605860586%"><p id="ZH-CN_TOPIC_0000002478174588__p20181144314591">是否启用源码混淆：</p> <ul id="ZH-CN_TOPIC_0000002478174588__ul60458036"><li id="li80558533">true：启用。</li><li id="li4431221417">false（默认值）：不启用。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174588__p1647193393216">从DevEco Studio NEXT Developer Beta3（5.0.3.600）版本开始，默认值由true改为false。</p> </div></div></div> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174588__row1838620560212"><td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p173878561212">files</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p1738710566217">字符串数组</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p31215393166">否</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p3516014161120">配置混淆规则文件的相对路径，默认使用obfuscation-rules.txt文件。文件中配置的混淆规则仅在本模块编译时生效（包含依赖代码）。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002478174588__ul1452772118180"><li id="li652762151810">规则文件中支持配置所有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation" target="_blank">混淆规则</a>。</li><li id="li1382145792118">支持配置多个文件，文件名称支持自定义，当存在多个混淆规则文件时，规则合并以及合并后的作用范围可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#混淆规则合并策略" target="_blank">混淆规则合并策略</a>。</li></ul> </div></div></div> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174588__row1425855610374"><td class="cellrowborder" colspan="2" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p025925612373">consumerFiles</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p1325975663714">字符串/字符串数组</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p6259856183715">否</p> </td> <td class="cellrowborder" valign="top"><p id="ZH-CN_TOPIC_0000002478174588__p174381947175415">仅HAR/HSP模块可配置，配置传递给集成方的混淆规则文件的相对路径，支持配置多个文件，文件名称支持自定义。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002478174588__ul13844173218552"><li id="li2210193913282">为保证HAR/HSP模块可被正确集成使用，若有不希望被集成方混淆的内容，建议在规则文件中配置对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>，例如HAR/HSP模块中导出的变量或函数。</li></ul> <ul id="ZH-CN_TOPIC_0000002478174588__ul133211442122311"><li id="li1032154216231">规则文件中配置的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#混淆选项" target="_blank">混淆选项</a>会与集成方的混淆规则进行合并，进而影响集成方的编译混淆，因此，建议仅配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>。</li><li id="li8296356111">从DevEco Studio 5.1.0 Release版本开始支持在HSP模块中配置该字段。</li></ul> </div></div></div> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section18326541833">使能混淆<i class="anchor-icon anchor-icon-link" anchorid="section18326541833" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174588__p432564534">为保护代码资产，建议开启混淆，您可以在模块级的build-profile.json5配置文件中开启源码混淆功能：</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen1832520411314" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"arkOptions"</span>: {</li><li>  <span class="hljs-string">"obfuscation"</span>: {</li><li>    <span class="hljs-string">"ruleOptions"</span>: {</li><li>      <span class="hljs-string">"enable"</span>: <span class="hljs-keyword">true</span>  <span class="hljs-comment">// 配置true，即可开启源码混淆功能</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174588__p98561757143219">从DevEco Studio NEXT Developer Beta3（5.0.3.600）版本开始，开启混淆后，混淆规则配置文件obfuscation-rules.txt中默认开启推荐的混淆规则，包含-enable-property-obfuscation、-enable-toplevel-obfuscation、-enable-filename-obfuscation、-enable-export-obfuscation四项混淆项。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174588__p1736819521239">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-compilation-options-customizing-guide#section192461528194916">release模式</a>编译发布时，建议开启混淆，需要正确配置混淆规则，否则可能会有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation-questions" target="_blank">运行时问题</a>。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section138141742102520">使能高阶混淆<i class="anchor-icon anchor-icon-link" anchorid="section138141742102520" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174588__p899711712284">在<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section18326541833">开启混淆</a>后，若您需要更高阶的混淆能力，可以通过以下操作配置高阶混淆规则。</p> </div> <div class="tiledSection"><h3 id="section760533133313" class="firsth2">配置所有混淆规则<i class="anchor-icon anchor-icon-link" anchorid="section760533133313" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174588__ol16525163913373"><li id="li155251839123714">打开模块级build-profile.json5文件，在"files"字段下配置混淆规则文件的相对路径，支持配置多个文件，默认为./obfuscation-rules.txt。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen173441129184119" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">"stageMode"</span>,</li><li>  ...</li><li>  <span class="hljs-string">"buildOptionSet"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span>,</li><li>      <span class="hljs-string">"arkOptions"</span>: {</li><li>        <span class="hljs-string">"obfuscation"</span>: {</li><li>          <span class="hljs-string">"ruleOptions"</span>: {</li><li>            <span class="hljs-string">"enable"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"files"</span>: [</li><li>              <span class="hljs-string">"./obfuscation-rules.txt"</span>  <span class="hljs-comment">// 混淆规则文件</span></li><li>            ]</li><li>          }</li><li>        }</li><li>      }</li><li>    },</li><li>  ],</li><li>  ...</li><li>}</li></ol></pre></div></div> </li><li id="li1796272124415">打开模块目录内的obfuscation-rules.txt文件配置混淆规则，具体的配置规则请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation" target="_blank">配置混淆规则</a>，对于不需要混淆的内容，请配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>。<p id="ZH-CN_TOPIC_0000002478174588__p18962132144410">当存在多个混淆规则文件时，规则合并以及合并后的作用范围可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#混淆规则合并策略" target="_blank">混淆规则合并策略</a>。</p> <p id="ZH-CN_TOPIC_0000002478174588__p396282124413"><span><img originheight="142" originwidth="229" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104903.34187390948390404050382565142980:50001231000000:2800:888ED9335949E29B36ED3517795F93D7359B6F822C11A9BB1C56C505D205E582.png" class="notEnlarge" width="229" height="142"></span></p> </li></ol> </div> <div class="tiledSection"><h3 id="section14191116183412">HAR/HSP配置保留选项<i class="anchor-icon anchor-icon-link" anchorid="section14191116183412" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174588__p10668114217469">为保证HAR/HSP模块可被正确集成使用，若有不希望被集成方混淆的内容，建议在规则文件中配置对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>，例如HAR/HSP模块中导出的变量或函数。</p> <ol id="ZH-CN_TOPIC_0000002478174588__ol39428563813"><li id="li494220511385">打开模块级build-profile.json5文件，在"consumerFiles"字段下配置传递给集成方的混淆规则文件的相对路径，支持配置多个文件，默认为./consumer-rules.txt，对应编译后HAR包中的obfuscation.txt文件。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen12622153685120" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">"stageMode"</span>,</li><li>  ...</li><li>  <span class="hljs-string">"buildOptionSet"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span>,</li><li>      <span class="hljs-string">"arkOptions"</span>: {</li><li>        <span class="hljs-string">"obfuscation"</span>: {</li><li>          <span class="hljs-string">"ruleOptions"</span>: {</li><li>            <span class="hljs-string">"enable"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"files"</span>: [</li><li>              <span class="hljs-string">"./obfuscation-rules.txt"</span>   </li><li>            ]</li><li>          },</li><li>          <span class="hljs-string">"consumerFiles"</span>: [              <span class="hljs-comment">// 该模块被依赖时的混淆规则</span></li><li>            <span class="hljs-string">"./consumer-rules.txt"</span>   </li><li>          ]</li><li>        }</li><li>      }</li><li>    },</li><li>  ],</li><li>  ...</li><li>}</li></ol></pre></div></div> </li><li id="li2703688563">打开模块目录内的consumer-rules.txt文件配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>。<p id="ZH-CN_TOPIC_0000002478174588__p1244418251616">当存在多个混淆规则文件时，规则合并以及合并后的作用范围可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#混淆规则合并策略" target="_blank">混淆合并策略</a>。</p> <p id="ZH-CN_TOPIC_0000002478174588__p19152142519115"><span><img originheight="182" originwidth="236" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104903.09434694969393056763251435566993:50001231000000:2800:1A2A349FEB8BB79E749C413295981527CF8C3C8635E3D25D9C4B98E0F6CE8E49.png" class="notEnlarge" width="236" height="182"></span></p> </li></ol> </div> <div class="tiledSection"><h2 id="section19439175917123">通过混淆助手配置保留选项<i class="anchor-icon anchor-icon-link" anchorid="section19439175917123" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174588__p776385017411">开启混淆后，代码中的方法、属性或路径被混淆，但运行的时候访问的是未混淆的方法、属性或路径，可能导致功能不可用，因此需要将对应的字段配置保留选项。关于保留选项的排查场景及配置方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#保留选项" target="_blank">保留选项</a>。</p> <p id="ZH-CN_TOPIC_0000002478174588__p188565321568">需要排查的场景和配置的字段有很多，因此DevEco Studio提供了混淆助手工具（ObfuscationHelper），可以根据模块和场景对源码进行扫描，快速<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section3989185975217">识别需要配置的保留选项和白名单字段</a>，开发者可以一键生成白名单混淆规则文件。由于某些场景是动态访问名称、属性，需要在运行的时候才能确定的字段，ObfuscationHelper会识别该类场景，开发者需要根据业务进一步<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section42331014105310">排查识别白名单后进行配置</a>。</p> </div> <div class="tiledSection"><h3 id="section18718175314115" class="firsth2">扫描代码<i class="anchor-icon anchor-icon-link" anchorid="section18718175314115" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174588__ol18050442575"><li id="li6805544105715">通过以下任意一种方式打开ObfuscationHelper：<ul id="ZH-CN_TOPIC_0000002478174588__ul05710523576"><li id="li13698338232">点击菜单栏<strong>Tools &gt; </strong><strong>ObfuscationHelper</strong>。</li><li id="li10571452195712">在模块目录上点击鼠标右键，在弹出的菜单中选择<strong>ObfuscationHelper</strong>。<p id="ZH-CN_TOPIC_0000002478174588__p34258327342"><span><img originheight="238" originwidth="339" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.14191988650319105610661782107696:50001231000000:2800:3276F214885963C0D2F501DD339202CE886DC2BD932A1B5462333CE0A6F5F440.png" width="339" height="238"></span></p> </li></ul> </li><li id="li1457343015814">点击模块下拉选择框，选择待扫描的模块。</li><li id="li117651438102918">如果模块之前被扫描过，并且生成了排查白名单，则会生成相应的历史记录。选择对应的历史记录，在本次扫描完成后，会自动关联历史的排查记录，历史已经排查过的白名单字段无需再重复排查。<p id="ZH-CN_TOPIC_0000002478174588__p1617963133916">从DevEco Studio 6.0.0 Beta1开始支持关联历史记录。</p> <p id="ZH-CN_TOPIC_0000002478174588__p1528142855211"><span><img originheight="402" originwidth="808" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.44657941655291349557618455664939:50001231000000:2800:DD1B22789881133F8AF1CD871003F3471F4FF9CC259747FA7FFF8FB069DC46A6.png" width="808" height="402"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p1427442141317"></p> </li><li id="li1686231018592">根据涉及的混淆场景，选择一个或多个扫描任务，点击<strong>开始扫描</strong>。关于扫描任务的介绍请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section18125192133818">扫描任务</a>。<p id="ZH-CN_TOPIC_0000002478174588__p9934102285620"><span><img originheight="729" originwidth="612" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.67754594746759998985329474659924:50001231000000:2800:6F0D12F3A2A5E88B63C4222060B319D83BBB8073113E3372685B16A3A17370D8.png" width="612" height="729"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p54161455171419"></p> </li><li id="li159801561802">等待扫描成功后，进入<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section3989185975217">推荐白名单</a>和<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section42331014105310">待排查白名单</a>配置页面。在扫描的过程中，也可以点击<strong>停止扫描</strong>按钮，结束扫描。<p id="ZH-CN_TOPIC_0000002478174588__p63651433183915"><span><img originheight="796" originwidth="805" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.49232956803541817693328128416321:50001231000000:2800:808460BD0F232826DB76834F7840BFE5BC6EF2C18FD0A4AB01948786CC37D58A.png" width="805" height="796"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p113411953191512"></p> </li></ol> </div> <div class="tiledSection"><h3 id="section3989185975217">配置推荐白名单<i class="anchor-icon anchor-icon-link" anchorid="section3989185975217" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174588__p18628378430">在推荐白名单配置页面，可以查看扫描出来的推荐配置的保留选项和白名单字段，并一键生成白名单混淆规则文件。</p> <ul id="ZH-CN_TOPIC_0000002478174588__ul8844104411391"><li id="li17913122411244"><strong>使用DevEco Studio 6.0.0 Beta1及以上版本，按以下步骤操作：</strong><ol id="ZH-CN_TOPIC_0000002478174588__ol119081923610"><li id="li159091923611">在页面上方，按照以下的树状结构呈现扫描结果。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen0959216182317" data-highlighted="yes"><ol class="linenums"><li>模块名</li><li><span class="hljs-comment">----混淆选项</span></li><li><span class="hljs-comment">--------扫描任务：扫描出来推荐配置白名单字段的数量</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174588__p1957926162319">选中一个扫描任务，在页面下方会按照以下的树状结构，显示推荐的保留选项和白名单字段。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen155793682311" data-highlighted="yes"><ol class="linenums"><li>保留选项</li><li><span class="hljs-comment">----关键代码</span></li><li><span class="hljs-comment">--------白名单字段 --&gt; 字段所在文件:代码行</span></li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478174588__ul9580136172317"><li id="li165801462232"><strong>关键代码</strong>：点击关键代码，可以跳转到代码所在的文件和代码行。<p id="ZH-CN_TOPIC_0000002478174588__p958086142311"><span><img originheight="622" originwidth="1383" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.98817587067508097153525586216512:50001231000000:2800:9DE1708D2DC75B4A14027999E71C9BE469355D9E5879643E5EC607DA00ED7963.png" width="920" height="413.76717281272596"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p135521720217"></p> </li><li id="li10580262234"><strong>白名单字段</strong>：点击白名单字段，可以跳转到字段所在的文件和代码行。<p id="ZH-CN_TOPIC_0000002478174588__p135802642310"><span><img originheight="592" originwidth="1384" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.58126516234611920189863068226159:50001231000000:2800:D14E4E15BACCEF24D2CDECA893A1899C4A545BEA29E35A23CB4CA5ECC189BC5D.png" width="920" height="393.52601156069363"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p4817028162211"></p> </li></ul> </li><li id="li1617173193814">如果需要将白名单文件生成到工程中，可以点击<strong>生成推荐白名单</strong>按钮，ObfuscationHelper会在对应模块下生成推荐白名单文件Hm-recommend-keep-list.txt/Hm-recommend-consumer-keep-list.txt，并提示对应的文件路径。同时在工程根目录下生成对应的白名单Excel表格obfuscation-helper-xxx.xlsx。<p id="ZH-CN_TOPIC_0000002478174588__p1596452193919"><span><img originheight="287" originwidth="516" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.82439339918464842068102157610411:50001231000000:2800:D48C68D2D3EB64625A19B7B0CBACDD384F9C21C5086078529002151610A1170E.png" width="516" height="287"></span></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul14884192693920"><li id="li1888492612396">点击<strong>OK</strong>，会关闭提示框，停留在推荐白名单场景。</li><li id="li1954412863915">点击<strong>跳转待排查</strong>，会关闭提示框，进入到待排查白名单场景。</li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p6797202188">如果勾选<strong>合并白名单文件</strong>，点击<strong>OK</strong>或者<strong>跳转待排查</strong>时，会在工程根目录下生成合并后的白名单文件Hm-merge-recommend-keep-list.txt，该文件会合并entry模块的Hm-recommend-keep-list.txt和所有模块的Hm-recommend-consumer-keep-list.txt。</p> <p id="ZH-CN_TOPIC_0000002478174588__p375613573537">如以下模块下生成推荐白名单文件：</p> <p id="ZH-CN_TOPIC_0000002478174588__p2485206105412"><span><img originheight="494" originwidth="1571" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.63242102930284727700331301383189:50001231000000:2800:CF7F13D3856D43882D256D12ECA89810C2F69DFED61A63063849CBB95AC4C8F3.png" width="920" height="289.2934436664545"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p15724195672420"></p> </li><li id="li7634144016386">在混淆配置中添加白名单文件，有两种方式。<ul id="ZH-CN_TOPIC_0000002478174588__ul11771029204912"><li id="li8771729114918">在各模块的build-profile.json5中，将Hm-recommend-keep-list.txt加入到混淆配置files字段下，将Hm-recommend-consumer-keep-list.txt加入到consumerFiles字段下。关于字段的介绍请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section88021016154414">字段说明</a>。</li><li id="li336843864911">将合并后的文件Hm-merge-recommend-keep-list.txt配置在entry模块build-profile.json5的files字段下。</li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p17748120135916"><span><img originheight="759" originwidth="1127" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.00093158923556015638627714000212:50001231000000:2800:86F77FDCBF0FD3CBA901447CFF70F8FDC6CA87DD5E266481EF30A5C0E04E6F59.png" width="920" height="619.5918367346939"></span></p> </li></ol> </li><li id="li162551214184017"><strong>使用DevEco Studio 6.0.0 Beta1以下版本，按以下步骤操作：</strong><ol id="ZH-CN_TOPIC_0000002478174588__ol169043541298"><li id="li890445432918">在页面上方，按照以下的树状结构呈现扫描结果。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen4904854122917" data-highlighted="yes"><ol class="linenums"><li>模块名</li><li><span class="hljs-comment">----混淆选项</span></li><li><span class="hljs-comment">--------扫描任务：扫描出来推荐配置白名单字段的数量</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174588__p2090412546295">选中一个扫描任务，在页面下方会按照以下的树状结构，显示推荐的保留选项和白名单字段。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen16904185472917" data-highlighted="yes"><ol class="linenums"><li>保留选项</li><li><span class="hljs-comment">----关键代码</span></li><li><span class="hljs-comment">--------白名单字段 --&gt; 字段所在文件:代码行</span></li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478174588__ul12904165482917"><li id="li16904754192919"><strong>关键代码</strong>：点击关键代码，可以跳转到代码所在的文件和代码行。<p id="ZH-CN_TOPIC_0000002478174588__p109041354182917"><span><img originheight="630" originwidth="1108" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.15242585346905981369070083178573:50001231000000:2800:51F694F64574EB9BFA206ADDE986AFA83420D0A5247AB52D10B753F71BC619EB.png" width="920" height="523.1046931407942"></span></p> </li><li id="li15904145412912"><strong>白名单字段</strong>：点击白名单字段，可以跳转到字段所在的文件和代码行。<p id="ZH-CN_TOPIC_0000002478174588__p19904125414292"><span><img originheight="705" originwidth="1252" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.28273376293808340952289145680564:50001231000000:2800:F6690EE70A8D0C66E335AC42CAB31CABB2C18624143D84C6A0485EAEBC0FCF87.png" width="920" height="518.0511182108626"></span></p> </li></ul> </li><li id="li790516547292">如果需要将白名单文件生成到工程中，可以点击<strong>生成推荐白名单</strong>按钮，ObfuscationHelper会在对应模块下生成Hm-recommend-keep-list.txt文件，并提示对应的文件路径。同时在工程根目录下生成对应的白名单Excel表格obfuscation-helper-xxx.xlsx。<p id="ZH-CN_TOPIC_0000002478174588__p129055541299"><span><img originheight="201" originwidth="515" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.44434802823010336490655039068379:50001231000000:2800:53A4613A6C3F52FD55C32CFCA35969D1C95996FCC1280A5671B2A7E8EB19777E.png" width="515" height="201"></span></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul18905195462910"><li id="li890565412296">点击OK，会关闭提示框，停留在推荐白名单场景。</li><li id="li790513544292">点击跳转待排查，会关闭提示框，进入到待排查白名单场景。</li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p129053541294">如以下模块下生成推荐白名单文件：</p> <p id="ZH-CN_TOPIC_0000002478174588__p1690555420296"><span><img originheight="820" originwidth="1839" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104904.17206077635210558234491446842765:50001231000000:2800:5FB01A1CFA8725E4980032BCA372C5719DE999D1AA307A7C3F8422BA947FDA4E.png" width="920" height="410.2229472539423"></span></p> </li><li id="li89051254132915">在模块下的build-profile.json5中，将模块下生成的推荐白名单文件Hm-recommend-keep-list.txt加入到混淆配置files或consumerFiles字段下。关于字段的介绍请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section88021016154414">字段说明</a>。<p id="ZH-CN_TOPIC_0000002478174588__p390585482916"><span><img originheight="693" originwidth="1333" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.81033942907042921677341826440651:50001231000000:2800:F4DE2AD164AD5A1DA4B5C3CA1A8D83A42ED35B87336BA7E737569DF9D3C690B9.png" width="920" height="478.28957239309824"></span></p> </li></ol> </li></ul> </div> <div class="tiledSection"><h3 id="section42331014105310">配置待排查白名单<i class="anchor-icon anchor-icon-link" anchorid="section42331014105310" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174588__p12191163414610">在待排查白名单配置页面，可以查看扫描出来的关键代码，需要开发者根据业务进一步排查，识别白名单字段并配置到文件中。</p> <ul id="ZH-CN_TOPIC_0000002478174588__ul0383165019411"><li id="li3383205074110"><strong>使用DevEco Studio 6.0.0 Beta1及以上版本，按以下步骤操作：</strong><ol id="ZH-CN_TOPIC_0000002478174588__ol15304913157"><li id="li11461930356">在页面上方，按照以下的树状结构呈现扫描结果。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen1814613303516" data-highlighted="yes"><ol class="linenums"><li>模块名</li><li><span class="hljs-comment">----混淆选项</span></li><li><span class="hljs-comment">--------扫描任务：扫描出来待排查的关键代码的数量</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174588__p21461630852">选中一个扫描任务，在页面下方会显示待排查的代码。点击关键代码，可以跳转到代码所在的文件和代码行。</p> <p id="ZH-CN_TOPIC_0000002478174588__p723084417111"><span><img originheight="702" originwidth="1312" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.92085129282389833743501190052285:50001231000000:2800:5698BD38CCB1ED1BD50F9A340A443C9778CCFA615FF4C5E8C3A5007317704888.png" width="920" height="492.2560975609756"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p1394952942715"></p> </li><li id="li12826151550">跳转到关键代码后，根据具体场景识别是否需要配置白名单字段，排查方式请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section18125192133818">扫描任务</a>。<ul id="ZH-CN_TOPIC_0000002478174588__ul49886315132"><li id="li298817312134">如果排查后不需要配置白名单，点击<strong>待排查</strong>，选择<strong>已排查</strong>，标记该项已经排查。</li><li id="li1742531810134">如果排查后需要配置白名单，点击<strong>添加白名单</strong>，在输入框中输入保留选项和白名单字段，点击<strong>保存白名单</strong>。保存后该排查项会被标记为已排查。</li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p6767154112114">被标记为已排查的排查项，后续再次扫描该模块和场景时，如果关联本次的排查记录，将不再需要重复排查。</p> <p id="ZH-CN_TOPIC_0000002478174588__p1564684113717"><span><img originheight="578" originwidth="701" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.40912675761237130281623544426747:50001231000000:2800:71A841D27DFB5B3B0DBA68BD25D35046C0889490F8E9BA7A2860EF762192F9AC.png" width="701" height="578"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p196942072912"></p> </li><li id="li41476303512">排查完成后，点击<strong>生成排查白名单</strong>按钮，ObfuscationHelper会在对应模块下生成排查白名单文件Hm-manual-keep-list.txt/Hm-manual-consumer-keep-list.txt，并提示对应的文件路径。同时在工程根目录下生成对应的白名单Excel表格obfuscation-helper-xxx.xlsx。<p id="ZH-CN_TOPIC_0000002478174588__p171471306515"><span><img originheight="263" originwidth="512" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.40021883899361045920248071157117:50001231000000:2800:5093F8721F36EF3D4F840B3FA0D6B85C432EDD763DC21D249BA7BCCB0429C17B.png" width="512" height="263"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p6583722203110">如果勾选<strong>合并白名单文件</strong>，点击<strong>OK</strong>，会在工程根目录下生成合并后的白名单文件Hm-merge-manual-keep-list.txt，该文件会合并entry模块的Hm-manual-keep-list.txt和所有模块的Hm-manual-consumer-keep-list.txt。</p> <p id="ZH-CN_TOPIC_0000002478174588__p1114715308516">如以下模块下生成排查白名单文件：</p> <p id="ZH-CN_TOPIC_0000002478174588__p1514715301518"><span><img originheight="795" originwidth="1874" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.05759414621542113557221066772842:50001231000000:2800:84C8EB841C0D44A0B02BC25B3E112EE59DE5060EAF1B8143F74A9EA10BB2BA09.png" width="920" height="390.2881536819637"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p1447873913307"></p> </li><li id="li1514718302512">在混淆配置中添加白名单文件，有两种方式。<ul id="ZH-CN_TOPIC_0000002478174588__ul121061459144015"><li id="li14106115934019">在各模块的build-profile.json5中，将Hm-manual-keep-list.txt加入到混淆配置files字段下，将Hm-manual-consumer-keep-list.txt加入到consumerFiles字段下。关于字段的介绍请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section88021016154414">字段说明</a>。</li><li id="li16579146144117">将合并后的文件Hm-merge-manual-keep-list.txt配置在entry模块build-profile.json5的files字段下。</li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p31471730256"><span><img originheight="699" originwidth="1124" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.35484313052557247861526827491675:50001231000000:2800:C9D33D7377438C3611C3FB0F391E8508FCBE3A8581B5E28191B1B5996CBCD761.png" width="920" height="572.135231316726"></span></p> </li></ol> </li><li id="li1162841010423"><strong>使用DevEco Studio 6.0.0 Beta1以下版本，按以下步骤操作：</strong><ol id="ZH-CN_TOPIC_0000002478174588__ol1631132217348"><li id="li1031222133414">在页面上方，按照以下的树状结构呈现扫描结果。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" id="ZH-CN_TOPIC_0000002478174588__screen13315227341" data-highlighted="yes"><ol class="linenums"><li>模块名</li><li><span class="hljs-comment">----混淆选项</span></li><li><span class="hljs-comment">--------扫描任务：扫描出来待排查的关键代码的数量</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174588__p15311922203419">选中一个扫描任务，在页面下方会按照“关键代码 --&gt; 代码所在文件: 代码行”的结构，显示待排查的代码。点击关键代码，可以跳转到代码所在的文件和代码行。</p> <p id="ZH-CN_TOPIC_0000002478174588__p153152253413"><span><img originheight="698" originwidth="1251" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.01058768813932769473142935311936:50001231000000:2800:9F4A6B0F81B00BFA94044FF12C682DFD72DB73BB747E8082EF143FE0F427A342.png" width="920" height="513.3173461231015"></span></p> </li><li id="li731112211349">跳转到关键代码后，根据具体场景识别是否需要配置白名单字段，排查方式请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section18125192133818">扫描任务</a>。如果存在需要配置的字段，在上方的输入框中，输入保留选项和对应的白名单字段。<p id="ZH-CN_TOPIC_0000002478174588__p14313226343"><span><img originheight="508" originwidth="672" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.43775421176079304038974582036500:50001231000000:2800:8EE0C61021B62C7B39BFB737ADCFF5F816E61A608D0ED62905630FED35D98BD2.png" width="672" height="508"></span></p> </li><li id="li23192253410">排查完成后，点击<strong>生成排查白名单</strong>按钮，ObfuscationHelper会在对应模块下生成Hm-manual-keep-list.txt文件，并提示对应的文件路径。同时在工程根目录下生成对应的白名单Excel表格obfuscation-helper-xxx.xlsx。<p id="ZH-CN_TOPIC_0000002478174588__p1131102213345"><span><img originheight="190" originwidth="515" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.80827862950544797802062863907088:50001231000000:2800:0101A4F2C294707406BD807A7C80140089DDE718B50D10300EAA26B91C7944D6.png" width="515" height="190"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p13212228345">如以下模块下生成排查白名单文件：</p> <p id="ZH-CN_TOPIC_0000002478174588__p203292217346"><span><img originheight="671" originwidth="1865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.12200698640938078899771324400811:50001231000000:2800:BAED2344A382FE48EDF5748305C5467E1A7A2B9BB263B57CF0C0F0D6C48A4CF5.png" width="920" height="331.0026809651475"></span></p> </li><li id="li193212233417">在模块下的build-profile.json5中，将模块下生成的排查白名单文件Hm-manual-keep-list.txt加入到混淆配置files或consumerFiles字段下。关于字段的介绍请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#section88021016154414">字段说明</a>。<p id="ZH-CN_TOPIC_0000002478174588__p332622173414"><span><img originheight="603" originwidth="1143" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.92284753270705811339388853907397:50001231000000:2800:EB0E0BCFAD0192CE5CD90D0B8566F36BDC4996597BCB1A076C6EC8509C90A287.png" width="920" height="485.3543307086614"></span></p> </li></ol> </li></ul> </div> <div class="tiledSection"><h3 id="section1247110297535">查看历史记录<i class="anchor-icon anchor-icon-link" anchorid="section1247110297535" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174588__p167065710015">点击生成推荐白名单或者待排查白名单后，会生成一条历史记录，方便开发者后续查看和继续排查白名单。</p> <p id="ZH-CN_TOPIC_0000002478174588__p261720446115">在ObfuscationHelper的首页，点击底部的<strong>历史记录</strong>按钮，可查看所有的历史记录。</p> <p id="ZH-CN_TOPIC_0000002478174588__p76960302233"><span><img originheight="335" originwidth="844" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.42913091067695366953168767428360:50001231000000:2800:9C52D41AF0C77BAC12A35E2031E4F4F1A5E9BF18D8AF05AED37D13F3053E95BD.png" width="844" height="335"></span></p> <p id="ZH-CN_TOPIC_0000002478174588__p9859173212317"></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul9834257618"><li id="li118349572114">保存路径是历史记录的缓存文件，鼠标悬停在保存路径上，可以查看白名单文件和Excel表格保存的路径。</li><li id="li1014014261625">点击查看详情图标<span><img originheight="14" originwidth="13" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.84549697536529651390147630414826:50001231000000:2800:2E0CF6E9509631163A0D4FC5B8800B461966A5FB59F1DE46D418F0C94CA3138D.png" class="IconPic notEnlarge" width="13" height="14"></span>，可以跳转到对应的白名单场景配置页面。</li><li id="li1927851422">点击删除图标，可以删除指定的历史记录，以及对应的缓存文件和Excel表格，但是不会删除白名单文件。</li></ul> </div> <div class="tiledSection"><h3 id="section18125192133818">扫描任务<i class="anchor-icon anchor-icon-link" anchorid="section18125192133818" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174588__p541513523165">以下是ObfuscationHelper的扫描任务，关于保留选项的原理介绍和排查场景请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation" target="_blank">混淆规则</a>。</p> <p id="ZH-CN_TOPIC_0000002478174588__p14729706395"><strong>属性混淆</strong></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul5518311124111"><li id="li149352624118"><strong>JSON数据解析及对象序列化</strong><p id="ZH-CN_TOPIC_0000002478174588__p163144213329">在使用JSON/ArkTSUtils.ASON进行转换时，对象类型中的属性需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478174588__screen7279182211375" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// JSON.parse</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">JSONTest</span> {</li><li>  <span class="hljs-attr">prop1</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  <span class="hljs-attr">prop2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>}</li><li><span class="hljs-comment">// 示例JSON文件test.json</span></li><li><span class="hljs-comment">/*</span></li><li><span class="hljs-comment">{</span></li><li><span class="hljs-comment">  "prop1": "value",</span></li><li><span class="hljs-comment">  "prop2": 10</span></li><li><span class="hljs-comment">}</span></li><li><span class="hljs-comment">*/</span></li><li><span class="hljs-keyword">const</span> jsonData = buffer.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-string">"test.json"</span>)).<span class="hljs-title function_">toString</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">demo</span>: <span class="hljs-title class_">JSON</span>Test = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonData)       <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> demo = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonData) <span class="hljs-keyword">as</span> <span class="hljs-title class_">JSON</span>Test     <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> demo = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonData) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">JSON</span>Test      <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">demo</span>: <span class="hljs-title class_">ESObject</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonData)       <span class="hljs-comment">// 没有明确类型的，包括(EsObject、Object、object)加入待排查白名单中，需要将jsonData中所有的key，如prop1/prop2加入keep-property-name</span></li><li>
</li><li><span class="hljs-comment">// ArkTSUtils.ASON.parse</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">demo</span>: <span class="hljs-title class_">JSON</span>Test = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">ASON</span>.<span class="hljs-title function_">parse</span>(jsonData)      <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> demo = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">ASON</span>.<span class="hljs-title function_">parse</span>(jsonData) <span class="hljs-keyword">as</span> <span class="hljs-title class_">JSON</span>Test    <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> demo = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">ASON</span>.<span class="hljs-title function_">parse</span>(jsonData) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ESObject</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">JSON</span>Test    <span class="hljs-comment">// JSONTest加入keep-property-name</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">demo</span>: <span class="hljs-title class_">ESObject</span> = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">ASON</span>.<span class="hljs-title function_">parse</span>(jsonData)      <span class="hljs-comment">// 没有明确类型的，包括(EsObject、Object、object)加入待排查白名单中，需要将jsonData中所有的key，如prop1/prop2加入keep-property-name</span></li><li>
</li><li><span class="hljs-comment">// JSON.stringify</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-keyword">type</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span>Test()</li><li><span class="hljs-keyword">let</span> str = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-keyword">type</span>)    <span class="hljs-comment">// JSON.stringify加入待排查白名单，需要将JSONTest中的所有属性加入-keep-property-name</span></li><li>
</li><li><span class="hljs-comment">// ArkTSUtils.ASON.stringify</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-keyword">type</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span>Test()</li><li><span class="hljs-keyword">let</span> str = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">ASON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-keyword">type</span>)  <span class="hljs-comment">// ArkTSUtils.ASON.stringify加入待排查白名单，需要将JSONTest中的所有属性加入-keep-property-name</span></li></ol></pre></div></div> </li><li id="li125181211174112"><strong>通过字符串访问的对象属性</strong><p id="ZH-CN_TOPIC_0000002478174588__p484954433211">通过中括号形式访问的对象属性，以及Object.defineProperty/Object.defineProperties/Object.getOwnPropertyDescriptor接口中的属性需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen101122516375" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过中括号形式访问的属性如obj['name']，如果name是变量，加入待排查白名单，需要将name对应的内容加入-keep-property-name</span></li><li><span class="hljs-variable">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable">obj</span>, <span class="hljs-string">'y'</span>, {})   <span class="hljs-comment">// 如果y是变量，加入待排查白名单，需要将y对应的内容加入-keep-property-name</span></li><li><span class="hljs-variable">Object</span>.<span class="hljs-title function_">defineProperties</span>(<span class="hljs-variable">obj</span>, {        <span class="hljs-comment">// 属性prop1/prop2加入推荐白名单-keep-property-name</span></li><li>  <span class="hljs-variable">prop1</span>: {</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-string">'Hello'</span>,</li><li>    <span class="hljs-variable">writable</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">enumerable</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">configurable</span>: <span class="hljs-keyword">true</span></li><li>  },</li><li>  <span class="hljs-variable">prop2</span>: {</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-string">'Hello'</span>,</li><li>    <span class="hljs-variable">writable</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">enumerable</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">configurable</span>: <span class="hljs-keyword">true</span></li><li>  } </li><li>});</li><li><span class="hljs-variable">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(<span class="hljs-variable">obj</span>, <span class="hljs-string">'bbb'</span>);    <span class="hljs-comment">// 如果bbb是变量，加入待排查白名单，需要将bbb对应的内容加入-keep-property-name</span></li><li><span class="hljs-variable">obj</span>.<span class="hljs-variable">s</span>=<span class="hljs-number">0</span>; <span class="hljs-keyword">let</span> <span class="hljs-variable">key</span>=<span class="hljs-string">'s'</span>; <span class="hljs-variable">obj</span>[<span class="hljs-variable">key</span>]    <span class="hljs-comment">// key是变量，加入待排查白名单，需要将key对应的内容s加入keep-property-name</span></li></ol></pre></div></div> </li><li id="li183454211713"><strong>C++侧访问/操作ArkTS对象属性</strong><p id="ZH-CN_TOPIC_0000002478174588__p1226215512420">开发者需要根据C++接口来排查与其相关的ArkTS中的属性字符串，并手动加入白名单中，涉及的C++接口参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-property" target="_blank">使用Node-API接口设置ArkTS对象的属性</a>。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002478174588__screen38111691197" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//index.ets</span></li><li><span class="hljs-built_in">func</span>() {</li><li>  let obj: NapiTestClassObj = { napiTestClassObjData: <span class="hljs-number">0</span>, napiTestClassObjMessage: <span class="hljs-string">"hello world"</span> };</li><li>  let result: ESObject = testNapi.<span class="hljs-built_in">setProperty</span>(obj, <span class="hljs-string">"napiTestClassObjMessage"</span>, <span class="hljs-string">"100"</span>);    <span class="hljs-comment">// 根据napi_set_property接口排查到ArkTS中的属性napiTestClassObjMessage被修改，需要将napiTestClassObjMessage加入-keep-property-name白名单</span></li><li>  <span class="hljs-keyword">if</span> (obj.napiTestClassObjMessage === <span class="hljs-string">"100"</span>) {</li><li>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"setProperty success"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li><span class="hljs-comment">//napi_init.cpp</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">SetProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">3</span>;</li><li>    napi_value args[<span class="hljs-number">3</span>];</li><li>    napi_status status = <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_get_cb_info fail"</span>);</li><li>    }</li><li>    status = <span class="hljs-built_in">napi_set_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>]);    <span class="hljs-comment">// 扫描napi_set_property关键API</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_set_property fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li></ol></pre></div></div> </li><li id="li7369844441"><strong>数据库键值对类型（ValuesBucket）中的属性</strong><p id="ZH-CN_TOPIC_0000002478174588__p3674148193219">数据库键值对类型（ValuesBucket）中的属性需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen36511928103712" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">valueBucket</span>: <span class="hljs-title class_">ValuesBucket</span> = {</li><li>  <span class="hljs-string">'ID1'</span>: <span class="hljs-title class_">ID1</span>,    <span class="hljs-comment">// ID1、NAME1、AGE1、SALARY1加入到-keep-property-name</span></li><li>  <span class="hljs-string">'NAME1'</span>: <span class="hljs-title class_">name</span>,</li><li>  <span class="hljs-string">'AGE1'</span>: <span class="hljs-title class_">age</span>,</li><li>  <span class="hljs-string">'SALARY1'</span>: <span class="hljs-title class_">salary</span></li><li>};</li></ol></pre></div></div> </li><li id="li128471225441"><strong>自定义装饰器修饰的成员变量、方法、参数</strong><p id="ZH-CN_TOPIC_0000002478174588__p6234205073210">自定义装饰器修饰的成员变量、方法、参数，需要排查是否加入白名单。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478174588__screen11998183018374" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">logClass</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'类被创建：'</span>, target);    <span class="hljs-comment">// MyClass未参与混淆，因此被@logClass修饰的类名不需要加入白名单</span></li><li>  <span class="hljs-keyword">return</span> target;</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logMethod</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, methodName: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {</li><li>  <span class="hljs-keyword">const</span> originalMethod = descriptor.<span class="hljs-property">value</span>;</li><li>  descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {</li><li>   <span class="hljs-keyword">if</span>(methodName === <span class="hljs-string">'myMethod'</span>){    <span class="hljs-comment">// methodName会被混淆，与'myMethod'作比较不符合预期，因此被@logMethod修饰的方法名myMethod需要加入白名单</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'调用myMethod方法'</span>)</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`方法 <span class="hljs-subst">${methodName}</span> 即将被调用，参数为：`</span>, args);</li><li>    <span class="hljs-keyword">const</span> result = originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`方法 <span class="hljs-subst">${methodName}</span> 调用完毕，结果为：`</span>, result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  };</li><li>  <span class="hljs-keyword">return</span> descriptor;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">logProperty</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyName: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-keyword">let</span> value;</li><li>  <span class="hljs-keyword">const</span> getter = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在获取属性 <span class="hljs-subst">${propertyName}</span>`</span>);   <span class="hljs-comment">// propertyName会被混淆，但不影响运行结果，不需要加入白名单</span></li><li>    <span class="hljs-keyword">return</span> value;</li><li>  };</li><li>  <span class="hljs-keyword">const</span> setter = <span class="hljs-keyword">function</span> (<span class="hljs-params">newValue: <span class="hljs-built_in">any</span></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在设置属性 <span class="hljs-subst">${propertyName}</span>，新值为：<span class="hljs-subst">${newValue}</span>`</span>);</li><li>    value = newValue;</li><li>  };</li><li>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyName, {</li><li>    <span class="hljs-attr">get</span>: getter,</li><li>    <span class="hljs-attr">set</span>: setter,</li><li>    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span></li><li>  });</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-meta">@logClass</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {    <span class="hljs-comment">// 自定义装饰器修饰的类名，需要排查MyClass是否加入白名单</span></li><li>  <span class="hljs-meta">@logProperty</span></li><li>  <span class="hljs-attr">myProperty</span>: <span class="hljs-built_in">number</span>;    <span class="hljs-comment">// 自定义装饰器修饰的属性，需要排查myProperty是否加入白名单</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myProperty</span> = <span class="hljs-number">10</span>;</li><li>  }</li><li>  <span class="hljs-meta">@abcd</span></li><li>  <span class="hljs-meta">@logMethod</span></li><li>  <span class="hljs-title function_">myMethod</span>(<span class="hljs-params">arg1: <span class="hljs-built_in">number</span>, arg2: <span class="hljs-built_in">number</span></span>) {    <span class="hljs-comment">// 自定义装饰器修饰的方法，需要排查myMethod是否加入白名单</span></li><li>    <span class="hljs-keyword">return</span> arg1 + arg2;</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li1040212121517"><strong>Record类型对象的属性</strong><p id="ZH-CN_TOPIC_0000002478174588__p2709241105111">Record类型对象的属性需要被保留。该场景从DevEco Studio 6.0.1 Beta1版本开始支持。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen38191948155116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 支持扫描的场景</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">hello</span>() {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">person</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt; = {</li><li>    <span class="hljs-variable">ddName</span>: <span class="hljs-string">'zhangsan'</span>,    <span class="hljs-comment">// Record类型对象person的属性ddName、ggAge、isWfStudent，加入到-keep-property-name</span></li><li>    <span class="hljs-variable">ggAge</span>: <span class="hljs-number">25</span>,</li><li>    <span class="hljs-variable">isWfStudent</span>: <span class="hljs-keyword">true</span></li><li>  }</li><li>  <span class="hljs-variable">person</span>.<span class="hljs-variable">wwArea</span> = <span class="hljs-string">'112'</span>;     <span class="hljs-comment">// 通过点语法新增的属性wwArea，加入到-keep-property-name</span></li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">person</span>;</li><li>}</li><li><span class="hljs-comment">// 不支持扫描的场景</span></li><li><span class="hljs-comment">// 1、调用该方法获取Record类型对象，通过点语法添加sssd属性不支持扫描，该属性会被混淆</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">hello</span>();</li><li><span class="hljs-variable">ret</span>.<span class="hljs-variable">sssd</span> = <span class="hljs-string">'1111'</span>;</li><li><span class="hljs-comment">// 2、隐式Record类型的对象parameters的属性a123、b123不支持扫描，会被混淆</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">sendPost3</span>() {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>    <span class="hljs-variable">action</span>: <span class="hljs-string">'ohos.want.action.viewData'</span>,</li><li>    <span class="hljs-variable">entities</span>: [<span class="hljs-string">'entity.system.browsable'</span>],</li><li>    <span class="hljs-variable">uri</span>: <span class="hljs-string">'123'</span>,</li><li>    <span class="hljs-variable">parameters</span>: {</li><li>      <span class="hljs-variable">a123</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-variable">b123</span>: <span class="hljs-number">2</span></li><li>    }</li><li>  };</li><li>}</li></ol></pre></div></div> </li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p198721134397"><strong>顶层作用域名称混淆</strong></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul1784610276920"><li id="li16985194815412"><strong>namespace中导出的名称</strong><p id="ZH-CN_TOPIC_0000002478174588__p14322205283217">namespace中导出的名称、嵌套namespace中导出的名称都需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478174588__screen2382433143712" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> namespace1 {</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">namespace1Class1</span> {      <span class="hljs-comment">// namespace1Class1加入推荐白名单-keep-global-name</span></li><li>  }</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> namespace1_1 {      <span class="hljs-comment">// namespace1_1加入推荐白名单-keep-global-name</span></li><li>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> <span class="hljs-attr">namespace1Property1_1</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'111'</span>;      <span class="hljs-comment">// namespace1Property1_1加入推荐白名单-keep-global-name</span></li><li>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">namespace1Func1_1</span>(<span class="hljs-params"></span>) {      <span class="hljs-comment">// namespace1Func1_1加入推荐白名单-keep-global-name</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'namespace1Func1_1 execute success'</span>);</li><li>    }</li><li>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">namespaceClass1_1</span>{      <span class="hljs-comment">// namespaceClass1_1加入推荐白名单-keep-global-name</span></li><li>      <span class="hljs-title function_">func</span>(<span class="hljs-params"></span>){</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">""</span>namespaceClass1_1 success<span class="hljs-string">""</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li920735933212"><strong>动态导入的名称</strong><p id="ZH-CN_TOPIC_0000002478174588__p1475391293310">动态导入的接口名、属性名和类名，需要被保留。该场景从DevEco Studio 6.0.0 Beta2版本开始支持。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478174588__screen38497191332" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入模块后，使用的类名TestClass加入推荐白名单keep-global-name</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> test = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../model/TestClass'</span>)).<span class="hljs-property">TestClass</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'test = '</span>, test);</li><li>  <span class="hljs-comment">// console.warn(TAG, 'test TestClass = ', test.);</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'test staticGlsAdd = '</span>, test.<span class="hljs-title function_">staticGlsAdd</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>));</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`error = <span class="hljs-subst">${e}</span>`</span>);</li><li>}</li><li><span class="hljs-comment">// 导入模块后，使用的方法名componentClass加入推荐白名单keep-global-name</span></li><li><span class="hljs-keyword">let</span> util = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'harlibrary/src/main/ets/utils/Util'</span>);</li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'util = '</span>, util);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'call util function = '</span>, <span class="hljs-keyword">await</span> util.<span class="hljs-title function_">componentClass</span>());</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`error = <span class="hljs-subst">${e}</span>`</span>);</li><li>}</li><li><span class="hljs-comment">// 导入模块后，使用default后调用的方法warn加入推荐白名单keep-global-name</span></li><li><span class="hljs-keyword">import</span>(<span class="hljs-string">'hsplibrary/src/main/ets/utils/Logger'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">logger</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'import Logger success.'</span>);</li><li>    logger.<span class="hljs-property">default</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'this is logger warn'</span>)</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`error = <span class="hljs-subst">${e}</span>`</span>);</li><li>    }</li><li>})</li><li><span class="hljs-comment">// 将动态导入封装为方法，导出的类实例如果是变量，加入待排查白名单，需要排查后将变量对应的值加入keep-global-name</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> importFile&lt;T&gt;(<span class="hljs-attr">modulePath</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">resultClassName</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(modulePath).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">ns: ESObject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: T = <span class="hljs-keyword">new</span> ns[resultClassName]();   <span class="hljs-comment">// 该行加入待排查白名单，排查后将resultClassName对应的值TestClass加入keep-global-name</span></li><li>      <span class="hljs-keyword">return</span> res;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'chisj debug: importFile error = '</span>, err);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>    });</li><li>  }</li><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">let</span> modulePath = <span class="hljs-string">'../model/TestClass'</span>;</li><li><span class="hljs-keyword">let</span> className = <span class="hljs-string">'TestClass'</span>;</li><li><span class="hljs-title class_">ImportUtil</span>.<span class="hljs-property">importFile</span>&lt;<span class="hljs-title class_">ESObject</span>&gt;(modulePath, className).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">ns:ESObject</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'import importFile success'</span>)</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ns = '</span>, ns)</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'calcAdd = '</span>, ns?.<span class="hljs-title function_">calcAdd</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`error = <span class="hljs-subst">${e}</span>`</span>);</li><li>    }</li><li>})</li><li><span class="hljs-comment">// 将动态导入封装为方法，导出的模块myModule调用的方法Calc加入推荐白名单</span></li><li><span class="hljs-comment">// ImportUtil.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> dynamicImport&lt;T&gt;(<span class="hljs-attr">modulePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(modulePath).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> {</li><li>    <span class="hljs-comment">// 有些模块可能有默认导出，这里处理一下</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span> || <span class="hljs-variable language_">module</span> <span class="hljs-keyword">as</span> T;</li><li>  });</li><li>}</li><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">const</span> myModule = <span class="hljs-keyword">await</span> dynamicImport&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'harlibrary'</span>)&gt;(<span class="hljs-string">'harlibrary'</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'1 calc = '</span>, myModule.<span class="hljs-title class_">Calc</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))</li></ol></pre></div></div> </li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p1578724320398"><strong>文件名名称混淆</strong></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul169561411910"><li id="li9993137174219"><strong>动态导入的路径名</strong><p id="ZH-CN_TOPIC_0000002478174588__p38384534322">模块下build-profile.json5文件中，sources字段对应的路径名需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen4240163612374" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 模块级build-profile.json5</span></li><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">"stageMode"</span>,</li><li>  <span class="hljs-string">"buildOption"</span>: {</li><li>    <span class="hljs-string">"arkOptions"</span>: {<span class="hljs-string">"runtimeOnly"</span>: {<span class="hljs-string">"sources"</span>: [<span class="hljs-string">"./aaa/bbb"</span>, <span class="hljs-string">"./ccc/dddd"</span>]}}  <span class="hljs-comment">//./aaa/bbb和./ccc/dddd加入keep-file-name</span></li><li>  },</li><li>  <span class="hljs-string">"buildOptionSet"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span>,</li><li>      <span class="hljs-string">"arkOptions"</span>: {</li><li>        <span class="hljs-string">"runtimeOnly"</span>: {<span class="hljs-string">"sources"</span>: [<span class="hljs-string">"./e/f"</span>, <span class="hljs-string">"./g/h"</span>]},  <span class="hljs-comment">// ./e/f和./g/h加入keep-file-name</span></li><li>        <span class="hljs-string">"obfuscation"</span>: {</li><li>          <span class="hljs-string">"ruleOptions"</span>: {</li><li>            <span class="hljs-string">"enable"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"files"</span>: [</li><li>              <span class="hljs-string">"./obfuscation-rules.txt"</span></li><li>            ]</li><li>          }</li><li>        }</li><li>      },</li><li>    },</li><li>  ],</li><li>......</li><li>}</li></ol></pre></div></div> </li><li id="li1280813197411"><strong>传递给动态路由的路径名</strong><p id="ZH-CN_TOPIC_0000002478174588__p5399185513216">模块下resources/base/profile/route_map.json中，pageSourceFile字段对应的路径名需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174588__screen19341938203712" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 模块下resources/base/profile/route_map.json文件</span></li><li>{</li><li>  <span class="hljs-string">"routerMap"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"PageOne"</span>,</li><li>      <span class="hljs-string">"pageSourceFile"</span>: <span class="hljs-string">"src/main/ets/pages/directory/PageOne.ets"</span>,  <span class="hljs-comment">// src/main/ets/pages/directory/PageOne.ets加入keep-file-name</span></li><li>      <span class="hljs-string">"buildFunction"</span>: <span class="hljs-string">"PageOneBuilder"</span>,</li><li>      <span class="hljs-string">"data"</span>: {</li><li>        <span class="hljs-string">"description"</span> : <span class="hljs-string">"this is PageOne"</span></li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li></ul> <p id="ZH-CN_TOPIC_0000002478174588__p18260194993915"><strong>导入/导出名称混淆</strong></p> <ul id="ZH-CN_TOPIC_0000002478174588__ul132511541098"><li id="li1021211334102"><strong>从so库导入的接口</strong><p id="ZH-CN_TOPIC_0000002478174588__p6271258121516">从so库中导入的接口及其点式调用的属性，需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174588__screen1399825617187" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx.so"</span>    <span class="hljs-comment">// testNapi加入keep-global-name</span></li><li><span class="hljs-keyword">import</span> {testNapi} <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx.so"</span>  <span class="hljs-comment">// testNapi加入keep-global-name</span></li><li><span class="hljs-keyword">import</span> {testNapi <span class="hljs-keyword">as</span> napi} <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx.so"</span>    <span class="hljs-comment">// testNapi加入keep-global-name</span></li><li>testNapi.<span class="hljs-title function_">add</span>()    <span class="hljs-comment">// add加入-keep-property-name</span></li></ol></pre></div></div> </li><li id="li15198347161014"><strong>hsp对外暴露的接口</strong><div class="p" id="ZH-CN_TOPIC_0000002478174588__p394445181313">hsp的入口文件(一般为index.ets)中导出的接口名及其属性名，需要被保留。<div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478174588__screen382645011310" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导出的常量</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LOCAL_NUM</span> = <span class="hljs-number">100</span>  <span class="hljs-comment">// LOCAL_NUM加入keep-global-name</span></li><li><span class="hljs-comment">// 导出的方法</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">harFun</span>(<span class="hljs-params"></span>) {    <span class="hljs-comment">// harFun加入keep-global-name</span></li><li>}</li><li><span class="hljs-comment">// 导出的类名及其属性(包括该类的父类和属性)，如果属性也是一个类，该类也需要以同样的方式保留。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">FatherClass</span> {</li><li>  <span class="hljs-attr">prop4</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"bbb"</span></li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span> {</li><li>  <span class="hljs-attr">prop3</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"bbb"</span></li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HSPClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FatherClass</span>{    <span class="hljs-comment">// 类名称HSPClass加入到-keep-global-name</span></li><li>  <span class="hljs-attr">prop1</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"aaa"</span> </li><li>  <span class="hljs-attr">prop2</span>: <span class="hljs-title class_">SubClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass</span>()    <span class="hljs-comment">// 属性prop1,prop2,prop3,prop4加入到-keep-property-name</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 导出的namespace，包括其中的方法、常量、类(保留方式同上)、子namespace</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">NmSpace</span> {</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NUM_NAME_SPACE</span> = <span class="hljs-number">100</span>   <span class="hljs-comment">// 常量NUM_NAME_SPACE加入-keep-global-name</span></li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">classNameSpace</span> {       <span class="hljs-comment">// 类名称classNameSpace加入-keep-global-name</span></li><li>     <span class="hljs-attr">prop</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"bbb"</span>             <span class="hljs-comment">// 类属性prop加入-keep-property-name</span></li><li>  }</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">funNameSpace</span>(<span class="hljs-params"></span>) {    <span class="hljs-comment">// 方法funNameSpace加入-keep-global-name</span></li><li>  }</li><li>}</li><li><span class="hljs-comment">// 将入口文件相对路径,如 ./index.ets加入keep保留选项。</span></li><li><span class="hljs-comment">// 将入口文件名如index.ets加入keep-file-name保留选项。</span></li></ol></pre></div></div> </div> </li><li id="li783440141114"><strong>从hsp导入的接口</strong><p id="ZH-CN_TOPIC_0000002478174588__p13275534151">从hsp中导入的接口及其点式调用的属性，需要被保留。</p> <div _ngcontent-wcn-c106="" class="highlight-div"><div _ngcontent-wcn-c106="" class="highlight-div-header"><div _ngcontent-wcn-c106="" class="highlight-div-header-left"><div _ngcontent-wcn-c106="" class="handle-button expand-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wcn-c106="" class="highlight-div-header-right"><div _ngcontent-wcn-c106="" class="handle-button ai-button"></div><div _ngcontent-wcn-c106="" class="handle-button line-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wcn-c106="" class="handle-button theme-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wcn-c106="" class="handle-button copy-button"><div _ngcontent-wcn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wcn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174588__screen7835110111911" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">MyClass1</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx"</span>     <span class="hljs-comment">// MyClass1加入keep-global-name</span></li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">MyClass2</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx"</span>   <span class="hljs-comment">// MyClass2加入keep-global-name</span></li><li><span class="hljs-keyword">import</span> {<span class="hljs-title class_">MyClass3</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyClass</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"xxxx"</span>    <span class="hljs-comment">// MyClass3加入keep-global-name</span></li><li><span class="hljs-title class_">MyClass1</span>.<span class="hljs-title function_">add</span>()    <span class="hljs-comment">// add加入keep-property-name</span></li></ol></pre></div></div> </li><li id="li932519546914"><strong>har对外暴露的接口</strong><p id="ZH-CN_TOPIC_0000002478174588__p165842210140">参考<a href="/consumer/cn/doc/harmonyos-guides/ide-build-obfuscation#li15198347161014">hsp对外暴露的接口</a>。</p> <p id="ZH-CN_TOPIC_0000002478174588__p12785132261">仅当hap-&gt;hsp-&gt;har，同时hap-&gt;har时，该har会被扫描，其中-&gt;表示依赖关系。</p> <p id="ZH-CN_TOPIC_0000002478174588__p1846163075211"><span><img originheight="244" originwidth="735" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104905.40682109289874890352190202781494:50001231000000:2800:6427FFC0D454168E1564A28884E5BCF69C827FC75984B7F071DF55A82B974BFA.png" width="735" height="244"></span></p> </li></ul> </div> </div></div>