<h1 _ngcontent-jyv-c119="" class="doc-title ng-star-inserted" title="添加策略"> 添加策略 </h1>

<div _ngcontent-jyv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section139649362716">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section139649362716" tips="复制节点链接"></i></h2>          <p>当用户希望创建新的屏幕时间守护规则时，可以调用添加管控策略的接口。根据参数中传入的策略，用户可以添加各种策略，如设置各个应用的停用起止时间。一旦策略被创建并启用，系统将根据规则对用户的屏幕使用行为进行监管。</p>    </div>    <div class="tiledSection">     <h2 id="section277178141519">用户体验设计<i class="anchor-icon anchor-icon-link" anchorid="section277178141519" tips="复制节点链接"></i></h2>          <p><span><img height="469.37854600000003" originheight="439" originwidth="793" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114553.15969180219386057096423598801280:50001231000000:2800:9FA6F8091A7E05EC0E1584D17E4B0CC6A05D1F2F61183A28C1F056523DC8328B.png" title="点击放大" width="847.875"></span></p>     <p></p>    </div>    <div class="tiledSection">     <h2 id="section5680134318336">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section5680134318336" tips="复制节点链接"></i></h2>          <p><span><img originheight="741" originwidth="693" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114553.58182287845968041065850551580552:50001231000000:2800:CE417ED4CAE45B732F6CFD3D42CC2E02036191C2834B1B6B1AD334D5FF457134.png" width="693" height="741"></span></p>     <p>流程说明：</p>     <p>1. 应用调用添加管控策略的接口，拉起健康使用设备查询本应用是否已申请权限，以及用户是否已给本应用授权。</p>     <p>2. 若没有权限，则抛出相应错误码；若有权限，则解析参数中传入的策略，判断策略是否有效、是否重复、数量是否超限。</p>     <p>3. 若策略正常，则记录到本地数据库；否则，抛出相应错误码。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>1. 管控策略可以设置为起止时间策略，表示策略在一天内配置的起始时间和结束时间内生效，也可以设置为总时长策略类型，表示一天内策略生效的总时长。具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-guardservice#section133401616145119" target="_blank">TimeStrategyType</a> 。</p>       <p>2. 管控策略可以设置限制类型，按允许清单做限制表示对传入的应用之外的应用进行管控，按禁止清单做限制表示对传入的应用进行限制。具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-guardservice#section119174813532" target="_blank">RestrictionType</a> 。</p>       <p>3. 管控策略可以设置一周内重复执行时间，支持填写含有1-7数字的number数组，表示在周一到周日的某些天重复执行。具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-guardservice#section7640121574612" target="_blank">TimeStrategy</a> 。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section11489173117423">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section11489173117423" tips="复制节点链接"></i></h2>          <p>添加策略的关键接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-arkts" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50.239999999999995%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="49.76%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50.239999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-guardservice#section26135455267" target="_blank">addGuardStrategy</a>(guardStrategy: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/screentimeguard-guardservice#section188761911193713" target="_blank">GuardStrategy</a>): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="49.76%">          <p>添加屏幕时间管控策略。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1822994945113">开发前提<i class="anchor-icon anchor-icon-link" anchorid="section1822994945113" tips="复制节点链接"></i></h2>          <p>添加管控策略需要申请用户授权，请先参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/screentimeguard-request-user-auth">请求用户授权</a>章节完成用户授权。</p>    </div>    <div class="tiledSection">     <h2 id="section178565494410">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section178565494410" tips="复制节点链接"></i></h2>          <p>1. 导入相关模块。</p>     <div _ngcontent-jyv-c106="" class="highlight-div"><div _ngcontent-jyv-c106="" class="highlight-div-header"><div _ngcontent-jyv-c106="" class="highlight-div-header-left"><div _ngcontent-jyv-c106="" class="handle-button expand-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyv-c106="" class="highlight-div-header-right"><div _ngcontent-jyv-c106="" class="handle-button ai-button"></div><div _ngcontent-jyv-c106="" class="handle-button line-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyv-c106="" class="handle-button theme-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyv-c106="" class="handle-button copy-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { guardService, appPicker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScreenTimeGuardKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>     <div class="p">      2. 调用addGuardStrategy，添加屏幕时间管控策略。      <div _ngcontent-jyv-c106="" class="highlight-div"><div _ngcontent-jyv-c106="" class="highlight-div-header"><div _ngcontent-jyv-c106="" class="highlight-div-header-left"><div _ngcontent-jyv-c106="" class="handle-button expand-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyv-c106="" class="highlight-div-header-right"><div _ngcontent-jyv-c106="" class="handle-button ai-button"></div><div _ngcontent-jyv-c106="" class="handle-button line-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyv-c106="" class="handle-button theme-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyv-c106="" class="handle-button copy-button"><div _ngcontent-jyv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TestPage</span> {</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Button</span>(<span class="hljs-string">"TestAddGuardStrategy"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-variable">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// 先调用startAppPicker获取相应应用的token</span></li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">tokens</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">appPicker</span>.<span class="hljs-title function_">startAppPicker</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(), { <span class="hljs-variable">appTokens</span>: [] });</li><li>
</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">time</span>: <span class="hljs-title class_">guardService</span>.<span class="hljs-title class_">TimeStrategy</span> = {</li><li>              <span class="hljs-keyword">type</span>: <span class="hljs-title class_">guardService</span>.<span class="hljs-title class_">TimeStrategyType</span>.<span class="hljs-title class_">START_END_TIME_TYPE</span>,</li><li>              <span class="hljs-variable">startTime</span>: <span class="hljs-string">"08:00"</span>,</li><li>              <span class="hljs-variable">endTime</span>: <span class="hljs-string">"19:00"</span>,</li><li>              <span class="hljs-variable">repeat</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]</li><li>            }</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">info</span>: <span class="hljs-title class_">guardService</span>.<span class="hljs-title class_">AppInfo</span> = {</li><li>              <span class="hljs-variable">appTokens</span>: <span class="hljs-title class_">tokens</span></li><li>            }</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">strategy</span>: <span class="hljs-title class_">guardService</span>.<span class="hljs-title class_">GuardStrategy</span> = {</li><li>              <span class="hljs-variable">name</span>: <span class="hljs-string">"TestStrategy"</span>,</li><li>              <span class="hljs-variable">timeStrategy</span>: <span class="hljs-title class_">time</span>,</li><li>              <span class="hljs-variable">appInfo</span>: <span class="hljs-title class_">info</span>,</li><li>              <span class="hljs-variable">appRestrictionType</span>: <span class="hljs-title class_">guardService</span>.<span class="hljs-title class_">RestrictionType</span>.<span class="hljs-title class_">BLOCKLIST_TYPE</span></li><li>            }</li><li>            <span class="hljs-variable">await</span> <span class="hljs-variable">guardService</span>.<span class="hljs-title function_">addGuardStrategy</span>(<span class="hljs-variable">strategy</span>);</li><li>          } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">message</span> = (<span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>).<span class="hljs-variable">message</span>;</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">code</span> = (<span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>).<span class="hljs-variable">code</span>;</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, `<span class="hljs-variable">ScreenTimeGuard</span>:<span class="hljs-title class_">addGuardStrategy</span>`, `<span class="hljs-variable">addGuardStrategy</span> <span class="hljs-variable">failed</span> <span class="hljs-variable">with</span> <span class="hljs-variable">error</span> <span class="hljs-variable">code</span>: ${<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">message</span>}`);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     </div>    </div>   </div>   <div></div></div>