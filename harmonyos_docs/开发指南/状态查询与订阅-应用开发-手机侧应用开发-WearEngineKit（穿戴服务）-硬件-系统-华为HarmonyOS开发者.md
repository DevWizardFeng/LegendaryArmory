<h1 _ngcontent-wva-c119="" class="doc-title ng-star-inserted" title="状态查询与订阅"> 状态查询与订阅 </h1>

<div _ngcontent-wva-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p>该接口的调用需要在开发者联盟申请设备基础信息权限与穿戴用户状态权限（请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>），穿戴用户状态权限还需获得用户授权。</p>     </div></div></div>    <ul>     <li>实时查询穿戴设备可用空间、电量状态。</li>     <li>订阅穿戴设备连接状态、低电量告警、用户心率告警。</li>     <li>查询和订阅穿戴设备充电状态、佩戴状态、设备模式。</li>    </ul>    <p>使用该接口前，需要确保应用已申请相应权限（参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>）同时向手机侧用户申请获取对应权限的授权（参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request_user_authorization">请求用户授权</a>），否则接口将调用失败。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <caption>       <b>表1 </b>申请权限：设备基础信息      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.5.1.1" valign="top" width="20.24%">         <p>穿戴设备状态与运动健康状态</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.5.1.2" valign="top" width="26.52%">         <p>查询结果</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.5.1.3" valign="top" width="30.080000000000002%">         <p>订阅事件的触发条件</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.5.1.4" valign="top" width="23.16%">         <p>订阅结果</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="20.24%">         <p>连接状态</p></td>        <td class="cellrowborder" valign="top" width="26.52%">         <p>N/A</p></td>        <td class="cellrowborder" valign="top" width="30.080000000000002%">         <ul>          <li>2：手机连接设备成功</li>          <li>3：手机与设备断开（断开蓝牙或拉远距离）</li>         </ul></td>        <td class="cellrowborder" valign="top" width="23.16%">         <ul>          <li>2：连接成功</li>          <li>3：连接断开</li>          <li>4：连接失败</li>          <li>5：设备被删除</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="20.24%">         <p>可用空间</p></td>        <td class="cellrowborder" valign="top" width="26.52%">         <p>可用存储空间，单位：KB（例如：20480）</p></td>        <td class="cellrowborder" valign="top" width="30.080000000000002%">         <p>N/A</p></td>        <td class="cellrowborder" valign="top" width="23.16%">         <p>N/A</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="20.24%">         <p>电量状态</p></td>        <td class="cellrowborder" valign="top" width="26.52%">         <p>电量值（例如：97）</p></td>        <td class="cellrowborder" valign="top" width="30.080000000000002%">         <p>设备电量每减少1% （例如：由98%降到97%），且设备处于非充电状态</p></td>        <td class="cellrowborder" valign="top" width="23.16%">         <p>电量值（例如：97）</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="20.24%">         <p>充电状态</p></td>        <td class="cellrowborder" valign="top" width="26.52%">         <ul>          <li>1：设备正在充电状态</li>          <li>2：设备为非充电状态</li>          <li>3：设备正在充电，且为满电状态</li>         </ul></td>        <td class="cellrowborder" valign="top" width="30.080000000000002%">         <ul>          <li>1：给设备进行充电</li>          <li>2：设备停止充电</li>          <li>3：设备达到充满电的状态</li>         </ul></td>        <td class="cellrowborder" valign="top" width="23.16%">         <ul>          <li>1：充电开始</li>          <li>2：充电结束</li>          <li>3：充电完成</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="20.24%">         <p>设备模式</p></td>        <td class="cellrowborder" valign="top" width="26.52%">         <ul>          <li>-1：设备不支持模式切换</li>          <li>0：设备处于智能模式</li>          <li>1：设备处于超长续航模式</li>         </ul></td>        <td class="cellrowborder" valign="top" width="30.080000000000002%">         <ul>          <li>0：设备从超长续航模式切换到智能模式</li>          <li>1：设备从智能模式切换到超长续航模式</li>         </ul></td>        <td class="cellrowborder" valign="top" width="23.16%">         <ul>          <li>0：设备处于智能模式</li>          <li>1：设备处于超长续航模式</li>         </ul></td>       </tr>           </tbody></table></div>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <caption>       <b>表2 </b>申请权限：穿戴用户状态USER_STATUS（仅限企业开发者）      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.5.1.1" valign="top" width="25%">         <p>穿戴设备状态与运动健康状态</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.5.1.2" valign="top" width="14.99%">         <p>查询结果</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.5.1.3" valign="top" width="35.010000000000005%">         <p>订阅事件的触发条件</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.5.1.4" valign="top" width="25%">         <p>订阅结果</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="25%">         <p>佩戴状态</p></td>        <td class="cellrowborder" valign="top" width="14.99%">         <ul>          <li>1：佩戴中</li>          <li>2：未佩戴</li>         </ul></td>        <td class="cellrowborder" valign="top" width="35.010000000000005%">         <ul>          <li>1：将穿戴设备戴在手腕上</li>          <li>2：将穿戴设备由手腕摘下</li>         </ul></td>        <td class="cellrowborder" valign="top" width="25%">         <ul>          <li>1：佩戴</li>          <li>2：未佩戴</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%">         <p>心率告警</p></td>        <td class="cellrowborder" valign="top" width="14.99%">         <p>N/A</p></td>        <td class="cellrowborder" valign="top" width="35.010000000000005%">         <ul>          <li>1：静态心率连续10分钟高于上限值</li>          <li>2：静态心率连续10分钟低于下限值</li>          <li>3：运动心率过高</li>          <li>4：运动心率过低</li>         </ul>         <p>备注：打开<span class="menucascade">“<span class="uicontrol">运动健康App</span> &gt; <span class="uicontrol"> 设备</span>”</span>，在应用和服务列表中，点击<span class="menucascade">“<span class="uicontrol">心率</span>”</span>，设置相应的心率提醒。</p></td>        <td class="cellrowborder" valign="top" width="25%">         <ul>          <li>1：静态心率过高</li>          <li>2：静态心率过低</li>          <li>3：运动心率过高</li>          <li>4：运动心率过低</li>         </ul></td>       </tr>           </tbody></table></div>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>穿戴设备侧无对应的应用，手机侧应用也可以使用该能力获取穿戴设备状态。</li>       <li>在查询或订阅穿戴设备电量、充电、佩戴、心率告警状态时，请确保穿戴设备和华为运动健康App处于连接状态。用户可进入App“设备”界面查看设备是否在线。开发者可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1828213119411" target="_blank">getConnectedDevices</a>或根据返回错误码了解设备是否已连接手机，如果设备未连接则提醒用户重新连接设备。</li>       <li>查询和订阅佩戴状态、心率告警时，需要申请穿戴用户状态<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section09971113566" target="_blank">USER_STATUS</a>权限。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="section1719161163616">查询设备状态<i class="anchor-icon anchor-icon-link" anchorid="section1719161163616" tips="复制节点链接"></i></h2>          <p>穿戴设备的状态可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section178254313113" target="_blank">MonitorClient</a>对象中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section3383841153218" target="_blank">queryStatus</a>方法获取到。一次只能查询一个状态。</p>     <ol>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/query_connected_devices">已连接穿戴设备查询</a>章节，获取已连接设备列表。</span></li>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/we-device-selection">目标设备选择</a>章节，从已连接设备列表中选定需要通信的设备。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">wearEngine</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section068883315262" target="_blank">getMonitorClient</a>方法，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section178254313113" target="_blank">MonitorClient</a>对象。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section3383841153218" target="_blank">queryStatus</a>方法，查询指定指标状态。</span>       <p></p>       <ul>        <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section16422462613" target="_blank">MonitorItem</a>对象，查询指定指标状态。目前支持查询的状态如下：         <ul>          <li>“电量状态”字段：POWER_STATUS。</li>          <li>“充电状态”字段：CHARGE_STATUS。</li>          <li>“佩戴状态”字段：WEAR_STATUS。</li>          <li>“设备模式”字段：POWER_MODE。</li>          <li>“可用内存”字段：AVAILABLE_STORAGE_SPACE</li>         </ul></li>        <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section12024822410" target="_blank">MonitorData</a>对象，返回指定指标状态的查询结果。         <div _ngcontent-wva-c106="" class="highlight-div"><div _ngcontent-wva-c106="" class="highlight-div-header"><div _ngcontent-wva-c106="" class="highlight-div-header-left"><div _ngcontent-wva-c106="" class="handle-button expand-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wva-c106="" class="highlight-div-header-right"><div _ngcontent-wva-c106="" class="handle-button ai-button"></div><div _ngcontent-wva-c106="" class="handle-button line-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wva-c106="" class="handle-button theme-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wva-c106="" class="handle-button copy-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wva-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 步骤3 获取MonitorClient对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">monitorClient</span>: wearEngine.<span class="hljs-property">MonitorClient</span> = wearEngine.<span class="hljs-title function_">getMonitorClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>
</li><li><span class="hljs-comment">// 步骤4 查询指定指标状态（以佩戴状态为例）</span></li><li>monitorClient.<span class="hljs-title function_">queryStatus</span>(targetDevice.<span class="hljs-property">randomId</span>, wearEngine.<span class="hljs-property">MonitorItem</span>.<span class="hljs-property">WEAR_STATUS</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: wearEngine.MonitorData</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 获取到所查状态的状态值，处理对应业务逻辑</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in querying wear status, result is <span class="hljs-subst">${result.code}</span>.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 处理调用失败时捕获到的异常</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to query wear status. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>.`</span>);</li><li>})</li></ol></pre></div></div></li>       </ul>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section821516217616">订阅设备状态<i class="anchor-icon anchor-icon-link" anchorid="section821516217616" tips="复制节点链接"></i></h2>          <ol>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/query_connected_devices">已连接穿戴设备查询</a>章节，获取已连接的设备列表。</span></li>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/we-device-selection">目标设备选择</a>章节，从已连接设备列表中选定需要通信的设备。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">wearEngine</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section068883315262" target="_blank">getMonitorClient</a>方法，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section178254313113" target="_blank">MonitorClient</a>对象。</span></li>      <li><span>定义订阅任务的回调对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#callback" target="_blank">Callback</a>。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section74368231248" target="_blank">subscribeEvent</a>方法，订阅指定指标状态变化的订阅。</span>       <p></p>       <ul>        <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section0407141762619" target="_blank">MonitorEvent</a>对象，订阅穿戴设备与运动健康状态。目前支持的订阅状态如下：         <ul>          <li>“设备连接状态”字段： EVENT_CONNECTION_STATUS_CHANGED。</li>          <li>“电量降低状态”字段：EVENT_BATTERY_LEVEL_DROPPED。</li>          <li>“充电状态”字段： EVENT_CHARGE_STATUS_CHANGED。</li>          <li>“佩戴状态”字段：EVENT_WEAR_STATUS_CHANGED。</li>          <li>“心率告警”字段：EVENT_HEART_RATE_ALARM。</li>          <li>“设备模式”字段：EVENT_POWER_MODE_CHANGED。</li>         </ul></li>        <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#callback" target="_blank">Callback</a>&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section38571246164212" target="_blank">MonitorEventData</a>&gt;对象，返回设备状态的订阅结果。</li>       </ul>       <div _ngcontent-wva-c106="" class="highlight-div"><div _ngcontent-wva-c106="" class="highlight-div-header"><div _ngcontent-wva-c106="" class="highlight-div-header-left"><div _ngcontent-wva-c106="" class="handle-button expand-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wva-c106="" class="highlight-div-header-right"><div _ngcontent-wva-c106="" class="handle-button ai-button"></div><div _ngcontent-wva-c106="" class="handle-button line-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wva-c106="" class="handle-button theme-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wva-c106="" class="handle-button copy-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wva-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 步骤3 获取MonitorClient对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">monitorClient</span>: wearEngine.<span class="hljs-property">MonitorClient</span> = wearEngine.<span class="hljs-title function_">getMonitorClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>
</li><li><span class="hljs-comment">// 步骤4 定义回调函数</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = (<span class="hljs-params">monitorEventData: wearEngine.MonitorEventData</span>) =&gt; {</li><li>  <span class="hljs-comment">// 处理监听到状态变化后的业务逻辑</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in listening change of <span class="hljs-subst">${monitorEventData.event}</span>, the new status is <span class="hljs-subst">${monitorEventData.data}</span>.`</span>)</li><li>}</li><li>
</li><li><span class="hljs-comment">// 步骤5 调用订阅方法</span></li><li>monitorClient.<span class="hljs-title function_">subscribeEvent</span>(targetDevice.<span class="hljs-property">randomId</span>, wearEngine.<span class="hljs-property">MonitorEvent</span>.<span class="hljs-property">EVENT_WEAR_STATUS_CHANGED</span>, callback).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in subscribing wear status.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to subscribe wear status. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>.`</span>);</li><li>})</li></ol></pre></div></div>       <p></p></li>     </ol>     <ol start="6">      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section182736075018" target="_blank">unsubscribeEvent</a>方法，解除穿戴设备状态变化的订阅。（需要传入订阅时使用的回调函数对象）</span>       <p></p>       <div _ngcontent-wva-c106="" class="highlight-div"><div _ngcontent-wva-c106="" class="highlight-div-header"><div _ngcontent-wva-c106="" class="highlight-div-header-left"><div _ngcontent-wva-c106="" class="handle-button expand-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wva-c106="" class="highlight-div-header-right"><div _ngcontent-wva-c106="" class="handle-button ai-button"></div><div _ngcontent-wva-c106="" class="handle-button line-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wva-c106="" class="handle-button theme-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wva-c106="" class="handle-button copy-button"><div _ngcontent-wva-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wva-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 步骤6 取消订阅，取消订阅时需要传入与订阅时相同的回调函数对象才可正常取消订阅</span></li><li>monitorClient.<span class="hljs-title function_">unsubscribeEvent</span>(targetDevice.<span class="hljs-property">randomId</span>, wearEngine.<span class="hljs-property">MonitorEvent</span>.<span class="hljs-property">EVENT_WEAR_STATUS_CHANGED</span>, callback).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in unsubscribing wear status`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to unsubscribe wear status. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>.`</span>);</li><li>})</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>