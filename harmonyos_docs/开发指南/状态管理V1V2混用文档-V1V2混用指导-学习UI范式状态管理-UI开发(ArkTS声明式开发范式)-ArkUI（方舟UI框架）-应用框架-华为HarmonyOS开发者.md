<h1 _ngcontent-adi-c119="" class="doc-title ng-star-inserted" title="状态管理V1V2混用文档"> 状态管理V1V2混用文档 </h1>

<div _ngcontent-adi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>在状态管理框架的演进过程中，分别于API version 7和API version 12推出了状态管理V1和V2两个版本。对于已经使用状态管理V1的应用，如果有诉求向状态管理V2迁移，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration">状态管理V1和V2迁移文档</a>。</p>     <p>对于大型应用，迁移过程中会遇到V1V2混用的场景，在API version 19之前，混用场景有相对严格的校验，主要表现在复杂对象的传递上，具体规则可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-component-mixed-scenarios">自定义组件混用场景指导</a>。为了帮助开发者顺利地向V2迁移，从API version 19开始，减少了对V1V2混用场景的约束。具体变更可参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#校验规则">校验规则</a>。同时提供新的方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#enablev2compatibility19" target="_blank">enableV2Compatibility</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>来帮助开发者解决在迁移过程中遇到的混用问题。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>本文档中使用“-&gt;”表示变量的传递，比如“V1-&gt;V2”，表示V1状态变量向V2状态变量传递。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="校验规则">校验规则<i class="anchor-icon anchor-icon-link" anchorid="校验规则" tips="复制节点链接"></i></h2>          <p>在API version 19以前，状态管理V1V2的混用规则可以总结为：</p>     <ol>      <li>V1装饰器不能和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a>一起使用。</li>      <li>V2装饰器不能和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed</a>一起使用。</li>      <li>V1-&gt;V2只能传简单类型，不允许传复杂类型，包括built-in类型Array、Map、Set、Date。</li>      <li>V2-&gt;V1可以传简单类型和普通class，不允许传built-in类型Array、Map、Set、Date。</li>      <li>V1中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>遵循其原本初始化规则，只能被V1状态变量初始化，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link#变量的传递访问规则说明">@Link初始化规则</a>。</li>     </ol>     <p>从API version 19开始，第1、5条规则依旧禁止，第2-4条规则放开校验。具体编译期校验见下表。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.4.1.1" valign="top" width="33.33333333333333%">场景</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.4.1.2" valign="top" width="33.33333333333333%">API version 19以前</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.4.1.3" valign="top" width="33.33333333333333%">API version 19及以后</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V1装饰器和@ObservedV2同时使用</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V2装饰器和@Observed同时使用</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V1-&gt;V2 普通class</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V1-&gt;V2 built-in类型Array、Map、Set、Date</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V1-&gt;V2 @Observed装饰的class</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V2-&gt;V1 @ObservedV2装饰的class</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">V2-&gt;V1 built-in类型Array、Map、Set、Date</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">@ObjectLink被非@Observed装饰的class初始化</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">报错</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不报错</td>        </tr>             </tbody></table></div>     </div>     <p>依旧禁止第1条，是因为@ObservedV2/@Trace有自己独立的观察能力，不仅可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>中使用，也可以独立在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component">@Component</a>中使用，状态管理框架不希望其观察能力和V1的观察能力混合使用，所以依旧维持禁止现状。</p>     <p>依旧禁止第5条，是因为V1中@Link仅能和V1状态变量建立双向同步关系，而V2中如果想实现双向同步，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-event">@Event</a>，具体例子见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#link---paramevent">@Link和@Param@Event迁移示例</a>。</p>    </div>    <div class="tiledSection">     <h2 id="新增接口">新增接口<i class="anchor-icon anchor-icon-link" anchorid="新增接口" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="makev1observed" class="firsth2">makeV1Observed<i class="anchor-icon anchor-icon-link" anchorid="makev1observed" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>将不可观察的对象包装成状态管理V1可观察的对象，能力等同于@Observed，其返回值可初始化@ObjectLink。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 19开始，开发者可以使用UIUtils中的makeV1Observed接口将不可观察的对象包装成状态管理V1可观察的对象。</p>      </div></div></div>     <p><strong>接口说明</strong></p>     <ul>      <li>makeV1Observed主要和enableV2Compatibility搭配使用，实现V2-&gt;V1的传递。</li>      <li>makeV1Observed可将普通class、Array、Map、Set、Date类型转换为V1的状态变量，其能力等同于@Observed，所以其返回值可以初始化@ObjectLink。</li>      <li>如果makeV1Observed接受的数据已经是V1的状态变量，则返回自身，不做任何改变。</li>      <li>makeV1Observed不会递归执行，仅会将第一层包装成V1的状态变量。</li>     </ul>     <p><strong>限制条件</strong></p>     <ul>      <li>不支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-collections" target="_blank">collections类型</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable">@Sendable</a>装饰的class。</li>      <li>不支持非object类型。</li>      <li>不支持undefined、null。</li>      <li>不支持@ObservedV2、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makeobserved" target="_blank">makeObserved</a>的返回值和V2装饰器装饰的built-in类型的变量（Array、Map、Set和Date）。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="enablev2compatibility">enableV2Compatibility<i class="anchor-icon anchor-icon-link" anchorid="enablev2compatibility" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#enablev2compatibility19" target="_blank">enableV2Compatibility</a>将V1的状态变量使能V2的观察能力，即让V1状态变量可以在@ComponentV2中观察到变化。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 19开始，开发者可以使用UIUtils中的enableV2Compatibility接口将V1的状态变量兼容V2中使用。</p>      </div></div></div>     <p><strong>接口说明</strong></p>     <ul>      <li>该接口主要应用于V1-&gt;V2的场景，V1的状态变量调用该接口后，传递到@ComponentV2中，则可以在V2中观察到变化，从而实现数据的联动刷新。</li>      <li>enableV2Compatibility只能作用于V1的状态变量。V1状态变量为V1装饰器装饰的变量，即@Observed装饰的变量，或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Consume</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink</a>（@ObjectLink需是@Observed装饰的实例或者makeV1Observed的返回值）装饰的变量。否则，将返回入参自身。</li>      <li>enableV2Compatibility会递归遍历class的所有属性，Array/Set/Map的所有子项，直到遇到非V1状态变量的数据，则停止当前分支的遍历。</li>     </ul>     <p><strong>限制条件</strong></p>     <ul>      <li>不支持非object类型。</li>      <li>不支持undefined、null。</li>      <li>不支持非V1的状态变量数据。</li>      <li>不支持@ObservedV2、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makeobserved" target="_blank">makeObserved</a>的返回值和V2装饰器装饰的built-in类型的变量（Array、Map、Set和Date）。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="混用范式">混用范式<i class="anchor-icon anchor-icon-link" anchorid="混用范式" tips="复制节点链接"></i></h2>          <p>基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#enablev2compatibility19" target="_blank">enableV2Compatibility</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>接口，V1V2混用范式如下：</p>    </div>    <div class="tiledSection">     <h3 id="v1-v2" class="firsth2">V1-&gt;V2<i class="anchor-icon anchor-icon-link" anchorid="v1-v2" tips="复制节点链接"></i></h3>          <ul>      <li>V1的状态变量传递给V2的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>，调用UIUtils.enableV2Compatibility使V1的状态变量可在@ComponentV2中有观察能力。完整示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#常见场景">常见场景</a>。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>) })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>V1状态变量可观察第一层属性，在调用UIUtils.enableV2Compatibility传递给@Param后，@Param也可观察第一层属性的变化。</li>     </ul>     <p>具体场景能力可见下表。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.1" valign="top" width="50%">@Component(父) -&gt; @ComponentV2（子）</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.2" valign="top" width="50%">调用enableV2Compatibility后观察行为</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">常规变量</td>         <td class="cellrowborder" valign="top" width="50%">无观察能力，因为enableV2Compatibility仅支持V1状态变量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">@Observed装饰class</td>         <td class="cellrowborder" valign="top" width="50%">可观察第一层属性。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">V1装饰器装饰的变量，其类型为Array、Map、Set和Date</td>         <td class="cellrowborder" valign="top" width="50%">可观察API调用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">V1装饰器装饰的变量，其类型为非@Observed装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">可观察第一层属性。需注意，如果数据源是@ObjectLink，则其需要为@Observed装饰class的实例或者makeV1Observed的返回值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">普通Array，其数组项为@Observed装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">不可观察，因为enableV2Compatibility检查外层数组为非V1状态变量，所以接口不生效，返回数据源本身。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">V1装饰器装饰的变量，其类型为普通Array，其数组项为@Observed装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">在@Component中仅可观察第一层，如果想深度观察，则需搭配@ObjectLink使用。在@ComponentV2中可深度观察。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">@ObservedV2装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">在V1和V2中可观察，其观察能力源于@ObservedV2和@Trace的能力，enableV2Compatibility不生效。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">V1装饰器装饰的变量，其类型为普通Array，其数组项为@ObservedV2装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">可观察，因为enableV2Compatibility会使外层的Array在V2中可观察。@ObservedV2装饰的class的属性观察能力源自于@ObservedV2和@Trace，和enableV2Compatibility无关。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="v2-v1">V2-&gt;V1<i class="anchor-icon anchor-icon-link" anchorid="v2-v1" tips="复制节点链接"></i></h3>          <p>在V2-&gt;V1时，推荐使用UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())。如果当前对象已经是V1的可观察数据了，则仅调用UIUtils.enableV2Compatibility即可，完整例子见<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#常见场景">常见场景</a>。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>());</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">CompV1</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>具体场景如下表。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.3.1.1" valign="top" width="50%">@ComponentV2(父) -&gt; @Component（子）</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.3.1.2" valign="top" width="50%">调用enableV2Compatibility后观察行为</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">@Observed装饰class的嵌套类</td>         <td class="cellrowborder" valign="top" width="50%">在@ComponentV2可深度观察嵌套属性的变化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">普通class</td>         <td class="cellrowborder" valign="top" width="50%">可以观察，需要调用makeV1Observed使得enableV2Compatibility正常工作。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Array&lt;number&gt;，或其他简单类型数组</td>         <td class="cellrowborder" valign="top" width="50%">          <p>可以观察，需要调用makeV1Observed。</p>          <p>例子： @Local local : Array&lt;number&gt; = UIUtils.enableV2Compatibility(UIUtils.makeV1Observed([1, 2, 3]))。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Array&lt;ObservedClass&gt;，即数组项是@Observed装饰的class</td>         <td class="cellrowborder" valign="top" width="50%">          <p>可以观察，需要调用makeV1Observed。</p>          <p>例子： @Local local : Array&lt;ObservedClass&gt; = UIUtils.enableV2Compatibility(UIUtils.makeV1Observed([new ObservedClass()]))。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Array&lt;Array&lt;number&gt;&gt;，二维数组，数组项或为其他简单类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>可以观察，需要调用makeV1Observed。</p>          <p>例子： @Local local : Array&lt;Array&lt;number&gt;&gt;&gt; = UIUtils.enableV2Compatibility(UIUtils.makeV1Observed([UIUtils.makeV1Observed([1, 2, 3])]))。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="混用规则">混用规则<i class="anchor-icon anchor-icon-link" anchorid="混用规则" tips="复制节点链接"></i></h2>          <ul>      <li>V1-&gt;V2传递复杂类型数据，需要调用enableV2Compatibility，否则无法实现V1和V2的数据联动，推荐在V2组件的构造处调用，否则当变量被整体赋值时，需要再次手动调用enableV2Compatibility。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 推荐，this.state = new ObservedClass()时无需再调用UIUtils.enableV2Compatibility，减少代码量</span></li><li><span class="hljs-title class_">SubComponentV2</span>({<span class="hljs-attr">param</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>)})</li><li>
</li><li><span class="hljs-comment">// 不推荐，state做整体赋值时，需要再次调用UIUtils.enableV2Compatibility</span></li><li><span class="hljs-comment">// 否则传递给SubComponentV2的V1变量是无法在V2中观察的</span></li><li><span class="hljs-comment">// @State state: ObservedClass = UIUtils.enableV2Compatibility(new ObservedClass());</span></li><li><span class="hljs-comment">// this.state = UIUtils.enableV2Compatibility(new ObservedClass());</span></li><li><span class="hljs-title class_">SubComponentV2</span>({<span class="hljs-attr">param</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>})</li></ol></pre></div></div>     <ul>      <li>V2-&gt;V1传递复杂类型数据，在V2中优先声明成V1的状态变量数据，并调用UIUtils.enableV2Compatibility。因为在状态管理V1中，状态变量默认有观察第一层的能力，而状态管理V2仅有观察自身的能力，如果希望双方数据联动，则需要调用UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())拉齐双方的观察能力。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 推荐</span></li><li><span class="hljs-meta">@Local</span> <span class="hljs-attr">unObservedClass</span>: <span class="hljs-title class_">UnObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UnObservedClass</span>()));</li><li>
</li><li><span class="hljs-comment">// 推荐，ObservedClass是@Observed装饰的class</span></li><li><span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>());</li></ol></pre></div></div>     <ul>      <li>UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())不会改变V1和V2本身观察能力。       <ul>        <li>在V1中，UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())等于V1的观察能力，观察数据本身的赋值和第一层属性的赋值，无法深度观察，如果需要深度观察，则需要配合@ObjectLink。</li>        <li>在V2中，UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())可以深度观察，但是需要每一层都是@Observed装饰的class，或者是makeV1Observed的返回值。</li>       </ul></li>      <li>当数据已使能V2观察能力，即调用UIUtils.enableV2Compatibility后，会将新的数据默认使能V2观察能力，但需要开发者保证新增数据也是@Observed装饰的class，或者是makeV1Observed的返回值。完整例子可见<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#嵌套类型">常见场景</a>。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ArrayItem</span>&gt; = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>()));</li><li>
</li><li>arr.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>()); <span class="hljs-comment">// 新增数据不是V1状态变量，所以不会具有V2观察能力</span></li><li>arr.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>())); <span class="hljs-comment">// 新增数据是V1的状态变量，默认在V2中可观察</span></li></ol></pre></div></div>     <ul>      <li>对于built-in类型，如Array、Map、Set和Date，V1和V2都可以观察自身赋值和其API的调用所带来的变化。虽然开发者在不调用UIUtils.enableV2Compatibility时，也可以在一些简单场景下实现数据刷新，但是会带来双重代理导致性能较差的问题，所以推荐开发者使用UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())，具体例子见<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#内置类型">常见场景</a>。</li>      <li>对于有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-track">@Track</a>装饰属性的类，非@Track装饰的属性在@ComponentV2中使用不会崩溃，在@Component中使用仍会崩溃。具体例子见<a href="/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#observed装饰的class">常见场景</a>。</li>     </ul>     <p>开发者在使用这两个接口混用V1V2时，可遵循下图逻辑。</p>     <p><span><img originheight="950" originwidth="1022" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114911.96339153066946683857083235925296:50001231000000:2800:E2F54B8BD019ED566713AF2E1BC3CC2ADAFAC2DB150A30D2CCB71482F2E87C65.png" width="920" height="855.1859099804304"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见场景">常见场景<i class="anchor-icon anchor-icon-link" anchorid="常见场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="普通js-object" class="firsth2">普通JS Object<i class="anchor-icon anchor-icon-link" anchorid="普通js-object" tips="复制节点链接"></i></h3>          <p><strong>V1-&gt;V2</strong></p>     <p><strong>推荐写法</strong></p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>        })</li><li>      <span class="hljs-comment">// 调用UIUtils.enableV2Compatibility使V1的状态变量可在@ComponentV2中有观察能力。</span></li><li>      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>) })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// V1状态变量在使能V2观察能力后，可以在V2观察第一层的变化</span></li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>不推荐写法</strong></p>     <p>在下面的例子中，V1的状态变量在传递给V2时，未调用enableV2Compatibility接口，未使能V2的观察能力，则observedClass在CompV2中无法观察属性name的变化。同一个状态变量在CompV1和CompV2中观察能力不一致。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>        })</li><li>      <span class="hljs-comment">// 未调用enableV2Compatibility接口，V1的状态变量在CompV2中无观察能力</span></li><li>      <span class="hljs-comment">// 在CompV2不可观察name的变化</span></li><li>      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 不刷新</span></li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>V2-&gt;V1</strong></p>     <p><strong>推荐写法</strong></p>     <p>在V2-&gt;V1传递的场景中，为了拉齐V2和V1的观察能力，需要在V2中调用makeV1Observed接口，同时也需要使能V2的观察能力，调用enableV2Compatibility接口，所以推荐写法如下。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>()));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// @Local原本能力仅可观察自身</span></li><li>      <span class="hljs-comment">// 但是调用了UIUtils.makeV1Observed使其变成V1的状态变量，V1状态变量可观察第一层变化</span></li><li>      <span class="hljs-comment">// 又调用UIUtils.enableV2Compatibility使其在V2中可观察</span></li><li>      <span class="hljs-comment">// 所以当前可观察第一层属性的变化</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Local observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>        })</li><li>      <span class="hljs-comment">// @ObjectLink可接收@Observed装饰class的实例或者makeV1Observed的返回值</span></li><li>      <span class="hljs-title class_">CompV1</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 在CompV1中可观察第一层的变化</span></li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@ObjectLink observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>不推荐写法</strong></p>     <p>因为V1和V2观察能力不同，如果不调用UIUtils.enableV2Compatibility(UIUtils.makeV1Observed())直接进行数据传递，则会造成不刷新或者刷新行为不一致的问题。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// @Local原本能力仅可观察自身，此处不可观察属性的变化</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Local observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 不刷新</span></li><li>        })</li><li>      <span class="hljs-comment">// @ObjectLink不可接收非@Observed装饰class的实例或者makeV1Observed的返回值</span></li><li>      <span class="hljs-comment">// 日志提示开发者当前ObjectLink被不合法赋值</span></li><li>      <span class="hljs-title class_">CompV1</span>({ <span class="hljs-attr">observedClass1</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>, <span class="hljs-attr">observedClass2</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">observedClass1</span>: <span class="hljs-title class_">ObservedClass</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass2</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// @ObjectLink被不合法赋值，不会响应UI刷新</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@ObjectLink observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass1.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass1</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 不刷新</span></li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// 不同于@ObjectLink，@State会默认将不可观察的对象包装成V1可观察的对象，可观察到自身和属性的变化</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass2.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass2</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// 刷新</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="observed装饰的class">@Observed装饰的class<i class="anchor-icon anchor-icon-link" anchorid="observed装饰的class" tips="复制节点链接"></i></h3>          <p><strong>V1-&gt;V2</strong></p>     <p>下面的例子中：</p>     <ul>      <li>ObservedClass是@Observed装饰的class，并在传递给V2时使能了在V2中观察的能力。</li>      <li>name是@Track装饰的属性，其在V1和V2均是可观察的。</li>      <li>count是非@Track装饰的属性，其在V1和V2的UI中使用均是非法的。       <ul>        <li>在V1中，如果将非@Track装饰的属性使用在UI中，是非法行为，会有运行时报错。</li>        <li>在V2中，非@Track装饰的属性使用在UI不会有运行时报错，但不会响应更新。</li>       </ul></li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'a'</span>;</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 触发刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>      })</li><li>      <span class="hljs-comment">// 使用非@Track的变量在V1中会崩溃</span></li><li>      <span class="hljs-comment">// Text(`count: ${this.observedClass.count}`)</span></li><li>
</li><li>      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>) })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 使用非@Track的变量在V2中不会崩溃，但不会响应更新</span></li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.count}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// 不触发刷新</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">count</span>++;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>V2-&gt;V1</strong></p>     <ul>      <li>ObservedClass是@Observed装饰的class，所以传递给V1调用UIUtils.enableV2Compatibility时，无需再调用UIUtils.makeV1Observed。</li>      <li>只有@Track装饰的变量在V1和V2中可观察。非@Track的变量在V1中使用在UI上会有运行时报错，在V2中不会报错，但不会响应刷新。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'a'</span>;</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">CompV1</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>());</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 触发刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>      })</li><li>      <span class="hljs-comment">// 使用非@Track的变量在V2中不会崩溃，但不响应更新</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.count}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">count</span>++;</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">CompV2</span>({ <span class="hljs-attr">observedClass</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CompV2</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedClass.name}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 触发刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedClass</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>      })</li><li>      <span class="hljs-comment">// 使用非@Track的变量在V1中会崩溃</span></li><li>      <span class="hljs-comment">// Text(`count: ${this.observedClass.count}`)</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="内置类型">内置类型<i class="anchor-icon anchor-icon-link" anchorid="内置类型" tips="复制节点链接"></i></h3>          <p>以Array为例。</p>     <p><strong>V1-&gt;V2</strong></p>     <p><strong>推荐写法</strong></p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ArrayCompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V1 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击触发ArrayCompV1和ArrayCompV2变化</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>      <span class="hljs-comment">// 传递给V2时，发现当前代理是makeV1Observed包装的，且使能V2观察能力</span></li><li>      <span class="hljs-comment">// 在ArrayCompV2中Param不会再次包装代理，避免双重代理的问题</span></li><li>      <span class="hljs-title class_">ArrayCompV2</span>({ <span class="hljs-attr">arr</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>) })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ArrayCompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V2 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击触发ArrayCompV1和ArrayCompV2变化</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>不推荐写法</strong></p>     <p>在下面的例子中，没有调用enableV2Compatibility和makeV1Observed，则有V1和V2双重代理的问题。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ArrayCompV1</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V1 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// V1代理，可触发ArrayCompV1的刷新并通知ArrayCompV2更新@Param的值</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>      <span class="hljs-comment">// 传递给ArrayCompV2，被再次包装V2的代理</span></li><li>      <span class="hljs-title class_">ArrayCompV2</span>({ <span class="hljs-attr">arr</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ArrayCompV2</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V2 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// V1V2双重代理，可触发ArrayCompV1和ArrayCompV2的刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>V2-&gt;V1</strong></p>     <p><strong>推荐写法</strong></p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ArrayCompV2</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V2 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击触发V2变化，且同步给V1 @ObjectLink</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>      <span class="hljs-title class_">ArrayCompV1</span>({ <span class="hljs-attr">arr</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ArrayCompV1</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V1 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击触发V1变化，且双向同步回给V2</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>不推荐写法</strong></p>     <p>在下面的例子中，没有调用enableV2Compatibility和makeV1Observed，且对@ObjectLink非法初始化，使其无法观察属性的变化。</p>     <p>但因为传递给@ObjectLink是V2的状态变量，所以可以触发V2的刷新。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ArrayCompV2</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V2 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 点击触发V2变化</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>      <span class="hljs-comment">// 传递给@ObjectLink为非@Observed和makeV1Observed数据</span></li><li>      <span class="hljs-comment">// 非法操作，@ObjectLink将不能观察属性变化</span></li><li>      <span class="hljs-title class_">ArrayCompV1</span>({ <span class="hljs-attr">arr</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ArrayCompV1</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`V1 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// V1不刷新，但可以触发V2的刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>]++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="二维数组">二维数组<i class="anchor-icon anchor-icon-link" anchorid="二维数组" tips="复制节点链接"></i></h3>          <p><strong>V1-&gt;V2</strong></p>     <p>下面的例子中：</p>     <ul>      <li>使用makeV1Observed将二维数组的内层数组变成V1的状态变量。</li>      <li>在传递给V2子组件时，调用enableV2Compatibility，使其具有V2的观察能力，也避免V1V2的双重代理。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Item</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">itemArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item}</span>`</span>)</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>())</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Param push'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'Param'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">IndexPage</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; =</li><li>    [<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'apple'</span>]), <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'banana'</span>]), <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'orange'</span>])];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">itemArr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Item</span>({ <span class="hljs-attr">itemArr</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(itemArr) })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">itemArr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(itemArr) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>())</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@State push two-dimensional array item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">push</span>(<span class="hljs-string">'strawberry'</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@State push array item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'pear'</span>]));</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@State change two-dimensional array first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">'APPLE'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@State change array first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'watermelon'</span>]);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>V2-&gt;V1</strong></p>     <p>下面的例子中：</p>     <ul>      <li>使用makeV1Observed将二维数组的内层数组变成V1的状态变量。调用enableV2Compatibility，使其具有V2的观察能力，也避免V1V2的双重代理。</li>      <li>在V1中，使用@ObjectLink接收二维数组的内层数组，因为其为makeV1Observed的返回值，所以点击Button('@ObjectLink push')，会正常响应刷新。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Item</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">itemArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item}</span>`</span>)</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>())</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@ObjectLink push'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'ObjectLink'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">IndexPage</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; =</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'apple'</span>]),</li><li>      <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'banana'</span>]), <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'orange'</span>])]));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">itemArr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Item</span>({ <span class="hljs-attr">itemArr</span>: itemArr })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">itemArr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(itemArr) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>())</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Local push two-dimensional array item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">push</span>(<span class="hljs-string">'strawberry'</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Local push array item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'pear'</span>]));</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Local change two-dimensional array first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">'APPLE'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Local change array first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'watermelon'</span>]);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="嵌套类型">嵌套类型<i class="anchor-icon anchor-icon-link" anchorid="嵌套类型" tips="复制节点链接"></i></h3>          <p><strong>V1-&gt;V2</strong></p>     <p>基于上述基本场景，下面展示一个嵌套场景的示例。</p>     <p>下面的例子的行为可以总结为：</p>     <ul>      <li>@State仅能观察第一层的变化，如果要深度观察，需要传递给@ObjectLink。</li>      <li>数据源@State的第二层的改变，虽然不能带来本层的刷新，但会被@ObjectLink和@Param观察到，并触发它们关联组件的刷新。</li>      <li>@ObjectLink和@Param是同一个对象的引用，其属性改变也会带来其他引用的刷新。</li>      <li>在传递给V2子组件NestedClassV2时，调用enableV2Compatibility，使其具有V2的观察能力。</li>      <li>如果开发者在传递给V2时没有调用enableV2Compatibility，则@Param无法观察对象的属性。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 不推荐写法</span></li><li><span class="hljs-title class_">NestedClassV2</span>({ <span class="hljs-attr">outer</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span> })</li></ol></pre></div></div>     <p>完整例子如下。</p>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayItem</span> {</li><li>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {</li><li>  <span class="hljs-attr">innerValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'inner'</span>;</li><li>  <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ArrayItem</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;ArrayItem&gt;</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = arr;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">outerValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'outer'</span>;</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">inner: Inner</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span> = inner;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NestedClassV1</span> {</li><li>  <span class="hljs-comment">// 需保证每一层都是V1的状态变量</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">outer</span>: <span class="hljs-title class_">Outer</span> =</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>(</li><li>      <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([</li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">1</span>)),</li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">2</span>))</li><li>      ])))</li><li>    ));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State outer.outerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.outerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// @State可以观察第一层的变化</span></li><li>          <span class="hljs-comment">// 变化会通知@ObjectLink和@Param刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">outerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@State outer.inner.innerValue cannot update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.inner.innerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// @State无法观察第二层的变化</span></li><li>          <span class="hljs-comment">// 但该变化会被@ObjectLink和@Param观察</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">innerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 将inner传递给@ObjectLink可观察inner属性的变化</span></li><li>      <span class="hljs-title class_">NestedClassV1ObjectLink</span>({ <span class="hljs-attr">inner</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span> })</li><li>      <span class="hljs-comment">// 将开启enableV2Compatibility的数据传给V2</span></li><li>      <span class="hljs-title class_">NestedClassV2</span>({ <span class="hljs-attr">outer</span>: <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>) })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NestedClassV1ObjectLink</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@ObjectLink inner.innerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.inner.innerValue}</span>`</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 可以触发刷新，和@Param是同一个对象的引用，@Param也会进行刷新</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">innerValue</span> += <span class="hljs-string">'!'</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NestedClassV2</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">outer</span>: <span class="hljs-title class_">Outer</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param outer.outerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.outerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可以观察第一层的变化</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">outerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param outer.inner.innerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.inner.innerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可以观察第二层的变化，和@ObjectLink是同一个对象的引用，也会触发刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">innerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">arr</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">item: RepeatItem&lt;ArrayItem&gt;</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Param outer.inner.arr index: <span class="hljs-subst">${item.index}</span> item: <span class="hljs-subst">${item.item.value}</span>`</span>)</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Param push'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// outer已经使能了V2观察能力，对于新增加的数据，则默认开启V2观察能力</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">20</span>)));</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@Param change the last Item'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 可以观察最后一个数组项的属性变化</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">arr</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">value</span>++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>V2-&gt;V1</strong></p>     <ul>      <li>下面的例子中，NestedClassV2中outer调用了UIUtils.enableV2Compatibility，且每一层都是UIUtils.makeV1Observed的返回值，所以outer在V2中有了深度观察的能力。</li>      <li>V1中仅能观察第一层的变化，所以需要多层自定义组件，且每层都配合使用@ObjectLink来接收，从而实现深度观察能力。</li>     </ul>     <div _ngcontent-adi-c106="" class="highlight-div"><div _ngcontent-adi-c106="" class="highlight-div-header"><div _ngcontent-adi-c106="" class="highlight-div-header-left"><div _ngcontent-adi-c106="" class="handle-button expand-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-adi-c106="" class="highlight-div-header-right"><div _ngcontent-adi-c106="" class="handle-button ai-button"></div><div _ngcontent-adi-c106="" class="handle-button line-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-adi-c106="" class="handle-button theme-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-adi-c106="" class="handle-button copy-button"><div _ngcontent-adi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-adi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayItem</span> {</li><li>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {</li><li>  <span class="hljs-attr">innerValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'inner'</span>;</li><li>  <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ArrayItem</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;ArrayItem&gt;</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = arr;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">outerValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'out'</span>;</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">inner: Inner</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span> = inner;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NestedClassV2</span> {</li><li>  <span class="hljs-comment">// 需保证每一层都是V1的状态变量</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">outer</span>: <span class="hljs-title class_">Outer</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">enableV2Compatibility</span>(</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>(</li><li>      <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([</li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">1</span>)),</li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">2</span>))</li><li>      ])))</li><li>    )));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Local outer.outerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.outerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可观察第一层的变化</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">outerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Local outer.inner.innerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.outer.inner.innerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可观察第二层的变化</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">innerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 将inner传递给@ObjectLink可观察inner属性的变化</span></li><li>      <span class="hljs-title class_">NestedClassV1ObjectLink</span>({ <span class="hljs-attr">inner</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NestedClassV1ObjectLink</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@ObjectLink inner.innerValue can update <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.inner.innerValue}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可以触发刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">innerValue</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">NestedClassV1ObjectLinkArray</span>({ <span class="hljs-attr">arr</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">arr</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NestedClassV1ObjectLinkArray</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ArrayItem</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: ArrayItem</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">NestedClassV1ObjectLinkArrayItem</span>({ <span class="hljs-attr">item</span>: item })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: ArrayItem, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">return</span> item.<span class="hljs-property">value</span>.<span class="hljs-title function_">toString</span>() + index.<span class="hljs-title function_">toString</span>();</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@ObjectLink push'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayItem</span>(<span class="hljs-number">20</span>)));</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'@ObjectLink change the last Item'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 在NestedClassV1ObjectLinkArrayItem中可以观察最后一个数组项的属性变化</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">value</span>++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NestedClassV1ObjectLinkArrayItem</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">item</span>: <span class="hljs-title class_">ArrayItem</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@ObjectLink outer.inner.arr item: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item.value}</span>`</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>