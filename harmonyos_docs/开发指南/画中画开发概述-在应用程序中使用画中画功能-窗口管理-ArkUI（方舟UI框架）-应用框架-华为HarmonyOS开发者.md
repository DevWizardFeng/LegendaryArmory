<h1 _ngcontent-dey-c119="" class="doc-title ng-star-inserted" title="画中画开发概述"> 画中画开发概述 </h1>

<div _ngcontent-dey-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section759644818458">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section759644818458" tips="复制节点链接"></i></h2><p>应用在视频播放、视频会议、视频通话等场景下，可以使用画中画能力将视频内容以小窗（画中画）模式呈现。切换为小窗（画中画）模式后，用户可以进行其他界面操作，提升使用体验。</p> <p>画中画的常见使用场景有以下几种：</p> <ul><li>视频播放。</li><li>视频通话。</li><li>视频会议。</li><li>直播。</li></ul> <p>系统提供以下三种画中画功能的开发方式：</p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pipwindow-xcomponent">使用XComponent实现画中画功能开发</a>：适用于应用通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation" target="_blank">Navigation</a>管理页面或Ability单页面情况下使用画中画的场景，这种实现方式无需应用管理页面。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pipwindow-typenode">使用typeNode实现画中画功能开发</a>：适用于所有场景，这种实现方式灵活性高，需要应用自行管理页面，推荐通过该方式使用画中画功能。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pipwindow-native">使用NDK接口实现画中画功能开发</a>：适用于依赖NDK接口开发的应用，需要应用自行管理页面。</li></ul> </div> <div class="tiledSection"><h2 id="section87011220102311">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section87011220102311" tips="复制节点链接"></i></h2><ul><li>基于安全考虑，应用处于后台时不允许通过startPiP启动画中画。针对应用返回后台时需要启动画中画的场景，建议使用setAutoStartEnabled(true)实现自动启动。</li></ul> </div> <div class="tiledSection"><h2 id="section9102639115012">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section9102639115012" tips="复制节点链接"></i></h2><p>以下是画中画功能的常用ArkTS接口，更多接口及使用参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow" target="_blank">@ohos.PiPWindow (画中画窗口)</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="53.26%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="46.739999999999995%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="53.26%"><p>isPiPEnabled(): boolean</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>判断当前系统是否开启画中画功能。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>create(config: PiPConfiguration): Promise&lt;PiPController&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>创建画中画控制器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>create(config: PiPConfiguration, contentNode: typeNode.XComponent): Promise&lt;PiPController&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>使用typeNode创建画中画控制器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>startPiP(): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>启动画中画。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>stopPiP(): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>停止画中画。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>setAutoStartEnabled(enable: boolean): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>设置是否需要在应用退后台时自动启动画中画，true表示需要自动启动，false表示不需要自动启动。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>updateContentSize(width: number, height: number): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>当媒体源切换时，向画中画控制器更新媒体源尺寸信息。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>on(type: 'stateChange', callback: (state: PiPState, reason: string) =&gt; void): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>开启画中画生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>off(type: 'stateChange'): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>关闭画中画生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>on(type: 'controlPanelActionEvent', callback: ControlPanelActionEventCallback): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>开启画中画控制面板控件动作事件的监听。推荐使用on('controlEvent')来开启画中画控制面板控件动作事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>off(type: 'controlPanelActionEvent'): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>关闭画中画控制面板控件动作事件的监听。推荐使用off('controlEvent')来关闭画中画控制面板控件动作事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>updatePiPControlStatus(controlType: PiPControlType, status: PiPControlStatus): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>更新画中画控制面板控件状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>setPiPControlEnabled(controlType: PiPControlType, enabled: boolean): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>设置控制面板控件使能状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>on(type: 'controlEvent', callback: CallBack&lt;ControlEventParam&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>开启画中画控制面板控件动作事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.26%"><p>off(type: 'controlEvent', callback?: CallBack&lt;ControlEventParam&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="46.739999999999995%"><p>关闭画中画控制面板控件动作事件的监听。</p> </td> </tr>  </tbody></table></div> </div> <p>以下是画中画功能的常用NDK接口，更多接口及使用参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-window-pip-h" target="_blank">oh_window_pip.h</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.5.1.3.1.1" valign="top" width="53.39%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.3.1.2" valign="top" width="46.61%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_CreatePipConfig(PictureInPicture_PipConfig* pipConfig)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>创建画中画参数配置器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_DestroyPipConfig(PictureInPicture_PipConfig* pipConfig)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>销毁画中画参数配置器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_CreatePip(PictureInPicture_PipConfig pipConfig, uint32_t* controllerId)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>创建画中画控制器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_DeletePip(uint32_t controllerId)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>删除画中画控制器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_StartPip(uint32_t controllerId)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>启动画中画。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_StopPip(uint32_t controllerId)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>停止画中画。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UpdatePipContentSize(uint32_t controllerId, uint32_t width, uint32_t height)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>当媒体源切换时，向画中画控制器更新媒体源尺寸信息。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UpdatePipControlStatus(uint32_t controllerId, PictureInPicture_PipControlType controlType, PictureInPicture_PipControlStatus status)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>更新画中画控制面板控件状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_SetPipControlEnabled(uint32_t controllerId, PictureInPicture_PipControlType controlType, bool enabled)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>设置画中画控制面板控件使能状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_RegisterStartPipCallback(uint32_t controllerId, WebPipStartPipCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>开启画中画surface创建完成的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UnregisterStartPipCallback(uint32_t controllerId, WebPipStartPipCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>关闭画中画surface创建完成的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_RegisterLifecycleListener(uint32_t controllerId, WebPipLifeCycleCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>开启画中画生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UnregisterLifecycleListener(uint32_t controllerId, WebPipLifeCycleCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>关闭画中画生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_RegisterControlEventListener(uint32_t controllerId, WebPipControlEventCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>开启画中画控制面板控件动作事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UnregisterControlEventListener(uint32_t controllerId, WebPipControlEventCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>关闭画中画控制面板控件动作事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_RegisterResizeListener(uint32_t controllerId, WebPipResizeCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>开启画中画窗口尺寸变化事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="53.39%"><p>int32_t OH_PictureInPicture_UnregisterResizeListener(uint32_t controllerId, WebPipResizeCallback callback)</p> </td> <td class="cellrowborder" valign="top" width="46.61%"><p>关闭画中画窗口尺寸变化事件的监听。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section13787164103315">交互方式<i class="anchor-icon anchor-icon-link" anchorid="section13787164103315" tips="复制节点链接"></i></h2><p>画中画窗口提供以下交互方式：</p> </div> <ul><li>单击画中画窗口：如果画中画控制层未显示，则显示画中画控制层，3秒后自动隐藏控制层；如果当前控制层已显示，则隐藏画中画控制层。</li><li>双击画中画窗口：放大或缩小画中画窗口。</li><li>拖动画中画窗口：可以将画中画窗口拖动到屏幕任意位置。如果将画中画窗口拖动到屏幕左右边缘，画中画窗口会自动隐藏；隐藏后在屏幕边缘显示画中画隐藏图标，点击该图标后画中画窗口恢复显示。</li><li>拖拽缩放画中画窗口：可以拖拽画中画窗口四边以及四个对角缩放画中画窗口大小，窗口尺寸不能超过默认最大档与最小档，当拖拽过程中画中画窗口超过窗口尺寸限制以及超出屏幕尺寸，会触发回弹效果。</li><li>拖动删除画中画窗口：可以将画中画窗口拖动到底部垃圾桶热区，删除画中画窗口。对于申请长时任务的应用，需要主动监听画中画生命周期STOPPED事件，关闭任务或进程。</li></ul> <div class="p">画中画控制层提供以下功能：<ul><li>窗口控制：包括“关闭”和“恢复全屏窗口”功能。点按“关闭”按钮后，画中画窗口关闭；点按“恢复全屏窗口”按钮后，将从画中画窗口恢复到应用原始界面。</li><li>内容控制：内容控制区根据不同场景呈现不同，应用可根据实际场景需要进行设置，各场景控制层示意图如下所示。</li></ul> </div> <div class="fignone"><span class="figcap"><b>图1 </b>不同场景下画中画控制层的不同呈现</span><br><span><img height="275.479575" originheight="345" originwidth="812" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.20483215696842797340882326241678:50001231000000:2800:E3D21520B313DB6AFF6512E19F0AF613CAD4E24F1E95C19C34CBBCC4F9A9720E.png" title="点击放大" width="648.375"></span></div> <div class="tiledSection"><h2 id="section13249112113315">配置画中画控制层可选控件<i class="anchor-icon anchor-icon-link" anchorid="section13249112113315" tips="复制节点链接"></i></h2><p>在使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#pipwindowcreate" target="_blank">create</a>接口创建画中画时，可通过在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#pipconfiguration" target="_blank">PiPConfiguration</a>中新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#pipcontrolgroup12" target="_blank">PiPControlGroup</a>类型的数组配置当前画中画控制层控件。</p> <ul><li>视频播放场景可通过配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#videoplaycontrolgroup12" target="_blank">VideoPlayControlGroup</a>来显示可选的控制层控件。<div class="fignone"><span class="figcap"><b>图2 </b>视频播放场景配置控制层可选控件</span><br><span><img height="160.05486000000002" originheight="213" originwidth="892" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.49641013041870014277261849542704:50001231000000:2800:D32A7571A5F59A5DA838287D6525C8D50CECE05AC9CCBC6CA917199EBB84461C.png" title="点击放大" width="670.32"></span></div> </li><li>视频通话场景可通过配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#videocallcontrolgroup12" target="_blank">VideoCallControlGroup</a>来显示可选的控制层控件。示意图如下所示。<div class="fignone"><span class="figcap"><b>图3 </b>视频通话场景配置控制层可选控件</span><br><span><img height="303.594179" originheight="409" originwidth="1110" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.45924620470185420886783266147639:50001231000000:2800:E936E22E09A5EDFE55A68C1C640F0D667D8922A3BF3897EA5DBD8CA67E6B545E.png" title="点击放大" width="823.948965"></span></div> <p>若不配置，视频通话模版默认不存在任何按钮，点击画中画窗口即可启动还原（见下图左，未配置任何控件的操作示意图）。下图右为配置控件的操作示意图。</p> <p><span><img height="468.82500000000005" originheight="746" originwidth="356" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.22424289404203557719096617789978:50001231000000:2800:792953F52B9BC1EAD2A6E808C559F96624730A22DFD9A3DBFAA27B01719C92E9.gif" title="点击放大" width="223.729275"></span>                     <span><img height="467.82750000000004" originheight="746" originwidth="356" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.92943761663256910637122916865545:50001231000000:2800:056276ADDD86F63E8D7D59E9B2F7FE9BF9522CE28196388BAF9A8635CF869C8B.gif" title="点击放大" width="223.250475"></span></p> </li><li>视频会议场景可通过配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#videomeetingcontrolgroup12" target="_blank">VideoMeetingControlGroup</a>来显示可选的控制层控件。示意图如下所示。若不配置，视频会议模版默认不存在任何按钮，点击画中画窗口即可启动还原（与视频通话模版操作示意图一致）。<div class="fignone"><span class="figcap"><b>图4 </b>视频会议场景配置控制层可选控件</span></div> <p><span><img height="305.43250500000005" originheight="409" originwidth="1110" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114757.47273869397068000307362434205682:50001231000000:2800:DFADC568F0942C1601889B28184EE832B00DC20D1832CA4292843CAD8D362753.png" title="点击放大" width="828.936465"></span></p> </li><li>直播场景可通过配置<a href="https://gitee.com/openharmony/docs/blob/6ef3072be96ddb9e029f1ee7f303c27f4747b94a/zh-cn/application-dev/reference/apis-arkui/js-apis-pipWindow.md#videolivecontrolgroup12" target="_blank">VideoLiveControlGroup</a>来显示可选的控制层控件。示意图如下所示。<div class="fignone"><span class="figcap"><b>图5 </b>直播场景配置控制层可选控件</span><br><span><img height="312.589501" originheight="404" originwidth="856" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114757.72429337075044932992723147926697:50001231000000:2800:9A360327E10CDF070C1486CB957AED55C173FE45A2AF127B28C25D4B7C527D3A.png" title="点击放大" width="662.353965"></span></div> </li></ul> </div> <div class="tiledSection"><h2 id="section6521411254">在画中画内容上方展示自定义UI<i class="anchor-icon anchor-icon-link" anchorid="section6521411254" tips="复制节点链接"></i></h2><p>在使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#pipwindowcreate" target="_blank">create</a>接口创建画中画时，可通过在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pipwindow#pipconfiguration" target="_blank">PiPConfiguration</a>中传入customUIController来显示自定义UI。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>自定义显示的UI无法响应交互事件。</p> </div></div></div> <div class="p"><div class="fignone"><span class="figcap"><b>图6 </b>在画中画内容上方显示自定义UI</span><br><span><img originheight="128" originwidth="203" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114757.27663139912233852912105683600534:50001231000000:2800:26E6DDE078B46C794E0E488D18DD94E09D90B1741138915887C079BA5702B683.png" class="notEnlarge" width="203" height="128"></span></div> </div> </div> <div class="tiledSection"><h2 id="section1122181382817">更新画中画控制面板控件状态<i class="anchor-icon anchor-icon-link" anchorid="section1122181382817" tips="复制节点链接"></i></h2><p>应用可以使用updatePiPControlStatus接口更新控制面板控件的功能状态，如将视频播放模板下VIDEO_PLAY_PAUSE控件的播放状态更改为暂停状态，见下图。</p> <p>应用也可以使用setPiPControlEnabled接口设置控制面板控件的使能状态，如将视频播放模板下VIDEO_PREVIOUS控件从可点击状态变为不可点击状态，见下图。</p> <div class="fignone"><span class="figcap"><b>图7 </b>更新控件功能状态</span><br><span><img height="300.80809500000004" originheight="692" originwidth="592" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114757.78221008246224197883257407063640:50001231000000:2800:130891507773BCAD885031AF8E891D4E886494B4E3E35713F3FA89F80FBDF497.gif" title="点击放大" width="257.355"></span></div> <div class="fignone"><span class="figcap"><b>图8 </b>设置控件使能状态</span><br><span><img height="297.0555" originheight="684" originwidth="592" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114757.12224063825565593077311721577283:50001231000000:2800:2337520D079DCBEF446E90ED9C3BFD98EDE788035910094A7A7EC7B0871ED73F.gif" title="点击放大" width="257.355"></span></div> </div> </div> <div></div></div>