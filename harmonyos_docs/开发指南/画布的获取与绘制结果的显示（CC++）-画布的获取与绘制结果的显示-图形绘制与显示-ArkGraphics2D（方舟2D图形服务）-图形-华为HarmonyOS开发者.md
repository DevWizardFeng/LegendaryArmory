<h1 _ngcontent-cxl-c119="" class="doc-title ng-star-inserted" title="画布的获取与绘制结果的显示（C/C++）"> 画布的获取与绘制结果的显示（C/C++） </h1>

<div _ngcontent-cxl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>Canvas即画布，提供绘制基本图形的能力，用于在屏幕上绘制图形和处理图形。开发者可以通过Canvas实现自定义的绘图效果，增强应用的用户体验。</p>     <p>Canvas是图形绘制的核心，本章中提到的所有绘制操作（包括基本图形的绘制、文字的绘制、图片的绘制、图形变换等）都是基于Canvas的。</p>     <p>目前C/C++有两种获取Canvas的方式：获取可直接上屏显示的Canvas、获取离屏的Canvas，前者在调用绘制接口之后无需进行额外的操作即可完成绘制结果的上屏显示，而后者需要依靠已有的显示手段来显示绘制结果。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>创建Canvas常用接口如下表所示，详细的使用和参数说明请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-canvas-h" target="_blank">drawing_canvas.h</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">接口</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_Canvas* OH_Drawing_CanvasCreate (void)</td>         <td class="cellrowborder" valign="top" width="50%">用于创建一个画布对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_Drawing_CanvasBind (OH_Drawing_Canvas*, OH_Drawing_Bitmap*)</td>         <td class="cellrowborder" valign="top" width="50%">用于将一个位图对象绑定到画布中，使得画布绘制的内容输出到位图中。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_Canvas* OH_Drawing_SurfaceGetCanvas (OH_Drawing_Surface *)</td>         <td class="cellrowborder" valign="top" width="50%">通过surface对象获取画布对象。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="获取可直接显示的canvas画布">获取可直接显示的Canvas画布<i class="anchor-icon anchor-icon-link" anchorid="获取可直接显示的canvas画布" tips="复制节点链接"></i></h2>          <p>通过XComponent获取可直接显示的Canvas画布。</p>     <ol>      <li>       <p>添加链接库。</p>       <p>在Native工程的src/main/cpp/CMakeLists.txt，添加如下链接库：</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_drawing.so)</li></ol></pre></div></div></li>      <li>       <p>导入依赖的相关头文件。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li></ol></pre></div></div>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_surface.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>从XComponent对应的NativeWindow中获取BufferHandle对象。NativeWindow相关的API请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativewindow" target="_blank">_native_window</a>。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint64_t</span> width, height;</li><li>OHNativeWindow *nativeWindow;    <span class="hljs-comment">// NativeWindow及其宽高需要从XComponent获取</span></li><li><span class="hljs-type">int32_t</span> usage = NATIVEBUFFER_USAGE_CPU_READ | NATIVEBUFFER_USAGE_CPU_WRITE | NATIVEBUFFER_USAGE_MEM_DMA;</li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_NativeWindow_NativeWindowHandleOpt</span>(nativeWindow, SET_USAGE, usage);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">NativeWindowBuffer</span> *buffer = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">int</span> fenceFd = <span class="hljs-number">0</span>;</li><li>ret = <span class="hljs-built_in">OH_NativeWindow_NativeWindowRequestBuffer</span>(nativeWindow, &amp;buffer, &amp;fenceFd);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>
</li><li>BufferHandle* bufferHandle = <span class="hljs-built_in">OH_NativeWindow_GetBufferHandleFromNative</span>(buffer);</li></ol></pre></div></div></li>      <li>       <p>从BufferHandle中获取对应的内存地址。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">uint32_t</span>* <span class="hljs-variable">mappedAddr</span> = <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">uint32_t</span> *&gt;(<span class="hljs-title function_">mmap</span>(<span class="hljs-variable">bufferHandle</span>-&gt;<span class="hljs-title class_">virAddr</span>, <span class="hljs-variable">bufferHandle</span>-&gt;<span class="hljs-title class_">size</span>, <span class="hljs-variable">PROT_READ</span> | <span class="hljs-variable">PROT_WRITE</span>, <span class="hljs-variable">MAP_SHARED</span>, <span class="hljs-variable">bufferHandle</span>-&gt;<span class="hljs-title class_">fd</span>, <span class="hljs-number">0</span>));</li></ol></pre></div></div></li>      <li>       <p>创建窗口画布。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建bitmap的方式一：使用OH_Drawing_BitmapCreateFromPixels创建OH_Drawing_Bitmap*类型的cScreenBitmap_</span></li><li><span class="hljs-comment">// OH_Drawing_Image_Info screenImageInfo = {static_cast&lt;int32_t&gt;(width), static_cast&lt;int32_t&gt;(height), COLOR_FORMAT_RGBA_8888, ALPHA_FORMAT_OPAQUE};</span></li><li><span class="hljs-comment">// OH_Drawing_Bitmap* cScreenBitmap_ = OH_Drawing_BitmapCreateFromPixels(&amp;screenImageInfo, mappedAddr, bufferHandle-&gt;stride);</span></li><li><span class="hljs-comment">// 创建bitmap的方式二：使用OH_Drawing_BitmapCreate创建OH_Drawing_Bitmap*类型的cScreenBitmap_</span></li><li><span class="hljs-variable">cScreenBitmap_</span> = <span class="hljs-title function_">OH_Drawing_BitmapCreate</span>();</li><li><span class="hljs-comment">// 定义bitmap的像素格式</span></li><li><span class="hljs-variable">OH_Drawing_BitmapFormat</span> <span class="hljs-variable">cFormat</span>{<span class="hljs-variable">COLOR_FORMAT_RGBA_8888</span>, <span class="hljs-variable">ALPHA_FORMAT_OPAQUE</span>};</li><li><span class="hljs-comment">// 构造对应格式的bitmap</span></li><li><span class="hljs-variable">uint32_t</span> <span class="hljs-variable">width</span> = <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">uint32_t</span>&gt;(<span class="hljs-variable">bufferHandle_</span>-&gt;<span class="hljs-title class_">stride</span> / <span class="hljs-number">4</span>);</li><li><span class="hljs-title function_">OH_Drawing_BitmapBuild</span>(<span class="hljs-variable">cScreenBitmap_</span>, <span class="hljs-variable">width</span>, <span class="hljs-variable">height_</span>, &amp;<span class="hljs-title class_">cFormat</span>);</li><li><span class="hljs-variable">OH_Drawing_Canvas</span>* <span class="hljs-variable">screenCanvas</span> = <span class="hljs-title function_">OH_Drawing_CanvasCreate</span>();</li><li><span class="hljs-title function_">OH_Drawing_CanvasBind</span>(<span class="hljs-variable">screenCanvas</span>, <span class="hljs-variable">cScreenBitmap_</span>);</li></ol></pre></div></div></li>      <li>       <p>利用上一步中得到的Canvas进行自定义的绘制操作，即本章下文中的内容。</p></li>      <li>       <p>利用XComponent完成显示。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>Region region {nullptr, <span class="hljs-number">0</span>};</li><li><span class="hljs-built_in">OH_NativeWindow_NativeWindowFlushBuffer</span>(nativeWindow, buffer, fenceFd, region);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="离屏canvas画布的获取与显示">离屏Canvas画布的获取与显示<i class="anchor-icon anchor-icon-link" anchorid="离屏canvas画布的获取与显示" tips="复制节点链接"></i></h2>          <p>目前有两种创建离屏Canvas的方式：创建CPU后端Canvas、创建GPU后端Canvas，这两种Canvas都需要依靠XComponent来完成绘制结果的上屏显示。由于历史原因，早期的Canvas都是CPU后端Canvas。目前已经支持GPU后端Canvas，GPU的并行计算能力更强，更适合图形绘制。但GPU后端Canvas对部分场景的支持还有欠缺，比如复杂的路径，对于简短文字的绘制性能也比不上CPU后端Canvas。</p>    </div>    <div class="tiledSection">     <h3 id="cpu后端canvas的创建与显示" class="firsth2">CPU后端Canvas的创建与显示<i class="anchor-icon anchor-icon-link" anchorid="cpu后端canvas的创建与显示" tips="复制节点链接"></i></h3>          <p>目前C/C++接口的绘制需要依赖于NativeWindow，CPU后端Canvas需要先离屏绘制，生成位图或像素图（从API Version 20开始支持），再借助XComponent上屏。</p>     <p>方式一：通过绑定位图（Bitmap）的方式创建Canvas。</p>     <ol>      <li>       <p>导入依赖的相关头文件。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_bitmap.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>创建基于CPU的Canvas。需要通过OH_Drawing_BitmapCreate()接口创建一个位图对象（具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pixelmap-drawing-c">图片绘制</a>），并通过OH_Drawing_CanvasBind()接口将位图绑定到Canvas中，从而使得Canvas绘制的内容可以输出到位图中。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建一个位图对象</span></li><li>OH_Drawing_Bitmap* bitmap = <span class="hljs-built_in">OH_Drawing_BitmapCreate</span>();</li><li>OH_Drawing_BitmapFormat cFormat{COLOR_FORMAT_RGBA_8888, ALPHA_FORMAT_PREMUL};</li><li><span class="hljs-comment">// 设置位图长宽（按需设置）</span></li><li><span class="hljs-type">uint32_t</span> width = <span class="hljs-number">800</span>;</li><li><span class="hljs-type">uint32_t</span> height = <span class="hljs-number">800</span>;</li><li><span class="hljs-comment">// 初始化位图</span></li><li><span class="hljs-built_in">OH_Drawing_BitmapBuild</span>(bitmap, width, height, &amp;cFormat);</li><li><span class="hljs-comment">// 创建一个Canvas对象</span></li><li>OH_Drawing_Canvas* bitmapCanvas = <span class="hljs-built_in">OH_Drawing_CanvasCreate</span>();</li><li><span class="hljs-comment">// 将Canvas与bitmap绑定，Canvas绘制的内容会输出到绑定的bitmap内存中</span></li><li><span class="hljs-built_in">OH_Drawing_CanvasBind</span>(bitmapCanvas, bitmap);</li></ol></pre></div></div>       <p>如果需要将背景设置为白色，需要执行以下步骤：</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_Drawing_CanvasClear</span>(bitmapCanvas, OH_Drawing_ColorSetArgb(<span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF));</li></ol></pre></div></div></li>      <li>       <p>将上一步中创建的位图绘制到<a href="/consumer/cn/doc/harmonyos-guides/canvas-get-result-draw-c#获取可直接显示的canvas画布">窗口画布</a>上。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_Drawing_CanvasDrawBitmap</span>(screenCanvas, bitmap, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li></ol></pre></div></div></li>     </ol>     <p>方式二：通过像素图（PixelMap）创建Canvas。从API Version 20开始，支持使用此种方式创建Canvas。</p>     <p>像素图是系统中用来表示图片的统一的数据结构，相比于drawing模块中提供的位图，像素图具备通用性，并且能够更好地发挥系统的能力。</p>     <ol>      <li>       <p>添加链接库。</p>       <p>在Native工程的src/main/cpp/CMakeLists.txt，添加如下链接库：</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libhilog_ndk.z.so libpixelmap.so)</li></ol></pre></div></div></li>      <li>       <p>导入依赖的相关头文件。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/image_framework/image/pixelmap_native.h&gt;</span></span></li></ol></pre></div></div>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_pixel_map.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>需要通过OH_Drawing_PixelMapGetFromOhPixelMapNative()接口创建一个像素图对象（具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pixelmap-drawing-c">图片绘制</a>），并通过OH_Drawing_CanvasCreateWithPixelMap()接口借助像素图对象创建Canvas。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 图片宽高</span></li><li><span class="hljs-type">uint32_t</span> width = <span class="hljs-number">600</span>;</li><li><span class="hljs-type">uint32_t</span> height = <span class="hljs-number">400</span>;</li><li><span class="hljs-comment">// 设置位图格式（长、宽、颜色类型、透明度类型）</span></li><li>OH_Pixelmap_InitializationOptions *createOps = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_Create</span>(&amp;createOps);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetWidth</span>(createOps, width);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetHeight</span>(createOps, height);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetPixelFormat</span>(createOps, PIXEL_FORMAT_RGBA_8888);</li><li><span class="hljs-built_in">OH_PixelmapInitializationOptions_SetAlphaType</span>(createOps, PIXELMAP_ALPHA_TYPE_UNKNOWN);</li><li><span class="hljs-comment">// 字节长度，RGBA_8888每个像素占4字节</span></li><li><span class="hljs-type">size_t</span> bufferSize = width * height * <span class="hljs-number">4</span>;</li><li><span class="hljs-type">void</span> *buffer = <span class="hljs-built_in">malloc</span>(bufferSize);</li><li><span class="hljs-comment">// 创建OH_PixelmapNative对象</span></li><li>OH_PixelmapNative *pixelMapNative = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_PixelmapNative_CreatePixelmap</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span> *&gt;(buffer), bufferSize, createOps, &amp;pixelMapNative);</li><li><span class="hljs-comment">// 创建Pixelmap对象</span></li><li>OH_Drawing_PixelMap *pixelMap = <span class="hljs-built_in">OH_Drawing_PixelMapGetFromOhPixelMapNative</span>(pixelMapNative);</li><li><span class="hljs-comment">// 创建Canvas对象</span></li><li>OH_Drawing_Canvas* pixelmapCanvas = <span class="hljs-built_in">OH_Drawing_CanvasCreateWithPixelMap</span>(pixelMap);</li></ol></pre></div></div>       <p>如果需要将背景设置为白色，需要执行以下步骤：</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_Drawing_CanvasClear</span>(pixelmapCanvas, OH_Drawing_ColorSetArgb(<span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF));</li></ol></pre></div></div></li>      <li>       <p>将上一步中创建的像素图绘制到<a href="/consumer/cn/doc/harmonyos-guides/canvas-get-result-draw-c#获取可直接显示的canvas画布">窗口画布</a>上。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// PixelMap中像素的截取区域</span></li><li><span class="hljs-variable">OH_Drawing_Rect</span> *<span class="hljs-variable">src</span> = <span class="hljs-title function_">OH_Drawing_RectCreate</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>);</li><li><span class="hljs-comment">// 画布中显示的区域</span></li><li><span class="hljs-variable">OH_Drawing_Rect</span> *<span class="hljs-variable">dst</span> = <span class="hljs-title function_">OH_Drawing_RectCreate</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>);</li><li><span class="hljs-comment">// 采样选项对象</span></li><li><span class="hljs-variable">OH_Drawing_SamplingOptions</span>* <span class="hljs-variable">samplingOptions</span> = <span class="hljs-title function_">OH_Drawing_SamplingOptionsCreate</span>(</li><li>    <span class="hljs-variable">OH_Drawing_FilterMode</span>::<span class="hljs-title class_">FILTER_MODE_LINEAR</span>, <span class="hljs-variable">OH_Drawing_MipmapMode</span>::<span class="hljs-title class_">MIPMAP_MODE_LINEAR</span>);</li><li><span class="hljs-comment">// 绘制PixelMap</span></li><li><span class="hljs-title function_">OH_Drawing_CanvasDrawPixelMapRect</span>(<span class="hljs-variable">screenCanvas</span>, <span class="hljs-variable">pixelMap</span>, <span class="hljs-variable">src</span>, <span class="hljs-variable">dst</span>, <span class="hljs-variable">samplingOptions</span>);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="gpu后端canvas的创建与显示">GPU后端Canvas的创建与显示<i class="anchor-icon anchor-icon-link" anchorid="gpu后端canvas的创建与显示" tips="复制节点链接"></i></h3>          <p>GPU后端Canvas指画布是基于GPU进行绘制的，GPU的并行计算能力优于CPU，适用于绘制图片或区域相对大的场景，但目前GPU后端的Canvas针对绘制复杂路径的能力还有欠缺。同CPU后端Canvas，目前C/C++接口的绘制需要依赖于XComponent，GPU后端Canvas需要先离屏绘制再借助XComponent上屏。</p>     <ol>      <li>       <p>当前创建GPU后端的Canvas依赖EGL的能力，需要在CMakeList.txt中添加EGL的动态依赖库。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>libEGL.so</li></ol></pre></div></div></li>      <li>       <p>导入依赖的头文件。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;EGL/egl.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;EGL/eglext.h&gt;</span></span></li></ol></pre></div></div>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_gpu_context.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_surface.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>初始化EGL上下文。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化上下文相关参数</span></li><li><span class="hljs-type">EGLDisplay</span> <span class="hljs-variable">mEGLDisplay</span> <span class="hljs-operator">=</span> EGL_NO_DISPLAY;</li><li><span class="hljs-type">EGLConfig</span> <span class="hljs-variable">mEGLConfig</span> <span class="hljs-operator">=</span> nullptr;</li><li><span class="hljs-type">EGLContext</span> <span class="hljs-variable">mEGLContext</span> <span class="hljs-operator">=</span> EGL_NO_CONTEXT;</li><li><span class="hljs-type">EGLSurface</span> <span class="hljs-variable">mEGLSurface</span> <span class="hljs-operator">=</span> nullptr;</li></ol></pre></div></div>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化上下文相关配置</span></li><li><span class="hljs-function">EGLConfig <span class="hljs-title">getConfig</span><span class="hljs-params">(<span class="hljs-type">int</span> version, EGLDisplay eglDisplay)</span></span></li><li><span class="hljs-function"></span>{</li><li>   <span class="hljs-type">int</span> attribList[] = {EGL_SURFACE_TYPE,</li><li>                        EGL_WINDOW_BIT,</li><li>                        EGL_RED_SIZE,</li><li>                        <span class="hljs-number">8</span>,</li><li>                        EGL_GREEN_SIZE,</li><li>                        <span class="hljs-number">8</span>,</li><li>                        EGL_BLUE_SIZE,</li><li>                        <span class="hljs-number">8</span>,</li><li>                        EGL_ALPHA_SIZE,</li><li>                        <span class="hljs-number">8</span>,</li><li>                        EGL_RENDERABLE_TYPE,</li><li>                        EGL_OPENGL_ES2_BIT,</li><li>                        EGL_NONE};</li><li>   EGLConfig configs = <span class="hljs-literal">NULL</span>;</li><li>   <span class="hljs-type">int</span> configsNum;</li><li>
</li><li>   <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">eglChooseConfig</span>(eglDisplay, attribList, &amp;configs, <span class="hljs-number">1</span>, &amp;configsNum)) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</li><li>   }</li><li>
</li><li>   <span class="hljs-keyword">return</span> configs;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 在需要初始化EGL上下文处调用InitializeEglContext</span></li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">InitializeEglContext</span><span class="hljs-params">(EGLDisplay mEGLDisplay, EGLConfig mEGLConfig,</span></span></li><li><span class="hljs-function">   EGLContext mEGLContext, EGLSurface mEGLSurface)</span></li><li><span class="hljs-function"></span>{</li><li>   mEGLDisplay = <span class="hljs-built_in">eglGetDisplay</span>(EGL_DEFAULT_DISPLAY);</li><li>   <span class="hljs-keyword">if</span> (mEGLDisplay == EGL_NO_DISPLAY) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</li><li>   }</li><li>
</li><li>   EGLint eglMajVers;</li><li>   EGLint eglMinVers;</li><li>   <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">eglInitialize</span>(mEGLDisplay, &amp;eglMajVers, &amp;eglMinVers)) {</li><li>      mEGLDisplay = EGL_NO_DISPLAY;</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</li><li>   }</li><li>
</li><li>   <span class="hljs-type">int</span> version = <span class="hljs-number">3</span>;</li><li>   mEGLConfig = <span class="hljs-built_in">getConfig</span>(version, mEGLDisplay);</li><li>   <span class="hljs-keyword">if</span> (mEGLConfig == <span class="hljs-literal">nullptr</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</li><li>   }</li><li>
</li><li>   <span class="hljs-type">int</span> attribList[] = {EGL_CONTEXT_CLIENT_VERSION, <span class="hljs-number">2</span>, EGL_NONE};</li><li>
</li><li>   mEGLContext = <span class="hljs-built_in">eglCreateContext</span>(mEGLDisplay, mEGLConfig, EGL_NO_CONTEXT, attribList);</li><li>
</li><li>   EGLint attribs[] = {EGL_WIDTH, <span class="hljs-number">1</span>, EGL_HEIGHT, <span class="hljs-number">1</span>, EGL_NONE};</li><li>   mEGLSurface = <span class="hljs-built_in">eglCreatePbufferSurface</span>(mEGLDisplay, mEGLConfig, attribs);</li><li>   <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">eglMakeCurrent</span>(mEGLDisplay, mEGLSurface, mEGLSurface, mEGLContext)) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</li><li>   }</li><li>   </li><li>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>创建GPU后端Canvas。GPU后端Canvas需要借助Surface对象来获取，需先创建surface，surface的API请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-surface-h" target="_blank">drawing_surface.h</a>。通过OH_Drawing_GpuContextCreateFromGL接口创建绘图上下文，再将这个上下文作为参数创建surface，最后通过OH_Drawing_SurfaceGetCanvas接口从surface中获取到canvas。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置宽高（按需设定）</span></li><li><span class="hljs-type">int32_t</span> <span class="hljs-variable">cWidth</span> <span class="hljs-operator">=</span> <span class="hljs-number">800</span>;</li><li><span class="hljs-type">int32_t</span> <span class="hljs-variable">cHeight</span> <span class="hljs-operator">=</span> <span class="hljs-number">800</span>;</li><li><span class="hljs-comment">// 设置图像，包括宽度、高度、颜色格式和透明度格式</span></li><li><span class="hljs-type">OH_Drawing_Image_Info</span> <span class="hljs-variable">imageInfo</span> <span class="hljs-operator">=</span> {cWidth, cHeight, COLOR_FORMAT_RGBA_8888, ALPHA_FORMAT_PREMUL};</li><li><span class="hljs-comment">// GPU上下文的选项</span></li><li>OH_Drawing_GpuContextOptions options{<span class="hljs-literal">false</span>};</li><li><span class="hljs-comment">// 创建一个使用OpenGL（GL）作为其GPU后端的绘图上下文</span></li><li>OH_Drawing_GpuContext *gpuContext = OH_Drawing_GpuContextCreateFromGL(options);</li><li><span class="hljs-comment">// 创建surface对象</span></li><li>OH_Drawing_Surface *surface = OH_Drawing_SurfaceCreateFromGpuContext(gpuContext, <span class="hljs-literal">true</span>, imageInfo);</li><li><span class="hljs-comment">// 创建一个canvas对象</span></li><li>OH_Drawing_Canvas* gpuCanvas = OH_Drawing_SurfaceGetCanvas(surface);</li></ol></pre></div></div>       <p>如果需要将背景设置为白色，需要执行以下步骤：</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_Drawing_CanvasClear</span>(gpuCanvas, OH_Drawing_ColorSetArgb(<span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF, <span class="hljs-number">0</span>xFF));</li></ol></pre></div></div></li>      <li>       <p>将上一步中的绘制结果拷贝到<a href="/consumer/cn/doc/harmonyos-guides/canvas-get-result-draw-c#获取可直接显示的canvas画布">窗口画布</a>上。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span>* dstPixels = <span class="hljs-built_in">malloc</span>(cWidth * cHeight * <span class="hljs-number">4</span>); <span class="hljs-comment">// 4 for rgba</span></li><li><span class="hljs-built_in">OH_Drawing_CanvasReadPixels</span>(gpuCanvas, &amp;imageInfo, dstPixels, <span class="hljs-number">4</span> * cWidth, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li><li>OH_Drawing_Bitmap* bitmap = <span class="hljs-built_in">OH_Drawing_BitmapCreateFromPixels</span>(&amp;imageInfo, dstPixels, <span class="hljs-number">4</span> * cWidth);</li><li><span class="hljs-built_in">OH_Drawing_CanvasDrawBitmap</span>(screenCanvas, bitmap, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li></ol></pre></div></div></li>      <li>       <p>使用完之后需要将EGL上下文销毁。</p>       <div _ngcontent-cxl-c106="" class="highlight-div"><div _ngcontent-cxl-c106="" class="highlight-div-header"><div _ngcontent-cxl-c106="" class="highlight-div-header-left"><div _ngcontent-cxl-c106="" class="handle-button expand-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxl-c106="" class="highlight-div-header-right"><div _ngcontent-cxl-c106="" class="handle-button ai-button"></div><div _ngcontent-cxl-c106="" class="handle-button line-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxl-c106="" class="handle-button theme-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxl-c106="" class="handle-button copy-button"><div _ngcontent-cxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxl-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在需要销毁处调用DeInitializeEglContext销毁EGL上下文。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DeInitializeEglContext</span><span class="hljs-params">(EGLDisplay mEGLDisplay, EGLContext mEGLContext, EGLSurface mEGLSurface)</span></span></li><li><span class="hljs-function"></span>{</li><li>   <span class="hljs-comment">// 以下三个方法都有返回值判断是否销毁成功，必要时可进行调试。</span></li><li>   <span class="hljs-built_in">eglDestroySurface</span>(mEGLDisplay, mEGLSurface);</li><li>   <span class="hljs-built_in">eglDestroyContext</span>(mEGLDisplay, mEGLContext);</li><li>   <span class="hljs-built_in">eglTerminate</span>(mEGLDisplay);</li><li>
</li><li>   mEGLSurface = <span class="hljs-literal">NULL</span>;</li><li>   mEGLContext = <span class="hljs-literal">NULL</span>;</li><li>   mEGLDisplay = <span class="hljs-literal">NULL</span>;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/DocsSample_Graphics/tree/master/ArkGraphics2D/Drawing/NDKAPIDrawing" target="_blank">图形绘制（C/C++）</a></li>     </ul>    </div>   </div>   <div></div></div>