<h1 _ngcontent-ydj-c119="" class="doc-title ng-star-inserted" title="白盒性能测试框架使用指导"> 白盒性能测试框架使用指导 </h1>

<div _ngcontent-ydj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body602176126100314"><div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002473826534__p358021818115">白盒性能测试框架（PerfTest），提供了针对指定代码段运行时的白盒性能测试能力，用于度量指定应用进程的性能表现。框架通过多轮迭代执行机制和环境复位机制实现自动化测试，支持耗时、CPU使用率等基础数据和启动时延、滑动帧率等场景化性能数据的采集和度量。使用PerfTest接口的性能测试脚本需基于单元测试框架进行开发。</p> <p id="ZH-CN_TOPIC_0000002473826534__p1424545016100314">从API version 20开始，支持白盒性能测试能力。</p> </div> <div class="tiledSection"><h2 id="实现原理">实现原理<i class="anchor-icon anchor-icon-link" anchorid="实现原理" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002473826534__p1799459786100314">PerfTest功能设计图如下所示：</p> <p id="ZH-CN_TOPIC_0000002473826534__p327737061100314"><span><img originheight="422" originwidth="700" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251120201420.08235822268208420505628151000796:50001231000000:2800:3D056E236C2083D3E124E348E9869DFE0BDCA6349E4C233F36A0A353C750D920.png" width="700" height="422"></span></p> <p id="ZH-CN_TOPIC_0000002473826534__p1475704042100314">PerfTest对外提供ArkTS API，包括性能测试策略设置、性能测试执行、测试结果获取等能力。具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest" target="_blank">API文档</a>。</p> <p id="ZH-CN_TOPIC_0000002473826534__p379020868100314">跨语言通信层负责上层ArkTS接口与底层C++接口的转换，包括参数校验、JSON序列化对象处理和异常处理等。作为PerfTest的客户端，它提供启动入口和功能调用接口。该层由测试应用加载运行，通过IPC与服务端通信实现功能调用和生命周期管理。此外，该层还负责管理C++层对ArkTS回调函数的调用。</p> <p id="ZH-CN_TOPIC_0000002473826534__p1105763545100314">PerfTest服务端负责白盒性能测试框架的主要功能处理，包含以下两部分：</p> <ul id="ZH-CN_TOPIC_0000002473826534__ul1801173349100314"><li id="li546639407100314"><p id="ZH-CN_TOPIC_0000002473826534__p2089805482100314">框架运行通用能力：管理C++接口和错误码，包括接口调用、参数解析、异常处理等。PerfTest服务端以独立进程运行，通过IPC与客户端通信，监听客户端生命周期，实现进程保活和按需启停。</p> </li><li id="li372619403100314"><p id="ZH-CN_TOPIC_0000002473826534__p325014802100314">白盒性能测试能力：主要负责测试任务调度和性能数据采集工作。根据用户定义的测试策略，实现测试代码段运行、性能数据采集、数据处理和存储的自动化性能测试流程。当前支持采集的性能指标包括：耗时、CPU、内存、应用启动时延、页面切换时延、列表滑动帧率等。</p> </li></ul> </div> <div class="tiledSection"><h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002473826534__p997927962100314">使用PerfTest接口进行白盒性能测试流程如下图所示：</p> <p id="ZH-CN_TOPIC_0000002473826534__p1310059426100314"><span><img originheight="649" originwidth="1028" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251120201420.62351256972883955922534336185361:50001231000000:2800:DEF670D79F6274CD3B52F83850D40BEAC501BA9C42D416A64C3FBFA0338BE756.png" width="920" height="580.8171206225682"></span></p> <ol id="ZH-CN_TOPIC_0000002473826534__ol919330571100314"><li id="li1835309760100314"><p id="ZH-CN_TOPIC_0000002473826534__p679496957100314">定义性能测试策略，明确测试指标列表、被测代码段、环境复位代码段、被测应用包名、测试迭代次数、代码段单次执行超时时间等，后续白盒性能测试中将依照此策略执行测试。</p> </li><li id="li1183130238100314"><p id="ZH-CN_TOPIC_0000002473826534__p1495990074100314">创建测试任务，配置测试策略并准备测试环境。</p> </li><li id="li679648701100314"><p id="ZH-CN_TOPIC_0000002473826534__p1783131597100314">启动测试，将根据测试迭代次数执行多轮测试。每轮测试采集被测代码段执行期间的性能数据，并执行环境复位代码段恢复环境。完成后进行数据处理和保存。</p> </li><li id="li1520719041100314"><p id="ZH-CN_TOPIC_0000002473826534__p1205866243100314">获取测量数据值，结果存储在对象中，支持获取每轮测试详细数据和最大值、最小值、平均值等统计数据。</p> </li><li id="li1554755869100314"><p id="ZH-CN_TOPIC_0000002473826534__p669920177100314">销毁创建的对象，释放内存占用。</p> </li></ol> <p id="ZH-CN_TOPIC_0000002473826534__p1525550081100314">下面以采集指定代码段执行期间的耗时、CPU使用率为例，介绍详细代码开发步骤。</p> </div> <div class="tiledSection"><h3 id="定义测试策略" class="firsth2">定义测试策略<i class="anchor-icon anchor-icon-link" anchorid="定义测试策略" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002473826534__ol335394381100314"><li id="li488340060100314"><p id="ZH-CN_TOPIC_0000002473826534__p2146920831100314">定义测试性能指标列表</p> <p id="ZH-CN_TOPIC_0000002473826534__p1793681119100314">定义所需测试的性能指标列表metrics，类型为Array&lt;PerfMetric&gt;，其中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmetric" target="_blank">PerfMetric</a>为框架支持采集的性能指标枚举。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen461951390100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [ <span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>, <span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">CPU_USAGE</span> ];</li></ol></pre></div></div> </li><li id="li1386503629100314"><p id="ZH-CN_TOPIC_0000002473826534__p535637681100314">定义被测代码段和环境复位代码段</p> <p id="ZH-CN_TOPIC_0000002473826534__p107989741100314">被测代码段actionCode是一个类型为Callback&lt;Callback&lt;boolean&gt;&gt;的回调函数，框架在测试期间会自动调用此回调函数，并采集性能数据。执行结束时需调用入参Callback&lt;boolean&gt;函数通知框架执行完成，否则会导致代码段执行超时。例如测试Utils.CalculateTest方法性能时，通过调用finish(true)通知框架代码段执行完成。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen1118252259100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">actionCode</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;&gt; = <span class="hljs-keyword">async</span> (<span class="hljs-attr">finish</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;) =&gt; {</li><li>    <span class="hljs-title class_">Utils</span>.<span class="hljs-title class_">CalculateTest</span>();</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>};</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002473826534__p1904666947100314">此外，框架支持定义环境复位代码段resetCode，用于在单次测试后进行环境复位，类型和使用方法与actionCode相同。resetCode会在actionCode执行完成后执行，但执行期间不会采集应用性能数据。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen186026996100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">resetCode</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;&gt; = <span class="hljs-keyword">async</span> (<span class="hljs-attr">finish</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;) =&gt; {</li><li>    <span class="hljs-title class_">Utils</span>.<span class="hljs-title class_">Reset</span>();</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>};</li></ol></pre></div></div> </li><li id="li1820380230100314"><p id="ZH-CN_TOPIC_0000002473826534__p279295648100314">构造测试策略对象</p> <p id="ZH-CN_TOPIC_0000002473826534__p2040107126100314">除以上步骤定义的属性外，框架还支持定义其他测试策略，从而帮助开发者进行更加精确的自动化性能测试。所有测试策略通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfteststrategy" target="_blank">PerfTestStrategy</a>对象定义和保存，性能测试期间会依据此策略执行并采集数据。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen1205231532100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {</li><li>    <span class="hljs-attr">metrics</span>: metrics,   <span class="hljs-comment">// 步骤1中定义</span></li><li>    <span class="hljs-attr">actionCode</span>: actionCode,   <span class="hljs-comment">// 步骤2中定义</span></li><li>    <span class="hljs-attr">resetCode</span>: resetCode,   <span class="hljs-comment">// 步骤2中定义</span></li><li>    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.test"</span>, <span class="hljs-comment">// 定义被测应用包名</span></li><li>    <span class="hljs-attr">iterations</span>: <span class="hljs-number">10</span>,  <span class="hljs-comment">// 定义测试迭代次数</span></li><li>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">20000</span>  <span class="hljs-comment">// 定义代码段单次执行超时时间，单位ms</span></li><li>};</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="创建测试任务和启动测试">创建测试任务和启动测试<i class="anchor-icon anchor-icon-link" anchorid="创建测试任务和启动测试" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002473826534__p1414418182100314">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#create" target="_blank">PerfTest.create()</a>创建测试任务时，传入上文定义的PerfTestStrategy对象。然后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#run" target="_blank">PerfTest.run()</a>异步接口启动测试。测试会自动迭代执行被测代码段并采集性能数据。使用await语法糖同步等待执行完成后再进行后续操作。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen245108956100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy);</li><li><span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>();</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="获取测试结果">获取测试结果<i class="anchor-icon anchor-icon-link" anchorid="获取测试结果" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002473826534__p867106800100314">性能测试运行完成后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#getmeasureresult" target="_blank">PerfTest.getMeasureResult()</a>获取各个指标的测试结果。结果存储在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmeasureresult" target="_blank">PerfMeasureResult</a>对象中。若测试未完成或指标未定义，则抛出错误码。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen2029541021100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">res1</span>: <span class="hljs-title class_">PerfMeasureResult</span> = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">res2</span>: <span class="hljs-title class_">PerfMeasureResult</span> = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">CPU_USAGE</span>);</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="销毁创建的对象">销毁创建的对象<i class="anchor-icon anchor-icon-link" anchorid="销毁创建的对象" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002473826534__p1488460171100314">性能测试完成后，若无需继续使用PerfTest对象，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-perftest#destroy" target="_blank">PerfTest.destroy()</a>销毁对象以释放内存。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen356846405100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>perfTest.<span class="hljs-title function_">destroy</span>();</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="基础性能数据采集示例" class="firsth2">基础性能数据采集示例<i class="anchor-icon anchor-icon-link" anchorid="基础性能数据采集示例" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002473826534__p1283526406100314">下面以测试应用内指定逻辑执行时的基础性能数据为例，应用内定义了一个名为'Utils.CalculateTest()'的方法，性能测试时执行此方法，并采集执行期间的耗时和应用CPU占用率。</p> <ol id="ZH-CN_TOPIC_0000002473826534__ol1625953551100314"><li id="li301200225100314"><p id="ZH-CN_TOPIC_0000002473826534__p738788007100314">在 main &gt; ets &gt; utils 文件夹下新增 Utils.ets 文件，在文件中编写自定义的函数。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen334197366100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Utils</span> {</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">CalculateTest</span>() {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) {</li><li>      <span class="hljs-title class_">Utils</span>.<span class="hljs-property">num</span>++;</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Reset</span>() {</li><li>    <span class="hljs-title class_">Utils</span>.<span class="hljs-property">num</span> = <span class="hljs-number">0</span></li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li509481967100314"><p id="ZH-CN_TOPIC_0000002473826534__p425308804100314">在 ohosTest &gt; ets &gt; test 文件夹下 PerfTest.test.ets 文件中编写具体测试代码。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen1815573028100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { describe, it, expect, <span class="hljs-title class_">Level</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hypium'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span>, <span class="hljs-title class_">PerfMeasureResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Utils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../main/ets/utils/Utils'</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PerfTestTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'PerfTestTest'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-title function_">it</span>(<span class="hljs-string">'testExample1'</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">done</span>: <span class="hljs-title class_">Function</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [ <span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>, <span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">CPU_USAGE</span> ]; <span class="hljs-comment">// 定义待测指标</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">actionCode</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;&gt; = <span class="hljs-keyword">async</span> (<span class="hljs-attr">finish</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;) =&gt; {  <span class="hljs-comment">// 定义被测代码段</span></li><li>        <span class="hljs-title class_">Utils</span>.<span class="hljs-title class_">CalculateTest</span>();</li><li>        <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>      };</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">resetCode</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;&gt; = <span class="hljs-keyword">async</span> (<span class="hljs-attr">finish</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">boolean</span>&gt;) =&gt; {  <span class="hljs-comment">// 定义环境复位代码段</span></li><li>        <span class="hljs-title class_">Utils</span>.<span class="hljs-title class_">Reset</span>();</li><li>        <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>      };</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {  <span class="hljs-comment">// 定义测试策略</span></li><li>        <span class="hljs-attr">metrics</span>: metrics,</li><li>        <span class="hljs-attr">actionCode</span>: actionCode,</li><li>        <span class="hljs-attr">resetCode</span>: resetCode,</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.test"</span>, <span class="hljs-comment">// 定义被测应用包名，请开发者替换为实际包名</span></li><li>        <span class="hljs-attr">iterations</span>: <span class="hljs-number">10</span>,  <span class="hljs-comment">// 定义测试迭代次数</span></li><li>        <span class="hljs-attr">timeout</span>: <span class="hljs-number">20000</span>  <span class="hljs-comment">// 定义代码段单次执行超时时间</span></li><li>      };</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy); <span class="hljs-comment">// 创建测试任务对象PerfTest</span></li><li>        <span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// 执行测试，异步函数需使用await同步等待完成</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">res1</span>: <span class="hljs-title class_">PerfMeasureResult</span> = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>); <span class="hljs-comment">// 获取耗时指标的测试结果</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">res2</span>: <span class="hljs-title class_">PerfMeasureResult</span> = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">CPU_USAGE</span>); <span class="hljs-comment">// 获取CPU使用率指标的测试结果</span></li><li>        perfTest.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 销毁PerfTest对象</span></li><li>        <span class="hljs-title function_">expect</span>(res1.<span class="hljs-property">average</span>).<span class="hljs-title function_">assertLessOrEqual</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 断言性能测试结果</span></li><li>        <span class="hljs-title function_">expect</span>(res2.<span class="hljs-property">average</span>).<span class="hljs-title function_">assertLessOrEqual</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 断言性能测试结果</span></li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to execute perftest. Cause:<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>        <span class="hljs-title function_">expect</span>(<span class="hljs-literal">false</span>).<span class="hljs-title function_">assertTrue</span>()</li><li>      }</li><li>      <span class="hljs-title function_">done</span>()</li><li>    })</li><li>  })</li><li>}</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="场景化性能数据采集示例">场景化性能数据采集示例<i class="anchor-icon anchor-icon-link" anchorid="场景化性能数据采集示例" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002473826534__p1709238207100314">下面以测试应用内列表滑动的帧率为例，实现如下功能：打开指定应用，使用UI测试框架接口查找类型为'Scroll'的可滚动组件，并进行滑动操作，采集期间的列表滑动帧率数据。</p> <ol id="ZH-CN_TOPIC_0000002473826534__ol998685020100314"><li id="li1314843327100314"><p id="ZH-CN_TOPIC_0000002473826534__p568652473100314">在 main &gt; ets &gt; pages 文件夹下编写 Index.ets 页面代码，作为被测示例demo。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen70637076100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ListPage</span> {</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>]</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>                .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">80</span>)</li><li>                .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>            }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          }</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>)</li><li>        .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>)</li><li>        .<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li1028992142100314"><p id="ZH-CN_TOPIC_0000002473826534__p502444785100314">在ohosTest &gt; ets &gt; test文件夹下 PerfTest.test.ets 文件中编写具体测试代码。</p> <div _ngcontent-ydj-c106="" class="highlight-div"><div _ngcontent-ydj-c106="" class="highlight-div-header"><div _ngcontent-ydj-c106="" class="highlight-div-header-left"><div _ngcontent-ydj-c106="" class="handle-button expand-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydj-c106="" class="highlight-div-header-right"><div _ngcontent-ydj-c106="" class="handle-button ai-button"></div><div _ngcontent-ydj-c106="" class="handle-button line-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydj-c106="" class="handle-button theme-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydj-c106="" class="handle-button copy-button"><div _ngcontent-ydj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002473826534__screen423035515100314" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { describe, it, expect, <span class="hljs-title class_">Level</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hypium'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span>, <span class="hljs-title class_">PerfMeasureResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li><span class="hljs-keyword">import</span> { abilityDelegatorRegistry, <span class="hljs-title class_">Driver</span>, <span class="hljs-variable constant_">ON</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">delegator</span>: abilityDelegatorRegistry.<span class="hljs-property">AbilityDelegator</span> = abilityDelegatorRegistry.<span class="hljs-title function_">getAbilityDelegator</span>();</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PerfTestTest</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title function_">describe</span>(<span class="hljs-string">'PerfTestTest'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-title function_">it</span>(<span class="hljs-string">'testExample2'</span>,<span class="hljs-title class_">Level</span>.<span class="hljs-property">LEVEL3</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">done</span>: <span class="hljs-title class_">Function</span>) =&gt; {</li><li>        <span class="hljs-keyword">let</span> driver = <span class="hljs-title class_">Driver</span>.<span class="hljs-title function_">create</span>();</li><li>        <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">1000</span>);</li><li>        <span class="hljs-keyword">const</span> bundleName = abilityDelegatorRegistry.<span class="hljs-title function_">getArguments</span>().<span class="hljs-property">bundleName</span>;</li><li>        <span class="hljs-comment">// 被拉起应用的包名和Ability组件名，请开发者替换为实际的bundleName和abilityName</span></li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>            <span class="hljs-attr">bundleName</span>: bundleName,</li><li>            <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span></li><li>        };</li><li>        <span class="hljs-keyword">await</span> delegator.<span class="hljs-title function_">startAbility</span>(want); <span class="hljs-comment">// 拉起测试应用</span></li><li>        <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">1000</span>);</li><li>        <span class="hljs-keyword">let</span> scroll = <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">findComponent</span>(<span class="hljs-variable constant_">ON</span>.<span class="hljs-title function_">type</span>(<span class="hljs-string">'Scroll'</span>));</li><li>        <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">1000</span>);</li><li>        <span class="hljs-keyword">let</span> center = <span class="hljs-keyword">await</span> scroll.<span class="hljs-title function_">getBoundsCenter</span>();  <span class="hljs-comment">// 获取Scroll可滚动组件坐标</span></li><li>        <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">1000</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">LIST_SWIPE_FPS</span>]  <span class="hljs-comment">// 指定被测指标为列表滑动帧率</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-title function_">actionCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; { <span class="hljs-comment">// 测试代码段中使用uitest进行列表滑动</span></li><li>            <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">fling</span>({<span class="hljs-attr">x</span>: center.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(center.<span class="hljs-property">y</span> * <span class="hljs-number">3</span> / <span class="hljs-number">2</span>)}, {<span class="hljs-attr">x</span>: center.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(center.<span class="hljs-property">y</span> / <span class="hljs-number">2</span>)}, <span class="hljs-number">50</span>, <span class="hljs-number">20000</span>);</li><li>            <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">3000</span>);</li><li>            <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-title function_">resetCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; {  <span class="hljs-comment">// 复位环境，将列表划至顶部</span></li><li>            <span class="hljs-keyword">await</span> scroll.<span class="hljs-title function_">scrollToTop</span>(<span class="hljs-number">40000</span>);</li><li>            <span class="hljs-keyword">await</span> driver.<span class="hljs-title function_">delayMs</span>(<span class="hljs-number">1000</span>);</li><li>            <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {  <span class="hljs-comment">// 定义测试策略</span></li><li>            <span class="hljs-attr">metrics</span>: metrics,</li><li>            <span class="hljs-attr">actionCode</span>: actionCode,</li><li>            <span class="hljs-attr">resetCode</span>: resetCode,</li><li>            <span class="hljs-attr">iterations</span>: <span class="hljs-number">5</span>,  <span class="hljs-comment">// 指定测试迭代次数</span></li><li>            <span class="hljs-attr">timeout</span>: <span class="hljs-number">50000</span>, <span class="hljs-comment">// 指定actionCode和resetCode的超时时间</span></li><li>        };</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy); <span class="hljs-comment">// 创建测试任务对象PerfTest</span></li><li>            <span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// 执行测试，异步函数需使用await同步等待完成</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">PerfMeasureResult</span> = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">LIST_SWIPE_FPS</span>); <span class="hljs-comment">// 获取列表滑动帧率指标的测试结果</span></li><li>            perfTest.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 销毁PerfTest对象</span></li><li>            <span class="hljs-title function_">expect</span>(res.<span class="hljs-property">average</span>).<span class="hljs-title function_">assertLargerOrEqual</span>(<span class="hljs-number">60</span>);  <span class="hljs-comment">// 断言性能测试结果</span></li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to execute perftest. Cause:<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>        }</li><li>        <span class="hljs-title function_">done</span>();</li><li>      })</li><li>  })</li><li>}</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>