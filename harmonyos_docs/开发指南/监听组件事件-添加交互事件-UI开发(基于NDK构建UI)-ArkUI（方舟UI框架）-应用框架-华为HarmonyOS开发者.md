<h1 _ngcontent-jmy-c119="" class="doc-title ng-star-inserted" title="监听组件事件"> 监听组件事件 </h1>

<div _ngcontent-jmy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>NDK接口针对UI组件的事件，提供了监听函数的方式。首先，可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#addnodeeventreceiver" target="_blank">addNodeEventReceiver</a>函数添加组件事件的监听器，该监听器会监听该组件上发生的所有事件，例如：点击事件、焦点事件。然后，可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#registernodeevent" target="_blank">registerNodeEvent</a>函数声明组件的哪些事件需要监听，NDK接口支持的事件范围通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">ArkUI_NodeEventType</a>枚举值定义。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>        <p>事件注册需要声明<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#addnodeeventreceiver" target="_blank">addNodeEventReceiver</a>监听器注册和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#registernodeevent" target="_blank">registerNodeEvent</a>事件类型，监听器只能监听已声明的事件。</p></li>       <li>        <p>需要关注事件的反注册逻辑，如在组件销毁前调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#removenodeeventreceiver" target="_blank">removeNodeEventReceiver</a>移除事件监听器，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#unregisternodeevent" target="_blank">unregisterNodeEvent</a>通知ArkUI框架已监听的事件不再需要监听。</p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#addnodeeventreceiver" target="_blank">addNodeEventReceiver</a>可以添加多个函数指针，每个函数指针都会在对应事件触发时触发，对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#removenodeeventreceiver" target="_blank">removeNodeEventReceiver</a>需要传递对应的函数指针用于移除监听。</p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#registernodeeventreceiver" target="_blank">registerNodeEventReceiver</a>是全局监听函数，不同于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#addnodeeventreceiver" target="_blank">addNodeEventReceiver</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#registernodeeventreceiver" target="_blank">registerNodeEventReceiver</a>能够监听所有Native组件的事件触发，但只能传递一个函数指针，多次调用使用最后一次的函数指针进行回调，释放时使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#unregisternodeeventreceiver" target="_blank">unregisterNodeEventReceiver</a>进行释放。</p></li>      </ul>     </div></div></div>    <p>以下示例基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面</a>章节，补充相关事件监听。详细代码请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-listen-to-component-events#完整示例">完整示例</a>。</p>    <ul>     <li>      <p>事件注册和事件解注册</p>      <p>通过addNodeEventReceiver对节点绑定事件处理函数，接着通过调用registerNodeEvent注册对应的事件。</p>      <p>说明：</p>      <p>事件监听函数的入参ArkUI_NodeEvent* event的生命周期只在函数回调周期内生效，不推荐对该指针进行缓存或者进行异步处理。</p>      <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ArkUI_NativeNodeAPI_1</span> *<span class="hljs-variable">nodeAPI</span> = <span class="hljs-variable">nullptr</span>;</li><li><span class="hljs-title function_">OH_ArkUI_GetModuleInterface</span>(<span class="hljs-variable">ARKUI_NATIVE_NODE</span>, <span class="hljs-variable">ArkUI_NativeNodeAPI_1</span>, <span class="hljs-variable">nodeAPI</span>);</li><li><span class="hljs-variable">void</span> <span class="hljs-title function_">NodeEventReceiver</span>(<span class="hljs-variable">ArkUI_NodeEvent</span> *<span class="hljs-variable">event</span>) {</li><li>  <span class="hljs-comment">// 设置对应的事件类型触发时进行的操作，如NODE_ON_CLICK_EVENT</span></li><li>};</li><li><span class="hljs-variable">auto</span> <span class="hljs-variable">button</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_BUTTON</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">addNodeEventReceiver</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NodeEventReceiver</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeEvent</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NODE_ON_CLICK_EVENT</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">nullptr</span>);</li></ol></pre></div></div>      <p>详细的事件类型请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeeventtype" target="_blank">ArkUI_NodeEventType</a>。</p>      <p>通过unregisterNodeEvent解注册对应的事件类型，再通过removeNodeEventReceiver卸载事件处理函数。</p>      <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">unregisterNodeEvent</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NODE_ON_CLICK_EVENT</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">removeNodeEventReceiver</span>(<span class="hljs-title class_">button</span>, <span class="hljs-title class_">NodeEventReceiver</span>);</li></ol></pre></div></div></li>     <li>      <p>全局事件监听</p>      <p>使用registerNodeEventReceiver注册全局的事件处理函数，对事件进行统一的处理，结束后可使用unregisterNodeEventReceiver进行释放。</p>      <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEventReceiver</span>([](ArkUI_NodeEvent *event){</li><li>  <span class="hljs-keyword">auto</span> *inputEvent = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetInputEvent</span>(event);</li><li>  <span class="hljs-keyword">auto</span> eventType = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetEventType</span>(event);</li><li>  <span class="hljs-keyword">switch</span>(eventType){</li><li>      <span class="hljs-keyword">case</span> NODE_ON_CLICK_EVENT: {</li><li>          <span class="hljs-comment">// 触发点击事件所进行的操作</span></li><li>      }</li><li>      <span class="hljs-keyword">default</span>: {</li><li>          <span class="hljs-keyword">break</span>;</li><li>      }</li><li>  }</li><li>})</li><li>nodeAPI-&gt;<span class="hljs-built_in">unregisterNodeEventReceiver</span>();</li></ol></pre></div></div></li>     <li>      <p>获取事件信息</p>      <p>ArkUI框架提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeevent_getinputevent" target="_blank">OH_ArkUI_NodeEvent_GetInputEvent()</a>接口，用于从输入交互相关的组件事件（如NODE_ON_CLICK_EVENT、NODE_TOUCH_EVENT等，具体可参见每个枚举定义的说明）中获取基础事件对象。然后，可通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ui-input-event-h#oh_arkui_pointerevent_getdisplayx" target="_blank">OH_ArkUI_PointerEvent_GetDisplayX()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ui-input-event-h#oh_arkui_pointerevent_getdisplayxbyindex" target="_blank">OH_ArkUI_PointerEvent_GetDisplayXByIndex()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ui-input-event-h#oh_arkui_uiinputevent_getaction" target="_blank">OH_ArkUI_UIInputEvent_GetAction()</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ui-input-event-h#oh_arkui_uiinputevent_geteventtime" target="_blank">OH_ArkUI_UIInputEvent_GetEventTime()</a>等接口，从基础事件中获取更多信息。应用根据获取的事件信息，在事件执行过程中实现差异化交互逻辑。</p>      <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 注册click事件</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> LOG_PRINT_DOMAIN = <span class="hljs-number">0xFF00</span>;</li><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEvent</span>(button, NODE_ON_CLICK_EVENT, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>);</li><li><span class="hljs-comment">// 设置组件事件的全局监听</span></li><li>nodeAPI-&gt;<span class="hljs-built_in">registerNodeEventReceiver</span>([](ArkUI_NodeEvent *event) {</li><li>    <span class="hljs-comment">// 从组件事件中获取基础事件对象</span></li><li>    <span class="hljs-keyword">auto</span> *inputEvent = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetInputEvent</span>(event);</li><li>    <span class="hljs-comment">// 从组件事件获取事件类型</span></li><li>    <span class="hljs-keyword">auto</span> eventType = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetEventType</span>(event);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"inputEvent = %{public}p"</span>, inputEvent);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"eventType = %{public}d"</span>, eventType);</li><li>    <span class="hljs-keyword">auto</span> componentEvent = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetNodeComponentEvent</span>(event);</li><li>    <span class="hljs-comment">// 获取组件事件中的数字类型数据</span></li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"componentEvent = %{public}p"</span>,</li><li>                  componentEvent);</li><li>    <span class="hljs-comment">// 获取触发该事件的组件对象</span></li><li>    <span class="hljs-keyword">auto</span> nodeHandle = <span class="hljs-built_in">OH_ArkUI_NodeEvent_GetNodeHandle</span>(event);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"nodeHandle = %{public}p"</span>, nodeHandle);</li><li>    <span class="hljs-comment">// 根据eventType来区分事件类型，进行差异化处理，其他获取事件信息的接口也可类似方式来进行差异化的处理</span></li><li>    <span class="hljs-keyword">switch</span> (eventType) {</li><li>    <span class="hljs-keyword">case</span> NODE_ON_CLICK_EVENT: {</li><li>        <span class="hljs-comment">// 触发点击事件所进行的操作，从基础事件获取事件信息</span></li><li>        <span class="hljs-keyword">auto</span> x = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetX</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> y = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetY</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> displayX = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetDisplayX</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> displayY = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetDisplayY</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> windowX = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetWindowX</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> windowY = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetWindowY</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> pointerCount = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetPointerCount</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> xByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetXByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> yByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetYByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> displayXByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetDisplayXByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> displayYByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetDisplayYByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> windowXByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetWindowXByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> windowYByIndex = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetWindowYByIndex</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> pointerId = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetPointerId</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> pressure = <span class="hljs-built_in">OH_ArkUI_PointerEvent_GetPressure</span>(inputEvent, <span class="hljs-number">0</span>);</li><li>        <span class="hljs-keyword">auto</span> action = <span class="hljs-built_in">OH_ArkUI_UIInputEvent_GetAction</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> eventTime = <span class="hljs-built_in">OH_ArkUI_UIInputEvent_GetEventTime</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> sourceType = <span class="hljs-built_in">OH_ArkUI_UIInputEvent_GetSourceType</span>(inputEvent);</li><li>        <span class="hljs-keyword">auto</span> type = <span class="hljs-built_in">OH_ArkUI_UIInputEvent_GetType</span>(inputEvent);</li><li>        std::string eventInfo =</li><li>            <span class="hljs-string">"x: "</span> + std::<span class="hljs-built_in">to_string</span>(x) + <span class="hljs-string">", y: "</span> + std::<span class="hljs-built_in">to_string</span>(y) +</li><li>            <span class="hljs-string">", displayX: "</span> + std::<span class="hljs-built_in">to_string</span>(displayX) + <span class="hljs-string">", displayY: "</span> + std::<span class="hljs-built_in">to_string</span>(displayY) +</li><li>            <span class="hljs-string">", windowX: "</span> + std::<span class="hljs-built_in">to_string</span>(windowX) + <span class="hljs-string">", windowY: "</span> + std::<span class="hljs-built_in">to_string</span>(windowY) +</li><li>            <span class="hljs-string">", pointerCount: "</span> + std::<span class="hljs-built_in">to_string</span>(pointerCount) + <span class="hljs-string">", xByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(xByIndex) +</li><li>            <span class="hljs-string">", yByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(yByIndex) +</li><li>            <span class="hljs-string">", displayXByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(displayXByIndex) +</li><li>            <span class="hljs-string">", displayYByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(displayYByIndex) +</li><li>            <span class="hljs-string">", windowXByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(windowXByIndex) +</li><li>            <span class="hljs-string">", windowYByIndex: "</span> + std::<span class="hljs-built_in">to_string</span>(windowYByIndex) +</li><li>            <span class="hljs-string">", pointerId: "</span> + std::<span class="hljs-built_in">to_string</span>(pointerId) + <span class="hljs-string">", pressure: "</span> + std::<span class="hljs-built_in">to_string</span>(pressure) +</li><li>            <span class="hljs-string">", action: "</span> + std::<span class="hljs-built_in">to_string</span>(action) + <span class="hljs-string">", eventTime: "</span> + std::<span class="hljs-built_in">to_string</span>(eventTime) +</li><li>            <span class="hljs-string">", sourceType: "</span> + std::<span class="hljs-built_in">to_string</span>(sourceType) + <span class="hljs-string">", type: "</span> + std::<span class="hljs-built_in">to_string</span>(type);</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfoOfCommonEvent"</span>, <span class="hljs-string">"eventInfo = %{public}s"</span>,</li><li>                     eventInfo.<span class="hljs-built_in">c_str</span>());</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">default</span>: {</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    }</li><li>});</li><li>nodeAPI-&gt;<span class="hljs-built_in">unregisterNodeEventReceiver</span>();</li><li>nodeAPI-&gt;<span class="hljs-built_in">unregisterNodeEvent</span>(button, NODE_ON_CLICK_EVENT);</li></ol></pre></div></div></li>     <li>      <p>深浅色变更事件</p>      <p>ArkUI开发框架在NDK接口提供了以组件为注册单位的系统深浅色变更事件，系统通过在深浅色变更时通知注册在组件上的回调，实现NDK侧的深浅色变更能力。</p>      <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">        <ul>         <li>一个回调内可以自行设计多个组件的深浅色变更。</li>         <li>同一组件仅能注册一个系统深浅变更回调。</li>         <li>建议注册在页面内不会被销毁的节点，防止因节点销毁导致的回调失效。</li>        </ul>       </div></div></div>      <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> LOG_PRINT_DOMAIN = <span class="hljs-number">0xFF00</span>;</li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ColorModeInfo</span> {</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* lightMsg;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* darkMsg;</li><li>};</li><li>
</li><li><span class="hljs-comment">//注册回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">onColorModeChange</span><span class="hljs-params">(ArkUI_SystemColorMode colorMode, <span class="hljs-type">void</span> *userData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    ColorModeInfo* info = <span class="hljs-built_in">static_cast</span>&lt;ColorModeInfo*&gt;(userData);</li><li>    <span class="hljs-keyword">if</span> (colorMode == ARKUI_SYSTEM_COLOR_MODE_LIGHT) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, LOG_PRINT_DOMAIN, <span class="hljs-string">"Manager"</span>, <span class="hljs-string">"Light mode: "</span>, info-&gt;lightMsg);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colorMode == ARKUI_SYSTEM_COLOR_MODE_DARK) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, LOG_PRINT_DOMAIN, <span class="hljs-string">"Manager"</span>, <span class="hljs-string">"Dark mode: "</span>, info-&gt;darkMsg);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function">ArkUI_NodeHandle <span class="hljs-title">testColorModeChange</span><span class="hljs-params">(ArkUI_NativeNodeAPI_1 *nodeAPI)</span> </span>{</li><li>    ArkUI_NodeHandle text = nodeAPI-&gt;<span class="hljs-built_in">createNode</span>(ARKUI_NODE_TEXT);</li><li>    <span class="hljs-type">static</span> ColorModeInfo info = {<span class="hljs-string">"现在是浅色模式"</span>, <span class="hljs-string">"现在是深色模式"</span>};</li><li>    <span class="hljs-built_in">OH_ArkUI_RegisterSystemColorModeChangeEvent</span>(text, &amp;info, onColorModeChange);</li><li>
</li><li>    ArkUI_AttributeItem itemstring = {<span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, (<span class="hljs-string">"人生得意须尽欢"</span>)};</li><li>    nodeAPI-&gt;<span class="hljs-built_in">setAttribute</span>(text, NODE_TEXT_CONTENT, &amp;itemstring);</li><li>
</li><li>    <span class="hljs-keyword">return</span> text;</li><li>}</li></ol></pre></div></div></li>    </ul>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>在ArkUINode基类对象中实现通用事件注册逻辑。</p>       <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUINode.h</span></li><li><span class="hljs-comment">// 提供通用属性和事件的封装。</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_ARKUINODE_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_ARKUINODE_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUIBaseNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"NativeModule.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li>
</li><li>namespace NativeModule {</li><li>
</li><li><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArkUINode</span> :</span> public ArkUIBaseNode {</li><li>public:</li><li>    explicit <span class="hljs-title function_">ArkUINode</span><span class="hljs-params">(ArkUI_NodeHandle handle)</span> : <span class="hljs-title function_">ArkUIBaseNode</span><span class="hljs-params">(handle)</span> {</li><li>        nativeModule_ = NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI();</li><li>        <span class="hljs-comment">// 事件触发时需要通过函数获取对应的事件对象，这边通过设置节点自定义数据将封装类指针保持在组件上，方便后续事件分发。</span></li><li>        nativeModule_-&gt;setUserData(handle_, this);</li><li>        <span class="hljs-comment">// 注册节点监听事件接受器。</span></li><li>        nativeModule_-&gt;addNodeEventReceiver(handle_, ArkUINode::NodeEventReceiver);</li><li>    }</li><li>
</li><li>    ~ArkUINode() override {</li><li>        <span class="hljs-keyword">if</span> (onClick_) {</li><li>            nativeModule_-&gt;unregisterNodeEvent(handle_, NODE_ON_CLICK_EVENT);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (onTouch_) {</li><li>            nativeModule_-&gt;unregisterNodeEvent(handle_, NODE_TOUCH_EVENT);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (onDisappear_) {</li><li>            nativeModule_-&gt;unregisterNodeEvent(handle_, NODE_EVENT_ON_DISAPPEAR);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (onAppear_) {</li><li>            nativeModule_-&gt;unregisterNodeEvent(handle_, NODE_EVENT_ON_APPEAR);</li><li>        }</li><li>        nativeModule_-&gt;removeNodeEventReceiver(handle_, ArkUINode::NodeEventReceiver);</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetWidth</span><span class="hljs-params">(<span class="hljs-type">float</span> width)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_NumberValue value[] = {{.f32 = width}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_WIDTH, &amp;item);</li><li>    }</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetPercentWidth</span><span class="hljs-params">(<span class="hljs-type">float</span> percent)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_NumberValue value[] = {{.f32 = percent}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_WIDTH_PERCENT, &amp;item);</li><li>    }</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetHeight</span><span class="hljs-params">(<span class="hljs-type">float</span> height)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_NumberValue value[] = {{.f32 = height}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_HEIGHT, &amp;item);</li><li>    }</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetPercentHeight</span><span class="hljs-params">(<span class="hljs-type">float</span> percent)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_NumberValue value[] = {{.f32 = percent}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_HEIGHT_PERCENT, &amp;item);</li><li>    }</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetBackgroundColor</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> color)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_NumberValue value[] = {{.u32 = color}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_BACKGROUND_COLOR, &amp;item);</li><li>    }</li><li>    <span class="hljs-comment">// 处理通用事件。</span></li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterOnClick</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(ArkUI_NodeEvent *event)&gt; &amp;onClick)</span> {</li><li>        assert(handle_);</li><li>        onClick_ = onClick;</li><li>        <span class="hljs-comment">// 注册点击事件。</span></li><li>        nativeModule_-&gt;registerNodeEvent(handle_, NODE_ON_CLICK_EVENT, <span class="hljs-number">0</span>, nullptr);</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterOnTouch</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(<span class="hljs-type">int32_t</span> type, <span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y)&gt; &amp;onTouch)</span> {</li><li>        assert(handle_);</li><li>        onTouch_ = onTouch;</li><li>        <span class="hljs-comment">// 注册触碰事件。</span></li><li>        nativeModule_-&gt;registerNodeEvent(handle_, NODE_TOUCH_EVENT, <span class="hljs-number">0</span>, nullptr);</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterOnDisappear</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>()&gt; &amp;onDisappear)</span> {</li><li>        assert(handle_);</li><li>        onDisappear_ = onDisappear;</li><li>        <span class="hljs-comment">// 注册卸载事件。</span></li><li>        nativeModule_-&gt;registerNodeEvent(handle_, NODE_EVENT_ON_DISAPPEAR, <span class="hljs-number">0</span>, nullptr);</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterOnAppear</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>()&gt; &amp;onAppear)</span> {</li><li>        assert(handle_);</li><li>        onAppear_ = onAppear;</li><li>        <span class="hljs-comment">// 注册挂载事件。</span></li><li>        nativeModule_-&gt;registerNodeEvent(handle_, NODE_EVENT_ON_APPEAR, <span class="hljs-number">0</span>, nullptr);</li><li>    }</li><li>
</li><li>protected:</li><li>    <span class="hljs-comment">// 事件监听器函数指针。</span></li><li>    <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">NodeEventReceiver</span><span class="hljs-params">(ArkUI_NodeEvent *event)</span> {</li><li>        <span class="hljs-comment">// 获取事件发生的UI组件对象。</span></li><li>        <span class="hljs-keyword">auto</span> nodeHandle = OH_ArkUI_NodeEvent_GetNodeHandle(event);</li><li>        <span class="hljs-comment">// 获取保持在UI组件对象中的自定义数据，返回封装类指针。</span></li><li>        <span class="hljs-keyword">auto</span> *node = reinterpret_cast&lt;ArkUINode *&gt;(</li><li>            NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI()-&gt;getUserData(nodeHandle));</li><li>        <span class="hljs-comment">// 基于封装类实例对象处理事件。</span></li><li>        node-&gt;ProcessNodeEvent(event);</li><li>    }</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">ProcessNodeEvent</span><span class="hljs-params">(ArkUI_NodeEvent *event)</span> {</li><li>        <span class="hljs-keyword">auto</span> eventType = OH_ArkUI_NodeEvent_GetEventType(event);</li><li>        <span class="hljs-keyword">switch</span> (eventType) {</li><li>        <span class="hljs-keyword">case</span> NODE_ON_CLICK_EVENT: {</li><li>            <span class="hljs-keyword">if</span> (onClick_) {</li><li>                onClick_(event);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        <span class="hljs-keyword">case</span> NODE_TOUCH_EVENT: {</li><li>            <span class="hljs-keyword">if</span> (onTouch_) {</li><li>                <span class="hljs-keyword">auto</span> *uiInputEvent = OH_ArkUI_NodeEvent_GetInputEvent(event);</li><li>                <span class="hljs-type">float</span> x = OH_ArkUI_PointerEvent_GetX(uiInputEvent);</li><li>                <span class="hljs-type">float</span> y = OH_ArkUI_PointerEvent_GetY(uiInputEvent);</li><li>                <span class="hljs-keyword">auto</span> type = OH_ArkUI_UIInputEvent_GetAction(uiInputEvent);</li><li>                onTouch_(type, x, y);</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">case</span> NODE_EVENT_ON_DISAPPEAR: {</li><li>            <span class="hljs-keyword">if</span> (onDisappear_) {</li><li>                onDisappear_();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        <span class="hljs-keyword">case</span> NODE_EVENT_ON_APPEAR: {</li><li>            <span class="hljs-keyword">if</span> (onAppear_) {</li><li>                onAppear_();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        <span class="hljs-keyword">default</span>: {</li><li>            <span class="hljs-comment">// 组件特有事件交给子类处理</span></li><li>            OnNodeEvent(event);</li><li>        }</li><li>        }</li><li>    }</li><li>
</li><li>    virtual <span class="hljs-type">void</span> <span class="hljs-title function_">OnNodeEvent</span><span class="hljs-params">(ArkUI_NodeEvent *event)</span> {}</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnAddChild</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; &amp;child)</span> override {</li><li>        nativeModule_-&gt;addChild(handle_, child-&gt;GetHandle());</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnRemoveChild</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; &amp;child)</span> override {</li><li>        nativeModule_-&gt;removeChild(handle_, child-&gt;GetHandle());</li><li>    }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnInsertChild</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; &amp;child, <span class="hljs-type">int32_t</span> index)</span> override {</li><li>        nativeModule_-&gt;insertChildAt(handle_, child-&gt;GetHandle(), index);</li><li>    }</li><li>
</li><li>private:</li><li>    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(ArkUI_NodeEvent *event)&gt; onClick_;</li><li>    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>()&gt; onDisappear_;</li><li>    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>()&gt; onAppear_;</li><li>    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(<span class="hljs-type">int32_t</span> type, <span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y)&gt; onTouch_;</li><li>};</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYAPPLICATION_ARKUINODE_H</span></span></li></ol></pre></div></div></li>      <li>       <p>在ArkUIListNode对象中实现列表事件注册逻辑。</p>       <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListNode.h</span></li><li><span class="hljs-comment">// 列表封装类对象</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_ARKUILISTNODE_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_ARKUILISTNODE_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUINode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li>namespace NativeModule {</li><li><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArkUIListNode</span> :</span> public ArkUINode {</li><li>public:</li><li>    ArkUIListNode()</li><li>        : ArkUINode((NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI())-&gt;createNode(ARKUI_NODE_LIST)) {}</li><li>
</li><li>    ~ArkUIListNode() override { nativeModule_-&gt;unregisterNodeEvent(handle_, NODE_LIST_ON_SCROLL_INDEX); }</li><li>
</li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">SetScrollBarState</span><span class="hljs-params">(<span class="hljs-type">bool</span> isShow)</span> {</li><li>        assert(handle_);</li><li>        ArkUI_ScrollBarDisplayMode displayMode =</li><li>            isShow ? ARKUI_SCROLL_BAR_DISPLAY_MODE_ON : ARKUI_SCROLL_BAR_DISPLAY_MODE_OFF;</li><li>        ArkUI_NumberValue value[] = {{.i32 = displayMode}};</li><li>        ArkUI_AttributeItem item = {value, <span class="hljs-number">1</span>};</li><li>        nativeModule_-&gt;setAttribute(handle_, NODE_SCROLL_BAR_DISPLAY_MODE, &amp;item);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 注册列表相关事件。</span></li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterOnScrollIndex</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(<span class="hljs-type">int32_t</span> index)&gt; &amp;onScrollIndex)</span> {</li><li>        assert(handle_);</li><li>        onScrollIndex_ = onScrollIndex;</li><li>        nativeModule_-&gt;registerNodeEvent(handle_, NODE_LIST_ON_SCROLL_INDEX, <span class="hljs-number">0</span>, nullptr);</li><li>    }</li><li>
</li><li>protected:</li><li>   <span class="hljs-comment">// 处理List相关事件。</span></li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnNodeEvent</span><span class="hljs-params">(ArkUI_NodeEvent *event)</span> override {</li><li>        <span class="hljs-keyword">auto</span> eventType = OH_ArkUI_NodeEvent_GetEventType(event);</li><li>        <span class="hljs-keyword">switch</span> (eventType) {</li><li>        <span class="hljs-keyword">case</span> NODE_LIST_ON_SCROLL_INDEX: {</li><li>            <span class="hljs-keyword">auto</span> index = OH_ArkUI_NodeEvent_GetNodeComponentEvent(event)-&gt;data[<span class="hljs-number">0</span>];</li><li>            <span class="hljs-keyword">if</span> (onScrollIndex_) {</li><li>                onScrollIndex_(index.i32);</li><li>            }</li><li>        }</li><li>        <span class="hljs-keyword">default</span>: {</li><li>        }</li><li>        }</li><li>    }</li><li>
</li><li>private:</li><li>    <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">void</span>(<span class="hljs-type">int32_t</span> index)&gt; onScrollIndex_;</li><li>};</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYAPPLICATION_ARKUILISTNODE_H</span></span></li></ol></pre></div></div></li>      <li>       <p>添加相关事件。</p>       <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NormalTextListExample.h</span></li><li><span class="hljs-comment">// 文本列表示例。</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_NORMALTEXTLISTEXAMPLE_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_NORMALTEXTLISTEXAMPLE_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUIBaseNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUIListItemNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUIListNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUITextNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> LOG_PRINT_DOMAIN = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li>namespace NativeModule {</li><li>
</li><li><span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;ArkUIBaseNode&gt; <span class="hljs-title function_">CreateTextListExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-comment">// 创建组件并挂载</span></li><li>    <span class="hljs-comment">// 1：创建List组件。</span></li><li>    <span class="hljs-keyword">auto</span> <span class="hljs-built_in">list</span> = <span class="hljs-built_in">std</span>::make_shared&lt;ArkUIListNode&gt;();</li><li>    <span class="hljs-built_in">list</span>-&gt;SetPercentWidth(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-built_in">list</span>-&gt;SetPercentHeight(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-comment">// 2：创建ListItem子组件并挂载到List上。</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; ++i) {</li><li>        <span class="hljs-keyword">auto</span> listItem = <span class="hljs-built_in">std</span>::make_shared&lt;ArkUIListItemNode&gt;();</li><li>        <span class="hljs-keyword">auto</span> textNode = <span class="hljs-built_in">std</span>::make_shared&lt;ArkUITextNode&gt;();</li><li>        textNode-&gt;SetTextContent(<span class="hljs-built_in">std</span>::to_string(i));</li><li>        textNode-&gt;SetFontSize(<span class="hljs-number">16</span>);</li><li>        textNode-&gt;SetPercentWidth(<span class="hljs-number">1</span>);</li><li>        textNode-&gt;SetHeight(<span class="hljs-number">100</span>);</li><li>        textNode-&gt;SetBackgroundColor(<span class="hljs-number">0xFFfffacd</span>);</li><li>        textNode-&gt;SetTextAlign(ARKUI_TEXT_ALIGNMENT_CENTER);</li><li>        listItem-&gt;AddChild(textNode);</li><li>        <span class="hljs-comment">// 列表项注册点击事件。</span></li><li>        <span class="hljs-keyword">auto</span> onClick = [](ArkUI_NodeEvent *event) {</li><li>            <span class="hljs-comment">// 从组件事件中获取基础事件对象</span></li><li>            <span class="hljs-keyword">auto</span> *inputEvent = OH_ArkUI_NodeEvent_GetInputEvent(event);</li><li>            <span class="hljs-keyword">if</span> (inputEvent == nullptr) {</li><li>                 <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 从组件事件获取事件类型</span></li><li>            <span class="hljs-keyword">auto</span> eventType = OH_ArkUI_NodeEvent_GetEventType(event);</li><li>            OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"inputEvent = %{public}p"</span>, inputEvent);</li><li>            OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"eventType = %{public}d"</span>, eventType);</li><li>            <span class="hljs-keyword">auto</span> componentEvent = OH_ArkUI_NodeEvent_GetNodeComponentEvent(event);</li><li>            <span class="hljs-comment">// 获取组件事件中的数字类型数据</span></li><li>            OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"componentEvent = %{public}p"</span>,</li><li>                         componentEvent);</li><li>            <span class="hljs-comment">// 获取触发该事件的组件对象</span></li><li>            <span class="hljs-keyword">auto</span> nodeHandle = OH_ArkUI_NodeEvent_GetNodeHandle(event);</li><li>            <span class="hljs-keyword">if</span> (nodeHandle == nullptr) {</li><li>                 <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfo"</span>, <span class="hljs-string">"nodeHandle = %{public}p"</span>, nodeHandle);</li><li>            <span class="hljs-comment">// 根据eventType来区分事件类型，进行差异化处理，其他获取事件信息的接口也可类似方式来进行差异化的处理</span></li><li>            <span class="hljs-keyword">switch</span> (eventType) {</li><li>                 <span class="hljs-keyword">case</span> NODE_ON_CLICK_EVENT: {</li><li>                     <span class="hljs-comment">// 触发点击事件所进行的操作，从基础事件获取事件信息</span></li><li>                     <span class="hljs-keyword">auto</span> x = OH_ArkUI_PointerEvent_GetX(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> y = OH_ArkUI_PointerEvent_GetY(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> displayX = OH_ArkUI_PointerEvent_GetDisplayX(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> displayY = OH_ArkUI_PointerEvent_GetDisplayY(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> windowX = OH_ArkUI_PointerEvent_GetWindowX(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> windowY = OH_ArkUI_PointerEvent_GetWindowY(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> pointerCount = OH_ArkUI_PointerEvent_GetPointerCount(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> xByIndex = OH_ArkUI_PointerEvent_GetXByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> yByIndex = OH_ArkUI_PointerEvent_GetYByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> displayXByIndex = OH_ArkUI_PointerEvent_GetDisplayXByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> displayYByIndex = OH_ArkUI_PointerEvent_GetDisplayYByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> windowXByIndex = OH_ArkUI_PointerEvent_GetWindowXByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> windowYByIndex = OH_ArkUI_PointerEvent_GetWindowYByIndex(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> pointerId = OH_ArkUI_PointerEvent_GetPointerId(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> pressure = OH_ArkUI_PointerEvent_GetPressure(inputEvent, <span class="hljs-number">0</span>);</li><li>                     <span class="hljs-keyword">auto</span> action = OH_ArkUI_UIInputEvent_GetAction(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> eventTime = OH_ArkUI_UIInputEvent_GetEventTime(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> sourceType = OH_ArkUI_UIInputEvent_GetSourceType(inputEvent);</li><li>                     <span class="hljs-keyword">auto</span> type = OH_ArkUI_UIInputEvent_GetType(inputEvent);</li><li>                     <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> eventInfo =</li><li>                         <span class="hljs-string">"x: "</span> + <span class="hljs-built_in">std</span>::to_string(x) + <span class="hljs-string">", y: "</span> + <span class="hljs-built_in">std</span>::to_string(y) +</li><li>                         <span class="hljs-string">", displayX: "</span> + <span class="hljs-built_in">std</span>::to_string(displayX) + <span class="hljs-string">", displayY: "</span> + <span class="hljs-built_in">std</span>::to_string(displayY) +</li><li>                         <span class="hljs-string">", windowX: "</span> + <span class="hljs-built_in">std</span>::to_string(windowX) + <span class="hljs-string">", windowY: "</span> + <span class="hljs-built_in">std</span>::to_string(windowY) +</li><li>                         <span class="hljs-string">", pointerCount: "</span> + <span class="hljs-built_in">std</span>::to_string(pointerCount) + <span class="hljs-string">", xByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(xByIndex) +</li><li>                         <span class="hljs-string">", yByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(yByIndex) +</li><li>                         <span class="hljs-string">", displayXByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(displayXByIndex) +</li><li>                         <span class="hljs-string">", displayYByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(displayYByIndex) +</li><li>                         <span class="hljs-string">", windowXByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(windowXByIndex) +</li><li>                         <span class="hljs-string">", windowYByIndex: "</span> + <span class="hljs-built_in">std</span>::to_string(windowYByIndex) +</li><li>                         <span class="hljs-string">", pointerId: "</span> + <span class="hljs-built_in">std</span>::to_string(pointerId) + <span class="hljs-string">", pressure: "</span> + <span class="hljs-built_in">std</span>::to_string(pressure) +</li><li>                         <span class="hljs-string">", action: "</span> + <span class="hljs-built_in">std</span>::to_string(action) + <span class="hljs-string">", eventTime: "</span> + <span class="hljs-built_in">std</span>::to_string(eventTime) +</li><li>                         <span class="hljs-string">", sourceType: "</span> + <span class="hljs-built_in">std</span>::to_string(sourceType) + <span class="hljs-string">", type: "</span> + <span class="hljs-built_in">std</span>::to_string(type);</li><li>                     OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"eventInfoOfCommonEvent"</span>,</li><li>                                     <span class="hljs-string">"eventInfo = %{public}s"</span>, eventInfo.c_str());</li><li>                 }</li><li>                 <span class="hljs-keyword">default</span>: {</li><li>                     <span class="hljs-keyword">break</span>;</li><li>                 }</li><li>             }</li><li>        };</li><li>        listItem-&gt;RegisterOnClick(onClick);</li><li>        <span class="hljs-built_in">list</span>-&gt;AddChild(listItem);</li><li>    }</li><li>    <span class="hljs-comment">// 3：注册List相关监听事件.</span></li><li>    <span class="hljs-built_in">list</span>-&gt;RegisterOnScrollIndex([](<span class="hljs-type">int32_t</span> index) { OH_LOG_INFO(LOG_APP, <span class="hljs-string">"on list scroll index: %{public}d"</span>, index); });</li><li>    <span class="hljs-comment">// 4: 注册挂载事件。</span></li><li>    <span class="hljs-built_in">list</span>-&gt;RegisterOnAppear([]() { OH_LOG_INFO(LOG_APP, <span class="hljs-string">"on list mount to tree"</span>); });</li><li>    <span class="hljs-comment">// 5: 注册卸载事件。</span></li><li>    <span class="hljs-built_in">list</span>-&gt;RegisterOnDisappear([]() { OH_LOG_INFO(LOG_APP, <span class="hljs-string">"on list unmount from tree"</span>); });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>;</li><li>}</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYAPPLICATION_NORMALTEXTLISTEXAMPLE_H</span></span></li></ol></pre></div></div>       <p>由于使用了日志相关接口，需要在CMakeLists.txt中添加对libhilog_ndk.z.so的引用，如下：</p>       <div _ngcontent-jmy-c106="" class="highlight-div"><div _ngcontent-jmy-c106="" class="highlight-div-header"><div _ngcontent-jmy-c106="" class="highlight-div-header-left"><div _ngcontent-jmy-c106="" class="handle-button expand-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jmy-c106="" class="highlight-div-header-right"><div _ngcontent-jmy-c106="" class="handle-button ai-button"></div><div _ngcontent-jmy-c106="" class="handle-button line-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jmy-c106="" class="handle-button theme-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jmy-c106="" class="handle-button copy-button"><div _ngcontent-jmy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jmy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">add_library</span>(entry SHARED napi_init.cpp NativeEntry.cpp)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libace_ndk.z.so libhilog_ndk.z.so)</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>