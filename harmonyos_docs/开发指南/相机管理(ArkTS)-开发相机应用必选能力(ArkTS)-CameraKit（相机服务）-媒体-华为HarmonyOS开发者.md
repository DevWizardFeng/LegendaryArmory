<h1 _ngcontent-kpl-c119="" class="doc-title ng-star-inserted" title="相机管理(ArkTS)"> 相机管理(ArkTS) </h1>

<div _ngcontent-kpl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在开发一个相机应用前，需要先通过调用相机接口来创建一个独立的相机设备。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入camera接口，接口中提供了相机相关的属性和方法，导入方法如下。</p>       <div _ngcontent-kpl-c106="" class="highlight-div"><div _ngcontent-kpl-c106="" class="highlight-div-header"><div _ngcontent-kpl-c106="" class="highlight-div-header-left"><div _ngcontent-kpl-c106="" class="handle-button expand-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kpl-c106="" class="highlight-div-header-right"><div _ngcontent-kpl-c106="" class="handle-button ai-button"></div><div _ngcontent-kpl-c106="" class="handle-button line-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kpl-c106="" class="handle-button theme-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kpl-c106="" class="handle-button copy-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kpl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-f#cameragetcameramanager" target="_blank">getCameraManager</a>方法，获取cameraManager对象。</p>       <p>Context获取方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>       <div _ngcontent-kpl-c106="" class="highlight-div"><div _ngcontent-kpl-c106="" class="highlight-div-header"><div _ngcontent-kpl-c106="" class="highlight-div-header-left"><div _ngcontent-kpl-c106="" class="handle-button expand-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kpl-c106="" class="highlight-div-header-right"><div _ngcontent-kpl-c106="" class="handle-button ai-button"></div><div _ngcontent-kpl-c106="" class="handle-button line-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kpl-c106="" class="handle-button theme-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kpl-c106="" class="handle-button copy-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kpl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCameraManager</span>(<span class="hljs-params">context: common.BaseContext</span>): camera.<span class="hljs-property">CameraManager</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraManager</span>: camera.<span class="hljs-property">CameraManager</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraManager = camera.<span class="hljs-title function_">getCameraManager</span>(context);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getCameraManager error, errCode: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> cameraManager;</li><li>}</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>如果获取对象失败，说明相机可能被占用或无法使用。如果被占用，须等到相机被释放后才能重新获取。</p>        </div></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager" target="_blank">CameraManager</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getsupportedcameras" target="_blank">getSupportedCameras</a>方法，获取当前设备支持的相机列表，列表中存储了设备支持的所有相机ID。若列表不为空，则说明列表中的每个ID都支持独立创建相机对象；否则，说明当前设备无可用相机，不可继续后续操作。</p>       <div _ngcontent-kpl-c106="" class="highlight-div"><div _ngcontent-kpl-c106="" class="highlight-div-header"><div _ngcontent-kpl-c106="" class="highlight-div-header-left"><div _ngcontent-kpl-c106="" class="handle-button expand-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kpl-c106="" class="highlight-div-header-right"><div _ngcontent-kpl-c106="" class="handle-button ai-button"></div><div _ngcontent-kpl-c106="" class="handle-button line-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kpl-c106="" class="handle-button theme-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kpl-c106="" class="handle-button copy-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kpl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getCameraDevices</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>): <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>  <span class="hljs-keyword">if</span> (cameraArray != <span class="hljs-literal">undefined</span> &amp;&amp; cameraArray.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; cameraArray.<span class="hljs-property">length</span>; index++) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraId : '</span> + cameraArray[index].<span class="hljs-property">cameraId</span>);  <span class="hljs-comment">// 获取相机ID。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraPosition : '</span> + cameraArray[index].<span class="hljs-property">cameraPosition</span>);  <span class="hljs-comment">// 获取相机位置。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraType : '</span> + cameraArray[index].<span class="hljs-property">cameraType</span>);  <span class="hljs-comment">// 获取相机类型。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'connectionType : '</span> + cameraArray[index].<span class="hljs-property">connectionType</span>);  <span class="hljs-comment">// 获取相机连接类型。</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> cameraArray;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"cameraManager.getSupportedCameras error"</span>);</li><li>    <span class="hljs-keyword">return</span> [];</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听相机状态，包括新相机的出现、相机的移除、相机的可用状态。在回调函数中，通过相机ID、相机状态这两个参数进行监听，如当有新相机出现时，可以将新相机加入到应用的备用相机中。</p>     <p>通过注册cameraStatus事件，通过回调返回监听结果，callback返回CameraStatusInfo参数，参数的具体内容可参考相机管理器回调接口实例<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#camerastatusinfo" target="_blank">CameraStatusInfo</a>。</p>     <div _ngcontent-kpl-c106="" class="highlight-div"><div _ngcontent-kpl-c106="" class="highlight-div-header"><div _ngcontent-kpl-c106="" class="highlight-div-header-left"><div _ngcontent-kpl-c106="" class="handle-button expand-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kpl-c106="" class="highlight-div-header-right"><div _ngcontent-kpl-c106="" class="handle-button ai-button"></div><div _ngcontent-kpl-c106="" class="handle-button line-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kpl-c106="" class="handle-button theme-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kpl-c106="" class="handle-button copy-button"><div _ngcontent-kpl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kpl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onCameraStatusChange</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>): <span class="hljs-built_in">void</span> {</li><li>  cameraManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'cameraStatus'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, cameraStatusInfo: camera.CameraStatusInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Callback Error, errorCode: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 如果当通过USB连接相机设备时，回调函数会返回新的相机出现状态。</span></li><li>    <span class="hljs-keyword">if</span> (cameraStatusInfo.<span class="hljs-property">status</span> == camera.<span class="hljs-property">CameraStatus</span>.<span class="hljs-property">CAMERA_STATUS_APPEAR</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`New Camera device appear.`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 如果当断开相机设备USB连接时，回调函数会返回相机被移除状态。</span></li><li>    <span class="hljs-keyword">if</span> (cameraStatusInfo.<span class="hljs-property">status</span> == camera.<span class="hljs-property">CameraStatus</span>.<span class="hljs-property">CAMERA_STATUS_DISAPPEAR</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Camera device has been removed.`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 相机被关闭时，回调函数会返回相机可用状态。</span></li><li>    <span class="hljs-keyword">if</span> (cameraStatusInfo.<span class="hljs-property">status</span> == camera.<span class="hljs-property">CameraStatus</span>.<span class="hljs-property">CAMERA_STATUS_AVAILABLE</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Current Camera is available.`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 相机被打开/占用时，回调函数会返回相机不可用状态。</span></li><li>    <span class="hljs-keyword">if</span> (cameraStatusInfo.<span class="hljs-property">status</span> == camera.<span class="hljs-property">CameraStatus</span>.<span class="hljs-property">CAMERA_STATUS_UNAVAILABLE</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Current Camera has been occupied.`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`camera: <span class="hljs-subst">${cameraStatusInfo.camera.cameraId}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`status: <span class="hljs-subst">${cameraStatusInfo.status}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>