<h1 _ngcontent-yyu-c119="" class="doc-title ng-star-inserted" title="知识加工"> 知识加工 </h1>

<div _ngcontent-yyu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>知识加工是指根据实际业务数据生成知识库的能力，主要包含以下两个方面：</p>    <ul>     <li>通过配置schema生成知识加工的产物（如倒排表、向量库、向量表），这些产物最终用于知识问答过程中的检索。schema的配置应基于实际业务使用的数据库及数据表结构。知识加工和检索对中文处理进行了优化，因此中文问答的效果优于英文。</li>     <li>通过调用获取知识加工状态的接口，查询当前的加工状态。</li>    </ul>    <p>知识加工生成的知识表结构如下：</p>    <div class="tablenoborder">     <a name="ZH-CN_TOPIC_0000002342660658__table1186182016388"></a><a name="table1186182016388"></a>     <div class="tbBox"><table id="table1186182016388" class="layoutFixed idpTab">      <caption>       <b>表1 </b>倒排表结构      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.4.1.1" valign="top" width="33.33333333333333%">         <p>列名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.4.1.2" valign="top" width="33.33333333333333%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.2.4.1.3" valign="top" width="33.33333333333333%">         <p>定义</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>reference_id</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>UNINDEXED</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>关联id，与业务表主键id对应。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_id</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>UNINDEXED</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>用于标识每一个切分后的Chunk。一个Chunk代表需要进行知识加工的文本的一个切片。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_source</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>UNINDEXED</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>每个Chunk在业务表中的字段归属。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_text</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>TEXT</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>倒排索引字段，每个Chunk的文本内容。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tablenoborder">     <a name="ZH-CN_TOPIC_0000002342660658__table57920393405"></a><a name="table57920393405"></a>     <div class="tbBox"><table id="table57920393405" class="layoutFixed idpTab">      <caption>       <b>表2 </b>向量表结构      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.4.1.1" valign="top" width="33.33333333333333%">         <p>列名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.4.1.2" valign="top" width="33.33333333333333%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.2.4.1.3" valign="top" width="33.33333333333333%">         <p>含义</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>id</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>INTEGER</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>自增主键。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>reference_id</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>INTEGER</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>关联id，与业务表主键id对应。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_id</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>TEXT</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>用于标识每一个切分后的Chunk。一个Chunk代表需要进行知识加工的文本的一个切片。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_source</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>TEXT</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>每个Chunk在业务表中的字段归属。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>repr</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>FLOATVECTOR(128)</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>chunk_id对应的文本的向量表征。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>Scalar</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>TEXT</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>Schema中定义的所有标量字段，类型均为TEXT。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section4330121518103">触发知识加工的时机<i class="anchor-icon anchor-icon-link" anchorid="section4330121518103" tips="复制节点链接"></i></h2>          <p>触发知识加工包含下列两种情况。</p>     <ul>      <li>通过<a href="/consumer/cn/doc/harmonyos-guides/data-augmentation-knowledge-processing#li1041155415158">步骤1</a>、<a href="/consumer/cn/doc/harmonyos-guides/data-augmentation-knowledge-processing#li7681121661620">步骤2</a>配置knowledge_schema.json和开库参数后，每次开库都会启动一次知识加工任务。</li>      <li>当已经成功开库并且存在一个活跃的数据库连接时，数据源表发生数据变更（插入、更新、删除）时会自动触发加工任务。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section13189205451011">约束限制<i class="anchor-icon anchor-icon-link" anchorid="section13189205451011" tips="复制节点链接"></i></h2>          <ol>      <li>知识加工使用的表不支持同时进行端端同步、端云同步以及搜索。</li>      <li>知识加工schema不支持升级。</li>      <li>知识加工数据向量化能力目前只支持PC/2in1上使用，Phone、Tablet不支持。</li>      <li>知识加工schema中version字段值为正整数，最大值为2147483647。</li>      <li>知识加工schema中dbName字段值的最小长度为1，最大长度为120，支持数字、大小写字母、下划线和字符“.”。</li>      <li>知识加工schema中tableName字段值的最小长度为1，最大长度为120，支持数字、大小写字母和下划线_。</li>      <li>知识加工schema中columnName字段值的最小长度为1，最大长度为255。</li>      <li>知识加工schema中referenceFields仅支持一个字段，且字段为整数类型，字段值最小长度为1，最大长度为255。</li>      <li>知识加工schema中每个知识字段的type值支持的类型有Text（纯文本知识加工字段）、Scalar（标量字段）和Json（Json格式的知识加工字段）。</li>      <li>知识加工schema中类型为Scalar的知识字段必须包含description字段，字段值最小长度为1，最大长度为255。Scalar字段不会进行知识加工，内容与业务表对应字段保持一致。</li>      <li>知识加工schema中类型为Json的知识字段必须包含parser字段，用于指定文件路径的解析器。每个Json字段允许定义的parser数量范围是[1, 5]，最多支持提取5个不同的本地文件路径。</li>      <li>知识加工schema中parser字段值的每个对象必填type和path，其中type为File，path的长度范围是[1，255]。path必须是合法的Json路径表达式，用于表示知识加工需要解析的文件路径。</li>      <li>知识加工schema中的pipelineHandlers字段用于定义知识加工时各处理模块（Handler）的执行顺序。Handler可自定义，可配置，通过合理修改Handler的流程，可以控制原始数据如何被解析、切分、表征，最终写入倒排表与向量表，具体位置可以参考开发步骤1中的示例。配置为一个映射（unordered_map&lt;string, vector&lt;string&gt;&gt;），每个键为当前Handler，值为其后续执行的Handler列表，参考示例：       <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"pipelineHandlers"</span>: </li><li>{</li><li>  <span class="hljs-string">"FileParserHandler"</span>: [<span class="hljs-string">"SplitTextHandler"</span>],  </li><li>  <span class="hljs-string">"SplitTextHandler"</span>: [<span class="hljs-string">"TextEmbeddingHandler"</span>],</li><li>  <span class="hljs-string">"TextEmbeddingHandler"</span>: [<span class="hljs-string">"ImageEmbeddingHandler"</span>],</li><li>  <span class="hljs-string">"ImageEmbeddingHandler"</span>: []</li><li>}</li></ol></pre></div></div>       <p>其中，所有的Handler名称必须是系统支持的类型，当前支持的包括：FileParserHandler、SplitTextHandler、TextEmbeddingHandler、ImageEmbeddingHandler。推荐的标准执行流程为：</p>       <ul>        <li>FileParserHandler → SplitTextHandler → TextEmbeddingHandler → ImageEmbeddingHandler。</li>       </ul>       <p>Handler之间不能出现循环依赖，否则系统会在加载schema时报错。每个Handler的下游可以为空数组，表示加工流程在此结束。如果配置顺序错误（如跳过某些处理器、顺序不通或形成闭环），可能导致文件未处理、加工流程中断或初始化失败。可根据实际场景适当简化，例如仅加工倒排索引时只配置SplitTextHandler。各Handler功能与依赖说明如下：</p>       <ul>        <li>FileParserHandler：提取Json字段中所指向本地文件的文本内容，支持格式：doc、docx、ppt、pptx、xls、xlsx、html、txt、pdf、png、jpg、jpeg。文本类文件会提取正文内容，图片文件会通过OCR提取可识别文本。不依赖其他Handler。         <p>推荐组合：建议放在SplitTextHandler之前，使提取出的文件内容能被切分、表征。</p>         <p>不配置影响：Json字段内文件不会被解析，倒排和向量中均无这些内容（不影响图片向量表征）。</p></li>        <li>SplitTextHandler：对文本字段进行两级切分：第一级chunk：用于倒排索引；第二级segment：用于向量表征（Embedding）。         <p>推荐组合：必须在TextEmbeddingHandler之前；否则向量表征阶段缺少segment，后续表征失败。</p>         <p>不配置影响：倒排表和向量表都无文本内容，检索无法返回文本相关内容。</p></li>        <li>TextEmbeddingHandler：对SplitTextHandler产生的segment进行文本向量表征，生成供向量检索使用的数据。依赖SplitTextHandler的结果。         <p>推荐组合：放在SplitTextHandler之后、ImageEmbeddingHandler 之前。</p>         <p>不配置影响：文本表征结果不会进入向量表，影响语义搜索。</p></li>        <li>ImageEmbeddingHandler：根据Json字段解析后的图像路径加载图片，并对图像特征进行向量表征。图片处理不依赖SplitTextHandler，也不会参与文本倒排表。无依赖（独立于文本处理流程）。         <p>推荐组合：放在TextEmbeddingHandler之后，避免图片路径字段被误当作文本参与表征，产生噪声。</p>         <p>不配置影响：图像表征结果不会进入向量表，影响图片相关搜索。</p></li>       </ul></li>      <li>知识加工schema中的knowledgeProcess字段为可选项，用于设置知识加工参数配置，包括三个字段：表征模型设置（embeddingModelCfg），文本切分设置（chunkSplitter）和文件预处理限制（perRecordLimit），可以参考开发步骤1中的示例。配置knowledgeProcess字段无需配置全部的三个字段，但其下每个字段（embeddingModelCfg、chunkSplitter、perRecordLimit）一旦出现，对应的子字段内部的内容均为必填，不允许部分配置。       <ul>        <li>知识加工schema中，若knowledgeProcess中配置了embeddingModelCfg字段，则必须包含modelVersion字段，类型为字符串，表示所使用的向量表征模型版本。字段值最大长度为100，若为空字符串会使用默认版本。该字段值需与实际部署或支持的模型版本匹配，且知识加工的表征模型版本需要和推理的版本一致，当前默认值为"default"。</li>        <li>知识加工schema中，若knowledgeProcess字段中配置了chunkSplitter字段，则需同时配置以下三个子字段，均为必填项：         <ul>          <li>chunkSize：每个Chunk的最大长度，整数类型，取值范围为[100, 5000]，默认值为3072；</li>          <li>segmentSize：Chunk内部分段的最大长度，是向量表征的单位，整数类型，取值范围为[128, 512]，默认值为300；</li>          <li>overlapRatio：相邻Chunk之间的重叠比例，浮点数类型，取值范围为(0.0, 0.3]，默认值为0.1。</li>         </ul></li>       </ul>       <p>这些参数用于控制文本切分策略，影响切分粒度、上下文连续性。如果未配置，则系统将使用上述默认值。</p>       <ul>        <li>知识加工schema中，若knowledgeProcess中配置了perRecordLimit字段，则需同时配置以下三个字段，均为必填项：         <ul>          <li>parseFileMaxCnt：每条记录最多允许解析的文件数，整数类型，取值范围为[0, 200]，默认值为10；</li>          <li>textEmbeddingMaxCnt：每条记录最多进行向量表征的文本段数量，整数类型，取值范围为[0, 200]，默认值为50，超出限制的文本段不会被表征；</li>          <li>imageEmbeddingMaxCnt：每条记录最多进行处理的图片数量，整数类型，取值范围为[0, 200]，默认值为10。</li>         </ul></li>       </ul>       <p>这些参数用于限制单条记录在知识加工过程中的最大处理规模。如果未配置，则系统将采用默认值。设定过小可能导致信息加工不全，设定过大则可能导致系统资源消耗过大。</p></li>      <li>知识加工schema文件名必须为knowledge_schema.json，文件内容必须是合法的Json字符串，放置在src/main/resources/rawfile/arkdata/knowledge/路径下。</li>      <li>知识加工支持处理如下文件类型：       <ul>        <li>文本和网页类型：txt、html；</li>        <li>办公文件类型：doc、docx、ppt、pptx、xls、xlsx、pdf，仅支持纯文本的基本处理，复杂或特定内容可由应用侧自行解析处理后转成txt格式进行后续加工；</li>        <li>图片类型：jpeg、jpg、png。</li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section482692385711">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section482692385711" tips="复制节点链接"></i></h2>          <p>知识加工关键接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section10914338105311" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.3.1.1" valign="top" width="71.02000000000001%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.3.1.2" valign="top" width="28.98%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="71.02000000000001%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section4623141252" target="_blank">getKnowledgeProcessor</a>(context: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-basecontext" target="_blank">common.BaseContext</a>, config: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section7916104025215" target="_blank">KnowledgeProcessorConfig</a>): Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section395619456396" target="_blank">KnowledgeProcessor</a>&gt;</p></td>         <td class="cellrowborder" valign="top" width="28.98%">          <p>获取知识加工对象，用于获取知识加工状态等操作。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="71.02000000000001%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section1172685711116" target="_blank">getStatus</a>(): Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section174782032163713" target="_blank">ProcessorStatus</a>&gt;</p></td>         <td class="cellrowborder" valign="top" width="28.98%">          <p>获取知识加工状态。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="71.02000000000001%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-f#relationalstoregetrdbstore-1" target="_blank">getRdbStore</a>(context: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>, config: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-i#storeconfig" target="_blank">StoreConfig</a>): Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-rdbstore" target="_blank">RdbStore</a>&gt;</p></td>         <td class="cellrowborder" valign="top" width="28.98%">          <p>创建或打开已有的关系型数据库，按照<a href="/consumer/cn/doc/harmonyos-guides/data-augmentation-knowledge-processing#li7681121661620">步骤2</a>配置开库参数后，调用该接口可触发知识加工。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section912287171317">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section912287171317" tips="复制节点链接"></i></h2>          <ol>      <li id="li1041155415158"><span>配置知识加工schema文件knowledge_schema.json，下文是配置示例，实际文件内容请根据业务需要进行配置。知识加工产物命名规则如下：</span>       <p></p>       <ul>        <li>倒排库与数据源库是同一个数据库。</li>        <li>倒排表名相较于数据源表名增加了"_inverted"后缀（email-&gt;email_inverted）。</li>        <li>向量库名相较于数据源库名增加了"_vector"后缀（testmail_store.db-&gt;testmail_store_vector.db）。</li>        <li>向量表名相较于数据源表名增加了"_vector"后缀（email-&gt;email_vector）。         <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径：src/main/resources/rawfile/arkdata/knowledge/knowledge_schema.json</span></li><li><span class="hljs-comment">// 项目中没有该目录请递归创建</span></li><li><span class="hljs-comment">// 实际使用时请去除注释，示例中增加注释仅作字段说明用</span></li><li>{</li><li>  <span class="hljs-string">"knowledgeSource"</span>: [{</li><li>    <span class="hljs-string">"version"</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-string">"dbName"</span>: <span class="hljs-string">"testmail_store.db"</span>,  <span class="hljs-comment">// 存储原始数据的数据库文件名</span></li><li>    <span class="hljs-string">"tables"</span>: [{</li><li>      <span class="hljs-string">"tableName"</span>: <span class="hljs-string">"email"</span>,  <span class="hljs-comment">// 用于知识加工的表名</span></li><li>      <span class="hljs-string">"referenceFields"</span>: [<span class="hljs-string">"id"</span>],  <span class="hljs-comment">// 知识数据源引用字段，用于关联知识库中的数据</span></li><li>      <span class="hljs-string">"knowledgeFields"</span>: [{  <span class="hljs-comment">// 关注的知识字段</span></li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"subject"</span>,  <span class="hljs-comment">// 关注的字段名称</span></li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Text"</span>]  <span class="hljs-comment">// 关注的字段类型，Text则表示要做向量和倒排</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"content"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Text"</span>]</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"image_text"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Text"</span>]</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"attachment_names"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Text"</span>]</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"inline_files"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Json"</span>],</li><li>        <span class="hljs-string">"parser"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"type"</span>: <span class="hljs-string">"File"</span>,</li><li>            <span class="hljs-string">"path"</span>: <span class="hljs-string">"$[*].uri"</span>  <span class="hljs-comment">// path字段的值为Json路径表达式</span></li><li>          }</li><li>        ]</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"sender"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Scalar"</span>],  <span class="hljs-comment">// Scalar表示标量字段，不做加工，直接写到向量数据表中对应的列，用于标量检索过滤</span></li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"sender"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"receivers"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Scalar"</span>],</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"receivers"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"columnName"</span>: <span class="hljs-string">"received_date"</span>,</li><li>        <span class="hljs-string">"type"</span>: [<span class="hljs-string">"Scalar"</span>],</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"received_date"</span></li><li>      }],</li><li>      <span class="hljs-string">"pipelineHandlers"</span>: {</li><li>        <span class="hljs-string">"FileParserHandler"</span>: [<span class="hljs-string">"SplitTextHandler"</span>],  <span class="hljs-comment">// 表示文件解析完成后交由文本切分处理器SplitTextHandler进行处理</span></li><li>        <span class="hljs-string">"SplitTextHandler"</span>: [<span class="hljs-string">"TextEmbeddingHandler"</span>],</li><li>        <span class="hljs-string">"TextEmbeddingHandler"</span>: [<span class="hljs-string">"ImageEmbeddingHandler"</span>],</li><li>        <span class="hljs-string">"ImageEmbeddingHandler"</span>: []</li><li>      }</li><li>    }],</li><li>    <span class="hljs-string">"knowledgeProcess"</span>: {</li><li>      <span class="hljs-string">"embeddingModelCfg"</span>:</li><li>      {</li><li>        <span class="hljs-string">"modelVersion"</span>: <span class="hljs-string">"default"</span>  <span class="hljs-comment">// 向量表征模型，"default" 表示默认版本</span></li><li>      },</li><li>      <span class="hljs-string">"chunkSplitter"</span>:</li><li>      {</li><li>        <span class="hljs-string">"chunkSize"</span>: <span class="hljs-number">3072</span>,</li><li>        <span class="hljs-string">"segmentSize"</span>: <span class="hljs-number">300</span>,</li><li>        <span class="hljs-string">"overlapRatio"</span>: <span class="hljs-number">0.1</span></li><li>      },</li><li>      <span class="hljs-string">"perRecordLimit"</span>:</li><li>      {</li><li>        <span class="hljs-string">"parseFileMaxCnt"</span>: <span class="hljs-number">10</span>,</li><li>        <span class="hljs-string">"textEmbeddingMaxCnt"</span>: <span class="hljs-number">50</span>,</li><li>        <span class="hljs-string">"imageEmbeddingMaxCnt"</span>: <span class="hljs-number">10</span></li><li>      }</li><li>    }</li><li>  }]</li><li>}</li></ol></pre></div></div></li>       </ul>       <p></p></li>      <li id="li7681121661620"><span>配置数据源库<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-i#storeconfig" target="_blank">开库参数</a>，根据业务需要预置数据。下文是示例代码片段，仅供参考，具体实现方式请根据业务需要调整。</span>       <p></p>       <div class="p">        schema示例中inline_files列配置的type为Json，且其path字段为指向uri的路径表达式，那么知识加工会去数据库中的inline_files字段解析uri对应的值作为文件路径。inline_files列的数据值应该为示例代码中所示的文件路径的对象数组形式。加工时会根据获取的文件路径对应的文件内容进行知识构建。        <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">          <ul>           <li>relationalStore开库参数配置中的name字段需要与<a href="/consumer/cn/doc/harmonyos-guides/data-augmentation-knowledge-processing#li1041155415158">1</a>中"dbName"字段保持一致，并且enableSemanticIndex字段需要设置为true才会触发知识加工。</li>           <li>建表语句中的表名需要与<a href="/consumer/cn/doc/harmonyos-guides/data-augmentation-knowledge-processing#li1041155415158">1</a>中"tableName"字段保持一致，列名与"columnName"字段保持一致。</li>          </ul>         </div></div></div>       </div>       <div class="p">        <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">relationalStore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-comment">// relationalStore开库参数配置</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">storeConfig</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">StoreConfig</span> = {</li><li>  <span class="hljs-variable">name</span>: <span class="hljs-string">'testmail_store.db'</span>,  <span class="hljs-comment">// 注意与步骤1中"dbName"字段保持一致</span></li><li>  <span class="hljs-variable">securityLevel</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">SecurityLevel</span>.<span class="hljs-title class_">S3</span>,</li><li>  <span class="hljs-variable">enableSemanticIndex</span>: <span class="hljs-keyword">true</span>,  <span class="hljs-comment">// 注意该项设为true才会触发知识加工</span></li><li>  <span class="hljs-variable">tokenizer</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">Tokenizer</span>.<span class="hljs-title class_">CUSTOM_TOKENIZER</span></li><li>};</li><li>
</li><li><span class="hljs-comment">// 建表语句，注意表名应与步骤1中"tableName"字段保持一致，列名与"columnName"字段保持一致</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">createTableSql</span> = <span class="hljs-string">"CREATE TABLE IF NOT EXISTS email(id integer primary key, subject text, "</span> +</li><li>  <span class="hljs-string">"content text, image_text text, attachment_names text, inline_files text, sender text, "</span> +</li><li>  <span class="hljs-string">"receivers text, received_date text);"</span>;</li><li>
</li><li><span class="hljs-comment">// 插入数据语句，请按实际业务需要实现，下文仅作参考</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">sql</span> = `<span class="hljs-variable">insert</span> <span class="hljs-variable">or</span> <span class="hljs-variable">replace</span> <span class="hljs-variable">into</span> <span class="hljs-variable">email</span> <span class="hljs-title function_">VALUES</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'Subject of an email'</span>, <span class="hljs-string">'Content of an email'</span>,</li><li>  <span class="hljs-string">'Convert image to text through OCR'</span>, <span class="hljs-string">'attachment_name_1.txt'</span>,</li><li>  <span class="hljs-string">'[{"uri":"/data/storage/el2/base/haps/entry/files/capture_1.png"},{"uri":"/data/storage/el2/base/haps/entry/files/capture_2.jpeg"}]'</span>,</li><li>  <span class="hljs-string">'zhangsan(zhangsan@xxx.com)'</span>, <span class="hljs-string">'lisi(lisi@xxx.com), wangwu(wangwu@xxx.com)'</span>, <span class="hljs-string">'Convert time to timestamp'</span>);`;</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>可根据业务需要，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-knowledgeprocessor-api#section1172685711116" target="_blank">getStatus()</a>接口，查询当前的知识加工状态。</span>       <p></p>       <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">relationalStore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">knowledgeProcessor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">UIAbility</span>, <span class="hljs-variable">common</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// relationalStore开库参数配置</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">storeConfig</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">StoreConfig</span> = {</li><li>  <span class="hljs-variable">name</span>: <span class="hljs-string">'testmail_store.db'</span>,  <span class="hljs-comment">// 注意与步骤1中"dbName"字段保持一致</span></li><li>  <span class="hljs-variable">securityLevel</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">SecurityLevel</span>.<span class="hljs-title class_">S3</span>,</li><li>  <span class="hljs-variable">enableSemanticIndex</span>: <span class="hljs-keyword">true</span>,</li><li>  <span class="hljs-variable">tokenizer</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">Tokenizer</span>.<span class="hljs-title class_">CUSTOM_TOKENIZER</span></li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">knowledgeSourceConfig</span>: <span class="hljs-title class_">knowledgeProcessor</span>.<span class="hljs-title class_">KnowledgeSourceConfig</span> = {</li><li>  <span class="hljs-variable">rdbSource</span>: <span class="hljs-title class_">storeConfig</span>,</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">knowledgeProcessorConfig</span>: <span class="hljs-title class_">knowledgeProcessor</span>.<span class="hljs-title class_">KnowledgeProcessorConfig</span> = {</li><li>  <span class="hljs-variable">sourceConfig</span>: <span class="hljs-title class_">knowledgeSourceConfig</span>,</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取知识加工状态的异步函数，业务自行按需调用</span></li><li><span class="hljs-variable">async</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">getStatus</span>() {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">context</span> = <span class="hljs-variable">AppStorage</span>.<span class="hljs-variable">get</span>&lt;<span class="hljs-title class_">common</span>.<span class="hljs-title class_">UIAbilityContext</span>&gt;(<span class="hljs-string">"Context"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 获取知识加工对象</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">processor</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">knowledgeProcessor</span>.<span class="hljs-title function_">getKnowledgeProcessor</span>(<span class="hljs-variable">context</span>, <span class="hljs-variable">knowledgeProcessorConfig</span>);</li><li>    <span class="hljs-comment">// 获取知识加工状态</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">status</span>: <span class="hljs-title class_">knowledgeProcessor</span>.<span class="hljs-title class_">ProcessorStatus</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">processor</span>.<span class="hljs-title function_">getStatus</span>();</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">status</span>;</li><li>  } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>    <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error: "</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span> + <span class="hljs-string">" code: "</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">undefined</span>;</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>