<h1 _ngcontent-iyg-c119="" class="doc-title ng-star-inserted" title="短时任务(C/C++)"> 短时任务(C/C++) </h1>

<div _ngcontent-iyg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>应用退至后台一小段时间后，应用进程会被挂起，无法执行对应的任务。如果应用在后台仍需要执行耗时不长的任务，如状态保存等，可以通过本文申请短时任务，扩展应用在后台的运行时间。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>常用接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-transient-task-api-h#函数" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-transient-task-api-h#oh_backgroundtaskmanager_requestsuspenddelay" target="_blank">int32_t OH_BackgroundTaskManager_RequestSuspendDelay(const char *reason, TransientTask_Callback callback, TransientTask_DelaySuspendInfo *info)</a></td>         <td class="cellrowborder" valign="top" width="50%">申请短时任务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-transient-task-api-h#oh_backgroundtaskmanager_getremainingdelaytime" target="_blank">int32_t OH_BackgroundTaskManager_GetRemainingDelayTime(int32_t requestId, int32_t *delayTime)</a></td>         <td class="cellrowborder" valign="top" width="50%">获取对应短时任务的剩余时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-transient-task-api-h#oh_backgroundtaskmanager_cancelsuspenddelay" target="_blank">int32_t OH_BackgroundTaskManager_CancelSuspendDelay(int32_t requestId)</a></td>         <td class="cellrowborder" valign="top" width="50%">取消短时任务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-transient-task-api-h#oh_backgroundtaskmanager_gettransienttaskinfo" target="_blank">int32_t OH_BackgroundTaskManager_GetTransientTaskInfo(TransientTask_TransientTaskInfo *transientTaskInfo)</a></td>         <td class="cellrowborder" valign="top" width="50%">获取所有短时任务信息，如当日剩余总配额等。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="在napi_initcpp文件中封装接口并注册模块" class="firsth2">在napi_init.cpp文件中封装接口并注册模块<i class="anchor-icon anchor-icon-link" anchorid="在napi_initcpp文件中封装接口并注册模块" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>封装函数</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="C prettyprint linenums hljs language-C" hw-language="C" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"transient_task/transient_task_api.h"</span></span></li><li>
</li><li>TransientTask_DelaySuspendInfo delaySuspendInfo;</li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">callback</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></li><li>{</li><li>   <span class="hljs-comment">// 短时任务即将结束，业务在这里取消短时任务</span></li><li>   OH_BackgroundTaskManager_CancelSuspendDelay(delaySuspendInfo.requestId);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 申请短时任务</span></li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">RequestSuspendDelay</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>      napi_value result;</li><li>      <span class="hljs-type">int32_t</span> res = OH_BackgroundTaskManager_RequestSuspendDelay(<span class="hljs-string">"test"</span>, callback, &amp;delaySuspendInfo);</li><li>      <span class="hljs-keyword">if</span> (res == <span class="hljs-number">0</span>) {</li><li>         napi_create_int32(env, delaySuspendInfo.requestId, &amp;result);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>         napi_create_int32(env, <span class="hljs-number">-1</span>, &amp;result);</li><li>      }</li><li>      <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取剩余时间</span></li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">GetRemainingDelayTime</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>      napi_value result;</li><li>      <span class="hljs-type">int32_t</span> delayTime = <span class="hljs-number">0</span>;</li><li>      <span class="hljs-type">int32_t</span> res = OH_BackgroundTaskManager_GetRemainingDelayTime(delaySuspendInfo.requestId, &amp;delayTime);</li><li>      <span class="hljs-keyword">if</span> (res == <span class="hljs-number">0</span>) {</li><li>         napi_create_int32(env, delayTime, &amp;result);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>         napi_create_int32(env, <span class="hljs-number">-1</span>, &amp;result);</li><li>      }</li><li>      <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 取消短时任务</span></li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">CancelSuspendDelay</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>      napi_value result;</li><li>      <span class="hljs-type">int32_t</span> res = OH_BackgroundTaskManager_CancelSuspendDelay(delaySuspendInfo.requestId);</li><li>      napi_create_int32(env, res, &amp;result);</li><li>      <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取所有短时任务信息</span></li><li>TransientTask_TransientTaskInfo transientTaskInfo;</li><li>
</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">GetTransientTaskInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>   napi_value result;</li><li>   napi_create_object(env, &amp;result);</li><li>   <span class="hljs-type">int32_t</span> res = OH_BackgroundTaskManager_GetTransientTaskInfo(&amp;transientTaskInfo);</li><li>   napi_value napiRemainingQuota = nullptr;</li><li>   <span class="hljs-comment">// 获取成功，格式化数据并返回给接口</span></li><li>   <span class="hljs-keyword">if</span> (res == <span class="hljs-number">0</span>) {</li><li>      napi_create_int32(env, transientTaskInfo.remainingQuota, &amp;napiRemainingQuota);</li><li>      napi_set_named_property(env, result, <span class="hljs-string">"remainingQuota"</span>, napiRemainingQuota); <span class="hljs-comment">// 格式化当日总配额</span></li><li>
</li><li>      napi_value info {nullptr};</li><li>      napi_create_array(env, &amp;info);</li><li>      <span class="hljs-type">uint32_t</span> count = <span class="hljs-number">0</span>;</li><li>      <span class="hljs-comment">// 格式化所有已申请的短时任务信息</span></li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">3</span>; index++) {</li><li>         <span class="hljs-keyword">if</span> (transientTaskInfo.transientTasks[index].requestId == <span class="hljs-number">0</span>) {</li><li>             <span class="hljs-keyword">continue</span>;</li><li>         }</li><li>         </li><li>         napi_value napiWork = nullptr;</li><li>         napi_create_object(env, &amp;napiWork);</li><li>
</li><li>         napi_value napiRequestId = nullptr;</li><li>         napi_create_int32(env, transientTaskInfo.transientTasks[index].requestId, &amp;napiRequestId);</li><li>         napi_set_named_property(env, napiWork, <span class="hljs-string">"requestId"</span>, napiRequestId);</li><li>
</li><li>         napi_value napiActualDelayTime = nullptr;</li><li>         napi_create_int32(env, transientTaskInfo.transientTasks[index].actualDelayTime, &amp;napiActualDelayTime);</li><li>         napi_set_named_property(env, napiWork, <span class="hljs-string">"actualDelayTime"</span>, napiActualDelayTime);</li><li>
</li><li>         napi_set_element(env, info, count, napiWork);</li><li>         count++;</li><li>      }</li><li>      napi_set_named_property(env, result, <span class="hljs-string">"transientTasks"</span>, info);</li><li>   } <span class="hljs-keyword">else</span> {</li><li>      napi_create_int32(env, <span class="hljs-number">0</span>, &amp;napiRemainingQuota);</li><li>      napi_set_named_property(env, result, <span class="hljs-string">"remainingQuota"</span>, napiRemainingQuota);</li><li>      napi_value info {nullptr};</li><li>      napi_create_array(env, &amp;info);</li><li>      napi_set_named_property(env, result, <span class="hljs-string">"transientTasks"</span>, info);</li><li>   }</li><li>   <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>注册函数</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="C prettyprint linenums hljs language-C" hw-language="C" data-highlighted="yes"><ol class="linenums"><li>EXTERN_C_START</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></li><li>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"RequestSuspendDelay"</span>, nullptr, RequestSuspendDelay, nullptr, nullptr, nullptr, napi_default, nullptr},</li><li>        {<span class="hljs-string">"GetRemainingDelayTime"</span>, nullptr, GetRemainingDelayTime, nullptr, nullptr, nullptr, napi_default, nullptr},</li><li>        {<span class="hljs-string">"CancelSuspendDelay"</span>, nullptr, CancelSuspendDelay, nullptr, nullptr, nullptr, napi_default, nullptr},</li><li>        {<span class="hljs-string">"GetTransientTaskInfo"</span>, nullptr, GetTransientTaskInfo, nullptr, nullptr, nullptr, napi_default, nullptr },</li><li>    };</li><li>    napi_define_properties(env, exports, <span class="hljs-keyword">sizeof</span>(desc) / <span class="hljs-keyword">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>      <li>       <p>注册模块</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="C prettyprint linenums hljs language-C" hw-language="C" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = nullptr,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>),</li><li>    .reserved = { <span class="hljs-number">0</span> },</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-type">void</span> <span class="hljs-title function_">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></li><li>{</li><li>    napi_module_register(&amp;demoModule);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="在indexdts文件中声明函数">在index.d.ts文件中声明函数<i class="anchor-icon anchor-icon-link" anchorid="在indexdts文件中声明函数" tips="复制节点链接"></i></h3>          <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> backgroundTaskManager <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BackgroundTasksKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">RequestSuspendDelay</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">GetRemainingDelayTime</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">CancelSuspendDelay</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">GetTransientTaskInfo</span>: <span class="hljs-function">() =&gt;</span> backgroundTaskManager.<span class="hljs-property">TransientTaskInfo</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在indexets文件中调用函数">在index.ets文件中调用函数<i class="anchor-icon anchor-icon-link" anchorid="在indexets文件中调用函数" tips="复制节点链接"></i></h3>          <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testTransientTask <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'申请短时任务'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">RequestSuspendDelay</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取剩余时间'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">GetRemainingDelayTime</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'取消短时任务'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CancelSuspendDelay</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'获取所有短时任务信息'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">GetTransientTaskInfo</span>();</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>     }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">RequestSuspendDelay</span>() {</li><li>    <span class="hljs-keyword">let</span> requestId = testTransientTask.<span class="hljs-title class_">RequestSuspendDelay</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The return requestId is "</span> + requestId);</li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">GetRemainingDelayTime</span>() {</li><li>    <span class="hljs-keyword">let</span> time = testTransientTask.<span class="hljs-title class_">GetRemainingDelayTime</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The time is "</span> + time);</li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">CancelSuspendDelay</span>() {</li><li>    <span class="hljs-keyword">let</span> ret = testTransientTask.<span class="hljs-title class_">CancelSuspendDelay</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The ret is "</span> + ret);</li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">GetTransientTaskInfo</span>() {</li><li>    <span class="hljs-keyword">let</span> ret = testTransientTask.<span class="hljs-title class_">GetTransientTaskInfo</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"The ret is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(ret));</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="配置库依赖">配置库依赖<i class="anchor-icon anchor-icon-link" anchorid="配置库依赖" tips="复制节点链接"></i></h3>          <p>配置CMakeLists.txt，本模块需要用到的共享库是libtransient_task.so，在工程自动生成的CMakeLists.txt中的target_link_libraries中添加此共享库。</p>     <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libace_napi.z.so libtransient_task.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="测试步骤">测试步骤<i class="anchor-icon anchor-icon-link" anchorid="测试步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>连接设备并运行程序。</p></li>      <li>       <p>点击 申请短时任务 按钮，控制台会打印日志，示例如下：</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li>The <span class="hljs-keyword">return</span> requestId <span class="hljs-keyword">is</span> <span class="hljs-number">1</span></li></ol></pre></div></div></li>      <li>       <p>点击 获取剩余时间 按钮，控制台会打印日志，示例如下：</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li>The <span class="hljs-keyword">return</span> requestId <span class="hljs-keyword">is</span> <span class="hljs-number">18000</span></li></ol></pre></div></div></li>      <li>       <p>点击 取消短时任务 按钮，控制台会打印日志，示例如下：</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>The ret <span class="hljs-keyword">is</span> <span class="hljs-number">0</span></li></ol></pre></div></div></li>      <li>       <p>点击 获取所有短时任务信息 按钮，控制台会打印日志，示例如下：</p>       <div _ngcontent-iyg-c106="" class="highlight-div"><div _ngcontent-iyg-c106="" class="highlight-div-header"><div _ngcontent-iyg-c106="" class="highlight-div-header-left"><div _ngcontent-iyg-c106="" class="handle-button expand-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iyg-c106="" class="highlight-div-header-right"><div _ngcontent-iyg-c106="" class="handle-button ai-button"></div><div _ngcontent-iyg-c106="" class="handle-button line-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iyg-c106="" class="handle-button theme-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iyg-c106="" class="handle-button copy-button"><div _ngcontent-iyg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iyg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>The ret <span class="hljs-keyword">is</span> {<span class="hljs-string">"remainingQuota"</span>:<span class="hljs-number">600000</span>,<span class="hljs-string">"transientTasks"</span>:[]}</li></ol></pre></div></div></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>申请短时任务的按钮，不可连续点击超过3次，否则会超出短时任务数量限制并报错。使用过程中更多的约束与限制请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/transient-task#约束与限制">短时任务(ArkTS)</a>。</p>      </div></div></div>    </div>   </div>   <div></div></div>