<h1 _ngcontent-qfh-c119="" class="doc-title ng-star-inserted" title="空域GPU超分"> 空域GPU超分 </h1>

<div _ngcontent-qfh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>XEngine Kit提供空域GPU超分能力，其基于单帧输入图像，使用空间邻域信息实现超采样，开销较小同时收益可观，建议使用超分倍率为[1.2, 1.5]。</p> <div class="tiledSection"><h2 id="section624112515458">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section624112515458" tips="复制节点链接"></i></h2><ul><li>支持的设备类型：Phone，从5.0.2(14)版本开始，新增支持Tablet、PC/2in1设备，从5.1.0(18)版本开始新增支持TV设备。</li><li>可通过以下方式查询相关扩展特性是否支持：<p>- 对于OpenGL ES，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga76f9695fa41c6664e949cdba586699c0" target="_blank">HMS_XEG_GetString</a>扩展特性查询接口进行查询。</p> <p>- 对于Vulkan，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga686e40e383c8e946b36c11b4073e77c3" target="_blank">HMS_XEG_EnumerateDeviceExtensionProperties</a>扩展特性查询接口进行查询。</p> <p>如查询结果包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga099f74840b53904e849c9f308551d8f1" target="_blank">XEG_SPATIAL_UPSCALE_EXTENSION_NAME</a>，则表示支持该特性，若查询结果未包含，则表示不支持该特性。</p> </li></ul> </div> <div class="tiledSection"><h2 id="section5906121818412">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5906121818412" tips="复制节点链接"></i></h2><p>以下接口为OpenGL ES和Vulkan空域GPU超分设置接口，如需使用更丰富的设置和查询接口，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine" target="_blank">接口文档</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="49.94%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50.06%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="49.94%"><p>const GLubyte * HMS_XEG_GetString (GLenum name)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>XEngine OpenGL ES扩展特性查询接口。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>GL_APICALL void GL_APIENTRY HMS_XEG_SpatialUpscaleParameter (GLenum pname, GLvoid *param)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>设置空域GPU超分输入参数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>GL_APICALL void GL_APIENTRY HMS_XEG_RenderSpatialUpscale (GLuint inputTexture)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>执行空域GPU超分渲染命令。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>VKAPI_ATTR VkResult VKAPI_CALL HMS_XEG_EnumerateDeviceExtensionProperties (VkPhysicalDevice physicalDevice, uint32_t *pPropertyCount, XEG_ExtensionProperties *pProperties)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>XEngine Vulkan扩展特性查询接口。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>VKAPI_ATTR VkResult VKAPI_CALL HMS_XEG_CreateSpatialUpscale (VkDevice device, const XEG_SpatialUpscaleCreateInfo *pXegSpatialUpscaleCreateInfo, XEG_SpatialUpscale *pXegSpatialUpscale)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>创建XEG_SpatialUpscale对象。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>VKAPI_ATTR void VKAPI_CALL HMS_XEG_CmdRenderSpatialUpscale (VkCommandBuffer commandBuffer, XEG_SpatialUpscale xegSpatialUpscale, XEG_SpatialUpscaleDescription *pXegSpatialUpscaleDescription)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>执行空域GPU超分渲染命令。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="49.94%"><p>VKAPI_ATTR void VKAPI_CALL HMS_XEG_DestroySpatialUpscale (XEG_SpatialUpscale xegSpatialUpscale)</p> </td> <td class="cellrowborder" valign="top" width="50.06%"><p>销毁XEG_SpatialUpscale对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section9187179113620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9187179113620" tips="复制节点链接"></i></h2></div> <p>本章以OpenGL ES和Vulkan图像API集成为例，说明XEngine集成操作过程。</p> <div class="tiledSection"><h3 id="section102971912165113" class="firsth2">配置项目<i class="anchor-icon anchor-icon-link" anchorid="section102971912165113" tips="复制节点链接"></i></h3><p>编译HAP时，Native层so编译需要依赖NDK中的libxengine.so。</p> <ul><li>头文件引用<p>按需引用XEngine的头文件，如使用OpenGL ES空域GPU超分。</p> <div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_gles_extension.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_gles_spatial_upscale.h&gt;</span></span></li></ol></pre></div></div> <p>按需引用XEngine的头文件，如使用Vulkan空域GPU超分。</p> <div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_vulkan_extension.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;xengine/xeg_vulkan_spatial_upscale.h&gt;</span></span></li></ol></pre></div></div> </li><li>编写CMakeLists.txt<p>按需引用XEngine的CMakeLists，如使用OpenGL ES空域GPU超分功能，CMakeLists.txt部分示例代码如下，完整示例代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-gles-demo-cpp" target="_blank">Demo（GPU加速引擎-GLES）</a>。</p> <div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    xengine-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    xengine</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    EGL-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    EGL</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    GLES-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    GLESv3</li><li>)</li><li>
</li><li><span class="hljs-built_in">target_link_libraries</span>(nativerender PUBLIC</li><li>${EGL-lib} ${GLES-lib} ${xengine-lib})</li></ol></pre></div></div> <p>按需引用XEngine的CMakeLists，如使用Vulkan空域GPU超分功能，CMakeLists.txt部分示例代码如下，完整示例代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-vulkan-demo-cpp" target="_blank">Demo（GPU加速引擎-Vulkan）</a>。</p> <div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    xengine-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    xengine</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    Vulkan-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    vulkan</li><li>)</li><li>
</li><li><span class="hljs-built_in">target_link_libraries</span>(nativerender PUBLIC</li><li>${Vulkan-lib} ${xengine-lib})</li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h3 id="section42501224195218">集成XEngine空域GPU超分（OpenGL ES）<i class="anchor-icon anchor-icon-link" anchorid="section42501224195218" tips="复制节点链接"></i></h3><p>使用EGL和OpenGL ES图形API搭建图像渲染管线并集成空域GPU超分在Native层实现，渲染结果通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件显示到屏幕。</p> <p>本节阐述OpenGL ES图形API的空域GPU超分的使用，详细代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-gles-demo-cpp" target="_blank">Demo（GPU加速引擎-GLES）</a>。</p> <p>在调用XEngine Kit能力前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/syscap#判断-api-是否可以使用" target="_blank">Syscap</a>查询您的目标设备是否支持SystemCapability.Graphic.XEngine系统能力。</p> <ol><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga76f9695fa41c6664e949cdba586699c0" target="_blank">HMS_XEG_GetString</a>接口，获取XEngine支持的扩展信息，只有在支持XEG_SPATIAL_UPSCALE_EXTENSION_NAME扩展时才可以使用空域GPU超分的相关接口。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 查询XEngine支持的GLES扩展信息</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* extensions = (<span class="hljs-type">const</span> <span class="hljs-type">char</span>*)<span class="hljs-built_in">HMS_XEG_GetString</span>(XEG_EXTENSIONS);</li><li><span class="hljs-comment">// 检查是否支持空域GPU超分</span></li><li><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strstr</span>(extensions, XEG_SPATIAL_UPSCALE_EXTENSION_NAME)) {</li><li>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// return error</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol><ol start="2"><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga2417b2947eed13e6b7529e3ae78c495c" target="_blank">HMS_XEG_SpatialUpscaleParameter</a>接口，对空域GPU超分的参数赋值。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// m_sharpness为用户自定义超分锐化参数，此处以参数为0.3f为例</span></li><li><span class="hljs-type">float</span> m_sharpness = <span class="hljs-number">0.3f</span>;</li><li><span class="hljs-comment">// m_renderWidth与m_renderHeight分别为用户自定义的渲染宽度与渲染高度，此处以800*600分辨率为例</span></li><li><span class="hljs-type">uint32_t</span> m_renderWidth = <span class="hljs-number">800</span>;</li><li><span class="hljs-type">uint32_t</span> m_renderHeight = <span class="hljs-number">600</span>;</li><li><span class="hljs-built_in">HMS_XEG_SpatialUpscaleParameter</span>(XEG_SPATIAL_UPSCALE_SHARPNESS, &amp;m_sharpness);</li><li><span class="hljs-comment">// upscaleScissor为超分输入图像的采样区域</span></li><li><span class="hljs-type">int</span> upscaleScissor[<span class="hljs-number">4</span>] = {<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(m_renderWidth), <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(m_renderHeight)}; </li><li><span class="hljs-built_in">HMS_XEG_SpatialUpscaleParameter</span>(XEG_SPATIAL_UPSCALE_SCISSOR, upscaleScissor);</li></ol></pre></div></div> <p></p></li></ol><ol start="3"><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gaa50410e3dd512d991236be5d77627508" target="_blank">HMS_XEG_RenderSpatialUpscale</a>接口进行超分。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// upscaleFBO为用户自定义创建的framebuffer</span></li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> upscaleFBO;</li><li><span class="hljs-built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, upscaleFBO); </li><li><span class="hljs-comment">// m_upscaleWidth和m_upscaleHeight分别为用户自定义超分宽度和超分高度，此处以超分至1200*900分辨率为例</span></li><li><span class="hljs-type">uint32_t</span> m_upscaleWidth = <span class="hljs-number">1200</span>;</li><li><span class="hljs-type">uint32_t</span> m_upscaleHeight = <span class="hljs-number">900</span>;</li><li><span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, m_upscaleWidth, m_upscaleHeight);</li><li><span class="hljs-built_in">glScissor</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, m_upscaleWidth, m_upscaleHeight); </li><li><span class="hljs-comment">// upscaleColorBuffer为纹理附件，用户可自定义</span></li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> upscaleColorBuffer;</li><li><span class="hljs-built_in">HMS_XEG_RenderSpatialUpscale</span>(upscaleColorBuffer);</li></ol></pre></div></div> <p>upscaleFBO是已创建完成的framebuffer，并绑定纹理，超分接口调用后绘制到纹理上。</p> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section1578411402569">集成XEngine空域GPU超分（Vulkan）<i class="anchor-icon anchor-icon-link" anchorid="section1578411402569" tips="复制节点链接"></i></h3><p>使用Vulkan图形API搭建图像渲染管线并集成空域GPU超分在Native层实现，渲染结果通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件显示到屏幕。</p> <p>本节阐述Vulkan图形API的空域GPU超分使用，详细代码请参见<a href="https://gitcode.com/harmonyos_samples/xengine-samplecode-vulkan-demo-cpp" target="_blank">Demo（GPU加速引擎-Vulkan）</a>。</p> <p>在调用XEngine Kit能力前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/syscap#判断-api-是否可以使用" target="_blank">Syscap</a>查询您的目标设备是否支持SystemCapability.Graphic.XEngine系统能力。</p> <ol><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga686e40e383c8e946b36c11b4073e77c3" target="_blank">HMS_XEG_EnumerateDeviceExtensionProperties</a>接口，获取XEngine支持的扩展信息，只有在支持XEG_SPATIAL_UPSCALE_EXTENSION_NAME扩展时才可以使用空域GPU超分的相关接口。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// physicalDevice为Vulkan物理设备，用户需进行初始化</span></li><li>VkPhysicalDevice physicalDevice;</li><li><span class="hljs-comment">// 查询XEngine支持的Vulkan扩展列表</span></li><li>std::vector&lt;std::string&gt; supportedExtensions;</li><li><span class="hljs-type">uint32_t</span> pPropertyCount;</li><li><span class="hljs-built_in">HMS_XEG_EnumerateDeviceExtensionProperties</span>(physicalDevice, &amp;pPropertyCount, <span class="hljs-literal">nullptr</span>);</li><li><span class="hljs-keyword">if</span> (pPropertyCount &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-function">std::vector&lt;XEG_ExtensionProperties&gt; <span class="hljs-title">pProperties</span><span class="hljs-params">(pPropertyCount)</span></span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">HMS_XEG_EnumerateDeviceExtensionProperties</span>(physicalDevice, &amp;pPropertyCount, &amp;pProperties.<span class="hljs-built_in">front</span>()) == VK_SUCCESS) {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> ext : pProperties) {</li><li>        supportedExtensions.<span class="hljs-built_in">push_back</span>(ext.extensionName);</li><li>    }</li><li>    }</li><li>}</li><li><span class="hljs-comment">// 查询是否支持空域GPU超分</span></li><li><span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">find</span>(supportedExtensions.<span class="hljs-built_in">begin</span>(), supportedExtensions.<span class="hljs-built_in">end</span>(), XEG_SPATIAL_UPSCALE_EXTENSION_NAME) == supportedExtensions.<span class="hljs-built_in">end</span>()) {</li><li>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// return error</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol><ol start="2"><li><span>声明实例句柄。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>XEG_SpatialUpscale xegSpatialUpscale;</li></ol></pre></div></div> <p></p></li><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga03421cce35434f34cdc76b9e0cb2074f" target="_blank">HMS_XEG_CreateSpatialUpscale</a>接口，创建超分实例。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 渲染宽高和超分后宽高均为用户自定义参数，此处以将800*600分辨率超分至1200*900分辨率为例</span></li><li><span class="hljs-type">uint32_t</span> m_renderWidth = <span class="hljs-number">800</span>;</li><li><span class="hljs-type">uint32_t</span> m_renderHeight = <span class="hljs-number">600</span>;</li><li><span class="hljs-type">uint32_t</span> m_upscaleWidth = <span class="hljs-number">1200</span>;</li><li><span class="hljs-type">uint32_t</span> m_upscaleHeight = <span class="hljs-number">900</span>;</li><li><span class="hljs-comment">// Vulkan逻辑设备，用户需进行初始化</span></li><li>VkDevice device;</li><li><span class="hljs-comment">// VkRect2D为Vulkan指定的二维区域结构</span></li><li><span class="hljs-comment">// srcRect2D为超分输入纹理区域，用户可自定义</span></li><li>VkRect2D srcRect2D;</li><li><span class="hljs-comment">// srcRect2D.offset.x和srcRect2D.offset.y为原点偏移量</span></li><li>srcRect2D.offset.x = <span class="hljs-number">0</span>;</li><li>srcRect2D.offset.y = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// srcRect2D.extent.width与srcRect2D.extent.height为输入纹理宽高</span></li><li>srcRect2D.extent.width = m_renderWidth; </li><li>srcRect2D.extent.height = m_renderHeight; </li><li><span class="hljs-comment">// dstRect2D为超分输出纹理区域，用户可自定义</span></li><li>VkRect2D dstRect2D;</li><li><span class="hljs-comment">// dstRect2D.offset.x和dstRect2D.offset.y为原点偏移量</span></li><li>dstRect2D.offset.x = <span class="hljs-number">0</span>;</li><li>dstRect2D.offset.y = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// dstRect2D.extent.width与dstRect2D.extent.height为超分纹理宽高</span></li><li>dstRect2D.extent.width = m_upscaleWidth; </li><li>dstRect2D.extent.height = m_upscaleHeight; </li><li>XEG_SpatialUpscaleCreateInfo createInfo;</li><li>createInfo.format = VK_FORMAT_R8G8B8A8_UNORM;</li><li><span class="hljs-comment">// sharpness为用户自定义超分锐化参数，此处以参数为0.3f为例</span></li><li>createInfo.sharpness = <span class="hljs-number">0.3f</span>;</li><li>createInfo.outputSize = dstRect2D.extent;</li><li>createInfo.inputRegion = srcRect2D;</li><li>createInfo.outputRegion = dstRect2D;</li><li>createInfo.inputSize = srcRect2D.extent;</li><li><span class="hljs-built_in">HMS_XEG_CreateSpatialUpscale</span>(device, &amp;createInfo, &amp;xegSpatialUpscale);</li></ol></pre></div></div> <p></p></li></ol><ol start="4"><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#ga67248485ae1ecf219ebc26aca21705a9" target="_blank">HMS_XEG_CmdRenderSpatialUpscale</a>接口下发超分，每帧都需要调用。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// inputImageView为用户创建的超分输入图像的vkImageView</span></li><li>VkImageView inputImageView = VK_NULL_HANDLE; </li><li><span class="hljs-comment">// outputImageView为用户创建的超分输出图像的vkImageView</span></li><li>VkImageView outputImageView = VK_NULL_HANDLE;</li><li><span class="hljs-comment">// cmdBuff为命令缓冲区，用户需进行初始化</span></li><li>VkCommandBuffer cmdBuff = VK_NULL_HANDLE ;</li><li>XEG_SpatialUpscaleDescription xegDescription;</li><li>xegDescription.inputImage = inputImageView; </li><li>xegDescription.outputImage = outputImageView; </li><li><span class="hljs-built_in">HMS_XEG_CmdRenderSpatialUpscale</span>(cmdBuff, xegSpatialUpscale, &amp;xegDescription);</li></ol></pre></div></div> <p></p></li></ol><ol start="5"><li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/xengine-kit-xengine#gac90c6d38f405348615c76df9c0e5c341" target="_blank">HMS_XEG_DestroySpatialUpscale</a>接口销毁实例。</span><p></p><div _ngcontent-qfh-c106="" class="highlight-div"><div _ngcontent-qfh-c106="" class="highlight-div-header"><div _ngcontent-qfh-c106="" class="highlight-div-header-left"><div _ngcontent-qfh-c106="" class="handle-button expand-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qfh-c106="" class="highlight-div-header-right"><div _ngcontent-qfh-c106="" class="handle-button ai-button"></div><div _ngcontent-qfh-c106="" class="handle-button line-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qfh-c106="" class="handle-button theme-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qfh-c106="" class="handle-button copy-button"><div _ngcontent-qfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qfh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_XEG_DestroySpatialUpscale</span>(xegSpatialUpscale);</li></ol></pre></div></div> <p></p></li></ol> </div> </div> <div></div></div>