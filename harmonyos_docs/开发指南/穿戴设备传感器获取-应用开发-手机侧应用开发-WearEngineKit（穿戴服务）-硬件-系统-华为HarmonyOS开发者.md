<h1 _ngcontent-nur-c119="" class="doc-title ng-star-inserted" title="穿戴设备传感器获取"> 穿戴设备传感器获取 </h1>

<div _ngcontent-nur-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p>人体传感器功能仅限专业研究机构使用。</p>     </div></div></div>    <p>手机侧应用可以通过Wear Engine获取穿戴设备上的传感器信息，并通过打开、关闭命令控制获取传感器数据。</p>    <p>使用传感器相关接口前，需要向手机侧用户申请获取对应权限的授权（参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request_user_authorization">请求用户授权</a>），否则接口将调用失败。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.1" valign="top" width="50%">         <p>传感器类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.2" valign="top" width="50%">         <p>申请权限</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="50%">         <p>ECG、PPG、HR</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section09971113566" target="_blank">HEALTH_SENSOR</a>人体传感器</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">         <p>ACC、GYRO、MAG</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section09971113566" target="_blank">MOTION_SENSOR</a>运动传感器</p></td>       </tr>           </tbody></table></div>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>穿戴设备侧无对应的应用，手机侧应用也可以使用该能力获取穿戴设备传感器。</li>       <li>请确保穿戴设备和华为运动健康App处于连接状态。用户可进入App“设备”界面查看设备是否在线。开发者可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1828213119411" target="_blank">getConnectedDevices</a>方法了解设备是否在线，如果返回列表中不包含目标设备，则提醒用户重新连接该设备。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="section77891421131617">获取穿戴设备的传感器列表<i class="anchor-icon anchor-icon-link" anchorid="section77891421131617" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>该接口的调用需要在开发者联盟申请运动传感器权限或人体传感器（受限开放，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>）权限并获得用户授权。</p>      </div></div></div>     <p>手机侧应用可以获取穿戴设备上传感器列表，并获得这些传感器的名称、ID、上报周期等参数。</p>     <ol>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/query_connected_devices">已连接穿戴设备查询</a>章节，获取已连接设备列表。</span></li>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/we-device-selection">目标设备选择</a>章节，从已连接设备列表中选定需要通信的设备。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">wearEngine</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1529943512113" target="_blank">getSensorClient</a>方法，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1743102372015" target="_blank">SensorClient</a>对象。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section168854385238" target="_blank">getSensorList</a>方法，获取指定连接设备的传感器列表。</span>       <p></p>       <div _ngcontent-nur-c106="" class="highlight-div"><div _ngcontent-nur-c106="" class="highlight-div-header"><div _ngcontent-nur-c106="" class="highlight-div-header-left"><div _ngcontent-nur-c106="" class="handle-button expand-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nur-c106="" class="highlight-div-header-right"><div _ngcontent-nur-c106="" class="handle-button ai-button"></div><div _ngcontent-nur-c106="" class="handle-button line-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nur-c106="" class="handle-button theme-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nur-c106="" class="handle-button copy-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nur-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 步骤3 获取SensorClient客户端</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sensorClient</span>: wearEngine.<span class="hljs-property">SensorClient</span> = wearEngine.<span class="hljs-title function_">getSensorClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>
</li><li><span class="hljs-comment">// 步骤4 获取指定连接设备的传感器列表</span></li><li>sensorClient.<span class="hljs-title function_">getSensorList</span>(targetDevice.<span class="hljs-property">randomId</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">sensorList</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in getting sensor list, result is <span class="hljs-subst">${sensorList}</span>`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get sensor list. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>})</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1217814464225">订阅指定传感器数据上报<i class="anchor-icon anchor-icon-link" anchorid="section1217814464225" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>该接口的调用需要在开发者联盟申请运动传感器权限或人体传感器权限（受限开放，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>）并获得用户授权。</p>      </div></div></div>     <p>手机侧通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section168854385238" target="_blank">getSensorList</a>方法获取传感器列表后可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1043415982714" target="_blank">subscribeSensor</a>方法订阅指定传感器数据上报。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1616121311379" target="_blank">unsubscribeSensor</a>方法可取消订阅指定传感器的数据上报。</p>     <ol>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/query_connected_devices">已连接穿戴设备查询</a>章节，获取已连接设备列表。</span></li>      <li><span>参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/we-device-selection">目标设备选择</a>章节，从已连接设备列表中选定需要通信的设备。</span></li>      <li><span>参见上一小节<a href="/consumer/cn/doc/harmonyos-guides/device_sensor#section77891421131617">获取穿戴设备的传感器列表</a>，获取设备的传感器列表信息。</span></li>      <li><span>核对传感器列表中是否存在目标传感器。</span></li>      <li><span>订阅或取消订阅传感器数据上报。</span>       <p></p>       <div _ngcontent-nur-c106="" class="highlight-div"><div _ngcontent-nur-c106="" class="highlight-div-header"><div _ngcontent-nur-c106="" class="highlight-div-header-left"><div _ngcontent-nur-c106="" class="handle-button expand-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nur-c106="" class="highlight-div-header-right"><div _ngcontent-nur-c106="" class="handle-button ai-button"></div><div _ngcontent-nur-c106="" class="handle-button line-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nur-c106="" class="handle-button theme-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nur-c106="" class="handle-button copy-button"><div _ngcontent-nur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nur-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sensorClient</span>: wearEngine.<span class="hljs-property">SensorClient</span> = wearEngine.<span class="hljs-title function_">getSensorClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sensorList</span>: wearEngine.<span class="hljs-property">Sensor</span>[] = <span class="hljs-keyword">await</span> sensorClient.<span class="hljs-title function_">getSensorList</span>(targetDevice.<span class="hljs-property">randomId</span>);</li><li>sensorList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">sensor, idx, arr</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (sensor.<span class="hljs-property">type</span> === wearEngine.<span class="hljs-property">SensorType</span>.<span class="hljs-property">ACCELEROMETER</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = (<span class="hljs-params">sensorResult: wearEngine.SensorResult</span>) =&gt; {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in getting sensor result, result is <span class="hljs-subst">${sensorResult}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 订阅传感器数据上报</span></li><li>    sensorClient.<span class="hljs-title function_">subscribeSensor</span>(targetDevice.<span class="hljs-property">randomId</span>, wearEngine.<span class="hljs-property">SensorType</span>.<span class="hljs-property">ACCELEROMETER</span>, callback).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in subscribing sensor data.`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to subscribe sensor data. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    })</li><li>
</li><li>    <span class="hljs-comment">// 取消传感器数据上报</span></li><li>    sensorClient.<span class="hljs-title function_">unsubscribeSensor</span>(targetDevice.<span class="hljs-property">randomId</span>, wearEngine.<span class="hljs-property">SensorType</span>.<span class="hljs-property">ACCELEROMETER</span>, callback).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in unsubscribing sensor data.`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to unsubscribe sensor data. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>})</li></ol></pre></div></div>       <div class="p">        <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">          <ul>           <li>传感器成功打开后，会根据每个传感器的上报周期，连续不断的通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1043415982714" target="_blank">subscribeSensor</a>方法入参的回调函数上报数据，数据上报时长可由开发者通过取消订阅传感器接口自行控制。每组数据都有时间戳属性，建议开发者根据时间戳进行数据对齐。不同的传感器上报的数据格式是不同的，具体可参见：<a href="/consumer/cn/doc/harmonyos-guides/device_sensor#section18811142832216">穿戴设备传感器数据格式及样例</a>。</li>           <li>传感器分为多通道传感器，如PPG、ECG，和非多通道传感器，如ACC。对于多通道传感器上报的数据，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1896124869" target="_blank">SensorData</a>中的channel字段来区分通道。</li>           <li>设备连接状态断开，设备会停止传感器数据的上报，需要开发者主动订阅设备的连接状态，设备重新连接上后主动调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1043415982714" target="_blank">subscribeSensor</a>方法订阅指定传感器数据上报。</li>          </ul>         </div></div></div>       </div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section18811142832216">穿戴设备传感器数据格式及样例<i class="anchor-icon anchor-icon-link" anchorid="section18811142832216" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>数据上报数量非固定，示例中给出的是通常上报结果，实际有可能根据设备原因增加或者减少数据。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.1" valign="top" width="6.93%">          <p>传感器</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.2" valign="top" width="6.97%">          <p>支持多通道</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.3" valign="top" width="8.709999999999999%">          <p>采集周期（ms）</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.4" valign="top" width="7.55%">          <p>上报周期（ms）</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.5" valign="top" width="22.46%">          <p>数据格式</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.7.1.6" valign="top" width="47.38%">          <p>数据样例</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>ACC</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>No</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>10</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>1次上报10组，每组3个数据，分别代表x轴、y轴、z轴加速度，共30个数据。</p>          <p>单位：m/s^2，4096为1个重力加速度g</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[34303.0, 10753.0, 54799.0, 33023.0, 15617.0, 2576.0, 33535.0, 9729.0, 5136.0, 24063.0, 6145.0, 62479.0, 23295.0, 6145.0, 58895.0, 35071.0, 9729.0, 57359.0, 46335.0, 10497.0, 53263.0, 55039.0, 4609.0, 57359.0, 42495.0, 2305.0, 60943.0, 41471.0, 64768.0, 57359.0]</p>          <p>备注：ACC、GYRO原始数据值范围为有符号Short，目前上报后的数据值范围为无符号Short，需要开发者自行进行转换。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>GYRO</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>No</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>10</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>1次上报10组，每组3个数据，分别代表x轴、y轴、z轴角速度，共30个数据。</p>          <p>单位：70mdps/LSB</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[34303.0, 10753.0, 54799.0, 33023.0, 15617.0, 2576.0, 33535.0, 9729.0, 5136.0, 24063.0, 6145.0, 62479.0, 23295.0, 6145.0, 58895.0, 35071.0, 9729.0, 57359.0, 46335.0, 10497.0, 53263.0, 55039.0, 4609.0, 57359.0, 42495.0, 2305.0, 60943.0, 41471.0, 64768.0, 57359.0]</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>HR</p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>No</p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>1000</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>1000</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>1次1个数据，代表每分钟心跳次数。</p>          <p>单位：次/分钟</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[80.0]</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>MAG</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>No</p>          <p></p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>1次上报1组，每组4个数据，分别代表x轴、y轴、z轴磁场强度，最后一个数据无实际意义，无需关注。</p>          <p>单位：μT</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[3.9310358, 21.161278, -34.467373, 0.0]</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>PPG</p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>Yes</p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>10</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>三路数据（GREEN/RED/IR） 100ms上报10包数据，每包数据4个字节。</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[758457.0, 2273675.0, 2276247.0, 2278939.0, 2281102.0, 2283411.0, 2285717.0, 2288307.0, 2290863.0, 2293297.0]（一路数据）</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="6.93%">          <p>ECG</p></td>         <td class="cellrowborder" valign="top" width="6.97%">          <p>Yes</p></td>         <td class="cellrowborder" valign="top" width="8.709999999999999%">          <p>2</p></td>         <td class="cellrowborder" valign="top" width="7.55%">          <p>100</p></td>         <td class="cellrowborder" valign="top" width="22.46%">          <p>一路数据100ms上报50包数据。不区分左右手。</p>          <p>单位：nV</p></td>         <td class="cellrowborder" valign="top" width="47.38%">          <p>[-5020837.0, -4742510.0, -4896082.0, -4938397.0, -4796497.0, -4886598.0, -4871642.0, -4943139.0, -5209429.0, -5294787.0, -5161278.0, -5174045.0, -5588071.0, -5323970.0, -5342938.0, -5028133.0, -5094523.0, -5240070.0, -5394008.0, -5540285.0, -5655190.0, -5589895.0, -5539920.0, -5559618.0, -5623090.0, -5501618.0, -5747845.0, -5871870.0, -5814964.0, -5885002.0, -6069946.0, -5678536.0, -5839040.0, -5903971.0, -5959417.0, -6172084.0, -6263279.0, -6029455.0, -6097669.0, -6165518.0, -6174638.0, -6284072.0, -6347544.0, -6319091.0, -6085631.0, -6143631.0, -6382198.0, -6250512.0, -6396059.0, -6424512.0]</p></td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>