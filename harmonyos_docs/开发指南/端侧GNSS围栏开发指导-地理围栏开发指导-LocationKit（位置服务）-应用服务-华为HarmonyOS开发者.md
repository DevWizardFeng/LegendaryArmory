<h1 _ngcontent-haf-c119="" class="doc-title ng-star-inserted" title="端侧GNSS围栏开发指导"> 端侧GNSS围栏开发指导 </h1>

<div _ngcontent-haf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>目前端侧仅支持构建圆形围栏，并且依赖GNSS芯片的地理围栏功能，仅在室外开阔区域才能准确识别用户进出围栏事件。</p> <p>应用场景举例：开发者可以使用地理围栏技术，在企业周围创建一个区域围栏，当用户进入这个区域，在移动设备上进行有针对性的提醒。</p> <div class="tiledSection"><h2 id="section14375587277">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section14375587277" tips="复制节点链接"></i></h2></div> <p>地理围栏所使用的接口如下，详细说明参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager" target="_blank">Location Kit</a>。</p> <div class="tiledSection"><h2 id="section280514142712">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section280514142712" tips="复制节点链接"></i></h2></div> <ol><li>使用地理围栏功能，需要有ohos.permission.LOCATION 和 ohos.permission.APPROXIMATELY_LOCATION权限，位置权限申请的方法和步骤见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/location-permission-guidelines">申请位置权限开发指导</a>。</li><li>导入geoLocationManager模块、wantAgent模块和BusinessError模块。<div _ngcontent-haf-c106="" class="highlight-div"><div _ngcontent-haf-c106="" class="highlight-div-header"><div _ngcontent-haf-c106="" class="highlight-div-header-left"><div _ngcontent-haf-c106="" class="handle-button expand-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-haf-c106="" class="highlight-div-header-right"><div _ngcontent-haf-c106="" class="handle-button ai-button"></div><div _ngcontent-haf-c106="" class="handle-button line-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-haf-c106="" class="handle-button theme-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-haf-c106="" class="handle-button copy-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-haf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">import</span> { wantAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span></li></ol></pre></div></div> </li><li>创建WantAgentInfo信息。<p>场景一：创建拉起Ability的WantAgentInfo信息。</p> <div _ngcontent-haf-c106="" class="highlight-div"><div _ngcontent-haf-c106="" class="highlight-div-header"><div _ngcontent-haf-c106="" class="highlight-div-header-left"><div _ngcontent-haf-c106="" class="handle-button expand-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-haf-c106="" class="highlight-div-header-right"><div _ngcontent-haf-c106="" class="handle-button ai-button"></div><div _ngcontent-haf-c106="" class="handle-button line-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-haf-c106="" class="handle-button theme-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-haf-c106="" class="handle-button copy-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-haf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过WantAgentInfo的operationType设置动作类型</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>:wantAgent.<span class="hljs-property">WantAgentInfo</span> = {</li><li>    <span class="hljs-attr">wants</span>: [</li><li>        {</li><li>            <span class="hljs-attr">deviceId</span>: <span class="hljs-string">''</span>,</li><li>            <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>,</li><li>            <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,</li><li>            <span class="hljs-attr">action</span>: <span class="hljs-string">''</span>,</li><li>            <span class="hljs-attr">entities</span>: [],</li><li>            <span class="hljs-attr">uri</span>: <span class="hljs-string">''</span>,</li><li>            <span class="hljs-attr">parameters</span>: {}</li><li>        }</li><li>    ],</li><li>    <span class="hljs-attr">operationType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">START_ABILITY</span>,</li><li>    <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">wantAgentFlags</span>:[wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">CONSTANT_FLAG</span>]</li><li>};</li></ol></pre></div></div> <p>场景二：创建发布公共事件的WantAgentInfo信息。</p> <div _ngcontent-haf-c106="" class="highlight-div"><div _ngcontent-haf-c106="" class="highlight-div-header"><div _ngcontent-haf-c106="" class="highlight-div-header-left"><div _ngcontent-haf-c106="" class="handle-button expand-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-haf-c106="" class="highlight-div-header-right"><div _ngcontent-haf-c106="" class="handle-button ai-button"></div><div _ngcontent-haf-c106="" class="handle-button line-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-haf-c106="" class="handle-button theme-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-haf-c106="" class="handle-button copy-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-haf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过WantAgentInfo的operationType设置动作类型</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>:wantAgent.<span class="hljs-property">WantAgentInfo</span> = {</li><li>    <span class="hljs-attr">wants</span>: [</li><li>        {</li><li>            <span class="hljs-attr">action</span>: <span class="hljs-string">'event_name'</span>, <span class="hljs-comment">// 设置事件名</span></li><li>            <span class="hljs-attr">parameters</span>: {},</li><li>        }</li><li>    ],</li><li>    <span class="hljs-attr">operationType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">SEND_COMMON_EVENT</span>,</li><li>    <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">wantAgentFlags</span>: [wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">CONSTANT_FLAG</span>],</li><li>}</li></ol></pre></div></div> </li><li>调用getWantAgent()方法进行创建WantAgent。<p>并且在获取到WantAgent对象之后调用地理围栏接口添加围栏，当设备进入或者退出该围栏时，系统会自动触发WantAgent的动作。</p> <div _ngcontent-haf-c106="" class="highlight-div"><div _ngcontent-haf-c106="" class="highlight-div-header"><div _ngcontent-haf-c106="" class="highlight-div-header-left"><div _ngcontent-haf-c106="" class="handle-button expand-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-haf-c106="" class="highlight-div-header-right"><div _ngcontent-haf-c106="" class="handle-button ai-button"></div><div _ngcontent-haf-c106="" class="handle-button line-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-haf-c106="" class="handle-button theme-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-haf-c106="" class="handle-button copy-button"><div _ngcontent-haf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-haf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> wantAgentObj : <span class="hljs-built_in">object</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-comment">// 创建WantAgent</span></li><li>wantAgent.<span class="hljs-title function_">getWantAgent</span>(wantAgentInfo, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getWantAgent err='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getWantAgent success'</span>);</li><li>    wantAgentObj = data;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">requestInfo</span>:geoLocationManager.<span class="hljs-property">GeofenceRequest</span> = {<span class="hljs-string">'scenario'</span>: <span class="hljs-number">0x301</span>, <span class="hljs-string">"geofence"</span>: {<span class="hljs-string">"latitude"</span>: <span class="hljs-number">31.12</span>, <span class="hljs-string">"longitude"</span>: <span class="hljs-number">121.11</span>, <span class="hljs-string">"radius"</span>: <span class="hljs-number">100</span>, <span class="hljs-string">"expiration"</span>: <span class="hljs-number">10000</span>}};</li><li>    <span class="hljs-keyword">try</span> {</li><li>        geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'gnssFenceStatusChange'</span>, requestInfo, wantAgentObj);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>    }</li><li>});</li></ol></pre></div></div> </li></ol> </div> <div></div></div>