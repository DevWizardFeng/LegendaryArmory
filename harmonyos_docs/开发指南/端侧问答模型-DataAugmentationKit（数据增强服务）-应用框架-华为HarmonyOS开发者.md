<h1 _ngcontent-ysu-c119="" class="doc-title ng-star-inserted" title="端侧问答模型"> 端侧问答模型 </h1>

<div _ngcontent-ysu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1147384019259">概述<i class="anchor-icon anchor-icon-link" anchorid="section1147384019259" tips="复制节点链接"></i></h2>          <p>当应用通过RAG接口进行知识问答时，系统会经过以下处理流程：问题分解、查询改写、知识检索和检索生成，该流程需要与大语言模型（LLM）进行多次交互。应用可选择两种部署方案：</p>     <ul>      <li>使用自建的云端大模型。</li>      <li>采用Kit提供的端侧问答模型能力。</li>     </ul>     <p>选择端侧问答模型方案具有以下优势：</p>     <ul>      <li>免除云端大模型的运维成本。</li>      <li>增强用户数据安全性（数据在端侧处理）。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section2323123112812">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2323123112812" tips="复制节点链接"></i></h2>          <p>开发者需要申请接口调用。</p>    </div>    <div class="tiledSection">     <h2 id="section184711353112515">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section184711353112515" tips="复制节点链接"></i></h2>          <p>端侧问答模型关键接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="61.809999999999995%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="38.190000000000005%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="61.809999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section48951613820" target="_blank">init</a>(): Promise&lt;boolean&gt;</p></td>         <td class="cellrowborder" valign="top" width="38.190000000000005%">          <p>初始化端侧问答模型，负责拉起模型管理应用。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="61.809999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section157381918121212" target="_blank">chat</a>(info: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section1666712479912" target="_blank">QuestionInfo</a>, config: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section178144421252" target="_blank">Config</a>, callback: AsyncCallback&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section44611173175" target="_blank">Answer</a>&gt;): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="38.190000000000005%">          <p>与端侧模型进行交互，实现端侧模型的问答功能。</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>模型资源来自<a href="https://matrix.openharmony.cn/#/model/main" target="_blank">Matrix</a>模型库，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section157381918121212" target="_blank">chat</a>接口默认调用模型为Qwen25-7B-Instruct。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section3668173315214">如何申请接口调用<i class="anchor-icon anchor-icon-link" anchorid="section3668173315214" tips="复制节点链接"></i></h2>          <p>打开华为开发者联盟的“<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>”页面，填写“问题概述”，端侧模型问答接口调用申请，“问题分类“选择“HarmonyOS 5.0及以上&gt; 应用框架 &gt; Data Augmentation Kit（数据增强服务）”，描述详情并单击“提交问题”。提交问题后，有时需要您进一步澄清问题，请及时关注进展并予以回复，以便更好地解决问题。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>1.当前端侧模型问答仅支持PC/2in1设备类型，其它设备类型（Phone、Tablet等）无法使用此能力。</p>       <p>2.为了提供优质的开发体验，当前端侧模型问答接口需要申请，优先处理华为开放生态团队对接的企业方应用。</p>      </div></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>申请接口调用信息模板：</p>       <ol>        <li>应用名称：xxx。</li>        <li>bundleName：xxx。</li>        <li>AppID：xxx。</li>        <li>支持PC/2in1设备类型：是或否。</li>        <li>华为开放生态团队对接的企业方应用：是或否。</li>        <li>当前鸿蒙化进展：xxx。</li>        <li>当前已经支持的AI能力：xxx。</li>        <li>当前行业与用户影响力：xxx。</li>        <li>应用内容信息介绍：xxx。</li>       </ol>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section8861938202614">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section8861938202614" tips="复制节点链接"></i></h2>          <ol>      <li><span>问答过程中，端侧模型与LLM通过http请求交互，因此需要为应用申请网络权限。</span>       <p></p>       <div _ngcontent-ysu-c106="" class="highlight-div"><div _ngcontent-ysu-c106="" class="highlight-div-header"><div _ngcontent-ysu-c106="" class="highlight-div-header-left"><div _ngcontent-ysu-c106="" class="handle-button expand-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ysu-c106="" class="highlight-div-header-right"><div _ngcontent-ysu-c106="" class="handle-button ai-button"></div><div _ngcontent-ysu-c106="" class="handle-button line-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ysu-c106="" class="handle-button theme-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ysu-c106="" class="handle-button copy-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ysu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" data-highlighted="yes"><ol class="linenums"><li>// <span class="hljs-built_in">module</span>.json5中配置<span class="hljs-string">"requestPermissions"</span>字段</li><li><span class="hljs-string">"requestPermissions"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.INTERNET"</span></li><li>  }</li><li>],</li></ol></pre></div></div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section48951613820" target="_blank">init</a>接口，拉起本地AI模型管理。</span></li>      <li><span>本地AI模型管理首次拉起，弹出隐私声明界面，同意后下载默认模型。</span></li>      <li><span>本地AI模型管理非首次拉起，打开设置&gt;系统&gt;本地AI模型管理，下载默认模型。</span></li>      <li><span>等待模型下载完成后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-localchatmodel-api#section157381918121212" target="_blank">chat</a>接口，开始进行端侧问答。</span></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section97882623217">完整示例代码<i class="anchor-icon anchor-icon-link" anchorid="section97882623217" tips="复制节点链接"></i></h2>          <div _ngcontent-ysu-c106="" class="highlight-div"><div _ngcontent-ysu-c106="" class="highlight-div-header"><div _ngcontent-ysu-c106="" class="highlight-div-header-left"><div _ngcontent-ysu-c106="" class="handle-button expand-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ysu-c106="" class="highlight-div-header-right"><div _ngcontent-ysu-c106="" class="handle-button ai-button"></div><div _ngcontent-ysu-c106="" class="handle-button line-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ysu-c106="" class="handle-button theme-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ysu-c106="" class="handle-button copy-button"><div _ngcontent-ysu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ysu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li><span class="hljs-keyword">import</span> { localChatModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span></li><li>
</li><li><span class="hljs-keyword">type</span> <span class="hljs-title class_">MessageRole</span> = <span class="hljs-string">'system'</span> | <span class="hljs-string">'user'</span> | <span class="hljs-string">'assistant'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChatMessage</span> {</li><li>  <span class="hljs-attr">role</span>: <span class="hljs-title class_">MessageRole</span>;</li><li>  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'端侧大模型问答助手'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isStreamMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">messages</span>: <span class="hljs-title class_">ChatMessage</span>[] = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">inputText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">initFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isProcessing</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">assistantContent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">chatCounter</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-comment">// 页面加载时，拉起模型管理应用</span></li><li>  <span class="hljs-title function_">onPageShow</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'modelChat onPageShow'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initModel</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">scrollToBottom</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollEdge</span>(<span class="hljs-title class_">Edge</span>.<span class="hljs-property">Bottom</span>);</li><li>    }, <span class="hljs-number">50</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">addMessage</span>(<span class="hljs-attr">role</span>: <span class="hljs-title class_">MessageRole</span>, <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">newMessage</span>: <span class="hljs-title class_">ChatMessage</span> = {</li><li>      <span class="hljs-attr">role</span>: role,</li><li>      <span class="hljs-attr">content</span>: content,</li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>, newMessage];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">initModel</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> localChatModel.<span class="hljs-title function_">init</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">initFlag</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'system'</span>, <span class="hljs-string">'模型初始化完成！'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">const</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">initFlag</span> = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'system'</span>, <span class="hljs-string">`模型初始化出错: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title class_">DoChat</span>(<span class="hljs-attr">questionId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>.<span class="hljs-title function_">trim</span>() || <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> userQuestion = <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>.<span class="hljs-title function_">trim</span>();</li><li>    <span class="hljs-keyword">if</span> (!userQuestion) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'user'</span>, userQuestion);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> = <span class="hljs-string">"思考中..."</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">true</span>;</li><li>
</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">questionInfo</span>: localChatModel.<span class="hljs-property">QuestionInfo</span> = {</li><li>      <span class="hljs-attr">questionId</span>: questionId,</li><li>      <span class="hljs-attr">content</span>: userQuestion</li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">localConfig</span>: localChatModel.<span class="hljs-property">Config</span> = {</li><li>      <span class="hljs-attr">isStream</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isStreamMode</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">const</span> localChatCallback = <span class="hljs-keyword">async</span> (<span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">ans</span>: localChatModel.<span class="hljs-property">Answer</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>();</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> == <span class="hljs-string">"思考中..."</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> = <span class="hljs-string">""</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">false</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 模型运行相关错误码</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'modelChat Callback failed:'</span>, err.<span class="hljs-property">message</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'system'</span>, <span class="hljs-string">`localChatCallback: error code is <span class="hljs-subst">${err.code}</span>,  <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>();</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (ans.<span class="hljs-property">content</span> &amp;&amp; ans.<span class="hljs-property">content</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> == <span class="hljs-string">"思考中..."</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> = <span class="hljs-string">""</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span> += ans.<span class="hljs-property">content</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>();</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scrollToBottom</span>();</li><li>      <span class="hljs-keyword">if</span> (ans.<span class="hljs-property">isFinished</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'modelChat finished'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'assistant'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">false</span>;</li><li>      }</li><li>
</li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'modelChat Starting chat...'</span>);</li><li>      localChatModel.<span class="hljs-title function_">chat</span>(questionInfo, localConfig, localChatCallback);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-comment">// 入参相关错误码</span></li><li>      <span class="hljs-keyword">const</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'modelChat Chat failed:'</span>, error.<span class="hljs-property">message</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'system'</span>, <span class="hljs-string">`chat: error code is <span class="hljs-subst">${error.code}</span>,  <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">clearChat</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span> = [];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#1a73e8'</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">12</span> })</li><li>
</li><li>          <span class="hljs-title class_">Circle</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">12</span> })</li><li>            .<span class="hljs-title function_">fill</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">initFlag</span> ? <span class="hljs-string">'#0f0'</span> : <span class="hljs-string">'#f00'</span>)</li><li>            .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.8</span>)</li><li>
</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">initFlag</span> ? <span class="hljs-string">'已就绪'</span> : <span class="hljs-string">'未就绪'</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">6</span> })</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666'</span>)</li><li>
</li><li>          <span class="hljs-title class_">Blank</span>()</li><li>
</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isStreamMode</span> ? <span class="hljs-string">'流式'</span> : <span class="hljs-string">'非流式'</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">70</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">25</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12.5</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isStreamMode</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isStreamMode</span>;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addMessage</span>(<span class="hljs-string">'system'</span>, <span class="hljs-string">`已切换至 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.isStreamMode ? <span class="hljs-string">'流式问答'</span> : <span class="hljs-string">'非流式问答'</span>}</span> 模式`</span>);</li><li>              })</li><li>          }</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">12</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">shadow</span>({</li><li>          <span class="hljs-attr">radius</span>: <span class="hljs-number">4</span>,</li><li>          <span class="hljs-attr">color</span>: <span class="hljs-string">'#1a73e888'</span>,</li><li>          <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,</li><li>          <span class="hljs-attr">offsetY</span>: <span class="hljs-number">2</span></li><li>        })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>
</li><li>        <span class="hljs-comment">// 聊天区域</span></li><li>        <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>, <span class="hljs-function">(<span class="hljs-params">msg: ChatMessage, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">role</span> === <span class="hljs-string">'system'</span>) {</li><li>                <span class="hljs-title class_">Row</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(msg.<span class="hljs-property">content</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>                    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666'</span>)</li><li>                    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: index === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">12</span> })</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">role</span> === <span class="hljs-string">'user'</span>) {</li><li>                <span class="hljs-title class_">Row</span>() {</li><li>                  <span class="hljs-title class_">Blank</span>()</li><li>                  <span class="hljs-title class_">Text</span>(msg.<span class="hljs-property">content</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>                    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>                    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#1a73e8'</span>)</li><li>                    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>                .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">End</span>)</li><li>              } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">role</span> === <span class="hljs-string">'assistant'</span>) {</li><li>                <span class="hljs-title class_">Row</span>() {</li><li>                  <span class="hljs-title class_">Column</span>() {</li><li>                    <span class="hljs-title class_">Text</span>(msg.<span class="hljs-property">content</span>)</li><li>                      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                      .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#333'</span>)</li><li>                      .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">20</span>)</li><li>                      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>                      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>                      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>                  }</li><li>                  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>                  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">8</span> })</li><li>
</li><li>                  <span class="hljs-title class_">Blank</span>()</li><li>                }</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>                .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>)</li><li>              }</li><li>            }, <span class="hljs-function">(<span class="hljs-params">msg: ChatMessage</span>) =&gt;</span> msg.<span class="hljs-title function_">toString</span>())</li><li>
</li><li>            <span class="hljs-comment">// 加载指示器</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span>) {</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Column</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">assistantContent</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#333'</span>)</li><li>                    .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">20</span>)</li><li>                    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>                    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>                    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">8</span> })</li><li>
</li><li>                <span class="hljs-title class_">Blank</span>()</li><li>              }</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>            }</li><li>          }</li><li>          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>
</li><li>        <span class="hljs-comment">// 输入区域</span></li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'请输入您的问题...'</span> })</li><li>              .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">42</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">21</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'85%'</span>)</li><li>              .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span> = value;</li><li>              })</li><li>              .<span class="hljs-title function_">onSubmit</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>) {</li><li>                  <span class="hljs-keyword">const</span> chatId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chatCounter</span>++;</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">DoChat</span>(chatId);</li><li>                }</li><li>              })</li><li>
</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">'发送'</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">72</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">42</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">8</span> })</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#1a73e8'</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">21</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>) {</li><li>                  <span class="hljs-keyword">const</span> chatId = <span class="hljs-variable language_">this</span>.<span class="hljs-property">chatCounter</span>++;</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">DoChat</span>(chatId);</li><li>                }</li><li>              })</li><li>              .<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputText</span>.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span> ? <span class="hljs-number">0.6</span> : <span class="hljs-number">1</span>)</li><li>
</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"清空"</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">72</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">42</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">8</span> })</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#fff'</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ea4335'</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">18</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearChat</span>();</li><li>              })</li><li>          }</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>)</li><li>          .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">shadow</span>({</li><li>          <span class="hljs-attr">radius</span>: <span class="hljs-number">4</span>,</li><li>          <span class="hljs-attr">color</span>: <span class="hljs-string">'#1a73e888'</span>,</li><li>          <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,</li><li>          <span class="hljs-attr">offsetY</span>: <span class="hljs-number">2</span></li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f0f5ff'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>