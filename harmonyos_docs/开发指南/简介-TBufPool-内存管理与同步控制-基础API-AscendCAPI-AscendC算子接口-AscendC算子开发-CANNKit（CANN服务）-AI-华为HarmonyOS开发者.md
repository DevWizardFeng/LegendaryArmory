<h1 _ngcontent-qdx-c119="" class="doc-title ng-star-inserted" title="简介"> 简介 </h1>

<div _ngcontent-qdx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>TPipe可以管理全局内存资源，而TBufPool可以手动管理或复用Unified Buffer/L1 Buffer物理内存，主要用于多个stage计算中Unified Buffer/L1 Buffer物理内存不足的场景。</p> <div class="tiledSection"><h2 id="section26999mcpsimp">功能图示<i class="anchor-icon anchor-icon-link" anchorid="section26999mcpsimp" tips="复制节点链接"></i></h2><p>下图展示了资源池划分的过程：</p> <ul><li>通过TPipe::InitBuffer接口可以申请Buffer内存并使用队列进行管理。</li><li>通过TPipe::InitBufPool可以划分出资源池BufPool1。</li><li>通过TPipe::InitBufPool可以指定BufPool1与BufPool3地址和长度复用。</li><li>通过TBufPool::InitBuffer及TBufPool::InitBufPool接口继续将BufPool1及BufPool3划分成Buffer或TBufPool资源池。</li></ul> <div class="fignone"><span class="figcap"><b>图1 </b>BufPool资源池划分</span><br><span><img height="191.52" originheight="198" originwidth="542" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114326.08153382768536687355322100237675:50001231000000:2800:2C99D1A660793DBC4B8E56F13A8CC07212229AA5B7699E9FF3E4D42DA24BCDA0.png" title="点击放大" width="524.02"></span></div> <p>如图示的嵌套关系，最外层TBufPool(BufPool1与BufPool3)需要通过TPipe::InitBufPool申请并初始化，内层TBufPool(BufPool2)可以通过TBufPool::InitBufPool申请并初始化。</p> </div> <div class="tiledSection"><h2 id="section27015mcpsimp">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section27015mcpsimp" tips="复制节点链接"></i></h2><ul><li>TBufPool必须通过TPipe::InitBufPool或TBufPool::InitBufPool接口进行划分和初始化。资源池只能整体划分成部分，无法部分拼接为整体。</li><li>不同TBufPool资源池切换进行计算时，需要调用TBufPool::Reset()接口清空已完成计算的TBufPool，清空后的TBufPool资源池及分配的Buffer和数据默认无效。</li><li>不同资源池间分配的Buffer无法混用避免数据踩踏。</li><li>Alloc/Free、EnQue/DeQue在切分TBufPool资源池时必须成对匹配使用，自动确保同步。</li><li>切换资源池的时候，若手写同步，AscendC不保证地址读写复用同步。因此不推荐手写同步。</li></ul> </div> </div> <div></div></div>