<h1 _ngcontent-avm-c119="" class="doc-title ng-star-inserted" title="算子调试概述"> 算子调试概述 </h1>

<div _ngcontent-avm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section12353185013818">工具介绍<i class="anchor-icon anchor-icon-link" anchorid="section12353185013818" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section39904571786" class="firsth2">使用说明<i class="anchor-icon anchor-icon-link" anchorid="section39904571786" tips="复制节点链接"></i></h3><p>介绍AscendC算子调测工具的调测流程和调测功能等，并提供命令行方式，以指导开发者在不同场景下对AscendC算子发起Tiling、精度、性能调测。</p> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>工具指引</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.4.1.1" valign="top" width="24%"><p>使用场景</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.4.1.2" valign="top" width="27%"><p>操作指引</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.4.1.3" valign="top" width="49%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="24%"><p>AscendC算子调测工具是什么</p> </td> <td class="cellrowborder" valign="top" width="27%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-functions">调测工具简介</a></p> </td> <td class="cellrowborder" valign="top" width="49%"><p>阐述了工具的基本概念、关键调测功能、调测方式和流程等，帮助开发者快速了解和使用工具。</p> </td> </tr> <tr><td class="cellrowborder" rowspan="5" valign="top" width="24%"><p>算子调测过程中涉及哪些配置和调测功能</p> </td> <td class="cellrowborder" valign="top" width="27%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-data-preparation-and-configuration">数据准备与配置说明</a></p> </td> <td class="cellrowborder" valign="top" width="49%"><p>阐述命令行方式下算子调测需要的<strong>输入/标杆数据</strong>、<strong>算子信息json文件配置</strong>等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tiling-tuning">Tiling调测功能</a></p> </td> <td class="cellrowborder" valign="top"><p>阐述了命令行方式下算子如何进行Tiling计算，并介绍相应产物说明。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cpu-twin-debugging">CPU孪生调试功能</a></p> </td> <td class="cellrowborder" valign="top"><p>阐述了命令行方式下算子如何在CPU侧编译运行，并介绍精度比对结果，帮助开发者快速定位代码问题。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-simulator-performance-simulation">Simulator性能仿真功能</a></p> </td> <td class="cellrowborder" valign="top"><p>阐述了命令行方式下算子如何在CPU侧通过仿真器进行编译运行，并介绍精度比对结果和性能仿真数据，帮助验证实际算子精度是否正常，性能是否达标。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-more-functions">更多功能</a></p> </td> <td class="cellrowborder" valign="top"><p>阐述了命令行方式下算子调测过程中支持的调试功能，包括printf/PRINTF、DumpTensor、assert等打印功能与gdb功能。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="24%"><p>想了解更多调测相关的命令行参数</p> </td> <td class="cellrowborder" valign="top" width="27%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cli-parameters">ascendebug调测工具参数说明</a></p> </td> <td class="cellrowborder" valign="top" width="49%"><p>针对命令行方式，本章根据调测功能提供了对应的全量参数说明，帮助开发者快速掌握命令行参数含义和功能。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="24%"><p>使用工具调试调优算子时，遇到问题怎么办</p> </td> <td class="cellrowborder" valign="top" width="27%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-faqs-operator-development">算子开发常见问题</a></p> </td> <td class="cellrowborder" valign="top" width="49%"><p>工具调测过程中难免会出现异常或报错场景。本章罗列了一些高频问题，给出了具体的原因分析和处理措施。</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h3 id="section1644417301688">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section1644417301688" tips="复制节点链接"></i></h3><p>仅支持对静态Shape算子调测，暂不支持动态Shape算子调测。</p> </div> <div class="tiledSection"><h2 id="section13493310121218">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section13493310121218" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>基本概念</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.1" valign="top" width="21.16%"><p>概念</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.2" valign="top" width="78.84%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="21.16%"><p>标准自定义算子工程场景(customize)</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>该场景下，开发者需按照“工程创建-&gt;算子实现-&gt;编译部署&gt;算子调用”的流程完成算子开发和调用。基于工程代码框架完成算子核函数的开发和Tiling实现，通过工程编译脚本完成算子编译部署。Tiling开发基于CANN提供的编程框架进行，后续更易于借助框架功能实现单算子API调用、图模式算子调用等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>输入数据和标杆数据</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>使用AscendC调测工具时，需要提供算子输入数据及标杆数据（Golden数据）。</p> <ul><li>输入数据：固定shape算子运行时的输入数据，bin格式。</li><li>标杆数据：根据输入数据计算出来的真值数据，用于与输出数据进行精度比对，bin格式。</li></ul> <div class="p">输入数据和标杆数据可通过numpy生成，样例如下。<div _ngcontent-avm-c106="" class="highlight-div"><div _ngcontent-avm-c106="" class="highlight-div-header"><div _ngcontent-avm-c106="" class="highlight-div-header-left"><div _ngcontent-avm-c106="" class="handle-button expand-button"><div _ngcontent-avm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avm-c106="" class="highlight-div-header-right"><div _ngcontent-avm-c106="" class="handle-button ai-button"></div><div _ngcontent-avm-c106="" class="handle-button line-button"><div _ngcontent-avm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avm-c106="" class="handle-button theme-button"><div _ngcontent-avm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avm-c106="" class="handle-button copy-button"><div _ngcontent-avm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avm-c106="" class="highlight-scroll-div"><pre class="python prettyprint linenums hljs language-python" hw-language="python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_data_simple</span>(): </li><li>    input_x = np.random.uniform(-<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, [<span class="hljs-number">8</span>, <span class="hljs-number">2048</span>]).astype(np.float16)</li><li>    input_y = np.random.uniform(-<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, [<span class="hljs-number">8</span>, <span class="hljs-number">2048</span>]).astype(np.float16)</li><li>    golden = (input_x + input_y).astype(np.float16)</li><li>    input_x.tofile(<span class="hljs-string">"./input/input_x.bin"</span>)     <span class="hljs-comment"># 通过numpy生成的随机输入数据x</span></li><li>    input_y.tofile(<span class="hljs-string">"./input/input_y.bin"</span>)     <span class="hljs-comment"># 通过numpy生成的随机输入数据y</span></li><li>    golden.tofile(<span class="hljs-string">"./output/golden.bin"</span>)      <span class="hljs-comment"># 根据输入计算出来的真值数据，即标杆数据</span></li></ol></pre></div></div> </div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>算子json配置文件</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>用于描述算子的输入、输出及属性信息，以json格式存储。该文件中的参数个数、顺序、数据类型等信息，必须与算子原型相匹配。</p> <p>工具支持以下配置格式：</p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-json-configuration">固定输入/输出顺序的算子json配置</a>：其输入/输出参数信息单独在inputs、outputs、attrs配置项中设置，不支持输入/输出参数交叉设置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>Tiling</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>描述Kirin AI处理器上算子的输入/输出数据切分、分块计算、多核并行等策略，主要是为了满足片上存储限制和计算pipeline的需求，最大化计算并行性和数据局部性（data locality 或 data reuse），从而发挥硬件的极致性能。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>CAModel</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>CAModel(Cycle Accurate Model)仿真器主要用于生成算子性能仿真流水数据。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>CCEC</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>CCEC(Cube-based Computing Engine Compiler)工具基于毕昇编译器，通过自动拼接编译选项构建的一种编译方式。其中，毕昇编译器是一款专为达芬奇SOC设计的编译器，支持异构编程扩展，可将开发者编写的昇腾算子代码编译成二进制可执行文件和动态库等形式，详细介绍请参考《<a href="https://www.hiascend.com/document/detail/zh/canncommercial/82RC1/index/index.html" target="_blank">毕昇编译器使用指南</a>》。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>CCEprint/Intrilog</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>intrilog：落盘算子运行中的CCE指令流。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.16%"><p>原地算子(in-place op)</p> </td> <td class="cellrowborder" valign="top" width="78.84%"><p>一般指原地更新操作类算子，即算子的输入和输出为同一地址，算子在计算完成后，把原有的输出结果直接覆盖在输入的地址上，以减少不必要的内存占用。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section193271321410">运行流程<i class="anchor-icon anchor-icon-link" anchorid="section193271321410" tips="复制节点链接"></i></h2><p>若采用工具命令行方式对单算子调测，其运行流程如图1所示。</p> <div class="fignone"><span class="figcap"><b>图1 </b>基于命令行的工具运行流程</span><br><span><img height="424.27000000000004" originheight="423" originwidth="457" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114257.84946180135027209841048055982929:50001231000000:2800:4DFCEBDFCD99B9152B3057AE31AEE6F03528E5DABAD913457122D4E7058B195C.png" title="点击放大" width="458.85"></span></div> <ol><li>准备环境：使用本工具进行算子调测前，请先完成基础环境搭建，详细操作参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-environment-preparation">环境准备</a>。</li><li>准备数据：准备好bin格式的输入数据和标杆数据文件，该数据是调测工具的必要输入。</li><li>配置json文件：根据工具提供的算子信息json配置样例配置待测算子信息，该文件是调测工具的必要输入。</li><li>通过命令行方式发起算子调测。<p>目前工具支持的算子调测能力如下，请按需选择：</p> <ul><li>Tiling调测：对Tiling函数调测，生成Tiling结果，验证Tiling函数功能。</li><li>精度调试：通过CPU仿真或者simulator仿真进行核函数精度调试，支持自动精度比对、printf/PRINTF/DumpTensor/assert打印等功能。</li><li>性能调优：通过simulator仿真获取算子执行circle数，评估算子性能。</li></ul> </li></ol> </div> </div> <div></div></div>