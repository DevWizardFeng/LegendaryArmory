<h1 _ngcontent-xhl-c119="" class="doc-title ng-star-inserted" title="管理Cookie及数据存储"> 管理Cookie及数据存储 </h1>

<div _ngcontent-xhl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Cookie是服务端发送客户端的数据。客户端持有Cookie，便于服务端快速识别身份和状态。</p>    <p>当Cookie的SameSite属性未指定时，默认值为SameSite=Lax。这种设置下，Cookie仅在用户导航到其源站点时发送，不会在跨站请求中发送。</p>    <div class="tiledSection">     <h2 id="cookie管理">Cookie管理<i class="anchor-icon anchor-icon-link" anchorid="cookie管理" tips="复制节点链接"></i></h2>          <p>Web组件提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager" target="_blank">WebCookieManager</a>类来管理Cookie信息。Cookie信息存储在应用沙箱路径下/proc/{pid}/root/data/storage/el2/base/cache/web/Cookies的文件中。</p>     <p>下面以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager#configcookiesync11" target="_blank">configCookieSync()</a>接口为例，为“www.example.com”设置单个Cookie的值“value=test”。其他Cookie的相关功能及使用，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager" target="_blank">WebCookieManager()</a>接口文档。</p>     <div _ngcontent-xhl-c106="" class="highlight-div"><div _ngcontent-xhl-c106="" class="highlight-div-header"><div _ngcontent-xhl-c106="" class="highlight-div-header-left"><div _ngcontent-xhl-c106="" class="handle-button expand-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xhl-c106="" class="highlight-div-header-right"><div _ngcontent-xhl-c106="" class="handle-button ai-button"></div><div _ngcontent-xhl-c106="" class="handle-button line-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xhl-c106="" class="handle-button theme-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xhl-c106="" class="handle-button copy-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xhl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'configCookieSync'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            webview.<span class="hljs-property">WebCookieManager</span>.<span class="hljs-title function_">configCookieSync</span>(<span class="hljs-string">'https://www.example.com'</span>, <span class="hljs-string">'value=test'</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Cookie每30s周期性保存到磁盘中，也可以使用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager#savecookieasync" target="_blank">saveCookieAsync</a>进行强制落盘（PC/2in1和Tablet设备不会持久化session cookie，即使调用saveCookieAsync，也不会将session cookie写入磁盘）。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="缓存与存储管理">缓存与存储管理<i class="anchor-icon anchor-icon-link" anchorid="缓存与存储管理" tips="复制节点链接"></i></h2>          <p>在访问网站时，网络资源请求通常需要较长的时间。开发者可以通过Cache和Dom Storage等手段将资源保存到本地，以提高访问同一网站的速度。</p>    </div>    <div class="tiledSection">     <h3 id="cache" class="firsth2">Cache<i class="anchor-icon anchor-icon-link" anchorid="cache" tips="复制节点链接"></i></h3>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#cachemode" target="_blank">cacheMode()</a>配置页面资源的缓存模式，Web组件为开发者提供四种缓存模式，分别为：</p>     <ul>      <li>       <p>Default：优先使用未过期的缓存。如果缓存不存在，则从网络获取。</p></li>      <li>       <p>None：加载资源使用缓存。如果缓存中无该资源，则从网络中获取。</p></li>      <li>       <p>Online：加载资源不使用缓存。全部从网络中获取。</p></li>      <li>       <p>Only：只从缓存中加载资源。</p></li>     </ul>     <p>在下面的示例中，缓存设置为None模式。</p>     <div _ngcontent-xhl-c106="" class="highlight-div"><div _ngcontent-xhl-c106="" class="highlight-div-header"><div _ngcontent-xhl-c106="" class="highlight-div-header-left"><div _ngcontent-xhl-c106="" class="handle-button expand-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xhl-c106="" class="highlight-div-header-right"><div _ngcontent-xhl-c106="" class="handle-button ai-button"></div><div _ngcontent-xhl-c106="" class="handle-button line-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xhl-c106="" class="handle-button theme-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xhl-c106="" class="handle-button copy-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xhl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">mode</span>: <span class="hljs-title class_">CacheMode</span> = <span class="hljs-title class_">CacheMode</span>.<span class="hljs-property">None</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">cacheMode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mode</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>为了获取最新资源，开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#removecache" target="_blank">removeCache()</a>接口清除已经缓存的资源，示例代码如下：</p>     <div _ngcontent-xhl-c106="" class="highlight-div"><div _ngcontent-xhl-c106="" class="highlight-div-header"><div _ngcontent-xhl-c106="" class="highlight-div-header-left"><div _ngcontent-xhl-c106="" class="handle-button expand-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xhl-c106="" class="highlight-div-header-right"><div _ngcontent-xhl-c106="" class="handle-button ai-button"></div><div _ngcontent-xhl-c106="" class="handle-button line-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xhl-c106="" class="handle-button theme-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xhl-c106="" class="handle-button copy-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xhl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">mode</span>: <span class="hljs-title class_">CacheMode</span> = <span class="hljs-title class_">CacheMode</span>.<span class="hljs-property">None</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'removeCache'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// 设置为true时同时清除rom和ram中的缓存，设置为false时只清除ram中的缓存</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">removeCache</span>(<span class="hljs-literal">true</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">cacheMode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mode</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="dom-storage">Dom Storage<i class="anchor-icon anchor-icon-link" anchorid="dom-storage" tips="复制节点链接"></i></h3>          <p>Dom Storage包含了Session Storage和Local Storage两类。Session Storage为临时数据，其存储与释放跟随会话生命周期；Local Storage为持久化数据，保存在应用目录下。两者的数据均通过Key-Value的形式存储，在访问需要客户端存储的页面时使用。开发者可以通过Web组件的属性接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#domstorageaccess" target="_blank">domStorageAccess()</a>进行使能配置，示例如下：</p>     <div _ngcontent-xhl-c106="" class="highlight-div"><div _ngcontent-xhl-c106="" class="highlight-div-header"><div _ngcontent-xhl-c106="" class="highlight-div-header-left"><div _ngcontent-xhl-c106="" class="handle-button expand-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xhl-c106="" class="highlight-div-header-right"><div _ngcontent-xhl-c106="" class="handle-button ai-button"></div><div _ngcontent-xhl-c106="" class="handle-button line-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xhl-c106="" class="handle-button theme-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xhl-c106="" class="handle-button copy-button"><div _ngcontent-xhl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xhl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>