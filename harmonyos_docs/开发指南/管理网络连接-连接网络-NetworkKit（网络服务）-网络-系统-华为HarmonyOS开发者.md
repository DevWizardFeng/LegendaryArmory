<h1 _ngcontent-aji-c119="" class="doc-title ng-star-inserted" title="管理网络连接"> 管理网络连接 </h1>

<div _ngcontent-aji-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2>          <p>网络连接管理提供管理网络的一些基础能力，包括WiFi/蜂窝/Ethernet等多网络连接优先级管理、网络质量评估、订阅默认/指定网络连接状态变化、查询网络连接信息、DNS解析等功能。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>为了保证应用的运行效率，大部分API调用都是异步的，对于异步调用的API，均提供了callback和Promise两种方式，以下示例均采用promise函数，更多方式可以查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection" target="_blank">API参考</a>。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <ul>      <li>网络生产者：数据网络的提供方。例如WiFi、蜂窝、Ethernet等。</li>      <li>网络消费者：数据网络的使用方。例如应用或系统服务。</li>      <li>网络探测：检测网络有效性，避免将网络从可用网络切换到不可用网络。包括绑定网络探测、DNS探测、HTTP探测及HTTPS探测。</li>      <li>网络优选：处理多网络共存时选择最优网络。在网络状态、网络信息及评分发生变化时被触发。</li>      <li>默认网络：默认路由所在的网络。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>网络连接管理的典型场景如下所示。</p>     <ul>      <li>接收指定网络的状态变化通知。</li>      <li>获取所有注册的网络。</li>      <li>查询默认网络或者指定网络的连接信息。</li>      <li>使用默认网络解析域名，获取所有IP。</li>     </ul>     <p>具体开发方式介绍如下。</p>    </div>    <div class="tiledSection">     <h2 id="接收指定网络的状态变化通知">接收指定网络的状态变化通知<i class="anchor-icon anchor-icon-link" anchorid="接收指定网络的状态变化通知" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>声明接口调用所需要的权限：ohos.permission.GET_NETWORK_INFO。</p>       <p>此权限级别为normal，在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则">权限使用的基本原则</a>。然后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">访问控制-声明权限</a>声明对应权限。</p></li>      <li>       <p>从@kit.NetworkKit中导入connection命名空间。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 引入包名。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectioncreatenetconnection" target="_blank">createNetConnection</a>方法，指定网络能力、网络类型和超时时间(可选，如不传入代表默认网络；创建不同于默认网络时可通过指定这些参数完成)，创建一个NetConnection对象。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">netSpecifier</span>: connection.<span class="hljs-property">NetSpecifier</span> = {</li><li>  <span class="hljs-attr">netCapabilities</span>: {</li><li>    <span class="hljs-comment">// 假设当前默认网络是WiFi，需要创建蜂窝网络连接，可指定网络类型为蜂窝网。</span></li><li>    <span class="hljs-attr">bearerTypes</span>: [connection.<span class="hljs-property">NetBearType</span>.<span class="hljs-property">BEARER_CELLULAR</span>],</li><li>    <span class="hljs-comment">// 指定网络能力为Internet。</span></li><li>    <span class="hljs-attr">networkCap</span>: [connection.<span class="hljs-property">NetCap</span>.<span class="hljs-property">NET_CAPABILITY_INTERNET</span>]</li><li>  },</li><li>};</li><li>
</li><li><span class="hljs-comment">// 指定超时时间为10s(默认值为0)。</span></li><li><span class="hljs-keyword">let</span> timeout = <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>;</li><li>
</li><li><span class="hljs-comment">// 创建NetConnection对象。</span></li><li><span class="hljs-keyword">let</span> conn = connection.<span class="hljs-title function_">createNetConnection</span>(netSpecifier, timeout);</li></ol></pre></div></div></li>      <li>       <p>调用该对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#onnetavailable" target="_blank">on()</a>方法，传入type和callback参数，订阅关心的事件。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 订阅事件，如果当前指定网络可用，通过on_netAvailable通知用户。</span></li><li>conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netAvailable'</span>, (<span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"net is available, netId is "</span> + data.<span class="hljs-property">netId</span>);</li><li>}));</li><li>
</li><li><span class="hljs-comment">// 订阅事件，如果当前指定网络不可用，通过on_netUnavailable通知用户。</span></li><li>conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netUnavailable'</span>, (<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">void</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"net is unavailable, data is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>}));</li></ol></pre></div></div></li>      <li>       <p>调用该对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#register" target="_blank">register()</a>方法，订阅指定网络状态变化的通知，此接口要在调用on后调用。当网络可用时，会收到netAvailable事件的回调；当网络不可用时，会收到netUnavailable事件的回调。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 订阅指定网络状态变化的通知。</span></li><li>conn.<span class="hljs-title function_">register</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: <span class="hljs-built_in">void</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>});</li></ol></pre></div></div></li>      <li>       <p>当不使用该网络时，可以调用该对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#unregister" target="_blank">unregister()</a>方法，取消订阅。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 当不使用该网络时，可以调用该对象的unregister()方法，取消订阅。</span></li><li>conn.<span class="hljs-title function_">unregister</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: <span class="hljs-built_in">void</span></span>) =&gt;</span> {</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="监控默认网络变化并主动重建网络连接">监控默认网络变化并主动重建网络连接<i class="anchor-icon anchor-icon-link" anchorid="监控默认网络变化并主动重建网络连接" tips="复制节点链接"></i></h2>          <p>根据当前网络状态及网络质量情况，默认网络可能会发生变化，如下所示。</p>     <ol>      <li>在WiFi弱信号的情况下，默认网络可能会切换到蜂窝网络。</li>      <li>在蜂窝网络状态差的情况下，默认网络可能会切换到WiFi。</li>      <li>关闭WiFi后，默认网络可能会切换到蜂窝网络。</li>      <li>关闭蜂窝网络后，默认网络可能会切换到WiFi。</li>      <li>在WiFi弱信号的情况下，默认网络可能会切换到其他WiFi(存在跨网情况)。</li>      <li>在蜂窝网络状态差的情况下，默认网络可能会切换到其他蜂窝(存在跨网情况)。</li>     </ol>     <p>本节旨在介绍监控默认网络的变化后，应用报文能够快速迁移到新默认网络上，具体做法如下。</p>    </div>    <div class="tiledSection">     <h3 id="监控默认网络变化" class="firsth2">监控默认网络变化<i class="anchor-icon anchor-icon-link" anchorid="监控默认网络变化" tips="复制节点链接"></i></h3>          <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> netConnection = connection.<span class="hljs-title function_">createNetConnection</span>();</li><li><span class="hljs-comment">// 监听默认网络改变。</span></li><li>netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netAvailable'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {</li><li> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>})</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="默认网络变化后重新建立网络连接">默认网络变化后重新建立网络连接<i class="anchor-icon anchor-icon-link" anchorid="默认网络变化后重新建立网络连接" tips="复制节点链接"></i></h3>          <p><strong>原网络连接使用Socket模块建立连接</strong></p>     <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { connection, socket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建socket对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sock</span>: socket.<span class="hljs-property">TCPSocket</span> = socket.<span class="hljs-title function_">constructTCPSocketInstance</span>();</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">useSocket</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">netAddress</span>: socket.<span class="hljs-property">NetAddress</span> = {</li><li>    <span class="hljs-attr">address</span>: <span class="hljs-string">'192.168.xx.xxx'</span>,</li><li>    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">tcpConnectOptions</span>: socket.<span class="hljs-property">TCPConnectOptions</span> = {</li><li>    <span class="hljs-attr">address</span>: netAddress,</li><li>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">6000</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 建立socket连接。</span></li><li>  sock.<span class="hljs-title function_">connect</span>(tcpConnectOptions, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'connect fail'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'connect success'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">tcpSendOptions</span>: socket.<span class="hljs-property">TCPSendOptions</span> = {</li><li>      <span class="hljs-attr">data</span>: <span class="hljs-string">'Hello, server!'</span></li><li>    }</li><li>    <span class="hljs-title function_">socketSend</span>(tcpSendOptions);</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-comment">// 通过socket发送数据。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">socketSend</span>(<span class="hljs-params">tcpSendOptions: socket.TCPSendOptions</span>) {</li><li>  sock.<span class="hljs-title function_">send</span>(tcpSendOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'send success'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'send fail'</span>);</li><li>  });</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">socketTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> netConnection = connection.<span class="hljs-title function_">createNetConnection</span>();</li><li>  <span class="hljs-comment">// 网络切换会导致网络发生中断，原socket失效，故需重新建立socket。</span></li><li>  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netAvailable'</span>, <span class="hljs-function">(<span class="hljs-params">netHandle: connection.NetHandle</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"default network changed: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(netHandle));</li><li>    sock.<span class="hljs-title function_">close</span>();</li><li>    sock = socket.<span class="hljs-title function_">constructTCPSocketInstance</span>();</li><li>    <span class="hljs-comment">// 通过socket发送数据。</span></li><li>    <span class="hljs-title function_">useSocket</span>();</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 订阅指定网络状态变化的通知。</span></li><li>  netConnection.<span class="hljs-title function_">register</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"register fail: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"register success"</span>);</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div>     <p><strong>原网络连接使用Socket Library建立网络连接</strong></p>     <p>监控到默认网络变化后关闭原有Socket并重新建立Socket连接。</p>    </div>    <div class="tiledSection">     <h2 id="获取所有注册的网络">获取所有注册的网络<i class="anchor-icon anchor-icon-link" anchorid="获取所有注册的网络" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>声明接口调用所需要的权限：ohos.permission.GET_NETWORK_INFO。</p>       <p>此权限级别为normal，在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则">权限使用的基本原则</a>。然后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">访问控制-声明权限</a>声明对应权限。</p></li>      <li>       <p>示例代码</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 从@kit.NetworkKit中导入connection命名空间。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 调用getAllNets方法，获取所有处于连接状态的网络列表。</span></li><li>connection.<span class="hljs-title function_">getAllNets</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle[]</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Succeeded to get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  <span class="hljs-keyword">if</span> (data) {</li><li>    <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-title function_">getContext</span>().<span class="hljs-property">netList</span> = data;</li><li>  }</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="查询默认网络或者指定网络的连接信息">查询默认网络或者指定网络的连接信息<i class="anchor-icon anchor-icon-link" anchorid="查询默认网络或者指定网络的连接信息" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>声明接口调用所需要的权限：ohos.permission.GET_NETWORK_INFO。</p>       <p>此权限级别为normal，在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则">权限使用的基本原则</a>。然后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">访问控制-声明权限</a>声明对应权限。</p></li>      <li>       <p>查询默认网络或指定网络连接信息代码示例</p>       <p>通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetdefaultnet" target="_blank">getDefaultNet</a>方法，获取默认的数据网络(NetHandle)；调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetnetcapabilities" target="_blank">getNetCapabilities</a>方法，获取该NetHandle对应网络的能力信息。能力信息包含了网络类型(蜂窝网络、Wi-Fi网络、以太网网络等)、网络具体能力等网络信息。也可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetconnectionproperties" target="_blank">getConnectionProperties</a>方法，获取该NetHandle对应网络的连接信息。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 从@kit.NetworkKit中导入connection命名空间。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getDefaultNetsInfo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">netHandleInfo</span>:connection.<span class="hljs-property">NetHandle</span>|<span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// 调用getDefaultNet方法，获取默认的数据网络(NetHandle)。</span></li><li>  connection.<span class="hljs-title function_">getDefaultNet</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data:connection.NetHandle</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">netId</span> == <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"don't have defaultNet"</span>);</li><li>      <span class="hljs-comment">// 当前无默认网络时，获取的netHandler的netid为0,属于异常情况，需要额外处理。</span></li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (data) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getDefaultNet get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>      <span class="hljs-comment">// 获取netHandle对应网络的能力信息。能力信息包含了网络类型、网络具体能力等网络信息。</span></li><li>      netHandleInfo = data;</li><li>      connection.<span class="hljs-title function_">getNetCapabilities</span>(netHandleInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.NetCapabilities</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getNetCapabilities get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        <span class="hljs-comment">// 获取网络类型(bearerTypes)。</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">bearerTypes</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(data.<span class="hljs-property">bearerTypes</span>);</li><li>        <span class="hljs-keyword">let</span> bearerTypesNum = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(bearerTypes.<span class="hljs-title function_">values</span>());</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> bearerTypesNum) {</li><li>          <span class="hljs-keyword">if</span> (item == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-comment">// 蜂窝网络。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"BEARER_CELLULAR"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">1</span>) {</li><li>            <span class="hljs-comment">// Wi-Fi网络。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"BEARER_WIFI"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">3</span>) {</li><li>            <span class="hljs-comment">// 以太网网络。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"BEARER_ETHERNET"</span>));</li><li>          }</li><li>        }</li><li>
</li><li>        <span class="hljs-comment">// 获取网络具体能力(networkCap)。</span></li><li>        <span class="hljs-keyword">let</span> itemNumber : <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(data.<span class="hljs-property">networkCap</span>);</li><li>        <span class="hljs-keyword">let</span> dataNumber = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(itemNumber.<span class="hljs-title function_">values</span>());</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> dataNumber) {</li><li>          <span class="hljs-keyword">if</span> (item == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-comment">// 表示网络可以访问运营商的MMSC(Multimedia Message Service，多媒体短信服务)发送和接收彩信。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"NET_CAPABILITY_MMS"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">11</span>) {</li><li>            <span class="hljs-comment">// 表示网络流量未被计费。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"NET_CAPABILITY_NOT_METERED"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">12</span>) {</li><li>            <span class="hljs-comment">// 表示该网络应具有访问Internet的能力，该能力由网络提供者设置。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"NET_CAPABILITY_INTERNET"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">15</span>) {</li><li>            <span class="hljs-comment">// 表示网络不使用VPN(Virtual Private Network，虚拟专用网络)。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"NET_CAPABILITY_NOT_VPN"</span>));</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item == <span class="hljs-number">16</span>) {</li><li>            <span class="hljs-comment">// 表示该网络访问Internet的能力被网络管理成功验证，该能力由网络管理模块设置。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">"NET_CAPABILITY_VALIDATED"</span>));</li><li>          }</li><li>        }</li><li>      })</li><li>    }</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 获取netHandle对应的网络的连接信息。</span></li><li>  connection.<span class="hljs-title function_">getConnectionProperties</span>(netHandleInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.ConnectionProperties</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getConnectionProperties get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  })</li><li>}</li></ol></pre></div></div></li>      <li>       <p>查询所有网络连接信息代码示例</p>       <p>通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetallnets" target="_blank">getAllNets</a>方法，获取所有处于连接状态的网络列表(Array&lt;NetHandle&gt;)。然后遍历获取到的NetHandle数组，分别调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetnetcapabilities" target="_blank">getNetCapabilities</a>方法，获取该NetHandle对应网络的能力信息，能力信息包含了网络类型(蜂窝网络、Wi-Fi网络、以太网网络等)、网络具体能力等网络信息。也可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetconnectionproperties" target="_blank">getConnectionProperties</a>方法，获取该NetHandle对应网络的连接信息。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 从@kit.NetworkKit中导入connection命名空间。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllNetsInfo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 调用getAllNets,获取所有处于连接状态的网络列表(Array&lt;NetHandle&gt;)。</span></li><li>  connection.<span class="hljs-title function_">getAllNets</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle[]</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getAllNets get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>    <span class="hljs-keyword">if</span> (data) {</li><li>      <span class="hljs-keyword">let</span> itemNumber : <span class="hljs-title class_">Set</span>&lt;connection.<span class="hljs-property">NetHandle</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(data);</li><li>      <span class="hljs-keyword">let</span> dataNumber = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(itemNumber.<span class="hljs-title function_">values</span>());</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> dataNumber) {</li><li>        <span class="hljs-comment">// 循环获取网络列表每个netHandle对应网络的能力信息。</span></li><li>        connection.<span class="hljs-title function_">getNetCapabilities</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.NetCapabilities</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getNetCapabilities get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        })</li><li>
</li><li>        <span class="hljs-comment">// 循环获取网络列表每个netHandle对应的网络的连接信息。</span></li><li>        connection.<span class="hljs-title function_">getConnectionProperties</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.ConnectionProperties</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getConnectionProperties get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        })</li><li>      }</li><li>    }</li><li>  })</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="判断默认网络是否可以访问互联网">判断默认网络是否可以访问互联网<i class="anchor-icon anchor-icon-link" anchorid="判断默认网络是否可以访问互联网" tips="复制节点链接"></i></h2>          <p>如果应用需要检查当前连接的网络是否可以访问互联网，可参考以下步骤进行判断：</p>     <ol>      <li>       <p>声明接口调用所需要的权限：ohos.permission.GET_NETWORK_INFO</p>       <p>此权限级别为normal，在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则">权限使用的基本原则</a>。然后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">访问控制-声明权限</a>声明对应权限。</p></li>      <li>       <p>代码示例</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetdefaultnetsync9" target="_blank">getDefaultNetSync</a>方法，获取当前默认网络的netHandle，netHandle有效的情况下，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetnetcapabilitiessync10" target="_blank">getNetCapabilitiesSync</a>方法，获取NetHandle对应网络的能力信息，根据获取到的能力信息，判断networkCap数组中的值判断网络是否可用。</p>       <p>NET_CAPABILITY_CHECKING_CONNECTIVITY表示在进行连通性判断的过程中，当不处于连通性判断过程中，且networkCap数组中包含NET_CAPABILITY_VALIDATED表示网络连通性校验通过，可以访问互联网。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 从@kit.NetworkKit中导入connection命名空间。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 获取默认激活的数据网络。</span></li><li><span class="hljs-keyword">let</span> netHandle = connection.<span class="hljs-title function_">getDefaultNetSync</span>();</li><li><span class="hljs-keyword">if</span> (!netHandle || netHandle.<span class="hljs-property">netId</span> === <span class="hljs-number">0</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"getDefaultNetSync fail"</span>);</li><li>} <span class="hljs-keyword">else</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"default network: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(netHandle));</li><li>  <span class="hljs-comment">// 获取netHandle对应网络的能力信息。</span></li><li>  <span class="hljs-keyword">let</span> netCapabilities = connection.<span class="hljs-title function_">getNetCapabilitiesSync</span>(netHandle);</li><li>  <span class="hljs-keyword">let</span> cap = netCapabilities.<span class="hljs-property">networkCap</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"network capabilities: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(netCapabilities));</li><li>  <span class="hljs-comment">// 判断网络是否可以访问互联网。</span></li><li>  <span class="hljs-keyword">if</span> (cap?.<span class="hljs-title function_">includes</span>(connection.<span class="hljs-property">NetCap</span>.<span class="hljs-property">NET_CAPABILITY_CHECKING_CONNECTIVITY</span>)) {</li><li>    <span class="hljs-comment">// 正在验证网络连通性，请稍后重试。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"default network is checking, please try again later"</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">if</span> (cap?.<span class="hljs-title function_">includes</span>(connection.<span class="hljs-property">NetCap</span>.<span class="hljs-property">NET_CAPABILITY_VALIDATED</span>)) {</li><li>      <span class="hljs-comment">// 网络连通性验证成功，当前默认网络可以访问互联网。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"default network is validated"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-comment">// 网络连通性验证失败，当前默认网络不可以访问互联网。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"default network is not validated"</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用默认网络解析域名获取所有ip">使用默认网络解析域名，获取所有IP<i class="anchor-icon anchor-icon-link" anchorid="使用默认网络解析域名获取所有ip" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>声明接口调用所需要的权限：ohos.permission.GET_NETWORK_INFO</p>       <p>此权限级别为normal，在申请权限前，请保证符合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-permission-mgmt-overview#权限使用的基本原则">权限使用的基本原则</a>。然后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">访问控制-声明权限</a>声明对应权限。</p></li>      <li>       <p>代码示例</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#connectiongetaddressesbyname" target="_blank">getAddressesByName</a>方法，使用默认网络解析主机名以获取所有IP地址。</p>       <div _ngcontent-aji-c106="" class="highlight-div"><div _ngcontent-aji-c106="" class="highlight-div-header"><div _ngcontent-aji-c106="" class="highlight-div-header-left"><div _ngcontent-aji-c106="" class="handle-button expand-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aji-c106="" class="highlight-div-header-right"><div _ngcontent-aji-c106="" class="handle-button ai-button"></div><div _ngcontent-aji-c106="" class="handle-button line-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aji-c106="" class="handle-button theme-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aji-c106="" class="handle-button copy-button"><div _ngcontent-aji-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aji-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 从@kit.NetworkKit中导入connection命名空间。</span></li><li><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-comment">// 使用默认网络解析主机名以获取所有IP地址。</span></li><li>connection.<span class="hljs-title function_">getAddressesByName</span>(<span class="hljs-string">"xxxx"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: connection.NetAddress[]</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Succeeded to get data: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>