<h1 _ngcontent-qsa-c119="" class="doc-title ng-star-inserted" title="系统后台切应用前台接续下载资源包"> 系统后台切应用前台接续下载资源包 </h1>

<div _ngcontent-qsa-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>系统后台静默下载过程中启动游戏，应用前台将接管系统后台下载任务，资源包下载任务将在应用前台接续执行。</p>    <div class="tiledSection">     <h2 id="section563214134911">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section563214134911" tips="复制节点链接"></i></h2>          <p><span><img originheight="906" originwidth="1327" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114411.37008022710629849811041998905385:50001231000000:2800:03BB4E46963DAEA84D41AC7A1828BDE3BFD09443C3B18A0CC97C519F59419328.png" width="920" height="628.1235870384326"></span></p>     <ol>      <li>用户在应用市场安装游戏后、用户在应用市场更新游戏后、系统检测到用户设备符合闲时条件时，游戏资源加速服务开启资源包后台下载。</li>      <li>游戏资源加速服务携带manifestUrl资源清单，向资源加速ExtensionAbility获取资源包下载任务列表。</li>      <li>游戏实现资源加速ExtensionAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section1643305731014" target="_blank">onDownloadContentRequest</a>方法，下载manifestUrl，对比本地资源差异，生成资源包下载任务列表。若manifestUrl不为空，资源加速ExtensionAbility从华为CDN获取下载任务列表，若manifestUrl为空，从三方CDN获取下载任务列表。</li>      <li>资源加速ExtensionAbility向游戏资源加速服务返回不超过200条下载任务的配置信息列表<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section14401125712" target="_blank">AssetDownloadConfig</a>。</li>      <li>游戏资源加速服务根据配置信息列表逐一从华为CDN或三方CDN下载资源包。</li>      <li>游戏资源加速服务每完成一个下载任务，均会向资源加速ExtensionAbility通知当前任务的下载状态。</li>      <li>游戏实现资源加速ExtensionAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section7400025191119" target="_blank">onBackgroundDownloadSucceeded</a>方法，接收“成功”状态的下载任务信息，并前往下载路径操作（例如转移、解压）资源文件。游戏实现资源加速ExtensionAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section1348813731114" target="_blank">onBackgroundDownloadFailed</a>方法，接收“失败”状态的下载任务信息，并根据失败原因<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section82071855806" target="_blank">DownloadFault</a>自行实现处理逻辑。</li>      <li>用户在后台下载资源包的过程中打开游戏App。</li>      <li>游戏资源加速服务通知资源加速ExtensionAbility即将关闭资源包后台下载功能。</li>      <li>游戏资源加速服务关闭资源包后台下载功能。</li>      <li>游戏向资源加速服务订阅资源包下载进度/状态事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section171317233391" target="_blank">on('progress')</a>方法，监听资源包下载进度。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section93468227013" target="_blank">on('pause')</a>方法，监听下载任务是否暂停。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section165201771441" target="_blank">on('complete')</a>方法，监听资源是否成功下载。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section22331871979" target="_blank">on('fail')</a>方法，监听下载任务是否失败。</li>      <li>游戏资源加速服务继续下载资源包。</li>      <li>游戏资源加速服务每完成一个下载任务，还会向游戏通知当前任务的下载进度和下载状态。</li>      <li>若游戏接收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section171317233391" target="_blank">on('progress')</a>方法返回的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section13627145473413" target="_blank">DownloadCompletedInfo</a>，表示资源包下载成功，游戏可前往下载路径操作（例如转移、解压）资源文件。若游戏接收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section22331871979" target="_blank">on('fail')</a>方法返回的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section154451056193512" target="_blank">DownloadFailedInfo</a>，表示下载任务失败，游戏可以根据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section82071855806" target="_blank">DownloadFault</a>自行实现处理逻辑。若游戏接收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section93468227013" target="_blank">on('pause')</a>方法返回的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1639510932819" target="_blank">AssetDownloadTask</a>，表示下载任务已暂停，游戏可以携带taskId，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section81011552114216" target="_blank">resumeAssetDownloadTask</a>方法，恢复暂停中的下载任务。</li>      <li>游戏向资源加速服务取消订阅资源包下载进度/状态事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section119038965812" target="_blank">off('progress')</a>方法，取消监听资源包下载进度。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1229111411927" target="_blank">off('pause')</a>方法，取消监听下载任务暂停事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section145731108615" target="_blank">off('complete')</a>方法，取消监听资源包下载成功事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section131235411188" target="_blank">off('fail')</a>方法，取消监听资源包下载失败事件。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section12440114518494">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section12440114518494" tips="复制节点链接"></i></h2>          <ol>      <li>在“src/main/module.json5”的extensionAbilities层级中添加资源加速ExtensionAbility信息。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"extensionAbilities"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"AssetAccelExtAbility"</span>, <span class="hljs-comment">// 游戏资源加速ExtensionAbility组件的名称。</span></li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/extensionability/AssetAccelExtAbility.ets"</span>, <span class="hljs-comment">// 游戏资源加速ExtensionAbility组件所对应的代码路径。</span></li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"assetAcceleration"</span></li><li>  }</li><li>]</li></ol></pre></div></div></li>      <li>新建extensionability文件夹及AssetAccelExtAbility.ets文件，导入assetDownloadManager模块、AssetAccelerationExtensionAbility模块及相关模块，同时新增AssetAccelExtAbility类继承AssetAccelerationExtensionAbility。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { assetDownloadManager, <span class="hljs-title class_">AssetAccelerationExtensionAbility</span>, <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>, <span class="hljs-title class_">ContentRequestType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>};</li></ol></pre></div></div></li>      <li>游戏实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section1643305731014" target="_blank">onDownloadContentRequest</a>方法，收集资源包下载任务列表。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onDownloadContentRequest</span>(<span class="hljs-attr">requestType</span>: <span class="hljs-title class_">ContentRequestType</span>, <span class="hljs-attr">manifestUrl</span>: <span class="hljs-built_in">string</span>,</li><li>  <span class="hljs-attr">assetAccelerationExtensionInfo</span>: <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>): <span class="hljs-title class_">Promise</span>&lt;assetDownloadManager.<span class="hljs-property">AssetDownloadConfig</span>[]&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onDownloadContentRequest enter, requestType: <span class="hljs-subst">${requestType}</span>, manifestUrl: <span class="hljs-subst">${manifestUrl}</span>.`</span>);</li><li>  <span class="hljs-comment">// 1.根据manifestUrl获取下载资源包。2.manifestUrl不为空，获取华为CDN侧资源，为空则获取三方CDN侧资源。3.返回资源包下载任务列表。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">downloadConfigArr</span>: <span class="hljs-title class_">Array</span>&lt;assetDownloadManager.<span class="hljs-property">AssetDownloadConfig</span>&gt; = [];</li><li>  <span class="hljs-keyword">return</span> downloadConfigArr;</li><li>}</li></ol></pre></div></div></li>      <li>游戏实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section7400025191119" target="_blank">onBackgroundDownloadSucceeded</a>方法，接收“成功”状态的下载任务，并前往下载路径操作（例如转移、解压）资源文件。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onBackgroundDownloadSucceeded</span>(<span class="hljs-attr">downloadTask</span>: assetDownloadManager.<span class="hljs-property">AssetDownloadTask</span>,</li><li>  <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onBackgroundDownloadSucceeded enter, taskId is <span class="hljs-subst">${downloadTask.taskId}</span>, filePath = <span class="hljs-subst">${filePath}</span>`</span>);</li><li>  <span class="hljs-comment">// 添加已下载资源包转移等处理逻辑。</span></li><li>}</li></ol></pre></div></div></li>      <li>游戏实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section1348813731114" target="_blank">onBackgroundDownloadFailed</a>方法，接收“失败”状态的下载任务，并根据失败原因<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section82071855806" target="_blank">DownloadFault</a>自行实现处理逻辑。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onBackgroundDownloadFailed</span>(<span class="hljs-attr">downloadTask</span>: assetDownloadManager.<span class="hljs-property">AssetDownloadTask</span>,</li><li>  <span class="hljs-attr">fault</span>: assetDownloadManager.<span class="hljs-property">DownloadFault</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onBackgroundDownloadFailed enter, download url: <span class="hljs-subst">${downloadTask.config.url}</span>, err: <span class="hljs-subst">${fault}</span>`</span>);</li><li>  <span class="hljs-comment">// 添加资源包下载失败处理逻辑。</span></li><li>}</li></ol></pre></div></div></li>      <li>游戏实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section144241488119" target="_blank">onExtensionWillTerminate</a>方法，接收游戏资源加速服务关闭资源包后台下载功能的通知。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">onExtensionWillTerminate</span>(error?: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-comment">// 避免进行耗时处理。</span></li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onExtensionWillTerminate enter, TerminateReason：<span class="hljs-subst">${error?.code}</span>, msg: <span class="hljs-subst">${error?.message}</span>.`</span>);</li><li>    <span class="hljs-comment">// 添加异常终止处理逻辑。</span></li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 添加资源清理等处理逻辑。</span></li><li>}</li></ol></pre></div></div></li>      <li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section171317233391" target="_blank">on('progress')</a>方法，监听资源包下载进度。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section93468227013" target="_blank">on('pause')</a>方法，监听下载任务是否暂停。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section165201771441" target="_blank">on('complete')</a>方法，监听资源是否成功下载。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section22331871979" target="_blank">on('fail')</a>方法，监听下载任务是否失败。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">onProgressCallback</span>: <span class="hljs-function">(<span class="hljs-params">progressArray: assetDownloadManager.DownloadProgressInfo[]</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">progressArray</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onProgressCallback progressArray length: <span class="hljs-subst">${progressArray.length}</span>`</span>);</li><li>  <span class="hljs-comment">// 添加资源包下载进度处理逻辑。</span></li><li>}</li><li>
</li><li><span class="hljs-attr">onPauseCallback</span>: <span class="hljs-function">(<span class="hljs-params">downloadTaskInfo: assetDownloadManager.AssetDownloadTask</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">downloadTaskInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`task identifier = <span class="hljs-subst">${downloadTaskInfo.config.identifier}</span> has paused.`</span>);</li><li>  <span class="hljs-comment">// 添加资源包下载暂停处理逻辑。</span></li><li>}</li><li>
</li><li><span class="hljs-attr">onCompleteCallback</span>: <span class="hljs-function">(<span class="hljs-params">completeInfo: assetDownloadManager.DownloadCompletedInfo</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-keyword">async</span> (completeInfo) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`task identifier = <span class="hljs-subst">${completeInfo.downloadTask.config.identifier}</span> has completed.`</span>);</li><li>  <span class="hljs-comment">// 添加资源包下载完成处理逻辑。</span></li><li>}</li><li>
</li><li><span class="hljs-attr">onFailedCallback</span>: <span class="hljs-function">(<span class="hljs-params">failedInfo: assetDownloadManager.DownloadFailedInfo</span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-keyword">async</span> (failedInfo) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`task identifier = <span class="hljs-subst">${failedInfo.downloadTask.config.identifier}</span> has failed.`</span>);</li><li>  <span class="hljs-comment">// 添加资源包下载失败处理逻辑。</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 订阅下载状态和下载进度事件。</span></li><li><span class="hljs-keyword">try</span> {</li><li>　assetDownloadManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"progress"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onProgressCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"pause"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPauseCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"complete"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onCompleteCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"fail"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFailedCallback</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`Failed to do assetDownloadManager.on, errCode: <span class="hljs-subst">${error.code}</span>, errMessage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section119038965812" target="_blank">off('progress')</a>方法，取消监听资源包下载进度。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1229111411927" target="_blank">off('pause')</a>方法，取消监听下载任务暂停事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section145731108615" target="_blank">off('complete')</a>方法，取消监听资源包下载成功事件。游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section131235411188" target="_blank">off('fail')</a>方法，取消监听资源包下载失败事件。       <div _ngcontent-qsa-c106="" class="highlight-div"><div _ngcontent-qsa-c106="" class="highlight-div-header"><div _ngcontent-qsa-c106="" class="highlight-div-header-left"><div _ngcontent-qsa-c106="" class="handle-button expand-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qsa-c106="" class="highlight-div-header-right"><div _ngcontent-qsa-c106="" class="handle-button ai-button"></div><div _ngcontent-qsa-c106="" class="handle-button line-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qsa-c106="" class="handle-button theme-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qsa-c106="" class="handle-button copy-button"><div _ngcontent-qsa-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qsa-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 取消订阅下载状态和下载进度事件。</span></li><li><span class="hljs-keyword">try</span> {</li><li>　assetDownloadManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"progress"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onProgressCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"pause"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPauseCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"complete"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onCompleteCallback</span>);</li><li>　assetDownloadManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"fail"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFailedCallback</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`Failed to do assetDownloadManager.off, errCode: <span class="hljs-subst">${error.code}</span>, errMessage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>