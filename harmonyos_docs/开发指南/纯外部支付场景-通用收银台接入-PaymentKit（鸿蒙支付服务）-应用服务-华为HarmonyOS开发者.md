<h1 _ngcontent-iev-c119="" class="doc-title ng-star-inserted" title="纯外部支付场景"> 纯外部支付场景 </h1>

<div _ngcontent-iev-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section44521256194011">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section44521256194011" tips="复制节点链接"></i></h2>          <p>从5.0.2(14)版本开始，新增支持通用收银台纯外部支付场景。</p>     <p>用户在开发者的应用/元服务中选购完商品，点击下单购买，应用/元服务拉起通用收银台支付仅可以选择三方支付方式完成商品订单的支付。</p>     <p>支持商户模型：不涉及华为支付商户入网。</p>     <p>通用收银台纯外部支付页面展示：</p>     <div class="tablenoborder">      <div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab">               <tbody><tr>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="33.333333333333336%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114559.35029462874362664427386029656759:50001231000000:2800:14D5A92FDBC382A15A1E4D85FCDA3BCDA4A6C7262A17C45965DA705C716FC860.png" title="点击放大" width="206.2032"></span></p></td>         <td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="33.333333333333336%">          <p><span><img height="425.6" originheight="1026" originwidth="494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114559.31585854039788923774994295543323:50001231000000:2800:6FB1B27A4380FA36849989E847B511D14148E806BE417F374A83BD33285F7DDF.png" title="点击放大" width="206.2032"></span></p></td>         <td class="cell-norowborder" style="border: none;" valign="top" width="33.333333333333336%">&nbsp;&nbsp;</td>        </tr>        <tr>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33.333333333333336%">          <p>支付方式选择页面</p></td>         <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33.333333333333336%">          <p>跳转三方支付页面</p></td>         <td class="cellrowborder" style="border: none;" valign="top" width="33.333333333333336%">&nbsp;&nbsp;</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section15662173013114">接入流程<i class="anchor-icon anchor-icon-link" anchorid="section15662173013114" tips="复制节点链接"></i></h2>          <p>华为支付通用收银台纯外部支付接入流程如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="25.75%">          <p>步骤</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="74.25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25.75%">          <p>商户入网（非必选）</p></td>         <td class="cellrowborder" valign="top" width="74.25%">          <p><strong>三方支付商户入网</strong><strong>（非必选）</strong></p>          <p>由于三方支付为直接连接第三方支付平台完成支付，故可能涉及需要开发者在第三方支付平台注册、创建商户（建议开发者用新申请的商户号与现有商户号做区分）。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25.75%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-common-pay-introduction#section3657513103713">产品开通与配置</a></p></td>         <td class="cellrowborder" valign="top" width="74.25%">          <p>申请开通三方支付及完成相关支付模式配置。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25.75%">          <p>通用收银台接入</p></td>         <td class="cellrowborder" valign="top" width="74.25%">          <p>根据纯外部支付场景<a href="/consumer/cn/doc/harmonyos-guides/payment-common-pay-external#section9187179113620">开发步骤</a>完成通用收银台支付接入。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section17560656182617">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section17560656182617" tips="复制节点链接"></i></h2>          <p>纯外部支付模式下，收银台仅支持第三方平台支付，用户无法使用华为支付。具体接入流程如下：</p>     <p><span><img originheight="672" originwidth="970" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114559.16324860683357575965624032545457:50001231000000:2800:08CAB57F7CBDA76EA7E4CCBD42C358F8CB955A647EFB7E2CD5199FE75A6FCF48.png" width="920" height="637.360824742268"></span></p>     <ol>      <li>商户客户端根据商户已开通的支付模式构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section1158325715256" target="_blank">PaymentInfo</a>参数调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section107051621123013" target="_blank">cashierPicker</a>接口拉起Payment Kit通用收银台。</li>      <li>Payment Kit通用收银台展示可用的三方支付方式，用户选择三方支付方式并确认支付。</li>      <li>Payment Kit客户端将用户在通用收银台选择支付方式并确认支付后的支付信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section1129353710263" target="_blank">PickerResult</a>返回给商户客户端。</li>     </ol>     <p></p>     <p><strong>基于URL跳转方式拉起收银台：</strong></p>     <ol>      <li>商户客户端将支付方式通知给商户服务端。</li>      <li>商户服务端调用三方支付的接口获取支付信息。</li>      <li>三方支付服务端将支付跳转链接信息返回给商户服务端。</li>      <li>商户服务端将支付跳转链接信息返回给商户客户端。</li>      <li>商户客户端构建<strong>订单支付跳转信息</strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section159202591414" target="_blank">orderStr</a>请求Payment Kit<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section295285522616" target="_blank">requestPayment</a>接口跳转三方支付。</li>      <li>Payment Kit客户端根据传递的支付消息拉起三方支付收银台。</li>      <li>三方支付客户端展示支付收银台。</li>      <li>用户完成支付操作。</li>      <li>三方支付服务端处理支付。</li>      <li>三方支付服务端同步返回支付状态给三方支付客户端，三方支付客户端展示支付状态后返回商户客户端。</li>      <li>三方支付服务端通过回调接口将支付结果返回给商户服务端。</li>      <li>商户服务端收到支付结果回调请求后，根据三方支付服务要求对支付结果进行验签。</li>     </ol>     <p></p>     <p><strong>基于接口拉起方式拉起收银台：</strong></p>     <ol>      <li>商户客户端将返回的支付方式上送给商户服务端。</li>      <li>商户服务端获取拉起三方收银台参数，构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1240916334438" target="_blank">payInfo</a>（不同三方支付方式拉起收银台参数不同）返回。</li>      <li>商户服务端返回<strong>三方支付信息</strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1240916334438" target="_blank">payInfo</a>给商户客户端。</li>      <li>商户客户端使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1240916334438" target="_blank">payInfo</a>调用Payment Kit的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-third-payment-service#section5214134018367" target="_blank">ThirdPayClient.pay</a>接口拉起三方支付（可同步通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-third-payment-service#section09689720416" target="_blank">ThirdPayClient.handlePayCallback</a>接口调用，获取三方支付操作处理结果）。</li>      <li>Payment Kit拉起三方支付收银台。</li>      <li>三方支付客户端展示支付收银台。</li>      <li>用户完成支付操作。</li>      <li>三方支付服务端处理支付。</li>      <li>三方支付服务端同步返回支付状态给三方支付客户端，三方支付客户端展示支付状态后返回商户客户端。</li>      <li>三方支付客户端将用户支付操作完成同步给Payment Kit客户端。</li>      <li>Payment Kit客户端通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-third-payment-service#section09689720416" target="_blank">ThirdPayClient.handlePayCallback</a>接口，将用户支付操作结果返回给商户客户端。</li>      <li>三方支付服务端通过回调接口将支付结果返回给商户服务端。</li>      <li>商户服务端收到支付结果回调请求后，根据三方支付服务要求对支付结果进行验签，同步返回支付结果给客户端。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section5906121818412">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5906121818412" tips="复制节点链接"></i></h2>          <p>拉起通用收银台接口通过Promise返回结果。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>cashierPicker(context: common.UIAbilityContext, paymentInfo: PaymentInfo): Promise&lt;PickerResult&gt;</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>拉起Payment Kit通用收银台（不含华为支付）。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>requestPayment(context: common.UIAbilityContext, orderStr: string, payload: string): Promise&lt;PayResult&gt;</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>跳转三方支付收银台。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>pay(payInfo: string): Promise&lt;void&gt;;</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>拉起三方支付收银台。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>handlePayCallback(want: Want): boolean;</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>三方支付结果回调同步华为支付收银台。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section9187179113620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9187179113620" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section19371156173617" class="firsth2">拉起通用收银台（端侧开发）<i class="anchor-icon anchor-icon-link" anchorid="section19371156173617" tips="复制节点链接"></i></h3>          <p>商户客户端构建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section1158325715256" target="_blank">PaymentInfo</a>参数调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section107051621123013" target="_blank">cashierPicker</a>接口拉起Payment Kit通用收银台，用户选择支付方式并确认支付后，Payment Kit客户端将支付信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-paymentservice#section1129353710263" target="_blank">PickerResult</a>返回给商户客户端 。</p>     <div class="p">      当接口通过.then()方法返回时，则表示当前接口请求响应正常，通过.catch()方法返回表示接口请求响应异常。当此次请求有异常时，可通过<strong>error.code</strong>获取错误码，错误码相关信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-error-code" target="_blank">错误码</a>。示例代码如下：      <div _ngcontent-iev-c106="" class="highlight-div"><div _ngcontent-iev-c106="" class="highlight-div-header"><div _ngcontent-iev-c106="" class="highlight-div-header-left"><div _ngcontent-iev-c106="" class="handle-button expand-button"><div _ngcontent-iev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iev-c106="" class="highlight-div-header-right"><div _ngcontent-iev-c106="" class="handle-button ai-button"></div><div _ngcontent-iev-c106="" class="handle-button line-button"><div _ngcontent-iev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iev-c106="" class="handle-button theme-button"><div _ngcontent-iev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iev-c106="" class="handle-button copy-button"><div _ngcontent-iev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { paymentService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PaymentKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-title function_">requestCashierPickerCallBack</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// use your own paymentInfo</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">paymentInfo</span>: paymentService.<span class="hljs-property">PaymentInfo</span>= {</li><li>      <span class="hljs-attr">tradeSummary</span>: <span class="hljs-string">"***交易"</span>,</li><li>      <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span>,</li><li>      <span class="hljs-attr">currency</span>: <span class="hljs-string">"CNY"</span>,</li><li>      <span class="hljs-attr">extraInfo</span>: <span class="hljs-string">'{"***":"***"}'</span></li><li>    }</li><li>    paymentService.<span class="hljs-title function_">cashierPicker</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, paymentInfo)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pickerResult: paymentService.PickerResult</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// succeeded in paying</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'succeeded in paying, picker result: '</span>, pickerResult);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// failed to pay</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`failed to pay, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'requestCashierPickerCallBack'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">requestCashierPickerCallBack</span>();</li><li>        })</li><li>      }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section94413415421">拉起三方支付收银台（端侧开发）<i class="anchor-icon anchor-icon-link" anchorid="section94413415421" tips="复制节点链接"></i></h3>          <p>根据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-common-pay-introduction#section3657513103713">产品开通与配置</a>中的所配置的支付方式，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-launch-third-party-payment">拉起三方支付收银台</a>进行三方支付收银台拉起处理。</p>    </div>   </div>   <div></div></div>