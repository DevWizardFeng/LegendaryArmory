<h1 _ngcontent-noq-c119="" class="doc-title ng-star-inserted" title="组件动画"> 组件动画 </h1>

<div _ngcontent-noq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkUI为组件提供了通用的属性动画和转场动画能力的同时，还为一些组件提供了默认的动画效果。例如，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list" target="_blank">List</a>的滑动动效、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-button" target="_blank">Button</a>的点击动效，是组件自带的默认动画效果。在组件默认动画效果的基础上，开发者还可以通过属性动画和转场动画对容器组件内的子组件动效进行定制。</p>    <div class="tiledSection">     <h2 id="使用组件默认动画">使用组件默认动画<i class="anchor-icon anchor-icon-link" anchorid="使用组件默认动画" tips="复制节点链接"></i></h2>          <p>组件默认动效具备以下功能：</p>     <ul>      <li>       <p>提示用户当前状态，例如用户点击Button组件时，Button组件默认变灰，用户即确定完成选中操作。</p></li>      <li>       <p>提升界面精致程度和生动性。</p></li>      <li>       <p>减少开发者工作量，例如列表滑动组件自带滑动动效，开发者直接调用即可。</p></li>     </ul>     <p>更多效果，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-flex" target="_blank">组件说明</a>。</p>     <p>示例代码和效果如下。</p>     <div _ngcontent-noq-c106="" class="highlight-div"><div _ngcontent-noq-c106="" class="highlight-div-header"><div _ngcontent-noq-c106="" class="highlight-div-header-left"><div _ngcontent-noq-c106="" class="handle-button expand-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-noq-c106="" class="highlight-div-header-right"><div _ngcontent-noq-c106="" class="handle-button ai-button"></div><div _ngcontent-noq-c106="" class="handle-button line-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-noq-c106="" class="handle-button theme-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-noq-c106="" class="handle-button copy-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-noq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ComponentDemo</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Checkbox</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'checkbox1'</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">'checkboxGroup'</span> })</li><li>        .<span class="hljs-title function_">select</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">shape</span>(<span class="hljs-title class_">CheckBoxShape</span>.<span class="hljs-property">CIRCLE</span>)</li><li>        .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="200" originwidth="195" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114848.31065755415491631764854941899988:50001231000000:2800:6D03EBDC166ADEF83B65DEE943DA53CAAA71FD454A59D049E558022C08463F69.gif" class="notEnlarge" width="195" height="200"></span></p>    </div>    <div class="tiledSection">     <h2 id="打造组件定制化动效">打造组件定制化动效<i class="anchor-icon anchor-icon-link" anchorid="打造组件定制化动效" tips="复制节点链接"></i></h2>          <p>部分组件支持通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-attribute-animation-overview">属性动画</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-transition-overview">转场动画</a>自定义组件子Item的动效，实现定制化动画效果。例如，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll" target="_blank">Scroll</a>组件中可对各个子组件在滑动时的动画效果进行定制。</p>     <ul>      <li>       <p>在滑动或者点击操作时通过改变各个Scroll子组件的仿射属性来实现各种效果。</p></li>      <li>       <p>如果要在滑动过程中定制动效，可在滑动回调onScroll中监控滑动距离，并计算每个组件的仿射属性。也可以自己定义手势，通过手势监控位置，手动调用ScrollTo改变滑动位置。</p></li>      <li>       <p>在滑动回调onScrollStop或手势结束回调中对滑动的最终位置进行微调。</p></li>     </ul>     <p>定制Scroll组件滑动动效示例代码和效果如下。</p>     <div _ngcontent-noq-c106="" class="highlight-div"><div _ngcontent-noq-c106="" class="highlight-div-header"><div _ngcontent-noq-c106="" class="highlight-div-header-left"><div _ngcontent-noq-c106="" class="handle-button expand-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-noq-c106="" class="highlight-div-header-right"><div _ngcontent-noq-c106="" class="handle-button ai-button"></div><div _ngcontent-noq-c106="" class="handle-button line-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-noq-c106="" class="handle-button theme-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-noq-c106="" class="handle-button copy-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-noq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { curves, <span class="hljs-variable language_">window</span>, display, mediaquery, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AppStorage</span> {</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">mainWin</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">mainWindowSize</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Size</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>}</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 窗口、屏幕相关信息管理类</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManager</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">WindowManager</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">displayInfo</span>: display.<span class="hljs-property">Display</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">orientationListener</span>: mediaquery.<span class="hljs-property">MediaQueryListener</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">uiContext: UIContext</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orientationListener</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getMediaQuery</span>().<span class="hljs-title function_">matchMediaSync</span>(<span class="hljs-string">'(orientation: landscape)'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">orientationListener</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">mediaQueryResult: mediaquery.MediaQueryResult</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPortrait</span>(mediaQueryResult)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadDisplayInfo</span>()</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 设置主window窗口</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> win 当前app窗口</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">setMainWin</span>(<span class="hljs-params">win: <span class="hljs-variable language_">window</span>.Window</span>) {</li><li>    <span class="hljs-keyword">if</span> (win == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span></li><li>    }</li><li>    <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWin</span> = win;</li><li>    win.<span class="hljs-title function_">on</span>(<span class="hljs-string">"windowSizeChange"</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-variable language_">window</span>.Size</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> == <span class="hljs-literal">undefined</span> || <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> == <span class="hljs-literal">null</span>) {</li><li>        <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> = data;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span>.<span class="hljs-property">width</span> == data.<span class="hljs-property">width</span> &amp;&amp; <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span>.<span class="hljs-property">height</span> == data.<span class="hljs-property">height</span>) {</li><li>          <span class="hljs-keyword">return</span></li><li>        }</li><li>        <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> = data;</li><li>      }</li><li>
</li><li>      <span class="hljs-keyword">let</span> winWidth = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMainWindowWidth</span>();</li><li>      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'mainWinWidth'</span>, winWidth)</li><li>      <span class="hljs-keyword">let</span> winHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMainWindowHeight</span>();</li><li>      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'mainWinHeight'</span>, winHeight)</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">UIAbility</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UIAbility</span>()</li><li>      context.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"windowSizeChange"</span>, winWidth, winHeight)</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">WindowManager</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">WindowManager</span>.<span class="hljs-property">instance</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-title class_">WindowManager</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManager</span>(uiContext);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">WindowManager</span>.<span class="hljs-property">instance</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onPortrait</span>(<span class="hljs-params">mediaQueryResult: mediaquery.MediaQueryResult</span>) {</li><li>    <span class="hljs-keyword">if</span> (mediaQueryResult.<span class="hljs-property">matches</span> == <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-string">'isLandscape'</span>)) {</li><li>      <span class="hljs-keyword">return</span></li><li>    }</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-string">'isLandscape'</span>, mediaQueryResult.<span class="hljs-property">matches</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadDisplayInfo</span>()</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 切换屏幕方向</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> ori 常量枚举值：window.Orientation</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">changeOrientation</span>(<span class="hljs-params">ori: <span class="hljs-variable language_">window</span>.Orientation</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWin</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWin</span>.<span class="hljs-title function_">setPreferredOrientation</span>(ori)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">loadDisplayInfo</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayInfo</span> = display.<span class="hljs-title function_">getDefaultDisplaySync</span>()</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'displayWidth'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDisplayWidth</span>())</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'displayHeight'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDisplayHeight</span>())</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取main窗口宽度，单位vp</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">getMainWindowWidth</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> != <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span>.<span class="hljs-property">width</span>) : <span class="hljs-number">0</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取main窗口高度，单位vp</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">getMainWindowHeight</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span> != <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWindowSize</span>.<span class="hljs-property">height</span>) : <span class="hljs-number">0</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取屏幕宽度，单位vp</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">getDisplayWidth</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayInfo</span> != <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayInfo</span>.<span class="hljs-property">width</span>) : <span class="hljs-number">0</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 获取屏幕高度，单位vp</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">getDisplayHeight</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayInfo</span> != <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">px2vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayInfo</span>.<span class="hljs-property">height</span>) : <span class="hljs-number">0</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 释放资源</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">release</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">orientationListener</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">orientationListener</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">mediaQueryResult: mediaquery.MediaQueryResult</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPortrait</span>(mediaQueryResult)</li><li>      })</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWin</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">mainWin</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'windowSizeChange'</span>)</li><li>    }</li><li>    <span class="hljs-title class_">WindowManager</span>.<span class="hljs-property">instance</span> = <span class="hljs-literal">null</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 封装任务卡片信息数据类</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskData</span> {</li><li>  <span class="hljs-attr">bgColor</span>: <span class="hljs-title class_">Color</span> | <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Resource</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">taskInfo</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'music'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">bgColor: Color | <span class="hljs-built_in">string</span> | Resource, index: <span class="hljs-built_in">number</span>, taskInfo: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgColor</span> = bgColor;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = index;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskInfo</span> = taskInfo;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">taskDataArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">TaskData</span>&gt; =</li><li>  [</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#317AF7'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'music'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'mall'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'photos'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'setting'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#317AF7'</span>, <span class="hljs-number">4</span>, <span class="hljs-string">'call'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">5</span>, <span class="hljs-string">'music'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">6</span>, <span class="hljs-string">'mall'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">7</span>, <span class="hljs-string">'photos'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">8</span>, <span class="hljs-string">'setting'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">9</span>, <span class="hljs-string">'call'</span>),</li><li>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskData</span>(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">10</span>, <span class="hljs-string">'music'</span>)</li><li>
</li><li>  ];</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">TaskSwitchMainPage</span> {</li><li>  <span class="hljs-attr">displayWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">WindowManager</span>.<span class="hljs-title function_">getInstance</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()).<span class="hljs-title function_">getDisplayWidth</span>();</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-attr">cardSpace</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 卡片间距</span></li><li>  <span class="hljs-attr">cardWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardSpace</span> / <span class="hljs-number">2</span>; <span class="hljs-comment">// 卡片宽度</span></li><li>  <span class="hljs-attr">cardHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">400</span>; <span class="hljs-comment">// 卡片高度</span></li><li>  <span class="hljs-attr">cardPosition</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = []; <span class="hljs-comment">// 卡片初始位置</span></li><li>  <span class="hljs-attr">clickIndex</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">taskViewOffsetX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cardOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span>;</li><li>  <span class="hljs-attr">lastCardOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span>;</li><li>  <span class="hljs-attr">startTime</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>
</li><li>  <span class="hljs-comment">// 每个卡片初始位置</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; taskDataArr.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardPosition</span>[i] = i * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardSpace</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 每个卡片位置</span></li><li>  <span class="hljs-title function_">getProgress</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">let</span> progress = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardPosition</span>[index] - <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskViewOffsetX</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardWidth</span> / <span class="hljs-number">2</span>) / <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span>;</li><li>    <span class="hljs-keyword">return</span> progress</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span> }) {</li><li>      <span class="hljs-comment">// 背景</span></li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xF0F0F0</span>)</li><li>
</li><li>      <span class="hljs-comment">// 滑动组件</span></li><li>      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>        <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardSpace</span> }) {</li><li>          <span class="hljs-title class_">ForEach</span>(taskDataArr, <span class="hljs-function">(<span class="hljs-params">item: TaskData, index</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Column</span>()</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardWidth</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardHeight</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(item.<span class="hljs-property">bgColor</span>)</li><li>              .<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Solid</span>)</li><li>              .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>              .<span class="hljs-title function_">borderColor</span>(<span class="hljs-number">0xAFEEEE</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>                <span class="hljs-comment">// 计算子组件的仿射属性</span></li><li>              .<span class="hljs-title function_">scale</span>((<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index) &gt;= <span class="hljs-number">0.4</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index) &lt;= <span class="hljs-number">0.6</span>) ?</li><li>                {</li><li>                  <span class="hljs-attr">x</span>: <span class="hljs-number">1.1</span> - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-number">0.5</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index)),</li><li>                  <span class="hljs-attr">y</span>: <span class="hljs-number">1.1</span> - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(<span class="hljs-number">0.5</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index))</li><li>                } :</li><li>                { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1</span> })</li><li>              .<span class="hljs-title function_">animation</span>({ <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">Smooth</span> })</li><li>                <span class="hljs-comment">// 滑动动画</span></li><li>              .<span class="hljs-title function_">translate</span>({ <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> })</li><li>              .<span class="hljs-title function_">animation</span>({ <span class="hljs-attr">curve</span>: curves.<span class="hljs-title function_">springMotion</span>() })</li><li>              .<span class="hljs-title function_">zIndex</span>((<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index) &gt;= <span class="hljs-number">0.4</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProgress</span>(index) &lt;= <span class="hljs-number">0.6</span>) ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: TaskData</span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>())</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>((<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardSpace</span>) * (taskDataArr.<span class="hljs-property">length</span> + <span class="hljs-number">1</span>))</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">gesture</span>(</li><li>        <span class="hljs-title class_">GestureGroup</span>(<span class="hljs-title class_">GestureMode</span>.<span class="hljs-property">Parallel</span>,</li><li>          <span class="hljs-title class_">PanGesture</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">PanDirection</span>.<span class="hljs-property">Horizontal</span>, <span class="hljs-attr">distance</span>: <span class="hljs-number">5</span> })</li><li>            .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent | <span class="hljs-literal">undefined</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (event) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = event.<span class="hljs-property">timestamp</span>;</li><li>              }</li><li>            })</li><li>            .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent | <span class="hljs-literal">undefined</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (event) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCardOffset</span> + event.<span class="hljs-property">offsetX</span>;</li><li>              }</li><li>            })</li><li>            .<span class="hljs-title function_">onActionEnd</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent | <span class="hljs-literal">undefined</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (event) {</li><li>                <span class="hljs-keyword">let</span> time = <span class="hljs-number">0</span></li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>) {</li><li>                  time = event.<span class="hljs-property">timestamp</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;</li><li>                }</li><li>                <span class="hljs-keyword">let</span> speed = event.<span class="hljs-property">offsetX</span> / (time / <span class="hljs-number">1000000000</span>);</li><li>                <span class="hljs-keyword">let</span> moveX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(speed, <span class="hljs-number">2</span>) / <span class="hljs-number">7000</span> * (speed &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>);</li><li>
</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> += moveX;</li><li>                <span class="hljs-comment">// 左滑大于最右侧位置</span></li><li>                <span class="hljs-keyword">let</span> cardOffsetMax = -(taskDataArr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span>);</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> &lt; cardOffsetMax) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> = cardOffsetMax;</li><li>                }</li><li>                <span class="hljs-comment">// 右滑大于最左侧位置</span></li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span>;</li><li>                }</li><li>
</li><li>                <span class="hljs-comment">// 左右滑动距离不满足/满足切换关系时，补位/退回</span></li><li>                <span class="hljs-keyword">let</span> remainMargin = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> % (<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span>);</li><li>                <span class="hljs-keyword">if</span> (remainMargin &lt; <span class="hljs-number">0</span>) {</li><li>                  remainMargin = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> % (<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span>) + <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span>;</li><li>                }</li><li>                <span class="hljs-keyword">if</span> (remainMargin &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span> - remainMargin;</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> -= <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span> - (<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span> - remainMargin);</li><li>                }</li><li>
</li><li>                <span class="hljs-comment">// 记录本次滑动偏移量</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span>;</li><li>              }</li><li>            })</li><li>        ), <span class="hljs-title class_">GestureMask</span>.<span class="hljs-property">IgnoreInternal</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Horizontal</span>)</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)</li><li>
</li><li>      <span class="hljs-comment">// 滑动到首尾位置</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Move to first/last'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x888888</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">30</span> })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">clickIndex</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">clickIndex</span>;</li><li>
</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">clickIndex</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span>;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">4</span> - (taskDataArr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayWidth</span> / <span class="hljs-number">2</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastCardOffset</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardOffset</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="554" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114848.43891691514139776631669072953313:50001231000000:2800:1CBBCF42960709C222B33AAC026807FD38D8B1C6FA31825ABE81C8C2DF95E074.gif" width="300" height="554"></span></p>     <p>通过animateTo可以实现将List中指定的Item替换到首位，List中其余Item依次向下排列。定制List组件动态替换动效的示例代码和效果如下。</p>     <div _ngcontent-noq-c106="" class="highlight-div"><div _ngcontent-noq-c106="" class="highlight-div-header"><div _ngcontent-noq-c106="" class="highlight-div-header-left"><div _ngcontent-noq-c106="" class="handle-button expand-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-noq-c106="" class="highlight-div-header-right"><div _ngcontent-noq-c106="" class="handle-button ai-button"></div><div _ngcontent-noq-c106="" class="handle-button line-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-noq-c106="" class="handle-button theme-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-noq-c106="" class="handle-button copy-button"><div _ngcontent-noq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-noq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { curves, <span class="hljs-title class_">AnimatorResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 该接口控制列表项视觉属性</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListItemModify</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">ListItemAttribute</span>&gt; {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-attr">instance</span>: <span class="hljs-title class_">ListItemAttribute</span>): <span class="hljs-built_in">void</span> {</li><li>    instance.<span class="hljs-title function_">translate</span>({ <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> }) <span class="hljs-comment">// Y轴位移</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DragSortCtrl</span>&lt;T&gt; {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;T&gt;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">modify</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ListItemModify</span>&gt;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>; <span class="hljs-comment">// 新增UIContext成员</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dragRefOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">ITEM_INTV</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;T&gt;, intv: <span class="hljs-built_in">number</span>, uiContext: UIContext</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = arr;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ListItemModify</span>&gt;()</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ITEM_INTV</span> = intv</li><li>    arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListItemModify</span>())</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">itemMove</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">newIndex</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>) <span class="hljs-comment">// 移除当前传入的index</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">splice</span>(newIndex, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]) <span class="hljs-comment">// 将当前移除的index插入到数组前一个位置</span></li><li>    <span class="hljs-keyword">let</span> tmp2 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span>.<span class="hljs-title function_">splice</span>(newIndex, <span class="hljs-number">0</span>, tmp2[<span class="hljs-number">0</span>])</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setDragRef</span>(<span class="hljs-attr">item</span>: T): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragRefOffset</span> = <span class="hljs-number">0</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMove</span>(<span class="hljs-params">item: T, offset: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> = offset - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragRefOffset</span> <span class="hljs-comment">// 逐帧计算传入的offect，每满足一个item高度时，进入下方if逻辑，更新dragRefOffset的值</span></li><li>    <span class="hljs-keyword">let</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">indexOf</span>(item) <span class="hljs-comment">// 在数组中查找传入的item</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span>[index].<span class="hljs-property">offsetY</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> &lt; -<span class="hljs-variable language_">this</span>.<span class="hljs-property">ITEM_INTV</span> / <span class="hljs-number">2</span>) { <span class="hljs-comment">// 通过判断使指定的item逐一移动到首位</span></li><li>      <span class="hljs-comment">// 使用interpolatingSpring曲线生成弹簧动画</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">animateTo</span>({ <span class="hljs-attr">curve</span>: curves.<span class="hljs-title function_">interpolatingSpring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">400</span>, <span class="hljs-number">38</span>) }, <span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">ITEM_INTV</span> <span class="hljs-comment">// 调整偏移量实现平滑移动</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragRefOffset</span> -= <span class="hljs-variable language_">this</span>.<span class="hljs-property">ITEM_INTV</span> <span class="hljs-comment">// 移动的总偏移量</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`item offsetY <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.offsetY}</span> dragRefOffset <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dragRefOffset}</span>`</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemMove</span>(index, index - <span class="hljs-number">1</span>) <span class="hljs-comment">// 执行列表项位置交换</span></li><li>      })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getModify</span>(<span class="hljs-attr">item</span>: T): <span class="hljs-title class_">ListItemModify</span> {</li><li>    <span class="hljs-keyword">let</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">indexOf</span>(item)</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modify</span>[index]</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ListAutoSortExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">dragSortCtrl</span>: <span class="hljs-title class_">DragSortCtrl</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DragSortCtrl</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-number">120</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>())</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">firstListItemGroupCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listScroll</span>: <span class="hljs-title class_">ListScroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListScroller</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">backAnimator</span>: <span class="hljs-title class_">AnimatorResult</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span></li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">itemEnd</span>(<span class="hljs-params">item: <span class="hljs-built_in">number</span>, index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"To TOP"</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-string">"4vp"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`item number item <span class="hljs-subst">${item}</span> index <span class="hljs-subst">${index}</span>`</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroll</span>.<span class="hljs-title function_">closeAllSwipeActions</span>({</li><li>          <span class="hljs-attr">onFinish</span>: <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragSortCtrl</span>.<span class="hljs-title function_">setDragRef</span>(item)</li><li>            <span class="hljs-keyword">let</span> length = <span class="hljs-number">120</span> * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">indexOf</span>(item))</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">backAnimator</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">createAnimator</span>({ <span class="hljs-comment">// 创建弹簧动画</span></li><li>              <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span>,</li><li>              <span class="hljs-attr">easing</span>: <span class="hljs-string">"interpolating-spring(0, 1, 150, 24)"</span>,</li><li>              <span class="hljs-attr">delay</span>: <span class="hljs-number">0</span>,</li><li>              <span class="hljs-attr">fill</span>: <span class="hljs-string">"none"</span>,</li><li>              <span class="hljs-attr">direction</span>: <span class="hljs-string">"normal"</span>,</li><li>              <span class="hljs-attr">iterations</span>: <span class="hljs-number">1</span>,</li><li>              <span class="hljs-attr">begin</span>: <span class="hljs-number">0</span>,</li><li>              <span class="hljs-attr">end</span>: -length</li><li>            })</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">backAnimator</span>.<span class="hljs-property">onFrame</span> = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> { <span class="hljs-comment">// 逐帧回调更新位置</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragSortCtrl</span>.<span class="hljs-title function_">onMove</span>(item, value) <span class="hljs-comment">// 处理list的移动替换动效</span></li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">backAnimator</span>.<span class="hljs-property">onFinish</span> = <span class="hljs-function">() =&gt;</span> {}</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">backAnimator</span>.<span class="hljs-title function_">play</span>() <span class="hljs-comment">// 启动动画</span></li><li>          }</li><li>        })</li><li>      })</li><li>    }.<span class="hljs-title function_">padding</span>(<span class="hljs-string">"4vp"</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">header</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(title)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroll</span> }) {</li><li>          <span class="hljs-title class_">ListItemGroup</span>({ <span class="hljs-attr">header</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">header</span>(<span class="hljs-string">'first ListItemGroup'</span>), <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span>, index</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstListItemGroupCount</span>) {</li><li>                <span class="hljs-title class_">ListItem</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">''</span> + item)</li><li>                    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                    .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>                    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">swipeAction</span>({</li><li>                  <span class="hljs-attr">end</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemEnd</span>(item, index)</li><li>                })</li><li>                .<span class="hljs-title function_">clip</span>(<span class="hljs-literal">true</span>)</li><li>                .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dragSortCtrl</span>.<span class="hljs-title function_">getModify</span>(item)) <span class="hljs-comment">// 动态设置属性修改</span></li><li>                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })</li><li>              }</li><li>            })</li><li>          }</li><li>          <span class="hljs-title class_">ListItemGroup</span>({ <span class="hljs-attr">header</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">header</span>(<span class="hljs-string">'second ListItemGroup'</span>), <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span>, index</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstListItemGroupCount</span> - <span class="hljs-number">1</span>) {</li><li>                <span class="hljs-title class_">ListItem</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">''</span> + item)</li><li>                    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                    .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>                    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">swipeAction</span>({</li><li>                  <span class="hljs-attr">end</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemEnd</span>(item, index)</li><li>                })</li><li>                .<span class="hljs-title function_">clip</span>(<span class="hljs-literal">true</span>)</li><li>                .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dragSortCtrl</span>.<span class="hljs-title function_">getModify</span>(item))</li><li>                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })</li><li>              }</li><li>            })</li><li>          }</li><li>        }</li><li>        .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>      }</li><li>    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="736" originwidth="351" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114848.03141026275813461753730893494545:50001231000000:2800:784DA1DBD8F0E5AB26574840CC5B91C1E20BC239B59F1B558DC43681FFE8BD24.gif" width="351" height="736"></span></p>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/harmonyos_samples/animation-collection" target="_blank">动效案例合集</a></li>     </ul>    </div>   </div>   <div></div></div>