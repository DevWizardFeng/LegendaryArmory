<h1 _ngcontent-vki-c119="" class="doc-title ng-star-inserted" title="编辑图片EXIF信息"> 编辑图片EXIF信息 </h1>

<div _ngcontent-vki-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Image Kit提供图片EXIF信息的读取与编辑能力。</p>    <p>EXIF（Exchangeable image file format）是专门为数码相机的照片设定的文件格式，可以记录数码照片的属性信息和拍摄数据。当前支持JPEG、PNG、HEIF格式，且需要图片包含EXIF信息。</p>    <p>在图库等应用中，需要查看或修改数码照片的EXIF信息。由于摄像机的手动镜头参数无法自动写入到EXIF信息中或者因为相机断电等原因会导致拍摄时间出错，这时需要手动修改错误的EXIF数据，即可使用本功能。</p>    <p>HarmonyOS目前仅支持对部分EXIF信息的查看和修改，具体支持的范围请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#propertykey7" target="_blank">Exif信息</a>。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>EXIF信息的读取与编辑相关API的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-imagesource#getimageproperty11" target="_blank">API参考</a>。</p>     <p>获取图片，创建ImageSource。读取、编辑EXIF信息。示例代码如下：</p>     <div _ngcontent-vki-c106="" class="highlight-div"><div _ngcontent-vki-c106="" class="highlight-div-header"><div _ngcontent-vki-c106="" class="highlight-div-header-left"><div _ngcontent-vki-c106="" class="handle-button expand-button"><div _ngcontent-vki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vki-c106="" class="highlight-div-header-right"><div _ngcontent-vki-c106="" class="handle-button ai-button"></div><div _ngcontent-vki-c106="" class="handle-button line-button"><div _ngcontent-vki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vki-c106="" class="handle-button theme-button"><div _ngcontent-vki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vki-c106="" class="handle-button copy-button"><div _ngcontent-vki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入相关模块包。</span></li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 获取沙箱路径创建ImageSource。</span></li><li><span class="hljs-keyword">const</span> fd : <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 获取需要被处理的图片的fd。</span></li><li><span class="hljs-keyword">const</span> imageSourceApi : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fd);</li><li>
</li><li><span class="hljs-comment">// 读取EXIF信息，BitsPerSample为每个像素比特数。</span></li><li><span class="hljs-keyword">let</span> options : image.<span class="hljs-property">ImagePropertyOptions</span> = { <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">defaultValue</span>: <span class="hljs-string">'This key has no value!'</span> };</li><li>imageSourceApi.<span class="hljs-title function_">getImageProperty</span>(image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">BITS_PER_SAMPLE</span>, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data : <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting the value of the specified attribute key of the image.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get the value of the specified attribute key of the image, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>})</li><li>
</li><li><span class="hljs-comment">// 编辑EXIF信息。</span></li><li>imageSourceApi.<span class="hljs-title function_">modifyImageProperty</span>(image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">IMAGE_WIDTH</span>, <span class="hljs-string">"120"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  imageSourceApi.<span class="hljs-title function_">getImageProperty</span>(image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">IMAGE_WIDTH</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">width : <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'The new imageWidth is '</span> + width);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get the Image Width, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  })</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to modify the Image Width, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>})</li></ol></pre></div></div>    </div>   </div>   <div></div></div>