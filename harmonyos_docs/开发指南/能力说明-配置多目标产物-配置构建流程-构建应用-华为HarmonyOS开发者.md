<h1 _ngcontent-jan-c119="" class="doc-title ng-star-inserted" title="能力说明"> 能力说明 </h1>

<div _ngcontent-jan-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001731595144"><p id="ZH-CN_TOPIC_0000002510174473__p14706191753620">通常情况下，应用厂商会根据不同的部署环境，不同的目标人群，不同的运行环境等，将同一个应用定制为不同的版本，如国内版、国际版、普通版、VIP版、免费版、付费版等。针对以上场景，DevEco Studio支持通过少量的代码配置以实例化不同的差异版本，在编译构建过程中实现一个应用构建出不同的目标产物版本，从而实现源代码、资源文件等的高效复用。</p> <p id="ZH-CN_TOPIC_0000002510174473__p8706181723612">在了解HarmonyOS应用的多目标构建产物如何定制前，先了解target和product的概念：</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul9706141753616"><li id="li187061617123617">工程内的每一个Entry/Feature模块，对应的构建产物为HAP，HAP是应用/元服务可以独立运行在设备中的形态。由于在不同的业务场景中，同一个模块可能需要定制不同的功能或资源，因此引入target的概念。一个模块可以定义多个target，每个target对应一个定制的HAP，通过配置可以实现一个模块构建出不同的HAP。</li><li id="li177061017133611">一个HarmonyOS工程的构建产物为APP包，APP包用于应用/元服务发布上架应用市场。由于不同的业务场景，需要定制不同的应用包，因此引入product概念。一个工程可以定义多个product，每个product对应一个定制化应用包，通过配置可以实现一个工程构建出多个不同的应用包。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p2570203015567">更多关于多目标产物的实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-target" target="_blank">多目标产物构建开发实践</a>。</p> <div class="tiledSection"><h2 id="section1011341611469">定制HAP多目标构建产物<i class="anchor-icon anchor-icon-link" anchorid="section1011341611469" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174473__p7602131215374">每一个Entry/Feature模块均支持定制不同的target，通过在模块中的build-profile.json5文件中实现差异化定制，当前支持HAP包名、设备类型（deviceType）、源码集（source）、资源（resource）、buildOption配置项（如C++依赖的.so、混淆配置、abi类型、cppFlags等）、分发规则（distributionFilter）的定制。</p> <p id="ZH-CN_TOPIC_0000002510174473__p102483683811"></p> <p id="ZH-CN_TOPIC_0000002510174473__p1862644711376"><strong>定义目标产物target</strong></p> <p id="ZH-CN_TOPIC_0000002510174473__p18626184753719">每一个target对应一个定制的HAP，因此，在定制HAP多目标构建产物前，应提前规划好需要定制的target名称。例如，以ArkTS Stage模型为例，定义一个免费版和付费版，模块级build-profile.json5文件示例如下：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1722919283811" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>  <span class="hljs-string">"buildOption"</span>: {   </li><li>  }, </li><li>  <span class="hljs-string">"targets"</span>: [  <span class="hljs-comment">//定义不同的target </span></li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,  <span class="hljs-comment">//默认target名称default </span></li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>,  <span class="hljs-comment">//免费版target名称 </span></li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>,  <span class="hljs-comment">//付费版target名称 </span></li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p142293215388">按照上述target的定义，在编译构建时，会同时打包生成default、free和pay三个不同的HAP。</p> </div> <p id="ZH-CN_TOPIC_0000002510174473__p172751331203819"></p> <div class="tiledSection"><h3 id="section329173315468" class="firsth2">定义产物的HAP包名<i class="anchor-icon anchor-icon-link" anchorid="section329173315468" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p1316421613815">每一个target均可以指定产物命名。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen17164121620382" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class=""><span class="hljs-string">"apiType"</span></span>: <span class=""><span class="hljs-string">"stageMode"</span></span>, </li><li>  <span class=""><span class="hljs-string">"buildOption"</span></span>: { </li><li>  }, </li><li>  <span class=""><span class="hljs-string">"targets"</span></span>: [ </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"default"</span></span>, </li><li>      <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>        <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedTargetOutputName-1.0.0"</span></span>  <span class="hljs-comment">//产物名称为customizedTargetOutputName</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"free"</span></span>, </li><li>      <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>        <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedTargetOutputName1-1.0.0"</span></span>  <span class="hljs-comment">//产物名称为customizedTargetOutputName1</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"pay"</span></span>, </li><li>      <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>        <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedTargetOutputName2-1.0.0"</span></span>  <span class="hljs-comment">//产物名称为customizedTargetOutputName2</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>      } </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p21659167385">如果已配置签名，target产物对应的HAP包名为开发者定制的名称；如果未配置签名，target产物对应的HAP包名为开发者定制的名称+unsigned。</p> <div class="tiledSection"><h3 id="section14980174415464">定义产物的deviceType<i class="anchor-icon anchor-icon-link" anchorid="section14980174415464" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p12556145514402">每一个target均可以指定支持的设备类型deviceType，也可以不定义。如果不定义，则该target默认支持module.json5/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-configuration-file-overview-fa" target="_blank">config.json</a>中定义的设备类型。</p> <p id="ZH-CN_TOPIC_0000002510174473__p2055645534017">同时，在定义每个target的deviceType时，支持的设备类型必须在module.json5或config.json中已经定义。例如，在上述定义的3个target中，分别定义default默认支持所有设备类型，free和pay版本只支持phone设备。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1855655584013" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>  <span class="hljs-string">"buildOption"</span>: { </li><li>  }, </li><li>  <span class="hljs-string">"targets"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,  <span class="hljs-comment">//未定义deviceType，默认支持config.json或module.json5中定义的设备类型 </span></li><li>
</li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [  <span class="hljs-comment">//定义free支持的设备类型为phone </span></li><li>          <span class="hljs-string">"phone"</span> </li><li>        ] </li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>, </li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [  <span class="hljs-comment">//定义pay支持的设备类型为phone </span></li><li>          <span class="hljs-string">"phone"</span> </li><li>        ] </li><li>      } </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p0676842134012"></p> <div class="tiledSection"><h3 id="section1214253811115">定义产物的distributionFilter<i class="anchor-icon anchor-icon-link" anchorid="section1214253811115" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1495231320419">在未定义target的分发规则distributionFilter时，以module配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#distributionfilter标签" target="_blank">distributionFilter</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-structure#distrofilter对象的内部结构" target="_blank">distroFilter</a>分发规则为准。</p> <p id="ZH-CN_TOPIC_0000002510174473__p1595281344118">针对多target存在相同设备类型deviceType的场景，相同设备类型的target需要指定分发规则distributionFilter。</p> <p id="ZH-CN_TOPIC_0000002510174473__p199521913194111">如果是FA工程，请将distributionFilter字段替换为distroFilter。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1695211344115" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class=""><span class="hljs-string">"apiType"</span></span>: <span class=""><span class="hljs-string">"stageMode"</span></span>, </li><li>  <span class=""><span class="hljs-string">"buildOption"</span></span>: { </li><li>  }, </li><li>  <span class=""><span class="hljs-string">"targets"</span></span>: [ </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"default"</span></span>, </li><li>
</li><li>    }, </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"free"</span></span>, </li><li>      <span class=""><span class="hljs-string">"config"</span></span>: { </li><li>        <span class=""><span class="hljs-string">"distributionFilter"</span></span>: {  <span class="hljs-comment">// 具体请参考distributionFilter标签</span></li><li>          <span class=""><span class="hljs-string">"screenShape"</span></span>: { <span class="hljs-comment">// 屏幕形状枚举 </span></li><li>            <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>, </li><li>            <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"circle"</span></span>] </li><li>          } </li><li>        } </li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"pay"</span></span>, </li><li>      <span class=""><span class="hljs-string">"config"</span></span>: { </li><li>        <span class=""><span class="hljs-string">"distributionFilter"</span></span>: { </li><li>          <span class=""><span class="hljs-string">"screenShape"</span></span>: { </li><li>            <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>, </li><li>            <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"rect"</span></span>] </li><li>          } </li><li>        } </li><li>      } </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> </div> <p id="ZH-CN_TOPIC_0000002510174473__p159431111174115"></p> <div class="tiledSection"><h3 id="section206461457101917">定义产物preloads的分包<i class="anchor-icon anchor-icon-link" anchorid="section206461457101917" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p1344611364413">对于元服务，每一个target均可以指定preloads的分包，也可以不定义。如果不定义，则以module.json5中的配置为准。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1446163615415" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class=""><span class="hljs-string">"apiType"</span></span><span class="">: </span><span class=""><span class="hljs-string">'stageMode'</span></span><span class="">,</span> </li><li><span class="">  <span class="hljs-string">"showInServiceCenter"</span></span><span class="">: <span class="hljs-keyword">true</span>,</span> </li><li>  <span class=""><span class="hljs-string">"buildOption"</span></span><span class="">: </span>{ </li><li>  }<span class="">,</span> </li><li>  <span class=""><span class="hljs-string">"targets"</span></span><span class="">: </span>[   </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,  </span> </li><li>    }<span class="">,</span></li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"free"</span></span><span class="">,  </span> </li><li>    }<span class="">,</span></li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"pay"</span></span><span class="">,  </span> </li><li>      <span class=""><span class="hljs-string">"config"</span></span><span class="">: </span>{ </li><li>        <span class=""><span class="hljs-string">"atomicService"</span></span><span class="">: </span>{ </li><li>          <span class=""><span class="hljs-string">"preloads"</span></span><span class="">: </span>[  <span class="hljs-comment">//指定preloads的分包 </span></li><li>            { </li><li>              <span class=""><span class="hljs-string">"moduleName"</span></span><span class="">: </span><span class=""><span class="hljs-string">"preloadSharedLibrary"</span></span></li><li>            } </li><li>          ] </li><li>        } </li><li>      } </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p9725153424120"></p> <div class="tiledSection"><h3 id="section73018336472">定义产物的source源码集-pages<i class="anchor-icon anchor-icon-link" anchorid="section73018336472" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1198815413411">对于source源码集的定制，由于Stage模型和FA模型的差异，Stage模型支持对pages源码目录的page页面进行定制，FA模型则支持对Ability源码目录下的page页面进行定制。</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul598805464118"><li id="li498885416417">例如，Stage模型中的工程，在模块的pages目录下分别定义了Index.ets、Page1.ets和Page2.ets三个页面。其中default使用了Index.ets页面；free使用了Index.ets和Page1.ets页面；pay使用了Index.ets和Page2.ets页面，则示例代码如下所示：<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen16809125018472" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>   <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>   <span class="hljs-string">"buildOption"</span>: { </li><li>   }, </li><li>   <span class="hljs-string">"targets"</span>: [ </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义Stage模型中默认版target的pages源码文件</span></li><li>         <span class="hljs-string">"pages"</span>: [ </li><li>           <span class="hljs-string">"pages/Index"</span> </li><li>         ] </li><li>       } </li><li>     }, </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>       <span class="hljs-string">"config"</span>: { </li><li>         <span class="hljs-string">"deviceType"</span>: [ </li><li>           <span class="hljs-string">"phone"</span> </li><li>         ] </li><li>       }, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义Stage模型中免费版target的pages源码文件</span></li><li>         <span class="hljs-string">"pages"</span>: [ </li><li>           <span class="hljs-string">"pages/Index"</span>, </li><li>           <span class="hljs-string">"pages/Page1"</span> </li><li>         ] </li><li>       } </li><li>     }, </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>, </li><li>       <span class="hljs-string">"config"</span>: { </li><li>         <span class="hljs-string">"deviceType"</span>: [ </li><li>           <span class="hljs-string">"phone"</span> </li><li>         ] </li><li>       }, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义Stage模型中付费版target的pages源码文件</span></li><li>         <span class="hljs-string">"pages"</span>: [ </li><li>           <span class="hljs-string">"pages/Index"</span>, </li><li>           <span class="hljs-string">"pages/Page2"</span> </li><li>         ] </li><li>       } </li><li>     } </li><li>   ] </li><li> }</li></ol></pre></div></div> </li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul837818325433"><li id="li63781032194319">例如，FA模型中的工程，在模块的MainAbility中定义了index.ets、page1.ets和page2.ets，其中：default使用了index.ets 页面；free使用了index.ets和page1.ets页面；pay使用了index.ets和page2.ets页面。<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1436216417485" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>   <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'faMode'</span>, </li><li>   <span class="hljs-string">"buildOption"</span>: { </li><li>   }, </li><li>   <span class="hljs-string">"targets"</span>: [ </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义FA模型中默认版target的pages源码文件</span></li><li>         <span class="hljs-string">"abilities"</span>: [ </li><li>           { </li><li>             <span class="hljs-string">"name"</span>: <span class="hljs-string">".MainAbility"</span>, </li><li>             <span class="hljs-string">"pages"</span>: [ </li><li>               <span class="hljs-string">"pages/index"</span> </li><li>             ] </li><li>           } </li><li>         ], </li><li>       } </li><li>     }, </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>       <span class="hljs-string">"config"</span>: { </li><li>         <span class="hljs-string">"deviceType"</span>: [ </li><li>           <span class="hljs-string">"phone"</span> </li><li>         ] </li><li>       }, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义FA模型中免费版target的pages源码文件</span></li><li>         <span class="hljs-string">"abilities"</span>: [ </li><li>           { </li><li>             <span class="hljs-string">"name"</span>: <span class="hljs-string">".MainAbility"</span>, </li><li>             <span class="hljs-string">"pages"</span>: [ </li><li>               <span class="hljs-string">"pages/index"</span>, </li><li>               <span class="hljs-string">"pages/page1"</span> </li><li>             ] </li><li>           } </li><li>         ], </li><li>       } </li><li>     }, </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>, </li><li>       <span class="hljs-string">"config"</span>: { </li><li>         <span class="hljs-string">"deviceType"</span>: [ </li><li>           <span class="hljs-string">"phone"</span> </li><li>         ] </li><li>       }, </li><li>       <span class="hljs-string">"source"</span>: {  <span class="hljs-comment">//定义FA模型中付费版target的pages源码文件</span></li><li>         <span class="hljs-string">"abilities"</span>: [ </li><li>           { </li><li>             <span class="hljs-string">"name"</span>: <span class="hljs-string">".MainAbility"</span>, </li><li>             <span class="hljs-string">"pages"</span>: [ </li><li>               <span class="hljs-string">"pages/index"</span>, </li><li>               <span class="hljs-string">"pages/page2"</span> </li><li>             ] </li><li>           } </li><li>         ], </li><li>       } </li><li>     } </li><li>   ] </li><li> }</li></ol></pre></div></div> </li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p10972942174019"></p> </div> <div class="tiledSection"><h3 id="section18668905913">定义产物的source源码集-sourceRoots<i class="anchor-icon anchor-icon-link" anchorid="section18668905913" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1798074414310">在模块的主代码空间（src/main）下，承载着开发者编写的公共代码。如果开发者需要实现不同target之间的差异化逻辑，可以使用差异化代码空间（sourceRoots）。配合差异化代码空间的能力，可以在主代码空间中代码不变的情况下，针对不同的target，编译对应的代码到最终产物中。</p> <p id="ZH-CN_TOPIC_0000002510174473__p155511347194920"><strong>概念说明</strong></p> <ul id="ZH-CN_TOPIC_0000002510174473__ul176291531164411"><li id="li36291431104415">packageName：当前模块的oh-package.json5中的name字段对应的值。</li><li id="li1694314338449">sourceRoot：&lt;defaultSourceRoot&gt; | &lt;targetSourceRoot&gt; ，其中&lt;defaultSourceRoot&gt;是 src/main，&lt;targetSourceRoot&gt;可自定义，寻址优先级为 &lt;targetSourceRoot&gt; &gt; &lt;defaultSourceRoot&gt;。</li><li id="li521019363449">sourcePath：在sourceRoot中的代码结构目录。</li><li id="li23621387441">sourceFileName：代码目录下的ets文件名。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p2415527135015"></p> <p id="ZH-CN_TOPIC_0000002510174473__p10271169409">例如以下工程目录：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" id="ZH-CN_TOPIC_0000002510174473__screen118669256409" data-highlighted="yes"><ol class="linenums"><li>entry</li><li>|<span class="hljs-comment">--src</span></li><li>|<span class="hljs-comment">----main</span></li><li>|<span class="hljs-comment">------ets</span></li><li>|<span class="hljs-comment">--------code</span></li><li>|<span class="hljs-comment">----------test.ets</span></li><li>|<span class="hljs-comment">----target</span></li><li>|<span class="hljs-comment">------util</span></li><li>|<span class="hljs-comment">--------util.ets</span></li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002510174473__ul15853916489"><li id="li15855911486">packageName为entry。</li><li id="li11851790487">sourceRoot为src/main、src/target。</li><li id="li785199124818">sourcePath为ets/code、util。</li><li id="li16856974812">sourceFileName为test.ets、util.ets。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p18432195516273"><strong>规格限制</strong></p> <p id="ZH-CN_TOPIC_0000002510174473__p64657282281">1. import xxx from '&lt;packageName&gt;/sourcePath/sourceFileName' ：通过packageName的方式，省略sourceRoot，可以实现不同target下的差异化构建。</p> <p id="ZH-CN_TOPIC_0000002510174473__p9972449470">2. 支持hap、hsp、har（请注意：开启<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-filename-obfuscation" target="_blank">文件/文件夹名称混淆</a>的har模块需要使用-keep-file-name指定sourceRoot，sourcePath，sourceFileName对应的文件/文件夹名称不被混淆）。</p> <p id="ZH-CN_TOPIC_0000002510174473__p15510191012318">3. 不支持跨模块引用。</p> <p id="ZH-CN_TOPIC_0000002510174473__p1033615527310">4. 不支持动态import。</p> <p id="ZH-CN_TOPIC_0000002510174473__p321418271347"></p> <p id="ZH-CN_TOPIC_0000002510174473__p1087962715345"><strong>编译时模块target的选择优先级说明</strong></p> <p id="ZH-CN_TOPIC_0000002510174473__p148555113597">在模块编译的过程中，该模块使用的sourceRoots由当前模块编译时的target来决定。当前模块编译时选择target的优先级则为：命令行显式指定 &gt; 直接引用方target &gt; default。</p> <p id="ZH-CN_TOPIC_0000002510174473__p171219582910">如以下示例：</p> <p id="ZH-CN_TOPIC_0000002510174473__p583914613304">hap -&gt; hsp -&gt; har（-&gt;表示依赖）</p> <p id="ZH-CN_TOPIC_0000002510174473__p10479184410298">其中hap和hsp存在三个target：default、custom、static，而har存在两个target：default、static。</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul1353725563015"><li id="li05371554300">执行编译命令：hvigorw -p module=hap@custom assembleHap，hap指定target为custom进行编译，那么三个模块编译时的target分别为：<p id="ZH-CN_TOPIC_0000002510174473__p1541893184314">hap: custom，命令行显式指定；</p> <p id="ZH-CN_TOPIC_0000002510174473__p117818348436">hsp: custom，命令行没有显式指定，则基于直接引用方查找，hsp的直接引用方为hap，hap的target为custom，hsp存在该target，则hsp的target为custom；</p> <p id="ZH-CN_TOPIC_0000002510174473__p4133113915439">har: default，命令行没有显式指定，则基于直接引用方查找，har的直接引用方为hsp，hsp的target为custom，har不存在该target，则har的target为default；</p> </li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul11647410123115"><li id="li12647010103117">执行编译命令：hvigorw -p module=hap@custom,hsp@static assembleHap assembleHsp，hap指定target为custom，hsp则指定target为static进行编译，那么三个模块编译时的target分别为：<p id="ZH-CN_TOPIC_0000002510174473__p5194164483114">hap: custom，命令行显式指定；</p> <p id="ZH-CN_TOPIC_0000002510174473__p929425934216">hsp: static，命令行显式指定；</p> <p id="ZH-CN_TOPIC_0000002510174473__p83241348154214">har: static，命令行没有显式指定，则基于直接引用方查找，har的直接引用方为hsp，hsp的target为static，har存在该target，则har的target为static。</p> </li><li id="li17191925111410">在当前依赖关系的基础上，添加依赖：hap -&gt; har。执行编译命令：hvigorw -p module=hap@custom,hsp@static assembleHap assembleHsp。由于har没有显式指定target，且存在两个target不同的直接引用方（hap和hsp，对应的target分别为custom和static），所以编译过程中har的target只能二选一。基于这种场景，建议开发者显式指定模块的target进行编译：hvigorw -p module=hap@custom,hsp@static,har@static assembleHap assembleHsp assembleHar。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p18898340153310"><strong>示例</strong></p> <p id="ZH-CN_TOPIC_0000002510174473__p1920421817468">1. 在entry模块的build-profile.json5中添加sourceRoots：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen15681012193415" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">"stageMode"</span>,</li><li>  <span class="hljs-string">"buildOption"</span>: {},</li><li>  <span class="hljs-string">"targets"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"source"</span>: { </li><li>        <span class="hljs-string">"sourceRoots"</span>: [<span class="hljs-string">"./src/default"</span>] <span class="hljs-comment">// 配置target为default的差异化代码空间</span></li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"custom"</span>, </li><li>      <span class="hljs-string">"source"</span>: { </li><li>        <span class="hljs-string">"sourceRoots"</span>: [<span class="hljs-string">"./src/custom"</span>] <span class="hljs-comment">// 配置target为custom的差异化代码空间</span></li><li>      } </li><li>    } </li><li>  ]</li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p12223125810449"></p> <p id="ZH-CN_TOPIC_0000002510174473__p176951255174620">2. 在src目录下新增default/Test.ets和custom/Test.ets，新增后的模块目录结构：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" id="ZH-CN_TOPIC_0000002510174473__screen883134954616" data-highlighted="yes"><ol class="linenums"><li>entry</li><li>  |<span class="hljs-comment">--src</span></li><li>    |<span class="hljs-comment">--main</span></li><li>      |<span class="hljs-comment">--ets</span></li><li>        |<span class="hljs-comment">--pages</span></li><li>          |<span class="hljs-comment">--Index.ets</span></li><li>    |<span class="hljs-comment">--default</span></li><li>      |<span class="hljs-comment">--Test.ets  // 新增</span></li><li>    |<span class="hljs-comment">--custom</span></li><li>      |<span class="hljs-comment">--Test.ets  // 新增  </span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p514211364510"></p> <p id="ZH-CN_TOPIC_0000002510174473__p9545142535611">3. 在default/Test.ets中写入代码：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002510174473__screen18157186574" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getName</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-string">"default"</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p9755194085713"></p> <p id="ZH-CN_TOPIC_0000002510174473__p10984340125716">4. 在custom/Test.ets中写入代码：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002510174473__screen62872219584" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getName</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-string">"custom"</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p18964029155812"></p> <p id="ZH-CN_TOPIC_0000002510174473__p7886639105016">5. 修改src/main/ets/pages/Index.ets的代码：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510174473__screen7500133510552" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { getName } <span class="hljs-keyword">from</span> <span class="hljs-string">'entry/Test'</span>; <span class="hljs-comment">// 其中entry为模块级的oh-package.json5中的name字段的值</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> { </li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title function_">getName</span>(); </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) { </li><li>    <span class="hljs-title class_">RelativeContainer</span>() { </li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>) </li><li>    } </li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>) </li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>) </li><li>  }</li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p101201140205014"></p> <p id="ZH-CN_TOPIC_0000002510174473__p054114665">6. 在工程级的build-profile.json5中配置targets：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen3504505194" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"app"</span>: {</li><li>    <span class="hljs-string">"signingConfigs"</span>: [],</li><li>    <span class="hljs-string">"products"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>,</li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>,</li><li>      }</li><li>    ],</li><li>    <span class="hljs-string">"buildModeSet"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"debug"</span>,</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span></li><li>      }</li><li>    ]</li><li>  },</li><li>  <span class="hljs-string">"modules"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"entry"</span>,</li><li>      <span class="hljs-string">"srcPath"</span>: <span class="hljs-string">"./entry"</span>,</li><li>      <span class="hljs-string">"targets"</span>: [</li><li>        {</li><li>          <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>          <span class="hljs-string">"applyToProducts"</span>: [</li><li>            <span class="hljs-string">"default"</span></li><li>          ]</li><li>        },</li><li>        {</li><li>          <span class="hljs-string">"name"</span>: <span class="hljs-string">"custom"</span>,</li><li>          <span class="hljs-string">"applyToProducts"</span>: [</li><li>            <span class="hljs-string">"default"</span></li><li>          ]</li><li>        }</li><li>      ]</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p20771143116916"></p> <p id="ZH-CN_TOPIC_0000002510174473__p17223381228">7. Sync完成后，选择entry的target为default，点击Run，界面展示default；选择entry的target为custom，点击Run，则界面展示custom。</p> <p id="ZH-CN_TOPIC_0000002510174473__p1610412571211"></p> </div> <div class="tiledSection"><h3 id="section1853511169480">定义产物的资源<i class="anchor-icon anchor-icon-link" anchorid="section1853511169480" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p181641557443">每个target使用的资源文件可能存在差异，在开发过程中，开发者可以将每个target所使用的资源存放在不同的资源目录下。其中，ArkTS工程支持对main目录下的资源文件目录（resource）进行定制；JS工程支持对main目录下的资源文件目录（resource）及 Ability下的资源文件目录（res）进行定制。如下为ArkTS工程的资源文件目录定制示例：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen016465134415" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>  <span class="hljs-string">"buildOption"</span>: { </li><li>  }, </li><li>  <span class="hljs-string">"targets"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"source"</span>: { </li><li>        <span class="hljs-string">"pages"</span>: [ </li><li>          <span class="hljs-string">"pages/Index"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"resource"</span>: {  <span class="hljs-comment">// 定义默认版target使用的资源文件目录 </span></li><li>        <span class="hljs-string">"directories"</span>: [ </li><li>          <span class="hljs-string">"./src/main/resources_default"</span> </li><li>        ] </li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [ </li><li>          <span class="hljs-string">"phone"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"source"</span>: {   </li><li>        <span class="hljs-string">"pages"</span>: [ </li><li>          <span class="hljs-string">"pages/Index"</span>, </li><li>          <span class="hljs-string">"pages/Page1"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"resource"</span>: {  <span class="hljs-comment">// 定义免费版target使用的资源文件目录 </span></li><li>        <span class="hljs-string">"directories"</span>: [ </li><li>          <span class="hljs-string">"./src/main/resources_free"</span>,</li><li>          <span class="hljs-string">"./src/main/resources_default"</span></li><li>        ] </li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>, </li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [ </li><li>          <span class="hljs-string">"phone"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"source"</span>: {   </li><li>        <span class="hljs-string">"pages"</span>: [ </li><li>          <span class="hljs-string">"pages/Index"</span>, </li><li>          <span class="hljs-string">"pages/Page2"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"resource"</span>: {  <span class="hljs-comment">// 定义付费版target使用的资源文件目录</span></li><li>        <span class="hljs-string">"directories"</span>: [ </li><li>          <span class="hljs-string">"./src/main/resources_pay"</span>,</li><li>          <span class="hljs-string">"./src/main/resources_default"</span></li><li>        ] </li><li>      } </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p1379066938">编译构建时，资源文件存在以下优先级顺序：</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul18895844234"><li id="li299617591437">AppScope目录下的资源文件会合入到模块下相同路径的资源目录中。如果两个目录下存在重名文件，编译打包后AppScope目录下的资源文件会覆盖模块下的资源。</li><li id="li168959441932">如果target引用的多个资源文件目录下，存在重名文件，则在构建打包过程中，将按照配置的资源文件目录顺序进行选择。例如，上述付费版target引用的资源中，resources_pay和resources_default中存在重名文件，则resources_pay中的资源会被打包到HAP中。</li></ul> <div class="tiledSection"><h3 id="section82111917125413">定义产物的icon、label、launchType<i class="anchor-icon anchor-icon-link" anchorid="section82111917125413" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p189514414559">针对每一个的target的ability，均可以定制不同的icon、label和launchType。如果不定义，则该target采用module.json5中module.abilities配置的icon、label，launchType默认为"singleton"。示例如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen2995446125718" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>   <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>   <span class="hljs-string">"buildOption"</span>: { </li><li>   }, </li><li>   <span class="hljs-string">"targets"</span>: [ </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>       <span class="hljs-string">"source"</span>: {</li><li>        <span class="hljs-string">"abilities"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>            <span class="hljs-string">"icon"</span>:<span class="hljs-string">"$media:layered_image"</span>,</li><li>            <span class="hljs-string">"label"</span>:<span class="hljs-string">"$string:EntryAbility_label"</span>,</li><li>            <span class="hljs-string">"launchType"</span>: <span class="hljs-string">"singleton"</span></li><li>          }</li><li>        ]</li><li>      }</li><li>     }, </li><li>     { </li><li>       <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>       <span class="hljs-string">"source"</span>: {</li><li>        <span class="hljs-string">"abilities"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>            <span class="hljs-string">"icon"</span>:<span class="hljs-string">"$media:layered_image"</span>,</li><li>            <span class="hljs-string">"label"</span>:<span class="hljs-string">"$string:EntryAbility_label"</span>,</li><li>            <span class="hljs-string">"launchType"</span>: <span class="hljs-string">"multiton"</span></li><li>          }</li><li>        ]</li><li>      }</li><li>     }</li><li>   ] </li><li> }</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section3118153524810">定义C++工程依赖的.so文件<i class="anchor-icon anchor-icon-link" anchorid="section3118153524810" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p132101218144411">在 C++ 工程中，可以对每个target依赖的.so文件进行定制。例如某模块依赖了function1.so、function2.so和function3.so三个文件，其中target为default的产物依赖了function1.so和function2.so；其中target为vip的产物依赖了function1.so和 function3.so，则示例代码如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen18529141510404" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>,</li><li>  <span class="hljs-string">"buildOption"</span>: {</li><li>    <span class="hljs-string">"externalNativeOptions"</span>: {</li><li>      <span class="hljs-string">"path"</span>: <span class="hljs-string">"./src/main/cpp/CMakeLists.txt"</span>,</li><li>      <span class="hljs-string">"arguments"</span>: [],</li><li>      <span class="hljs-string">"abiFilters"</span>: [</li><li>        <span class="hljs-string">"arm64-v8a"</span>,</li><li>        <span class="hljs-string">"x86_64"</span></li><li>      ],</li><li>      <span class="hljs-string">"cppFlags"</span>: <span class="hljs-string">""</span>,</li><li>    }</li><li>  },</li><li>  <span class="hljs-string">"targets"</span>: [  <span class="hljs-comment">//定义不同的target </span></li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>      <span class="hljs-string">"config"</span>: {</li><li>        <span class="hljs-string">"buildOption"</span>: {</li><li>          <span class="hljs-string">"nativeLib"</span>: {</li><li>            <span class="hljs-string">"filter"</span>: {</li><li>              <span class="hljs-comment">//按照.so文件的优先级顺序，打包最高优先级的function1.so文件 </span></li><li>              <span class="hljs-string">"pickFirsts"</span>: [</li><li>                <span class="hljs-string">"**/function1.so"</span></li><li>              ],</li><li>              <span class="hljs-comment">//排除不打包的function3.so文件 </span></li><li>              <span class="hljs-string">"excludes"</span>: [</li><li>                <span class="hljs-string">"**/function3.so"</span></li><li>              ],</li><li>              <span class="hljs-comment">//允许当.so中资源重名冲突时，使用高优先级的.so文件覆盖低优先级的.so文件 </span></li><li>              <span class="hljs-string">"enableOverride"</span>: <span class="hljs-keyword">true</span></li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"vip"</span>,</li><li>      <span class="hljs-string">"config"</span>: {</li><li>        <span class="hljs-string">"buildOption"</span>: {</li><li>          <span class="hljs-string">"nativeLib"</span>: {</li><li>            <span class="hljs-string">"filter"</span>: {</li><li>              <span class="hljs-comment">//按照.so文件的优先级顺序，打包最高优先级的function1.so文件 </span></li><li>              <span class="hljs-string">"pickFirsts"</span>: [</li><li>                <span class="hljs-string">"**/function1.so"</span></li><li>              ],</li><li>              <span class="hljs-comment">//排除不打包的function2.so文件 </span></li><li>              <span class="hljs-string">"excludes"</span>: [</li><li>                <span class="hljs-string">"**/function2.so"</span></li><li>              ],</li><li>              <span class="hljs-comment">//允许当.so中资源重名冲突时，使用高优先级的.so文件覆盖低优先级的.so文件 </span></li><li>              <span class="hljs-string">"enableOverride"</span>: <span class="hljs-keyword">true</span></li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section173102213445">定制HAR多目标构建产物<i class="anchor-icon anchor-icon-link" anchorid="section173102213445" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174473__p16636588447">每一个HAR模块均支持定制不同的target，通过在模块中的build-profile.json5文件中实现差异化定制，当前支持设备类型（deviceType）、资源（resource）、buildOption配置项（如C++依赖的.so、混淆配置、abi类型、cppFlags等）、源码集（source）的定制。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174473__p630618113452">在DevEco Studio中编译HAR模块时，仅支持default target，若需指定其他target，需通过命令行来指定，并通过命令行来编译。</p> <p id="ZH-CN_TOPIC_0000002510174473__p193607116314">例如构建指定的自定义target:free的har，可参考执行以下命令：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" id="ZH-CN_TOPIC_0000002510174473__screen1074132711561" data-highlighted="yes"><ol class="linenums"><li>hvigorw --mode <span class="hljs-keyword">module</span> -p product=<span class="hljs-keyword">default</span> -p <span class="hljs-keyword">module</span>=library<span class="hljs-meta">@free</span> -p buildMode=debug assembleHar</li></ol></pre></div></div> </div></div></div> </div> <div class="tiledSection"><h3 id="section18788124274410" class="firsth2">定义产物的deviceType<i class="anchor-icon anchor-icon-link" anchorid="section18788124274410" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p274661116533">每一个target均可以指定支持的设备类型deviceType，也可以不定义。如果不定义，则该target默认支持module.json5/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-configuration-file-overview-fa" target="_blank">config.json</a>中定义的设备类型。</p> <p id="ZH-CN_TOPIC_0000002510174473__p15746311105319">同时，在定义每个target的deviceType时，支持的设备类型必须在module.json5或config.json中已经定义。例如，在上述定义的2个target中，分别定义default默认支持所有设备类型，free版本只支持2in1设备。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen9746201165316" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>  <span class="hljs-string">"buildOption"</span>: { </li><li>  }, </li><li>  <span class="hljs-string">"targets"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>  <span class="hljs-comment">//未定义deviceType，默认支持config.json或module.json5中定义的设备类型 </span></li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>,</li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [  <span class="hljs-comment">//定义free支持的设备类型为2in1</span></li><li>          <span class="hljs-string">"2in1"</span> </li><li>        ] </li><li>      } </li><li>    }</li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p7747311165320"></p> </div> <div class="tiledSection"><h3 id="section1742443519446">定义C++工程依赖的.so文件<i class="anchor-icon anchor-icon-link" anchorid="section1742443519446" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1722024516592">在 C++ 工程中，可以对每个target依赖的.so文件进行定制。例如某模块依赖了function1.so、function2.so和function3.so三个文件，其中target为default的产物依赖了function1.so和function2.so；其中target为vip的产物依赖了function1.so和 function3.so，则示例代码如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen7220184525914" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>,</li><li>  <span class="hljs-string">"buildOption"</span>: {</li><li>    <span class="hljs-string">"externalNativeOptions"</span>: {</li><li>      <span class="hljs-string">"path"</span>: <span class="hljs-string">"./src/main/cpp/CMakeLists.txt"</span>,</li><li>      <span class="hljs-string">"arguments"</span>: [],</li><li>      <span class="hljs-string">"abiFilters"</span>: [</li><li>        <span class="hljs-string">"arm64-v8a"</span>,</li><li>        <span class="hljs-string">"x86_64"</span></li><li>      ],</li><li>      <span class="hljs-string">"cppFlags"</span>: <span class="hljs-string">""</span>,</li><li>    }</li><li>  },</li><li>  <span class="hljs-string">"targets"</span>: [  <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义不同的</span></span><span class=""><span class="hljs-comment">target </span></span></li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>      <span class="hljs-string">"config"</span>: {</li><li>        <span class="hljs-string">"buildOption"</span>: {</li><li>          <span class="hljs-string">"nativeLib"</span>: {</li><li>            <span class="hljs-string">"filter"</span>: {</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">按照</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件的优先级顺序，打包最高优先级的</span></span><span class=""><span class="hljs-comment">function1.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"pickFirsts"</span>: [</li><li>                <span class="hljs-string">"**/function1.so"</span></li><li>              ],</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">排除不打包的</span></span><span class=""><span class="hljs-comment">function3.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"excludes"</span>: [</li><li>                <span class="hljs-string">"**/function3.so"</span></li><li>              ],</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">允许当</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">中资源重名冲突时，使用高优先级的</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件覆盖低优先级的</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"enableOverride"</span>: <span class="hljs-keyword">true</span></li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"vip"</span>,</li><li>      <span class="hljs-string">"config"</span>: {</li><li>        <span class="hljs-string">"buildOption"</span>: {</li><li>          <span class="hljs-string">"nativeLib"</span>: {</li><li>            <span class="hljs-string">"filter"</span>: {</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">按照</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件的优先级顺序，打包最高优先级的</span></span><span class=""><span class="hljs-comment">function1.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"pickFirsts"</span>: [</li><li>                <span class="hljs-string">"**/function1.so"</span></li><li>              ],</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">排除不打包的</span></span><span class=""><span class="hljs-comment">function2.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"excludes"</span>: [</li><li>                <span class="hljs-string">"**/function2.so"</span></li><li>              ],</li><li>              <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">允许当</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">中资源重名冲突时，使用高优先级的</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件覆盖低优先级的</span></span><span class=""><span class="hljs-comment">.so</span></span><span class=""><span class="hljs-comment">文件 </span></span></li><li>              <span class="hljs-string">"enableOverride"</span>: <span class="hljs-keyword">true</span></li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section1248185214551">定义产物的资源<i class="anchor-icon anchor-icon-link" anchorid="section1248185214551" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p824875265511">每个target使用的资源文件可能存在差异，在开发过程中，开发者可以将每个target所使用的资源存放在不同的资源目录下。其中，ArkTS工程支持对main目录下的资源文件目录（resource）进行定制；JS工程支持对main目录下的资源文件目录（resource）及 Ability下的资源文件目录（res）进行定制。如下为ArkTS工程的资源文件目录定制示例：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen224825210551" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"apiType"</span>: <span class="hljs-string">'stageMode'</span>, </li><li>  <span class="hljs-string">"buildOption"</span>: { </li><li>  }, </li><li>  <span class="hljs-string">"targets"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>      <span class="hljs-string">"resource"</span>: {  <span class="hljs-comment">//定义默认版target使用的资源文件目录 </span></li><li>        <span class="hljs-string">"directories"</span>: [ </li><li>          <span class="hljs-string">"./src/main/resources_default"</span> </li><li>        ] </li><li>      } </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>, </li><li>      <span class="hljs-string">"config"</span>: { </li><li>        <span class="hljs-string">"deviceType"</span>: [ </li><li>          <span class="hljs-string">"2in1"</span> </li><li>        ] </li><li>      }, </li><li>      <span class="hljs-string">"resource"</span>: {  <span class="hljs-comment">//定义免费版target使用的资源文件目录 </span></li><li>        <span class="hljs-string">"directories"</span>: [ </li><li>          <span class="hljs-string">"./src/main/resources_free"</span>,</li><li>          <span class="hljs-string">"./src/main/resources_default"</span></li><li>        ] </li><li>      } </li><li>    },</li><li>  ] </li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section13344184411593">定义产物的source源码集-sourceRoots<i class="anchor-icon anchor-icon-link" anchorid="section13344184411593" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p77819411209">请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-customized-multi-targets-and-products-guides#section18668905913">定义产物的source源码集-sourceRoots</a>。</p> </div> <div class="tiledSection"><h2 id="section680552311459">配置APP多目标构建产物<i class="anchor-icon anchor-icon-link" anchorid="section680552311459" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174473__p68231323104516">APP用于应用/元服务上架发布，针对不同的应用场景，可以定制不同的product，每个product中支持对bundleName、bundleType、签名信息、icon和label以及包含的target进行定制。</p> </div> <p id="ZH-CN_TOPIC_0000002510174473__p1553111408457"><strong>定义目标产物product</strong></p> <p id="ZH-CN_TOPIC_0000002510174473__p153211407450">每一个product对应一个定制的APP包，因此，在定制APP多目标构建产物前，应提前规划好需要定制的product名称。例如，定义productA和productB。工程级build-profile.json5文件示例如下：</p> <p id="ZH-CN_TOPIC_0000002510174473__p184501642468">在定制product时，必须存在"default"的product，否则编译时会出现错误。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174473__p1582702934113">在编译构建流程中，default product或者default target都承载着兜底机制，其中，default target可以缺省。当某个模块的default target缺省时，Hvigor会默认加上default target并挂载到default product中，因此，构建default product时，默认会构建出default target。如果不想构建出default target，建议参考<a href="/consumer/cn/doc/harmonyos-guides/ide-customized-multi-targets-and-products-guides#section7613106105114">定义product中包含的target</a>，自定义product以及包含的target。</p> </div></div></div> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1045014134616" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"app"</span>: { </li><li>  <span class="hljs-string">"signingConfigs"</span>: [], </li><li>  <span class="hljs-string">"products"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productA"</span>, </li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productB"</span>, </li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>    } </li><li>  ], </li><li>  <span class="hljs-string">"buildModeSet"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"debug"</span>, </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span> </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p174421141125814"></p> <div class="tiledSection"><h3 id="section1959916462423" class="firsth2">定义产物的APP包名和供应商名称<i class="anchor-icon anchor-icon-link" anchorid="section1959916462423" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p8451194124615">每一个product均可以指定产物命名和供应商名称。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen54513413465" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class=""><span class="hljs-string">"app"</span></span>: { </li><li>    <span class=""><span class="hljs-string">"signingConfigs"</span></span>: [], </li><li>    <span class=""><span class="hljs-string">"products"</span></span>: [ </li><li>      { </li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"default"</span></span>, </li><li>        <span class=""><span class="hljs-string">"signingConfig"</span></span>: <span class=""><span class="hljs-string">"default"</span></span>, </li><li>        <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span>: <span class=""><span class="hljs-string">"6.0.1(21)"</span></span>, </li><li>        <span class=""><span class="hljs-string">"runtimeOS"</span></span>: <span class=""><span class="hljs-string">"HarmonyOS"</span></span>, </li><li>        <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>          <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedProductOutputName-1.0.0"</span></span>  <span class="hljs-comment">//产物名称为customizedProductOutputName</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>        }, </li><li>        <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"</span><span class=""><span class="hljs-string">customizedProductVendorName</span></span><span class="hljs-string">"</span>   <span class="hljs-comment">//供应商名称为</span><span class=""><span class="hljs-comment">customizedProductVendorName</span></span></li><li>      }, </li><li>      { </li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"productA"</span></span>, </li><li>        <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span>: <span class=""><span class="hljs-string">"6.0.1(21)"</span></span>, </li><li>        <span class=""><span class="hljs-string">"runtimeOS"</span></span>: <span class=""><span class="hljs-string">"HarmonyOS"</span></span>, </li><li>        <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>          <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedProductOutputNameA-1.0.0"</span></span>  <span class="hljs-comment">//产物名称为customizedProductOutputNameA</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>        }, </li><li>        <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"</span><span class=""><span class="hljs-string">customizedProductVendorNameA</span></span><span class="hljs-string">"</span>   <span class="hljs-comment">//供应商名称为</span><span class=""><span class="hljs-comment">customizedProductVendorName</span></span><span class="hljs-comment">A</span></li><li>      }, </li><li>      { </li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"productB"</span></span>, </li><li>        <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span>: <span class=""><span class="hljs-string">"6.0.1(21)"</span></span>, </li><li>        <span class=""><span class="hljs-string">"runtimeOS"</span></span>: <span class=""><span class="hljs-string">"HarmonyOS"</span></span>, </li><li>        <span class=""><span class="hljs-string">"output"</span></span>: { </li><li>          <span class=""><span class="hljs-string">"artifactName"</span></span>: <span class=""><span class="hljs-string">"customizedProductOutputNameB-1.0.0"</span> </span><span class="hljs-comment">//产物名称为customizedProductOutputNameB</span><span class=""><span class="hljs-comment">-1.0.0</span></span></li><li>        }, </li><li>        <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"</span><span class=""><span class="hljs-string">customizedProductVendorName</span></span><span class="hljs-string">B"</span>   <span class="hljs-comment">//供应商名称为</span><span class=""><span class="hljs-comment">customizedProductVendorName</span></span><span class="hljs-comment">B</span></li><li>      } </li><li>    ], </li><li>    <span class=""><span class="hljs-string">"buildModeSet"</span></span>: [ </li><li>      { </li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"debug"</span></span>, </li><li>      }, </li><li>      { </li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"release"</span></span> </li><li>      } </li><li>    ] </li><li>  }, </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p15452104204617">如果已配置签名，product产物对应的APP包名为开发者定制的名称；如果未配置签名，product产物对应的APP包名为开发者定制的名称+unsigned。</p> </div> <p id="ZH-CN_TOPIC_0000002510174473__p1251919375588"></p> <div class="tiledSection"><h3 id="section189551830165020">定义product的bundleName<i class="anchor-icon anchor-icon-link" anchorid="section189551830165020" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1745284114610">针对每个定义的product，均可以定制不同的bundleName，如果product未定义bundleName，则采用工程默认的bundleName。示例如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen34526434616" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"app"</span>: { </li><li>  <span class="hljs-string">"signingConfigs"</span>: [], </li><li>  <span class="hljs-string">"products"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example00.com"</span>  <span class="hljs-comment">//定义default的bundleName信息 </span></li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productA"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li> </li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example01.com"</span>  <span class="hljs-comment">//定义productA的bundleName信息</span></li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productB"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example02.com"</span>  <span class="hljs-comment">//定义productB的bundleName信息 </span></li><li>    } </li><li>  ], </li><li>  <span class="hljs-string">"buildModeSet"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"debug"</span>, </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span> </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> </div> <p id="ZH-CN_TOPIC_0000002510174473__p164108332586"></p> <div class="tiledSection"><h3 id="section15553140141218">定义product的bundleType<i class="anchor-icon anchor-icon-link" anchorid="section15553140141218" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p204531444614">针对每个定义的product，均可以定制不同的bundleType。开发者可以通过定义每个product的bundleType，分别定义产物类型：</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul154531249468"><li id="li1745320413466">bundleType值为app，表示产物为应用；</li><li id="li2453104164618">bundleType值为atomicService，表示产物为元服务。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p18453144124615">如果product未定义bundleType，则采用工程的bundleType（即创建工程时选择的Application/Atomic Service）。示例如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen74533417465" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"app"</span></span><span class="">: </span>{ </li><li>  <span class=""><span class="hljs-string">"signingConfigs"</span></span><span class="">: </span>[]<span class="">,</span> </li><li>  <span class=""><span class="hljs-string">"products"</span></span><span class="">: </span>[ </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"signingConfig"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span><span class="">: </span><span class=""><span class="hljs-string">"6.0.1(21)"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"runtimeOS"</span></span><span class="">: </span><span class=""><span class="hljs-string">"HarmonyOS"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"bundleName"</span></span><span class="">: </span><span class=""><span class="hljs-string">"com.example00.com"</span></span><span class="">,  </span> </li><li>      <span class=""><span class="hljs-string">"bundleType"</span></span><span class="">: </span><span class=""><span class="hljs-string">"app"</span> </span><span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">default</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">bundleType</span></span><span class=""><span class="hljs-comment">信息</span></span><span class="hljs-comment"> </span></li><li>    }<span class="">,</span></li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"productA"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"signingConfig"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span><span class="">: </span><span class=""><span class="hljs-string">"6.0.1(21)"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"runtimeOS"</span></span><span class="">: </span><span class=""><span class="hljs-string">"HarmonyOS"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"bundleName"</span></span><span class="">: </span><span class=""><span class="hljs-string">"com.example01.com"</span></span><span class="">,  </span>  </li><li>      <span class=""><span class="hljs-string">"bundleType"</span></span><span class="">: </span><span class=""><span class="hljs-string">"atomicService"</span>  </span><span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productA</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">bundleType</span></span><span class=""><span class="hljs-comment">信息</span></span><span class="hljs-comment"> </span></li><li>    }<span class="">,</span></li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"productB"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"signingConfig"</span></span><span class="">: </span><span class=""><span class="hljs-string">"default"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"compatibleSdkVersion"</span></span><span class="">: </span><span class=""><span class="hljs-string">"6.0.1(21)"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"runtimeOS"</span></span><span class="">: </span><span class=""><span class="hljs-string">"HarmonyOS"</span></span><span class="">,</span> </li><li>      <span class=""><span class="hljs-string">"bundleName"</span></span><span class="">: </span><span class=""><span class="hljs-string">"com.example02.com"</span></span><span class="">,  </span>  </li><li>      <span class=""><span class="hljs-string">"bundleType"</span></span><span class="">: </span><span class=""><span class="hljs-string">"atomicService"</span>  </span><span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productB</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">bundleType</span></span><span class=""><span class="hljs-comment">信息</span></span><span class="hljs-comment"> </span></li><li>    } </li><li>  ]<span class="">,</span> </li><li>  <span class=""><span class="hljs-string">"buildModeSet"</span></span><span class="">: </span>[ </li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"debug"</span></span><span class="">,</span> </li><li>    }<span class="">,</span></li><li>    { </li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"release"</span></span></li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> </div> <p id="ZH-CN_TOPIC_0000002510174473__p6315142911583"></p> <div class="tiledSection"><h3 id="section0464550509">定义product的签名配置信息<i class="anchor-icon anchor-icon-link" anchorid="section0464550509" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p194551746461">针对每个定义的product，均可以定制不同的signingConfig签名文件，如果product未定义signingConfig，则构建生成未签名的APP包。</p> <p id="ZH-CN_TOPIC_0000002510174473__p54559424615">通常情况下，您首先需要在签名配置界面或工程的build-profile.json5文件中配置签名信息。例如在<strong>File &gt; Project Structure &gt; Project &gt; Signing Configs</strong>界面，分别配置default、productA和productB的签名信息，如下图所示：</p> <p id="ZH-CN_TOPIC_0000002510174473__p3998744917"><span><img originheight="591" originwidth="954" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104916.60291968674032559547575836743462:50001231000000:2800:B32C0E2234839B4E5AD2A2F0CEFAED58DA8F93A1ED6421C453B34CB47B3A6F93.png" width="920" height="569.937106918239"></span></p> </div> <p id="ZH-CN_TOPIC_0000002510174473__p234251034613"></p> <p id="ZH-CN_TOPIC_0000002510174473__p9727142584612">签名信息配置完成后，再添加各个product对应的签名文件，示例如下所示：</p> <p id="ZH-CN_TOPIC_0000002510174473__p166421241144620">您也可以提前在product中定义签名文件信息，然后在签名界面对每个product进行签名，确保配置的product签名文件与签名界面配置的签名文件保持一致即可。</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1864211411466" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"app"</span>: { </li><li>  <span class="hljs-string">"signingConfigs"</span>: [], <span class="hljs-comment">//此处通过界面配置签名后会自动生成相应的签名配置，本文略 </span></li><li>  <span class="hljs-string">"products"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>, <span class="hljs-comment">//定义default的签名文件信息</span></li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example00.com"</span>  </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productA"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"productA"</span>, <span class="hljs-comment">//定义productA的签名文件信息</span></li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example01.com"</span>  </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"productB"</span>, </li><li>      <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"productB"</span>, <span class="hljs-comment">//定义productB的签名文件信息</span></li><li>      <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>      <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>      <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example02.com"</span> </li><li>    } </li><li>  ], </li><li>  <span class="hljs-string">"buildModeSet"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"debug"</span>, </li><li>    }, </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span> </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p1782292265818"></p> <div class="tiledSection"><h3 id="section131374382148">定义product的icon和label<i class="anchor-icon anchor-icon-link" anchorid="section131374382148" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002510174473__p1137638161413">针对每个定义的product，均可以定制不同的icon和label，如果product未定义icon和label，则采用工程默认的icon和label。示例如下所示：</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174473__p467115033018">products中的icon和label字段在编译时会替换<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file" target="_blank">app.json5</a>中对应的字段，app.json5和module.json5均可以配置这两个字段，如果都配置，优先级顺序请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/layered-image#配置优先级和生成策略" target="_blank">配置优先级</a>。</p> </div></div></div> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1377820305192" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"app"</span>: {</li><li>    <span class="hljs-string">"signingConfigs"</span>: [],</li><li>    <span class="hljs-string">"products"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>,</li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>,</li><li>        <span class="hljs-string">"icon"</span>:<span class="hljs-string">"$media:default_icon"</span>, <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">default</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">icon</span></span></li><li>        <span class="hljs-string">"label"</span>:<span class="hljs-string">"$string:default_name"</span>, <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">default</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">label</span></span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"productA"</span>,</li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>,</li><li>        <span class="hljs-string">"icon"</span>:<span class="hljs-string">"$media:productA_icon"</span>, <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productA</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">icon</span></span></li><li>        <span class="hljs-string">"label"</span>:<span class="hljs-string">"$string:productA_name"</span>, <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productA</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">label</span></span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"productB"</span>,</li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>,</li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>,</li><li>        <span class="hljs-string">"icon"</span>:<span class="hljs-string">"$media:productB_icon"</span>, <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productB</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">icon</span></span></li><li>        <span class="hljs-string">"label"</span>:<span class="hljs-string">"$string:productB_name"</span>,  <span class=""><span class="hljs-comment">//</span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">productB</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">label</span></span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-string">"buildModeSet"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"debug"</span>,</li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"release"</span></li><li>      }</li><li>    ]</li><li>  },</li><li>  ...</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section7613106105114">定义product中包含的target<i class="anchor-icon anchor-icon-link" anchorid="section7613106105114" tips="复制节点链接"></i></h3></div> <p id="ZH-CN_TOPIC_0000002510174473__p764217416460">开发者可以选择需要将定义的target分别打包到哪一个product中，每个product可以指定一个或多个target。</p> <p id="ZH-CN_TOPIC_0000002510174473__p13642174154616">同时每个target也可以打包到不同的product中，但是同一个module的不同target不能打包到同一个product中（除非该module的不同target配置了不同的deviceType或distributionFilter/distroFilter）。</p> <p id="ZH-CN_TOPIC_0000002510174473__p18642104114466">例如，前面定义了default、free和pay三个target，现需要将default target打包到default product中；将free target打包到productA中；将pay target打包到productB中，对应的示例代码如下所示：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen3642194111466" data-highlighted="yes"><ol class="linenums"><li>{ </li><li>  <span class="hljs-string">"app"</span>: { </li><li>    <span class="hljs-string">"signingConfigs"</span>: [], <span class="hljs-comment">//此处通过界面配置签名后会自动生成相应的签名配置，本文略 </span></li><li>    <span class="hljs-string">"products"</span>: [ </li><li>      { </li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>, </li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"default"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>        <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example00.com"</span>  </li><li>      }, </li><li>      { </li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"productA"</span>, </li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"productA"</span>,</li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>        <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example01.com"</span>  </li><li>      }, </li><li>      { </li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"productB"</span>, </li><li>        <span class="hljs-string">"signingConfig"</span>: <span class="hljs-string">"productB"</span>,  </li><li>        <span class="hljs-string">"compatibleSdkVersion"</span>: <span class="hljs-string">"6.0.1(21)"</span>, </li><li>        <span class="hljs-string">"runtimeOS"</span>: <span class="hljs-string">"HarmonyOS"</span>, </li><li>        <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.example02.com"</span> </li><li>      } </li><li>    ], </li><li>  <span class="hljs-string">"modules"</span>: [ </li><li>    { </li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"entry"</span>, </li><li>      <span class="hljs-string">"srcPath"</span>: <span class="hljs-string">"./entry"</span>, </li><li>      <span class="hljs-string">"targets"</span>: [ </li><li>        { </li><li>          <span class="hljs-string">"name"</span>: <span class="hljs-string">"default"</span>,  <span class="hljs-comment">//将default target打包到default APP中 </span></li><li>          <span class="hljs-string">"applyToProducts"</span>: [ </li><li>            <span class="hljs-string">"default"</span> </li><li>          ] </li><li>        }, </li><li>        { </li><li>          <span class="hljs-string">"name"</span>: <span class="hljs-string">"free"</span>,  <span class="hljs-comment">//将free target打包到productA APP中 </span></li><li>          <span class="hljs-string">"applyToProducts"</span>: [ </li><li>            <span class="hljs-string">"productA"</span> </li><li>          ] </li><li>        }, </li><li>        { </li><li>          <span class="hljs-string">"name"</span>: <span class="hljs-string">"pay"</span>,  <span class="hljs-comment">//将pay target打包到productB APP中 </span></li><li>          <span class="hljs-string">"applyToProducts"</span>: [ </li><li>            <span class="hljs-string">"productB"</span> </li><li>          ] </li><li>        } </li><li>      ] </li><li>    } </li><li>  ] </li><li>}</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section2554174114463">构建定义的目标产物<i class="anchor-icon anchor-icon-link" anchorid="section2554174114463" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174473__p364310413466">每个target对应一个HAP，每个product对应一个APP包，在编译构建时，如果存在多product或多target时，您可以指定编译具体的包。</p> <p id="ZH-CN_TOPIC_0000002510174473__p1564316413464">单击右上角的<span><img originheight="18" originwidth="18" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.02054283297870619013377150536663:50001231000000:2800:16C0256CAADD8E1726817C499B62B3733D546F07D4AABB14D035090C259668CE.png" class="IconPic notEnlarge" width="18" height="18"></span>图标，指定需要打包的<strong>Product</strong>及<strong>Target</strong>，然后单击<strong>Apply</strong>保存。例如选择"ProductA"中，entry模块对应的"free" Target。</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul11643641184619"><li id="li10643174113460"><strong>Product</strong>：选择需要构建的APP包。</li><li id="li664310416462"><strong>Build Mode</strong>：选择<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-compilation-options-customizing-guide#section192461528194916">编译模式</a>。</li><li id="li3643194116467"><strong>Product Info</strong>：该APP包的BundleName和SigningConfig信息。</li><li id="li1464364134613"><strong>Target Select</strong>：选择各个模块的Target，该Target需要包含在定义的Product中才能选择，如果未包含则显示"No Target to apply"</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p84364320131"><span><img originheight="339" originwidth="462" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.41842841422357000577911546434575:50001231000000:2800:B5CE2A9A7FF9A3E9D8DA1DC66A5F1C3D119B191725EBF98D8E350654E3DB61CA.png" width="462" height="339"></span></p> <p id="ZH-CN_TOPIC_0000002510174473__p66436414467">然后执行编译构建APP/HAP的任务：</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul6643154164614"><li id="li4643341154612">单击菜单栏的<strong>Build &gt; Build Hap(s)/APP(s) &gt; Build APP(s)</strong> ，构建指定的Product对应的APP。例如，按照<a href="/consumer/cn/doc/harmonyos-guides/ide-customized-multi-targets-and-products-guides#section7613106105114">上述配置文件</a>和上图中的配置，此时DevEco Studio将构建生成ProductA的APP包。default和ProductB的APP均不会生成。</li><li id="li4643341114613">单击菜单栏的<strong>Build &gt; Build Hap(s)/APP(s) &gt; Build Hap(s)</strong>，构建指定Product下的所有Target对应的HAP。</li></ul> <p id="ZH-CN_TOPIC_0000002510174473__p136431841174615">如果您想将某个模块下的指定target打包生成HAP，可以在工程目录中，单击模块名，然后再单击<strong>Build &gt; Make Module </strong><strong>‘模块名 </strong><strong>’</strong>，此时DevEco Studio将构建生成模块下指定target对应的包。例如，按照上述配置，此时DevEco Studio将构建生成entry模块下free的HAP。</p> <p id="ZH-CN_TOPIC_0000002510174473__p1664454117469"><span><img originheight="188" originwidth="522" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.49709124648523510203553520516513:50001231000000:2800:8BCF99AC17DED2CAE017A540CE909549246B8F2C1C3707B075A501B73FE8B5F4.png" width="522" height="188"></span></p> </div> <div class="tiledSection"><h2 id="section856344110465">调试和运行指定的Target<i class="anchor-icon anchor-icon-link" anchorid="section856344110465" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510174473__p5644154164614">使用DevEco Studio调试或运行应用/元服务时，每个模块只能选择其中的一个target运行，可以通过单击右上角的<span><img originheight="18" originwidth="18" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.21765931317150037420384457320221:50001231000000:2800:C195F81983CE330128D4A2298C817FBB630F6BD3BA0E8940BAAE34CC5589F31C.png" class="IconPic notEnlarge" width="18" height="18"></span>图标，指定需要调试或运行的<strong>Product</strong>下对应的<strong>Module Target</strong>，然后单击<strong>Apply</strong>保存。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174473__p7644174116464">在选择需要调试或运行的target时，需要注意选择该target所属的Product，否则将找不到可调试和运行的target。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p61591961145"><span><img originheight="339" originwidth="462" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.68598686635504289491629786777858:50001231000000:2800:0CA2A3A712F303DD8D4F0F27CE5039D28B8620322A780EF8E68670ADDDF5B770.png" width="462" height="339"></span></p> </div> <div class="tiledSection"><h2 id="section7121513141619">多产物构建target<i class="anchor-icon anchor-icon-link" anchorid="section7121513141619" tips="复制节点链接"></i></h2><ul id="ZH-CN_TOPIC_0000002510174473__ul19941804811"><li id="li529716519323">align target<p id="ZH-CN_TOPIC_0000002510174473__p1348154283917">编译构建时，优先级最高的target。工程配置align target后，如果模块中存在align target，那么将自动选择align target进行构建。align target作用范围是整个工程，只能配置一个，支持命令行和配置文件两种方式。</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul1491536114011"><li id="li99158654014">命令行方式示例如下：<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-r" id="ZH-CN_TOPIC_0000002510174473__screen1812502617154" data-highlighted="yes"><ol class="linenums"><li>hvigorw <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> properties.ohos.align.target<span class="hljs-operator">=</span>target1 assembleHap</li></ol></pre></div></div> </li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul1175101516405"><li id="li1975615104017">在hvigor-config.json5配置文件中添加ohos.align.target，示例如下：<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen1716491214119" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"properties"</span></span>: {</li><li>  <span class=""><span class="hljs-string">'ohos.align.target'</span></span>: <span class=""><span class="hljs-string">'target1'</span></span></li><li>},</li></ol></pre></div></div> </li></ul> </li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul4400919112010"><li id="li7400161992014">fallback target<p id="ZH-CN_TOPIC_0000002510174473__p15855111361813">当模块不存在指定的target时会选用default进行构建，但如果不想用default进行构建，那么可以配置fallback target，当找不到指定target时，如果模块中存在fallback target，则使用fallback target进行构建。fallback target作用范围是整个工程，可配置多个，配置多个时按数组顺序先命中的生效。</p> <ul id="ZH-CN_TOPIC_0000002510174473__ul436915484436"><li id="li43699485437">命令行方式示例如下：<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-r" id="ZH-CN_TOPIC_0000002510174473__screen1234819224457" data-highlighted="yes"><ol class="linenums"><li>hvigorw <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> properties.ohos.fallback.target<span class="hljs-operator">=</span>target1<span class="hljs-punctuation">,</span>target2 assembleHap</li></ol></pre></div></div> </li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul49805259445"><li id="li998042514441">在hvigor-config.json5配置文件中添加ohos.fallback.target，示例如下：<div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174473__screen7688113834511" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"properties"</span></span>: {</li><li>  <span class=""><span class="hljs-string">'ohos.fallback.target'</span></span>: [<span class=""><span class="hljs-string">'target1'</span></span>, <span class=""><span class="hljs-string">'target2'</span></span>]</li><li>}</li></ol></pre></div></div> </li></ul> </li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510174473__ul13702175505516"><li id="li270319559550">align target和fallback target配置方式命令行优先级高于配置文件。</li></ul> <ul id="ZH-CN_TOPIC_0000002510174473__ul948610585716"><li id="li94861585714">使用配置文件配置align target和fallback target，仅支持DevEco Studio界面<strong>Build</strong>菜单栏功能，不支持<strong>Run</strong>菜单栏功能，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc" target="_blank">hdc命令行工具</a>进行推包运行、调试。</li></ul> </div></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p438123611583">多个target的优先级顺序为：align target &gt; 命令行指定模块target &gt; 父级模块target &gt; fallback target &gt; default。</p> <p id="ZH-CN_TOPIC_0000002510174473__p152139244425"><span><img originheight="744" originwidth="1032" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104917.79167500495295413358413515199270:50001231000000:2800:7FE3B50FD3C8F063EC1D979D2279E9EB1E1973E6F2C793C6675A6871C563FF0A.png" width="920" height="663.2558139534884"></span></p> <p id="ZH-CN_TOPIC_0000002510174473__p9187151194714">举例说明：</p> <p id="ZH-CN_TOPIC_0000002510174473__p927516541477">工程依赖entry-&gt;lib1-&gt;lib2，需要构建多个产品A、B、C，工程中target配置如下：</p> <p id="ZH-CN_TOPIC_0000002510174473__p7149107175015">entry: A、B、default</p> <p id="ZH-CN_TOPIC_0000002510174473__p102914342503">lib1: B、C、default</p> <p id="ZH-CN_TOPIC_0000002510174473__p148722177514">lib2: A、C、default</p> <p id="ZH-CN_TOPIC_0000002510174473__p467172955112">指定align target为A，fallback target为C。那么构建hap时的编译命令为：</p> <div _ngcontent-jan-c106="" class="highlight-div"><div _ngcontent-jan-c106="" class="highlight-div-header"><div _ngcontent-jan-c106="" class="highlight-div-header-left"><div _ngcontent-jan-c106="" class="handle-button expand-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jan-c106="" class="highlight-div-header-right"><div _ngcontent-jan-c106="" class="handle-button ai-button"></div><div _ngcontent-jan-c106="" class="handle-button line-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jan-c106="" class="handle-button theme-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jan-c106="" class="handle-button copy-button"><div _ngcontent-jan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jan-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002510174473__screen137162494535" data-highlighted="yes"><ol class="linenums"><li>hvigorw --mode <span class="hljs-keyword">module</span> -p <span class="hljs-keyword">module</span>=entry -c properties.ohos.align.target=A -c properties.ohos.fallback.target=C assembleHap</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510174473__p9908193425114">编译的target选择就是：entry@A, lib1@C, lib2@A。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510174473__p19989231596">以上所有说明仅针对非ohosTest模式。在ohosTest模式下，依赖的target固定为default，其他target均不生效。</p> </div></div></div> </div> </div> <div></div></div>