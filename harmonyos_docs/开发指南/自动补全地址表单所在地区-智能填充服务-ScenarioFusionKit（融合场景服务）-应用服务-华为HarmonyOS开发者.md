<h1 _ngcontent-lip-c119="" class="doc-title ng-star-inserted" title="自动补全地址表单所在地区"> 自动补全地址表单所在地区 </h1>

<div _ngcontent-lip-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>在填写地址表单场景时，当应用使用了所在地区的省市区选择器，需要开发者对表单中的地址字段进行开发。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><ul><li>需要在module.json5文件中设置模糊位置权限：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/permissions-for-all-user#ohospermissionapproximately_location" target="_blank">ohos.permission.APPROXIMATELY_LOCATION</a>。</li><li>所在地区地址选择器需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/map-config-agc#section16133115441516" target="_blank">开通地图服务</a>。</li><li>需要<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-sign-fingerprints" target="_blank">配置签名和指纹</a>。</li></ul> </div></div></div> <div class="tiledSection"><h2 id="section1221519589438">效果图<i class="anchor-icon anchor-icon-link" anchorid="section1221519589438" tips="复制节点链接"></i></h2><p>地址表单中的所在地区能根据详细地址内容自动补全，当补全内容不符合预期时，可通过地址选择器进行修改。</p> <p><span><img height="204.4875" originheight="792" originwidth="2020" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114626.95256598786279365727260716345044:50001231000000:2800:87F68A7BE476F37FC00E5DB56A5B08D9440EB665D23BD868DCF956A3DD0EC0BA.png" title="点击放大" width="523.6875"></span></p> </div> <div class="tiledSection"><h2 id="section10984143916131">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section10984143916131" tips="复制节点链接"></i></h2><div _ngcontent-lip-c106="" class="highlight-div"><div _ngcontent-lip-c106="" class="highlight-div-header"><div _ngcontent-lip-c106="" class="highlight-div-header-left"><div _ngcontent-lip-c106="" class="handle-button expand-button"><div _ngcontent-lip-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lip-c106="" class="highlight-div-header-right"><div _ngcontent-lip-c106="" class="handle-button ai-button"></div><div _ngcontent-lip-c106="" class="handle-button line-button"><div _ngcontent-lip-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lip-c106="" class="handle-button theme-button"><div _ngcontent-lip-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lip-c106="" class="handle-button copy-button"><div _ngcontent-lip-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lip-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { i18n } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { sceneMap, site } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, autoFillManager, common, <span class="hljs-title class_">PermissionRequestResult</span>, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FunctionalInput</span>, functionalInputComponentManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScenarioFusionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">TextInputModifier</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTHED</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TIME_OUT</span> = <span class="hljs-number">100</span>;</li><li><span class="hljs-comment">// 默认经度和纬度。以下以北京天安门的经纬度为例。 </span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INIT_LAT</span> = <span class="hljs-number">39.5</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INIT_LON</span> = <span class="hljs-number">116.2</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ENGLISH</span> = <span class="hljs-string">'en'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SIMPLIFIED_CHINESE</span> = <span class="hljs-string">'zh_CN'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">PERMISSIONS</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>];</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">ADMINISTRATIVE_REGION</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; =</li><li>  [<span class="hljs-string">'countryName'</span>, <span class="hljs-string">'adminLevel1'</span>, <span class="hljs-string">'adminLevel2'</span>, <span class="hljs-string">'adminLevel3'</span>, <span class="hljs-string">'adminLevel4'</span>];</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PersonInfo</span> {</li><li>  name?: <span class="hljs-built_in">string</span>;</li><li>  phone?: <span class="hljs-built_in">string</span>;</li><li>  email?: <span class="hljs-built_in">string</span>;</li><li>  idCard?: <span class="hljs-built_in">string</span>;</li><li>  region?: <span class="hljs-built_in">string</span>;</li><li>  streetAddress?: <span class="hljs-built_in">string</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RequestParam</span> {</li><li>  <span class="hljs-attr">requestTag</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">requestText</span>: <span class="hljs-built_in">string</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Location</span> {</li><li>  <span class="hljs-attr">latitude</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">longitude</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 显示授权弹出窗口。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">reqPermissionsFromUser</span>(<span class="hljs-params">permissions: <span class="hljs-built_in">Array</span>&lt;Permissions&gt;,</span></li><li><span class="hljs-params">  context: common.UIAbilityContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">PermissionRequestResult</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, permissions);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 节流函数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func: () =&gt; <span class="hljs-built_in">void</span>, wait: <span class="hljs-built_in">number</span> = TIME_OUT</span>): <span class="hljs-title class_">Function</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {</li><li>    timeout &amp;&amp; <span class="hljs-built_in">clearTimeout</span>(timeout);</li><li>    timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title function_">func</span>();</li><li>      <span class="hljs-built_in">clearTimeout</span>(timeout);</li><li>    }, wait);</li><li>  };</li><li>}</li><li>
</li><li><span class="hljs-meta">@Extend</span>(<span class="hljs-title class_">Text</span>)</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">textStyle</span>(<span class="hljs-params"></span>) {</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">64</span>)</li><li>  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">End</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">personInfo</span>: <span class="hljs-title class_">PersonInfo</span> = {};</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isClicked</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// 用户是否已触发信息输入。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isUserInput</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">location</span>: <span class="hljs-title class_">Location</span> = {</li><li>    <span class="hljs-attr">latitude</span>: <span class="hljs-variable constant_">INIT_LAT</span>,</li><li>    <span class="hljs-attr">longitude</span>: <span class="hljs-variable constant_">INIT_LON</span>,</li><li>  };</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">currentRequestTag</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">private</span> handleAddressChange = <span class="hljs-function">(<span class="hljs-params">request: RequestParam</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">autoCompleteAddress</span>(request);</li><li>    });</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title function_">reqPermissionsFromUser</span>(<span class="hljs-variable constant_">PERMISSIONS</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">permissionRequestResult: PermissionRequestResult</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (permissionRequestResult.<span class="hljs-property">authResults</span>[<span class="hljs-number">0</span>] === <span class="hljs-variable constant_">AUTHED</span>) {</li><li>          <span class="hljs-comment">// 获取位置信息的API只能在授权的情况下被调用。</span></li><li>          geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>(<span class="hljs-function">(<span class="hljs-params">err, location: geoLocationManager.Location</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get location, code: <span class="hljs-subst">${err?.code}</span>, message: <span class="hljs-subst">${err?.message}</span>`</span>);</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in obtaining the current location of the user`</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span>.<span class="hljs-property">latitude</span> = location.<span class="hljs-property">latitude</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span>.<span class="hljs-property">longitude</span> = location.<span class="hljs-property">longitude</span>;</li><li>          })</li><li>        }</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed request permissions, code: <span class="hljs-subst">${err?.code}</span>, message: <span class="hljs-subst">${err?.message}</span>`</span>);</li><li>      })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">isUsLanguage</span>(): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      result = i18n.<span class="hljs-property">System</span>.<span class="hljs-title function_">getSystemLanguage</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to get system language'</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">'en-latn-us'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">autoCompleteAddress</span>(<span class="hljs-attr">request</span>: <span class="hljs-title class_">RequestParam</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: site.<span class="hljs-property">SearchByTextParams</span> = {</li><li>        <span class="hljs-attr">query</span>: request.<span class="hljs-property">requestText</span>,</li><li>        <span class="hljs-comment">// 搜索结果需要偏向的经纬度。</span></li><li>        <span class="hljs-attr">location</span>: {</li><li>          <span class="hljs-attr">latitude</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span>.<span class="hljs-property">latitude</span>,</li><li>          <span class="hljs-attr">longitude</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span>.<span class="hljs-property">longitude</span></li><li>        },</li><li>        <span class="hljs-attr">language</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isUsLanguage</span>() ? <span class="hljs-variable constant_">ENGLISH</span> : <span class="hljs-variable constant_">SIMPLIFIED_CHINESE</span>,</li><li>        <span class="hljs-attr">isChildren</span>: <span class="hljs-literal">true</span></li><li>      };</li><li>      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> site.<span class="hljs-title function_">searchByText</span>(params);</li><li>      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">sites</span>) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">region</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>        <span class="hljs-keyword">let</span> addressComponent = result.<span class="hljs-property">sites</span>[<span class="hljs-number">0</span>].<span class="hljs-property">addressComponent</span>;</li><li>        <span class="hljs-comment">// 遍历当前地址的行政区划层级。</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> <span class="hljs-variable constant_">ADMINISTRATIVE_REGION</span>) {</li><li>          <span class="hljs-keyword">if</span> (addressComponent[item] === <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-keyword">break</span>;</li><li>          }</li><li>          region += addressComponent[item];</li><li>        }</li><li>        <span class="hljs-comment">// 防止可能导致结果不一致的重复搜索。</span></li><li>        <span class="hljs-keyword">if</span> (request.<span class="hljs-property">requestTag</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRequestTag</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> = region;</li><li>        }</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to search location, code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in searching location'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onRegionClick</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 用户选择行政区域后，仅显示该区域的搜索结果，以防止查询时间过长。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRequestTag</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">districtSelectOptions</span>: sceneMap.<span class="hljs-property">DistrictSelectOptions</span> = {</li><li>      <span class="hljs-attr">countryCode</span>: <span class="hljs-string">'CN'</span>,</li><li>    };</li><li>    sceneMap.<span class="hljs-title function_">selectDistrict</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(), districtSelectOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'SelectDistrict'</span>, <span class="hljs-string">'Succeeded  in selecting district.'</span>);</li><li>      <span class="hljs-keyword">let</span> region = <span class="hljs-string">''</span>;</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data?.<span class="hljs-property">districts</span>?.<span class="hljs-property">length</span>; i++) {</li><li>        region += data.<span class="hljs-property">districts</span>[i].<span class="hljs-property">name</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> = region;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to select district, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">searchRegionByAddress</span>(<span class="hljs-attr">val</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">tag</span>: <span class="hljs-built_in">string</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRequestTag</span> = tag;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">RequestParam</span> = {</li><li>      <span class="hljs-attr">requestTag</span>: tag,</li><li>      <span class="hljs-attr">requestText</span>: val</li><li>    }</li><li>    <span class="hljs-comment">// 用户输入的场景需要加做抖动处理, 智能填充回填场景直接查询即可。</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> !== <span class="hljs-string">''</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isUserInput</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleAddressChange</span>(param)();</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">autoCompleteAddress</span>(param);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'姓名'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'姓名'</span> })</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">contentType</span>(<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">PERSON_FULL_NAME</span>)</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">name</span> = val;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'联系电话'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">phone</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'手机号码'</span> })</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">contentType</span>(<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">PHONE_NUMBER</span>)</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">phone</span> = val;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'身份证号'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">idCard</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'身份证信息'</span> })</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">contentType</span>(<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">ID_CARD_NUMBER</span>)</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">idCard</span> = val;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'邮件地址'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">email</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'电子邮件信息'</span> })</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">contentType</span>(<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">EMAIL_ADDRESS</span>)</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">email</span> = val;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'所在地区'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">FunctionalInput</span>({</li><li>          <span class="hljs-attr">params</span>: {</li><li>            <span class="hljs-comment">// InputType.SELECT_DISTRICT表示输入类型为省/市/区选择器类型。</span></li><li>            <span class="hljs-attr">inputType</span>: functionalInputComponentManager.<span class="hljs-property">InputType</span>.<span class="hljs-property">SELECT_DISTRICT</span>,</li><li>            <span class="hljs-attr">textInputValue</span>: {</li><li>              <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span>,</li><li>              <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'省、市、区、街道地址'</span>,</li><li>            },</li><li>            <span class="hljs-comment">// 调整TextInput样式。</span></li><li>            <span class="hljs-attr">inputAttributeModifier</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextInputModifier</span>()</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>              .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (value !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> = value;</li><li>                }</li><li>              })</li><li>          },</li><li>          <span class="hljs-comment">// 当InputType为SELECT_DISTRICT时，回调必须为onSelectDistrict。</span></li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-keyword">new</span> functionalInputComponentManager.<span class="hljs-title class_">FunctionalInputController</span>().<span class="hljs-title function_">onSelectDistrict</span>(<span class="hljs-function">(<span class="hljs-params">err,</span></span></li><li><span class="hljs-function">            data: functionalInputComponentManager.DistrictSelectResult</span>) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (err) {</li><li>              <span class="hljs-comment">// 错误日志处理。</span></li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"error: %{public}d %{public}s"</span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 成功日志处理。</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTag"</span>, <span class="hljs-string">"succeeded in selecting district"</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> = data.<span class="hljs-property">inputContent</span>;</li><li>          })</li><li>        })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'详细地址'</span>).<span class="hljs-title function_">textStyle</span>()</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">streetAddress</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'小区门牌信息'</span> })</li><li>          .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">contentType</span>(<span class="hljs-title class_">ContentType</span>.<span class="hljs-property">DETAIL_INFO_WITHOUT_STREET</span>)</li><li>          .<span class="hljs-title function_">onDidInsert</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 当用户通过输入方法输入数据时触发。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isUserInput</span> = <span class="hljs-literal">true</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">onDidDelete</span>(<span class="hljs-function">(<span class="hljs-params">val: DeleteValue</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 当用户通过输入方法删除数据时触发。</span></li><li>            <span class="hljs-keyword">if</span> (val?.<span class="hljs-property">deleteValue</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">isUserInput</span> = <span class="hljs-literal">true</span>;</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">streetAddress</span> = val;</li><li>            <span class="hljs-keyword">if</span> (val &amp;&amp; val.<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">searchRegionByAddress</span>(val);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentRequestTag</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">personInfo</span>.<span class="hljs-property">region</span> = <span class="hljs-string">''</span>;</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isUserInput</span> = <span class="hljs-literal">false</span>;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'保存'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isClicked</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isClicked</span> = <span class="hljs-literal">true</span>;</li><li>            autoFillManager.<span class="hljs-title function_">requestAutoSave</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>(), {</li><li>              <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in saving request'</span>);</li><li>              },</li><li>              <span class="hljs-attr">onFailure</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to save request'</span>);</li><li>              }</li><li>            });</li><li>            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">isClicked</span> = <span class="hljs-literal">false</span>;</li><li>            }, <span class="hljs-number">2000</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">16</span> })</li><li>    .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'sys.color.ohos_id_color_list_card_bg'</span>))</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>该示例中，使用了场景化Input作为所在地区的地址选择器，智能填充支持对该地址选择器进行填充。</p> </div></div></div> </div> </div> <div></div></div>