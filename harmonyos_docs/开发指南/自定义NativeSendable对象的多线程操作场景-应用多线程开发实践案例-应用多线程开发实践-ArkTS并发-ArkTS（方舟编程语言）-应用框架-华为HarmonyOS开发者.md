<h1 _ngcontent-fdv-c119="" class="doc-title ng-star-inserted" title="自定义Native Sendable对象的多线程操作场景"> 自定义Native Sendable对象的多线程操作场景 </h1>

<div _ngcontent-fdv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>ArkTS支持开发者自定义Native Sendable对象，Sendable对象提供了并发实例间高效的通信能力，即引用传递，适用于开发者自定义大对象需要线程间通信的场景，例如子线程读取数据库数据并返回给宿主线程。</p> <p>本示例将详细说明如何使用自定义Native Sendable对象实现并发实例间数据共享。</p> <ol><li><p>接口声明中自定义Sendable类。</p>  <div _ngcontent-fdv-c106="" class="highlight-div"><div _ngcontent-fdv-c106="" class="highlight-div-header"><div _ngcontent-fdv-c106="" class="highlight-div-header-left"><div _ngcontent-fdv-c106="" class="handle-button expand-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fdv-c106="" class="highlight-div-header-right"><div _ngcontent-fdv-c106="" class="handle-button ai-button"></div><div _ngcontent-fdv-c106="" class="handle-button line-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fdv-c106="" class="handle-button theme-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fdv-c106="" class="handle-button copy-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fdv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.d.ets</span></li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyObject</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">arg: <span class="hljs-built_in">number</span></span>);</li><li>  <span class="hljs-title function_">plusOne</span>(): <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>(): <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newVal: <span class="hljs-built_in">number</span></span>);</li><li>}</li></ol></pre></div></div>  </li><li><p>编译配置。</p>  <div _ngcontent-fdv-c106="" class="highlight-div"><div _ngcontent-fdv-c106="" class="highlight-div-header"><div _ngcontent-fdv-c106="" class="highlight-div-header-left"><div _ngcontent-fdv-c106="" class="handle-button expand-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fdv-c106="" class="highlight-div-header-right"><div _ngcontent-fdv-c106="" class="handle-button ai-button"></div><div _ngcontent-fdv-c106="" class="handle-button line-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fdv-c106="" class="handle-button theme-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fdv-c106="" class="handle-button copy-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fdv-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li># CMakeLists<span class="hljs-selector-class">.txt</span></li><li># the minimum version of CMake.</li><li><span class="hljs-built_in">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.5</span>.<span class="hljs-number">0</span>)</li><li><span class="hljs-built_in">project</span>(napi_wrap_sendable_demo)</li><li>
</li><li><span class="hljs-built_in">set</span>(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li>
</li><li><span class="hljs-built_in">if</span>(DEFINED PACKAGE_FIND_FILE)</li><li>    <span class="hljs-built_in">include</span>(${PACKAGE_FIND_FILE})</li><li><span class="hljs-built_in">endif</span>()</li><li>
</li><li><span class="hljs-built_in">include_directories</span>(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li><span class="hljs-built_in">add_definitions</span>("-DLOG_DOMAIN=<span class="hljs-number">0</span>x0000")</li><li><span class="hljs-built_in">add_definitions</span>("-DLOG_TAG=\"testTag\"")</li><li>
</li><li><span class="hljs-built_in">add_library</span>(entry SHARED napi_init.cpp)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div>  </li><li><p>Native实现各项接口功能，例如取值、设置值或者给Native对象的值加1等功能。</p>  <div _ngcontent-fdv-c106="" class="highlight-div"><div _ngcontent-fdv-c106="" class="highlight-div-header"><div _ngcontent-fdv-c106="" class="highlight-div-header-left"><div _ngcontent-fdv-c106="" class="handle-button expand-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fdv-c106="" class="highlight-div-header-right"><div _ngcontent-fdv-c106="" class="handle-button ai-button"></div><div _ngcontent-fdv-c106="" class="handle-button line-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fdv-c106="" class="handle-button theme-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fdv-c106="" class="handle-button copy-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fdv-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// napi_init.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 一个native类，它的实例在下面会包装在ArkTS的Sendable对象中</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyObject</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span>;</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">Destructor</span><span class="hljs-params">(napi_env env, <span class="hljs-type">void</span> *nativeObject, <span class="hljs-type">void</span> *finalize_hint)</span></span>;</li><li>
</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MyObject</span><span class="hljs-params">(<span class="hljs-type">double</span> value_ = <span class="hljs-number">0</span>)</span></span>;</li><li>    ~<span class="hljs-built_in">MyObject</span>();</li><li>
</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">New</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span>;</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValue</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span>;</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">SetValue</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span>;</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">PlusOne</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span>;</li><li>
</li><li>    <span class="hljs-type">double</span> value_;</li><li>    napi_env env_;</li><li>};</li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-keyword">thread_local</span> napi_ref g_ref = <span class="hljs-literal">nullptr</span>;</li><li>
</li><li>MyObject::<span class="hljs-built_in">MyObject</span>(<span class="hljs-type">double</span> value) : <span class="hljs-built_in">value_</span>(value), <span class="hljs-built_in">env_</span>(<span class="hljs-literal">nullptr</span>) {}</li><li>
</li><li>MyObject::~<span class="hljs-built_in">MyObject</span>() {}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MyObject::Destructor</span><span class="hljs-params">(napi_env env, <span class="hljs-type">void</span> *nativeObject, [[maybe_unused]] <span class="hljs-type">void</span> *finalize_hint)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"MyObject::Destructor called"</span>);</li><li>    <span class="hljs-built_in">reinterpret_cast</span>&lt;MyObject *&gt;(nativeObject)-&gt;~<span class="hljs-built_in">MyObject</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// 在构造函数中绑定ArkTS Sendable对象与C++对象</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">MyObject::New</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"MyObject::New called"</span>);</li><li>
</li><li>    napi_value newTarget;</li><li>    <span class="hljs-built_in">napi_get_new_target</span>(env, info, &amp;newTarget);</li><li>    <span class="hljs-keyword">if</span> (newTarget != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-comment">// 使用`new MyObject(...)`调用方式</span></li><li>        <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>        napi_value args[<span class="hljs-number">1</span>];</li><li>        napi_value jsThis;</li><li>        <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, &amp;jsThis, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>        <span class="hljs-type">double</span> value = <span class="hljs-number">0.0</span>;</li><li>        napi_valuetype valuetype;</li><li>        <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valuetype);</li><li>        <span class="hljs-keyword">if</span> (valuetype != napi_undefined) {</li><li>            <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">0</span>], &amp;value);</li><li>        }</li><li>
</li><li>        MyObject *obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyObject</span>(value);</li><li>
</li><li>        obj-&gt;env_ = env;</li><li>        <span class="hljs-comment">// 通过napi_wrap_sendable将ArkTS Sendable对象jsThis与C++对象obj绑定</span></li><li>        <span class="hljs-built_in">napi_wrap_sendable</span>(env, jsThis, <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">void</span> *&gt;(obj), MyObject::Destructor, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>        <span class="hljs-keyword">return</span> jsThis;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 使用`MyObject(...)`调用方式</span></li><li>        <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>        napi_value args[<span class="hljs-number">1</span>];</li><li>        <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>        napi_value cons;</li><li>        <span class="hljs-built_in">napi_get_reference_value</span>(env, g_ref, &amp;cons);</li><li>        napi_value instance;</li><li>        <span class="hljs-built_in">napi_new_instance</span>(env, cons, argc, args, &amp;instance);</li><li>
</li><li>        <span class="hljs-keyword">return</span> instance;</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 取出Native对象的值</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">MyObject::GetValue</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"MyObject::GetValue called"</span>);</li><li>
</li><li>    napi_value jsThis;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;jsThis, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    MyObject *obj;</li><li>    <span class="hljs-comment">// 通过napi_unwrap_sendable将jsThis之前绑定的C++对象取出，并对其进行操作</span></li><li>    <span class="hljs-built_in">napi_unwrap_sendable</span>(env, jsThis, <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">void</span> **&gt;(&amp;obj));</li><li>    napi_value num;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, obj-&gt;value_, &amp;num);</li><li>
</li><li>    <span class="hljs-keyword">return</span> num;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 设置Native对象的值</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">MyObject::SetValue</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"MyObject::SetValue called"</span>);</li><li>
</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value value;</li><li>    napi_value jsThis;</li><li>
</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, &amp;value, &amp;jsThis, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    MyObject *obj;</li><li>    <span class="hljs-comment">// 通过napi_unwrap_sendable将jsThis之前绑定的C++对象取出，并对其进行操作</span></li><li>    <span class="hljs-built_in">napi_unwrap_sendable</span>(env, jsThis, <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">void</span> **&gt;(&amp;obj));</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, value, &amp;obj-&gt;value_);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 给Native对象的值加1</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">MyObject::PlusOne</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"MyObject::PlusOne called"</span>);</li><li>
</li><li>    napi_value jsThis;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;jsThis, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    MyObject *obj;</li><li>    <span class="hljs-comment">// 通过napi_unwrap_sendable将jsThis之前绑定的C++对象取出，并对其进行操作</span></li><li>    <span class="hljs-built_in">napi_unwrap_sendable</span>(env, jsThis, <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">void</span> **&gt;(&amp;obj));</li><li>    obj-&gt;value_ += <span class="hljs-number">1</span>;</li><li>    napi_value num;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, obj-&gt;value_, &amp;num);</li><li>
</li><li>    <span class="hljs-keyword">return</span> num;</li><li>}</li><li>
</li><li><span class="hljs-function">napi_value <span class="hljs-title">MyObject::Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value num;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, <span class="hljs-number">0</span>, &amp;num);</li><li>    napi_property_descriptor properties[] = {</li><li>        {<span class="hljs-string">"value"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, GetValue, SetValue, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"plusOne"</span>, <span class="hljs-literal">nullptr</span>, PlusOne, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>    };</li><li>
</li><li>    napi_value cons;</li><li>    <span class="hljs-comment">// 定义一个Sendable class MyObject</span></li><li>    <span class="hljs-built_in">napi_define_sendable_class</span>(env, <span class="hljs-string">"MyObject"</span>, NAPI_AUTO_LENGTH, New, <span class="hljs-literal">nullptr</span>,</li><li>                            <span class="hljs-built_in">sizeof</span>(properties) / <span class="hljs-built_in">sizeof</span>(properties[<span class="hljs-number">0</span>]), properties, <span class="hljs-literal">nullptr</span>, &amp;cons);</li><li>
</li><li>    <span class="hljs-built_in">napi_create_reference</span>(env, cons, <span class="hljs-number">1</span>, &amp;g_ref);</li><li>    <span class="hljs-comment">// 在exports对象上挂载MyObject类</span></li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, exports, <span class="hljs-string">"MyObject"</span>, cons);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>
</li><li>EXTERN_C_START</li><li><span class="hljs-comment">// 模块初始化</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    MyObject::<span class="hljs-built_in">Init</span>(env, exports);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-comment">// 准备模块加载相关信息，将上述Init函数与本模块名等信息记录下来。</span></li><li><span class="hljs-type">static</span> napi_module nativeModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = <span class="hljs-literal">nullptr</span>,</li><li>    .reserved = {<span class="hljs-number">0</span>},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 加载so时，自动调用该函数，将上述nativeModule模块注册到系统中。</span></li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterObjectWrapModule</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">napi_module_register</span>(&amp;nativeModule); }</li></ol></pre></div></div>  </li><li><p>ArkTS侧在UI主线程中定义Sendable实例对象并传递给TaskPool子线程，子线程处理完数据后返回UI主线程，UI主线程可以继续访问该Sendable实例对象。</p>  <div _ngcontent-fdv-c106="" class="highlight-div"><div _ngcontent-fdv-c106="" class="highlight-div-header"><div _ngcontent-fdv-c106="" class="highlight-div-header-left"><div _ngcontent-fdv-c106="" class="handle-button expand-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fdv-c106="" class="highlight-div-header-right"><div _ngcontent-fdv-c106="" class="handle-button ai-button"></div><div _ngcontent-fdv-c106="" class="handle-button line-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fdv-c106="" class="handle-button theme-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fdv-c106="" class="handle-button copy-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fdv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">import</span> { taskpool } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Concurrent</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sum</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>: MyObject</span>) {</li><li>  <span class="hljs-built_in">object</span>.<span class="hljs-property">value</span> = <span class="hljs-number">2000</span>;</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-built_in">object</span>.<span class="hljs-title function_">plusOne</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"taskpool thread num is "</span> + num); <span class="hljs-comment">// taskpool thread num is 2001</span></li><li>  <span class="hljs-keyword">return</span> num;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>( <span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-built_in">object</span> : <span class="hljs-title class_">MyObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyObject</span>(<span class="hljs-number">0</span>);</li><li>            <span class="hljs-built_in">object</span>.<span class="hljs-property">value</span> = <span class="hljs-number">1023</span>;</li><li>            <span class="hljs-keyword">let</span> num = <span class="hljs-built_in">object</span>.<span class="hljs-title function_">plusOne</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"host thread num1 is "</span> + num); <span class="hljs-comment">// host thread num1 is 1024</span></li><li>            <span class="hljs-keyword">let</span> task = <span class="hljs-keyword">new</span> taskpool.<span class="hljs-title class_">Task</span>(<span class="hljs-title class_">Sum</span>, <span class="hljs-built_in">object</span>);</li><li>            <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(task);</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"host thread result is "</span> + result); <span class="hljs-comment">// host thread result is 2001</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"host thread num2 is "</span> + <span class="hljs-built_in">object</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// host thread num2 is 2001</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>  </li><li><p>修改与Index.d.ets同目录下的配置文件oh-package.json5，配置如下：</p>  <div _ngcontent-fdv-c106="" class="highlight-div"><div _ngcontent-fdv-c106="" class="highlight-div-header"><div _ngcontent-fdv-c106="" class="highlight-div-header-left"><div _ngcontent-fdv-c106="" class="handle-button expand-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fdv-c106="" class="highlight-div-header-right"><div _ngcontent-fdv-c106="" class="handle-button ai-button"></div><div _ngcontent-fdv-c106="" class="handle-button line-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fdv-c106="" class="handle-button theme-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fdv-c106="" class="handle-button copy-button"><div _ngcontent-fdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fdv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>{</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"libentry.so"</span>,</li><li>    <span class="hljs-string">"types"</span>: <span class="hljs-string">"./Index.d.ets"</span>,</li><li>    <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Please describe the basic information."</span></li><li>}</li></ol></pre></div></div>  </li></ol> </div> <div></div></div>