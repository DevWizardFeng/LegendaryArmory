<h1 _ngcontent-vic-c119="" class="doc-title ng-star-inserted" title="自定义元数据规则校验插件配置"> 自定义元数据规则校验插件配置 </h1>

<div _ngcontent-vic-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div id="body0000002225479341">    <p id="ZH-CN_TOPIC_0000002510293655__p8060118">ohpm-repo 5.1.3版本开始支持自定义元数据规则校验，允许通过插件对oh-package.json5中部分字段开发定制化的校验规则。</p>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p id="ZH-CN_TOPIC_0000002510293655__p18984271243">自定义元数据规则校验插件的作用是基于原有元数据校验规则的增强，而非替换，原有校验规则可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-oh-package-json5">oh-package.json5规格文档</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section022911194412">准备工作<i class="anchor-icon anchor-icon-link" anchorid="section022911194412" tips="复制节点链接"></i></h2>          <ol id="ZH-CN_TOPIC_0000002510293655__ol666325179192207">      <li id="li550411169589">下载ohpm-repo5.1.3及以上版本工具安装包并解压。</li>      <li id="li7450358103011">根据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file">模板文件</a>中的操作指示，创建三个必要模板文件：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section14072085013">checkField.ts</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1076523392">CustomExtensionValidationConfig.json</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1613602518915">tsconfig.json</a>。</li>      <li id="li846616424192207">将文件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1613602518915">tsconfig.json</a>文件移动到ohpm-repo解压根目录内；建议将文件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section14072085013">checkField.ts</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1076523392">CustomExtensionValidationConfig.json</a>文件移动到ohpm-repo解压根目录的plugins/fieldCheckPlugin文件夹内。       <p id="ZH-CN_TOPIC_0000002510293655__p574511720372"><span><img originheight="392" originwidth="655" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104738.80845999706153400897696131824376:50001231000000:2800:0E59EAA6BFB118D205E2977AAD0C272D2132E709C0CDCC09330D008DAA7AAD84.png" width="655" height="392"></span></p>       <p id="ZH-CN_TOPIC_0000002510293655__p24831891509"><span><img height="204.81574400000002" originheight="191" originwidth="625" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104738.62277633308429411311299127257211:50001231000000:2800:FBAA2AA7BDAC38C9FC690EFCB0A37C7B037382D74086DC91190557BC2823E65C.png" title="点击放大" width="658.35"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section15931356184319">编写自定义规则校验函数文件checkField.ts<i class="anchor-icon anchor-icon-link" anchorid="section15931356184319" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510293655__p284501314380">打开<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section14072085013">checkField.ts</a>模板文件（默认名称为checkField，可自定义修改），创建与文件同名的校验函数（示例：文件checkField.ts中仅允许存在一个名称为checkField的函数），实现自定义规则校验函数接口ValidationExtensionRule。若需定义多个校验规则，需要为每个规则创建专属的校验函数文件。</p>     <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen1989488216" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 自定义规则校验函数接口ValidationExtensionRule定义如下</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ValidationExtensionRule</span> {</li><li> (<span class="hljs-variable">fieldData</span>: <span class="hljs-title class_">FieldDataType</span>, <span class="hljs-variable">userInfo</span>: <span class="hljs-title class_">UserBasicInfo</span>): <span class="hljs-title class_">void</span>; </li><li>}</li></ol></pre></div></div>     <ol id="ZH-CN_TOPIC_0000002510293655__ol1334720142409">      <li id="li103477145409">入参：包含两个固定入参：       <ul id="ZH-CN_TOPIC_0000002510293655__ul4347181412409">        <li id="li234711420404">fieldData：oh-package.json5文件中字段的取值，类型可以是布尔值，字符串，字符串数组，对象和对象数组。</li>        <li id="li103472147403">userInfo：发布三方包用户的信息，包含userName和userRole两部分：         <ul id="ZH-CN_TOPIC_0000002510293655__ul11347171424015">          <li id="li1334761420401">userInfo.userName：字符串类型，发布三方包账户的用户名称。</li>          <li id="li1834771474020">userInfo.userRole：字符串类型，发布三方包账户的用户角色，1表示为管理员账户，0表示为普通用户（使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-custom-auth-plugin">自定义认证插件</a>，默认为0）。</li>         </ul></li>       </ul></li>      <li id="li2034771494015">返回值：字段校验成功返回void，校验失败则抛出错误并返回错误原因。</li>     </ol>     <div class="p" id="ZH-CN_TOPIC_0000002510293655__p16670427141619">      规则校验函数实现过程中需要引用UserBasicInfo，FieldDataType类型和ValidationExtensionRule接口，处理函数报错时将会使用日志记录、异常处理等基础功能，需准确书写函数引用路径。相关工具类与方法具体使用方法见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section14072085013">checkField.ts</a>模板文件，存放位置如下：      <ul id="ZH-CN_TOPIC_0000002510293655__ul1320143274112">       <li id="li13201193217417">FieldDataType和ValidationExtensionRule：FieldDataType为字段信息类型，ValidationExtensionRule为规则函数的接口，地址：&lt;ohpm-repo解压根目录&gt;/libs/service/validator/validationExtensionRule/ValidationExtensionRule.js。</li>       <li id="li120173284116">UserBasicInfo：用户信息类型，地址：&lt;ohpm-repo解压根目录&gt;/libs/service/validator/validationExtensionRule/type.js。</li>       <li id="li620163214117">CustomValidateError：错误抛出类，地址：&lt;ohpm-repo解压根目录&gt;/libs/service/validator/CustomValidateError.js。</li>       <li id="li1320173213410">OhpmLazyLogger：日志打印类，地址为：&lt;ohpm-repo解压根目录&gt;/libs/packages/log。</li>      </ul>     </div>    </div>    <div class="tiledSection">     <h2 id="section781193014413">编写自定义规则配置文件CustomExtensionValidationConfig.json<i class="anchor-icon anchor-icon-link" anchorid="section781193014413" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510293655__p123809483501">完成自定义规则校验函数开发后，需要在模板文件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1076523392">CustomExtensionValidationConfig.json</a>中（该文件名不可自定义），为oh-package.json5文件中需要被加强校验的字段配置所需的校验规则。</p>     <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen198571838104619" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;被校验字段的名称1&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      }</li><li>    ]</li><li>  },</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;被校验字段的名称2&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"规则的类型，不配置默认为CustomFunction"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"&lt;规则的功能描述&gt;"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;规则的内容&gt;"</span></li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div>     <ul id="ZH-CN_TOPIC_0000002510293655__ul8788033593">      <li id="li870594811292">attrName：被校验字段的名称，支持模块级oh-package.json5中所有字段进行校验，也支持自定义字段（例如在三方包的oh-package.json5中添加一个自定义字段A，可以对字段A进行校验）。       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p id="ZH-CN_TOPIC_0000002510293655__p15866015308">oh-package.json5中author字段分为'author.name'，'author.email'，'author.url'三个字段独立校验。attrName不能重复，重复将报错。</p>        </div></div></div></li>      <li id="li1678919385917">configs：被校验字段的规则配置，一个attrName对应一个configs，configs可包含多个config，每个config对应一个独立规则，config配置有三个参数：       <ul id="ZH-CN_TOPIC_0000002510293655__ul7789163195910">        <li id="li278918315598">ruleType：表示字段的规则类型，string类型，不配置默认为“CustomFunction”，规则类型有六种：["CustomFunction","NotNull","LengthLimit","ListItemLengthLimit","MapEntry","RegExp"]，当使用“CustomFunction”时需要编写自定义校验规则函数文件，其他五种规则类型配置即生效，系统已经完成功能实现。         <ul id="ZH-CN_TOPIC_0000002510293655__ul127893365913">          <li id="li9789633593">CustomFunction：自定义函数规则。</li>          <li id="li18789833595">NotNull：非空规则。</li>          <li id="li0789123165911">LengthLimit：字符串长度限制规则。</li>          <li id="li97891338597">ListItemLengthLimit：字符串数组中单个字符串长度限制规则。</li>          <li id="li187890395918">MapEntry：对象数据校验规则，可以对key和value进行不同的规则校验。</li>          <li id="li177891731594">RegExp：字符串正则匹配校验。</li>         </ul></li>        <li id="li378913185913">description：string类型，规则的功能描述，内容不做校验。</li>        <li id="li157891933595">ruleContent：规则的内容，具体格式要求需与ruleType相匹配。</li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section113703326440">CustomExtensionValidationConfig.json中六种字段规则校验<i class="anchor-icon anchor-icon-link" anchorid="section113703326440" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510293655__p1198403185611">根据ruleType的不同，ohpm-repo提供六种字段校验能力：</p>     <ol id="ZH-CN_TOPIC_0000002510293655__ol91740524425">      <li id="li13174155244210">       <div class="p" id="ZH-CN_TOPIC_0000002510293655__p5174135224213">        自定义函数校验：CustomFunction        <ul id="ZH-CN_TOPIC_0000002510293655__ul1917413525424">         <li id="li1017485214425">规则配置：          <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen19174125218422" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"CustomFunction"</span>,</li><li>       <span class="hljs-string">"description"</span>: <span class="hljs-string">"自定义规则校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">"&lt;自定义规则函数的名称&gt;"</span></li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div>          <ul id="ZH-CN_TOPIC_0000002510293655__ul374892715443">           <li id="li2748112784418">ruleType如果不配置，将默认为CustomFunction。</li>           <li id="li1174862784418">ruleContent必须是字符串类型，值为自定义规则函数的名称（示例：书写规则函数文件checkField.ts，ruleContent取值为checkField）。</li>          </ul></li>        </ul>       </div></li>      <li id="li161741525427">非空校验：NotNull       <ul id="ZH-CN_TOPIC_0000002510293655__ul11741052184219">        <li id="li017435210421">规则配置：         <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen9174115234215" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"NotNull"</span>,</li><li>       <span class="hljs-string">"description"</span>: <span class="hljs-string">"非空校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: <span class="hljs-string">""</span></li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div>         <ul id="ZH-CN_TOPIC_0000002510293655__ul517417525428">          <li id="li9174105210427">当字段配置规则为非空时，会校验字段是否为空或者长度是否为0，ruleContent必须保持为空字符串。</li>         </ul></li>       </ul></li>     </ol>     <ol id="ZH-CN_TOPIC_0000002510293655__ol617405254219" start="3">      <li id="li9174145215428">       <p id="ZH-CN_TOPIC_0000002510293655__p1399105218449">长度校验：LengthLimit</p>       <ul id="ZH-CN_TOPIC_0000002510293655__ul141741052124219">        <li id="li1717485217420">规则配置：         <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen10174145234214" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"LengthLimit"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"字符串长度校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: {</li><li>          <span class="hljs-string">"minLength"</span>: &lt;<span class="hljs-title class_">最小长度</span>&gt;,</li><li>          <span class="hljs-string">"maxLength"</span>: &lt;<span class="hljs-title class_">最大长度</span>&gt;</li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div></li>       </ul>       <ul id="ZH-CN_TOPIC_0000002510293655__ul21743529429">        <li id="li763544154512">字段需要是字符串类型，例如字段name，对字段长度进行限制，长度范围为[最小长度，最大长度]，长度为整数类型，可以仅配置minLength或者maxLength，minLength和maxLength需要为非负数，且maxLength需要大于等于minLength。</li>       </ul></li>     </ol>     <ol id="ZH-CN_TOPIC_0000002510293655__ol117237724315" start="4">      <li id="li1572315784319">数组长度校验：ListItemLengthLimit       <ul id="ZH-CN_TOPIC_0000002510293655__ul11723207154320">        <li id="li1272327204315">规则配置：         <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen3723875431" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"ListItemLengthLimit"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"数组中单个字符串长度校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: {</li><li>          <span class="hljs-string">"maxLength"</span>: &lt;<span class="hljs-title class_">最大长度</span>&gt;,</li><li>          <span class="hljs-string">"minLength"</span>: &lt;<span class="hljs-title class_">最小长度</span>&gt;</li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div></li>       </ul>       <ul id="ZH-CN_TOPIC_0000002510293655__ul197231716439">        <li id="li2414335184615">字段需要是字符串数组类型，例如字段keywords，对数组中每一个字符串的长度进行限制，长度范围为[最小长度，最大长度]，长度为整数类型，可以只配置minLength或者maxLength，minLength和maxLength需要为非负数，且maxLength大于等于minLength。</li>       </ul></li>     </ol>     <ol id="ZH-CN_TOPIC_0000002510293655__ol1068321134318" start="5">      <li id="li268381164316">Map对象类型校验：MapEntry       <ul id="ZH-CN_TOPIC_0000002510293655__ul19683151118431">        <li id="li1683191144315">规则配置：         <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen96834118431" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"MapEntry"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"Map中单个key-value的字符校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: {</li><li>          <span class="hljs-string">"keyRuleConfig"</span>: {</li><li>            <span class="hljs-string">"ruleType"</span>: &lt;<span class="hljs-title class_">key值规则校验类型</span>&gt;,</li><li>            <span class="hljs-string">"ruleContent"</span>: &lt;<span class="hljs-title class_">key值规则校验内容</span>&gt;</li><li>          },</li><li>          <span class="hljs-string">"valueRuleConfig"</span>: {</li><li>            <span class="hljs-string">"ruleType"</span>: &lt;<span class="hljs-title class_">value值规则校验类型</span>&gt;,</li><li>            <span class="hljs-string">"ruleContent"</span>:&lt;<span class="hljs-title class_">value值规则校验内容</span>&gt;</li><li>          }</li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div></li>       </ul>       <ul id="ZH-CN_TOPIC_0000002510293655__ul668371134314">        <li id="li8748557194719">字段需要是对象类型，例如字段dependencies，针对对象中每一组数据的key和value值分别做校验，key和value需要同时配置。         <ul id="ZH-CN_TOPIC_0000002510293655__ul612784175617">          <li id="li108579409563">keyRuleConfig：有两个参数，ruleType和ruleContent，规格同<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li1678919385917">configs</a>中的<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li278918315598">ruleType</a>和<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li157891933595">ruleContent</a>，定义key值的校验规则。</li>          <li id="li2452636195712">valueRuleConfig：有两个参数，ruleType和ruleContent，规格同<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li1678919385917">configs</a>中的<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li278918315598">ruleType</a>和<a href="/consumer/cn/doc/harmonyos-guides/ide-custom-metadata-rule-validation-config#li157891933595">ruleContent</a>，定义value值的校验规则。</li>         </ul></li>       </ul></li>     </ol>     <ol id="ZH-CN_TOPIC_0000002510293655__ol4575116164319" start="6">      <li id="li9575131604311">正则校验：RegExp       <ul id="ZH-CN_TOPIC_0000002510293655__ul65758161431">        <li id="li657571617437">规则配置：         <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen1257541619435" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"attrName"</span>: <span class="hljs-string">"&lt;oh-package.json5文件的字段名称&gt;"</span>,</li><li>    <span class="hljs-string">"configs"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"ruleType"</span>: <span class="hljs-string">"RegExp"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"字符串正则表达校验"</span>,</li><li>        <span class="hljs-string">"ruleContent"</span>: &lt;<span class="hljs-title class_">正则表达式</span>&gt;</li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div></li>       </ul>       <ul id="ZH-CN_TOPIC_0000002510293655__ul8575151604310">        <li id="li1303428184918">字段需要是字符串类型，例如字段name，对字段内容进行正则匹配限制，ruleContent需为有效的正则表达式。</li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section85621533114411">启用自定义规则配置<i class="anchor-icon anchor-icon-link" anchorid="section85621533114411" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510293655__p7214519559">为了保证ohpm-repo能够正确加载自定义规则校验，需要修改配置文件config.yaml，开启自定义元数据规则校验，涉及field_check_plugin字段内容修改。</p>     <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen034916920572" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">field_check_plugin</span>:</li><li>  <span class="hljs-variable">config_file_path</span>:  <span class="hljs-title class_">plugins</span>/<span class="hljs-variable">fieldCheckPlugin</span>/<span class="hljs-variable">CustomExtensionValidationConfig</span>.<span class="hljs-variable">json</span></li><li>  <span class="hljs-variable">check_func_dir</span>: <span class="hljs-title class_">plugins</span>/<span class="hljs-variable">fieldCheckPlugin</span>                                       </li></ol></pre></div></div>    </div>    <p id="ZH-CN_TOPIC_0000002510293655__p15885193315595">参数说明：</p>    <ul id="ZH-CN_TOPIC_0000002510293655__ul11885133317594">     <li id="li3885193395917">config_file_path：字段校验配置文件路径，支持绝对路径和相对路径，相对路径的基准为ohpm-repo解压根目录，建议将文件存放在软件包的plugins/fieldCheckPlugin目录下，默认值为plugins/fieldCheckPlugin/CustomExtensionValidationConfig.json。</li>     <li id="li1088510339596">check_func_dir：字段校验函数文件所在目录路径，支持绝对路径和相对路径，相对路径的基准为ohpm-repo解压根目录，建议将目录设置为plugins/fieldCheckPlugin文件夹，默认值为plugins/fieldCheckPlugin。</li>    </ul>    <div class="tiledSection">     <h2 id="section1495925913017">使用自定义规则校验<i class="anchor-icon anchor-icon-link" anchorid="section1495925913017" tips="复制节点链接"></i></h2>          <ol id="ZH-CN_TOPIC_0000002510293655__ol1342163513110">      <li id="li194218352015"><span>安装必要的npm包。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510293655__p144811571016">通过命令行工具，在ohpm-repo解压根目录下，安装typescript包和@types/node包。</p>       <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" id="ZH-CN_TOPIC_0000002510293655__screen65331430434" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">$ </span>npm i typescript</li><li><span class="hljs-variable">$ </span>npm i <span class="hljs-variable">@types</span>/node</li></ol></pre></div></div>       <p></p></li>      <li id="li243817541319"><span>编译自定义规则函数文件。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510293655__p265215356418">如果checkField.ts(举例说明，函数名称可自定义) 存放在ohpm-repo安装根目录的plugins/fieldCheckPlugin文件夹中，当编写完规则函数后，通过命令行工具，在ohpm-repo安装根目录下执行如下编译命令。</p>       <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" id="ZH-CN_TOPIC_0000002510293655__screen125959717510" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">$ </span>tsc </li></ol></pre></div></div>       <p id="ZH-CN_TOPIC_0000002510293655__p10539189620">命令成功执行后会在ohpm-repo解压根目录的plugins/outDir文件夹中生成编译后的文件checkField.js。</p>       <p id="ZH-CN_TOPIC_0000002510293655__p1599774914617">如果checkField.ts没有存放在plugins/fieldCheckPlugin内，请先修改<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-rule-verification-template-file#section1613602518915">tsconfig.json</a>文件中参数include和outDir，include指定需编译的插件代码的存储目录，outDir指定编译后文件的存储位置，修改后通过命令行工具，在ohpm-repo解压根目录下执行编译命令“tsc”。</p>       <div _ngcontent-vic-c106="" class="highlight-div"><div _ngcontent-vic-c106="" class="highlight-div-header"><div _ngcontent-vic-c106="" class="highlight-div-header-left"><div _ngcontent-vic-c106="" class="handle-button expand-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vic-c106="" class="highlight-div-header-right"><div _ngcontent-vic-c106="" class="handle-button ai-button"></div><div _ngcontent-vic-c106="" class="handle-button line-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vic-c106="" class="handle-button theme-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vic-c106="" class="handle-button copy-button"><div _ngcontent-vic-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vic-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510293655__screen12543344714" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// tsconfig.json 文件中的默认配置</span></li><li><span class="hljs-comment">// 默认值：自定义规则函数文件默认存放在 ./plugins/fieldCheckPlugin 中，编译后的文件存放在./plugins/outDir中</span></li><li> <span class="hljs-string">"include"</span>: <span class="hljs-string">"plugins/fieldCheckPlugin/*"</span>          <span class="hljs-comment">// 插件文件的位置</span></li><li> <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"./plugins/outDir"</span>                     <span class="hljs-comment">// 编译后文件的存放位置</span></li></ol></pre></div></div>       <p></p></li>      <li id="li24420451385"><span>编译后文件指定存放位置。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510293655__p419615543820">编译后获得的checkField.js需要与checkField.ts保持在同一级目录中，否则会编译出错。默认checkField.js文件输出在./plugins/outDir内，需要把checkField.js拷贝到checkField.ts同级目录./plugins/fieldCheckPlugin中（ohpm-repo成功启动后可删除checkField.ts文件）。</p>       <p></p></li>      <li id="li1660312501114"><span>ohpm-repo服务的启动。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510293655__p13694155041013">在完成上述操作之后，通过执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-install">install</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-start">start</a>命令，完成服务的部署启动。</p>       <p></p></li>      <li id="li1954348171016"><span>发送三方包，使用自定义规则校验。</span>       <p></p>       <p id="ZH-CN_TOPIC_0000002510293655__p167749612126">通过ohpm命令行工具或者ohpm-repo管理界面，发布三方包。在发包的过程中包的元数据将通过自定义规则的校验，如果校验不通过则会报错，请根据报错信息修改oh-package.json文件的内容再重新发布三方包。</p>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>