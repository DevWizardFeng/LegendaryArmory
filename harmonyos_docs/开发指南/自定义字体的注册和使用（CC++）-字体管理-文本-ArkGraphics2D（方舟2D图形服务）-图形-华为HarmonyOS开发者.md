<h1 _ngcontent-twk-c119="" class="doc-title ng-star-inserted" title="自定义字体的注册和使用（C/C++）"> 自定义字体的注册和使用（C/C++） </h1>

<div _ngcontent-twk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>自定义字体是指开发者根据应用需求创建或选择的字体，通常用于实现特定的文字风格或满足独特的设计要求。当应用需要使用特定的文本样式和字符集时，可以注册并使用自定义字体进行文本渲染。</p>    </div>    <div class="tiledSection">     <h2 id="实现流程">实现流程<i class="anchor-icon anchor-icon-link" anchorid="实现流程" tips="复制节点链接"></i></h2>          <p><strong>自定义字体的注册</strong>是指将字体文件（如ttf、otf文件等）从应用资源注册到系统中，使得应用能够使用这些字体进行文本渲染。注册过程通常指将字体文件通过字体管理接口注册到系统字体库中，以便在应用中进行调用。</p>     <p><strong>自定义字体的使用</strong>是指在应用中显式指定使用已注册的自定义字体进行文本绘制。开发者可以根据需要选择特定的文本样式（如常规、粗体、斜体等），并将其应用到UI元素、文本控件或其他文本展示区域，以确保符合设计要求并提供一致的视觉效果。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>注册使用自定义字体的相关接口如下所示，详细接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing" target="_blank">Drawing</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_CreateSharedFontCollection (void)</td>         <td class="cellrowborder" valign="top" width="50%">创建可共享的字体集对象OH_Drawing_FontCollection。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_RegisterFont (OH_Drawing_FontCollection* , const char* fontFamily, const char* familySrc )</td>         <td class="cellrowborder" valign="top" width="50%">用于在字体管理器中注册自定义字体，支持的字体文件格式包含：ttf、otf。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_CreateTextStyle(void)</td>         <td class="cellrowborder" valign="top" width="50%">创建指向OH_Drawing_TextStyle对象的指针，用于设置文本样式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_SetTextStyleFontFamilies (OH_Drawing_TextStyle *, int, const char *fontFamilies[])</td>         <td class="cellrowborder" valign="top" width="50%">设置字体类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_UnregisterFont (OH_Drawing_FontCollection* , const char* fontFamily)</td>         <td class="cellrowborder" valign="top" width="50%">通过字体家族名称取消注册自定义字体。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>在工程的src/main/cpp/CMakeLists.txt文件中添加以下lib。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>libnative_drawing.so</li></ol></pre></div></div></li>      <li>       <p>导入依赖的相关头文件。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_font_collection.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_text_typography.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_register_font.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>创建字体管理器，建议优先使用OH_Drawing_CreateSharedFontCollection()创建可共享的字体集对象。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>使用OH_Drawing_CreateFontCollection()和OH_Drawing_CreateSharedFontCollection()均可创建字体管理器OH_Drawing_FontCollection对象，但前者创建的字体集指针对象只能被一个段落生成器OH_Drawing_TypographyCreate对象使用，无法被多个段落生成器OH_Drawing_TypographyCreate对象共享使用。如需在多个段落生成器OH_Drawing_TypographyCreate对象间共享使用，请使用后者创建可共享的字体集对象。</p>        </div></div></div>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_FontCollection *fontCollection = OH_Drawing_CreateSharedFontCollection();</li></ol></pre></div></div></li>      <li>       <p>设置自定义字体的字体家族名和字体文件所在的沙箱路径。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>确保需注册的可用自定义字体文件已正确放置在应用设备的/system/fonts/myFontFile.ttf路径下。</p>        </div></div></div>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 后续使用自定义字体时，需使用到该字体家族名</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* fontFamily = <span class="hljs-string">"myFamilyName"</span>;</li><li><span class="hljs-comment">// 该路径是待注册的自定义字体文件在应用设备下的路径，确保该自定义字体文件已正确放置在该路径下</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* fontPath = <span class="hljs-string">"/system/fonts/myFontFile.ttf"</span>;</li></ol></pre></div></div></li>      <li>       <p>在字体管理器中使用OH_Drawing_RegisterFont()注册自定义字体。</p>       <p>可通过接口返回结果，查看具体情况，确认注册成功与否。</p>       <p>OH_Drawing_RegisterFont接口返回结果的几种情况及含义如下所示：</p>       <p>0表示注册成功，1表示文件不存在，2表示打开文件失败，3表示读取文件失败，4表示寻找文件失败，5表示获取大小失败，9表示文件损坏。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 返回0为成功，1为文件不存在，2为打开文件失败，3为读取文件失败，4为寻找文件失败，5为获取大小失败，9为文件损坏</span></li><li><span class="hljs-type">int</span> errorCode = <span class="hljs-built_in">OH_Drawing_RegisterFont</span>(fontCollection, fontFamily, fontPath);</li></ol></pre></div></div></li>      <li>       <p>确保自定义字体注册成功后，使用OH_Drawing_CreateTextStyle()接口创建文本样式对象，并使用OH_Drawing_SetTextStyleFontFamilies()接口加入自定义字体。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_TextStyle* textStyle = <span class="hljs-built_in">OH_Drawing_CreateTextStyle</span>();</li><li><span class="hljs-comment">// 如果已经注册成功自定义字体，填入自定义字体的字体家族名</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* myFontFamilies[] = {<span class="hljs-string">"myFamilyName"</span>};</li><li><span class="hljs-comment">// 加入可使用的自定义字体</span></li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontFamilies</span>(textStyle, <span class="hljs-number">1</span>, myFontFamilies);</li></ol></pre></div></div></li>      <li>       <p>生成最终段落文本，使用自定义字体，以便实现最终的文本绘制和显示。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置其他文本样式</span></li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(textStyle , <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>));</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(textStyle , <span class="hljs-number">50.0</span>);</li><li><span class="hljs-comment">// 创建一个段落样式对象，以设置排版风格</span></li><li>OH_Drawing_TypographyStyle *typographyStyle = <span class="hljs-built_in">OH_Drawing_CreateTypographyStyle</span>();</li><li><span class="hljs-built_in">OH_Drawing_SetTypographyTextAlign</span>(typographyStyle, TEXT_ALIGN_LEFT); <span class="hljs-comment">// 设置段落样式为左对齐</span></li><li><span class="hljs-comment">// 创建一个段落生成器</span></li><li>OH_Drawing_TypographyCreate* handler = <span class="hljs-built_in">OH_Drawing_CreateTypographyHandler</span>(typographyStyle, fontCollection);</li><li><span class="hljs-comment">// 在段落生成器中设置文本样式</span></li><li><span class="hljs-built_in">OH_Drawing_TypographyHandlerPushTextStyle</span>(handler, textStyle);</li><li><span class="hljs-comment">// 在段落生成器中设置文本内容</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* text = <span class="hljs-string">"Hello World. 你好世界。\n以上文字使用了主题字体"</span>;</li><li><span class="hljs-built_in">OH_Drawing_TypographyHandlerAddText</span>(handler, text);</li><li><span class="hljs-comment">// 通过段落生成器生成段落</span></li><li>OH_Drawing_Typography* typography = <span class="hljs-built_in">OH_Drawing_CreateTypography</span>(handler);</li></ol></pre></div></div></li>      <li>       <p>如果需要释放自定义字体，可以使用OH_Drawing_UnregisterFont接口。</p>       <div _ngcontent-twk-c106="" class="highlight-div"><div _ngcontent-twk-c106="" class="highlight-div-header"><div _ngcontent-twk-c106="" class="highlight-div-header-left"><div _ngcontent-twk-c106="" class="handle-button expand-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-twk-c106="" class="highlight-div-header-right"><div _ngcontent-twk-c106="" class="handle-button ai-button"></div><div _ngcontent-twk-c106="" class="handle-button line-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-twk-c106="" class="handle-button theme-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-twk-c106="" class="handle-button copy-button"><div _ngcontent-twk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-twk-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放自定义字体</span></li><li><span class="hljs-built_in">OH_Drawing_UnregisterFont</span>(fontCollection, fontFamily);</li><li><span class="hljs-comment">// 重新排版</span></li><li><span class="hljs-comment">// ...</span></li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>