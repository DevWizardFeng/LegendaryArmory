<h1 _ngcontent-rea-c119="" class="doc-title ng-star-inserted" title="自定义渲染节点 (RenderNode)"> 自定义渲染节点 (RenderNode) </h1>

<div _ngcontent-rea-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>对于不具备自己的渲染环境的三方框架，尽管已实现前端解析、布局及事件处理等功能，但仍需依赖系统的基础渲染和动画能力。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-framenode">FrameNode</a>上的通用属性与通用事件对这类框架而言是冗余的，会导致多次不必要的操作，涵盖布局、事件处理等逻辑。</p>     <p>自定义渲染节点 (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode" target="_blank">RenderNode</a>)是更加轻量的渲染节点，仅具备与渲染相关的功能。它提供了设置基础渲染属性的能力，以及节点的动态添加、删除和自定义绘制的能力。RenderNode能够为第三方框架提供基础的渲染和动画支持。</p>    </div>    <div class="tiledSection">     <h2 id="创建和删除节点">创建和删除节点<i class="anchor-icon anchor-icon-link" anchorid="创建和删除节点" tips="复制节点链接"></i></h2>          <p>RenderNode提供了节点创建和删除的能力。可以通过RenderNode的构造函数创建自定义的RenderNode节点。通过构造函数创建的节点对应一个实体的节点。同时，可以通过RenderNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#dispose12" target="_blank">dispose</a>接口来实现与实体节点的绑定关系的解除。</p>    </div>    <div class="tiledSection">     <h2 id="操作节点树">操作节点树<i class="anchor-icon anchor-icon-link" anchorid="操作节点树" tips="复制节点链接"></i></h2>          <p>RenderNode提供了节点的增、删、查、改的能力，能够修改节点的子树结构；可以对所有RenderNode的节点的父子节点做出查询操作，并返回查询结果。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>RenderNode中查询获取得到的子树结构按照开发通过RenderNode的接口传递的参数构建。</p></li>        <li>         <p>RenderNode如果要与系统直接结合显示，使用需要依赖FrameNode中获取的RenderNode进行挂载上树。</p></li>       </ul>      </div></div></div>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">RenderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"RenderNode"</span>;</li><li><span class="hljs-keyword">const</span> renderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>renderNode.<span class="hljs-property">frame</span> = {</li><li>  <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">350</span></li><li>};</li><li>renderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xffff0000</span>;</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</li><li>  <span class="hljs-keyword">const</span> node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>  <span class="hljs-comment">// 设置node节点的Frame大小</span></li><li>  node.<span class="hljs-property">frame</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-number">10</span> + <span class="hljs-number">60</span> * i,</li><li>    <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,</li><li>    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span></li><li>  };</li><li>  <span class="hljs-comment">// 设置node节点的背景颜色</span></li><li>  node.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xff00ff00</span>;</li><li>  <span class="hljs-comment">// 将新增节点挂载在renderNode上</span></li><li>  renderNode.<span class="hljs-title function_">appendChild</span>(node);</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode) {</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(renderNode);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">350</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getNextSibling'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> child = renderNode.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">1</span>);</li><li>          <span class="hljs-keyword">const</span> nextSibling = child!.<span class="hljs-title function_">getNextSibling</span>()</li><li>          <span class="hljs-keyword">if</span> (child === <span class="hljs-literal">null</span> || nextSibling === <span class="hljs-literal">null</span>) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">' the child or nextChild is null'</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// 获取子节点的位置信息</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> the position of child is x: <span class="hljs-subst">${child.position.x}</span>, y: <span class="hljs-subst">${child.position.y}</span>, `</span> +</li><li>            <span class="hljs-string">`the position of nextSibling is x: <span class="hljs-subst">${nextSibling.position.x}</span>, y: <span class="hljs-subst">${nextSibling.position.y}</span>`</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置和获取渲染相关属性">设置和获取渲染相关属性<i class="anchor-icon anchor-icon-link" anchorid="设置和获取渲染相关属性" tips="复制节点链接"></i></h2>          <p>RenderNode中可以设置渲染相关的属性，包括：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#backgroundcolor" target="_blank">backgroundColor</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#cliptoframe" target="_blank">clipToFrame</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#opacity" target="_blank">opacity</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#size" target="_blank">size</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#position" target="_blank">position</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#frame" target="_blank">frame</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#pivot" target="_blank">pivot</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#scale" target="_blank">scale</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#translation" target="_blank">translation</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#rotation" target="_blank">rotation</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#transform" target="_blank">transform</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shadowcolor" target="_blank">shadowColor</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shadowoffset" target="_blank">shadowOffset</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shadowalpha" target="_blank">shadowAlpha</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shadowelevation" target="_blank">shadowElevation</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shadowradius" target="_blank">shadowRadius</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#borderstyle12" target="_blank">borderStyle</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#borderwidth12" target="_blank">borderWidth</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#bordercolor12" target="_blank">borderColor</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#borderradius12" target="_blank">borderRadius</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shapemask12" target="_blank">shapeMask</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#shapeclip12" target="_blank">shapeClip</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#marknodegroup12" target="_blank">markNodeGroup</a>等。具体属性支持范围参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode" target="_blank">RenderNode</a>接口说明。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>RenderNode中查询获取得到的属性为设置的属性值。</p></li>        <li>         <p>若未传入参数或者传入参数为非法值则查询获得的为默认值。</p></li>        <li>         <p>不建议对BuilderNode中的RenderNode进行修改操作。BuilderNode中具体属性设置是由状态管理实现的，属性更新的时序开发者不可控，BuilderNode和FrameNode中同时设置RenderNode属性可能会导致RenderNode属性设置与预期不相符。</p></li>       </ul>      </div></div></div>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">RenderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">ShapeMask</span>, <span class="hljs-title class_">ShapeClip</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"RenderNode"</span>;</li><li><span class="hljs-keyword">const</span> mask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShapeMask</span>();</li><li>mask.<span class="hljs-title function_">setRectShape</span>({</li><li>  <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">right</span>: <span class="hljs-number">150</span>,</li><li>  <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">bottom</span>: <span class="hljs-number">150</span></li><li>});</li><li>mask.<span class="hljs-property">fillColor</span> = <span class="hljs-number">0X55FF0000</span>;</li><li>mask.<span class="hljs-property">strokeColor</span> = <span class="hljs-number">0XFFFF0000</span>;</li><li>mask.<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">24</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> clip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShapeClip</span>();</li><li>clip.<span class="hljs-title function_">setCommandPath</span>({ <span class="hljs-attr">commands</span>: <span class="hljs-string">"M100 0 L0 100 L50 200 L150 200 L200 100 Z"</span> });</li><li>
</li><li><span class="hljs-keyword">const</span> renderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>renderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xffff0000</span>;</li><li>renderNode.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> };</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(renderNode);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"position"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">position</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">10</span> };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" position:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">position</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"pivot"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">pivot</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.6</span> };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" pivot:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">pivot</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"scale"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">scale</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1</span> };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" scale:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">scale</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"translation"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">translation</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" translation:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">translation</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"rotation"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">rotation</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">45</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">z</span>: <span class="hljs-number">0</span> };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" rotation:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">rotation</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"transform"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">transform</span> = [</li><li>            <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,</li><li>            <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,</li><li>            <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>,</li><li>            <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span></li><li>          ];</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" transform:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">transform</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"shadow"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">shadowElevation</span> = <span class="hljs-number">10</span>;</li><li>          renderNode.<span class="hljs-property">shadowColor</span> = <span class="hljs-number">0XFF00FF00</span>;</li><li>          renderNode.<span class="hljs-property">shadowOffset</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">10</span> };</li><li>          renderNode.<span class="hljs-property">shadowAlpha</span> = <span class="hljs-number">0.1</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowElevation:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowElevation</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowColor:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowColor</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowOffset:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowOffset</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowAlpha:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowAlpha</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"shadowRadius"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">shadowOffset</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">10</span> };</li><li>          renderNode.<span class="hljs-property">shadowAlpha</span> = <span class="hljs-number">0.7</span></li><li>          renderNode.<span class="hljs-property">shadowRadius</span> = <span class="hljs-number">30</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowOffset:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowOffset</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowAlpha:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowAlpha</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shadowRadius:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shadowRadius</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"border"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">borderWidth</span> = {</li><li>            <span class="hljs-attr">left</span>: <span class="hljs-number">8</span>,</li><li>            <span class="hljs-attr">top</span>: <span class="hljs-number">8</span>,</li><li>            <span class="hljs-attr">right</span>: <span class="hljs-number">8</span>,</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-number">8</span></li><li>          };</li><li>          renderNode.<span class="hljs-property">borderStyle</span> = {</li><li>            <span class="hljs-attr">left</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Solid</span>,</li><li>            <span class="hljs-attr">top</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span>,</li><li>            <span class="hljs-attr">right</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dashed</span>,</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Solid</span></li><li>          }</li><li>          renderNode.<span class="hljs-property">borderColor</span> = {</li><li>            <span class="hljs-attr">left</span>: <span class="hljs-number">0xFF0000FF</span>,</li><li>            <span class="hljs-attr">top</span>: <span class="hljs-number">0xFF0000FF</span>,</li><li>            <span class="hljs-attr">right</span>: <span class="hljs-number">0xFF0000FF</span>,</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-number">0xFF0000FF</span></li><li>          };</li><li>          renderNode.<span class="hljs-property">borderRadius</span> = {</li><li>            <span class="hljs-attr">topLeft</span>: <span class="hljs-number">32</span>,</li><li>            <span class="hljs-attr">topRight</span>: <span class="hljs-number">32</span>,</li><li>            <span class="hljs-attr">bottomLeft</span>: <span class="hljs-number">32</span>,</li><li>            <span class="hljs-attr">bottomRight</span>: <span class="hljs-number">32</span></li><li>          };</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" borderWidth:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">borderWidth</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" borderStyle:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">borderStyle</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" borderColor:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">borderColor</span>));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" borderRadius:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">borderRadius</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"shapeMask"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">shapeMask</span> = mask;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shapeMask:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shapeMask</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"shapeClip"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          renderNode.<span class="hljs-property">shapeClip</span> = clip;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" shapeClip:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(renderNode.<span class="hljs-property">shapeClip</span>));</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="自定义绘制">自定义绘制<i class="anchor-icon anchor-icon-link" anchorid="自定义绘制" tips="复制节点链接"></i></h2>          <p>通过重写RenderNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#draw" target="_blank">draw</a>方法，可以自定义RenderNode的绘制内容，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#invalidate" target="_blank">invalidate</a>接口可以主动触发节点的重新绘制。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>同时同步触发多个invalidate仅会触发一次重新绘制。</p></li>        <li>         <p>自定义绘制有两种绘制方式：通过ArkTS接口进行调用和通过Node-API进行调用。</p></li>       </ul>      </div></div></div>     <p><strong>ArkTS接口调用示例：</strong></p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">RenderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { drawing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRenderNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderNode</span> {</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">200</span>;</li><li>
</li><li>  <span class="hljs-title function_">draw</span>(<span class="hljs-params">context: DrawContext</span>) {</li><li>    <span class="hljs-comment">// 获取canvas对象</span></li><li>    <span class="hljs-keyword">const</span> canvas = context.<span class="hljs-property">canvas</span>;</li><li>    <span class="hljs-comment">// 创建笔刷</span></li><li>    <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>    <span class="hljs-comment">// 设置笔刷颜色</span></li><li>    brush.<span class="hljs-title function_">setColor</span>({</li><li>      <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">red</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">blue</span>: <span class="hljs-number">0</span></li><li>    });</li><li>    canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>    <span class="hljs-comment">// 绘制矩阵</span></li><li>    canvas.<span class="hljs-title function_">drawRect</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">200</span></li><li>    });</li><li>    canvas.<span class="hljs-title function_">detachBrush</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`RenderNode draw width = <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.width}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">const</span> renderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRenderNode</span>();</li><li>renderNode.<span class="hljs-property">frame</span> = {</li><li>  <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">300</span></li><li>};</li><li>renderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xff0000ff</span>;</li><li>renderNode.<span class="hljs-property">opacity</span> = <span class="hljs-number">0.5</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-property">frame</span> = {</li><li>        <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">width</span>: <span class="hljs-number">500</span>,</li><li>        <span class="hljs-attr">height</span>: <span class="hljs-number">500</span></li><li>      }</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(renderNode);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Invalidate'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 同步调用多次，仅触发一次重绘，draw回调中的日志仅打印一次</span></li><li>          renderNode.<span class="hljs-property">width</span> += <span class="hljs-number">10</span>;</li><li>          renderNode.<span class="hljs-title function_">invalidate</span>();</li><li>          renderNode.<span class="hljs-title function_">invalidate</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="调整自定义绘制canvas的变换矩阵">调整自定义绘制Canvas的变换矩阵<i class="anchor-icon anchor-icon-link" anchorid="调整自定义绘制canvas的变换矩阵" tips="复制节点链接"></i></h2>          <p>从API version 12开始，通过重写RenderNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#draw" target="_blank">draw</a>方法，可以自定义RenderNode的绘制内容。</p>     <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#concatmatrix12" target="_blank">concatMatrix</a>可以调整自定义绘制Canvas的变换矩阵。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#gettotalmatrix12" target="_blank">getTotalMatrix</a>获取的是用来记录绘制指令的临时canvas的变换矩阵。</p></li>        <li>         <p>如果开发者希望对画布进行预期的变换，应使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#concatmatrix12" target="_blank">concatMatrix</a>而不是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#setmatrix12" target="_blank">setMatrix</a>，因为setMatrix会覆盖原本真实canvas上存在的变换矩阵。</p></li>       </ul>      </div></div></div>     <p><strong>ArkTS接口调用示例：</strong></p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">RenderNode</span>, <span class="hljs-title class_">DrawContext</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { drawing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawImage</span>(<span class="hljs-params">canvas: DrawingCanvas</span>) {</li><li>  <span class="hljs-keyword">let</span> matrix = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Matrix</span>();</li><li>  matrix.<span class="hljs-title function_">setTranslation</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>  canvas.<span class="hljs-title function_">concatMatrix</span>(matrix);</li><li>  <span class="hljs-keyword">const</span> pen = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Pen</span>();</li><li>  pen.<span class="hljs-title function_">setStrokeWidth</span>(<span class="hljs-number">5</span>);</li><li>  pen.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">74</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">175</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachPen</span>(pen);</li><li>  <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>  brush.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">74</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">175</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>  canvas.<span class="hljs-title function_">drawRect</span>({</li><li>    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">right</span>: <span class="hljs-number">110</span>,</li><li>    <span class="hljs-attr">bottom</span>: <span class="hljs-number">60</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">detachPen</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawImage1</span>(<span class="hljs-params">canvas: DrawingCanvas</span>) {</li><li>  <span class="hljs-keyword">let</span> matrix = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Matrix</span>();</li><li>  matrix.<span class="hljs-title function_">setTranslation</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>  <span class="hljs-comment">// 1. getTotalMatrix获取的是用来记录绘制指令的临时canvas的变换矩阵</span></li><li>  <span class="hljs-comment">// 2. 如果开发者希望这个画布进行一个预期的变换，应该使用concatMatrix而不是setMatrix，因为setMatrix会覆盖原本真实canvas上存在的变换矩阵</span></li><li>  canvas.<span class="hljs-title function_">getTotalMatrix</span>();</li><li>  canvas.<span class="hljs-title function_">setMatrix</span>(matrix);</li><li>  <span class="hljs-keyword">const</span> pen = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Pen</span>();</li><li>  pen.<span class="hljs-title function_">setStrokeWidth</span>(<span class="hljs-number">5</span>);</li><li>  pen.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">74</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">175</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachPen</span>(pen);</li><li>  <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>  brush.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">74</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">175</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>  canvas.<span class="hljs-title function_">drawRect</span>({</li><li>    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">right</span>: <span class="hljs-number">110</span>,</li><li>    <span class="hljs-attr">bottom</span>: <span class="hljs-number">60</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">detachPen</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRenderNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderNode</span> {</li><li>  <span class="hljs-title function_">draw</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">DrawContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">drawImage</span>(context.<span class="hljs-property">canvas</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRenderNode1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderNode</span> {</li><li>  <span class="hljs-title function_">draw</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">DrawContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">drawImage1</span>(context.<span class="hljs-property">canvas</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    rootNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">theRenderNode</span>: <span class="hljs-title class_">MyRenderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRenderNode</span>();</li><li>    theRenderNode.<span class="hljs-property">frame</span> = {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>,</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">50</span></li><li>    };</li><li>    theRenderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xFF2787D9</span>;</li><li>    rootNode.<span class="hljs-title function_">getRenderNode</span>()?.<span class="hljs-title function_">appendChild</span>(theRenderNode);</li><li>    <span class="hljs-keyword">return</span> rootNode;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    rootNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">theRenderNode</span>: <span class="hljs-title class_">MyRenderNode1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRenderNode1</span>();</li><li>    theRenderNode.<span class="hljs-property">frame</span> = {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>,</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">50</span></li><li>    };</li><li>    theRenderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xFF2787D9</span>;</li><li>    rootNode.<span class="hljs-title function_">getRenderNode</span>()?.<span class="hljs-title function_">appendChild</span>(theRenderNode);</li><li>    <span class="hljs-keyword">return</span> rootNode;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-attr">myNodeController1</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController1</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController1</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="406" originwidth="1080" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114935.78478543745623672673985357028290:50001231000000:2800:27E299D64E0210521A6D3021AA1B841BBC8A233B0D1BFCB4D724530106C676E1.png" width="920" height="345.85185185185185"></span></p>     <p><strong>Node-API调用示例：</strong></p>     <p>C++侧可通过Node-API来获取Canvas，并进行后续的自定义绘制操作。</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// native_bridge.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_color.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_path.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_pen.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">OnDraw</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">4</span>;</li><li>    napi_value args[<span class="hljs-number">4</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-type">int32_t</span> id;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;id);</li><li>    </li><li>    <span class="hljs-comment">// 获取 Canvas 指针</span></li><li>    <span class="hljs-type">void</span>* temp = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_unwrap</span>(env, args[<span class="hljs-number">1</span>], &amp;temp);</li><li>    OH_Drawing_Canvas *canvas = <span class="hljs-built_in">reinterpret_cast</span>&lt;OH_Drawing_Canvas*&gt;(temp);</li><li>    </li><li>    <span class="hljs-comment">// 获取 Canvas 宽度</span></li><li>    <span class="hljs-type">int32_t</span> width;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">2</span>], &amp;width);</li><li>    </li><li>    <span class="hljs-comment">// 获取 Canvas 高度</span></li><li>    <span class="hljs-type">int32_t</span> height;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">3</span>], &amp;height);</li><li>    </li><li>    <span class="hljs-comment">// 传入canvas、height、width等信息至绘制函数中进行自定义绘制</span></li><li>    <span class="hljs-keyword">auto</span> path = <span class="hljs-built_in">OH_Drawing_PathCreate</span>();</li><li>    <span class="hljs-built_in">OH_Drawing_PathMoveTo</span>(path, width / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PathClose</span>(path);</li><li>    </li><li>    <span class="hljs-keyword">auto</span> pen = <span class="hljs-built_in">OH_Drawing_PenCreate</span>();</li><li>    <span class="hljs-built_in">OH_Drawing_PenSetWidth</span>(pen, <span class="hljs-number">10</span>);</li><li>    <span class="hljs-built_in">OH_Drawing_PenSetColor</span>(pen, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>));</li><li>    <span class="hljs-built_in">OH_Drawing_CanvasAttachPen</span>(canvas, pen);</li><li>    </li><li>    <span class="hljs-built_in">OH_Drawing_CanvasDrawPath</span>(canvas, path);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"nativeOnDraw"</span>, <span class="hljs-literal">nullptr</span>, OnDraw, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> }</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version =<span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>),</li><li>    .reserved = { <span class="hljs-number">0</span> },</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_module_register</span>(&amp;demoModule);</li><li>}</li></ol></pre></div></div>     <p>修改工程中的src/main/cpp/CMakeLists.txt文件，添加如下内容：</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li># the minimum version of CMake.</li><li><span class="hljs-built_in">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.4</span>.<span class="hljs-number">1</span>)</li><li><span class="hljs-built_in">project</span>(NapiTest)</li><li>
</li><li><span class="hljs-built_in">set</span>(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li>
</li><li><span class="hljs-built_in">include_directories</span>(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li><span class="hljs-built_in">add_library</span>(entry SHARED native_bridge.cpp)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_ndk.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_drawing.so)</li></ol></pre></div></div>     <p>同时在工程中的src/main/cpp/types/libentry/index.d.ts文件中，添加自定义绘制函数在ArkTS侧的定义，如：</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DrawContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">nativeOnDraw</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, context: DrawContext, width: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>     <p>ArkTS侧代码：</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> bridge <span class="hljs-keyword">from</span> <span class="hljs-string">"libentry.so"</span> <span class="hljs-comment">// 该 so 由 Node-API 编写并生成</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DrawContext</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">RenderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRenderNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderNode</span> {</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">uiContext: UIContext</span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">draw</span>(<span class="hljs-params">context: DrawContext</span>) {</li><li>    <span class="hljs-comment">// 需要将 context 中的宽度和高度从vp转换为px</span></li><li>    bridge.<span class="hljs-title function_">nativeOnDraw</span>(<span class="hljs-number">0</span>, context, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(context.<span class="hljs-property">size</span>.<span class="hljs-property">height</span>), <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(context.<span class="hljs-property">size</span>.<span class="hljs-property">width</span>));</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">const</span> renderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRenderNode</span>(uiContext);</li><li>      renderNode.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> }</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(renderNode);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置标签">设置标签<i class="anchor-icon anchor-icon-link" anchorid="设置标签" tips="复制节点链接"></i></h2>          <p>开发者可利用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#label12" target="_blank">label</a>接口向RenderNode设置标签信息，这有助于在节点Inspector中更清晰地区分各节点。</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {  <span class="hljs-title class_">RenderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">renderNode</span>: <span class="hljs-title class_">RenderNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (renderNode !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">renderChildNode</span>: <span class="hljs-title class_">RenderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>      renderChildNode.<span class="hljs-property">frame</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> };</li><li>      renderChildNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xffff0000</span>;</li><li>      renderChildNode.<span class="hljs-property">label</span> = <span class="hljs-string">'customRenderChildNode'</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'label:'</span>, renderChildNode.<span class="hljs-property">label</span>);</li><li>      renderNode.<span class="hljs-title function_">appendChild</span>(renderChildNode);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">700</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查询当前rendernode是否解除引用">查询当前RenderNode是否解除引用<i class="anchor-icon anchor-icon-link" anchorid="查询当前rendernode是否解除引用" tips="复制节点链接"></i></h2>          <p>前端节点均绑定有相应的后端实体节点，当节点调用dispose接口解除绑定后，再次调用接口可能会出现crash、返回默认值的情况。</p>     <p>从API version 20开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode#isdisposed20" target="_blank">isDisposed</a>接口查询当前RenderNode对象是否已解除与后端实体节点的引用关系，从而可以在操作节点前检查其有效性，避免潜在风险。</p>     <div _ngcontent-rea-c106="" class="highlight-div"><div _ngcontent-rea-c106="" class="highlight-div-header"><div _ngcontent-rea-c106="" class="highlight-div-header-left"><div _ngcontent-rea-c106="" class="handle-button expand-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rea-c106="" class="highlight-div-header-right"><div _ngcontent-rea-c106="" class="handle-button ai-button"></div><div _ngcontent-rea-c106="" class="handle-button line-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rea-c106="" class="handle-button theme-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rea-c106="" class="handle-button copy-button"><div _ngcontent-rea-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rea-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">RenderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">renderNode</span>: <span class="hljs-title class_">RenderNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span>.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">300</span> };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xffd5d5d5</span>;</li><li>
</li><li>    <span class="hljs-comment">// 挂载RenderNode</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>()?.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">disposeRenderNode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 解除RenderNode与后端实体节点的引用关系</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span>?.<span class="hljs-title function_">dispose</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">isDisposed</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 查询RenderNode是否解除引用</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderNode</span>.<span class="hljs-title function_">isDisposed</span>()) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'renderNode isDisposed is true'</span>;</li><li>      }</li><li>      <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'renderNode isDisposed is false'</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'renderNode is null'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">4</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'RenderNode dispose'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">disposeRenderNode</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">''</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'RenderNode isDisposed'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isDisposed</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>