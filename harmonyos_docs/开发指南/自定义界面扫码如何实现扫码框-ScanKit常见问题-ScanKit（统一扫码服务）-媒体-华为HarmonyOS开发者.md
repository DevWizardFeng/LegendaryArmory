<h1 _ngcontent-jvl-c119="" class="doc-title ng-star-inserted" title="自定义界面扫码如何实现扫码框"> 自定义界面扫码如何实现扫码框 </h1>

<div _ngcontent-jvl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><strong>问题现象</strong></p>    <p>扫码界面没有类似扫码框呈现。</p>    <p><strong>解决措施</strong></p>    <ol>     <li>使用ArkTS在实时扫码界面画出需要的扫码框。</li>     <li>根据获得的码图位置信息确定码图是否在扫码框内（注意：需要将码图位置单位和扫码框位置单位保持一致，根据实际情况使用px或vp）。</li>     <li>当码图位置不在扫码框范围内时，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-customscan-api#section747366165913" target="_blank">customScan.start</a>的callback回调中执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-customscan-api#section19244173211169" target="_blank">customScan.rescan</a>接口，即可继续扫码。</li>    </ol>    <p>示例代码（仅供参考）：</p>    <div _ngcontent-jvl-c106="" class="highlight-div"><div _ngcontent-jvl-c106="" class="highlight-div-header"><div _ngcontent-jvl-c106="" class="highlight-div-header-left"><div _ngcontent-jvl-c106="" class="handle-button expand-button"><div _ngcontent-jvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jvl-c106="" class="highlight-div-header-right"><div _ngcontent-jvl-c106="" class="handle-button ai-button"></div><div _ngcontent-jvl-c106="" class="handle-button line-button"><div _ngcontent-jvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jvl-c106="" class="handle-button theme-button"><div _ngcontent-jvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jvl-c106="" class="handle-button copy-button"><div _ngcontent-jvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jvl-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan, scanBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 例如XComponent设置的宽高为cameraWidth = 1080px, cameraHeight = 1920px</span></li><li><span class="hljs-keyword">let</span> cameraWidth = <span class="hljs-number">1080</span>;</li><li><span class="hljs-keyword">let</span> cameraHeight = <span class="hljs-number">1920</span>;</li><li><span class="hljs-comment">// 自定义扫码框在屏幕中间 scanBox 为800px*800px，则扫码框相对XComponent的坐标left: 140px, top: 560px, right: 940px, bottom: 1360px</span></li><li><span class="hljs-keyword">let</span> scanBoxWidth = <span class="hljs-number">800</span>;</li><li><span class="hljs-keyword">let</span> scanBoxHeight = <span class="hljs-number">800</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">scanBox</span>: scanBarcode.<span class="hljs-property">ScanCodeRect</span> = {</li><li>  <span class="hljs-attr">left</span>: (cameraWidth - scanBoxWidth) / <span class="hljs-number">2</span>,</li><li>  <span class="hljs-attr">top</span>: (cameraHeight - scanBoxHeight) / <span class="hljs-number">2</span>,</li><li>  <span class="hljs-attr">right</span>: (cameraWidth + scanBoxWidth) / <span class="hljs-number">2</span>,</li><li>  <span class="hljs-attr">bottom</span>: (cameraHeight + scanBoxHeight) / <span class="hljs-number">2</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 设置ViewControl参数</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>  <span class="hljs-attr">width</span>: cameraWidth,</li><li>  <span class="hljs-attr">height</span>: cameraHeight,</li><li>  <span class="hljs-attr">surfaceId</span>: <span class="hljs-string">'123'</span> <span class="hljs-comment">// mock数据，实际需要从组件生成获取</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">start</span>(viewControl, <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">result</span>: <span class="hljs-title class_">Array</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>&gt;) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-comment">// 扫码识别失败</span></li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; result.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-comment">// 例如：scanCodeRect是{ left: 150px, top: 400px, right: 450px, bottom: 700px }</span></li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">scanCodeRect</span>: scanBarcode.<span class="hljs-property">ScanCodeRect</span> | <span class="hljs-literal">undefined</span> = result[i].<span class="hljs-property">scanCodeRect</span>;</li><li>        <span class="hljs-keyword">if</span> (scanCodeRect) {</li><li>          <span class="hljs-comment">// 判断码图位置是否位于扫码框范围内</span></li><li>          <span class="hljs-keyword">if</span> (scanCodeRect.<span class="hljs-property">left</span> &gt;= scanBox.<span class="hljs-property">left</span> &amp;&amp; scanCodeRect.<span class="hljs-property">top</span> &gt;= scanBox.<span class="hljs-property">top</span> &amp;&amp;</li><li>            scanCodeRect.<span class="hljs-property">right</span> &lt;= scanBox.<span class="hljs-property">right</span> &amp;&amp;</li><li>            scanCodeRect.<span class="hljs-property">bottom</span> &lt;= scanBox.<span class="hljs-property">bottom</span>) {</li><li>            <span class="hljs-comment">// 扫码成功，码图位置位于扫码框范围，根据业务需求处理扫码结果</span></li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// 码图位置不在扫码框范围，继续扫码</span></li><li>            <span class="hljs-keyword">try</span> {</li><li>              customScan.<span class="hljs-title function_">rescan</span>();</li><li>              <span class="hljs-keyword">break</span>;</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to rescan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            }</li><li>          }</li><li>        }</li><li>      }</li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>