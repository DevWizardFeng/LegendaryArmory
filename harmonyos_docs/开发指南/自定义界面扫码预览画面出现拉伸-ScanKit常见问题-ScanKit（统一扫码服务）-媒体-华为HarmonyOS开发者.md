<h1 _ngcontent-vgw-c119="" class="doc-title ng-star-inserted" title="自定义界面扫码预览画面出现拉伸"> 自定义界面扫码预览画面出现拉伸 </h1>

<div _ngcontent-vgw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><strong>问题现象</strong></p>    <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>的宽高比与自定义界面扫码接口中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-customscan-api#section8604949165313" target="_blank">ViewControl</a>的宽高比不一致，导致自定义界面扫码预览画面出现拉伸。</p>    <p><strong>解决措施</strong></p>    <p>ViewControl的宽高比需要与XComponent的宽高比保持一致，会消除画面拉伸现象。当前支持的分辨率比例为16:9、4:3、1:1。</p>    <p>例如：XComponent中width为1080(px)，height为1920(px)，则ViewControl宽度设置为1080，高度设置为1920。</p>    <div _ngcontent-vgw-c106="" class="highlight-div"><div _ngcontent-vgw-c106="" class="highlight-div-header"><div _ngcontent-vgw-c106="" class="highlight-div-header-left"><div _ngcontent-vgw-c106="" class="handle-button expand-button"><div _ngcontent-vgw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vgw-c106="" class="highlight-div-header-right"><div _ngcontent-vgw-c106="" class="handle-button ai-button"></div><div _ngcontent-vgw-c106="" class="handle-button line-button"><div _ngcontent-vgw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vgw-c106="" class="handle-button theme-button"><div _ngcontent-vgw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vgw-c106="" class="handle-button copy-button"><div _ngcontent-vgw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vgw-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：px</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1920</span>;</li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：px</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1080</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'onLoad is called'</span>)</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'viewControl'</span>, <span class="hljs-string">`onLoad surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置viewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">scanResult: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Succeeded in getting ScanResult by promise, scanResult is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(scanResult)}</span>`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Failed to get ScanResult by promise. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span> + <span class="hljs-string">'px'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span> + <span class="hljs-string">'px'</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>