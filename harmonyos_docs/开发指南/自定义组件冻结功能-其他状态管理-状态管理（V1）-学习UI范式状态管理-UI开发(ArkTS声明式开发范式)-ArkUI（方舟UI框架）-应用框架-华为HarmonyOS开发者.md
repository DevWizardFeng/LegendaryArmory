<h1 _ngcontent-lei-c119="" class="doc-title ng-star-inserted" title="自定义组件冻结功能"> 自定义组件冻结功能 </h1>

<div _ngcontent-lei-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>自定义组件冻结功能专为优化复杂UI页面的性能而设计，尤其适用于包含多个页面栈、长列表或宫格布局的场景。当状态变量绑定多个UI组件时，其变化易触发大量组件刷新，导致界面卡顿与响应延迟。为提升这类高负载UI界面的刷新性能，建议开发者使用自定义组件冻结功能。</p>    <p>组件冻结功能是一种性能优化机制，它会冻结非激活状态下的组件的刷新能力。当组件处于非激活状态时，即使其绑定的状态变量发生变化，也不会触发该组件的UI重新渲染，从而降低复杂UI场景下的刷新负载。</p>    <p>在阅读本文档前，开发者需要了解自定义组件基本语法。建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components">自定义组件</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 11开始，支持自定义组件冻结功能。</p>      <p>从API version 18开始，支持自定义组件冻结混用场景。</p>      <p>从API version 20开始，通过配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#inheritfreezeoptions20" target="_blank">inheritFreezeOptions</a>接口为true，实现BuilderNode继承冻结的能力。具体示例见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#inheritfreezeoptions20" target="_blank">BuilderNode对象继承组件冻结</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>组件冻结的工作原理是：</p>     <ol>      <li>开发者通过设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-parameter#componentoptions" target="_blank">freezeWhenInactive</a>属性，即可激活组件冻结机制。</li>      <li>启用后，系统将仅对处于激活状态的自定义组件进行更新，这使得UI框架可以尽量缩小更新范围，仅限于用户可见范围内（激活状态）的自定义组件，从而提高复杂UI场景下的刷新效率。</li>      <li>当之前处于inactive状态的自定义组件重新变为active状态时，状态管理框架会对其执行必要的刷新操作，确保UI的正确展示。</li>     </ol>     <p>简而言之，组件冻结旨在优化复杂界面下的UI刷新性能。在存在多个不可见自定义组件的情况下，如多页面栈、长列表或宫格，通过组件冻结可以实现按需刷新，即仅刷新当前可见的自定义组件，而将不可见自定义组件的刷新延迟至它们变为可见时。</p>     <p>需要注意，组件active/inactive并不等同于其可见性。组件冻结目前仅适用于以下场景：</p>     <ol>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-router" target="_blank">页面路由</a>：当前栈顶页面为active状态，非栈顶不可见页面为inactive状态。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabcontent" target="_blank">TabContent</a>：只有当前显示的TabContent中的自定义组件处于active状态，其余则为inactive。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>：仅当前显示的LazyForEach中的自定义组件为active状态，而缓存节点的组件则为inactive状态。</li>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation" target="_blank">Navigation</a>：当前显示的NavDestination中的自定义组件为active状态，而其他未显示的NavDestination组件则为inactive状态。需要注意，本文档中涉及的“激活（active）/非激活（inactive）”是指组件冻结的激活/非激活状态，和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navdestination" target="_blank">NavDestination</a>组件中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navdestination#onactive17" target="_blank">onActive</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navdestination#oninactive17" target="_blank">onInactive</a>不同。</li>      <li>组件复用：进入复用池的组件为inactive状态，从复用池上树的节点为active状态。</li>      <li>混用场景：对于以上场景的组合使用，例如TabContent下面使用LazyForEach，切换Tab时，API version 17及以下，LazyForEach中的所有节点都会被设置为active状态，而从API version 18开始，只有LazyForEach的屏上节点会被设置为active状态，其余则为inactive状态。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="当前支持的场景">当前支持的场景<i class="anchor-icon anchor-icon-link" anchorid="当前支持的场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="页面路由" class="firsth2">页面路由<i class="anchor-icon anchor-icon-link" anchorid="页面路由" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>本示例使用了router进行页面跳转，建议开发者使用组件导航(Navigation)代替页面路由(router)来实现页面切换。Navigation提供了更多的功能和更灵活的自定义能力。请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-custom-components-freeze#navigation">使用Navigation的组件冻结用例</a>。</p>      </div></div></div>     <p>当页面1调用router.pushUrl接口跳转到页面2时，页面1为隐藏不可见状态，此时如果更新页面1中的状态变量，不会触发页面1刷新。</p>     <p>图示如下：</p>     <p><span><img originheight="351" originwidth="371" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.64720423745060376591832501295621:50001231000000:2800:F837434E166754D613CD9FC77906159461F2339D8846E589A29E165522FF1215.png" width="371" height="351"></span></p>     <p>页面1：</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'first'</span>) <span class="hljs-attr">storageLink</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">47</span>;</li><li>
</li><li>  <span class="hljs-title function_">first</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'first page '</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageLink}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`From first Page <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageLink}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'first page storageLink + 1'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageLink</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'go to next page'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/Page2'</span> });</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>页面2：</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'second'</span>) <span class="hljs-attr">storageLink2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">second</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'second page: '</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageLink2}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`second Page <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageLink2}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'back'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">back</span>();</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'second page storageLink2 + 2'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageLink2</span> += <span class="hljs-number">2</span>;</li><li>        })</li><li>
</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <p>1.在页面1中点击first page storageLink + 1，storageLink状态变量改变，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch">@Watch</a>注册的方法first会被调用。</p>     <p>2.在页面1中点击go to next page，跳转到页面2，页面1隐藏，状态由active变为inactive。</p>     <p>3.在页面2中点击this.storageLink2 += 2，只会回调页面2中@Watch注册的方法second，因为页面1的状态变量此时已被冻结。</p>     <p>4.在页面2中点击back，页面2被销毁，页面1的状态由inactive变为active，重新刷新在inactive时被冻结的状态变量，页面1中@Watch注册的方法first被再次调用。</p>    </div>    <div class="tiledSection">     <h3 id="tabcontent">TabContent<i class="anchor-icon anchor-icon-link" anchorid="tabcontent" tips="复制节点链接"></i></h3>          <p>对Tabs中当前不可见的TabContent进行冻结，修改状态变量不会触发冻结组件的更新。</p>     <p>需要注意的是：在首次渲染的时候，Tabs只会创建当前正在显示的TabContent，当切换全部的TabContent后，TabContent才会被全部创建。</p>     <p>图示如下：</p>     <p><span><img originheight="271" originwidth="451" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.13670855155813792889326138451371:50001231000000:2800:D02360AA41F1BF370ACD0BAF1B0A2AC23DCFD5FB3E27C38036E1EC3CF536EAA0.png" width="451" height="271"></span></p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TabContentTest</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>];</li><li>
</li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`TabContent message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>++;</li><li>        })</li><li>
</li><li>        <span class="hljs-title class_">Tabs</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">TabContent</span>() {</li><li>              <span class="hljs-title class_">FreezeChild</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: item })</li><li>            }.<span class="hljs-title function_">tabBar</span>(<span class="hljs-string">`tab<span class="hljs-subst">${item}</span>`</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>())</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">FreezeChild</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FreezeChild message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>, index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'message'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>, index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <p>1.点击change message更改message的值，当前正在显示的TabContent组件中的@Watch注册的方法onMessageUpdated被触发。</p>     <p>2.点击tab1切换到另外的TabContent，该TabContent的状态由inactive变为active，对应的@Watch注册的方法onMessageUpdated被触发。</p>     <p>3.再次点击change message更改message的值，仅当前显示的TabContent子组件中的@Watch注册的方法onMessageUpdated被触发。</p>     <p><span><img originheight="641" originwidth="1757" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.96999466771382084919650809632447:50001231000000:2800:1F9C32F034BE345AADF0A2632247694A78B20F9BD57D808887B96A0C3A7F646E.gif" width="920" height="335.64029595902105"></span></p>    </div>    <div class="tiledSection">     <h3 id="lazyforeach">LazyForEach<i class="anchor-icon anchor-icon-link" anchorid="lazyforeach" tips="复制节点链接"></i></h3>          <p>对LazyForEach中缓存的自定义组件进行冻结，修改状态变量不会触发缓存组件的更新。</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 用于处理数据监听的IDataSource的基本实现</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LazyforEachTest</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`LazyforEach message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>++;</li><li>      })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">FreezeChild</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: item })</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">500</span>)</li><li>    }</li><li>
</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">FreezeChild</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FreezeChild aboutToAppear index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FreezeChild message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>, index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'message'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>, index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xAFEEEE</span>)</li><li>      .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <p>1.点击change message更改message的值，当前正在显示的ListItem中的子组件@Watch注册的方法onMessageUpdated被触发。缓存节点中@Watch注册的方法不会被触发。（如果不加组件冻结，当前正在显示的ListItem和cachecount缓存节点中@Watch注册的方法onMessageUpdated都会被触发。）</p>     <p>2.List区域外的ListItem滑动到List区域内，状态由inactive变为active，对应的@Watch注册的方法onMessageUpdated被触发。</p>     <p>3.再次点击change message更改message的值，仅有当前显示的ListItem中的子组件@Watch注册的方法onMessageUpdated被触发。</p>     <p><span><img originheight="608" originwidth="1671" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.88038471992092039593712989633333:50001231000000:2800:ECDCCA391F6B6860EF2D16940C01ABD83E7602728ABDD95B319FF60EF41B7691.gif" width="920" height="334.7456612806703"></span></p>    </div>    <div class="tiledSection">     <h3 id="navigation">Navigation<i class="anchor-icon anchor-icon-link" anchorid="navigation" tips="复制节点链接"></i></h3>          <p>当NavDestination不可见时，会将其子自定义组件设置成非激活态，修改状态变量不会触发冻结组件的刷新。当返回该页面时，其子自定义组件重新恢复成激活态，触发@Watch回调进行刷新。</p>     <p>在下面例子中，NavigationContentMsgStack会被设置成非激活态，将不再响应状态变量的变化，也不会触发组件刷新。</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'info'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`freeze-test MyNavigation message callback <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-title class_">PageOneStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title class_">PageTwoStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageThree'</span>) {</li><li>      <span class="hljs-title class_">PageThreeStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">//将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageOneStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'cur stack size:'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.pageInfo.size()}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageTwoStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'cur stack size:'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.pageInfo.size()}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageThree'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageThreeStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'cur stack size:'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.pageInfo.size()}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageOne'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageThree'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">NavigationContentMsgStack</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'info'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`freeze-test NavigationContent message callback <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`freeze-test ---- called by content <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span>++;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'msg:'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'log number:'</span> + <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.logNumber}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <p>1.点击change message更改message的值，当前正在显示的MyNavigationTestStack组件中的@Watch注册的方法info被触发。</p>     <p>2.点击Next Page切换到PageOne，创建PageOneStack节点。</p>     <p>3.再次点击change message更改message的值，仅PageOneStack中的NavigationContentMsgStack子组件中@Watch注册的方法info被触发。</p>     <p>4.再次点击Next Page切换到PageTwo，创建PageTwoStack节点。</p>     <p>5.再次点击change message更改message的值，仅PageTwoStack中的NavigationContentMsgStack子组件中@Watch注册的方法info被触发。</p>     <p>6.再次点击Next Page切换到PageThree，创建PageThreeStack节点。</p>     <p>7.再次点击change message更改message的值，仅PageThreeStack中的NavigationContentMsgStack子组件中@Watch注册的方法info被触发。</p>     <p>8.点击Back Page回到PageTwo，此时，仅PageTwoStack中的NavigationContentMsgStack子组件中@Watch注册的方法info被触发。</p>     <p>9.再次点击Back Page回到PageOne，此时，仅PageOneStack中的NavigationContentMsgStack子组件中@Watch注册的方法info被触发。</p>     <p>10.再次点击Back Page回到初始页，此时，无任何触发。</p>     <p><span><img originheight="461" originwidth="1567" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.40565701003619517112544122378897:50001231000000:2800:7C78862C594A75C212130CA549CDF707FF021C7622DD5EFC084F5776B58C0104.gif" width="920" height="270.6573069559668"></span></p>    </div>    <div class="tiledSection">     <h3 id="组件复用">组件复用<i class="anchor-icon anchor-icon-link" anchorid="组件复用" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable">组件复用</a>通过重利用缓存池中已存在的节点，而非创建新节点，来优化UI性能并提升应用流畅度。复用池中的节点尽管未在UI组件树上展示，但是状态变量的更改仍会触发UI刷新。为了解决复用池中组件异常刷新问题，可以使用组件冻结避免复用池中的组件刷新。</p>     <p><strong>组件复用、if和组件冻结混用场景</strong></p>     <p>下面是组件复用、if组件和组件冻结混合使用场景的例子，if组件绑定的状态变量变化成false时，触发子组件ChildComponent的下树，由于ChildComponent被标记了组件复用，所以不会被销毁，而是进入复用池，这个时候如果同时开启了组件冻结，则可以使在复用池里不再刷新。</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'descChange'</span>) <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">descChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent messageChange <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = params.<span class="hljs-property">count</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent has been recycled`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ChildComponent desc: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ChildComponent count <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change desc`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span> += <span class="hljs-string">'!'</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change flag`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;</li><li>      })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>        <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">desc</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span>, <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ol>      <li>点击change flag，改变flag为false：       <ul>        <li>被标记@Reusable的ChildComponent组件在下树时，不会被销毁，而是进入复用池，触发aboutToRecycle生命周期，同时设置状态为inactive。</li>        <li>ChildComponent同时也开启了组件冻结，当其状态为inactive时，不会响应任何状态变量变化带来的UI刷新。</li>       </ul></li>      <li>点击change desc，触发Page的成员变量desc的变化：       <ul>        <li>desc是@State装饰的，其变化会通知给其子组件ChildComponent<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>装饰的desc。</li>        <li>但因为ChildComponent是inactive状态，且开启了组件冻结，所以这次变化并不会触发@Watch('descChange')的回调和ChildComponentUI刷新。如果没有开启组件冻结，当前@Watch('descChange')会立即回调，且复用池内的ChildComponent组件也会对应刷新。</li>       </ul></li>      <li>再次点击change flag，改变flag为true：       <ul>        <li>ChildComponent从复用池中重新加入到组件树上。</li>        <li>回调aboutToReuse生命周期，将当前最新的count值同步给子组件。desc是通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>到@Link同步的，所以无需开发者手动在aboutToReuse中赋值。</li>        <li>设置ChildComponent为active状态，并且刷新在inactive时没有刷新的组件，在当前例子中，就是Text(ChildComponent desc: ${this.desc})。</li>       </ul></li>     </ol>     <p><strong>LazyForEach、组件复用和组件冻结混用场景</strong></p>     <p>在数据很多的长列表滑动场景下，开发者会使用LazyForEach来按需创建组件，同时配合组件复用降低在滑动过程中因创建和销毁组件带来的开销。但是开发者如果根据其复用类型不同，设置了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-reuse-id#reuseid" target="_blank">reuseId</a>，或者为了保证滑动性能设置了较大的cacheCount，这就可能使复用池或者LazyForEach缓存较多的节点。在这种情况下，如果开发者触发List下所有子节点的刷新，就会带来节点刷新数量过多的问题，这个时候，可以考虑搭配组件冻结使用。</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-comment">// 用于处理数据监听的IDataSource的基本实现</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span>({<span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span>})</li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'descChange'</span>) <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-title function_">descChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent messageChange <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span> = params.<span class="hljs-property">item</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = params.<span class="hljs-property">index</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent has been recycled`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ChildComponent index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span> item: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`desc: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    }.<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>})</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change desc`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'change desc'</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span> += <span class="hljs-string">'!'</span>;</li><li>        hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'change desc'</span>, <span class="hljs-number">1</span>);</li><li>      })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ChildComponent</span>({<span class="hljs-attr">index</span>: index, <span class="hljs-attr">item</span>: item, <span class="hljs-attr">desc</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span>}).<span class="hljs-title function_">reuseId</span>(index % <span class="hljs-number">10</span> &lt; <span class="hljs-number">5</span> ? <span class="hljs-string">'1'</span>: <span class="hljs-string">'0'</span>)</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ol>      <li>滑动到index为14的位置，当前屏幕上可见区域内有15个ChildComponent。</li>      <li>在滑动过程中：       <ul>        <li>列表上端的ChildComponent滑出可视区域外，此时先进入LazyForEach的缓存区域内，被设置inactive。在滑出LazyForEach缓存区域外后，因为标记了组件复用，所以并不会被析构，而是会进入复用池，此时再次被设置inactive。</li>        <li>列表下端LazyForEach的缓存节点会进入List范围内，此时会试图请求创建新的节点进入LazyForEach的缓存，发现有可复用的节点时，从复用池中拿出已有节点，触发aboutToReuse生命周期回调，此时因为节点进入的是LazyForEach的缓存区域，所以其状态依旧是inactive。</li>       </ul></li>      <li>点击change desc，触发Page的成员变量desc的变化：       <ul>        <li>desc是@State装饰的，其变化会通知给其子组件ChildComponent@Link装饰的desc。</li>        <li>非可视区域内的ChildComponent是inactive状态，且开启了组件冻结，所以这次变化只触发可视区域内的15个节点的@Watch('descChange')回调，并只刷新对应可视区域内的15个节点。LazyForEach和复用池中的节点并不会刷新，也不会触发@Watch回调。</li>       </ul></li>     </ol>     <p>图示如下：</p>     <p><span><img originheight="1029" originwidth="1141" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.78748844833896859254170083922364:50001231000000:2800:7B66B10DECF1E9CEB102CCEAB39A3FD4E3F2731774E7EAE407BAF393F0900A33.png" width="920" height="829.6932515337423"></span></p>     <p>可通过trace观察，仅触发了15个ChildComponent节点的刷新。</p>     <p><span><img originheight="614" originwidth="1573" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.42624568385753571091261633642352:50001231000000:2800:FDA1A111C73B182BC50B2ED03090C167DDCDA67B481337268B4EF39C9C614F55.png" width="920" height="359.10998092816277"></span></p>     <p><strong>LazyForEach、if、组件复用和组件冻结混用场景</strong></p>     <p>下面的场景中展示了LazyForEach、if、组件复用和组件冻结混用场景。在同一个父自定义组件下，可复用的节点可能通过不同的方式进入复用池，比如：</p>     <ul>      <li>通过滑动从LazyForEach的缓存区域下树，进入复用池。</li>      <li>if条件切换通知子节点下树，进入复用池。</li>     </ul>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span>({<span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span>})</li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'descChange'</span>) <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-title function_">descChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent messageChange <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span> = params.<span class="hljs-property">item</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = params.<span class="hljs-property">index</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent has been recycled`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ChildComponent index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span> item: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`desc: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    }.<span class="hljs-title function_">border</span>({<span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>})</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change desc`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'change desc'</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span> += <span class="hljs-string">'!'</span>;</li><li>        hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'change desc'</span>, <span class="hljs-number">1</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change flag`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'change flag'</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;</li><li>        hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'change flag'</span>, <span class="hljs-number">1</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ChildComponent</span>({<span class="hljs-attr">index</span>: index, <span class="hljs-attr">item</span>: item, <span class="hljs-attr">desc</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span>}).<span class="hljs-title function_">reuseId</span>(index % <span class="hljs-number">10</span> &lt; <span class="hljs-number">5</span> ? <span class="hljs-string">'1'</span>: <span class="hljs-string">'0'</span>)</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>)</li><li>
</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>        <span class="hljs-title class_">ChildComponent</span>({<span class="hljs-attr">index</span>: -<span class="hljs-number">1</span>, <span class="hljs-attr">item</span>: <span class="hljs-string">'Hello'</span>, <span class="hljs-attr">desc</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span>}).<span class="hljs-title function_">reuseId</span>( <span class="hljs-string">'1'</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ol>      <li>当滑动到index为14的位置，屏幕上可见区域内有10个ChildComponent，9个是LazyForEach的子节点，1个是if的子节点。</li>      <li>点击change flag，if的条件变成false，其子节点ChildComponent进入复用池。当前屏幕显示9个节点。</li>      <li>此时不管是通过LazyForEach还是if下树的节点都会进入Page节点下的复用池。</li>      <li>点击change desc，仅更新屏幕上的9个ChildComponent节点，具体可参考下面的trace。</li>      <li>再次点击change flag，if的条件变成true，ChildComponent从复用池中重新加入到组件树上，其状态变成active。</li>      <li>再次点击change desc，从复用池中通过if和LazyForEach上树的节点都可正常刷新。</li>     </ol>     <p>开启组件冻结trace：</p>     <p><span><img originheight="630" originwidth="1562" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.04011203594944186085896954068948:50001231000000:2800:8CBB18E531459CF45531DF12B3E784C834FBFACC5A1C3B890F231B8288E125FC.png" width="920" height="371.06274007682464"></span></p>     <p>没有开启组件冻结trace：</p>     <p><span><img originheight="788" originwidth="1573" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.69001483258159354311140652237384:50001231000000:2800:45EDD6A53E591720F05BB7141D5F7424597934AF865C80B0F708B04A0CA49AA8.png" width="920" height="460.87730451366815"></span></p>    </div>    <div class="tiledSection">     <h3 id="组件混用">组件混用<i class="anchor-icon anchor-icon-link" anchorid="组件混用" tips="复制节点链接"></i></h3>          <p>当支持组件冻结的场景彼此之间组合使用时，对于不同的API版本，冻结行为会有不同。给父组件设置组件冻结标志，在API version 17及以下，当父组件解冻时，会解冻自己子组件所有的节点；从API version 18开始，父组件解冻时，只会解冻子组件的屏上节点。</p>     <p><strong>Navigation和TabContent的混用</strong></p>     <p>代码示例如下：</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.ets</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildOfParamComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">child_val</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Appmonitor ChildOfParamComponent: child_val changed:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.child_val}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child Param： <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.child_val}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParamComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">paramVal</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Appmonitor ParamComponent: paramVal changed:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.paramVal}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`val： <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.paramVal}</span>`</span>)</li><li>      <span class="hljs-title class_">ChildOfParamComponent</span>({ <span class="hljs-attr">child_val</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">paramVal</span> });</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DelayComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">delayVal</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Appmonitor ParamComponent: delayVal changed:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.delayVal}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Delay Param： <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.delayVal}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">TabsComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TabsController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabsController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">tabState</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">47</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Appmonitor TabsComponent: tabState changed:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.tabState}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Incr state <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.tabState}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Button increment state value'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabState</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabState</span> + <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Tabs</span>({ <span class="hljs-attr">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> }) {</li><li>        <span class="hljs-title class_">TabContent</span>() {</li><li>          <span class="hljs-title class_">ParamComponent</span>({ <span class="hljs-attr">paramVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabState</span> });</li><li>        }.<span class="hljs-title function_">tabBar</span>(<span class="hljs-string">'Update'</span>)</li><li>
</li><li>        <span class="hljs-title class_">TabContent</span>() {</li><li>          <span class="hljs-title class_">DelayComponent</span>({ <span class="hljs-attr">delayVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabState</span> });</li><li>        }.<span class="hljs-title function_">tabBar</span>(<span class="hljs-string">'DelayUpdate'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">vertical</span>(<span class="hljs-literal">false</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">barMode</span>(<span class="hljs-title class_">BarMode</span>.<span class="hljs-property">Fixed</span>)</li><li>      .<span class="hljs-title function_">barWidth</span>(<span class="hljs-number">400</span>)</li><li>      .<span class="hljs-title function_">barHeight</span>(<span class="hljs-number">150</span>)</li><li>      .<span class="hljs-title function_">animationDuration</span>(<span class="hljs-number">400</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xF5F5F5</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-title class_">PageOneStack</span>()</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title class_">PageTwoStack</span>()</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">//将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageOneStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">TabsComponent</span>();</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageTwoStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>代码运行结果图如下：</p>     <p><span><img originheight="357" originwidth="397" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.38283742102866442448255023886509:50001231000000:2800:0E38D4BF7F5457373BA5F318AB8EF51F8C3D3A8FB9A2933E2AD08E22A19AC31E.gif" width="397" height="357"></span></p>     <p>点击Next Page，进入pageOne页面，页面中存在两个tab标签，默认在Update标签，开启组件冻结功能，Tabcontent的标签如果未被选中，状态变量不会刷新，如以下操作。</p>     <p>点击Incr state，日志中查询Appmonitor，存在3个打印。</p>     <p><span><img originheight="91" originwidth="1268" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.41030389630187941040997036001683:50001231000000:2800:EEA19BD33202DBDE8C9005BF1ACDAEBC6AD6BB10F92ED3944749F4C73704B6A4.png" width="920" height="66.02523659305994"></span></p>     <p>切换到DelayUpdate标签，点击Incr state，日志中查询Appmonitor，存在2个打印。DelayUpdate中状态变量不会刷新与Update标签中相关的状态变量。</p>     <p><span><img originheight="91" originwidth="1268" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.12810925661285746557161434547137:50001231000000:2800:E82FD4F428044C35CEEF70A66AC81F045B84395292EB892EF9C5320AEB7FE92A.png" width="920" height="66.02523659305994"></span></p>     <p>在API version 17及以下：</p>     <p>点击Next page进入下一个页面并返回，标签默认在DelayUpdate，再次点击Incr state，日志中查询Appmonitor，存在4个打印，页面路由返回时，会解冻Tabcontent所有的标签。</p>     <p><span><img originheight="90" originwidth="1269" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.17562546395894863573678419659213:50001231000000:2800:E8A37644751B0FAC28D62B84C6EB47FE0E15E66A614103C25E50A090C447E387.png" width="920" height="65.24822695035462"></span></p>     <p>在API version 18及以上：</p>     <p>点击Next page进入下一个页面并返回，标签默认在DelayUpdate，再次点击Incr state，日志中查询Appmonitor，存在2个打印，页面路由返回时，只会解冻对应标签的节点。</p>     <p><span><img originheight="90" originwidth="1270" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.25309970773981593525321205416490:50001231000000:2800:E5C5D6DA65878A1F84E9001B6A71BF263E71B5098C6851C4027EA6466F54FB2F.png" width="920" height="65.19685039370079"></span></p>     <p><strong>页面和LazyForEach</strong></p>     <p>Navigation和TabContent混用时，之所以会解锁TabContent标签的子节点，是因为回到前一个页面时会从父组件开始递归解冻子组件，与此行为类似的还有页面生命周期：OnPageShow。OnPageShow会将当前Page中的根节点设置为active状态，TabContent作为页面的子节点，也会被设置为active状态。在屏幕灭屏和屏幕亮屏时会分别触发页面的生命周期：OnPageHide和OnPageShow，因此页面中使用LazyForEach时，手动灭屏和亮屏也能实现页面路由一样的效果，如以下示例代码：</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-comment">// 用于处理数据监听的IDataSource的基本实现</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span>({<span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span>})</li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'sumChange'</span>) <span class="hljs-attr">sum</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">sumChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`sum: Change <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.sum}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">desc</span> = params.<span class="hljs-property">desc</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span> = params.<span class="hljs-property">sum</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChildComponent has been recycled`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-string">'#ff11acb8'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`子组件: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.desc}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.sum}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">30</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span> ({<span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span>})</li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sum</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">20</span>; index++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(index.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`add sum`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span>++;</li><li>      })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ChildComponent</span>({<span class="hljs-attr">desc</span>: item, <span class="hljs-attr">sum</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sum</span>});</li><li>          }</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在组件复用场景中，已经对LazyForEach的节点进行了详细说明，分为屏上节点和cachedCount节点。</p>     <p><span><img originheight="714" originwidth="331" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.63534040237775105943980146296142:50001231000000:2800:3160D2BB7B831254E57FC007426089770047D6C18916234D5C92516C8C31C7C8.png" width="331" height="714"></span></p>     <p>向下滑动LazyForEach，让cachedCount补充节点，点击add sum，搜索打印日志：sum: Change，出现了8条打印。</p>     <p><span><img originheight="181" originwidth="911" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.36715838061781655279186341744122:50001231000000:2800:7B9EDE3658496A602BC08BAB219D0E777380330E7869771B6B4F1A333FC1162E.png" width="911" height="181"></span></p>     <p>在API version 17及以下：</p>     <p>灭屏之后亮屏，触发OnPageShow，点击add sum，打印数量为屏上节点与cachedCount数量的总和。</p>     <p><span><img originheight="419" originwidth="909" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.93529892535402926186793333414784:50001231000000:2800:B17DD44B9631E78E8A7D890408BACC89FA659F8725F77507B887E12EC6DE3A20.png" width="909" height="419"></span></p>     <p>从API version 18开始：</p>     <p>灭屏之后亮屏，触发OnPageShow，点击add sum，只会打印屏上节点数量，不会再解冻cachedCount中的节点。</p>     <p><span><img originheight="232" originwidth="910" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.67234047199523324635085968611644:50001231000000:2800:6806A935A356982FF631225D1D1022525E4B2CF9BE9EE7C4E90226EC232C443E.png" width="910" height="232"></span></p>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="buildernode无法继承父组件冻结" class="firsth2">BuilderNode无法继承父组件冻结<i class="anchor-icon anchor-icon-link" anchorid="buildernode无法继承父组件冻结" tips="复制节点链接"></i></h3>          <p>在API version 20之前，BuilderNode无法继承父组件冻结。如下面的例子所示，FreezeBuildNode中使用了自定义节点<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>。BuilderNode可以通过命令式动态挂载组件，而组件冻结又是强依赖父子关系来通知是否开启组件冻结。如果父组件使用组件冻结，且组件树的中间层级上又启用了BuilderNode，则BuilderNode的子组件将无法被冻结。</p>     <p>在API version 20及以后，开发者可以通过配置BuilderNode的inheritFreezeOptions接口为true，实现BuilderNode继承冻结的能力。具体示例见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#inheritfreezeoptions20" target="_blank">BuilderNode对象继承组件冻结</a>。</p>     <div _ngcontent-lei-c106="" class="highlight-div"><div _ngcontent-lei-c106="" class="highlight-div-header"><div _ngcontent-lei-c106="" class="highlight-div-header-left"><div _ngcontent-lei-c106="" class="handle-button expand-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lei-c106="" class="highlight-div-header-right"><div _ngcontent-lei-c106="" class="handle-button ai-button"></div><div _ngcontent-lei-c106="" class="handle-button line-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lei-c106="" class="handle-button theme-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lei-c106="" class="handle-button copy-button"><div _ngcontent-lei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lei-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 定义一个Params类，用于传递参数</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = index;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 定义一个BuildNodeChild组件，它包含一个message属性和一个index属性</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">BuildNodeChild</span> {</li><li>  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'buildNodeTest'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello world'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-comment">// 当message更新时，调用此方法</span></li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FreezeBuildNode builderNodeChild message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>,index：<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`buildNode Child message: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 定义一个buildText函数，它接收一个Params参数并构建一个Column组件</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">BuildNodeChild</span>({ <span class="hljs-attr">index</span>: params.<span class="hljs-property">index</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 定义一个TextNodeController类，继承自NodeController</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-comment">// 构造函数接收一个index参数</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = index;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建并返回一个FrameNode</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>));</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 定义一个Index组件，它包含一个message属性和一个data数组</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'buildNodeTest'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'a'</span>;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Tabs</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">TabContent</span>() {</li><li>              <span class="hljs-title class_">FreezeBuildNode</span>({ <span class="hljs-attr">index</span>: item })</li><li>            }.<span class="hljs-title function_">tabBar</span>(<span class="hljs-string">`tab<span class="hljs-subst">${item}</span>`</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>())</li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 定义一个FreezeBuildNode组件，它包含一个message属性和一个index属性</span></li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">FreezeBuildNode</span> {</li><li>  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'buildNodeTest'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onMessageUpdated'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'1111'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-comment">// 当message更新时，调用此方法</span></li><li>  <span class="hljs-title function_">onMessageUpdated</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FreezeBuildNode message callback func <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>, index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>))</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <p>点击change，改变message的值，当前正在显示的TabContent组件中@Watch注册的方法onMessageUpdated被触发。未显示的TabContent中的BuilderNode节点下组件的@Watch方法onMessageUpdated也被触发，并没有被冻结。</p>     <p><span><img originheight="656" originwidth="1791" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115002.28006036257629690011191319363097:50001231000000:2800:04277A6E7C757DA216D6611EDBD688F226FB17A383508123CCF1B4EB78A9676F.gif" width="920" height="336.9737576772753"></span></p>    </div>   </div>   <div></div></div>