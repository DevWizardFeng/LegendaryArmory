<h1 _ngcontent-ogi-c119="" class="doc-title ng-star-inserted" title="自定义组件混用场景指导"> 自定义组件混用场景指导 </h1>

<div _ngcontent-ogi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>状态管理V1（简称V1）为开发者提供了一系列状态变量装饰器（后续称V1的装饰器），例如：@State、@Prop、@Link等，可以在@Component装饰的自定义组件中使用（后续称V1的自定义组件）。</p>    <p>然而V1对于嵌套类的观测存在诸多限制。例如：需要开发者通过@ObjectLink不断拆解嵌套类才能使得深层次数据具备观测能力。</p>    <p>为此，在API version 12中为开发者提供了一套全新的状态管理V2（简称V2），开发者可以声明@ComponentV2装饰的自定义组件（后续称V2的自定义组件）并搭配一套全新的装饰器去使用（后续称V2的装饰器）。例如：@Local、@Param等。</p>    <p>V2的提出不仅解决了V1对嵌套类观测的不足，还增强了部分装饰器的功能。例如：V2的@Monitor不仅能够感知变化后的数据，还能获取变化前的数据。</p>    <p>在设计上，我们希望V1和V2的代码是完全隔离的，因为V1能实现的功能，V2能做得更好。但从实际角度出发，V1的开发者已经有很大的基础，让开发者一次性迁移成V2也不符合实际，因此在V1的代码中使用V2的部分能力是允许的，V2中也没有完全禁止V1，这样就涉及到V1和V2的一个混用问题，例如：V1的自定义组件使用了V2的自定义组件或V1去使用V2的装饰器等。</p>    <p>本指南详细阐述了V1与V2混用的场景，旨在帮助开发者将V1代码迁移到V2。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>状态管理V2从API version 12开始支持。</p>      <p>该文档介绍的混用规则仅适用于API version 18及以前。从API version 19开始，为支持应用更便捷地从V1向V2迁移，状态管理提供了新的接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#enablev2compatibility19" target="_blank">enableV2Compatibility</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>来帮助开发者解决在V1向V2迁移过程中遇到的混用问题，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage">状态管理V1V2混用文档</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>状态管理V1与V2的混用规则如下：</p>     <ul>      <li>       <p>V1的自定义组件中不可以使用V2的装饰器，否则编译报错。</p></li>      <li>       <p>当组件间不传递变量时，V1的自定义组件中可以使用V2的自定义组件，包括导入第三方的@ComponentV2装饰的自定义组件。</p></li>      <li>       <p>组件间存在变量传递时，V1的变量传递给V2的自定义组件，有以下限制：</p>       <ul>        <li>V1中未被装饰器装饰的变量（后称普通变量）：V2只能使用@Param接收。</li>        <li>V1中被装饰器装饰的变量（后称状态变量）：V2只能通过@Param装饰器接收，且仅限于boolean、number、enum、string、undefined、null这些简单类型数据。</li>       </ul></li>      <li>       <p>V2的自定义组件中不可以使用V1的装饰器，否则编译报错。</p></li>      <li>       <p>组件间不存在变量传递时，V2自定义组件可以使用V1的自定义组件，包括import第三方@Component装饰的自定义组件。</p></li>      <li>       <p>组件间存在变量传递时，V2的变量传递给V1的自定义组件，有以下限制：</p>       <ul>        <li>         <p>V2普通变量（未使用状态变量装饰器）传递给V1自定义组件：</p>         <p>如果V1使用状态变量接收该数据，只能使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide</a>这三种V1的状态变量装饰器。</p></li>        <li>         <p>V2状态变量（使用状态变量装饰器）传递给V1自定义组件：</p>         <p>如果V1使用状态变量装饰器（同样仅限@State、@Prop、@Provide支持）装饰接收的数据，不支持内置类型数据：Array、Set、Map、Date。需要注意V2状态变量支持Function类型，但是V1的状态变量装饰器均不支持Function类型，传递Function类型会导致运行时校验。以@State为例，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state#限制条件">@State限制条件</a>。</p></li>        <li>V1中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>遵循其原本初始化规则，只能被V1状态变量初始化，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link#变量的传递访问规则说明">@Link初始化规则</a>。</li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="状态管理装饰器总览">状态管理装饰器总览<i class="anchor-icon anchor-icon-link" anchorid="状态管理装饰器总览" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="状态管理v1的装饰器" class="firsth2">状态管理V1的装饰器<i class="anchor-icon anchor-icon-link" anchorid="状态管理v1的装饰器" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.1" valign="top" width="50%">装饰器类别</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.2" valign="top" width="50%">装饰器</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">组件内装饰器</td>         <td class="cellrowborder" valign="top" width="50%">@State、@Prop、@Link、@ObjectLink、@Provide、@Consume、@StorageProp、@StorageLink、@LocalStorageProp、@LocalStorageLink、@Watch</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">类相关装饰器</td>         <td class="cellrowborder" valign="top" width="50%">@Observed、@Track</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="状态管理v2的装饰器">状态管理V2的装饰器<i class="anchor-icon anchor-icon-link" anchorid="状态管理v2的装饰器" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.3.1.1" valign="top" width="50%">装饰器类别</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.3.1.2" valign="top" width="50%">装饰器</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">组件内装饰器</td>         <td class="cellrowborder" valign="top" width="50%">@Local、@Param、@Provider、@Consumer、@Once、@Event、@Monitor、@Computed</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">类相关装饰器</td>         <td class="cellrowborder" valign="top" width="50%">@ObservedV2、@Trace、@Type</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="状态管理装饰器支持的数据类型总览">状态管理装饰器支持的数据类型总览<i class="anchor-icon anchor-icon-link" anchorid="状态管理装饰器支持的数据类型总览" tips="复制节点链接"></i></h3>          <p>状态管理能够支持的数据类型有：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.3.1.1" valign="top" width="50%">数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.3.1.2" valign="top" width="50%">关键字</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">简单类型数据</td>         <td class="cellrowborder" valign="top" width="50%">boolean、number、enum、string、null、undefined</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">function类型</td>         <td class="cellrowborder" valign="top" width="50%">function(仅V2的@Event、@Monitor、@Computed支持)</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Object类型</td>         <td class="cellrowborder" valign="top" width="50%">Object</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Class类型</td>         <td class="cellrowborder" valign="top" width="50%">Class</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">内置类型</td>         <td class="cellrowborder" valign="top" width="50%">Array、Map、Set、Date</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="v1和v2的装饰器不允许混用" class="firsth2">V1和V2的装饰器不允许混用<i class="anchor-icon anchor-icon-link" anchorid="v1和v2的装饰器不允许混用" tips="复制节点链接"></i></h3>          <p><strong>1.V1的自定义组件中不可以使用V2的装饰器</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @Param不可以在@Component中使用，编译报错</span></li><li>  <span class="hljs-comment">// @Once @Require都是@Param的能力扩展装饰器，必须和@Param一起连用</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeMessage</span>: <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// @Event 不可以在@Component中使用，编译报错</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeMessage</span>(<span class="hljs-string">'world hello'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>; <span class="hljs-comment">// @Local不可以在 @Component中使用，编译报错</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">changeMessage</span>: <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = val;</li><li>        }</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2的组件内装饰器不支持在V1的自定义组件中使用，编译会报错。</p>     <p>@Local、@Param、@Event、@Provider、@Consumer、@Monitor、@Computed和示例代码中的装饰器表现一致。</p>     <p><strong>2.V2的自定义组件中不可以使用V1的装饰器</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;      <span class="hljs-comment">// @Prop不可以在@ComponentV2中使用，编译报错</span></li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;           <span class="hljs-comment">// @Link不可以在@ComponentV2中使用，编译报错</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.myId}</span>`</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;      <span class="hljs-comment">// @State不可以在@ComponentV2中使用，编译报错</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'idChange'</span>) <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;  <span class="hljs-comment">// @Watch不可以在@ComponentV2中使用，编译报错</span></li><li>
</li><li>  <span class="hljs-title function_">idChange</span>(<span class="hljs-attr">propName</span>: <span class="hljs-built_in">number</span>) : <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`id changed <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.myId}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">myId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V1的组件内装饰器不支持在V2的自定义组件中使用，编译会报错。</p>     <p>@ObjectLink、@Provide、@Consume、@StorageProp、@StorageLink、@LocalStorageProp、@LocalStorageLink和示例的装饰器表现一致。</p>    </div>    <div class="tiledSection">     <h3 id="多个装饰器不允许装饰同一个变量watchoncerequire除外">多个装饰器不允许装饰同一个变量（@Watch、@Once、@Require除外）<i class="anchor-icon anchor-icon-link" anchorid="多个装饰器不允许装饰同一个变量watchoncerequire除外" tips="复制节点链接"></i></h3>          <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;    <span class="hljs-comment">// 多个V1的装饰器不可以修饰同一个变量，编译器报错</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>; <span class="hljs-comment">// 多个V2的装饰器不允许修饰同一个变量，编译器报错</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>除了@Watch、@Once、@Require这些能力扩展装饰器可以与其他装饰器配合使用外，其他装饰器不允许装饰同一个变量。</p>    </div>    <div class="tiledSection">     <h2 id="混用场景介绍">混用场景介绍<i class="anchor-icon anchor-icon-link" anchorid="混用场景介绍" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="v1和v2类相关装饰器混用" class="firsth2">V1和V2类相关装饰器混用<i class="anchor-icon anchor-icon-link" anchorid="v1和v2类相关装饰器混用" tips="复制节点链接"></i></h3>          <p><strong>1.V1的自定义组件中使用被@ObservedV2装饰的类对象</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;           <span class="hljs-comment">// 有观测能力</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;                   <span class="hljs-comment">// 无观测能力</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">trackId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;     <span class="hljs-comment">// @Track作为V1的装饰器，不能在@ObservedV2中使用，编译时报错；消除编译错误请去掉@Track</span></li><li>  </li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = id || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Info</span> {    <span class="hljs-comment">// 继承自@ObservedV2装饰的类不可以被Observed装饰，编译时报错；消除编译错误请去掉@Observed</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Info</span> {</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info1</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();                      <span class="hljs-comment">// @ObservedV2装饰的Class可以在V1中使用，且被@Trace装饰的类属性具有观测能力</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info2</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();               <span class="hljs-comment">// @ObservedV2装饰的Class不可以被V1的装饰器装饰，否则编译器报错；消除编译错误请去掉@State</span></li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfo</span>();  <span class="hljs-comment">// 继承自@ObservedV2的Class不可以被V1装饰器装饰，运行时报错；消除错误请去掉@State</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1 name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.name}</span>`</span>)            <span class="hljs-comment">// name未被@Trace装饰，无法观察变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'b'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1 id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.myId}</span>`</span>)              <span class="hljs-comment">// myId被@Trace装饰，可观察变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info2 id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.myId}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info2</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfo id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfo.myId}</span>`</span>) <span class="hljs-comment">// 继承自@ObservedV2的Class被V1的装饰器装饰时会出现crash，运行时出错，需要去掉装饰器@State</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@ObservedV2的使用需要遵循如下规则：</p>     <ul>      <li>@ObservedV2只能装饰Class，@Trace、@Type只能装饰类属性，且只能在@ObservedV2中使用。</li>      <li>@Track不可以在@ObservedV2中使用。</li>      <li>对于被@ObservedV2装饰的Class，不可以直接被V1的装饰器装饰，否则编译时报错。</li>      <li>示例中，开发者去掉报错的装饰器即可正常运行，被@Trace装饰的类属性变化时可以观察到变化，否则不可以观测到变化。</li>     </ul>     <p><strong>2.V2的自定义组件中使用被@Observed装饰的类对象</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;             <span class="hljs-comment">// 无观测能力，只能防止因其他属性改变而导致的连带刷新</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;                     <span class="hljs-comment">// 无观测能力</span></li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">trackId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;       <span class="hljs-comment">// @Trace作为V2的装饰器，不能在@Observed中使用，编译时报错；消除编译错误请去掉@Trace</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = id || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Info</span> {      <span class="hljs-comment">// @ObservedV2装饰的Class不能继承@Observed，编译时报错；消除编译错误请去掉@ObservedV2</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Info</span> {</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info1</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();             <span class="hljs-comment">// @Observed装饰的Class可以在V2中使用</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info2</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();      <span class="hljs-comment">// @Observe装饰的Class不可以被V2的装饰器装饰，否则编译器报错；消除编译错误请去掉@Local</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfo</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1 name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'b'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1 id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.myId}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info2 id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.myId}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info2</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-comment">// 继承自@ObservedV2的Class被V2装饰器装饰，V2的装饰器无类属性观测能力，所以不建议在V2中使用@Observed装饰的Class</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfo id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfo.myId}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">myId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>不建议开发者在V2中使用@Observed装饰的Class，因为@Observed和@Track仅能对类属性做区分，无观测能力，使用@Observed和@ObjectLink拆分嵌套数据才能够观测深层次数据，但@ObjectLink无法在V2的自定义组件中使用。</p>     <p>开发者在将V1的代码向V2迁移时，不建议在@ComponentV2中使用@Observed装饰的Class（在V2中无观测能力）。如果一定要使用，则遵循以下规则：</p>     <ul>      <li>@Observed只能装饰Class，且@Trace不可以在@Observed中使用。</li>      <li>@Observed和@Track无任何观测能力，只能用于防止Class中一个类属性改变而导致整个Class的刷新。</li>      <li>继承自@Observed的Class被V2装饰器装饰，V2的组件内装饰器无类属性观测能力，所以使用@Observed会无法观测到类属性变化。</li>      <li>示例中，开发者去掉报错的装饰器即可正常运行，由于无观测能力，所以不建议V2中使用@Observed。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="不存在变量传递时v1和v2的自定义组件混用">不存在变量传递时，V1和V2的自定义组件混用<i class="anchor-icon anchor-icon-link" anchorid="不存在变量传递时v1和v2的自定义组件混用" tips="复制节点链接"></i></h3>          <p><strong>1.V1中使用V2的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在V1中使用V2的自定义组件时，如果不存在变量传递，则不会产生影响。若涉及变量传递，请参见下一节<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage">状态管理V1V2混用文档</a>。</p>     <p><strong>2.V2中使用V1的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在V2中使用V1的自定义组件时，如果不存在变量传递，则不会产生影响。如果涉及变量传递，请参见下一节<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage">状态管理V1V2混用文档</a>。</p>    </div>    <div class="tiledSection">     <h3 id="存在变量传递时v1和v2的自定义组件数据混用">存在变量传递时，V1和V2的自定义组件数据混用<i class="anchor-icon anchor-icon-link" anchorid="存在变量传递时v1和v2的自定义组件数据混用" tips="复制节点链接"></i></h3>          <p><strong>1.V1-&gt;V2：V1的普通变量传递给V2的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// V2对数据输入有严格的管理，从父组件接受数据时，必须@Param装饰器进行数据接收</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;                  <span class="hljs-comment">// 可以观测到变化，同步回父组件依赖@Event，使用了@Once可以修改@Param装饰的变量</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">undefinedVal</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;  <span class="hljs-comment">// 使用了@Once可以修改@Param装饰的变量</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();                         <span class="hljs-comment">// 观测不到类属性变化</span></li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>) <span class="hljs-comment">// 显示 string</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`undefinedVal:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.undefinedVal}</span>`</span>) <span class="hljs-comment">// 显示 undefinedVal</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span> = <span class="hljs-string">"change to define"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info id:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.myId}</span>`</span>) <span class="hljs-comment">// 显示 info:myId</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span>.<span class="hljs-title function_">values</span>()), <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {  <span class="hljs-comment">// 显示 Set</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;       <span class="hljs-comment">// 简单数据</span></li><li>  <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;    <span class="hljs-comment">// 简单类型，undefined</span></li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();               <span class="hljs-comment">// Class类型</span></li><li>  <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]);  <span class="hljs-comment">// 内置 类型</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">undefinedVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span>,</li><li>        <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>,</li><li>        <span class="hljs-attr">set</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>当V1的普通变量传递给V2的自定义组件时，有如下限制：</p>     <ul>      <li>V2的自定义组件必须通过@Param接收数据。</li>      <li>接收数据的观测能力为@Param能力，对于接收的Class，需要通过@ObservedV2和@Trace才能观察变化。</li>     </ul>     <p><strong>2.V1-&gt;V2：V1的状态变量传递给V2的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// V2对数据输入有严格的管理，从父组件接受数据时，必须@Param装饰器进行数据接收</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">undefinedVal</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;  <span class="hljs-comment">// 使用了@Once可以修改@Param装饰的变量</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>) <span class="hljs-comment">// 显示string</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`undefinedVal:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.undefinedVal}</span>`</span>) <span class="hljs-comment">// 显示undefinedVal</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span> = <span class="hljs-string">"change to define"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info id:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.myId}</span>`</span>) <span class="hljs-comment">// 显示info:myId</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span>.<span class="hljs-title function_">values</span>()), <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {  <span class="hljs-comment">// 显示Set</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;       <span class="hljs-comment">// 简单类型数据，支持</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;    <span class="hljs-comment">// 简单类型数据，undefined，支持</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();               <span class="hljs-comment">// Class类型，不支持传递，编译器报错；消除编译错误请去掉@State</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]);  <span class="hljs-comment">// 内置类型，不支持传递，编译器报错；消除编译错误请去掉@State</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">undefinedVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span>,</li><li>        <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>,</li><li>        <span class="hljs-attr">set</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>当V1的状态变量传递给V2的自定义组件时，遵循如下规则：</p>     <ul>      <li>       <p>仅支持简单类型变量，其余类型数据会在编译时报错。</p></li>      <li>       <p>示例中使用了@State装饰器，@Prop、@Link、@ObjectLink、@Provide、@Consume、@StorageProp、@StorageLink、@LocalStorageProp、@LocalStorageLink行为和@State保持一致。</p></li>     </ul>     <p><strong>3.V2-&gt;V1：V2的普通变量传递给V1的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// V1从V2接收的状态变量，若使用装饰器，仅可使用@State、@Prop、@Provide接收</span></li><li>  <span class="hljs-meta">@State</span>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;             <span class="hljs-comment">// 可以观测到变化</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();                  <span class="hljs-comment">// 可以观测一层类属性变化</span></li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> | <span class="hljs-built_in">string</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">setMap</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)     <span class="hljs-comment">// 显示string</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`undefinedVal:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.undefinedVal}</span>`</span>)     <span class="hljs-comment">// 显示undefinedVal</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span> = <span class="hljs-string">"change to define"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info id:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.myId}</span>`</span>)             <span class="hljs-comment">// 显示info:myId</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">setMap</span>.<span class="hljs-title function_">values</span>()), <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {  <span class="hljs-comment">// 显示 Set</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;       <span class="hljs-comment">// 简单数据类型</span></li><li>  <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;    <span class="hljs-comment">// 简单数据类型，undefined</span></li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();               <span class="hljs-comment">// Class类型</span></li><li>  <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]);  <span class="hljs-comment">// 内置 类型</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">undefinedVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span>,</li><li>        <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>,</li><li>        <span class="hljs-attr">setMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>当V2的普通变量传递给V1自定义组件时：</p>     <ul>      <li>       <p>V1可以不使用装饰器接收数据，接收的变量在V1自定义组件内是普通变量。</p></li>      <li>       <p>V1使用装饰器接收数据时，仅可通过@State、@Prop、@Provide接收。</p></li>     </ul>     <p><strong>4.V2-&gt;V1：V2的状态变量传递给V1的自定义组件</strong></p>     <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// V1从V2接收的状态变量，仅可使用@State、@Prop、@Provide接收</span></li><li>  <span class="hljs-meta">@State</span>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;            <span class="hljs-comment">// 可以观测到变化</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();                <span class="hljs-comment">// 可以观测一层类属性变化</span></li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> | <span class="hljs-built_in">string</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)     <span class="hljs-comment">// 显示 string</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`undefinedVal:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.undefinedVal}</span>`</span>)     <span class="hljs-comment">// 显示 undefinedVal</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span> = <span class="hljs-string">"change to define"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info id:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.myId}</span>`</span>)     <span class="hljs-comment">// 显示 info:myId</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span>.<span class="hljs-title function_">values</span>()), <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {  <span class="hljs-comment">// 显示 Set</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;           <span class="hljs-comment">// 简单数据类型，支持传递</span></li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">undefinedVal</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;   <span class="hljs-comment">// 简单数据类型，undefined，支持传递</span></li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();              <span class="hljs-comment">// Class类型，支持传递</span></li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]);      <span class="hljs-comment">// 内置类型，不支持传递；消除编译错误请去掉@Param</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`message:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'world hello'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>        <span class="hljs-attr">undefinedVal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">undefinedVal</span>,</li><li>        <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>,</li><li>        <span class="hljs-attr">set</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">set</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>V2的状态变量传递给V1的自定义组件，存在以下限制：</p>     <ul>      <li>V1可以不使用装饰器接收数据，接收过来的变量在V1组定义组件内也会是普通变量。</li>      <li>V1使用装饰器接收数据时，仅可通过@State、@Prop、@Provide接收。</li>      <li>V1使用装饰器接收数据时，不支持内置类型的数据。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="混用场景总结">混用场景总结<i class="anchor-icon anchor-icon-link" anchorid="混用场景总结" tips="复制节点链接"></i></h3>          <p>对V1和V2混用场景进行梳理后，可以总结出：</p>     <ol>      <li>       <p>当V2的代码混用V1的代码时（即V1的组件或者类数据向V2传递），大部分V1的能力在V2都是被禁止的。</p></li>      <li>       <p>当V1的代码混用V2的代码时（即V2的组件或者类数据向V1传递），做了部分功能开放。例如：@ObservedV2和@Trace，这也是对V1嵌套类数据的观测能提供的最大的帮助。</p></li>     </ol>     <p>所以在代码开发时，不鼓励开发者使用V1和V2进行混用开发，但是对于代码迁移上，可以让V1的开发者逐步将代码向V2进行迁移，从而稳步替换V1的功能代码，并且十分不鼓励开发者在V2的代码架构上混用V1的代码。</p>    </div>    <div class="tiledSection">     <h2 id="补充场景">补充场景<i class="anchor-icon anchor-icon-link" anchorid="补充场景" tips="复制节点链接"></i></h2>          <p>@Observed和@ObservedV2由于装饰Class类型，而Class可以进行多层级的嵌套，因此场景相对复杂，本节主要是对Class类型的自嵌套和内置类型的嵌套作一个详细的场景说明。由于@Observed并没有@ObservedV2+@Trace那样强大的深层次观测能力，不再对@Observed的深层次嵌套进行讨论，只讨论@ObservedV2在V1的使用场景。</p>    </div>    <div class="tiledSection">     <h3 id="使用observedobjectlink观测嵌套类" class="firsth2">使用@Observed+@ObjectLink观测嵌套类<i class="anchor-icon anchor-icon-link" anchorid="使用observedobjectlink观测嵌套类" tips="复制节点链接"></i></h3>          <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfo</span> {         <span class="hljs-comment">// 一层嵌套</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span>;        <span class="hljs-comment">// 防止messageId改变导致info的连带刷新</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">messageId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 防止messageId改变导致info的连带刷新</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info?: Info, messageId?: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span> = messageId || <span class="hljs-number">0</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfoNested</span> {     <span class="hljs-comment">// 二层嵌套</span></li><li>  <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">messageInfo?: MessageInfo</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span> = messageInfo || <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfo</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GrandSon</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ObjectLink info info.myId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.myId}</span>`</span>)  <span class="hljs-comment">// 经过@ObjectLink拆解两次之后，观测到变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ObjectLink MessageInfo messageId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfo.messageId}</span>`</span>)  <span class="hljs-comment">// 经过@ObjectLink拆解之后，可以观测一层类属性变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">messageId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ObjectLink MessageInfo info.myId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfo.info.myId}</span>`</span>)  <span class="hljs-comment">// 经过@ObjectLink拆解之后，依旧观测不到变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">GrandSon</span>({<span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">info</span>});                <span class="hljs-comment">// 继续拆解一层子组件</span></li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">messageInfoNested</span>: <span class="hljs-title class_">MessageInfoNested</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfoNested</span>();  <span class="hljs-comment">// 三层嵌套的数据，需要对所有数据进行观测。</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 观察messageInfoNested</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfoNested messageId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfoNested.messageInfo.messageId}</span>`</span>)  <span class="hljs-comment">// @State只有一层类属性观测能力，无法观察到变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">messageId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-comment">// 通过@ObjectLink嵌套观察 messageInfoId</span></li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">messageInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>})      <span class="hljs-comment">// 经过拆分后，使用@ObjectLink拆分可以观察到深一层的变化</span></li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上面的示例是三层嵌套的场景，表明：</p>     <ul>      <li>       <p>V1装饰器的观测能力是对数据本身做代理，因此当数据存在嵌套时，V1只能通过@Observed+@ObjectLink的方式拆分子组件，观测深层次数据。</p></li>      <li>       <p>@Track防止MessageInfo类中的info被messageId改变而连带刷新，开发者去掉@Track可观测到，当messageId改变时，info的连带刷新，但是这并不是@ObjectLink的观测能力。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="使用obsevedv2trace观测嵌套类">使用@ObsevedV2+@Trace观测嵌套类<i class="anchor-icon anchor-icon-link" anchorid="使用obsevedv2trace观测嵌套类" tips="复制节点链接"></i></h3>          <div _ngcontent-ogi-c106="" class="highlight-div"><div _ngcontent-ogi-c106="" class="highlight-div-header"><div _ngcontent-ogi-c106="" class="highlight-div-header-left"><div _ngcontent-ogi-c106="" class="handle-button expand-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ogi-c106="" class="highlight-div-header-right"><div _ngcontent-ogi-c106="" class="handle-button ai-button"></div><div _ngcontent-ogi-c106="" class="handle-button line-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ogi-c106="" class="handle-button theme-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ogi-c106="" class="handle-button copy-button"><div _ngcontent-ogi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ogi-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">myId</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">myId?: <span class="hljs-built_in">number</span>, name?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myId</span> = myId || <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name || <span class="hljs-string">'aaa'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfo</span> { <span class="hljs-comment">// 一层嵌套</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span>;        <span class="hljs-comment">// 防止messageId改变导致info的连带刷新</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">messageId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 防止messageId改变导致info的连带刷新</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info?: Info, messageId?: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info || <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();   <span class="hljs-comment">// 使用传入的info或创建一个新的Info</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageId</span> = messageId || <span class="hljs-number">0</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageInfoNested</span> { <span class="hljs-comment">// 二层嵌套，MessageInfoNested如果是被@ObservedV2装饰，则不可以被V1的状态变量更新相关的装饰器装饰，如@State</span></li><li>  <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">messageInfo?: MessageInfo</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span> = messageInfo || <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfo</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">messageInfo</span>: <span class="hljs-title class_">MessageInfo</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ObjectLink MessageInfo messageId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfo.messageId}</span>`</span>)  <span class="hljs-comment">// 经过@ObjectLink拆解之后，可以观测一层类属性变化</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">messageId</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">messageInfoNested</span>: <span class="hljs-title class_">MessageInfoNested</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageInfoNested</span>();  <span class="hljs-comment">// 三层嵌套的数据，如何观测内部。</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 观察messageInfoNested，@State只有一层观测能力，无法观察到变化</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfoNested messageId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfoNested.messageInfo.messageId}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">messageId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfoNested name:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfoNested.messageInfo.info.name}</span>`</span>)   <span class="hljs-comment">// 未被@Trace修饰，无法观测</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'a'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`messageInfoNested myId:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.messageInfoNested.messageInfo.info.myId}</span>`</span>)   <span class="hljs-comment">// 被@Trace修饰，无论嵌套多少层都能观测</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>.<span class="hljs-property">info</span>.<span class="hljs-property">myId</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>        .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>      <span class="hljs-comment">// 通过@ObjectLink嵌套观察 messageInfoId</span></li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">messageInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageInfoNested</span>.<span class="hljs-property">messageInfo</span>})      <span class="hljs-comment">// 经过拆分后，使用@ObjectLink拆分可以观察到深一层的变化</span></li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>当使用@ObservedV2+@Trace时可以发现：</p>     <ul>      <li>@ObservedV2+@Trace将观测能力实现在类属性上，所以当类属性被@Trace标记时，无论嵌套多少层都可以观测到变化。</li>      <li>@ObservedV2和@Observed嵌套使用时，类对象能否被V1的装饰器装饰取决于最外层Class使用的装饰器。例如示例中嵌套在深处的@ObservedV2装饰的Class不影响最外层的Class被V1的装饰器装饰。</li>     </ul>    </div>   </div>   <div></div></div>