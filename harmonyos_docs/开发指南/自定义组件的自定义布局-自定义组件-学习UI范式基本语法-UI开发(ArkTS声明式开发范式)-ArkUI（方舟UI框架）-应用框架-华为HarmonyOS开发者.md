<h1 _ngcontent-bfs-c119="" class="doc-title ng-star-inserted" title="自定义组件的自定义布局"> 自定义组件的自定义布局 </h1>

<div _ngcontent-bfs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>如果系统提供的布局组件（如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-flex" target="_blank">Flex</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-column" target="_blank">Column</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-row" target="_blank">Row</a>等）无法满足复杂布局需求，或开发者希望自定义计算组件内子组件的大小和位置，建议在自定义组件中使用以下接口：</p>    <ul>     <li>      <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-layout#onmeasuresize10" target="_blank">onMeasureSize</a>：组件每次布局时触发，开发者可以在这个回调中增加自定义组件内子组件的大小的计算逻辑，返回自定义组件的尺寸信息，其执行时间先于onPlaceChildren。</p></li>     <li>      <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-layout#onplacechildren10" target="_blank">onPlaceChildren</a>：组件每次布局时触发，开发者可以在这个回调中增加放置自定义组件内子组件位置的逻辑。</p></li>    </ul>    <p>以下示例中，Index页面包含一个实现了自定义布局的自定义组件，且对应自定义组件的子组件通过index页面内的builder方式传入。</p>    <p>而在自定义组件中，调用了onMeasureSize和onPlaceChildren设置子组件大小和放置位置。例如，在本示例中，在onMeasureSize中初始化组件大小size=100，后续的每一个子组件size会加上上一个子组件大小的一半，实现组件大小递增的效果。而在onPlaceChildren中，定义startPos=300，设置每一个子组件的位置为startPos减去子组件自身的高度，所有子组件右下角一致在顶点位置(300, 300)，实现一个从右下角开始展示组件的类Stack组件。</p>    <p><strong>示例：</strong></p>    <div _ngcontent-bfs-c106="" class="highlight-div"><div _ngcontent-bfs-c106="" class="highlight-div-header"><div _ngcontent-bfs-c106="" class="highlight-div-header-left"><div _ngcontent-bfs-c106="" class="handle-button expand-button"><div _ngcontent-bfs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bfs-c106="" class="highlight-div-header-right"><div _ngcontent-bfs-c106="" class="handle-button ai-button"></div><div _ngcontent-bfs-c106="" class="handle-button line-button"><div _ngcontent-bfs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bfs-c106="" class="handle-button theme-button"><div _ngcontent-bfs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bfs-c106="" class="handle-button copy-button"><div _ngcontent-bfs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bfs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">CustomLayout</span>({ <span class="hljs-variable">builder</span>: <span class="hljs-title class_">ColumnChildren</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 通过builder的方式传递多个组件，作为自定义组件的一级子组件（即不包含容器组件，如Column）</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">ColumnChildren</span>() {</li><li>  <span class="hljs-title function_">ForEach</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], (<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; { <span class="hljs-comment">// 暂不支持lazyForEach的写法</span></li><li>    <span class="hljs-title function_">Text</span>(<span class="hljs-string">'S'</span> + <span class="hljs-variable">index</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">offset</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">20</span> })</li><li>  })</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomLayout</span> {</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">doNothingBuilder</span>() {</li><li>  };</li><li>
</li><li>  @<span class="hljs-title function_">BuilderParam</span> <span class="hljs-variable">builder</span>: () =&gt; <span class="hljs-variable">void</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">doNothingBuilder</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">startSize</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">100</span>;</li><li>  <span class="hljs-variable">result</span>: <span class="hljs-title class_">SizeResult</span> = {</li><li>    <span class="hljs-variable">width</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">height</span>: <span class="hljs-number">0</span></li><li>  };</li><li>
</li><li>  <span class="hljs-comment">// 第一步：计算各子组件的大小</span></li><li>  <span class="hljs-title function_">onMeasureSize</span>(<span class="hljs-variable">selfLayoutInfo</span>: <span class="hljs-title class_">GeometryInfo</span>, <span class="hljs-variable">children</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Measurable</span>&gt;, <span class="hljs-variable">constraint</span>: <span class="hljs-title class_">ConstraintSizeOptions</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">size</span> = <span class="hljs-number">100</span>;</li><li>    <span class="hljs-variable">children</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">child</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">result</span>: <span class="hljs-title class_">MeasureResult</span> = <span class="hljs-variable">child</span>.<span class="hljs-title function_">measure</span>({ <span class="hljs-variable">minHeight</span>: <span class="hljs-title class_">size</span>, <span class="hljs-variable">minWidth</span>: <span class="hljs-title class_">size</span>, <span class="hljs-variable">maxWidth</span>: <span class="hljs-title class_">size</span>, <span class="hljs-variable">maxHeight</span>: <span class="hljs-title class_">size</span> })</li><li>      <span class="hljs-variable">size</span> += <span class="hljs-variable">result</span>.<span class="hljs-variable">width</span> / <span class="hljs-number">2</span>;</li><li>    })</li><li>    <span class="hljs-comment">// this.result在该用例中代表自定义组件本身的大小，onMeasureSize方法返回的是组件自身的尺寸。</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">result</span>.<span class="hljs-variable">width</span> = <span class="hljs-number">100</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">result</span>.<span class="hljs-variable">height</span> = <span class="hljs-number">400</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">result</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 第二步：放置各子组件的位置</span></li><li>  <span class="hljs-title function_">onPlaceChildren</span>(<span class="hljs-variable">selfLayoutInfo</span>: <span class="hljs-title class_">GeometryInfo</span>, <span class="hljs-variable">children</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Layoutable</span>&gt;, <span class="hljs-variable">constraint</span>: <span class="hljs-title class_">ConstraintSizeOptions</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">startPos</span> = <span class="hljs-number">300</span>;</li><li>    <span class="hljs-variable">children</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">child</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">pos</span> = <span class="hljs-variable">startPos</span> - <span class="hljs-variable">child</span>.<span class="hljs-variable">measureResult</span>.<span class="hljs-variable">height</span>;</li><li>      <span class="hljs-variable">child</span>.<span class="hljs-title function_">layout</span>({ <span class="hljs-variable">x</span>: <span class="hljs-title class_">pos</span>, <span class="hljs-variable">y</span>: <span class="hljs-title class_">pos</span> })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">builder</span>()</li><li>  }</li><li>}</li></ol></pre></div></div>    <p><span><img originheight="401" originwidth="418" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114922.96571564559721771708813974799690:50001231000000:2800:341BB8A2C1A12F14BE903238F673D03AA43668EB0C079F20496A94C7DD8DFC0A.png" width="418" height="401"></span></p>   </div>   <div></div></div>