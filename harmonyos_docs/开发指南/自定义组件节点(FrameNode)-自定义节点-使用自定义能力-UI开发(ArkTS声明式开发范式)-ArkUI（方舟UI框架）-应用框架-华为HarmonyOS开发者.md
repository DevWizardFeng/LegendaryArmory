<h1 _ngcontent-qmm-c119="" class="doc-title ng-star-inserted" title="自定义组件节点 (FrameNode)"> 自定义组件节点 (FrameNode) </h1>

<div _ngcontent-qmm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>对于拥有自定义前端的第三方框架（如JSON、XML、DOM树等），需将特定的DSL转换为ArkUI的声明式描述。如下图描述了JSON定义的前端框架和ArkUI声明式描述的对应关系。</p>     <p><span><img originheight="329" originwidth="707" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114926.09910333824062752282475073395060:50001231000000:2800:6B2E198731D30103231AFA12F83C81641B9A59410EB73EEB1F8FAF91BB5017D7.png" width="707" height="329"></span></p>     <p>上述转换过程需要依赖额外的数据驱动，绑定至<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder">Builder</a>中，较为复杂且性能欠佳。这类框架通常依赖于ArkUI的布局、事件处理、基础的节点操作和自定义能力。大部分组件通过自定义实现，但需结合使用部分系统组件以实现混合显示，如下图示例既使用了FrameNode的自定义方法进行绘制，又使用了系统组件Column及其子组件Text，通过BuilderNode的方式将其挂载到根节点的FrameNode上混合显示。</p>     <p><span><img originheight="1057" originwidth="1256" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114926.60511376672514993956061051167328:50001231000000:2800:43D710BE935F271D25F4272068F9412EEBBBC88ACD1A51AE05E04A8678F1C358.png" width="920" height="774.2356687898089"></span></p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode" target="_blank">FrameNode</a>的设计初衷正是为了解决上述转换问题。FrameNode表示组件树中的实体节点，与自定义占位容器组件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer" target="_blank">NodeContainer</a>相配合，实现在占位容器内构建一棵自定义的节点树。该节点树支持动态操作，如节点的增加、修改和删除。基础的FrameNode具备设置通用属性和事件回调的功能，同时提供完整的自定义能力，涵盖自定义测量、布局和绘制等方面。</p>     <p>除此之外，ArkUI还提供了获取和遍历系统组件对应代理FrameNode对象的能力（下文简称代理节点）。代理节点能够用于遍历整个UI的树形结构，支持获取系统组件节点的详细信息，以及额外注册组件的事件监听回调。</p>    </div>    <div class="tiledSection">     <h2 id="创建和删除节点">创建和删除节点<i class="anchor-icon anchor-icon-link" anchorid="创建和删除节点" tips="复制节点链接"></i></h2>          <p>FrameNode提供了节点创建和删除的能力。可以通过FrameNode的构造函数创建自定义FrameNode节点，通过构造函数创建的节点对应一个实体的节点。同时，可以通过FrameNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#dispose12" target="_blank">dispose</a>接口来实现与实体节点的绑定关系的解除。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>在创建FrameNode对象的时候需要传入必选参数UIContext，若未传入UIContext对象或者传入不合法，则节点创建抛出异常。</p></li>        <li>         <p>自定义占位组件将节点进行显示的时候需要保证UI上下文一致，否则会出现显示异常。</p></li>        <li>         <p>若不持有FrameNode对象，则该对象会在GC的时候被回收。</p></li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="判断节点是否可修改">判断节点是否可修改<i class="anchor-icon anchor-icon-link" anchorid="判断节点是否可修改" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#ismodifiable12" target="_blank">isModifiable</a>用于查询当前节点类型是否为系统组件的代理节点。当FrameNode节点作为系统组件的代理节点的时候，该节点不可修改。即无法修改代理节点的自身属性以及其子节点的结构。</p>    </div>    <div class="tiledSection">     <h2 id="获取对应的rendernode节点">获取对应的RenderNode节点<i class="anchor-icon anchor-icon-link" anchorid="获取对应的rendernode节点" tips="复制节点链接"></i></h2>          <p>FrameNode提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getrendernode" target="_blank">getRenderNode</a>接口，用于获取FrameNode中的RenderNode。可以通过对获取到的RenderNode对象进行操作，动态修改FrameNode上绘制相关的属性，具体可修改的属性参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode" target="_blank">RenderNode</a>的接口。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>无法获取系统组件代理FrameNode的RenderNode对象。</p></li>        <li>         <p>BuilderNode中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#getframenode" target="_blank">getFrameNode</a>获取得到的FrameNode节点对象中，可以通过getRenderNode获取对应的根节点的RenderNode对象。</p></li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="操作节点树">操作节点树<i class="anchor-icon anchor-icon-link" anchorid="操作节点树" tips="复制节点链接"></i></h2>          <p>FrameNode提供了节点的增、删、查、改的能力，能够修改非代理节点的子树结构。可以对所有FrameNode的节点的父子节点做出查询操作，并返回查询结果。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>对节点进行增、删、改操作的时候，会对非法操作抛出异常信息。</p>       <p>通过查询获得的系统组件的代理节点，仅具备查询节点信息的作用，不具备修改节点属性的功能。代理节点不持有组件的实体节点，即不影响对应的节点的生命周期。</p>       <p>查询节点仅查询获得UI相关的节点，不返回语法节点。</p>       <p>使用自定义组件的场景下，可能查询获得自定义组件的新增节点，节点类型为“__Common__”。</p>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode"</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buttonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>    <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>
</li><li>    <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">buttonNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">childList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">FrameNode</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">FrameNode</span>&gt;();</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(buttonBuilder);</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-property">commonAttribute</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"50%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>.<span class="hljs-property">commonAttribute</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt;(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"This is a Button"</span> })</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span>.<span class="hljs-title function_">getFrameNode</span>())</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">operationFrameNodeWithFrameNode</span>(<span class="hljs-params">frameNode: FrameNode | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (frameNode) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" get ArkTSNode success."</span>)</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" check rootNode whether is modifiable "</span> + frameNode.<span class="hljs-title function_">isModifiable</span>());</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>) {</li><li>      <span class="hljs-keyword">let</span> frameNode1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>);</li><li>      <span class="hljs-keyword">let</span> frameNode2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>);</li><li>      frameNode1.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">60</span> })</li><li>      frameNode2.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">120</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">60</span> })</li><li>      <span class="hljs-keyword">try</span> {</li><li>        frameNode?.<span class="hljs-title function_">appendChild</span>(frameNode1);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" appendChild success "</span>);</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" appendChild fail :"</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">" : "</span> +</li><li>        (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>      }</li><li>      <span class="hljs-keyword">try</span> {</li><li>        frameNode?.<span class="hljs-title function_">insertChildAfter</span>(frameNode2, <span class="hljs-literal">null</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" insertChildAfter success "</span>);</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" insertChildAfter fail : "</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">" : "</span> +</li><li>        (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>      }</li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          frameNode?.<span class="hljs-title function_">removeChild</span>(frameNode?.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">0</span>))</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" removeChild success "</span>);</li><li>        } <span class="hljs-keyword">catch</span> (err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" removeChild fail : "</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">" : "</span> +</li><li>          (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>        }</li><li>      }, <span class="hljs-number">2000</span>)</li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          frameNode?.<span class="hljs-title function_">clearChildren</span>();</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" clearChildren success "</span>);</li><li>        } <span class="hljs-keyword">catch</span> (err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" clearChildren fail : "</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">" : "</span> +</li><li>          (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>        }</li><li>      }, <span class="hljs-number">4000</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">testInterfaceAboutSearch</span>(<span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-keyword">if</span> (frameNode) {</li><li>      result = result + <span class="hljs-string">`current node is <span class="hljs-subst">${frameNode.getNodeType()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`parent node is <span class="hljs-subst">${frameNode.getParent()?.getNodeType()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`child count is <span class="hljs-subst">${frameNode.getChildrenCount()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`first child node is <span class="hljs-subst">${frameNode.getFirstChild()?.getNodeType()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`second child node is <span class="hljs-subst">${frameNode.getChild(<span class="hljs-number">1</span>)?.getNodeType()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`previousSibling node is <span class="hljs-subst">${frameNode.getPreviousSibling()?.getNodeType()}</span> \n`</span>;</li><li>      result = result + <span class="hljs-string">`nextSibling node is <span class="hljs-subst">${frameNode.getNextSibling()?.getNodeType()}</span> \n`</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">checkAppendChild</span>(<span class="hljs-params">parent: FrameNode | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>, child: FrameNode | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">if</span> (parent &amp;&amp; child) {</li><li>        parent.<span class="hljs-title function_">appendChild</span>(child);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" appendChild success "</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" appendChild fail : "</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">" : "</span> +</li><li>      (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"验证FrameNode子节点的增、删、改功能"</span>)</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对自定义FrameNode进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对FrameNode节点进行增、删、改操作，正常实现。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">operationFrameNodeWithFrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>);</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对BuilderNode中的代理节点进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对BuilderNode代理节点进行增、删、改操作，捕获异常信息。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">operationFrameNodeWithFrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>());</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对系统组件中的代理节点进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对代理节点进行增、删、改操作，捕获异常信息。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">operationFrameNodeWithFrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>());</li><li>              })</li><li>          }</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"验证FrameNode添加子节点的特殊场景"</span>)</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"新增BuilderNode的代理节点"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">let</span> buttonNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>                buttonNode.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buttonBuilder), { <span class="hljs-attr">text</span>: <span class="hljs-string">"BUTTON"</span> })</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">checkAppendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>, buttonNode?.<span class="hljs-title function_">getFrameNode</span>());</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"新增系统组件代理节点"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">checkAppendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>,</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>());</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"新增已有父节点的自定义节点"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">checkAppendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>,</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>);</li><li>              })</li><li>          }</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"验证FrameNode节点的查询功能"</span>)</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对自定义FrameNode进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对FrameNode节点进行进行查询。当前节点为NodeContainer的子节点。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">testInterfaceAboutSearch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>);</li><li>                <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-comment">// 对FrameNode节点进行进行查询。rootNode下的第一个子节点。</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">testInterfaceAboutSearch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>);</li><li>                }, <span class="hljs-number">2000</span>)</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对BuilderNode中的代理节点进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对BuilderNode代理节点进行进行查询。当前节点为BuilderNode中的Column节点。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> =</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">testInterfaceAboutSearch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>());</li><li>              })</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"对系统组件中的代理节点进行操作"</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 对代理节点进行查询。当前节点为NodeContainer。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> =</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">testInterfaceAboutSearch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>());</li><li>              })</li><li>          }</li><li>        }</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">"50%"</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Result：\n<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.result}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"This is a NodeContainer."</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">400</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用moveto移动命令式节点">使用moveTo移动命令式节点<i class="anchor-icon anchor-icon-link" anchorid="使用moveto移动命令式节点" tips="复制节点链接"></i></h2>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#moveto18" target="_blank">moveTo</a>接口可以将FrameNode节点移动到新的父节点下，从而按需改变节点树结构。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当前FrameNode如果不可修改，抛出异常信息。</p>       <p>目标父节点为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#typenode12" target="_blank">typeNode</a>时会校验子组件类型或个数，不满足抛出异常信息，限制情况请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#typenode12" target="_blank">typeNode</a>描述。</p>       <p>当前不支持对无组件类型的命令式节点进行移动。</p>       <p>当前仅支持以下类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#typedframenode12" target="_blank">TypedFrameNode</a>进行移动操作：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#stack12" target="_blank">Stack</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#xcomponent12" target="_blank">XComponent</a>。对于其他类型的节点，移动操作不会生效。</p>       <p>当前仅支持根节点为以下类型组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildernode-1" target="_blank">BuilderNode</a>进行移动操作：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-stack" target="_blank">Stack</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component" target="_blank">EmbeddedComponent</a>。对于其他类型的组件，移动操作不会生效。</p>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span>, typeNode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">rowNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">stackNode1</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">stackNode2</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">stackNode3</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>
</li><li>    <span class="hljs-keyword">const</span> row = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">'Row'</span>);</li><li>    row.<span class="hljs-title function_">initialize</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rowNode</span> = row;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rowNode</span>);</li><li>
</li><li>    <span class="hljs-keyword">const</span> stack1 = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">'Stack'</span>);</li><li>    stack1.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode1</span> = stack1;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rowNode</span>?.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode1</span>);</li><li>    <span class="hljs-keyword">const</span> stack2 = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">'Stack'</span>);</li><li>    stack2.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode2</span> = stack2;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rowNode</span>?.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode2</span>);</li><li>    <span class="hljs-keyword">const</span> stack3 = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">'Stack'</span>);</li><li>    stack3.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode3</span> = stack3;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rowNode</span>?.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stackNode3</span>);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController1</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController2</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>()</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController1</span>)</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController2</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"move"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController1</span>.<span class="hljs-property">stackNode1</span>?.<span class="hljs-title function_">moveTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController2</span>.<span class="hljs-property">rowNode</span>, <span class="hljs-number">2</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="200" originwidth="369" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114927.47753790372429897021053721006014:50001231000000:2800:5D976F164DA5E8A2F000700364CA77EDD5EC25133E769969551E3E3250189C96.gif" width="369" height="200"></span></p>    </div>    <div class="tiledSection">     <h2 id="设置节点通用属性和事件回调">设置节点通用属性和事件回调<i class="anchor-icon anchor-icon-link" anchorid="设置节点通用属性和事件回调" tips="复制节点链接"></i></h2>          <p>FrameNode提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#commonattribute12" target="_blank">commonAttribute</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#commonevent12" target="_blank">commonEvent</a>两个对象用于设置节点的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-component-general-attributes" target="_blank">通用属性</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-uicommonevent" target="_blank">设置事件回调</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>由于代理节点的属性不可修改，因此通过代理节点的commonAttribute修改节点的基础属性不生效。</p></li>        <li>         <p>设置的基础事件与系统组件定义的事件平行，参与事件竞争。设置的基础事件不覆盖系统组件事件。同时设置两个事件回调的时候，优先回调系统组件事件。</p></li>       </ul>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buttonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Button <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(event)}</span>`</span>);</li><li>    })</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">buttonNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(buttonBuilder);</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-comment">// 对rootNode进行属性修改，该节点为自定义的FrameNode节点，修改生效</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-property">commonAttribute</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-comment">// 对frameNode进行属性修改，该节点为自定义的FrameNode节点，修改生效</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>.<span class="hljs-property">commonAttribute</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"50%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt;(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"This is a Button"</span> })</li><li>      <span class="hljs-comment">// 对BuilderNode中获取的FrameNode进行属性修改，该节点非自定义的FrameNode节点，修改不生效</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>()?.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> })</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonNode</span>.<span class="hljs-title function_">getFrameNode</span>())</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">modifyNode</span>(<span class="hljs-params">frameNode: FrameNode | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>, sizeValue: SizeOptions, positionValue: Position</span>) {</li><li>    <span class="hljs-keyword">if</span> (frameNode) {</li><li>      frameNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">size</span>(sizeValue).<span class="hljs-title function_">position</span>(positionValue);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">addClickEvent</span>(<span class="hljs-params">frameNode: FrameNode | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (frameNode) {</li><li>      frameNode.<span class="hljs-property">commonEvent</span>.<span class="hljs-title function_">setOnClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`FrameNode <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(event)}</span>`</span>);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"修改节点通用属性-宽高"</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"modify ArkTS-FrameNode"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 获取到的是当前页面中的开发者创建的FrameNode对象，该节点可修改。即节点大小与位置。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span></li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">modifyNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>, { <span class="hljs-attr">width</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> }, {</li><li>              <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,</li><li>              <span class="hljs-attr">y</span>: <span class="hljs-number">0</span></li><li>            })</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"modify FrameNode get by BuilderNode"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 获取到的是当前页面中的BuilderNode的根节点，该节点不可修改。即节点大小与位置未发生改变。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> +</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>()</li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">modifyNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>(), {</li><li>              <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,</li><li>              <span class="hljs-attr">height</span>: <span class="hljs-number">100</span></li><li>            }, { <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">50</span> })</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"modify proxyFrameNode get by search"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// rootNode调用getParent()获取到的是当前页面中的NodeContainer节点，该节点不可修改。即节点大小与位置未发生改变。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>()</li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">modifyNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>(), {</li><li>              <span class="hljs-attr">width</span>: <span class="hljs-number">500</span>,</li><li>              <span class="hljs-attr">height</span>: <span class="hljs-number">500</span></li><li>            }, {</li><li>              <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>              <span class="hljs-attr">y</span>: <span class="hljs-number">0</span></li><li>            })</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">padding</span>({</li><li>        <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"修改节点点击事件"</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"add click event to ArkTS-FrameNode"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 获取到的是当前页面中的开发者创建的FrameNode对象，该节点可增加点击事件。</span></li><li>            <span class="hljs-comment">// 增加的点击事件参与事件竞争，即点击事件会在该节点被消费且不不再向父组件冒泡。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>()</li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">addClickEvent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">frameNode</span>)</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"add click event to FrameNode get by BuilderNode"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 获取到的是当前页面中的BuilderNode的根节点，该类节点可增加点击事件。</span></li><li>            <span class="hljs-comment">// 点击的时候优先回调通过系统组件接口设置的click事件回调，然后回调通过commonEvent增加的click监听。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> +</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>()</li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">addClickEvent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">buttonNode</span>?.<span class="hljs-title function_">getFrameNode</span>())</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"add click event to proxyFrameNode get by search"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// rootNode调用getParent()获取到的是当前页面中的NodeContainer节点，该类节点可增加点击事件。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Check the weather the node can be modified "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>()</li><li>            ?.<span class="hljs-title function_">isModifiable</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">addClickEvent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getParent</span>());</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">padding</span>({</li><li>        <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>        <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`NodeContainer <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(event)}</span>`</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="自定义测量布局与绘制">自定义测量布局与绘制<i class="anchor-icon anchor-icon-link" anchorid="自定义测量布局与绘制" tips="复制节点链接"></i></h2>          <p>通过重写<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#ondraw12" target="_blank">onDraw</a>方法，可以自定义FrameNode的绘制内容。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#invalidate12" target="_blank">invalidate</a>接口可以主动触发节点的重新绘制。</p>     <p>通过重写<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#onmeasure12" target="_blank">onMeasure</a>可以自定义FrameNode的测量方式，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#measure12" target="_blank">measure</a>可以主动传递布局约束触发重新测量。</p>     <p>通过重写<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#onlayout12" target="_blank">onLayout</a>方法可以自定义FrameNode的布局方式，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#layout12" target="_blank">layout</a>方法可以主动传递位置信息并触发重新布局。</p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#setneedslayout12" target="_blank">setNeedsLayout</a>可以将当前节点标记，在下一帧触发重新布局。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>对节点进行dispose解引用后，由于FrameNode对象不再对应一个实体节点，invalidate无法触发原有绑定节点的刷新。</p></li>        <li>         <p>通过onDraw方法进行的自定义绘制，绘制内容大小无法超出组件大小。</p></li>       </ul>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DrawContext</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">Position</span>, <span class="hljs-title class_">Size</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">LayoutConstraint</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { drawing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">GetChildLayoutConstraint</span>(<span class="hljs-params">constraint: LayoutConstraint, child: FrameNode</span>): <span class="hljs-title class_">LayoutConstraint</span> {</li><li>  <span class="hljs-keyword">const</span> size = child.<span class="hljs-title function_">getUserConfigSize</span>();</li><li>  <span class="hljs-keyword">const</span> width = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(</li><li>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(constraint.<span class="hljs-property">maxSize</span>.<span class="hljs-property">width</span>, size.<span class="hljs-property">width</span>.<span class="hljs-property">value</span>),</li><li>    constraint.<span class="hljs-property">minSize</span>.<span class="hljs-property">width</span></li><li>  );</li><li>  <span class="hljs-keyword">const</span> height = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(</li><li>    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(constraint.<span class="hljs-property">maxSize</span>.<span class="hljs-property">height</span>, size.<span class="hljs-property">height</span>.<span class="hljs-property">value</span>),</li><li>    constraint.<span class="hljs-property">minSize</span>.<span class="hljs-property">height</span></li><li>  );</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">finalSize</span>: <span class="hljs-title class_">Size</span> = { width, height };</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">LayoutConstraint</span> = {</li><li>    <span class="hljs-attr">maxSize</span>: finalSize,</li><li>    <span class="hljs-attr">minSize</span>: finalSize,</li><li>    <span class="hljs-attr">percentReference</span>: finalSize</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">return</span> res;</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFrameNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FrameNode</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">100</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">space</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">uiContext: UIContext</span>) {</li><li>    <span class="hljs-variable language_">super</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMeasure</span>(<span class="hljs-attr">constraint</span>: <span class="hljs-title class_">LayoutConstraint</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">sizeRes</span>: <span class="hljs-title class_">Size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(<span class="hljs-number">100</span>), <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(<span class="hljs-number">100</span>) };</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getChildrenCount</span>(); i++) {</li><li>      <span class="hljs-keyword">let</span> child = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getChild</span>(i);</li><li>      <span class="hljs-keyword">if</span> (child) {</li><li>        <span class="hljs-keyword">let</span> childConstraint = <span class="hljs-title class_">GetChildLayoutConstraint</span>(constraint, child);</li><li>        child.<span class="hljs-title function_">measure</span>(childConstraint);</li><li>        <span class="hljs-keyword">let</span> size = child.<span class="hljs-title function_">getMeasuredSize</span>();</li><li>        sizeRes.<span class="hljs-property">height</span> += size.<span class="hljs-property">height</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">space</span>;</li><li>        sizeRes.<span class="hljs-property">width</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(sizeRes.<span class="hljs-property">width</span>, size.<span class="hljs-property">width</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setMeasuredSize</span>(sizeRes);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onLayout</span>(<span class="hljs-attr">position</span>: <span class="hljs-title class_">Position</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getChildrenCount</span>(); i++) {</li><li>      <span class="hljs-keyword">let</span> child = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getChild</span>(i);</li><li>      <span class="hljs-keyword">if</span> (child) {</li><li>        child.<span class="hljs-title function_">layout</span>({</li><li>          <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(<span class="hljs-number">100</span>),</li><li>          <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">vp2px</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span>)</li><li>        });</li><li>        <span class="hljs-keyword">let</span> layoutPosition = child.<span class="hljs-title function_">getLayoutPosition</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"child position:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(layoutPosition));</li><li>      }</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setLayoutPosition</span>(position);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDraw</span>(<span class="hljs-params">context: DrawContext</span>) {</li><li>    <span class="hljs-keyword">const</span> canvas = context.<span class="hljs-property">canvas</span>;</li><li>    <span class="hljs-keyword">const</span> pen = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Pen</span>();</li><li>    pen.<span class="hljs-title function_">setStrokeWidth</span>(<span class="hljs-number">15</span>);</li><li>    pen.<span class="hljs-title function_">setColor</span>({</li><li>      <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">red</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">blue</span>: <span class="hljs-number">0</span></li><li>    });</li><li>    canvas.<span class="hljs-title function_">attachPen</span>(pen);</li><li>    canvas.<span class="hljs-title function_">drawRect</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> + <span class="hljs-number">50</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> + <span class="hljs-number">50</span>,</li><li>    });</li><li>    canvas.<span class="hljs-title function_">detachPen</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">addWidth</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> + <span class="hljs-number">10</span>) % <span class="hljs-number">50</span> + <span class="hljs-number">100</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">MyFrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFrameNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-property">commonAttribute</span>?.<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> }).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(frameNode);</li><li>    frameNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Invalidate'</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">addWidth</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">invalidate</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'UpdateLayout'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-property">rootNode</span>;</li><li>            node!.<span class="hljs-property">offsetY</span> = (node!.<span class="hljs-property">offsetY</span> + <span class="hljs-number">10</span>) % <span class="hljs-number">110</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>?.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">setNeedsLayout</span>();</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查找节点及获取基础信息">查找节点及获取基础信息<i class="anchor-icon anchor-icon-link" anchorid="查找节点及获取基础信息" tips="复制节点链接"></i></h2>          <p>FrameNode提供了查询接口用于返回实体节点的基础信息。具体返回的信息内容参考FrameNode中提供的接口。</p>     <p>查找获得FrameNode的方式包括三种：</p>     <ol>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getframenodebyid12" target="_blank">getFrameNodeById</a>获取。</p></li>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getframenodebyuniqueid12" target="_blank">getFrameNodeByUniqueId</a>获取。</p></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-observer" target="_blank">无感监听</a>获取。</p></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>1、当前接口提供的可查询的信息包括：</p>       <ul>        <li>         <p>节点大小：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getmeasuredsize12" target="_blank">getMeasuredSize</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigsize12" target="_blank">getUserConfigSize</a></p></li>        <li>         <p>布局信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontowindow12" target="_blank">getPositionToWindow</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparent12" target="_blank">getPositionToParent</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getlayoutposition12" target="_blank">getLayoutPosition</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigborderwidth12" target="_blank">getUserConfigBorderWidth</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigpadding12" target="_blank">getUserConfigPadding</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigmargin12" target="_blank">getUserConfigMargin</a></p></li>        <li>         <p>节点信息：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getid12" target="_blank">getId</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuniqueid12" target="_blank">getUniqueId</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getnodetype12" target="_blank">getNodeType</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getopacity12" target="_blank">getOpacity</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#isvisible12" target="_blank">isVisible</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#iscliptoframe12" target="_blank">isClipToFrame</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#isattached12" target="_blank">isAttached</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getinspectorinfo12" target="_blank">getInspectorInfo</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getcustomproperty12" target="_blank">getCustomProperty</a></p></li>       </ul>       <p>2、无法获取UINode类型节点，例如：JsView节点、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan" target="_blank">ContainerSpan</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-contentslot" target="_blank">ContentSlot</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-foreach" target="_blank">ForEach</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>、if/else组件等。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="获取节点位置偏移信息">获取节点位置偏移信息<i class="anchor-icon anchor-icon-link" anchorid="获取节点位置偏移信息" tips="复制节点链接"></i></h2>          <p>FrameNode提供了查询节点相对窗口、父组件以及屏幕位置偏移的信息接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontowindow12" target="_blank">getPositionToWindow</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparent12" target="_blank">getPositionToParent</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoscreen12" target="_blank">getPositionToScreen</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getglobalpositionondisplay20" target="_blank">getGlobalPositionOnDisplay</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontowindowwithtransform12" target="_blank">getPositionToWindowWithTransform</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparentwithtransform12" target="_blank">getPositionToParentWithTransform</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoscreenwithtransform12" target="_blank">getPositionToScreenWithTransform</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getlayoutposition12" target="_blank">getLayoutPosition</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigborderwidth12" target="_blank">getUserConfigBorderWidth</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigpadding12" target="_blank">getUserConfigPadding</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuserconfigmargin12" target="_blank">getUserConfigMargin</a>）。</p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontowindow12" target="_blank">getPositionToWindow</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparent12" target="_blank">getPositionToParent</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoscreen12" target="_blank">getPositionToScreen</a>三个接口获取到的位置信息关系如下图所示：</p>     <p><span><img originheight="872" originwidth="731" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114927.80261909193760028020180345681589:50001231000000:2800:84DD1481FA715B0AE59B03F9DB992D128BAD06E27214B62202DB66813D943CEA.png" width="731" height="872"></span></p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode"</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToWindow</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToWindow = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToWindow</span>(); <span class="hljs-comment">// 获取FrameNode相对于窗口的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToWindow)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToParent</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToParent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToParent</span>(); <span class="hljs-comment">// 获取FrameNode相对于父组件的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToParent)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToScreen</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToScreen = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToScreen</span>(); <span class="hljs-comment">// 获取FrameNode相对于屏幕的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToScreen)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getGlobalPositionOnDisplay</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionOnGlobalDisplay = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getGlobalPositionOnDisplay</span>(); <span class="hljs-comment">// 获取FrameNode相对于全局屏幕的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionOnGlobalDisplay)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToWindowWithTransform</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToWindowWithTransform =</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToWindowWithTransform</span>(); <span class="hljs-comment">// 获取FrameNode相对于窗口带有绘制属性的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToWindowWithTransform)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToParentWithTransform</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToParentWithTransform =</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToParentWithTransform</span>(); <span class="hljs-comment">// 获取FrameNode相对于父组件带有绘制属性的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToParentWithTransform)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getPositionToScreenWithTransform</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> positionToScreenWithTransform =</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">getPositionToScreenWithTransform</span>(); <span class="hljs-comment">// 获取FrameNode相对于屏幕带有绘制属性的位置偏移</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(positionToScreenWithTransform)}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToWindow"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToWindow</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToParent"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToParent</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToScreen"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToScreen</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getGlobalPositionOnDisplay"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getGlobalPositionOnDisplay</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToParentWithTransform"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToParentWithTransform</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToWindowWithTransform"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToWindowWithTransform</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getPositionToScreenWithTransform"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getPositionToScreenWithTransform</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"This is a NodeContainer."</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过typenode创建具体类型的framenode节点">通过typeNode创建具体类型的FrameNode节点<i class="anchor-icon anchor-icon-link" anchorid="通过typenode创建具体类型的framenode节点" tips="复制节点链接"></i></h2>          <p>通过TypeNode创建具体类型的FrameNode节点，可以根据属性获取接口来检索用户设置的属性信息。</p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">BuilderNode</span>, typeNode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">"buildText"</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>      .<span class="hljs-title function_">visibility</span>(<span class="hljs-title class_">Visibility</span>.<span class="hljs-property">Visible</span>)</li><li>      .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.7</span>)</li><li>      .<span class="hljs-title function_">customProperty</span>(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode"</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">frameNode</span>: typeNode.<span class="hljs-property">Column</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">textTypeNode</span>: typeNode.<span class="hljs-property">Text</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"DEFAULT"</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span> = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"Column"</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>.<span class="hljs-property">attribute</span></li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textTypeNode</span> = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"Text"</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textTypeNode</span>.<span class="hljs-title function_">initialize</span>(<span class="hljs-string">"textTypeNode"</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>      .<span class="hljs-title function_">visibility</span>(<span class="hljs-title class_">Visibility</span>.<span class="hljs-property">Visible</span>)</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">"textTypeNode"</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textTypeNode</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeChild</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> parent = frameNode.<span class="hljs-title function_">getParent</span>();</li><li>    <span class="hljs-keyword">if</span> (parent) {</li><li>      parent.<span class="hljs-title function_">removeChild</span>(frameNode);</li><li>
</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getUserConfigBorderWidth</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> userConfigBorderWidth = frameNode?.<span class="hljs-title function_">getUserConfigBorderWidth</span>(); <span class="hljs-comment">// 获取用户设置的边框宽度</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(userConfigBorderWidth)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getUserConfigPadding</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> userConfigPadding = frameNode?.<span class="hljs-title function_">getUserConfigPadding</span>(); <span class="hljs-comment">// 获取用户设置的内边距</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(userConfigPadding)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getUserConfigMargin</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> userConfigMargin = frameNode?.<span class="hljs-title function_">getUserConfigMargin</span>(); <span class="hljs-comment">// 获取用户设置的外边距</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(userConfigMargin)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getUserConfigSize</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> userConfigSize = frameNode?.<span class="hljs-title function_">getUserConfigSize</span>(); <span class="hljs-comment">// 获取用户设置的宽高</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(userConfigSize)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getId</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> id = frameNode?.<span class="hljs-title function_">getId</span>(); <span class="hljs-comment">// 获取用户设置的节点ID</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${id}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getUniqueId</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> uniqueId = frameNode?.<span class="hljs-title function_">getUniqueId</span>(); <span class="hljs-comment">// 获取系统分配的唯一标识的节点UniqueID</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${uniqueId}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getNodeType</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> nodeType = frameNode?.<span class="hljs-title function_">getNodeType</span>(); <span class="hljs-comment">// 获取节点的类型</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${nodeType}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getOpacity</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> opacity = frameNode?.<span class="hljs-title function_">getOpacity</span>(); <span class="hljs-comment">// 获取节点的不透明度</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(opacity)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">isVisible</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> visible = frameNode?.<span class="hljs-title function_">isVisible</span>(); <span class="hljs-comment">// 获取节点是否可见</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(visible)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">isClipToFrame</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> clipToFrame = frameNode?.<span class="hljs-title function_">isClipToFrame</span>(); <span class="hljs-comment">// 获取节点是否是剪裁到组件区域</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(clipToFrame)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">isAttached</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> attached = frameNode?.<span class="hljs-title function_">isAttached</span>(); <span class="hljs-comment">// 获取节点是否被挂载到主节点树上</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(attached)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getInspectorInfo</span>(<span class="hljs-params">frameNode: FrameNode</span>) {</li><li>    <span class="hljs-keyword">let</span> inspectorInfo = frameNode?.<span class="hljs-title function_">getInspectorInfo</span>(); <span class="hljs-comment">// 获取节点的结构信息</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(inspectorInfo)}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"This is a NodeContainer."</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getUserConfigBorderWidth"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getUserConfigBorderWidth</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getUserConfigPadding"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getUserConfigPadding</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getUserConfigMargin"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getUserConfigMargin</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getUserConfigSize"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getUserConfigSize</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getId"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getId</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getUniqueId"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getUniqueId</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getNodeType"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getNodeType</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getOpacity"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getOpacity</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"isVisible"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isVisible</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"isClipToFrame"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isClipToFrame</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"isAttached"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isAttached</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"remove Text"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"textTypeNode"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">removeChild</span>(node);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isAttached</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getInspectorInfo"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getInspectorInfo</span>(node);</li><li>            }</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getCustomProperty"</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>          <span class="hljs-keyword">if</span> (uiContext) {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = uiContext.<span class="hljs-title function_">getFrameNodeById</span>(<span class="hljs-string">"buildText"</span>) || <span class="hljs-literal">null</span>;</li><li>            <span class="hljs-keyword">if</span> (node) {</li><li>              <span class="hljs-keyword">const</span> property = node.<span class="hljs-title function_">getCustomProperty</span>(<span class="hljs-string">"key1"</span>);</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(property));</li><li>            }</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-attr">left</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">right</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">top</span>: <span class="hljs-number">35</span>,</li><li>      <span class="hljs-attr">bottom</span>: <span class="hljs-number">35</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="解除当前framenode对象对实体framenode节点的引用关系">解除当前FrameNode对象对实体FrameNode节点的引用关系<i class="anchor-icon anchor-icon-link" anchorid="解除当前framenode对象对实体framenode节点的引用关系" tips="复制节点链接"></i></h2>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#dispose12" target="_blank">dispose</a>接口可以立即解除当前FrameNode对象对实体FrameNode节点的引用关系。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在调用dispose方法后，FrameNode对象不再对应任何实际的FrameNode节点。此时，若尝试调用以下查询接口：getMeasuredSize、getLayoutPosition、getUserConfigBorderWidth、getUserConfigPadding、getUserConfigMargin、getUserConfigSize，将导致应用程序触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-stability-guide#jscrash">jscrash</a>。</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getuniqueid12" target="_blank">getUniqueId</a>可以判断当前FrameNode是否对应一个实体FrameNode节点。当UniqueId大于0时表示该对象对应一个实体FrameNode节点。</p>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">BuilderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode"</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TestComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'This is a BuilderNode.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">' aboutToAppear'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">' aboutToDisappear'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildComponent</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TestComponent</span>()</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WrappedBuilder</span>(buildComponent));</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">200</span> };</li><li>      rootRenderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xff00ff00</span>;</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">printUniqueId</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> rootNode's uniqueId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rootNode.getUniqueId()}</span>`</span>);</li><li>      <span class="hljs-keyword">const</span> frameNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>      <span class="hljs-keyword">if</span> (frameNode) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> the uniqueId of builderNode's framenode: <span class="hljs-subst">${frameNode.getUniqueId()}</span>`</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> builderNode's framenode is undefined`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">disposeFrameNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> disposeFrameNode`</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">dispose</span>();</li><li>
</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">dispose</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeBuilderNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>() !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">4</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'FrameNode dispose'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">printUniqueId</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">disposeFrameNode</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">printUniqueId</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查询当前framenode是否解除引用">查询当前FrameNode是否解除引用<i class="anchor-icon anchor-icon-link" anchorid="查询当前framenode是否解除引用" tips="复制节点链接"></i></h2>          <p>前端节点均绑定有相应的后端实体节点，当节点调用dispose接口解除绑定后，再次调用接口可能会出现crash、返回默认值的情况。</p>     <p>从API version 20开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#isdisposed20" target="_blank">isDisposed</a>接口查询当前FrameNode对象是否已解除与后端实体节点的引用关系，从而可以在操作节点前检查其有效性，避免潜在风险。</p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">disposeFrameNode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 解除当前FrameNode对象对实体FrameNode节点的引用关系</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>?.<span class="hljs-title function_">dispose</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">isDisposed</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 查询FrameNode是否解除引用</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">isDisposed</span>()) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'frameNode isDisposed is true'</span>;</li><li>      }</li><li>      <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'frameNode isDisposed is false'</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'frameNode is null'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">4</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'FrameNode dispose'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">disposeFrameNode</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">''</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'FrameNode isDisposed'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isDisposed</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="framenode的数据懒加载能力">FrameNode的数据懒加载能力<i class="anchor-icon anchor-icon-link" anchorid="framenode的数据懒加载能力" tips="复制节点链接"></i></h2>          <p>提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#nodeadapter12" target="_blank">NodeAdapter</a>对象替代ArkTS侧的LazyForEach功能，提供自定义节点的数据懒加载功能，实现按需迭代数据。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>入参不能为负数，入参为负数时不做处理。</p>      </div></div></div>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">NodeAdapter</span>, typeNode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode"</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeAdapter</span> {</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span></li><li>  <span class="hljs-attr">cachePool</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">FrameNode</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>  <span class="hljs-attr">changed</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></li><li>  <span class="hljs-attr">reloadTimes</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>  hostNode?: <span class="hljs-title class_">FrameNode</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">uiContext: UIContext, count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span> = count;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">reloadData</span>(<span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reloadTimes</span>++;</li><li>    <span class="hljs-title class_">NodeAdapter</span>.<span class="hljs-title function_">attachNodeAdapter</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">hostNode</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span> = count;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadAllItems</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">refreshData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> items = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAllAvailableItems</span>()</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" get All items:"</span> + items.<span class="hljs-property">length</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span> -= <span class="hljs-number">1</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadAllItems</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">detachData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">NodeAdapter</span>.<span class="hljs-title function_">detachNodeAdapter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">hostNode</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reloadTimes</span> = <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">loadData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[i] = <span class="hljs-string">"Adapter ListItem "</span> + i + <span class="hljs-string">" r:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">reloadTimes</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">changeData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">changed</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">changed</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</li><li>      <span class="hljs-keyword">let</span> index = i + <span class="hljs-keyword">from</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[index] = <span class="hljs-string">"Adapter ListItem "</span> + (<span class="hljs-variable language_">this</span>.<span class="hljs-property">changed</span> ? <span class="hljs-string">"changed:"</span> : <span class="hljs-string">""</span>) + index + <span class="hljs-string">" r:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">reloadTimes</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadItem</span>(<span class="hljs-keyword">from</span>, count);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">insertData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</li><li>      <span class="hljs-keyword">let</span> index = i + <span class="hljs-keyword">from</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, <span class="hljs-string">"Adapter ListItem "</span> + <span class="hljs-keyword">from</span> + <span class="hljs-string">"-"</span> + i);</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">insertItem</span>(<span class="hljs-keyword">from</span>, count);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span> += count;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" after insert count:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> arr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, count);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-keyword">from</span>, count);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span> -= arr.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" after remove count:"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalNodeCount</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">moveData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(to, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">moveItem</span>(<span class="hljs-keyword">from</span>, to);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onAttachToNode</span>(<span class="hljs-attr">target</span>: <span class="hljs-title class_">FrameNode</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onAttachToNode id:"</span> + target.<span class="hljs-title function_">getUniqueId</span>());</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hostNode</span> = target;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDetachFromNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onDetachFromNode"</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onGetChildId</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onGetChildId:"</span> + index);</li><li>    <span class="hljs-keyword">return</span> index;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onCreateChild</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">FrameNode</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onCreateChild:"</span> + index);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachePool</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">let</span> cacheNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachePool</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">if</span> (cacheNode !== <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onCreateChild reused id:"</span> + cacheNode.<span class="hljs-title function_">getUniqueId</span>());</li><li>        <span class="hljs-keyword">let</span> text = cacheNode?.<span class="hljs-title function_">getFirstChild</span>();</li><li>        <span class="hljs-keyword">let</span> textNode = text <span class="hljs-keyword">as</span> typeNode.<span class="hljs-property">Text</span>;</li><li>        textNode?.<span class="hljs-title function_">initialize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[index]).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>);</li><li>        <span class="hljs-keyword">return</span> cacheNode;</li><li>      }</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onCreateChild createNew"</span>);</li><li>    <span class="hljs-keyword">let</span> itemNode = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">"ListItem"</span>);</li><li>    <span class="hljs-keyword">let</span> textNode = typeNode.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-string">"Text"</span>);</li><li>    textNode.<span class="hljs-title function_">initialize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[index]).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>);</li><li>    itemNode.<span class="hljs-title function_">appendChild</span>(textNode);</li><li>    <span class="hljs-keyword">return</span> itemNode;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDisposeChild</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" onDisposeChild:"</span> + id);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachePool</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">10</span>) {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachePool</span>.<span class="hljs-title function_">includes</span>(node)) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" caching node id:"</span> + node.<span class="hljs-title function_">getUniqueId</span>());</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachePool</span>.<span class="hljs-title function_">push</span>(node);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      node.<span class="hljs-title function_">dispose</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onUpdateChild</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> index = id;</li><li>    <span class="hljs-keyword">let</span> text = node.<span class="hljs-title function_">getFirstChild</span>();</li><li>    <span class="hljs-keyword">let</span> textNode = text <span class="hljs-keyword">as</span> typeNode.<span class="hljs-property">Text</span>;</li><li>    textNode?.<span class="hljs-title function_">initialize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[index]).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeAdapterController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">nodeAdapter</span>: <span class="hljs-title class_">MyNodeAdapter</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-keyword">let</span> listNode = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"List"</span>);</li><li>    listNode.<span class="hljs-title function_">initialize</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }).<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(listNode);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeAdapter</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeAdapter</span>(uiContext, <span class="hljs-number">100</span>);</li><li>    <span class="hljs-title class_">NodeAdapter</span>.<span class="hljs-title function_">attachNodeAdapter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeAdapter</span>, listNode);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ListNodeTest</span> {</li><li>  <span class="hljs-attr">adapterController</span>: <span class="hljs-title class_">MyNodeAdapterController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeAdapterController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"ListNode Adapter"</span>);</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>);</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Reload"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">reloadData</span>(<span class="hljs-number">50</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Change"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">changeData</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Insert"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">insertData</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Remove"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">removeData</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Move"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">moveData</span>(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Refresh"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">refreshData</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Detach"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>.<span class="hljs-property">nodeAdapter</span>?.<span class="hljs-title function_">detachData</span>();</li><li>          })</li><li>      }</li><li>    }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查询lazyforeach中的framenode节点信息">查询LazyForEach中的FrameNode节点信息<i class="anchor-icon anchor-icon-link" anchorid="查询lazyforeach中的framenode节点信息" tips="复制节点链接"></i></h2>          <p>如果FrameNode子节点中包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>节点，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getchild15" target="_blank">getChild</a>接口支持指定子节点展开模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#expandmode15" target="_blank">ExpandMode</a>，以不同展开模式获取子节点。</p>     <p>当前支持如下子节点展开模式：</p>     <ul>      <li>ExpandMode.NOT_EXPAND：表示不展开当前FrameNode的子节点。如果FrameNode子节点中包含LazyForEach节点，获取在主节点树上的子节点时，不展开当前FrameNode的子节点。子节点序列号按在主节点树上的子节点计算。</li>      <li>ExpandMode.EXPAND：表示展开当前FrameNode的子节点。如果FrameNode子节点中包含LazyForEach节点，获取任何子节点时，展开当前FrameNode的子节点。子节点序列号按所有子节点计算。</li>      <li>ExpandMode.LAZY_EXPAND：表示按需展开当前FrameNode的子节点。如果FrameNode子节点中包含LazyForEach节点，获取在主节点树上的子节点时，不展开当前FrameNode的子节点；获取不在主节点树上的子节点时，展开当前FrameNode的子节点。子节点序列号按所有子节点计算。</li>     </ul>     <p>可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getfirstchildindexwithoutexpand15" target="_blank">getFirstChildIndexWithoutExpand</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getlastchildindexwithoutexpand15" target="_blank">getLastChildIndexWithoutExpand</a>获取当前节点第一个和最后一个在主节点树上的子节点的序列号，其中子节点序列号按所有子节点计算。</p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">ExpandMode</span>, <span class="hljs-title class_">LengthUnit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"FrameNode "</span>;</li><li>
</li><li><span class="hljs-comment">// BasicDataSource实现了IDataSource接口，用于管理listener监听，以及通知LazyForEach数据更新</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.ADD, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.CHANGE, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.DELETE, index: index}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange(</span></li><li>      <span class="hljs-comment">//         [{type: DataOperationType.EXCHANGE, index: {start: from, end: to}}]);</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = []</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data: MyDataSource, scroller: Scroller</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> = scroller;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildData</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">List</span>({ <span class="hljs-attr">scroller</span>: params.<span class="hljs-property">scroller</span> }) {</li><li>    <span class="hljs-title class_">LazyForEach</span>(params.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">ListItem</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(item)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" node appear: "</span> + item)</li><li>            })</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>            .<span class="hljs-title function_">margin</span>({</li><li>              <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,</li><li>              <span class="hljs-attr">bottom</span>: <span class="hljs-number">30</span>,</li><li>              <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>              <span class="hljs-attr">right</span>: <span class="hljs-number">10</span></li><li>            })</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">id</span>(item)</li><li>    }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>  }</li><li>  .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  .<span class="hljs-title function_">listDirection</span>(<span class="hljs-title class_">Axis</span>.<span class="hljs-property">Horizontal</span>)</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = uiContext;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`N<span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Params</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">dataNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    dataNode.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildData), params);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = dataNode.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">scrollToIndexOptions</span>: <span class="hljs-title class_">ScrollToIndexOptions</span> = {</li><li>      <span class="hljs-attr">extraOffset</span>: {</li><li>        <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">unit</span>: <span class="hljs-title class_">LengthUnit</span>.<span class="hljs-property">VP</span></li><li>      }</li><li>    };</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">6</span>, <span class="hljs-literal">true</span>, <span class="hljs-title class_">ScrollAlign</span>.<span class="hljs-property">START</span>, scrollToIndexOptions);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getFirstChildIndexWithoutExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> getFirstChildIndexWithoutExpand: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rootNode!.getFirstChildIndexWithoutExpand()}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getLastChildIndexWithoutExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> getLastChildIndexWithoutExpand: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rootNode!.getLastChildIndexWithoutExpand()}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChildWithNotExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">NOT_EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND): "</span> + childNode!.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode!.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N9"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.NOT_EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChildWithExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND): "</span> + childNode!.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode!.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N3"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>  </li><li>  <span class="hljs-title function_">getChildWithLazyExpand</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> childNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">3</span>, <span class="hljs-title class_">ExpandMode</span>.<span class="hljs-property">LAZY_EXPAND</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND): "</span> + childNode!.<span class="hljs-title function_">getId</span>());</li><li>    <span class="hljs-keyword">if</span> (childNode!.<span class="hljs-title function_">getId</span>() === <span class="hljs-string">"N3"</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND)  result: success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TEST_TAG</span> + <span class="hljs-string">" getChild(3, ExpandMode.LAZY_EXPAND)  result: fail."</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">8</span> }) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">"This is a NodeContainer."</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>            .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getFirstChildIndexWithoutExpand"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getFirstChildIndexWithoutExpand</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getLastChildIndexWithoutExpand"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getLastChildIndexWithoutExpand</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithNotExpand"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithNotExpand</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithExpand"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithExpand</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"getChildWithLazyExpand"</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">getChildWithLazyExpand</span>();</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>) <span class="hljs-comment">// 滚动方向纵向</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="调整自定义绘制canvas的变换矩阵">调整自定义绘制Canvas的变换矩阵<i class="anchor-icon anchor-icon-link" anchorid="调整自定义绘制canvas的变换矩阵" tips="复制节点链接"></i></h2>          <p>从API version 12开始，通过重写FrameNode的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#ondraw12" target="_blank">onDraw</a>方法，可以重写默认绘制方法。</p>     <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#concatmatrix12" target="_blank">concatMatrix</a>可以调整自定义绘制画布的变换矩阵。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#gettotalmatrix12" target="_blank">getTotalMatrix</a>获取的是用来记录绘制指令的临时canvas的变换矩阵。</p></li>        <li>         <p>如果开发者希望对画布进行预期的变换，应使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#concatmatrix12" target="_blank">concatMatrix</a>而不是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing-canvas#setmatrix12" target="_blank">setMatrix</a>，因为setMatrix会覆盖原本真实canvas上存在的变换矩阵。</p></li>       </ul>      </div></div></div>     <p><strong>ArkTS接口调用示例：</strong></p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">DrawContext</span>, <span class="hljs-title class_">FrameNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { drawing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawImage</span>(<span class="hljs-params">canvas: DrawingCanvas</span>) {</li><li>  <span class="hljs-keyword">let</span> matrix = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Matrix</span>();</li><li>  matrix.<span class="hljs-title function_">setTranslation</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>  canvas.<span class="hljs-title function_">concatMatrix</span>(matrix);</li><li>  <span class="hljs-keyword">const</span> pen = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Pen</span>();</li><li>  pen.<span class="hljs-title function_">setStrokeWidth</span>(<span class="hljs-number">5</span>);</li><li>  pen.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">255</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachPen</span>(pen);</li><li>  <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>  brush.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">255</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>  canvas.<span class="hljs-title function_">drawRect</span>({</li><li>    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">right</span>: <span class="hljs-number">110</span>,</li><li>    <span class="hljs-attr">bottom</span>: <span class="hljs-number">60</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">detachPen</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">drawImage1</span>(<span class="hljs-params">canvas: DrawingCanvas</span>) {</li><li>  <span class="hljs-keyword">let</span> matrix = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Matrix</span>();</li><li>  matrix.<span class="hljs-title function_">setTranslation</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>
</li><li>  <span class="hljs-comment">// 1. getTotalMatrix获取的是用来记录绘制指令的临时canvas的变换矩阵</span></li><li>  <span class="hljs-comment">// 2. 如果开发者希望这个画布进行一个预期的变换，应该使用concatMatrix而不是setMatrix，因为setMatrix会覆盖原本真实canvas上存在的变换矩阵</span></li><li>  canvas.<span class="hljs-title function_">getTotalMatrix</span>();</li><li>  canvas.<span class="hljs-title function_">setMatrix</span>(matrix);</li><li>  <span class="hljs-keyword">const</span> pen = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Pen</span>();</li><li>  pen.<span class="hljs-title function_">setStrokeWidth</span>(<span class="hljs-number">5</span>);</li><li>  pen.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">255</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachPen</span>(pen);</li><li>  <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>  brush.<span class="hljs-title function_">setColor</span>({</li><li>    <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">blue</span>: <span class="hljs-number">255</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>  canvas.<span class="hljs-title function_">drawRect</span>({</li><li>    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">right</span>: <span class="hljs-number">110</span>,</li><li>    <span class="hljs-attr">bottom</span>: <span class="hljs-number">60</span></li><li>  });</li><li>  canvas.<span class="hljs-title function_">detachPen</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFrameNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FrameNode</span> {</li><li>  <span class="hljs-title function_">onDraw</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">DrawContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">drawImage</span>(context.<span class="hljs-property">canvas</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFrameNode1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FrameNode</span> {</li><li>  <span class="hljs-title function_">onDraw</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">DrawContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">drawImage1</span>(context.<span class="hljs-property">canvas</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    rootNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">theFrameNode</span>: <span class="hljs-title class_">MyFrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFrameNode</span>(uiContext)</li><li>    theFrameNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFF2787D9</span>);</li><li>    rootNode.<span class="hljs-title function_">appendChild</span>(theFrameNode);</li><li>    <span class="hljs-keyword">return</span> rootNode;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    rootNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">theFrameNode</span>: <span class="hljs-title class_">MyFrameNode1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFrameNode1</span>(uiContext)</li><li>    theFrameNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFF2787D9</span>);</li><li>    rootNode.<span class="hljs-title function_">appendChild</span>(theFrameNode);</li><li>    <span class="hljs-keyword">return</span> rootNode;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-attr">myNodeController1</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController1</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController1</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="336" originwidth="993" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114927.93178497372776051592177635164449:50001231000000:2800:1DD5B8FAD9F81E6393E13D03CBC0D59F68D679C96ED470ED4241EB2E7FE92C93.png" width="920" height="311.2990936555891"></span></p>    </div>    <div class="tiledSection">     <h2 id="更新当前帧节点">更新当前帧节点<i class="anchor-icon anchor-icon-link" anchorid="更新当前帧节点" tips="复制节点链接"></i></h2>          <p>从API version 21开始，通过使用frameNode的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#invalidateattributes21" target="_blank">invalidateAttributes</a>方法，可以在当前帧触发节点更新，避免组件切换过程中出现闪烁。</p>     <div _ngcontent-qmm-c106="" class="highlight-div"><div _ngcontent-qmm-c106="" class="highlight-div-header"><div _ngcontent-qmm-c106="" class="highlight-div-header-left"><div _ngcontent-qmm-c106="" class="handle-button expand-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qmm-c106="" class="highlight-div-header-right"><div _ngcontent-qmm-c106="" class="handle-button ai-button"></div><div _ngcontent-qmm-c106="" class="handle-button line-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qmm-c106="" class="handle-button theme-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qmm-c106="" class="handle-button copy-button"><div _ngcontent-qmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qmm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-comment">//index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, typeNode, <span class="hljs-title class_">NodeContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义NodeAdapter控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeAdapterController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-attr">imageUrl</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">imageUrl: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageUrl</span> = imageUrl;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">let</span> imageNode = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"Image"</span>);</li><li>    imageNode.<span class="hljs-title function_">initialize</span>($r(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageUrl</span>))</li><li>    imageNode.<span class="hljs-property">commonAttribute</span>.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">100</span> })</li><li>    imageNode.<span class="hljs-property">attribute</span>.<span class="hljs-title function_">syncLoad</span>(<span class="hljs-literal">true</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>);</li><li>    <span class="hljs-comment">// 强制当前帧内即时节点更新，避免出现切换闪烁</span></li><li>    imageNode.<span class="hljs-title function_">invalidateAttributes</span>();</li><li>    <span class="hljs-keyword">return</span> imageNode;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义挂载事件的自定义组件，挂载前加载样例图片</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NodeComponent3</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootSlot</span>: <span class="hljs-title class_">NodeContent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> uiContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> imageNode = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"Image"</span>);</li><li>    imageNode.<span class="hljs-title function_">initialize</span>($r(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>    imageNode.<span class="hljs-property">attribute</span>.<span class="hljs-title function_">syncLoad</span>(<span class="hljs-literal">true</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>);</li><li>    imageNode.<span class="hljs-title function_">invalidateAttributes</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>.<span class="hljs-title function_">addFrameNode</span>(imageNode);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义挂载事件的自定义组件，挂载前加载样例图片</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NodeComponent4</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootSlot</span>: <span class="hljs-title class_">NodeContent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> uiContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> imageNode = typeNode.<span class="hljs-title function_">createNode</span>(uiContext, <span class="hljs-string">"Image"</span>);</li><li>    imageNode.<span class="hljs-title function_">initialize</span>($r(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>    imageNode.<span class="hljs-property">attribute</span>.<span class="hljs-title function_">syncLoad</span>(<span class="hljs-literal">true</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>);</li><li>    imageNode.<span class="hljs-title function_">invalidateAttributes</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>.<span class="hljs-title function_">addFrameNode</span>(imageNode);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootSlot</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ListNodeTest</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-attr">adapterController</span>: <span class="hljs-title class_">MyNodeAdapterController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeAdapterController</span>(<span class="hljs-string">'app.media.startIcon'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"NodeComponent"</span>)</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>        <span class="hljs-title class_">NodeComponent3</span>()</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title class_">NodeComponent4</span>()</li><li>      }</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"NodeContainer"</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">adapterController</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      }</li><li>      <span class="hljs-comment">// 点击后图片正常切换不闪烁</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;</li><li>      }).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="445" originwidth="268" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114927.27799346054717215231300450055422:50001231000000:2800:E26A7DCB1530FC8D86247C15A30C9A743ADC7586482335D9B898FF2D46388E4E.png" class="notEnlarge" width="268" height="445"></span></p>    </div>   </div>   <div></div></div>