<h1 _ngcontent-aef-c119="" class="doc-title ng-star-inserted" title="自定义绘制"> 自定义绘制 </h1>

<div _ngcontent-aef-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>NDK提供了自定义绘制节点的能力，通过以下接口，开发者可以实现基于NDK侧Custom节点的自绘制能力。</p>    <div class="tiledSection">     <h2 id="自定义绘制内容">自定义绘制内容<i class="anchor-icon anchor-icon-link" anchorid="自定义绘制内容" tips="复制节点链接"></i></h2>          <p>当监听到注册的事件为绘制类型时，可通过自定义绘制功能执行绘制逻辑，自定义内容。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>在事件注册过程中，需将事件注册为绘制事件（如ARKUI_NODE_CUSTOM_EVENT_ON_DRAW），通过查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodecustomeventtype" target="_blank">ArkUI_NodeCustomEventType</a>枚举值，获取事件类型及含义。</p></li>        <li>         <p>若需实现自定义绘制逻辑，应自定义UserData，并在事件注册时进行传递。</p></li>       </ul>      </div></div></div>     <p>以下场景基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面</a>章节，创建前置工程。</p>     <ul>      <li>       <p>自定义节点的创建，通过ArkUI_NativeNodeAPI_1的create接口，传入ARKUI_NODE_CUSTOM创建自定义节点。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">auto</span> <span class="hljs-variable">customNode</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_CUSTOM</span>);</li></ol></pre></div></div></li>      <li>       <p>在事件注册时将自定义节点、事件类型（例如ARKUI_NODE_CUSTOM_EVENT_ON_FOREGROUND_DRAW，获取NDK接口支持的事件类型范围可通过查询<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodecustomeventtype" target="_blank">ArkUI_NodeCustomEventType</a>枚举值）、事件ID和UserData作为参数传入。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//UserData</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">A</span> {</li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">a</span> =<span class="hljs-number">6</span>;</li><li>    <span class="hljs-variable">bool</span> <span class="hljs-variable">flag</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">node</span>;</li><li>};</li><li><span class="hljs-variable">A</span> *<span class="hljs-variable">a</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">A</span>;</li><li><span class="hljs-variable">a</span>-&gt;<span class="hljs-title class_">node</span> = <span class="hljs-variable">customNode</span>;</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeCustomEvent</span>(<span class="hljs-title class_">customNode</span>,<span class="hljs-title class_">ARKUI_NODE_CUSTOM_EVENT_ON_FOREGROUND_DRAW</span>,<span class="hljs-number">1</span>,<span class="hljs-title class_">a</span>);</li><li><span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeCustomEventReceiver</span>([](<span class="hljs-variable">ArkUI_NodeCustomEvent</span> <span class="hljs-variable">*event</span>) {</li><li><span class="hljs-comment">//事件回调函数逻辑</span></li><li>});</li></ol></pre></div></div></li>      <li>       <p>在回调函数中，获取自定义事件的事件类型（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodecustomevent_geteventtype" target="_blank">OH_ArkUI_NodeCustomEvent_GetEventType</a>）、事件ID（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodecustomevent_geteventtargetid" target="_blank">OH_ArkUI_NodeCustomEvent_GetEventTargetId</a>获取）、UserData（通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodecustomevent_getuserdata" target="_blank">OH_ArkUI_NodeCustomEvent_GetUserData</a>获取）进行判断，以执行不同的逻辑。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-vbnet" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">auto</span> type = OH_ArkUI_NodeCustomEvent_GetEventType(<span class="hljs-keyword">event</span>);</li><li><span class="hljs-keyword">auto</span> targetId = OH_ArkUI_NodeCustomEvent_GetEventTargetId(<span class="hljs-keyword">event</span>);</li><li><span class="hljs-keyword">auto</span> userData =reinterpret_cast&lt;A *&gt;( OH_ArkUI_NodeCustomEvent_GetUserData(<span class="hljs-keyword">event</span>));</li></ol></pre></div></div></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodecustomevent_getdrawcontextindraw" target="_blank">OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw</a>通过自定义组件事件获取绘制上下文，并将其传入 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_drawcontext_getcanvas" target="_blank">OH_ArkUI_DrawContext_GetCanvas</a>中以获取绘制canvas指针，该指针随后转换为OH_Drawing_Canvas指针进行绘制。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//获取自定义事件绘制的上下文。</span></li><li><span class="hljs-keyword">auto</span> *drawContext = <span class="hljs-built_in">OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw</span>(event);</li><li><span class="hljs-comment">//获取绘制canvas指针。</span></li><li><span class="hljs-keyword">auto</span> *canvas1 = <span class="hljs-built_in">OH_ArkUI_DrawContext_GetCanvas</span>(drawContext);</li><li><span class="hljs-comment">//转换为OH_Drawing_Canvas指针进行绘制。</span></li><li>OH_Drawing_Canvas *canvas = <span class="hljs-built_in">reinterpret_cast</span>&lt;OH_Drawing_Canvas *&gt;(canvas1);</li><li><span class="hljs-comment">//绘制逻辑。</span></li><li><span class="hljs-type">int32_t</span> width = <span class="hljs-number">1000</span>;</li><li><span class="hljs-type">int32_t</span> height = <span class="hljs-number">1000</span>;</li><li><span class="hljs-keyword">auto</span> path = <span class="hljs-built_in">OH_Drawing_PathCreate</span>();</li><li><span class="hljs-built_in">OH_Drawing_PathMoveTo</span>(path, width / <span class="hljs-number">4</span>, height / <span class="hljs-number">4</span>);</li><li><span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li><span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li><span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li><span class="hljs-built_in">OH_Drawing_PathLineTo</span>(path, width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li><span class="hljs-built_in">OH_Drawing_PathClose</span>(path);</li><li><span class="hljs-keyword">auto</span> pen = <span class="hljs-built_in">OH_Drawing_PenCreate</span>();</li><li><span class="hljs-built_in">OH_Drawing_PenSetWidth</span>(pen, <span class="hljs-number">10</span>);</li><li><span class="hljs-built_in">OH_Drawing_PenSetColor</span>(pen, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>));</li><li><span class="hljs-built_in">OH_Drawing_CanvasAttachPen</span>(canvas, pen);</li><li><span class="hljs-built_in">OH_Drawing_CanvasDrawPath</span>(canvas, path);</li></ol></pre></div></div>       <p><strong>内容绘制的完整示例：</strong></p></li>     </ul>     <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">arkui</span>/<span class="hljs-title class_">native_interface</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">arkui</span>/<span class="hljs-title class_">native_node</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_canvas</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_color</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_path</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_pen</span>.<span class="hljs-title class_">h</span>&gt;</li><li>
</li><li><span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-title function_">test_draw</span>(<span class="hljs-variable">ArkUI_NativeNodeAPI_1</span> *<span class="hljs-variable">nodeAPI</span>) {</li><li>    <span class="hljs-comment">//创建节点</span></li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">column</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_COLUMN</span>);</li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">customNode</span> = <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_CUSTOM</span>);</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {<span class="hljs-number">480</span>};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span> = {<span class="hljs-variable">value</span>, <span class="hljs-number">1</span>};</li><li>    <span class="hljs-comment">//属性设置</span></li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">column</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>    <span class="hljs-variable">value</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">i32</span> = <span class="hljs-number">720</span>;</li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">column</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">NODE_WIDTH_value</span>[] = {<span class="hljs-number">200</span>};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">NODE_WIDTH_Item</span>[] = {<span class="hljs-variable">NODE_WIDTH_value</span>, <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">NODE_HEIGHT_value</span>[] = {<span class="hljs-number">200</span>};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">NODE_HEIGHT_Item</span>[] = {<span class="hljs-variable">NODE_HEIGHT_value</span>, <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">NODE_BACKGROUND_COLOR_item_value</span>[] = {{.<span class="hljs-variable">u32</span> = <span class="hljs-number">0xFFFFFF00</span>}};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">NODE_BACKGROUND_COLOR_Item</span>[] = {<span class="hljs-variable">NODE_BACKGROUND_COLOR_item_value</span>, <span class="hljs-number">1</span>};</li><li>    <span class="hljs-comment">//自定义UserData。</span></li><li>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">A</span> {</li><li>        <span class="hljs-variable">int32_t</span> <span class="hljs-variable">a</span> =<span class="hljs-number">6</span>;</li><li>        <span class="hljs-variable">bool</span> <span class="hljs-variable">flag</span> = <span class="hljs-keyword">true</span>;</li><li>        <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">node</span>;</li><li>    };</li><li>    <span class="hljs-variable">A</span> *<span class="hljs-variable">a</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">A</span>;</li><li>    <span class="hljs-variable">a</span>-&gt;<span class="hljs-title class_">node</span> = <span class="hljs-variable">customNode</span>;</li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">customNode</span>, <span class="hljs-title class_">NODE_WIDTH</span>, <span class="hljs-title class_">NODE_WIDTH_Item</span>);</li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">customNode</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, <span class="hljs-title class_">NODE_HEIGHT_Item</span>);</li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">customNode</span>, <span class="hljs-title class_">NODE_BACKGROUND_COLOR</span>, <span class="hljs-title class_">NODE_BACKGROUND_COLOR_Item</span>);</li><li>    <span class="hljs-comment">//进行事件注册</span></li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeCustomEvent</span>(<span class="hljs-title class_">customNode</span>,<span class="hljs-title class_">ARKUI_NODE_CUSTOM_EVENT_ON_FOREGROUND_DRAW</span>,<span class="hljs-number">1</span>,<span class="hljs-title class_">a</span>);</li><li>    <span class="hljs-comment">//事件回调函数的编写</span></li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">registerNodeCustomEventReceiver</span>([](<span class="hljs-variable">ArkUI_NodeCustomEvent</span> <span class="hljs-variable">*event</span>) {</li><li>        <span class="hljs-comment">//获取自定义事件的相关信息。</span></li><li>        <span class="hljs-variable">auto</span> <span class="hljs-keyword">type</span> = <span class="hljs-title function_">OH_ArkUI_NodeCustomEvent_GetEventType</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">targetId</span> = <span class="hljs-title function_">OH_ArkUI_NodeCustomEvent_GetEventTargetId</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">userData</span> =<span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">A</span> *&gt;( <span class="hljs-title function_">OH_ArkUI_NodeCustomEvent_GetUserData</span>(<span class="hljs-variable">event</span>));</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> == <span class="hljs-variable">ARKUI_NODE_CUSTOM_EVENT_ON_FOREGROUND_DRAW</span> &amp;&amp; <span class="hljs-variable">targetId</span> == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-variable">userData</span>-&gt;<span class="hljs-title class_">flag</span>) {</li><li>            <span class="hljs-comment">//获取自定义事件绘制的上下文。</span></li><li>            <span class="hljs-variable">auto</span> *<span class="hljs-variable">drawContext</span> = <span class="hljs-title function_">OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw</span>(<span class="hljs-variable">event</span>);</li><li>            <span class="hljs-comment">//获取绘制canvas指针。</span></li><li>            <span class="hljs-variable">auto</span> *<span class="hljs-variable">canvas1</span> = <span class="hljs-title function_">OH_ArkUI_DrawContext_GetCanvas</span>(<span class="hljs-variable">drawContext</span>);</li><li>            <span class="hljs-comment">//转换为OH_Drawing_Canvas指针进行绘制。</span></li><li>            <span class="hljs-variable">OH_Drawing_Canvas</span> *<span class="hljs-variable">canvas</span> = <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">OH_Drawing_Canvas</span> *&gt;(<span class="hljs-variable">canvas1</span>);</li><li>            <span class="hljs-variable">int32_t</span> <span class="hljs-variable">width</span> = <span class="hljs-number">1000</span>;</li><li>            <span class="hljs-variable">int32_t</span> <span class="hljs-variable">height</span> = <span class="hljs-number">1000</span>;</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">path</span> = <span class="hljs-title function_">OH_Drawing_PathCreate</span>();</li><li>            <span class="hljs-title function_">OH_Drawing_PathMoveTo</span>(<span class="hljs-variable">path</span>, <span class="hljs-variable">width</span> / <span class="hljs-number">4</span>, <span class="hljs-variable">height</span> / <span class="hljs-number">4</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PathLineTo</span>(<span class="hljs-variable">path</span>, <span class="hljs-variable">width</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, <span class="hljs-variable">height</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PathLineTo</span>(<span class="hljs-variable">path</span>, <span class="hljs-variable">width</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, <span class="hljs-variable">height</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PathLineTo</span>(<span class="hljs-variable">path</span>, <span class="hljs-variable">width</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, <span class="hljs-variable">height</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PathLineTo</span>(<span class="hljs-variable">path</span>, <span class="hljs-variable">width</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, <span class="hljs-variable">height</span> * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PathClose</span>(<span class="hljs-variable">path</span>);</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">pen</span> = <span class="hljs-title function_">OH_Drawing_PenCreate</span>();</li><li>            <span class="hljs-title function_">OH_Drawing_PenSetWidth</span>(<span class="hljs-variable">pen</span>, <span class="hljs-number">10</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_PenSetColor</span>(<span class="hljs-variable">pen</span>, <span class="hljs-title function_">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>));</li><li>            <span class="hljs-title function_">OH_Drawing_CanvasAttachPen</span>(<span class="hljs-variable">canvas</span>, <span class="hljs-variable">pen</span>);</li><li>            <span class="hljs-title function_">OH_Drawing_CanvasDrawPath</span>(<span class="hljs-variable">canvas</span>, <span class="hljs-variable">path</span>);</li><li>        }</li><li>    });</li><li>    <span class="hljs-comment">//自定义节点上树</span></li><li>    <span class="hljs-variable">nodeAPI</span>-&gt;<span class="hljs-title class_">addChild</span>(<span class="hljs-title class_">column</span>, <span class="hljs-title class_">customNode</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">column</span>;</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="323" originwidth="369" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114748.54981793870527782855293062664218:50001231000000:2800:8A514CA74CCF26AC8B5352308A0DA05992926C6AAE69C91F5A428E81705688EA.jpg" width="369" height="323"></span></p>    </div>    <div class="tiledSection">     <h2 id="自定义绘制前景背景">自定义绘制前景背景<i class="anchor-icon anchor-icon-link" anchorid="自定义绘制前景背景" tips="复制节点链接"></i></h2>          <p>以下示例创建了一个自定义绘制组件，该绘制组件能够绘制自定义矩形，同时可以自定义绘制前景和背景，并使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-build-custom-components#自定义布局容器">自定义布局容器</a>进行布局排布。</p>     <ol>      <li>       <p>按照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-build-custom-components#自定义布局容器">自定义布局容器</a>章节准备前置工程。</p></li>      <li>       <p>创建自定义绘制组件封装对象。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUICustomNode.h</span></li><li><span class="hljs-comment">// 自定义绘制组件示例</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYAPPLICATION_ARKUICUSTOMNODE_H</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYAPPLICATION_ARKUICUSTOMNODE_H</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_brush.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_path.h&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUINode.h"</span></span></li><li>
</li><li>namespace NativeModule {</li><li>
</li><li><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArkUICustomNode</span> :</span> public ArkUINode {</li><li>public:</li><li>    <span class="hljs-comment">// 使用自定义组件类型ARKUI_NODE_CUSTOM创建组件。</span></li><li>    ArkUICustomNode()</li><li>        : ArkUINode((NativeModuleInstance::GetInstance()-&gt;GetNativeNodeAPI())-&gt;createNode(ARKUI_NODE_CUSTOM)) {</li><li>        <span class="hljs-comment">// 注册自定义事件监听器。</span></li><li>        nativeModule_-&gt;addNodeCustomEventReceiver(handle_, OnStaticCustomEvent);</li><li>        <span class="hljs-comment">// 声明自定义事件并转递自身作为自定义数据。</span></li><li>        nativeModule_-&gt;registerNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_FRONT, <span class="hljs-number">0</span>, this);</li><li>        nativeModule_-&gt;registerNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW, <span class="hljs-number">0</span>, this);</li><li>        nativeModule_-&gt;registerNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_BEHIND , <span class="hljs-number">0</span>, this);</li><li>        </li><li>    }</li><li>
</li><li>    ~ArkUICustomNode() override {</li><li>        <span class="hljs-comment">// 反注册自定义事件监听器。</span></li><li>        nativeModule_-&gt;removeNodeCustomEventReceiver(handle_, OnStaticCustomEvent);</li><li>        <span class="hljs-comment">// 取消声明自定义事件。</span></li><li>        nativeModule_-&gt;unregisterNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_FRONT);</li><li>        nativeModule_-&gt;unregisterNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW);</li><li>        nativeModule_-&gt;unregisterNodeCustomEvent(handle_, ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_BEHIND);</li><li>    }</li><li>
</li><li>private:</li><li>    <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">OnStaticCustomEvent</span><span class="hljs-params">(ArkUI_NodeCustomEvent *event)</span> {</li><li>        <span class="hljs-comment">// 获取组件实例对象，调用相关实例方法。</span></li><li>        <span class="hljs-keyword">auto</span> customNode = reinterpret_cast&lt;ArkUICustomNode *&gt;(OH_ArkUI_NodeCustomEvent_GetUserData(event));</li><li>        <span class="hljs-keyword">auto</span> type = OH_ArkUI_NodeCustomEvent_GetEventType(event);</li><li>        <span class="hljs-keyword">switch</span> (type) {</li><li>        <span class="hljs-keyword">case</span> ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_BEHIND:</li><li>            customNode-&gt;OnDrawBehind(event);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> ARKUI_NODE_CUSTOM_EVENT_ON_DRAW:</li><li>            customNode-&gt;OnDraw(event);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> ARKUI_NODE_CUSTOM_EVENT_ON_DRAW_FRONT:</li><li>            customNode-&gt;OnDrawFront(event);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 自定义绘制逻辑。</span></li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnDrawBehind</span><span class="hljs-params">(ArkUI_NodeCustomEvent *event)</span> {</li><li>        <span class="hljs-keyword">auto</span> drawContext = OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw(event);</li><li>        <span class="hljs-comment">// 获取图形绘制对象。</span></li><li>        <span class="hljs-keyword">auto</span> drawCanvas = reinterpret_cast&lt;OH_Drawing_Canvas *&gt;(OH_ArkUI_DrawContext_GetCanvas(drawContext));</li><li>        <span class="hljs-comment">// 获取组件大小。</span></li><li>        <span class="hljs-keyword">auto</span> size = OH_ArkUI_DrawContext_GetSize(drawContext);</li><li>        <span class="hljs-comment">// 绘制自定义内容。</span></li><li>        <span class="hljs-keyword">auto</span> path = OH_Drawing_PathCreate();</li><li>        OH_Drawing_PathMoveTo(path, size.width / <span class="hljs-number">5</span>, size.height / <span class="hljs-number">5</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">4</span> / <span class="hljs-number">5</span>, size.height / <span class="hljs-number">5</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">4</span> / <span class="hljs-number">5</span>, size.height * <span class="hljs-number">4</span> / <span class="hljs-number">5</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">5</span>, size.height * <span class="hljs-number">4</span> / <span class="hljs-number">5</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">5</span>, size.height / <span class="hljs-number">5</span>);</li><li>        OH_Drawing_PathClose(path);</li><li>        <span class="hljs-keyword">auto</span> brush = OH_Drawing_BrushCreate();</li><li>        OH_Drawing_BrushSetColor(brush, <span class="hljs-number">0xFFF0FAFF</span>);<span class="hljs-comment">// 蓝白色</span></li><li>        OH_Drawing_CanvasAttachBrush(drawCanvas, brush);</li><li>        OH_Drawing_CanvasDrawPath(drawCanvas, path);</li><li>        <span class="hljs-comment">// 释放资源</span></li><li>        OH_Drawing_BrushDestroy(brush);</li><li>        OH_Drawing_PathDestroy(path);</li><li>    }</li><li>    </li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnDraw</span><span class="hljs-params">(ArkUI_NodeCustomEvent *event)</span> {</li><li>        <span class="hljs-keyword">auto</span> drawContext = OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw(event);</li><li>        <span class="hljs-comment">// 获取图形绘制对象。</span></li><li>        <span class="hljs-keyword">auto</span> drawCanvas = reinterpret_cast&lt;OH_Drawing_Canvas *&gt;(OH_ArkUI_DrawContext_GetCanvas(drawContext));</li><li>        <span class="hljs-comment">// 获取组件大小。</span></li><li>        <span class="hljs-keyword">auto</span> size = OH_ArkUI_DrawContext_GetSize(drawContext);</li><li>        <span class="hljs-comment">// 绘制自定义内容。</span></li><li>        <span class="hljs-keyword">auto</span> path = OH_Drawing_PathCreate();</li><li>        OH_Drawing_PathMoveTo(path, size.width / <span class="hljs-number">4</span>, size.height / <span class="hljs-number">4</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, size.height / <span class="hljs-number">4</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>, size.height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">4</span>, size.height * <span class="hljs-number">3</span> / <span class="hljs-number">4</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">4</span>, size.height / <span class="hljs-number">4</span>);</li><li>        OH_Drawing_PathClose(path);</li><li>        <span class="hljs-keyword">auto</span> brush = OH_Drawing_BrushCreate();</li><li>        OH_Drawing_BrushSetColor(brush, <span class="hljs-number">0xff2787D9</span>);<span class="hljs-comment">// 浅蓝色</span></li><li>        OH_Drawing_CanvasAttachBrush(drawCanvas, brush);</li><li>        OH_Drawing_CanvasDrawPath(drawCanvas, path);</li><li>        <span class="hljs-comment">// 释放资源</span></li><li>        OH_Drawing_BrushDestroy(brush);</li><li>        OH_Drawing_PathDestroy(path);</li><li>    }</li><li>    </li><li>    <span class="hljs-type">void</span> <span class="hljs-title function_">OnDrawFront</span><span class="hljs-params">(ArkUI_NodeCustomEvent *event)</span> {</li><li>        <span class="hljs-keyword">auto</span> drawContext = OH_ArkUI_NodeCustomEvent_GetDrawContextInDraw(event);</li><li>        <span class="hljs-comment">// 获取图形绘制对象。</span></li><li>        <span class="hljs-keyword">auto</span> drawCanvas = reinterpret_cast&lt;OH_Drawing_Canvas *&gt;(OH_ArkUI_DrawContext_GetCanvas(drawContext));</li><li>        <span class="hljs-comment">// 获取组件大小。</span></li><li>        <span class="hljs-keyword">auto</span> size = OH_ArkUI_DrawContext_GetSize(drawContext);</li><li>        <span class="hljs-comment">// 绘制自定义内容。</span></li><li>        <span class="hljs-keyword">auto</span> path = OH_Drawing_PathCreate();</li><li>        OH_Drawing_PathMoveTo(path, size.width / <span class="hljs-number">3</span>, size.height / <span class="hljs-number">3</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>, size.height / <span class="hljs-number">3</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>, size.height * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">3</span>, size.height * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>);</li><li>        OH_Drawing_PathLineTo(path, size.width / <span class="hljs-number">3</span>, size.height / <span class="hljs-number">3</span>);</li><li>        OH_Drawing_PathClose(path);</li><li>        <span class="hljs-keyword">auto</span> brush = OH_Drawing_BrushCreate();</li><li>        OH_Drawing_BrushSetColor(brush, <span class="hljs-number">0xFF004AAF</span>);<span class="hljs-comment">// 深蓝色</span></li><li>        OH_Drawing_CanvasAttachBrush(drawCanvas, brush);</li><li>        OH_Drawing_CanvasDrawPath(drawCanvas, path);</li><li>        <span class="hljs-comment">// 释放资源</span></li><li>        OH_Drawing_BrushDestroy(brush);</li><li>        OH_Drawing_PathDestroy(path);</li><li>    }</li><li>};</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYAPPLICATION_ARKUICUSTOMNODE_H</span></span></li></ol></pre></div></div></li>      <li>       <p>使用自定义绘制组件和自定义容器创建示例界面。</p>       <div _ngcontent-aef-c106="" class="highlight-div"><div _ngcontent-aef-c106="" class="highlight-div-header"><div _ngcontent-aef-c106="" class="highlight-div-header-left"><div _ngcontent-aef-c106="" class="handle-button expand-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aef-c106="" class="highlight-div-header-right"><div _ngcontent-aef-c106="" class="handle-button ai-button"></div><div _ngcontent-aef-c106="" class="handle-button line-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aef-c106="" class="handle-button theme-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aef-c106="" class="handle-button copy-button"><div _ngcontent-aef-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aef-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUICustomNode.cpp</span></li><li><span class="hljs-comment">// 自定义NDK接口入口组件。</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"NativeEntry.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUICustomContainerNode.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ArkUICustomNode.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 全局环境变量声明</span></li><li><span class="hljs-type">static</span> napi_env g_env = nullptr;</li><li>
</li><li>namespace NativeModule {</li><li>
</li><li>napi_value <span class="hljs-title function_">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {nullptr};</li><li>
</li><li>    napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</li><li>
</li><li>    <span class="hljs-comment">// 获取NodeContent</span></li><li>    ArkUI_NodeContentHandle contentHandle;</li><li>    OH_ArkUI_GetNodeContentFromNapiValue(env, args[<span class="hljs-number">0</span>], &amp;contentHandle);</li><li>    NativeEntry::GetInstance()-&gt;SetContentHandle(contentHandle);</li><li>
</li><li>    <span class="hljs-comment">// 创建自定义容器和自定义绘制组件。</span></li><li>    <span class="hljs-keyword">auto</span> node = <span class="hljs-built_in">std</span>::make_shared&lt;ArkUICustomContainerNode&gt;();</li><li>    node-&gt;SetBackgroundColor(<span class="hljs-number">0xFFD5D5D5</span>);<span class="hljs-comment">// 浅灰色</span></li><li>    <span class="hljs-keyword">auto</span> customNode = <span class="hljs-built_in">std</span>::make_shared&lt;ArkUICustomNode&gt;();</li><li>    customNode-&gt;SetBackgroundColor(<span class="hljs-number">0xFF707070</span>);<span class="hljs-comment">// 深灰色</span></li><li>    customNode-&gt;SetWidth(<span class="hljs-number">150</span>);</li><li>    customNode-&gt;SetHeight(<span class="hljs-number">150</span>);</li><li>    node-&gt;AddChild(customNode);</li><li>
</li><li>    <span class="hljs-comment">// 保持Native侧对象到管理类中，维护生命周期。</span></li><li>    NativeEntry::GetInstance()-&gt;SetRootNode(node);</li><li>    g_env = env;</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>napi_value <span class="hljs-title function_">DestroyNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> {</li><li>    <span class="hljs-comment">// 从管理类中释放Native侧对象。</span></li><li>    NativeEntry::GetInstance()-&gt;DisposeRootNode();</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li></ol></pre></div></div></li>     </ol>     <p><span><img originheight="635" originwidth="479" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114749.34212377078377250104498345419312:50001231000000:2800:115A269D2D54C5FE72FC966500B9C30D42F3DA1A036EBFAF6FDF762636A44611.jpg" width="479" height="635"></span></p>    </div>   </div>   <div></div></div>