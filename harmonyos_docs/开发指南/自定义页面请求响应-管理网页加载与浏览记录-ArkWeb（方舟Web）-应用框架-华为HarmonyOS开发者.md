<h1 _ngcontent-ghy-c119="" class="doc-title ng-star-inserted" title="自定义页面请求响应"> 自定义页面请求响应 </h1>

<div _ngcontent-ghy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Web组件支持在应用拦截到页面请求后自定义响应请求能力。开发者通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oninterceptrequest9" target="_blank">onInterceptRequest()</a>接口来实现自定义资源请求响应 。自定义请求能力可以用于开发者自定义Web页面响应、自定义文件资源响应等场景。</p>    <p>Web网页上发起资源加载请求，应用层收到资源请求信息。应用层构造本地资源响应信息发送给Web内核。Web内核解析应用层响应信息，根据此响应信息进行页面资源加载。</p>    <p>在下面的示例中，Web组件通过拦截页面请求“https://www.example.com/test.html”， 在应用侧代码构建响应资源，实现自定义页面响应场景。</p>    <ul>     <li>      <p>前端页面index.html代码。</p>      <div _ngcontent-ghy-c106="" class="highlight-div"><div _ngcontent-ghy-c106="" class="highlight-div-header"><div _ngcontent-ghy-c106="" class="highlight-div-header-left"><div _ngcontent-ghy-c106="" class="handle-button expand-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ghy-c106="" class="highlight-div-header-right"><div _ngcontent-ghy-c106="" class="handle-button ai-button"></div><div _ngcontent-ghy-c106="" class="handle-button line-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ghy-c106="" class="handle-button theme-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ghy-c106="" class="handle-button copy-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ghy-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-comment">&lt;!-- 页面资源请求 --&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com/test.html"</span>&gt;</span>intercept test!<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>     <li>      <p>应用侧代码。</p>      <div _ngcontent-ghy-c106="" class="highlight-div"><div _ngcontent-ghy-c106="" class="highlight-div-header"><div _ngcontent-ghy-c106="" class="highlight-div-header-left"><div _ngcontent-ghy-c106="" class="handle-button expand-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ghy-c106="" class="highlight-div-header-right"><div _ngcontent-ghy-c106="" class="handle-button ai-button"></div><div _ngcontent-ghy-c106="" class="handle-button line-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ghy-c106="" class="handle-button theme-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ghy-c106="" class="handle-button copy-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ghy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">responseResource</span>: <span class="hljs-title class_">WebResourceResponse</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebResourceResponse</span>();</li><li>  <span class="hljs-comment">// 开发者自定义响应数据</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">webData</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'&lt;!DOCTYPE html&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;html&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;head&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;title&gt;intercept test&lt;/title&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;/head&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;body&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;h1&gt;intercept ok&lt;/h1&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;/body&gt;\n'</span> +</li><li>    <span class="hljs-string">'&lt;/html&gt;'</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onInterceptRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'url:'</span> + event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>());</li><li>            <span class="hljs-comment">// 拦截页面请求</span></li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>() !== <span class="hljs-string">'https://www.example.com/test.html'</span>) {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>            }</li><li>          }</li><li>          <span class="hljs-comment">// 构造响应数据</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webData</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseMimeType</span>(<span class="hljs-string">'text/html'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseCode</span>(<span class="hljs-number">200</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setReasonMessage</span>(<span class="hljs-string">'OK'</span>);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>被拦截后的页面</p>      <p><span><img originheight="286" originwidth="369" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114739.27005026431981598400426940869566:50001231000000:2800:3E23F671BA326AA539F2B89AAB7C2F287F4A7DB4E6608D855072EE0376B5F41A.png" width="369" height="286"></span></p></li>    </ul>    <p>为自定义的JavaScript请求响应生成 CodeCache：自定义请求响应的资源类型如果是JavaScript脚本，可以在响应头中添加“ResponseDataID”字段，Web内核读取到该字段后会在为该JS资源生成CodeCache，加速JS执行，并且ResponseData如果有更新时必须更新该字段。不添加“ResponseDataID”字段的情况下默认不生成CodeCache。</p>    <p>在下面的示例中，Web组件通过拦截页面请求“https://www.example.com/test.js”， 应用侧代码构建响应资源，在响应头中添加“ResponseDataID”字段，开启生成CodeCache的功能。</p>    <ul>     <li>      <p>前端页面index.html代码。</p>      <div _ngcontent-ghy-c106="" class="highlight-div"><div _ngcontent-ghy-c106="" class="highlight-div-header"><div _ngcontent-ghy-c106="" class="highlight-div-header-left"><div _ngcontent-ghy-c106="" class="handle-button expand-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ghy-c106="" class="highlight-div-header-right"><div _ngcontent-ghy-c106="" class="handle-button ai-button"></div><div _ngcontent-ghy-c106="" class="handle-button line-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ghy-c106="" class="handle-button theme-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ghy-c106="" class="handle-button copy-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ghy-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-1"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-2"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-3"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-4"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-5"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-6"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-7"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-8"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-9"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-10"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-11"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.example.com/test.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div></li>     <li>      <p>应用侧代码。</p>      <div _ngcontent-ghy-c106="" class="highlight-div"><div _ngcontent-ghy-c106="" class="highlight-div-header"><div _ngcontent-ghy-c106="" class="highlight-div-header-left"><div _ngcontent-ghy-c106="" class="handle-button expand-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ghy-c106="" class="highlight-div-header-right"><div _ngcontent-ghy-c106="" class="handle-button ai-button"></div><div _ngcontent-ghy-c106="" class="handle-button line-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ghy-c106="" class="handle-button theme-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ghy-c106="" class="handle-button copy-button"><div _ngcontent-ghy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ghy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">responseResource</span>: <span class="hljs-title class_">WebResourceResponse</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebResourceResponse</span>();</li><li>  <span class="hljs-comment">// 开发者自定义响应数据（响应数据长度需大于等于1024才会生成codecache）</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">jsData</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'let text_msg = "the modified content:version 0000000000001";\n'</span> +</li><li>    <span class="hljs-string">'let element1 = window.document.getElementById("div-1");\n'</span> +</li><li>    <span class="hljs-string">'let element2 = window.document.getElementById("div-2");\n'</span> +</li><li>    <span class="hljs-string">'let element3 = window.document.getElementById("div-3");\n'</span> +</li><li>    <span class="hljs-string">'let element4 = window.document.getElementById("div-4");\n'</span> +</li><li>    <span class="hljs-string">'let element5 = window.document.getElementById("div-5");\n'</span> +</li><li>    <span class="hljs-string">'let element6 = window.document.getElementById("div-6");\n'</span> +</li><li>    <span class="hljs-string">'let element7 = window.document.getElementById("div-7");\n'</span> +</li><li>    <span class="hljs-string">'let element8 = window.document.getElementById("div-8");\n'</span> +</li><li>    <span class="hljs-string">'let element9 = window.document.getElementById("div-9");\n'</span> +</li><li>    <span class="hljs-string">'let element10 = window.document.getElementById("div-10");\n'</span> +</li><li>    <span class="hljs-string">'let element11 = window.document.getElementById("div-11");\n'</span> +</li><li>    <span class="hljs-string">'element1.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element2.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element3.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element4.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element5.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element6.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element7.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element8.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element9.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element10.innerHTML = text_msg;\n'</span> +</li><li>    <span class="hljs-string">'element11.innerHTML = text_msg;\n'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onInterceptRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// 拦截页面请求</span></li><li>          <span class="hljs-keyword">if</span> (event?.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>() == <span class="hljs-string">'https://www.example.com/test.js'</span>) {</li><li>            <span class="hljs-comment">// 构造响应数据</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseHeader</span>([</li><li>              {</li><li>                <span class="hljs-comment">// 格式：不超过13位纯数字。js识别码，Js有更新时必须更新该字段</span></li><li>                <span class="hljs-attr">headerKey</span>: <span class="hljs-string">"ResponseDataID"</span>,</li><li>                <span class="hljs-attr">headerValue</span>: <span class="hljs-string">"0000000000001"</span></li><li>              }]);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">jsData</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseMimeType</span>(<span class="hljs-string">'application/javascript'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setResponseCode</span>(<span class="hljs-number">200</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>.<span class="hljs-title function_">setReasonMessage</span>(<span class="hljs-string">'OK'</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseResource</span>;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>被拦截后的页面</p>      <p><span><img originheight="243" originwidth="369" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114739.25446341727220669657563551654055:50001231000000:2800:7318E057C46B868FB0D4ED995FC8782904693913CBB7E68E44AC0ED04EFD954F.png" width="369" height="243"></span></p></li>    </ul>   </div>   <div></div></div>