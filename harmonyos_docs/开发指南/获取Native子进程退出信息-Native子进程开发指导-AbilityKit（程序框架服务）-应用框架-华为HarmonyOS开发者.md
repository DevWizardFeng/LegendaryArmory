<h1 _ngcontent-qwh-c119="" class="doc-title ng-star-inserted" title="获取Native子进程退出信息"> 获取Native子进程退出信息 </h1>

<div _ngcontent-qwh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>从API version 20开始，支持父进程通过注册回调函数监听子进程，获取子进程异常退出信息，以便父进程做后续优化处理。这里支持监听的子进程必须为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_startnativechildprocess" target="_blank">OH_Ability_StartNativeChildProcess</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-childprocessmanager#childprocessmanagerstartnativechildprocess13" target="_blank">startNativeChildProcess</a>接口创建的子进程。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#ability_nativechildprocess_errcode" target="_blank">Ability_NativeChildProcess_ErrCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_registernativechildprocessexitcallback" target="_blank">OH_Ability_RegisterNativeChildProcessExitCallback</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_onnativechildprocessexit" target="_blank">OH_Ability_OnNativeChildProcessExit</a> onProcessExit)</td>         <td class="cellrowborder" valign="top" width="50%">注册子进程退出回调函数。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#ability_nativechildprocess_errcode" target="_blank">Ability_NativeChildProcess_ErrCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_unregisternativechildprocessexitcallback" target="_blank">OH_Ability_UnregisterNativeChildProcessExitCallback</a> (<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_onnativechildprocessexit" target="_blank">OH_Ability_OnNativeChildProcessExit</a> onProcessExit)</td>         <td class="cellrowborder" valign="top" width="50%">解注册子进程退出回调函数。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p><strong>动态库文件</strong></p>     <div _ngcontent-qwh-c106="" class="highlight-div"><div _ngcontent-qwh-c106="" class="highlight-div-header"><div _ngcontent-qwh-c106="" class="highlight-div-header-left"><div _ngcontent-qwh-c106="" class="handle-button expand-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qwh-c106="" class="highlight-div-header-right"><div _ngcontent-qwh-c106="" class="handle-button ai-button"></div><div _ngcontent-qwh-c106="" class="handle-button line-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qwh-c106="" class="handle-button theme-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qwh-c106="" class="handle-button copy-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qwh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libchild_process.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-qwh-c106="" class="highlight-div"><div _ngcontent-qwh-c106="" class="highlight-div-header"><div _ngcontent-qwh-c106="" class="highlight-div-header-left"><div _ngcontent-qwh-c106="" class="handle-button expand-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qwh-c106="" class="highlight-div-header-right"><div _ngcontent-qwh-c106="" class="handle-button ai-button"></div><div _ngcontent-qwh-c106="" class="handle-button line-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qwh-c106="" class="handle-button theme-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qwh-c106="" class="handle-button copy-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qwh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>主进程-注册和解注册Native子进程异常退出回调。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_registernativechildprocessexitcallback" target="_blank">OH_Ability_RegisterNativeChildProcessExitCallback</a>注册Native子进程，如果返回值为NCP_NO_ERROR表示注册成功。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_unregisternativechildprocessexitcallback" target="_blank">OH_Ability_UnregisterNativeChildProcessExitCallback</a>解注册Native子进程，如果返回值为NCP_NO_ERROR表示解注册成功。</p>       <div _ngcontent-qwh-c106="" class="highlight-div"><div _ngcontent-qwh-c106="" class="highlight-div-header"><div _ngcontent-qwh-c106="" class="highlight-div-header-left"><div _ngcontent-qwh-c106="" class="handle-button expand-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qwh-c106="" class="highlight-div-header-right"><div _ngcontent-qwh-c106="" class="handle-button ai-button"></div><div _ngcontent-qwh-c106="" class="handle-button line-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qwh-c106="" class="handle-button theme-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qwh-c106="" class="handle-button copy-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qwh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnNativeChildProcessExit</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> pid, <span class="hljs-type">int32_t</span> signal)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(<span class="hljs-string">"pid: %{public}d, signal: %{public}d"</span>, pid, signal);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterNativeChildProcessExitCallback</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    Ability_NativeChildProcess_ErrCode ret = <span class="hljs-built_in">OH_Ability_RegisterNativeChildProcessExitCallback</span>(OnNativeChildProcessExit);</li><li>    <span class="hljs-keyword">if</span> (ret != NCP_NO_ERROR) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(<span class="hljs-string">"register failed."</span>);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">UnregisterNativeChildProcessExitCallback</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    Ability_NativeChildProcess_ErrCode ret = <span class="hljs-built_in">OH_Ability_UnregisterNativeChildProcessExitCallback</span>(OnNativeChildProcessExit);</li><li>    <span class="hljs-keyword">if</span> (ret != NCP_NO_ERROR) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(<span class="hljs-string">"unregister failed."</span>);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>主进程-添加编译依赖项。</p>       <p>修改CMaklist.txt添加必要的依赖库，假设主进程所在的so名称为libmainprocesssample.so（主进程和子进程的实现也可以选择编译到同一个动态库文件）。</p>       <div _ngcontent-qwh-c106="" class="highlight-div"><div _ngcontent-qwh-c106="" class="highlight-div-header"><div _ngcontent-qwh-c106="" class="highlight-div-header-left"><div _ngcontent-qwh-c106="" class="handle-button expand-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qwh-c106="" class="highlight-div-header-right"><div _ngcontent-qwh-c106="" class="handle-button ai-button"></div><div _ngcontent-qwh-c106="" class="handle-button line-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qwh-c106="" class="handle-button theme-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qwh-c106="" class="handle-button copy-button"><div _ngcontent-qwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qwh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(mainprocesssample PUBLIC</li><li>    # 添加依赖的元能力动态库</li><li>    libchild_process.so</li><li>   </li><li>    # 其它依赖的动态库</li><li>    # ...</li><li>)</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>