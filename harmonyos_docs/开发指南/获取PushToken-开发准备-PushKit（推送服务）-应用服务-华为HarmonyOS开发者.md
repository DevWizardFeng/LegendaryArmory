<h1 _ngcontent-chv-c119="" class="doc-title ng-star-inserted" title="获取Push Token"> 获取Push Token </h1>

<div _ngcontent-chv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section123091617105820">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section123091617105820" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>Push Kit对Push Token进行了推送服务权益校验，请在进行开发前先阅读<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-config-setting">开通推送服务</a>章节，完成相关配置。</p>      </div></div></div>     <p>Push Token标识了每台设备上每个应用，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>()接口向Push Kit服务端请求Push Token，获取到之后使用Push Token来推送消息。</p>     <p>Push Token一般情况不会变化，仅下列场景会导致之前的Push Token发生变化而失效：</p>     <ul>      <li class="MsoNormal">卸载应用后重新安装。</li>      <li>设备恢复出厂设置。</li>      <li class="MsoNormal">应用显式调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section1298316346493" target="_blank">deleteToken</a>()接口后重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>()接口。</li>      <li>应用显式调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-aaid-api#section18269336164311" target="_blank">deleteAAID</a>()接口后重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>()接口。</li>      <li>将设备（仅涉及Wearable设备）拿到海外其他国家或者地区后，系统会更新设备的token。更新后的token通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section1730794845210" target="_blank">pushService.on('tokenUpdate')</a>接口的回调返回。</li>     </ul>     <p>因此，建议您在应用启动时调用getToken()接口，若设备的Push Token发生变化，及时上报到您的应用服务器更新Push Token，以防由于Push Token失效导致收不到消息。</p>    </div>    <div class="tiledSection">     <h2 id="section842412232016">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section842412232016" tips="复制节点链接"></i></h2>          <p>获取Push Token能力支持Phone、Tablet、PC/2in1设备。并且从5.1.0(18)版本开始新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section103671738121314">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section103671738121314" tips="复制节点链接"></i></h2>          <ul>      <li>请勿使用Push Token跟踪标记用户。</li>      <li>应用不要固定判断Push Token长度，因为Push Token长度可能会变化。</li>      <li>禁止应用频繁申请Push Token。建议应用每次启动时获取Push Token。</li>      <li>只有在<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>平台<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-config-setting">开通推送服务</a>后，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>方法才会返回Push Token。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section24845415583">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section24845415583" tips="复制节点链接"></i></h2>          <p>接口返回值有两种返回形式：Callback和Promise回调。下表中仅展示Promise回调形式的接口，Promise和Callback只是返回值方式不一样，功能相同。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50.22%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="49.78%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50.22%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>(): Promise&lt;string&gt;</p></td>         <td class="cellrowborder" valign="top" width="49.78%">          <p>以Promise形式获取Push Token。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50.22%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section1298316346493" target="_blank">deleteToken</a>(): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="49.78%">          <p>以Promise形式删除Push Token。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section85173618105">获取Push Token<i class="anchor-icon anchor-icon-link" anchorid="section85173618105" tips="复制节点链接"></i></h2>          <ol>      <li><span>Push Kit对Push Token进行了推送服务权益校验，请在进行开发前先阅读<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/push-config-setting">开通推送服务</a>章节，完成相关配置。</span></li>      <li><span>导入pushService模块及相关公共模块。</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { pushService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>建议在您的UIAbility（例如EntryAbility）的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>()方法中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section562973524818" target="_blank">getToken</a>()接口获取Push Token并上报到您的服务端，方便您的服务端向终端推送消息。代码示例：</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/entryability/EntryAbility.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// 入参 want 与 launchParam 并未使用，为初始化项目时自带参数</span></li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取Push Token</span></li><li><span class="">    pushService</span><span class="">.</span><span class=""><span class="hljs-title function_">getToken</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(</span><span class=""><span class="hljs-function"><span class="hljs-params">token</span> </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in getting push token'</span></span><span class="">)</span><span class="">;</span></li><li><span class="">    }</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">BusinessError</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Failed to get push token: %{public}d %{public}s'</span></span><span class="">, </span><span class="">err</span><span class="">.</span><span class=""><span class="hljs-property">code</span></span><span class="">, </span><span class="">err</span><span class="">.</span><span class=""><span class="hljs-property">message</span></span><span class="">)</span><span class="">;</span></li><li><span class="">    }</span><span class="">)</span></li><li>    <span class="hljs-comment">// 上报Push Token并上报到您的服务端</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>若您获取Push Token时发生APP身份验证失败错误（1000900010），请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-error-code#section3835124673016" target="_blank">ArkTS API错误码</a>排查。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section186103651013">删除Push Token<i class="anchor-icon anchor-icon-link" anchorid="section186103651013" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>删除Push Token后，本应用下的所有Push Kit历史数据会一并删除。非必要情况，请您不要主动调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section1298316346493" target="_blank">deleteToken</a>()接口。</p>      </div></div></div>     <ol>      <li><span>导入pushService模块</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { pushService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span><span class="">;</span></li></ol></pre></div></div>       <p></p></li>      <li><span>调用PushService.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/push-pushservice#section1298316346493" target="_blank">deleteToken</a>()接口删除Push Token。代码示例：</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 文件路径: src/main/ets/entryability/EntryAbility.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">myDeletePushToken</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> pushService.<span class="hljs-title function_">deleteToken</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in deleting push token'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to delete push token: %{public}d %{public}s'</span>, e.<span class="hljs-property">code</span>, e.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="json" id="section732116257269">     <a name="section732116257269"></a><a name="section732116257269"></a>     <h4>Push Token更新回调</h4>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>该接口目前仅支持Wearable设备。</p>       <p>当设备离开当前国家或地区时，可能会触发Push Token自动更新，如果应用期望感知到Push Token更新事件，需要调用on接口进行回调注册；对应的，可以调用off接口解除回调注册，解除后当Push Token更新时，应用将不会收到回调。</p>      </div></div></div>     <ol>      <li><span>导入pushService模块</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { pushService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PushKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在您项目的ability（下以PushMessageAbility为例）内导入push模块，调用on()方法接收token更新的消息。注意，您仅能使用UIAbility接收token更新消息。代码示例：</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// </span><span class=""><span class="hljs-comment">文件路径: src/main/ets/abilities/PushMessageAbility.ets</span></span></li><li><span class=""><span class="hljs-keyword">import</span></span> { <span class=""><span class="hljs-title class_">UIAbility</span></span> } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span>;</li><li><span class=""><span class="hljs-keyword">import</span></span> { pushService } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.PushKit'</span></span>;</li><li><span class=""><span class="hljs-keyword">import</span></span> { hilog } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span>;</li><li><span class=""><span class="hljs-keyword">import</span></span> { <span class=""><span class="hljs-title class_">BusinessError</span></span> } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.BasicServicesKit'</span></span>;</li><li>
</li><li><span class=""><span class="hljs-comment">// 无需新增UIAbility，在原有UIAbility的onCreate方法中调用即可。以PushMessageAbility为例 </span></span></li><li><span class=""><span class="hljs-keyword">export</span></span> <span class=""><span class="hljs-keyword">default</span></span> <span class=""><span class="hljs-keyword">class</span></span> <span class=""><span class="hljs-title class_">PushMessageAbility</span></span> <span class=""><span class="hljs-keyword">extends</span></span> <span class=""><span class="hljs-title class_ inherited__">UIAbility</span></span> {</li><li><span class="">  <span class="hljs-title function_">onCreate</span></span>(): <span class=""><span class="hljs-built_in">void</span></span> {</li><li><span class="">    <span class="hljs-keyword">const</span></span> <span class=""><span class="hljs-title function_">callBack</span></span> = (<span class=""><span class="hljs-params">data: <span class="hljs-built_in">string</span></span></span>) =&gt; {</li><li><span class="">      <span class="hljs-keyword">try</span></span> {</li><li>        hilog.<span class=""><span class="hljs-title function_">info</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'update token: %{public}s'</span></span>, data);</li><li>      } <span class=""><span class="hljs-keyword">catch</span></span> (e) {</li><li><span class="">        <span class="hljs-keyword">let</span></span> <span class=""><span class="hljs-attr">err</span></span>: <span class=""><span class="hljs-title class_">BusinessError</span></span> = e <span class=""><span class="hljs-keyword">as</span></span> <span class=""><span class="hljs-title class_">BusinessError</span></span>;</li><li>        hilog.<span class=""><span class="hljs-title function_">error</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'Failed to update data: %{public}d %{public}s'</span></span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>      }</li><li>    }</li><li>
</li><li><span class="">    <span class="hljs-keyword">try</span></span> {</li><li><span class="">      <span class="hljs-comment">// 注册token更新回调场景</span></span></li><li>      pushService.<span class=""><span class="hljs-title function_">on</span></span>(<span class=""><span class="hljs-string">'tokenUpdate'</span></span>, <span class=""><span class="hljs-variable language_">this</span></span>, callBack);</li><li>      hilog.<span class=""><span class="hljs-title function_">info</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'Register on success'</span></span>);</li><li>    } <span class=""><span class="hljs-keyword">catch</span></span> (e) {</li><li><span class="">      <span class="hljs-keyword">let</span></span> <span class=""><span class="hljs-attr">err</span></span>: <span class=""><span class="hljs-title class_">BusinessError</span></span> = e <span class=""><span class="hljs-keyword">as</span></span> <span class=""><span class="hljs-title class_">BusinessError</span></span>;</li><li>      hilog.<span class=""><span class="hljs-title function_">error</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'Register on error: %{public}d %{public}s'</span></span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>
</li><li><span class="">  <span class="hljs-title function_">onDestroy</span></span>(): <span class=""><span class="hljs-built_in">void</span></span> {</li><li><span class="">    <span class="hljs-keyword">try</span></span> {</li><li><span class="">      <span class="hljs-comment">// 解除注册token更新回调场景</span></span></li><li>      pushService.<span class=""><span class="hljs-title function_">off</span></span>(<span class=""><span class="hljs-string">'tokenUpdate'</span></span>);</li><li>      hilog.<span class=""><span class="hljs-title function_">info</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'Register off success'</span></span>);</li><li>    } <span class=""><span class="hljs-keyword">catch</span></span> (e) {</li><li><span class="">      <span class="hljs-keyword">let</span></span> <span class=""><span class="hljs-attr">err</span></span>: <span class=""><span class="hljs-title class_">BusinessError</span></span> = e <span class=""><span class="hljs-keyword">as</span></span> <span class=""><span class="hljs-title class_">BusinessError</span></span>;</li><li>      hilog.<span class=""><span class="hljs-title function_">error</span></span>(<span class=""><span class="hljs-number">0x0000</span></span>, <span class=""><span class="hljs-string">'testTag'</span></span>, <span class=""><span class="hljs-string">'Register off error: %{public}d %{public}s'</span></span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>在项目工程的 src/main/module.json5文件的abilities模块的<strong>skills</strong>标签中配置<strong>actions</strong>内容为<strong>action.ohos.push.listener</strong>（有且只能有一个ability定义该action，<strong>若同时添加</strong><strong>uris</strong><strong>参数，则uris</strong><strong>内容需为空</strong>）。</span>       <p></p>       <div _ngcontent-chv-c106="" class="highlight-div"><div _ngcontent-chv-c106="" class="highlight-div-header"><div _ngcontent-chv-c106="" class="highlight-div-header-left"><div _ngcontent-chv-c106="" class="handle-button expand-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chv-c106="" class="highlight-div-header-right"><div _ngcontent-chv-c106="" class="handle-button ai-button"></div><div _ngcontent-chv-c106="" class="handle-button line-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chv-c106="" class="handle-button theme-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chv-c106="" class="handle-button copy-button"><div _ngcontent-chv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chv-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-attr">"abilities"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class="hljs-punctuation">[</span></li><li>  <span class="hljs-punctuation">{</span></li><li>    <span class=""><span class="hljs-attr">"name"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"PushMessageAbility"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"srcEntry"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"./ets/abilities/PushMessageAbility.ets"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"launchType"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"singleton"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"startWindowIcon"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"$media:startIcon"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"startWindowBackground"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class=""><span class="hljs-string">"$color:start_window_background"</span></span><span class=""><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"exported"</span></span><span class=""><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span></span></li><li>    <span class=""><span class="hljs-attr">"skills"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class=""><span class="hljs-attr">"actions"</span></span><span class=""><span class="hljs-punctuation">:</span> </span><span class="hljs-punctuation">[</span></li><li>          <span class=""><span class="hljs-string">"action.ohos.push.listener"</span></span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">]</span></li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>