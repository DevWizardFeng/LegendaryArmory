<h1 _ngcontent-emr-c119="" class="doc-title ng-star-inserted" title="获取分享结果"> 获取分享结果 </h1>

<div _ngcontent-emr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section17601877817">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section17601877817" tips="复制节点链接"></i></h2>          <p>从5.1.0(18)版本开始，支持宿主应用获取用户分享结果。</p>     <p>基于业务实现需要，开发者可统计用户使用分享功能时，将内容分享到了哪些渠道。渠道信息规则如下：</p>     <ul>      <li>系统操作有固定名称。请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-system-share#section16531512163920" target="_blank">ShareAbilityName</a>。</li>      <li>非系统操作采用'[bundleName]#[moduleName]#[abilityName]'格式拼接。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section130421319817">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section130421319817" tips="复制节点链接"></i></h2>          <ol>      <li>导入相关模块。       <div _ngcontent-emr-c106="" class="highlight-div"><div _ngcontent-emr-c106="" class="highlight-div-header"><div _ngcontent-emr-c106="" class="highlight-div-header-left"><div _ngcontent-emr-c106="" class="handle-button expand-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-emr-c106="" class="highlight-div-header-right"><div _ngcontent-emr-c106="" class="handle-button ai-button"></div><div _ngcontent-emr-c106="" class="handle-button line-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-emr-c106="" class="handle-button theme-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-emr-c106="" class="handle-button copy-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-emr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { systemShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor <span class="hljs-keyword">as</span> utd } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li></ol></pre></div></div></li>      <li>构造分享数据。       <div _ngcontent-emr-c106="" class="highlight-div"><div _ngcontent-emr-c106="" class="highlight-div-header"><div _ngcontent-emr-c106="" class="highlight-div-header-left"><div _ngcontent-emr-c106="" class="handle-button expand-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-emr-c106="" class="highlight-div-header-right"><div _ngcontent-emr-c106="" class="handle-button ai-button"></div><div _ngcontent-emr-c106="" class="handle-button line-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-emr-c106="" class="handle-button theme-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-emr-c106="" class="handle-button copy-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-emr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构造ShareData，需配置一条有效数据信息</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: systemShare.<span class="hljs-property">SharedData</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">SharedData</span>({</li><li>  <span class="hljs-attr">utd</span>: utd.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>,</li><li>  <span class="hljs-attr">content</span>: <span class="hljs-string">'Hello HarmonyOS'</span></li><li>});</li></ol></pre></div></div></li>      <li>注册分享结果监听事件，并启动分享面板。       <div _ngcontent-emr-c106="" class="highlight-div"><div _ngcontent-emr-c106="" class="highlight-div-header"><div _ngcontent-emr-c106="" class="highlight-div-header-left"><div _ngcontent-emr-c106="" class="handle-button expand-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-emr-c106="" class="highlight-div-header-right"><div _ngcontent-emr-c106="" class="handle-button ai-button"></div><div _ngcontent-emr-c106="" class="handle-button line-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-emr-c106="" class="handle-button theme-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-emr-c106="" class="handle-button copy-button"><div _ngcontent-emr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-emr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构建ShareController</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">controller</span>: systemShare.<span class="hljs-property">ShareController</span> = <span class="hljs-keyword">new</span> systemShare.<span class="hljs-title class_">ShareController</span>(data);</li><li><span class="hljs-comment">// 获取UIAbility上下文对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = uiContext.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-comment">// 注册分享结果事件监听</span></li><li>controller.<span class="hljs-title function_">on</span>(<span class="hljs-string">'shareCompleted'</span>, <span class="hljs-function">(<span class="hljs-params">result: systemShare.ShareOperationResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'shareCompleted name:'</span>, result.<span class="hljs-property">targetAbilityInfo</span>.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-comment">// 可根据分享渠道进行数据统计等操作</span></li><li>});</li><li>
</li><li><span class="hljs-comment">// 进行分享面板显示</span></li><li>controller.<span class="hljs-title function_">show</span>(context, {</li><li>  <span class="hljs-attr">previewMode</span>: systemShare.<span class="hljs-property">SharePreviewMode</span>.<span class="hljs-property">DEFAULT</span>,</li><li>  <span class="hljs-attr">selectionMode</span>: systemShare.<span class="hljs-property">SelectionMode</span>.<span class="hljs-property">SINGLE</span></li><li>});</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>