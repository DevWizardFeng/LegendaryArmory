<h1 _ngcontent-hlm-c119="" class="doc-title ng-star-inserted" title="获取天气数据"> 获取天气数据 </h1>

<div _ngcontent-hlm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>通过开发者提供的经纬度数据，获取天气数据，比如：实况数据、预警数据。</p>    <div class="tiledSection">     <h2 id="section792210101719">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section792210101719" tips="复制节点链接"></i></h2>          <p>本kit支持Phone、Tablet、PC/2in1设备，并且从5.1.0(18)版本开始，新增支持Wearable设备。</p>    </div>    <div class="tiledSection">     <h2 id="section546501255">（可选）获取当前位置经纬度<i class="anchor-icon anchor-icon-link" anchorid="section546501255" tips="复制节点链接"></i></h2>          <p>当开发者需要查询当前位置的天气数据时，需要先<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#申请权限" target="_blank">申请位置权限</a>，并且获取当前位置的经纬度信息。获取当前位置的经纬度信息方法如下：</p>     <ol>      <li><span>导入模块。</span>       <p></p>       <div _ngcontent-hlm-c106="" class="highlight-div"><div _ngcontent-hlm-c106="" class="highlight-div-header"><div _ngcontent-hlm-c106="" class="highlight-div-header-left"><div _ngcontent-hlm-c106="" class="handle-button expand-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hlm-c106="" class="highlight-div-header-right"><div _ngcontent-hlm-c106="" class="handle-button ai-button"></div><div _ngcontent-hlm-c106="" class="handle-button line-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hlm-c106="" class="handle-button theme-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hlm-c106="" class="handle-button copy-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hlm-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagergetcurrentlocation-2" target="_blank">getCurrentLocation</a>，获取经纬度。</span>       <p></p>       <div _ngcontent-hlm-c106="" class="highlight-div"><div _ngcontent-hlm-c106="" class="highlight-div-header"><div _ngcontent-hlm-c106="" class="highlight-div-header-left"><div _ngcontent-hlm-c106="" class="handle-button expand-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hlm-c106="" class="highlight-div-header-right"><div _ngcontent-hlm-c106="" class="handle-button ai-button"></div><div _ngcontent-hlm-c106="" class="handle-button line-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hlm-c106="" class="handle-button theme-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hlm-c106="" class="handle-button copy-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hlm-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'current location latitude: '</span> + result.<span class="hljs-property">latitude</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'current location longitude: '</span> + result.<span class="hljs-property">longitude</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError </span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getCurrentLocation failed. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section197992018613">查询天气数据<i class="anchor-icon anchor-icon-link" anchorid="section197992018613" tips="复制节点链接"></i></h2>          <p>Weather Service Kit依赖开发者提供的经纬度数据（精确到小数点后2位），返回格点天气数据。</p>     <ol>      <li><span>导入模块。</span>       <p></p>       <div _ngcontent-hlm-c106="" class="highlight-div"><div _ngcontent-hlm-c106="" class="highlight-div-header"><div _ngcontent-hlm-c106="" class="highlight-div-header-left"><div _ngcontent-hlm-c106="" class="handle-button expand-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hlm-c106="" class="highlight-div-header-right"><div _ngcontent-hlm-c106="" class="handle-button ai-button"></div><div _ngcontent-hlm-c106="" class="handle-button line-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hlm-c106="" class="handle-button theme-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hlm-c106="" class="handle-button copy-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hlm-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { weatherService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WeatherServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>创建请求对象。</span>       <p></p>       <ul>        <li>location：使用<a href="/consumer/cn/doc/harmonyos-guides/weather-service-getweather#section546501255">当前位置</a>的数据，或者填入查询目的地的经纬度。</li>        <li>limitedDatasets：为可选字段，传入一个数组，表示请求有限的数据集，取值范围参考weatherService.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/weather-service-weatherservice#section83091727192814" target="_blank">Dataset</a>。</li>       </ul>       <div _ngcontent-hlm-c106="" class="highlight-div"><div _ngcontent-hlm-c106="" class="highlight-div-header"><div _ngcontent-hlm-c106="" class="highlight-div-header-left"><div _ngcontent-hlm-c106="" class="handle-button expand-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hlm-c106="" class="highlight-div-header-right"><div _ngcontent-hlm-c106="" class="handle-button ai-button"></div><div _ngcontent-hlm-c106="" class="handle-button line-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hlm-c106="" class="handle-button theme-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hlm-c106="" class="handle-button copy-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hlm-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: weatherService.<span class="hljs-property">WeatherRequest</span> = {</li><li>  <span class="hljs-attr">location</span>: {</li><li>    <span class="hljs-attr">latitude</span>: <span class="hljs-number">22.62</span>,</li><li>    <span class="hljs-attr">longitude</span>: <span class="hljs-number">114.07</span></li><li>  },</li><li>  <span class="hljs-attr">limitedDatasets</span>: [weatherService.<span class="hljs-property">Dataset</span>.<span class="hljs-property">CURRENT</span>, weatherService.<span class="hljs-property">Dataset</span>.<span class="hljs-property">ALERTS</span>]</li><li>}</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>如果limitedDatasets参数不传值，或者传入的数组为空，则默认返回Weather Service Kit支持的所有数据。根据实际需要的天气数据设置limitedDatasets，可以大幅降低接口请求时延。</p>        </div></div></div>       <p></p></li>      <li><span>请求数据。</span>       <p></p>       <div _ngcontent-hlm-c106="" class="highlight-div"><div _ngcontent-hlm-c106="" class="highlight-div-header"><div _ngcontent-hlm-c106="" class="highlight-div-header-left"><div _ngcontent-hlm-c106="" class="handle-button expand-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hlm-c106="" class="highlight-div-header-right"><div _ngcontent-hlm-c106="" class="handle-button ai-button"></div><div _ngcontent-hlm-c106="" class="handle-button line-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hlm-c106="" class="handle-button theme-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hlm-c106="" class="handle-button copy-button"><div _ngcontent-hlm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hlm-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> weather = <span class="hljs-keyword">await</span> weatherService.<span class="hljs-title function_">getWeather</span>(request);</li><li>  <span class="hljs-keyword">if</span> (weather.<span class="hljs-property">current</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getWeather current temperature: '</span> + weather.<span class="hljs-property">current</span>.<span class="hljs-property">temperature</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (weather.<span class="hljs-property">alerts</span>?.<span class="hljs-property">length</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getWeather alert: '</span> + weather.<span class="hljs-property">alerts</span>[<span class="hljs-number">0</span>].<span class="hljs-property">title</span>);</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  err = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getWeather failed. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>getWeather接口的使用依赖当前Ability的Context，如果开发者在无法通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#gethostcontext12" target="_blank">getHostContext()</a>接口获取到Context的环境中请求天气数据，例如使用worker或者taskpool的子线程场景，请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/weather-service-weatherservice#section25641843201511" target="_blank">weatherService.getWeatherWithContext(context, request)</a>方法并提供Ability的Context信息。</p>        </div></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>