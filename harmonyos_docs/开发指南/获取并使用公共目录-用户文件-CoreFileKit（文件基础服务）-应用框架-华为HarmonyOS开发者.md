<h1 _ngcontent-hwj-c119="" class="doc-title ng-star-inserted" title="获取并使用公共目录"> 获取并使用公共目录 </h1>

<div _ngcontent-hwj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="通过-arkts-接口获取并访问公共目录">通过 ArkTS 接口获取并访问公共目录<i class="anchor-icon anchor-icon-link" anchorid="通过-arkts-接口获取并访问公共目录" tips="复制节点链接"></i></h2>          <p>目录环境能力接口（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-environment" target="_blank">ohos.file.environment</a>）提供获取公共目录路径的能力，支持三方应用在公共文件用户目录下进行文件访问操作。</p>     <p><strong>约束限制</strong></p>     <ul>      <li>使用此方式，需确认设备具有以下系统能力：SystemCapability.FileManagement.File.Environment.FolderObtain，当前仅支持2in1设备。       <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (!<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.FileManagement.File.Environment.FolderObtain'</span>)) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'this api is not supported on this device'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div></li>      <li>公共目录获取接口仅用于获取公共目录路径，不对公共目录访问权限进行校验。若需访问公共目录需申请对应的公共目录访问权限。三方应用需要访问公共目录时，需通过弹窗授权向用户申请授予 Download 目录权限、Documents 目录权限或 Desktop 目录权限，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">访问控制-向用户申请授权</a>。</li>     </ul>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li>   <span class="hljs-attr">"requestPermissions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>       <span class="hljs-string">"ohos.permission.READ_WRITE_DOWNLOAD_DIRECTORY"</span><span class="hljs-punctuation">,</span></li><li>       <span class="hljs-string">"ohos.permission.READ_WRITE_DOCUMENTS_DIRECTORY"</span><span class="hljs-punctuation">,</span></li><li>   <span class="hljs-punctuation">]</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="示例" class="firsth2">示例<i class="anchor-icon anchor-icon-link" anchorid="示例" tips="复制节点链接"></i></h3>          <p>1.获取公共目录路径。</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Environment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDirExample</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">const</span> downloadPath = <span class="hljs-title class_">Environment</span>.<span class="hljs-title function_">getUserDownloadDir</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success to getUserDownloadDir: <span class="hljs-subst">${downloadPath}</span>`</span>);</li><li>        <span class="hljs-keyword">const</span> documentsPath = <span class="hljs-title class_">Environment</span>.<span class="hljs-title function_">getUserDocumentDir</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success to getUserDocumentDir: <span class="hljs-subst">${documentsPath}</span>`</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`failed to get user dir, Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>     <p>2.以 Download 目录为例，访问 Download 目录下的文件。</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Environment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">readUserDownloadDirExample</span>(<span class="hljs-params">context: common.UIAbilityContext</span>) {</li><li>    <span class="hljs-comment">// 检查是否具有 READ_WRITE_DOWNLOAD_DIRECTORY 权限，无权限则需要向用户申请授予权限。</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// 获取 Download 目录</span></li><li>        <span class="hljs-keyword">const</span> downloadPath = <span class="hljs-title class_">Environment</span>.<span class="hljs-title function_">getUserDownloadDir</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success to getUserDownloadDir: <span class="hljs-subst">${downloadPath}</span>`</span>);</li><li>        <span class="hljs-keyword">const</span> dirPath = context.<span class="hljs-property">filesDir</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success to get filesDir: <span class="hljs-subst">${dirPath}</span>`</span>);</li><li>        <span class="hljs-comment">// 查看 Download 目录下的文件并拷贝到沙箱目录中</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">fileList</span>: <span class="hljs-built_in">string</span>[] = fs.<span class="hljs-title function_">listFileSync</span>(downloadPath);</li><li>        fileList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${downloadPath}</span> <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${file}</span>`</span>);</li><li>            fs.<span class="hljs-title function_">copyFileSync</span>(<span class="hljs-string">`<span class="hljs-subst">${downloadPath}</span>/<span class="hljs-subst">${file}</span>`</span>, <span class="hljs-string">`<span class="hljs-subst">${dirPath}</span>/<span class="hljs-subst">${file}</span>`</span>);</li><li>        });</li><li>        <span class="hljs-comment">// 查看沙箱目录下对应的文件</span></li><li>        fileList = fs.<span class="hljs-title function_">listFileSync</span>(dirPath);</li><li>        fileList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file, index</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${dirPath}</span> <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${file}</span>`</span>);</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>     <p>3.以 Download 目录为例，保存文件到 Download 目录。</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Environment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">writeUserDownloadDirExample</span>(<span class="hljs-params"></span>) {</li><li><span class="hljs-comment">// 检查是否具有 READ_WRITE_DOWNLOAD_DIRECTORY 权限，无权限则需要向用户申请授予权限。</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// 获取 Download 目录</span></li><li>        <span class="hljs-keyword">const</span> downloadPath = <span class="hljs-title class_">Environment</span>.<span class="hljs-title function_">getUserDownloadDir</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`success to getUserDownloadDir: <span class="hljs-subst">${downloadPath}</span>`</span>);</li><li>        <span class="hljs-comment">// 保存 temp.txt 到 Download 目录下</span></li><li>        <span class="hljs-keyword">const</span> file = fs.<span class="hljs-title function_">openSync</span>(<span class="hljs-string">`<span class="hljs-subst">${downloadPath}</span>/temp.txt`</span>, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>        fs.<span class="hljs-title function_">writeSync</span>(file.<span class="hljs-property">fd</span>, <span class="hljs-string">'write a message'</span>);</li><li>        fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过-cc-接口获取并使用公共目录">通过 C/C++ 接口获取并使用公共目录<i class="anchor-icon anchor-icon-link" anchorid="通过-cc-接口获取并使用公共目录" tips="复制节点链接"></i></h2>          <p>除了通过 ArkTS 访问公共目录的方式，也可通过 C/C++ 接口进行目录访问，具体可以参考 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-environment-h" target="_blank">Environment</a>。</p>     <p><strong>约束限制</strong></p>     <ul>      <li>使用此接口，需确认设备具有以下系统能力：SystemCapability.FileManagement.File.Environment.FolderObtain。</li>      <li>三方应用需要访问公共目录时，需通过弹窗授权向用户申请授予 Download 目录权限、Documents 目录权限或 Desktop 目录权限，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">访问控制-向用户申请授权</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="接口说明" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3>          <p>接口的详细说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-environment-h" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDownloadDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Download目录沙箱路径。只支持2in1设备</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDesktopDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Desktop目录沙箱路径。只支持2in1设备</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDocumentDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Document目录沙箱路径。只支持2in1设备</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <p><strong>在CMake脚本中链接动态库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(sample PUBLIC libohenvironment.so libhilog_ndk.z.so)</li></ol></pre></div></div>     <p><strong>添加头文件</strong></p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filemanagement/environment/oh_environment.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filemanagement/fileio/oh_fileio.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div>     <p>1.调用 OH_Environment_GetUserDownloadDir 接口获取用户 Download 目录沙箱路径，在接口中使用malloc申请的内存需要在使用完后释放因此需要free对应的内存。示例代码如下所示：</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">GetUserDownloadDirExample</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">char</span> *downloadPath = <span class="hljs-literal">nullptr</span>;</li><li>    FileManagement_ErrCode ret = <span class="hljs-built_in">OH_Environment_GetUserDownloadDir</span>(&amp;downloadPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Download Path=%{public}s"</span>, downloadPath);</li><li>        <span class="hljs-built_in">free</span>(downloadPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"GetDownloadPath fail, error code is %{public}d"</span>, ret);</li><li>    }</li><li>}</li></ol></pre></div></div>     <p>2.调用 OH_Environment_GetUserDownloadDir 接口获取用户 Download 目录沙箱路径，并查看 Download 目录下的文件。示例代码如下所示：</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;dirent.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ScanUserDownloadDirPathExample</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取 download 路径</span></li><li>    <span class="hljs-type">char</span> *downloadPath = <span class="hljs-literal">nullptr</span>;</li><li>    FileManagement_ErrCode ret = <span class="hljs-built_in">OH_Environment_GetUserDownloadDir</span>(&amp;downloadPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Download Path=%{public}s"</span>, downloadPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"GetDownloadPath fail, error code is %{public}d"</span>, ret);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 查看文件夹下的文件</span></li><li>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dirent</span> **namelist = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">int</span> num = <span class="hljs-built_in">scandir</span>(downloadPath, &amp;namelist, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (num &lt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">free</span>(downloadPath);</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"Failed to scan dir"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"%{public}s"</span>, namelist[i]-&gt;d_name);</li><li>    }</li><li>    <span class="hljs-built_in">free</span>(downloadPath);</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num; i++) {</li><li>        <span class="hljs-built_in">free</span>(namelist[i]);</li><li>    }</li><li>    <span class="hljs-built_in">free</span>(namelist);</li><li>}</li></ol></pre></div></div>     <p>3.调用 OH_Environment_GetUserDownloadDir 接口获取用户 Download 目录沙箱路径，并保存 temp.txt 到 Download 目录下。示例代码如下所示：</p>     <div _ngcontent-hwj-c106="" class="highlight-div"><div _ngcontent-hwj-c106="" class="highlight-div-header"><div _ngcontent-hwj-c106="" class="highlight-div-header-left"><div _ngcontent-hwj-c106="" class="handle-button expand-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hwj-c106="" class="highlight-div-header-right"><div _ngcontent-hwj-c106="" class="handle-button ai-button"></div><div _ngcontent-hwj-c106="" class="handle-button line-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hwj-c106="" class="handle-button theme-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hwj-c106="" class="handle-button copy-button"><div _ngcontent-hwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hwj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-title class_">include</span> &lt;<span class="hljs-title class_">fstream</span>&gt;</li><li>
</li><li><span class="hljs-variable">void</span> <span class="hljs-title function_">WriteUserDownloadDirPathExample</span>()</li><li>{</li><li>    <span class="hljs-comment">// 获取 download 路径</span></li><li>    <span class="hljs-variable">char</span> *<span class="hljs-variable">downloadPath</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">FileManagement_ErrCode</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_Environment_GetUserDownloadDir</span>(&amp;<span class="hljs-title class_">downloadPath</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"Download Path=%{public}s"</span>, <span class="hljs-variable">downloadPath</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"GetDownloadPath fail, error code is %{public}d"</span>, <span class="hljs-variable">ret</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 保存文件到 download 目录下</span></li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">filePath</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span>(<span class="hljs-title class_">downloadPath</span>) + <span class="hljs-string">"/temp.txt"</span>;</li><li>    <span class="hljs-title function_">free</span>(<span class="hljs-variable">downloadPath</span>);</li><li>
</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">ofstream</span> <span class="hljs-title class_">outfile</span>;</li><li>    <span class="hljs-variable">outfile</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">filePath</span>.<span class="hljs-title function_">c_str</span>());</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">outfile</span>) {</li><li>        <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"Failed to open file"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">msg</span> = <span class="hljs-string">"Write a message"</span>;</li><li>    <span class="hljs-variable">outfile</span>.<span class="hljs-title function_">write</span>(<span class="hljs-variable">msg</span>.<span class="hljs-title function_">c_str</span>(), <span class="hljs-variable">msg</span>.<span class="hljs-title function_">size</span>());</li><li>    <span class="hljs-variable">outfile</span>.<span class="hljs-title function_">close</span>();</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>