<h1 _ngcontent-hnv-c119="" class="doc-title ng-star-inserted" title="获取深度估计信息"> 获取深度估计信息 </h1>

<div _ngcontent-hnv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section20980186526">概要<i class="anchor-icon anchor-icon-link" anchorid="section20980186526" tips="复制节点链接"></i></h2>          <p>从5.1.0(18)开始，AR Engine支持获取深度估计信息能力。</p>     <p>AR Engine提供的深度估计功能通过算法输出深度估计数据（物体表面离相机的距离）和深度置信度信息，为开发者提供环境三维感知能力。该技术可应用于测量、体积估算、场景重建等场景。基于空间物体的深度信息，开发者可完成一些空间计算任务，比如计算物体体积等。</p>     <p>开发者如果需要使用获取深度图功能请使用NAPI进行开发，参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-get-depth">获取深度图</a>。ArkTS API将于后期版本上线深度图能力。</p>     <div class="fignone">      <span class="figcap"><b>图1 </b>深度估计信息示意图</span>      <br><span><img originheight="657" originwidth="318" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114356.26363549151413898327118326767431:50001231000000:2800:776AFAEE04FCF64D0281986A06F3630143FE8F696AB767EA221AA0FABD924C21.png" width="318" height="657"></span>     </div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>本功能仅提供能力，接入该功能不构成对产品的质量保证或任何承诺，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-appendix#section1854314717219">AR Engine深度估计功能技术局限性及免责声明</a>。</p>      </div></div></div>     <p>本章节涉及的AR Engine能力如下：</p>     <ul>      <li>运动跟踪能力</li>      <li>环境跟踪能力（平面检测）</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section57212150139">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section57212150139" tips="复制节点链接"></i></h2>          <p>获取深度估计信息可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section83421523123819" target="_blank">ARFrame</a>帧对象获取，以下接口为深度估计相关接口。详细接口和说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-arkts-api" target="_blank">AR Engine API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="49.94%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50.06%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section114051108916" target="_blank">ARSession.getFrame</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取AR Engine处理后的一帧数据。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section8978424152512" target="_blank">ARFrame.acquireDepthImage16Bits</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取当前帧对应的深度图像对象。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section58412318287" target="_blank">ARFrame.acquireDepthConfidenceImage</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取当前帧的深度置信度图像。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section528511529350">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section528511529350" tips="复制节点链接"></i></h2>          <p>对于使用ArkTS的任何AR应用，首先需要创建一个AR会话<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section12681656121519" target="_blank">ARViewContext</a>，用于管理AR Engine的系统状态。AR会话<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section12681656121519" target="_blank">ARViewContext</a>的创建可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arsession">管理AR会话</a>章节。</p>    </div>    <div class="tiledSection">     <h3 id="section66461933183216" class="firsth2">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section66461933183216" tips="复制节点链接"></i></h3>          <p>获取深度估计信息能力所需的模块导入方法如下：</p>     <div _ngcontent-hnv-c106="" class="highlight-div"><div _ngcontent-hnv-c106="" class="highlight-div-header"><div _ngcontent-hnv-c106="" class="highlight-div-header-left"><div _ngcontent-hnv-c106="" class="handle-button expand-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hnv-c106="" class="highlight-div-header-right"><div _ngcontent-hnv-c106="" class="handle-button ai-button"></div><div _ngcontent-hnv-c106="" class="handle-button line-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hnv-c106="" class="handle-button theme-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hnv-c106="" class="handle-button copy-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hnv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { arEngine, <span class="hljs-title class_">ARView</span>, arViewController } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AREngine'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Node</span>, <span class="hljs-title class_">Scene</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics3D'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section104031814145815">定义变量<i class="anchor-icon anchor-icon-link" anchorid="section104031814145815" tips="复制节点链接"></i></h3>          <div class="p">      定义变量centerDistance深度估计距离和centerConfidence深度置信度。      <div _ngcontent-hnv-c106="" class="highlight-div"><div _ngcontent-hnv-c106="" class="highlight-div-header"><div _ngcontent-hnv-c106="" class="highlight-div-header-left"><div _ngcontent-hnv-c106="" class="handle-button expand-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hnv-c106="" class="highlight-div-header-right"><div _ngcontent-hnv-c106="" class="handle-button ai-button"></div><div _ngcontent-hnv-c106="" class="handle-button line-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hnv-c106="" class="handle-button theme-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hnv-c106="" class="handle-button copy-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hnv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">centerDistance</span>: <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">centerConfidence</span>: <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section12260171014594">显示深度估计信息<i class="anchor-icon anchor-icon-link" anchorid="section12260171014594" tips="复制节点链接"></i></h3>          <p>首先初始化AR会话和AR场景，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arsession#section3391814131611">初始化AR会话和AR场景</a>章节。</p>     <p>在设备界面上显示深度估计信息及深度置信度信息，使用重复调用函数方法在设备界面上实时更新深度估计信息及置信度信息。</p>    </div>    <div _ngcontent-hnv-c106="" class="highlight-div"><div _ngcontent-hnv-c106="" class="highlight-div-header"><div _ngcontent-hnv-c106="" class="highlight-div-header-left"><div _ngcontent-hnv-c106="" class="handle-button expand-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hnv-c106="" class="highlight-div-header-right"><div _ngcontent-hnv-c106="" class="handle-button ai-button"></div><div _ngcontent-hnv-c106="" class="handle-button line-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hnv-c106="" class="handle-button theme-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hnv-c106="" class="handle-button copy-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hnv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">ARDepthBuilder</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-title function_">ARDepth</span>();</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ARDepth</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">delayInterval</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">33</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">intervalId</span>: <span class="hljs-title class_">number</span> = -<span class="hljs-number">1</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">arContext</span>?: <span class="hljs-title class_">arViewController</span>.<span class="hljs-title class_">ARViewContext</span> = <span class="hljs-variable">undefined</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">depthConfidence</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">depthDistance</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'0'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">NavDestination</span>() {</li><li>      <span class="hljs-title function_">RelativeContainer</span>() {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">arContext</span>) {</li><li>          <span class="hljs-title function_">ARView</span>({ <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">arContext</span> })</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">alignRules</span>({</li><li>              <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>              <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>            })</li><li>
</li><li>          <span class="hljs-comment">// 在屏幕上显示中心点、深度估计值及置信度</span></li><li>          <span class="hljs-title function_">Text</span>(<span class="hljs-string">'●'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">8</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span>)</li><li>            .<span class="hljs-title function_">alignRules</span>({</li><li>              <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>              <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>            })</li><li>
</li><li>          <span class="hljs-title function_">Column</span>() {</li><li>            <span class="hljs-title function_">Text</span>(`${<span class="hljs-keyword">this</span>.<span class="hljs-variable">depthDistance</span>} | ${<span class="hljs-keyword">this</span>.<span class="hljs-variable">depthConfidence</span>}`)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Yellow</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)</li><li>              .<span class="hljs-title function_">textShadow</span>({</li><li>                <span class="hljs-variable">radius</span>: <span class="hljs-number">10</span>,</li><li>                <span class="hljs-variable">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Black</span>,</li><li>                <span class="hljs-variable">offsetX</span>: <span class="hljs-number">0</span>,</li><li>                <span class="hljs-variable">offsetY</span>: <span class="hljs-number">0</span></li><li>              })</li><li>          }</li><li>          .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">bottom</span>: <span class="hljs-number">10</span> })</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">bottom</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Bottom</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">initARView</span>();</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">renderDepthMsg</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">onWillAppear</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">stopARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">onShown</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">resumeARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">onHidden</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">pauseARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-keyword">true</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initARView</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">Scene</span>.<span class="hljs-title function_">load</span>().<span class="hljs-title function_">then</span>(<span class="hljs-variable">async</span> (<span class="hljs-variable">scene</span>: <span class="hljs-title class_">Scene</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">viewContext</span>: <span class="hljs-title class_">arViewController</span>.<span class="hljs-title class_">ARViewContext</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">arViewController</span>.<span class="hljs-title function_">ARViewContext</span>();</li><li>      <span class="hljs-variable">viewContext</span>.<span class="hljs-variable">scene</span> = <span class="hljs-variable">scene</span>;</li><li>      <span class="hljs-variable">viewContext</span>.<span class="hljs-variable">callback</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">ARViewCallbackImpl</span>();</li><li>      <span class="hljs-variable">viewContext</span>.<span class="hljs-variable">config</span> = {</li><li>        <span class="hljs-keyword">type</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARType</span>.<span class="hljs-title class_">WORLD</span>,</li><li>        <span class="hljs-variable">planeFindingMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARPlaneFindingMode</span>.<span class="hljs-title class_">HORIZONTAL_AND_VERTICAL</span>,</li><li>        <span class="hljs-variable">powerMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARPowerMode</span>.<span class="hljs-title class_">NORMAL</span>,</li><li>        <span class="hljs-variable">semanticMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARSemanticMode</span>.<span class="hljs-title class_">NONE</span>,</li><li>        <span class="hljs-variable">poseMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARPoseMode</span>.<span class="hljs-title class_">GRAVITY</span>,</li><li>        <span class="hljs-variable">depthMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARDepthMode</span>.<span class="hljs-title class_">AUTOMATIC</span>,</li><li>        <span class="hljs-variable">meshMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARMeshMode</span>.<span class="hljs-title class_">DISABLED</span>,</li><li>        <span class="hljs-variable">focusMode</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARFocusMode</span>.<span class="hljs-title class_">AUTO</span></li><li>      }</li><li>      <span class="hljs-variable">viewContext</span>.<span class="hljs-keyword">init</span>().<span class="hljs-title function_">then</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">arContext</span> = <span class="hljs-variable">viewContext</span>;</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in initializing ARView.'</span>);</li><li>      }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>        <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-keyword">init</span> <span class="hljs-variable">ARView</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">renderDepthMsg</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">intervalId</span> = <span class="hljs-title function_">setInterval</span>(() =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">centerDistance</span> === <span class="hljs-variable">undefined</span> || <span class="hljs-variable">centerConfidence</span> === <span class="hljs-variable">undefined</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">depthDistance</span> = <span class="hljs-variable">centerDistance</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">4</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">depthConfidence</span> = <span class="hljs-variable">centerConfidence</span>;</li><li>    }, <span class="hljs-keyword">this</span>.<span class="hljs-variable">delayInterval</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">stopARView</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">arContext</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-title function_">clearInterval</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">intervalId</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">arContext</span>.<span class="hljs-title function_">destroy</span>();</li><li>      <span class="hljs-variable">centerDistance</span> = <span class="hljs-number">0</span>;</li><li>      <span class="hljs-variable">centerConfidence</span> = <span class="hljs-number">0</span>;</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">stop</span> <span class="hljs-variable">context</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">resumeARView</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">pauseARView</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section194157391715">获取深度估计信息<i class="anchor-icon anchor-icon-link" anchorid="section194157391715" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section9396615174614" target="_blank">ARViewCallback</a>，使用其中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section52341758194715" target="_blank">onFrameUpdate</a>方法获取到AR会话对象后进行深度估计，获取深度信息、置信度信息。</p>     <div _ngcontent-hnv-c106="" class="highlight-div"><div _ngcontent-hnv-c106="" class="highlight-div-header"><div _ngcontent-hnv-c106="" class="highlight-div-header-left"><div _ngcontent-hnv-c106="" class="handle-button expand-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hnv-c106="" class="highlight-div-header-right"><div _ngcontent-hnv-c106="" class="handle-button ai-button"></div><div _ngcontent-hnv-c106="" class="handle-button line-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hnv-c106="" class="handle-button theme-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hnv-c106="" class="handle-button copy-button"><div _ngcontent-hnv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hnv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ARViewCallbackImpl</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">arViewController</span>.<span class="hljs-variable">ARViewCallback</span> {</li><li>  <span class="hljs-title function_">onAnchorAdd</span>(<span class="hljs-variable">ctx</span>: <span class="hljs-title class_">arViewController</span>.<span class="hljs-title class_">ARViewContext</span>, <span class="hljs-variable">node</span>: <span class="hljs-title class_">Node</span>, <span class="hljs-variable">anchor</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARAnchor</span>): <span class="hljs-title class_">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onAnchorUpdate</span>(<span class="hljs-variable">ctx</span>: <span class="hljs-title class_">arViewController</span>.<span class="hljs-title class_">ARViewContext</span>, <span class="hljs-variable">node</span>: <span class="hljs-title class_">Node</span>, <span class="hljs-variable">anchor</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARAnchor</span>): <span class="hljs-title class_">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">onFrameUpdate</span>(<span class="hljs-variable">ctx</span>: <span class="hljs-title class_">arViewController</span>.<span class="hljs-title class_">ARViewContext</span>, <span class="hljs-variable">sysBootTs</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">ctx</span>.<span class="hljs-variable">session</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">session</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARSession</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">ctx</span>.<span class="hljs-variable">session</span>;</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">frame</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARFrame</span> = <span class="hljs-variable">session</span>.<span class="hljs-title function_">getFrame</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">depthImage</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARImage</span> = <span class="hljs-variable">frame</span>.<span class="hljs-title function_">acquireDepthImage16Bits</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">confidenceImage</span>: <span class="hljs-title class_">arEngine</span>.<span class="hljs-title class_">ARImage</span> = <span class="hljs-variable">frame</span>.<span class="hljs-title function_">acquireDepthConfidenceImage</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">depthPlane</span>: <span class="hljs-title class_">number</span>[] = <span class="hljs-title function_">arrayBufferInt32ToNumber</span>(<span class="hljs-variable">depthImage</span>.<span class="hljs-variable">planes</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">buffer</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">confidencePlane</span>: <span class="hljs-title class_">number</span>[] = <span class="hljs-title function_">arrayBufferInt32ToNumber</span>(<span class="hljs-variable">confidenceImage</span>.<span class="hljs-variable">planes</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">buffer</span>);</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">depthImage</span>.<span class="hljs-variable">height</span> * <span class="hljs-variable">depthImage</span>.<span class="hljs-variable">width</span> / <span class="hljs-number">2</span> + <span class="hljs-variable">depthImage</span>.<span class="hljs-variable">width</span> / <span class="hljs-number">2</span>;</li><li>
</li><li>      <span class="hljs-variable">centerDistance</span> = <span class="hljs-variable">depthPlane</span>[<span class="hljs-variable">index</span>] / <span class="hljs-number">1000</span>;</li><li>      <span class="hljs-variable">centerConfidence</span> = <span class="hljs-variable">confidencePlane</span>[<span class="hljs-variable">index</span>];</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">acquire</span> <span class="hljs-variable">depth</span> <span class="hljs-variable">information</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section44005208213">获取深度估计信息的自定义方法<i class="anchor-icon anchor-icon-link" anchorid="section44005208213" tips="复制节点链接"></i></h3>          <p>自定义数据转换方法arrayBufferInt32ToNumber可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arraybuffer-info">数据类型转换说明</a>。</p>    </div>   </div>   <div></div></div>