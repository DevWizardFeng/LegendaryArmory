<h1 _ngcontent-jxf-c119="" class="doc-title ng-star-inserted" title="获取深度图"> 获取深度图 </h1>

<div _ngcontent-jxf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section19803101214197">概要<i class="anchor-icon anchor-icon-link" anchorid="section19803101214197" tips="复制节点链接"></i></h2>          <p>从5.0.5(17)开始，AR Engine支持获取深度图的能力。</p>     <p>AR Engine提供的深度估计功能通过算法输出深度图数据（物体表面离相机的距离组成的图）和深度置信度图信息，为开发者提供环境三维感知能力。该技术可应用于例如测量、体积估算、场景重建等获取空间物体深度信息场景，基于此信息完成一些空间计算任务，比如计算物体体积等。</p>     <div class="fignone">      <span class="figcap"><b>图1 </b>深度渲染示意图</span>      <br><span><img originheight="657" originwidth="318" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114356.43801717353343903221180980740867:50001231000000:2800:7D23310366859A4F237FB3141FDCA550546CB681C888080160ABD8D350C7D0F2.png" width="318" height="657"></span>     </div>     <p></p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>本功能仅提供能力，接入该功能不构成对产品的质量保证或任何承诺，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-appendix#section1854314717219">AR Engine深度估计功能技术局限性及免责声明</a>。</p>      </div></div></div>     <p>本章节涉及的AR Engine能力如下：</p>     <ul>      <li>运动跟踪能力</li>      <li>环境跟踪能力（平面检测）</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section4701164061710">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section4701164061710" tips="复制节点链接"></i></h2>          <p>以下接口为AR深度估计相关接口。详细接口和说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine" target="_blank">AR Engine API参考</a>。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.3.1.3.1.1" valign="top" width="49.94%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.3.1.3.1.2" valign="top" width="50.06%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga47713cb18234569e03b5216b6c8442d3" target="_blank">HMS_AREngine_ARSession_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>创建一个新的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga2dbf3585f50628750ec855501c043650" target="_blank">AREngine_ARSession</a>会话。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga1d1cacf372a8011a439f0e4e76994259" target="_blank">HMS_AREngine_ARSession_Update</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>更新AR Engine的计算结果。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga6394ae995148abbe3d00082817bf320a" target="_blank">HMS_AREngine_ARSession_Configure</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga2dbf3585f50628750ec855501c043650" target="_blank">AREngine_ARSession</a>会话。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gadfcb9589137a39c5afcb217e18853a9d" target="_blank">HMS_AREngine_ARFrame_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>创建一个新的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gaf35f728a1179ef54a3eba9f1cf021719" target="_blank">AREngine_ARFrame</a>对象，将指针存储到*outFrame中。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga3f23bf747def8303c3fb261a9e9a2286" target="_blank">HMS_AREngine_ARSession_SetDisplayGeometry</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>设置显示的高和宽（以像素为单位）。该高度和宽度是显示视图的高度和宽度，如果不一致，会导致显示相机预览出错。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac697e4be36db63ed6098f154aa9ac01c" target="_blank">HMS_AREngine_ARSession_SetCameraGLTexture</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>设置可用于存储相机预览流数据的OpenGL纹理。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取所有指定类型的可跟踪对象集合。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gab1782eeeeddc01b77a140af915cb351c" target="_blank">HMS_AREngine_ARTrackableList_AcquireItem</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>从可跟踪列表中获取指定index的对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gabbb03027afb984be8542d00d2eebd063" target="_blank">HMS_AREngine_ARPlane_GetCenterPose</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取从平面的局部坐标系到世界坐标系转换的位姿信息。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga5295c975a0ff3d633a1dde5a8eb70863" target="_blank">HMS_AREngine_ARFrame_AcquireCamera</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前帧的相机参数对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gafb471f39563ca1a4947d4f87c77e24e2" target="_blank">HMS_AREngine_ARPose_Create</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>分配并初始化一个新的位姿对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#ga00df108c4ba187967a10e9c4d2e27d3a" target="_blank">HMS_AREngine_ARCamera_GetPose</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前相机对象在AR世界空间中的位姿。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section12608229155413" target="_blank">HMS_AREngine_ARConfig_SetDepthMode</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>设置深度模式。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section138574584154" target="_blank">HMS_AREngine_ARFrame_AcquireDepthImage16Bits</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前帧的深度图像。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section4424501286" target="_blank">HMS_AREngine_ARFrame_AcquireDepthConfidenceImage</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前帧的深度图像对应的置信度信息。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="49.94%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section367418528228" target="_blank">HMS_AREngine_ARImage_GetNativeBuffer</a></p></td>        <td class="cellrowborder" valign="top" width="50.06%">         <p>获取当前帧图像对象的NativeBuffer数据。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section171161453144613">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section171161453144613" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002363865165__p193824275361">本章节给出了关键开发步骤，完整代码可以参考<a href="https://gitcode.com/harmonyos_samples/arengine_-sample-code_-clientdemo_cpp" target="_blank">示例代码</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section1149014511314" class="firsth2">声明Native接口<i class="anchor-icon anchor-icon-link" anchorid="section1149014511314" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002363865165__p16573195181311">开发者可参考AR物体摆放章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arworld#section1557014318265">声明Native接口</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section65312574410">创建UI界面<i class="anchor-icon anchor-icon-link" anchorid="section65312574410" tips="复制节点链接"></i></h3>          <p>首先创建一个UI界面ARDepth.ets，用于选择是否开启深度图渲染模式。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此代码可参考示例代码：ARSample/entry/src/main/ets/pages/ARDepth.ets。</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">ARDepthBuilder</span>() {</li><li>  <span class="hljs-title function_">ARDepth</span>();</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ARDepth</span> {</li><li>  <span class="hljs-variable">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">NavDestination</span>() {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'关闭深度图渲染模式'</span>, { <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Normal</span>, <span class="hljs-variable">stateEffect</span>: <span class="hljs-keyword">true</span> })</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'ARDepthRender'</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 0表示关闭渲染</span></li><li>          })</li><li>
</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'开启深度图渲染模式'</span>, { <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Normal</span>, <span class="hljs-variable">stateEffect</span>: <span class="hljs-keyword">true</span> })</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'ARDepthRender'</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// 1表示打开渲染</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">SpaceEvenly</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>((<span class="hljs-variable">context</span>: <span class="hljs-title class_">NavDestinationContext</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathStack</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-keyword">true</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>最后创建一个ARDepthRender.ets，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件用于加载相机预览画面，并定时触发每一帧绘制。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此代码可参考示例代码：ARSample/entry/src/main/ets/pages/ARDepthRender.ets。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">deviceInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">resourceManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">arEngineDemo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">ARDepthRenderBuilder</span>() {</li><li>  <span class="hljs-title function_">ARDepthRender</span>();</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ARDepthRender</span> {</li><li>  <span class="hljs-variable">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">interval</span>: <span class="hljs-title class_">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">isUpdate</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">true</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">params</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">xComponentId</span> = <span class="hljs-string">'ARDepth'</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">resMgr</span>: <span class="hljs-title class_">resourceManager</span>.<span class="hljs-title class_">ResourceManager</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">resourceManager</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">distance</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">''</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">rotation</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">deviceInfo</span>.<span class="hljs-variable">deviceType</span> === <span class="hljs-string">'tablet'</span> ? <span class="hljs-number">3</span> : <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">NavDestination</span>() {</li><li>      <span class="hljs-title function_">RelativeContainer</span>() {</li><li>        <span class="hljs-title function_">XComponent</span>({ <span class="hljs-variable">id</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xComponentId</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-title class_">SURFACE</span>, <span class="hljs-variable">libraryname</span>: <span class="hljs-string">'entry'</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">center</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Center</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onLoad</span>(() =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span> = <span class="hljs-title function_">setInterval</span>(() =&gt; {</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span>) {</li><li>                <span class="hljs-comment">// 每一帧通过调用AR Engine的Native API update来更新计算结果</span></li><li>                <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-variable">distance</span> = <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">getDistance</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>              }</li><li>            }, <span class="hljs-number">33</span>) <span class="hljs-comment">// 将帧速率设置为30fps（每33ms刷新一次帧）</span></li><li>          })</li><li>          .<span class="hljs-title function_">onDestroy</span>(() =&gt; {</li><li>            <span class="hljs-title function_">clearInterval</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">interval</span>);</li><li>          })</li><li>
</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">distance</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Yellow</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)</li><li>          .<span class="hljs-title function_">textShadow</span>({</li><li>            <span class="hljs-variable">radius</span>: <span class="hljs-number">10</span>,</li><li>            <span class="hljs-variable">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Black</span>,</li><li>            <span class="hljs-variable">offsetX</span>: <span class="hljs-number">0</span>,</li><li>            <span class="hljs-variable">offsetY</span>: <span class="hljs-number">0</span></li><li>          })</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-variable">TextAlign</span>.<span class="hljs-variable">Center</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-variable">bottom</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-title class_">Bottom</span> },</li><li>            <span class="hljs-variable">middle</span>: { <span class="hljs-variable">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-variable">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-title class_">Center</span> }</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">resMgr</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">config</span>: <span class="hljs-title class_">Int32Array</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Int32Array</span>([<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">params</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">rotation</span>]);</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">start</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>, <span class="hljs-variable">config</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onWillDisappear</span>(() =&gt; {</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">stop</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onShown</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">true</span>;</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">show</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onHidden</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">isUpdate</span> = <span class="hljs-keyword">false</span>;</li><li>      <span class="hljs-variable">arEngineDemo</span>.<span class="hljs-title function_">hide</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">xComponentId</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onReady</span>((<span class="hljs-variable">context</span>: <span class="hljs-title class_">NavDestinationContext</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfo</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathStack</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">params</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathInfo</span>.<span class="hljs-variable">param</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">number</span>;</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-keyword">true</span>)</li><li>  }</li><li>
</li><li>}</li></ol></pre></div></div>     <p>配置路由进行页面间跳转，页面路由配置详细可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation" target="_blank">组件导航(Navigation) (推荐)</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section13951554911">引入AR Engine<i class="anchor-icon anchor-icon-link" anchorid="section13951554911" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002363865165__p1174733951511">开发者可参考AR物体摆放章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arworld#section183721115521">引入AR Engine</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section1489114064711">创建AR会话<i class="anchor-icon anchor-icon-link" anchorid="section1489114064711" tips="复制节点链接"></i></h3>          <p>创建AR会话并配置为开启深度模式。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARSession *arSession = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Create</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;arSession);</li><li>AREngine_ARConfig *arConfig = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话配置器。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_Create</span>(arSession, &amp;arConfig);</li><li><span class="hljs-comment">// 设置深度模式为开启状态。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_SetDepthMode</span>(arSession, arConfig, ARENGINE_DEPTH_MODE_AUTOMATIC);</li><li><span class="hljs-comment">// 配置器设置给AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Configure</span>(arSession, arConfig);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section7330193213476">获取当前环境中的深度图<i class="anchor-icon anchor-icon-link" anchorid="section7330193213476" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section138574584154" target="_blank">HMS_AREngine_ARFrame_AcquireDepthImage16Bits</a>函数，获取当前环境中的深度信息，并将结果存放在depthImage中。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARFrame *arFrame = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR单帧对象</span></li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_Create</span>(arSession, &amp;arFrame);</li><li>AREngine_ARImage *depthImage = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 获取深度图</span></li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_AcquireDepthImage16Bits</span>(arSession, arFrame, &amp;depthImage);</li><li><span class="hljs-comment">// 获取深度图的nativeBuffer</span></li><li>OH_NativeBuffer* depthBuffer;</li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetNativeBuffer</span>(arSession, depthImage, &amp;depthBuffer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1730313587477">获取当前深度图对应的深度置信度图<i class="anchor-icon anchor-icon-link" anchorid="section1730313587477" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#section4424501286" target="_blank">HMS_AREngine_ARFrame_AcquireDepthConfidenceImage</a>函数，获取当前深度图对应的置信度图。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARFrame *arFrame = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR单帧对象</span></li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_Create</span>(arSession, &amp;arFrame);</li><li>AREngine_ARImage *depthConfidenceImage = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 获取深度置信度图</span></li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_AcquireDepthConfidenceImage</span>(arSession, arFrame, &amp;depthConfidenceImage);</li><li><span class="hljs-comment">// 获取深度置信图的nativeBuffer</span></li><li>OH_NativeBuffer* depthConfidenceBuffer;</li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetNativeBuffer</span>(arSession, depthConfidenceImage, &amp;depthConfidenceBuffer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1698143920481">获取深度图和深度置信度图中的值<i class="anchor-icon anchor-icon-link" anchorid="section1698143920481" tips="复制节点链接"></i></h3>          <p>深度图和深度置信度图包装为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gabfee13b0076f2f00b7efdef2717add59" target="_blank">AREngine_ARImage</a>对象，可以通过此对象获取对应的深度图和深度置信度图。</p>     <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARImageFormat format;</li><li><span class="hljs-comment">// 获取当前帧图像的数据格式</span></li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetFormat</span>(arSession, depthImage, &amp;format);</li><li><span class="hljs-type">int32_t</span> depthWidth;</li><li><span class="hljs-comment">// 获取深度图的宽度</span></li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetWidth</span>(arSession, depthImage, &amp;depthWidth);</li><li><span class="hljs-type">int32_t</span> depthHeight;</li><li><span class="hljs-comment">// 获取深度图的高度</span></li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetHeight</span>(arSession, depthImage, &amp;depthHeight);</li><li><span class="hljs-type">uint8_t</span> *depthData = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">int32_t</span> depthLength = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 获取深度图的数据</span></li><li><span class="hljs-built_in">HMS_AREngine_ARImage_GetPlaneData</span>(arSession, depthImage, <span class="hljs-number">0</span>, (<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span> **)&amp;depthData, &amp;depthLength);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1256017108494">使用完毕后，销毁深度图和深度置信度图<i class="anchor-icon anchor-icon-link" anchorid="section1256017108494" tips="复制节点链接"></i></h3>          <div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_AREngine_ARImage_Release</span>(depthImage);</li><li><span class="hljs-built_in">HMS_AREngine_ARImage_Release</span>(depthConfidenceImage);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>