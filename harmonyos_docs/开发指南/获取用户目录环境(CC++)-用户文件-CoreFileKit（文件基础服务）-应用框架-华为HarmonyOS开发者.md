<h1 _ngcontent-doj-c119="" class="doc-title ng-star-inserted" title="获取用户目录环境(C/C++)"> 获取用户目录环境(C/C++) </h1>

<div _ngcontent-doj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-environment-h" target="_blank">Environment</a>提供了获取公共文件用户目录路径的能力，以支持三方应用在公共文件用户目录下进行文件访问操作。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>使用此接口，需确认设备具有以下系统能力：SystemCapability.FileManagement.File.Environment.FolderObtain。</li>      <li>此接口仅用作公共沙箱目录路径的获取接口，操作对应的公共目录及其子目录需获取通过弹窗授权方式向用户申请授予对应目录的权限，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">访问控制-向用户申请授权</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>接口的详细说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-environment-h" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDownloadDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Download目录沙箱路径。只支持2in1设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDesktopDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Desktop目录沙箱路径。只支持2in1设备。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FileManagement_ErrCode OH_Environment_GetUserDocumentDir (char **result)</td>         <td class="cellrowborder" valign="top" width="50%">获取用户Document目录沙箱路径。只支持2in1设备。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p><strong>在CMake脚本中链接动态库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(sample PUBLIC libohenvironment.so)</li></ol></pre></div></div>     <p><strong>添加头文件</strong></p>     <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filemanagement/environment/oh_environment.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;filemanagement/fileio/oh_fileio.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>调用OH_Environment_GetUserDownloadDir接口获取用户Download目录沙箱路径，在接口中使用malloc申请的内存需要在使用完后释放因此需要free对应的内存。示例代码如下所示：</p>       <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">GetUserDownloadDirPathExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-type">char</span> *downloadPath = <span class="hljs-literal">NULL</span>;</li><li>    FileManagement_ErrCode ret = OH_Environment_GetUserDownloadDir(&amp;downloadPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Download Path=%s"</span>, downloadPath);</li><li>        <span class="hljs-built_in">free</span>(downloadPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"GetDownloadPath failed, error code is %d"</span>, ret);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_Environment_GetUserDesktopDir接口获取用户Desktop目录沙箱路径，在接口中使用malloc申请的内存需要在使用完后释放因此需要free对应的内存。示例代码如下所示：</p>       <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">GetUserDesktopDirPathExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-type">char</span> *desktopPath = <span class="hljs-literal">NULL</span>;</li><li>    FileManagement_ErrCode ret = OH_Environment_GetUserDesktopDir(&amp;desktopPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Desktop Path=%s"</span>, desktopPath);</li><li>        <span class="hljs-built_in">free</span>(desktopPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"GetDesktopPath failed, error code is %d"</span>, ret);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_Environment_GetUserDocumentDir接口获取用户Document目录沙箱路径，在接口中使用malloc申请的内存需要在使用完后释放因此需要free对应的内存。示例代码如下所示：</p>       <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">GetUserDocumentDirPathExample</span><span class="hljs-params">()</span> {</li><li>    <span class="hljs-type">char</span> *documentPath = <span class="hljs-literal">NULL</span>;</li><li>    FileManagement_ErrCode ret = OH_Environment_GetUserDocumentDir(&amp;documentPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Document Path=%s"</span>, documentPath);</li><li>        <span class="hljs-built_in">free</span>(documentPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"GetDocumentPath failed, error code is %d"</span>, ret);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_Environment_GetUserDocumentDir接口获取用户Document目录沙箱路径，使用stat函数判断Document目录空间大小。示例代码如下所示：</p>       <p>使用前需要引入如下头文件：</p>       <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span></li></ol></pre></div></div>       <div _ngcontent-doj-c106="" class="highlight-div"><div _ngcontent-doj-c106="" class="highlight-div-header"><div _ngcontent-doj-c106="" class="highlight-div-header-left"><div _ngcontent-doj-c106="" class="handle-button expand-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-doj-c106="" class="highlight-div-header-right"><div _ngcontent-doj-c106="" class="handle-button ai-button"></div><div _ngcontent-doj-c106="" class="handle-button line-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-doj-c106="" class="handle-button theme-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-doj-c106="" class="handle-button copy-button"><div _ngcontent-doj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-doj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">GetUserDownloadDirSizeExample</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">char</span> *documentPath = <span class="hljs-literal">nullptr</span>;</li><li>    FileManagement_ErrCode ret = <span class="hljs-built_in">OH_Environment_GetUserDocumentDir</span>(&amp;documentPath);</li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Document Path=%{public}s"</span>, documentPath);</li><li>        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">stat</span> fileStat;</li><li>        <span class="hljs-type">int</span> result = <span class="hljs-built_in">stat</span>(documentPath, &amp;fileStat);</li><li>        <span class="hljs-keyword">if</span> (result == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Document Size=%{public}ld"</span>, fileStat.st_size);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"GetDocumentSize fail, error code is %{public}ld"</span>, result);</li><li>        }</li><li>        <span class="hljs-built_in">free</span>(documentPath);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"GetDocumentPath fail, error code is %{public}d"</span>, ret);</li><li>    }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>