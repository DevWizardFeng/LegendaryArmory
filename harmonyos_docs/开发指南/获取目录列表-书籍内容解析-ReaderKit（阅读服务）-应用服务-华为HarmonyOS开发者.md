<h1 _ngcontent-hrs-c119="" class="doc-title ng-star-inserted" title="获取目录列表"> 获取目录列表 </h1>

<div _ngcontent-hrs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>当应用需要展示书籍目录列表时，开发者可通过解析能力获取目录节点列表，实现目录列表中章节名称按顺序、层级的展示。当用户点击目录节点时，开发者也需要获取目录位置及资源信息，用于跳转到指定位置。</p>    <div class="tiledSection">     <h2 id="section3713101319111">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section3713101319111" tips="复制节点链接"></i></h2>          <p><span><img height="496.832805" originheight="576" originwidth="791" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114551.86233881979081217079473111210342:50001231000000:2800:70AA37BFA59D63D61C3712FC9FF5C040D56256FED1DD9FC34613F5E7ACA89E0E.png" title="点击放大" width="682.2900000000001"></span></p>    </div>    <div class="tiledSection">     <h2 id="section11562431143718">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section11562431143718" tips="复制节点链接"></i></h2>          <p>获取目录列表及获取指定目录位置及资源信息共涉及4个接口，具体API说明请参考下表。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.1" valign="top" width="50%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.3.1.2" valign="top" width="50%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-book-parser#section896820167243" target="_blank">getDefaultHandler</a>(path: string): Promise&lt;BookParserHandler&gt;</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p>获取书籍默认解析器。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-book-parser#section14841714114211" target="_blank">getCatalogList</a>(): CatalogItem[]</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p>获取书籍目录列表。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-book-parser#section124930457617" target="_blank">getDomPosByCatalogHref</a>(href: string): string</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p>获取阅读起始位置domPos。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="50%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-book-parser#section61575276477" target="_blank">getSpineList</a>(): SpineItem[]</p></td>        <td class="cellrowborder" valign="top" width="50%">         <p>获取书脊内容列表。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section17628101414327">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section17628101414327" tips="复制节点链接"></i></h2>          <ol>      <li>导入相关模块。       <div _ngcontent-hrs-c106="" class="highlight-div"><div _ngcontent-hrs-c106="" class="highlight-div-header"><div _ngcontent-hrs-c106="" class="highlight-div-header-left"><div _ngcontent-hrs-c106="" class="handle-button expand-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrs-c106="" class="highlight-div-header-right"><div _ngcontent-hrs-c106="" class="handle-button ai-button"></div><div _ngcontent-hrs-c106="" class="handle-button line-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrs-c106="" class="handle-button theme-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrs-c106="" class="handle-button copy-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div></li>      <li>通过提前导入到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank">应用沙箱目录</a>中的书籍文件，初始化书籍解析器。       <div _ngcontent-hrs-c106="" class="highlight-div"><div _ngcontent-hrs-c106="" class="highlight-div-header"><div _ngcontent-hrs-c106="" class="highlight-div-header-left"><div _ngcontent-hrs-c106="" class="handle-button expand-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrs-c106="" class="highlight-div-header-right"><div _ngcontent-hrs-c106="" class="handle-button ai-button"></div><div _ngcontent-hrs-c106="" class="handle-button line-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrs-c106="" class="handle-button theme-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrs-c106="" class="handle-button copy-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">defaultHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(path);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTAG"</span>, <span class="hljs-string">`getDefaultHandler failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>获取目录列表并进行展示。       <div _ngcontent-hrs-c106="" class="highlight-div"><div _ngcontent-hrs-c106="" class="highlight-div-header"><div _ngcontent-hrs-c106="" class="highlight-div-header-left"><div _ngcontent-hrs-c106="" class="handle-button expand-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrs-c106="" class="highlight-div-header-right"><div _ngcontent-hrs-c106="" class="handle-button ai-button"></div><div _ngcontent-hrs-c106="" class="handle-button line-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrs-c106="" class="handle-button theme-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrs-c106="" class="handle-button copy-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@State</span> <span class="hljs-attr">catalogItemList</span>: bookParser.<span class="hljs-property">CatalogItem</span>[] = [];</li><li>
</li><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCatalogList</span>();</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getCatalogList</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">catalogItemList</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHandler</span>?.<span class="hljs-title function_">getCatalogList</span>() || [];</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTAG"</span>, <span class="hljs-string">`getCatalogList failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">List</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">catalogItemList</span>, <span class="hljs-function">(<span class="hljs-params">item: bookParser.CatalogItem</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">' · '</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>                <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">catalogName</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>                  .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-attr">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span> })</li><li>                  .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">8</span> })</li><li>                  .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">2</span>)</li><li>                  .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>              }</li><li>
</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>            .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>
</li><li>            <span class="hljs-title class_">Divider</span>()</li><li>          }</li><li>          .<span class="hljs-title function_">padding</span>({</li><li>            <span class="hljs-attr">left</span>: item.<span class="hljs-property">catalogLevel</span> ? item.<span class="hljs-property">catalogLevel</span> * <span class="hljs-number">26</span> : <span class="hljs-number">10</span>,</li><li>            <span class="hljs-attr">right</span>: item.<span class="hljs-property">catalogLevel</span> ? item.<span class="hljs-property">catalogLevel</span> * <span class="hljs-number">26</span> : <span class="hljs-number">10</span>,</li><li>            <span class="hljs-attr">top</span>: <span class="hljs-number">6</span>,</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-number">6</span></li><li>          })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-comment">// 在此实现点击目录跳转到指定章节功能</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">jumpToCatalogItem</span>(item);</li><li>          })</li><li>        }</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li></ol></pre></div></div></li>      <li>获取跳转用的目录位置及资源信息。       <div _ngcontent-hrs-c106="" class="highlight-div"><div _ngcontent-hrs-c106="" class="highlight-div-header"><div _ngcontent-hrs-c106="" class="highlight-div-header-left"><div _ngcontent-hrs-c106="" class="handle-button expand-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrs-c106="" class="highlight-div-header-right"><div _ngcontent-hrs-c106="" class="handle-button ai-button"></div><div _ngcontent-hrs-c106="" class="handle-button line-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrs-c106="" class="handle-button theme-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrs-c106="" class="handle-button copy-button"><div _ngcontent-hrs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">jumpToCatalogItem</span>(<span class="hljs-params">catalogItem: bookParser.CatalogItem</span>) {</li><li>  <span class="hljs-keyword">let</span> domPos = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDomPos</span>(catalogItem);</li><li>  <span class="hljs-keyword">let</span> resourceIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getResourceItemByCatalog</span>(catalogItem).<span class="hljs-property">index</span>;</li><li>  <span class="hljs-comment">// 通过domPos及resourceIndex信息，即可通过startPlay接口跳转到指定位置</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTAG"</span>, <span class="hljs-string">`jumpToCatalogItem domPos:<span class="hljs-subst">${domPos}</span>, resourceIndex:<span class="hljs-subst">${resourceIndex}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getDomPos</span>(<span class="hljs-attr">catalogItem</span>: bookParser.<span class="hljs-property">CatalogItem</span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">domPos</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHandler</span>?.<span class="hljs-title function_">getDomPosByCatalogHref</span>(catalogItem.<span class="hljs-property">href</span> || <span class="hljs-string">''</span>) || <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">return</span> domPos;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTAG"</span>, <span class="hljs-string">`getDomPos failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 获取书籍目录对应的资源条目</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> catalogItem 目录条目</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getResourceItemByCatalog</span>(<span class="hljs-attr">catalogItem</span>: bookParser.<span class="hljs-property">CatalogItem</span>): bookParser.<span class="hljs-property">SpineItem</span> {</li><li>  <span class="hljs-keyword">let</span> resourceFile = catalogItem.<span class="hljs-property">resourceFile</span> || <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">spineList</span>: bookParser.<span class="hljs-property">SpineItem</span>[] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHandler</span>?.<span class="hljs-title function_">getSpineList</span>() || []</li><li>    <span class="hljs-comment">// 查找目录对应的资源条目</span></li><li>    <span class="hljs-keyword">let</span> resourceItemArr = spineList.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">href</span> === resourceFile);</li><li>    <span class="hljs-keyword">if</span> (resourceItemArr.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'getResourceItemByCatalog get resource '</span>, resourceItemArr[<span class="hljs-number">0</span>]);</li><li>      <span class="hljs-keyword">let</span> resourceItem = resourceItemArr[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-keyword">return</span> resourceItem;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (spineList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-comment">// 如果查找不到，则默认返回第1个资源条目</span></li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'getResourceItemByCatalog get resource in resourceList'</span>, spineList[<span class="hljs-number">0</span>]);</li><li>      <span class="hljs-keyword">return</span> spineList[<span class="hljs-number">0</span>];</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">"testTAG"</span>, <span class="hljs-string">`getDomPos failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// 如果没有资源条目，则返回默认值</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'getResourceItemByCatalog get resource in escape'</span>);</li><li>  <span class="hljs-keyword">return</span> {</li><li>    <span class="hljs-attr">idRef</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">href</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-attr">properties</span>: <span class="hljs-string">''</span></li><li>  };</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>