<h1 _ngcontent-mwj-c119="" class="doc-title ng-star-inserted" title="获取设备位姿"> 获取设备位姿 </h1>

<div _ngcontent-mwj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section57991341175412">概要<i class="anchor-icon anchor-icon-link" anchorid="section57991341175412" tips="复制节点链接"></i></h2><p>从5.0.0(12)开始，AR Engine支持获取设备位姿能力。</p> <p>设备位姿描述了物体在真实世界中的位置和朝向。AR Engine提供了世界坐标下6自由度（6DoF）的位姿计算，包括物体的位置（沿x、y、z轴方向位移）和朝向（绕x、y、z轴旋转）。通过AR Engine，开发者可以实时获取设备在空间中任意时刻的位姿。</p> </div> <div class="tiledSection"><h2 id="section134071231142820">世界坐标系与位姿示意<i class="anchor-icon anchor-icon-link" anchorid="section134071231142820" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002363785089__zh-cn_topic_0000002363785081_p2273206173914">设备位姿一般在世界坐标系下进行表示。世界坐标系描述了真实物理空间中物体的绝对位置，其正方向如图所示。</p> <div class="fignone" id="zh-cn_topic_0000002363785081_fig9896175410514"><span class="figcap"><b>图1 </b>世界坐标系示意图</span><br><span><img originheight="439" originwidth="493" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.24976079128338495502596127552172:50001231000000:2800:422383D35DEF483BC397D9AA74EB21CB4F5552C382E31A713BB231EF734269AC.png" width="493" height="439"></span></div> <p id="ZH-CN_TOPIC_0000002363785089__zh-cn_topic_0000002363785081_p14432110123">AR Engine会自动完成世界坐标系初始化。</p> <p id="ZH-CN_TOPIC_0000002363785089__zh-cn_topic_0000002363785081_p199564313268">在AR Engine中，设备位姿由一个7维向量描述，包括旋转量<span><img originheight="36" originwidth="118" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.57896423013143210320296833913622:50001231000000:2800:688BB4E0F7F7513D1BB676733EFBAEB1669C99BC5F4012C8EB81949274213EE5.png" class="notEnlarge" width="118" height="36"></span>和位移量<span><img originheight="36" originwidth="89" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.38240814423627360744690840943979:50001231000000:2800:5C6228558B1AA224D67C48C250AB69E43775608E619ED0ECBD9410BE13AC8A66.png" class="notEnlarge" width="89" height="36"></span>。其中旋转量<span><img originheight="36" originwidth="118" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.79882133171977192137896071569399:50001231000000:2800:E35B72E47CF57F1B76E3D4D81D1682ADAE9646964FB9809D28FC9CF59398E507.png" class="notEnlarge" width="118" height="36"></span>是一组四元数，描述了设备相对于坐标原点的旋转状态；位移量<span><img originheight="36" originwidth="89" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.66954484348162809709694605614690:50001231000000:2800:4FB35E8463972064E3B73CF466CB6BD07F3A1F247BF6EE87EC6C993D3364411D.png" class="notEnlarge" width="89" height="36"></span>是一组三维向量，描述了设备相对于坐标原点的平移状态，如下图所示。</p> <div class="fignone" id="zh-cn_topic_0000002363785081_fig12030161166"><span class="figcap"><b>图2 </b>设备位姿的旋转和平移变化示意图</span><br><span><img originheight="456" originwidth="1032" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114352.49395666815666251031261969656172:50001231000000:2800:082D5D3B37D09E2FE1AA045A8E8287F525A712B5441132447A9836E94970023B.png" width="920" height="406.51162790697674"></span></div> <p id="ZH-CN_TOPIC_0000002363785089__zh-cn_topic_0000002363785081_p829153619138">通过旋转分量和平移分量，可以描述设备在空间中任意时刻的位姿状态。</p> </div> <div class="tiledSection"><h2 id="section0222145391119">引入AR Engine<i class="anchor-icon anchor-icon-link" anchorid="section0222145391119" tips="复制节点链接"></i></h2><p>开发者可参考管理AR会话章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arsession#section1410827131110">引入AR Engine</a>。</p> </div> <div class="tiledSection"><h2 id="section1574219011519">创建ARSession<i class="anchor-icon anchor-icon-link" anchorid="section1574219011519" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002363785089__p1955711516155">开发者可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arsession">管理AR会话</a>创建ARSession。</p> </div> <div class="tiledSection"><h2 id="section1894312892612">获取设备当前位姿<i class="anchor-icon anchor-icon-link" anchorid="section1894312892612" tips="复制节点链接"></i></h2><ol><li>创建一个空位姿变量cameraPose。<div _ngcontent-mwj-c106="" class="highlight-div"><div _ngcontent-mwj-c106="" class="highlight-div-header"><div _ngcontent-mwj-c106="" class="highlight-div-header-left"><div _ngcontent-mwj-c106="" class="handle-button expand-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwj-c106="" class="highlight-div-header-right"><div _ngcontent-mwj-c106="" class="handle-button ai-button"></div><div _ngcontent-mwj-c106="" class="handle-button line-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwj-c106="" class="handle-button theme-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwj-c106="" class="handle-button copy-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARPose *cameraPose = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARPose_Create</span>(arSession, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;cameraPose);</li></ol></pre></div></div> </li><li>获取当前时刻相机位姿信息，并存储在cameraPose变量中。<div _ngcontent-mwj-c106="" class="highlight-div"><div _ngcontent-mwj-c106="" class="highlight-div-header"><div _ngcontent-mwj-c106="" class="highlight-div-header-left"><div _ngcontent-mwj-c106="" class="handle-button expand-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwj-c106="" class="highlight-div-header-right"><div _ngcontent-mwj-c106="" class="handle-button ai-button"></div><div _ngcontent-mwj-c106="" class="handle-button line-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwj-c106="" class="handle-button theme-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwj-c106="" class="handle-button copy-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建一个新的AREngine_ARFrame对象。</span></li><li>AREngine_ARFrame *arFrame = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_Create</span>(arSession, &amp;arFrame);</li><li><span class="hljs-comment">// 更新当前帧的结果到arFrame。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Update</span>(arSession, arFrame);</li><li><span class="hljs-comment">// 获取当前帧的相机参数对象。</span></li><li>AREngine_ARCamera *arCamera = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARFrame_AcquireCamera</span>(arSession, arFrame, &amp;arCamera);</li><li><span class="hljs-comment">// 获取当前时刻相机位姿信息。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARCamera_GetPose</span>(arSession, arCamera, cameraPose);</li></ol></pre></div></div> </li></ol><ol start="3"><li>从cameraPose中获取相机位姿的不同分量，包括平移分量和旋转分量。<div _ngcontent-mwj-c106="" class="highlight-div"><div _ngcontent-mwj-c106="" class="highlight-div-header"><div _ngcontent-mwj-c106="" class="highlight-div-header-left"><div _ngcontent-mwj-c106="" class="handle-button expand-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwj-c106="" class="highlight-div-header-right"><div _ngcontent-mwj-c106="" class="handle-button ai-button"></div><div _ngcontent-mwj-c106="" class="handle-button line-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwj-c106="" class="handle-button theme-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwj-c106="" class="handle-button copy-button"><div _ngcontent-mwj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">float</span> poseRaw[<span class="hljs-number">7</span>] = { <span class="hljs-number">0.0f</span> };</li><li><span class="hljs-built_in">HMS_AREngine_ARPose_GetPoseRaw</span>(arSession, cameraPose, poseRaw, <span class="hljs-number">7</span>);</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>