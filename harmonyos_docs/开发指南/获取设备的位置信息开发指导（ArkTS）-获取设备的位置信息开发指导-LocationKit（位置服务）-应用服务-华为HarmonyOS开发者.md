<h1 _ngcontent-aof-c119="" class="doc-title ng-star-inserted" title="获取设备的位置信息开发指导（ArkTS）"> 获取设备的位置信息开发指导（ArkTS） </h1>

<div _ngcontent-aof-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="场景概述">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述" tips="复制节点链接"></i></h2><p>开发者可以调用HarmonyOS位置相关接口，获取设备实时位置，或者最近的历史位置，以及监听设备的位置变化。</p> <p>对于位置敏感的应用业务，建议获取设备实时位置信息。如果不需要设备实时位置信息，并且希望尽可能的节省耗电，开发者可以考虑获取最近的历史位置。</p> </div> <div class="tiledSection"><h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2><p>获取设备的位置信息所使用的接口如下，详细说明参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/location-api" target="_blank">Location Kit API参考</a>。</p> <p>本模块能力仅支持WGS-84坐标系，如需转换成其他坐标系，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/map-convert-coordinate" target="_blank">坐标转换工具</a>。</p> <p><strong>表2</strong> 获取设备的位置信息接口介绍</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.5.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.3.1.2" valign="top" width="50%"><p>功能描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanageronlocationchange" target="_blank">on(type: 'locationChange', request: LocationRequest | ContinuousLocationRequest, callback: Callback&lt;Location&gt;): void</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>开启位置变化订阅，并发起定位请求。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagerofflocationchange" target="_blank">off(type: 'locationChange', callback?: Callback&lt;Location&gt;): void</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>关闭位置变化订阅，并删除对应的定位请求。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagergetcurrentlocation" target="_blank">getCurrentLocation(request: CurrentLocationRequest | SingleLocationRequest, callback: AsyncCallback&lt;Location&gt;): void</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取当前位置，使用callback回调异步返回结果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagergetcurrentlocation-2" target="_blank">getCurrentLocation(request?: CurrentLocationRequest | SingleLocationRequest): Promise&lt;Location&gt;</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取当前位置，使用Promise方式异步返回结果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagergetlastlocation" target="_blank">getLastLocation(): Location</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取最近一次定位结果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#geolocationmanagerislocationenabled" target="_blank">isLocationEnabled(): boolean</a></p> </td> <td class="cellrowborder" valign="top" width="50%"><p>判断位置服务是否已经开启。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2><ol><li><p>获取设备的位置信息，需要有位置权限，位置权限申请的方法和步骤见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/location-permission-guidelines">申请位置权限开发指导</a>。</p> </li><li><p>导入geoLocationManager模块，所有与基础定位能力相关的功能API，都是通过该模块提供的。</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li></ol></pre></div></div> </li><li><p>调用获取位置接口之前需要先判断位置开关是否打开。</p> <p>查询当前位置开关状态，返回结果为布尔值，true代表位置开关开启，false代表位置开关关闭，示例代码如下：</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> locationEnabled = geoLocationManager.<span class="hljs-title function_">isLocationEnabled</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">", message:"</span>  + err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> <p>如果位置开关未开启，可以拉起全局开关设置弹框，引导用户打开位置开关，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-abilityaccessctrl#requestglobalswitch12" target="_blank">拉起全局开关设置弹框</a>。</p> </li><li><p>单次获取当前设备位置。多用于查看当前位置、签到打卡、服务推荐等场景。</p> <ul><li><p>方式一：获取系统缓存的最新位置。</p> <p>如果系统当前没有缓存位置会返回错误码。</p> <p>推荐优先使用该接口获取位置，可以减少系统功耗。</p> <p>如果对位置的新鲜度比较敏感，可以先获取缓存位置，将位置中的时间戳与当前时间对比，若新鲜度不满足预期可以使用方式二获取位置。</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span></li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> location = geoLocationManager.<span class="hljs-title function_">getLastLocation</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>}</li></ol></pre></div></div> </li><li><p>方式二：获取当前位置。</p> <p>首先要实例化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#singlelocationrequest12" target="_blank">SingleLocationRequest</a>对象，用于告知系统该向应用提供何种类型的位置服务，以及单次定位超时时间。</p> <ul><li><p>设置LocatingPriority：</p> <p>如果对位置的返回精度要求较高，建议LocatingPriority参数优先选择PRIORITY_ACCURACY，会将一段时间内精度较好的结果返回给应用。</p> <p>如果对定位速度要求较高，建议LocatingPriority参数选择PRIORITY_LOCATING_SPEED，会将最先拿到的定位结果返回给应用。</p> <p>两种定位策略均会同时使用GNSS定位和网络定位技术，以便在室内和户外场景下均可以获取到位置结果，对设备的硬件资源消耗较大，功耗也较大。</p> </li><li><p>设置locatingTimeoutMs：</p> <p>因为设备环境、设备所处状态、系统功耗管控策略等的影响，定位返回的时延会有较大波动，建议把单次定位超时时间设置为10秒。</p> </li></ul> <p>以快速定位策略(PRIORITY_LOCATING_SPEED)为例，调用方式如下：</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: geoLocationManager.<span class="hljs-property">SingleLocationRequest</span> = {</li><li>   <span class="hljs-string">'locatingPriority'</span>: geoLocationManager.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>,</li><li>   <span class="hljs-string">'locatingTimeoutMs'</span>: <span class="hljs-number">10000</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>   geoLocationManager.<span class="hljs-title function_">getCurrentLocation</span>(request).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> { <span class="hljs-comment">// 调用getCurrentLocation获取当前设备位置，通过promise接收上报的位置</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'current location: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>   })</li><li>   .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> { <span class="hljs-comment">// 接收上报的错误码</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'promise, getCurrentLocation: error='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>   });</li><li> } <span class="hljs-keyword">catch</span> (err) {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li> }</li></ol></pre></div></div> </li></ul> <p>通过本模块获取到的坐标均为WGS-84坐标系坐标点，如需使用其它坐标系类型的坐标点，请进行坐标系转换后再使用。</p> <p>可使用三方地图提供的SDK能力进行坐标系转换。</p> </li><li><p>持续定位。多用于导航、运动轨迹、出行等场景。</p> <p>首先要实例化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#continuouslocationrequest12" target="_blank">ContinuousLocationRequest</a>对象，用于告知系统该向应用提供何种类型的位置服务，以及位置结果上报的频率。</p> <ul><li><p>设置locationScenario：</p> <p>建议locationScenario参数优先根据应用的使用场景进行设置，该参数枚举值定义参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager#useractivityscenario12" target="_blank">UserActivityScenario</a>，例如地图在导航时使用NAVIGATION参数，可以持续在室内和室外场景获取位置用于导航。</p> </li><li><p>设置interval：</p> <p>表示上报位置信息的时间间隔，单位是秒，默认值为1秒。如果对位置上报时间间隔无特殊要求，可以不填写该字段。</p> </li></ul> <p>以地图导航场景为例，调用方式如下：</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { geoLocationManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocationKit'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: geoLocationManager.<span class="hljs-property">ContinuousLocationRequest</span>= {</li><li>   <span class="hljs-string">'interval'</span>: <span class="hljs-number">1</span>,</li><li>   <span class="hljs-string">'locationScenario'</span>: geoLocationManager.<span class="hljs-property">UserActivityScenario</span>.<span class="hljs-property">NAVIGATION</span></li><li>}</li><li><span class="hljs-keyword">let</span> locationCallback = (<span class="hljs-attr">location</span>:geoLocationManager.<span class="hljs-property">Location</span>):<span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'locationCallback: data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(location));</li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>   geoLocationManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, request, locationCallback);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"errCode:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>}</li></ol></pre></div></div> <p>如果不主动结束定位可能导致设备功耗高，耗电快；建议在不需要获取定位信息时及时结束定位。</p> <div _ngcontent-aof-c106="" class="highlight-div"><div _ngcontent-aof-c106="" class="highlight-div-header"><div _ngcontent-aof-c106="" class="highlight-div-header-left"><div _ngcontent-aof-c106="" class="handle-button expand-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aof-c106="" class="highlight-div-header-right"><div _ngcontent-aof-c106="" class="handle-button ai-button"></div><div _ngcontent-aof-c106="" class="handle-button line-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aof-c106="" class="handle-button theme-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aof-c106="" class="handle-button copy-button"><div _ngcontent-aof-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aof-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>geoLocationManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'locationChange'</span>, locationCallback);</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>