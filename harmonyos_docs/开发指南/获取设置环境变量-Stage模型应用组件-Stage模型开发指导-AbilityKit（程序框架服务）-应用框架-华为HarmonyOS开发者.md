<h1 _ngcontent-xks-c119="" class="doc-title ng-star-inserted" title="获取/设置环境变量"> 获取/设置环境变量 </h1>

<div _ngcontent-xks-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>环境变量涵盖了所有可能影响应用运行时的环境配置信息，包括应用可指定的内部环境变量（字体大小、外观、语言等）和应用可感知的外部环境变量（屏幕方向等）。</p>    <p>通常条件下，环境变量会跟随系统设置变化。</p>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.5.1.1" valign="top" width="25%">场景</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.5.1.2" valign="top" width="25%">说明</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.5.1.3" valign="top" width="25%">约束限制</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.5.1.4" valign="top" width="25%">场景举例</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%"><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#获取环境变量">获取环境变量</a></td>         <td class="cellrowborder" valign="top" width="25%">开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getconfigurationsync10" target="_blank">getConfigurationSync</a>主动获取当前环境变量，包括深浅色模式、屏幕方向、语言地区、屏幕密度、设备类型等。</td>         <td class="cellrowborder" valign="top" width="25%">当前仅支持同步获取，使用方式参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getconfigurationsync10" target="_blank">ResourceManager.getConfigurationSync</a>。</td>         <td class="cellrowborder" valign="top" width="25%">应用运行过程中，可以主动获取当前应用深浅色模式，以更新用户界面显示。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置环境变量">设置环境变量</a></td>         <td class="cellrowborder" valign="top" width="25%">          <p>当前仅支持应用自定义字体大小、深浅色、语言。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置字体大小">设置字体大小</a></p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置深浅色模式">设置深浅色模式</a></p>          <p>- <a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置应用语言">设置应用语言</a></p></td>         <td class="cellrowborder" valign="top" width="25%">当应用设置环境变量后，应用将无法通过订阅感知到对应的环境变量在系统中的变化。</td>         <td class="cellrowborder" valign="top" width="25%">应用自定义字体大小，以提升用户体验。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%"><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#订阅环境变量">订阅环境变量</a></td>         <td class="cellrowborder" valign="top" width="25%">通过订阅环境变量，及时感知系统环境变化 。支持订阅的环境变量包括语言、深浅色、屏幕方向等，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>。</td>         <td class="cellrowborder" valign="top" width="25%">          <p>- 如果开发者将环境变量配置为不跟随系统变化（即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file#configuration标签">configuration标签</a>中的对应字段取值为“nonFollowSystem”），应用将无法通过订阅感知对应的环境变量在系统中的变化。</p>          <p>- 应用订阅环境变量后，当应用处于后台时，环境变量发生变更，应用将无法实时收到订阅通知。相关通知推送会被延迟处理，待应用切换回前台时，才会收到订阅通知。</p></td>         <td class="cellrowborder" valign="top" width="25%">当用户旋转设备屏幕时，应用可以通过订阅环境变量感知环境变化重新布局用户界面，以适应屏幕方向和尺寸。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="获取环境变量">获取环境变量<i class="anchor-icon anchor-icon-link" anchorid="获取环境变量" tips="复制节点链接"></i></h2>          <p>开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getconfigurationsync10" target="_blank">getConfigurationSync</a>主动获取当前<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#configuration" target="_blank">环境变量</a>，包括深浅色模式、屏幕方向、语言地区、屏幕密度、设备类型等，对应用程序作出相应处理，提供更好的用户体验。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getConfigurationSync</span>();</li><li>      <span class="hljs-comment">// 屏幕方向</span></li><li>      <span class="hljs-keyword">let</span> direction = value.<span class="hljs-property">direction</span>;</li><li>      <span class="hljs-comment">// 语言文字国家地区</span></li><li>      <span class="hljs-keyword">let</span> locale = value.<span class="hljs-property">locale</span>;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"getConfigurationSync error is "</span> + error);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置环境变量">设置环境变量<i class="anchor-icon anchor-icon-link" anchorid="设置环境变量" tips="复制节点链接"></i></h2>          <p>支持应用自定义的环境变量包括<a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置字体大小">字体大小</a>、<a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置深浅色模式">深浅色模式</a>、<a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#设置应用语言">应用语言</a>，其他环境变量（例如屏幕方向等）均不支持直接设置。</p>    </div>    <div class="tiledSection">     <h3 id="设置字体大小" class="firsth2">设置字体大小<i class="anchor-icon anchor-icon-link" anchorid="设置字体大小" tips="复制节点链接"></i></h3>          <p>应用字体大小默认不跟随系统变化，开发者可以通过将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file#configuration标签">configuration标签</a>中fontSizeScale的值配置为followSystem，使得应用字体大小跟随系统变化。</p>     <p>开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetfontsizescale13" target="_blank">setFontSizeScale</a>设置应用字体大小。设置后，应用字体将不跟随系统变化，不再支持订阅系统字体大小变化。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    });</li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    applicationContext.<span class="hljs-title function_">setFontSizeScale</span>(<span class="hljs-number">2</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置深浅色模式">设置深浅色模式<i class="anchor-icon anchor-icon-link" anchorid="设置深浅色模式" tips="复制节点链接"></i></h3>          <p>应用深浅色模式默认跟随系统。开发者可以设置应用或组件的深浅色模式。设置后，不再支持订阅系统的深浅色模式变化。</p>     <p>配置生效的优先级为：UIAbility/UIExtensionAbility的深浅色模式 &gt; 应用的深浅色模式 &gt; 系统的深浅色模式。</p>     <ul>      <li>       <p><strong>设置应用的深浅色模式：</strong> 使用ApplicationContext的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetcolormode11" target="_blank">setColorMode</a>接口，可以设置应用深浅色模式。</p>       <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content.'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>      applicationContext.<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p><strong>设置UIAbility的深浅色模式：</strong> 使用UIAbilityContext的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#setcolormode18" target="_blank">setColorMode</a>，可以设置UIAbility的深浅色模式。</p>       <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content.'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">let</span> uiAbilityContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>      uiAbilityContext.<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p><strong>设置UIExtensionAbility的深浅色模式：</strong> 使用UIExtensionContext的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiextensioncontext#setcolormode18" target="_blank">setColorMode</a>，可以设置UIExtensionAbility的深浅色模式。</p>       <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// UIExtensionAbility不支持三方应用直接继承，故以派生类ShareExtensionAbility举例说明。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ShareExtensionAbility</span>, <span class="hljs-title class_">ConfigurationConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ShareExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onForeground</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> uiExtensionContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    uiExtensionContext.<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="设置应用语言">设置应用语言<i class="anchor-icon anchor-icon-link" anchorid="设置应用语言" tips="复制节点链接"></i></h3>          <p>应用语言默认跟随系统语言变化。开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetlanguage11" target="_blank">setLanguage</a>设置应用语言。设置后，不再支持订阅系统语言变化。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content.'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>      applicationContext.<span class="hljs-title function_">setLanguage</span>(<span class="hljs-string">'zh-cn'</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="订阅环境变量">订阅环境变量<i class="anchor-icon anchor-icon-link" anchorid="订阅环境变量" tips="复制节点链接"></i></h2>          <p>系统配置的变化通常由“设置”中的选项或“控制中心”中的图标触发。订阅环境变量变化，可以使应用程序更加智能地响应系统环境变化，从而提供更好的用户体验。查看当前支持订阅变化的环境变量，参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>。</p>     <p>基于当前的应用模型，可以通过以下几种方式来实现订阅环境变量的变化。</p>     <ul>      <li><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#使用applicationcontext订阅回调">使用ApplicationContext订阅回调</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#在abilitystage组件管理器中订阅回调">在AbilityStage组件管理器中订阅回调</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#在uiability组件中订阅回调">在UIAbility组件中订阅回调</a></li>      <li><a href="/consumer/cn/doc/harmonyos-guides/subscribe-system-environment-variable-changes#在extensionability组件中订阅回调">在ExtensionAbility组件中订阅回调</a></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="使用applicationcontext订阅回调" class="firsth2">使用ApplicationContext订阅回调<i class="anchor-icon anchor-icon-link" anchorid="使用applicationcontext订阅回调" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext" target="_blank">ApplicationContext</a>提供了注册回调函数以订阅环境变量的变化，并且可以通过调用相应的方法来撤销该回调。这有助于在资源不再需要时释放相关资源，从而提高系统的可靠性和性能。</p>     <ol>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextonenvironment" target="_blank">on</a>方法，应用程序可以通过在非应用组件模块中订阅环境变量的变化来动态响应这些变化。例如，使用该方法在页面中监测系统语言的变化。</p>       <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">EnvironmentCallback</span>, <span class="hljs-title class_">Configuration</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[MyAbility]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callbackId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 注册订阅系统环境变化的ID</span></li><li>
</li><li>  <span class="hljs-title function_">subscribeConfigurationUpdate</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">systemLanguage</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">language</span>; <span class="hljs-comment">// 获取系统当前语言</span></li><li>
</li><li>    <span class="hljs-comment">// 1.获取ApplicationContext</span></li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>
</li><li>    <span class="hljs-comment">// 2.通过applicationContext订阅环境变量变化</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">environmentCallback</span>: <span class="hljs-title class_">EnvironmentCallback</span> = {</li><li>      <span class="hljs-title function_">onConfigurationUpdated</span>(<span class="hljs-params">newConfig: Configuration</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onConfigurationUpdated systemLanguage is <span class="hljs-subst">${systemLanguage}</span>, newConfig: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(newConfig)}</span>`</span>);</li><li>        <span class="hljs-keyword">if</span> (systemLanguage !== newConfig.<span class="hljs-property">language</span>) {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`systemLanguage from <span class="hljs-subst">${systemLanguage}</span> changed to <span class="hljs-subst">${newConfig.language}</span>`</span>);</li><li>          systemLanguage = newConfig.<span class="hljs-property">language</span>; <span class="hljs-comment">// 将变化之后的系统语言保存，作为下一次变化前的系统语言</span></li><li>        }</li><li>      },</li><li>      <span class="hljs-title function_">onMemoryLevel</span>(<span class="hljs-params">level</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onMemoryLevel level: <span class="hljs-subst">${level}</span>`</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackId</span> = applicationContext.<span class="hljs-title function_">on</span>(<span class="hljs-string">'environment'</span>, environmentCallback);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to register applicationContext. Code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 页面展示</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在资源使用完成之后，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextoffenvironment-1" target="_blank">off</a>方法释放相关资源。</p>       <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[MyAbility]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callbackId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 注册订阅系统环境变化的ID</span></li><li>
</li><li>  <span class="hljs-title function_">unsubscribeConfigurationUpdate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> applicationContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      applicationContext.<span class="hljs-title function_">off</span>(<span class="hljs-string">'environment'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackId</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to unregister applicationContext. Code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 页面展示</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="在abilitystage组件管理器中订阅回调">在AbilityStage组件管理器中订阅回调<i class="anchor-icon anchor-icon-link" anchorid="在abilitystage组件管理器中订阅回调" tips="复制节点链接"></i></h3>          <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#onconfigurationupdate" target="_blank">AbilityStage.onConfigurationUpdate()</a>回调方法订阅环境变量的变化。当环境变量发生变化时，会调用该回调方法。在该方法中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>对象获取最新的环境变量信息。可以进行相应的界面适配等操作，从而提高系统的灵活性和可维护性。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>DevEco Studio默认工程中未自动生成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage" target="_blank">AbilityStage</a>，AbilityStage文件的创建参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/abilitystage#开发步骤">AbilityStage开发步骤</a>。</li>        <li>当使用回调方法订阅系统环境变量的变化时，该回调方法会随着AbilityStage的生命周期而存在，在Module销毁时一并销毁。</li>       </ul>      </div></div></div>     <p>例如，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-abilitystage#onconfigurationupdate" target="_blank">AbilityStage.onConfigurationUpdate()</a>回调方法中实现监测系统语言的变化。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityStage</span>, <span class="hljs-title class_">Configuration</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[MyAbilityStage]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">systemLanguage</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 系统当前语言</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbilityStage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbilityStage</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>    systemLanguage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">language</span>; <span class="hljs-comment">// Module首次加载时，获取系统当前语言</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`systemLanguage is <span class="hljs-subst">${systemLanguage}</span>`</span>);</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onConfigurationUpdate, language: <span class="hljs-subst">${newConfig.language}</span>`</span>);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onConfigurationUpdated systemLanguage is <span class="hljs-subst">${systemLanguage}</span>, newConfig: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(newConfig)}</span>`</span>);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (systemLanguage !== newConfig.<span class="hljs-property">language</span>) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`systemLanguage from <span class="hljs-subst">${systemLanguage}</span> changed to <span class="hljs-subst">${newConfig.language}</span>`</span>);</li><li>      systemLanguage = newConfig.<span class="hljs-property">language</span>; <span class="hljs-comment">// 将变化之后的系统语言保存，作为下一次变化前的系统语言</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在uiability组件中订阅回调">在UIAbility组件中订阅回调<i class="anchor-icon anchor-icon-link" anchorid="在uiability组件中订阅回调" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>组件提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">UIAbility.onConfigurationUpdate()</a>回调方法用于订阅环境变量的变化。当环境变量发生变化时，会调用该回调方法。在该方法中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>对象获取最新的环境变量信息，而无需重启UIAbility。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>当应用通过回调方法订阅环境变量变化时，该订阅会随着所在UIAbility的生命周期持续有效。一旦UIAbility被销毁，之前注册的所有回调订阅将自动失效，同时应用将不会再收到订阅的回调信息。</li>        <li>如果使用该接口监听屏幕方向变化，需要在module.json5配置文件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#abilities标签">abilities标签</a>中将orientation字段配置为auto_rotation。</li>       </ul>      </div></div></div>     <p>例如，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">onConfigurationUpdate()</a>回调方法中实现监测系统语言的变化。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[EntryAbility]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">systemLanguage</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 系统当前语言</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    systemLanguage = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">config</span>.<span class="hljs-property">language</span>; <span class="hljs-comment">// UIAbility实例首次加载时，获取系统当前语言</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`systemLanguage is <span class="hljs-subst">${systemLanguage}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`onConfigurationUpdated systemLanguage is <span class="hljs-subst">${systemLanguage}</span>, newConfig: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(newConfig)}</span>`</span>);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (systemLanguage !== newConfig.<span class="hljs-property">language</span>) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`systemLanguage from <span class="hljs-subst">${systemLanguage}</span> changed to <span class="hljs-subst">${newConfig.language}</span>`</span>);</li><li>      systemLanguage = newConfig.<span class="hljs-property">language</span>; <span class="hljs-comment">// 将变化之后的系统语言保存，作为下一次变化前的系统语言</span></li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在extensionability组件中订阅回调">在ExtensionAbility组件中订阅回调<i class="anchor-icon anchor-icon-link" anchorid="在extensionability组件中订阅回调" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-extensionability" target="_blank">ExtensionAbility</a>组件提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">onConfigurationUpdate()</a>回调方法用于订阅环境变量的变化。当环境变量发生变化时，会调用该回调方法。在该方法中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration" target="_blank">Configuration</a>对象获取最新的环境变量信息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当应用通过回调方法订阅环境变量变化时，该订阅会随着所在ExtensionAbility的生命周期持续有效。一旦ExtensionAbility被销毁，之前注册的所有回调订阅将自动失效，同时应用将不会再收到订阅的回调信息。</p>      </div></div></div>     <p>以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability" target="_blank">FormExtensionAbility</a>为例说明。例如，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonconfigurationupdate" target="_blank">onConfigurationUpdate()</a>回调方法中实现环境变量的变化。</p>     <div _ngcontent-xks-c106="" class="highlight-div"><div _ngcontent-xks-c106="" class="highlight-div-header"><div _ngcontent-xks-c106="" class="highlight-div-header-left"><div _ngcontent-xks-c106="" class="handle-button expand-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xks-c106="" class="highlight-div-header-right"><div _ngcontent-xks-c106="" class="handle-button ai-button"></div><div _ngcontent-xks-c106="" class="handle-button line-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xks-c106="" class="handle-button theme-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xks-c106="" class="handle-button copy-button"><div _ngcontent-xks-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xks-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FormExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Configuration</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[EntryAbility]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-params">newConfig: Configuration</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onConfigurationUpdate:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newConfig));</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>