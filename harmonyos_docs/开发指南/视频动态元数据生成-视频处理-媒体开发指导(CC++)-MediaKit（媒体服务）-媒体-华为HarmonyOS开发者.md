<h1 _ngcontent-sdm-c119="" class="doc-title ng-star-inserted" title="视频动态元数据生成"> 视频动态元数据生成 </h1>

<div _ngcontent-sdm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>调用者可以调用本模块提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-videoprocessing" target="_blank">C API接口</a>，实现HDRVivid标准动态元数据生成。</p> <p>该能力常用于视频编辑中，如下图所示：</p> <p><span><img height="94.21987096774195" originheight="157" originwidth="1533" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114449.70676615662243927188313131706617:50001231000000:2800:8EB81EB853A14AD4F03DDA1BA0D68FE93EE5656B20C539C0B69FF4D2D3ED0330.png" title="点击放大" width="920"></span></p> <div class="tiledSection"><h2 id="section179511445715">规格说明<i class="anchor-icon anchor-icon-link" anchorid="section179511445715" tips="复制节点链接"></i></h2><p>支持的数据输入格式：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td align="left" class="cellrowborder" valign="top" width="28.749999999999996%"><p><strong>支持算法格式</strong></p> </td> <td align="left" class="cellrowborder" valign="top" width="20.330000000000002%"><p><strong>参数</strong></p> </td> <td align="left" class="cellrowborder" valign="top" width="50.92%"><p><strong>输入</strong></p> </td> </tr> <tr><td class="cellrowborder" rowspan="3" valign="top" width="28.749999999999996%"><p><strong>BT2020PQ_LIMIT</strong></p> <p><strong>HDR_VIVID</strong></p> </td> <td class="cellrowborder" valign="top" width="20.330000000000002%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_colorspace" target="_blank">ColorSpace</a></p> </td> <td class="cellrowborder" valign="top" width="50.92%"><p>OH_COLORSPACE_BT2020_PQ_LIMIT</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_metadatatype" target="_blank">MetadataType</a></p> </td> <td class="cellrowborder" valign="top"><p>OH_VIDEO_HDR_VIVID</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-buffer-h#oh_nativebuffer_format" target="_blank">pixelFormat</a></p> </td> <td class="cellrowborder" valign="top"><p>NATIVEBUFFER_PIXEL_FMT_YCBCR_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_YCRCB_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_RGBA_1010102</p> </td> </tr> <tr><td class="cellrowborder" rowspan="3" valign="top" width="28.749999999999996%"><p><strong>BT2020HLG_LIMIT</strong></p> <p><strong>HDR_VIVID</strong></p> </td> <td class="cellrowborder" valign="top" width="20.330000000000002%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_colorspace" target="_blank">ColorSpace</a></p> </td> <td class="cellrowborder" valign="top" width="50.92%"><p>OH_COLORSPACE_BT2020_HLG_LIMIT</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_metadatatype" target="_blank">MetadataType</a></p> </td> <td class="cellrowborder" valign="top"><p>OH_VIDEO_HDR_VIVID</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-buffer-h#oh_nativebuffer_format" target="_blank">pixelFormat</a></p> </td> <td class="cellrowborder" valign="top"><p>NATIVEBUFFER_PIXEL_FMT_YCBCR_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_YCRCB_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_RGBA_1010102</p> </td> </tr> <tr><td class="cellrowborder" rowspan="3" valign="top" width="28.749999999999996%"><p><strong>HLG</strong></p> </td> <td class="cellrowborder" valign="top" width="20.330000000000002%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_colorspace" target="_blank">ColorSpace</a></p> </td> <td class="cellrowborder" valign="top" width="50.92%"><p>OH_COLORSPACE_BT2020_HLG_LIMIT</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_metadatatype" target="_blank">MetadataType</a></p> </td> <td class="cellrowborder" valign="top"><p>OH_VIDEO_HDR_HLG</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-buffer-h#oh_nativebuffer_format" target="_blank">pixelFormat</a></p> </td> <td class="cellrowborder" valign="top"><p>NATIVEBUFFER_PIXEL_FMT_YCBCR_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_YCRCB_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_RGBA_1010102</p> </td> </tr> <tr><td class="cellrowborder" rowspan="3" valign="top" width="28.749999999999996%"><p><strong>HDR10</strong></p> </td> <td class="cellrowborder" valign="top" width="20.330000000000002%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_colorspace" target="_blank">ColorSpace</a></p> </td> <td class="cellrowborder" valign="top" width="50.92%"><p>OH_COLORSPACE_BT2020_PQ_LIMIT</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-buffer-common-h#oh_nativebuffer_metadatatype" target="_blank">MetadataType</a></p> </td> <td class="cellrowborder" valign="top"><p>OH_VIDEO_HDR_HDR10</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-buffer-h#oh_nativebuffer_format" target="_blank">pixelFormat</a></p> </td> <td class="cellrowborder" valign="top"><p>NATIVEBUFFER_PIXEL_FMT_YCBCR_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_YCRCB_P010,</p> <p>NATIVEBUFFER_PIXEL_FMT_RGBA_1010102</p> </td> </tr>  </tbody></table></div> </div> <p><strong>支持的分辨率规格：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.1" valign="top" width="50%"><p>最小分辨率（单位：像素）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.2" valign="top" width="50%"><p>最大分辨率（单位：像素）</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>32*32</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>8192*8192</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1394744312518">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section1394744312518" tips="复制节点链接"></i></h2><ol><li>为保障转换效率，建议并行转换不超过5个。</li><li>视频动态元数据生成，只支持生成OH_VIDEO_HDR_VIVID类型的动态元数据，转换后会将metadataType修改为OH_VIDEO_HDR_VIVID。</li><li>不允许在视频处理回调函数中，直接调用视频处理相关接口或其他耗时操作，请在应用自己的线程中调用。</li></ol> </div> <div class="tiledSection"><h2 id="section5271193561818">开发指导<i class="anchor-icon anchor-icon-link" anchorid="section5271193561818" tips="复制节点链接"></i></h2></div> <p>具体实现可参考<a href="https://gitee.com/harmonyos_samples/VideoProcessing" target="_blank">示例工程</a>。</p> <div class="tiledSection"><h3 id="section1697544181813" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="section1697544181813" tips="复制节点链接"></i></h3><div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libvideo_processing.so)</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section140617526180">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section140617526180" tips="复制节点链接"></i></h3><ol><li>添加头文件。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/video_processing_engine/video_processing.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/video_processing_engine/video_processing_types.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_window/external_window.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_buffer/native_buffer.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ace/xcomponent/native_interface_xcomponent.h&gt;</span></span></li></ol></pre></div></div> </li><li>（可选）初始化环境。<div class="p">一般在进程内第一次使用时调用，可提前完成部分耗时操作。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_VideoProcessing_InitializeEnvironment</span>();</li></ol></pre></div></div> </div> </li><li>（可选）查询能力支持。建议在使用对应能力前调用。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//输入格式</span></li><li>VideoProcessing_ColorSpaceInfo videoInfo;</li><li>videoInfo.metadataType = OH_VIDEO_HDR_HDR10;</li><li>videoInfo.colorSpace = OH_COLORSPACE_BT2020_PQ_LIMIT;</li><li>videoInfo.pixelFormat = NATIVEBUFFER_PIXEL_FMT_YCBCR_P010;</li><li>
</li><li><span class="hljs-comment">//输入格式是否支持转换为vivid元数据类型</span></li><li><span class="hljs-type">bool</span> isSupport = <span class="hljs-built_in">OH_VideoProcessing_IsMetadataGenerationSupported</span>(&amp;videoInfo);</li></ol></pre></div></div> </li><li>创建动态元数据生成转换模块。<p>应用可以通过视频处理引擎模块类型来创建动态元数据生成模块。示例中的变量说明如下：</p> <ul><li>videoProcessor：动态元数据生成模块实例。</li><li>VIDEO_PROCESSING_TYPE_METADATA_GENERATION：动态元数据生成类型。</li><li>预期返回值：VIDEO_PROCESSING_SUCCESS</li></ul> <div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过指定视频处理引擎类型创建动态元数据生成模块实例</span></li><li>OH_VideoProcessing* videoProcessor = <span class="hljs-literal">nullptr</span>;</li><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_Create</span>(&amp;videoProcessor, VIDEO_PROCESSING_TYPE_METADATA_GENERATION);</li></ol></pre></div></div> </li><li>配置异步回调函数。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 回调函数声明（其中userData会传递注册回调时传入的调用者数据，如：this指针）</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnError</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, VideoProcessing_ErrorCode error, <span class="hljs-type">void</span>* userData)</span></span>;</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnState</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, VideoProcessing_State state, <span class="hljs-type">void</span>* userData)</span></span>;</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnNewOutputBuffer</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, <span class="hljs-type">uint32_t</span> index, <span class="hljs-type">void</span>* userData)</span></span>;</li><li>
</li><li><span class="hljs-comment">// 创建回调实例</span></li><li>VideoProcessing_Callback* callback = <span class="hljs-literal">nullptr</span>;</li><li>ret = <span class="hljs-built_in">OH_VideoProcessingCallback_Create</span>(&amp;callback);</li><li><span class="hljs-comment">// 绑定回调函数</span></li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnError</span>(callback, OnError);</li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnState</span>(callback, OnState);</li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnNewOutputBuffer</span>(callback, OnNewOutputBuffer);</li><li><span class="hljs-comment">// 注册回调函数</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_RegisterCallback</span>(videoProcessor, callback, <span class="hljs-keyword">this</span>);</li></ol></pre></div></div> </li><li>获取Surface。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//获取输入surface</span></li><li>OHNativeWindow *inWindow = <span class="hljs-literal">nullptr</span>;</li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_GetSurface</span>(videoProcessor, &amp;inWindow);</li></ol></pre></div></div> </li><li>设置Surface。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>可以通过XComponent等其他方式获取OHNativeWindow实例，具体参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/native-window-guidelines" target="_blank">NativeWindows开发指导</a>。</p> <p>视频处理引擎的SetSurface的windowOut从XComponent的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/native-window-guidelines" target="_blank">OnSurfaceCreatedCB</a>回调函数获取，需要对windowOut设置元数据类型、数据格式和颜色空间等参数。</p> </div></div></div> <div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置元数据类型、数据格式、颜色空间</span></li><li><span class="hljs-type">uint8_t</span> <span class="hljs-variable">metadataType</span> <span class="hljs-operator">=</span> OH_VIDEO_HDR_HLG;</li><li>OH_NativeWindow_SetMetadataValue(windowOut, OH_HDR_METADATA_TYPE, sizeof(uint8_t), </li><li>(uint8_t *)&amp;metadataType);</li><li><span class="hljs-type">OH_NativeBuffer_Format</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> NATIVEBUFFER_PIXEL_FMT_YCBCR_P010;</li><li>OH_NativeWindow_NativeWindowHandleOpt(windowOut, SET_FORMAT, format);</li><li><span class="hljs-type">OH_NativeBuffer_ColorSpace</span> <span class="hljs-variable">colorSpace</span> <span class="hljs-operator">=</span> OH_COLORSPACE_BT2020_HLG_LIMIT;</li><li>OH_NativeWindow_SetColorSpace(windowOut, colorSpace);</li><li><span class="hljs-comment">// 设置输出surface</span></li><li><span class="hljs-type">VideoProcessing_ErrorCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_VideoProcessing_SetSurface(videoProcessor, windowOut);</li></ol></pre></div></div> </li><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-video-processing-h#oh_videoprocessing_start" target="_blank">OH_VideoProcessing_Start()</a>启动动态元数据生成处理。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始动态元数据生成转换处理</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_Start</span>(videoProcessor);</li></ol></pre></div></div> </li><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-video-processing-h#oh_videoprocessing_stop" target="_blank">OH_VideoProcessing_Stop()</a>停止动态元数据生成处理。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//停止动态元数据生成处理</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_Stop</span>(videoProcessor);</li></ol></pre></div></div> </li><li>释放处理实例。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_VideoProcessingCallback_Destroy</span>(callback);</li><li>callback = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">OH_VideoProcessing_Destroy</span>(videoProcessor);</li><li>videoProcessor = <span class="hljs-literal">nullptr</span>;</li></ol></pre></div></div> </li><li>释放处理资源。<div _ngcontent-sdm-c106="" class="highlight-div"><div _ngcontent-sdm-c106="" class="highlight-div-header"><div _ngcontent-sdm-c106="" class="highlight-div-header-left"><div _ngcontent-sdm-c106="" class="handle-button expand-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdm-c106="" class="highlight-div-header-right"><div _ngcontent-sdm-c106="" class="handle-button ai-button"></div><div _ngcontent-sdm-c106="" class="handle-button line-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdm-c106="" class="handle-button theme-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdm-c106="" class="handle-button copy-button"><div _ngcontent-sdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_VideoProcessing_DeinitializeEnvironment</span>();</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>