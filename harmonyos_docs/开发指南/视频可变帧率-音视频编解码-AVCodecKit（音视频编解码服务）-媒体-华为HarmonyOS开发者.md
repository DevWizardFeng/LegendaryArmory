<h1 _ngcontent-gan-c119="" class="doc-title ng-star-inserted" title="视频可变帧率"> 视频可变帧率 </h1>

<div _ngcontent-gan-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>从API version 15开始，支持视频可变帧率。</p> <p>本模块提供视频可变帧率功能的CAPI接口，通过调用本接口，可以在视频播放过程中根据视频内容动态调整屏幕刷新率，在保障视频播放流畅度的基础上节省屏幕显示功耗。</p>  <div class="tiledSection"><h2 id="适用场景">适用场景<i class="anchor-icon anchor-icon-link" anchorid="适用场景" tips="复制节点链接"></i></h2><p>具有高帧率（&gt;30fps）视频源的播放场景；视频帧率小于或等于30的场景建议以30Hz的刷新率运行。下图以播放一段60fps的视频为例，算法根据视频内容实时调整屏幕刷新率，调节过程中，当刷新率小于视频帧率时，显示前会丢弃部分视频帧以节省功耗。</p> <p><span><img originheight="635" originwidth="1371" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114438.80270213150353423298238012388099:50001231000000:2800:42FFB4568039152C1FE7FD5CA2B209A1620F44702392C69F81823CFECE01069B.png" width="920" height="426.11232676878194"></span></p> </div>  <div class="tiledSection"><h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2><ol><li>只支持硬件解码后直接送显的视频播放场景。</li><li>屏幕整体刷新率会被调整，建议在全屏播放、无弹幕、无动效的场景使用，否则会影响弹幕、动效的流畅度体验。</li><li>依赖解码帧率配置，使用前需要正确配置OH_MD_KEY_FRAME_RATE属性。</li><li>与硬件平台能力相关，当平台不支持时，接口不报错，内部能力不生效，不影响正常解码播放流程。</li></ol> </div>  <div class="tiledSection"><h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2><p>基础解码功能请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/video-decoding">视频解码开发指南</a>，下面仅针对于基础视频解码过程中存在的区别做具体说明。</p> <ol><li><p>解码器配置阶段，添加视频可变帧率使能开关。</p>  <p>示例中的变量说明如下：</p>  <p>• videoDec：视频解码器实例的指针。创建方式参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/video-decoding#surface模式">Surface模式下创建解码器实例对象</a>。</p>  <div _ngcontent-gan-c106="" class="highlight-div"><div _ngcontent-gan-c106="" class="highlight-div-header"><div _ngcontent-gan-c106="" class="highlight-div-header-left"><div _ngcontent-gan-c106="" class="handle-button expand-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gan-c106="" class="highlight-div-header-right"><div _ngcontent-gan-c106="" class="handle-button ai-button"></div><div _ngcontent-gan-c106="" class="handle-button line-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gan-c106="" class="handle-button theme-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gan-c106="" class="handle-button copy-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gan-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-type">int32_t</span> width = <span class="hljs-number">1280</span>; <span class="hljs-comment">// 视频帧宽度。</span></li><li><span class="hljs-type">int32_t</span> height = <span class="hljs-number">720</span>; <span class="hljs-comment">// 视频帧高度。</span></li><li><span class="hljs-type">int32_t</span> fps = <span class="hljs-number">60</span>; <span class="hljs-comment">// 视频帧率。</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_WIDTH, width);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_HEIGHT, height);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_FRAME_RATE, fps);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_VIDEO_DECODER_OUTPUT_ENABLE_VRR, <span class="hljs-number">1</span>);</li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_VideoDecoder_Configure</span>(videoDec, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(format);</li></ol></pre></div></div>  </li><li><p>（可选）视频播放过程中，动态开关视频可变帧率。</p>  <p> 如果用户在播放中开启了弹幕，为了避免本模块输出最终未在屏幕刷新率调节过程中生效，导致计算资源的浪费，可以动态关闭本模块。</p>  <p> 动态关闭如下：</p>  <div _ngcontent-gan-c106="" class="highlight-div"><div _ngcontent-gan-c106="" class="highlight-div-header"><div _ngcontent-gan-c106="" class="highlight-div-header-left"><div _ngcontent-gan-c106="" class="handle-button expand-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gan-c106="" class="highlight-div-header-right"><div _ngcontent-gan-c106="" class="handle-button ai-button"></div><div _ngcontent-gan-c106="" class="handle-button line-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gan-c106="" class="handle-button theme-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gan-c106="" class="handle-button copy-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gan-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_VIDEO_DECODER_OUTPUT_ENABLE_VRR, <span class="hljs-number">0</span>);</li><li><span class="hljs-built_in">OH_VideoDecoder_SetParameter</span>(videoDec, format);</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(format);</li></ol></pre></div></div>  <p> 动态开启如下：</p>  <div _ngcontent-gan-c106="" class="highlight-div"><div _ngcontent-gan-c106="" class="highlight-div-header"><div _ngcontent-gan-c106="" class="highlight-div-header-left"><div _ngcontent-gan-c106="" class="handle-button expand-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gan-c106="" class="highlight-div-header-right"><div _ngcontent-gan-c106="" class="handle-button ai-button"></div><div _ngcontent-gan-c106="" class="handle-button line-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gan-c106="" class="handle-button theme-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gan-c106="" class="handle-button copy-button"><div _ngcontent-gan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gan-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_FRAME_RATE, fps);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_VIDEO_DECODER_OUTPUT_ENABLE_VRR, <span class="hljs-number">1</span>);</li><li><span class="hljs-built_in">OH_VideoDecoder_SetParameter</span>(videoDec, format);</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(format);</li></ol></pre></div></div>  </li></ol> </div> </div> <div></div></div>