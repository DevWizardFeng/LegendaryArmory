<h1 _ngcontent-kui-c119="" class="doc-title ng-star-inserted" title="视频缩放"> 视频缩放 </h1>

<div _ngcontent-kui-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供视频细节增强的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-videoprocessing" target="_blank">C API接口</a>，通过调用本模块的接口，可以实现视频流图像内容的清晰度增强及缩放功能，处理后的数据可以用于送显、播放和录制。</p> <p>典型应用场景如：视频解码 &gt; 视频细节增强 &gt; XComponent显示。</p> <div class="tiledSection"><h2 id="section146441195153">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section146441195153" tips="复制节点链接"></i></h2><ol><li>为保证处理能够实时响应，建议只创建一个实例。</li><li>当前仅支持处理同时满足以下条件的视频：<ul><li>视频为SDR（Standard dynamic range）视频。</li><li>视频的像素格式为NV12、NV21，输出格式与输入格式一致。</li></ul> </li><li>本模块提供4个档位的算法，处理效果逐渐变优，但性能也会逐渐下降。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.3.1.1.5.1.1" valign="top" width="25%"><p>档位</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.3.1.1.5.1.2" valign="top" width="25%"><p>输入分辨率要求（单位：像素）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.3.1.1.5.1.3" valign="top" width="25%"><p>输出分辨率要求（单位：像素）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.3.1.1.5.1.4" valign="top" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>NONE</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，无清晰度增强效果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>LOW</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，等比缩放时无清晰度增强效果。</p> <p>缩放时会对图像进行低质量的清晰度增强，处理速度较快。</p> <p>该档位为默认设置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>MEDIUM</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：(32,2000]</p> <p>高：(32,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，等比缩放时无清晰度增强效果。</p> <p>缩放时会对图像进行中等质量的清晰度增强，处理速度适中。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>HIGH</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[512,2000]</p> <p>高：[512,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[512,2000]</p> <p>高：[512,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>适用于缩放及清晰度增强场景，等比缩放时能进行清晰度增强。</p> <p>缩放时会对图像进行高质量的清晰度增强，处理速度相对较慢。</p> </td> </tr>  </tbody></table></div> </div> </li><li>不允许在视频处理回调函数中，直接调用视频处理相关接口或其他耗时操作，请在应用自己的线程中调用。</li></ol> </div> <div class="tiledSection"><h2 id="section25453143194">开发指导<i class="anchor-icon anchor-icon-link" anchorid="section25453143194" tips="复制节点链接"></i></h2></div> <p>具体实现可参考<a href="https://gitee.com/harmonyos_samples/VideoProcessing" target="_blank">示例工程</a>。</p> <div class="tiledSection"><h3 id="section951192051911" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="section951192051911" tips="复制节点链接"></i></h3><div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libvideo_processing.so)</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section5234103271910">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section5234103271910" tips="复制节点链接"></i></h3><ol><li>添加头文件。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ace/xcomponent/native_interface_xcomponent.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avformat.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/video_processing_engine/video_processing.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/video_processing_engine/video_processing_types.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_window/external_window.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_buffer/native_buffer.h&gt;</span></span></li></ol></pre></div></div> </li><li>（可选）创建解码实例。<div class="p">细节增强模块的输入可以是来自系统解码的视频流，也可以由应用自行往window填充视频数据（例如：应用内部软解后直接将数据填充到window中）。若选择系统解码器对视频文件或视频流媒体进行处理，则可以创建解码实例来作为细节增强模块的输入。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建Demuxer（媒体多路分解器）解析音视频信息(详见代码示例)</span></li><li>OH_AVSource* source_ = <span class="hljs-built_in">OH_AVSource_CreateWithFD</span>(inputFd, inputFileOffset, inputFileSize);</li><li>OH_AVDemuxer* demuxer_ = <span class="hljs-built_in">OH_AVDemuxer_CreateWithSource</span>(source_);</li><li><span class="hljs-keyword">auto</span> sourceFormat = std::<span class="hljs-built_in">shared_ptr</span>&lt;OH_AVFormat&gt;(<span class="hljs-built_in">OH_AVSource_GetSourceFormat</span>(source_), OH_AVFormat_Destroy);</li><li><span class="hljs-comment">// 创建视频解码器</span></li><li>OH_AVCodec * decoder_ = <span class="hljs-built_in">OH_VideoDecoder_CreateByMime</span>(videoCodecMime.<span class="hljs-built_in">c_str</span>());</li><li><span class="hljs-comment">// 配置视频信息</span></li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_WIDTH, videoWidth);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_HEIGHT, videoHeight);</li><li><span class="hljs-built_in">OH_AVFormat_SetDoubleValue</span>(format, OH_MD_KEY_FRAME_RATE, frameRate);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_PIXEL_FORMAT, pixelFormat);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_ROTATION, rotation);</li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_VideoDecoder_Configure</span>(decoder_, format);</li><li><span class="hljs-built_in">OH_AVFormat_Destroy</span>(format);</li><li><span class="hljs-comment">// 配置回调，维护视频解码器buffer队列（详见代码示例）</span></li><li><span class="hljs-built_in">OH_VideoDecoder_RegisterCallback</span>(decoder_,</li><li>        {SampleCallback::OnCodecError, SampleCallback::OnCodecFormatChange,</li><li>         SampleCallback::OnNeedInputBuffer, SampleCallback::OnNewOutputBuffer}, videoDecContext_);</li><li><span class="hljs-comment">// 准备视频解码器</span></li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_VideoDecoder_Prepare</span>(decoder_);</li><li><span class="hljs-comment">// 创建解码上下文</span></li><li>videoDecContext_ = <span class="hljs-keyword">new</span> CodecUserData;</li></ol></pre></div></div> </div> </li><li>（可选）初始化环境。<div class="p">一般在进程内第一次使用时调用，可提前完成部分耗时操作。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_InitializeEnvironment</span>();</li></ol></pre></div></div> </div> </li><li>创建细节增强模块。<p>应用可以通过视频处理引擎模块类型来创建细节增强模块。示例中的变量说明如下：</p> <ul><li>videoProcessor：细节增强模块实例。</li><li>VIDEO_PROCESSING_TYPE_DETAIL_ENHANCER：细节增强类型。</li><li>预期返回值：VIDEO_PROCESSING_SUCCESS</li></ul> <div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过指定视频处理引擎类型创建细节增强模块实例</span></li><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_Create</span>(&amp;videoProcessor, VIDEO_PROCESSING_TYPE_DETAIL_ENHANCER);</li></ol></pre></div></div> </li><li>配置异步回调函数。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建回调实例</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessingCallback_Create</span>(&amp;callback);</li><li><span class="hljs-comment">// 绑定回调函数</span></li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnError</span>(callback, OnError);</li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnState</span>(callback, OnState);</li><li><span class="hljs-built_in">OH_VideoProcessingCallback_BindOnNewOutputBuffer</span>(callback, OnNewOutputBuffer);</li><li><span class="hljs-comment">// 注册回调函数</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_RegisterCallback</span>(videoProcessor, callback, <span class="hljs-keyword">this</span>);</li><li><span class="hljs-comment">// 回调函数声明（其中userData会传递注册回调时传入的用户数据，如：this指针）</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnError</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, VideoProcessing_ErrorCode error, <span class="hljs-type">void</span>* userData)</span></span>;</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnState</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, VideoProcessing_State state, <span class="hljs-type">void</span>* userData)</span></span>;</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnNewOutputBuffer</span><span class="hljs-params">(OH_VideoProcessing* videoProcessor, <span class="hljs-type">uint32_t</span> index, <span class="hljs-type">void</span>* userData)</span></span>;</li></ol></pre></div></div> </li><li>（可选）配置细节增强档位，当前有高中低三档及NONE可选，若不配置则默认档位为LOW档。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建format实例</span></li><li>OH_AVFormat* parameter = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 指定档位</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(parameter, VIDEO_DETAIL_ENHANCER_PARAMETER_KEY_QUALITY_LEVEL, VIDEO_DETAIL_ENHANCER_QUALITY_LEVEL_HIGH);</li><li><span class="hljs-comment">// 配置参数</span></li><li><span class="hljs-built_in">OH_VideoProcessing_SetParameter</span>(videoProcessor, parameter);</li></ol></pre></div></div> </li><li>获取Surface。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//配置算法的输入</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_GetSurface</span>(videoProcessor, inputWindow);</li><li><span class="hljs-comment">// 将解码器的输出与算法的输入进行绑定，解码器输出的window分辨率即为算法输入分辨率</span></li><li><span class="hljs-built_in">OH_VideoDecoder_SetSurface</span>(decoder_,  inputWindow_);</li></ol></pre></div></div> </li><li>设置Surface（配置送显）。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 配置算法的输出，配置的输出window的分辨率即为算法输出分辨率</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_SetSurface</span>(videoProcessor, outWindow);</li></ol></pre></div></div> </li><li>创建解码器输入输出线程。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>std::unique_ptr&lt;std::thread&gt; videoDecInputThread_ = std::<span class="hljs-built_in">make_unique</span>&lt;std::thread&gt;(&amp;Player::VideoDecInputThread, <span class="hljs-keyword">this</span>);</li><li>std::unique_ptr&lt;std::thread&gt; videoDecOutputThread_ = std::<span class="hljs-built_in">make_unique</span>&lt;std::thread&gt;(&amp;Player::VideoDecOutputThread, <span class="hljs-keyword">this</span>);</li></ol></pre></div></div> </li><li>启动细节增强处理。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 启动解码</span></li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_VideoDecoder_Start</span>(decoder_);</li><li><span class="hljs-comment">// 启动细节增强处理</span></li><li>ret = <span class="hljs-built_in">OH_VideoProcessing_Start</span>(videoProcessor);</li></ol></pre></div></div> </li><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-video-processing-h#oh_videoprocessing_stop" target="_blank">OH_VideoProcessing_Stop()</a>停止细节增强。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_Stop</span>(videoProcessor);</li></ol></pre></div></div> </li><li>释放处理实例。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_Destroy</span>(videoProcessor)；</li><li>videoProcessor = <span class="hljs-literal">nullptr</span>;</li><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessingCallback_Destroy</span>(callback);</li><li>callback = <span class="hljs-literal">nullptr</span>;</li></ol></pre></div></div> </li><li>释放处理资源。<div _ngcontent-kui-c106="" class="highlight-div"><div _ngcontent-kui-c106="" class="highlight-div-header"><div _ngcontent-kui-c106="" class="highlight-div-header-left"><div _ngcontent-kui-c106="" class="handle-button expand-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kui-c106="" class="highlight-div-header-right"><div _ngcontent-kui-c106="" class="handle-button ai-button"></div><div _ngcontent-kui-c106="" class="handle-button line-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kui-c106="" class="handle-button theme-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kui-c106="" class="handle-button copy-button"><div _ngcontent-kui-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kui-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>VideoProcessing_ErrorCode ret = <span class="hljs-built_in">OH_VideoProcessing_DeinitializeEnvironment</span>();</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>