<h1 _ngcontent-pxb-c119="" class="doc-title ng-star-inserted" title="解决Web组件本地资源跨域问题"> 解决Web组件本地资源跨域问题 </h1>

<div _ngcontent-pxb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="拦截本地资源跨域">拦截本地资源跨域<i class="anchor-icon anchor-icon-link" anchorid="拦截本地资源跨域" tips="复制节点链接"></i></h2>          <p>为了提高安全性，ArkWeb内核禁止file协议和resource协议访问跨域请求。因此，在使用Web组件加载本地离线资源的时候，Web组件会拦截file协议和resource协议的跨域访问。通过方法二设置一个路径列表，再使用file协议访问该路径列表中的资源，允许跨域访问本地文件。Web组件无法访问本地跨域资源时，DevTools控制台会显示报错信息：</p>     <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Access</span> <span class="hljs-variable">to</span> <span class="hljs-variable">script</span> <span class="hljs-variable">at</span> <span class="hljs-string">'xxx'</span> <span class="hljs-keyword">from</span> <span class="hljs-variable">origin</span> <span class="hljs-string">'xxx'</span> <span class="hljs-variable">has</span> <span class="hljs-variable">been</span> <span class="hljs-variable">blocked</span> <span class="hljs-variable">by</span> <span class="hljs-variable">CORS</span> <span class="hljs-variable">policy</span>: <span class="hljs-title class_">Cross</span> <span class="hljs-title class_">origin</span> <span class="hljs-title class_">requests</span> <span class="hljs-title class_">are</span> <span class="hljs-title class_">only</span> <span class="hljs-title class_">supported</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">protocol</span> <span class="hljs-title class_">schemes</span>: <span class="hljs-title class_">http</span>, <span class="hljs-variable">arkweb</span>, <span class="hljs-variable">data</span>, <span class="hljs-variable">chrome</span>-<span class="hljs-variable">extension</span>, <span class="hljs-variable">chrome</span>, <span class="hljs-variable">https</span>, <span class="hljs-variable">chrome</span>-<span class="hljs-variable">untrusted</span>.</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="本地资源跨域问题解决方法">本地资源跨域问题解决方法<i class="anchor-icon anchor-icon-link" anchorid="本地资源跨域问题解决方法" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>方法一</p>       <p>开发者应使用http或https协议替代file或resource协议，使Web组件成功访问跨域资源。替代的URL域名为自定义构造，仅供个人或组织使用，避免与互联网上的实际域名冲突。同时，开发者需利用Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oninterceptrequest9" target="_blank">onInterceptRequest</a>方法，对本地资源进行拦截和相应的替换。</p>       <p>以下结合示例说明如何使用http或者https等协议解决本地资源跨域访问失败的问题。其中，index.html和js/script.js置于工程中的rawfile目录下。当使用resource协议访问index.html时，js/script.js将因跨域而被拦截，无法加载。在示例中，使用https://www.example.com/域名替换了原本的resource协议，同时利用onInterceptRequest接口替换资源，使得js/script.js可以成功加载，从而解决了跨域拦截的问题。</p>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-comment">// 构造域名和本地文件的映射表</span></li><li>  schemeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([</li><li>    [<span class="hljs-string">"https://www.example.com/index.html"</span>, <span class="hljs-string">"index.html"</span>],</li><li>    [<span class="hljs-string">"https://www.example.com/js/script.js"</span>, <span class="hljs-string">"js/script.js"</span>],</li><li>  ])</li><li>  <span class="hljs-comment">// 构造本地文件和构造返回的格式mimeType</span></li><li>  mimeTypeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([</li><li>    [<span class="hljs-string">"index.html"</span>, <span class="hljs-string">'text/html'</span>],</li><li>    [<span class="hljs-string">"js/script.js"</span>, <span class="hljs-string">"text/javascript"</span>]</li><li>  ])</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 针对本地index.html,使用http或者https协议代替file协议或者resource协议，并且构造一个属于自己的域名。</span></li><li>        <span class="hljs-comment">// 本例中构造www.example.com为例。</span></li><li>        <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">"https://www.example.com/index.html"</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span> })</li><li>          .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">geolocationAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>          .<span class="hljs-title function_">onInterceptRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (!event) {</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 此处匹配自己想要加载的本地离线资源，进行资源拦截替换，绕过跨域</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">schemeMap</span>.<span class="hljs-title function_">has</span>(event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>())) {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">rawfileName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">schemeMap</span>.<span class="hljs-title function_">get</span>(event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>())!;</li><li>              <span class="hljs-keyword">let</span> mimeType = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mimeTypeMap</span>.<span class="hljs-title function_">get</span>(rawfileName);</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> mimeType === <span class="hljs-string">'string'</span>) {</li><li>                <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebResourceResponse</span>();</li><li>                <span class="hljs-comment">// 构造响应数据，如果本地文件在rawfile下，可以通过如下方式设置</span></li><li>                response.<span class="hljs-title function_">setResponseData</span>($rawfile(rawfileName));</li><li>                response.<span class="hljs-title function_">setResponseEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>                response.<span class="hljs-title function_">setResponseMimeType</span>(mimeType);</li><li>                response.<span class="hljs-title function_">setResponseCode</span>(<span class="hljs-number">200</span>);</li><li>                response.<span class="hljs-title function_">setReasonMessage</span>(<span class="hljs-string">'OK'</span>);</li><li>                response.<span class="hljs-title function_">setResponseIsReady</span>(<span class="hljs-literal">true</span>);</li><li>                <span class="hljs-keyword">return</span> response;</li><li>              }</li><li>            }</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- main/resources/rawfile/index.html --&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">crossorigin</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./js/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/resources/rawfile/js/script.js</span></li><li><span class="hljs-keyword">const</span> body = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</li><li><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);</li><li>element.<span class="hljs-property">textContent</span> = <span class="hljs-string">'success'</span>;</li><li>body.<span class="hljs-title function_">appendChild</span>(element);</li></ol></pre></div></div></li>      <li>       <p>方法二</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setpathallowinguniversalaccess12" target="_blank">setPathAllowingUniversalAccess</a>设置一个路径列表。当使用file协议访问该列表中的资源时，允许进行跨域访问本地文件。此外，一旦设置了路径列表，file协议将仅限于访问列表内的资源(此时，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>的行为将会被此接口行为覆盖)。路径列表中的路径应符合以下任一路径格式：</p>       <p>1.应用文件目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.filesDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/files/example</li>        <li>/data/storage/el2/base/haps/entry/files/example</li>       </ul>       <p>2.应用资源目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.resourceDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el1/bundle/entry/resource/resfile</li>        <li>/data/storage/el1/bundle/entry/resource/resfile/example</li>       </ul>       <p>3.从API version 21开始，还包括了应用缓存目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.cacheDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/cache</li>        <li>/data/storage/el2/base/haps/entry/cache/example</li>        <li>设置的目录路径中，不允许包含cache/web，否则会抛出异常码401。如果设置目录路径是cache，cache/web也不允许访问。</li>       </ul>       <p>4.从API version 21开始，还包括了应用临时目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.tempDir</a>获取，其子目录示例如下：</p>       <ul>        <li>/data/storage/el2/base/temp</li>        <li>/data/storage/el2/base/haps/entry/temp/example</li>       </ul>       <p>当路径列表中的任一路径不满足上述条件时，系统将抛出异常码401，并判定路径列表设置失败。如果路径列表设置为空，file协议的可访问范围将遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>规则，具体示例如下。</p>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/ets/pages/index.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// 设置允许可以跨域访问的路径列表</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPathAllowingUniversalAccess</span>([</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span>,</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/example"</span></li><li>            ])</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">"file://"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span> + <span class="hljs-string">"/index.html"</span>)</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- main/resources/resfile/index.html --&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1, user-scalable=no,   viewport-fit=cover"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFile</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-javascript">            <span class="hljs-keyword">var</span> file = <span class="hljs-string">"file:///data/storage/el1/bundle/entry/resources/resfile/js/script.js"</span>;</span></li><li><span class="language-javascript">      <span class="hljs-comment">// 使用file协议通过XMLHttpRequest跨域访问本地js文件。</span></span></li><li><span class="language-javascript">            <span class="hljs-keyword">var</span> xmlHttpReq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){</span></li><li><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"readyState:"</span> + xmlHttpReq.<span class="hljs-property">readyState</span>);</span></li><li><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"status:"</span> + xmlHttpReq.<span class="hljs-property">status</span>);</span></li><li><span class="language-javascript">                <span class="hljs-keyword">if</span>(xmlHttpReq.<span class="hljs-property">readyState</span> == <span class="hljs-number">4</span>){</span></li><li><span class="language-javascript">                    <span class="hljs-keyword">if</span> (xmlHttpReq.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>) {</span></li><li><span class="language-javascript">                <span class="hljs-comment">// 如果ets侧正确设置路径列表，则此处能正常获取资源</span></span></li><li><span class="language-javascript">                        <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>);</span></li><li><span class="language-javascript">                        element.<span class="hljs-property">textContent</span> = <span class="hljs-string">"load "</span> + file + <span class="hljs-string">" success"</span>;</span></li><li><span class="language-javascript">                    } <span class="hljs-keyword">else</span> {</span></li><li><span class="language-javascript">                <span class="hljs-comment">// 如果ets侧不设置路径列表，则此处会触发CORS跨域检查错误</span></span></li><li><span class="language-javascript">                        <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>);</span></li><li><span class="language-javascript">                        element.<span class="hljs-property">textContent</span> = <span class="hljs-string">"load "</span> + file + <span class="hljs-string">" failed"</span>;</span></li><li><span class="language-javascript">                    }</span></li><li><span class="language-javascript">                }</span></li><li><span class="language-javascript">            }</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-title function_">open</span>(<span class="hljs-string">"GET"</span>, file);</span></li><li><span class="language-javascript">            xmlHttpReq.<span class="hljs-title function_">send</span>(<span class="hljs-literal">null</span>);</span></li><li><span class="language-javascript">        }</span></li><li><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"example"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"getFile()"</span>&gt;</span>loadFile<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>       <div _ngcontent-pxb-c106="" class="highlight-div"><div _ngcontent-pxb-c106="" class="highlight-div-header"><div _ngcontent-pxb-c106="" class="highlight-div-header-left"><div _ngcontent-pxb-c106="" class="handle-button expand-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxb-c106="" class="highlight-div-header-right"><div _ngcontent-pxb-c106="" class="handle-button ai-button"></div><div _ngcontent-pxb-c106="" class="handle-button line-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxb-c106="" class="handle-button theme-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxb-c106="" class="handle-button copy-button"><div _ngcontent-pxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxb-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main/resources/resfile/js/script.js</span></li><li><span class="hljs-keyword">const</span> body = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</li><li><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);</li><li>element.<span class="hljs-property">textContent</span> = <span class="hljs-string">'success'</span>;</li><li>body.<span class="hljs-title function_">appendChild</span>(element);</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>