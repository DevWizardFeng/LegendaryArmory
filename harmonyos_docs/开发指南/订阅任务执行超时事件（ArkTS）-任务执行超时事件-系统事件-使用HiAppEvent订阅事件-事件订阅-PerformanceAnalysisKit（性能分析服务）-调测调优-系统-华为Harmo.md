<h1 _ngcontent-ygd-c119="" class="doc-title ng-star-inserted" title="订阅任务执行超时事件（ArkTS）"> 订阅任务执行超时事件（ArkTS） </h1>

<div _ngcontent-ygd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2>          <p>从API version 21开始，支持arkTS接口订阅任务执行超时事件。 本文介绍如何使用HiAppEvent提供的ArkTS接口订阅任务执行超时事件。接口的详细使用说明（参数限制、取值范围等）请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-hiappevent" target="_blank">@ohos.hiviewdfx.hiAppEvent (应用事件打点)ArkTS API文档</a>。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">addWatcher(watcher: Watcher): AppEventPackageHolder</td>         <td class="cellrowborder" valign="top" width="50%">添加应用事件观察者，以添加对应用事件的订阅。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">removeWatcher(watcher: Watcher): void</td>         <td class="cellrowborder" valign="top" width="50%">移除应用事件观察者，以取消对应用事件的订阅。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="添加事件观察者" class="firsth2">添加事件观察者<i class="anchor-icon anchor-icon-link" anchorid="添加事件观察者" tips="复制节点链接"></i></h3>          <p>为确保开发阶段顺利接收事件回调，建议采取以下方案：创建新的Native C++工程，在ArkTs代码中实现订阅，并通过C++代码构造故障注入以触发任务执行超时事件。</p>     <ol>      <li>       <p>新建Native C++工程，目录结构如下：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="yml prettyprint linenums hljs language-yaml" hw-language="yml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">entry:</span></li><li>  <span class="hljs-attr">src:</span></li><li>    <span class="hljs-attr">main:</span></li><li>      <span class="hljs-attr">cpp:</span></li><li>        <span class="hljs-attr">types:</span></li><li>          <span class="hljs-attr">libentry:</span></li><li>            <span class="hljs-bullet">-</span> <span class="hljs-string">index.d.ts</span></li><li>        <span class="hljs-bullet">-</span> <span class="hljs-string">CMakeLists.txt</span></li><li>        <span class="hljs-bullet">-</span> <span class="hljs-string">napi_init.cpp</span></li><li>      <span class="hljs-attr">ets:</span></li><li>        <span class="hljs-attr">entryability:</span></li><li>          <span class="hljs-bullet">-</span> <span class="hljs-string">EntryAbility.ets</span></li><li>        <span class="hljs-attr">pages:</span></li><li>          <span class="hljs-bullet">-</span> <span class="hljs-string">Index.ets</span></li></ol></pre></div></div></li>      <li>       <p>编辑“CMakeLists.txt”文件，添加源文件及动态库。</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li># 新增动态库依赖libhilog_ndk<span class="hljs-selector-class">.z</span><span class="hljs-selector-class">.so</span>（日志输出）及libohhicollie<span class="hljs-selector-class">.so</span>（hicollie检测）</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so libohhicollie.so)</li></ol></pre></div></div></li>      <li>       <p>编辑“EntryAbility.ets”文件，导入依赖模块，示例代码如下：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiAppEvent, hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>订阅系统事件，编辑“EntryAbility.ets”文件，在onCreate函数中添加订阅代码，示例代码如下：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">watcher</span>: hiAppEvent.<span class="hljs-property">Watcher</span> = {</li><li>  <span class="hljs-comment">// 开发者可以自定义观察者名称，系统会使用名称来标识不同的观察者</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-string">"watcher"</span>,</li><li>  <span class="hljs-comment">// 开发者可以订阅感兴趣的系统事件，此处是订阅了任务执行超时事件</span></li><li>  <span class="hljs-attr">appEventFilters</span>: [</li><li>    {</li><li>      <span class="hljs-attr">domain</span>: hiAppEvent.<span class="hljs-property">domain</span>.<span class="hljs-property">OS</span>,</li><li>      <span class="hljs-attr">names</span>: [hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">APP_HICOLLIE</span>]</li><li>    }</li><li>  ],</li><li>  <span class="hljs-comment">// 开发者可以自行实现订阅实时回调函数，以便对订阅获取到的事件数据进行自定义处理</span></li><li>  <span class="hljs-attr">onReceive</span>: <span class="hljs-function">(<span class="hljs-params">domain: <span class="hljs-built_in">string</span>, appEventGroups: <span class="hljs-built_in">Array</span>&lt;hiAppEvent.AppEventGroup&gt;</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent onReceive: domain=<span class="hljs-subst">${domain}</span>`</span>);</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventGroup <span class="hljs-keyword">of</span> appEventGroups) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventName=<span class="hljs-subst">${eventGroup.name}</span>`</span>);</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventInfo <span class="hljs-keyword">of</span> eventGroup.<span class="hljs-property">appEventInfos</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.domain=<span class="hljs-subst">${eventInfo.domain}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.name=<span class="hljs-subst">${eventInfo.name}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.eventType=<span class="hljs-subst">${eventInfo.eventType}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.time=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'time'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.foreground=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'foreground'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.bundle_version=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'bundle_version'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.process_name=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'process_name'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.pid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'pid'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.uid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'uid'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.uid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'uuid'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.exception=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'exception'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.hilog.size=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'hilog'</span>].length}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.peer_binder.size=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo.params[<span class="hljs-string">'peer_binder'</span>].length)}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.memory=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'memory'</span>]}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.external_log=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo.params[<span class="hljs-string">'external_log'</span>])}</span>`</span>);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.log_over_limit=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'log_over_limit'</span>]}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li> };</li><li>hiAppEvent.<span class="hljs-title function_">addWatcher</span>(watcher);</li></ol></pre></div></div></li>      <li>       <p>新增TestHiCollieTimerNdk函数。</p>       <p>编辑“napi_init.cpp”文件，新增TestHiCollieTimerNdk函数，构造任务执行超时事件：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 引入hicollie.h头文件</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hicollie/hicollie.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"testTag"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">TestHiCollieTimerNdk</span><span class="hljs-params">(napi_env env, napi_callback_info exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 定义执行任务超时id值</span></li><li>    <span class="hljs-type">int</span> id;</li><li>    <span class="hljs-comment">// 定义任务超时检测参数：超时时间阈值1s，动作级别为生成日志</span></li><li>    HiCollie_SetTimerParam param = {<span class="hljs-string">"testTimer"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, HiCollie_Flag::HICOLLIE_FLAG_LOG};</li><li>    <span class="hljs-comment">// 设置检测</span></li><li>    HiCollie_ErrorCode errorCode = <span class="hljs-built_in">OH_HiCollie_SetTimer</span>(param, &amp;id);</li><li>    <span class="hljs-keyword">if</span> (errorCode == HICOLLIE_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"Timer Id is %{public}d"</span>, id);</li><li>        <span class="hljs-comment">// 构造超时2s</span></li><li>        <span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);</li><li>        <span class="hljs-built_in">OH_HiCollie_CancelTimer</span>(id);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>将TestHiCollieTimerNdk注册为ArkTS接口。</p>       <p>编辑“napi_init.cpp”文件，TestHiCollieTimerNdk注册为ArkTS接口：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"TestHiCollieTimerNdk"</span>, <span class="hljs-literal">nullptr</span>, TestHiCollieTimerNdk, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> }</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>),</li><li>    .reserved = { <span class="hljs-number">0</span> },</li><li>};</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_module_register</span>(&amp;demoModule);</li><li>}</li></ol></pre></div></div>       <p>编辑“index.d.ts”文件，定义ArkTS接口：</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TestHiCollieTimerNdk</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div></li>      <li>       <p>编辑“Index.ets”文件，新增按钮触发任务执行超时事件。</p>       <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-meta">@Entry</span></li><li>  <span class="hljs-meta">@Component</span></li><li>  struct <span class="hljs-title class_">Index</span> {</li><li>    <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>   </li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">"TestHiCollieTimerNdk"</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(testNapi.<span class="hljs-property">TestHiCollieTimerNdk</span>);  <span class="hljs-comment">//添加点击事件，触发TestHiCollieTimerNdk方法。</span></li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>单击DevEco Studio界面中的运行按钮，运行应用工程，然后在应用界面中单击按钮“TestHiCollieTimerNdk”，触发任务执行超时事件。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="验证观察者是否订阅到任务执行超时事件">验证观察者是否订阅到任务执行超时事件<i class="anchor-icon anchor-icon-link" anchorid="验证观察者是否订阅到任务执行超时事件" tips="复制节点链接"></i></h3>          <p>应用工程崩溃退出后，再次运行可在Log窗口查看系统事件数据处理日志。</p>     <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>HiAppEvent eventInfo.domain=OS</li><li>HiAppEvent eventInfo.name=APP_HICOLLIE</li><li>HiAppEvent eventInfo.eventType=1</li><li>HiAppEvent eventInfo.params.time=1754914806680</li><li>HiAppEvent eventInfo.params.foreground=true</li><li>HiAppEvent eventInfo.params.bundle_version=1.0.0</li><li>HiAppEvent eventInfo.params.process_name=com.example.myapplication</li><li>HiAppEvent eventInfo.params.pid=20317</li><li>HiAppEvent eventInfo.params.uid=20020198</li><li>HiAppEvent eventInfo.params.uuid=4asd360e18f5d6d84cf4f0c9e80d66we5786c1cc2343d9632e07abb0d3552asd</li><li>HiAppEvent eventInfo.params.exception={"message":"","name":"APP_HICOLLIE"}</li><li>HiAppEvent eventInfo.params.hilog.size=28</li><li>HiAppEvent eventInfo.params.peer_binder.size=0</li><li>HiAppEvent eventInfo.params.memory={"pss":0,"rss":150748,"sys_avail_mem":5387264,"sys_free_mem":218902,"sys_total_mem":11679236,"vss":38306936}</li><li>HiAppEvent eventInfo.params.external_log=["/data/storage/el2/log/hiappevent/APP_HICOLLIE_1754914811140_20317.log"]</li><li>HiAppEvent eventInfo.params.log_over_limit=false</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="移除事件观察者">移除事件观察者<i class="anchor-icon anchor-icon-link" anchorid="移除事件观察者" tips="复制节点链接"></i></h3>          <div _ngcontent-ygd-c106="" class="highlight-div"><div _ngcontent-ygd-c106="" class="highlight-div-header"><div _ngcontent-ygd-c106="" class="highlight-div-header-left"><div _ngcontent-ygd-c106="" class="handle-button expand-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygd-c106="" class="highlight-div-header-right"><div _ngcontent-ygd-c106="" class="handle-button ai-button"></div><div _ngcontent-ygd-c106="" class="handle-button line-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygd-c106="" class="handle-button theme-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygd-c106="" class="handle-button copy-button"><div _ngcontent-ygd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 移除该应用事件观察者以取消订阅事件</span></li><li>hiAppEvent.<span class="hljs-title function_">removeWatcher</span>(watcher);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>