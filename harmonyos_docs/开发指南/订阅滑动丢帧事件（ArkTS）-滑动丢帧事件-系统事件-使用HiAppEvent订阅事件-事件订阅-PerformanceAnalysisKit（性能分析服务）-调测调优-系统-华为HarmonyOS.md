<h1 _ngcontent-rfd-c119="" class="doc-title ng-star-inserted" title="订阅滑动丢帧事件（ArkTS）"> 订阅滑动丢帧事件（ArkTS） </h1>

<div _ngcontent-rfd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section5732184611513">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5732184611513" tips="复制节点链接"></i></h2></div> <p>API接口的具体使用说明（参数使用限制、具体取值范围等）请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-hiappevent" target="_blank">@ohos.hiviewdfx.hiAppEvent (应用事件打点)ArkTS API文档</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>addWatcher(watcher: Watcher): AppEventPackageHolder</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>添加应用事件观察者，以添加对应用事件的订阅。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>removeWatcher(watcher: Watcher): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>移除应用事件观察者，以移除对应用事件的订阅。</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section97331461659">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section97331461659" tips="复制节点链接"></i></h2></div> <p>以实现对用户滑动列表触发丢帧生成的滑动丢帧事件订阅为例，说明开发步骤。</p> <ol><li><p>编辑工程中的“entry &gt; src &gt; main &gt; ets  &gt; entryability &gt; EntryAbility.ets”文件，在onCreate函数中添加系统事件的订阅，示例代码如下：</p> <div _ngcontent-rfd-c106="" class="highlight-div"><div _ngcontent-rfd-c106="" class="highlight-div-header"><div _ngcontent-rfd-c106="" class="highlight-div-header-left"><div _ngcontent-rfd-c106="" class="handle-button expand-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rfd-c106="" class="highlight-div-header-right"><div _ngcontent-rfd-c106="" class="handle-button ai-button"></div><div _ngcontent-rfd-c106="" class="handle-button line-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rfd-c106="" class="handle-button theme-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rfd-c106="" class="handle-button copy-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rfd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiAppEvent, hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li>hiAppEvent.<span class="hljs-title function_">addWatcher</span>({</li><li>   <span class="hljs-comment">// 开发者可以自定义观察者名称，系统会使用名称来标识不同的观察者</span></li><li>   <span class="hljs-attr">name</span>: <span class="hljs-string">"watcher"</span>,</li><li>   <span class="hljs-comment">// 开发者可以订阅感兴趣的系统事件，此处是订阅了滑动丢帧事件</span></li><li>   <span class="hljs-attr">appEventFilters</span>: [</li><li>     {</li><li>       <span class="hljs-attr">domain</span>: hiAppEvent.<span class="hljs-property">domain</span>.<span class="hljs-property">OS</span>,</li><li>       <span class="hljs-attr">names</span>: [hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">SCROLL_JANK</span>]</li><li>     }</li><li>   ],</li><li>   <span class="hljs-comment">// 开发者可以自行实现订阅回调函数，以便对订阅获取到的事件数据进行自定义处理</span></li><li>   <span class="hljs-attr">onReceive</span>: <span class="hljs-function">(<span class="hljs-params">domain: <span class="hljs-built_in">string</span>, appEventGroups: <span class="hljs-built_in">Array</span>&lt;hiAppEvent.AppEventGroup&gt;</span>) =&gt;</span> {</li><li>     hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent onReceive: domain=<span class="hljs-subst">${domain}</span>`</span>);</li><li>     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventGroup <span class="hljs-keyword">of</span> appEventGroups) {</li><li>       <span class="hljs-comment">// 开发者可以根据事件集合中的事件名称区分不同的系统事件</span></li><li>       hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventName=<span class="hljs-subst">${eventGroup.name}</span>`</span>);</li><li>       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventInfo <span class="hljs-keyword">of</span> eventGroup.<span class="hljs-property">appEventInfos</span>) {</li><li>         <span class="hljs-comment">// 开发者可以对事件集合中的事件数据进行自定义处理，此处是将事件数据打印在日志中</span></li><li>         hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo)}</span>`</span>);</li><li>       }</li><li>     }</li><li>   }</li><li> });</li></ol></pre></div></div> </li><li><p>编辑工程中的“entry &gt; src &gt; main &gt; ets  &gt; pages &gt; Index.ets”文件，添加一个列表控件，在列表的滑动事件中添加耗时操作，示例代码如下：</p> <div _ngcontent-rfd-c106="" class="highlight-div"><div _ngcontent-rfd-c106="" class="highlight-div-header"><div _ngcontent-rfd-c106="" class="highlight-div-header-left"><div _ngcontent-rfd-c106="" class="handle-button expand-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rfd-c106="" class="highlight-div-header-right"><div _ngcontent-rfd-c106="" class="handle-button ai-button"></div><div _ngcontent-rfd-c106="" class="handle-button line-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rfd-c106="" class="handle-button theme-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rfd-c106="" class="handle-button copy-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rfd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 模拟列表元素</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>,<span class="hljs-number">23</span>]</li><li>
</li><li><span class="hljs-comment">// 创建List控件</span></li><li><span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>  <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x007DFF</span>)</li><li>    }</li><li>  })</li><li>}</li><li>.<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">firstIndex: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">while</span> (i&lt;<span class="hljs-number">10000</span>) { <span class="hljs-comment">// 在列表滑动事件中做一些耗时操作</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"do something"</span>);</li><li>    i++;</li><li>  }</li><li>})</li></ol></pre></div></div> </li><li><p>点击DevEco Studio界面中的运行按钮，运行应用工程，在页面中滑动列表，当系统检测到故障时触发滑动丢帧事件。</p> </li><li><p>每次滑动操作发生超过50ms卡顿场景，间隔5~35秒，可以在Log窗口看到对系统事件数据的处理日志：</p> <div _ngcontent-rfd-c106="" class="highlight-div"><div _ngcontent-rfd-c106="" class="highlight-div-header"><div _ngcontent-rfd-c106="" class="highlight-div-header-left"><div _ngcontent-rfd-c106="" class="handle-button expand-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rfd-c106="" class="highlight-div-header-right"><div _ngcontent-rfd-c106="" class="handle-button ai-button"></div><div _ngcontent-rfd-c106="" class="handle-button line-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rfd-c106="" class="handle-button theme-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rfd-c106="" class="handle-button copy-button"><div _ngcontent-rfd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rfd-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>HiAppEvent onReceive: domain=OS</li><li>HiAppEvent eventName=SCROLL_JANK</li><li>HiAppEvent eventInfo={"domain":"OS","name":"SCROLL_JANK","eventType":1,"params":{"ability_name":"EntryAbility","begin_time":1710322495739,"bundle_name":"com.example.myapplication1","bundle_version":"1.0.0","duration":801,"external_log":["/data/storage/el2/log/watchdog/SCROLL_JANK_20250402192812_6033.txt"],"log_over_limit":false,"max_app_frametime":3,"max_app_seq_frames":0,"max_render_frametime":8,"max_render_seq_frames":0,"process_name":"com.example.myapplication1","time":1710322497495,"total_app_frames":98,"total_app_missed_frames":0,"total_render_frames":80,"total_render_missed_frames":0}}</li></ol></pre></div></div> </li></ol> </div> <div></div></div>