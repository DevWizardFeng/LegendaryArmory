<h1 _ngcontent-orb-c119="" class="doc-title ng-star-inserted" title="订阅通知类事件"> 订阅通知类事件 </h1>

<div _ngcontent-orb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section14564084215">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section14564084215" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p15680193415577">从API version 20 开始，新增提供统一的安全审计数据多客户端订阅/取消订阅与添加/删除过滤条件接口，应用可以获取设备上的安全审计数据（如下表），并按需进行过滤，以支撑审计相关业务。</p>     <div class="tablenoborder">      <div class="tbBox"><table id="zh-cn_topic_0000002471494192_table111148409115" class="layoutFixed idpTab">       <thead>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row1111494011120">         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.3.1.1" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p181148406119">审计事件ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.3.1.2" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p181142401117">说明</p></th>        </tr>       </thead>               <tbody><tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row9153144219176">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p7985735579">0x027000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p141531242141710">剪切板复制粘贴事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row195841952182">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p179851238575">0x010000100</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1058445191819">账号登录登出事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row03931317141814">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p2985635579">0x007000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1539391731819">窗口截屏录屏投屏事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row694074221818">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p598515313570">0x00F000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1494004219189">移动存储插拔事件，如U盘、存储卡等具有存储功能的外设插拔事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row11217161319195">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p7985183135716">0x02E000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p17217201371915">打印机事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row185261223191911">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p398573155714">0x01C000007</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p45261123131917">文件事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row957416434194">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p18985831576">0x01C000008</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p657474311197">进程创建退出事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row63602542197">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p798515365713">0x01C000009</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1036010546197">网络事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row4364173062516">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p14985739575">0x01C00000A</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p6138512264">KIA文件拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row111511110200">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p198519345718">0x02D000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8152151117200">相机事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row12948427132019">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p119861231575">0x010000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p394816277206">应用事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row166392513216">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p189867355719">0x011000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p563918562112">edm事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row1659611932114">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1498612317573">0x012003000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p159651915213">证书操作事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row18561172819259">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p198619310571">0x01C00000B</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1913810182617">KIA文件新增事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row1139613418254">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p39864319579">0x01C00000C</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p5138151162617">KIA文件变种事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row2146085352">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p18147208113517">0x01C000012</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8681172563518">KIA文件读事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row3676273918">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p15233611394">0x01C00000E</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p20231966393">网络流量事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row08970913275">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p269223042719">0x01C00000F</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p16692630162719">网络连接事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row366691262712">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8692113019273">0x00B000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p106921730122712">应用权限变更事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row1990518158279">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p17692730102714">0x003000001</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p369216300279">DNS审计事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row338231163011">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p638341119306">0x01C001100</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8383131115302">文件拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row118651720153110">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p88662205316">0x018000100</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p178666207316">app安装拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row3639195010369">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p19640185053619">0x018000101</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1464013501366">app卸载拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row11882420123715">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p288272015378">0x018000102</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p888242093716">app更新拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row6299124519376">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p10145651193713">0x018000103</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8145851153715">app恢复拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row891715143387">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p8549132113811">0x018000104</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p17549162163814">app启动拦截事件</p></td>        </tr>        <tr id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_row442213723817">         <td class="cellrowborder" valign="top" width="35.410000000000004%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p6422337203814">0x030000000</p></td>         <td class="cellrowborder" valign="top" width="64.59%">          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p144221837103810">USB访问拦截事件</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section47419315463">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section47419315463" tips="复制节点链接"></i></h2>          <ol id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_ol114711544105714">      <li id="zh-cn_topic_0000002471494192_li747118440573">当前能力仅支持2in1设备。</li>      <li id="zh-cn_topic_0000002471494192_li14418184615575">一个进程最大只允许创建2个客户端实例，当前设备最多只允许创建16个客户端实例。</li>      <li id="zh-cn_topic_0000002471494192_li991454317581">一个客户端实例最大只允许设置256个Filter，每个Filter限制10条过滤value。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1868103517464">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1868103517464" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p977073774614"><span><img originheight="692" originwidth="970" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115057.19799878604747521567149557992099:50001231000000:2800:539586015A421EA93C34674961B835079DD52D9F3D53E6839D20389E2FA4D4B3.png" width="920" height="656.3298969072165"></span></p>     <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1436613125418"><strong>流程说明：</strong></p>     <ol id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_ol11139456139">      <li id="zh-cn_topic_0000002471494192_li4913124645718">开发者创建审计通知类事件(以下统称为事件)订阅客户端实例，需要提供CallBack。</li>      <li id="zh-cn_topic_0000002471494192_li154315261899">开发者使用1中创建的实例订阅事件，需要提供想要订阅的事件id。</li>      <li id="zh-cn_topic_0000002471494192_li7552151615919">开发者使用1中创建的实例设置事件过滤条件，需要提供事件id和过滤条件信息。</li>      <li id="zh-cn_topic_0000002471494192_li17346154813508">当事件发生时，审计服务先根据事件过滤条件过滤事件，当事件满足过滤条件时，触发回调通知订阅当前事件的客户端。</li>      <li id="zh-cn_topic_0000002471494192_li574671985311">开发者根据审计数据处理业务。</li>      <li id="zh-cn_topic_0000002471494192_li75264426537">当开发者应用不需要过滤/使用该审计数据时，开发者可以使用1中创建的实例解除过滤条件，取消对应的订阅事件。</li>      <li id="zh-cn_topic_0000002471494192_li314019562319">当开发者应用不需要使用当前实例时，开发者可以删除实例。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p1821220111513">支持先设置过滤条件再订阅事件。</p>        </div></div></div>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p id="ZH-CN_TOPIC_0000002471494218__zh-cn_topic_0000002471494192_p48561454566">删除实例后，被删除的实例所有的订阅以及过滤条件将被全部解除。</p>        </div></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section12853714125811">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section12853714125811" tips="复制节点链接"></i></h2>          <p>接口如下表，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-capi-securityaudit#zh-cn_topic_0000002349017400_ga18d7c9fe5c578d6113c86dd0c09353b4" target="_blank">API参考</a>。</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.5.1.3.1.1" valign="top" width="80.97%">         <p>接口名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.5.1.3.1.2" valign="top" width="19.03%">         <p>描述</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_NewClient(SecurityAudit_Client** client, SecurityAudit_Handler handler)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>创建通知类事件管理对象Client，Client提供订阅、解订阅、增加事件过滤、移除事件过滤功能。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_DeleteClient(SecurityAudit_Client* client)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>删除审计通知类事件管理对象。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_Subscribe(const SecurityAudit_Client* client, const SecurityAudit_Notify_Event *events, uint64_t count)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>订阅审计通知类事件。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_Unsubscribe(const SecurityAudit_Client* client, const SecurityAudit_Notify_Event *events, uint64_t count)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>解订阅审计通知类事件。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_AddFilter(const SecurityAudit_Client* client, SecurityAudit_Notify_Event event, const SecurityAudit_Filter *filter)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>添加审计通知类事件过滤条件。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="80.97%">         <p>int32_t HMS_SecurityAudit_RemoveFilter(const SecurityAudit_Client* client, SecurityAudit_Notify_Event event, const SecurityAudit_Filter *filter)</p></td>        <td class="cellrowborder" valign="top" width="19.03%">         <p>移除审计通知类事件过滤条件。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section1192801915199">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1192801915199" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>在开发准备过程中，需要申请权限：ohos.permission.QUERY_AUDIT_EVENT。</li>        <li>只允许清单内的企业类应用申请该权限，申请方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/permissions-for-enterprise-apps" target="_blank">申请使用企业类应用可用权限</a>。</li>       </ul>      </div></div></div>     <ol>      <li><span>在CMakeLists.txt中导入安全审计共享库，并链接该库。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(dsm-lib libsecurityaudit_ndk.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so ${dsm-lib})</li></ol></pre></div></div>       <p></p></li>      <li><span>导入安全审计的头文件。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;DeviceSecurityKit/security_audit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span></li></ol></pre></div></div>       <p></p></li>      <li><span>全局范围定义通知类事件的回调函数。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Notify</span><span class="hljs-params">(<span class="hljs-type">const</span> SecurityAudit_Event *events, <span class="hljs-type">uint64_t</span> count)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">if</span> (events == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"events nullptr"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint64_t</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"event content = %s"</span>, events[i].content);</li><li>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"event id = %ld"</span>, events[i].eventId);</li><li>    }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>创建审计通知类事件客户端实例。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>SecurityAudit_Client *client = <span class="hljs-literal">NULL</span>;</li><li>SecurityAudit_Handler handler = Notify;</li><li><span class="hljs-built_in">HMS_SecurityAudit_NewClient</span>(&amp;client, handler);</li><li><span class="hljs-keyword">if</span> (client == <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"client is null"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>订阅审计通知类事件。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>SecurityAudit_Notify_Event <span class="hljs-keyword">event</span>[<span class="hljs-number">1</span>] = {};</li><li><span class="hljs-keyword">event</span>[<span class="hljs-number">0</span>] = SECURITY_AUDIT_NOTIFY_EVENT_KIA_READ;</li><li><span class="hljs-built_in">int</span> ret = HMS_SecurityAudit_Subscribe(client, <span class="hljs-keyword">event</span>, <span class="hljs-number">1</span>);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>    printf(<span class="hljs-string">"subscribe fail"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>设置审计通知类事件过滤条件。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" data-highlighted="yes"><ol class="linenums"><li>SecurityAudit_Filter <span class="hljs-built_in">filter</span> = {};</li><li><span class="hljs-built_in">filter</span>.<span class="hljs-built_in">type</span> = PROCESS_NAME_PREFIX;</li><li>const char* filterStr[<span class="hljs-number">1</span>] = {};</li><li>filterStr[<span class="hljs-number">0</span>] = <span class="hljs-string">"1"</span>;</li><li><span class="hljs-built_in">filter</span>.value = filterStr;</li><li><span class="hljs-built_in">filter</span>.valueCount = <span class="hljs-number">1</span>;</li><li>ret = HMS_SecurityAudit_AddFilter(client, SECURITY_AUDIT_NOTIFY_EVENT_KIA_READ, &amp;<span class="hljs-built_in">filter</span>);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {</li><li>    printf(<span class="hljs-string">"addfilter fail"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>解除审计通知类事件订阅。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>ret = HMS_SecurityAudit_Unsubscribe(client, event, 1);</li><li><span class="hljs-keyword">if</span> (ret != 0) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"unsubscribe fail"</span>);</li><li>    <span class="hljs-built_in">return</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>解除审计通知类事件过滤条件。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>ret = HMS_SecurityAudit_RemoveFilter(client, SECURITY_AUDIT_NOTIFY_EVENT_KIA_READ, &amp;filter);</li><li><span class="hljs-keyword">if</span> (ret != 0) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"removefilter fail"</span>);</li><li>    <span class="hljs-built_in">return</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>删除审计通知类事件客户端实例。</span>       <p></p>       <div _ngcontent-orb-c106="" class="highlight-div"><div _ngcontent-orb-c106="" class="highlight-div-header"><div _ngcontent-orb-c106="" class="highlight-div-header-left"><div _ngcontent-orb-c106="" class="handle-button expand-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-orb-c106="" class="highlight-div-header-right"><div _ngcontent-orb-c106="" class="handle-button ai-button"></div><div _ngcontent-orb-c106="" class="handle-button line-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-orb-c106="" class="handle-button theme-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-orb-c106="" class="handle-button copy-button"><div _ngcontent-orb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-orb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>ret = HMS_SecurityAudit_DeleteClient(client);</li><li><span class="hljs-keyword">if</span> (ret != 0) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"deleteclient fail"</span>);</li><li>    <span class="hljs-built_in">return</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>