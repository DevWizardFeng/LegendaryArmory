<h1 _ngcontent-icv-c119="" class="doc-title ng-star-inserted" title="设备输入(ArkTS)"> 设备输入(ArkTS) </h1>

<div _ngcontent-icv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在开发相机应用时，需要先<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation">申请相关权限</a>。</p>    <p>相机应用可通过调用和控制相机设备，完成预览、拍照和录像等基础操作。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入camera接口，接口中提供了相机相关的属性和方法，导入方法如下。</p>       <div _ngcontent-icv-c106="" class="highlight-div"><div _ngcontent-icv-c106="" class="highlight-div-header"><div _ngcontent-icv-c106="" class="highlight-div-header-left"><div _ngcontent-icv-c106="" class="handle-button expand-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icv-c106="" class="highlight-div-header-right"><div _ngcontent-icv-c106="" class="handle-button ai-button"></div><div _ngcontent-icv-c106="" class="handle-button line-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icv-c106="" class="handle-button theme-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icv-c106="" class="handle-button copy-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>在相机设备输入之前需要先完成相机管理，详细开发步骤请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-device-management">相机管理</a>。</p>        </div></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager" target="_blank">cameraManager</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createcamerainput" target="_blank">createCameraInput</a>方法创建相机输入流。</p>       <div _ngcontent-icv-c106="" class="highlight-div"><div _ngcontent-icv-c106="" class="highlight-div-header"><div _ngcontent-icv-c106="" class="highlight-div-header-left"><div _ngcontent-icv-c106="" class="handle-button expand-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icv-c106="" class="highlight-div-header-right"><div _ngcontent-icv-c106="" class="handle-button ai-button"></div><div _ngcontent-icv-c106="" class="handle-button line-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icv-c106="" class="handle-button theme-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icv-c106="" class="handle-button copy-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createInput</span>(<span class="hljs-params">cameraDevice: camera.CameraDevice, cameraManager: camera.CameraManager</span>): <span class="hljs-title class_">Promise</span>&lt;camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-comment">// 创建相机输入流。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraInput = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraDevice);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to createCameraInput errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (cameraInput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 监听cameraInput错误信息。</span></li><li>  cameraInput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, cameraDevice, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Camera input error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  });</li><li>  <span class="hljs-comment">// 打开相机。</span></li><li>  <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>();</li><li>  <span class="hljs-keyword">return</span> cameraInput;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getsupportedscenemodes11" target="_blank">getSupportedSceneModes</a>方法，获取当前相机设备支持的模式列表，列表中存储了相机设备支持的所有模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#scenemode11" target="_blank">SceneMode</a>。</p>       <div _ngcontent-icv-c106="" class="highlight-div"><div _ngcontent-icv-c106="" class="highlight-div-header"><div _ngcontent-icv-c106="" class="highlight-div-header-left"><div _ngcontent-icv-c106="" class="handle-button expand-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icv-c106="" class="highlight-div-header-right"><div _ngcontent-icv-c106="" class="handle-button ai-button"></div><div _ngcontent-icv-c106="" class="handle-button line-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icv-c106="" class="handle-button theme-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icv-c106="" class="handle-button copy-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSupportedSceneMode</span>(<span class="hljs-params">cameraDevice: camera.CameraDevice, cameraManager: camera.CameraManager</span>): <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">SceneMode</span>&gt; {</li><li>  <span class="hljs-comment">// 获取相机设备支持的模式列表。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">sceneModeArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">SceneMode</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedSceneModes</span>(cameraDevice);</li><li>  <span class="hljs-keyword">if</span> (sceneModeArray != <span class="hljs-literal">undefined</span> &amp;&amp; sceneModeArray.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; sceneModeArray.<span class="hljs-property">length</span>; index++) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Camera SceneMode : '</span> + sceneModeArray[index]);</li><li>  }</li><li>    <span class="hljs-keyword">return</span> sceneModeArray;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"cameraManager.getSupportedSceneModes error"</span>);</li><li>      <span class="hljs-keyword">return</span> [];</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getsupportedoutputcapability11" target="_blank">getSupportedOutputCapability</a>方法，获取当前相机设备支持的所有输出流，如预览流、拍照流、录像流等。输出流在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>中的各个profile字段中，根据相机设备指定模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#scenemode11" target="_blank">SceneMode</a>的不同，需要添加不同类型的输出流。</p>       <div _ngcontent-icv-c106="" class="highlight-div"><div _ngcontent-icv-c106="" class="highlight-div-header"><div _ngcontent-icv-c106="" class="highlight-div-header-left"><div _ngcontent-icv-c106="" class="handle-button expand-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-icv-c106="" class="highlight-div-header-right"><div _ngcontent-icv-c106="" class="handle-button ai-button"></div><div _ngcontent-icv-c106="" class="handle-button line-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-icv-c106="" class="handle-button theme-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-icv-c106="" class="handle-button copy-button"><div _ngcontent-icv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-icv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getSupportedOutputCapability</span>(<span class="hljs-params">cameraDevice: camera.CameraDevice, cameraManager: camera.CameraManager, sceneMode: camera.SceneMode</span>): <span class="hljs-title class_">Promise</span>&lt;camera.<span class="hljs-property">CameraOutputCapability</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>   <span class="hljs-comment">// 获取相机设备支持的输出流能力。</span></li><li>   <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraOutputCapability</span>: camera.<span class="hljs-property">CameraOutputCapability</span> = cameraManager.<span class="hljs-title function_">getSupportedOutputCapability</span>(cameraDevice, sceneMode);</li><li>   <span class="hljs-keyword">if</span> (!cameraOutputCapability) {</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"cameraManager.getSupportedOutputCapability error"</span>);</li><li>     <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>   }</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"outputCapability: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(cameraOutputCapability));</li><li>   <span class="hljs-comment">// 以NORMAL_PHOTO模式为例，需要添加预览流、拍照流。</span></li><li>   <span class="hljs-comment">// previewProfiles属性为获取当前设备支持的预览输出流。</span></li><li>   <span class="hljs-keyword">let</span> <span class="hljs-attr">previewProfilesArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = cameraOutputCapability.<span class="hljs-property">previewProfiles</span>;</li><li>   <span class="hljs-keyword">if</span> (!previewProfilesArray) {</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"createOutput previewProfilesArray == null || undefined"</span>);</li><li>   }</li><li>   <span class="hljs-comment">//photoProfiles属性为获取当前设备支持的拍照输出流。</span></li><li>   <span class="hljs-keyword">let</span> <span class="hljs-attr">photoProfilesArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = cameraOutputCapability.<span class="hljs-property">photoProfiles</span>;</li><li>   <span class="hljs-keyword">if</span> (!photoProfilesArray) {</li><li>     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"createOutput photoProfilesArray == null || undefined"</span>);</li><li>   }</li><li>   <span class="hljs-keyword">return</span> cameraOutputCapability;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>