<h1 _ngcontent-aso-c119="" class="doc-title ng-star-inserted" title="设置Web组件前进后退缓存"> 设置Web组件前进后退缓存 </h1>

<div _ngcontent-aso-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Web组件为开发者提供了启用和配置前进后退缓存（以下简称BFCache）的功能。启用此功能后，能够显著提升用户返回至先前浏览网页的速度，尤其对于网络条件不佳的用户，可提供更为流畅的浏览体验。</p>    <p>BFCache功能启用后，Web组件会在用户离开当前页面时在内存中保存该页面的快照。当用户在短期内通过Web组件的前进或后退功能重新访问同一页面时，能够迅速恢复页面状态，避免重复发起HTTP请求。</p>    <div class="tiledSection">     <h2 id="web组件开启bfcache">Web组件开启BFCache<i class="anchor-icon anchor-icon-link" anchorid="web组件开启bfcache" tips="复制节点链接"></i></h2>          <p>开发者需要在调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#initializewebengine" target="_blank">initializeWebEngine()</a>初始化ArkWeb内核之前调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#enablebackforwardcache12" target="_blank">enableBackForwardCache()</a>来开启BFCache。enableBackForwardCache可以接收一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/kts-apis-webview-backforwardcachesupportedfeatures" target="_blank">BackForwardCacheSupportedFeatures</a>参数，用于控制是否允许具备同层渲染特性和视频托管特性的页面进入BFCache。</p>     <div _ngcontent-aso-c106="" class="highlight-div"><div _ngcontent-aso-c106="" class="highlight-div-header"><div _ngcontent-aso-c106="" class="highlight-div-header-left"><div _ngcontent-aso-c106="" class="handle-button expand-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aso-c106="" class="highlight-div-header-right"><div _ngcontent-aso-c106="" class="handle-button ai-button"></div><div _ngcontent-aso-c106="" class="handle-button line-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aso-c106="" class="handle-button theme-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aso-c106="" class="handle-button copy-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aso-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>    <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>        <span class="hljs-keyword">let</span> features = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">BackForwardCacheSupportedFeatures</span>();</li><li>        features.<span class="hljs-property">nativeEmbed</span> = <span class="hljs-literal">true</span>;</li><li>        features.<span class="hljs-property">mediaTakeOver</span> = <span class="hljs-literal">true</span>;</li><li>        webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">enableBackForwardCache</span>(features);</li><li>        webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">initializeWebEngine</span>();</li><li>        <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">"abilityWant"</span>, want);</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置缓存的页面数量和页面留存的时间">设置缓存的页面数量和页面留存的时间<i class="anchor-icon anchor-icon-link" anchorid="设置缓存的页面数量和页面留存的时间" tips="复制节点链接"></i></h2>          <p>启用BFCache后仅能存储一个页面，Web组件默认进入BFCache的页面可保持存活状态600秒。开发者可通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setbackforwardcacheoptions12" target="_blank">setBackForwardCacheOptions()</a>设置每个Web实例的前进后退缓存策略。包括调整缓存中页面的最大数量，使BFCache能够容纳更多页面，从而在用户连续进行前进后退操作时，提供更快的加载速度。同时，开发者还能修改每个页面在缓存中的停留时间，延长页面在BFCache中的驻留期限，进而优化用户的浏览体验。</p>     <p>在下面的示例中，设置Web组件可以缓存的最大数量为10，每个页面在缓存中停留300s。</p>     <div _ngcontent-aso-c106="" class="highlight-div"><div _ngcontent-aso-c106="" class="highlight-div-header"><div _ngcontent-aso-c106="" class="highlight-div-header-left"><div _ngcontent-aso-c106="" class="handle-button expand-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aso-c106="" class="highlight-div-header-right"><div _ngcontent-aso-c106="" class="handle-button ai-button"></div><div _ngcontent-aso-c106="" class="handle-button line-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aso-c106="" class="handle-button theme-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aso-c106="" class="handle-button copy-button"><div _ngcontent-aso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aso-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Add options"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> options = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">BackForwardCacheOptions</span>();</li><li>          options.<span class="hljs-property">size</span> = <span class="hljs-number">10</span>;</li><li>          options.<span class="hljs-property">timeToLive</span> = <span class="hljs-number">300</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setBackForwardCacheOptions</span>(options);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Backward"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">backward</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Forward"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">event: ClickEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">forward</span>();</li><li>        })</li><li>      }</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">"https://www.example.com"</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>