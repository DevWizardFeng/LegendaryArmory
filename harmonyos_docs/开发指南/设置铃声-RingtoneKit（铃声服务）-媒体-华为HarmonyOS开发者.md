<h1 _ngcontent-vxb-c119="" class="doc-title ng-star-inserted" title="设置铃声"> 设置铃声 </h1>

<div _ngcontent-vxb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <ol>     <li><span>导入ringtone模块和相关公共模块。</span>      <p></p>      <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { ringtone } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RingtoneKit'</span></li><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">JSON</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">APP_TAG</span> = <span class="hljs-string">"Msc_Demo"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0001</span></li></ol></pre></div></div>      <p></p></li>     <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ringtone-ringtone#section81796536265" target="_blank">ringtone.getSupportedRingtoneTypes</a>接口，查询支持设置的铃声类型。</span>      <p></p>      <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">ringtoneTypeList</span>: <span class="hljs-title class_">Array</span>&lt;ringtone.<span class="hljs-property">RingtoneType</span>&gt; = ringtone.<span class="hljs-title function_">getSupportedRingtoneTypes</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">APP_TAG</span>,<span class="hljs-string">'getSupportedRingtoneTypes : '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(ringtoneTypeList));</li></ol></pre></div></div>      <p></p></li>     <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ringtone-ringtone#section1858041418291" target="_blank">ringtone.getSupportedDataTypes</a>接口，查询支持的数据类型。当前支持格式：MP3，OGG，FLAC，AAC，MP2，M4A。</span>      <p></p>      <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 其中 ringtone.RingtoneType.NOTIFICATION 为通知铃声</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">dataTypeList</span>: <span class="hljs-title class_">Array</span>&lt;uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>&gt; = ringtone.<span class="hljs-title function_">getSupportedDataTypes</span>(ringtone.<span class="hljs-property">RingtoneType</span>.<span class="hljs-property">NOTIFICATION</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">APP_TAG</span>,<span class="hljs-string">'getSupportedDataTypes: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(dataTypeList));</li></ol></pre></div></div>      <p></p></li>     <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ringtone-ringtone#section5949453189" target="_blank">ringtone.startRingtoneSetting</a>接口拉起设置弹窗，用户设置铃声后返回设置的铃声类型。</span>      <p></p>      <div class="p">       通过promise异步方式：       <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 详细代码参考API参考</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">prefixUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioPath</span>: <span class="hljs-built_in">string</span> = prefixUri + <span class="hljs-string">'/'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span> = audioPath.<span class="hljs-title function_">substring</span>(audioPath.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>, audioPath.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'.'</span>));</li><li><span class="hljs-keyword">await</span> ringtone.<span class="hljs-title function_">startRingtoneSetting</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, audioPath, fileName).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">APP_TAG</span>,<span class="hljs-string">'setFlag :'</span> + res);</li><li>});</li></ol></pre></div></div>      </div>      <p>通过callback异步方式：</p>      <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 详细代码参考API参考</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">prefixUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioPath</span>: <span class="hljs-built_in">string</span> = prefixUri + <span class="hljs-string">'/'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">buttonText</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span> = audioPath.<span class="hljs-title function_">substring</span>(audioPath.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>, audioPath.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'.'</span>));</li><li>ringtone.<span class="hljs-title function_">startRingtoneSetting</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, audioPath, fileName, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">APP_TAG</span>,<span class="hljs-string">'setFlag :'</span> + data);</li><li>}); </li></ol></pre></div></div>      <p></p></li>     <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ringtone-ringtone#section759192934316" target="_blank">ringtone.getSupportedMaxDuration</a>接口，获取当前铃声支持的最大时长。</span>      <p></p>      <div _ngcontent-vxb-c106="" class="highlight-div"><div _ngcontent-vxb-c106="" class="highlight-div-header"><div _ngcontent-vxb-c106="" class="highlight-div-header-left"><div _ngcontent-vxb-c106="" class="handle-button expand-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vxb-c106="" class="highlight-div-header-right"><div _ngcontent-vxb-c106="" class="handle-button ai-button"></div><div _ngcontent-vxb-c106="" class="handle-button line-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vxb-c106="" class="handle-button theme-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vxb-c106="" class="handle-button copy-button"><div _ngcontent-vxb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vxb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 其中 ringtone.RingtoneType.MESSAGE 为短信铃声</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">maxDuration</span>: <span class="hljs-built_in">number</span> =</li><li>  ringtone.<span class="hljs-title function_">getSupportedMaxDuration</span>(ringtone.<span class="hljs-property">RingtoneType</span>.<span class="hljs-property">MESSAGE</span>, uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">MP3</span>)</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-variable constant_">APP_TAG</span>,<span class="hljs-string">'getSupportedMaxDuration: '</span> + maxDuration);</li></ol></pre></div></div>      <p></p></li>    </ol>   </div>   <div></div></div>