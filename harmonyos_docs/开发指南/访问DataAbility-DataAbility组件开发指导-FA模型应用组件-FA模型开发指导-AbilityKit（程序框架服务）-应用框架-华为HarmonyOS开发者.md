<h1 _ngcontent-nbs-c119="" class="doc-title ng-star-inserted" title="访问DataAbility"> 访问DataAbility </h1>

<div _ngcontent-nbs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>访问DataAbility需导入基础依赖包，以及获取与DataAbility子模块通信的URI字符串。</p>    <p>其中，基础依赖包包括：</p>    <ul>     <li>      <p>@ohos.ability.featureAbility</p></li>     <li>      <p>@ohos.data.dataAbility</p></li>    </ul>    <p>访问DataAbility的示例代码如下：</p>    <ol>     <li>      <p>创建工具接口类对象。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-comment">// 作为参数传递的URI,与config中定义的URI的区别是多了一个"/",有三个"/"</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-title class_">DAHelper</span>: ability.<span class="hljs-property">DataAbilityHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(uri);</li></ol></pre></div></div></li>     <li>      <p>构建数据库相关的RDB数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">valuesBucket_insert</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'insert'</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">valuesBucket_update</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'update'</span> };</li><li><span class="hljs-keyword">let</span> crowd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_one'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>,</li><li>  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_two'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>);</li><li><span class="hljs-keyword">let</span> columnArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'introduction'</span>);</li><li><span class="hljs-keyword">let</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li></ol></pre></div></div>      <p>注：关于DataAbilityPredicates的详细内容，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-ability" target="_blank">DataAbility谓词</a>。</p></li>     <li>      <p>调用insert方法向指定的DataAbility子模块插入数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li>
</li><li><span class="hljs-comment">// callback方式调用:</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">valuesBucket_insert</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'insert'</span> };</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">insert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">valuesBucket_insert</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError, data: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'insert_failed_toast'</span></li><li>                  });</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'insert_success_toast'</span></li><li>                  });</li><li>                }</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper insert result: '</span> + data + <span class="hljs-string">', error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>              }</li><li>              );</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">valuesBucket_insert</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'insert'</span> };</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">insert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">valuesBucket_insert</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">datainsert</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'insert_success_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper insert result: '</span> + datainsert);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'insert_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper insert failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>调用delete方法删除DataAbility子模块中指定的数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>, <span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'delete_failed_toast'</span></li><li>                  });</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'delete_success_toast'</span></li><li>                  });</li><li>                }</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper delete result: '</span> + data + <span class="hljs-string">', error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>              }</li><li>              );</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">datadelete</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'delete_success_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper delete result: '</span> + datadelete);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'delete_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper delete failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>调用update方法更新指定DataAbility子模块中的数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">valuesBucket_update</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'update'</span> };</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Rose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">update</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">valuesBucket_update</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>, <span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'update_failed_toast'</span></li><li>                  });</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'update_success_toast'</span></li><li>                  });</li><li>                }</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper update result: '</span> + data + <span class="hljs-string">', error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>              }</li><li>              );</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">valuesBucket_update</span>: rdb.<span class="hljs-property">ValuesBucket</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'update'</span> };</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Rose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">update</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">valuesBucket_update</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dataupdate</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'update_success_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper update result: '</span> + dataupdate);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'update_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper update failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>调用query方法在指定的DataAbility子模块中查找数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> columnArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'introduction'</span>);</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Rose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">query</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnArray</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>, <span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'query_failed_toast'</span></li><li>                  });</li><li>                  hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper query failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'query_success_toast'</span></li><li>                  });</li><li>                }</li><li>                <span class="hljs-comment">// ResultSet是一个数据集合的游标，默认指向第-1个记录，有效的数据从0开始。</span></li><li>                <span class="hljs-keyword">while</span> (data.<span class="hljs-title function_">goToNextRow</span>()) {</li><li>                  <span class="hljs-keyword">const</span> id = data.<span class="hljs-title function_">getLong</span>(data.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'id'</span>));</li><li>                  <span class="hljs-keyword">const</span> name = data.<span class="hljs-title function_">getString</span>(data.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'name'</span>));</li><li>                  <span class="hljs-keyword">const</span> introduction = data.<span class="hljs-title function_">getString</span>(data.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'introduction'</span>));</li><li>                  hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper query result:id = [<span class="hljs-subst">${id}</span>], name = [<span class="hljs-subst">${name}</span>], introduction = [<span class="hljs-subst">${introduction}</span>]`</span>);</li><li>                }</li><li>                <span class="hljs-comment">// 释放数据集的内存</span></li><li>                data.<span class="hljs-title function_">close</span>();</li><li>              }</li><li>              );</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> columnArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'introduction'</span>);</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'Rose'</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">query</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnArray</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dataquery</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'query_success_toast'</span></li><li>                });</li><li>                <span class="hljs-comment">// ResultSet是一个数据集合的游标，默认指向第-1个记录，有效的数据从0开始。</span></li><li>                <span class="hljs-keyword">while</span> (dataquery.<span class="hljs-title function_">goToNextRow</span>()) {</li><li>                  <span class="hljs-keyword">const</span> id = dataquery.<span class="hljs-title function_">getLong</span>(dataquery.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'id'</span>));</li><li>                  <span class="hljs-keyword">const</span> name = dataquery.<span class="hljs-title function_">getString</span>(dataquery.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'name'</span>));</li><li>                  <span class="hljs-keyword">const</span> introduction = dataquery.<span class="hljs-title function_">getString</span>(dataquery.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'introduction'</span>));</li><li>                  hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper query result:id = [<span class="hljs-subst">${id}</span>], name = [<span class="hljs-subst">${name}</span>], introduction = [<span class="hljs-subst">${introduction}</span>]`</span>);</li><li>                }</li><li>                <span class="hljs-comment">// 释放数据集的内存</span></li><li>                dataquery.<span class="hljs-title function_">close</span>();</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'query_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper query failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>调用batchInsert方法向指定的DataAbility子模块批量插入数据。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> crowd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_one'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>,</li><li>    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_two'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>);</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">batchInsert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">crowd</span>, <span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'batchInsert_failed_toast'</span></li><li>                  });</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'batchInsert_success_toast'</span></li><li>                  });</li><li>                }</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper batchInsert result: '</span> + data + <span class="hljs-string">', error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>              }</li><li>              );</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> crowd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_one'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>,</li><li>    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'batchInsert_two'</span> } <span class="hljs-keyword">as</span> rdb.<span class="hljs-property">ValuesBucket</span>);</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">batchInsert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">crowd</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">databatchInsert</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'batchInsert_success_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper batchInsert result: '</span> + databatchInsert);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'batchInsert_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper batchInsert failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>调用executeBatch方法向指定的DataAbility子模块进行数据的批量处理。</p>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// callback方式调用:</span></li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">operations</span>: <span class="hljs-title class_">Array</span>&lt;ability.<span class="hljs-property">DataAbilityOperation</span>&gt; = [{</li><li>                <span class="hljs-attr">uri</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>,</li><li>                <span class="hljs-attr">type</span>: featureAbility.<span class="hljs-property">DataAbilityOperationType</span>.<span class="hljs-property">TYPE_INSERT</span>,</li><li>                <span class="hljs-attr">valuesBucket</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'executeBatch'</span> },</li><li>                <span class="hljs-attr">predicates</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>,</li><li>                <span class="hljs-attr">expectedCount</span>: <span class="hljs-number">0</span>,</li><li>                <span class="hljs-attr">predicatesBackReferences</span>: <span class="hljs-literal">undefined</span>,</li><li>                <span class="hljs-attr">interrupted</span>: <span class="hljs-literal">true</span>,</li><li>              }];</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">executeBatch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, operations, <span class="hljs-function">(<span class="hljs-params">error, data</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'executeBatch_failed_toast'</span></li><li>                  });</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                  promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                    <span class="hljs-attr">message</span>: <span class="hljs-string">'executeBatch_success_toast'</span></li><li>                  });</li><li>                }</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper executeBatch, result: `</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) + <span class="hljs-string">', error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li></ol></pre></div></div>      <div _ngcontent-nbs-c106="" class="highlight-div"><div _ngcontent-nbs-c106="" class="highlight-div-header"><div _ngcontent-nbs-c106="" class="highlight-div-header-left"><div _ngcontent-nbs-c106="" class="handle-button expand-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nbs-c106="" class="highlight-div-header-right"><div _ngcontent-nbs-c106="" class="handle-button ai-button"></div><div _ngcontent-nbs-c106="" class="handle-button line-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nbs-c106="" class="handle-button theme-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nbs-c106="" class="handle-button copy-button"><div _ngcontent-nbs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nbs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.ability'</span>;</li><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> ohos_data_ability <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> promptAction <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.promptAction'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'PageDataAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageDataAbility</span> {</li><li>  <span class="hljs-keyword">private</span> predicates = <span class="hljs-keyword">new</span> ohos_data_ability.<span class="hljs-title class_">DataAbilityPredicates</span>();</li><li>  <span class="hljs-keyword">private</span> uri = <span class="hljs-string">'dataability:///com.samples.famodelabilitydevelop.DataAbility'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title class_">DAHelper</span> = featureAbility.<span class="hljs-title function_">acquireDataAbilityHelper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItemGroup</span>() {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceBetween</span>, <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-comment">// ...</span></li><li>            }</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-comment">// promise方式调用(await需要在async方法中使用):</span></li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">operations</span>: <span class="hljs-title class_">Array</span>&lt;ability.<span class="hljs-property">DataAbilityOperation</span>&gt; = [{</li><li>                <span class="hljs-attr">uri</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>,</li><li>                <span class="hljs-attr">type</span>: featureAbility.<span class="hljs-property">DataAbilityOperationType</span>.<span class="hljs-property">TYPE_INSERT</span>,</li><li>                <span class="hljs-attr">valuesBucket</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Rose'</span>, <span class="hljs-attr">introduction</span>: <span class="hljs-string">'executeBatch'</span> },</li><li>                <span class="hljs-attr">predicates</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicates</span>,</li><li>                <span class="hljs-attr">expectedCount</span>: <span class="hljs-number">0</span>,</li><li>                <span class="hljs-attr">predicatesBackReferences</span>: <span class="hljs-literal">undefined</span>,</li><li>                <span class="hljs-attr">interrupted</span>: <span class="hljs-literal">true</span>,</li><li>              }];</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">DAHelper</span>.<span class="hljs-title function_">executeBatch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uri</span>, operations).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dataquery</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'executeBatch_success_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DAHelper executeBatch result: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(dataquery));</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                promptAction.<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'executeBatch_failed_toast'</span></li><li>                });</li><li>                hilog.<span class="hljs-title function_">error</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`DAHelper executeBatch failed. Cause: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            })</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>    </ol>    <p>DataAbility的客户端的接口是由工具接口类对象DataAbilityHelper向外提供，相关接口可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-ability-dataabilityhelper" target="_blank">DataAbilityHelper模块</a>。</p>   </div>   <div></div></div>