<h1 _ngcontent-job-c119="" class="doc-title ng-star-inserted" title="访问和管理动态照片资源"> 访问和管理动态照片资源 </h1>

<div _ngcontent-job-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>动态照片是一种结合了图片和视频的照片形式，可以显示一小段时间的动态画面和声音。可以帮助用户捕捉精彩的动态瞬间，提升创作空间，同时令拍照的容错率更高。</p>    <p>媒体库提供访问和管理动态照片资源的能力，包括：</p>    <ul>     <li><a href="/consumer/cn/doc/harmonyos-guides/photoaccesshelper-movingphoto#保存动态照片资源">使用安全控件保存动态照片资源</a></li>     <li><a href="/consumer/cn/doc/harmonyos-guides/photoaccesshelper-movingphoto#获取动态照片对象">获取动态照片对象（MovingPhoto）</a></li>     <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/movingphotoview-guidelines">使用MovingPhotoView播放动态照片</a></li>     <li><a href="/consumer/cn/doc/harmonyos-guides/photoaccesshelper-movingphoto#读取动态照片资源">读取动态照片资源</a></li>    </ul>    <p>拍摄动态照片的能力由Camera Kit提供，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-moving-photo">Camera Kit-动态照片</a>。</p>    <div class="tiledSection">     <h2 id="保存动态照片资源">保存动态照片资源<i class="anchor-icon anchor-icon-link" anchorid="保存动态照片资源" tips="复制节点链接"></i></h2>          <p>使用安全控件保存动态照片资源后，可用于获取MovingPhoto对象，从而完成播放动态照片等操作。</p>     <p>使用安全控件保存动态照片资源，无需申请相册管理模块权限'ohos.permission.WRITE_IMAGEVIDEO'，允许用户通过点击按钮临时获取存储权限，并将资源直接保存到指定的媒体库路径，使得操作更为便捷。</p>     <p>详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-security-components-savebutton" target="_blank">安全控件的保存控件</a>。</p>     <p><strong>开发步骤</strong></p>     <ol>      <li>       <p>设置安全控件按钮属性。</p></li>      <li>       <p>创建安全控件按钮。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/kts-apis-photoaccesshelper-mediaassetchangerequest#createassetrequest11" target="_blank">MediaAssetChangeRequest.createAssetRequest</a>接口新建一个创建资产的变更请求，指定待创建资产的子类型为动态照片。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/kts-apis-photoaccesshelper-mediaassetchangerequest#addresource11" target="_blank">MediaAssetChangeRequest.addResource</a>接口指定动态照片的图片和视频内容，动态照片的视频时长不能超过10s。</p>       <p>以下示例以从应用沙箱的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file-access">应用文件</a>fileUri指定动态照片的图片和视频内容为例。</p>       <p>开发者可根据实际情况，通过ArrayBuffer的方式指定资源内容，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/kts-apis-photoaccesshelper-mediaassetchangerequest#addresource11-1" target="_blank">MediaAssetChangeRequest.addResource(type: ResourceType, data: ArrayBuffer)</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoaccesshelper#applychanges11" target="_blank">PhotoAccessHelper.applyChanges</a>接口提交创建资产的变更请求。</p></li>     </ol>     <div _ngcontent-job-c106="" class="highlight-div"><div _ngcontent-job-c106="" class="highlight-div-header"><div _ngcontent-job-c106="" class="highlight-div-header-left"><div _ngcontent-job-c106="" class="handle-button expand-button"><div _ngcontent-job-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-job-c106="" class="highlight-div-header-right"><div _ngcontent-job-c106="" class="handle-button ai-button"></div><div _ngcontent-job-c106="" class="handle-button line-button"><div _ngcontent-job-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-job-c106="" class="handle-button theme-button"><div _ngcontent-job-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-job-c106="" class="handle-button copy-button"><div _ngcontent-job-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-job-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">saveButtonOptions</span>: <span class="hljs-title class_">SaveButtonOptions</span> = {</li><li>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">SaveIconStyle</span>.<span class="hljs-property">FULL_FILLED</span>,</li><li>    <span class="hljs-attr">text</span>: <span class="hljs-title class_">SaveDescription</span>.<span class="hljs-property">SAVE_IMAGE</span>,</li><li>    <span class="hljs-attr">buttonType</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span></li><li>  } <span class="hljs-comment">// 设置安全控件按钮属性。</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">SaveButton</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButtonOptions</span>) <span class="hljs-comment">// 创建安全控件按钮。</span></li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> (event, <span class="hljs-attr">result</span>: <span class="hljs-title class_">SaveButtonOnClickResult</span>) =&gt; {</li><li>             <span class="hljs-keyword">if</span> (result == <span class="hljs-title class_">SaveButtonOnClickResult</span>.<span class="hljs-property">SUCCESS</span>) {</li><li>               <span class="hljs-keyword">try</span> {</li><li>                 <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>                 <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>                 <span class="hljs-comment">// 需要确保imageFileUri和videoFileUri对应的资源存在，分别表示待创建到媒体库的动态照片的图片和视频。</span></li><li>                 <span class="hljs-keyword">let</span> imageFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/create_moving_photo.jpg'</span>;</li><li>                 <span class="hljs-keyword">let</span> videoFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/create_moving_photo.mp4'</span>;</li><li>                 <span class="hljs-keyword">let</span> <span class="hljs-attr">assetChangeRequest</span>: photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span> = photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span>.<span class="hljs-title function_">createAssetRequest</span>(context, photoAccessHelper.<span class="hljs-property">PhotoType</span>.<span class="hljs-property">IMAGE</span>, <span class="hljs-string">"jpg"</span>, {</li><li>                  <span class="hljs-attr">title</span>: <span class="hljs-string">"moving_photo"</span>,</li><li>                  <span class="hljs-attr">subtype</span>: photoAccessHelper.<span class="hljs-property">PhotoSubtype</span>.<span class="hljs-property">MOVING_PHOTO</span></li><li>                 });</li><li>                 assetChangeRequest.<span class="hljs-title function_">addResource</span>(photoAccessHelper.<span class="hljs-property">ResourceType</span>.<span class="hljs-property">IMAGE_RESOURCE</span>, imageFileUri);</li><li>                 assetChangeRequest.<span class="hljs-title function_">addResource</span>(photoAccessHelper.<span class="hljs-property">ResourceType</span>.<span class="hljs-property">VIDEO_RESOURCE</span>, videoFileUri);</li><li>                 <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">applyChanges</span>(assetChangeRequest);</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'create moving photo successfully, uri: '</span> + assetChangeRequest.<span class="hljs-title function_">getAsset</span>().<span class="hljs-property">uri</span>);</li><li>               } <span class="hljs-keyword">catch</span> (err) {</li><li>                 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create moving photo failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>               }</li><li>             } <span class="hljs-keyword">else</span> {</li><li>               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SaveButtonOnClickResult create moving photo failed'</span>);</li><li>             }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="获取动态照片对象">获取动态照片对象<i class="anchor-icon anchor-icon-link" anchorid="获取动态照片对象" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>应用可以通过Picker的方式获取用户媒体库里的动态照片对象，后续可用于在应用内播放动态照片，或是读取动态照片资源进行其他操作（如上传到应用共享给他人浏览等）。</p></li>      <li>       <p>应用也可以通过传入应用沙箱的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file-access">应用文件</a>图片和视频fileUri的方式构造应用本地的动态照片对象。</p></li>     </ul>     <p>获取到动态照片对象后，如需播放动态照片请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/movingphotoview-guidelines">MovingPhotoView组件</a>。</p>    </div>    <div class="tiledSection">     <h3 id="获取媒体库动态照片对象" class="firsth2">获取媒体库动态照片对象<i class="anchor-icon anchor-icon-link" anchorid="获取媒体库动态照片对象" tips="复制节点链接"></i></h3>          <ol>      <li>通过Picker选择动态照片的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/user-file-uri-intro#媒体文件uri">媒体文件</a>uri。</li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoaccesshelper#getassets-1" target="_blank">PhotoAccessHelper.getAssets</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-fetchresult#getfirstobject-1" target="_blank">FetchResult.getFirstObject</a>接口获取uri对应的PhotoAsset资产。</li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-mediaassetmanager#requestmovingphoto12" target="_blank">MediaAssetManager.requestMovingPhoto</a>获取PhotoAsset对应的动态照片对象（MovingPhoto）。</li>     </ol>     <div _ngcontent-job-c106="" class="highlight-div"><div _ngcontent-job-c106="" class="highlight-div-header"><div _ngcontent-job-c106="" class="highlight-div-header-left"><div _ngcontent-job-c106="" class="handle-button expand-button"><div _ngcontent-job-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-job-c106="" class="highlight-div-header-right"><div _ngcontent-job-c106="" class="handle-button ai-button"></div><div _ngcontent-job-c106="" class="handle-button line-button"><div _ngcontent-job-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-job-c106="" class="handle-button theme-button"><div _ngcontent-job-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-job-c106="" class="handle-button copy-button"><div _ngcontent-job-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-job-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { dataSharePredicates } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"example"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>        <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>        <span class="hljs-title function_">example</span>(phAccessHelper, context);</li><li>      }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">phAccessHelper: photoAccessHelper.PhotoAccessHelper, context: Context</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// picker选择动态照片uri。</span></li><li>    <span class="hljs-keyword">let</span> photoSelectOptions = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>    photoSelectOptions.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">MOVING_PHOTO_IMAGE_TYPE</span>;</li><li>    photoSelectOptions.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">9</span>;</li><li>    <span class="hljs-keyword">let</span> photoViewPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>    <span class="hljs-keyword">let</span> photoSelectResult = <span class="hljs-keyword">await</span> photoViewPicker.<span class="hljs-title function_">select</span>(photoSelectOptions);</li><li>    <span class="hljs-keyword">let</span> uris = photoSelectResult.<span class="hljs-property">photoUris</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uris.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-comment">// 获取uri对应的PhotoAsset资产。</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">predicates</span>: dataSharePredicates.<span class="hljs-property">DataSharePredicates</span> = <span class="hljs-keyword">new</span> dataSharePredicates.<span class="hljs-title class_">DataSharePredicates</span>();</li><li>      predicates.<span class="hljs-title function_">equalTo</span>(photoAccessHelper.<span class="hljs-property">PhotoKeys</span>.<span class="hljs-property">URI</span>, uris[i]);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">fetchOption</span>: photoAccessHelper.<span class="hljs-property">FetchOptions</span> = {</li><li>        <span class="hljs-attr">fetchColumns</span>: [],</li><li>        <span class="hljs-attr">predicates</span>: predicates</li><li>      };</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">fetchResult</span>: photoAccessHelper.<span class="hljs-property">FetchResult</span>&lt;photoAccessHelper.<span class="hljs-property">PhotoAsset</span>&gt; = <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">getAssets</span>(fetchOption);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">photoAsset</span>: photoAccessHelper.<span class="hljs-property">PhotoAsset</span> = <span class="hljs-keyword">await</span> fetchResult.<span class="hljs-title function_">getFirstObject</span>();</li><li>      <span class="hljs-comment">// 获取PhotoAsset对应的动态照片对象。</span></li><li>      <span class="hljs-keyword">await</span> photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">requestMovingPhoto</span>(context, photoAsset, {</li><li>        <span class="hljs-attr">deliveryMode</span>: photoAccessHelper.<span class="hljs-property">DeliveryMode</span>.<span class="hljs-property">FAST_MODE</span></li><li>      }, {</li><li>        <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDataPrepared</span>(<span class="hljs-params">movingPhoto: photoAccessHelper.MovingPhoto</span>) {</li><li>          <span class="hljs-keyword">if</span> (movingPhoto !== <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-comment">// 应用可自定义对movingPhoto的处理逻辑。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'request moving photo successfully, uri: '</span> + movingPhoto.<span class="hljs-title function_">getUri</span>());</li><li>          }</li><li>        }</li><li>      })</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`request moving photo failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取应用沙箱动态照片对象">获取应用沙箱动态照片对象<i class="anchor-icon anchor-icon-link" anchorid="获取应用沙箱动态照片对象" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-mediaassetmanager#loadmovingphoto12" target="_blank">MediaAssetManager.loadMovingPhoto</a>加载应用沙箱的动态照片对象（MovingPhoto）。</p>     <div _ngcontent-job-c106="" class="highlight-div"><div _ngcontent-job-c106="" class="highlight-div-header"><div _ngcontent-job-c106="" class="highlight-div-header-left"><div _ngcontent-job-c106="" class="handle-button expand-button"><div _ngcontent-job-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-job-c106="" class="highlight-div-header-right"><div _ngcontent-job-c106="" class="handle-button ai-button"></div><div _ngcontent-job-c106="" class="handle-button line-button"><div _ngcontent-job-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-job-c106="" class="handle-button theme-button"><div _ngcontent-job-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-job-c106="" class="handle-button copy-button"><div _ngcontent-job-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-job-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">outputText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'支持的类型为：\n'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"example"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>        <span class="hljs-title function_">example</span>(context);</li><li>      }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">context: Context</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> imageFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/local_moving_photo.jpg'</span>;</li><li>    <span class="hljs-keyword">let</span> videoFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/local_moving_photo.mp4'</span>;</li><li>    <span class="hljs-keyword">let</span> movingPhoto = <span class="hljs-keyword">await</span> photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">loadMovingPhoto</span>(context, imageFileUri, videoFileUri);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'load moving photo successfully'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`load moving photo failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="读取动态照片资源">读取动态照片资源<i class="anchor-icon anchor-icon-link" anchorid="读取动态照片资源" tips="复制节点链接"></i></h2>          <p>对于一个动态照片对象，应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-movingphoto#requestcontent12" target="_blank">MovingPhoto.requestContent</a>导出图片和视频到应用沙箱，或者读取图片或视频的ArrayBuffer内容。</p>     <div _ngcontent-job-c106="" class="highlight-div"><div _ngcontent-job-c106="" class="highlight-div-header"><div _ngcontent-job-c106="" class="highlight-div-header-left"><div _ngcontent-job-c106="" class="handle-button expand-button"><div _ngcontent-job-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-job-c106="" class="highlight-div-header-right"><div _ngcontent-job-c106="" class="handle-button ai-button"></div><div _ngcontent-job-c106="" class="handle-button line-button"><div _ngcontent-job-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-job-c106="" class="handle-button theme-button"><div _ngcontent-job-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-job-c106="" class="handle-button copy-button"><div _ngcontent-job-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-job-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">movingPhoto: photoAccessHelper.MovingPhoto</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> imageFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/request_moving_photo.jpg'</span>;</li><li>    <span class="hljs-keyword">let</span> videoFileUri = <span class="hljs-string">'file://com.example.temptest/data/storage/el2/base/haps/entry/files/request_moving_photo.mp4'</span>;</li><li>    <span class="hljs-keyword">await</span> movingPhoto.<span class="hljs-title function_">requestContent</span>(imageFileUri, videoFileUri); <span class="hljs-comment">// 将动态照片导出到应用沙箱。</span></li><li>    <span class="hljs-keyword">let</span> imageData = <span class="hljs-keyword">await</span> movingPhoto.<span class="hljs-title function_">requestContent</span>(photoAccessHelper.<span class="hljs-property">ResourceType</span>.<span class="hljs-property">IMAGE_RESOURCE</span>); <span class="hljs-comment">// 读取图片的ArrayBuffer内容。</span></li><li>    <span class="hljs-keyword">let</span> videoData = <span class="hljs-keyword">await</span> movingPhoto.<span class="hljs-title function_">requestContent</span>(photoAccessHelper.<span class="hljs-property">ResourceType</span>.<span class="hljs-property">VIDEO_RESOURCE</span>); <span class="hljs-comment">// 读取视频的ArrayBuffer内容。</span></li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`request content of moving photo failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>