<h1 _ngcontent-vqu-c119="" class="doc-title ng-star-inserted" title="证书PKCS7签名"> 证书PKCS7签名 </h1>

<div _ngcontent-vqu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API 18开始，支持证书PKCS7签名。</p>    <p>PKCS#7是用于存储签名或加密数据的标准语法。CMS作为PKCS#7的扩展，支持的数据类型包括数据、签名数据、信封数据、签名和信封数据、摘要数据以及加密数据。该标准常用于保护数据的完整性和机密性。目前仅支持PKCS7签名数据。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert" target="_blank">证书算法库框架模块</a>。</p>       <div _ngcontent-vqu-c106="" class="highlight-div"><div _ngcontent-vqu-c106="" class="highlight-div-header"><div _ngcontent-vqu-c106="" class="highlight-div-header-left"><div _ngcontent-vqu-c106="" class="handle-button expand-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vqu-c106="" class="highlight-div-header-right"><div _ngcontent-vqu-c106="" class="handle-button ai-button"></div><div _ngcontent-vqu-c106="" class="handle-button line-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vqu-c106="" class="handle-button theme-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vqu-c106="" class="handle-button copy-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vqu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcreatecmsgenerator18" target="_blank">cert.createCmsGenerator</a>创建cmsGenerator对象。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#addsigner18" target="_blank">cmsGenerator.addSigner</a>添加签名者信息。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#addcert18" target="_blank">cmsGenerator.addCert</a>添加证书。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#dofinal18" target="_blank">cmsGenerator.doFinal</a>获取Cms最终签名数据。</p></li>     </ol>     <ul>      <li>       <p>异步方法示例：</p>       <div _ngcontent-vqu-c106="" class="highlight-div"><div _ngcontent-vqu-c106="" class="highlight-div-header"><div _ngcontent-vqu-c106="" class="highlight-div-header-left"><div _ngcontent-vqu-c106="" class="handle-button expand-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vqu-c106="" class="highlight-div-header-right"><div _ngcontent-vqu-c106="" class="handle-button ai-button"></div><div _ngcontent-vqu-c106="" class="handle-button line-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vqu-c106="" class="handle-button theme-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vqu-c106="" class="handle-button copy-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vqu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> certData = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIICXjCCAcegAwIBAgIGAXKnJjrAMA0GCSqGSIb3DQEBCwUAMEgxCzAJBgNVBAYT\n'</span> +</li><li>  <span class="hljs-string">'AkNOMQwwCgYDVQQIDANzaGExDTALBgNVBAcMBHhpYW4xDTALBgNVBAoMBHRlc3Qx\n'</span> +</li><li>  <span class="hljs-string">'DTALBgNVBAMMBHRlc3QwHhcNMjQxMTIyMDkwNTIyWhcNMzQxMTIwMDkwNTIyWjBI\n'</span> +</li><li>  <span class="hljs-string">'MQswCQYDVQQGEwJDTjEMMAoGA1UECAwDc2hhMQ0wCwYDVQQHDAR4aWFuMQ0wCwYD\n'</span> +</li><li>  <span class="hljs-string">'VQQKDAR0ZXN0MQ0wCwYDVQQDDAR0ZXN0MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCB\n'</span> +</li><li>  <span class="hljs-string">'iQKBgQC6nCZTM16Rk2c4P/hwfVm++jqe6GCA/PXXGe4YL218q1dTKMHBGEw8kXi0\n'</span> +</li><li>  <span class="hljs-string">'XLDcyyC2yUn8ywN2QSyly6ke9EE6PGfZywStLp4g2PTTWB04sS3aXT2y+fToiTXQ\n'</span> +</li><li>  <span class="hljs-string">'3AxfFYRpB+EgSdSCkJs6jKXVwbzu54kEtQTfs8UdBQ9nVKaJLwIDAQABo1MwUTAd\n'</span> +</li><li>  <span class="hljs-string">'BgNVHQ4EFgQU6QXnt1smb2HRSO/2zuRQnz/SDxowHwYDVR0jBBgwFoAU6QXnt1sm\n'</span> +</li><li>  <span class="hljs-string">'b2HRSO/2zuRQnz/SDxowDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOB\n'</span> +</li><li>  <span class="hljs-string">'gQBPR/+5xzFG1XlTdgwWVvqVxvhGUkbMTGW0IviJ+jbKsi57vnVsOtFzEA6y+bYx\n'</span> +</li><li>  <span class="hljs-string">'xG/kEOcwLtzeVHOQA+ZU5SVcc+qc0dfFiWjL2PSAG4bpqSTjujpuUk+g8ugixbG1\n'</span> +</li><li>  <span class="hljs-string">'a26pkDJhNeB/E3eBIbeydSY0A/dIGb6vbGo6BSq2KvnWAA==\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----\n'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rsaStr1024</span>: <span class="hljs-built_in">string</span>  =</li><li>  <span class="hljs-string">'-----BEGIN RSA PRIVATE KEY-----\n'</span> +</li><li>    <span class="hljs-string">'Proc-Type: 4,ENCRYPTED\n'</span> +</li><li>    <span class="hljs-string">'DEK-Info: DES-EDE3-CBC,DB0AC6E3BEE16420\n\n'</span> +</li><li>    <span class="hljs-string">'1N5xykdckthZnswMV7blxXm2RCqe/OByBfMwFI7JoXR8STtMiStd4xA3W405k1Ma\n'</span> +</li><li>    <span class="hljs-string">'ExpsHgWwZaS23x+sQ1sL1dsqIPMrw1Vr+KrL20vQcCVjXPpGKauafVbtcWQ1r2PZ\n'</span> +</li><li>    <span class="hljs-string">'QJ4KWP6FhUp+sGt2ItODW3dK+1GdqL22ZtANrgFzS42Wh8FSn0UMCf6RG62DK62J\n'</span> +</li><li>    <span class="hljs-string">'z2jtf4XaorrGSjdTeY+fyyGfSyKidIMMBe+IXwlhCgAe7aHSaqXtMsv+BibB7PJ3\n'</span> +</li><li>    <span class="hljs-string">'XmEp1D/0ptL3r46txyYcuy8jSNCkW8er93KKnlRN6KbuYZPvPNncWkzZBzV17t5d\n'</span> +</li><li>    <span class="hljs-string">'QgtvVh32AKgqk5jm8YVnspOFiPrbrK9UN3IW15juFkfnhriM3IrKap4/kW+tfawZ\n'</span> +</li><li>    <span class="hljs-string">'DmHkSyl8xqFK413Rv0UvYBTjOcGbs2BSJYEvp8CIjtA17SvLmNw70K2nXWuQYutY\n'</span> +</li><li>    <span class="hljs-string">'+HyucPtHfEqUPQRzWTAMMntTru77u7dxo2WMMMxOtMJO5h7MAnZH9bAFiuO3ewcY\n'</span> +</li><li>    <span class="hljs-string">'eEePg10d8Owcfh9G6kc0HIGT9MMLMi0mTXhpoQTuWPYuSx6uUZL1fsp1x2fuM0qn\n'</span> +</li><li>    <span class="hljs-string">'bdf3+UnATYUu4tgvBHrMV7405Y6Y3PnqOFxVMeAHeOTo6UThtJ10mfeCPXGcUaHo\n'</span> +</li><li>    <span class="hljs-string">'P5enw7h4145cha3+S4hNrUwj3skrtavld7tY74p4DvgZSlCMF3JAm3DhpnEMVcYP\n'</span> +</li><li>    <span class="hljs-string">'Y6TkSevvxOpBvEHE41Y4VBCBwd9clcixI6cSBJKPUU4A/sc/kkNdGFcbzLQCg/zR\n'</span> +</li><li>    <span class="hljs-string">'1m7YmBROb2qy4w3lv/uwVnPGLg/YV465irRaN3hgz7/1lm8STKQhmQ==\n'</span> +</li><li>    <span class="hljs-string">'-----END RSA PRIVATE KEY-----\n'</span>;</li><li>
</li><li><span class="hljs-comment">// string转Uint8Array。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Uint8Array</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = str.<span class="hljs-property">length</span>; i &lt; j; i++) {</li><li>    arr.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">charCodeAt</span>(i));</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">testPkcs7SignByPromise</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">certEncodingBlob</span>: cert.<span class="hljs-property">EncodingBlob</span> = {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-title function_">stringToUint8Array</span>(certData),</li><li>    <span class="hljs-comment">// 根据encodingData的格式进行赋值，支持FORMAT_PEM和FORMAT_DER。</span></li><li>    <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>  };</li><li>  cert.<span class="hljs-title function_">createX509Cert</span>(certEncodingBlob, <span class="hljs-function">(<span class="hljs-params">error, x509Cert</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createX509Cert failed, errCode: '</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">', errMsg: '</span> + error.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> cmsContentType = cert.<span class="hljs-property">CmsContentType</span>.<span class="hljs-property">SIGNED_DATA</span>;</li><li>        <span class="hljs-keyword">let</span> cmsGenerator = cert.<span class="hljs-title function_">createCmsGenerator</span>(cmsContentType);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignByPromise createCmsGenerator success.'</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">privateKeyInfo</span>: cert.<span class="hljs-property">PrivateKeyInfo</span> = {</li><li>          <span class="hljs-attr">key</span>: rsaStr1024,</li><li>          <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span></li><li>        };</li><li>        <span class="hljs-comment">// addCert设置为true时，第二次addSigner或者addCert增加相同的证书，会报错。</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: cert.<span class="hljs-property">CmsSignerConfig</span> = {</li><li>          <span class="hljs-attr">mdName</span>:<span class="hljs-string">'SHA256'</span>,</li><li>          <span class="hljs-attr">addCert</span>:<span class="hljs-literal">false</span>,</li><li>          <span class="hljs-attr">addAttr</span>:<span class="hljs-literal">true</span>,</li><li>          <span class="hljs-attr">addSmimeCapAttr</span>:<span class="hljs-literal">true</span></li><li>        }</li><li>        cmsGenerator.<span class="hljs-title function_">addSigner</span>(x509Cert, privateKeyInfo, config);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignByPromise addSigner success.'</span>);</li><li>        cmsGenerator.<span class="hljs-title function_">addCert</span>(x509Cert);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignByPromise addCert success.'</span>);</li><li>        <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">optionsFinal</span>: cert.<span class="hljs-property">CmsGeneratorOptions</span> = {</li><li>          contentDataFormat : cert.<span class="hljs-property">CmsContentDataFormat</span>.<span class="hljs-property">BINARY</span>,</li><li>          outFormat : cert.<span class="hljs-property">CmsFormat</span>.<span class="hljs-property">PEM</span>,</li><li>          isDetached : <span class="hljs-literal">true</span></li><li>        };</li><li>        cmsGenerator.<span class="hljs-title function_">doFinal</span>(content, optionsFinal).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignByPromise doFinal success, result = %s'</span>, result);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'testPkcs7SignByPromise failed, errCode: '</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">', errMsg: '</span> + error.<span class="hljs-property">message</span>);</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'testPkcs7SignByPromise failed, errCode: '</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">', errMsg: '</span> + e.<span class="hljs-property">message</span>);</li><li>      }</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步方法示例：</p>       <div _ngcontent-vqu-c106="" class="highlight-div"><div _ngcontent-vqu-c106="" class="highlight-div-header"><div _ngcontent-vqu-c106="" class="highlight-div-header-left"><div _ngcontent-vqu-c106="" class="handle-button expand-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vqu-c106="" class="highlight-div-header-right"><div _ngcontent-vqu-c106="" class="handle-button ai-button"></div><div _ngcontent-vqu-c106="" class="handle-button line-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vqu-c106="" class="handle-button theme-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vqu-c106="" class="handle-button copy-button"><div _ngcontent-vqu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vqu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> certData = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIICXjCCAcegAwIBAgIGAXKnJjrAMA0GCSqGSIb3DQEBCwUAMEgxCzAJBgNVBAYT\n'</span> +</li><li>  <span class="hljs-string">'AkNOMQwwCgYDVQQIDANzaGExDTALBgNVBAcMBHhpYW4xDTALBgNVBAoMBHRlc3Qx\n'</span> +</li><li>  <span class="hljs-string">'DTALBgNVBAMMBHRlc3QwHhcNMjQxMTIyMDkwNTIyWhcNMzQxMTIwMDkwNTIyWjBI\n'</span> +</li><li>  <span class="hljs-string">'MQswCQYDVQQGEwJDTjEMMAoGA1UECAwDc2hhMQ0wCwYDVQQHDAR4aWFuMQ0wCwYD\n'</span> +</li><li>  <span class="hljs-string">'VQQKDAR0ZXN0MQ0wCwYDVQQDDAR0ZXN0MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCB\n'</span> +</li><li>  <span class="hljs-string">'iQKBgQC6nCZTM16Rk2c4P/hwfVm++jqe6GCA/PXXGe4YL218q1dTKMHBGEw8kXi0\n'</span> +</li><li>  <span class="hljs-string">'XLDcyyC2yUn8ywN2QSyly6ke9EE6PGfZywStLp4g2PTTWB04sS3aXT2y+fToiTXQ\n'</span> +</li><li>  <span class="hljs-string">'3AxfFYRpB+EgSdSCkJs6jKXVwbzu54kEtQTfs8UdBQ9nVKaJLwIDAQABo1MwUTAd\n'</span> +</li><li>  <span class="hljs-string">'BgNVHQ4EFgQU6QXnt1smb2HRSO/2zuRQnz/SDxowHwYDVR0jBBgwFoAU6QXnt1sm\n'</span> +</li><li>  <span class="hljs-string">'b2HRSO/2zuRQnz/SDxowDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOB\n'</span> +</li><li>  <span class="hljs-string">'gQBPR/+5xzFG1XlTdgwWVvqVxvhGUkbMTGW0IviJ+jbKsi57vnVsOtFzEA6y+bYx\n'</span> +</li><li>  <span class="hljs-string">'xG/kEOcwLtzeVHOQA+ZU5SVcc+qc0dfFiWjL2PSAG4bpqSTjujpuUk+g8ugixbG1\n'</span> +</li><li>  <span class="hljs-string">'a26pkDJhNeB/E3eBIbeydSY0A/dIGb6vbGo6BSq2KvnWAA==\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----\n'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rsaStr1024</span>: <span class="hljs-built_in">string</span>  =</li><li>  <span class="hljs-string">'-----BEGIN RSA PRIVATE KEY-----\n'</span> +</li><li>    <span class="hljs-string">'Proc-Type: 4,ENCRYPTED\n'</span> +</li><li>    <span class="hljs-string">'DEK-Info: DES-EDE3-CBC,DB0AC6E3BEE16420\n\n'</span> +</li><li>    <span class="hljs-string">'1N5xykdckthZnswMV7blxXm2RCqe/OByBfMwFI7JoXR8STtMiStd4xA3W405k1Ma\n'</span> +</li><li>    <span class="hljs-string">'ExpsHgWwZaS23x+sQ1sL1dsqIPMrw1Vr+KrL20vQcCVjXPpGKauafVbtcWQ1r2PZ\n'</span> +</li><li>    <span class="hljs-string">'QJ4KWP6FhUp+sGt2ItODW3dK+1GdqL22ZtANrgFzS42Wh8FSn0UMCf6RG62DK62J\n'</span> +</li><li>    <span class="hljs-string">'z2jtf4XaorrGSjdTeY+fyyGfSyKidIMMBe+IXwlhCgAe7aHSaqXtMsv+BibB7PJ3\n'</span> +</li><li>    <span class="hljs-string">'XmEp1D/0ptL3r46txyYcuy8jSNCkW8er93KKnlRN6KbuYZPvPNncWkzZBzV17t5d\n'</span> +</li><li>    <span class="hljs-string">'QgtvVh32AKgqk5jm8YVnspOFiPrbrK9UN3IW15juFkfnhriM3IrKap4/kW+tfawZ\n'</span> +</li><li>    <span class="hljs-string">'DmHkSyl8xqFK413Rv0UvYBTjOcGbs2BSJYEvp8CIjtA17SvLmNw70K2nXWuQYutY\n'</span> +</li><li>    <span class="hljs-string">'+HyucPtHfEqUPQRzWTAMMntTru77u7dxo2WMMMxOtMJO5h7MAnZH9bAFiuO3ewcY\n'</span> +</li><li>    <span class="hljs-string">'eEePg10d8Owcfh9G6kc0HIGT9MMLMi0mTXhpoQTuWPYuSx6uUZL1fsp1x2fuM0qn\n'</span> +</li><li>    <span class="hljs-string">'bdf3+UnATYUu4tgvBHrMV7405Y6Y3PnqOFxVMeAHeOTo6UThtJ10mfeCPXGcUaHo\n'</span> +</li><li>    <span class="hljs-string">'P5enw7h4145cha3+S4hNrUwj3skrtavld7tY74p4DvgZSlCMF3JAm3DhpnEMVcYP\n'</span> +</li><li>    <span class="hljs-string">'Y6TkSevvxOpBvEHE41Y4VBCBwd9clcixI6cSBJKPUU4A/sc/kkNdGFcbzLQCg/zR\n'</span> +</li><li>    <span class="hljs-string">'1m7YmBROb2qy4w3lv/uwVnPGLg/YV465irRaN3hgz7/1lm8STKQhmQ==\n'</span> +</li><li>    <span class="hljs-string">'-----END RSA PRIVATE KEY-----\n'</span>;</li><li>
</li><li><span class="hljs-comment">// string转Uint8Array。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Uint8Array</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = str.<span class="hljs-property">length</span>; i &lt; j; i++) {</li><li>    arr.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">charCodeAt</span>(i));</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">testPkcs7SignBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">certEncodingBlob</span>: cert.<span class="hljs-property">EncodingBlob</span> = {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-title function_">stringToUint8Array</span>(certData),</li><li>    <span class="hljs-comment">// 根据encodingData的格式进行赋值，支持FORMAT_PEM和FORMAT_DER。</span></li><li>    <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>  };</li><li>  cert.<span class="hljs-title function_">createX509Cert</span>(certEncodingBlob, <span class="hljs-function">(<span class="hljs-params">error, x509Cert</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createX509Cert failed, errCode: '</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">', errMsg: '</span> + error.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-keyword">let</span> cmsContentType = cert.<span class="hljs-property">CmsContentType</span>.<span class="hljs-property">SIGNED_DATA</span>;</li><li>          <span class="hljs-keyword">let</span> cmsGenerator = cert.<span class="hljs-title function_">createCmsGenerator</span>(cmsContentType);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignBySync createCmsGenerator success.'</span>);</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">privateKeyInfo</span>: cert.<span class="hljs-property">PrivateKeyInfo</span> = {</li><li>            <span class="hljs-attr">key</span>: rsaStr1024,</li><li>            <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span></li><li>          };</li><li>          <span class="hljs-comment">// addCert设置为true时，第二次addSigner或者addCert增加相同的证书，会报错。</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: cert.<span class="hljs-property">CmsSignerConfig</span> = {</li><li>            <span class="hljs-attr">mdName</span>:<span class="hljs-string">'SHA256'</span>,</li><li>            <span class="hljs-attr">addCert</span>:<span class="hljs-literal">false</span>,</li><li>            <span class="hljs-attr">addAttr</span>:<span class="hljs-literal">false</span>,</li><li>            <span class="hljs-attr">addSmimeCapAttr</span>:<span class="hljs-literal">false</span></li><li>          }</li><li>          cmsGenerator.<span class="hljs-title function_">addSigner</span>(x509Cert, privateKeyInfo, config);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignBySync addSigner success.'</span>);</li><li>          cmsGenerator.<span class="hljs-title function_">addCert</span>(x509Cert);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignBySync addCert success.'</span>);</li><li>          <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]);</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">optionsFinal</span>: cert.<span class="hljs-property">CmsGeneratorOptions</span> = {</li><li>            contentDataFormat : cert.<span class="hljs-property">CmsContentDataFormat</span>.<span class="hljs-property">BINARY</span>,</li><li>            outFormat : cert.<span class="hljs-property">CmsFormat</span>.<span class="hljs-property">DER</span>,</li><li>            isDetached : <span class="hljs-literal">false</span></li><li>          };</li><li>          <span class="hljs-keyword">let</span> output = cmsGenerator.<span class="hljs-title function_">doFinalSync</span>(content, optionsFinal);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'testPkcs7SignBySync doFinalSync success, output = %s.'</span>, output);</li><li>        } <span class="hljs-keyword">catch</span> (err) {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'testPkcs7SignBySync failed, errCode: '</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">', errMsg: '</span> + e.<span class="hljs-property">message</span>);</li><li>        }</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>