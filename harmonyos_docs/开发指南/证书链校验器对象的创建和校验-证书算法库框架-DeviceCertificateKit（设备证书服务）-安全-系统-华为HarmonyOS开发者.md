<h1 _ngcontent-cgy-c119="" class="doc-title ng-star-inserted" title="证书链校验器对象的创建和校验"> 证书链校验器对象的创建和校验 </h1>

<div _ngcontent-cgy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>证书链是由一组证书组成的证书集合，以图中样例证书文件为例，即可放在一个证书链中。</p>    <p>样例中可以看到GlobalSign自签名了证书，GlobalSign也签发了GlobalSign RSA OV SSL CA 2018的证书，GlobalSign RSA OV SSL CA 2018又签发了第三级证书。</p>    <p><span><img originheight="721" originwidth="1397" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115054.58320040974373952034668550436075:50001231000000:2800:C21A02CF3825B80DA99499C5745C95FB85653A3489BA90B81B8F028D99503569.png" width="920" height="474.8174659985683"></span></p>    <p>开发者可以参考示例将已有的多个证书构建出证书链数据。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert" target="_blank">证书算法库框架模块</a>。</p>       <div _ngcontent-cgy-c106="" class="highlight-div"><div _ngcontent-cgy-c106="" class="highlight-div-header"><div _ngcontent-cgy-c106="" class="highlight-div-header-left"><div _ngcontent-cgy-c106="" class="handle-button expand-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgy-c106="" class="highlight-div-header-right"><div _ngcontent-cgy-c106="" class="handle-button ai-button"></div><div _ngcontent-cgy-c106="" class="handle-button line-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgy-c106="" class="handle-button theme-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgy-c106="" class="handle-button copy-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li></ol></pre></div></div></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcreatecertchainvalidator" target="_blank">cert.createCertChainValidator</a>创建证书链校验器对象。</p></li>      <li>       <p>基于已有的证书数据，创建证书链数据对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certchaindata" target="_blank">CertChainData</a>。</p>       <p>证书算法库框架提供了证书链校验器对象可用于校验证书链，以验证信任链根源，但待校验的证书链数据对象应符合证书链数据对象的数据结构定义<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certchaindata" target="_blank">CertChainData</a>。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#validate" target="_blank">CertChainValidator.validate</a>校验证书链数据。</p></li>     </ol>     <div _ngcontent-cgy-c106="" class="highlight-div"><div _ngcontent-cgy-c106="" class="highlight-div-header"><div _ngcontent-cgy-c106="" class="highlight-div-header-left"><div _ngcontent-cgy-c106="" class="handle-button expand-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cgy-c106="" class="highlight-div-header-right"><div _ngcontent-cgy-c106="" class="handle-button ai-button"></div><div _ngcontent-cgy-c106="" class="handle-button line-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cgy-c106="" class="handle-button theme-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cgy-c106="" class="handle-button copy-button"><div _ngcontent-cgy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cgy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// CA数据，这只是一个示例，需要根据具体业务来赋值。</span></li><li><span class="hljs-keyword">let</span> caCertData = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIIDgTCCAmmgAwIBAgIGAXKnJjrAMA0GCSqGSIb3DQEBCwUAMFcxCzAJBgNVBAYT\n'</span> +</li><li>  <span class="hljs-string">'AkNOMQ8wDQYDVQQIDAbpmZXopb8xDzANBgNVBAcMBuilv+WuiTEPMA0GA1UECgwG\n'</span> +</li><li>  <span class="hljs-string">'5rWL6K+VMRUwEwYDVQQDDAzkuK3mlofmtYvor5UwHhcNMjUwMjIwMDI1NjMxWhcN\n'</span> +</li><li>  <span class="hljs-string">'MzUwMjE4MDI1NjMxWjBXMQswCQYDVQQGEwJDTjEPMA0GA1UECAwG6ZmV6KW/MQ8w\n'</span> +</li><li>  <span class="hljs-string">'DQYDVQQHDAbopb/lrokxDzANBgNVBAoMBua1i+ivlTEVMBMGA1UEAwwM5Lit5paH\n'</span> +</li><li>  <span class="hljs-string">'5rWL6K+VMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyY30ubE33Zmc\n'</span> +</li><li>  <span class="hljs-string">'BBM4OIpD1UuDVKynC4xNBK4v79vnlc4ElmRZD4RjkS612DtpaUzt/yHMZXmJTdqg\n'</span> +</li><li>  <span class="hljs-string">'2jq7UG4sQc0G3uNGIXdUpRZpnUYGVftuZMxHaNOb+IgDkZzaO3Dk33piOpH/X/Ke\n'</span> +</li><li>  <span class="hljs-string">'OosCbm7eBL+y+wRhUsLSCEasEsIvW3edHuYLrfz3MzwY/9AmnwqDGdRJ5rPayODD\n'</span> +</li><li>  <span class="hljs-string">'HH0yw9JuRkdMacN8omVX8jBfJeI8KafcQW8MJz+Y0qyQyiZ6A81AQSVfT+6Sk2U3\n'</span> +</li><li>  <span class="hljs-string">'UqeSTmtdIL1u29HfYLwYGHey+1Ro2wxqnMsFKIdKu2dDMDQZx61pER/dFtPYFlS7\n'</span> +</li><li>  <span class="hljs-string">'/uh3mi9HUQIDAQABo1MwUTAdBgNVHQ4EFgQUGDykmR825RPNFIEQaFzUqkr+CIow\n'</span> +</li><li>  <span class="hljs-string">'HwYDVR0jBBgwFoAUGDykmR825RPNFIEQaFzUqkr+CIowDwYDVR0TAQH/BAUwAwEB\n'</span> +</li><li>  <span class="hljs-string">'/zANBgkqhkiG9w0BAQsFAAOCAQEAXjlmYKjBz1ajWywZNlN+LVRXNx7bS4TYtOc2\n'</span> +</li><li>  <span class="hljs-string">'ME4N1ls6yjWSLtBe4DdkBqZ2HwrVW4dg5xZdAS/T0v/rRiGbX6iUFRV9WCTdtLZB\n'</span> +</li><li>  <span class="hljs-string">'HKNh7vU39F7mgTaaWXQK/+6NeLKMzwJENRRaESI/sXeKE6irfJgYuq3NH8GGFd+w\n'</span> +</li><li>  <span class="hljs-string">'HnvVBHRb6WSlY2s5Li7t6lj40UbwOljnqzRQvBeX57rOnzJgVKND3oY9pex/05Oe\n'</span> +</li><li>  <span class="hljs-string">'96x+qc2iqZbu54A6NYCTj/65EEKoj5rYxPXMV4FegV42ouaLJJoS+cEEY7w+ixcl\n'</span> +</li><li>  <span class="hljs-string">'04TjtjEdhTZiJCmI0RK50H2SWC0t9qkFewM3CCWTHY5ygPtMGA==\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----\n'</span>;</li><li>
</li><li><span class="hljs-comment">// 二级CA证书数据，这只是一个示例，需要根据具体业务来赋值。</span></li><li><span class="hljs-keyword">let</span> secondCaCertData = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIIDgTCCAmmgAwIBAgIGAXKnJjrBMA0GCSqGSIb3DQEBCwUAMFcxCzAJBgNVBAYT\n'</span> +</li><li>  <span class="hljs-string">'AkNOMQ8wDQYDVQQIDAbpmZXopb8xDzANBgNVBAcMBuilv+WuiTEPMA0GA1UECgwG\n'</span> +</li><li>  <span class="hljs-string">'5rWL6K+VMRUwEwYDVQQDDAzkuK3mlofmtYvor5UwHhcNMjUwMjIwMDI1NjU3WhcN\n'</span> +</li><li>  <span class="hljs-string">'MzUwMjE4MDI1NjU3WjBXMQswCQYDVQQGEwJDTjEPMA0GA1UECAwG6ZmV6KW/MQ8w\n'</span> +</li><li>  <span class="hljs-string">'DQYDVQQHDAbopb/lrokxDzANBgNVBAoMBua1i+ivlTEVMBMGA1UEAwwM5Lit5paH\n'</span> +</li><li>  <span class="hljs-string">'5rWL6K+VMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxSL5L7fwMaRF\n'</span> +</li><li>  <span class="hljs-string">'RiT1l7kpzaAqZe33/3lgexoMfGiIFarIhYyYJsmOJKes2uLSnPeqEtscrXmFQiIG\n'</span> +</li><li>  <span class="hljs-string">'0srmwrriGgo3oxDp4/5i1FhCf3FqZUwD/RJhtVmkHT0HoYl4cpt/dJSF/e5vxt/J\n'</span> +</li><li>  <span class="hljs-string">'2Z1eRIQOj9DzyqET6+ONQmfVOyzEH6xlpXHZLvykSZ7ytPp25LxULPWjTmpDOPRq\n'</span> +</li><li>  <span class="hljs-string">'vkSMaH4H3mPw/Z9r0MVKP7DgAZMl2yVudHp785AMTVD0L9zWGHf3sek25ek5nv2r\n'</span> +</li><li>  <span class="hljs-string">'SlB21MTBpvd8GC/iGns4V3Bvf75WAMgpGghAkRRyADeqt5Hw+x9BIb9FcfE+h6n+\n'</span> +</li><li>  <span class="hljs-string">'6EF6FPa8GQIDAQABo1MwUTAdBgNVHQ4EFgQUjt2Crk/j6W8WCdHWyz4H+Q2/3PYw\n'</span> +</li><li>  <span class="hljs-string">'HwYDVR0jBBgwFoAUGDykmR825RPNFIEQaFzUqkr+CIowDwYDVR0TAQH/BAUwAwEB\n'</span> +</li><li>  <span class="hljs-string">'/zANBgkqhkiG9w0BAQsFAAOCAQEAksPHMuVF9e2GMVlaSe1Ao9D1KrJvKNaFZPCI\n'</span> +</li><li>  <span class="hljs-string">'lQe2CDsX+Qu7sQj4SML5vvWFLtcAp6ZovqUyEM0PtZWVSjPCRTMJ3ofBPwnXvQ2N\n'</span> +</li><li>  <span class="hljs-string">'7J7NCDA227MQabXeN3jMhkcAzlpdO5poTnobPF4xRqb39jM7otnNJsujvzdDab2l\n'</span> +</li><li>  <span class="hljs-string">'LiP4eU5TrEaF2lwidBWJX0VoLrRpqzQhiWXGMpCBBugP5U+bFs20wezJBG19WYyc\n'</span> +</li><li>  <span class="hljs-string">'2xKKfvyIcxrpmvjLZl8HddS7Ot1CKXyc8U9QZBGAlPwOXu8juppcEtjJyl36EnvF\n'</span> +</li><li>  <span class="hljs-string">'YAcwrXOAtCiNpX3UnLUbG8GtpOOWQWCt+x1gKmA6V0jbqQmqcw==\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----\n'</span>;</li><li>
</li><li><span class="hljs-comment">// 证书链校验器示例。在这个示例中，验证了一个二级证书链。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">certChainValidatorSample</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li>  <span class="hljs-comment">// 证书链校验器算法。目前仅支持PKIX。</span></li><li>  <span class="hljs-keyword">let</span> algorithm = <span class="hljs-string">'PKIX'</span>;</li><li>
</li><li>  <span class="hljs-comment">// 创建一个证书链校验器实例。</span></li><li>  <span class="hljs-keyword">let</span> validator = cert.<span class="hljs-title function_">createCertChainValidator</span>(algorithm);</li><li>
</li><li>  <span class="hljs-comment">// CA证书数据。</span></li><li>  <span class="hljs-keyword">let</span> uint8ArrayOfCaCertData = textEncoder.<span class="hljs-title function_">encodeInto</span>(caCertData);</li><li>
</li><li>  <span class="hljs-comment">// CA证书数据的长度。</span></li><li>  <span class="hljs-keyword">let</span> uint8ArrayOfCaCertDataLen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([uint8ArrayOfCaCertData.<span class="hljs-property">byteLength</span>]).<span class="hljs-property">buffer</span>);</li><li>
</li><li>  <span class="hljs-comment">// 二级CA证书数据。</span></li><li>  <span class="hljs-keyword">let</span> uint8ArrayOf2ndCaCertData =  textEncoder.<span class="hljs-title function_">encodeInto</span>(secondCaCertData);</li><li>
</li><li>  <span class="hljs-comment">// 二级CA证书数据的长度。</span></li><li>  <span class="hljs-keyword">let</span> uint8ArrayOf2ndCaCertDataLen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([uint8ArrayOf2ndCaCertData.<span class="hljs-property">byteLength</span>]).<span class="hljs-property">buffer</span>);</li><li>
</li><li>  <span class="hljs-comment">// 证书链二进制数据：二级CA证书数据长度+二级CA证书数据+CA证书数据长度+CA证书数据（L-V格式）。</span></li><li>  <span class="hljs-keyword">let</span> encodingData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(uint8ArrayOf2ndCaCertDataLen.<span class="hljs-property">length</span> + uint8ArrayOf2ndCaCertData.<span class="hljs-property">length</span> +</li><li>  uint8ArrayOfCaCertDataLen.<span class="hljs-property">length</span> + uint8ArrayOfCaCertData.<span class="hljs-property">length</span>);</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8ArrayOf2ndCaCertDataLen.<span class="hljs-property">length</span>; i++) {</li><li>    encodingData[i] = uint8ArrayOf2ndCaCertDataLen[i];</li><li>  }</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8ArrayOf2ndCaCertData.<span class="hljs-property">length</span>; i++) {</li><li>    encodingData[uint8ArrayOf2ndCaCertDataLen.<span class="hljs-property">length</span> + i] = uint8ArrayOf2ndCaCertData[i];</li><li>  }</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8ArrayOfCaCertDataLen.<span class="hljs-property">length</span>; i++) {</li><li>    encodingData[uint8ArrayOf2ndCaCertDataLen.<span class="hljs-property">length</span> + uint8ArrayOf2ndCaCertData.<span class="hljs-property">length</span> + i] = uint8ArrayOfCaCertDataLen[i];</li><li>  }</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uint8ArrayOfCaCertData.<span class="hljs-property">length</span>; i++) {</li><li>    encodingData[uint8ArrayOf2ndCaCertDataLen.<span class="hljs-property">length</span> + uint8ArrayOf2ndCaCertData.<span class="hljs-property">length</span> +</li><li>    uint8ArrayOfCaCertDataLen.<span class="hljs-property">length</span> + i] = uint8ArrayOfCaCertData[i];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">certChainData</span>: cert.<span class="hljs-property">CertChainData</span> = {</li><li>    <span class="hljs-comment">// Uint8Array类型：L-V格式（证书数据长度-证书数据）。</span></li><li>    <span class="hljs-attr">data</span>: encodingData,</li><li>    <span class="hljs-comment">// 证书的数量。本例中为2。</span></li><li>    <span class="hljs-attr">count</span>: <span class="hljs-number">2</span>,</li><li>    <span class="hljs-comment">// 证书格式。仅支持 PEM 和 DER。在此示例中，证书为 PEM 格式。</span></li><li>    <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>  };</li><li>
</li><li>  <span class="hljs-comment">// 验证证书链。</span></li><li>  validator.<span class="hljs-title function_">validate</span>(certChainData, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 校验失败。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`validate failed, errCode: <span class="hljs-subst">${err.code}</span>, errMsg: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-comment">// 校验成功。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'validate success'</span>);</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>