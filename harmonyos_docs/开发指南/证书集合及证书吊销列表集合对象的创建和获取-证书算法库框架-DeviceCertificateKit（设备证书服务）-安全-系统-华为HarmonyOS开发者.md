<h1 _ngcontent-lsr-c119="" class="doc-title ng-star-inserted" title="证书集合及证书吊销列表集合对象的创建和获取"> 证书集合及证书吊销列表集合对象的创建和获取 </h1>

<div _ngcontent-lsr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从输入的证书集合和证书吊销列表集合中选择满足条件的证书或者证书吊销列表。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert" target="_blank">证书算法库框架模块</a>。</p>       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>基于已有的证书数据，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcreatex509cert-1" target="_blank">cert.createX509Cert</a>创建X509证书的对象。</p></li>      <li>       <p>基于已有的CRL数据，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcreatex509crl11-1" target="_blank">cert.createX509CRL</a>创建X509证书吊销列表的对象。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcreatecertcrlcollection11" target="_blank">cert.createCertCRLCollection</a>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#certcrlcollection11" target="_blank">CertCRLCollection</a>的对象，并返回相应的结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#selectcerts11" target="_blank">CertCRLCollection.selectCerts</a>查找所有与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#x509certmatchparameters11" target="_blank">X509CertMatchParameters</a>匹配的证书对象数组，并返回结果。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#selectcrls11" target="_blank">CertCRLCollection.selectCRLs</a>查找所有与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cert#x509crlmatchparameters11" target="_blank">X509CRLMatchParameters</a>匹配的证书吊销列表数组，并返回结果。</p></li>     </ol>     <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createX509CRL</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;cert.<span class="hljs-property">X509CRL</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> crlData = <span class="hljs-string">'-----BEGIN X509 CRL-----\n'</span> +</li><li>    <span class="hljs-string">'MIHzMF4CAQMwDQYJKoZIhvcNAQEEBQAwFTETMBEGA1UEAxMKQ1JMIGlzc3VlchcN\n'</span> +</li><li>    <span class="hljs-string">'MTcwODA3MTExOTU1WhcNMzIxMjE0MDA1MzIwWjAVMBMCAgPoFw0zMjEyMTQwMDUz\n'</span> +</li><li>    <span class="hljs-string">'MjBaMA0GCSqGSIb3DQEBBAUAA4GBACEPHhlaCTWA42ykeaOyR0SGQIHIOUR3gcDH\n'</span> +</li><li>    <span class="hljs-string">'J1LaNwiL+gDxI9rMQmlhsUGJmPIPdRs9uYyI+f854lsWYisD2PUEpn3DbEvzwYeQ\n'</span> +</li><li>    <span class="hljs-string">'5SqQoPDoM+YfZZa23hoTLsu52toXobP74sf/9K501p/+8hm4ROMLBoRT86GQKY6g\n'</span> +</li><li>    <span class="hljs-string">'eavsH0Q3\n'</span> +</li><li>    <span class="hljs-string">'-----END X509 CRL-----\n'</span>;</li><li>
</li><li>  <span class="hljs-comment">// 证书吊销列表二进制数据，需业务自行赋值。</span></li><li>  <span class="hljs-keyword">let</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">encodingBlob</span>: cert.<span class="hljs-property">EncodingBlob</span> = {</li><li>    <span class="hljs-attr">data</span>: textEncoder.<span class="hljs-title function_">encodeInto</span>(crlData),</li><li>    <span class="hljs-comment">// 根据encodingData的格式进行赋值，支持FORMAT_PEM和FORMAT_DER。</span></li><li>    <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">x509CRL</span>: cert.<span class="hljs-property">X509CRL</span> = {} <span class="hljs-keyword">as</span> cert.<span class="hljs-property">X509CRL</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    x509CRL = <span class="hljs-keyword">await</span> cert.<span class="hljs-title function_">createX509CRL</span>(encodingBlob);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createX509CRL failed, errCode: <span class="hljs-subst">${e.code}</span>, errMsg: <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> x509CRL;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createX509Cert</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;cert.<span class="hljs-property">X509Cert</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> certData = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>    <span class="hljs-string">'MIIBHTCBwwICA+gwCgYIKoZIzj0EAwIwGjEYMBYGA1UEAwwPRXhhbXBsZSBSb290\n'</span> +</li><li>    <span class="hljs-string">'IENBMB4XDTIzMDkwNTAyNDgyMloXDTI2MDUzMTAyNDgyMlowGjEYMBYGA1UEAwwP\n'</span> +</li><li>    <span class="hljs-string">'RXhhbXBsZSBSb290IENBMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHjG74yMI\n'</span> +</li><li>    <span class="hljs-string">'ueO7z3T+dyuEIrhxTg2fqgeNB3SGfsIXlsiUfLTatUsU0i/sePnrKglj2H8Abbx9\n'</span> +</li><li>    <span class="hljs-string">'PK0tsW/VgqwDIDAKBggqhkjOPQQDAgNJADBGAiEApVZno/Z7WyDc/muRN1y57uaY\n'</span> +</li><li>    <span class="hljs-string">'Mjrgnvp/AMdE8qmFiDwCIQCrIYdHVO1awaPgcdALZY+uLQi6mEs/oMJLUcmaag3E\n'</span> +</li><li>    <span class="hljs-string">'Qw==\n'</span> +</li><li>    <span class="hljs-string">'-----END CERTIFICATE-----\n'</span>;</li><li>
</li><li>  <span class="hljs-keyword">let</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">encodingBlob</span>: cert.<span class="hljs-property">EncodingBlob</span> = {</li><li>    <span class="hljs-attr">data</span>: textEncoder.<span class="hljs-title function_">encodeInto</span>(certData),</li><li>    <span class="hljs-comment">// 根据encodingData的格式进行赋值，支持FORMAT_PEM和FORMAT_DER。</span></li><li>    <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">x509Cert</span>: cert.<span class="hljs-property">X509Cert</span> = {} <span class="hljs-keyword">as</span> cert.<span class="hljs-property">X509Cert</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    x509Cert = <span class="hljs-keyword">await</span> cert.<span class="hljs-title function_">createX509Cert</span>(encodingBlob);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`createX509Cert failed, errCode: <span class="hljs-subst">${e.code}</span>, errMsg: <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> x509Cert;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sample</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> x509Cert = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createX509Cert</span>();</li><li>  <span class="hljs-keyword">const</span> x509CRL = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createX509CRL</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">collection</span>: cert.<span class="hljs-property">CertCRLCollection</span> = {} <span class="hljs-keyword">as</span> cert.<span class="hljs-property">CertCRLCollection</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    collection = cert.<span class="hljs-title function_">createCertCRLCollection</span>([x509Cert], [x509CRL]);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'createCertCRLCollection success'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createCertCRLCollection failed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">certParam</span>: cert.<span class="hljs-property">X509CertMatchParameters</span> = {</li><li>    <span class="hljs-attr">validDate</span>: <span class="hljs-string">'231128000000Z'</span></li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">certs</span>: cert.<span class="hljs-property">X509Cert</span>[] = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">selectCerts</span>(certParam);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'selectCerts failed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">crlParam</span>: cert.<span class="hljs-property">X509CRLMatchParameters</span> = {</li><li>    <span class="hljs-attr">x509Cert</span>: x509Cert</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">crls</span>: cert.<span class="hljs-property">X509CRL</span>[] = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">selectCRLs</span>(crlParam);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'selectCRLs success'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'selectCRLs failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="section" id="section1662469390083108">         </div>   </div>   <div></div></div>