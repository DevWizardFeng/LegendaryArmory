<h1 _ngcontent-hek-c119="" class="doc-title ng-star-inserted" title="识别平面语义"> 识别平面语义 </h1>

<div _ngcontent-hek-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section192991531237">概要<i class="anchor-icon anchor-icon-link" anchorid="section192991531237" tips="复制节点链接"></i></h2>          <p>从5.1.0(18)开始，AR Engine支持识别平面语义能力。</p>     <p>对于检测到的平面，开发者可以通过AR Engine识别该平面的语义，语义类型包括墙面、地面、座椅、桌面、天花板、门、窗户、床、平面空间、立方体体积、立方体空间容积和未知类型（平面空间、立方体体积和立方体空间容积仅在高精几何重建模式下支持）。</p>    </div>    <div class="tiledSection">     <h2 id="section57212150139">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section57212150139" tips="复制节点链接"></i></h2>          <p>获取平面语义信息可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section3392194311417" target="_blank">ARPlane</a>平面对象获取，以下接口为平面相关接口。详细接口和说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-arkts-api" target="_blank">AR Engine API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="49.94%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50.06%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section14241133116264" target="_blank">ARTrackable.getPose</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取追踪目标的位姿信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section10878141483010" target="_blank">ARTrackable.getAnchors</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取绑定到输入可跟踪对象的锚点对象。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section5278038164917" target="_blank">ARPose.getMatrix</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>将位姿数据转换为一个4x4的矩阵。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section12949442354" target="_blank">ARPlane.getPolygonXZ</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取检测到的平面2D顶点数组。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section1127511467514" target="_blank">ARPlane.getSubsumedBy</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>获取平面的父平面（当平面与另一个平面合并时会生成父平面）。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section102761471453" target="_blank">ARPlane.isPoseInExtents</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>检查给定位姿是否在平面的边界矩形内。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.94%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section1471811920162" target="_blank">ARPlane.isPoseInPolygon</a></p></td>         <td class="cellrowborder" valign="top" width="50.06%">          <p>检查给定位姿是否在平面的边界多边形内。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section338844212367">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section338844212367" tips="复制节点链接"></i></h2>          <p>AR Engine仅输出识别到的平面数据。为便于用户观察，开发者可使用AGP（Ark Graphics Platform）渲染引擎或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>绘制识别的平面。关于AGP的介绍可以查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkgraphics3d-overview" target="_blank">ArkGraphics 3D简介</a>和<a href="https://gitcode.com/openharmony/graphic_graphic_3d" target="_blank">AGP引擎</a>。</p>     <p>对于使用ArkTS的任何AR应用，首先需要创建一个AR会话<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section12681656121519" target="_blank">ARViewContext</a>，用于管理AR Engine的系统状态。AR会话<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section12681656121519" target="_blank">ARViewContext</a>的创建可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arsession">管理AR会话</a>章节。</p>     <p>识别平面语义之前需要先检测识别环境中的平面，如何检测识别环境中的平面请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-get-plane">检测环境中的平面</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section66461933183216" class="firsth2">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section66461933183216" tips="复制节点链接"></i></h3>          <p>识别平面语义能力所需要导入的模块如下：</p>     <div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { arEngine, <span class="hljs-title class_">ARView</span>, arViewController } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AREngine'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Node</span>, <span class="hljs-title class_">Scene</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics3D'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section57509123317">定义变量<i class="anchor-icon anchor-icon-link" anchorid="section57509123317" tips="复制节点链接"></i></h3>          <p>定义变量planeLabel接收平面类型标签信息。</p>     <div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">planeLabel</span>: arEngine.<span class="hljs-property">ARSemanticPlaneLabel</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1867811585405">显示平面语义信息<i class="anchor-icon anchor-icon-link" anchorid="section1867811585405" tips="复制节点链接"></i></h3>          <p>首先初始化AR会话和AR场景，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arsession#section3391814131611">初始化AR会话和AR场景</a>章节。</p>     <p>更改semanticMode为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arengine#section19325205718138" target="_blank">ARSemanticMode</a>.PLANE，启用平面语义识别能力。</p>     <div class="p">      在设备界面上显示识别到平面的信息，使用重复调用函数方法在设备界面上实时更新识别到的平面语义信息。      <div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ARTargetBuilder</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-title class_">ARTarget</span>();</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ARTarget</span> {</li><li>  <span class="hljs-meta">@State</span> arContext?: arViewController.<span class="hljs-property">ARViewContext</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-comment">// 平面类型</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">targetPlaneLabel</span>: arEngine.<span class="hljs-property">ARSemanticPlaneLabel</span> = planeLabel;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">intervalId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-comment">// 重复调用函数时间间隔为33ms，即设定为30fps</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">delayInterval</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">33</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">RelativeContainer</span>() {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span>) {</li><li>          <span class="hljs-title class_">ARView</span>({ <span class="hljs-attr">context</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span> })</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">alignRules</span>({</li><li>              <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>              <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>            })</li><li>
</li><li>          <span class="hljs-comment">// 在屏幕底部显示识别的平面信息</span></li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Label: <span class="hljs-subst">${convertSemanticLabel(<span class="hljs-variable language_">this</span>.targetPlaneLabel)}</span>`</span>)</li><li>              .<span class="hljs-title function_">infoStyles</span>()</li><li>          }</li><li>          .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> })</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">bottom</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Bottom</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">"__container__"</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>        }</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initARView</span>();</li><li>      <span class="hljs-comment">// 设定在30fps下更新识别平面语义信息</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalId</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetPlaneLabel</span> = planeLabel;</li><li>      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">delayInterval</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onWillDisappear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// 退出setInterval函数</span></li><li>      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalId</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">onShown</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resumeARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">onHidden</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pauseARView</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideBackButton</span>(<span class="hljs-literal">true</span>)</li><li>    .<span class="hljs-title function_">hideToolBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initARView</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">Scene</span>.<span class="hljs-title function_">load</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">scene</span>: <span class="hljs-title class_">Scene</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">viewContext</span>: arViewController.<span class="hljs-property">ARViewContext</span> = <span class="hljs-keyword">new</span> arViewController.<span class="hljs-title class_">ARViewContext</span>();</li><li>      viewContext.<span class="hljs-property">scene</span> = scene;</li><li>      viewContext.<span class="hljs-property">callback</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ARViewCallbackImpl</span>();</li><li>      viewContext.<span class="hljs-property">config</span> = {</li><li>        <span class="hljs-attr">type</span>: arEngine.<span class="hljs-property">ARType</span>.<span class="hljs-property">WORLD</span>,</li><li>        <span class="hljs-attr">planeFindingMode</span>: arEngine.<span class="hljs-property">ARPlaneFindingMode</span>.<span class="hljs-property">HORIZONTAL_AND_VERTICAL</span>,</li><li>        <span class="hljs-attr">powerMode</span>: arEngine.<span class="hljs-property">ARPowerMode</span>.<span class="hljs-property">NORMAL</span>,</li><li>        <span class="hljs-attr">semanticMode</span>: arEngine.<span class="hljs-property">ARSemanticMode</span>.<span class="hljs-property">PLANE</span>, <span class="hljs-comment">// 识别平面语义</span></li><li>        <span class="hljs-attr">poseMode</span>: arEngine.<span class="hljs-property">ARPoseMode</span>.<span class="hljs-property">GRAVITY</span>,</li><li>        <span class="hljs-attr">depthMode</span>: arEngine.<span class="hljs-property">ARDepthMode</span>.<span class="hljs-property">AUTOMATIC</span>,</li><li>        <span class="hljs-attr">meshMode</span>: arEngine.<span class="hljs-property">ARMeshMode</span>.<span class="hljs-property">DISABLED</span>,</li><li>        <span class="hljs-attr">focusMode</span>: arEngine.<span class="hljs-property">ARFocusMode</span>.<span class="hljs-property">AUTO</span></li><li>      }</li><li>      viewContext.<span class="hljs-title function_">init</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arContext</span> = viewContext;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in initializing ARView.'</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to init ARView. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">stopARView</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">resumeARView</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">pauseARView</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 界面显示文本样式</span></li><li><span class="hljs-meta">@Extend</span>(<span class="hljs-title class_">Text</span>)</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">infoStyles</span>(<span class="hljs-params"></span>) {</li><li>  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)</li><li>  .<span class="hljs-title function_">textShadow</span>({</li><li>    <span class="hljs-attr">radius</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>,</li><li>    <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">offsetY</span>: <span class="hljs-number">0</span></li><li>  })</li><li>  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Start</span>)</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section19909586452">获取语义信息<i class="anchor-icon anchor-icon-link" anchorid="section19909586452" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section9396615174614" target="_blank">ARViewCallback</a>，使用其中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-api-arviewcontroller#section52341758194715" target="_blank">onFrameUpdate</a>方法进行帧数据更新，在设备界面上显示识别到的平面类型。</p>     <p>增加获取语义信息的方法plane.label，获取每一帧识别到的平面语义信息。</p>     <div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ARViewCallbackImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">arViewController.ARViewCallback</span> {</li><li>  <span class="hljs-title function_">onAnchorAdd</span>(<span class="hljs-attr">ctx</span>: arViewController.<span class="hljs-property">ARViewContext</span>, <span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span>, <span class="hljs-attr">anchor</span>: arEngine.<span class="hljs-property">ARAnchor</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onAnchorUpdate</span>(<span class="hljs-attr">ctx</span>: arViewController.<span class="hljs-property">ARViewContext</span>, <span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span>, <span class="hljs-attr">anchor</span>: arEngine.<span class="hljs-property">ARAnchor</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onFrameUpdate</span>(<span class="hljs-attr">ctx</span>: arViewController.<span class="hljs-property">ARViewContext</span>, <span class="hljs-attr">sysBootTs</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">session</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">arSession</span>: arEngine.<span class="hljs-property">ARSession</span> = ctx.<span class="hljs-property">session</span>;</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">frame</span>: arEngine.<span class="hljs-property">ARFrame</span> = arSession.<span class="hljs-title function_">getFrame</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">camera</span>: arEngine.<span class="hljs-property">ARCamera</span> = frame.<span class="hljs-title function_">getCamera</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">trackable</span>: arEngine.<span class="hljs-property">ARTrackable</span>[] = [];</li><li>
</li><li>      <span class="hljs-keyword">if</span> (camera.<span class="hljs-property">state</span> === arEngine.<span class="hljs-property">ARTrackingState</span>.<span class="hljs-property">TRACKING</span>) {</li><li>        trackable = arSession.<span class="hljs-title function_">getAllTrackables</span>(arEngine.<span class="hljs-property">ARTrackableType</span>.<span class="hljs-property">PLANE</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in getting tracking plane, length is: <span class="hljs-subst">${trackable.length}</span>`</span>);</li><li>      }</li><li>
</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; trackable.<span class="hljs-property">length</span>; ++i) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">plane</span>: arEngine.<span class="hljs-property">ARPlane</span> = trackable[i] <span class="hljs-keyword">as</span> arEngine.<span class="hljs-property">ARPlane</span>;</li><li>
</li><li>        <span class="hljs-comment">// 更新识别的平面语义信息</span></li><li>        planeLabel = plane.<span class="hljs-property">label</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in updating frame data for loop: <span class="hljs-subst">${plane.label}</span>`</span>);</li><li>      }</li><li>
</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to update data. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section121547101491">识别平面语义的自定义方法<i class="anchor-icon anchor-icon-link" anchorid="section121547101491" tips="复制节点链接"></i></h3>          <p>自定义方法获取顶点数据getVertices、创建索引generateMeshIndex、创建mesh数据generateMeshInput，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-get-plane#section142331216260">检测平面的自定义方法</a>。</p>     <p>arrayBufferFloat32ToNumber可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-arraybuffer-info">数据类型转换说明</a>。</p>     <p>平面语义标签转换convertSemanticLabel可参考如下。</p>     <div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertSemanticLabel</span>(<span class="hljs-params">obj: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">res</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">0</span>) {</li><li>    res = <span class="hljs-string">'UNKNOWN'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">1</span>) {</li><li>    res = <span class="hljs-string">'WALL'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">2</span>) {</li><li>    res = <span class="hljs-string">'FLOOR'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">3</span>) {</li><li>    res = <span class="hljs-string">'SEAT'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">4</span>) {</li><li>    res = <span class="hljs-string">'TABLE'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">5</span>) {</li><li>    res = <span class="hljs-string">'CEILING'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">6</span>) {</li><li>    res = <span class="hljs-string">'DOOR'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">7</span>) {</li><li>    res = <span class="hljs-string">'WINDOW'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">8</span>) {</li><li>    res = <span class="hljs-string">'BED'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">9</span>) {</li><li>    res = <span class="hljs-string">'PLANE SPACE'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">10</span>) {</li><li>    res = <span class="hljs-string">'CUBE VOLUME'</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj === <span class="hljs-number">11</span>) {</li><li>    res = <span class="hljs-string">'CUBE SPACE'</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> res;</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>