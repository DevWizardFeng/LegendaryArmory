<h1 _ngcontent-cav-c119="" class="doc-title ng-star-inserted" title="识别本地图片"> 识别本地图片 </h1>

<div _ngcontent-cav-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section16522171851016">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section16522171851016" tips="复制节点链接"></i></h2>          <p>图片识码能力支持对图库中的码图进行扫描识别，并获取信息。</p>    </div>    <div class="tiledSection">     <h2 id="section14187135401418">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section14187135401418" tips="复制节点链接"></i></h2>          <p>图片识码能力支持对图库中的条形码、二维码、MULTIFUNCTIONAL CODE进行识别，并获得码类型、码值、码位置信息。该能力可用于一图单码和一图多码的识别，比如条形码、付款码等。</p>    </div>    <div class="tiledSection">     <h2 id="section52491649171418">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section52491649171418" tips="复制节点链接"></i></h2>          <p><span><img height="317.64390000000003" originheight="823" originwidth="1723" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114423.25282388646249801270686356948104:50001231000000:2800:3D27CE73D47F396CAEEAB2228C8729B981B23D4535FD27B00521E7ABCD382070.png" title="点击放大" width="665"></span></p>     <ol>      <li>用户向开发者的应用发起图片识码请求。</li>      <li>应用通过调用Scan Kit的decode接口启动图片识码。</li>      <li>Scan Kit通过回调返回图片识码结果。</li>      <li>应用向用户返回扫码结果。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1451724123520">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1451724123520" tips="复制节点链接"></i></h2>          <p>接口返回值有两种返回形式：Callback和Promise回调。下表中为启动图片识码Callback和Promise形式接口，Callback和Promise只是返回值方式不一样，功能相同。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-imagedecode" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-imagedecode#section9221156204617" target="_blank">decode</a>(inputImage: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-imagedecode#section2194164873812" target="_blank">InputImage</a>, options?: scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1285191073117" target="_blank">ScanOptions</a>): Promise&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112" target="_blank">ScanResult</a>&gt;&gt;</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>启动图片识码，通过InputImage传入图片信息，通过ScanOptions进行识码参数设置（options为可选参数），使用Promise异步回调返回识码结果。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-imagedecode#section12482559194718" target="_blank">decode</a>(inputImage: InputImage, options: scanBarcode.ScanOptions, callback: AsyncCallback&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>启动图片识码，通过InputImage传入图片信息，通过ScanOptions进行识码参数设置，使用Callback异步回调返回识码结果。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-imagedecode#section17256144317492" target="_blank">decode</a>(inputImage: InputImage, callback: AsyncCallback&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>启动图片识码，通过InputImage传入图片信息，使用Callback异步回调返回识码结果。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section119101215856">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section119101215856" tips="复制节点链接"></i></h2>          <p>图片识码接口支持识别图库中的条形码，二维码以及MULTIFUNCTIONAL CODE，并返回图片中码图的值，类型以及码的位置信息（码图最小外接矩形左上角和右下角的坐标）。</p>     <p>为了方便开发者接入，我们提供了详细的样例工程供参考，推荐参考<a href="https://gitcode.com/HarmonyOS_Samples/scan-kit_-sample-code_-clientdemo_-arkts" target="_blank">示例工程</a>接入。</p>     <p>以下示例为调用图片识码的detectBarcode.decode接口获取码图信息。</p>     <ol>      <li>导入图片识码接口和相关接口模块，该接口提供了图片识码参数和方法，导入方法如下。       <div _ngcontent-cav-c106="" class="highlight-div"><div _ngcontent-cav-c106="" class="highlight-div-header"><div _ngcontent-cav-c106="" class="highlight-div-header-left"><div _ngcontent-cav-c106="" class="handle-button expand-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cav-c106="" class="highlight-div-header-right"><div _ngcontent-cav-c106="" class="handle-button ai-button"></div><div _ngcontent-cav-c106="" class="handle-button line-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cav-c106="" class="handle-button theme-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cav-c106="" class="handle-button copy-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cav-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入图片识码需要的日志和picker模块</span></li><li><span class="hljs-keyword">import</span> { scanCore, scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>调用detectBarcode.decode接口解析码图。       <ul>        <li>通过Promise回调函数得到扫码结果，InputImage对象中uri参数推荐通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker" target="_blank">picker</a>方式获取。         <div _ngcontent-cav-c106="" class="highlight-div"><div _ngcontent-cav-c106="" class="highlight-div-header"><div _ngcontent-cav-c106="" class="highlight-div-header-left"><div _ngcontent-cav-c106="" class="handle-button expand-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cav-c106="" class="highlight-div-header-right"><div _ngcontent-cav-c106="" class="handle-button ai-button"></div><div _ngcontent-cav-c106="" class="handle-button line-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cav-c106="" class="handle-button theme-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cav-c106="" class="handle-button copy-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cav-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DetectPage</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Promise with options'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'sys.color.comp_background_list_card'</span>))</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>)</li><li>        .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">5</span> })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 定义识码参数options</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = {</li><li>            <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>],</li><li>            <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>,</li><li>          }</li><li>          <span class="hljs-comment">// 通过picker拉起图库的图片</span></li><li>          <span class="hljs-keyword">let</span> photoOption = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>          photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>          photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li>          <span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>          photoPicker.<span class="hljs-title function_">select</span>(photoOption).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 定义识码参数inputImage，其中uri为picker选择图片</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: result.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>] };</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-comment">// 调用图片识码接口</span></li><li>              detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                  <span class="hljs-string">`Succeeded in getting ScanResult by promise with options, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                  <span class="hljs-string">`Failed to get ScanResult by promise with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              });</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Failed to detectBarcode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            }</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to select a photo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          })</li><li>        });</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>        <li>通过Callback回调函数得到扫码结果，InputImage对象中uri参数推荐通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker" target="_blank">picker</a>方式获取。         <div _ngcontent-cav-c106="" class="highlight-div"><div _ngcontent-cav-c106="" class="highlight-div-header"><div _ngcontent-cav-c106="" class="highlight-div-header-left"><div _ngcontent-cav-c106="" class="handle-button expand-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cav-c106="" class="highlight-div-header-right"><div _ngcontent-cav-c106="" class="handle-button ai-button"></div><div _ngcontent-cav-c106="" class="handle-button line-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cav-c106="" class="handle-button theme-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cav-c106="" class="handle-button copy-button"><div _ngcontent-cav-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cav-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DetectPage</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Callback with options'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'sys.color.comp_background_list_card'</span>))</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>)</li><li>        .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">5</span> })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 定义识码参数options</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = {</li><li>            <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>],</li><li>            <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>,</li><li>            <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span></li><li>          }</li><li>          <span class="hljs-comment">// 通过选择模式拉起photoPicker界面，用户可以选择一个图片</span></li><li>          <span class="hljs-keyword">let</span> photoOption = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>          photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>          photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li>          <span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>          photoPicker.<span class="hljs-title function_">select</span>(photoOption).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// 定义识码参数inputImage，其中uri为picker选择图片</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: result.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>] };</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-comment">// 调用图片识码接口</span></li><li>              detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, options,</li><li>                <span class="hljs-function">(<span class="hljs-params">error: BusinessError, result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>                  <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span>) {</li><li>                    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                      <span class="hljs-string">`Failed to get ScanResult by callback with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>                    <span class="hljs-keyword">return</span>;</li><li>                  }</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                    <span class="hljs-string">`Succeeded in getting ScanResult by callback with options, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>                });</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Failed to detectBarcode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            }</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to select a photo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          })</li><li>        });</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section8793479155">模拟器开发<i class="anchor-icon anchor-icon-link" anchorid="section8793479155" tips="复制节点链接"></i></h2>          <p>支持模拟器开发，使用指导请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-emulator" target="_blank">使用模拟器运行应用</a>。</p>    </div>   </div>   <div></div></div>