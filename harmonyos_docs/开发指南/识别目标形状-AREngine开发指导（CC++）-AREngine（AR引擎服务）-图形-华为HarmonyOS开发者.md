<h1 _ngcontent-lix-c119="" class="doc-title ng-star-inserted" title="识别目标形状"> 识别目标形状 </h1>

<div _ngcontent-lix-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section428443019561">概要<i class="anchor-icon anchor-icon-link" anchorid="section428443019561" tips="复制节点链接"></i></h2>          <p>从5.0.0(12)开始，AR Engine支持识别目标形状的能力。</p>     <p>本章节介绍如何对目标物体进行形状识别，可识别的形状包括矩形和圆形。</p>    </div>    <div class="tiledSection">     <h2 id="section0222145391119">引入AR Engine<i class="anchor-icon anchor-icon-link" anchorid="section0222145391119" tips="复制节点链接"></i></h2>          <p>开发者可参考管理AR会话章节的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arengine-c-arsession#section1410827131110">引入AR Engine</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section416624191615">创建AR会话<i class="anchor-icon anchor-icon-link" anchorid="section416624191615" tips="复制节点链接"></i></h2>          <p>创建AR会话并配置为目标形状识别模式。</p>     <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARSession *arSession = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Create</span>(<span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;arSession);</li><li>AREngine_ARConfig *arConfig = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-comment">// 创建AR会话配置器。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_Create</span>(arSession, &amp;arConfig);</li><li><span class="hljs-comment">// 设置语义识别模式为目标形状识别。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARConfig_SetSemanticMode</span>(arSession, arConfig, ARENGINE_SEMANTIC_MODE_TARGET);</li><li><span class="hljs-comment">// 配置器设置给AR会话。</span></li><li><span class="hljs-built_in">HMS_AREngine_ARSession_Configure</span>(arSession, arConfig);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1846616259515">创建可跟踪对象列表<i class="anchor-icon anchor-icon-link" anchorid="section1846616259515" tips="复制节点链接"></i></h2>          <p>创建一个可跟踪对象列表targetList，用于存放AR Engine运行过程中检测到的所有可跟踪对象。</p>     <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackableList *targetList = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_Create</span>(arSession, &amp;targetList);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section10755131611511">获取当前环境中的可跟踪对象<i class="anchor-icon anchor-icon-link" anchorid="section10755131611511" tips="复制节点链接"></i></h2>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gac5b39338f95317671d8de6d4f409cf9c" target="_blank">HMS_AREngine_ARSession_GetAllTrackables</a>函数，检测当前环境中的所有可跟踪对象，并将结果存放在targetList中。</p>     <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_AREngine_ARSession_GetAllTrackables</span>(arSession, ARENGINE_TRACKABLE_TARGET, targetList);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1979116910614">获取可跟踪对象数量<i class="anchor-icon anchor-icon-link" anchorid="section1979116910614" tips="复制节点链接"></i></h2>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gad9729d4436f3d969286f31b33d07513e" target="_blank">HMS_AREngine_ARTrackableList_GetSize</a>函数获取当前可跟踪对象数量，结果存放在targetSize中。</p>     <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> targetSize = <span class="hljs-number">0</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_GetSize</span>(arSession, targetList, &amp;targetSize);</li></ol></pre></div></div>    </div>    <p>当targetSize等于0时，代表当前环境中无可跟踪对象。</p>    <p>当targetSize等于1时，代表当前环境中仅存在1个可跟踪对象。</p>    <p>当targetSize大于1时，代表当前环境中存在多个可跟踪对象。</p>    <div class="tiledSection">     <h2 id="section12103135965">遍历并识别物体形状<i class="anchor-icon anchor-icon-link" anchorid="section12103135965" tips="复制节点链接"></i></h2>          <ol>      <li>当环境中存在一个或多个可跟踪对象时，依次遍历targetList中所有可跟踪对象进行目标形状识别。       <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; targetSize; ++i) {</li><li>    <span class="hljs-comment">// 遍历可跟踪对象，进行形状识别。</span></li><li>}</li></ol></pre></div></div></li>      <li>对于第i个对象，创建并获取对象实例。       <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackable *target = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_AcquireItem</span>(arSession, targetList, i, &amp;target);</li></ol></pre></div></div></li>      <li>获取该实例跟踪状态，当且仅当其跟踪状态为ARENGINE_TRACKING_STATE_TRACKING时，才可进行形状识别。       <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AREngine_ARTrackingState outTrackingState;</li><li><span class="hljs-built_in">HMS_AREngine_ARTrackable_GetTrackingState</span>(arSession, target, &amp;outTrackingState);</li><li>
</li><li><span class="hljs-keyword">if</span> (AREngine_ARTrackingState::ARENGINE_TRACKING_STATE_TRACKING != outTrackingState) {</li><li>    <span class="hljs-keyword">continue</span>;</li><li>}</li></ol></pre></div></div></li>      <li>获取该实例目标形状，识别结果存放在label中。       <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">AREngine_ARTargetShapeLabel</span> <span class="hljs-variable">label</span> = <span class="hljs-variable">ARENGINE_TARGET_SHAPE_UNKNOWN</span>;</li><li><span class="hljs-title function_">HMS_AREngine_ARTarget_GetShapeType</span>(<span class="hljs-variable">arSession</span>, <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">AREngine_ARTarget</span> *&gt;(<span class="hljs-variable">target</span>), &amp;<span class="hljs-title class_">label</span>);</li></ol></pre></div></div>       <p>其中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arengine-capi-arengine#gaed68dc13cc314da98d79c88b12d3ae49" target="_blank">AREngine_ARTargetShapeLabel</a>为枚举类型，描述了目标物体形状。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section131820272071">销毁可跟踪对象列表<i class="anchor-icon anchor-icon-link" anchorid="section131820272071" tips="复制节点链接"></i></h2>          <div _ngcontent-lix-c106="" class="highlight-div"><div _ngcontent-lix-c106="" class="highlight-div-header"><div _ngcontent-lix-c106="" class="highlight-div-header-left"><div _ngcontent-lix-c106="" class="handle-button expand-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lix-c106="" class="highlight-div-header-right"><div _ngcontent-lix-c106="" class="handle-button ai-button"></div><div _ngcontent-lix-c106="" class="handle-button line-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lix-c106="" class="handle-button theme-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lix-c106="" class="handle-button copy-button"><div _ngcontent-lix-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lix-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">HMS_AREngine_ARTrackableList_Destroy</span>(targetList);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>