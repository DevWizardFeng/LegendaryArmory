<h1 _ngcontent-dal-c119="" class="doc-title ng-star-inserted" title="请求UI绘制帧率"> 请求UI绘制帧率 </h1>

<div _ngcontent-dal-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>如果开发者需要以独立的帧率绘制更新操作UI界面时，可以通过DisplaySync来实现。应用中绘制内容的帧率可以使用DisplaySync实例来控制，具体请查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-displaysync" target="_blank">@ohos.graphics.displaySync(可变帧率)</a>。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>此处以不同帧率改变文件组件字体大小为例，来模拟不同UI绘制帧率的效果。</p>     <ol>      <li>       <p>导入模块。</p>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { displaySync } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li></ol></pre></div></div></li>      <li>       <p>定义和构建DisplaySync对象。</p>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 定义两个DisplaySync变量，未初始化</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">backDisplaySyncSlow</span>: displaySync.<span class="hljs-property">DisplaySync</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">backDisplaySyncFast</span>: displaySync.<span class="hljs-property">DisplaySync</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>定义两个文本组件。</p>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@State</span> <span class="hljs-attr">drawFirstSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">drawSecondSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li><span class="hljs-meta">@Builder</span> <span class="hljs-title function_">doSomeRenderFirst</span>(<span class="hljs-params"></span>) {</li><li> <span class="hljs-title class_">Text</span>(<span class="hljs-string">'30'</span>)</li><li>   .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span> <span class="hljs-title function_">doSomeRenderSecond</span>(<span class="hljs-params"></span>) {</li><li> <span class="hljs-title class_">Text</span>(<span class="hljs-string">'60'</span>)</li><li>   .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span>)</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过DisplaySync实例设置帧率和注册订阅函数。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>订阅函数运行于UI主线程，故涉及UI线程的耗时操作不应运行于订阅函数中，以免影响性能。</p>        </div></div></div>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">CreateDisplaySyncSlow</span>() {</li><li>    <span class="hljs-keyword">let</span> range : <span class="hljs-title class_">ExpectedFrameRateRange</span> = { <span class="hljs-comment">// 创建和配置帧率参数</span></li><li>      <span class="hljs-attr">expected</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 设置期望绘制帧率为30hz</span></li><li>      <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 配置帧率范围</span></li><li>      <span class="hljs-attr">max</span>: <span class="hljs-number">120</span> <span class="hljs-comment">// 配置帧率范围</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">draw30</span> = (<span class="hljs-params">intervalInfo: displaySync.IntervalInfo</span>) =&gt; { <span class="hljs-comment">// 订阅回调函数，字体大小在25到150之间变化</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> += <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> &gt; <span class="hljs-number">150</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span> = <span class="hljs-literal">false</span>;</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> -= <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> &lt; <span class="hljs-number">25</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span> = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }</li><li>    };</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> = displaySync.<span class="hljs-title function_">create</span>(); <span class="hljs-comment">// 创建DisplaySync实例</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">setExpectedFrameRateRange</span>(range); <span class="hljs-comment">// 设置帧率</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"frame"</span>, draw30); <span class="hljs-comment">// 订阅frame事件和注册订阅函数</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>开始每帧回调。</p>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start'</span>)</li><li>  .<span class="hljs-title function_">id</span>(<span class="hljs-string">'CustomDrawStart'</span>)</li><li>  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">5</span> })</li><li>  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>  .<span class="hljs-title function_">onClick</span>((): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> == <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CreateDisplaySyncSlow</span>();</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span> == <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CreateDisplaySyncFast</span>();</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">start</span>();</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">start</span>();</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>    .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_LG</span>)</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>创建的DisplaySync实例在start使能后需要aboutToDisappear函数中进行stop操作并置空，避免内存泄漏问题。</p>        </div></div></div>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">stop</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> = <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">stop</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span> = <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>结束每帧回调。</p>       <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'Stop'</span>)</li><li>  .<span class="hljs-title function_">id</span>(<span class="hljs-string">'CustomDrawStop'</span>)</li><li>  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">5</span> })</li><li>  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>  .<span class="hljs-title function_">onClick</span>((): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">stop</span>();</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">stop</span>();</li><li>    }</li><li>  })</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>  .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_LG</span>)</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <div _ngcontent-dal-c106="" class="highlight-div"><div _ngcontent-dal-c106="" class="highlight-div-header"><div _ngcontent-dal-c106="" class="highlight-div-header-left"><div _ngcontent-dal-c106="" class="handle-button expand-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dal-c106="" class="highlight-div-header-right"><div _ngcontent-dal-c106="" class="handle-button ai-button"></div><div _ngcontent-dal-c106="" class="handle-button line-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dal-c106="" class="handle-button theme-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dal-c106="" class="handle-button copy-button"><div _ngcontent-dal-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dal-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { displaySync } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">drawFirstSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">drawSecondSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">backDisplaySyncSlow</span>: displaySync.<span class="hljs-property">DisplaySync</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">backDisplaySyncFast</span>: displaySync.<span class="hljs-property">DisplaySync</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isBigger_30</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isBigger_60</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>
</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title function_">doSomeRenderFirst</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'30'</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title function_">doSomeRenderSecond</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'60'</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">CreateDisplaySyncSlow</span>() {</li><li>    <span class="hljs-comment">// 定义期望绘制帧率</span></li><li>    <span class="hljs-keyword">let</span> range : <span class="hljs-title class_">ExpectedFrameRateRange</span> = {</li><li>      <span class="hljs-attr">expected</span>: <span class="hljs-number">30</span>,</li><li>      <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">max</span>: <span class="hljs-number">120</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">draw30</span> = (<span class="hljs-params">intervalInfo: displaySync.IntervalInfo</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> += <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> &gt; <span class="hljs-number">150</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span> = <span class="hljs-literal">false</span>;</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> -= <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawFirstSize</span> &lt; <span class="hljs-number">25</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_30</span> = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }</li><li>    };</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> = displaySync.<span class="hljs-title function_">create</span>(); <span class="hljs-comment">// 创建DisplaySync实例</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">setExpectedFrameRateRange</span>(range); <span class="hljs-comment">// 设置帧率</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"frame"</span>, draw30); <span class="hljs-comment">// 订阅frame事件和注册订阅函数</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title class_">CreateDisplaySyncFast</span>() {</li><li>    <span class="hljs-comment">// 定义期望绘制帧率</span></li><li>    <span class="hljs-keyword">let</span> range : <span class="hljs-title class_">ExpectedFrameRateRange</span> = {</li><li>      <span class="hljs-attr">expected</span>: <span class="hljs-number">60</span>,</li><li>      <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">max</span>: <span class="hljs-number">120</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-title function_">draw60</span> = (<span class="hljs-params">intervalInfo: displaySync.IntervalInfo</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_60</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span> += <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span> &gt; <span class="hljs-number">150</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_60</span> = <span class="hljs-literal">false</span>;</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span> -= <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawSecondSize</span> &lt; <span class="hljs-number">25</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBigger_60</span> = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }</li><li>
</li><li>    };</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>= displaySync.<span class="hljs-title function_">create</span>(); <span class="hljs-comment">// 创建DisplaySync实例</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">setExpectedFrameRateRange</span>(range); <span class="hljs-comment">// 设置帧率</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"frame"</span>, draw60); <span class="hljs-comment">// 订阅frame事件和注册订阅函数</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// DisplaySync失能关闭</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 实例置空</span></li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// DisplaySync失能关闭</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 实例置空</span></li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doSomeRenderFirst</span>();</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doSomeRenderSecond</span>();</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start'</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'CustomDrawStart'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">500</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">5</span> })</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">onClick</span>((): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span> == <span class="hljs-literal">undefined</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CreateDisplaySyncSlow</span>();</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span> == <span class="hljs-literal">undefined</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CreateDisplaySyncFast</span>();</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// DisplaySync使能开启</span></li><li>            }</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// DisplaySync使能开启</span></li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_LG</span>)</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Stop'</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'CustomDrawStop'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">500</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">5</span> })</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">onClick</span>((): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncSlow</span>.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// DisplaySync失能关闭</span></li><li>            }</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">backDisplaySyncFast</span>.<span class="hljs-title function_">stop</span>(); <span class="hljs-comment">// DisplaySync失能关闭</span></li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'20%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_LG</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_SM</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Bottom</span>)</li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>