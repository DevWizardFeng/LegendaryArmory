<h1 _ngcontent-rbu-c119="" class="doc-title ng-star-inserted" title="请求用户授权"> 请求用户授权 </h1>

<div _ngcontent-rbu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为保护用户隐私，Wear Engine的API需要用户授权才可以正常访问。建议开发者在用户首次调用Wear Engine开放能力的时候执行本章节操作。</p>    <div class="tiledSection">     <h2 id="section7157142771512">申请用户穿戴设备权限<i class="anchor-icon anchor-icon-link" anchorid="section7157142771512" tips="复制节点链接"></i></h2>          <p>应用拉起华为账号登录和授权界面，由用户授权相应的数据访问权限。用户可以自主选择授权的数据类型，可以只授权部分数据权限。</p>     <p></p>     <p><br><span><img height="464.299409" originheight="773" originwidth="372" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115105.23686063276125396006620964786142:50001231000000:2800:3C4A2D7E183CE27243EE8219C5AE62839E993C1981C9FC68A3C7AD4E82A45D63.png" title="点击放大" width="223.44"></span><br></p>     <ol>      <li><span>应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">wearEngine</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section17606835182712" target="_blank">getAuthClient</a>方法，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section876918413377" target="_blank">AuthClient</a>对象。</span></li>      <li><span>定义需要用户授权的权限请求类<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section12513135291215" target="_blank">AuthorizationRequest</a>。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section172541457203810" target="_blank">requestAuthorization</a>方法，向用户请求权限。执行成功后，会弹出授权界面，让用户选择授予权限（若未登录华为账号则会先弹出登录界面）。当用户允许后才能正常使用接口，否则会遇到错误码为201的提示。</span>       <p></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>请确保向用户请求的权限已在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>中审批通过，否则会遇到错误码为1008500004的提示。</li>          <li>该功能可以多次调用，如果申请的权限之前已经授予了，不会再弹出授权页面，接口会返回已经授权的权限。</li>          <li>通过入参的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section12513135291215" target="_blank">AuthorizationRequest</a>对象，获取应用需要的权限。参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply#zh-cn_topic_0000001073008985_li5158124634712">步骤3中权限说明</a>了解应用所需请求的权限类型。</li>          <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section1536013509131" target="_blank">AuthorizationResponse</a>对象，返回用户的授权结果。</li>         </ul>        </div></div></div>       <div _ngcontent-rbu-c106="" class="highlight-div"><div _ngcontent-rbu-c106="" class="highlight-div-header"><div _ngcontent-rbu-c106="" class="highlight-div-header-left"><div _ngcontent-rbu-c106="" class="handle-button expand-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rbu-c106="" class="highlight-div-header-right"><div _ngcontent-rbu-c106="" class="handle-button ai-button"></div><div _ngcontent-rbu-c106="" class="handle-button line-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rbu-c106="" class="handle-button theme-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rbu-c106="" class="handle-button copy-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rbu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在使用Wear Engine服务前，请导入WearEngine与相关模块</span></li><li><span class="hljs-keyword">import</span> { wearEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WearEngine'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 步骤1：获取AuthClient对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">authClient</span>: wearEngine.<span class="hljs-property">AuthClient</span> = wearEngine.<span class="hljs-title function_">getAuthClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>
</li><li><span class="hljs-comment">// 步骤2：基于需要用户授权的权限定义权限请求类</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: wearEngine.<span class="hljs-property">AuthorizationRequest</span> = {</li><li>  <span class="hljs-attr">permissions</span>: [wearEngine.<span class="hljs-property">Permission</span>.<span class="hljs-property">USER_STATUS</span>]</li><li>}</li><li>
</li><li><span class="hljs-comment">// 步骤3：请求用户授权</span></li><li>authClient.<span class="hljs-title function_">requestAuthorization</span>(request).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in requesting authorize, authorized permissions is <span class="hljs-subst">${result.permissions}</span>`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to request authorize. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>})</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section16849549194116">查询用户授权结果<i class="anchor-icon anchor-icon-link" anchorid="section16849549194116" tips="复制节点链接"></i></h2>          <p>用于查询已被用户授予的应用权限。如果所需权限用户未授权，请参见上一节<a href="/consumer/cn/doc/harmonyos-guides/request_user_authorization#section7157142771512">申请用户穿戴设备权限</a>向用户请求权限。建议在请求用户授权前，先使用该接口查询应用是否已有相关权限。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>请确保权限已在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wearengine_apply">申请接入Wear Engine服务</a>中审批通过，否则会遇到错误码为1008500004的提示。</p>      </div></div></div>     <ol>      <li><span>应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api" target="_blank">wearEngine</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section17606835182712" target="_blank">getAuthClient</a>方法，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section876918413377" target="_blank">AuthClient</a>对象。</span></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wearengine_api#section36125238476" target="_blank">getAuthorization</a>方法，查询用户已授权的权限。</span>       <p></p>       <div _ngcontent-rbu-c106="" class="highlight-div"><div _ngcontent-rbu-c106="" class="highlight-div-header"><div _ngcontent-rbu-c106="" class="highlight-div-header-left"><div _ngcontent-rbu-c106="" class="handle-button expand-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rbu-c106="" class="highlight-div-header-right"><div _ngcontent-rbu-c106="" class="handle-button ai-button"></div><div _ngcontent-rbu-c106="" class="handle-button line-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rbu-c106="" class="handle-button theme-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rbu-c106="" class="handle-button copy-button"><div _ngcontent-rbu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rbu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在使用Wear Engine服务前，请导入WearEngine与相关模块</span></li><li><span class="hljs-keyword">import</span> { wearEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WearEngine'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 步骤1：获取AuthClient对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">authClient</span>: wearEngine.<span class="hljs-property">AuthClient</span> = wearEngine.<span class="hljs-title function_">getAuthClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>
</li><li><span class="hljs-comment">// 步骤2：调用API查询已授权权限</span></li><li>authClient.<span class="hljs-title function_">getAuthorization</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in getting authorized permissions, authorized permissions is <span class="hljs-subst">${result.permissions}</span>`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get authorized permissions. Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>})</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>