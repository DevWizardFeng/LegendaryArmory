<h1 _ngcontent-wys-c119="" class="doc-title ng-star-inserted" title="贴片广告"> 贴片广告 </h1>

<div _ngcontent-wys-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section17817731534">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section17817731534" tips="复制节点链接"></i></h2><p>贴片广告是一种在视频播放前、视频播放中或视频播放结束后插入的视频或图片广告。</p> <p><span><img originheight="661" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114636.38111485371154584401477848140124:50001231000000:2800:3581A6256EF42B47C52A453BC8704A98DED4D7FC1EE5C23585B50361400DE58A.png" width="320" height="661"></span>  </p> <p></p> <p></p> </div> <div class="tiledSection"><h2 id="section65401229123616">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section65401229123616" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#loadad" target="_blank">loadAd</a>(adParam: AdRequestParams, adOptions: AdOptions, listener: AdLoadListener): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>请求单广告位广告，通过AdRequestParams、AdOptions进行广告请求参数设置，通过AdLoadListener监听广告请求回调。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-adcomponent" target="_blank">AdComponent</a>({ads: advertising.Advertisement[], displayOptions: advertising.AdDisplayOptions, interactionListener: advertising.AdInteractionListener, @BuilderParam adRenderer?: () =&gt; void, @Prop rollPlayState?: number})</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>展示广告，通过AdDisplayOptions进行广告展示参数设置，通过AdInteractionListener监听广告状态回调。</p> <p><strong>说明：</strong>为了保证广告能正确展示，该接口必须和请求广告接口配套使用。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section231103013613">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section231103013613" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section12553111417488" class="firsth2">请求广告<i class="anchor-icon anchor-icon-link" anchorid="section12553111417488" tips="复制节点链接"></i></h3><ol><li><span>导入相关模块。</span><p></p><div _ngcontent-wys-c106="" class="highlight-div"><div _ngcontent-wys-c106="" class="highlight-div-header"><div _ngcontent-wys-c106="" class="highlight-div-header-left"><div _ngcontent-wys-c106="" class="handle-button expand-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wys-c106="" class="highlight-div-header-right"><div _ngcontent-wys-c106="" class="handle-button ai-button"></div><div _ngcontent-wys-c106="" class="handle-button line-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wys-c106="" class="handle-button theme-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wys-c106="" class="handle-button copy-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, common, <span class="hljs-title class_">PermissionRequestResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { advertising, identifier } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AdsKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>获取OAID。</span><p></p><p>若需提升广告推送精准度，可以在请求参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adrequestparams" target="_blank">AdRequestParams</a>中添加oaid属性。</p> <p>如何获取OAID参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/oaid-service" target="_blank">获取OAID信息</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用以下示例中提供的测试广告位时，必须先获取OAID信息。</p> </div></div></div> <p></p></li><li><span>请求单广告位广告。</span><p></p><p>需要创建一个AdLoader对象，通过AdLoader的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#loadad" target="_blank">loadAd</a>方法请求广告，最后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adloadlistener" target="_blank">AdLoadListener</a>来监听广告的加载状态。</p> <p>在请求贴片广告时，需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adoptions" target="_blank">AdOptions</a>中设置参数：totalDuration。</p> <div class="p">请求广告关键参数如下所示： <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.2.3.2.3.1.1.5.1.1" valign="top" width="17.580000000000002%"><p>请求广告参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.3.2.3.1.1.5.1.2" valign="top" width="10.530000000000001%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.3.2.3.1.1.5.1.3" valign="top" width="9.9%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.3.2.3.1.1.5.1.4" valign="top" width="61.99%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="17.580000000000002%"><p>adType</p> </td> <td class="cellrowborder" valign="top" width="10.530000000000001%"><p>number</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>请求广告类型，贴片广告类型为60。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.580000000000002%"><p>adId</p> </td> <td class="cellrowborder" valign="top" width="10.530000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>是</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>广告位ID。</p> <ul><li>如果仅调测广告，可使用测试广告位ID：testy3cglm3pj0。</li><li>如果要接入正式广告，则需要申请正式的广告位ID。可在应用发布前进入<a href="https://developer.huawei.com/consumer/cn/monetize" target="_blank">流量变现官网</a>，点击“开始变现”，登录<a href="https://developer.huawei.com/consumer/cn/service/ads/publisher/html/index.html?lang=zh" target="_blank">鲸鸿动能媒体服务平台</a>进行申请，具体操作详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/monetize/zhanshiweichuangjian-0000001132700049" target="_blank">展示位创建</a>。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="17.580000000000002%"><p>oaid</p> </td> <td class="cellrowborder" valign="top" width="10.530000000000001%"><p>string</p> </td> <td class="cellrowborder" valign="top" width="9.9%"><p>否</p> </td> <td class="cellrowborder" valign="top" width="61.99%"><p>开放匿名设备标识符，用于精准推送广告。不填无法获取到个性化广告。</p> </td> </tr>  </tbody></table></div> </div> </div> <p>示例代码如下所示：</p> <div _ngcontent-wys-c106="" class="highlight-div"><div _ngcontent-wys-c106="" class="highlight-div-header"><div _ngcontent-wys-c106="" class="highlight-div-header-left"><div _ngcontent-wys-c106="" class="handle-button expand-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wys-c106="" class="highlight-div-header-right"><div _ngcontent-wys-c106="" class="handle-button ai-button"></div><div _ngcontent-wys-c106="" class="handle-button line-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wys-c106="" class="handle-button theme-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wys-c106="" class="handle-button copy-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 请求到的广告内容</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ads</span>: advertising.<span class="hljs-property">Advertisement</span>[] = [];</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 调用loadAd加载广告</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadAd</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadAd</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-comment">// 广告请求回调监听</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adLoadListener</span>: advertising.<span class="hljs-property">AdLoadListener</span> = {</li><li>      <span class="hljs-attr">onAdLoadFailure</span>: <span class="hljs-function">(<span class="hljs-params">errorCode: <span class="hljs-built_in">number</span>, errorMsg: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to load ad. Code is <span class="hljs-subst">${errorCode}</span>, message is <span class="hljs-subst">${errorMsg}</span>`</span>);</li><li>      },</li><li>      <span class="hljs-attr">onAdLoadSuccess</span>: <span class="hljs-function">(<span class="hljs-params">ads: <span class="hljs-built_in">Array</span>&lt;advertising.Advertisement&gt;</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in loading ad'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ads</span> = ads;</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 广告请求参数</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adRequestParams</span>: advertising.<span class="hljs-property">AdRequestParams</span> = {</li><li>      <span class="hljs-comment">// 'testy3cglm3pj0'为测试专用的广告位ID，App正式发布时需要改为正式的广告位ID</span></li><li>      <span class="hljs-attr">adId</span>: <span class="hljs-string">'testy3cglm3pj0'</span>,</li><li>      <span class="hljs-comment">// 贴片广告类型</span></li><li>      <span class="hljs-attr">adType</span>: <span class="hljs-number">60</span>,</li><li>      <span class="hljs-comment">// 用于区分普通在线请求和素材预加载请求 true: 素材预加载请求 false: 普通在线请求</span></li><li>      <span class="hljs-attr">isPreload</span>: <span class="hljs-literal">false</span>,</li><li>      <span class="hljs-comment">// 开放匿名设备标识符</span></li><li>      <span class="hljs-attr">oaid</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestOAID</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>    };</li><li>    <span class="hljs-comment">// 广告配置参数，开发者可根据项目实际情况设置</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adOptions</span>: advertising.<span class="hljs-property">AdOptions</span> = {</li><li>      <span class="hljs-comment">// 设置贴片广告展示时长（贴片广告必填）</span></li><li>      <span class="hljs-attr">totalDuration</span>: <span class="hljs-number">30</span></li><li>    };</li><li>    <span class="hljs-comment">// 创建AdLoader广告对象</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">adLoader</span>: advertising.<span class="hljs-property">AdLoader</span> = <span class="hljs-keyword">new</span> advertising.<span class="hljs-title class_">AdLoader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用广告请求接口</span></li><li>      adLoader.<span class="hljs-title function_">loadAd</span>(adRequestParams, adOptions, adLoadListener);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to load ad. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestOAID</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-comment">// 向用户请求授权广告跨应用关联访问权限</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">isPermissionGranted</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">atManager</span>: abilityAccessCtrl.<span class="hljs-property">AtManager</span> = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">PermissionRequestResult</span> =</li><li>      <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, [<span class="hljs-string">'ohos.permission.APP_TRACKING_CONSENT'</span>]);</li><li>    isPermissionGranted = result.<span class="hljs-property">authResults</span>[<span class="hljs-number">0</span>] === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to request permission. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (isPermissionGranted) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in requesting permission'</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> oaid = <span class="hljs-keyword">await</span> identifier.<span class="hljs-title function_">getOAID</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting OAID'</span>);</li><li>      <span class="hljs-keyword">return</span> oaid;</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get OAID. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to request permission. User rejected'</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section4281165885118">展示广告<i class="anchor-icon anchor-icon-link" anchorid="section4281165885118" tips="复制节点链接"></i></h3><ol><li><span>导入相关模块。</span><p></p><div _ngcontent-wys-c106="" class="highlight-div"><div _ngcontent-wys-c106="" class="highlight-div-header"><div _ngcontent-wys-c106="" class="highlight-div-header-left"><div _ngcontent-wys-c106="" class="handle-button expand-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wys-c106="" class="highlight-div-header-right"><div _ngcontent-wys-c106="" class="handle-button ai-button"></div><div _ngcontent-wys-c106="" class="handle-button line-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wys-c106="" class="handle-button theme-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wys-c106="" class="handle-button copy-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AdComponent</span>, advertising } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AdsKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>展示广告。</span><p></p><p>展示广告通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-advertising#adinteractionlistener" target="_blank">AdInteractionListener</a>监听广告状态回调，涉及的回调状态如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.2.2.2.1.5.1.1" valign="top" width="25%"><p>回调状态</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.2.2.1.5.1.2" valign="top" width="25%"><p>说明</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.2.2.1.5.1.3" valign="top" width="25%"><p>扩展信息</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.2.2.1.5.1.4" valign="top" width="25%"><p>使用建议</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>onAdFail</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告加载失败。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告展示失败时触发，需要将广告组件隐藏，播放正片。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onPortrait</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>全屏状态下点击返回按钮。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>用户在全屏状态下点击返回按钮时触发，需要设置屏幕方向为竖屏，按需显示导航栏、状态栏、底部导航条和设置广告组件宽高。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onLandscape</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>竖屏状态下点击全屏按钮。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>用户在竖屏状态下点击全屏按钮时触发，需要设置屏幕方向为横屏，按需隐藏导航栏、状态栏、底部导航条和设置广告组件宽高。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaProgress</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告播放进度。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长。</li><li>percentage：类型number，单位百分比，广告播放进度。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaStart</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告开始播放。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaPause</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告暂停播放。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaStop</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告停止播放。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaComplete</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告播放完成。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>单个广告播放完成时触发，当所有广告播放完成后，需要将广告组件隐藏，播放正片。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaError</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告播放失败。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>playTime：类型number，单位ms，广告播放时长，-1为异常值。</li><li>errorCode：类型number，错误码ID。</li><li>errorMsg：类型string，错误信息。</li></ul> <p>错误码的详细介绍请参见AVPlayer.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#onerror9" target="_blank">on('error')</a>错误码。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onMediaCountdown</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告倒计时。</p> </td> <td class="cellrowborder" valign="top" width="25%"><ul><li>countdownTime：类型number，单位s，倒计时时长。</li></ul> </td> <td class="cellrowborder" valign="top" width="25%"><p>广告倒计时时触发，需要根据扩展信息的倒计时时长绘制倒计时控件。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>onBackClicked</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>点击返回按钮。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>-</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>用户在非全屏状态下或系统锁定全屏状态下点击返回按钮时触发，需要返回上一页面。</p> </td> </tr>  </tbody></table></div> </div> <p>在您的页面中使用AdComponent组件展示贴片广告。以前贴广告为例，前贴广告播放完成后进入正片播放。</p> <p>示例代码如下所示：</p> <div _ngcontent-wys-c106="" class="highlight-div"><div _ngcontent-wys-c106="" class="highlight-div-header"><div _ngcontent-wys-c106="" class="highlight-div-header-left"><div _ngcontent-wys-c106="" class="handle-button expand-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wys-c106="" class="highlight-div-header-right"><div _ngcontent-wys-c106="" class="handle-button ai-button"></div><div _ngcontent-wys-c106="" class="handle-button line-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wys-c106="" class="handle-button theme-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wys-c106="" class="handle-button copy-button"><div _ngcontent-wys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 请求到的广告内容</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ads</span>: advertising.<span class="hljs-property">Advertisement</span>[] = [];</li><li>  <span class="hljs-comment">// 倒计时文案</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">countDownText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// 贴片广告播放状态</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">rollPlayState</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-comment">// 是否播放正片</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isPlayVideo</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// 视频宽高比</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ratio</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;</li><li>  <span class="hljs-comment">// 广告展示参数，开发者可根据项目实际情况设置</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">adDisplayOptions</span>: advertising.<span class="hljs-property">AdDisplayOptions</span> = {</li><li>    <span class="hljs-comment">// 是否静音</span></li><li>    <span class="hljs-attr">mute</span>: <span class="hljs-literal">true</span></li><li>  };</li><li>  <span class="hljs-comment">// 已经播放的贴片广告数量</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">playedAdSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-comment">// 用于渲染右上角倒计时</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">countDownTxtPlaceholder</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'%d | VIP免广告'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 设置屏幕方向为默认值，开发者可根据项目实际情况修改</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">UNSPECIFIED</span>);</li><li>    <span class="hljs-comment">// 显示导航栏、状态栏、底部导航条，开发者可根据项目实际情况修改</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowSystemBar</span>([<span class="hljs-string">'status'</span>, <span class="hljs-string">'navigation'</span>]);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">TopEnd</span> }) {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">ads</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title class_">AdComponent</span>({</li><li>          <span class="hljs-attr">ads</span>: [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">ads</span>],</li><li>          <span class="hljs-attr">rollPlayState</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">rollPlayState</span>,</li><li>          <span class="hljs-attr">displayOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">adDisplayOptions</span>,</li><li>          <span class="hljs-attr">interactionListener</span>: {</li><li>            <span class="hljs-comment">// 广告状态变化回调</span></li><li>            <span class="hljs-attr">onStatusChanged</span>: <span class="hljs-function">(<span class="hljs-params">status: <span class="hljs-built_in">string</span>, ad: advertising.Advertisement, data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">switch</span> (status) {</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onAdFail'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onAdFail'</span>);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> = <span class="hljs-literal">true</span>;</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onPortrait'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onPortrait'</span>);</li><li>                  <span class="hljs-comment">// 设置屏幕方向为竖屏</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">PORTRAIT</span>);</li><li>                  <span class="hljs-comment">// 显示导航栏、状态栏、底部导航条</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowSystemBar</span>([<span class="hljs-string">'status'</span>, <span class="hljs-string">'navigation'</span>]);</li><li>                  <span class="hljs-comment">// 竖屏时还原宽高比</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">ratio</span> = <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onLandscape'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onLandscape'</span>);</li><li>                  <span class="hljs-comment">// 设置屏幕方向为横屏</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">LANDSCAPE</span>);</li><li>                  <span class="hljs-comment">// 隐藏导航栏、状态栏、底部导航条</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowSystemBar</span>([]);</li><li>                  <span class="hljs-comment">// 横屏时忽略宽高比</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">ratio</span> = -<span class="hljs-number">1</span>;</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaProgress'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaProgress'</span>);</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaStart'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaStart'</span>);</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaPause'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaPause'</span>);</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaStop'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaStop'</span>);</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaComplete'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaComplete'</span>);</li><li>                  <span class="hljs-comment">// 所有广告都播放完毕后，开始播放正片</span></li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">playedAdSize</span>++;</li><li>                  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">playedAdSize</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">ads</span>.<span class="hljs-property">length</span>) {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> = <span class="hljs-literal">true</span>;</li><li>                  }</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaError'</span>:</li><li>                  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaError'</span>);</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onMediaCountdown'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onMediaCountdown'</span>);</li><li>                  <span class="hljs-keyword">const</span> <span class="hljs-attr">parseData</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">safeParseData</span>(data);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownText</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownTxtPlaceholder</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'%d'</span>, <span class="hljs-title class_">String</span>(parseData.<span class="hljs-property">countdownTime</span>));</li><li>                  <span class="hljs-keyword">break</span>;</li><li>                <span class="hljs-keyword">case</span> <span class="hljs-string">'onBackClicked'</span>:</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Status is onBackClicked'</span>);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">back</span>();</li><li>                  <span class="hljs-keyword">break</span>;</li><li>              }</li><li>            }</li><li>          }</li><li>        })</li><li>          .<span class="hljs-title function_">visibility</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> ? <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">None</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownText</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-attr">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span> })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#66000000'</span>)</li><li>          .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">radius</span>: <span class="hljs-number">25</span> })</li><li>          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'OnVipClicked, do something...'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> = <span class="hljs-literal">true</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">visibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownText</span> ? <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">None</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Video</span>({</li><li>        <span class="hljs-comment">// 广告后播放的视频，开发者需根据项目实际情况设置</span></li><li>        <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'videoTest.mp4'</span>),</li><li>        <span class="hljs-comment">// 播放视频的预览图，开发者需根据项目实际情况设置</span></li><li>        <span class="hljs-attr">previewUri</span>: $r(<span class="hljs-string">'app.media.video_preview'</span>),</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoController</span>()</li><li>      })</li><li>        .<span class="hljs-title function_">visibility</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span> ? <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-property">None</span>)</li><li>        .<span class="hljs-title function_">autoPlay</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayVideo</span>)</li><li>        .<span class="hljs-title function_">controls</span>(<span class="hljs-literal">false</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ratio</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setWindowPreferredOrientation</span>(<span class="hljs-attr">orientation</span>: <span class="hljs-title class_">Orientation</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">win</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>      <span class="hljs-keyword">await</span> win.<span class="hljs-title function_">setPreferredOrientation</span>(orientation);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to set preferred orientation. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setWindowSystemBar</span>(<span class="hljs-attr">names</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-string">'status'</span> | <span class="hljs-string">'navigation'</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">win</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>      <span class="hljs-keyword">await</span> win.<span class="hljs-title function_">setWindowSystemBarEnable</span>(names);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to set window system bar. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">safeParseData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">'string'</span>) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to parse data. Code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> {};</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> </div> <div></div></div>