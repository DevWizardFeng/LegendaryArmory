<h1 _ngcontent-lpe-c119="" class="doc-title ng-star-inserted" title="跨设备互通NDK开发指导"> 跨设备互通NDK开发指导 </h1>

<div _ngcontent-lpe-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>跨设备互通提供跨设备的相机、扫描、图库访问能力，TV、平板或2in1设备可以调用手机的相机、扫描、图库等功能。</p>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>您通过此能力实现跨设备交互，可以使用其他设备的相机、扫描和图库功能。</p>    </div>    <div class="tiledSection">     <h2 id="section17575828642">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section17575828642" tips="复制节点链接"></i></h2>          <p>需同时满足以下条件，才能使用该功能：</p>     <ul>      <li><strong>设备限制</strong>       <ul>        <li>本端设备：HarmonyOS版本为HarmonyOS NEXT及以上的TV、平板或2in1设备。</li>        <li>远端设备：HarmonyOS版本为HarmonyOS NEXT及以上、具有相机能力的手机或平板设备。</li>       </ul></li>      <li><strong>使用限制</strong>       <ul>        <li>双端设备需要登录同一华为账号。</li>        <li>跨设备互通API支持根据特定调用策略调用设备。调用策略：TV、2in1设备可以调用平板和手机，平板可以调用手机，同类型设备不可调用。</li>        <li>双端设备需要打开WLAN和蓝牙开关。         <p>条件允许时，建议双端设备接入同一个局域网，可提升唤醒相机的速度。</p></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section11875613154114">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section11875613154114" tips="复制节点链接"></i></h2>          <ol>      <li><span>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-module#gaeffea1546cbe64aeba533e5b72bca7ba" target="_blank">HMS_ServiceCollaboration_GetCollaborationDeviceInfos</a>接口获取设备能力列表。</span></li>      <li><span>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-module#section4531193410296" target="_blank">HMS_ServiceCollaboration_StartCollaboration</a>接口拉起跨设备互通能力。</span></li>      <li><span>对端设备确定回传后，本端处理对端回传的图片。</span></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section28113147106">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section28113147106" tips="复制节点链接"></i></h2>          <p>在开发具体功能前，请先查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-model" target="_blank">参考文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-module#gaeffea1546cbe64aeba533e5b72bca7ba" target="_blank">HMS_ServiceCollaboration_GetCollaborationDeviceInfos</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>获取跨设备互通可用的设备信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-module#section4531193410296" target="_blank">HMS_ServiceCollaboration_StartCollaboration</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>拉起跨设备互通能力。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-capi-module#section67211235132913" target="_blank">HMS_ServiceCollaboration_StopCollaboration</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>取消跨设备互通能力。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section11757163410599">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section11757163410599" tips="复制节点链接"></i></h2>          <p>1.引入头文件</p>     <div _ngcontent-lpe-c106="" class="highlight-div"><div _ngcontent-lpe-c106="" class="highlight-div-header"><div _ngcontent-lpe-c106="" class="highlight-div-header-left"><div _ngcontent-lpe-c106="" class="handle-button expand-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lpe-c106="" class="highlight-div-header-right"><div _ngcontent-lpe-c106="" class="handle-button ai-button"></div><div _ngcontent-lpe-c106="" class="handle-button line-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lpe-c106="" class="handle-button theme-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lpe-c106="" class="handle-button copy-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lpe-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>#include <span class="hljs-string">"service_collaboration/service_collaboration_api.h"</span></li></ol></pre></div></div>     <div class="p">      2.编写CMakeList.txt      <div _ngcontent-lpe-c106="" class="highlight-div"><div _ngcontent-lpe-c106="" class="highlight-div-header"><div _ngcontent-lpe-c106="" class="highlight-div-header-left"><div _ngcontent-lpe-c106="" class="handle-button expand-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lpe-c106="" class="highlight-div-header-right"><div _ngcontent-lpe-c106="" class="handle-button ai-button"></div><div _ngcontent-lpe-c106="" class="handle-button line-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lpe-c106="" class="handle-button theme-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lpe-c106="" class="handle-button copy-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lpe-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">find_library</span>(</li><li>    # <span class="hljs-title class_">Sets</span> the name <span class="hljs-keyword">of</span> the path variable.</li><li>    service_collaboration-lib</li><li>    # <span class="hljs-title class_">Specifies</span> the name <span class="hljs-keyword">of</span> the <span class="hljs-variable constant_">NDK</span> library that</li><li>    # you want <span class="hljs-title class_">CMake</span> to locate.</li><li>    libservice_collaboration_ndk.<span class="hljs-property">z</span>.<span class="hljs-property">so</span></li><li>)</li><li><span class="hljs-title function_">target_link_libraries</span>(entry <span class="hljs-variable constant_">PUBLIC</span></li><li>    ${service_collaboration-lib}</li><li>)</li></ol></pre></div></div>     </div>     <p>3.实例代码调用接口，分为以下三步。</p>     <ol>      <li><span>通过调用HMS_ServiceCollaboration_GetCollaborationDeviceInfos接口获取设备列表信息，传入需要的ServiceCollaborationFilterType能力数组，接口会返回支持对应能力设备。</span></li>      <li><span>创建回调ServiceCollaborationCallback，其中包括事件回调OnEventProc和图片数据回调OnDataCallbackProc；创建ServiceCollaboration_SelectInfo，示例中传入了TAKE_PHOTO能力，并选择了列表的第一个设备。</span></li>      <li><span>HMS_ServiceCollaboration_StartCollaboration入参传入第二步构造的ServiceCollaborationCallback和ServiceCollaboration_SelectInfo，此时被调用的设备会拉起相机，操作被拉起相机的设备进行拍照。事件和图片数据会通过第二步构造的回调通知给应用。</span></li>     </ol>     <div _ngcontent-lpe-c106="" class="highlight-div"><div _ngcontent-lpe-c106="" class="highlight-div-header"><div _ngcontent-lpe-c106="" class="highlight-div-header-left"><div _ngcontent-lpe-c106="" class="handle-button expand-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lpe-c106="" class="highlight-div-header-right"><div _ngcontent-lpe-c106="" class="handle-button ai-button"></div><div _ngcontent-lpe-c106="" class="handle-button line-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lpe-c106="" class="handle-button theme-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lpe-c106="" class="handle-button copy-button"><div _ngcontent-lpe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lpe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"service_collaboration/service_collaboration_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int32_t</span> <span class="hljs-title">OnEventProc</span><span class="hljs-params">(ServiceCollaborationEventCode code, <span class="hljs-type">uint32_t</span> extraCode)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int32_t</span> <span class="hljs-title">OnDataCallbackProc</span><span class="hljs-params">(</span></span></li><li><span class="hljs-function">    ServiceCollaborationEventCode code, ServiceCollaborationDataType dataType, <span class="hljs-type">uint32_t</span> dataSize, <span class="hljs-type">char</span>* data)</span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int</span> two = <span class="hljs-number">2</span>;</li><li>    <span class="hljs-type">int</span> three = <span class="hljs-number">3</span>;</li><li>    <span class="hljs-type">int</span> filter = <span class="hljs-number">1</span>;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> size = <span class="hljs-number">3</span>;</li><li>    <span class="hljs-type">int</span> shouldCancel = <span class="hljs-number">0</span>;</li><li>    </li><li>    <span class="hljs-comment">// 构建所需跨设备互通能力，并调用HMS_ServiceCollaboration_GetCollaborationDeviceInfos接口获取设备信息</span></li><li>    ServiceCollaborationFilterType serviceFilterTypes[size] = {TAKE_PHOTO, SCAN_DOCUMENT, IMAGE_PICKER};</li><li>    ServiceCollaboration_CollaborationDeviceInfoSets* info = <span class="hljs-built_in">HMS_ServiceCollaboration_GetCollaborationDeviceInfos</span>(<span class="hljs-number">3</span>, serviceFilterTypes);</li><li>    <span class="hljs-comment">// 构建callback回调</span></li><li>    ServiceCollaboration_SelectInfo taskInfo = { TAKE_PHOTO, { <span class="hljs-number">0</span> } };</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; info-&gt;size; i++) {</li><li>        ServiceCollaboration_CollaborationDeviceInfo *deviceInfo =</li><li>            (ServiceCollaboration_CollaborationDeviceInfo *)&amp;(info-&gt;deviceInfoSets[i]);</li><li>        <span class="hljs-keyword">if</span> (filter == <span class="hljs-number">1</span>) {</li><li>            taskInfo.serviceFilterType = TAKE_PHOTO;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (filter == two) {</li><li>            taskInfo.serviceFilterType = SCAN_DOCUMENT;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (filter == three) {</li><li>            taskInfo.serviceFilterType = IMAGE_PICKER;</li><li>        }</li><li>        std::<span class="hljs-built_in">memcpy</span>(taskInfo.deviceNetworkId, deviceInfo-&gt;deviceNetworkId, COLLABORATIONDEVICEINFO_DEVICENETWORKID_MAXLENGTH<span class="hljs-number">-1</span>);</li><li>    }</li><li>    ServiceCollaborationCallback callback = {.OnEvent = OnEventProc, .OnDataCallback = OnDataCallbackProc};</li><li>    <span class="hljs-comment">// 传入拍照参数、callback回调并调用HMS_ServiceCollaboration_StartCollaboration接口</span></li><li>    <span class="hljs-type">uint32_t</span> id = <span class="hljs-built_in">HMS_ServiceCollaboration_StartCollaboration</span>(&amp;taskInfo, &amp;callback);</li><li>    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">seconds</span>(three));</li><li>    <span class="hljs-keyword">if</span> (shouldCancel) {</li><li>        <span class="hljs-comment">// 三秒后主动调用HMS_ServiceCollaboration_StopCollaboration关闭跨设备互通</span></li><li>        <span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">HMS_ServiceCollaboration_StopCollaboration</span>(id);</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>