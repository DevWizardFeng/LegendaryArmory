<h1 _ngcontent-htt-c119="" class="doc-title ng-star-inserted" title="跨设备互通开发指导"> 跨设备互通开发指导 </h1>

<div _ngcontent-htt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>跨设备互通提供跨设备的相机、扫描、图库访问能力，平板或2in1设备可以调用手机的相机、扫描、图库等功能。</p>    <div class="tiledSection">     <h2 id="section1880231055910">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1880231055910" tips="复制节点链接"></i></h2>          <p>您通过此能力实现跨设备交互，可以使用其他设备的相机、扫描和图库功能。</p>    </div>    <div class="tiledSection">     <h2 id="section17575828642">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section17575828642" tips="复制节点链接"></i></h2>          <p>需同时满足以下条件，才能使用该功能：</p>     <ul>      <li><strong>设备限制</strong>       <ul>        <li>本端设备：HarmonyOS版本为HarmonyOS NEXT及以上的平板或2in1设备。</li>        <li>远端设备：HarmonyOS版本为HarmonyOS NEXT及以上、具有相机能力的手机或平板设备。</li>       </ul></li>      <li><strong>使用限制</strong>       <ul>        <li>双端设备需要登录同一华为账号。</li>        <li>跨设备互通API支持根据特定调用策略调用设备。调用策略：2in1设备可以调用平板和手机，平板可以调用手机，同类型设备不可调用。</li>        <li>双端设备需要打开WLAN和蓝牙开关。         <p>条件允许时，建议双端设备接入同一个局域网，可提升唤醒相机的速度。</p></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section28113147106">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section28113147106" tips="复制节点链接"></i></h2>          <p>在开发具体功能前，请先查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice" target="_blank">参考文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section1633482912443" target="_blank">createCollaborationServiceMenuItems</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>设备列表选择器，用于获取组网内具有对应跨设备互通能力的设备列表。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section158671330145417" target="_blank">CollaborationServiceStateDialog</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>弹窗组件，用于提示对端业务状态。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section5716163641018">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section5716163641018" tips="复制节点链接"></i></h2>          <ol>      <li>导入模块。       <div _ngcontent-htt-c106="" class="highlight-div"><div _ngcontent-htt-c106="" class="highlight-div-header"><div _ngcontent-htt-c106="" class="highlight-div-header-left"><div _ngcontent-htt-c106="" class="handle-button expand-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-htt-c106="" class="highlight-div-header-right"><div _ngcontent-htt-c106="" class="handle-button ai-button"></div><div _ngcontent-htt-c106="" class="handle-button line-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-htt-c106="" class="handle-button theme-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-htt-c106="" class="handle-button copy-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-htt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { createCollaborationServiceMenuItems, <span class="hljs-title class_">CollaborationServiceStateDialog</span>, <span class="hljs-title class_">CollaborationServiceFilter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span>;</li></ol></pre></div></div>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section1633482912443" target="_blank">createCollaborationServiceMenuItems</a>是设备列表菜单项模块，传入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section12639651397" target="_blank">CollaborationServiceFilter</a>的能力枚举值；<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section158671330145417" target="_blank">CollaborationServiceStateDialog</a>是状态提示框模块。</p></li>      <li>在Menu中调用createCollaborationServiceMenuItems添加设备列表选择器，在菜单项内显示设备列表。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>在调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section1633482912443" target="_blank">createCollaborationServiceMenuItems</a>前，需了解：</p>         <ul>          <li>该方法需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>组件内调用。</li>          <li>该方法是自定义构建函数，您在使用前需要先了解<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>。</li>         </ul>        </div></div></div></li>      <li>传入Array类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section12639651397" target="_blank">CollaborationServiceFilter</a>枚举值即可使用对应能力，目前支持ALL、TAKE_PHOTO、SCAN_DOCUMENT、IMAGE_PICKER、VIDEO_PICKER和IMAGE_VIDEO_PICKER。       <div class="p">        ALL为预留值，匹配跨端拍照、文档扫描和图库选择器，功能将在后续拓展，TAKE_PHOTO匹配跨设备拍照能力，SCAN_DOCUMENT匹配跨设备扫描能力，IMAGE_PICKER匹配跨设备图库能力，VIDEO_PICKER匹配视频选择器，IMAGE_VIDEO_PICKER匹配图片和视频选择器。        <div _ngcontent-htt-c106="" class="highlight-div"><div _ngcontent-htt-c106="" class="highlight-div-header"><div _ngcontent-htt-c106="" class="highlight-div-header-left"><div _ngcontent-htt-c106="" class="handle-button expand-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-htt-c106="" class="highlight-div-header-right"><div _ngcontent-htt-c106="" class="handle-button ai-button"></div><div _ngcontent-htt-c106="" class="handle-button line-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-htt-c106="" class="handle-button theme-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-htt-c106="" class="handle-button copy-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-htt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-title class_">MyTestMenu</span>() {</li><li>  <span class="hljs-title class_">Menu</span>() {</li><li>    <span class="hljs-title function_">createCollaborationServiceMenuItems</span>([<span class="hljs-title class_">CollaborationServiceFilter</span>.<span class="hljs-property">ALL</span>]) </li><li>  }</li><li>}</li></ol></pre></div></div>       </div></li>      <li>在build方法中添加弹窗组件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section158671330145417" target="_blank">CollaborationServiceStateDialog</a>，用于提示远端相机拍摄状态和回传数据，需要实现其中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section33027582114" target="_blank">onState</a>方法。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section158671330145417" target="_blank">CollaborationServiceStateDialog</a>是全局的提示框，不会对原有布局产生影响。</li>      <li>为弹窗组件绑定和实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section33027582114" target="_blank">onState</a>方法，用于接收和处理照片数据。       <p>回调函数的传入参数stateCode是完成状态，buffer是回传的数据内容，可通过状态和数据内容结合自身的业务逻辑实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationservice#section33027582114" target="_blank">onState</a>方法。</p>       <div _ngcontent-htt-c106="" class="highlight-div"><div _ngcontent-htt-c106="" class="highlight-div-header"><div _ngcontent-htt-c106="" class="highlight-div-header-left"><div _ngcontent-htt-c106="" class="handle-button expand-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-htt-c106="" class="highlight-div-header-right"><div _ngcontent-htt-c106="" class="handle-button ai-button"></div><div _ngcontent-htt-c106="" class="handle-button line-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-htt-c106="" class="handle-button theme-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-htt-c106="" class="handle-button copy-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-htt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">CollaborationServiceStateDialog</span>({</li><li>  <span class="hljs-attr">onState</span>: (<span class="hljs-attr">stateCode</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">bufferType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span>):<span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doInsertPicture</span>(stateCode, bufferType, buffer)</li><li>})</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section116310462616">跨设备互通完整示例<i class="anchor-icon anchor-icon-link" anchorid="section116310462616" tips="复制节点链接"></i></h2>          <p>通过以下示例，您可以完成一次调用对端相机拍摄的操作。</p>     <div _ngcontent-htt-c106="" class="highlight-div"><div _ngcontent-htt-c106="" class="highlight-div-header"><div _ngcontent-htt-c106="" class="highlight-div-header-left"><div _ngcontent-htt-c106="" class="handle-button expand-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-htt-c106="" class="highlight-div-header-right"><div _ngcontent-htt-c106="" class="handle-button ai-button"></div><div _ngcontent-htt-c106="" class="handle-button line-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-htt-c106="" class="handle-button theme-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-htt-c106="" class="handle-button copy-button"><div _ngcontent-htt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-htt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {</li><li>  createCollaborationServiceMenuItems,</li><li>  <span class="hljs-title class_">CollaborationServiceStateDialog</span>,</li><li>  <span class="hljs-title class_">CollaborationServiceFilter</span></li><li>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">picture</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">MyTestMenu</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title function_">createCollaborationServiceMenuItems</span>([<span class="hljs-title class_">CollaborationServiceFilter</span>.<span class="hljs-property">ALL</span>])</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>      <span class="hljs-title class_">CollaborationServiceStateDialog</span>({</li><li>        <span class="hljs-attr">onState</span>: (<span class="hljs-attr">stateCode</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">bufferType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doInsertPicture</span>(stateCode, bufferType, buffer)</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'使用远端设备进行拍照'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">bindMenu</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">MyTestMenu</span>)</li><li>
</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span>) {</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span>)</li><li>          .<span class="hljs-title function_">borderStyle</span>(<span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Dotted</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"MEMOMOCK"</span>, <span class="hljs-string">"onComplete "</span> + event.<span class="hljs-property">loadingStatus</span>)</li><li>            }</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">doInsertPicture</span>(<span class="hljs-attr">stateCode</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">bufferType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (stateCode != <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span></li><li>    }</li><li>    <span class="hljs-keyword">if</span> (bufferType == <span class="hljs-string">"general.image"</span>) {</li><li>      <span class="hljs-keyword">let</span> imageSource = image.<span class="hljs-title function_">createImageSource</span>(buffer)</li><li>      imageSource.<span class="hljs-title function_">createPixelMap</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelMap</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span> = pixelMap;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section17522135912185">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section17522135912185" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/harmonyos_samples/service-collaboration-kit-sample-code-arkts" target="_blank">跨设备互通</a></li>     </ul>    </div>   </div>   <div></div></div>