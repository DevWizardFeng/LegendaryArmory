<h1 _ngcontent-pux-c119="" class="doc-title ng-star-inserted" title="跨设备剪贴板开发指导"> 跨设备剪贴板开发指导 </h1>

<div _ngcontent-pux-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>在开发跨设备剪贴板的功能时，系统将自动完成跨设备的数据传递，应用可按照本设备上的开发示例，完成跨设备剪贴板的开发。</p> <div class="tiledSection"><h2 id="section17575828642">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section17575828642" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="29.09%"><p>设备版本</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="70.91%"><p>使用限制</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="29.09%"><p>HarmonyOS NEXT Developer Preview0及以上</p> </td> <td class="cellrowborder" valign="top" width="70.91%"><ul><li>双端设备需要打开跨设备剪贴板开关。</li><li>双端设备需要登录同一华为账号。</li><li>双端设备需要打开Wi-Fi和蓝牙开关。</li><li>双端设备在过程中需解锁、亮屏。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section184815911712">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section184815911712" tips="复制节点链接"></i></h2><p>在开发具体功能前，请先查阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard" target="_blank">参考文档</a>，获取详细的接口说明。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="54.48%"><p>接口</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="45.519999999999996%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="54.48%"><p>getSystemPasteboard(): SystemPasteboard</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>获取系统剪贴板对象。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>createData(mimeType: string, value: ValueType): PasteData</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>构建一个自定义类型的剪贴板内容对象。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>setData(data: PasteData): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>将数据写入系统剪贴板，使用Promise异步回调。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>getData(callback: AsyncCallback&lt;PasteData&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>读取系统剪贴板内容，使用callback异步回调。</p> <p>应用使用自定义控件后台访问剪贴板需要申请ohos.permission.READ_PASTEBOARD。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>getRecordCount(): number</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>获取剪贴板内容中条目的个数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>getPrimaryMimeType(): string</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>获取剪贴板内容中首个条目的数据类型。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="54.48%"><p>getPrimaryText(): string</p> </td> <td class="cellrowborder" valign="top" width="45.519999999999996%"><p>获取首个条目的纯文本内容。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1653575873018">开发示例<i class="anchor-icon anchor-icon-link" anchorid="section1653575873018" tips="复制节点链接"></i></h2><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>跨设备复制的数据两分钟内有效。</p> </div></div></div> <ul><li>设备A复制数据，写入到剪贴板服务。<div _ngcontent-pux-c106="" class="highlight-div"><div _ngcontent-pux-c106="" class="highlight-div-header"><div _ngcontent-pux-c106="" class="highlight-div-header-left"><div _ngcontent-pux-c106="" class="handle-button expand-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pux-c106="" class="highlight-div-header-right"><div _ngcontent-pux-c106="" class="handle-button ai-button"></div><div _ngcontent-pux-c106="" class="handle-button line-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pux-c106="" class="handle-button theme-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pux-c106="" class="handle-button copy-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pux-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> pasteboard <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.pasteboard'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setPasteDataTest</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">text</span>: string = <span class="hljs-string">'hello world'</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">pasteData</span>: pasteboard.<span class="hljs-property">PasteData</span> = pasteboard.<span class="hljs-title function_">createData</span>(pasteboard.<span class="hljs-property">MIMETYPE_TEXT_PLAIN</span>, text);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">systemPasteBoard</span>: pasteboard.<span class="hljs-property">SystemPasteboard</span> = pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>();</li><li>  <span class="hljs-keyword">await</span> systemPasteBoard.<span class="hljs-title function_">setData</span>(pasteData).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to set pastedata. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div> </li></ul> <ul><li>设备B粘贴数据，读取剪贴板内容。<div _ngcontent-pux-c106="" class="highlight-div"><div _ngcontent-pux-c106="" class="highlight-div-header"><div _ngcontent-pux-c106="" class="highlight-div-header-left"><div _ngcontent-pux-c106="" class="handle-button expand-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pux-c106="" class="highlight-div-header-right"><div _ngcontent-pux-c106="" class="handle-button ai-button"></div><div _ngcontent-pux-c106="" class="handle-button line-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pux-c106="" class="handle-button theme-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pux-c106="" class="handle-button copy-button"><div _ngcontent-pux-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pux-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">pasteboard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.pasteboard'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-variable">async</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">getPasteDataTest</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">systemPasteBoard</span>: <span class="hljs-title class_">pasteboard</span>.<span class="hljs-title class_">SystemPasteboard</span> = <span class="hljs-variable">pasteboard</span>.<span class="hljs-title function_">getSystemPasteboard</span>();</li><li>  <span class="hljs-variable">systemPasteBoard</span>.<span class="hljs-title function_">getData</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">pasteboard</span>.<span class="hljs-title class_">PasteData</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">get</span> <span class="hljs-variable">pastedata</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 对pastedata进行处理，获取类型，个数等</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">recordCount</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">data</span>.<span class="hljs-title function_">getRecordCount</span>(); <span class="hljs-comment">// 获取剪贴板内record的个数</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">types</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">data</span>.<span class="hljs-title function_">getPrimaryMimeType</span>(); <span class="hljs-comment">// 获取剪贴板内数据的类型</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">primaryText</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">data</span>.<span class="hljs-title function_">getPrimaryText</span>(); <span class="hljs-comment">// 获取剪贴板内数据的内容</span></li><li>  });</li><li>}</li></ol></pre></div></div> </li></ul> </div> </div> <div></div></div>