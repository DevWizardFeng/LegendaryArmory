<h1 _ngcontent-lyk-c119="" class="doc-title ng-star-inserted" title="车控"> 车控 </h1>

<div _ngcontent-lyk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>数字车钥匙开通完成后，车主APP可以通过车控指令远程控制车辆的开门等操作。</p>    <p><span><img originheight="522" originwidth="851" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114627.26554098242424492463112672519212:50001231000000:2800:E0F2DE3885B02920A6F363C5DDCC39234DCAADDEA3A5D4249C994C8629EBC467.png" width="851" height="522"></span></p>    <p>典型的交互流程如下:</p>    <ul>     <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section82336268523" target="_blank">queryICCEConnectionState</a>接口检查车控蓝牙的连接状态，如果未连接则使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section137818297525" target="_blank">startICCEConnection</a>主动连接。</li>     <li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section287123205213" target="_blank">registerICCEListener</a>注册监听，接收华为钱包发送的消息。</li>     <li>车主APP可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section73091546144716" target="_blank">sendICCERKEMessage</a>接口发送车控指令。</li>     <li>用户退出数字钥匙车控页面，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section692193414523" target="_blank">unregisterICCEListener</a>接口取消监听。</li>    </ul>    <div class="tiledSection">     <h2 id="section141688231526">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section141688231526" tips="复制节点链接"></i></h2>          <ol>      <li><span>车主APP使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations">创建Wallet Kit服务</a>时注册的服务号和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195" target="_blank">申请钥匙卡片</a>时定义的卡券唯一标识，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section82336268523" target="_blank">queryICCEConnectionState</a>判断车钥匙的蓝牙链路状态。</span>       <p></p>       <div _ngcontent-lyk-c106="" class="highlight-div"><div _ngcontent-lyk-c106="" class="highlight-div-header"><div _ngcontent-lyk-c106="" class="highlight-div-header-left"><div _ngcontent-lyk-c106="" class="handle-button expand-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lyk-c106="" class="highlight-div-header-right"><div _ngcontent-lyk-c106="" class="handle-button ai-button"></div><div _ngcontent-lyk-c106="" class="handle-button line-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lyk-c106="" class="handle-button theme-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lyk-c106="" class="handle-button copy-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lyk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { walletPass } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WalletKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">walletPassClient</span>: walletPass.<span class="hljs-property">WalletPassClient</span> = <span class="hljs-keyword">new</span> walletPass.<span class="hljs-title class_">WalletPassClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>);</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations"><span class="hljs-comment">创建Wallet Kit服务</span></a><span class="hljs-comment">时注册的服务号</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">passType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195" target="_blank"><span class="hljs-comment">申请钥匙卡片</span></a><span class="hljs-comment">时定义的卡券唯一标识</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">serialNumber</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">queryICCEConnectionState</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> passStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({</li><li>      <span class="hljs-attr">passType</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">passType</span>,</li><li>      <span class="hljs-attr">serialNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">serialNumber</span></li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">walletPassClient</span>.<span class="hljs-title function_">queryICCEConnectionState</span>(passStr).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in querying ICCEConnectionState, result: <span class="hljs-subst">${result}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to query ICCEConnectionState, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// your application UI</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>如果<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section82336268523" target="_blank">queryICCEConnectionState</a>接口返回连接状态connectionState为未配对0时，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section137818297525" target="_blank">startICCEConnection</a>主动创建蓝牙链接。</span>       <p></p>       <div _ngcontent-lyk-c106="" class="highlight-div"><div _ngcontent-lyk-c106="" class="highlight-div-header"><div _ngcontent-lyk-c106="" class="highlight-div-header-left"><div _ngcontent-lyk-c106="" class="handle-button expand-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lyk-c106="" class="highlight-div-header-right"><div _ngcontent-lyk-c106="" class="handle-button ai-button"></div><div _ngcontent-lyk-c106="" class="handle-button line-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lyk-c106="" class="handle-button theme-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lyk-c106="" class="handle-button copy-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lyk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { walletPass } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WalletKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">walletPassClient</span>: walletPass.<span class="hljs-property">WalletPassClient</span> = <span class="hljs-keyword">new</span> walletPass.<span class="hljs-title class_">WalletPassClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>);</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations"><span class="hljs-comment">创建Wallet Kit服务</span></a><span class="hljs-comment">时注册的服务号</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">passType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195" target="_blank"><span class="hljs-comment">申请钥匙卡片</span></a><span class="hljs-comment">时定义的卡券唯一标识</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">serialNumber</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">startICCEConnection</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> passStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({</li><li>      <span class="hljs-attr">passType</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">passType</span>,</li><li>      <span class="hljs-attr">serialNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">serialNumber</span></li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">walletPassClient</span>.<span class="hljs-title function_">startICCEConnection</span>(passStr).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in starting ICCEConnection, result: <span class="hljs-subst">${result}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to start ICCEConnection, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// your application UI</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>车主APP通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section287123205213" target="_blank">registerICCEListener</a>注册监听华为钱包发送的消息。</span>       <p></p>       <div _ngcontent-lyk-c106="" class="highlight-div"><div _ngcontent-lyk-c106="" class="highlight-div-header"><div _ngcontent-lyk-c106="" class="highlight-div-header-left"><div _ngcontent-lyk-c106="" class="handle-button expand-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lyk-c106="" class="highlight-div-header-right"><div _ngcontent-lyk-c106="" class="handle-button ai-button"></div><div _ngcontent-lyk-c106="" class="handle-button line-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lyk-c106="" class="handle-button theme-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lyk-c106="" class="handle-button copy-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lyk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { walletPass } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WalletKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ICCECallBack</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">rpc.RemoteObject</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">super</span>(<span class="hljs-string">'ICCECallBack'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onRemoteMessageRequest</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: rpc.<span class="hljs-property">MessageSequence</span>, <span class="hljs-attr">reply</span>: rpc.<span class="hljs-property">MessageSequence</span>, <span class="hljs-attr">option</span>: rpc.<span class="hljs-property">MessageOption</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>    <span class="hljs-comment">// processing after receiving communication data</span></li><li>    <span class="hljs-keyword">let</span> codeInt = data.<span class="hljs-title function_">readInt</span>();</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">walletPassClient</span>: walletPass.<span class="hljs-property">WalletPassClient</span> = <span class="hljs-keyword">new</span> walletPass.<span class="hljs-title class_">WalletPassClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callback</span>: rpc.<span class="hljs-property">RemoteObject</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations"><span class="hljs-comment">创建Wallet Kit服务</span></a><span class="hljs-comment">时注册的服务号</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">passType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// 注册监听的应用名称，一般为包名</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">registerName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">registerICCEListener</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> passStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({</li><li>      <span class="hljs-attr">passType</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">passType</span>,</li><li>      <span class="hljs-attr">registerName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">registerName</span></li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ICCECallBack</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">walletPassClient</span>.<span class="hljs-title function_">registerICCEListener</span>(passStr, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in registering ICCEListener, result: <span class="hljs-subst">${result}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to register ICCEListener, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// your application UI</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>车主APP通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section73091546144716" target="_blank">sendICCERKEMessage</a>接口发送车控指令。</span>       <p></p>       <div _ngcontent-lyk-c106="" class="highlight-div"><div _ngcontent-lyk-c106="" class="highlight-div-header"><div _ngcontent-lyk-c106="" class="highlight-div-header-left"><div _ngcontent-lyk-c106="" class="handle-button expand-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lyk-c106="" class="highlight-div-header-right"><div _ngcontent-lyk-c106="" class="handle-button ai-button"></div><div _ngcontent-lyk-c106="" class="handle-button line-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lyk-c106="" class="handle-button theme-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lyk-c106="" class="handle-button copy-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lyk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { walletPass } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WalletKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">walletPassClient</span>: walletPass.<span class="hljs-property">WalletPassClient</span> = <span class="hljs-keyword">new</span> walletPass.<span class="hljs-title class_">WalletPassClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>);</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations"><span class="hljs-comment">创建Wallet Kit服务</span></a><span class="hljs-comment">时注册的服务号</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">passType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195" target="_blank"><span class="hljs-comment">申请钥匙卡片</span></a><span class="hljs-comment">时定义的卡券唯一标识</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">serialNumber</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// 车控指令</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rkeCommand</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendICCERKEMessage</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> passStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({</li><li>      <span class="hljs-attr">passType</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">passType</span>,</li><li>      <span class="hljs-attr">serialNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">serialNumber</span>,</li><li>      <span class="hljs-attr">rkeCommand</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">rkeCommand</span>,</li><li>      <span class="hljs-attr">encryptFlag</span>: <span class="hljs-string">'0'</span>,</li><li>      <span class="hljs-attr">directionFlag</span>: <span class="hljs-string">'1'</span></li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">walletPassClient</span>.<span class="hljs-title function_">sendICCERKEMessage</span>(passStr).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in sending ICCERKEMessage, result: <span class="hljs-subst">${result}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to send ICCERKEMessage, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// your application UI</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>用户退出数字钥匙车控页面，车主APP通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-walletpass#section692193414523" target="_blank">unregisterICCEListener</a>接口取消监听。</span>       <p></p>       <div _ngcontent-lyk-c106="" class="highlight-div"><div _ngcontent-lyk-c106="" class="highlight-div-header"><div _ngcontent-lyk-c106="" class="highlight-div-header-left"><div _ngcontent-lyk-c106="" class="handle-button expand-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lyk-c106="" class="highlight-div-header-right"><div _ngcontent-lyk-c106="" class="handle-button ai-button"></div><div _ngcontent-lyk-c106="" class="handle-button line-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lyk-c106="" class="handle-button theme-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lyk-c106="" class="handle-button copy-button"><div _ngcontent-lyk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lyk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { walletPass } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.WalletKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">walletPassClient</span>: walletPass.<span class="hljs-property">WalletPassClient</span> = <span class="hljs-keyword">new</span> walletPass.<span class="hljs-title class_">WalletPassClient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callback</span>: rpc.<span class="hljs-property">RemoteObject</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// </span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations"><span class="hljs-comment">创建Wallet Kit服务</span></a><span class="hljs-comment">时注册的服务号</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">passType</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// 注册监听的应用名称，一般为包名</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">registerName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">unregisterICCEListener</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> passStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({</li><li>      <span class="hljs-attr">passType</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">passType</span>,</li><li>      <span class="hljs-attr">registerName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">registerName</span></li><li>    });</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">walletPassClient</span>.<span class="hljs-title function_">unregisterICCEListener</span>(passStr).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in unregistering ICCEListener, result: <span class="hljs-subst">${result}</span>`</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span> = <span class="hljs-literal">null</span>;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to unregister ICCEListener, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// your application UI</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>