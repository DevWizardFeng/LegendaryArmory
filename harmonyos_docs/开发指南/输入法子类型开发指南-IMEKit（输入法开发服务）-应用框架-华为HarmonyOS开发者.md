<h1 _ngcontent-hhm-c119="" class="doc-title ng-star-inserted" title="输入法子类型开发指南"> 输入法子类型开发指南 </h1>

<div _ngcontent-hhm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>输入法子类型允许输入法展现不同的输入模式或语言，用户可以根据需要在不同模式和语言中切换。如输入法的中文键盘、英文键盘等，都属于输入法的子类型。</p>    <div class="tiledSection">     <h2 id="输入法子类型的配置与实现">输入法子类型的配置与实现<i class="anchor-icon anchor-icon-link" anchorid="输入法子类型的配置与实现" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>输入法应用开发者只需要注册实现一个InputMethodExtensionAbility，所有的输入法子类型共用该InputMethodExtensionAbility，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中添加metadata，name为ohos_extension.input_method，用于配置所有子类型的资源信息。</p>       <div _ngcontent-hhm-c106="" class="highlight-div"><div _ngcontent-hhm-c106="" class="highlight-div-header"><div _ngcontent-hhm-c106="" class="highlight-div-header-left"><div _ngcontent-hhm-c106="" class="handle-button expand-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hhm-c106="" class="highlight-div-header-right"><div _ngcontent-hhm-c106="" class="handle-button ai-button"></div><div _ngcontent-hhm-c106="" class="handle-button line-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hhm-c106="" class="handle-button theme-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hhm-c106="" class="handle-button copy-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hhm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"extensionAbilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"InputMethodExtDemo"</span>,</li><li>        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>,</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"InputMethodExtAbility"</span>,</li><li>        <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/InputMethodExtensionAbility/InputMethodService.ts"</span>,</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"inputMethod"</span>,</li><li>        <span class="hljs-string">"exported"</span>: <span class="hljs-literal">true</span>,</li><li>        <span class="hljs-string">"metadata"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.extension.input_method"</span>,</li><li>            <span class="hljs-string">"resource"</span>: <span class="hljs-string">"$profile:input_method_config"</span></li><li>          }</li><li>        ]</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>子类型配置文件input_method_config.json需要放在应用资源目录的profile文件夹中，格式如下，字段释义参照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod-subtype#inputmethodsubtype" target="_blank">InputMethodSubtype</a>；开发者需要严格按照配置文件格式及字段进行子类型信息配置，locale字段的配置参照<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/i18n-locale-culture#实现原理">i18n-locale-culture</a>。</p>       <div _ngcontent-hhm-c106="" class="highlight-div"><div _ngcontent-hhm-c106="" class="highlight-div-header"><div _ngcontent-hhm-c106="" class="highlight-div-header-left"><div _ngcontent-hhm-c106="" class="handle-button expand-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hhm-c106="" class="highlight-div-header-right"><div _ngcontent-hhm-c106="" class="handle-button ai-button"></div><div _ngcontent-hhm-c106="" class="handle-button line-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hhm-c106="" class="handle-button theme-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hhm-c106="" class="handle-button copy-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hhm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"subtypes"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>,</li><li>      <span class="hljs-string">"id"</span>: <span class="hljs-string">"InputMethodExtAbility"</span>,</li><li>      <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:english"</span>,</li><li>      <span class="hljs-string">"locale"</span>: <span class="hljs-string">"en-US"</span>,</li><li>      <span class="hljs-string">"mode"</span>: <span class="hljs-string">"lower"</span></li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>,</li><li>      <span class="hljs-string">"id"</span>: <span class="hljs-string">"InputMethodExtAbility1"</span>,</li><li>      <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:chinese"</span>,</li><li>      <span class="hljs-string">"locale"</span>: <span class="hljs-string">"zh-CN"</span>,</li><li>      <span class="hljs-string">"mode"</span>: <span class="hljs-string">"lower"</span></li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div></li>      <li>       <p>输入法应用中监听子类型事件，根据不同的子类型，可以加载不同的软键盘界面，或者通过状态变量控制软键盘显示效果。</p>       <div _ngcontent-hhm-c106="" class="highlight-div"><div _ngcontent-hhm-c106="" class="highlight-div-header"><div _ngcontent-hhm-c106="" class="highlight-div-header-left"><div _ngcontent-hhm-c106="" class="handle-button expand-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hhm-c106="" class="highlight-div-header-right"><div _ngcontent-hhm-c106="" class="handle-button ai-button"></div><div _ngcontent-hhm-c106="" class="handle-button line-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hhm-c106="" class="handle-button theme-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hhm-c106="" class="handle-button copy-button"><div _ngcontent-hhm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hhm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InputMethodSubtype</span>, inputMethodEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">panelInfo</span>: inputMethodEngine.<span class="hljs-property">PanelInfo</span> = {</li><li>  <span class="hljs-attr">type</span>: inputMethodEngine.<span class="hljs-property">PanelType</span>.<span class="hljs-property">SOFT_KEYBOARD</span>,</li><li>  <span class="hljs-attr">flag</span>: inputMethodEngine.<span class="hljs-property">PanelFlag</span>.<span class="hljs-property">FLG_FIXED</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">inputMethodAbility</span>: inputMethodEngine.<span class="hljs-property">InputMethodAbility</span> = inputMethodEngine.<span class="hljs-title function_">getInputMethodAbility</span>();</li><li><span class="hljs-comment">// createPanel需要在InputMethodExtensionAbility的Create声明周期中完成，this.context是InputMethodExtensionAbility中的InputMethodExtensionContext</span></li><li>inputMethodAbility.<span class="hljs-title function_">createPanel</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, panelInfo).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">panel</span>: inputMethodEngine.<span class="hljs-property">Panel</span>) =&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">inputPanel</span>: inputMethodEngine.<span class="hljs-property">Panel</span> = panel;</li><li>  inputMethodAbility.<span class="hljs-title function_">on</span>(<span class="hljs-string">'setSubtype'</span>, <span class="hljs-function">(<span class="hljs-params">inputMethodSubtype: InputMethodSubtype</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 保存当前输入法子类型, 此处也可以改变状态变量的值，布局中判断状态变量，不同的子类型显示不同的布局控件</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">subType</span>: <span class="hljs-title class_">InputMethodSubtype</span> = inputMethodSubtype;</li><li>    <span class="hljs-keyword">if</span> (inputMethodSubtype.<span class="hljs-property">id</span> == <span class="hljs-string">'InputMethodExtAbility'</span>) { <span class="hljs-comment">// 根据不同的子类型，可以加载不同的软键盘界面</span></li><li>      inputPanel.<span class="hljs-title function_">setUiContent</span>(<span class="hljs-string">'pages/Index'</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (inputMethodSubtype.<span class="hljs-property">id</span> == <span class="hljs-string">'InputMethodExtAbility1'</span>) { <span class="hljs-comment">// 根据不同的子类型，可以加载不同的软键盘界面</span></li><li>      inputPanel.<span class="hljs-title function_">setUiContent</span>(<span class="hljs-string">'pages/Index1'</span>);</li><li>    }</li><li>  });</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPanel, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="输入法子类型相关信息的获取">输入法子类型相关信息的获取<i class="anchor-icon anchor-icon-link" anchorid="输入法子类型相关信息的获取" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>开发者可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodgetcurrentinputmethodsubtype9" target="_blank">getCurrentInputMethodSubtype</a>获取当前输入法应用的当前子类型。</p></li>      <li>       <p>开发者可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#listcurrentinputmethodsubtype9" target="_blank">listCurrentInputMethodSubtype</a>获取当前输入法应用的所有子类型。</p></li>      <li>       <p>开发者可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#listinputmethodsubtype9" target="_blank">listInputMethodSubtype</a>获取指定输入法应用的所有子类型。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="输入法子类型的切换">输入法子类型的切换<i class="anchor-icon anchor-icon-link" anchorid="输入法子类型的切换" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>开发者可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodswitchcurrentinputmethodsubtype9" target="_blank">switchCurrentInputMethodSubtype</a>切换当前输入法应用的子类型。</p></li>      <li>       <p>开发者可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodswitchcurrentinputmethodandsubtype9" target="_blank">switchCurrentInputMethodAndSubtype</a>切换至指定输入法应用的指定子类型。</p></li>     </ol>    </div>   </div>   <div></div></div>