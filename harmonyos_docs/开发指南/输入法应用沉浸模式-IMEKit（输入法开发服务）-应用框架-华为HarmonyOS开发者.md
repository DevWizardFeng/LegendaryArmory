<h1 _ngcontent-ffd-c119="" class="doc-title ng-star-inserted" title="输入法应用沉浸模式"> 输入法应用沉浸模式 </h1>

<div _ngcontent-ffd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>为了让应用能够提供一致的沉浸式体验，我们提供了前台应用和输入法应用之间的通信机制。通过该机制，输入法应用根据前台应用设置的沉浸模式来决定最终沉浸模式。</p>    </div>    <div class="tiledSection">     <h2 id="框架原理">框架原理<i class="anchor-icon anchor-icon-link" anchorid="框架原理" tips="复制节点链接"></i></h2>          <p><span><img originheight="307" originwidth="692" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114717.97953625524635095538474518133607:50001231000000:2800:AE036E2A4BDEBCEEB8784FD9F2570749123EC57C8061DADE41146EBA3776A027.png" width="692" height="307"></span></p>     <ul>      <li>前台应用根据应用场景，设置应用期望的沉浸模式。</li>      <li>输入法框架在拉起输入法应用时会将前台应用期望的沉浸模式传递给输入法应用。</li>      <li>输入法应用根据前台应用的沉浸模式决定最终的沉浸模式，并设置最终沉浸模式给输入法框架。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接入指导">接入指导<i class="anchor-icon anchor-icon-link" anchorid="接入指导" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>前台应用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textarea#keyboardappearance15" target="_blank">设置编辑框沉浸模式</a>。示例代码如下。</p>       <div _ngcontent-ffd-c106="" class="highlight-div"><div _ngcontent-ffd-c106="" class="highlight-div-header"><div _ngcontent-ffd-c106="" class="highlight-div-header-left"><div _ngcontent-ffd-c106="" class="handle-button expand-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ffd-c106="" class="highlight-div-header-right"><div _ngcontent-ffd-c106="" class="handle-button ai-button"></div><div _ngcontent-ffd-c106="" class="handle-button line-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ffd-c106="" class="handle-button theme-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ffd-c106="" class="handle-button copy-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ffd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">TextArea</span>({<span class="hljs-attr">text</span>: <span class="hljs-string">"hello world"</span>})</li><li>   .<span class="hljs-title function_">keyboardAppearance</span>(<span class="hljs-title class_">KeyboardAppearance</span>.<span class="hljs-property">IMMERSIVE</span>)</li></ol></pre></div></div></li>      <li>       <p>输入法应用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethodengine#oneditorattributechanged10" target="_blank">订阅编辑框属性变化事件</a>，通过回调参数EditorAttribute中的immersiveMode字段感知前台应用期望的沉浸模式。示例代码如下。</p>       <div _ngcontent-ffd-c106="" class="highlight-div"><div _ngcontent-ffd-c106="" class="highlight-div-header"><div _ngcontent-ffd-c106="" class="highlight-div-header-left"><div _ngcontent-ffd-c106="" class="handle-button expand-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ffd-c106="" class="highlight-div-header-right"><div _ngcontent-ffd-c106="" class="handle-button ai-button"></div><div _ngcontent-ffd-c106="" class="handle-button line-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ffd-c106="" class="handle-button theme-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ffd-c106="" class="handle-button copy-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ffd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inputMethodEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li>inputMethodEngine.<span class="hljs-title function_">getKeyboardDelegate</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">"editorAttributeChanged"</span>, <span class="hljs-function">(<span class="hljs-params">attr : inputMethodEngine.EditorAttribute</span>) =&gt;</span> {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"received editorAttributeChanged, immersiveMode: "</span> + attr.<span class="hljs-property">immersiveMode</span>);</li><li>})</li></ol></pre></div></div></li>      <li>       <p>输入法应用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethodengine#setimmersivemode15" target="_blank">设置沉浸模式</a>。</p>       <ul>        <li>IMMERSIVE表示沉浸模式由输入法应用决定。</li>        <li>输入法应用不能设置IMMERSIVE模式给输入法框架。</li>        <li>如果输入法应用收到前台应用期望的沉浸模式为IMMERSIVE，建议输入法应用根据当前系统所处颜色模式，将最终沉浸模式设置为浅色沉浸模式（LIGHT_IMMERSIVE）或深色沉浸模式（DARK_IMMERSIVE）。</li>       </ul>       <p>设置沉浸模式，示例代码如下。setImmersiveMode接口需使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethodengine#createpanel10" target="_blank">createPanel</a>获取到Panel实例后，通过实例调用。</p>       <div _ngcontent-ffd-c106="" class="highlight-div"><div _ngcontent-ffd-c106="" class="highlight-div-header"><div _ngcontent-ffd-c106="" class="highlight-div-header-left"><div _ngcontent-ffd-c106="" class="handle-button expand-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ffd-c106="" class="highlight-div-header-right"><div _ngcontent-ffd-c106="" class="handle-button ai-button"></div><div _ngcontent-ffd-c106="" class="handle-button line-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ffd-c106="" class="handle-button theme-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ffd-c106="" class="handle-button copy-button"><div _ngcontent-ffd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ffd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inputMethodEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">panelInfo</span>: inputMethodEngine.<span class="hljs-property">PanelInfo</span> = {</li><li>  <span class="hljs-attr">type</span>: inputMethodEngine.<span class="hljs-property">PanelType</span>.<span class="hljs-property">SOFT_KEYBOARD</span>,</li><li>  <span class="hljs-attr">flag</span>: inputMethodEngine.<span class="hljs-property">PanelFlag</span>.<span class="hljs-property">FLG_FIXED</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">inputMethodAbility</span>: inputMethodEngine.<span class="hljs-property">InputMethodAbility</span> = inputMethodEngine.<span class="hljs-title function_">getInputMethodAbility</span>();</li><li><span class="hljs-comment">// createPanel需要在InputMethodExtensionAbility的Create声明周期中完成，this.context是InputMethodExtensionAbility中的InputMethodExtensionContext</span></li><li>inputMethodAbility.<span class="hljs-title function_">createPanel</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, panelInfo).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">panel</span>: inputMethodEngine.<span class="hljs-property">Panel</span>) =&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">inputPanel</span>: inputMethodEngine.<span class="hljs-property">Panel</span> = panel;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    inputPanel?.<span class="hljs-title function_">setImmersiveMode</span>(inputMethodEngine.<span class="hljs-property">ImmersiveMode</span>.<span class="hljs-property">LIGHT_IMMERSIVE</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to setImmersiveMode, code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPanel, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>