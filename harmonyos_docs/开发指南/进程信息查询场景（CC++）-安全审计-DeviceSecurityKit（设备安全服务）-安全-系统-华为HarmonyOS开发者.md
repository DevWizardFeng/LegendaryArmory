<h1 _ngcontent-unb-c119="" class="doc-title ng-star-inserted" title="进程信息查询场景（C/C++）"> 进程信息查询场景（C/C++） </h1>

<div _ngcontent-unb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1960212118554">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1960212118554" tips="复制节点链接"></i></h2>          <p>从API version 20 开始，新增提供应用进程信息查询接口，可以获取设备上已启动的应用进程信息。进程信息包括进程ID、指令命令行、父进程PID、用户ID、用户组ID、进程启动时间、进程所有者ID类型、进程所有者ID等相关信息。</p>    </div>    <div class="tiledSection">     <h2 id="section15263938648">约束和限制<i class="anchor-icon anchor-icon-link" anchorid="section15263938648" tips="复制节点链接"></i></h2>          <ol>      <li>当前能力仅支持2in1设备。</li>      <li>支持单次输入要查询的进程数最大限制为16个。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section10813114113715">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section10813114113715" tips="复制节点链接"></i></h2>          <p><span><img originheight="280" originwidth="1509" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115052.65342420534781789440233743765779:50001231000000:2800:5D18F3CF27A91836A96E83843F9A3F8E091FF25F2897417B7B9F4293F63DC074.png" width="920" height="170.7090788601723"></span></p>     <p><strong>流程说明：</strong></p>     <ol>      <li>用户在hap应用上调用查询接口获取应用进程信息。</li>      <li>Device Security Kit接口同步返回应用进程信息给hap应用，hap应用根据返回的应用进程信息进行业务处理。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section143574204817">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section143574204817" tips="复制节点链接"></i></h2>          <p>接口如下表，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-capi-securityaudit#section0945443114617" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="47.949999999999996%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="52.05%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="47.949999999999996%">          <p>int32_t HMS_SecurityAudit_QueryAllProcesses(char** result)</p></td>         <td class="cellrowborder" valign="top" width="52.05%">          <p>获取所有的应用进程信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="47.949999999999996%">          <p>int32_t HMS_SecurityAudit_QueryProcesses(uint64_t* pids, uint64_t count, char** result)</p></td>         <td class="cellrowborder" valign="top" width="52.05%">          <p>获取输入的pid的应用进程信息。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1744135493514">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1744135493514" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>在开发准备过程中，需要申请权限：ohos.permission.QUERY_AUDIT_EVENT。</li>        <li>只允许清单内的企业类应用申请该权限，申请方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/permissions-for-enterprise-apps" target="_blank">申请使用企业类应用可用权限</a>。</li>       </ul>      </div></div></div>    </div>    <ol>     <li><span>在CMakeLists.txt中导入安全审计共享库，并链接该库。</span>      <p></p>      <div _ngcontent-unb-c106="" class="highlight-div"><div _ngcontent-unb-c106="" class="highlight-div-header"><div _ngcontent-unb-c106="" class="highlight-div-header-left"><div _ngcontent-unb-c106="" class="handle-button expand-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unb-c106="" class="highlight-div-header-right"><div _ngcontent-unb-c106="" class="handle-button ai-button"></div><div _ngcontent-unb-c106="" class="handle-button line-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unb-c106="" class="handle-button theme-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unb-c106="" class="handle-button copy-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unb-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(dsm-lib libsecurityaudit_ndk.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so ${dsm-lib})</li></ol></pre></div></div>      <p></p></li>     <li><span>导入安全审计的头文件。</span>      <p></p>      <div _ngcontent-unb-c106="" class="highlight-div"><div _ngcontent-unb-c106="" class="highlight-div-header"><div _ngcontent-unb-c106="" class="highlight-div-header-left"><div _ngcontent-unb-c106="" class="handle-button expand-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unb-c106="" class="highlight-div-header-right"><div _ngcontent-unb-c106="" class="handle-button ai-button"></div><div _ngcontent-unb-c106="" class="handle-button line-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unb-c106="" class="handle-button theme-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unb-c106="" class="handle-button copy-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unb-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;DeviceSecurityKit/security_audit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span></li></ol></pre></div></div>      <p></p></li>     <li><span>开发者根据实际场景，获取单个或所有应用进程信息。</span>      <p></p>      <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">        <p>应用在根据应用进程信息进行业务处理后，需要释放查询接口出入参的内存。</p>       </div></div></div>      <ul>       <li>调用HMS_SecurityAudit_QueryProcesses接口，获取单个应用进程信息。</li>      </ul>      <div _ngcontent-unb-c106="" class="highlight-div"><div _ngcontent-unb-c106="" class="highlight-div-header"><div _ngcontent-unb-c106="" class="highlight-div-header-left"><div _ngcontent-unb-c106="" class="handle-button expand-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unb-c106="" class="highlight-div-header-right"><div _ngcontent-unb-c106="" class="handle-button ai-button"></div><div _ngcontent-unb-c106="" class="handle-button line-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unb-c106="" class="handle-button theme-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unb-c106="" class="handle-button copy-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">char</span> *result = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">uint64_t</span> pids[] = {<span class="hljs-number">3266</span>};</li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">HMS_SecurityAudit_QueryProcesses</span>(pids, <span class="hljs-built_in">sizeof</span>(pids)/<span class="hljs-built_in">sizeof</span>(pids[<span class="hljs-number">0</span>]), &amp;result);</li><li><span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span> &amp;&amp; result != <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"HMS_SecurityAudit_QueryProcesses result: %s\n"</span>, result);</li><li>} <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"HMS_SecurityAudit_QueryProcesses failed with error: %d\n"</span>, ret);</li><li>}</li><li><span class="hljs-keyword">if</span> (result != <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-keyword">delete</span>[] result;</li><li>    result = <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div>      <ul>       <li>调用HMS_SecurityAudit_QueryAllProcesses接口，获取所有的应用进程信息。</li>      </ul>      <div _ngcontent-unb-c106="" class="highlight-div"><div _ngcontent-unb-c106="" class="highlight-div-header"><div _ngcontent-unb-c106="" class="highlight-div-header-left"><div _ngcontent-unb-c106="" class="handle-button expand-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unb-c106="" class="highlight-div-header-right"><div _ngcontent-unb-c106="" class="handle-button ai-button"></div><div _ngcontent-unb-c106="" class="handle-button line-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unb-c106="" class="handle-button theme-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unb-c106="" class="handle-button copy-button"><div _ngcontent-unb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">char</span> *result = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">HMS_SecurityAudit_QueryAllProcesses</span>(&amp;result);</li><li><span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span> &amp;&amp; result != <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"HMS_SecurityAudit_QueryAllProcesses result: %s\n"</span>, result);</li><li>} <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"HMS_SecurityAudit_QueryAllProcesses failed with error: %d\n"</span>, ret);</li><li>}</li><li><span class="hljs-keyword">if</span> (result != <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-keyword">delete</span>[] result;</li><li>    result = <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div>      <p></p></li>    </ol>    <p></p>   </div>   <div></div></div>