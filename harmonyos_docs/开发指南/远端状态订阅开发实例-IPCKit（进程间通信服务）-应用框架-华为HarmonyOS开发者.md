<h1 _ngcontent-imy-c119="" class="doc-title ng-star-inserted" title="远端状态订阅开发实例"> 远端状态订阅开发实例 </h1>

<div _ngcontent-imy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>IPC/RPC提供了订阅远端Stub对象状态的机制。当远端Stub对象死亡时，可以自动触发本端Proxy注册的死亡通知。这种死亡通知订阅需要调用指定接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#registerdeathrecipient9-1" target="_blank">registerDeathRecipient</a>完成。不再需要订阅时，也需要调用指定接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#unregisterdeathrecipient9-1" target="_blank">unregisterDeathRecipient</a>取消订阅。</p>    <p>使用这种订阅机制的用户需要继承死亡通知类<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#deathrecipient" target="_blank">DeathRecipient</a>，并实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#onremotedied" target="_blank">onRemoteDied</a>方法清理资源。该方法会在远端Stub对象所在进程退出或当前RPC通信依赖的软总线连接断开时被回调。</p>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <ul>       <li>首先，Proxy订阅Stub死亡通知，若在订阅期间Stub状态正常，则在不再需要时取消订阅。</li>       <li>其次，若在订阅期间，Stub所在进程退出或当前RPC通信依赖的软总线连接断开，则会自动触发执行业务已向Proxy注册的自定义的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#onremotedied" target="_blank">onRemoteDied</a>方法。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>          <p>IPC/RPC的订阅机制适用于以下场景：</p>     <ol>      <li>IPC通信，Proxy对象需要感知远端Stub对象所在进程的状态。</li>      <li>       <p>RPC通信，Proxy对象需要感知远端Stub对象所在进程的状态，或者RPC通信依赖的软总线连接断开。</p>       <p>当Proxy感知到Stub端死亡后，应该清理本地Proxy对象以及相关资源。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>RPC不支持匿名Stub对象（没有向SAMgr注册）的死亡通知，IPC支持匿名Stub对象的死亡通知。</p>        </div></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="arkts侧接口">ArkTS侧接口<i class="anchor-icon anchor-icon-link" anchorid="arkts侧接口" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>         <p>此文档中的示例代码描述的是系统应用跨进程通信。</p></li>        <li>         <p>使用场景约束：客户端是第三方/系统应用，服务端是系统应用/服务</p></li>       </ul>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.1" valign="top" width="33.33333333333333%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.2" valign="top" width="33.33333333333333%">返回值类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.3" valign="top" width="33.33333333333333%">功能描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#registerdeathrecipient9-1" target="_blank">registerDeathRecipient</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">void</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">注册用于接收远程对象死亡通知的回调，该方法应该在proxy侧调用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#unregisterdeathrecipient9-1" target="_blank">unregisterDeathRecipient</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">void</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">注销用于接收远程对象死亡通知的回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#onremotedied" target="_blank">onRemoteDied</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">void</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">Proxy侧注册死亡通知成功后，当远端Stub对象所在进程死亡时，将自动回调本方法。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="参考代码" class="firsth2">参考代码<i class="anchor-icon anchor-icon-link" anchorid="参考代码" tips="复制节点链接"></i></h3>          <p>在IPC场景中，创建变量want和connect。</p>     <div _ngcontent-imy-c106="" class="highlight-div"><div _ngcontent-imy-c106="" class="highlight-div-header"><div _ngcontent-imy-c106="" class="highlight-div-header-left"><div _ngcontent-imy-c106="" class="handle-button expand-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-imy-c106="" class="highlight-div-header-right"><div _ngcontent-imy-c106="" class="handle-button ai-button"></div><div _ngcontent-imy-c106="" class="handle-button line-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-imy-c106="" class="handle-button theme-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-imy-c106="" class="handle-button copy-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-imy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>  <span class="hljs-comment">// 包名和组件名写实际的值</span></li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"ohos.rpc.test.server"</span>,</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ohos.rpc.test.server.ServiceAbility"</span>,</li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connect</span>: common.<span class="hljs-property">ConnectOptions</span> = {</li><li>  <span class="hljs-attr">onConnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName, remoteProxy</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: js onConnect called'</span>);</li><li>    proxy = remoteProxy;</li><li>  },</li><li>  <span class="hljs-attr">onDisconnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onDisconnect'</span>);</li><li>  },</li><li>  <span class="hljs-attr">onFailed</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onFailed'</span>);</li><li>  }</li><li>};</li></ol></pre></div></div>     <p>在RPC场景中，创建变量want和connect。</p>     <div _ngcontent-imy-c106="" class="highlight-div"><div _ngcontent-imy-c106="" class="highlight-div-header"><div _ngcontent-imy-c106="" class="highlight-div-header-left"><div _ngcontent-imy-c106="" class="handle-button expand-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-imy-c106="" class="highlight-div-header-right"><div _ngcontent-imy-c106="" class="handle-button ai-button"></div><div _ngcontent-imy-c106="" class="handle-button line-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-imy-c106="" class="handle-button theme-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-imy-c106="" class="handle-button copy-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-imy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">dmInstance</span>: distributedDeviceManager.<span class="hljs-property">DeviceManager</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">deviceList</span>: <span class="hljs-title class_">Array</span>&lt;distributedDeviceManager.<span class="hljs-property">DeviceBasicInfo</span>&gt; | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">networkId</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connect</span>: common.<span class="hljs-property">ConnectOptions</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">try</span>{</li><li>  dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">"ohos.rpc.test"</span>);</li><li>} <span class="hljs-keyword">catch</span>(error) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'createDeviceManager errCode:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage:'</span> + err.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用distributedDeviceManager获取目标设备NetworkId</span></li><li><span class="hljs-keyword">if</span> (dmInstance != <span class="hljs-literal">undefined</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    deviceList = dmInstance.<span class="hljs-title function_">getAvailableDeviceListSync</span>();</li><li>    <span class="hljs-keyword">if</span> (deviceList.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span>) {</li><li>      networkId = deviceList[<span class="hljs-number">0</span>].<span class="hljs-property">networkId</span>;</li><li>      want = {</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"ohos.rpc.test.server"</span>,</li><li>        <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ohos.rpc.test.service.ServiceAbility"</span>,</li><li>        <span class="hljs-attr">deviceId</span>: networkId,</li><li>      };</li><li>      connect = {</li><li>        <span class="hljs-attr">onConnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName, remoteProxy</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: js onConnect called'</span>);</li><li>          proxy = remoteProxy;</li><li>        },</li><li>        <span class="hljs-attr">onDisconnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onDisconnect'</span>);</li><li>        },</li><li>        <span class="hljs-attr">onFailed</span>: <span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onFailed'</span>);</li><li>        }</li><li>      };</li><li>    }</li><li>  }<span class="hljs-keyword">catch</span>(error) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'createDeviceManager err:'</span> + err);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>FA模型使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-ability-featureability#featureabilityconnectability7" target="_blank">connectAbility</a>接口连接Ability。</p>     <div _ngcontent-imy-c106="" class="highlight-div"><div _ngcontent-imy-c106="" class="highlight-div-header"><div _ngcontent-imy-c106="" class="highlight-div-header-left"><div _ngcontent-imy-c106="" class="handle-button expand-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-imy-c106="" class="highlight-div-header-right"><div _ngcontent-imy-c106="" class="handle-button ai-button"></div><div _ngcontent-imy-c106="" class="handle-button line-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-imy-c106="" class="handle-button theme-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-imy-c106="" class="handle-button copy-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-imy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { featureAbility } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 建立连接后返回的Id需要保存下来，在解绑服务时需要作为参数传入</span></li><li><span class="hljs-keyword">let</span> connectId = featureAbility.<span class="hljs-title function_">connectAbility</span>(want, connect);</li></ol></pre></div></div>     <p>Stage模型使用common.UIAbilityContext的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#connectserviceextensionability" target="_blank">connectServiceExtensionAbility</a>接口连接Ability。</p>     <p>在本文档的示例中，通过this.getUIContext().getHostContext()来获取UIAbilityContext，其中this代表继承自UIAbility的UIAbility实例。如需要在页面中使用UIAbilityContext提供的能力，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>     <div _ngcontent-imy-c106="" class="highlight-div"><div _ngcontent-imy-c106="" class="highlight-div-header"><div _ngcontent-imy-c106="" class="highlight-div-header-left"><div _ngcontent-imy-c106="" class="handle-button expand-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-imy-c106="" class="highlight-div-header-right"><div _ngcontent-imy-c106="" class="handle-button ai-button"></div><div _ngcontent-imy-c106="" class="handle-button line-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-imy-c106="" class="handle-button theme-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-imy-c106="" class="handle-button copy-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-imy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(); <span class="hljs-comment">// UIAbilityContext</span></li><li><span class="hljs-comment">// 建立连接后返回的Id需要保存下来，在解绑服务时需要作为参数传入</span></li><li><span class="hljs-keyword">let</span> connectId = context.<span class="hljs-title function_">connectServiceExtensionAbility</span>(want,connect);</li></ol></pre></div></div>     <p>成功连接服务后，onConnect回调函数中的Proxy对象会被赋值。此时，可以调用Proxy对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#registerdeathrecipient9-1" target="_blank">registerDeathRecipient</a>接口方法注册死亡回调，在Proxy不再使用的时候，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#unregisterdeathrecipient9-1" target="_blank">unregisterDeathRecipient</a>接口方法注销死亡回调。</p>     <div _ngcontent-imy-c106="" class="highlight-div"><div _ngcontent-imy-c106="" class="highlight-div-header"><div _ngcontent-imy-c106="" class="highlight-div-header-left"><div _ngcontent-imy-c106="" class="handle-button expand-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-imy-c106="" class="highlight-div-header-right"><div _ngcontent-imy-c106="" class="handle-button ai-button"></div><div _ngcontent-imy-c106="" class="handle-button line-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-imy-c106="" class="handle-button theme-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-imy-c106="" class="handle-button copy-button"><div _ngcontent-imy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-imy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDeathRecipient</span> <span class="hljs-keyword">implements</span> rpc.<span class="hljs-property">DeathRecipient</span>{</li><li>  <span class="hljs-title function_">onRemoteDied</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'server died'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> deathRecipient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDeathRecipient</span>();</li><li><span class="hljs-keyword">if</span> (proxy != <span class="hljs-literal">undefined</span>) {</li><li>  <span class="hljs-comment">// 此处的0为注册死亡监听的死亡通知的保留标志，暂无实际意义。且移除监听仅为示例，实际移除时机由业务自行判断</span></li><li>  proxy.<span class="hljs-title function_">registerDeathRecipient</span>(deathRecipient, <span class="hljs-number">0</span>);</li><li>  proxy.<span class="hljs-title function_">unregisterDeathRecipient</span>(deathRecipient, <span class="hljs-number">0</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="stub反向感知proxy死亡状态匿名stub的特殊用法">Stub反向感知Proxy死亡状态（匿名Stub的特殊用法）<i class="anchor-icon anchor-icon-link" anchorid="stub反向感知proxy死亡状态匿名stub的特殊用法" tips="复制节点链接"></i></h2>          <p>正向的死亡通知是Proxy感知Stub的状态，要实现反向的死亡通知（即Stub感知Proxy的状态），可以利用反向死亡通知。例如，进程A（原Stub所在进程）和进程B（原Proxy所在进程），进程B获取到进程A的原Proxy对象后，在B进程新建一个匿名Stub对象（未向SAMgr注册），称为回调Stub，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#sendmessagerequest9-2" target="_blank">sendMessageRequest</a>接口将回调Stub传给进程A的原Stub，进程A就可以获取到进程B的回调Proxy。只要向回调Proxy注册了死亡通知，当进程B（回调Stub）死亡或者RPC通信依赖的软总线连接断开时，回调Proxy会感知并通知进程A（原Stub），从而实现反向死亡通知。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>反向死亡通知仅限设备内跨进程通信使用，不可用于跨设备。</li>        <li>当匿名Stub对象没有被任何一个Proxy引用时，对象会被自动释放。</li>       </ul>      </div></div></div>    </div>   </div>   <div></div></div>