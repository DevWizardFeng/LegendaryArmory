<h1 _ngcontent-xbq-c119="" class="doc-title ng-star-inserted" title="适配加密分享"> 适配加密分享 </h1>

<div _ngcontent-xbq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="功能介绍">介绍<i class="anchor-icon anchor-icon-link" anchorid="功能介绍" tips="复制节点链接"></i></h2><p>DLP加密分享是基于系统级数据防泄漏框架构建的数据安全功能，用户在分享文件时可以使用该功能对文件进行加密保护，加密后的文件仅指定的华为账号用户可以查看，从而实现防止转发的安全效果。</p> <p>加密后的文件作为HarmonyOS操作系统中的一类新的标准文件格式（.dlp后缀文件），在接收方设备上，需要通过系统服务进行账号身份认证和权限管控才能操作对应文件。因此，通信、聊天类等应用需要在处理加密文件时，可以调用HarmonyOS系统能力进行对应处理，以确保无缝的用户体验。</p> <p>应用需要分别在两个部分适配加密分享，确保DLP文件可以被正确发送和查看：</p> <ul><li><a href="/consumer/cn/doc/harmonyos-guides/dlp-adapting-encrypted-sharing#适配点1发送加密文件dlp后缀文件">发送流程</a>：适配后，应用可以调用系统能力生成和接收DLP文件，用户可以在系统应用和三方应用间无缝发送DLP文件。</li><li><a href="/consumer/cn/doc/harmonyos-guides/dlp-adapting-encrypted-sharing#适配点2查看加密文件dlp后缀文件">查看流程</a>：适配后，应用可以直接调用文件预览查看DLP文件，极大缩短用户查看DLP文件的操作流程，无需用户手动跳转至文件预览查看。</li></ul> </div> <div class="tiledSection"><h2 id="适配点1发送加密文件dlp后缀文件">发送加密文件<i class="anchor-icon anchor-icon-link" anchorid="适配点1发送加密文件dlp后缀文件" tips="复制节点链接"></i></h2><p>用户加密分享文件主要有两种方式：</p> <ul><li>方式一：以文件为起点，用户直接选择文件，加密分享到应用。</li><li>方式二：以应用为起点，用户在应用内通过文件Picker的方式，选择文件并设置加密分享。</li></ul> </div> <div class="tiledSection"><h3 id="方式1选择文件加密分享到应用" class="firsth2">选择文件加密分享到应用<i class="anchor-icon anchor-icon-link" anchorid="方式1选择文件加密分享到应用" tips="复制节点链接"></i></h3><p>用户直接选择文件，加密分享到应用。用户在设备上的操作流程如下：</p> <ol><li>在文件管理、图库等系统应用中，选择需要加密分享的文件。</li><li>点击分享并选中底部功能区的“加密分享”功能，进入加密分享授权界面，添加访问方的华为账号，来指定可查看文件的用户。</li><li>通过系统分享加密后的文件到三方应用，如分享到聊天类应用后，再发送给他人。</li></ol> <p>为了支撑用户顺利完成上述流程，应用应满足以下要求：</p> <ul><li>支持从系统分享并发送.dlp后缀的加密文件到应用，应用不对.dlp文件进行过滤。</li><li>确保DLP文件内容不被损坏，并保持.dlp文件后缀不变。</li></ul> </div> <div class="tiledSection"><h3 id="方式2应用内使用文件picker进行文件加密分享">应用内使用文件Picker进行文件加密分享<i class="anchor-icon anchor-icon-link" anchorid="方式2应用内使用文件picker进行文件加密分享" tips="复制节点链接"></i></h3><p>用户在应用内通过文件Picker的方式，选择文件并设置加密分享。用户在设备上的操作流程如下：</p> <ol><li>在应用内通过文件Picker选择文件。</li><li>点击文件Picker底部的“加密分享”按钮进入加密分享授权界面，添加访问方的华为账号，来指定可查看文件的用户。</li><li>添加完毕后，直接在应用内将加密文件发送给他人。</li></ol> <p>为了支撑用户顺利完成上述流程，应用需进行以下适配：</p> <ol><li>显示文件Picker的加密分享按钮。</li><li>通过文件Picker获取文件URI。</li><li>应用获取文件URI后即可发送DLP文件。<div _ngcontent-xbq-c106="" class="highlight-div"><div _ngcontent-xbq-c106="" class="highlight-div-header"><div _ngcontent-xbq-c106="" class="highlight-div-header-left"><div _ngcontent-xbq-c106="" class="handle-button expand-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xbq-c106="" class="highlight-div-header-right"><div _ngcontent-xbq-c106="" class="handle-button ai-button"></div><div _ngcontent-xbq-c106="" class="handle-button line-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xbq-c106="" class="handle-button theme-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xbq-c106="" class="handle-button copy-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xbq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;</li><li><span class="hljs-keyword">import</span> picker <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.file.picker'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">callFilePicker</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> documentSelectOptions = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentSelectOptions</span>();</li><li>      documentSelectOptions.<span class="hljs-property">isEncryptionSupported</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 显示加密分享按钮。</span></li><li>      <span class="hljs-keyword">let</span> documentPicker = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentViewPicker</span>(context);</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">documentSelectResult</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">await</span> documentPicker.<span class="hljs-title function_">select</span>(documentSelectOptions); <span class="hljs-comment">// 获取文件URI。</span></li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'CallFilePickerSelectFile failed'</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="适配点2查看加密文件dlp后缀文件">查看加密文件<i class="anchor-icon anchor-icon-link" anchorid="适配点2查看加密文件dlp后缀文件" tips="复制节点链接"></i></h2><p>用户查看加密文件有两种方式：</p> <ul><li>方式一：在应用内通过文件预览查看DLP文件。</li><li>方式一：将应用内的DLP文件保存到本地系统文件管理中查看。</li></ul> </div> <div class="tiledSection"><h3 id="方式1应用内使用文件预览查看dlp文件" class="firsth2">应用内使用文件预览查看DLP文件<i class="anchor-icon anchor-icon-link" anchorid="方式1应用内使用文件预览查看dlp文件" tips="复制节点链接"></i></h3><p>用户在设备上的操作流程如下：</p> <ol><li>在应用内点击要查看的DLP文件，应用直接拉起文件预览查看文件。</li></ol> <p>为了支撑用户顺利完成上述流程，应用需进行以下适配：</p> <ol><li>打开DLP文件时，需要先获取待打开DLP文件的URI。</li><li>构造want参数。</li><li>通过startAbility将want信息传入，使用系统统一打开能力进行打开。<div _ngcontent-xbq-c106="" class="highlight-div"><div _ngcontent-xbq-c106="" class="highlight-div-header"><div _ngcontent-xbq-c106="" class="highlight-div-header-left"><div _ngcontent-xbq-c106="" class="handle-button expand-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xbq-c106="" class="highlight-div-header-right"><div _ngcontent-xbq-c106="" class="handle-button ai-button"></div><div _ngcontent-xbq-c106="" class="handle-button line-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xbq-c106="" class="handle-button theme-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xbq-c106="" class="handle-button copy-button"><div _ngcontent-xbq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xbq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Want'</span>;</li><li><span class="hljs-keyword">import</span> { common, wantConstant } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">viewDlp</span>(<span class="hljs-params">dlpUri: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>      <span class="hljs-string">"action"</span>: <span class="hljs-string">"ohos.want.action.viewData"</span>,</li><li>      <span class="hljs-string">"uri"</span>: dlpUri, <span class="hljs-comment">// 打开DLP文件时，需要先获取待打开DLP文件的URI。</span></li><li>      <span class="hljs-string">"flags"</span>: wantConstant.<span class="hljs-property">Flags</span>.<span class="hljs-property">FLAG_AUTH_READ_URI_PERMISSION</span>, <span class="hljs-comment">// 为打开的DLP文件进行uri授权，默认只读。</span></li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过startAbility将want信息传入，调用系统统一打开能力。</span></li><li>      context.<span class="hljs-title function_">startAbility</span>(want);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startAbility failed'</span>);</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="方式2将dlp文件保存到本地文件管理中查看">将DLP文件保存到本地文件管理中查看<i class="anchor-icon anchor-icon-link" anchorid="方式2将dlp文件保存到本地文件管理中查看" tips="复制节点链接"></i></h3><p>用户在设备上的操作流程如下：</p> <ol><li>在应用内选择DLP文件。</li><li>将文件保存到本地系统文件管理。</li><li>在系统文件管理中点击DLP文件通过系统文件预览查看。</li></ol> <p>为了支撑用户顺利完成上述流程，应用应满足以下要求：</p> <ul><li>应用支持下载或保存加密文件到系统文件管理。</li><li>下载或保存加密文件时不改变.dlp文件后缀。</li></ul> </div> </div> <div></div></div>