<h1 _ngcontent-gha-c119="" class="doc-title ng-star-inserted" title="通用文字识别"> 通用文字识别 </h1>

<div _ngcontent-gha-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1384112112520">适用场景<i class="anchor-icon anchor-icon-link" anchorid="section1384112112520" tips="复制节点链接"></i></h2>          <p>通用文字识别，是通过拍照、扫描等光学输入方式，将各种票据、卡证、表格、报刊、书籍等印刷品文字转化为图像信息，再利用文字识别技术将图像信息转化为计算机等设备可以使用的字符信息的技术。</p>     <ul>      <li>可以对文档翻拍、街景翻拍等图片进行文字检测和识别，也可以集成于其他应用中，提供文字检测、识别的功能，并根据识别结果提供翻译、搜索等相关服务。</li>      <li>可以处理来自相机、图库等多种来源的图像数据，提供一个自动检测文本、识别图像中文本位置以及文本内容功能的开放能力。</li>      <li>支持特定角度范围内的文本倾斜、拍摄角度倾斜、复杂光照条件以及复杂文本背景等场景的文字识别。</li>     </ul>     <p>效果如下图所示：</p>     <p><span><img originheight="661" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114224.48437566350410081224150073678533:50001231000000:2800:3AF659F9E8CADA3A6550CA3735A86134E2A54E4A441C658225CD5986DB0361AE.png" width="320" height="661"></span></p>    </div>    <div class="tiledSection">     <h2 id="section2020122517405">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2020122517405" tips="复制节点链接"></i></h2>          <p>该能力当前不支持模拟器。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="38.96%">          <p>AI能力</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="61.040000000000006%">          <p>约束</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="38.96%">          <p>文字识别</p></td>         <td class="cellrowborder" valign="top" width="61.040000000000006%">          <ul>           <li>支持的图片格式：JPEG、JPG、PNG。</li>           <li>支持的语言：简体中文、英文、日文、韩文、繁体中文。</li>           <li>文本长度：不超过10000字符。</li>           <li>支持文档印刷体识别，在识别手写字体方面能力有所欠缺。</li>           <li>输入图像具有合适成像的质量（建议720p以上），<span style="color: rgb(55,65,81);">100px</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">高度</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">15210px，100px</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">宽度</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">10000px</span>，高宽比例建议10:1以下（高度小于宽度的10倍），接近手机屏幕高宽比例为宜。</li>           <li>拍摄角度与文本所在平面垂直方向的夹角应小于30度。</li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section192175478520">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section192175478520" tips="复制节点链接"></i></h2>          <ol>      <li><span>在使用通用文字识别时，将实现文字识别的相关的类添加至工程。</span>       <p></p>       <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { textRecognition } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span></li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>简单配置页面的布局，并在Button组件添加点击事件，拉起图库，选择图片。</span>       <p></p>       <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'选择图片'</span>)</li><li>  .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>  .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>  .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 拉起图库，获取图片资源</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectImage</span>();</li><li>  })</li></ol></pre></div></div>       <p></p></li>      <li><span>通过图库获取图片资源，将图片转换为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>，并添加初始化和释放方法。</span>       <p></p>       <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> textRecognition.<span class="hljs-title function_">init</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`OCR service initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">await</span> textRecognition.<span class="hljs-title function_">release</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">'OCR service released successfully'</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">selectImage</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">openPhoto</span>();</li><li>  <span class="hljs-keyword">if</span> (uri === <span class="hljs-literal">undefined</span>) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">"Failed to get uri."</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(uri);</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">openPhoto</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>    photoPicker.<span class="hljs-title function_">select</span>({</li><li>      <span class="hljs-title class_">MIMEType</span>: photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>,</li><li>      <span class="hljs-attr">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>    }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: photoAccessHelper.PhotoSelectResult</span>) =&gt;</span> {</li><li>      <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>]);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Failed to get photo image uri. code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">''</span>);</li><li>    })</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(name, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>    imageSource = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>  }, <span class="hljs-number">100</span>)</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>实例化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-text-recognition-api#section674171818172" target="_blank">VisionInfo</a>对象，并传入待检测图片的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>。</span>       <p></p>       <div class="p">        VisionInfo为待OCR检测识别的入参项，目前仅支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>类型的视觉信息。        <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">visionInfo</span>: textRecognition.<span class="hljs-property">VisionInfo</span> = {</li><li>  <span class="hljs-attr">pixelMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span></li><li>};</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>配置通用文本识别的配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-text-recognition-api#section1081123302517" target="_blank">TextRecognitionConfiguration</a>，用于配置是否支持朝向检测。</span>       <p></p>       <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">textConfiguration</span>: textRecognition.<span class="hljs-property">TextRecognitionConfiguration</span> = {</li><li>  <span class="hljs-attr">isDirectionDetectionSupported</span>: <span class="hljs-literal">false</span></li><li>};</li></ol></pre></div></div>       <p></p></li>      <li><span>调用textRecognition的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-text-recognition-api#section1446761711464" target="_blank">recognizeText</a>接口，对识别到的结果进行处理。</span>       <p></p>       <p>当调用成功时，获取文字识别的结果；调用失败时，将返回对应错误码。</p>       <div class="p">        recognizeText接口提供了三种调用形式，当前以其中一种作为示例，其他方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-text-recognition-api" target="_blank">API文档</a>。        <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>textRecognition.<span class="hljs-title function_">recognizeText</span>(visionInfo, textConfiguration)</li><li>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: textRecognition.TextRecognitionResult</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 识别成功，获取对应的结果</span></li><li>    <span class="hljs-keyword">let</span> recognitionString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Succeeded in recognizing text: <span class="hljs-subst">${recognitionString}</span>`</span>);</li><li>    <span class="hljs-comment">// 将结果更新到Text中显示</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = data.<span class="hljs-property">value</span>;</li><li>  })</li><li>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Failed to recognize text. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = <span class="hljs-string">`Error: <span class="hljs-subst">${error.message}</span>`</span>;</li><li>  });</li></ol></pre></div></div>       </div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section56481271497">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section56481271497" tips="复制节点链接"></i></h2>          <p>点击按钮，识别一张图片的文字内容，并通过日志打印。</p>    </div>    <div class="tiledSection">     <h3 id="section1049116141584" class="firsth2">Index.ets<i class="anchor-icon anchor-icon-link" anchorid="section1049116141584" tips="复制节点链接"></i></h3>          <div _ngcontent-gha-c106="" class="highlight-div"><div _ngcontent-gha-c106="" class="highlight-div-header"><div _ngcontent-gha-c106="" class="highlight-div-header-left"><div _ngcontent-gha-c106="" class="handle-button expand-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gha-c106="" class="highlight-div-header-right"><div _ngcontent-gha-c106="" class="handle-button ai-button"></div><div _ngcontent-gha-c106="" class="handle-button line-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gha-c106="" class="handle-button theme-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gha-c106="" class="handle-button copy-button"><div _ngcontent-gha-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gha-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { textRecognition } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span></li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">chooseImage</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">dataValues</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> textRecognition.<span class="hljs-title function_">init</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`OCR service initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">await</span> textRecognition.<span class="hljs-title function_">release</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">'OCR service released successfully'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span>)</li><li>        .<span class="hljs-title function_">copyOption</span>(<span class="hljs-title class_">CopyOptions</span>.<span class="hljs-property">LocalDevice</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'60%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'选择图片'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 拉起图库，获取图片资源</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectImage</span>();</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'开始识别'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">textRecognitionTest</span>();</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">textRecognitionTest</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 调用文本识别接口</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">visionInfo</span>: textRecognition.<span class="hljs-property">VisionInfo</span> = {</li><li>      <span class="hljs-attr">pixelMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">textConfiguration</span>: textRecognition.<span class="hljs-property">TextRecognitionConfiguration</span> = {</li><li>      <span class="hljs-attr">isDirectionDetectionSupported</span>: <span class="hljs-literal">false</span></li><li>    };</li><li>    textRecognition.<span class="hljs-title function_">recognizeText</span>(visionInfo, textConfiguration)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: textRecognition.TextRecognitionResult</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// 识别成功，获取对应的结果</span></li><li>        <span class="hljs-keyword">let</span> recognitionString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Succeeded in recognizing text: <span class="hljs-subst">${recognitionString}</span>`</span>);</li><li>        <span class="hljs-comment">// 将结果更新到Text中显示</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = data.<span class="hljs-property">value</span>;</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Failed to recognize text. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = <span class="hljs-string">`Error: <span class="hljs-subst">${error.message}</span>`</span>;</li><li>      });</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">selectImage</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">openPhoto</span>();</li><li>    <span class="hljs-keyword">if</span> (uri === <span class="hljs-literal">undefined</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">"Failed to get uri."</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(uri);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">openPhoto</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>      photoPicker.<span class="hljs-title function_">select</span>({</li><li>        <span class="hljs-title class_">MIMEType</span>: photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>,</li><li>        <span class="hljs-attr">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>      }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: photoAccessHelper.PhotoSelectResult</span>) =&gt;</span> {</li><li>        <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>]);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Failed to get photo image uri. code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">''</span>);</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(name, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>();</li><li>        <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">close</span>(fileSource);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'OCRDemo'</span>, <span class="hljs-string">`Failed to open file. Error: <span class="hljs-subst">${error}</span>`</span>);</li><li>      }</li><li>    }, <span class="hljs-number">100</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>