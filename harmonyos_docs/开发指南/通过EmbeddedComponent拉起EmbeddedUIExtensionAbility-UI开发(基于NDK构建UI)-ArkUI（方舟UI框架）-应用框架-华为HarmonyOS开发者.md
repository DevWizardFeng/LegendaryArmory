<h1 _ngcontent-bkt-c119="" class="doc-title ng-star-inserted" title="通过EmbeddedComponent拉起EmbeddedUIExtensionAbility"> 通过EmbeddedComponent拉起EmbeddedUIExtensionAbility </h1>

<div _ngcontent-bkt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkUI在Native侧提供的能力是ArkTS的子集，某些能力不会在Native侧提供，例如声明式UI语法、自定义struct组件及UI系统预置UI组件库。</p>    <p>从API version 20开始，ArkUI开发框架提供了Native侧嵌入EmbeddedComponent组件的能力，此能力依赖于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component" target="_blank">EmbeddedComponent</a>机制。EmbeddedComponent用于支持在当前页面嵌入同一应用内其他<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-embeddeduiextensionability" target="_blank">EmbeddedUIExtensionAbility</a>提供的UI。EmbeddedUIExtensionAbility在独立进程中运行，负责页面布局和渲染。此功能主要用于有进程隔离需求的模块化开发场景。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>        <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_embeddedcomponentoption_create" target="_blank">OH_ArkUI_EmbeddedComponentOption_Create</a>获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/i-arkui-nativemodule-arkui-embeddedcomponentoption" target="_blank">ArkUI_EmbeddedComponentOption</a>后，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_embeddedcomponentoption_setonerror" target="_blank">OH_ArkUI_EmbeddedComponentOption_SetOnError</a>设置onError回调，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_embeddedcomponentoption_setonterminated" target="_blank">OH_ArkUI_EmbeddedComponentOption_SetOnTerminated</a>设置onTerminated回调。可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeutils_moveto" target="_blank">OH_ArkUI_NodeUtils_MoveTo</a>迁移节点。</p></li>       <li>        <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_embeddedcomponentoption_setonterminated" target="_blank">OH_ArkUI_EmbeddedComponentOption_SetOnTerminated</a>设置onTerminated回调时，返回的want参数，只支持提供方返回的want参数的key，value解析，不支持嵌套解析。</p></li>       <li>        <p>在EmbeddedComponent销毁时，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-type-h#oh_arkui_embeddedcomponentoption_dispose" target="_blank">OH_ArkUI_EmbeddedComponentOption_Dispose</a>释放内存。</p></li>       <li>        <p>EmbeddedComponent组件需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nativenodeapi-1#setattribute" target="_blank">setAttribute</a>设置宽高才能显示。</p></li>      </ul>     </div></div></div>    <p>本示例展示EmbeddedComponent组件NDK的基础使用方式，ability相关使用请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-embedded-component" target="_blank">EmbeddedComponent</a>。示例应用的bundleName为"com.example.embeddeddemo"，同一应用下被拉起的EmbeddedUIExtensionAbility为"ExampleEmbeddedAbility"。本示例仅支持在具有多进程权限的设备上运行，例如PC/2in1。</p>    <div _ngcontent-bkt-c106="" class="highlight-div"><div _ngcontent-bkt-c106="" class="highlight-div-header"><div _ngcontent-bkt-c106="" class="highlight-div-header-left"><div _ngcontent-bkt-c106="" class="handle-button expand-button"><div _ngcontent-bkt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bkt-c106="" class="highlight-div-header-right"><div _ngcontent-bkt-c106="" class="handle-button ai-button"></div><div _ngcontent-bkt-c106="" class="handle-button line-button"><div _ngcontent-bkt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bkt-c106="" class="handle-button theme-button"><div _ngcontent-bkt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bkt-c106="" class="handle-button copy-button"><div _ngcontent-bkt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bkt-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/ability_base/want.h&gt;</span> <span class="hljs-comment">//引用元能力want头文件</span></span></li><li><span class="hljs-comment">//创建节点</span></li><li>ArkUI_NodeHandle embeddedNode = nodeAPI-&gt;createNode(ARKUI_NODE_EMBEDDED_COMPONENT);</li><li>
</li><li><span class="hljs-comment">// 设置属性</span></li><li>AbilityBase_Element Element = {.bundleName = <span class="hljs-string">"com.example.embeddeddemo"</span>, .abilityName = <span class="hljs-string">"EmbeddedUIExtensionAbility"</span>, .moduleName = <span class="hljs-string">""</span>};<span class="hljs-comment">// 由元能力提供接口</span></li><li>AbilityBase_Want* want = OH_AbilityBase_CreateWant(Element); <span class="hljs-comment">// 由元能力提供接口</span></li><li>ArkUI_AttributeItem itemobjwant = {.object = want};</li><li>nodeAPI-&gt;setAttribute(embeddedNode, NODE_EMBEDDED_COMPONENT_WANT, &amp;itemobjwant);</li><li>
</li><li><span class="hljs-comment">//注册事件</span></li><li><span class="hljs-type">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> code, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* message)</span> {}</li><li><span class="hljs-type">void</span> <span class="hljs-title function_">onTerminated</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> code, AbilityBase_Want* want)</span> {}</li><li>
</li><li><span class="hljs-keyword">auto</span> embeddedNode_option = OH_ArkUI_EmbeddedComponentOption_Create();</li><li><span class="hljs-keyword">auto</span> onErrorCallback = onError;</li><li><span class="hljs-keyword">auto</span> onTerminatedCallback = onTerminated;</li><li>OH_ArkUI_EmbeddedComponentOption_SetOnError(embeddedNode_option, onErrorCallback);</li><li>OH_ArkUI_EmbeddedComponentOption_SetOnTerminated(embeddedNode_option, onTerminatedCallback);</li><li>  </li><li>ArkUI_AttributeItem itemobjembeddedNode = {.object = embeddedNode_option};</li><li>nodeAPI-&gt;setAttribute(embeddedNode, NODE_EMBEDDED_COMPONENT_OPTION, &amp;itemobjembeddedNode);</li><li>
</li><li><span class="hljs-comment">//设置基本属性，如宽高</span></li><li>ArkUI_NumberValue value[] = {<span class="hljs-number">480</span>};</li><li>ArkUI_AttributeItem item = {value, <span class="hljs-keyword">sizeof</span>(value) / <span class="hljs-keyword">sizeof</span>(ArkUI_NumberValue)};</li><li>value[<span class="hljs-number">0</span>].f32 = <span class="hljs-number">300</span>;</li><li>nodeAPI-&gt;setAttribute(embeddedNode, NODE_WIDTH, &amp;item);</li><li>nodeAPI-&gt;setAttribute(embeddedNode, NODE_HEIGHT, &amp;item);</li><li>
</li><li><span class="hljs-comment">// 创建Column</span></li><li>ArkUI_NodeHandle column = nodeAPI-&gt;createNode(ARKUI_NODE_COLUMN);</li><li>nodeAPI-&gt;setAttribute(column, NODE_WIDTH, &amp;item);</li><li>ArkUI_NumberValue column_bc[] = {{.u32 = <span class="hljs-number">0xFFF00BB</span>}};</li><li>ArkUI_AttributeItem column_item = {column_bc, <span class="hljs-number">1</span>};</li><li>nodeAPI-&gt;setAttribute(column, NODE_BACKGROUND_COLOR, &amp;column_item);</li><li>ArkUI_AttributeItem column_id = {.<span class="hljs-built_in">string</span> = <span class="hljs-string">"Column_CAPI"</span>};</li><li>nodeAPI-&gt;setAttribute(column, NODE_ID, &amp;column_id);</li><li>
</li><li><span class="hljs-comment">//上树</span></li><li>nodeAPI-&gt;addChild(column, embeddedNode);</li></ol></pre></div></div>   </div>   <div></div></div>