<h1 _ngcontent-bbf-c119="" class="doc-title ng-star-inserted" title="通过关系型数据库实现数据持久化 (C/C++)"> 通过关系型数据库实现数据持久化 (C/C++) </h1>

<div _ngcontent-bbf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>RelationalStore提供了一套完整的对本地数据库进行管理的机制，对外提供了一系列的增、删、改、查等接口，也可以直接运行用户输入的SQL语句来满足复杂的场景需要。</p>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <ul>      <li>       <p><strong>谓词</strong>：数据库中用来代表数据实体的性质、特征或者数据实体之间关系的词项，主要用来定义数据库的操作条件。</p></li>      <li>       <p><strong>结果集</strong>：指用户查询之后的结果集合，可以对数据进行访问。结果集提供了灵活的数据访问方式，可以更方便地拿到用户想要的数据。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>系统默认日志方式是WAL（Write Ahead Log）模式，系统默认落盘方式是FULL模式。</p></li>      <li>       <p>数据库中连接池的最大数量是4个，用以管理用户的读操作。</p></li>      <li>       <p>为保证数据的准确性，数据库同一时间仅支持一个写操作。</p></li>      <li>       <p>当应用被卸载完成后，设备上的相关数据库文件及临时文件会被自动清除。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-rdb" target="_blank">RDB</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_ConfigV2 *OH_Rdb_CreateConfig()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个OH_Rdb_ConfigV2实例，并返回指向该实例的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetDatabaseDir(OH_Rdb_ConfigV2 *config, const char *databaseDir)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置数据库文件路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetStoreName(OH_Rdb_ConfigV2 *config, const char *storeName)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置数据库名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetBundleName(OH_Rdb_ConfigV2 *config, const char *bundleName)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置应用包名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetModuleName(OH_Rdb_ConfigV2 *config, const char *moduleName)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置应用模块名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetSecurityLevel(OH_Rdb_ConfigV2 *config, int securityLevel)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置数据库安全级别OH_Rdb_SecurityLevel。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetEncrypted(OH_Rdb_ConfigV2 *config, bool isEncrypted)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置数据库是否加密。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetArea(OH_Rdb_ConfigV2 *config, int area)</td>         <td class="cellrowborder" valign="top" width="50%">给指定的数据库文件配置OH_Rdb_ConfigV2，设置数据库安全区域等级Rdb_SecurityArea。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Store *OH_Rdb_CreateOrOpen(const OH_Rdb_ConfigV2 *config, int *errCode)</td>         <td class="cellrowborder" valign="top" width="50%">使用数据库配置OH_Rdb_ConfigV2，获得一个对应的OH_Rdb_Store实例，用来操作关系型数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Execute(OH_Rdb_Store *store, const char *sql)</td>         <td class="cellrowborder" valign="top" width="50%">执行包含指定参数但不返回值的SQL语句。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Insert(OH_Rdb_Store *store, const char *table, OH_VBucket *valuesBucket)</td>         <td class="cellrowborder" valign="top" width="50%">向目标表中插入一行数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_InsertWithConflictResolution(OH_Rdb_Store *store, const char *table, OH_VBucket *row, Rdb_ConflictResolution resolution, int64_t *rowId)</td>         <td class="cellrowborder" valign="top" width="50%">向目标表中插入一行数据，支持配置冲突解决策略。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_UpdateWithConflictResolution(OH_Rdb_Store *store, OH_VBucket *row, OH_Predicates *predicates, Rdb_ConflictResolution resolution, int64_t *changes)</td>         <td class="cellrowborder" valign="top" width="50%">向目标表中插入一行数据，支持配置冲突解决策略。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Update(OH_Rdb_Store *store, OH_VBucket *valuesBucket, OH_Predicates *predicates)</td>         <td class="cellrowborder" valign="top" width="50%">根据OH_Predicates的指定实例对象更新数据库中的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Delete(OH_Rdb_Store *store, OH_Predicates *predicates)</td>         <td class="cellrowborder" valign="top" width="50%">根据OH_Predicates的指定实例对象从数据库中删除数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Predicates_NotLike(OH_Predicates *predicates, const char *field, const char *pattern)</td>         <td class="cellrowborder" valign="top" width="50%">设置OH_Predicates以匹配数据类型为字符串且值不类似于指定值的字段。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Predicates_Glob(OH_Predicates *predicates, const char *field, const char *pattern)</td>         <td class="cellrowborder" valign="top" width="50%">设置OH_Predicates以匹配指定字段（数据类型为字符串）且值包含通配符的字段。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Predicates_NotGlob(OH_Predicates *predicates, const char *field, const char *pattern)</td>         <td class="cellrowborder" valign="top" width="50%">设置OH_Predicates以不匹配指定字段（数据类型为字符串）且值包含通配符的字段。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_Query(OH_Rdb_Store *store, OH_Predicates *predicates, const char *const *columnNames, int length)</td>         <td class="cellrowborder" valign="top" width="50%">根据指定条件查询数据库中的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_DeleteStore(const OH_Rdb_Config *config)</td>         <td class="cellrowborder" valign="top" width="50%">删除数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_VBucket_PutAsset(OH_VBucket *bucket, const char *field, Rdb_Asset *value)</td>         <td class="cellrowborder" valign="top" width="50%">把Rdb_Asset类型的数据放到指定的OH_VBucket对象中。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_VBucket_PutAssets(OH_VBucket *bucket, const char *field, Rdb_Asset *value, uint32_t count)</td>         <td class="cellrowborder" valign="top" width="50%">把Rdb_Asset数组类型的数据放到指定的OH_VBucket对象中。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Rdb_FindModifyTime(OH_Rdb_Store *store, const char *tableName, const char *columnName, OH_VObject *values)</td>         <td class="cellrowborder" valign="top" width="50%">获取数据库指定表中指定列的数据的最后修改时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_RDB_TransOptions *OH_RdbTrans_CreateOptions(void)</td>         <td class="cellrowborder" valign="top" width="50%">创建一个OH_RDB_TransOptions实例，配置事务对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Cursor *OH_RdbTrans_Query(OH_Rdb_Transaction *trans, const OH_Predicates *predicates, const char *columns[], int len)</td>         <td class="cellrowborder" valign="top" width="50%">根据指定的条件查询数据库中的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_Data_Values *OH_Values_Create(void)</td>         <td class="cellrowborder" valign="top" width="50%">创建OH_Data_Values实例。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetName(Data_Asset *asset, const char *name)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetUri(Data_Asset *asset, const char *uri)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置绝对路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetPath(Data_Asset *asset, const char *path)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置应用沙箱里的相对路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetCreateTime(Data_Asset *asset, int64_t createTime)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置创建时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetModifyTime(Data_Asset *asset, int64_t modifyTime)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置最后修改时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetSize(Data_Asset *asset, size_t size)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置占用空间大小。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_SetStatus(Data_Asset *asset, Data_AssetStatus status)</td>         <td class="cellrowborder" valign="top" width="50%">为资产类型数据设置状态码。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetName(Data_Asset *asset, char *name, size_t *length)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetUri(Data_Asset *asset, char *uri, size_t *length)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的绝对路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetPath(Data_Asset *asset, char *path, size_t *length)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据在应用沙箱内的相对路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetCreateTime(Data_Asset *asset, int64_t *createTime)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的创建时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetModifyTime(Data_Asset *asset, int64_t *modifyTime)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的最后修改时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetSize(Data_Asset *asset, size_t *size)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的占用空间大小。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_GetStatus(Data_Asset *asset, Data_AssetStatus *status)</td>         <td class="cellrowborder" valign="top" width="50%">获取资产类型数据的状态码。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Data_Asset *OH_Data_Asset_CreateOne()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个资产类型实例。使用完毕后需要调用OH_Data_Asset_DestroyOne释放内存。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_DestroyOne(Data_Asset *asset)</td>         <td class="cellrowborder" valign="top" width="50%">销毁一个资产类型实例并回收内存。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Data_Asset **OH_Data_Asset_CreateMultiple(uint32_t count)</td>         <td class="cellrowborder" valign="top" width="50%">创造指定数量的资产类型实例。使用完毕后需要调用OH_Data_Asset_DestroyMultiple释放内存。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Data_Asset_DestroyMultiple(Data_Asset **assets, uint32_t count)</td>         <td class="cellrowborder" valign="top" width="50%">销毁指定数量的资产类型实例并回收内存。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_CreateTransaction(OH_Rdb_Store *store, const OH_RDB_TransOptions *options, OH_Rdb_Transaction **trans)</td>         <td class="cellrowborder" valign="top" width="50%">创建一个相关的OH_Rdb_Transaction实例，开启事务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTransOption_SetType(OH_RDB_TransOptions *options, OH_RDB_TransType type)</td>         <td class="cellrowborder" valign="top" width="50%">设置事务对象类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Insert(OH_Rdb_Transaction *trans, const char *table, const OH_VBucket *row, int64_t *rowId)</td>         <td class="cellrowborder" valign="top" width="50%">向目标表中插入一行数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_InsertWithConflictResolution(OH_Rdb_Transaction *trans, const char *table, const OH_VBucket *row, Rdb_ConflictResolution resolution, int64_t *rowId)</td>         <td class="cellrowborder" valign="top" width="50%">将一行数据插入到目标表中，支持冲突解决。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_UpdateWithConflictResolution(OH_Rdb_Transaction *trans, const OH_VBucket *row, const OH_Predicates *predicates, Rdb_ConflictResolution resolution, int64_t *changes)</td>         <td class="cellrowborder" valign="top" width="50%">根据指定条件更新数据库中的数据，并支持冲突解决。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Delete(OH_Rdb_Transaction *trans, const OH_Predicates *predicates, int64_t *changes)</td>         <td class="cellrowborder" valign="top" width="50%">根据OH_Predicates的指定实例对象从数据库中删除数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Value_Destroy(OH_Data_Value *value)</td>         <td class="cellrowborder" valign="top" width="50%">销毁OH_Data_Value对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Values_Destroy(OH_Data_Values *values)</td>         <td class="cellrowborder" valign="top" width="50%">销毁OH_Values_Destroy对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Execute(OH_Rdb_Transaction *trans, const char *sql, const OH_Data_Values *args, OH_Data_Value **result)</td>         <td class="cellrowborder" valign="top" width="50%">执行包含指定参数的SQL语句。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Commit(OH_Rdb_Transaction *trans)</td>         <td class="cellrowborder" valign="top" width="50%">提交事务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Rollback(OH_Rdb_Transaction *trans)</td>         <td class="cellrowborder" valign="top" width="50%">回滚事务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_RdbTrans_Destroy(OH_Rdb_Transaction *trans)</td>         <td class="cellrowborder" valign="top" width="50%">销毁OH_Rdb_Transaction实例。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_Attach(OH_Rdb_Store *store, const OH_Rdb_ConfigV2 *config, const char *attachName, int64_t waitTime, size_t *attachedNumber)</td>         <td class="cellrowborder" valign="top" width="50%">将数据库文件附加到当前连接的数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_Detach(OH_Rdb_Store *store, const char *attachName, int64_t waitTime, size_t *attachedNumber)</td>         <td class="cellrowborder" valign="top" width="50%">从当前数据库中分离指定的数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetCustomDir(OH_Rdb_ConfigV2 *config, const char *customDir)</td>         <td class="cellrowborder" valign="top" width="50%">设置数据库的自定义目录。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetLocale(OH_Rdb_Store *store, const char *locale)</td>         <td class="cellrowborder" valign="top" width="50%">支持不同语言的排序规则。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Rdb_SetPlugins(OH_Rdb_ConfigV2 *config, const char **plugins, int32_t length)</td>         <td class="cellrowborder" valign="top" width="50%">设置具有特定功能（如全文检索）的动态库。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p><strong>添加动态链接库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libnative_rdb_ndk.z.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/data/data_asset.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/oh_cursor.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/oh_predicates.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/oh_value_object.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/oh_values_bucket.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/relational_store.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/rdb/relational_store_error_code.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>获取OH_Rdb_Store实例，创建数据库文件。其中dataBaseDir变量为应用沙箱路径，Stage模式下建议使用数据库目录，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>的databaseDir属性。FA模式下，由于没有接口获取数据库沙箱路径，可使用应用程序的文件目录，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-app-context" target="_blank">Context</a>的getFilesDir接口。area为数据库文件存放的安全区域，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-contextconstant" target="_blank">contextConstant</a>，开发时需要实现由AreaMode枚举值对Rdb_SecurityArea枚举值的转换。示例代码如下所示：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建OH_Rdb_ConfigV2对象</span></li><li>OH_Rdb_ConfigV2 *config = OH_Rdb_CreateConfig();</li><li><span class="hljs-comment">// 该路径为应用沙箱路径</span></li><li><span class="hljs-comment">// 数据库文件创建位置将位于沙箱路径 /data/storage/el3/database/rdb/RdbTest.db</span></li><li>OH_Rdb_SetDatabaseDir(config, <span class="hljs-string">"/data/storage/el3/database"</span>);</li><li><span class="hljs-comment">// 数据库文件存放的安全区域，与databaseDir参数中el路径对应</span></li><li>OH_Rdb_SetArea(config, RDB_SECURITY_AREA_EL3);</li><li><span class="hljs-comment">// 数据库文件名</span></li><li>OH_Rdb_SetStoreName(config, <span class="hljs-string">"RdbTest.db"</span>);</li><li><span class="hljs-comment">// 应用包名</span></li><li>OH_Rdb_SetBundleName(config, <span class="hljs-string">"com.example.nativedemo"</span>);</li><li><span class="hljs-comment">// 应用模块名</span></li><li>OH_Rdb_SetModuleName(config, <span class="hljs-string">"entry"</span>);</li><li><span class="hljs-comment">// 数据库文件安全等级</span></li><li>OH_Rdb_SetSecurityLevel(config, OH_Rdb_SecurityLevel::S3);</li><li><span class="hljs-comment">// 数据库是否加密</span></li><li>OH_Rdb_SetEncrypted(config, <span class="hljs-literal">false</span>);</li><li>
</li><li><span class="hljs-type">int</span> errCode = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 获取OH_Rdb_Store实例</span></li><li>OH_Rdb_Store *store_ = OH_Rdb_CreateOrOpen(config, &amp;errCode);</li><li><span class="hljs-keyword">if</span> (store_ == <span class="hljs-literal">NULL</span>) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create store failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(config);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create attachStore failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(config);</li><li>    OH_Rdb_CloseStore(store_);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre></div></div>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-comment">// 可设置自定义数据库路径</span></li><li> <span class="hljs-comment">// 数据库文件创建位置将位于沙箱路径 /data/storage/el2/database/a/b/RdbTest.db</span></li><li> OH_Rdb_SetCustomDir(config, <span class="hljs-string">"../a/b"</span>);</li><li> <span class="hljs-comment">// 可设置为只读模式打开数据库</span></li><li> OH_Rdb_SetReadOnly(config, <span class="hljs-literal">true</span>);</li></ol></pre></div></div></li>      <li>       <p>获取到OH_Rdb_Store后，调用OH_Rdb_Execute接口创建表，并调用OH_Rdb_Insert接口插入数据。示例代码如下所示：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">char</span> createTableSql[] = <span class="hljs-string">"CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, NAME TEXT NOT NULL, "</span></li><li>                        <span class="hljs-string">"AGE INTEGER, SALARY REAL, CODES BLOB)"</span>;</li><li><span class="hljs-comment">// 执行建表语句</span></li><li>OH_Rdb_Execute(store_, createTableSql);</li><li>
</li><li><span class="hljs-comment">// 创建键值对实例</span></li><li>OH_VBucket *valueBucket = OH_Rdb_CreateValuesBucket();</li><li>valueBucket-&gt;putText(valueBucket, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"Lisa"</span>);</li><li>valueBucket-&gt;putInt64(valueBucket, <span class="hljs-string">"AGE"</span>, <span class="hljs-number">18</span>);</li><li>valueBucket-&gt;putReal(valueBucket, <span class="hljs-string">"SALARY"</span>, <span class="hljs-number">100.5</span>);</li><li><span class="hljs-type">uint8_t</span> arr[] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};</li><li><span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(arr) / <span class="hljs-keyword">sizeof</span>(arr[<span class="hljs-number">0</span>]);</li><li>valueBucket-&gt;putBlob(valueBucket, <span class="hljs-string">"CODES"</span>, arr, len);</li><li><span class="hljs-comment">// 插入数据</span></li><li><span class="hljs-type">int</span> rowId = OH_Rdb_Insert(store_, <span class="hljs-string">"EMPLOYEE"</span>, valueBucket);</li><li>
</li><li>OH_VBucket *valueBucket2 = OH_Rdb_CreateValuesBucket();</li><li>valueBucket2-&gt;putInt64(valueBucket2, <span class="hljs-string">"ID"</span>, <span class="hljs-number">1</span>);</li><li>valueBucket2-&gt;putText(valueBucket2, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"zhangsan"</span>);</li><li>valueBucket2-&gt;putInt64(valueBucket2, <span class="hljs-string">"AGE"</span>, <span class="hljs-number">24</span>);</li><li>valueBucket2-&gt;putReal(valueBucket2, <span class="hljs-string">"SALARY"</span>, <span class="hljs-number">120.4</span>);</li><li><span class="hljs-type">int64_t</span> rowId2 = <span class="hljs-number">-1</span>;</li><li><span class="hljs-comment">// 支持插入数据时配置冲突策略</span></li><li><span class="hljs-type">int</span> result = OH_Rdb_InsertWithConflictResolution(store_, <span class="hljs-string">"EMPLOYEE"</span>, valueBucket2,</li><li>                                                 Rdb_ConflictResolution::RDB_CONFLICT_REPLACE, &amp;rowId2);</li><li><span class="hljs-comment">// 销毁键值对实例</span></li><li>valueBucket-&gt;destroy(valueBucket);</li><li>valueBucket2-&gt;destroy(valueBucket2);</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>关系型数据库没有显式的flush操作实现持久化，数据插入即保存在持久化文件。</p>        </div></div></div></li>      <li>       <p>根据谓词指定的实例对象，对数据进行修改或删除。</p>       <p>调用OH_Rdb_Update方法修改数据，调用OH_Rdb_Delete方法删除数据。示例代码如下所示：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建valueBucket对象，用于存储要更新的新数据</span></li><li>OH_VBucket *valueBucket = OH_Rdb_CreateValuesBucket();</li><li>valueBucket-&gt;putText(valueBucket, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"Rose"</span>);</li><li>valueBucket-&gt;putInt64(valueBucket, <span class="hljs-string">"AGE"</span>, <span class="hljs-number">22</span>);</li><li>valueBucket-&gt;putReal(valueBucket, <span class="hljs-string">"SALARY"</span>, <span class="hljs-number">200.5</span>);</li><li><span class="hljs-type">uint8_t</span> arr[] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};</li><li><span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(arr) / <span class="hljs-keyword">sizeof</span>(arr[<span class="hljs-number">0</span>]);</li><li>valueBucket-&gt;putBlob(valueBucket, <span class="hljs-string">"CODES"</span>, arr, len);</li><li><span class="hljs-comment">// 创建谓词对象，指定更新条件：NAME为"Lisa"且SALARY为100.5</span></li><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   valueBucket-&gt;destroy(valueBucket);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VObject *valueObject = OH_Rdb_CreateValueObject();</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name = <span class="hljs-string">"Lisa"</span>;</li><li>valueObject-&gt;putText(valueObject, name);</li><li>predicates-&gt;equalTo(predicates, <span class="hljs-string">"NAME"</span>, valueObject)-&gt;andOperate(predicates);</li><li><span class="hljs-type">uint32_t</span> count = <span class="hljs-number">1</span>;</li><li><span class="hljs-type">double</span> salary = <span class="hljs-number">100.5</span>;</li><li>valueObject-&gt;putDouble(valueObject, &amp;salary, count);</li><li>predicates-&gt;equalTo(predicates, <span class="hljs-string">"SALARY"</span>, valueObject);</li><li><span class="hljs-comment">// 执行更新操作，将符合条件的数据更新为valueBucket中的值</span></li><li><span class="hljs-type">int</span> changeRows = OH_Rdb_Update(store_, valueBucket, predicates);</li><li><span class="hljs-type">int</span> rowId = OH_Rdb_Insert(store_, <span class="hljs-string">"EMPLOYEE"</span>, valueBucket);</li><li>OH_Predicates *predicates2 = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (predicates2 == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   valueObject-&gt;destroy(valueObject);</li><li>   valueBucket-&gt;destroy(valueBucket);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VObject *valueObject2 = OH_Rdb_CreateValueObject();</li><li>valueObject2-&gt;putText(valueObject2, <span class="hljs-string">"Rose"</span>);</li><li>predicates2-&gt;equalTo(predicates2, <span class="hljs-string">"NAME"</span>, valueObject2);</li><li>valueBucket-&gt;putInt64(valueBucket, <span class="hljs-string">"ID"</span>, <span class="hljs-number">1</span>);</li><li>valueBucket-&gt;putText(valueBucket, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"zhangsan"</span>);</li><li><span class="hljs-type">int64_t</span> changeRows2 = <span class="hljs-number">-1</span>;</li><li>
</li><li><span class="hljs-comment">// 支持更新数据时配置冲突策略</span></li><li><span class="hljs-type">int</span> result = OH_Rdb_UpdateWithConflictResolution(store_, valueBucket, predicates2,</li><li>                                                 Rdb_ConflictResolution::RDB_CONFLICT_REPLACE, &amp;changeRows2);</li><li>valueObject-&gt;destroy(valueObject);</li><li>valueObject2-&gt;destroy(valueObject2);</li><li>valueBucket-&gt;destroy(valueBucket);</li><li>predicates-&gt;destroy(predicates);</li><li>predicates2-&gt;destroy(predicates2);</li></ol></pre></div></div>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 删除数据</span></li><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VObject *valueObject = OH_Rdb_CreateValueObject();</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name = <span class="hljs-string">"Lisa"</span>;</li><li>valueObject-&gt;putText(valueObject, name);</li><li>predicates-&gt;equalTo(predicates, <span class="hljs-string">"NAME"</span>, valueObject);</li><li><span class="hljs-type">int</span> deleteRows = OH_Rdb_Delete(store_, predicates);</li><li>valueObject-&gt;destroy(valueObject);</li><li>predicates-&gt;destroy(predicates);</li></ol></pre></div></div></li>      <li>       <p>根据谓词指定的查询条件查找数据。</p>       <p>调用OH_Rdb_Query方法查找数据，返回一个OH_Cursor结果集。示例代码如下所示：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *columnNames[] = {<span class="hljs-string">"NAME"</span>, <span class="hljs-string">"AGE"</span>};</li><li><span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(columnNames) / <span class="hljs-keyword">sizeof</span>(columnNames[<span class="hljs-number">0</span>]);</li><li>OH_Cursor *cursor = OH_Rdb_Query(store_, predicates, columnNames, len);</li><li><span class="hljs-keyword">if</span> (cursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   predicates-&gt;destroy(predicates);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">int</span> columnCount = <span class="hljs-number">0</span>;</li><li>cursor-&gt;getColumnCount(cursor, &amp;columnCount);</li><li>
</li><li><span class="hljs-comment">// OH_Cursor是一个数据集合的游标，默认指向第-1个记录，有效的数据从0开始</span></li><li><span class="hljs-type">int64_t</span> age;</li><li><span class="hljs-keyword">while</span> (cursor-&gt;goToNextRow(cursor) == OH_Rdb_ErrCode::RDB_OK) {</li><li>    <span class="hljs-type">int32_t</span> ageColumnIndex = <span class="hljs-number">-1</span>;</li><li>    cursor-&gt;getColumnIndex(cursor, <span class="hljs-string">"AGE"</span>, &amp;ageColumnIndex);</li><li>    <span class="hljs-keyword">if</span> (ageColumnIndex != <span class="hljs-number">-1</span>) {</li><li>        cursor-&gt;getInt64(cursor, ageColumnIndex, &amp;age);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 释放谓词实例</span></li><li>predicates-&gt;destroy(predicates);</li><li><span class="hljs-comment">// 释放结果集</span></li><li>cursor-&gt;destroy(cursor);</li></ol></pre></div></div>       <p>配置谓词以LIKE模式或NOT LIKE模式匹配进行数据查询。示例代码如下：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Predicates *likePredicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (likePredicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VObject *likePattern = OH_Rdb_CreateValueObject();</li><li>likePattern-&gt;putText(likePattern, <span class="hljs-string">"zh%"</span>);</li><li><span class="hljs-comment">// 配置谓词以LIKE模式匹配</span></li><li>likePredicates-&gt;like(likePredicates, <span class="hljs-string">"NAME"</span>, likePattern);</li><li>
</li><li><span class="hljs-type">char</span> *colName[] = { <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"AGE"</span> };</li><li><span class="hljs-keyword">auto</span> *likeQueryCursor = OH_Rdb_Query(store_, likePredicates, colName, <span class="hljs-number">2</span>);</li><li><span class="hljs-keyword">if</span> (likeQueryCursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   likePredicates-&gt;destroy(likePredicates);</li><li>   likePattern-&gt;destroy(likePattern);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>likeQueryCursor-&gt;goToNextRow(likeQueryCursor);</li><li><span class="hljs-type">size_t</span> dataLength = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int</span> colIndex = <span class="hljs-number">-1</span>;</li><li>likeQueryCursor-&gt;getColumnIndex(likeQueryCursor, <span class="hljs-string">"NAME"</span>, &amp;colIndex);</li><li>likeQueryCursor-&gt;getSize(likeQueryCursor, colIndex, &amp;dataLength);</li><li><span class="hljs-type">char</span> *name = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>((dataLength + <span class="hljs-number">1</span>) * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>));</li><li>likeQueryCursor-&gt;getText(likeQueryCursor, colIndex, name, dataLength + <span class="hljs-number">1</span>);</li><li>
</li><li>likeQueryCursor-&gt;destroy(likeQueryCursor);</li><li>likePredicates-&gt;destroy(likePredicates);</li><li>likePattern-&gt;destroy(likePattern);</li><li><span class="hljs-built_in">free</span>(name);</li><li>
</li><li>OH_Predicates *notLikePredicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (notLikePredicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 配置谓词以NOT LIKE模式匹配</span></li><li>OH_Predicates_NotLike(notLikePredicates, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"zh%"</span>);</li><li><span class="hljs-keyword">auto</span> *notLikeQueryCursor = OH_Rdb_Query(store_, notLikePredicates, colName, <span class="hljs-number">2</span>);</li><li><span class="hljs-keyword">if</span> (notLikeQueryCursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   notLikePredicates-&gt;destroy(notLikePredicates);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>notLikeQueryCursor-&gt;goToNextRow(notLikeQueryCursor);</li><li>dataLength = <span class="hljs-number">0</span>;</li><li>colIndex = <span class="hljs-number">-1</span>;</li><li>notLikeQueryCursor-&gt;getColumnIndex(notLikeQueryCursor, <span class="hljs-string">"NAME"</span>, &amp;colIndex);</li><li>notLikeQueryCursor-&gt;getSize(notLikeQueryCursor, colIndex, &amp;dataLength);</li><li><span class="hljs-type">char</span> *name2 = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>((dataLength + <span class="hljs-number">1</span>) * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>));</li><li>notLikeQueryCursor-&gt;getText(notLikeQueryCursor, colIndex, name2, dataLength + <span class="hljs-number">1</span>);</li><li>
</li><li>notLikePredicates-&gt;destroy(notLikePredicates);</li><li>notLikeQueryCursor-&gt;destroy(notLikeQueryCursor);</li><li><span class="hljs-built_in">free</span>(name2);</li></ol></pre></div></div>       <p>配置谓词以GLOB模式或NOTGLOB模式匹配进行数据查询。示例代码如下：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Predicates *globPredicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (globPredicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 配置谓词以GLOB模式匹配</span></li><li>OH_Predicates_Glob(globPredicates, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"zh*"</span>);</li><li>
</li><li><span class="hljs-type">char</span> *colName[] = { <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"AGE"</span> };</li><li><span class="hljs-keyword">auto</span> *globQueryCursor = OH_Rdb_Query(store_, globPredicates, colName, <span class="hljs-number">2</span>);</li><li><span class="hljs-keyword">if</span> (globQueryCursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   globPredicates-&gt;destroy(globPredicates);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>globQueryCursor-&gt;goToNextRow(globQueryCursor);</li><li><span class="hljs-type">size_t</span> dataLength = <span class="hljs-number">0</span>;</li><li><span class="hljs-type">int</span> colIndex = <span class="hljs-number">-1</span>;</li><li>globQueryCursor-&gt;getColumnIndex(globQueryCursor, <span class="hljs-string">"NAME"</span>, &amp;colIndex);</li><li>globQueryCursor-&gt;getSize(globQueryCursor, colIndex, &amp;dataLength);</li><li><span class="hljs-type">char</span>* name = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>((dataLength + <span class="hljs-number">1</span>) * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>));</li><li>globQueryCursor-&gt;getText(globQueryCursor, colIndex, name, dataLength + <span class="hljs-number">1</span>);</li><li>
</li><li>globQueryCursor-&gt;destroy(globQueryCursor);</li><li>globPredicates-&gt;destroy(globPredicates);</li><li><span class="hljs-built_in">free</span>(name);</li><li>
</li><li>OH_Predicates *notGlobPredicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (notGlobPredicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-comment">// 配置谓词以NOT GLOB模式匹配</span></li><li>OH_Predicates_NotGlob(notGlobPredicates, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"zh*"</span>);</li><li><span class="hljs-keyword">auto</span> *notGlobQueryCursor = OH_Rdb_Query(store_, notGlobPredicates, colName, <span class="hljs-number">2</span>);</li><li><span class="hljs-keyword">if</span> (notGlobQueryCursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   notGlobPredicates-&gt;destroy(notGlobPredicates);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>notGlobQueryCursor-&gt;goToNextRow(notGlobQueryCursor);</li><li>dataLength = <span class="hljs-number">0</span>;</li><li>colIndex = <span class="hljs-number">-1</span>;</li><li>notGlobQueryCursor-&gt;getColumnIndex(notGlobQueryCursor, <span class="hljs-string">"NAME"</span>, &amp;colIndex);</li><li>notGlobQueryCursor-&gt;getSize(notGlobQueryCursor, colIndex, &amp;dataLength);</li><li><span class="hljs-type">char</span>* name2 = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>((dataLength + <span class="hljs-number">1</span>) * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>));</li><li>notGlobQueryCursor-&gt;getText(notGlobQueryCursor, colIndex, name2, dataLength + <span class="hljs-number">1</span>);</li><li>
</li><li>notGlobQueryCursor-&gt;destroy(notGlobQueryCursor);</li><li>notGlobPredicates-&gt;destroy(notGlobPredicates);</li><li><span class="hljs-built_in">free</span>(name2);</li></ol></pre></div></div>       <p>如需指定排序时使用的语言规则，例如zh_CN表示中文，tr_TR表示土耳其语等。可调用OH_Rdb_SetLocale配置相应规则。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Rdb_SetLocale(store_, <span class="hljs-string">"zh_CN"</span>);</li></ol></pre></div></div>       <p>如需配置fts（Full-Text Search，即全文搜索引擎）动态库，可使用OH_Rdb_SetPlugins接口进行配置。</p>       <p>使用约束详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore-i#storeconfig" target="_blank">StoreConfig</a>中pluginLibs配置项。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *plugins[] = {</li><li>    <span class="hljs-string">"/data/storage/el1/bundle/libs/arm64/libtokenizer.so"</span></li><li>};</li><li>
</li><li><span class="hljs-type">int32_t</span> count = <span class="hljs-keyword">sizeof</span>(plugins) / <span class="hljs-keyword">sizeof</span>(plugins[<span class="hljs-number">0</span>]);</li><li><span class="hljs-keyword">auto</span> setResult = OH_Rdb_SetPlugins(config, plugins, count);</li></ol></pre></div></div></li>      <li>       <p>使用事务对象进行插入、删除或更新数据操作。</p>       <p>调用OH_RdbTransOption_SetType方法，配置要创建的事务类型，</p>       <p>支持配置的事务类型有DEFERRED、IMMEDIATE和EXCLUSIVE，默认为DEFERRED。</p>       <p>调用OH_Rdb_CreateTransaction方法创建事务对象，使用该事务对象执行相应事务操作。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_RDB_TransOptions *options;</li><li>options = OH_RdbTrans_CreateOptions();</li><li><span class="hljs-comment">// 配置事务类型</span></li><li>OH_RdbTransOption_SetType(options, RDB_TRANS_DEFERRED);</li><li>OH_Rdb_Transaction *trans = nullptr;</li><li><span class="hljs-comment">// 创建事务对象</span></li><li><span class="hljs-type">int</span> ret = OH_Rdb_CreateTransaction(store_, options, &amp;trans);</li><li>
</li><li>OH_RdbTrans_DestroyOptions(options);</li><li>
</li><li><span class="hljs-type">char</span> transCreateTableSql[] =</li><li>    <span class="hljs-string">"CREATE TABLE IF NOT EXISTS transaction_table (id INTEGER PRIMARY KEY AUTOINCREMENT, data1 INTEGER, "</span></li><li>    <span class="hljs-string">"data2 INTEGER, data3 FLOAT, data4 TEXT, data5 BLOB, data6 ASSET, data7 ASSETS, data8 UNLIMITED INT, "</span></li><li>    <span class="hljs-string">"data9 FLOATVECTOR);"</span>;</li><li>
</li><li><span class="hljs-keyword">auto</span> *execResult = OH_Value_Create();</li><li>
</li><li><span class="hljs-comment">// 通过事务对象执行创建数据库表SQL语句</span></li><li>ret = OH_RdbTrans_Execute(trans, transCreateTableSql, nullptr, &amp;execResult);</li><li>
</li><li><span class="hljs-comment">// 创建OH_Data_Values实例</span></li><li>OH_Data_Values *values = OH_Values_Create();</li><li>ret = OH_Values_PutInt(values, <span class="hljs-number">1</span>);</li><li>ret = OH_Values_PutInt(values, <span class="hljs-number">2</span>);</li><li>ret = OH_Values_PutReal(values, <span class="hljs-number">1.1</span>);</li><li>ret = OH_Values_PutText(values, <span class="hljs-string">"1"</span>);</li><li><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> val[] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>};</li><li>ret = OH_Values_PutBlob(values, val, <span class="hljs-keyword">sizeof</span>(val) / <span class="hljs-keyword">sizeof</span>(val[<span class="hljs-number">0</span>]));</li><li>
</li><li>Data_Asset *asset = OH_Data_Asset_CreateOne();</li><li>ret = OH_Data_Asset_SetName(asset, <span class="hljs-string">"name"</span>);</li><li>ret = OH_Values_PutAsset(values, asset);</li><li>OH_Data_Asset_DestroyOne(asset);</li><li>
</li><li>Data_Asset **assets = OH_Data_Asset_CreateMultiple(<span class="hljs-number">2</span>);</li><li>ret = OH_Data_Asset_SetName(assets[<span class="hljs-number">0</span>], <span class="hljs-string">"name1"</span>);</li><li>ret = OH_Data_Asset_SetName(assets[<span class="hljs-number">1</span>], <span class="hljs-string">"name2"</span>);</li><li>ret = OH_Values_PutAssets(values, assets, <span class="hljs-number">2</span>);</li><li>ret = OH_Data_Asset_DestroyMultiple(assets, <span class="hljs-number">2</span>);</li><li>
</li><li><span class="hljs-type">uint64_t</span> bigInt[] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};</li><li>ret = OH_Values_PutUnlimitedInt(values, <span class="hljs-number">0</span>, bigInt, <span class="hljs-keyword">sizeof</span>(bigInt) / <span class="hljs-keyword">sizeof</span>(bigInt[<span class="hljs-number">0</span>]));</li><li>
</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *insertSql = <span class="hljs-string">"INSERT INTO transaction_table "</span></li><li>                        <span class="hljs-string">"(data1, data2, data3, data4, data5, data6, data7, data8) VALUES (?, ?, ?, ?, ?, ?, ?, ?)"</span>;</li><li>OH_Data_Value *outValue = nullptr;</li><li>
</li><li><span class="hljs-comment">// 通过事务对象执行数据插入SQL语句</span></li><li>ret = OH_RdbTrans_Execute(trans, insertSql, values, &amp;outValue);</li><li>OH_Value_Destroy(outValue);</li><li>OH_Values_Destroy(values);</li><li>
</li><li>OH_VBucket *transValueBucket = OH_Rdb_CreateValuesBucket();</li><li>transValueBucket-&gt;putInt64(transValueBucket, <span class="hljs-string">"data1"</span>, <span class="hljs-number">1</span>);</li><li>transValueBucket-&gt;putInt64(transValueBucket, <span class="hljs-string">"data2"</span>, <span class="hljs-number">2</span>);</li><li>transValueBucket-&gt;putReal(transValueBucket, <span class="hljs-string">"data3"</span>, <span class="hljs-number">1.1</span>);</li><li>transValueBucket-&gt;putText(transValueBucket, <span class="hljs-string">"data4"</span>, <span class="hljs-string">"1"</span>);</li><li>transValueBucket-&gt;putBlob(transValueBucket, <span class="hljs-string">"data5"</span>, val, <span class="hljs-keyword">sizeof</span>(val) / <span class="hljs-keyword">sizeof</span>(val[<span class="hljs-number">0</span>]));</li><li><span class="hljs-type">int64_t</span> insertRowId = <span class="hljs-number">-1</span>;</li><li><span class="hljs-comment">// 通过事务对象执行OH_VBucket数据插入</span></li><li><span class="hljs-type">int</span> insertRet = OH_RdbTrans_Insert(trans, <span class="hljs-string">"transaction_table"</span>, transValueBucket, &amp;insertRowId);</li><li>transValueBucket-&gt;destroy(transValueBucket);</li><li>
</li><li>OH_VBucket *transValueBucket2 = OH_Rdb_CreateValuesBucket();</li><li>transValueBucket2-&gt;putInt64(transValueBucket2, <span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>);</li><li>transValueBucket2-&gt;putInt64(transValueBucket2, <span class="hljs-string">"data2"</span>, <span class="hljs-number">2</span>);</li><li>transValueBucket2-&gt;putReal(transValueBucket2, <span class="hljs-string">"data3"</span>, <span class="hljs-number">1.2</span>);</li><li>
</li><li><span class="hljs-type">int64_t</span> transInsertRow = <span class="hljs-number">-1</span>;</li><li><span class="hljs-comment">// 支持插入数据时配置冲突策略</span></li><li><span class="hljs-type">int</span> result = OH_RdbTrans_InsertWithConflictResolution(</li><li>    trans, <span class="hljs-string">"transaction_table"</span>, transValueBucket2, Rdb_ConflictResolution::RDB_CONFLICT_REPLACE, &amp;transInsertRow);</li><li>
</li><li>transValueBucket2-&gt;destroy(transValueBucket2);</li><li>
</li><li>OH_VBucket *transValueBucket3 = OH_Rdb_CreateValuesBucket();</li><li>transValueBucket3-&gt;putInt64(transValueBucket3, <span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>);</li><li>transValueBucket3-&gt;putInt64(transValueBucket3, <span class="hljs-string">"data2"</span>, <span class="hljs-number">3</span>);</li><li>transValueBucket3-&gt;putReal(transValueBucket3, <span class="hljs-string">"data3"</span>, <span class="hljs-number">1.2</span>);</li><li>
</li><li>OH_Predicates *transUpdatePredicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"transaction_table"</span>);</li><li><span class="hljs-keyword">if</span> (transUpdatePredicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   transValueBucket3-&gt;destroy(transValueBucket3);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-keyword">auto</span> targetValue = OH_Rdb_CreateValueObject();</li><li><span class="hljs-type">int64_t</span> two = <span class="hljs-number">2</span>;</li><li>targetValue-&gt;putInt64(targetValue, &amp;two, <span class="hljs-number">1</span>);</li><li>transUpdatePredicates-&gt;equalTo(transUpdatePredicates, <span class="hljs-string">"data2"</span>, targetValue);</li><li>
</li><li><span class="hljs-type">int64_t</span> updateRows = <span class="hljs-number">-1</span>;</li><li><span class="hljs-comment">// 支持更新数据时配置冲突策略</span></li><li>OH_RdbTrans_UpdateWithConflictResolution(trans, transValueBucket3, transUpdatePredicates,</li><li>                                         Rdb_ConflictResolution::RDB_CONFLICT_REPLACE, &amp;updateRows);</li><li>targetValue-&gt;destroy(targetValue);</li><li>transValueBucket3-&gt;destroy(transValueBucket3);</li><li>transUpdatePredicates-&gt;destroy(transUpdatePredicates);</li><li>
</li><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"transaction_table"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *columns[] = {<span class="hljs-string">"data1"</span>, <span class="hljs-string">"data2"</span>, <span class="hljs-string">"data3"</span>};</li><li><span class="hljs-comment">// 通过事务对象执行数据查询</span></li><li>OH_Cursor *cursor = OH_RdbTrans_Query(trans, predicates, columns, <span class="hljs-keyword">sizeof</span>(columns) / <span class="hljs-keyword">sizeof</span>(columns[<span class="hljs-number">0</span>]));</li><li><span class="hljs-keyword">if</span> (cursor == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>   predicates-&gt;destroy(predicates);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">int</span> columnCount = <span class="hljs-number">0</span>;</li><li>cursor-&gt;getColumnCount(cursor, &amp;columnCount);</li><li>
</li><li>predicates-&gt;destroy(predicates);</li><li>cursor-&gt;destroy(cursor);</li><li>
</li><li>OH_Predicates *predicates2 = OH_Rdb_CreatePredicates(<span class="hljs-string">"transaction_table"</span>);</li><li><span class="hljs-keyword">if</span> (predicates2 == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VObject *valueObject = OH_Rdb_CreateValueObject();</li><li><span class="hljs-keyword">if</span> (valueObject == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreateValueObject failed."</span>);</li><li>   predicates2-&gt;destroy(predicates2);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>valueObject-&gt;putText(valueObject, <span class="hljs-string">"1"</span>);</li><li>predicates2-&gt;equalTo(predicates2, <span class="hljs-string">"data4"</span>, valueObject);</li><li><span class="hljs-type">int64_t</span> changes = <span class="hljs-number">-1</span>;</li><li><span class="hljs-comment">// 通过事务对象执行数据删除</span></li><li><span class="hljs-type">int</span> deleteRet = OH_RdbTrans_Delete(trans, predicates2, &amp;changes);</li><li>predicates2-&gt;destroy(predicates2);</li><li>valueObject-&gt;destroy(valueObject);</li><li>
</li><li><span class="hljs-comment">// 提交事务</span></li><li>OH_RdbTrans_Commit(trans);</li><li><span class="hljs-comment">// 销毁事务</span></li><li>OH_RdbTrans_Destroy(trans);</li></ol></pre></div></div>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_RDB_TransOptions *options2;</li><li>options2 = OH_RdbTrans_CreateOptions();</li><li>OH_RdbTransOption_SetType(options2, RDB_TRANS_DEFERRED);</li><li>OH_Rdb_Transaction *trans2 = nullptr;</li><li><span class="hljs-type">int</span> transCreateRet = OH_Rdb_CreateTransaction(store_, options2, &amp;trans2);</li><li>OH_RdbTrans_DestroyOptions(options2);</li><li>
</li><li><span class="hljs-comment">// 回滚事务</span></li><li>OH_RdbTrans_Rollback(trans2);</li><li>OH_RdbTrans_Destroy(trans2);</li></ol></pre></div></div></li>      <li>       <p>附加数据库。</p>       <p>调用OH_Rdb_Attach将一个数据库文件附加到当前数据库中，以便在SQL语句中可以直接访问附加数据库中的数据。</p>       <p>此API不支持附加加密数据库。</p>       <p>调用attach接口后，数据库切换为非WAL模式，性能会存在一定的劣化。切换模式需要确保所有的OH_Cursor都已经销毁，所有的写操作已经结束，否则会报错14800015。</p>       <p>attach不能并发调用，可能出现未响应情况，报错14800015，需要重试。</p>       <p>当不再使用附加数据时，可调用OH_Rdb_Detach分离附加数据库。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">char</span> attachStoreTableCreateSql[] = <span class="hljs-string">"CREATE TABLE IF NOT EXISTS EMPLOYEE (ID INTEGER PRIMARY KEY AUTOINCREMENT, "</span></li><li>    <span class="hljs-string">"NAME TEXT NOT NULL, AGE INTEGER, SALARY REAL, CODES BLOB)"</span>;</li><li>OH_Rdb_ConfigV2 *attachDbConfig = OH_Rdb_CreateConfig();</li><li><span class="hljs-keyword">if</span> (attachDbConfig == <span class="hljs-literal">NULL</span>) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create store config failed."</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_Rdb_SetModuleName(attachDbConfig, <span class="hljs-string">"entry"</span>);</li><li>OH_Rdb_SetDatabaseDir(attachDbConfig, <span class="hljs-string">"/data/storage/el3/database"</span>);</li><li>OH_Rdb_SetArea(attachDbConfig, RDB_SECURITY_AREA_EL3);</li><li>OH_Rdb_SetStoreName(attachDbConfig, <span class="hljs-string">"RdbAttach.db"</span>);</li><li>OH_Rdb_SetSecurityLevel(attachDbConfig, OH_Rdb_SecurityLevel::S3);</li><li>OH_Rdb_SetBundleName(attachDbConfig, <span class="hljs-string">"com.example.nativedemo"</span>);</li><li>
</li><li><span class="hljs-comment">// 创建附加示例数据库 RdbAttach.db</span></li><li>OH_Rdb_Store *attachStore = OH_Rdb_CreateOrOpen(attachDbConfig, &amp;errCode);</li><li>
</li><li><span class="hljs-keyword">if</span> (attachStore == <span class="hljs-literal">NULL</span>) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create attachStore failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create attachStore failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>errCode = OH_Rdb_Execute(attachStore, attachStoreTableCreateSql);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create table failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_VBucket *valueBucket = OH_Rdb_CreateValuesBucket();</li><li><span class="hljs-keyword">if</span> (valueBucket == <span class="hljs-literal">NULL</span>) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Create values bucket failed."</span>);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>errCode = valueBucket-&gt;putText(valueBucket, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"Lisa"</span>);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Put text failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    valueBucket-&gt;destroy(valueBucket);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>errCode = valueBucket-&gt;putInt64(valueBucket, <span class="hljs-string">"AGE"</span>, <span class="hljs-number">18</span>);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Put int64 failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    valueBucket-&gt;destroy(valueBucket);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>errCode = valueBucket-&gt;putReal(valueBucket, <span class="hljs-string">"SALARY"</span>, <span class="hljs-number">100.5</span>);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Put real failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    valueBucket-&gt;destroy(valueBucket);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">uint8_t</span> arr[] = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>};</li><li><span class="hljs-type">int</span> len = <span class="hljs-keyword">sizeof</span>(arr) / <span class="hljs-keyword">sizeof</span>(arr[<span class="hljs-number">0</span>]);</li><li>errCode = valueBucket-&gt;putBlob(valueBucket, <span class="hljs-string">"CODES"</span>, arr, len);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Put blob failed, errCode: %{public}d"</span>, errCode);</li><li>    OH_Rdb_DestroyConfig(attachDbConfig);</li><li>    OH_Rdb_CloseStore(attachStore);</li><li>    valueBucket-&gt;destroy(valueBucket);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">int</span> rowId = OH_Rdb_Insert(attachStore, <span class="hljs-string">"EMPLOYEE"</span>, valueBucket);</li><li>OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Insert data result: %{public}d"</span>, rowId);</li><li>valueBucket-&gt;destroy(valueBucket);</li><li>OH_Rdb_CloseStore(attachStore);</li><li>
</li><li><span class="hljs-comment">// 附加数据库</span></li><li><span class="hljs-type">size_t</span> attachedNumber = <span class="hljs-number">0</span>;</li><li>errCode = OH_Rdb_Attach(store_, attachDbConfig, <span class="hljs-string">"attach"</span>, <span class="hljs-number">10</span>, &amp;attachedNumber);</li><li>OH_Rdb_DestroyConfig(attachDbConfig);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Attach store failed, errCode: %{public}d"</span>, errCode);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"attach.EMPLOYEE"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   errCode = OH_Rdb_Detach(store_, <span class="hljs-string">"attach"</span>, <span class="hljs-number">10</span>, &amp;attachedNumber);</li><li>   OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Detach result: %{public}d"</span>, errCode);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">char</span> *colName[] = {};</li><li>OH_Cursor *cursor = OH_Rdb_Query(store_, predicates, colName, <span class="hljs-number">0</span>);</li><li><span class="hljs-keyword">if</span> (cursor == <span class="hljs-literal">NULL</span>) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Query failed."</span>);</li><li>    errCode = OH_Rdb_Detach(store_, <span class="hljs-string">"attach"</span>, <span class="hljs-number">10</span>, &amp;attachedNumber);</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Detach result: %{public}d"</span>, errCode);</li><li>    predicates-&gt;destroy(predicates);</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-type">int</span> rowCount = <span class="hljs-number">-1</span>;</li><li>errCode = cursor-&gt;getRowCount(cursor, &amp;rowCount);</li><li><span class="hljs-keyword">if</span> (errCode != OH_Rdb_ErrCode::RDB_OK) {</li><li>    OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Get row count failed, errCode: %{public}d"</span>, errCode);</li><li>} <span class="hljs-keyword">else</span> {</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Query success, row count: %{public}d"</span>, rowCount);</li><li>}</li><li>cursor-&gt;destroy(cursor);</li><li>predicates-&gt;destroy(predicates);</li><li><span class="hljs-comment">// 分离数据库</span></li><li>errCode = OH_Rdb_Detach(store_, <span class="hljs-string">"attach"</span>, <span class="hljs-number">10</span>, &amp;attachedNumber);</li><li>OH_LOG_INFO(LOG_APP, <span class="hljs-string">"Detach result: %{public}d"</span>, errCode);</li></ol></pre></div></div></li>      <li>       <p>向数据库表中插入资产类型数据。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 列的属性为单个资产类型时，sql语句中应指定为asset，多个资产类型应指定为assets。</span></li><li><span class="hljs-type">char</span> createAssetTableSql[] = <span class="hljs-string">"CREATE TABLE IF NOT EXISTS asset_table (id INTEGER PRIMARY KEY AUTOINCREMENT, data1 ASSET, data2 ASSETS );"</span>;</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *table = <span class="hljs-string">"asset_table"</span>;</li><li><span class="hljs-type">int</span> errCode = OH_Rdb_Execute(store_, createAssetTableSql);</li><li>OH_VBucket *valueBucket = OH_Rdb_CreateValuesBucket();</li><li>Data_Asset *asset = OH_Data_Asset_CreateOne();</li><li>OH_Data_Asset_SetName(asset, <span class="hljs-string">"name0"</span>);</li><li>OH_Data_Asset_SetUri(asset, <span class="hljs-string">"uri0"</span>);</li><li>OH_Data_Asset_SetPath(asset, <span class="hljs-string">"path0"</span>);</li><li>OH_Data_Asset_SetCreateTime(asset, <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetModifyTime(asset, <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetSize(asset, <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetStatus(asset, Data_AssetStatus::ASSET_NORMAL);</li><li>errCode = OH_VBucket_PutAsset(valueBucket, <span class="hljs-string">"data1"</span>, asset);</li><li>
</li><li>Data_Asset **assets = OH_Data_Asset_CreateMultiple(<span class="hljs-number">2</span>);</li><li>
</li><li>OH_Data_Asset_SetName(assets[<span class="hljs-number">0</span>], <span class="hljs-string">"name0"</span>);</li><li>OH_Data_Asset_SetUri(assets[<span class="hljs-number">0</span>], <span class="hljs-string">"uri0"</span>);</li><li>OH_Data_Asset_SetPath(assets[<span class="hljs-number">0</span>], <span class="hljs-string">"path0"</span>);</li><li>OH_Data_Asset_SetCreateTime(assets[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetModifyTime(assets[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetSize(assets[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetStatus(assets[<span class="hljs-number">0</span>], Data_AssetStatus::ASSET_NORMAL);</li><li>
</li><li>OH_Data_Asset_SetName(assets[<span class="hljs-number">1</span>], <span class="hljs-string">"name1"</span>);</li><li>OH_Data_Asset_SetUri(assets[<span class="hljs-number">1</span>], <span class="hljs-string">"uri1"</span>);</li><li>OH_Data_Asset_SetPath(assets[<span class="hljs-number">1</span>], <span class="hljs-string">"path1"</span>);</li><li>OH_Data_Asset_SetCreateTime(assets[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetModifyTime(assets[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetSize(assets[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>);</li><li>OH_Data_Asset_SetStatus(assets[<span class="hljs-number">1</span>], Data_AssetStatus::ASSET_NORMAL);</li><li>
</li><li><span class="hljs-type">uint32_t</span> assetsCount = <span class="hljs-number">2</span>;</li><li>errCode = OH_VBucket_PutAssets(valueBucket, <span class="hljs-string">"data2"</span>, assets, assetsCount);</li><li><span class="hljs-type">int</span> rowID = OH_Rdb_Insert(store_, table, valueBucket);</li><li><span class="hljs-comment">// 释放Data_Asset*和Data_Asset**</span></li><li>OH_Data_Asset_DestroyMultiple(assets, <span class="hljs-number">2</span>);</li><li>OH_Data_Asset_DestroyOne(asset);</li><li>valueBucket-&gt;destroy(valueBucket);</li></ol></pre></div></div></li>      <li>       <p>从结果集中读取资产类型数据。</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Predicates *predicates = OH_Rdb_CreatePredicates(<span class="hljs-string">"asset_table"</span>);</li><li><span class="hljs-keyword">if</span> (predicates == <span class="hljs-literal">NULL</span>) {</li><li>   OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"CreatePredicates failed."</span>);</li><li>   <span class="hljs-keyword">return</span>;</li><li>}</li><li>OH_Cursor *cursor = OH_Rdb_Query(store_, predicates, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);</li><li><span class="hljs-keyword">if</span> (cursor == <span class="hljs-literal">NULL</span>) {</li><li>    predicates-&gt;destroy(predicates);</li><li>} <span class="hljs-keyword">else</span> {</li><li>    cursor-&gt;goToNextRow(cursor);</li><li>    </li><li>    <span class="hljs-type">uint32_t</span> assetCount = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// assetCount作为出参获取该列资产类型数据的数量</span></li><li>    <span class="hljs-type">int</span> errCode = cursor-&gt;getAssets(cursor, <span class="hljs-number">2</span>, nullptr, &amp;assetCount);</li><li>    Data_Asset **assets = OH_Data_Asset_CreateMultiple(assetCount);</li><li>    errCode = cursor-&gt;getAssets(cursor, <span class="hljs-number">2</span>, assets, &amp;assetCount);</li><li>    <span class="hljs-keyword">if</span> (assetCount &lt; <span class="hljs-number">2</span>) {</li><li>        predicates-&gt;destroy(predicates);</li><li>        cursor-&gt;destroy(cursor);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        Data_Asset *asset = assets[<span class="hljs-number">1</span>];</li><li>        <span class="hljs-type">char</span> name[<span class="hljs-number">10</span>] = <span class="hljs-string">""</span>;</li><li>        <span class="hljs-type">size_t</span> nameLength = <span class="hljs-number">10</span>;</li><li>        errCode = OH_Data_Asset_GetName(asset, name, &amp;nameLength);</li><li>        </li><li>        <span class="hljs-type">char</span> uri[<span class="hljs-number">10</span>] = <span class="hljs-string">""</span>;</li><li>        <span class="hljs-type">size_t</span> uriLength = <span class="hljs-number">10</span>;</li><li>        errCode = OH_Data_Asset_GetUri(asset, uri, &amp;uriLength);</li><li>        </li><li>        <span class="hljs-type">char</span> path[<span class="hljs-number">10</span>] = <span class="hljs-string">""</span>;</li><li>        <span class="hljs-type">size_t</span> pathLength = <span class="hljs-number">10</span>;</li><li>        errCode = OH_Data_Asset_GetPath(asset, path, &amp;pathLength);</li><li>        </li><li>        <span class="hljs-type">int64_t</span> createTime = <span class="hljs-number">0</span>;</li><li>        errCode = OH_Data_Asset_GetCreateTime(asset, &amp;createTime);</li><li>        </li><li>        <span class="hljs-type">int64_t</span> modifyTime = <span class="hljs-number">0</span>;</li><li>        errCode = OH_Data_Asset_GetModifyTime(asset, &amp;modifyTime);</li><li>        </li><li>        <span class="hljs-type">size_t</span> size = <span class="hljs-number">0</span>;</li><li>        errCode = OH_Data_Asset_GetSize(asset, &amp;size);</li><li>        </li><li>        Data_AssetStatus status = Data_AssetStatus::ASSET_NULL;</li><li>        errCode = OH_Data_Asset_GetStatus(asset, &amp;status);</li><li>        </li><li>        predicates-&gt;destroy(predicates);</li><li>        OH_Data_Asset_DestroyMultiple(assets, assetCount);</li><li>        cursor-&gt;destroy(cursor);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>查询数据的最后修改时间。调用OH_Rdb_FindModifyTime查询指定表中指定列的数据的最后修改时间，该接口返回一个有两列数据的OH_Cursor对象，第一列为传入的主键/RowId，第二列为最后修改时间。示例代码如下所示：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_VObject *values = OH_Rdb_CreateValueObject();</li><li><span class="hljs-type">int64_t</span> keys[] = { <span class="hljs-number">1</span> };</li><li>values-&gt;putInt64(values, keys, <span class="hljs-number">1</span>);</li><li>OH_Cursor *cursor;</li><li>cursor = OH_Rdb_FindModifyTime(store_, <span class="hljs-string">"EMPLOYEE"</span>, <span class="hljs-string">"ROWID"</span>, values);</li></ol></pre></div></div></li>      <li>       <p>删除数据库。调用OH_Rdb_DeleteStoreV2方法，删除数据库及数据库相关文件。示例代码如下：</p>       <div _ngcontent-bbf-c106="" class="highlight-div"><div _ngcontent-bbf-c106="" class="highlight-div-header"><div _ngcontent-bbf-c106="" class="highlight-div-header-left"><div _ngcontent-bbf-c106="" class="handle-button expand-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bbf-c106="" class="highlight-div-header-right"><div _ngcontent-bbf-c106="" class="handle-button ai-button"></div><div _ngcontent-bbf-c106="" class="handle-button line-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bbf-c106="" class="handle-button theme-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bbf-c106="" class="handle-button copy-button"><div _ngcontent-bbf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bbf-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放数据库实例</span></li><li>OH_Rdb_CloseStore(store_);</li><li><span class="hljs-comment">// 删除数据库文件</span></li><li>OH_Rdb_DeleteStoreV2(config);</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>