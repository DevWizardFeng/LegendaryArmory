<h1 _ngcontent-hmv-c119="" class="doc-title ng-star-inserted" title="通过华为账号一键登录获取用户风险等级"> 通过华为账号一键登录获取用户风险等级 </h1>

<div _ngcontent-hmv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section18372104552713">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section18372104552713" tips="复制节点链接"></i></h2>          <p>应用登录风控场景，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login">华为账号一键登录</a>获取用户风险等级，对恶意账号进行风控，提升应用的安全等级。</p>    </div>    <div class="tiledSection">     <h2 id="section7506440165116">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section7506440165116" tips="复制节点链接"></i></h2>          <p>通过华为账号一键登录获取用户风险等级能力支持Phone、Tablet、PC/2in1设备。并且从5.1.1(19)版本开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section175775293117">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section175775293117" tips="复制节点链接"></i></h2>          <div class="fignone">      <span class="figcap"><b>图1 </b>华为账号一键登录（用户首次登录应用）获取华为账号风险等级流程图</span>     </div>     <p><span><img height="529.6725" originheight="3307" originwidth="3269" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114652.83344066553649985963270410964083:50001231000000:2800:C8DC7747A4093ED01A6AF282A9A437DE51CCBAEB5A782D13ACB7E7638D639515.png" title="点击放大" width="523.6875"></span></p>     <ol>      <li>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#section15857192215104">华为账号一键登录业务流程</a>，确保系统账号已登录，匿名手机号获取成功，且用户首次使用华为账号登录应用。（如用户非首次使用华为账号登录，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-get-risklevel-on-demand-acquisition">华为账号其他方式登录获取用户风险等级</a>来查询华为账号的风险等级）</li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button" target="_blank">LoginWithHuaweiIDButton</a>组件，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-component-manager#section4717249182518" target="_blank">LoginWithHuaweiIDButtonParams</a>参数中设置风险等级字段标识riskLevel，拉起应用登录页。</li>      <li>用户同意协议后，点击华为账号一键登录按钮，应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-component-manager#section1862534912215" target="_blank">HuaweiIDCredential</a>获取到Authorization Code等数据。</li>      <li>将获取的Authorization Code数据传给应用服务端，应用服务端通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-getuserrisklevel" target="_blank">获取用户风险等级</a>接口查询当前登录用户的华为账号风险等级。</li>      <li>应用基于用户风险等级判断继续登录流程或者返回对应风控措施。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section18359480327">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section18359480327" tips="复制节点链接"></i></h2>          <p>一键登录接口遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#section1453013601016">华为账号一键登录接口说明</a>，当应用需要获取用户风险等级时，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button" target="_blank">LoginWithHuaweiIDButton</a>组件参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-component-manager#section4717249182518" target="_blank">LoginWithHuaweiIDButtonParams</a>中传入riskLevel字段，通过一键登录返回Authorization Code查询用户的风险等级。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-component-manager#section4717249182518" target="_blank">LoginWithHuaweiIDButtonParams</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button" target="_blank">LoginWithHuaweiIDButton</a>组件参数，支持传入riskLevel字段（可选），标识一键登录后可查询用户风险等级。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section13466111683216">开发前提<i class="anchor-icon anchor-icon-link" anchorid="section13466111683216" tips="复制节点链接"></i></h2>          <ol>      <li>在进行代码开发前，请确认已完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#section95093591227">一键登录开发前提</a>工作。</li>      <li>应用在使用获取风险等级能力之前，需要完成对应的scope权限申请。       <p>scope权限申请审批未完成或未通过，将报错<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-2">1001502014 应用未申请scopes或permissions权限</a>。当前可通过<a href="mailto:accountkit@huawei.com" target="_blank">accountkit@huawei.com</a>进行邮件申请。</p>       <p>请提供如下信息进行申请，我们会在15个工作日内回复申请结果，请您留意邮箱消息。</p>       <p><strong><em>邮件主题</em></strong><em>：【获取风险等级】权限申请</em></p>       <p><em><strong>邮件正文</strong>：（请在正文中描述下具体希望申请的权限）</em></p>       <p><em><strong>企业名称</strong>：***</em></p>       <p><em><strong>应用名称</strong>：***</em></p>       <p><em><strong>应用包名</strong>：com.***.***</em></p>       <p><em><strong>APP ID</strong>：1****12</em></p>       <p><em><strong>Client ID</strong>：1****14</em></p>       <p><em><strong>背景介绍：</strong></em><em>（请提供应用简单介绍，便于快速了解）</em></p>       <p><em><strong>使用场景</strong>：（请提供相关使用场景的文字描述、交互流程图或参考交互视频等，可提供类似应用的使用场景进行说明）</em></p>       <p><em><strong>使用该权限的必要性：</strong>（请提供应用需要该权限和信息的必要性）</em></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1188063203217">客户端开发<i class="anchor-icon anchor-icon-link" anchorid="section1188063203217" tips="复制节点链接"></i></h2>          <ol>      <li>一键登录前置流程（获取系统账号登录状态，获取系统账号匿名手机号）请参考一键登录开发流程<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#li14938717193220">步骤1</a>及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#li146111330184515">步骤2</a>，确保系统账号已登录，匿名手机号获取成功，且用户首次通过华为账号登录该应用。</li>      <li>参考一键登录开发流程<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#li8130114016451">步骤3</a>示例代码，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button" target="_blank">LoginWithHuaweiIDButton</a>组件参数params中设置riskLevel标识为true，其余示例代码保持不变，拉起应用登录页。       <div _ngcontent-hmv-c106="" class="highlight-div"><div _ngcontent-hmv-c106="" class="highlight-div-header"><div _ngcontent-hmv-c106="" class="highlight-div-header-left"><div _ngcontent-hmv-c106="" class="handle-button expand-button"><div _ngcontent-hmv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hmv-c106="" class="highlight-div-header-right"><div _ngcontent-hmv-c106="" class="handle-button ai-button"></div><div _ngcontent-hmv-c106="" class="handle-button line-button"><div _ngcontent-hmv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hmv-c106="" class="handle-button theme-button"><div _ngcontent-hmv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hmv-c106="" class="handle-button copy-button"><div _ngcontent-hmv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hmv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">LoginWithHuaweiIDButton</span>({</li><li>  <span class="hljs-variable">params</span>: {</li><li>    <span class="hljs-comment">// LoginWithHuaweiIDButton支持的样式</span></li><li>    <span class="hljs-variable">style</span>: <span class="hljs-title class_">loginComponentManager</span>.<span class="hljs-title class_">Style</span>.<span class="hljs-title class_">BUTTON_RED</span>,</li><li>    <span class="hljs-comment">// 账号登录按钮在登录过程中展示加载态</span></li><li>    <span class="hljs-variable">extraStyle</span>: {</li><li>      <span class="hljs-variable">buttonStyle</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">loginComponentManager</span>.<span class="hljs-title class_">ButtonStyle</span>().<span class="hljs-title class_">loadingStyle</span>({</li><li>        <span class="hljs-variable">show</span>: <span class="hljs-keyword">true</span></li><li>      })</li><li>    },</li><li>    <span class="hljs-comment">// LoginWithHuaweiIDButton的边框圆角半径</span></li><li>    <span class="hljs-variable">borderRadius</span>: <span class="hljs-number">24</span>,</li><li>    <span class="hljs-comment">// LoginWithHuaweiIDButton支持的登录类型</span></li><li>    <span class="hljs-variable">loginType</span>: <span class="hljs-title class_">loginComponentManager</span>.<span class="hljs-title class_">LoginType</span>.<span class="hljs-title class_">QUICK_LOGIN</span>,</li><li>    <span class="hljs-comment">// LoginWithHuaweiIDButton支持按钮的样式跟随系统深浅色模式切换</span></li><li>    <span class="hljs-variable">supportDarkMode</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-comment">// verifyPhoneNumber：如果华为账号用户在过去90天内未进行短信验证，是否拉起Account Kit提供的短信验证码页面</span></li><li>    <span class="hljs-variable">verifyPhoneNumber</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-comment">// riskLevel：标识应用期望在登录后获取华为账号的风险等级</span></li><li>    <span class="hljs-variable">riskLevel</span>: <span class="hljs-keyword">true</span>,</li><li>  },</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span></li><li>})</li></ol></pre></div></div></li>      <li>用户同意协议并点击一键登录按钮后，可获取到Authorization Code，将该值传给应用服务端用于获取用户风险等级。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section15191194015326">服务端开发<i class="anchor-icon anchor-icon-link" anchorid="section15191194015326" tips="复制节点链接"></i></h2>          <ol>      <li>应用服务端使用Client ID、Client Secret、Authorization Code调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section1085901313579" target="_blank">获取用户级凭证接口</a>向华为账号服务器请求获取Access Token、Refresh Token。</li>      <li>使用Access Token调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-getuserrisklevel#section2520125725115" target="_blank">获取用户风险等级接口</a>获取用户的风险等级。       <p><strong>Access Token过期处理</strong></p>       <div class="p">        由于Access Token的有效期仅为60分钟，当Access Token失效或者即将失效时（可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-getuserrisklevel#section15782984912" target="_blank">REST API错误码</a>判断），可以使用Refresh Token（有效期180天）通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token#section1085901313579" target="_blank">刷新用户级凭证接口</a>向华为账号服务器请求获取新的Access Token。        <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">          <ol>           <li>当Access Token失效时，若应用不使用Refresh Token向华为账号服务器请求获取新的Access Token，账号的授权信息将会失效，导致使用Access Token的功能都会失败。</li>           <li>当Access Token非正常失效（如修改密码、退出账号、删除设备）时，应用可重新登录授权获取Authorization Code，向华为账号服务器请求获取新的Access Token。</li>          </ol>         </div></div></div>       </div>       <p><strong>Refresh Token过期处理</strong></p>       <p>由于Refresh Token的有效期为180天，当Refresh Token失效后（可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token#section1394417423453" target="_blank">REST API错误码</a>判断），应用服务端需要通知客户端，重新调用授权接口，请求用户重新授权。</p></li>      <li>应用基于风险等级判别用户风险程度，决定是否需要对用户进行额外验证或拦截用户行为。</li>     </ol>    </div>   </div>   <div></div></div>