<h1 _ngcontent-knc-c119="" class="doc-title ng-star-inserted" title="通过向量数据库实现数据持久化 (ArkTS)"> 通过向量数据库实现数据持久化 (ArkTS) </h1>

<div _ngcontent-knc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>向量数据库是一种支持存储、管理和检索向量数据的数据库，也支持标量的关系型数据处理。数据类型"floatvector"用来存储数据向量化的结果，从而实现对这些数据的快速检索和相似性搜索‌。</p>     <p>从API version 18开始，支持通过向量数据库实现数据持久化。</p>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <ul>      <li><strong>结果集</strong>：指用户查询之后的结果集合，可以对数据进行访问。结果集提供了灵活的数据访问方式，可以更方便地拿到用户想要的数据。</li>      <li><strong>floatvector</strong>：该数据类型表示向量数据，例如[1.0, 3.0, 2.4, 5.1, 6.2, 11.7]。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>系统默认日志方式是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/data-terminology#wal模式">WAL</a>（Write Ahead Log）模式，系统默认落盘方式是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/data-terminology#full模式">FULL模式</a>。</p></li>      <li>       <p>数据库中默认有4个读连接和1个写连接，线程获取到空闲读连接时，即可进行读取操作。当没有空闲读连接时，会创建新的读连接。</p></li>      <li>       <p>为保证数据的准确性，数据库同一时间只能支持一个写操作，并发的写操作会串行执行。</p></li>      <li>       <p>当应用被卸载完成后，设备上的相关数据库文件及临时文件会被自动清除。</p></li>      <li>       <p>ArkTS侧支持的基本数据类型：number、string、二进制类型数据、boolean；特殊数据类型：ValueType。</p></li>      <li>       <p>为保证插入并读取数据成功，建议一条数据不要超过2M。单条数据超出该大小时，即使插入成功，也会出现读取失败的情况。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="规格限制">规格限制<i class="anchor-icon anchor-icon-link" anchorid="规格限制" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="数据类型" class="firsth2">数据类型<i class="anchor-icon anchor-icon-link" anchorid="数据类型" tips="复制节点链接"></i></h3>          <p>数据库表字段的类型，如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.1" valign="top" width="33.33333333333333%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">NULL</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">空值</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">INTEGER</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">整形</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DOUBLE</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">浮点类型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">TEXT</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">字符串类型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">BLOB</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">二进制类型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">FLOATVECTOR</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">向量数据类型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="字段约束">字段约束<i class="anchor-icon anchor-icon-link" anchorid="字段约束" tips="复制节点链接"></i></h3>          <p>数据库表字段的约束，如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.1" valign="top" width="33.33333333333333%">功能</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.2" valign="top" width="33.33333333333333%">SQL语法</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不可为NULL</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">NOT NULL</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">默认值</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DEFAULT</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">唯一索引</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">UNIQUE</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主键索引</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">PRIMARY KEY</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">外键索引</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">FOREIGN</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">CHECK约束</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">CHECK</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="子句">子句<i class="anchor-icon anchor-icon-link" anchorid="子句" tips="复制节点链接"></i></h3>          <p>查询语句中的子句，如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.1" valign="top" width="33.33333333333333%">关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">WHERE</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">从一个或多个表中获取数据的条件。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">LIMIT</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">返回数据的限制。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ORDER BY</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">基于一列或多列排序。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ORDER BY 向量距离</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">&lt;-&gt;是L2距离，&lt;=&gt;是余弦距离。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">GROUP BY</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">对相同的数据进行分组。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">HAVING</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">过滤聚合函数的结果。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">INDEXED BY</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">查询时必须使用特定索引。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DISTINCT</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">消除重复记录。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="集合">集合<i class="anchor-icon anchor-icon-link" anchorid="集合" tips="复制节点链接"></i></h3>          <p>查询语句中的集合语句，如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.1" valign="top" width="33.33333333333333%">关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">UNION</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">合并两个或多个查询语句的结果并去重。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">UNION ALL</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">合并两个或多个查询语句的结果。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="运算符">运算符<i class="anchor-icon anchor-icon-link" anchorid="运算符" tips="复制节点链接"></i></h3>          <p>针对某个条件做筛选时，可以使用运算符，一般在查询语句中使用。运算符如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.4.1.1" valign="top" width="33.33333333333333%">运算类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.4.1.2" valign="top" width="33.33333333333333%">符号</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">算术运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">+、-、*、/、%</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">比较运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">==、=、!=、&gt;、&gt;=、&lt;、&lt;=</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">逻辑运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AND、BETWEEN、EXISTS、IN、NOT IN、NOT、OR、IS NULL、IS、IS NOT、LIKE、GLOB</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">字符串拼接运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">||</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">位运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">&amp;、|、~、&lt;&lt;、&gt;&gt;</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">向量距离运算</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">&lt;-&gt;、&lt;=&gt;</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是，支持在聚合函数max和min中使用</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="时间日期">时间&amp;日期<i class="anchor-icon anchor-icon-link" anchorid="时间日期" tips="复制节点链接"></i></h3>          <p>根据不同的时间函数返回不同格式的日期，一般在查询语句中使用。时间&amp;日期函数如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.1" valign="top" width="33.33333333333333%">关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DATE</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">以"YYYY-MM-DD"格式返回日期。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">TIME</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">以"HH:MM:SS"格式返回时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DATETIME</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">以"YYYY-MM-DD HH:MM:SS"格式返回。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JULIANDAY</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">返回从格林尼治时间的公元前4714年11月24日正午算起的天数。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">STRFTIME</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">根据第一个参数指定的格式字符串返回格式化的日期。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="函数">函数<i class="anchor-icon anchor-icon-link" anchorid="函数" tips="复制节点链接"></i></h3>          <p>SQL语句中的函数，如下所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.4.1.1" valign="top" width="33.33333333333333%">关键字</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.4.1.3" valign="top" width="33.33333333333333%">是否支持</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">COUNT</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">计算查询返回的行数。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">MAX/MIN</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">选择某列的最大值/最小值。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AVG</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">计算某列的平均值。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SUM</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">计算某列的总和。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">RANDOM</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">返回一个'-9223372036854775808'到'9223372036854775807'之间的伪随机整数。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ABS</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">计算绝对值。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">UPPER/LOWER</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">将字符串转换为大/小写字母。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">LENGTH</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">返回字符串的长度。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>以下是向量数据库持久化功能的相关接口，更多接口及使用方式请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-data-relationalstore" target="_blank">关系型数据库</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">getRdbStore(context: Context, config: StoreConfig): Promise&lt;RdbStore&gt;</td>         <td class="cellrowborder" valign="top" width="50%">用户可以根据自己的需求配置StoreConfig参数获得RdbStore对象，通过调用RdbStore接口执行数据操作。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">execute(sql: string, txId: number, args?: Array&lt;ValueType&gt;): Promise&lt;ValueType&gt;</td>         <td class="cellrowborder" valign="top" width="50%">执行包含指定参数的SQL语句，语句中的各种表达式和操作符之间的关系操作符号(例如=、&gt;、&lt;)不超过1000个。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">querySql(sql: string, bindArgs?: Array&lt;ValueType&gt;):Promise&lt;ResultSet&gt;</td>         <td class="cellrowborder" valign="top" width="50%">根据指定SQL语句查询数据库中的数据，语句中的各种表达式和操作符之间的关系操作符号(例如=、&gt;、&lt;)不超过1000个。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">beginTrans(): Promise&lt;number&gt;</td>         <td class="cellrowborder" valign="top" width="50%">在开始执行SQL语句之前，开始事务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">commit(txId : number):Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">提交已经执行的SQL语句，跟beginTrans配合使用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">rollback(txId : number):Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">回滚已经执行的SQL语句，跟beginTrans配合使用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">deleteRdbStore(context: Context, config: StoreConfig): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">删除数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">isVectorSupported(): boolean</td>         <td class="cellrowborder" valign="top" width="50%">判断系统是否提供向量数据库能力。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>判断当前系统是否支持向量数据库，若不支持，则表示当前系统不具备向量数据库能力。示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>; <span class="hljs-comment">// 导入模块</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-comment">// 此处示例在Ability中实现，使用者也可以在其他合理场景中使用</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>     <span class="hljs-comment">// 判断当前系统是否支持向量数据库</span></li><li>    <span class="hljs-keyword">let</span> ret = relationalStore.<span class="hljs-title function_">isVectorSupported</span>();</li><li>    <span class="hljs-keyword">if</span> (!ret) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`vectorDB is not supported .`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 开库、增删改查等</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>若支持向量数据库则需要获取一个RdbStore。通过getRdbStore接口创建数据库，并执行建表操作。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>           <p>应用创建的数据库与其上下文（Context）有关，即使使用同样的数据库名称，不同的应用上下文也会产生多个数据库，例如每个UIAbility都有各自的上下文。</p></li>          <li>           <p>当应用首次获取数据库（调用getRdbStore）后，在应用沙箱内会产生对应的数据库文件。使用数据库的过程中，在与数据库文件相同的目录下可能会产生以-wal和-shm结尾的临时文件。此时若开发者希望移动数据库文件到其它地方使用查看，则需要同时移动这些临时文件，当应用被卸载完成后，其在设备上产生的数据库文件及临时文件也会被移除。</p></li>          <li>           <p>错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-data-rdb" target="_blank">关系型数据库错误码</a>。</p></li>         </ul>        </div></div></div>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STORE_CONFIG</span> :relationalStore.<span class="hljs-property">StoreConfig</span>= {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-string">'VectorTest.db'</span>, <span class="hljs-comment">// 数据库文件名</span></li><li>  <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S1</span>, <span class="hljs-comment">// 数据库安全级别</span></li><li>  <span class="hljs-attr">vector</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 可选参数，该参数为true时才可以使用向量数据库。</span></li><li>};</li><li>
</li><li>relationalStore.<span class="hljs-title function_">getRdbStore</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, <span class="hljs-variable constant_">STORE_CONFIG</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">rdbStore</span>: relationalStore.<span class="hljs-property">RdbStore</span>) =&gt; {</li><li>  store = rdbStore;</li><li>  <span class="hljs-comment">// 建表语句，floatvector(2)代表repr的维度是2</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SQL_CREATE_TABLE</span> = <span class="hljs-string">'CREATE TABLE IF NOT EXISTS test (id INTEGER PRIMARY KEY, repr floatvector(2));'</span>;</li><li>  <span class="hljs-comment">// 第二个入参表示不开启显示事务，第三个参数undefined表示未使用参数绑定</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-variable constant_">SQL_CREATE_TABLE</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">undefined</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Get RdbStore failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>获取到RdbStore后，调用execute接口插入数据。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>向量数据库没有显式的flush操作实现持久化，数据插入即保存在持久化文件。</p>        </div></div></div>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 使用参数绑定</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">vectorValue</span>: <span class="hljs-title class_">Float32Array</span> = <span class="hljs-title class_">Float32Array</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">1.2</span>, <span class="hljs-number">2.3</span>]);</li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"insert into test VALUES(?, ?);"</span>, <span class="hljs-number">0</span>, [<span class="hljs-number">0</span>, vectorValue]);</li><li>  <span class="hljs-comment">// 不使用参数绑定</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"insert into test VALUES(1, '[1.3, 2.4]');"</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">undefined</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`execute insert failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>获取到RdbStore后，调用execute接口修改或删除数据。示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 修改数据</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 使用参数绑定</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">vectorValue1</span>: <span class="hljs-title class_">Float32Array</span> = <span class="hljs-title class_">Float32Array</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">2.1</span>, <span class="hljs-number">3.2</span>]);</li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"update test set repr = ? where id = ?"</span>, <span class="hljs-number">0</span>, [vectorValue1, <span class="hljs-number">0</span>]);</li><li>  <span class="hljs-comment">// 不使用参数绑定</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"update test set repr = '[5.1, 6.1]' where id = 0"</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">undefined</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`execute update failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 删除数据</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 使用参数绑定</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"delete from test where id = ?"</span>, <span class="hljs-number">0</span>, [<span class="hljs-number">0</span>]);</li><li>  <span class="hljs-comment">// 不使用参数绑定</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"delete from test where id = 0"</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">undefined</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`execute delete failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>获取到RdbStore后，调用querySql方法查找数据，返回一个ResultSet结果集。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>当应用完成查询数据操作，不再使用结果集（ResultSet）时，请及时调用close方法关闭结果集，释放系统为其分配的内存。</p>        </div></div></div>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 单表查询</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 使用参数绑定</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">QUERY_SQL</span> = <span class="hljs-string">"select id, repr &lt;-&gt; ? as distance from test where id &gt; ? order by repr &lt;-&gt; ? limit 5;"</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">vectorValue2</span>: <span class="hljs-title class_">Float32Array</span> = <span class="hljs-title class_">Float32Array</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">6.2</span>, <span class="hljs-number">7.3</span>]);</li><li>  <span class="hljs-keyword">let</span> resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-variable constant_">QUERY_SQL</span>, [vectorValue2, <span class="hljs-number">0</span>, vectorValue2]);</li><li>  <span class="hljs-keyword">while</span> (resultSet!.<span class="hljs-title function_">goToNextRow</span>()) {</li><li>     <span class="hljs-keyword">let</span> id = resultSet.<span class="hljs-title function_">getValue</span>(<span class="hljs-number">0</span>);</li><li>     <span class="hljs-keyword">let</span> dis = resultSet.<span class="hljs-title function_">getValue</span>(<span class="hljs-number">1</span>);</li><li>  }</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>
</li><li>  <span class="hljs-comment">// 不使用参数绑定</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">QUERY_SQL1</span> = <span class="hljs-string">"select id, repr &lt;-&gt; '[6.2, 7.3]' as distance from test where id &gt; 0 order by repr &lt;-&gt; '[6.2, 7.3]' limit 5;"</span>;</li><li>  resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-variable constant_">QUERY_SQL1</span>);</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`query failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 子查询</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 创建第二张表</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable constant_">CREATE_SQL</span> = <span class="hljs-string">"CREATE TABLE IF NOT EXISTS test1(id text PRIMARY KEY);"</span>;</li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-variable constant_">CREATE_SQL</span>);</li><li>  <span class="hljs-keyword">let</span> resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-string">"select * from test where id in (select id from test1);"</span>);</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`query failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 聚合查询</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-string">"select * from test where repr &lt;-&gt; '[1.0, 1.0]' &gt; 0 group by id having max(repr &lt;=&gt; '[1.0, 1.0]');"</span>);</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`query failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 多表查询</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// union all与union的区别在于union会将数据去重</span></li><li>  <span class="hljs-keyword">let</span> resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-string">"select id, repr &lt;-&gt; '[1.5, 5.6]' as distance from test union select id, repr &lt;-&gt; '[1.5, 5.6]' as distance from test order by distance limit 5;"</span>);</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`query failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>创建视图并执行查询。示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 视图查询</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 创建视图</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"CREATE VIEW v1 as select * from test where id &gt; 0;"</span>);</li><li>  <span class="hljs-keyword">let</span> resultSet = <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">querySql</span>(<span class="hljs-string">"select * from v1;"</span>);</li><li>  resultSet!.<span class="hljs-title function_">close</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`query failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>‌使用向量索引进行查询，提升查询效率。</p>       <p>向量数据库索引‌是一种以向量作为键的索引机制，旨在提供高效且快速的搜索能力。</p>       <p>当前支持的向量索引基础语法和扩展语法如下：</p>       <ul>        <li>         <p>基础语法如下：</p>         <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="sql prettyprint linenums hljs language-sql" hw-language="sql" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-operator">/</span><span class="hljs-operator">/</span> index_name为索引名称，index_type是索引类型，dist_function是索引距离度量类型</li><li><span class="hljs-keyword">CREATE</span> INDEX [IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] index_name <span class="hljs-keyword">ON</span> table_name <span class="hljs-keyword">USING</span> index_type (column_name dist_function);</li><li>
</li><li><span class="hljs-keyword">DROP</span> INDEX table_name.index_name;</li></ol></pre></div></div></li>        <li>         <p>扩展语法如下：</p>         <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="sql prettyprint linenums hljs language-sql" hw-language="sql" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">CREATE</span> INDEX [基础语法] [<span class="hljs-keyword">WITH</span>(<span class="hljs-keyword">parameter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span> [, ...])];</li></ol></pre></div></div></li>       </ul>       <p><strong>表1</strong> 索引类型(index_type)</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.6.1.3.1.1" valign="top" width="50%">类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.6.1.3.1.2" valign="top" width="50%">备注说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">gsdiskann</td>           <td class="cellrowborder" valign="top" width="50%">适用于处理高维稠密向量数据，如文本嵌入、图像特征等。</td>          </tr>                 </tbody></table></div>       </div>       <p><strong>表2</strong> 索引距离度量类型(dist_function)</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.8.1.4.1.1" valign="top" width="33.33333333333333%">类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.8.1.4.1.2" valign="top" width="33.33333333333333%">计算符号</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.8.1.4.1.3" valign="top" width="33.33333333333333%">备注说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">L2</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">&lt;-&gt;</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">欧式距离。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">COSINE</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">&lt;=&gt;</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">余弦距离。</td>          </tr>                 </tbody></table></div>       </div>       <p><strong>表3</strong> 扩展语法参数(parameter)</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.10.1.4.1.1" valign="top" width="33.33333333333333%">参数名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.10.1.4.1.2" valign="top" width="33.33333333333333%">取值范围和约束</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.7.10.1.4.1.3" valign="top" width="33.33333333333333%">备注说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">QUEUE_SIZE</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">设置范围是[10, 1000]，默认值 20。</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">代表创建索引搜索近邻的时候候选队列的长度，queue_size越大，构建速度降低，召回率有略微提升。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">OUT_DEGREE</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">设置范围是[1, 1200] ，默认值 60。</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">邻居节点出度数量。out_degree与pageSize也有关系，out_degree的数量超过pageSize的存储范围将报错GRD_INVALID_ARGS。</td>          </tr>                 </tbody></table></div>       </div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>           <p>删除索引的时候需要指定表名称，即Drop Index table.index_name。</p></li>          <li>           <p>随表一起创建的索引不能删除，如建表时创建的主键。</p></li>          <li>           <p>向量索引的命中条件。必须是ORDER BY + LIMIT类型的查询，ORDER BY只有一个排序条件，这个条件是向量距离条件；ORDER BY与DESC连用，不会使用向量索引；查询距离度量与创建索引时的度量需要保持一致，例如创建向量索引时使用L2，在查询时使用&lt;-&gt;进行度量才可以命中索引。</p></li>         </ul>        </div></div></div>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 基础用法</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 创建的索引名称为diskann_l2_idx，索引列为repr，类型为gsdiskann，距离度量类型为L2</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"CREATE INDEX diskann_l2_idx ON test USING GSDISKANN(repr L2);"</span>);</li><li>  <span class="hljs-comment">// 删除表test中的diskann_l2_idx索引</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"DROP INDEX test.diskann_l2_idx;"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create index failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 扩展语法</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 设置QUEUE_SIZE为20，OUT_DEGREE为50</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"CREATE INDEX diskann_l2_idx ON test USING GSDISKANN(repr L2) WITH (queue_size=20, out_degree=50);"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create ext index failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>手动回收索引删除产生的磁盘碎片。从API version 20 开始支持此功能。</p>       <p>向量数据库对已创建gsdiskann索引的表执行向量删除操作后，会自动执行磁盘碎片回收，但在以下两个场景下自动回收可能会无法触发：</p>       <ul>        <li>删除gsdiskann索引下的向量后，立刻关闭数据库。</li>        <li>批量删除gsdiskann索引下的向量后，后续不对该表进行任何操作。</li>       </ul>       <p>因此提供手动触发gsdiskann索引磁盘碎片回收的语句，语法如下所示：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="sql prettyprint linenums hljs language-sql" hw-language="sql" data-highlighted="yes"><ol class="linenums"><li>PRAGMA DISKANN_ASYNC_COLLECTING;</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>           <p>一次触发对向量数据库中所有表下的全部gsdiskann索引执行回收。</p></li>          <li>           <p>磁盘碎片回收任务为后台任务，不会阻塞后续其他语句的执行。</p></li>          <li>           <p>磁盘碎片回收任务由后台基于负载自动调度，通常仅在低负载场景下执行，成功所需时间依赖负载情况。</p></li>         </ul>        </div></div></div>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 手动触发异步删除整理，对向量数据库下所有gsdiskann执行磁盘碎片回收</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"PRAGMA DISKANN_ASYNC_COLLECTING;"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`diskann async collecting failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>配置数据老化功能。当应用的数据需要经常清理时，可以按时间或空间配置数据老化策略，从而实现数据的自动化清理。</p>       <p>语法如下所示：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="sql prettyprint linenums hljs language-sql" hw-language="sql" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table_name(column_name type [, ...]) [<span class="hljs-keyword">WITH</span>(<span class="hljs-keyword">parameter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">value</span> [, ...])];</li></ol></pre></div></div>       <p>其中，parameter为可配置的参数，value为对应取值，具体情况见下表。</p>       <p><strong>表4</strong> 数据老化策略参数(parameter)</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.9.6.1.4.1.1" valign="top" width="33.33333333333333%">参数名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.9.6.1.4.1.2" valign="top" width="33.33333333333333%">必填</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.9.6.1.4.1.3" valign="top" width="33.33333333333333%">取值范围和使用说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">time_col</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">是</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">列名。类型必须为整数且不为空。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">interval</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">老化任务线程的执行间隔时间，超过该时间后执行写操作，触发老化任务，删除符合老化条件的数据；若在间隔时间内执行写操作，不会触发老化任务。取值范围是[5 second, 1 year]，时间单位支持second、minute、hour、day、month、year，不区分大小写或复数形式(1 hour和1 hours均可)，默认是1 day。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">ttl</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">数据保留时间。取值范围是[1 hour, 1 year]，时间单位支持second、minute、hour、day、month、year，不区分大小写或复数形式(1 hour和1 hours均可)，默认是3 month。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">max_num</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">否</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">数据量限制。取值范围是[100, 1024]，默认是1024。老化任务在执行完过期数据删除后，如剩余表内数据超过max_num行，则会找到距离过期时间最近的时间点，删除该时间点对应的所有数据，直到数据量少于max_num。</td>          </tr>                 </tbody></table></div>       </div>       <p>时间相关参数会按数值换算为秒作为原子单位，取值规则如下所示：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.9.8.1.3.1.1" valign="top" width="50%">单位</th>           <th align="left" class="cellrowborder" id="mcps1.3.13.2.9.8.1.3.1.2" valign="top" width="50%">向下换算成秒取值</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">year</td>           <td class="cellrowborder" valign="top" width="50%">365 * 24 * 60 * 60</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">month</td>           <td class="cellrowborder" valign="top" width="50%">30 * 24 * 60 * 60</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">day</td>           <td class="cellrowborder" valign="top" width="50%">24 * 60 * 60</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">hour</td>           <td class="cellrowborder" valign="top" width="50%">60 * 60</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">minute</td>           <td class="cellrowborder" valign="top" width="50%">60</td>          </tr>                 </tbody></table></div>       </div>       <p>例如配置ttl = '3 months'，实际ttl会被换算为3 * (30 * 24 * 60 * 60) = 7776000 seconds。</p>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 每隔五分钟执行写操作后，会触发数据老化任务</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"CREATE TABLE test2(rec_time integer not null) WITH (time_col = 'rec_time', interval = '5 minute');"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`configure data aging failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>配置数据压缩功能。该功能在建表时配置，可以压缩数据类型为text的列数据。</p>       <p>从API version 20开始，支持数据压缩功能。</p>       <p>语法如下所示：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="sql prettyprint linenums hljs language-sql" hw-language="sql" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table_name(content text [, ...]) [<span class="hljs-keyword">WITH</span>(compress_col <span class="hljs-operator">=</span> <span class="hljs-string">'content'</span>)];</li></ol></pre></div></div>       <p>其中，compress_col为必填参数，value是类型为text的数据列名，可以与数据老化功能同时配置。</p>       <p>示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// content列配置了数据压缩，并且配置了数据老化。</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">execute</span>(<span class="hljs-string">"CREATE TABLE IF NOT EXISTS test3 (time integer not null, content text) with (time_col = 'time', interval = '5 minute', compress_col = 'content');"</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`configure data compress failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>删除数据库。</p>       <p>调用deleteRdbStore方法，删除数据库及数据库相关文件。示例代码如下：</p>       <div _ngcontent-knc-c106="" class="highlight-div"><div _ngcontent-knc-c106="" class="highlight-div-header"><div _ngcontent-knc-c106="" class="highlight-div-header-left"><div _ngcontent-knc-c106="" class="handle-button expand-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-knc-c106="" class="highlight-div-header-right"><div _ngcontent-knc-c106="" class="handle-button ai-button"></div><div _ngcontent-knc-c106="" class="handle-button line-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-knc-c106="" class="handle-button theme-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-knc-c106="" class="handle-button copy-button"><div _ngcontent-knc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-knc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 删除数据库前，需要先将store对象关闭，否则会导致下一次调用getRdbStore接口创建数据库失败</span></li><li>  <span class="hljs-keyword">await</span> store!.<span class="hljs-title function_">close</span>();</li><li>  <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">deleteRdbStore</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, <span class="hljs-variable constant_">STORE_CONFIG</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`delete rdbStore failed, code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>