<h1 _ngcontent-iro-c119="" class="doc-title ng-star-inserted" title="通过字节数组生成码图"> 通过字节数组生成码图 </h1>

<div _ngcontent-iro-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section16522171851016">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section16522171851016" tips="复制节点链接"></i></h2>          <p>码图生成能力支持将字节数组转换为自定义格式的码图。</p>    </div>    <div class="tiledSection">     <h2 id="section1451011513134">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section1451011513134" tips="复制节点链接"></i></h2>          <p>码图生成能力支持将字节数组转换为自定义格式的码图。</p>     <p>例如：调用码图生成能力, 将字节数组转换成交通一卡通二维码使用。</p>    </div>    <div class="tiledSection">     <h2 id="section9684181513312">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section9684181513312" tips="复制节点链接"></i></h2>          <ul>      <li>码图生成能力支持Phone、Tablet。从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持2in1、TV设备。</li>      <li>只支持QR Code生成，根据纠错水平不同对生成参数有不同的要求，参数限制可见下表，具体接口参数限制信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-generatebarcode#section87678254617" target="_blank">CreateOptions</a>。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>Scan Kit识别该码图内容显示内容为乱码，这种字节数组需要专门的解码器解析，例如地铁闸机。</p>        </div></div></div>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.3.1.1" valign="top" width="17.61%">            <p>纠错水平</p></th>           <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.3.1.2" valign="top" width="82.39%">            <p>参数内容限制</p></th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="17.61%">            <p>LEVEL_L</p></td>           <td class="cellrowborder" valign="top" width="82.39%">            <p>字节数组长度限制建议不超过2048。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="17.61%">            <p>LEVEL_M</p></td>           <td class="cellrowborder" valign="top" width="82.39%">            <p>字节数组长度限制建议不超过2048。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="17.61%">            <p>LEVEL_Q</p></td>           <td class="cellrowborder" valign="top" width="82.39%">            <p>字节数组长度限制建议不超过1536。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="17.61%">            <p>LEVEL_H</p></td>           <td class="cellrowborder" valign="top" width="82.39%">            <p>字节数组长度限制建议不超过1024。</p></td>          </tr>                 </tbody></table></div>       </div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>生成码参数建议：</li>          <li>码图颜色和背景           <p>建议使用默认颜色和背景：黑色码图、白色背景。如果码图颜色和背景对比度较小会影响识别率。</p></li>          <li>码图边距           <p>建议使用默认边距1，单位：px，取值范围：[1, 10]。</p></li>          <li>码图大小           <p>输入的width和height值相同且均大于等于200小于等于4096，单位：px，否则生成的码图过小会影响识别。</p></li>         </ul>        </div></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1850284851018">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section1850284851018" tips="复制节点链接"></i></h2>          <p><span><img height="376.97027900000006" originheight="535" originwidth="970" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114426.94462725346441533238505525580032:50001231000000:2800:875B579B4BA4A7B61B36413FC58F35E7F3600416FD8E45DD87AC479ABA254CD9.png" title="点击放大" width="663.3375000000001"></span></p>     <ol>      <li>用户向应用发起生成码请求后，传入需要生成的码的信息，包括码的类型、宽高等。</li>      <li>应用通过调用Scan Kit的createBarcode接口启动码图生成能力。</li>      <li>Scan Kit通过将字节数组转换为码图并返回给应用。</li>      <li>应用向用户返回生成码结果。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section8401194118505">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section8401194118505" tips="复制节点链接"></i></h2>          <p>通过字节数组生成码图，以Promise形式生成码图。具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-generatebarcode" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="46.589999999999996%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="53.410000000000004%">          <p>接口描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="46.589999999999996%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-generatebarcode#section77911759145019" target="_blank">createBarcode</a>(content: ArrayBuffer, options: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-generatebarcode#section87678254617" target="_blank">CreateOptions</a>): Promise&lt;image.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>&gt;</p></td>         <td class="cellrowborder" valign="top" width="53.410000000000004%">          <p>码图生成接口，返回image.PixelMap类型的参数，可以使用Image组件渲染成图片。使用Promise异步回调返回生成的码图。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section13428103844311">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section13428103844311" tips="复制节点链接"></i></h2>          <p>码图生成根据传参内容直接生成所需码图，需要传入固定参数和可选参数。</p>     <p>为了方便开发者接入，我们提供了详细的样例工程供参考，推荐参考<a href="https://gitcode.com/HarmonyOS_Samples/scan-kit_-sample-code_-clientdemo_-arkts" target="_blank">示例工程</a>接入。</p>     <p>以下示例为调用码图生成能力的createBarcode接口实现码图生成。</p>     <ol>      <li>导入码图生成接口模块，该模块提供了码图生成的参数和方法，导入方法如下。       <div _ngcontent-iro-c106="" class="highlight-div"><div _ngcontent-iro-c106="" class="highlight-div-header"><div _ngcontent-iro-c106="" class="highlight-div-header-left"><div _ngcontent-iro-c106="" class="handle-button expand-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iro-c106="" class="highlight-div-header-right"><div _ngcontent-iro-c106="" class="handle-button ai-button"></div><div _ngcontent-iro-c106="" class="handle-button line-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iro-c106="" class="handle-button theme-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iro-c106="" class="handle-button copy-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iro-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入码图生成需要的图片模块、错误码模块</span></li><li><span class="hljs-keyword">import</span> { scanCore, generateBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li></ol></pre></div></div></li>      <li>调用码图生成能力的createBarcode接口实现码图生成。       <ul>        <li>通过Promise方式回调，获取生成的码图。         <div _ngcontent-iro-c106="" class="highlight-div"><div _ngcontent-iro-c106="" class="highlight-div-header"><div _ngcontent-iro-c106="" class="highlight-div-header-left"><div _ngcontent-iro-c106="" class="handle-button expand-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iro-c106="" class="highlight-div-header-right"><div _ngcontent-iro-c106="" class="handle-button ai-button"></div><div _ngcontent-iro-c106="" class="handle-button line-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iro-c106="" class="handle-button theme-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iro-c106="" class="handle-button copy-button"><div _ngcontent-iro-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iro-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Create barcode'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'generateBarcode Promise'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = <span class="hljs-literal">undefined</span>;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> =</li><li><span class="hljs-string">'0177C10DD10F7768600202312110000063458FD14112345678FFFFD381012610b746365409210201b66636540ad0200020000000000110e617003201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006645fbec664358ECF657CB40693c92da'</span>;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">contentBuffer</span>: <span class="hljs-title class_">ArrayBuffer</span> = buffer.<span class="hljs-title function_">from</span>(content, <span class="hljs-string">'hex'</span>).<span class="hljs-property">buffer</span>; <span class="hljs-comment">// 通过包含十六进制字符的字符串创建Buffer</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: generateBarcode.<span class="hljs-property">CreateOptions</span> = {</li><li>          <span class="hljs-attr">scanType</span>: scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">QR_CODE</span>,</li><li>          <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,</li><li>          <span class="hljs-attr">width</span>: <span class="hljs-number">400</span></li><li>        }</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-comment">// 码图生成接口，成功返回PixelMap格式图片</span></li><li>          generateBarcode.<span class="hljs-title function_">createBarcode</span>(contentBuffer, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelMap: image.PixelMap</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = pixelMap;</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in creating barCode.'</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to createBarCode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          })</li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>            <span class="hljs-string">`Failed to createBarcode by Promise with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        }</li><li>      })</li><li>      <span class="hljs-comment">// 获取生成码后显示</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span>) {</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section8793479155">模拟器开发<i class="anchor-icon anchor-icon-link" anchorid="section8793479155" tips="复制节点链接"></i></h2>          <p>暂不支持模拟器使用，调用会返回错误信息“Emulator is not supported.”</p>    </div>   </div>   <div></div></div>