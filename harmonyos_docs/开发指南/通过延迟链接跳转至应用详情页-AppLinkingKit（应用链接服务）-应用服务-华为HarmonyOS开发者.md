<h1 _ngcontent-eqx-c119="" class="doc-title ng-star-inserted" title="通过延迟链接跳转至应用详情页"> 通过延迟链接跳转至应用详情页 </h1>

<div _ngcontent-eqx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section3415172434719">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section3415172434719" tips="复制节点链接"></i></h2>          <p>从5.0.3(15)版本开始，新增支持延迟链接能力。</p>     <p>当被分享用户未安装应用时，通过延迟链接能力，应用首次打开时，调用延迟链接接口，系统仍能获取用户之前点击的应用相关链接。在获取链接后，应用可直接跳转至对应的详情页，无需先跳转至应用首页，从而提升用户体验和链接的转化率。</p>     <p>例如：华为阅读结合App Linking Kit延迟链接能力，实现了即使用户未安装应用，点击链接完成下载并首次打开时，仍能直接跳转至预设页面（如书籍详情页）。与传统方式（需先打开APP再手动定位内容）相比，操作步骤减少了43%。</p>     <p><span><img height="527.6243" originheight="720" originwidth="363" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114512.40352520535069413510208743934380:50001231000000:2800:06918300BDAF821BA24801608C4C61A94355DB95B58F334C1765C37901848AE5.gif" title="点击放大" width="266"></span></p>    </div>    <div class="tiledSection">     <h2 id="section06781327144210">原理机制<i class="anchor-icon anchor-icon-link" anchorid="section06781327144210" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section6778301108" class="firsth2">一次性机制<i class="anchor-icon anchor-icon-link" anchorid="section6778301108" tips="复制节点链接"></i></h3>          <p>延迟链接只能获取一次，获取后，系统会从缓存中删除该链接；后续调用时，返回为空。</p>    </div>    <div class="tiledSection">     <h3 id="section877173015017">缓存机制<i class="anchor-icon anchor-icon-link" anchorid="section877173015017" tips="复制节点链接"></i></h3>          <ul>      <li>缓存时效性：系统缓存链接的最大时长为10分钟，超过则自动删除该缓存链接。</li>      <li>缓存条数限制：系统最多缓存的链接条目数为50条，超过则自动删除最早的缓存链接。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section18969904501">前提条件<i class="anchor-icon anchor-icon-link" anchorid="section18969904501" tips="复制节点链接"></i></h2>          <ol>      <li>目标方应用已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-linking-startupapp">配置App Linking应用链接</a>。</li>      <li>该能力目前仅适用于API 15及以上版本的HarmonyOS应用。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section3776301701">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section3776301701" tips="复制节点链接"></i></h2>          <p>只能获取通过App Linking域名校验的应用链接，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-linking-startupapp#section1101111611317">在AGC为应用创建关联的网址域名</a>。建议在首次启动签署隐私协议后再调用延迟链接接口，确保此时域名校验通过。</p>    </div>    <div class="tiledSection">     <h2 id="section998714173175">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section998714173175" tips="复制节点链接"></i></h2>          <ol>      <li>目标方应用获取延迟链接。       <ol>        <li>在入口类文件页面Index.ets中添加如下代码。当应用首次启动时，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/applinking-deferredlink-api#section15555111210233" target="_blank">deferredLink.popDeferredLink()</a>接口，获取用户此前点击的该应用相关链接。         <div _ngcontent-eqx-c106="" class="highlight-div"><div _ngcontent-eqx-c106="" class="highlight-div-header"><div _ngcontent-eqx-c106="" class="highlight-div-header-left"><div _ngcontent-eqx-c106="" class="handle-button expand-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eqx-c106="" class="highlight-div-header-right"><div _ngcontent-eqx-c106="" class="handle-button ai-button"></div><div _ngcontent-eqx-c106="" class="handle-button line-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eqx-c106="" class="handle-button theme-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eqx-c106="" class="handle-button copy-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eqx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { deferredLink } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppLinkingKit'</span>;  </li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li><span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>   <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>         <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>            <span class="hljs-title class_">Button</span>(<span class="hljs-string">"获取延迟链接"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>               <span class="hljs-comment">// 应用首次启动时，获取用户此前点击的该应用相关链接</span></li><li>               deferredLink.<span class="hljs-title function_">popDeferredLink</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">link: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in getting deferred link, result: <span class="hljs-subst">${link}</span>`</span>);</li><li>               }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                 <span class="hljs-comment">// 发生未知错误</span></li><li>                  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get deferred link.`</span>);</li><li>               })</li><li>            })</li><li>            <span class="hljs-comment">// ...</span></li><li>         }</li><li>         <span class="hljs-comment">// ...</span></li><li>      }</li><li>   }</li><li>}</li></ol></pre></div></div></li>        <li>根据自身业务逻辑配置链接，实现跳转到对应的详情页面。         <div _ngcontent-eqx-c106="" class="highlight-div"><div _ngcontent-eqx-c106="" class="highlight-div-header"><div _ngcontent-eqx-c106="" class="highlight-div-header-left"><div _ngcontent-eqx-c106="" class="handle-button expand-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eqx-c106="" class="highlight-div-header-right"><div _ngcontent-eqx-c106="" class="handle-button ai-button"></div><div _ngcontent-eqx-c106="" class="handle-button line-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eqx-c106="" class="handle-button theme-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eqx-c106="" class="handle-button copy-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eqx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { deferredLink } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppLinkingKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { url } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"获取延迟链接"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 应用首次启动时，获取用户此前点击的该应用相关链接</span></li><li>          deferredLink.<span class="hljs-title function_">popDeferredLink</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">link: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in getting deferred link, result: <span class="hljs-subst">${link}</span>`</span>);</li><li>            <span class="hljs-comment">// 若延迟链接不为空，开发者可根据自身业务逻辑配置链接，跳转至详情页面</span></li><li>            <span class="hljs-keyword">if</span> (link) {</li><li>              <span class="hljs-comment">// 根据业务逻辑配置链接，自行跳转至详情页面</span></li><li>              <span class="hljs-comment">// 如传入的url为：&lt;https://www.example.com/product?pageName=productDetail&gt;</span></li><li>              <span class="hljs-comment">// 从链接中解析query参数，拿到参数后，开发者可根据自己的业务需求进行后续的处理，示例如下：</span></li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-keyword">let</span> urlObject = url.<span class="hljs-property">URL</span>.<span class="hljs-title function_">parseURL</span>(link);</li><li>                <span class="hljs-keyword">let</span> pageName = urlObject.<span class="hljs-property">params</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'pageName'</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: pageName });</li><li>              } <span class="hljs-keyword">catch</span> (error) {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to parse url.`</span>);</li><li>              }</li><li>            }</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 发生未知错误</span></li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get deferred link.`</span>);</li><li>          })</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ol></li>      <li>拉起方应用跳转实现。       <p>拉起方应用可调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#openlink12" target="_blank">UIAbilityContext.openLink()</a>接口，传入目标应用的链接，从而拉起目标应用。</p>       <p>openLink接口提供了两种拉起目标应用的方式，开发者可根据业务需求进行选择。</p>       <ul>        <li>方式一： 仅以App Linking的方式打开应用。         <p>将appLinkingOnly参数设为true，若有App Linking匹配的应用，则直接打开目标应用。若无App Linking匹配的应用，则抛异常给开发者进行处理。</p>         <p>适用于无法打开目标应用时，开发者做了相应的异常处理。例如：拉起方应用集成了ArkWeb，当目标应用不存在时，可通过ArkWeb打开链接。</p></li>        <li>方式二： 以App Linking优先的方式打开应用。         <p>将appLinkingOnly参数设为false或者不传，若有App Linking匹配的应用，则直接打开目标应用。若无App Linking匹配的应用，则尝试以浏览器打开链接的方式打开应用。</p>         <p>适用于无法打开目标应用时，开发者未做任何处理。此时目标应用不存在时，会通过系统浏览器打开链接。</p></li>       </ul>       <p>本文为了方便验证App Linking的配置是否正确，选择方式一，示例如下。</p>       <ol>        <li>在“entry/src/main/ets/common”目录下添加GlobalContext.ets文件，开发初始化和获取应用上下文的接口。         <div _ngcontent-eqx-c106="" class="highlight-div"><div _ngcontent-eqx-c106="" class="highlight-div-header"><div _ngcontent-eqx-c106="" class="highlight-div-header-left"><div _ngcontent-eqx-c106="" class="handle-button expand-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eqx-c106="" class="highlight-div-header-right"><div _ngcontent-eqx-c106="" class="handle-button ai-button"></div><div _ngcontent-eqx-c106="" class="handle-button line-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eqx-c106="" class="handle-button theme-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eqx-c106="" class="handle-button copy-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eqx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalContext</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">initContext</span>(<span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">context</span> = context;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getContext</span>(): common.<span class="hljs-property">UIAbilityContext</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-property">context</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>        <li>在“entry/src/main/ets/entryability/EntryAbility.ets”文件中导入GlobalContext，在onCreate方法中使用GlobalContext.initContext(this.context)初始化全局应用上下文。</li>        <li>在“entry/src/main/ets/pages/Index.ets”文件中，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#openlink12" target="_blank">UIAbilityContext.openLink()</a>接口打开应用。         <div _ngcontent-eqx-c106="" class="highlight-div"><div _ngcontent-eqx-c106="" class="highlight-div-header"><div _ngcontent-eqx-c106="" class="highlight-div-header-left"><div _ngcontent-eqx-c106="" class="handle-button expand-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eqx-c106="" class="highlight-div-header-right"><div _ngcontent-eqx-c106="" class="handle-button ai-button"></div><div _ngcontent-eqx-c106="" class="handle-button line-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eqx-c106="" class="handle-button theme-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eqx-c106="" class="handle-button copy-button"><div _ngcontent-eqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eqx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GlobalContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../common/GlobalContext'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'start link'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>, <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'87%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-string">'12vp'</span> })</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> context = <span class="hljs-title class_">GlobalContext</span>.<span class="hljs-title function_">getContext</span>();</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">link</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"https://www.example.com/product?pageName=productDetail"</span>;</li><li>        <span class="hljs-comment">// 仅以App Linking的方式打开应用</span></li><li>        context.<span class="hljs-title function_">openLink</span>(link, { <span class="hljs-attr">appLinkingOnly</span>: <span class="hljs-literal">true</span> })</li><li>          .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in opening link.`</span>);</li><li>          })</li><li>          .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to open link, code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          })</li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ol></li>      <li>安装拉起方应用，点击拉起方应用中的跳转按钮。       <p>如果此时目标方应用未安装，会抛出系统异常。</p></li>      <li>安装目标方应用后，会根据获取的延迟链接直接跳转到目标方应用的详情页面。</li>     </ol>    </div>   </div>   <div></div></div>