<h1 _ngcontent-fgc-c119="" class="doc-title ng-star-inserted" title="通过标准化数据通路实现数据共享 (C/C++)"> 通过标准化数据通路实现数据共享 (C/C++) </h1>

<div _ngcontent-fgc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>在多对多跨应用数据共享的场景下，需要提供一条数据通路，能够写入多个不同应用的数据，并共享给其他应用进行读取。</p>     <p>UDMF针对多对多跨应用数据共享的不同业务场景，提供了标准化的数据通路和数据写入与读取接口。</p>    </div>    <div class="tiledSection">     <h2 id="标准化数据通路的定义和实现">标准化数据通路的定义和实现<i class="anchor-icon anchor-icon-link" anchorid="标准化数据通路的定义和实现" tips="复制节点链接"></i></h2>          <p>标准化数据通路是为各种业务场景提供的跨应用数据写入与读取通路。它能够暂存应用需要共享的、符合标准化数据定义的统一数据对象，并提供给其他应用访问。同时，它按照一定策略对暂存数据的修改、删除权限及生命周期进行管理。</p>     <p>标准化数据通路通过UDMF提供的系统服务实现。应用（数据提供方）需要共享公共数据时，可以通过UDMF提供的插入接口将数据写入UDMF的数据通路中，并且可以通过UDMF提供的更新和删除接口对已存入的数据进行更新和删除操作。目标应用（数据访问方）可以通过UDMF提供的读取接口访问数据。</p>     <p>标准化数据通路相关接口应不推荐多线程调用。</p>     <p>统一数据对象UnifiedData在UDMF数据通路中具有全局唯一URI标识，其定义为udmf://intention/bundleName/groupId，其中各组成部分的含义分别为：</p>     <ul>      <li>       <p><strong>udmf:</strong> 协议名，表示使用UDMF提供的数据通路。</p></li>      <li>       <p><strong>intention:</strong> UDMF已经支持的数据通路类型枚举值，对应不同的业务场景。</p></li>      <li>       <p><strong>bundleName:</strong> 数据来源应用的包名称。</p></li>      <li>       <p><strong>groupId:</strong> 分组名称，支持批量数据分组管理。</p></li>     </ul>     <p>当前UDMF中的跨应用数据共享通路有：<strong>公共数据通路</strong></p>     <p><strong>公共数据通路</strong>：应用共享的公用数据通路，所有应用均可向通路中写入数据。写入方可以根据写入数据时生成的数据唯一标识符进行数据的更新、删除、查询指定数据标识符或全量查询。数据读取方可以通过唯一标识符读取指定数据，也可以设置Intention枚举类型为DATA_HUB来读取当前数据通路中的全量数据。公共数据通路仅用于传输应用间的过程数据，不能用于传输沙箱目录下文件等有权限管控的数据。UDMF会统一对数据的生命周期进行管理，每小时定期清理存入时长超过一小时的数据。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-h" target="_blank">UDMF接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdsHyperlink* OH_UdsHyperlink_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建超链接类型对象的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdsHyperlink_SetDescription(OH_UdsHyperlink* pThis, const char* description)</td>         <td class="cellrowborder" valign="top" width="50%">设置超链接类型实例中的描述参数。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfRecord* OH_UdmfRecord_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个指向统一数据记录OH_UdmfRecord的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecord_AddHyperlink(OH_UdmfRecord* pThis, OH_UdsHyperlink* hyperlink)</td>         <td class="cellrowborder" valign="top" width="50%">向OH_UdmfRecord添加超链接类型数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfData* OH_UdmfData_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个指向统一数据对象OH_UdmfData的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfData_AddRecord(OH_UdmfData* pThis, OH_UdmfRecord* record)</td>         <td class="cellrowborder" valign="top" width="50%">向OH_UdmfData中增加一条OH_UdmfRecord数据记录。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Udmf_SetUnifiedDataByOptions(OH_UdmfOptions* options, OH_UdmfData *unifiedData, char *key, unsigned int keyLen)</td>         <td class="cellrowborder" valign="top" width="50%">从统一数据管理框架数据库中写入统一数据对象OH_UdmfData数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_UdsHyperlink_Destroy(OH_UdsHyperlink* pThis)</td>         <td class="cellrowborder" valign="top" width="50%">销毁超链接类型指针指向的实例对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_UdmfRecord_Destroy(OH_UdmfRecord* pThis)</td>         <td class="cellrowborder" valign="top" width="50%">销毁指向统一数据记录OH_UdmfRecord的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_UdmfData_Destroy(OH_UdmfData* pThis)</td>         <td class="cellrowborder" valign="top" width="50%">销毁指向统一数据对象OH_UdmfData的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">char** OH_UdmfRecord_GetTypes(OH_UdmfRecord* pThis, unsigned int* count)</td>         <td class="cellrowborder" valign="top" width="50%">获取OH_UdmfRecord中全部的数据类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecord_GetHyperlink(OH_UdmfRecord* pThis, OH_UdsHyperlink* hyperlink)</td>         <td class="cellrowborder" valign="top" width="50%">获取OH_UdmfRecord中超链接类型数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Udmf_GetUnifiedDataByOptions(OH_UdmfOptions* options, OH_UdmfData** dataArray, unsigned int* dataSize)</td>         <td class="cellrowborder" valign="top" width="50%">通过数据通路类型从统一数据管理框架数据库中获取统一数据对象数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Udmf_UpdateUnifiedData(OH_UdmfOptions* options, OH_UdmfData* unifiedData)</td>         <td class="cellrowborder" valign="top" width="50%">对统一数据管理框架数据库中的统一数据对象数据进行数据更改。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Udmf_DeleteUnifiedData(OH_UdmfOptions* options, OH_UdmfData** dataArray, unsigned int* dataSize)</td>         <td class="cellrowborder" valign="top" width="50%">删除统一数据管理框架数据库中的统一数据对象数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">bool OH_UdmfData_HasType(OH_UdmfData* pThis, const char* type)</td>         <td class="cellrowborder" valign="top" width="50%">判断统一数据对象OH_UdmfData是否存在指定类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfRecord** OH_UdmfData_GetRecords(OH_UdmfData* pThis, unsigned int* count)</td>         <td class="cellrowborder" valign="top" width="50%">获取OH_UdmfData中全部的数据记录。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfRecordProvider* OH_UdmfRecordProvider_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个指向统一数据提供者的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecordProvider_SetData(OH_UdmfRecordProvider* provider, void* context, const OH_UdmfRecordProvider_GetData callback, const UdmfData_Finalize finalize)</td>         <td class="cellrowborder" valign="top" width="50%">设置统一数据提供者的回调函数。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecord_SetProvider(OH_UdmfRecord* pThis, const char* const* types, unsigned int count, OH_UdmfRecordProvider* provider)</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据提供者配置到OH_UdmfRecord中。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfOptions* OH_UdmfOptions_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个指向数据操作选项的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_UdmfOptions_Destroy(OH_UdmfOptions* pThis)</td>         <td class="cellrowborder" valign="top" width="50%">销毁指向数据操作选项的指针。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="添加动态链接库">添加动态链接库<i class="anchor-icon anchor-icon-link" anchorid="添加动态链接库" tips="复制节点链接"></i></h2>          <p>CMakeLists.txt中添加以下库。</p>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libudmf.so, libhilog_ndk.z.so</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="引用头文件">引用头文件<i class="anchor-icon anchor-icon-link" anchorid="引用头文件" tips="复制节点链接"></i></h2>          <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/utd.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/uds.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/udmf.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/udmf_meta.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/udmf_err_code.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"MY_LOG"</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用udmf写入uds数据">使用UDMF写入UDS数据<i class="anchor-icon anchor-icon-link" anchorid="使用udmf写入uds数据" tips="复制节点链接"></i></h2>          <p>下面以写入超链接OH_UdsHyperlink类型数据场景为例，说明如何使用UDS与UDMF。</p>     <ol>      <li>创建hyperlink的UDS数据结构。</li>      <li>设置hyperlink中的URL和描述信息。</li>      <li>创建OH_UdmfRecord对象，并向OH_UdmfRecord中添加超链接类型数据。</li>      <li>创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</li>      <li>构建数据操作选项。</li>      <li>构建数据，将数据写入数据库中，得到返回的key值。</li>      <li>使用完成后销毁指针。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">createDataTest</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 1. 创建hyperlink的UDS数据结构。</span></li><li>    OH_UdsHyperlink* hyperlink = OH_UdsHyperlink_Create();</li><li>    <span class="hljs-comment">// 2. 设置hyperlink中的URL和描述信息。</span></li><li>    <span class="hljs-keyword">if</span> (OH_UdsHyperlink_SetUrl(hyperlink, <span class="hljs-string">"www.demo.com"</span>) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Hyperlink set url error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (OH_UdsHyperlink_SetDescription(hyperlink, <span class="hljs-string">"This is the description."</span>) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Hyperlink set description error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 创建OH_UdmfRecord对象，并向OH_UdmfRecord中添加超链接类型数据。</span></li><li>    OH_UdmfRecord* record = OH_UdmfRecord_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfRecord_AddHyperlink(record, hyperlink) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Add hyperlink to record error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 4. 创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</span></li><li>    OH_UdmfData* data = OH_UdmfData_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfData_AddRecord(data, record) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Add record to data error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 5. 构建数据操作选项。</span></li><li>    OH_UdmfOptions* options = OH_UdmfOptions_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfOptions_SetIntention(options, Udmf_Intention::UDMF_INTENTION_DATA_HUB) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set option error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 6. 构建数据，将数据写入数据库中，得到返回的key值。</span></li><li>    <span class="hljs-type">char</span> key[UDMF_KEY_BUFFER_LEN] = {<span class="hljs-number">0</span>};</li><li>    <span class="hljs-keyword">if</span> (OH_Udmf_SetUnifiedDataByOptions(options, data, key, <span class="hljs-keyword">sizeof</span>(key)) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set data error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"key = %{public}s"</span>, key);</li><li>    <span class="hljs-comment">// 7. 使用完成后销毁指针。</span></li><li>    OH_UdsHyperlink_Destroy(hyperlink);</li><li>    OH_UdmfRecord_Destroy(record);</li><li>    OH_UdmfData_Destroy(data);</li><li>    OH_UdmfOptions_Destroy(options);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用udmf获取uds数据">使用UDMF获取UDS数据<i class="anchor-icon anchor-icon-link" anchorid="使用udmf获取uds数据" tips="复制节点链接"></i></h2>          <p>下面继续以获取超链接OH_UdsHyperlink类型数据场景为例，说明如何使用UDS与UDMF。</p>     <ol>      <li>构建数据操作选项。</li>      <li>通过数据操作选项获取数据。</li>      <li>判断OH_UdmfData是否有对应的类型。</li>      <li>获取数据记录和hyperlink数据。</li>      <li>销毁指针。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">getDataTest</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 1. 构建数据操作选项。</span></li><li>    OH_UdmfOptions* options = OH_UdmfOptions_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfOptions_SetIntention(options, Udmf_Intention::UDMF_INTENTION_DATA_HUB) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set option error!"</span>);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 2. 通过数据操作选项获取数据。</span></li><li>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> dataSize = <span class="hljs-number">0</span>;</li><li>    OH_UdmfData* readData = nullptr;</li><li>    <span class="hljs-keyword">if</span> (OH_Udmf_GetUnifiedDataByOptions(options, &amp;readData, &amp;dataSize) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Get Data error!"</span>);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    OH_UdmfOptions_Destroy(options);</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"the size of data is %{public}u"</span>, dataSize);</li><li>    OH_UdmfData** dataArray = &amp;readData;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize; i++) {</li><li>        OH_UdmfData* data = dataArray[i];</li><li>        <span class="hljs-comment">// 3. 判断OH_UdmfData是否有对应的类型。</span></li><li>        <span class="hljs-keyword">if</span> (!OH_UdmfData_HasType(data, UDMF_META_HYPERLINK)) {</li><li>            OH_LOG_INFO(LOG_APP, <span class="hljs-string">"There is no hyperlink type in data[%{public}u]."</span>, i);</li><li>            <span class="hljs-keyword">continue</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 4. 获取数据记录和hyperlink数据。</span></li><li>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordsCount = <span class="hljs-number">0</span>;</li><li>        OH_UdmfRecord** records = OH_UdmfData_GetRecords(data, &amp;recordsCount);</li><li>        OH_LOG_INFO(LOG_APP, <span class="hljs-string">"the count of records count is %{public}u"</span>, recordsCount);    <span class="hljs-comment">// 5. 获取records中的元素。</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; recordsCount; j++) {</li><li>            <span class="hljs-comment">// 获取OH_UdmfRecord类型列表。</span></li><li>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordTypeIdCount = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-type">char</span>** typeIdsFromRecord = OH_UdmfRecord_GetTypes(records[i], &amp;recordTypeIdCount);</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; recordTypeIdCount; k++) {</li><li>                <span class="hljs-comment">// 从OH_UdmfRecord中获取超链接类型数据。</span></li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(typeIdsFromRecord[k], UDMF_META_HYPERLINK) == <span class="hljs-number">0</span>) {</li><li>                    <span class="hljs-comment">// 创建hyperlink的UDS，用来承载record中读取出来的hyperlink数据。</span></li><li>                    OH_UdsHyperlink* hyperlink = OH_UdsHyperlink_Create();</li><li>                    <span class="hljs-keyword">if</span> (OH_UdmfRecord_GetHyperlink(records[j], hyperlink) != Udmf_ErrCode::UDMF_E_OK) {</li><li>                        OH_LOG_ERROR(LOG_APP,<span class="hljs-string">"Fail get hyperlink from record!"</span>);</li><li>                        OH_UdsHyperlink_Destroy(hyperlink);</li><li>                        <span class="hljs-keyword">break</span>;</li><li>                    }</li><li>                    <span class="hljs-comment">// 读取OH_UdsHyperlink中的各项信息。</span></li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink type id is : %{public}s"</span>, OH_UdsHyperlink_GetType(hyperlink));</li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink url is : %{public}s"</span>, OH_UdsHyperlink_GetUrl(hyperlink));</li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink description is : %{public}s"</span>, OH_UdsHyperlink_GetDescription(hyperlink));</li><li>                    OH_UdsHyperlink_Destroy(hyperlink);</li><li>                }</li><li>            }</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// 5. 销毁指针。</span></li><li>    OH_Udmf_DestroyDataArray(dataArray, dataSize);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用udmf更新uds数据">使用UDMF更新UDS数据<i class="anchor-icon anchor-icon-link" anchorid="使用udmf更新uds数据" tips="复制节点链接"></i></h2>          <p>下面以更新超链接OH_UdsHyperlink类型数据场景为例，说明如何使用UDS与UDMF。</p>     <ol>      <li>创建hyperlink的UDS数据结构。</li>      <li>设置hyperlink中的URL和描述信息。</li>      <li>创建OH_UdmfRecord对象，并向OH_UdmfRecord中添加超链接类型数据。</li>      <li>创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</li>      <li>构建数据操作选项。</li>      <li>更新数据，将数据写入数据库中。</li>      <li>使用完成后销毁指针。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">updateDataTest</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 1. 创建hyperlink的UDS数据结构。</span></li><li>    OH_UdsHyperlink* hyperlink = OH_UdsHyperlink_Create();</li><li>    <span class="hljs-comment">// 2. 设置hyperlink中的URL和描述信息。</span></li><li>    <span class="hljs-keyword">if</span> (OH_UdsHyperlink_SetUrl(hyperlink, <span class="hljs-string">"www.demo2.com"</span>) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Hyperlink set url error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (OH_UdsHyperlink_SetDescription(hyperlink, <span class="hljs-string">"This is the new description."</span>) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Hyperlink set description error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 创建OH_UdmfRecord对象，并向OH_UdmfRecord中添加超链接类型数据。</span></li><li>    OH_UdmfRecord* record = OH_UdmfRecord_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfRecord_AddHyperlink(record, hyperlink) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Add hyperlink to record error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 4. 创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</span></li><li>    OH_UdmfData* data = OH_UdmfData_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfData_AddRecord(data, record) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Add record to data error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 5. 构建数据操作选项。</span></li><li>    OH_UdmfOptions* options = OH_UdmfOptions_Create();</li><li>    <span class="hljs-comment">// 此处key为示例，不可直接使用，其值应与OH_Udmf_SetUnifiedDataByOptions接口中获取到的key值保持一致。</span></li><li>    <span class="hljs-type">char</span> key[] = <span class="hljs-string">"udmf://DataHub/com.ohos.test/0123456789"</span>;</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfOptions_SetIntention(options, Udmf_Intention::UDMF_INTENTION_DATA_HUB) != Udmf_ErrCode::UDMF_E_OK</li><li>        || OH_UdmfOptions_SetKey(options, key) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set option error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 6. 更新数据，将数据写入数据库中。</span></li><li>    <span class="hljs-keyword">if</span> (OH_Udmf_UpdateUnifiedData(options, data) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Update data error!"</span>);</li><li>        OH_UdsHyperlink_Destroy(hyperlink);</li><li>        OH_UdmfRecord_Destroy(record);</li><li>        OH_UdmfData_Destroy(data);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"update data success"</span>);</li><li>    <span class="hljs-comment">// 7. 使用完成后销毁指针。</span></li><li>    OH_UdsHyperlink_Destroy(hyperlink);</li><li>    OH_UdmfRecord_Destroy(record);</li><li>    OH_UdmfData_Destroy(data);</li><li>    OH_UdmfOptions_Destroy(options);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用udmf删除uds数据">使用UDMF删除UDS数据<i class="anchor-icon anchor-icon-link" anchorid="使用udmf删除uds数据" tips="复制节点链接"></i></h2>          <p>下面继续以获取超链接OH_UdsHyperlink类型数据场景为例，说明如何使用UDS与UDMF。</p>     <ol>      <li>构建数据操作选项。</li>      <li>通过数据操作选项删除数据。</li>      <li>判断OH_UdmfData是否有对应的类型。</li>      <li>获取数据记录和hyperlink数据。</li>      <li>获取数据记录中的元素。</li>      <li>销毁指针。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">deleteDataTest</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 1. 构建数据操作选项。</span></li><li>    OH_UdmfOptions* options = OH_UdmfOptions_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfOptions_SetIntention(options, Udmf_Intention::UDMF_INTENTION_DATA_HUB) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set option error!"</span>);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 2. 通过数据操作选项删除数据。</span></li><li>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> dataSize = <span class="hljs-number">0</span>;</li><li>    OH_UdmfData* readData = nullptr;</li><li>    <span class="hljs-keyword">if</span> (OH_Udmf_DeleteUnifiedData(options, &amp;readData, &amp;dataSize) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Delete Data error!"</span>);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    OH_UdmfOptions_Destroy(options);</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"the size of data is %{public}u"</span>, dataSize);</li><li>    OH_UdmfData** dataArray = &amp;readData;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize - <span class="hljs-number">1</span>; i++) {</li><li>        OH_UdmfData* data = dataArray[i];</li><li>        <span class="hljs-comment">// 3. 判断OH_UdmfData是否有对应的类型。</span></li><li>        <span class="hljs-keyword">if</span> (!OH_UdmfData_HasType(data, UDMF_META_HYPERLINK)) {</li><li>            OH_LOG_INFO(LOG_APP, <span class="hljs-string">"There is no hyperlink type in data[%{public}u]."</span>, i);</li><li>            <span class="hljs-keyword">continue</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 4. 获取数据记录和hyperlink数据。</span></li><li>        <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordsCount = <span class="hljs-number">0</span>;</li><li>        OH_UdmfRecord** records = OH_UdmfData_GetRecords(data, &amp;recordsCount);</li><li>        OH_LOG_INFO(LOG_APP, <span class="hljs-string">"the count of records count is %{public}u"</span>, recordsCount);</li><li>        <span class="hljs-comment">// 5. 获取数据记录中的元素。</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; recordsCount; j++) {</li><li>            <span class="hljs-comment">// 获取OH_UdmfRecord类型列表。</span></li><li>            <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordTypeIdCount = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-type">char</span>** typeIdsFromRecord = OH_UdmfRecord_GetTypes(records[i], &amp;recordTypeIdCount);</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; recordTypeIdCount; k++) {</li><li>                <span class="hljs-comment">// 从OH_UdmfRecord中获取超链接类型数据。</span></li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(typeIdsFromRecord[k], UDMF_META_HYPERLINK) == <span class="hljs-number">0</span>) {</li><li>                    <span class="hljs-comment">// 创建hyperlink的UDS，用来承载record中读取出来的hyperlink数据。</span></li><li>                    OH_UdsHyperlink* hyperlink = OH_UdsHyperlink_Create();</li><li>                    <span class="hljs-keyword">if</span> (OH_UdmfRecord_GetHyperlink(records[j], hyperlink) != Udmf_ErrCode::UDMF_E_OK) {</li><li>                        OH_LOG_ERROR(LOG_APP,<span class="hljs-string">"Fail get hyperlink from record!"</span>);</li><li>                        OH_UdsHyperlink_Destroy(hyperlink);</li><li>                        <span class="hljs-keyword">break</span>;</li><li>                    }</li><li>                    <span class="hljs-comment">// 读取OH_UdsHyperlink中的各项信息。</span></li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink type id is : %{public}s"</span>, OH_UdsHyperlink_GetType(hyperlink));</li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink url is : %{public}s"</span>, OH_UdsHyperlink_GetUrl(hyperlink));</li><li>                    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"The hyperlink description is : %{public}s"</span>, OH_UdsHyperlink_GetDescription(hyperlink));</li><li>                    OH_UdsHyperlink_Destroy(hyperlink);</li><li>                }</li><li>            }</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// 6. 销毁指针。</span></li><li>    OH_Udmf_DestroyDataArray(dataArray, dataSize);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用udmf延迟写入uds数据">使用UDMF延迟写入UDS数据<i class="anchor-icon anchor-icon-link" anchorid="使用udmf延迟写入uds数据" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="定义uds数据提供函数" class="firsth2">定义UDS数据提供函数<i class="anchor-icon anchor-icon-link" anchorid="定义uds数据提供函数" tips="复制节点链接"></i></h3>          <p>下面以超链接hyperlink类型数据场景为例，说明如何定义一个提供UDS数据的回调函数。</p>     <ol>      <li>定义OH_UdmfRecordProvider的数据提供函数。</li>      <li>在数据提供函数中，创建hyperlink类型的UDS数据结构。</li>      <li>设置hyperlink的URL和描述信息。</li>      <li>定义OH_UdmfRecordProvider销毁时触发的回调函数。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 为了代码可读性，代码中省略了各个步骤操作结果的校验，实际开发中需要确认每次调用的成功。</span></li><li><span class="hljs-comment">// 1. 获取数据时触发的提供UDS数据的回调函数。</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title function_">GetDataCallback</span><span class="hljs-params">(<span class="hljs-type">void</span>* context, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* type)</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(type, UDMF_META_HYPERLINK) == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 2. 创建超链接hyperlink数据的UDS数据结构。</span></li><li>        OH_UdsHyperlink* hyperlink = OH_UdsHyperlink_Create();</li><li>        <span class="hljs-comment">// 3. 设置hyperlink中的URL和描述信息。</span></li><li>        OH_UdsHyperlink_SetUrl(hyperlink, <span class="hljs-string">"www.demo.com"</span>);</li><li>        OH_UdsHyperlink_SetDescription(hyperlink, <span class="hljs-string">"This is the description."</span>);</li><li>        <span class="hljs-keyword">return</span> hyperlink;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li><span class="hljs-comment">// 4. OH_UdmfRecordProvider销毁时触发的回调函数。</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">ProviderFinalizeCallback</span><span class="hljs-params">(<span class="hljs-type">void</span>* context)</span> { OH_LOG_INFO(LOG_APP, <span class="hljs-string">"OH_UdmfRecordProvider finalize."</span>); }</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="延迟写入uds数据">延迟写入UDS数据<i class="anchor-icon anchor-icon-link" anchorid="延迟写入uds数据" tips="复制节点链接"></i></h3>          <p>下面以延迟写入超链接类型数据为例，说明如何使用OH_UdmfRecordProvider与UDMF。此步骤完成后，超链接类型数据并未真正写入数据库。只有当数据使用者从OH_UdmfRecord中获取OH_UdsHyperlink时，才会触发上文定义的GetDataCallback数据提供函数，从中获取数据。</p>     <ol>      <li>创建OH_UdmfRecordProvider对象，设置它的数据提供函数和销毁回调函数。</li>      <li>创建OH_UdmfRecord对象，并配置OH_UdmfRecordProvider。</li>      <li>创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</li>      <li>构建数据并写入数据库中，获取返回的Key值。</li>      <li>使用完成后销毁指针。</li>     </ol>     <div _ngcontent-fgc-c106="" class="highlight-div"><div _ngcontent-fgc-c106="" class="highlight-div-header"><div _ngcontent-fgc-c106="" class="highlight-div-header-left"><div _ngcontent-fgc-c106="" class="handle-button expand-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgc-c106="" class="highlight-div-header-right"><div _ngcontent-fgc-c106="" class="handle-button ai-button"></div><div _ngcontent-fgc-c106="" class="handle-button line-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgc-c106="" class="handle-button theme-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgc-c106="" class="handle-button copy-button"><div _ngcontent-fgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgc-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">providerSetDataTest</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 为了代码可读性，代码中省略了各个步骤操作结果的校验，实际开发中需要确认每次调用的成功。</span></li><li>    <span class="hljs-comment">// 1. 创建一个OH_UdmfRecordProvider，设置它的数据提供函数和销毁回调函数。</span></li><li>    OH_UdmfRecordProvider* provider = OH_UdmfRecordProvider_Create();</li><li>    OH_UdmfRecordProvider_SetData(provider, (<span class="hljs-type">void</span>* )provider, GetDataCallback, ProviderFinalizeCallback);</li><li>
</li><li>    <span class="hljs-comment">// 2. 创建OH_UdmfRecord对象，并配置OH_UdmfRecordProvider。</span></li><li>    OH_UdmfRecord* record = OH_UdmfRecord_Create();</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* types[<span class="hljs-number">1</span>] = {UDMF_META_HYPERLINK};</li><li>    OH_UdmfRecord_SetProvider(record, types, <span class="hljs-number">1</span>, provider);</li><li>
</li><li>    <span class="hljs-comment">// 3. 创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</span></li><li>    OH_UdmfData* data = OH_UdmfData_Create();</li><li>    OH_UdmfData_AddRecord(data, record);</li><li>
</li><li>    <span class="hljs-comment">// 4. 构建数据并写入数据库中，获取返回的Key值。</span></li><li>    OH_UdmfOptions* options = OH_UdmfOptions_Create();</li><li>    <span class="hljs-keyword">if</span> (OH_UdmfOptions_SetIntention(options, Udmf_Intention::UDMF_INTENTION_DATA_HUB) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set option error!"</span>);</li><li>        OH_UdmfOptions_Destroy(options);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-type">char</span> key[UDMF_KEY_BUFFER_LEN] = {<span class="hljs-number">0</span>};</li><li>    <span class="hljs-keyword">if</span> (OH_Udmf_SetUnifiedDataByOptions(options, data, key, <span class="hljs-keyword">sizeof</span>(key)) != Udmf_ErrCode::UDMF_E_OK) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Set data error!"</span>);</li><li>    }</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"key = %{public}s"</span>, key);</li><li>
</li><li>    <span class="hljs-comment">// 5. 使用完成后销毁指针。</span></li><li>    OH_UdmfRecord_Destroy(record);</li><li>    OH_UdmfData_Destroy(data);</li><li>    OH_UdmfOptions_Destroy(options);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>