<h1 _ngcontent-voi-c119="" class="doc-title ng-star-inserted" title="通过用户首选项实现数据持久化 (C/C++)"> 通过用户首选项实现数据持久化 (C/C++) </h1>

<div _ngcontent-voi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>用户首选项（Preferences）模块主要提供轻量级Key-Value操作，支持本地存储少量数据，数据存储在文件和内存中，访问速度快。如果存在大量数据场景，请考虑使用键值型数据库或关系型数据库。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>API version 18之前：ArkTS API仅支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/data-persistence-by-preferences#xml存储">XML存储模式</a>；C API仅支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/data-persistence-by-preferences#gskv存储">GSKV存储模式</a>；存储模式互不兼容，不支持ArkTS和C API操作同一个Preferences实例。</li>      <li>API version 18及之后：ArkTS和C API均支持XML和GSKV双模式；ArkTS和C API使用相同的存储模式时，可以正常操作同一Preferences实例；禁止ArkTS和C API选择不同的存储模式，来操作同一个Preferences实例。</li>      <li>Key的最大长度限制为1024个字节，Value的最大长度限制为16MB。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-preferences" target="_blank">Preferences接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Preferences * OH_Preferences_Open (OH_PreferencesOption *option, int *errCode)</td>         <td class="cellrowborder" valign="top" width="50%">打开一个Preferences实例对象并创建指向它的指针。 当不再需要使用指针时，请使用OH_Preferences_Close关闭实例对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_Close (OH_Preferences *preference)</td>         <td class="cellrowborder" valign="top" width="50%">关闭一个Preferences实例对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_GetInt (OH_Preferences *preference, const char *key, int *value)</td>         <td class="cellrowborder" valign="top" width="50%">获取Preferences实例对象中Key对应的整型值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_GetBool (OH_Preferences *preference, const char *key, bool *value)</td>         <td class="cellrowborder" valign="top" width="50%">获取Preferences实例对象中Key对应的布尔值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_GetString (OH_Preferences *preference, const char *key, char **value, uint32_t *valueLen)</td>         <td class="cellrowborder" valign="top" width="50%">获取Preferences实例对象中Key对应的字符串。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_Preferences_FreeString (char *string)</td>         <td class="cellrowborder" valign="top" width="50%">释放从Preferences实例对象中获取的字符串。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_SetInt (OH_Preferences *preference, const char *key, int value)</td>         <td class="cellrowborder" valign="top" width="50%">根据Key设置Preferences实例对象中的整型值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_SetBool (OH_Preferences *preference, const char *key, bool value)</td>         <td class="cellrowborder" valign="top" width="50%">根据Key设置Preferences实例对象中的布尔值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_SetString (OH_Preferences *preference, const char *key, const char *value)</td>         <td class="cellrowborder" valign="top" width="50%">根据Key设置Preferences实例对象中的字符串。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_Delete (OH_Preferences *preference, const char *key)</td>         <td class="cellrowborder" valign="top" width="50%">在Preferences实例对象中删除Key对应的KV数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_RegisterDataObserver (OH_Preferences *preference, void *context, OH_PreferencesDataObserver observer, const char *keys[], uint32_t keyCount)</td>         <td class="cellrowborder" valign="top" width="50%">对选取的Key注册数据变更订阅。订阅的Key的值发生变更后，在调用OH_Preferences_Close()后触发回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_UnregisterDataObserver (OH_Preferences *preference, void *context, OH_PreferencesDataObserver observer, const char *keys[], uint32_t keyCount)</td>         <td class="cellrowborder" valign="top" width="50%">取消注册选取Key的数据变更订阅。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Preferences_IsStorageTypeSupported (Preferences_StorageType type, bool *isSupported)</td>         <td class="cellrowborder" valign="top" width="50%">检查当前平台是否支持对应的存储模式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_PreferencesOption * OH_PreferencesOption_Create (void)</td>         <td class="cellrowborder" valign="top" width="50%">创建一个Preferences配置选项的OH_PreferencesOption实例对象以及指向它的指针。 当不再需要使用指针时，请使用OH_PreferencesOption_Destroy销毁实例对象，否则会导致内存泄漏。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesOption_SetFileName (OH_PreferencesOption *option, const char *fileName)</td>         <td class="cellrowborder" valign="top" width="50%">设置Preferences配置选项OH_PreferencesOption实例对象的文件名称。名称长度为0到255字节，其中不能包含'/'。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesOption_SetBundleName (OH_PreferencesOption *option, const char *bundleName)</td>         <td class="cellrowborder" valign="top" width="50%">设置Preferences配置选项OH_PreferencesOption实例对象的包名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesOption_SetDataGroupId (OH_PreferencesOption *option, const char *dataGroupId)</td>         <td class="cellrowborder" valign="top" width="50%">设置Preferences配置选项OH_PreferencesOption实例对象的应用组ID。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesOption_SetStorageType (OH_PreferencesOption *option, Preferences_StorageType type)</td>         <td class="cellrowborder" valign="top" width="50%">设置Preferences配置选项 OH_PreferencesOption实例对象的存储模式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesOption_Destroy (OH_PreferencesOption *option)</td>         <td class="cellrowborder" valign="top" width="50%">销毁Preferences配置选项OH_PreferencesOption实例。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">const char * OH_PreferencesPair_GetKey (const OH_PreferencesPair *pairs, uint32_t index)</td>         <td class="cellrowborder" valign="top" width="50%">获取KV数据中索引对应数据的键。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">const OH_PreferencesValue * OH_PreferencesPair_GetPreferencesValue (const OH_PreferencesPair *pairs, uint32_t index)</td>         <td class="cellrowborder" valign="top" width="50%">获取KV数据数组中索引对应的值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Preference_ValueType OH_PreferencesValue_GetValueType (const OH_PreferencesValue *object)</td>         <td class="cellrowborder" valign="top" width="50%">获取PreferencesValue对象的数据类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesValue_GetInt (const OH_PreferencesValue *object, int *value)</td>         <td class="cellrowborder" valign="top" width="50%">从PreferencesValue对象OH_PreferencesValue中获取一个整型值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesValue_GetBool (const OH_PreferencesValue *object, bool *value)</td>         <td class="cellrowborder" valign="top" width="50%">从PreferencesValue对象OH_PreferencesValue中获取一个布尔值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_PreferencesValue_GetString (const OH_PreferencesValue *object, char **value, uint32_t *valueLen)</td>         <td class="cellrowborder" valign="top" width="50%">从PreferencesValue对象OH_PreferencesValue中获取字符串。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="添加动态链接库">添加动态链接库<i class="anchor-icon anchor-icon-link" anchorid="添加动态链接库" tips="复制节点链接"></i></h2>          <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-voi-c106="" class="highlight-div"><div _ngcontent-voi-c106="" class="highlight-div-header"><div _ngcontent-voi-c106="" class="highlight-div-header-left"><div _ngcontent-voi-c106="" class="handle-button expand-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-voi-c106="" class="highlight-div-header-right"><div _ngcontent-voi-c106="" class="handle-button ai-button"></div><div _ngcontent-voi-c106="" class="handle-button line-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-voi-c106="" class="handle-button theme-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-voi-c106="" class="handle-button copy-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-voi-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libohpreferences.so</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="引用头文件">引用头文件<i class="anchor-icon anchor-icon-link" anchorid="引用头文件" tips="复制节点链接"></i></h2>          <div _ngcontent-voi-c106="" class="highlight-div"><div _ngcontent-voi-c106="" class="highlight-div-header"><div _ngcontent-voi-c106="" class="highlight-div-header-left"><div _ngcontent-voi-c106="" class="handle-button expand-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-voi-c106="" class="highlight-div-header-right"><div _ngcontent-voi-c106="" class="handle-button ai-button"></div><div _ngcontent-voi-c106="" class="handle-button line-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-voi-c106="" class="handle-button theme-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-voi-c106="" class="handle-button copy-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-voi-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/preferences/oh_preferences.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/preferences/oh_preferences_err_code.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/preferences/oh_preferences_option.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/preferences/oh_preferences_value.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>下列实例展示如何通过Preferences实现对键值数据的修改与持久化。</p>     <ol>      <li>创建Preferences配置选项（PreferencesOption）对象并设置配置选项成员（名称、应用组ID、包名、存储模式）。使用完毕后，调用OH_PreferencesOption_Destroy销毁配置选项实例。</li>      <li>调用OH_Preferences_Open打开一个Preferences实例，该实例使用完后需要调用OH_Preferences_Close关闭。</li>      <li>调用OH_Preferences_RegisterDataObserver注册3个Key的数据变更订阅，订阅回调函数为DataChangeObserverCallback。</li>      <li>设置Preferences实例中的键值数据。</li>      <li>获取Preferences实例中的键值数据。</li>      <li>调用OH_Preferences_Close关闭Preferences实例，关闭后需要将实例指针置空。</li>     </ol>     <div _ngcontent-voi-c106="" class="highlight-div"><div _ngcontent-voi-c106="" class="highlight-div-header"><div _ngcontent-voi-c106="" class="highlight-div-header-left"><div _ngcontent-voi-c106="" class="handle-button expand-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-voi-c106="" class="highlight-div-header-right"><div _ngcontent-voi-c106="" class="handle-button ai-button"></div><div _ngcontent-voi-c106="" class="handle-button line-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-voi-c106="" class="handle-button theme-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-voi-c106="" class="handle-button copy-button"><div _ngcontent-voi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-voi-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 数据变更回调函数</span></li><li><span class="hljs-type">void</span> <span class="hljs-title function_">DataChangeObserverCallback</span><span class="hljs-params">(<span class="hljs-type">void</span> *context, <span class="hljs-type">const</span> OH_PreferencesPair *pairs, <span class="hljs-type">uint32_t</span> count)</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</li><li>        <span class="hljs-comment">// 获取索引i对应的PreferenceValue</span></li><li>        <span class="hljs-type">const</span> OH_PreferencesValue *pValue = OH_PreferencesPair_GetPreferencesValue(pairs, i);</li><li>        <span class="hljs-comment">// 获取PreferencesValue的数据类型</span></li><li>        Preference_ValueType type = OH_PreferencesValue_GetValueType(pValue);</li><li>        <span class="hljs-type">int</span> ret = PREFERENCES_OK;</li><li>        <span class="hljs-keyword">if</span> (type == PREFERENCE_TYPE_INT) {</li><li>            <span class="hljs-type">int</span> intValue = <span class="hljs-number">0</span>;</li><li>            ret = OH_PreferencesValue_GetInt(pValue, &amp;intValue);</li><li>            <span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>                <span class="hljs-comment">// 业务逻辑</span></li><li>            }</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == PREFERENCE_TYPE_BOOL) {</li><li>            <span class="hljs-type">bool</span> boolValue = <span class="hljs-literal">true</span>;</li><li>            ret = OH_PreferencesValue_GetBool(pValue, &amp;boolValue);</li><li>            <span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>                <span class="hljs-comment">// 业务逻辑</span></li><li>            }</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == PREFERENCE_TYPE_STRING) {</li><li>            <span class="hljs-type">char</span> *stringValue = nullptr;</li><li>            <span class="hljs-type">uint32_t</span> valueLen = <span class="hljs-number">0</span>;</li><li>            ret = OH_PreferencesValue_GetString(pValue, &amp;stringValue, &amp;valueLen);</li><li>            <span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>                <span class="hljs-comment">// 业务逻辑</span></li><li>                OH_Preferences_FreeString(stringValue);</li><li>            }</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// 无效类型</span></li><li>        }</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 1. 创建Preferences配置选项。</span></li><li>OH_PreferencesOption *option = OH_PreferencesOption_Create();</li><li><span class="hljs-keyword">if</span> (option == nullptr) {</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li><span class="hljs-comment">// 设置Preferences配置选项的文件名称。</span></li><li><span class="hljs-type">int</span> ret = OH_PreferencesOption_SetFileName(option, <span class="hljs-string">"testdb"</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li><span class="hljs-comment">// 设置Preferences配置选项的应用组ID。</span></li><li>ret = OH_PreferencesOption_SetDataGroupId(option, <span class="hljs-string">""</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li><span class="hljs-comment">// 设置Preferences配置选项的包名称。</span></li><li>ret = OH_PreferencesOption_SetBundleName(option, <span class="hljs-string">"com.example"</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 设置Preferences配置选项的存储模式，需要注意的是，设置之前需要调用OH_Preferences_IsStorageTypeSupported接口判断当前平台是否支持需要选择的模式。</span></li><li><span class="hljs-type">bool</span> isGskvSupported = <span class="hljs-literal">false</span>;</li><li>ret = OH_Preferences_IsStorageTypeSupported(Preferences_StorageType::PREFERENCES_STORAGE_GSKV, &amp;isGskvSupported);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li><span class="hljs-keyword">if</span> (isGskvSupported) {</li><li>    ret = OH_PreferencesOption_SetStorageType(option, Preferences_StorageType::PREFERENCES_STORAGE_GSKV);</li><li>    <span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>        (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>        <span class="hljs-comment">// 错误处理</span></li><li>    }</li><li>} <span class="hljs-keyword">else</span> {</li><li>    ret = OH_PreferencesOption_SetStorageType(option, Preferences_StorageType::PREFERENCES_STORAGE_XML);</li><li>    <span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>        (<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>        <span class="hljs-comment">// 错误处理</span></li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 2. 打开一个Preferences实例。</span></li><li><span class="hljs-type">int</span> errCode = PREFERENCES_OK;</li><li>OH_Preferences *preference = OH_Preferences_Open(option, &amp;errCode);</li><li><span class="hljs-comment">// option使用完毕后可直接释放，释放后需要将指针置空。</span></li><li>(<span class="hljs-type">void</span>)OH_PreferencesOption_Destroy(option);</li><li>option = nullptr;</li><li><span class="hljs-keyword">if</span> (preference == nullptr || errCode != PREFERENCES_OK) {</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 3. 对key_int、key_bool和key_string注册数据变更订阅。</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *keys[] = {<span class="hljs-string">"key_int"</span>, <span class="hljs-string">"key_bool"</span>, <span class="hljs-string">"key_string"</span>};</li><li>ret = OH_Preferences_RegisterDataObserver(preference, nullptr, DataChangeObserverCallback, keys, <span class="hljs-number">3</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_Preferences_Close(preference);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 4. 设置Preferences实例中的KV数据。</span></li><li>ret = OH_Preferences_SetInt(preference, keys[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_Preferences_Close(preference);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>ret = OH_Preferences_SetBool(preference, keys[<span class="hljs-number">1</span>], <span class="hljs-literal">true</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_Preferences_Close(preference);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>ret = OH_Preferences_SetString(preference, keys[<span class="hljs-number">2</span>], <span class="hljs-string">"string value"</span>);</li><li><span class="hljs-keyword">if</span> (ret != PREFERENCES_OK) {</li><li>    (<span class="hljs-type">void</span>)OH_Preferences_Close(preference);</li><li>    <span class="hljs-comment">// 错误处理</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 5. 获取Preferences实例中的KV数据。</span></li><li><span class="hljs-type">int</span> intValue = <span class="hljs-number">0</span>;</li><li>ret = OH_Preferences_GetInt(preference, keys[<span class="hljs-number">0</span>], &amp;intValue);</li><li><span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>    <span class="hljs-comment">// 业务逻辑</span></li><li>}</li><li>
</li><li><span class="hljs-type">bool</span> boolValue = <span class="hljs-literal">false</span>;</li><li>ret = OH_Preferences_GetBool(preference, keys[<span class="hljs-number">1</span>], &amp;boolValue);</li><li><span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>    <span class="hljs-comment">// 业务逻辑</span></li><li>}</li><li>
</li><li><span class="hljs-type">char</span> *stringValue = nullptr;</li><li><span class="hljs-type">uint32_t</span> valueLen = <span class="hljs-number">0</span>;</li><li>ret = OH_Preferences_GetString(preference, keys[<span class="hljs-number">2</span>], &amp;stringValue, &amp;valueLen);</li><li><span class="hljs-keyword">if</span> (ret == PREFERENCES_OK) {</li><li>    <span class="hljs-comment">// 业务逻辑</span></li><li>    <span class="hljs-comment">// 使用完OH_Preferences_GetString接口后，需要对字符串进行释放。</span></li><li>    OH_Preferences_FreeString(stringValue);</li><li>    stringValue = nullptr;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 6. 使用完Preferences实例后需要关闭实例，关闭后需要将指针置空。</span></li><li>(<span class="hljs-type">void</span>)OH_Preferences_Close(preference);</li><li>preference = nullptr;</li></ol></pre></div></div>    </div>   </div>   <div></div></div>