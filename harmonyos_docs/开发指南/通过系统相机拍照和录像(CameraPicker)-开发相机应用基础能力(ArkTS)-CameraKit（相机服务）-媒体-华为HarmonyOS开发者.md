<h1 _ngcontent-pmc-c119="" class="doc-title ng-star-inserted" title="通过系统相机拍照和录像(CameraPicker)"> 通过系统相机拍照和录像(CameraPicker) </h1>

<div _ngcontent-pmc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>应用可调用CameraPicker拍摄照片或录制视频，无需申请相机权限。</p>    <p>CameraPicker的相机交互界面由系统提供，在用户点击拍摄和确认按钮后，调用CameraPicker的应用获取对应的照片或者视频。</p>    <p>应用开发者如果只是需要获取即时拍摄的照片或者视频，则可以使用CameraPicker能力来轻松实现。</p>    <p>由于照片的拍摄和确认都是由用户进行主动确认，因此应用开发者可以不用申请操作相机的相关权限。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camerapicker" target="_blank">CameraPicker API参考</a>。</p>     <ol>      <li>       <p>导入相关接口，导入方法如下。</p>       <div _ngcontent-pmc-c106="" class="highlight-div"><div _ngcontent-pmc-c106="" class="highlight-div-header"><div _ngcontent-pmc-c106="" class="highlight-div-header-left"><div _ngcontent-pmc-c106="" class="handle-button expand-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmc-c106="" class="highlight-div-header-right"><div _ngcontent-pmc-c106="" class="handle-button ai-button"></div><div _ngcontent-pmc-c106="" class="handle-button line-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmc-c106="" class="handle-button theme-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmc-c106="" class="handle-button copy-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera, cameraPicker <span class="hljs-keyword">as</span> picker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo, fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camerapicker#pickerprofile" target="_blank">PickerProfile</a>。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>PickerProfile的saveUri为可选参数，如果未配置该项，拍摄的照片和视频默认存入媒体库中。</p>         <p>如果不想将照片和视频存入媒体库，请自行配置应用沙箱内的文件路径。</p>         <p>应用沙箱内的这个文件必须是一个存在的、可写的文件。这个文件的uri传入picker接口之后，相当于应用给系统相机授权该文件的读写权限。系统相机在拍摄结束之后，会对此文件进行覆盖写入。</p>        </div></div></div>       <div _ngcontent-pmc-c106="" class="highlight-div"><div _ngcontent-pmc-c106="" class="highlight-div-header"><div _ngcontent-pmc-c106="" class="highlight-div-header-left"><div _ngcontent-pmc-c106="" class="handle-button expand-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmc-c106="" class="highlight-div-header-right"><div _ngcontent-pmc-c106="" class="handle-button ai-button"></div><div _ngcontent-pmc-c106="" class="handle-button line-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmc-c106="" class="handle-button theme-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmc-c106="" class="handle-button copy-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPickerProfile</span>(<span class="hljs-params">context: Context</span>): picker.<span class="hljs-property">PickerProfile</span> {</li><li>  <span class="hljs-keyword">let</span> pathDir = context.<span class="hljs-property">filesDir</span>;</li><li>  <span class="hljs-keyword">let</span> fileName = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()}</span>`</span>;</li><li>  <span class="hljs-keyword">let</span> filePath = pathDir + <span class="hljs-string">`/<span class="hljs-subst">${fileName}</span>.tmp`</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    fileIo.<span class="hljs-title function_">createRandomAccessFileSync</span>(filePath, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create picker profile failed. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  </li><li>  <span class="hljs-keyword">let</span> uri = fileUri.<span class="hljs-title function_">getUriFromPath</span>(filePath);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">pickerProfile</span>: picker.<span class="hljs-property">PickerProfile</span> = {</li><li>    <span class="hljs-attr">cameraPosition</span>: camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_BACK</span>,</li><li>    <span class="hljs-attr">saveUri</span>: uri</li><li>  };</li><li>  <span class="hljs-keyword">return</span> pickerProfile;</li><li>}</li></ol></pre></div></div>       <p>fileIo接口调用方法请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs#fscreaterandomaccessfilesync10" target="_blank">createRandomAccessFileSync</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fileuri#fileurigeturifrompath" target="_blank">getUriFromPath</a>。</p></li>      <li>       <p>调用picker拍摄接口获取拍摄的结果。</p>       <div _ngcontent-pmc-c106="" class="highlight-div"><div _ngcontent-pmc-c106="" class="highlight-div-header"><div _ngcontent-pmc-c106="" class="highlight-div-header-left"><div _ngcontent-pmc-c106="" class="handle-button expand-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmc-c106="" class="highlight-div-header-right"><div _ngcontent-pmc-c106="" class="handle-button ai-button"></div><div _ngcontent-pmc-c106="" class="handle-button line-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmc-c106="" class="handle-button theme-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmc-c106="" class="handle-button copy-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPickerResult</span>(<span class="hljs-params">context: Context, pickerProfile: picker.PickerProfile</span>): <span class="hljs-title class_">Promise</span>&lt;picker.<span class="hljs-property">PickerResult</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: picker.<span class="hljs-property">PickerResult</span> =</li><li>    <span class="hljs-comment">// 调用picker方法拉起系统相机，获取拍摄的图片或视频。</span></li><li>    <span class="hljs-keyword">await</span> picker.<span class="hljs-title function_">pick</span>(context, [picker.<span class="hljs-property">PickerMediaType</span>.<span class="hljs-property">PHOTO</span>, picker.<span class="hljs-property">PickerMediaType</span>.<span class="hljs-property">VIDEO</span>],</li><li>      pickerProfile);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`picker resultCode: <span class="hljs-subst">${result.resultCode}</span>,resultUri: <span class="hljs-subst">${result.resultUri}</span>,mediaType: <span class="hljs-subst">${result.mediaType}</span>`</span>);</li><li>  <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <div _ngcontent-pmc-c106="" class="highlight-div"><div _ngcontent-pmc-c106="" class="highlight-div-header"><div _ngcontent-pmc-c106="" class="highlight-div-header-left"><div _ngcontent-pmc-c106="" class="handle-button expand-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pmc-c106="" class="highlight-div-header-right"><div _ngcontent-pmc-c106="" class="handle-button ai-button"></div><div _ngcontent-pmc-c106="" class="handle-button line-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pmc-c106="" class="handle-button theme-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pmc-c106="" class="handle-button copy-button"><div _ngcontent-pmc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pmc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera, cameraPicker <span class="hljs-keyword">as</span> picker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo, fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">imgSrc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">videoSrc</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-title function_">createPickerProfile</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>): picker.<span class="hljs-property">PickerProfile</span> {</li><li>    <span class="hljs-keyword">let</span> pathDir = context.<span class="hljs-property">filesDir</span>;</li><li>    <span class="hljs-keyword">let</span> fileName = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()}</span>`</span>;</li><li>    <span class="hljs-keyword">let</span> filePath = pathDir + <span class="hljs-string">`/<span class="hljs-subst">${fileName}</span>.tmp`</span>;</li><li>    fileIo.<span class="hljs-title function_">createRandomAccessFileSync</span>(filePath, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>    </li><li>    <span class="hljs-keyword">let</span> uri = fileUri.<span class="hljs-title function_">getUriFromPath</span>(filePath);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">pickerProfile</span>: picker.<span class="hljs-property">PickerProfile</span> = {</li><li>      <span class="hljs-attr">cameraPosition</span>: camera.<span class="hljs-property">CameraPosition</span>.<span class="hljs-property">CAMERA_POSITION_BACK</span>,</li><li>      <span class="hljs-attr">saveUri</span>: uri</li><li>    };</li><li>    <span class="hljs-keyword">return</span> pickerProfile;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPickerResult</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">pickerProfile</span>: picker.<span class="hljs-property">PickerProfile</span>): <span class="hljs-title class_">Promise</span>&lt;picker.<span class="hljs-property">PickerResult</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: picker.<span class="hljs-property">PickerResult</span> =</li><li>      <span class="hljs-keyword">await</span> picker.<span class="hljs-title function_">pick</span>(context, [picker.<span class="hljs-property">PickerMediaType</span>.<span class="hljs-property">PHOTO</span>, picker.<span class="hljs-property">PickerMediaType</span>.<span class="hljs-property">VIDEO</span>],</li><li>        pickerProfile);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`picker resultCode: <span class="hljs-subst">${result.resultCode}</span>,resultUri: <span class="hljs-subst">${result.resultUri}</span>,mediaType: <span class="hljs-subst">${result.mediaType}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getContext</span>(): <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = uiContext.<span class="hljs-title function_">getHostContext</span>();</li><li>    <span class="hljs-keyword">return</span> context;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSrc</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>);</li><li>        <span class="hljs-title class_">Video</span>({ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoSrc</span>}).<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">autoPlay</span>(<span class="hljs-literal">true</span>);</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Test Picker Photo&amp;Video"</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getContext</span>();</li><li>            <span class="hljs-keyword">if</span> (context === <span class="hljs-literal">undefined</span>) {</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-keyword">let</span> pickerProfile = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createPickerProfile</span>(context);</li><li>            <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getPickerResult</span>(context, pickerProfile);</li><li>            <span class="hljs-keyword">if</span> (result.<span class="hljs-property">resultCode</span> == <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-keyword">if</span> (result.<span class="hljs-property">mediaType</span> === picker.<span class="hljs-property">PickerMediaType</span>.<span class="hljs-property">PHOTO</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSrc</span> = result.<span class="hljs-property">resultUri</span>;</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoSrc</span> = result.<span class="hljs-property">resultUri</span>;</li><li>              }</li><li>            }</li><li>          }).<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>);</li><li>
</li><li>      }.<span class="hljs-title function_">alignRules</span>({</li><li>        <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>        <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>      });</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>