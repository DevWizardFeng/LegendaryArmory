<h1 _ngcontent-mgu-c119="" class="doc-title ng-star-inserted" title="通过键值型数据库实现数据持久化 (ArkTS)"> 通过键值型数据库实现数据持久化 (ArkTS) </h1>

<div _ngcontent-mgu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>键值型数据库存储键值对形式的数据，当需要存储的数据没有复杂的关系模型，比如存储商品名称及对应价格、员工工号及今日是否已出勤等，由于数据复杂度低，更容易兼容不同数据库版本和设备类型，因此推荐使用键值型数据库持久化此类数据。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>设备协同数据库，针对每条记录，Key的长度≤896 Byte，Value的长度&lt;4 MB。</p></li>      <li>       <p>单版本数据库，针对每条记录，Key的长度≤1 KB，Value的长度&lt;4 MB。</p></li>      <li>       <p>每个应用程序最多支持同时打开16个键值型分布式数据库。</p></li>      <li>       <p>键值型数据库事件回调方法中不允许进行阻塞操作，例如修改UI组件。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>以下是键值型数据库持久化功能的相关接口，大部分为异步接口。异步接口均有callback和Promise两种返回形式，下表均以callback形式为例，更多接口及使用方式请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributedkvstore" target="_blank">分布式键值数据库</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">createKVManager(config: KVManagerConfig): KVManager</td>         <td class="cellrowborder" valign="top" width="50%">创建一个KVManager对象实例，用于管理数据库对象。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getKVStore&lt;T&gt;(storeId: string, options: Options, callback: AsyncCallback&lt;T&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">指定options和storeId，创建并得到指定类型的KVStore数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">put(key: string, value: Uint8Array | string | number | boolean, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">添加指定类型的键值对到数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">get(key: string, callback: AsyncCallback&lt;boolean | string | number | Uint8Array&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">获取指定键的值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">delete(key: string, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">从数据库中删除指定键值的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">closeKVStore(appId: string, storeId: string, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">通过storeId的值关闭指定的分布式键值数据库。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">deleteKVStore(appId: string, storeId: string, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">通过storeId的值删除指定的分布式键值数据库。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>若要使用键值型数据库，首先要使用createKVManager()方法获取一个KVManager实例，用于管理数据库对象。示例代码如下所示：</p>       <p>Stage模型示例：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入模块</span></li><li><span class="hljs-keyword">import</span> { distributedKVStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-comment">// Stage模型</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">kvManager</span>: distributedKVStore.<span class="hljs-property">KVManager</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">appId</span>: string = <span class="hljs-string">'com.example.datamanagertest'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storeId</span>: string = <span class="hljs-string">'storeId'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">kvManagerConfig</span>: distributedKVStore.<span class="hljs-property">KVManagerConfig</span> = {</li><li>      <span class="hljs-attr">context</span>: context,</li><li>      <span class="hljs-attr">bundleName</span>: appId</li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 创建KVManager实例</span></li><li>      kvManager = distributedKVStore.<span class="hljs-title function_">createKVManager</span>(kvManagerConfig);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in creating KVManager.'</span>);</li><li>      <span class="hljs-comment">// 继续创建获取数据库</span></li><li>      <span class="hljs-keyword">if</span> (kvManager !== <span class="hljs-literal">undefined</span>) {</li><li>       <span class="hljs-comment">//进行后续操作</span></li><li>       <span class="hljs-comment">//...</span></li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create KVManager. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p>FA模型示例：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入模块</span></li><li><span class="hljs-keyword">import</span> { distributedKVStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-comment">// FA模型</span></li><li><span class="hljs-keyword">import</span> { featureAbility } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">kvManager</span>: distributedKVStore.<span class="hljs-property">KVManager</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">appId</span>: string = <span class="hljs-string">'com.example.datamanagertest'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storeId</span>: string = <span class="hljs-string">'storeId'</span>;</li><li><span class="hljs-keyword">let</span> context = featureAbility.<span class="hljs-title function_">getContext</span>(); <span class="hljs-comment">// 获取context</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">kvManagerConfig</span>: distributedKVStore.<span class="hljs-property">KVManagerConfig</span> = {</li><li>  <span class="hljs-attr">context</span>: context,</li><li>  <span class="hljs-attr">bundleName</span>: appId</li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  kvManager = distributedKVStore.<span class="hljs-title function_">createKVManager</span>(kvManagerConfig);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in creating KVManager.'</span>);</li><li>  <span class="hljs-comment">// 继续创建获取数据库</span></li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>   <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create KVManager. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li><li><span class="hljs-keyword">if</span> (kvManager !== <span class="hljs-literal">undefined</span>) {</li><li>  <span class="hljs-comment">//进行后续操作</span></li><li>  <span class="hljs-comment">//...</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用getKVStore()方法创建并获取键值数据库。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">kvStore</span>: distributedKVStore.<span class="hljs-property">SingleKVStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> child1 = <span class="hljs-keyword">new</span> distributedKVStore.<span class="hljs-title class_">FieldNode</span>(<span class="hljs-string">'id'</span>);</li><li>  child1.<span class="hljs-property">type</span> = distributedKVStore.<span class="hljs-property">ValueType</span>.<span class="hljs-property">INTEGER</span>;</li><li>  child1.<span class="hljs-property">nullable</span> = <span class="hljs-literal">false</span>;</li><li>  child1.<span class="hljs-property">default</span> = <span class="hljs-string">'1'</span>;</li><li>  <span class="hljs-keyword">let</span> child2 = <span class="hljs-keyword">new</span> distributedKVStore.<span class="hljs-title class_">FieldNode</span>(<span class="hljs-string">'name'</span>);</li><li>  child2.<span class="hljs-property">type</span> = distributedKVStore.<span class="hljs-property">ValueType</span>.<span class="hljs-property">STRING</span>;</li><li>  child2.<span class="hljs-property">nullable</span> = <span class="hljs-literal">false</span>;</li><li>  child2.<span class="hljs-property">default</span> = <span class="hljs-string">'zhangsan'</span>;</li><li>
</li><li>  <span class="hljs-keyword">let</span> schema = <span class="hljs-keyword">new</span> distributedKVStore.<span class="hljs-title class_">Schema</span>();</li><li>  schema.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(child1);</li><li>  schema.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(child2);</li><li>  schema.<span class="hljs-property">indexes</span> = [<span class="hljs-string">'$.id'</span>, <span class="hljs-string">'$.name'</span>];</li><li>  <span class="hljs-comment">// 0表示COMPATIBLE模式，1表示STRICT模式。</span></li><li>  schema.<span class="hljs-property">mode</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-comment">// 支持在检查Value时，跳过skip指定的字节数，且取值范围为[0,4M-2]。</span></li><li>  schema.<span class="hljs-property">skip</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: distributedKVStore.<span class="hljs-property">Options</span> = {</li><li>    <span class="hljs-attr">createIfMissing</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">encrypt</span>: <span class="hljs-literal">false</span>,</li><li>    <span class="hljs-attr">backup</span>: <span class="hljs-literal">false</span>,</li><li>    <span class="hljs-attr">autoSync</span>: <span class="hljs-literal">false</span>,</li><li>    <span class="hljs-comment">// kvStoreType不填时，默认创建多设备协同数据库</span></li><li>    <span class="hljs-attr">kvStoreType</span>: distributedKVStore.<span class="hljs-property">KVStoreType</span>.<span class="hljs-property">SINGLE_VERSION</span>,</li><li>    <span class="hljs-comment">// 多设备协同数据库：kvStoreType: distributedKVStore.KVStoreType.DEVICE_COLLABORATION,</span></li><li>    <span class="hljs-attr">schema</span>: schema,</li><li>    <span class="hljs-comment">// schema未定义可以不填，定义方法请参考上方schema示例。</span></li><li>    <span class="hljs-attr">securityLevel</span>: distributedKVStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S3</span></li><li>  };</li><li>  kvManager.<span class="hljs-property">getKVStore</span>&lt;distributedKVStore.<span class="hljs-property">SingleKVStore</span>&gt;(storeId, options, <span class="hljs-function">(<span class="hljs-params">err, store: distributedKVStore.SingleKVStore</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get KVStore: Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting KVStore.'</span>);</li><li>    kvStore = store;</li><li>    <span class="hljs-comment">// 请确保获取到键值数据库实例后，再进行相关数据操作</span></li><li>    <span class="hljs-keyword">if</span> (kvStore !== <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-comment">//进行后续操作</span></li><li>        <span class="hljs-comment">//...</span></li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用on()方法订阅分布式数据变化，如需关闭订阅分布式数据变化，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributedkvstore#offdatachange" target="_blank">off('dataChange')</a>关闭。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataChange'</span>, distributedKVStore.<span class="hljs-property">SubscribeType</span>.<span class="hljs-property">SUBSCRIBE_TYPE_ALL</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`dataChange callback call data: <span class="hljs-subst">${data}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用put()方法向键值数据库中插入数据。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span> = <span class="hljs-string">'key_test_string'</span>;</li><li><span class="hljs-comment">// 如果未定义Schema则Value可以传其他符合要求的值。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span> = <span class="hljs-string">'{"id":0, "name":"lisi"}'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to put data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in putting data.'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>当Key值存在时，put()方法会修改其值，否则新增一条数据。</p>        </div></div></div></li>      <li>       <p>调用get()方法获取指定键的值。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to put data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in putting data.'</span>);</li><li>    kvStore = kvStore <span class="hljs-keyword">as</span> distributedKVStore.<span class="hljs-property">SingleKVStore</span>;</li><li>    kvStore.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err != <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in getting data. Data:<span class="hljs-subst">${data}</span>`</span>);</li><li>    });</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get data. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用delete()方法删除指定键值的数据。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  kvStore.<span class="hljs-title function_">put</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-variable constant_">VALUE_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to put data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in putting data.'</span>);</li><li>    kvStore = kvStore <span class="hljs-keyword">as</span> distributedKVStore.<span class="hljs-property">SingleKVStore</span>;</li><li>    kvStore.<span class="hljs-title function_">delete</span>(<span class="hljs-variable constant_">KEY_TEST_STRING_ELEMENT</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to delete data. Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in deleting data.'</span>);</li><li>    });</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用closeKVStore()方法通过storeId的值关闭指定的分布式键值数据库。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// appId为应用的bundleName</span></li><li>  kvManager = kvManager <span class="hljs-keyword">as</span> distributedKVStore.<span class="hljs-property">KVManager</span>;</li><li>  kvStore = <span class="hljs-literal">undefined</span>;</li><li>  kvManager.<span class="hljs-title function_">closeKVStore</span>(appId, storeId, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>)=&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to close KVStore.code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in closing KVStore'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用deleteKVStore()方法通过storeId的值删除指定的分布式键值数据库。示例代码如下所示：</p>       <div _ngcontent-mgu-c106="" class="highlight-div"><div _ngcontent-mgu-c106="" class="highlight-div-header"><div _ngcontent-mgu-c106="" class="highlight-div-header-left"><div _ngcontent-mgu-c106="" class="handle-button expand-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mgu-c106="" class="highlight-div-header-right"><div _ngcontent-mgu-c106="" class="handle-button ai-button"></div><div _ngcontent-mgu-c106="" class="handle-button line-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mgu-c106="" class="handle-button theme-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mgu-c106="" class="handle-button copy-button"><div _ngcontent-mgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mgu-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// appId为应用的bundleName</span></li><li>  kvManager = kvManager <span class="hljs-keyword">as</span> distributedKVStore.<span class="hljs-property">KVManager</span>;</li><li>  kvStore = <span class="hljs-literal">undefined</span>;</li><li>  kvManager.<span class="hljs-title function_">deleteKVStore</span>(appId, storeId, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>)=&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to delete KVStore.code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in deleting KVStore'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-keyword">let</span> error = e <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`An unexpected error occurred. Code:<span class="hljs-subst">${error.code}</span>,message:<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/KVStore" target="_blank">实现键值型数据库读写功能</a></li>     </ul>    </div>   </div>   <div></div></div>