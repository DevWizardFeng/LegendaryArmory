<h1 _ngcontent-uyb-c119="" class="doc-title ng-star-inserted" title="邀请组队"> 邀请组队 </h1>

<div _ngcontent-uyb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1628581316146">注册碰一碰事件<i class="anchor-icon anchor-icon-link" anchorid="section1628581316146" tips="复制节点链接"></i></h2>          <p>在组队房间邀请界面注册碰一碰事件。</p>     <div class="fignone">      <span class="figcap"><b>图1 </b>横屏应用示例</span>      <br><span><img height="351.688575" originheight="439" originwidth="950" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114703.54432642436712940849861692989709:50001231000000:2800:9D97461F40FFF234FA47FF013262F5C23BDE3E8CD915759AA2AD70D5D56D97C7.png" title="点击放大" width="761.0925000000001"></span>     </div>     <p></p>     <div class="fignone">      <span class="figcap"><b>图2 </b>竖屏应用示例</span>      <br><span><img originheight="798" originwidth="363" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114703.09199331641346339744831355847705:50001231000000:2800:9F265991BF04A04095592EBCD18021A3E86DDD8FF143E9C9EB2B56F2FB8136F4.png" width="363" height="798"></span>     </div>     <p></p>    </div>    <div class="tiledSection">     <h2 id="section678983410144">注册单向分享能力<i class="anchor-icon anchor-icon-link" anchorid="section678983410144" tips="复制节点链接"></i></h2>          <p>通过碰一碰分享邀请好友加入组队房间，若双方都同时在组队房间内互相邀请，无法相互加入对方的组队房间。</p>     <p>针对以上场景，Share Kit提供单向仅发送能力。参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section7361949172719" target="_blank">SendCapabilityRegistry</a>的sendOnly属性。</p>     <p>若碰一碰的双方都设置单向仅发送，则终止本次分享并提示用户"请任意一方退出当前应用后再试"；反之，均可分享成功。</p>     <div _ngcontent-uyb-c106="" class="highlight-div"><div _ngcontent-uyb-c106="" class="highlight-div-header"><div _ngcontent-uyb-c106="" class="highlight-div-header-left"><div _ngcontent-uyb-c106="" class="handle-button expand-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uyb-c106="" class="highlight-div-header-right"><div _ngcontent-uyb-c106="" class="handle-button ai-button"></div><div _ngcontent-uyb-c106="" class="handle-button line-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uyb-c106="" class="handle-button theme-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uyb-c106="" class="handle-button copy-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uyb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">uniformTypeDescriptor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">utd</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">systemShare</span>, <span class="hljs-variable">harmonyShare</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">fileUri</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SendCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>      <span class="hljs-variable">sendOnly</span>: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 申明仅支持单向发送 若对端也同样申明仅支持单向发送 则双向分享时会失败</span></li><li>    }</li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-variable">capabilityRegistry</span>, (<span class="hljs-variable">sharableTarget</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SharableTarget</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">contextFaker</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">filePath</span> = <span class="hljs-variable">contextFaker</span>.<span class="hljs-variable">filesDir</span> + <span class="hljs-string">'/exampleKnock1.jpg'</span>; <span class="hljs-comment">// 仅为示例 请替换正确的文件路径</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">systemShare</span>.<span class="hljs-title function_">SharedData</span>({</li><li>        <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">HYPERLINK</span>,</li><li>        <span class="hljs-variable">content</span>: <span class="hljs-string">'https://sharekitdemo.drcn.agconnect.link/ZB3p'</span>,</li><li>        <span class="hljs-comment">// 根据title,description,thumbnailUri会生成不同的卡片模板。</span></li><li>        <span class="hljs-variable">thumbnailUri</span>: <span class="hljs-title class_">fileUri</span>.<span class="hljs-title class_">getUriFromPath</span>(<span class="hljs-title class_">filePath</span>),</li><li>        <span class="hljs-variable">title</span>: <span class="hljs-string">'碰一碰分享卡片标题'</span>,</li><li>        <span class="hljs-variable">description</span>: <span class="hljs-string">'碰一碰分享卡片描述'</span></li><li>      });</li><li>      <span class="hljs-variable">sharableTarget</span>.<span class="hljs-title function_">share</span>(<span class="hljs-variable">shareData</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SendCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>    }</li><li>    <span class="hljs-comment">// 解除碰一碰分享'knockShare'监听事件</span></li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-variable">capabilityRegistry</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1729654181411">设置组队邀请预览<i class="anchor-icon anchor-icon-link" anchorid="section1729654181411" tips="复制节点链接"></i></h2>          <p>预览图设置参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/knock-share-between-phones-content#section1880197194811">设置分享预览</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section101461666159">处理组队链接<i class="anchor-icon anchor-icon-link" anchorid="section101461666159" tips="复制节点链接"></i></h2>          <p>当目标应用被分享拉起时，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onnewwant" target="_blank">onNewWant</a>回调中获取传入的want参数。其中want.uri字段为邀请组队的链接，通过链接上携带的参数信息，处理组队邀请的业务逻辑。</p>     <p>示例代码：</p>     <div _ngcontent-uyb-c106="" class="highlight-div"><div _ngcontent-uyb-c106="" class="highlight-div-header"><div _ngcontent-uyb-c106="" class="highlight-div-header-left"><div _ngcontent-uyb-c106="" class="handle-button expand-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uyb-c106="" class="highlight-div-header-right"><div _ngcontent-uyb-c106="" class="handle-button ai-button"></div><div _ngcontent-uyb-c106="" class="handle-button line-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uyb-c106="" class="handle-button theme-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uyb-c106="" class="handle-button copy-button"><div _ngcontent-uyb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uyb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AbilityConstant</span>, <span class="hljs-variable">UIAbility</span>, <span class="hljs-variable">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">UIAbility</span> {</li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-variable">windowStage</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStage</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable">windowStage</span>.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>);</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">onWindowStageCreate</span> <span class="hljs-variable">error</span>. <span class="hljs-variable">Code</span>: ${<span class="hljs-variable">error</span>?.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">error</span>?.<span class="hljs-variable">message</span>}`);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onCreate invoked. uri: '</span>, <span class="hljs-variable">want</span>.<span class="hljs-variable">uri</span>);</li><li>    <span class="hljs-comment">// to do things.</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onNewWant</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onNewWant invoked. uri: '</span>, <span class="hljs-variable">want</span>.<span class="hljs-variable">uri</span>);</li><li>    <span class="hljs-comment">// to do things.</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1773313215155">异常场景终止分享<i class="anchor-icon anchor-icon-link" anchorid="section1773313215155" tips="复制节点链接"></i></h2>          <p>当碰一碰分享回调触发时，发生异常场景导致无法继续分享，可终止本次分享。</p>     <p>参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/knock-share-between-phones-content#section1142174216514">异常场景终止分享</a>。</p>    </div>   </div>   <div></div></div>