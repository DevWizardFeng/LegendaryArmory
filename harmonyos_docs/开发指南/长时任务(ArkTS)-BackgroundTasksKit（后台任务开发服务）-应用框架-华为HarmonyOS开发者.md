<h1 _ngcontent-ofg-c119="" class="doc-title ng-star-inserted" title="长时任务(ArkTS)"> 长时任务(ArkTS) </h1>

<div _ngcontent-ofg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="功能介绍" class="firsth2">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="功能介绍" tips="复制节点链接"></i></h3>          <p>应用退至后台后，在后台需要长时间运行用户可感知的任务，如播放音乐、导航等。为防止应用进程被挂起，导致对应功能异常，可以申请长时任务，使应用在后台长时间运行。在长时任务中，支持同时申请多种类型的任务，也可以对任务类型进行更新。应用退至后台执行业务时，系统会做一致性校验，确保应用在执行相应的长时任务。应用在申请长时任务成功后，通知栏会显示与长时任务相关联的消息，用户删除通知栏消息时，系统会自动停止长时任务。</p>    </div>    <div class="tiledSection">     <h3 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h3>          <p>下表给出了当前长时任务支持的类型，包含数据传输、音视频播放、录制、定位导航、蓝牙相关业务、多设备互联、音视频通话和计算任务。可以参考下表中的场景举例，选择合适的长时任务类型。</p>     <p><strong>表1</strong> 长时任务类型</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.5.1.2" valign="top" width="25%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.5.1.3" valign="top" width="25%">配置项</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.5.1.4" valign="top" width="25%">场景举例</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">DATA_TRANSFER</td>         <td class="cellrowborder" valign="top" width="25%">数据传输。</td>         <td class="cellrowborder" valign="top" width="25%">dataTransfer</td>         <td class="cellrowborder" valign="top" width="25%">非托管形式的上传、下载，如在浏览器后台上传或下载数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">AUDIO_PLAYBACK</td>         <td class="cellrowborder" valign="top" width="25%">音视频播放。</td>         <td class="cellrowborder" valign="top" width="25%">audioPlayback</td>         <td class="cellrowborder" valign="top" width="25%">          <p>音频、视频在后台播放，音视频投播。</p>          <p><strong>说明：</strong> 支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">AUDIO_RECORDING</td>         <td class="cellrowborder" valign="top" width="25%">录制。</td>         <td class="cellrowborder" valign="top" width="25%">audioRecording</td>         <td class="cellrowborder" valign="top" width="25%">录音、录屏退后台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">LOCATION</td>         <td class="cellrowborder" valign="top" width="25%">定位导航。</td>         <td class="cellrowborder" valign="top" width="25%">location</td>         <td class="cellrowborder" valign="top" width="25%">定位、导航。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">BLUETOOTH_INTERACTION</td>         <td class="cellrowborder" valign="top" width="25%">蓝牙相关业务。</td>         <td class="cellrowborder" valign="top" width="25%">bluetoothInteraction</td>         <td class="cellrowborder" valign="top" width="25%">通过蓝牙传输文件时退后台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">MULTI_DEVICE_CONNECTION</td>         <td class="cellrowborder" valign="top" width="25%">多设备互联。</td>         <td class="cellrowborder" valign="top" width="25%">multiDeviceConnection</td>         <td class="cellrowborder" valign="top" width="25%">          <p>分布式业务连接、投播。</p>          <p><strong>说明：</strong> 支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">VOIP<sup>13+</sup></td>         <td class="cellrowborder" valign="top" width="25%">音视频通话。</td>         <td class="cellrowborder" valign="top" width="25%">voip</td>         <td class="cellrowborder" valign="top" width="25%">某些聊天类应用（具有音视频业务）音频、视频通话时退后台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">TASK_KEEPING</td>         <td class="cellrowborder" valign="top" width="25%">          <p>计算任务（仅对PC/2in1设备开放）。</p>          <p><strong>说明：</strong> 从API version 21开始，对PC/2in1设备、非PC/2in1设备但申请了ACL权限为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/restricted-permissions#ohospermissionkeep_background_running_system">ohos.permission.KEEP_BACKGROUND_RUNNING_SYSTEM</a>的应用开放。 API version 20及之前版本，仅对PC/2in1设备开放。</p></td>         <td class="cellrowborder" valign="top" width="25%">taskKeeping</td>         <td class="cellrowborder" valign="top" width="25%">如杀毒软件。</td>        </tr>             </tbody></table></div>     </div>     <p>关于DATA_TRANSFER（数据传输）说明：</p>     <ul>      <li>       <p>在数据传输时，若应用使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-request" target="_blank">上传下载代理接口</a>托管给系统，即使申请DATA_TRANSFER的后台任务，应用退后台时还是会被挂起。</p></li>      <li>       <p>在数据传输时，应用需要更新进度，如果进度长时间（首次更新超过10分钟）未更新，数据传输的长时任务会被取消。更新进度的通知类型必须为实况窗，具体实现可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstartbackgroundrunning12" target="_blank">startBackgroundRunning()</a>中的示例。</p></li>     </ul>     <p>关于AUDIO_PLAYBACK（音视频播放）说明：</p>     <ul>      <li>       <p>音视频投播，是指将一台设备的音视频投至另一台设备播放。投播退至后台，长时任务会检测音视频播放和投屏两个业务，只要有其一正常运行，长时任务就不会终止。</p></li>      <li>       <p>当应用需要在后台播放媒体类型（流类型为STREAM_USAGE_MUSIC、STREAM_USAGE_MOVIE和STREAM_USAGE_AUDIOBOOK）和游戏类型（流类型为STREAM_USAGE_GAME）时，必须接入媒体会话服务（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avsession-overview">AVSession</a>）并申请AUDIO_PLAYBACK类型长时任务。</p></li>      <li>       <p>除了上述播放类型，针对用户可感知的其他播放任务，如果应用需要在后台长时间运行该任务，必须申请AUDIO_PLAYBACK类型长时任务，无需接入AVSession。</p></li>      <li>       <p>如果应用不满足上述接入规范，退至后台播放时会被系统静音并冻结，无法在后台正常播放，直到应用重新切回前台时，才会解除静音并恢复播放。</p></li>      <li>       <p>从API version 20开始，申请AUDIO_PLAYBACK类型长时任务但不接入AVSession，申请长时任务成功后会在通知栏显示通知；接入AVSession后，后台任务模块不会发送通知栏通知，由AVSession发送通知。对于API version 19及之前的版本，后台任务模块不会在通知栏显示通知。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h3>          <p><strong>申请限制</strong>：Stage模型中，长时任务仅支持UIAbility申请；FA模型中，长时任务仅支持ServiceAbility申请。长时任务支持设备当前应用申请，也支持跨设备或跨应用申请，跨设备或跨应用仅对系统应用开放。</p>     <p><strong>数量限制</strong>：</p>     <ul>      <li>从API version 21开始，支持一个UIAbility同一时刻申请多个长时任务，最多可申请10个，具体实现可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstartbackgroundrunning21" target="_blank">startBackgroundRunning()</a>。对于API version 20及之前版本，一个UIAbility（FA模型则为ServiceAbility）同一时刻仅支持申请一个长时任务，即在一个长时任务结束后才能继续申请。如果一个应用同时需要申请多个长时任务，需要创建多个UIAbility。</li>      <li>如果一个应用创建了多个UIAbility，一个UIAbility申请长时任务后，整个应用下的所有进程均不会被挂起。</li>     </ul>     <p><strong>运行限制</strong>：</p>     <ul>      <li>       <p>申请长时任务后，应用未执行相应的业务，系统会对应用进行管控，即应用退至后台会被挂起。如系统检测到应用申请了AUDIO_PLAYBACK（音视频播放），但实际未播放音乐。</p></li>      <li>       <p>申请长时任务后，应用执行的业务类型与申请的不一致，系统会对应用进行管控，即应用退至后台会被挂起。如系统检测到应用只申请了AUDIO_PLAYBACK（音视频播放），但实际上除了播放音乐（对应AUDIO_PLAYBACK类型），还在进行录制（对应AUDIO_RECORDING类型）。</p></li>      <li>       <p>申请长时任务后，应用的业务已执行完，系统会对应用进行管控，即应用退至后台会被挂起。</p></li>      <li>       <p>若运行长时任务的进程后台负载持续高于所申请类型的典型负载，系统会对应用进行管控，即应用退至后台会被挂起或终止。</p></li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>应用按需求申请长时任务，当应用无需在后台运行（任务结束）时，要及时主动取消长时任务，否则应用退至后台会被系统挂起。例如用户主动点击音乐暂停播放时，应用需及时取消对应的长时任务；用户再次点击音乐播放时，需重新申请长时任务。</p>       <p>若音频在后台播放时被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">打断</a>，系统会自行检测和停止长时任务，音频重启播放时，需要再次申请长时任务。</p>       <p>后台播放音频的应用，在停止长时任务的同时，需要暂停或停止音频流，否则应用会被系统强制终止。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p><strong>表2</strong> 主要接口</p>     <p>以下是长时任务开发使用的相关接口，下表均以Promise形式为例，更多接口及使用方式请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager" target="_blank">后台任务管理</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstartbackgroundrunning-1" target="_blank">startBackgroundRunning(context: Context, bgMode: BackgroundMode, wantAgent: WantAgent): Promise&lt;void&gt;</a></td>         <td class="cellrowborder" valign="top" width="50%">申请长时任务，本接口一个UIAbility同一时刻仅支持申请一个长时任务，即在一个长时任务结束后才能继续申请。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstopbackgroundrunning-1" target="_blank">stopBackgroundRunning(context: Context): Promise&lt;void&gt;</a></td>         <td class="cellrowborder" valign="top" width="50%">取消长时任务。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstartbackgroundrunning21" target="_blank">startBackgroundRunning(context: Context, request: ContinuousTaskRequest): Promise&lt;ContinuousTaskNotification&gt;</a></td>         <td class="cellrowborder" valign="top" width="50%">申请多个长时任务。本接口支持一个UIAbility同一时刻申请多个长时任务，最多可申请10个。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resourceschedule-backgroundtaskmanager#backgroundtaskmanagerstopbackgroundrunning21" target="_blank">stopBackgroundRunning(context: Context, continuousTaskId: number): Promise&lt;void&gt;</a></td>         <td class="cellrowborder" valign="top" width="50%">取消指定Id的长时任务。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>本文以申请一个录制长时任务为例，实现如下功能：</p>     <ul>      <li>       <p>点击“申请长时任务”按钮，应用申请录制长时任务成功，通知栏显示“正在运行录制任务”通知。</p></li>      <li>       <p>点击“取消长时任务”按钮，取消长时任务，通知栏撤销相关通知。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="stage模型" class="firsth2">Stage模型<i class="anchor-icon anchor-icon-link" anchorid="stage模型" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>需要申请ohos.permission.KEEP_BACKGROUND_RUNNING权限，配置方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>。</p></li>      <li>       <p>声明后台模式类型。</p>       <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中abilities下的backgroundModes字段里，为需要使用长时任务的UIAbility声明相应的长时任务类型，配置文件中填写长时任务类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/continuous-task#使用场景">配置项</a>。</p>       <div _ngcontent-ofg-c106="" class="highlight-div"><div _ngcontent-ofg-c106="" class="highlight-div-header"><div _ngcontent-ofg-c106="" class="highlight-div-header-left"><div _ngcontent-ofg-c106="" class="handle-button expand-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofg-c106="" class="highlight-div-header-right"><div _ngcontent-ofg-c106="" class="handle-button ai-button"></div><div _ngcontent-ofg-c106="" class="handle-button line-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofg-c106="" class="handle-button theme-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofg-c106="" class="handle-button copy-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>     <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>         <span class="hljs-punctuation">{</span></li><li>             <span class="hljs-attr">"backgroundModes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>              <span class="hljs-comment">// 长时任务类型的配置项</span></li><li>             <span class="hljs-string">"audioRecording"</span><span class="hljs-punctuation">,</span></li><li>             <span class="hljs-string">"bluetoothInteraction"</span><span class="hljs-punctuation">,</span></li><li>             <span class="hljs-string">"audioPlayback"</span></li><li>             <span class="hljs-punctuation">]</span></li><li>         <span class="hljs-punctuation">}</span></li><li>     <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>     <span class="hljs-comment">// ...</span></li><li> <span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>导入模块。</p>       <p>长时任务相关的模块为@ohos.resourceschedule.backgroundTaskManager和@ohos.app.ability.wantAgent，其余模块按实际需要导入。</p>       <div _ngcontent-ofg-c106="" class="highlight-div"><div _ngcontent-ofg-c106="" class="highlight-div-header"><div _ngcontent-ofg-c106="" class="highlight-div-header-left"><div _ngcontent-ofg-c106="" class="handle-button expand-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofg-c106="" class="highlight-div-header-right"><div _ngcontent-ofg-c106="" class="handle-button ai-button"></div><div _ngcontent-ofg-c106="" class="handle-button line-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofg-c106="" class="handle-button theme-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofg-c106="" class="handle-button copy-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-keyword">import</span> { backgroundTaskManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BackgroundTasksKit'</span>;</li><li> <span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li> <span class="hljs-keyword">import</span> { wantAgent, <span class="hljs-title class_">WantAgent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li> <span class="hljs-comment">// 在元服务中，请删除WantAgent导入</span></li></ol></pre></div></div></li>      <li>       <p>申请和取消长时任务。</p>       <p><strong>设备当前应用</strong>申请和取消长时任务示例代码如下：</p>       <div _ngcontent-ofg-c106="" class="highlight-div"><div _ngcontent-ofg-c106="" class="highlight-div-header"><div _ngcontent-ofg-c106="" class="highlight-div-header-left"><div _ngcontent-ofg-c106="" class="handle-button expand-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofg-c106="" class="highlight-div-header-right"><div _ngcontent-ofg-c106="" class="handle-button ai-button"></div><div _ngcontent-ofg-c106="" class="handle-button line-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofg-c106="" class="handle-button theme-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofg-c106="" class="handle-button copy-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">info: backgroundTaskManager.ContinuousTaskCancelInfo</span>) {</li><li>   <span class="hljs-comment">// 长时任务id</span></li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'OnContinuousTaskCancel callback id '</span> + info.<span class="hljs-property">id</span>);</li><li>   <span class="hljs-comment">// 长时任务取消原因</span></li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'OnContinuousTaskCancel callback reason '</span> + info.<span class="hljs-property">reason</span>);</li><li> }</li><li>
</li><li> <span class="hljs-meta">@Entry</span></li><li> <span class="hljs-meta">@Component</span></li><li> struct <span class="hljs-title class_">Index</span> {</li><li>   <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ContinuousTask'</span>;</li><li>  <span class="hljs-comment">// 通过getUIContext().getHostContext()方法，来获取page所在的UIAbility上下文</span></li><li>   <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li>
</li><li>   <span class="hljs-title class_">OnContinuousTaskCancel</span>() {</li><li>     <span class="hljs-keyword">try</span> {</li><li>        backgroundTaskManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"continuousTaskCancel"</span>, callback);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing OnContinuousTaskCancel.`</span>);</li><li>     } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Operation OnContinuousTaskCancel failed. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>     }</li><li>   }</li><li>
</li><li>   <span class="hljs-title class_">OffContinuousTaskCancel</span>() {</li><li>     <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// callback参数不传，则取消所有已注册的回调</span></li><li>        backgroundTaskManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"continuousTaskCancel"</span>, callback);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing OffContinuousTaskCancel.`</span>);</li><li>     } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Operation OffContinuousTaskCancel failed. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>     }</li><li>   }</li><li>
</li><li>   <span class="hljs-comment">// 申请长时任务.then()写法</span></li><li>   <span class="hljs-title function_">startContinuousTask</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>: wantAgent.<span class="hljs-property">WantAgentInfo</span> = {</li><li>       <span class="hljs-comment">// 点击通知后，将要执行的动作列表</span></li><li>       <span class="hljs-comment">// 添加需要被拉起应用的bundleName和abilityName</span></li><li>       <span class="hljs-attr">wants</span>: [</li><li>         {</li><li>           <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.myapplication"</span>,</li><li>           <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"MainAbility"</span></li><li>         }</li><li>       ],</li><li>       <span class="hljs-comment">// 指定点击通知栏消息后的动作是拉起ability</span></li><li>       <span class="hljs-attr">actionType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">START_ABILITY</span>,</li><li>       <span class="hljs-comment">// 使用者自定义的一个私有值</span></li><li>       <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,</li><li>       <span class="hljs-comment">// 点击通知后，动作执行属性</span></li><li>       <span class="hljs-attr">actionFlags</span>: [wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">UPDATE_PRESENT_FLAG</span>],</li><li>       <span class="hljs-comment">// 车钥匙长时任务子类型，从API version 16开始支持。只有申请bluetoothInteraction类型的长时任务，车钥匙子类型才能生效。</span></li><li>       <span class="hljs-comment">// 确保extraInfo参数中的Key值为backgroundTaskManager.BackgroundModeType.SUB_MODE，否则子类型不生效。</span></li><li>       <span class="hljs-comment">// extraInfo: { [backgroundTaskManager.BackgroundModeType.SUB_MODE] : backgroundTaskManager.BackgroundSubMode.CAR_KEY }</span></li><li>     };</li><li>
</li><li>     <span class="hljs-keyword">try</span> {</li><li>       <span class="hljs-comment">// 通过wantAgent模块下getWantAgent方法获取WantAgent对象</span></li><li>       <span class="hljs-comment">// 在元服务中，使用wantAgent.getWantAgent(wantAgentInfo).then((wantAgentObj: object) =&gt; {替换下面一行代码</span></li><li>       wantAgent.<span class="hljs-title function_">getWantAgent</span>(wantAgentInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">wantAgentObj: WantAgent</span>) =&gt;</span> {</li><li>         <span class="hljs-keyword">try</span> {</li><li>           <span class="hljs-keyword">let</span> <span class="hljs-attr">list</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"audioRecording"</span>];</li><li>           <span class="hljs-comment">// let list: Array&lt;string&gt; = ["bluetoothInteraction"]; 长时任务类型包含bluetoothInteraction，CAR_KEY子类型合法</span></li><li>           <span class="hljs-comment">// 在元服务中，let list: Array&lt;string&gt; = ["audioPlayback"];</span></li><li>           backgroundTaskManager.<span class="hljs-title function_">startBackgroundRunning</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, list, wantAgentObj).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: backgroundTaskManager.ContinuousTaskNotification</span>) =&gt;</span> {</li><li>             <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Operation startBackgroundRunning succeeded"</span>);</li><li>             <span class="hljs-comment">// 此处执行具体的长时任务逻辑，如录音，录制等。</span></li><li>             <span class="hljs-comment">// 系统会对业务场景的真实性进行检测，如果没有实际执行对应的业务，系统可能会取消对应的长时任务并挂起应用。</span></li><li>           }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>             <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${error.code}</span> message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>           });</li><li>         } <span class="hljs-keyword">catch</span> (error) {</li><li>           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>         }</li><li>       });</li><li>     } <span class="hljs-keyword">catch</span> (error) {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation getWantAgent. code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span> message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>     }</li><li>   }</li><li>
</li><li>   <span class="hljs-comment">// 取消长时任务.then()写法</span></li><li>   <span class="hljs-title function_">stopContinuousTask</span>(<span class="hljs-params"></span>) {</li><li>      backgroundTaskManager.<span class="hljs-title function_">stopBackgroundRunning</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing stopBackgroundRunning.`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to operation stopBackgroundRunning. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      });</li><li>   }</li><li>
</li><li>   <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-title class_">Row</span>() {</li><li>       <span class="hljs-title class_">Column</span>() {</li><li>         <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Index"</span>)</li><li>           .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>           .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>
</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'申请长时任务'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 通过按钮申请长时任务</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startContinuousTask</span>();</li><li>         })</li><li>
</li><li>         <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'取消长时任务'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 此处结束具体的长时任务的执行</span></li><li>
</li><li>           <span class="hljs-comment">// 通过按钮取消长时任务</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopContinuousTask</span>();</li><li>         })</li><li>
</li><li>         <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'注册长时任务取消回调'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 通过按钮注册长时任务取消回调</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">OnContinuousTaskCancel</span>();</li><li>         })</li><li>
</li><li>         <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'取消注册长时任务取消回调'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 通过按钮取消注册长时任务取消回调</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">OffContinuousTaskCancel</span>();</li><li>         })</li><li>       }</li><li>       .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>     }</li><li>     .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>   }</li><li> }</li></ol></pre></div></div></li>      <li>       <p>申请和取消长时任务async/await写法。</p>       <p><strong>设备当前应用</strong>申请和取消长时任务async/await写法示例代码如下：</p>       <div _ngcontent-ofg-c106="" class="highlight-div"><div _ngcontent-ofg-c106="" class="highlight-div-header"><div _ngcontent-ofg-c106="" class="highlight-div-header-left"><div _ngcontent-ofg-c106="" class="handle-button expand-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofg-c106="" class="highlight-div-header-right"><div _ngcontent-ofg-c106="" class="handle-button ai-button"></div><div _ngcontent-ofg-c106="" class="handle-button line-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofg-c106="" class="handle-button theme-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofg-c106="" class="handle-button copy-button"><div _ngcontent-ofg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-meta">@Entry</span></li><li> <span class="hljs-meta">@Component</span></li><li> struct <span class="hljs-title class_">Index</span> {</li><li>   <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ContinuousTask'</span>;</li><li>  <span class="hljs-comment">// 通过getUIContext().getHostContext()方法，来获取page所在的UIAbility上下文</span></li><li>   <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li>
</li><li>   <span class="hljs-comment">// 申请长时任务async/await写法</span></li><li>   <span class="hljs-keyword">async</span> <span class="hljs-title function_">startContinuousTask</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-keyword">let</span> <span class="hljs-attr">wantAgentInfo</span>: wantAgent.<span class="hljs-property">WantAgentInfo</span> = {</li><li>       <span class="hljs-comment">// 点击通知后，将要执行的动作列表</span></li><li>       <span class="hljs-comment">// 添加需要被拉起应用的bundleName和abilityName</span></li><li>       <span class="hljs-attr">wants</span>: [</li><li>         {</li><li>           <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.myapplication"</span>,</li><li>           <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"MainAbility"</span></li><li>         }</li><li>       ],</li><li>       <span class="hljs-comment">// 指定点击通知栏消息后的动作是拉起ability</span></li><li>       <span class="hljs-attr">actionType</span>: wantAgent.<span class="hljs-property">OperationType</span>.<span class="hljs-property">START_ABILITY</span>,</li><li>       <span class="hljs-comment">// 使用者自定义的一个私有值</span></li><li>       <span class="hljs-attr">requestCode</span>: <span class="hljs-number">0</span>,</li><li>       <span class="hljs-comment">// 点击通知后，动作执行属性</span></li><li>       <span class="hljs-attr">actionFlags</span>: [wantAgent.<span class="hljs-property">WantAgentFlags</span>.<span class="hljs-property">UPDATE_PRESENT_FLAG</span>],</li><li>       <span class="hljs-comment">// 车钥匙长时任务子类型，从API version 16开始支持。只有申请bluetoothInteraction类型的长时任务，车钥匙子类型才能生效。</span></li><li>       <span class="hljs-comment">// 确保extraInfo参数中的Key值为backgroundTaskManager.BackgroundModeType.SUB_MODE，否则子类型不生效。</span></li><li>       <span class="hljs-comment">// extraInfo: { [backgroundTaskManager.BackgroundModeType.SUB_MODE] : backgroundTaskManager.BackgroundSubMode.CAR_KEY }</span></li><li>     };</li><li>
</li><li>     <span class="hljs-keyword">try</span> {</li><li>       <span class="hljs-comment">// 通过wantAgent模块下getWantAgent方法获取WantAgent对象</span></li><li>       <span class="hljs-comment">// 在元服务中，使用const wantAgentObj: object = await wantAgent.getWantAgent(wantAgentInfo);替换下面一行代码</span></li><li>       <span class="hljs-keyword">const</span> <span class="hljs-attr">wantAgentObj</span>: <span class="hljs-title class_">WantAgent</span> = <span class="hljs-keyword">await</span> wantAgent.<span class="hljs-title function_">getWantAgent</span>(wantAgentInfo);</li><li>       <span class="hljs-keyword">try</span> {</li><li>         <span class="hljs-keyword">let</span> <span class="hljs-attr">list</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">"audioRecording"</span>];</li><li>         <span class="hljs-comment">// let list: Array&lt;string&gt; = ["bluetoothInteraction"]; 长时任务类型包含bluetoothInteraction，CAR_KEY子类型合法</span></li><li>         <span class="hljs-comment">// 在元服务中，let list: Array&lt;string&gt; = ["audioPlayback"];</span></li><li>         <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: backgroundTaskManager.<span class="hljs-property">ContinuousTaskNotification</span> = <span class="hljs-keyword">await</span> backgroundTaskManager.<span class="hljs-title function_">startBackgroundRunning</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Context</span>, list, wantAgentObj);</li><li>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Operation startBackgroundRunning succeeded, notificationId: <span class="hljs-subst">${res.notificationId}</span>`</span>);</li><li>         <span class="hljs-comment">// 此处执行具体的长时任务逻辑，如录音，录制等。</span></li><li>       } <span class="hljs-keyword">catch</span> (error) {</li><li>         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation startBackgroundRunning. Code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>       }</li><li>     } <span class="hljs-keyword">catch</span> (error) {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to Operation getWantAgent. Code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>     }</li><li>   }</li><li>
</li><li>   <span class="hljs-comment">// 取消长时任务async/await写法</span></li><li>   <span class="hljs-keyword">async</span> <span class="hljs-title function_">stopContinuousTask</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-keyword">try</span> {</li><li>       <span class="hljs-keyword">await</span> backgroundTaskManager.<span class="hljs-title function_">stopBackgroundRunning</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in operationing stopBackgroundRunning.`</span>);</li><li>     } <span class="hljs-keyword">catch</span> (error) {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to operation stopBackgroundRunning. Code is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, message is <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>)</li><li>     }</li><li>   }</li><li>
</li><li>   <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>     <span class="hljs-title class_">Row</span>() {</li><li>       <span class="hljs-title class_">Column</span>() {</li><li>         <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Index"</span>)</li><li>           .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>           .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>
</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'申请长时任务'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 通过按钮申请长时任务</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startContinuousTask</span>();</li><li>         })</li><li>
</li><li>         <span class="hljs-title class_">Button</span>() {</li><li>           <span class="hljs-title class_">Text</span>(<span class="hljs-string">'取消长时任务'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>         }</li><li>         .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>         .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>         .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0D9FFB'</span>)</li><li>         .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>         .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>         .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>           <span class="hljs-comment">// 此处结束具体的长时任务的执行</span></li><li>
</li><li>           <span class="hljs-comment">// 通过按钮取消长时任务</span></li><li>           <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopContinuousTask</span>();</li><li>         })</li><li>       }</li><li>       .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>     }</li><li>     .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>   }</li><li> }</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>