<h1 _ngcontent-nhx-c119="" class="doc-title ng-star-inserted" title="防窥保护"> 防窥保护 </h1>

<div _ngcontent-nhx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section65691729192214">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section65691729192214" tips="复制节点链接"></i></h2>          <p>支持应用根据屏幕窥视状态保护机主隐私，如拉起系统级蒙层遮盖窗口，非机主状态下不进行个性化推荐，隐藏浏览记录、支付记录、收藏记录等敏感信息。其中系统使用智能判断将长期通过人脸解锁手机的人作为防窥保护的机主。</p>    </div>    <div class="tiledSection">     <h2 id="section128161223011">开发前置条件<i class="anchor-icon anchor-icon-link" anchorid="section128161223011" tips="复制节点链接"></i></h2>          <ul>      <li>需要在设备开启人脸识别。</li>      <li>在设备上选择“设置 &gt; 隐私与安全 &gt; 防窥保护”，开启防窥保护开关。通过人脸验证后，打开需要加入保护的应用开关。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1163618124016">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section1163618124016" tips="复制节点链接"></i></h2>          <p>满足以下所有条件：</p>     <p>1. 本特性需要设备上存在防窥保护选项。开发者可通过在设备上选择“设置 &gt; 隐私与安全 &gt; 防窥保护”查看防窥保护选项。</p>     <p>2. HarmonyOS系统：HarmonyOS 6.0.0 Beta1及以上。</p>     <p>3. DevEco Studio版本：DevEco Studio 6.0.0 Beta1及以上。</p>     <p>4. HarmonyOS SDK版本: HarmonyOS 6.0.0 Beta1 SDK及以上。</p>     <p>5. 防窥保护功能使用智能判断，通过传感器判断您周边环境给您风险提醒。判断因素包括人脸距离设备是否在一定的范围内、人脸是否有遮挡、周围环境是否有充足的光线。当距离较近或较远、人脸被遮挡、周围环境较暗时，可能会引起识别误差，从而导致系统未提醒或者误提醒。如果您认为智能判断可能有误，您可以尝试调整位置和光线，重新使用人脸解锁手机等操作，并再次使用该功能帮助您防窥。</p>    </div>    <div class="tiledSection">     <h2 id="section9126211104715">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section9126211104715" tips="复制节点链接"></i></h2>          <p><span><img height="1205.2096335078534" originheight="5586" originwidth="4264" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115022.40903453725915202777933965965854:50001231000000:2800:7FB26A3534C16514BF22447DFF20D35DCE8E7667325BC2A19396AA4F5A1F552F.jpg" title="点击放大" width="920"></span></p>     <p><strong>流程说明：</strong></p>     <ol>      <li>用户在“设置 &gt; 隐私与安全 &gt; 防窥保护”中开启当前应用的防窥保护开关。</li>      <li>调用isDlpAntiPeepSwitchOn()接口查询当前应用开关的状态。</li>      <li>调用on()接口注册防窥保护通知：3.1 机主自身注视屏幕时反馈非窥视状态；3.2 机主与非机主同时注视屏幕时反馈被窥视状态。3.3 没有机主使用手机或机主分享场景，返回非窥视状态。</li>      <li>手动调用getDlpAntiPeepInfo()接口返回当前应用的窥视状态。</li>      <li>调用setAntiPeepMaskLayer(windowId: number)接口，拉起系统级蒙层。</li>      <li>调用passDlpAntiPeepInfo()接口修改窥视状态，直到手机锁屏或应用退出前一直会返回非窥视状态。</li>      <li>调用off()接口解除注册防窥保护通知。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section919522752613">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section919522752613" tips="复制节点链接"></i></h2>          <p>以下是获取防窥状态信息相关接口，更多接口及使用方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-dlpantipeep-api" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="38.92%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="61.08%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>isDlpAntiPeepSwitchOn(): Promise&lt;boolean&gt;</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>检查是否打开防窥保护。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>on(type: 'dlpAntiPeep', callback: Callback&lt;DlpAntiPeepStatus&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>订阅防窥保护状态通知。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>off(type: 'dlpAntiPeep', callback?: Callback&lt;DlpAntiPeepStatus&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>解除订阅防窥保护状态通知。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>getDlpAntiPeepInfo(): DlpAntiPeepStatus</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>获取当前应用的窥视状态。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>passDlpAntiPeepInfo(): void</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>直到手机锁屏或应用退出前一直会返回非窥视状态。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="38.92%">          <p>setAntiPeepMaskLayer(windowId: number): Promise&lt;void&gt;</p></td>         <td class="cellrowborder" valign="top" width="61.08%">          <p>拉起系统级窗口蒙层遮盖。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section09242145318">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section09242145318" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>在开发准备过程中，需要申请权限：ohos.permission.DLP_GET_HIDE_STATUS；用于获取当前应用使用过程中被非机主本人窥视屏幕相关状态信息。</li>        <li>面向合作企业开放，仅在允许名单内的固定应用可申请该权限，申请方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions-in-acl" target="_blank">申请使用受限权限</a></li>        <li>开发者需向用户说明数据使用的目的、方式和范围。</li>       </ul>      </div></div></div>     <ol>      <li><span>导入防窥保护模块及相关公共模块。</span>       <p></p>       <div _ngcontent-nhx-c106="" class="highlight-div"><div _ngcontent-nhx-c106="" class="highlight-div-header"><div _ngcontent-nhx-c106="" class="highlight-div-header-left"><div _ngcontent-nhx-c106="" class="handle-button expand-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhx-c106="" class="highlight-div-header-right"><div _ngcontent-nhx-c106="" class="handle-button ai-button"></div><div _ngcontent-nhx-c106="" class="handle-button line-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhx-c106="" class="handle-button theme-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhx-c106="" class="handle-button copy-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { dlpAntiPeep } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>调用检查接口确认当前应用是否开启防窥保护，开启防窥保护时调用防窥保护订阅接口获取窥视状态信息。</span>       <p></p>       <div _ngcontent-nhx-c106="" class="highlight-div"><div _ngcontent-nhx-c106="" class="highlight-div-header"><div _ngcontent-nhx-c106="" class="highlight-div-header-left"><div _ngcontent-nhx-c106="" class="handle-button expand-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nhx-c106="" class="highlight-div-header-right"><div _ngcontent-nhx-c106="" class="handle-button ai-button"></div><div _ngcontent-nhx-c106="" class="handle-button line-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nhx-c106="" class="handle-button theme-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nhx-c106="" class="handle-button copy-button"><div _ngcontent-nhx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nhx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Dlp anti peep start'</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">dlpAntiPeepStatus: dlpAntiPeep.DlpAntiPeepStatus</span>) {</li><li>    <span class="hljs-keyword">if</span> (dlpAntiPeepStatus == dlpAntiPeep.<span class="hljs-property">DlpAntiPeepStatus</span>.<span class="hljs-property">PASS</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`DlpAntiPeepStatus is PASS.`</span>);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dlpAntiPeepStatus == dlpAntiPeep.<span class="hljs-property">DlpAntiPeepStatus</span>.<span class="hljs-property">HIDE</span>) { <span class="hljs-comment">// 表示有人在窥屏，应用可以进行隐私保护操作。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`DlpAntiPeepStatus is HIDE.`</span>);</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setMaskLayer</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">setMaskLayer</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      windowClass = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(context);</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error'</span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">windowId</span>: <span class="hljs-built_in">number</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      windowId = windowClass.<span class="hljs-title function_">getWindowProperties</span>().<span class="hljs-property">id</span>;</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get window properties:'</span>, err);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> dlpAntiPeep.<span class="hljs-title function_">setAntiPeepMaskLayer</span>(windowId); <span class="hljs-comment">// 使用获取到的 windowID 设置防窥保护蒙层</span></li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`setAntiPeepMaskLayer failed. error code is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">testAntiPeep</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">isOpen</span>: <span class="hljs-built_in">boolean</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      isOpen = <span class="hljs-keyword">await</span> dlpAntiPeep.<span class="hljs-title function_">isDlpAntiPeepSwitchOn</span>();</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'isDlpAntiPeepSwitchOn failed:'</span>, err);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isOpen) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`isDlpAntiPeepSwitchOn is true.`</span>); <span class="hljs-comment">// 表示当前应用的防窥保护开关已开启。</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`isDlpAntiPeepSwitchOn is false.`</span>);<span class="hljs-comment">// 表示当前应用的防窥保护开关未开启。</span></li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      dlpAntiPeep.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dlpAntiPeep'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>); <span class="hljs-comment">// 订阅防窥保护通知。</span></li><li>      <span class="hljs-keyword">let</span> result = dlpAntiPeep.<span class="hljs-title function_">getDlpAntiPeepInfo</span>(); <span class="hljs-comment">// 主动调用接口获取当前应用的窥视状态。</span></li><li>     <span class="hljs-keyword">if</span> (result === dlpAntiPeep.<span class="hljs-property">DlpAntiPeepStatus</span>.<span class="hljs-property">HIDE</span>) { <span class="hljs-comment">// 表示有人在窥屏，应用可以进行隐私保护操作。</span></li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`getDlpAntiPeepInfo is HIDE.`</span>);</li><li>        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setMaskLayer</span>(); <span class="hljs-comment">//拉起蒙层</span></li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result === dlpAntiPeep.<span class="hljs-property">DlpAntiPeepStatus</span>.<span class="hljs-property">PASS</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`getDlpAntiPeepInfo is PASS.`</span>);</li><li>      }</li><li>      dlpAntiPeep.<span class="hljs-title function_">passDlpAntiPeepInfo</span>(); <span class="hljs-comment">// 改变防窥保护通知提示状态，有人窥屏时不再提示。</span></li><li>      dlpAntiPeep.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dlpAntiPeep'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>); <span class="hljs-comment">// 取消订阅防窥保护通知，不再发防窥保护通知。</span></li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error'</span>, err.<span class="hljs-property">code</span>, err.<span class="hljs-property">message</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>}) {</li><li>      <span class="hljs-title class_">Button</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Dlp_anti_peep_test'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      }.<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>      .<span class="hljs-title function_">margin</span>({</li><li>        <span class="hljs-attr">top</span>: <span class="hljs-number">30</span></li><li>      })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'10%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">testAntiPeep</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>