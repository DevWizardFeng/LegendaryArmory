<h1 _ngcontent-jyf-c119="" class="doc-title ng-star-inserted" title="音频时延管理"> 音频时延管理 </h1>

<div _ngcontent-jyf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>音频时延指从用户触发点击到声音从设备播放所经过的时间。</p>    <p>从音频数据传输的角度，指从触发回调写入开始，到最终播放出声的耗时，包括数据写入、算法处理、硬件传输延迟，以及在蓝牙场景下的蓝牙传输延迟。</p>    <p>当前OHAudio支持两种模式：普通模式（AUDIOSTREAM_LATENCY_MODE_NORMAL）和低时延模式（AUDIOSTREAM_LATENCY_MODE_FAST）。</p>    <p>开发者通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiostreambuilder-h#oh_audiostreambuilder_setlatencymode" target="_blank">OH_AudioStreamBuilder_SetLatencyMode()</a>，设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiostream-base-h#oh_audiostream_latencymode" target="_blank">OH_AudioStream_LatencyMode</a>，来决定音频流使用哪种模式。</p>    <p>低时延模式通过读写数据架构优化，使得该模式下音频播放和录制具有更低的时延。</p>    <p>为使用低时延模式，开发者需要使用OHAudio进行音频开发，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-playback">使用OHAudio开发音频播放功能</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-recording">使用OHAudio开发音频录制功能</a>。设置低时延模式开发示例：</p>    <div _ngcontent-jyf-c106="" class="highlight-div"><div _ngcontent-jyf-c106="" class="highlight-div-header"><div _ngcontent-jyf-c106="" class="highlight-div-header-left"><div _ngcontent-jyf-c106="" class="handle-button expand-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyf-c106="" class="highlight-div-header-right"><div _ngcontent-jyf-c106="" class="handle-button ai-button"></div><div _ngcontent-jyf-c106="" class="handle-button line-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyf-c106="" class="handle-button theme-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyf-c106="" class="handle-button copy-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioStream_LatencyMode latencyMode = AUDIOSTREAM_LATENCY_MODE_FAST;</li><li><span class="hljs-built_in">OH_AudioStreamBuilder_SetLatencyMode</span>(builder, latencyMode);</li></ol></pre></div></div>    <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audiorenderer-h#oh_audiorenderer_getlatencymode" target="_blank">GetLatencyMode</a>查询当前时延模式，开发示例：</p>    <div _ngcontent-jyf-c106="" class="highlight-div"><div _ngcontent-jyf-c106="" class="highlight-div-header"><div _ngcontent-jyf-c106="" class="highlight-div-header-left"><div _ngcontent-jyf-c106="" class="handle-button expand-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyf-c106="" class="highlight-div-header-right"><div _ngcontent-jyf-c106="" class="handle-button ai-button"></div><div _ngcontent-jyf-c106="" class="handle-button line-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyf-c106="" class="handle-button theme-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyf-c106="" class="handle-button copy-button"><div _ngcontent-jyf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyf-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">OH_AudioStream_Result <span class="hljs-title">OH_AudioRenderer_GetLatencyMode</span><span class="hljs-params">(OH_AudioRenderer *renderer, OH_AudioStream_LatencyMode *latencyMode)</span></span>;</li></ol></pre></div></div>    <p>在低时延模式下，应用需要每5ms提供一次数据，如果送数据不及时可能导致杂音等问题。</p>    <p>但在以下场景中，即使设置了低时延模式，系统仍会使用普通模式：</p>    <ul>     <li>当前设备不支持低时延模式。</li>     <li>采样率设置为非48K。</li>     <li>系统低时延资源已被全部占用。</li>    </ul>    <p>游戏类应用对时延要求较高，建议使用低时延模式。</p>   </div>   <div></div></div>