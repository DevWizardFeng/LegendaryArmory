<h1 _ngcontent-ahg-c119="" class="doc-title ng-star-inserted" title="音频编码"> 音频编码 </h1>

<div _ngcontent-ahg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>开发者可以调用本模块的Native API接口，完成音频编码，即将音频PCM编码压缩成不同的格式。</p>    <p>接口不限制PCM数据的来源，开发者可以调用麦克风录制获取、也可以导入编辑后的PCM数据，通过音频编码，输出对应格式的码流，最后封装为目标格式文件。</p>    <p>当前支持的编码能力请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avcodec-support-formats#音频编码">AVCodec支持的格式</a>。</p>    <p><strong>适用场景</strong></p>    <ul>     <li>      <p>音频录制</p>      <p>通过录制传入PCM，然后编码出对应格式的码流，最后<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-video-muxer">封装</a>成想要的格式。</p></li>     <li>      <p>音频编辑</p>      <p>编辑PCM后导出音频文件的场景，需要编码成对应音频格式后再<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-video-muxer">封装</a>成文件。</p></li>    </ul>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>AAC编码器默认采用的VBR可变码率模式，与配置的预期参数可能存在偏差。</li>       <li>AAC编码器默认输出携带ADTS头部，帧数据的前7字节为ADTS头部。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="开发指导">开发指导<i class="anchor-icon anchor-icon-link" anchorid="开发指导" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avcodec-audiocodec-h" target="_blank">API文档</a>。</p>     <p>参考以下示例代码，完成音频编码的全流程，包括：创建编码器、设置编码参数（采样率/码率/声道数等）、开始、刷新、重置、销毁资源。</p>     <p>在应用开发过程中，开发者应按一定顺序调用方法，执行对应操作，否则系统可能会抛出异常或生成其他未定义的行为。具体顺序可参考下列开发步骤及对应说明。</p>     <p>如下为音频编码调用关系图：</p>     <ul>      <li>       <p>虚线表示可选。</p></li>      <li>       <p>实线表示必选。</p></li>     </ul>     <p><span><img originheight="3377" originwidth="4445" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114424.54355630711416373893661451926027:50001231000000:2800:418DDA4019538A4A363E17411F4E2822D73AE6787289209F88E954EAD33B9365.png" width="920" height="698.9516310461192"></span></p>    </div>    <div class="tiledSection">     <h3 id="在-cmake-脚本中链接动态库" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在-cmake-脚本中链接动态库" tips="复制节点链接"></i></h3>          <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_codecbase.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_core.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_acodec.so)</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>上述'sample'字样仅为示例，此处由开发者根据实际工程目录自定义。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>添加头文件。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcodec_audiocodec.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/native_audio_channel_layout.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcapability.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcodec_base.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avformat.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avbuffer.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>创建编码器实例对象，OH_AVCodec *为编码器实例指针。</p>       <p>应用可以通过媒体类型或编解码器名称创建编码器。</p>       <p>方法一：通过 Mimetype 创建编码器。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置判定是否为编码；设置true表示当前是编码。</span></li><li><span class="hljs-type">bool</span> isEncoder = <span class="hljs-literal">true</span>;</li><li><span class="hljs-comment">// 通过媒体类型创建编码器。</span></li><li>OH_AVCodec *audioEnc_ = <span class="hljs-built_in">OH_AudioCodec_CreateByMime</span>(OH_AVCODEC_MIMETYPE_AUDIO_AAC, isEncoder);</li></ol></pre></div></div>       <p>方法二：通过 codec name 创建编码器。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过 codecname 创建编码器。</span></li><li>OH_AVCapability *capability = <span class="hljs-built_in">OH_AVCodec_GetCapability</span>(OH_AVCODEC_MIMETYPE_AUDIO_AAC, <span class="hljs-literal">true</span>);</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name = <span class="hljs-built_in">OH_AVCapability_GetName</span>(capability);</li><li>OH_AVCodec *audioEnc_ = <span class="hljs-built_in">OH_AudioCodec_CreateByName</span>(name);</li></ol></pre></div></div>       <p>添加头文件和命名空间:</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span></li><li><span class="hljs-comment">// c++标准库命名空间。</span></li><li><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</li></ol></pre></div></div>       <p>示例代码：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化队列。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">AEncBufferSignal</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    std::mutex inMutex_;</li><li>    std::mutex outMutex_;</li><li>    std::mutex startMutex_;</li><li>    std::condition_variable inCond_;</li><li>    std::condition_variable outCond_;</li><li>    std::condition_variable startCond_;</li><li>    std::queue&lt;<span class="hljs-type">uint32_t</span>&gt; inQueue_;</li><li>    std::queue&lt;<span class="hljs-type">uint32_t</span>&gt; outQueue_;</li><li>    std::queue&lt;OH_AVBuffer *&gt; inBufferQueue_;</li><li>    std::queue&lt;OH_AVBuffer *&gt; outBufferQueue_;</li><li>};</li><li>AEncBufferSignal *signal_;</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_RegisterCallback()注册回调函数。</p>       <p>注册回调函数指针集合OH_AVCodecCallback，包括：</p>       <ul>        <li>OH_AVCodecOnError：编码器运行错误。</li>        <li>OH_AVCodecOnStreamChanged：音频编码器暂未支持此回调。</li>        <li>OH_AVCodecOnNeedInputBuffer：运行过程中需要新的输入数据，即编码器已准备好，可以输入PCM数据。</li>        <li>OH_AVCodecOnNewOutputBuffer：运行过程中产生了新的输出数据，即编码完成。</li>       </ul>       <p>开发者可以通过处理该回调报告的信息，确保编码器正常运转。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>回调中不建议进行耗时操作。</p>        </div></div></div>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_AVCodecOnError回调函数的实现。</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnError</span><span class="hljs-params">(OH_AVCodec *codec, <span class="hljs-type">int32_t</span> errorCode, <span class="hljs-type">void</span> *userData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    (<span class="hljs-type">void</span>)codec;</li><li>    (<span class="hljs-type">void</span>)errorCode;</li><li>    (<span class="hljs-type">void</span>)userData;</li><li>}</li><li><span class="hljs-comment">// OH_AVCodecOnStreamChanged回调函数的实现。</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnOutputFormatChanged</span><span class="hljs-params">(OH_AVCodec *codec, OH_AVFormat *format, <span class="hljs-type">void</span> *userData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    (<span class="hljs-type">void</span>)codec;</li><li>    (<span class="hljs-type">void</span>)format;</li><li>    (<span class="hljs-type">void</span>)userData;</li><li>}</li><li><span class="hljs-comment">// OH_AVCodecOnNeedInputBuffer回调函数的实现。</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnInputBufferAvailable</span><span class="hljs-params">(OH_AVCodec *codec, <span class="hljs-type">uint32_t</span> index, OH_AVBuffer *data, <span class="hljs-type">void</span> *userData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    (<span class="hljs-type">void</span>)codec;</li><li>    <span class="hljs-comment">// 编码输入码流送入InputBuffer队列。</span></li><li>    AEncBufferSignal *signal = <span class="hljs-built_in">static_cast</span>&lt;AEncBufferSignal *&gt;(userData);</li><li>    <span class="hljs-function">unique_lock&lt;mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(signal-&gt;inMutex_)</span></span>;</li><li>    signal-&gt;inQueue_.<span class="hljs-built_in">push</span>(index);</li><li>    signal-&gt;inBufferQueue_.<span class="hljs-built_in">push</span>(data);</li><li>    signal-&gt;inCond_.<span class="hljs-built_in">notify_all</span>();</li><li>}</li><li><span class="hljs-comment">// OH_AVCodecOnNewOutputBuffer回调函数的实现。</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnOutputBufferAvailable</span><span class="hljs-params">(OH_AVCodec *codec, <span class="hljs-type">uint32_t</span> index, OH_AVBuffer *data, <span class="hljs-type">void</span> *userData)</span></span></li><li><span class="hljs-function"></span>{</li><li>    (<span class="hljs-type">void</span>)codec;</li><li>    <span class="hljs-comment">// 将对应输出buffer的index送入OutputQueue_队列。</span></li><li>    <span class="hljs-comment">// 将对应编码完成的数据data送入outBuffer队列。</span></li><li>    AEncBufferSignal *signal = <span class="hljs-built_in">static_cast</span>&lt;AEncBufferSignal *&gt;(userData);</li><li>    <span class="hljs-function">unique_lock&lt;mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(signal-&gt;outMutex_)</span></span>;</li><li>    signal-&gt;outQueue_.<span class="hljs-built_in">push</span>(index);</li><li>    signal-&gt;outBufferQueue_.<span class="hljs-built_in">push</span>(data);</li><li>    signal-&gt;outCond_.<span class="hljs-built_in">notify_all</span>();</li><li>}</li></ol></pre></div></div>       <p>配置回调：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>signal_ = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AEncBufferSignal</span>();</li><li>OH_AVCodecCallback cb_ = {&amp;OnError, &amp;OnOutputFormatChanged, &amp;OnInputBufferAvailable, &amp;OnOutputBufferAvailable};</li><li><span class="hljs-comment">// 配置异步回调。</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_AudioCodec_RegisterCallback</span>(audioEnc_, cb_, signal_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Configure设置编码器。</p>       <p>配置选项key值说明：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.1" valign="top" width="11.11111111111111%">key</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.2" valign="top" width="11.11111111111111%">描述</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.3" valign="top" width="11.11111111111111%">AAC</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.4" valign="top" width="11.11111111111111%">Flac</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.5" valign="top" width="11.11111111111111%">MPEG(MP3)</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.6" valign="top" width="11.11111111111111%">G711mu</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.7" valign="top" width="11.11111111111111%">opus</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.8" valign="top" width="11.11111111111111%">amrnb</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.3.1.10.1.9" valign="top" width="11.11111111111111%">amrwb</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUD_SAMPLE_RATE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">采样率</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUD_CHANNEL_COUNT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">声道数</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUDIO_SAMPLE_FORMAT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">输出音频流格式</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_BITRATE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">码率</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_CHANNEL_LAYOUT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">声道布局</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_MAX_INPUT_SIZE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">最大输入长度</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_PROFILE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">编码档次</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_COMPLIANCE_LEVEL</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">兼容性等级</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>                 </tbody></table></div>       </div>       <p>各音频编码类型参数范围说明：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.5.1.4.1.1" valign="top" width="33.33333333333333%">音频编码类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.5.1.4.1.2" valign="top" width="33.33333333333333%">采样率(Hz)</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.4.5.1.4.1.3" valign="top" width="33.33333333333333%">声道数</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">Flac</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">MP3</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~2</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">G711mu</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AAC-LC</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1、2、3、4、5、6、8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">HE-AAC、HE-AAC v2</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1、2、3、4、5、6、8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">opus</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、12000、16000、24000、48000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~2</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AMR(amrnb)</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AMR(amrwb)</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">16000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>                 </tbody></table></div>       </div>       <p>例如对一个44100Hz采样率、2声道立体声、SAMPLE_S16LE采样格式的PCM音频，以32000bps的码率进行AAC编码的调用流程如下：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">44100</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">32000</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">2</span>;</li><li><span class="hljs-comment">// 配置音频声道类型（必须）</span></li><li><span class="hljs-keyword">constexpr</span> OH_AudioChannelLayout CHANNEL_LAYOUT = OH_AudioChannelLayout::CH_LAYOUT_STEREO;</li><li><span class="hljs-comment">// 配置音频位深（必须）</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S16LE;</li><li><span class="hljs-comment">// 配置AAC profile（可选，默认值：AAC_PROFILE_LC，其他可选值：AAC_PROFILE_HE、AAC_PROFILE_HE_V2）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> AAC_PROFILE = OH_AACProfile::AAC_PROFILE_LC;</li><li>
</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_CHANNEL_LAYOUT, CHANNEL_LAYOUT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_PROFILE, AAC_PROFILE);</li><li><span class="hljs-comment">// 配置编码器</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div>       <p>例FLAC调用流程：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">44100</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">261000</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">2</span>;</li><li><span class="hljs-comment">// 配置音频声道布局（必须）。</span></li><li><span class="hljs-comment">// 值为CH_LAYOUT_MONO、CH_LAYOUT_STEREO、CH_LAYOUT_SURROUND、CH_LAYOUT_QUAD、CH_LAYOUT_5POINT0、CH_LAYOUT_5POINT1、CH_LAYOUT_6POINT1或CH_LAYOUT_7POINT1其中一项。</span></li><li><span class="hljs-keyword">constexpr</span> OH_AudioChannelLayout CHANNEL_LAYOUT = OH_AudioChannelLayout::CH_LAYOUT_STEREO;</li><li><span class="hljs-comment">// 配置音频位深（必须） flac只有SAMPLE_S16LE和SAMPLE_S32LE。</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S32LE;</li><li><span class="hljs-comment">// 配置音频compliance level (默认值0，取值范围-2~2)。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> COMPLIANCE_LEVEL = <span class="hljs-number">0</span>;</li><li>
</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format。</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-comment">// 配置音频精度。API version 20前，FLAC编码必须设置此参数，设置为1即可；未设置此参数配置FLAC编码器时，调用OH_AudioCodec_Configure会返回错误码AV_ERR_INVALID_VAL。该值无实际作用，不会影响编码结果。从API version 20开始，无需设置此参数。</span></li><li><span class="hljs-comment">// constexpr int32_t BITS_PER_CODED_SAMPLE = 1;</span></li><li><span class="hljs-comment">// OH_AVFormat_SetIntValue(format, OH_MD_KEY_BITS_PER_CODED_SAMPLE, BITS_PER_CODED_SAMPLE);</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_CHANNEL_LAYOUT, CHANNEL_LAYOUT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_COMPLIANCE_LEVEL, COMPLIANCE_LEVEL);</li><li><span class="hljs-comment">// 配置编码器。</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div>       <p>例AMR编码调用流程：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须），amr-nb输入采样率为8000hz的PCM，amr-wb输入采样率为16000hz的PCM</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">8000</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）</span></li><li><span class="hljs-comment">// amr-nb支持码率4750、5150、5900、6700、7400、7950、10200、12200</span></li><li><span class="hljs-comment">// amr-wb支持码率6600、8850、12650、14250、15850、18250、19850、23050、23850</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">10200</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">1</span>;</li><li><span class="hljs-comment">// 配置音频声道类型（必须）</span></li><li><span class="hljs-keyword">constexpr</span> OH_AudioChannelLayout CHANNEL_LAYOUT = OH_AudioChannelLayout::CH_LAYOUT_MONO;</li><li><span class="hljs-comment">// 配置音频位深（必须）</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S16LE;</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_CHANNEL_LAYOUT, CHANNEL_LAYOUT);</li><li><span class="hljs-comment">// 配置编码器</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div>       <p>例opus编码调用流程：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须）</span></li><li><span class="hljs-comment">// opus编码支持采样率：8000、12000、16000、24000、48000</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">8000</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）</span></li><li><span class="hljs-comment">// opus编码码率范围：[6000, 510000]</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">6000</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）</span></li><li><span class="hljs-comment">// opus编码支持声道数：1、2</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">1</span>;</li><li><span class="hljs-comment">// 配置音频位深（必须）</span></li><li><span class="hljs-comment">// opus编码支持位深：SAMPLE_S16LE</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S16LE;</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-comment">// 配置编码器</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Prepare()，编码器就绪。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_AudioCodec_Prepare</span>(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Start()启动编码器，进入运行态。</p>       <p>添加头文件：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span></li></ol></pre></div></div>       <p>使用示例：</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ifstream</span> <span class="hljs-variable">inputFile_</span>;</li><li><span class="hljs-variable">ofstream</span> <span class="hljs-variable">outFile_</span>;</li><li>
</li><li><span class="hljs-comment">// 根据实际使用情况填写输入文件路径。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">char</span>* <span class="hljs-variable">inputFilePath</span> = <span class="hljs-string">"/"</span>;</li><li><span class="hljs-comment">// 根据实际使用情况填写输出文件路径。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">char</span>* <span class="hljs-variable">outputFilePath</span> = <span class="hljs-string">"/"</span>;</li><li><span class="hljs-comment">// 打开待编码二进制文件路径（此处以输入为PCM文件为例）。</span></li><li><span class="hljs-variable">inputFile_</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">inputFilePath</span>, <span class="hljs-variable">ios</span>::<span class="hljs-keyword">in</span> | <span class="hljs-title class_">ios</span>::<span class="hljs-title class_">binary</span>);</li><li><span class="hljs-comment">// 配置编码文件输出路径（此处以输出为编码码流文件为例）。</span></li><li><span class="hljs-variable">outFile_</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">outputFilePath</span>, <span class="hljs-variable">ios</span>::<span class="hljs-title class_">out</span> | <span class="hljs-title class_">ios</span>::<span class="hljs-title class_">binary</span>);</li><li><span class="hljs-comment">// 开始编码。</span></li><li><span class="hljs-variable">int32_t</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_AudioCodec_Start</span>(<span class="hljs-variable">audioEnc_</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_PushInputBuffer()，写入待编码的数据。需开发者填充完整的输入数据后调用。</p>       <p>每次输入的采样点数（SAMPLES_PER_FRAME）取值方法如下：</p>       <p>AAC-LC编码每帧包含1024个PCM样点，建议单次输入1024个样点的数据量。</p>       <p>HE-AAC编码每帧包含2048个PCM样点，建议单次输入2048个样点的数据量。</p>       <p>flac比较特殊，需要根据如下表格进行设置。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.7.6.1.3.1.1" valign="top" width="50%">采样率</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.7.6.1.3.1.2" valign="top" width="50%">样点数</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">8000</td>           <td class="cellrowborder" valign="top" width="50%">576</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">16000</td>           <td class="cellrowborder" valign="top" width="50%">1152</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">22050</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">24000</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">32000</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">44100</td>           <td class="cellrowborder" valign="top" width="50%">4608</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">48000</td>           <td class="cellrowborder" valign="top" width="50%">4608</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">88200</td>           <td class="cellrowborder" valign="top" width="50%">8192</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">96000</td>           <td class="cellrowborder" valign="top" width="50%">8192</td>          </tr>                 </tbody></table></div>       </div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>单次编码输入的数据量（单位：字节）为：采样点数（SAMPLES_PER_FRAME） * 声道数 * 单个采样点的占用字节。</p>         <p>flac编码的样点数建议参考表格根据采样率对应的样点数进行设置，否则可能出现编码文件损坏问题。</p>        </div></div></div>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li> <span class="hljs-comment">// 声道数。</span></li><li> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">2</span>;</li><li> <span class="hljs-comment">// 采样点数，这里以AAC-LC为例，采样点数为1024。</span></li><li> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> SAMPLES_PER_FRAME = <span class="hljs-number">1024</span>;</li><li> <span class="hljs-comment">// 单次编码输入的数据量（单位：字节）为：采样点数 * 声道数 * 单个采样点的占用字节（以采样格式SAMPLE_S16LE为例）。</span></li><li> <span class="hljs-comment">// 如果最后一帧数据不满足长度，建议进行丢弃或填充处理。</span></li><li> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> INPUT_FRAME_BYTES = SAMPLES_PER_FRAME * DEFAULT_CHANNEL_COUNT * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">short</span>);</li><li> <span class="hljs-type">uint32_t</span> index = signal_-&gt;inQueue_.<span class="hljs-built_in">front</span>();</li><li> <span class="hljs-keyword">auto</span> buffer = signal_-&gt;inBufferQueue_.<span class="hljs-built_in">front</span>();</li><li> OH_AVCodecBufferAttr attr = {<span class="hljs-number">0</span>};</li><li> <span class="hljs-keyword">if</span> (!inputFile_.<span class="hljs-built_in">eof</span>()) {</li><li>     inputFile_.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span> *)<span class="hljs-built_in">OH_AVBuffer_GetAddr</span>(buffer), INPUT_FRAME_BYTES);</li><li>     attr.size = INPUT_FRAME_BYTES;</li><li>     attr.flags = AVCODEC_BUFFER_FLAGS_NONE;</li><li> } <span class="hljs-keyword">else</span> {</li><li>     attr.size = <span class="hljs-number">0</span>;</li><li>     attr.flags = AVCODEC_BUFFER_FLAGS_EOS;</li><li> }</li><li> <span class="hljs-built_in">OH_AVBuffer_SetBufferAttr</span>(buffer, &amp;attr);</li><li> <span class="hljs-comment">// 送入编码输入队列进行编码, index为对应队列下标。</span></li><li> <span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_AudioCodec_PushInputBuffer</span>(audioEnc_, index);</li><li> <span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>     <span class="hljs-comment">// 异常处理。</span></li><li> }</li></ol></pre></div></div>       <p>在上方案例中，attr.flags代表缓冲区标记的类别。</p>       <p>结束时需要将flags标识为AVCODEC_BUFFER_FLAGS_EOS。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.7.11.1.3.1.1" valign="top" width="50%">枚举值</th>           <th align="left" class="cellrowborder" id="mcps1.3.9.2.7.11.1.3.1.2" valign="top" width="50%">描述</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_NONE</td>           <td class="cellrowborder" valign="top" width="50%">表示为普通帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_EOS</td>           <td class="cellrowborder" valign="top" width="50%">表示缓冲区是流结束帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_CODEC_DATA</td>           <td class="cellrowborder" valign="top" width="50%">表示缓冲区包含编解码特定数据。</td>          </tr>                 </tbody></table></div>       </div></li>      <li>       <p>调用OH_AudioCodec_FreeOutputBuffer()，释放编码后的数据。</p>       <p>在取走编码码流后，就应及时调用OH_AudioCodec_FreeOutputBuffer()进行释放。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">uint32_t</span> <span class="hljs-variable">index</span> = <span class="hljs-variable">signal_</span>-&gt;<span class="hljs-title class_">outQueue_</span>.<span class="hljs-title class_">front</span>();</li><li><span class="hljs-variable">OH_AVBuffer</span> *<span class="hljs-variable">avBuffer</span> = <span class="hljs-variable">signal_</span>-&gt;<span class="hljs-title class_">outBufferQueue_</span>.<span class="hljs-title class_">front</span>();</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">avBuffer</span> == <span class="hljs-variable">nullptr</span>) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li><li><span class="hljs-comment">// 获取buffer attributes。</span></li><li><span class="hljs-variable">OH_AVCodecBufferAttr</span> <span class="hljs-variable">attr</span> = {<span class="hljs-number">0</span>};</li><li><span class="hljs-variable">int32_t</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_AVBuffer_GetBufferAttr</span>(<span class="hljs-variable">avBuffer</span>, &amp;<span class="hljs-title class_">attr</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-comment">// 将编码完成数据data写入到对应输出文件中。</span></li><li><span class="hljs-variable">outFile_</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">char</span> *&gt;(<span class="hljs-title function_">OH_AVBuffer_GetAddr</span>(<span class="hljs-variable">avBuffer</span>)), <span class="hljs-variable">attr</span>.<span class="hljs-variable">size</span>);</li><li><span class="hljs-comment">// 释放已完成写入的数据。</span></li><li><span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_AudioCodec_FreeOutputBuffer</span>(<span class="hljs-variable">audioEnc_</span>, <span class="hljs-variable">index</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">attr</span>.<span class="hljs-variable">flags</span> == <span class="hljs-variable">AVCODEC_BUFFER_FLAGS_EOS</span>) {</li><li>    <span class="hljs-comment">// 结束。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>（可选）调用OH_AudioCodec_Flush()刷新编码器。</p>       <p>调用OH_AudioCodec_Flush()后，编码器处于Flush状态，会将当前编码队列清空。</p>       <p>此时需要调用OH_AudioCodec_Start()重新开始编码。</p>       <p>使用情况：</p>       <ul>        <li>在文件EOS之后，需要调用刷新。</li>        <li>在执行过程中遇到可继续执行的错误时（即OH_AudioCodec_IsValid 为true）可以调用，然后重新调用OH_AudioCodec_Start。</li>       </ul>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-objectivec" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 刷新编码器 audioEnc_。</span></li><li>int32_t ret = OH_AudioCodec_Flush(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-comment">// 重新开始编码。</span></li><li>ret = OH_AudioCodec_Start(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>（可选）调用OH_AudioCodec_Reset()重置编码器。</p>       <p>调用OH_AudioCodec_Reset()后，编码器回到初始化的状态，需要调用OH_AudioCodec_Configure()重新配置，然后调用OH_AudioCodec_Start()重新开始编码。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-objectivec" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 重置编码器 audioEnc_。</span></li><li>int32_t ret = OH_AudioCodec_Reset(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-comment">// 重新配置编码器参数。</span></li><li>ret = OH_AudioCodec_Configure(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Stop()停止编码器。</p>       <p>停止后，可以通过Start重新进入已启动状态（started），但需要注意的是，如果编码器之前已输入数据，则需要重新输入编码器数据。</p>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 终止编码器 audioEnc_。</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_AudioCodec_Stop</span>(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Destroy()销毁编码器实例，释放资源。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>资源不能重复销毁</p>        </div></div></div>       <div _ngcontent-ahg-c106="" class="highlight-div"><div _ngcontent-ahg-c106="" class="highlight-div-header"><div _ngcontent-ahg-c106="" class="highlight-div-header-left"><div _ngcontent-ahg-c106="" class="handle-button expand-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ahg-c106="" class="highlight-div-header-right"><div _ngcontent-ahg-c106="" class="handle-button ai-button"></div><div _ngcontent-ahg-c106="" class="handle-button line-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ahg-c106="" class="handle-button theme-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ahg-c106="" class="handle-button copy-button"><div _ngcontent-ahg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ahg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 调用OH_AudioCodec_Destroy, 注销编码器。</span></li><li><span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_AudioCodec_Destroy</span>(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>} <span class="hljs-keyword">else</span> {</li><li>    audioEnc_ = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 不可重复destroy。</span></li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>