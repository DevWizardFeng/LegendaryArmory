<h1 _ngcontent-rqp-c119="" class="doc-title ng-star-inserted" title="音频编码同步模式"> 音频编码同步模式 </h1>

<div _ngcontent-rqp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API 20开始，支持音频编码同步模式。</p>    <p>开发者可以调用本模块的Native API接口，完成音频编码，即将音频PCM编码压缩成不同的格式。</p>    <p>接口不限制PCM数据的来源。开发者可以调用麦克风录制获取，也可以导入编辑后的PCM数据。通过音频编码，输出对应格式的码流，最后封装为目标格式文件。</p>    <p>支持的编码能力请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avcodec-support-formats#音频编码">AVCodec支持的格式</a>。</p>    <p><strong>适用场景</strong></p>    <p>通常推荐使用异步模式，异步模式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-encoding">音频编码</a>。若需要主动请求buffer去编码PCM，则可以使用同步模式。</p>    <ul>     <li>      <p>音频录制</p>      <p>通过录制传入PCM，然后编码成对应格式的码流，最后封装成所需格式的文件。具体封装方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-video-muxer">媒体数据封装</a>。</p></li>     <li>      <p>音频编辑</p>      <p>编辑PCM后导出音频文件的场景，需要编码成对应音频格式，最后封装成所需格式的文件。具体封装方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-video-muxer">媒体数据封装</a>。</p></li>    </ul>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>AAC编码器默认采用的VBR可变码率模式，这可能导致与预期码率有偏差。</li>       <li>AAC编码器默认输出携带ADTS头部，帧数据的前7字节为ADTS头部。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="开发指导">开发指导<i class="anchor-icon anchor-icon-link" anchorid="开发指导" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avcodec-audiocodec-h" target="_blank">AudioCodec</a>。</p>     <p>参考以下示例代码，完成音频编码的全流程，包括：创建编码器、设置编码参数（采样率/码率/声道数等）、开始/刷新/重置/销毁资源。</p>     <p>在应用开发过程中，开发者应按一定顺序调用方法，执行对应操作，否则系统可能会抛出异常或生成其他未定义的行为。具体顺序可参考下列开发步骤及对应说明。</p>     <p>音频编解码同步模式调用关系图如下所示：</p>     <ul>      <li>       <p>虚线表示可选。音频编码不涉及解密，无需调用OH_AudioCodec_SetDecryptionConfig。</p></li>      <li>       <p>实线表示必选。</p></li>     </ul>     <p><span><img originheight="1290" originwidth="1975" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114427.47693810671281800161621138491629:50001231000000:2800:A0D4E9DAB2981C6730B3385E2ACCA048F4BF93E66068ABF98778EA79DBF1926F.png" width="920" height="600.9113924050632"></span></p>    </div>    <div class="tiledSection">     <h3 id="在cmake脚本中链接动态库" class="firsth2">在CMake脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在cmake脚本中链接动态库" tips="复制节点链接"></i></h3>          <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_codecbase.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_core.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libnative_media_acodec.so)</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>上述'sample'字样仅为示例，此处由开发者根据实际工程目录自定义。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>添加头文件和命名空间。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcodec_audiocodec.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/native_audio_channel_layout.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcapability.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avcodec_base.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avformat.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avbuffer.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// c++标准库命名空间。</span></li><li><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;</li></ol></pre></div></div></li>      <li>       <p>创建编码器实例对象，OH_AVCodec *为编码器实例指针。</p>       <p>应用可以通过媒体类型或编解码器名称创建编码器。</p>       <p>方法一：通过Mimetype创建编码器。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过Mimetype创建编码器，这里示例创建的是AAC编码器，第二个参数设置为true表示当前是编码。</span></li><li>OH_AVCodec *audioEnc_ = <span class="hljs-built_in">OH_AudioCodec_CreateByMime</span>(OH_AVCODEC_MIMETYPE_AUDIO_AAC, <span class="hljs-literal">true</span>);</li></ol></pre></div></div>       <p>方法二：通过codec name创建编码器。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过codec name创建编码器。</span></li><li>OH_AVCapability *capability = <span class="hljs-built_in">OH_AVCodec_GetCapability</span>(OH_AVCODEC_MIMETYPE_AUDIO_AAC, <span class="hljs-literal">true</span>);</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name = <span class="hljs-built_in">OH_AVCapability_GetName</span>(capability);</li><li>OH_AVCodec *audioEnc_ = <span class="hljs-built_in">OH_AudioCodec_CreateByName</span>(name);</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Configure配置编码器。</p>       <p>配置选项key值说明：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.1" valign="top" width="11.11111111111111%">key</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.2" valign="top" width="11.11111111111111%">描述</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.3" valign="top" width="11.11111111111111%">AAC</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.4" valign="top" width="11.11111111111111%">Flac</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.5" valign="top" width="11.11111111111111%">MPEG(MP3)</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.6" valign="top" width="11.11111111111111%">G711mu</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.7" valign="top" width="11.11111111111111%">opus</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.8" valign="top" width="11.11111111111111%">amrnb</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.3.1.10.1.9" valign="top" width="11.11111111111111%">amrwb</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUD_SAMPLE_RATE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">采样率</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUD_CHANNEL_COUNT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">声道数</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_AUDIO_SAMPLE_FORMAT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">输出音频流格式</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_BITRATE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">码率</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_CHANNEL_LAYOUT</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">声道布局</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">必须</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_MAX_INPUT_SIZE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">最大输入长度</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_PROFILE</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">编码档次</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="11.11111111111111%">OH_MD_KEY_COMPLIANCE_LEVEL</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">兼容性等级</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">可选</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>           <td class="cellrowborder" valign="top" width="11.11111111111111%">-</td>          </tr>                 </tbody></table></div>       </div>       <p>各音频编码类型参数范围说明：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.5.1.4.1.1" valign="top" width="33.33333333333333%">音频编码类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.5.1.4.1.2" valign="top" width="33.33333333333333%">采样率(Hz)</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.3.5.1.4.1.3" valign="top" width="33.33333333333333%">声道数</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">Flac</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">MP3</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~2</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">G711mu</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AAC-LC</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、11025、12000、16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1、2、3、4、5、6、8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">HE-AAC、HE-AAC v2</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">16000、22050、24000、32000、44100、48000、64000、88200、96000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1、2、3、4、5、6、8</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">opus</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000、12000、16000、24000、48000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1~2</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AMR(amrnb)</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">8000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">AMR(amrwb)</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">16000</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">1</td>          </tr>                 </tbody></table></div>       </div>       <p>例如，对44100Hz采样率、2声道立体声、SAMPLE_S16LE采样格式的PCM音频，以32000bps的码率进行AAC编码的调用流程如下：</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVErrCode ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">44100</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">32000</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">2</span>;</li><li><span class="hljs-comment">// 配置音频位深（必须）</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S16LE;</li><li><span class="hljs-comment">// 配置AAC profile（可选，默认值：AAC_PROFILE_LC，其他可选值：AAC_PROFILE_HE、AAC_PROFILE_HE_V2）</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> AAC_PROFILE = OH_AACProfile::AAC_PROFILE_LC;</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format,OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format,OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format,OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format,OH_MD_KEY_CHANNEL_LAYOUT, CHANNEL_LAYOUT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_PROFILE, AAC_PROFILE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_ENABLE_SYNC_MODE, <span class="hljs-number">1</span>); <span class="hljs-comment">// 同步模式配置。</span></li><li><span class="hljs-comment">// 配置编码器</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>}</li></ol></pre></div></div>       <p>FLAC编码调用示例：</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVErrCode ret;</li><li><span class="hljs-comment">// 配置音频采样率（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_SAMPLERATE = <span class="hljs-number">44100</span>;</li><li><span class="hljs-comment">// 配置音频码率（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint64_t</span> DEFAULT_BITRATE = <span class="hljs-number">261000</span>;</li><li><span class="hljs-comment">// 配置音频声道数（必须）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> DEFAULT_CHANNEL_COUNT = <span class="hljs-number">2</span>;</li><li><span class="hljs-comment">// 配置音频声道布局（必须）。</span></li><li><span class="hljs-comment">// 值为CH_LAYOUT_MONO、CH_LAYOUT_STEREO、CH_LAYOUT_SURROUND、CH_LAYOUT_QUAD、CH_LAYOUT_5POINT0、CH_LAYOUT_5POINT1、CH_LAYOUT_6POINT1或CH_LAYOUT_7POINT1其中一项。</span></li><li><span class="hljs-keyword">constexpr</span> OH_AudioChannelLayout CHANNEL_LAYOUT = OH_AudioChannelLayout::CH_LAYOUT_STEREO;</li><li><span class="hljs-comment">// 配置音频位深（必须） flac只有SAMPLE_S16LE和SAMPLE_S32LE。</span></li><li><span class="hljs-keyword">constexpr</span> OH_BitsPerSample SAMPLE_FORMAT = OH_BitsPerSample::SAMPLE_S32LE;</li><li><span class="hljs-comment">// 配置音频compliance level（默认值0，取值范围[-2,2]）。</span></li><li><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int32_t</span> COMPLIANCE_LEVEL = <span class="hljs-number">0</span>;</li><li>
</li><li>OH_AVFormat *format = <span class="hljs-built_in">OH_AVFormat_Create</span>();</li><li><span class="hljs-comment">// 写入format。</span></li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_CHANNEL_COUNT, DEFAULT_CHANNEL_COUNT);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUD_SAMPLE_RATE, DEFAULT_SAMPLERATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_BITRATE, DEFAULT_BITRATE);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_AUDIO_SAMPLE_FORMAT, SAMPLE_FORMAT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_CHANNEL_LAYOUT, CHANNEL_LAYOUT);</li><li><span class="hljs-built_in">OH_AVFormat_SetLongValue</span>(format, OH_MD_KEY_COMPLIANCE_LEVEL, COMPLIANCE_LEVEL);</li><li><span class="hljs-built_in">OH_AVFormat_SetIntValue</span>(format, OH_MD_KEY_ENABLE_SYNC_MODE, <span class="hljs-number">1</span>); <span class="hljs-comment">// 同步模式配置。</span></li><li><span class="hljs-comment">// 配置编码器。</span></li><li>ret = <span class="hljs-built_in">OH_AudioCodec_Configure</span>(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Prepare()，编码器就绪。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AVErrCode ret = <span class="hljs-built_in">OH_AudioCodec_Prepare</span>(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Start()启动编码器，进入运行态。</p>       <p>添加头文件：</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span></li></ol></pre></div></div>       <p>使用示例：</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ifstream</span> <span class="hljs-variable">inputFile_</span>;</li><li><span class="hljs-variable">ofstream</span> <span class="hljs-variable">outFile_</span>;</li><li>
</li><li><span class="hljs-comment">// 根据实际使用情况填写输入文件路径。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">char</span>* <span class="hljs-variable">inputFilePath</span> = <span class="hljs-string">"/"</span>;</li><li><span class="hljs-comment">// 根据实际使用情况填写输出文件路径。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">char</span>* <span class="hljs-variable">outputFilePath</span> = <span class="hljs-string">"/"</span>;</li><li><span class="hljs-comment">// 打开待编码二进制文件路径（此处以输入为PCM文件为例）。</span></li><li><span class="hljs-variable">inputFile_</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">inputFilePath</span>, <span class="hljs-variable">ios</span>::<span class="hljs-keyword">in</span> | <span class="hljs-title class_">ios</span>::<span class="hljs-title class_">binary</span>);</li><li><span class="hljs-comment">// 配置编码文件输出路径（此处以输出为编码码流文件为例，并非可播放的音频文件，可播放的音频文件需要音频码流封装到容器内生成）。</span></li><li><span class="hljs-variable">outFile_</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">outputFilePath</span>, <span class="hljs-variable">ios</span>::<span class="hljs-title class_">out</span> | <span class="hljs-title class_">ios</span>::<span class="hljs-title class_">binary</span>);</li><li><span class="hljs-comment">// 开始编码。</span></li><li><span class="hljs-variable">OH_AVErrCode</span> <span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_AudioCodec_Start</span>(<span class="hljs-variable">audioEnc_</span>);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">ret</span> != <span class="hljs-variable">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步模式调用，写入待编码的PCM，获取编码输出的音频帧。</p>       <p>示例代码中，每次输入的采样点数SAMPLES_PER_FRAME取值方法如下：</p>       <p>AAC LC编码每帧包含1024个PCM样点，建议单次输入1024个样点的数据量。</p>       <p>HE-AAC编码每帧包含2048个PCM样点，建议单次输入2048个样点的数据量。</p>       <p>FLAC需要根据如下表格进行设置。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.6.6.1.3.1.1" valign="top" width="50%">采样率</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.6.6.1.3.1.2" valign="top" width="50%">样点数</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">8000</td>           <td class="cellrowborder" valign="top" width="50%">576</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">16000</td>           <td class="cellrowborder" valign="top" width="50%">1152</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">22050</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">24000</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">32000</td>           <td class="cellrowborder" valign="top" width="50%">2304</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">44100</td>           <td class="cellrowborder" valign="top" width="50%">4608</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">48000</td>           <td class="cellrowborder" valign="top" width="50%">4608</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">88200</td>           <td class="cellrowborder" valign="top" width="50%">8192</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">96000</td>           <td class="cellrowborder" valign="top" width="50%">8192</td>          </tr>                 </tbody></table></div>       </div>       <p>单次编码输入的数据量（单位：字节）为：SAMPLES_PER_FRAME * 声道数 * 单个采样点的占用字节。</p>       <p>使用示例：</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-objectivec" data-highlighted="yes"><ol class="linenums"><li>int32_t SAMPLES_PER_FRAME = <span class="hljs-number">1024</span>;</li><li><span class="hljs-comment">// AAC LC编码一帧包含1024采样点，2声道，输入数据为S16LE，16比特数据，占用2字节。</span></li><li>int32_t inputFrameBytes = SAMPLES_PER_FRAME * <span class="hljs-number">2</span> * <span class="hljs-number">2</span>;</li><li><span class="hljs-type">bool</span> inputFinished = <span class="hljs-literal">false</span>;</li><li>OH_AVErrCode ret;</li><li>OH_AVCodecBufferAttr attr;</li><li>
</li><li><span class="hljs-keyword">for</span> (;;) {</li><li>    uint32_t index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">if</span> (!inputFinished) {</li><li>        ret = OH_AudioCodec_QueryInputBuffer(audioEnc_, &amp;index, <span class="hljs-number">20000</span>); <span class="hljs-comment">// 20000us</span></li><li>        <span class="hljs-keyword">if</span> (ret == <span class="hljs-built_in">AV_ERR_TRY_AGAIN_LATER</span>) {</li><li>            <span class="hljs-keyword">continue</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>            <span class="hljs-comment">// 异常处理。</span></li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        OH_AVBuffer *inputBuf = OH_AudioCodec_GetInputBuffer(audioEnc_, index);</li><li>        <span class="hljs-keyword">if</span> (inputBuf == nullptr) {</li><li>            <span class="hljs-comment">// 异常处理。</span></li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        memset(&amp;attr, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(attr));</li><li>        <span class="hljs-keyword">if</span> (!inputFile_.eof()) {</li><li>            inputFile_.read((<span class="hljs-type">char</span> *)OH_AVBuffer_GetAddr(inputBuf), inputFrameBytes);</li><li>            int32_t readSize = inputFile_.gcount();</li><li>            attr.size = readSize;</li><li>            attr.flags = readSize != <span class="hljs-number">0</span> ? <span class="hljs-built_in">AVCODEC_BUFFER_FLAGS_NONE</span> : <span class="hljs-built_in">AVCODEC_BUFFER_FLAGS_EOS</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            inputFinished = <span class="hljs-literal">true</span>;</li><li>            attr.size = <span class="hljs-number">0</span>;</li><li>            attr.flags = <span class="hljs-built_in">AVCODEC_BUFFER_FLAGS_EOS</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (OH_AVBuffer_SetBufferAttr(inputBuf, &amp;attr) != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>            <span class="hljs-comment">// 异常处理。</span></li><li>        }</li><li>        <span class="hljs-keyword">if</span> (OH_AudioCodec_PushInputBuffer(audioEnc_, index) != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>            <span class="hljs-comment">// 异常处理。</span></li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// 当输入的数据量可以编码出多帧数据时，需要多次调用获取输出缓冲区，才能取完编码后的数据。</span></li><li>    ret = OH_AudioCodec_QueryOutputBuffer(audioEnc_, &amp;index, <span class="hljs-number">20000</span>); <span class="hljs-comment">// 20000us</span></li><li>    <span class="hljs-keyword">if</span> (ret == <span class="hljs-built_in">AV_ERR_TRY_AGAIN_LATER</span>) {</li><li>        <span class="hljs-comment">// 超时，可能输入的数据不足以编码出一帧，或者超时时间设置过短。</span></li><li>        <span class="hljs-keyword">continue</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>        <span class="hljs-comment">// 异常处理。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    OH_AVBuffer *outputBuf = OH_AudioCodec_GetOutputBuffer(audioEnc_, index);</li><li>    <span class="hljs-keyword">if</span> (outputBuf == nullptr) {</li><li>        <span class="hljs-comment">// 异常处理。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (OH_AVBuffer_GetBufferAttr(outputBuf, &amp;attr) != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>        <span class="hljs-comment">// 异常处理。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (attr.flags &amp; <span class="hljs-built_in">AVCODEC_BUFFER_FLAGS_EOS</span>) {</li><li>        <span class="hljs-comment">// 输出结束。</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 这里示例仅将数据写入文件记录。假如需要封装成音频文件，可参考媒体数据封装，调用OH_AVMuxer_WriteSampleBuffer封装数据。</span></li><li>    outFile_.write(reinterpret_cast&lt;<span class="hljs-type">char</span> *&gt;(OH_AVBuffer_GetAddr(outputBuf)), attr.size);</li><li>    OH_AudioCodec_FreeOutputBuffer(audioEnc_, index);</li><li>}</li></ol></pre></div></div>       <p>在上方案例中，attr.flags表示缓冲区标记的类别。</p>       <p>结束时需要将flags标识为AVCODEC_BUFFER_FLAGS_EOS。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.6.12.1.3.1.1" valign="top" width="50%">枚举值</th>           <th align="left" class="cellrowborder" id="mcps1.3.11.2.6.12.1.3.1.2" valign="top" width="50%">描述</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_NONE</td>           <td class="cellrowborder" valign="top" width="50%">表示为普通帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_EOS</td>           <td class="cellrowborder" valign="top" width="50%">表示缓冲区是流结束帧。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">AVCODEC_BUFFER_FLAGS_CODEC_DATA</td>           <td class="cellrowborder" valign="top" width="50%">表示缓冲区包含编解码特定数据。</td>          </tr>                 </tbody></table></div>       </div></li>      <li>       <p>（可选）调用OH_AudioCodec_Reset()重置编码器。</p>       <p>调用OH_AudioCodec_Reset()后，编码器回到初始化状态。需要调用OH_AudioCodec_Configure()重新配置，然后调用OH_AudioCodec_Start()重新开始编码。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-objectivec" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 重置编码器。</span></li><li>OH_AVErrCode ret = OH_AudioCodec_Reset(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li><li><span class="hljs-comment">// 重新配置编码器参数。</span></li><li>ret = OH_AudioCodec_Configure(audioEnc_, format);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>（可选）调用OH_AudioCodec_Stop()停止编码器。</p>       <p>停止后，可以通过Start重新进入已启动状态（started），但若编码器之前已输入数据，则需要重新输入编码器数据。</p>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 停止编码器。</span></li><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> OH_AudioCodec_Stop(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != AV_ERR_OK) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用OH_AudioCodec_Destroy()销毁编码器实例，释放资源。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>禁止重复销毁编码器。</p>        </div></div></div>       <div _ngcontent-rqp-c106="" class="highlight-div"><div _ngcontent-rqp-c106="" class="highlight-div-header"><div _ngcontent-rqp-c106="" class="highlight-div-header-left"><div _ngcontent-rqp-c106="" class="handle-button expand-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rqp-c106="" class="highlight-div-header-right"><div _ngcontent-rqp-c106="" class="handle-button ai-button"></div><div _ngcontent-rqp-c106="" class="handle-button line-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rqp-c106="" class="handle-button theme-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rqp-c106="" class="handle-button copy-button"><div _ngcontent-rqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rqp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-objectivec" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 调用OH_AudioCodec_Destroy销毁编码器。</span></li><li>OH_AVErrCode ret = OH_AudioCodec_Destroy(audioEnc_);</li><li><span class="hljs-keyword">if</span> (ret != <span class="hljs-built_in">AV_ERR_OK</span>) {</li><li>    <span class="hljs-comment">// 异常处理。</span></li><li>} <span class="hljs-keyword">else</span> {</li><li>    audioEnc_ = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 不可重复destroy。</span></li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>