<h1 _ngcontent-ggc-c119="" class="doc-title ng-star-inserted" title="顶部窗口控制条避让适配智慧多窗"> 顶部窗口控制条避让适配智慧多窗 </h1>

<div _ngcontent-ggc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>顶部窗口控制条是应用窗口处于智慧多窗模式下，应用顶部的操作横条 <span><img height="12.718125" originheight="56" originwidth="176" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114929.75568559886550343864028464951359:50001231000000:2800:6442AF33B8AB839519421855846BEB87928D1B83FA07F95894DAED318B79CC51.png" width="39.971155" class="notEnlarge"></span> 。</p> <p>顶部窗口控制条示意图如下所示：</p> <p><span><img height="281.295" originheight="2100" originwidth="3906" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114929.74654958418248111330347038683247:50001231000000:2800:41C04A915D8B80A229FE59BC29141487142A86BC6796B328E886BA740D2EAD07.png" title="点击放大" width="523.6875"></span></p> <p>顶部横条的避让可通过以下两种方式适配：</p> <ul><li>使用窗口的避让能力：通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen</a>设置窗口布局是否为沉浸式布局。<p>沉浸式布局是指应用布局不避让状态栏、导航栏以及智慧多窗顶部横条，这可能发生组件与顶部横条的重叠，导致文字遮挡、点击事件冲突等情况。非沉浸式布局是指布局避让状态栏、导航栏以及智慧多窗顶部横条，组件不会与其重叠。因此可设置isLayoutFullScreen值为false使窗口的布局为非沉浸式布局。</p> <p><span><img height="281.295" originheight="2100" originwidth="3906" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114929.94387348971907699836945768525212:50001231000000:2800:5EE284764E130AA206453270167F14D78055CC82B121C5C5D1E90C77D86D85B3.png" title="点击放大" width="523.6875"></span></p> <p>示例：</p> <div _ngcontent-ggc-c106="" class="highlight-div"><div _ngcontent-ggc-c106="" class="highlight-div-header"><div _ngcontent-ggc-c106="" class="highlight-div-header-left"><div _ngcontent-ggc-c106="" class="handle-button expand-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ggc-c106="" class="highlight-div-header-right"><div _ngcontent-ggc-c106="" class="handle-button ai-button"></div><div _ngcontent-ggc-c106="" class="handle-button line-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ggc-c106="" class="handle-button theme-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ggc-c106="" class="handle-button copy-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ggc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'非沉浸式布局'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>,</li><li>        <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>          <span class="hljs-keyword">if</span> (errCode) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span> = data;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in obtaining the top window. Data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (exception) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(exception));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-params">isLayoutFullScreen: <span class="hljs-built_in">boolean</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(isLayoutFullScreen).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in setting the window layout to full-screen mode.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">if</span> (errCode) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set the window layout to full-screen mode. Cause:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">TopStart</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({</li><li>            <span class="hljs-attr">top</span>: <span class="hljs-string">'2%'</span>,</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-string">'40%'</span></li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'设置窗口为沉浸式布局'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">stateStyles</span>({</li><li>          <span class="hljs-attr">normal</span>: {</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff6b89d4'</span>)</li><li>          },</li><li>          <span class="hljs-attr">pressed</span>: {</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ffc81f2a'</span>)</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'60%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'6%'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">true</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'沉浸式布局'</span>;</li><li>        })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'设置窗口为非沉浸式布局'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">stateStyles</span>({</li><li>          <span class="hljs-attr">normal</span>: {</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff6b89d4'</span>)</li><li>          },</li><li>          <span class="hljs-attr">pressed</span>: {</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ffc81f2a'</span>)</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'60%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'6%'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">false</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'非沉浸式布局'</span>;</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#fceaeaea'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li>应用主动避让：应用不使用窗口避让能力（即设置窗口为沉浸式布局）。首次通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">getWindowAvoidArea</a>接口可获取屏幕顶部需要规避的矩阵区域topRect，获取到该值后应用可对应做布局避让，并且注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>监听系统避让区域变化以进行布局的动态调整。<div _ngcontent-ggc-c106="" class="highlight-div"><div _ngcontent-ggc-c106="" class="highlight-div-header"><div _ngcontent-ggc-c106="" class="highlight-div-header-left"><div _ngcontent-ggc-c106="" class="handle-button expand-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ggc-c106="" class="highlight-div-header-right"><div _ngcontent-ggc-c106="" class="handle-button ai-button"></div><div _ngcontent-ggc-c106="" class="handle-button line-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ggc-c106="" class="handle-button theme-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ggc-c106="" class="handle-button copy-button"><div _ngcontent-ggc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ggc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">topSafeHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>,</li><li>        <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>          <span class="hljs-keyword">if</span> (errCode) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          windowClass = data;</li><li>          windowClass.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">true</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">px2vp</span>(</li><li>            windowClass.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM</span>).<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span>);</li><li>          windowClass.<span class="hljs-title function_">on</span>(<span class="hljs-string">'avoidAreaChange'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">type</span> == <span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">px2vp</span>(data.<span class="hljs-property">area</span>.<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span>)</li><li>            }</li><li>          })</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in obtaining the top window. Data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (exception) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to obtain the top window. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(exception));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">TopStart</span> }) {</li><li>      <span class="hljs-comment">// 顶部避让区域</span></li><li>      <span class="hljs-title class_">Row</span>() {</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>
</li><li>      <span class="hljs-comment">// 根据topSafeHeight动态调整应用布局</span></li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ul> </div> <div></div></div>