<h1 _ngcontent-dgc-c119="" class="doc-title ng-star-inserted" title="预览数据模拟"> 预览数据模拟 </h1>

<div _ngcontent-dgc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001721022452"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294523__p1699017983516">仅<span id="ZH-CN_TOPIC_0000002510294523__text6133150123613">API 11</span>及以上版本的Stage工程支持。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002510294523__p17164101403313">在预览场景中，由于代码的运行环境与真机设备上的运行环境不同，调用部分接口时无法获取到有效的返回值（例如获取电池电量信息等，在预览场景下batteryInfo.voltage返回的是一个固定的值0），这样开发者就无法在预览时查看到不同返回值带来的界面变化。因此，Hamock提供了预览场景的模拟功能，在不改变业务运行逻辑的同时，开发者可以模拟UI组件上的属性或方法，或模拟import的模块接口。</p> <div class="tiledSection"><h2 id="section62018177237">使用前提<i class="anchor-icon anchor-icon-link" anchorid="section62018177237" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510294523__p41641014133320">使用Hamock在预览场景模拟，需要在工程或模块的oh-package.json5中添加该依赖，然后重新同步工程。</p> <div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294523__screen1884313653313" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"devDependencies"</span>: {</li><li>    <span class="hljs-string">"@ohos/hamock"</span>: <span class="hljs-string">"1.0.0"</span></li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section5275161819342">UI组件上的Mock<i class="anchor-icon anchor-icon-link" anchorid="section5275161819342" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510294523__p0431183243415">Hamock提供了@MockSetup用于修饰Mock方法，仅支持声明式范式的组件。当开发者预览该组件时，预览运行时将在组件初始化时执行被@MockSetup修饰的方法。因此，开发者可以在这个被修饰的方法内重定义组件的方法或重赋值组件的属性，其将在预览时生效。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294523__p12564041165018">@MockSetup修饰的方法仅在预览场景会自动触发，并先于组件的aboutToAppear执行。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section16826163411347" class="firsth2">UI组件的方法<i class="anchor-icon anchor-icon-link" anchorid="section16826163411347" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510294523__ol6359201217511"><li id="li14359712205114"><span>在ArkTS页面代码中引入Hamock。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" id="ZH-CN_TOPIC_0000002510294523__screen0329329145115" data-highlighted="yes"><ol class="linenums"><li>import { MockKit, <span class="hljs-keyword">when</span>, MockSetup } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hamock'</span>;</li></ol></pre></div></div> <p></p></li><li id="li1639171613511"><span>在目标组件中定义一个方法，并用@MockSetup修饰该方法。在这个方法中，使用MockKit模拟目标方法。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510294523__screen11137153605112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockKit</span>, when, <span class="hljs-title class_">MockSetup</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hamock'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li> ...</li><li> <span class="hljs-meta">@MockSetup</span></li><li> <span class="hljs-title function_">randomName</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">mocker</span>: <span class="hljs-title class_">MockKit</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockKit</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">mockfunc</span>: <span class="hljs-title class_">Object</span> = mocker.<span class="hljs-title function_">mockFunc</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">method1</span>);</li><li>  <span class="hljs-comment">// mock 指定的方法在指定入参的返回值</span></li><li>  <span class="hljs-title function_">when</span>(mockfunc)(<span class="hljs-string">'test'</span>).<span class="hljs-title function_">afterReturn</span>(<span class="hljs-number">1</span>);</li><li> }</li><li> ...</li><li> <span class="hljs-comment">// 业务场景调用方法</span></li><li> <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">method1</span>(<span class="hljs-string">'test'</span>); <span class="hljs-comment">// in previewer, result = 1</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section118431126134818">UI组件的属性<i class="anchor-icon anchor-icon-link" anchorid="section118431126134818" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510294523__ol4197148145117"><li id="li20197114814513"><span>在ArkTS页面代码中引入Hamock。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002510294523__screen11197194845119" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockSetup</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hamock'</span>;</li></ol></pre></div></div> <p></p></li><li id="li1619774813514"><span>在目标组件中定义一个方法，并用@MockSetup修饰该方法。在这个方法中，对于需要Mock的属性，可以重新赋值。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510294523__screen115129269525" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockSetup</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hamock'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Person</span> {</li><li> <span class="hljs-meta">@Prop</span> <span class="hljs-attr">species</span>: <span class="hljs-built_in">string</span>;</li><li> <span class="hljs-comment">// 在@MockSetup片段中，定义对象属性</span></li><li> <span class="hljs-meta">@MockSetup</span></li><li> <span class="hljs-title function_">randomName</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">species</span> = <span class="hljs-string">'primates'</span></li><li> }</li><li> ...</li><li> <span class="hljs-comment">// 业务场景调用属性（如果从初始化到调用期间，该属性无变化）</span></li><li> <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">species</span> <span class="hljs-comment">// in previewer, result = primates</span></li><li>}</li></ol></pre></div></div> <p></p></li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510294523__ul1033316505520"><li id="li153331050155213">ArkUI部分类型属性不支持Mock，如readonly、@ObjectLink。</li><li id="li73331050125220">被@Link/@Consume/@Prop/@BuilderParam装饰器修饰的变量，ArkUI语法要求父容器需要有对应属性的定义，因此更推荐开发者通过定义⼀个预览场景父容器（并通过父容器传递合适的数据）来预览这⼀类的组件。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section749504012483">模块的Mock<i class="anchor-icon anchor-icon-link" anchorid="section749504012483" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510294523__p1799203217218">模块的Mock支持对系统模块、依赖模块及本地模块的Mock，通过新建ArkTS文件定义Mock实现代码，并在mock-config.json5配置文件中定义目标模块与Mock实现代码文件的映射关系。目标模块与Mock实现代码文件为一对一的关系，即对于同一目标模块，仅支持一份Mock实现代码，预览运行时，所有页面import目标模块都将指向这一份Mock实现代码。</p> </div> <div class="tiledSection"><h3 id="section1925557164817" class="firsth2">系统模块/依赖的模块<i class="anchor-icon anchor-icon-link" anchorid="section1925557164817" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510294523__ol124991614145311"><li id="li2014410539570"><span>在src/mock目录下新建一个ArkTS文件，在这个文件内定义目标模块的Mock实现。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510294523__screen13144155310574" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/mock/MeasureText.mock.ets</span></li><li><span class="hljs-keyword">import</span> <span class=""><span class="hljs-title class_">MeasureText</span> </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@ohos.measure'</span></span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">类的</span></span><span class=""><span class="hljs-comment">mock</span></span><span class=""><span class="hljs-comment">使用继承</span></span><span class=""><span class="hljs-comment">(extends)</span></span><span class=""><span class="hljs-comment">的方式实现</span></span></li><li><span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">MockMeasureText</span> </span><span class="hljs-keyword">extends</span> <span class=""><span class="hljs-title class_ inherited__">MeasureText</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">定义</span></span><span class=""><span class="hljs-comment">mock</span></span><span class=""><span class="hljs-comment">实现</span></span></li><li>  <span class="hljs-keyword">static</span> <span class=""><span class="hljs-title function_">measureText</span></span><span class="">()</span><span class="">: </span><span class=""><span class="hljs-built_in">number</span> </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">log</span></span><span class="">(</span><span class=""><span class="hljs-string">'Return value of the mock measureText function'</span></span><span class="">)</span></li><li>    <span class="hljs-keyword">return</span> <span class=""><span class="hljs-number">100</span></span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class=""><span class="hljs-title class_">MockMeasureText</span></span><span class="">;</span></li></ol></pre></div></div> <div class="p" id="ZH-CN_TOPIC_0000002510294523__p12145145311575"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294523__p49292286313">用户在对类定义Mock的实现时，需要使用继承(extends)的方式实现。</p> </div></div></div> </div> <p></p></li><li id="li990435715312"><span>在Mock配置文件src/mock/mock-config.json5中定义目标模块与Mock实现的替换关系。该替换关系会在预览场景下生效。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294523__screen15511525165410" data-highlighted="yes"><ol class="linenums"><li>{</li><li><span class="">  <span class="hljs-string">"@ohos.measure"</span></span><span class="">: </span>{ <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">待替换的</span></span><span class=""><span class="hljs-comment">moduleName</span></span></li><li>  <span class="">  <span class="hljs-string">"source"</span></span><span class="">: </span><span class=""><span class="hljs-string">"src/mock/MeasureText.mock.ets"</span> </span><span class=""><span class="hljs-comment">// Mock</span></span><span class=""><span class="hljs-comment">代码的路径，相对于模块根目录</span></span></li><li>  },</li><li> ...</li><li>}</li></ol></pre></div></div> <p></p></li><li id="li1121016231549"><span>在原调用处中添加Hilog日志，方便在预览时，在Log中打印获取返回值，从而验证Mock是否生效。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002510294523__screen1984910476543" data-highlighted="yes"><ol class="linenums"><li>hilog.<span class="hljs-title function_">debug</span>(<span class="hljs-title class_">DomainNumber</span>, logTag, <span class="hljs-string">'Mock %{public}s'</span>, <span class=""><span class="hljs-string">`</span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">MeasureText</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">measureText</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">(</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">{</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">textContent</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">: </span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'</span></span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">Hello World</span></span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'</span></span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">)</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">`</span></span>)</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section15329151074912">本地模块<i class="anchor-icon anchor-icon-link" anchorid="section15329151074912" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002510294523__ol941619135513"><li id="li1641671145510"><span>在src/mock目录下新建一个ArkTS文件，在这个文件内定义目标模块的Mock实现。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510294523__screen5416915551" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/mock/module/utils/CommonUtils.mock.ts</span></li><li><span class="hljs-comment">// import local module</span></li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">LibDefaultExport</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../main/ets/utils/CommonUtils'</span>; <span class="hljs-comment">// get origin default export</span></li><li><span class="hljs-keyword">import</span> { methodA, <span class="hljs-title class_">ObjectB</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../main/ets/utils/CommonUtils'</span>; <span class="hljs-comment">// get origin export on demand</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultExportMock</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LibDefaultExport</span> {</li><li>  <span class="hljs-comment">// 定义mock实现</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getName</span>(): <span class="hljs-title class_">String</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"Mocked Name"</span>;</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-keyword">export</span> {</li><li>  methodA,</li><li>  <span class="hljs-title class_">ObjectB</span>,</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DefaultExportMock</span>;</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510294523__p10417191115516">其中CommonUtils.ets文件示例如下：</p> <div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002510294523__screen1226898397" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonUtils</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getName</span>(): <span class="hljs-title class_">String</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"origin name"</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getTitle</span>(): <span class="hljs-title class_">String</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"origin title"</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> methodA = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-string">"methodA"</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ObjectB</span>: <span class="hljs-title class_">Object</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();</li></ol></pre></div></div> <div class="p" id="ZH-CN_TOPIC_0000002510294523__p14721752163811"><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510294523__p1816519113450">本地模块的Mock仅支持src/main/ets目录下的ArkTS或TS文件。</p> </div></div></div> </div> <p></p></li><li id="li5417171125516"><span>在Mock配置文件src/mock/mock-config.json5中定义目标模块与Mock实现的替换关系。该替换关系会在预览场景下生效。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294523__screen441791155517" data-highlighted="yes"><ol class="linenums"><li>{</li><li> <span class="hljs-string">"utils/CommonUtils.ets"</span>: { <span class="hljs-comment">// 本地模块只支持ets/xxx的相对路径，并需明确文件后缀</span></li><li>  <span class="hljs-string">"source"</span>: <span class="hljs-string">"src/mock/module/utils/CommonUtils.mock.ts"</span></li><li> },</li><li> ...</li><li>}</li></ol></pre></div></div> <p></p></li><li id="li84171413556"><span>在原调用处中添加Hilog日志，方便在预览时，在Log中打印获取返回值，从而验证Mock是否生效。</span><p></p><div _ngcontent-dgc-c106="" class="highlight-div"><div _ngcontent-dgc-c106="" class="highlight-div-header"><div _ngcontent-dgc-c106="" class="highlight-div-header-left"><div _ngcontent-dgc-c106="" class="handle-button expand-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgc-c106="" class="highlight-div-header-right"><div _ngcontent-dgc-c106="" class="handle-button ai-button"></div><div _ngcontent-dgc-c106="" class="handle-button line-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgc-c106="" class="handle-button theme-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgc-c106="" class="handle-button copy-button"><div _ngcontent-dgc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" id="ZH-CN_TOPIC_0000002510294523__screen15417513559" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-tag">hilog</span><span class="hljs-selector-class">.debug</span>(DomainNumber, logTag, <span class="hljs-string">'Mock %{public}s'</span>, CommonUtils.<span class="hljs-built_in">getName</span>());</li></ol></pre></div></div> <p></p></li></ol> </div> </div> <div></div></div>