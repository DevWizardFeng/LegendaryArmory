<h1 _ngcontent-cxo-c119="" class="doc-title ng-star-inserted" title="验证签名"> 验证签名 </h1>

<div _ngcontent-cxo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>如果需要在端侧校验安全图像数据或安全地理位置数据签名的有效性，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-architecture-kit-intro" target="_blank">Crypto Architecture Kit</a>，使用方法请参考“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-ecdsa-sign-sig-verify" target="_blank">使用ECDSA密钥对签名验签</a>”章节。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>推荐开发者在服务器端完成安全图像或安全地理位置的签名验证，请参考“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/device-attestation-servers" target="_blank">Device Certificate Kit 设备真实性证明服务器端开发</a>”。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section31055391019">获取签名数据<i class="anchor-icon anchor-icon-link" anchorid="section31055391019" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section584110121112" class="firsth2">安全摄像头图像数据格式<i class="anchor-icon anchor-icon-link" anchorid="section584110121112" tips="复制节点链接"></i></h3>          <p>安全图像数据的结构如下所示：</p>     <p><span><img height="256.83217297297296" originheight="1225" originwidth="4388" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115102.40417701171423175693080071516670:50001231000000:2800:0B67116A26C3152800EAF48D5343063DF6EEA5D5B4BA8ADFC4F39621C92C4408.png" title="点击放大" width="920"></span></p>     <p>其中，用户数据和图像数据为被签名的原始数据，图像数据长度固定为460800字节，签名数据是Base64编码的签名结果，开发者需要解析出这些数据用来验证安全图像数据签名。参考代码如下：</p>     <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 获取被签名的原始数据</span></li><li><span class="hljs-keyword">const</span> secureImageBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>); <span class="hljs-comment">// 实际使用时请替换为Camera Kit获取到的安全图像buffer</span></li><li><span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(secureImageBuffer);</li><li><span class="hljs-keyword">const</span> imageBufferLength = <span class="hljs-number">460800</span>; <span class="hljs-comment">// 安全图像buffer长度固定为460800</span></li><li><span class="hljs-keyword">const</span> userDataLength = view.<span class="hljs-title function_">getUint32</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取用户数据长度</span></li><li><span class="hljs-keyword">const</span> originData = secureImageBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">4</span>, <span class="hljs-number">4</span> + userDataLength + imageBufferLength);</li><li><span class="hljs-comment">// 获取签名结果</span></li><li><span class="hljs-keyword">const</span> maxSignatureBufferLength = <span class="hljs-number">512</span>;</li><li><span class="hljs-keyword">const</span> signatureBuffer = secureImageBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">4</span> + userDataLength + imageBufferLength,</li><li>  <span class="hljs-number">4</span> + userDataLength + imageBufferLength + maxSignatureBufferLength);</li><li><span class="hljs-keyword">const</span> signatureString = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(signatureBuffer).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">code</span> =&gt;</span> code !== <span class="hljs-number">0</span>));</li><li><span class="hljs-keyword">const</span> base64Helper = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">Base64Helper</span>();</li><li><span class="hljs-keyword">const</span> signatureData = base64Helper.<span class="hljs-title function_">decodeSync</span>(signatureString);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section13800181213920">压缩、裁剪后安全图像数据格式<i class="anchor-icon anchor-icon-link" anchorid="section13800181213920" tips="复制节点链接"></i></h3>         </div>    <p>压缩、裁剪处理后返回的安全图像数据的结构如下所示：</p>    <p><span><img height="436.76734500000003" originheight="2081" originwidth="4375" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115102.01283095677154102902524858641869:50001231000000:2800:53DD004306FEFA7C69CE96267ECA1A9A9742351F9BD479A87FEC307B36C41A05.jpg" title="点击放大" width="918.2985000000001"></span></p>    <p>返回的处理后安全图像数据具体包含：</p>    <ol>     <li>魔数Magic，其值当前默认为 0x53494D47，开发者可以通过检查Magic字段来验证返回的图像数据的正确性。</li>     <li>版本Version，其值当前默认为 1，开发者可以通过检查Version字段来验证返回的图像数据的正确性。</li>     <li>用户数据长度（16到127 Bytes之间）和用户数据。其中，用户数据是开发者在调用initializeAttestContext初始化证明会话时，传入的相关数据。</li>     <li>图像数据长度，图像宽度（单位为：pixel，取值范围在0到640之间），图像高度（单位为：pixel，取值范围在0到480之间）和图像数据。</li>     <li>签名数据，是Base64编码的签名结果。</li>    </ol>    <p>其中，签名的原始数据由用户数据和图像数据组成，开发者需要解析出这些数据用来验证安全图像数据签名。参考代码如下：</p>    <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">const</span> secureImageBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>); <span class="hljs-comment">// 实际使用时请替换为Camera Kit获取到的安全图像buffer</span></li><li><span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(secureImageBuffer);</li><li><span class="hljs-keyword">const</span> magic = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取安全图像的Magic字段，该值默认为 0x53494D47</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> version = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取安全图像的Version字段，该值默认为 1</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> userDataLength = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取用户数据长度</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> userdata = secureImageBuffer.<span class="hljs-title function_">slice</span>(offset, offset + userDataLength);</li><li>offset += userDataLength;</li><li><span class="hljs-keyword">const</span> imageLen = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取压缩、裁剪处理后的图像数据长度</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> imageWidth = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取图像的宽度，单位为像素</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> imageHeight = view.<span class="hljs-title function_">getUint32</span>(offset, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取图像的高度，单位为像素</span></li><li>offset += <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">const</span> imageBuffer = secureImageBuffer.<span class="hljs-title function_">slice</span>(offset, offset + imageLen);</li><li>offset += imageLen;</li><li><span class="hljs-comment">// 获取被签名的原始数据</span></li><li><span class="hljs-keyword">const</span> totalLength = userdata.<span class="hljs-property">byteLength</span> + imageBuffer.<span class="hljs-property">byteLength</span>;</li><li><span class="hljs-keyword">const</span> originData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(totalLength));</li><li>originData.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(userdata), <span class="hljs-number">0</span>);</li><li>originData.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(imageBuffer), userdata.<span class="hljs-property">byteLength</span>);</li><li><span class="hljs-comment">// 获取签名结果    </span></li><li><span class="hljs-keyword">const</span> maxSignatureLength = <span class="hljs-number">512</span>;</li><li><span class="hljs-keyword">const</span> signatureBuffer = secureImageBuffer.<span class="hljs-title function_">slice</span>(offset, offset + maxSignatureLength);</li><li><span class="hljs-keyword">const</span> signatureString = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(signatureBuffer).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">code</span> =&gt;</span> code !== <span class="hljs-number">0</span>));</li><li><span class="hljs-keyword">const</span> base64Helper = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">Base64Helper</span>();</li><li><span class="hljs-keyword">const</span> signatureData = base64Helper.<span class="hljs-title function_">decodeSync</span>(signatureString);</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section264710263521">安全地理位置数据格式<i class="anchor-icon anchor-icon-link" anchorid="section264710263521" tips="复制节点链接"></i></h3>          <p>安全地理位置数据的结构请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api" target="_blank">TrustedAppService（可信应用服务）</a>。</p>     <p>对安全地理位置数据验签时，需要将返回的结构体中的数据拼接成字符串形式，格式要求如下：</p>     <ol>      <li>数据排列顺序为：纬度、经度、高度、精确度、时间戳和用户数据。</li>      <li>纬度、经度和高度类型为浮点型，精度为小数点后保留15位；精确度为浮点型，精度为小数点后保留6位；时间戳类型为64位正整数；用户数据类型为字符串。</li>      <li>数据之间的分隔符使用英文逗号。</li>     </ol>     <p>签名数据是Base64编码后的签名结果。获取签名和签名原始数据的参考代码（不含异常处理逻辑，由开发者根据业务场景实现）如下：</p>     <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 以下均为示例值，仅用于展示如何获取原始签名数据和签名结果</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">location</span>: trustedAppService.<span class="hljs-property">Location</span> = {</li><li>  <span class="hljs-attr">latitude</span>: <span class="hljs-number">40.053903635898685</span>,</li><li>  <span class="hljs-attr">longitude</span>: <span class="hljs-number">116.17356591910897</span>,</li><li>  <span class="hljs-attr">altitude</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">accuracy</span>: <span class="hljs-number">11.160304069519043</span>,</li><li>  <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1722151680187</span></li><li>};</li><li><span class="hljs-keyword">const</span> userData = <span class="hljs-string">"trusted_app_service_userdata"</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">secureLocation</span>: trustedAppService.<span class="hljs-property">SecureLocation</span> = {</li><li>  <span class="hljs-attr">originalLocation</span>: location,</li><li>  <span class="hljs-attr">userData</span>: userData,</li><li>  <span class="hljs-attr">signature</span>: <span class="hljs-string">"MEQCIEAcJHgaU8aAoMqD1wgoxiXR5I4jmwVG6ncgSKkW4uBHAiBnfv96T+gt1ef83kNZ+U0gBLsq9byuBLP1RBx30hByuQ=="</span></li><li>};</li><li><span class="hljs-comment">// 获取原始数据</span></li><li><span class="hljs-keyword">const</span> originString = secureLocation.<span class="hljs-property">originalLocation</span>.<span class="hljs-property">latitude</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">15</span>) + <span class="hljs-string">','</span> +</li><li>  secureLocation.<span class="hljs-property">originalLocation</span>.<span class="hljs-property">longitude</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">15</span>) + <span class="hljs-string">','</span> +</li><li>  secureLocation.<span class="hljs-property">originalLocation</span>.<span class="hljs-property">altitude</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">15</span>) + <span class="hljs-string">','</span> +</li><li>  secureLocation.<span class="hljs-property">originalLocation</span>.<span class="hljs-property">accuracy</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">6</span>) + <span class="hljs-string">','</span> +</li><li>  secureLocation.<span class="hljs-property">originalLocation</span>.<span class="hljs-property">timestamp</span> + <span class="hljs-string">','</span> + secureLocation.<span class="hljs-property">userData</span>.<span class="hljs-title function_">toString</span>();</li><li><span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">const</span> originData = textEncoder.<span class="hljs-title function_">encodeInto</span>(originString);</li><li><span class="hljs-comment">// 获取签名结果</span></li><li><span class="hljs-keyword">const</span> base64Helper = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">Base64Helper</span>();</li><li><span class="hljs-keyword">const</span> signatureData = base64Helper.<span class="hljs-title function_">decodeSync</span>(secureLocation.<span class="hljs-property">signature</span>.<span class="hljs-title function_">toString</span>());</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1347163464110">验证签名<i class="anchor-icon anchor-icon-link" anchorid="section1347163464110" tips="复制节点链接"></i></h2>          <p>在安全摄像头场景和安全地理位置场景中，由于使用的是相同的证明密钥，因此签名验证的流程是一致的。结合“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-securecamera">安全摄像头场景</a>”和“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-securelocation">安全地理位置场景</a>”中获取到的原始数据和签名结果，验证签名的参考代码（不含异常处理逻辑，由开发者根据业务场景实现）如下：</p>     <ol>      <li id="li67510253287"><span>从匿名证书链中获取公钥。</span>       <p></p>       <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cert } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 以安全摄像头场景为例，忽略异常情况处理</span></li><li><span class="hljs-keyword">const</span> userData = <span class="hljs-string">"trusted_app_service_demo"</span>;</li><li><span class="hljs-keyword">const</span> deviceId = <span class="hljs-number">7483679320805398131</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">initProperties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_TYPE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestType</span>.<span class="hljs-property">ATTEST_TYPE_CAMERA</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_ID</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-title class_">BigInt</span>(deviceId)</li><li>  }</li><li>];</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">initOptions</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: initProperties</li><li>};</li><li><span class="hljs-keyword">const</span> returnResult = <span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">initializeAttestContext</span>(userData, initOptions);</li><li><span class="hljs-comment">// 解析匿名证书链数据，获取三级证书</span></li><li><span class="hljs-keyword">const</span> certChain = returnResult.<span class="hljs-property">certChains</span>;</li><li><span class="hljs-keyword">const</span> certList = certChain[<span class="hljs-number">0</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">'-----BEGIN CERTIFICATE-----'</span>);</li><li><span class="hljs-keyword">const</span> thirdCert = <span class="hljs-string">'-----BEGIN CERTIFICATE-----'</span> + certList[<span class="hljs-number">1</span>];</li><li><span class="hljs-comment">// 获取公钥</span></li><li><span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">encodingBlob</span>: cert.<span class="hljs-property">EncodingBlob</span> = {</li><li>  <span class="hljs-attr">data</span>: textEncoder.<span class="hljs-title function_">encodeInto</span>(thirdCert),</li><li>  <span class="hljs-attr">encodingFormat</span>: cert.<span class="hljs-property">EncodingFormat</span>.<span class="hljs-property">FORMAT_PEM</span></li><li>};</li><li><span class="hljs-keyword">const</span> x509Cert = <span class="hljs-keyword">await</span> cert.<span class="hljs-title function_">createX509Cert</span>(encodingBlob);</li><li><span class="hljs-keyword">const</span> asyKeyGenerator = cryptoFramework.<span class="hljs-title function_">createAsyKeyGenerator</span>(<span class="hljs-string">'ECC256'</span>);</li><li><span class="hljs-keyword">const</span> keyPair = asyKeyGenerator.<span class="hljs-title function_">convertKeySync</span>(x509Cert.<span class="hljs-title function_">getPublicKey</span>().<span class="hljs-title function_">getEncoded</span>(), <span class="hljs-literal">null</span>);</li><li><span class="hljs-keyword">const</span> pubKey = keyPair.<span class="hljs-property">pubKey</span>; <span class="hljs-comment">// 证书中的公钥需要转换成cryptoFramework能够接收的格式</span></li></ol></pre></div></div>       <p></p></li>      <li><span>创建非对称密钥类型为ECC256、摘要算法为SHA256的verify实例，并使用<a href="/consumer/cn/doc/harmonyos-guides/devicesecurity-taas-verifysignature#li67510253287">步骤1</a>中获取到的公钥进行初始化。</span>       <p></p>       <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> verifier = cryptoFramework.<span class="hljs-title function_">createVerify</span>(<span class="hljs-string">'ECC256|SHA256'</span>);</li><li>verifier.<span class="hljs-title function_">initSync</span>(pubKey);</li></ol></pre></div></div>       <p></p></li>      <li><span>使用原始数据和签名结果进行验证签名。</span>       <p></p>       <div _ngcontent-cxo-c106="" class="highlight-div"><div _ngcontent-cxo-c106="" class="highlight-div-header"><div _ngcontent-cxo-c106="" class="highlight-div-header-left"><div _ngcontent-cxo-c106="" class="handle-button expand-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cxo-c106="" class="highlight-div-header-right"><div _ngcontent-cxo-c106="" class="handle-button ai-button"></div><div _ngcontent-cxo-c106="" class="handle-button line-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cxo-c106="" class="handle-button theme-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cxo-c106="" class="handle-button copy-button"><div _ngcontent-cxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cxo-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> originData = ...; <span class="hljs-comment">// 请使用获取到的安全图像原始数据</span></li><li><span class="hljs-keyword">const</span> signatureData = ...; <span class="hljs-comment">// 请使用获取到的签名结果</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">inputData</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(originData)</li><li>};</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">signature</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(signatureData)</li><li>};</li><li><span class="hljs-comment">// 验证签名结果</span></li><li><span class="hljs-keyword">const</span> result = verifier.<span class="hljs-title function_">verifySync</span>(inputData, signature);</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>