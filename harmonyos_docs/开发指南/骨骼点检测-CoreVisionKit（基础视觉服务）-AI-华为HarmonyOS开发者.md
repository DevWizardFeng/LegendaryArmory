<h1 _ngcontent-juc-c119="" class="doc-title ng-star-inserted" title="骨骼点检测"> 骨骼点检测 </h1>

<div _ngcontent-juc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section2464538174711">适用场景<i class="anchor-icon anchor-icon-link" anchorid="section2464538174711" tips="复制节点链接"></i></h2><p>人体骨骼关键点检测，主要检测人体的一些关键点，通过关键点描述人体骨骼信息。具体应用主要集中在智能视频监控，病人监护系统，人机交互，虚拟现实，人体动画，智能家居，智能安防，运动员辅助训练等等。</p> <p>支持17个关键点的识别，具体为鼻子，左右眼，左右耳，左右肩，左右肘、左右手腕、左右髋、左右膝、左右脚踝。</p> <p>效果如下图所示：</p> <p><span><img originheight="661" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114227.21326997322652458297288634096031:50001231000000:2800:BC4D3B730B95BA61E37DB6F47673776149279114819C6A5CEA7302C1E84B3F29.png" width="320" height="661"></span></p> </div> <div class="tiledSection"><h2 id="section2020122517405">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2020122517405" tips="复制节点链接"></i></h2><p>该能力当前不支持模拟器。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="38.96%"><p>AI能力</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="61.040000000000006%"><p>约束</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="38.96%"><p>骨骼点检测</p> </td> <td class="cellrowborder" valign="top" width="61.040000000000006%"><ul><li>输入图像具有合适成像的质量（建议720p以上），<span style="color: rgb(55,65,81);">100px</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">高度</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">10000px，100px</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">宽度</span><span style="color: rgb(55,65,81);">&lt;</span><span style="color: rgb(55,65,81);">10000px</span>，高宽比例建议5:1以下（高度小于宽度的5倍），接近手机屏幕高宽比例为宜。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section11978122125012">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section11978122125012" tips="复制节点链接"></i></h2></div> <ol><li><span>在使用骨骼点检测时，将实现骨骼点检测相关的类添加至工程。</span><p></p><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { skeletonDetection, visionBase } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>简单配置页面的布局，并在Button组件添加点击事件，拉起图库，选择图片。</span><p></p><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'选择图片'</span>)</li><li>  .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>  .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>  .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 拉起图库，获取图片资源</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectImage</span>();</li><li>  })</li></ol></pre></div></div> <p></p></li><li><span>通过图库获取图片资源，将图片转换为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>。</span><p></p><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">selectImage</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">openPhoto</span>()</li><li>  <span class="hljs-keyword">if</span> (uri === <span class="hljs-literal">undefined</span>) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">"Failed to define uri."</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(uri)</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">openPhoto</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>    photoPicker.<span class="hljs-title function_">select</span>({</li><li>      <span class="hljs-title class_">MIMEType</span>: photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>, <span class="hljs-attr">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>    }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {</li><li>      <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>])</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Failed to get photo image uri. code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-title function_">reject</span>(<span class="hljs-string">''</span>)</li><li>    })</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(name, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>();</li><li>  }, <span class="hljs-number">100</span>)</li><li>}</li></ol></pre></div></div> <p></p></li><li><span>实例化Request对象，并传入待检测图片的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>，实现骨骼点检测功能。</span><p></p><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 调用骨骼点识别接口</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: visionBase.<span class="hljs-property">Request</span> = {</li><li>  <span class="hljs-attr">inputData</span>: { <span class="hljs-attr">pixelMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> }</li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: skeletonDetection.<span class="hljs-property">SkeletonDetectionResponse</span> = <span class="hljs-keyword">await</span> (<span class="hljs-keyword">await</span> skeletonDetection.<span class="hljs-property">SkeletonDetector</span>.<span class="hljs-title function_">create</span>()).<span class="hljs-title function_">process</span>(request);</li></ol></pre></div></div> <p></p></li><li><span><span style="color: rgb(55,65,81);">（可选）如果需要将结果展示在界面上，可以用下列代码。</span></span><p></p><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: skeletonDetection.<span class="hljs-property">SkeletonDetectionResponse</span> = <span class="hljs-keyword">await</span> (<span class="hljs-keyword">await</span> skeletonDetection.<span class="hljs-property">SkeletonDetector</span>.<span class="hljs-title function_">create</span>()).<span class="hljs-title function_">process</span>(request);</li><li><span class="hljs-keyword">let</span> poseJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Succeeded in skeleton detection: <span class="hljs-subst">${poseJson}</span>`</span>);</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = poseJson;</li></ol></pre></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section1564831315485">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section1564831315485" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section5718142912110" class="firsth2">Index.ets<i class="anchor-icon anchor-icon-link" anchorid="section5718142912110" tips="复制节点链接"></i></h3><div _ngcontent-juc-c106="" class="highlight-div"><div _ngcontent-juc-c106="" class="highlight-div-header"><div _ngcontent-juc-c106="" class="highlight-div-header-left"><div _ngcontent-juc-c106="" class="handle-button expand-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-juc-c106="" class="highlight-div-header-right"><div _ngcontent-juc-c106="" class="handle-button ai-button"></div><div _ngcontent-juc-c106="" class="handle-button line-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-juc-c106="" class="handle-button theme-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-juc-c106="" class="handle-button copy-button"><div _ngcontent-juc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-juc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { skeletonDetection, visionBase } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">chooseImage</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">dataValues</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span>)</li><li>        .<span class="hljs-title function_">copyOption</span>(<span class="hljs-title class_">CopyOptions</span>.<span class="hljs-property">LocalDevice</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'60%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'选择图片'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 拉起图库</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectImage</span>()</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'开始骨骼点识别'</span>)</li><li>        .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span>) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Failed to choose image.`</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-comment">// 调用骨骼点识别接口</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: visionBase.<span class="hljs-property">Request</span> = {</li><li>            <span class="hljs-attr">inputData</span>: { <span class="hljs-attr">pixelMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> }</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: skeletonDetection.<span class="hljs-property">SkeletonDetectionResponse</span> =</li><li>              <span class="hljs-keyword">await</span> (<span class="hljs-keyword">await</span> skeletonDetection.<span class="hljs-property">SkeletonDetector</span>.<span class="hljs-title function_">create</span>()).<span class="hljs-title function_">process</span>(request);</li><li>            <span class="hljs-keyword">let</span> poseJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Succeeded in skeleton detection: <span class="hljs-subst">${poseJson}</span>`</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataValues</span> = poseJson;</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Failed to get result. Error: <span class="hljs-subst">${error}</span>`</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">selectImage</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">openPhoto</span>()</li><li>    <span class="hljs-keyword">if</span> (uri === <span class="hljs-literal">undefined</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">"Failed to define uri."</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(uri)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">openPhoto</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>      photoPicker.<span class="hljs-title function_">select</span>({</li><li>        <span class="hljs-title class_">MIMEType</span>: photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>, <span class="hljs-attr">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>      }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {</li><li>        <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>])</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Failed to get photo image uri. code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-title function_">reject</span>(<span class="hljs-string">''</span>)</li><li>      })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(name, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">chooseImage</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>();</li><li>        <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">close</span>(fileSource);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'skeletonDetectSample'</span>, <span class="hljs-string">`Failed to open file. Error: <span class="hljs-subst">${error}</span>`</span>);</li><li>      }</li><li>    }, <span class="hljs-number">100</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>