<h1 _ngcontent-pnc-c119="" class="doc-title ng-star-inserted" title="黑盒覆盖率测试"> 黑盒覆盖率测试 </h1>

<div _ngcontent-pnc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001909226929"><p id="ZH-CN_TOPIC_0000002478334358__p3775124013912">DevEco Studio支持黑盒覆盖率测试，不需要开发测试用例，将编译插桩的HAP包推到设备上，然后对该应用/元服务模拟用户操作，测试完成后可生成覆盖率报告，当前仅支持Stage模型。</p> <div class="tiledSection"><h2 id="section7252565917">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section7252565917" tips="复制节点链接"></i></h2><ul id="ZH-CN_TOPIC_0000002478334358__ul156860445183"><li id="li136861844171818">DevEco Studio 6.0.1 Beta1版本前，仅支持对UIAbility进行覆盖率测试。</li><li id="li19458194211208">从DevEco Studio 6.0.1 Beta1版本开始，当继承的ExtensionAbility中存在onDump或onDestroy方法时，支持获取覆盖率数据。如果两个方法都不存在，则无法进行覆盖率测试。</li></ul> </div> <div class="tiledSection"><h2 id="section531471517617">前置操作<i class="anchor-icon anchor-icon-link" anchorid="section531471517617" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478334358__p1631416155610">将设备与电脑进行连接，并对应用/元服务签名，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-device">使用本地真机运行应用</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing">应用/元服务签名</a>。</p> </div> <div class="tiledSection"><h2 id="section13756446154">配置覆盖率过滤文件<i class="anchor-icon anchor-icon-link" anchorid="section13756446154" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478334358__p18842419369">如果开发者希望只针对部分文件进行覆盖率测试，可在工程目录下创建coverage-filter.json5文件，在文件中配置参与或不参与覆盖率统计的文件/文件夹。DevEco Studio编译插桩时将按照coverage-filter.json5文件中的配置进行过滤。</p> <p id="ZH-CN_TOPIC_0000002478334358__p15642135118536">该功能从DevEco Studio 5.1.0 Release版本开始支持。</p> <p id="ZH-CN_TOPIC_0000002478334358__p9501165104717"><span><img originheight="319" originwidth="315" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104837.98347945311936612521217269580897:50001231000000:2800:3C2F0420F7E875C1D6C0E12697A78B775CC3950D96AF76D47F2F090F7FF3220B.png" width="315" height="319"></span></p> <p id="ZH-CN_TOPIC_0000002478334358__p104181919614">coverage-filter.json5文件包含以下参数。</p>  <div class="tablenoborder"><div class="tbBox"><table id="table178312181667" class="layoutFixed idpTab"><caption><b>表1 </b></caption><thead><tr id="ZH-CN_TOPIC_0000002478334358__row7841318066"><th align="left" class="cellrowborder" id="mcps1.3.4.6.2.5.1.1" valign="top" width="20.1%"><p id="ZH-CN_TOPIC_0000002478334358__p88412188618">参数</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.2.5.1.2" valign="top" width="19.13%"><p id="ZH-CN_TOPIC_0000002478334358__p1084151817614">是否必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.2.5.1.3" valign="top" width="19.88%"><p id="ZH-CN_TOPIC_0000002478334358__p158411814612">类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.2.5.1.4" valign="top" width="40.89%"><p id="ZH-CN_TOPIC_0000002478334358__p128420185616">说明</p> </th> </tr> </thead> <tbody><tr id="ZH-CN_TOPIC_0000002478334358__row198410181663"><td class="cellrowborder" valign="top" width="20.1%"><p id="ZH-CN_TOPIC_0000002478334358__p284101816611">include</p> </td> <td class="cellrowborder" valign="top" width="19.13%"><p id="ZH-CN_TOPIC_0000002478334358__p17842181766">否</p> </td> <td class="cellrowborder" valign="top" width="19.88%"><p id="ZH-CN_TOPIC_0000002478334358__p15854141151013">字符串数组</p> </td> <td class="cellrowborder" valign="top" width="40.89%"><p id="ZH-CN_TOPIC_0000002478334358__p5845182614">配置参与覆盖率统计的文件或文件夹路径，仅支持模块名开头的绝对路径，暂不支持通配符。include的优先级比exclude高。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478334358__row1992005915810"><td class="cellrowborder" valign="top" width="20.1%"><p id="ZH-CN_TOPIC_0000002478334358__p892114599814">exclude</p> </td> <td class="cellrowborder" valign="top" width="19.13%"><p id="ZH-CN_TOPIC_0000002478334358__p292118591381">否</p> </td> <td class="cellrowborder" valign="top" width="19.88%"><p id="ZH-CN_TOPIC_0000002478334358__p136521053101018">字符串数组</p> </td> <td class="cellrowborder" valign="top" width="40.89%"><p id="ZH-CN_TOPIC_0000002478334358__p99211659982">配置不参与覆盖率统计的文件或文件夹路径，仅支持模块名开头的绝对路径，暂不支持通配符。</p> </td> </tr>  </tbody></table></div> </div> <div class="p" id="ZH-CN_TOPIC_0000002478334358__p1421395013463">示例如下：<div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" id="ZH-CN_TOPIC_0000002478334358__screen17616133016112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class=""><span class="hljs-attr">"include"</span></span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>    <span class="hljs-comment">// 配置参与覆盖率统计的文件或文件夹路径，仅支持模块名开头的绝对路径，暂不支持通配符</span></li><li>    <span class=""><span class="hljs-string">"entry/src/main/ets/pages/aaa.ets"</span></span></li><li>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>  <span class=""><span class="hljs-attr">"exclude"</span></span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>    <span class="hljs-comment">// 配置不参与覆盖率统计的文件或文件夹路径，仅支持模块名开头的绝对路径，暂不支持通配符</span></li><li>    <span class=""><span class="hljs-string">"entry/src/main/ets/pages"</span></span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p5117171512179">修改配置文件后不会触发增量编译，需要重新编译插桩再测试。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section147001619174611">执行覆盖率测试<i class="anchor-icon anchor-icon-link" anchorid="section147001619174611" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002478334358__ol163781001019"><li id="li15441012153518"><span>执行hvigor插桩编译命令，编译后在{projectPath}/{moduleName}/.test/default/intermediates/ohosTest路径下会生成init_coverage.json文件，供后续生成覆盖率报告使用。</span><p></p><div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" id="ZH-CN_TOPIC_0000002478334358__screen53121621195410" data-highlighted="yes"><ol class="linenums"><li>hvigorw --mode <span class="hljs-keyword">module</span> -p <span class="hljs-keyword">module</span>={moduleName<span class="hljs-meta">@targetName</span>} -p product={productName} -p buildMode=test -p ohos-test-coverage=<span class="hljs-literal">true</span> -p coverage-mode=black assembleHap --parallel --incremental --daemon</li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul14441312113517"><li id="li16312121155411">moduleName：执行测试的模块。</li><li id="li13441111219355">targetName/productName：当前生效的target/product，可以通过点击DevEco Studio右上方<span><img originheight="14" originwidth="15" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104837.87607594733706918864039018389011:50001231000000:2800:E70C2DA1825BDF84E0597105554105D189673A6DE3A70783B4E6714DD80A5A01.png" class="IconPic notEnlarge" width="15" height="14"></span>图标进行查看。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p13159632141615">如果HAP依赖HSP，需要单独编译HSP，将以上命令的assembleHap替换为assembleHsp即可。</p> </div></div></div> <p></p></li><li id="li15378503012"><span>如果设备上已存在待测试的应用，先卸载应用，不存在则跳过此步骤，关于hdc工具的使用指导请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc" target="_blank">hdc</a>。</span><p></p><div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478334358__screen1838117191320" data-highlighted="yes"><ol class="linenums"><li>hdc uninstall {bundleName}</li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul8328232191014"><li id="li132811320107">bundleName：设备上已安装的应用包名。</li></ul> <p></p></li><li id="li3378709011"><span>将插桩编译生成的HAP包安装到设备上，如果依赖HSP，需要同时安装HSP。</span><p></p><div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002478334358__screen148481938647" data-highlighted="yes"><ol class="linenums"><li>hdc install {SignedHapPath}</li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul14557205618619"><li id="li175579563611">SignedHapPath：已签名的HAP包路径，默认在模块的build\{productName}\outputs\{targetName}目录下。</li></ul> <p></p></li><li id="li173781206015"><span>在设备上模拟用户操作，进行黑盒测试，测试完毕后，通过以下方式，生成覆盖率数据。</span><p></p><ul id="ZH-CN_TOPIC_0000002478334358__ul205911126780"><li id="li159120262813">针对UIAbility和存在onDump方法的ExtensionAbility，执行命令生成覆盖率数据。UIAbility从DevEco Studio 5.1.0 Release版本开始支持，ExtensionAbility从DevEco Studio 6.0.1 Beta1版本开始支持。<div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" id="ZH-CN_TOPIC_0000002478334358__screen1516864717814" data-highlighted="yes"><ol class="linenums"><li>hdc shell aa <span class="hljs-built_in">dump</span> -c -l</li></ol></pre></div></div> </li><li id="li20168347288">针对UIAbility，退出应用，触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-lifecycle#ondestroy" target="_blank">onDestroy()回调</a>，生成覆盖率数据。</li><li id="li138871954183113">针对存在onDestroy方法的ExtensionAbility，Ability销毁时，触发onDestroy()回调，生成覆盖率数据。从DevEco Studio 6.0.1 Beta1版本开始支持。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p665047153911">从API 13开始，如果用户使用最近任务列表一键清理来关闭应用，将不会执行onDestroy()回调，导致获取不到覆盖率数据。</p> </div></div></div> <p></p></li><li id="li83789016016"><span>从设备上取出覆盖率数据json文件存放到电脑本地，该命令会将cache目录下的所有文件都保存到LocalPath目录下。</span><p></p><div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-swift" id="ZH-CN_TOPIC_0000002478334358__screen11001510131810" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 如果是应用则执行该命令，其中LocalPath非必填，如果不填写，默认存放在当前执行命令的目录</span></li><li>hdc file recv data<span class="hljs-regexp">/app/</span>el2<span class="hljs-regexp">/100/</span>base<span class="hljs-regexp">/{bundleName}/</span>haps<span class="hljs-regexp">/{moduleName}/</span>cache {<span class="hljs-type">LocalPath</span>}</li><li><span class="hljs-comment">// 如果是元服务则执行该命令，其中LocalPath必填</span></li><li>hdc file recv <span class="hljs-operator">-</span>b {bundleName} ls <span class="hljs-operator">./</span>data<span class="hljs-regexp">/storage/</span>el2<span class="hljs-regexp">/base/</span>haps<span class="hljs-regexp">/{moduleName}/</span>cache {<span class="hljs-type">LocalPath</span>}</li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul14216102642012"><li id="li6217326182013">LocalPath：数据在电脑本地存放的路径。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p2456241141">在多模块相互跳转的场景下，只需要取最后退出的模块下生成的覆盖率数据json文件，但特殊场景下如多模块无跳转关系，则需要取每个独立模块下生成的覆盖率数据json文件。</p> </div></div></div> <p></p></li><li id="li33781509020"><span>生成覆盖率报告：</span><p></p><div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478334358__screen0241163452213" data-highlighted="yes"><ol class="linenums"><li>hvigorw collectCoverage -p projectPath={projectPath} -p reportPath={reportPath} -p coverageFile={projectPath}/{moduleName}/.test/default/intermediates/ohosTest/init_coverage.json<span class="hljs-comment">#{LocalPath/bjc_cov_yyyyMMdd_HHmmss_SSS.json}</span></li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul661234932212"><li id="li1761284902218">projectPath：工程路径。</li><li id="li7562160122319">reportPath：指定的覆盖率报告文件生成路径。</li><li id="li66627114232">bjc_cov_yyyyMMdd_HHmmss_SSS.json：指定上一个步骤LocalPath目录下的一份最新的json文件，格式以bjc_cov开头，yyyyMMdd_HHmmss_SSS表示年月日_时分秒_毫秒。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p188745716239">在多模块相互跳转的场景下，需要取各模块的init_coverage.json文件路径，与bjc_cov_yyyyMMdd_HHmmss_SSS.json文件通过#拼接生成coverageFile参数。</p> </div></div></div> <p></p></li><li id="li15842124005816"><span>在本地找到报告文件路径并在浏览器中打开，查看代码覆盖率详情，关于覆盖率的计算方式请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-ui-test#section10394362109">查看覆盖率报告</a>。</span><p></p><p id="ZH-CN_TOPIC_0000002478334358__p15842840125819"><span><img originheight="463" originwidth="1775" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104837.76839393491662237559844887755035:50001231000000:2800:CA3A9545095DF4CCD7DE38BEEB38621A9786B7B84867EB748E27222BF2D3DA00.png" width="920" height="239.9774647887324"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section10394362109">查看覆盖率报告<i class="anchor-icon anchor-icon-link" anchorid="section10394362109" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478334358__p26433218108">测试覆盖率报告有三个测量维度，分别是：</p> <ul id="ZH-CN_TOPIC_0000002478334358__ul1083211201378"><li id="li139341517910">函数覆盖率（Functions）：每个函数是否都已调用。</li><li id="li8686109151310">分支覆盖率（Branches）：每个流程控制的各个分支是否都已执行。</li></ul> <ul id="ZH-CN_TOPIC_0000002478334358__ul1081213391217"><li id="li1081218351213">行覆盖率（Lines）：每个可执行代码行是否都已执行。</li></ul> <p id="ZH-CN_TOPIC_0000002478334358__p39561553154914"><span><img originheight="463" originwidth="1775" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104837.60764218416563540689324932147256:50001231000000:2800:A99EF3E8C5D8209D695CFFCEA8E6C49B15C4AD9D46CDAF9C69919C83CD885E47.png" width="920" height="239.9774647887324"></span></p> <p id="ZH-CN_TOPIC_0000002478334358__p592618712209">以下是关于三个测量维度的细节说明：</p> <ul id="ZH-CN_TOPIC_0000002478334358__ul179424571271"><li id="li144201001415"><strong>流程控制</strong><p id="ZH-CN_TOPIC_0000002478334358__p623003784215">常见的流程控制语句有if、while、do...while、switch、for等等，以及三目运算符（condition ? exprIfTrue : exprIfFalse），需要确保流程控制的每个边界情况（即分支）都被执行。</p> </li></ul> <ul id="ZH-CN_TOPIC_0000002478334358__ul1312143316217"><li id="li11263332115"><strong>行（Lines of Source Code） vs 可执行代码行（Lines of Executable Code）</strong><ul id="ZH-CN_TOPIC_0000002478334358__ul28248104224"><li id="li1631117106226">“行覆盖率”中的行是指可执行代码行（Lines of Executable Code），而不是源文件中所有的行（含空行）（Lines of Source Code）。一般来说，包含语句的每一行都应被视为可执行行。</li><li id="li162582963112">对于DevEco Studio的覆盖率测试引擎来说，只会统计方法内的语句，方法外的语句都不会被统计覆盖率。<ul id="ZH-CN_TOPIC_0000002478334358__ul117781405544"><li id="li197781740155416">方法内，如果某行存在可执行代码，则这一整行会被视为可执行代码行（+1）。</li><li id="li1283415416227">方法内，如果某行只包含标点符号<strong>{</strong>，会被视为可执行行（+1）。</li><li id="li177781409543">方法内，如果某行只包含标点符号<strong>}</strong>、<strong>}) </strong>或<strong> </strong><strong>});</strong> ，会被视为非可执行行（+0）。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p831692571312">箭头函数在方法内时，可以正常统计覆盖率，如果作为参数声明，则无法统计该行覆盖率。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002478334358__p67781040175410">示例如下：</p> <div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478334358__screen187791740105414" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;  <span class="hljs-comment">// +0  方法外不统计</span></li><li><span class="hljs-keyword">let</span> filePath :<span class="hljs-built_in">string</span>;               <span class="hljs-comment">// +0  方法外不统计</span></li><li><span class="hljs-keyword">const</span> fileName = <span class="hljs-string">'a.txt'</span>;          <span class="hljs-comment">// +0  方法外不统计</span></li><li> </li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doTheThing</span> ()  <span class="hljs-comment">// +1</span></li><li>{                              <span class="hljs-comment">// +1</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">s1</span>: <span class="hljs-built_in">string</span>;              <span class="hljs-comment">// +1</span></li><li>  <span class="hljs-keyword">const</span> str = <span class="hljs-string">'aaa'</span>;           <span class="hljs-comment">// +1</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str);            <span class="hljs-comment">// +1</span></li><li>}                              <span class="hljs-comment">// +0</span></li><li> </li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {         <span class="hljs-comment">// +0  方法外不统计</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>           <span class="hljs-comment">// +0  方法外不统计</span></li><li>  <span class="hljs-title function_">constructor</span> (<span class="hljs-attr">n</span>:<span class="hljs-built_in">string</span>) {    <span class="hljs-comment">// +1 构造函数</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = n;            <span class="hljs-comment">// +1</span></li><li>  }                           <span class="hljs-comment">// +0</span></li><li> </li><li>  <span class="hljs-keyword">static</span> sayHello () {        <span class="hljs-comment">// +1  类静态方法</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello'</span>);     <span class="hljs-comment">// +1</span></li><li>  }                           <span class="hljs-comment">// +0</span></li><li> </li><li>  walk () {                   <span class="hljs-comment">// +1  类实例方法</span></li><li>    <span class="hljs-keyword">for</span> (                     <span class="hljs-comment">// +1              </span></li><li>      <span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;                <span class="hljs-comment">// +1</span></li><li>      i &lt; <span class="hljs-number">10</span>;                 <span class="hljs-comment">// +1</span></li><li>      i++)                    <span class="hljs-comment">// +1</span></li><li>    {                         <span class="hljs-comment">// +1</span></li><li>    }                         <span class="hljs-comment">// +0</span></li><li>  }                           <span class="hljs-comment">// +0</span></li><li>}                             <span class="hljs-comment">// +0</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span> ():<span class="hljs-built_in">object</span> {    <span class="hljs-comment">// +1</span></li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>({        <span class="hljs-comment">// +1      一个语句被拆分为多行</span></li><li>    <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,                <span class="hljs-comment">// +1</span></li><li>    <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,                <span class="hljs-comment">// +1</span></li><li>  })                     <span class="hljs-comment">// +0</span></li><li>}                        <span class="hljs-comment">// +0</span></li><li> </li><li><span class="hljs-title function_">func</span>();                  <span class="hljs-comment">// +0  方法外不统计</span></li><li> </li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">n:<span class="hljs-built_in">number</span>, m:<span class="hljs-built_in">number</span></span>){}   <span class="hljs-comment">// +1</span></li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"></span>):<span class="hljs-built_in">number</span> {              <span class="hljs-comment">// +1</span></li><li>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;                          <span class="hljs-comment">// +1</span></li><li>}</li><li>
</li><li><span class="hljs-title function_">foo</span>(<span class="hljs-number">1</span>, <span class="hljs-title function_">bar</span>());                       <span class="hljs-comment">// +0  方法外不统计</span></li></ol></pre></div></div> </li></ul> </li><li id="li672045412282">测试覆盖率报告左侧的标识：<ul id="ZH-CN_TOPIC_0000002478334358__ul3350145542813"><li id="li82251954194115">灰色：不统计覆盖率。</li><li id="li12398121613423">粉色：语句/函数未覆盖。</li><li id="li15912616423">绿色：语句/函数覆盖。</li><li id="li73505554284">Nx：表示当前可执行代码行被执行了N次。<p id="ZH-CN_TOPIC_0000002478334358__p237712492387"><span><img originheight="719" originwidth="558" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104838.13997599495433537616378501709600:50001231000000:2800:A46F5970BB9EEA52124486195786002BB748769471CE0DDE9C61C44BC3EF3B38.png" width="558" height="719"></span></p> </li></ul> </li><li id="li14227163418472"><strong>通过注释语法忽略指定代码</strong><p id="ZH-CN_TOPIC_0000002478334358__p0942144018292">代码中的某些分支可能很难、甚至无法测试，DevEco Studio提供了instrument ignore * 语法来进行忽略，使得某些代码不计入覆盖率。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334358__p49631511162718">使用时需先清除缓存，点击菜单栏<strong>Build -&gt; Clean Project</strong>。</p> </div></div></div> <ul id="ZH-CN_TOPIC_0000002478334358__ul294264032918"><li id="li994224022918"><strong>忽略文件：</strong>在源文件中加入注释 // instrument ignore file或者 /* instrument ignore file */，加入注释后，该文件不再插桩，覆盖率报告也不会有该文件。</li><li id="li4942144012292"><strong>忽略代码块、class、function等：</strong>在代码块前加入/* instrument ignore next */或者// instrument ignore next即可忽略。</li><li id="li159420407297"><strong>忽略if/else分支：</strong>在条件表达式前加上// instrument ignore if或者/* instrument ignore  if*/（忽略if），// instrument ignore else或者/* instrument ignore  else*/（忽略else）。</li></ul> <div _ngcontent-pnc-c106="" class="highlight-div"><div _ngcontent-pnc-c106="" class="highlight-div-header"><div _ngcontent-pnc-c106="" class="highlight-div-header-left"><div _ngcontent-pnc-c106="" class="handle-button expand-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pnc-c106="" class="highlight-div-header-right"><div _ngcontent-pnc-c106="" class="handle-button ai-button"></div><div _ngcontent-pnc-c106="" class="handle-button line-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pnc-c106="" class="handle-button theme-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pnc-c106="" class="handle-button copy-button"><div _ngcontent-pnc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pnc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478334358__screen129431340122917" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {testA} <span class="hljs-keyword">from</span> <span class="hljs-string">'./Index'</span></li><li><span class="hljs-comment">// instrument ignore file       忽略整个文件</span></li><li>
</li><li><span class="hljs-comment">// instrument ignore next       忽略代码块</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a:<span class="hljs-built_in">number</span>,b:<span class="hljs-built_in">number</span></span>){</li><li>  <span class="hljs-keyword">return</span> a+b;</li><li>}</li><li><span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);</li><li> </li><li><span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;</li><li><span class="hljs-comment">// instrument ignore else       忽略else分支</span></li><li><span class="hljs-keyword">if</span> (a!=<span class="hljs-number">1</span>) {</li><li>  <span class="hljs-comment">// do something</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'BBB'</span>);</li><li>}<span class="hljs-keyword">else</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'AAA'</span>);</li><li>}</li><li> </li><li><span class="hljs-comment">// instrument ignore if         忽略if分支</span></li><li><span class="hljs-keyword">if</span> (a==<span class="hljs-number">1</span>) {</li><li>  <span class="hljs-comment">// do something</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'BBB'</span>);</li><li>}<span class="hljs-keyword">else</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'AAA'</span>);</li><li>}</li></ol></pre></div></div> </li></ul> </div> </div> <div></div></div>