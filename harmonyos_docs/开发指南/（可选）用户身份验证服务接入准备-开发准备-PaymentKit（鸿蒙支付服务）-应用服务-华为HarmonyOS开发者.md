<h1 _ngcontent-mdc-c119="" class="doc-title ng-star-inserted" title="（可选）用户身份验证服务接入准备"> （可选）用户身份验证服务接入准备 </h1>

<div _ngcontent-mdc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>如不涉及身份验证服务接入，可跳过该章节。</p>    <div class="tiledSection">     <h2 id="section11591427192013">开启用户身份验证服务权限开关<i class="anchor-icon anchor-icon-link" anchorid="section11591427192013" tips="复制节点链接"></i></h2>          <p>开发者可登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“项目设置 &gt; 开放能力管理”的“鸿蒙支付服务”中开启身份验证服务相关权限开关。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开启身份验证服务相关权限开关时，开发者需签署一份“开发者协议”，开发者同意协议并提交申请资料后需要等待审核（审核周期一般在1-3个工作日）通过后才能使用相关服务。</p>      </div></div></div>     <p><span><img height="194.5544444444444" originheight="398" originwidth="1882" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114638.08782586582180398195586821214539:50001231000000:2800:A07BBE28EE42C51EB07911B7B02C3F573BB336682FFA7B5171C52ECFB8F83552.png" title="点击放大" width="920"></span></p>    </div>    <div class="tiledSection">     <h2 id="section275114519198">上传开发者公钥及下载华为公钥<i class="anchor-icon anchor-icon-link" anchorid="section275114519198" tips="复制节点链接"></i></h2>          <p>开发者可登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“鸿蒙支付服务 &gt; 身份验证服务”菜单中的“公钥管理”页签下完成开发者证书的上传以及华为公钥证书下载。</p>     <p><span><img height="402.9344444444444" originheight="873" originwidth="2001" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114638.01781734101336474423701214296895:50001231000000:2800:BB0DCA77F09753B1EDCE25E6BADBF888AAC5FD87B1AC2B1DCAC39832305FB795.png" title="点击放大" width="920"></span></p>     <p>证书使用如图所示：</p>     <p><span><img height="957.6" originheight="3840" originwidth="2028" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114638.99670748931887677202131568390262:50001231000000:2800:005875FF578796E28E96FFBCA95C25BFE0DCC22052D7A2D125B4DF5792FDB917.png" title="点击放大" width="505.7724"></span></p>     <p>证书说明如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.7.1.4.1.1" valign="top" width="14.729999999999999%">          <p>证书</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.7.1.4.1.2" valign="top" width="20.669999999999998%">          <p>获取方式</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.7.1.4.1.3" valign="top" width="64.60000000000001%">          <p>内容说明及使用场景</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="14.729999999999999%">          <p><strong>华为加密公钥</strong></p></td>         <td class="cellrowborder" valign="top" width="20.669999999999998%">          <p><a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>的“鸿蒙支付服务&gt;身份验证服务&gt;公钥管理”下载</p></td>         <td class="cellrowborder" valign="top" width="64.60000000000001%">          <p>华为支付服务器使用SM2加密算法生成的证书公钥。</p>          <p><strong>使用场景：</strong>开发者可用对应的公钥证书对请求开放API接口的隐私字段进行加密，华为支付服务器使用配对的私钥证书对隐私字段进行解密。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="14.729999999999999%">          <p><strong>华为签名公钥</strong></p></td>         <td class="cellrowborder" valign="top" width="20.669999999999998%">          <p><a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>的“鸿蒙支付服务&gt;身份验证服务&gt;公钥管理”下载</p></td>         <td class="cellrowborder" valign="top" width="64.60000000000001%">          <p>华为支付服务器使用SM2加密算法生成的证书公钥。</p>          <p><strong>使用场景：</strong>华为支付服务器使用配对的私钥证书对响应报文进行加签， 开发者用于对开放API接口响应报文验签使用，具体验签方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-rest-overview#section17670192215175" target="_blank">验签规则</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="14.729999999999999%">          <p><strong>开发者公钥</strong>（<strong>加密</strong>）</p></td>         <td class="cellrowborder" valign="top" width="20.669999999999998%">          <p>开发者生成</p></td>         <td class="cellrowborder" valign="top" width="64.60000000000001%">          <p>开发者使用SM2加密算法生成的证书公钥。需登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“鸿蒙支付服务&gt;身份验证服务&gt;公钥管理”上传（公钥类型为加密）。</p>          <p><strong>使用场景：</strong>开发者上传后生成证书Id（developerEncKeyId），开发者请求开放API接口时可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1552810310615" target="_blank">PayDevAuth</a>请求头传递，指定给华为支付服务器用于对开放API接口响应的隐私字段加密。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="14.729999999999999%">          <p><strong>开发者公钥</strong><strong>（签名）</strong></p></td>         <td class="cellrowborder" valign="top" width="20.669999999999998%">          <p>开发者生成</p></td>         <td class="cellrowborder" valign="top" width="64.60000000000001%">          <p>开发者使用SM2加密算法生成的证书公钥。需登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“鸿蒙支付服务&gt;身份验证服务&gt;公钥管理”上传（公钥类型为签名）。</p>          <p><strong>使用场景：</strong>开发者上传后生成证书Id（developerSignKeyId），开发者请求开放API接口时可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section1552810310615" target="_blank">PayDevAuth</a>请求头传递，指定给华为支付服务器用于对开放API接口请求报文进行验签。</p></td>        </tr>             </tbody></table></div>     </div>     <ul>      <li>SM2公私钥对生成示例代码参考如下：</li>     </ul>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>只支持ASN.1格式的SM2公私钥对（以下示例代码为服务端生成示例）。如需在应用端生成ASN.1格式SM2公私钥对（公钥91字节，私钥51字节）可参考：         <ol>          <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-asym-key-pair-randomly" target="_blank">随机生成非对称密钥对(ArkTS)</a>（应用端生成的公私钥对可能无法在服务端使用）。</li>          <li>参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-cross-platform-compatibility#section1152116421582" target="_blank">数据编码格式差异</a>将生成的秘钥对转成16进制hex格式。</li>         </ol></li>        <li>生成的SM2公私钥对，还请先自测验证加解密是否正常，正常后再正式对外使用，避免生成错误的公私钥对，阻塞后续业务进度。</li>       </ul>      </div></div></div>     <div _ngcontent-mdc-c106="" class="highlight-div"><div _ngcontent-mdc-c106="" class="highlight-div-header"><div _ngcontent-mdc-c106="" class="highlight-div-header-left"><div _ngcontent-mdc-c106="" class="handle-button expand-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mdc-c106="" class="highlight-div-header-right"><div _ngcontent-mdc-c106="" class="handle-button ai-button"></div><div _ngcontent-mdc-c106="" class="handle-button line-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mdc-c106="" class="handle-button theme-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mdc-c106="" class="handle-button copy-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mdc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.util.encoders.Hex;</li><li><span class="hljs-keyword">import</span> org.junit.Test;</li><li><span class="hljs-keyword">import</span> java.security.KeyPair;</li><li><span class="hljs-keyword">import</span> java.security.KeyPairGenerator;</li><li><span class="hljs-keyword">import</span> java.security.SecureRandom;</li><li><span class="hljs-keyword">import</span> java.security.spec.ECGenParameterSpec;</li><li><span class="hljs-keyword">import</span> java.util.HashMap;</li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenerateSm2KeyPairTest2</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// 获取sm2公私钥</span></li><li>            <span class="hljs-type">String</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> getSm2SecretKey();</li><li>            <span class="hljs-comment">// 可打印生成公私钥信息，例如：log.info(jsonObject);</span></li><li>        } <span class="hljs-keyword">catch</span> (Exception e) {</li><li>            e.printStackTrace();</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * 生成SM2的ASN.1格式的公私钥</span></li><li><span class="hljs-comment">     *</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> SM2的ASN.1格式的公私钥</span></li><li><span class="hljs-comment">     */</span></li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSm2SecretKey</span><span class="hljs-params">()</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> generateSm2KeyPair();</li><li>            <span class="hljs-type">String</span> <span class="hljs-variable">privateKeyStr</span> <span class="hljs-operator">=</span> Hex.toHexString(keyPair.getPrivate().getEncoded());</li><li>            <span class="hljs-type">String</span> <span class="hljs-variable">publicKeyStr</span> <span class="hljs-operator">=</span> Hex.toHexString(keyPair.getPublic().getEncoded());</li><li>            HashMap&lt;String, String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>            result.put(<span class="hljs-string">"Sm2PrivateKey"</span>, privateKeyStr);</li><li>            result.put(<span class="hljs-string">"Sm2PublicKey"</span>, publicKeyStr);</li><li>            <span class="hljs-keyword">return</span> result.toString();</li><li>        } <span class="hljs-keyword">catch</span> (Exception e) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">     * SM2算法生成ASN.1格式的公私钥对</span></li><li><span class="hljs-comment">     *</span></li><li><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 密钥对信息</span></li><li><span class="hljs-comment">     */</span></li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> KeyPair <span class="hljs-title function_">generateSm2KeyPair</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">final</span> <span class="hljs-type">ECGenParameterSpec</span> <span class="hljs-variable">sm2Spec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ECGenParameterSpec</span>(<span class="hljs-string">"sm2p256v1"</span>);</li><li>            <span class="hljs-comment">// 获取一个椭圆曲线类型的密钥对生成器</span></li><li>            <span class="hljs-keyword">final</span> <span class="hljs-type">KeyPairGenerator</span> <span class="hljs-variable">kpg</span> <span class="hljs-operator">=</span> KeyPairGenerator.getInstance(<span class="hljs-string">"EC"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BouncyCastleProvider</span>());</li><li>            <span class="hljs-type">SecureRandom</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandom</span>();</li><li>            <span class="hljs-comment">// 使用SM2的算法区域初始化密钥生成器</span></li><li>            kpg.initialize(sm2Spec, random);</li><li>            <span class="hljs-comment">// 获取密钥对</span></li><li>            <span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> kpg.generateKeyPair();</li><li>            <span class="hljs-keyword">return</span> keyPair;</li><li>        } <span class="hljs-keyword">catch</span> (Exception e) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"generateSm2KeyPair failed."</span>);</li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div>     <ul>      <li id="li1492418137419">SM2加密示例代码参考如下：</li>     </ul>     <div _ngcontent-mdc-c106="" class="highlight-div"><div _ngcontent-mdc-c106="" class="highlight-div-header"><div _ngcontent-mdc-c106="" class="highlight-div-header-left"><div _ngcontent-mdc-c106="" class="handle-button expand-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mdc-c106="" class="highlight-div-header-right"><div _ngcontent-mdc-c106="" class="handle-button ai-button"></div><div _ngcontent-mdc-c106="" class="handle-button line-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mdc-c106="" class="handle-button theme-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mdc-c106="" class="handle-button copy-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mdc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 加密</span></li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1ObjectIdentifier;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.gm.GMNamedCurves;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x509.AlgorithmIdentifier;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x509.SubjectPublicKeyInfo;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x9.X9ECParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x9.X9ObjectIdentifiers;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.engines.SM2Engine;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.params.ECDomainParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.params.ECPublicKeyParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.params.ParametersWithRandom;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.math.ec.ECPoint;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.util.encoders.Hex;</li><li><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;</li><li><span class="hljs-keyword">import</span> java.security.SecureRandom;</li><li>
</li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SM2EncTest</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</li><li>        encrypt(<span class="hljs-string">"16进制编码的SM2公钥"</span>, <span class="hljs-string">"待加密数据"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String pubKey, String data)</span> {</li><li>        <span class="hljs-type">SM2Engine</span> <span class="hljs-variable">sm2Engine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SM2Engine</span>(SM2Engine.Mode.C1C3C2);</li><li>        <span class="hljs-keyword">if</span> (data == <span class="hljs-literal">null</span> || data.isEmpty()) {</li><li>            <span class="hljs-keyword">return</span> data;</li><li>        }</li><li>        <span class="hljs-type">byte</span>[] in = data.getBytes(StandardCharsets.UTF_8);</li><li>        <span class="hljs-keyword">return</span> Hex.toHexString(encrypt(pubKey, in, sm2Engine));</li><li>    }</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] encrypt(String pubKey, <span class="hljs-type">byte</span>[] in, SM2Engine sm2Engine) {</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-type">byte</span>[] bPubKey = Hex.decode(pubKey);</li><li>            <span class="hljs-type">byte</span>[] coding = getCoding(bPubKey);</li><li>            <span class="hljs-type">X9ECParameters</span> <span class="hljs-variable">x9ECParameters</span> <span class="hljs-operator">=</span> GMNamedCurves.getByName(<span class="hljs-string">"sm2p256v1"</span>);</li><li>            <span class="hljs-type">ECDomainParameters</span> <span class="hljs-variable">ecDomainParameters</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ECDomainParameters</span>(x9ECParameters.getCurve(),</li><li>                x9ECParameters.getG(), x9ECParameters.getN());</li><li>            <span class="hljs-type">ECPoint</span> <span class="hljs-variable">pukPoint</span> <span class="hljs-operator">=</span> x9ECParameters.getCurve().decodePoint(coding);</li><li>            <span class="hljs-type">ECPublicKeyParameters</span> <span class="hljs-variable">publicKeyParameters</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ECPublicKeyParameters</span>(pukPoint, ecDomainParameters);</li><li>            sm2Engine.init(<span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParametersWithRandom</span>(publicKeyParameters, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandom</span>()));</li><li>            <span class="hljs-keyword">return</span> sm2Engine.processBlock(in, <span class="hljs-number">0</span>, in.length);</li><li>        } <span class="hljs-keyword">catch</span> (Exception var7) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(var7);</li><li>        }</li><li>    }</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getCoding(<span class="hljs-type">byte</span>[] publicKey) {</li><li>        <span class="hljs-keyword">if</span> (publicKey.length != <span class="hljs-number">64</span> &amp;&amp; publicKey.length != <span class="hljs-number">65</span>) {</li><li>            <span class="hljs-type">AlgorithmIdentifier</span> <span class="hljs-variable">aid</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlgorithmIdentifier</span>(</li><li>                X9ObjectIdentifiers.id_ecPublicKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ASN1ObjectIdentifier</span>(<span class="hljs-string">"1.2.156.10197.1.301"</span>));</li><li>            <span class="hljs-type">SubjectPublicKeyInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> SubjectPublicKeyInfo.getInstance(publicKey);</li><li>            <span class="hljs-keyword">if</span> (!aid.equals(info.getAlgorithm())) {</li><li>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"encoded not valid"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-type">byte</span>[] coding = info.getPublicKeyData().getBytes();</li><li>                <span class="hljs-keyword">if</span> (coding.length != <span class="hljs-number">65</span>) {</li><li>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"encoded not valid"</span>);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-keyword">return</span> coding;</li><li>                }</li><li>            }</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-keyword">if</span> (publicKey.length == <span class="hljs-number">64</span>) {</li><li>                <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">65</span>];</li><li>                bytes[<span class="hljs-number">0</span>] = <span class="hljs-number">4</span>;</li><li>                System.arraycopy(publicKey, <span class="hljs-number">0</span>, bytes, <span class="hljs-number">1</span>, <span class="hljs-number">64</span>);</li><li>                publicKey = bytes;</li><li>            }</li><li>            <span class="hljs-keyword">return</span> (<span class="hljs-type">byte</span>[])publicKey.clone();</li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div>     <ul>      <li>SM2解密示例代码参考如下：</li>     </ul>     <div _ngcontent-mdc-c106="" class="highlight-div"><div _ngcontent-mdc-c106="" class="highlight-div-header"><div _ngcontent-mdc-c106="" class="highlight-div-header-left"><div _ngcontent-mdc-c106="" class="handle-button expand-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mdc-c106="" class="highlight-div-header-right"><div _ngcontent-mdc-c106="" class="handle-button ai-button"></div><div _ngcontent-mdc-c106="" class="handle-button line-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mdc-c106="" class="handle-button theme-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mdc-c106="" class="handle-button copy-button"><div _ngcontent-mdc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mdc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 解密</span></li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1Integer;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1OctetString;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1Primitive;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1Sequence;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1Set;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.ASN1TaggedObject;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.gm.GMNamedCurves;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.sec.ECPrivateKey;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x509.AlgorithmIdentifier;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.asn1.x9.X9ECParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.engines.SM2Engine;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.params.ECDomainParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.crypto.params.ECPrivateKeyParameters;</li><li><span class="hljs-keyword">import</span> org.bouncycastle.util.encoders.Hex;</li><li>
</li><li><span class="hljs-keyword">import</span> java.io.IOException;</li><li><span class="hljs-keyword">import</span> java.math.BigInteger;</li><li><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;</li><li><span class="hljs-keyword">import</span> java.util.Enumeration;</li><li>
</li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SM2DecTest</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> decrypt(<span class="hljs-string">"16进制编码解密私钥"</span>, <span class="hljs-string">"密文"</span>);</li><li>        System.out.println(data);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String priKey, String cipherData)</span> {</li><li>        <span class="hljs-type">SM2Engine</span> <span class="hljs-variable">sm2Engine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SM2Engine</span>(SM2Engine.Mode.C1C3C2);</li><li>        <span class="hljs-keyword">if</span> (cipherData == <span class="hljs-literal">null</span> || cipherData.isEmpty()) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"cipher data is empty when decrypt data"</span>);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (priKey == <span class="hljs-literal">null</span> || priKey.isEmpty()) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"pri key is empty when decrypt data"</span>);</li><li>        }</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-type">X9ECParameters</span> <span class="hljs-variable">x9ECParameters</span> <span class="hljs-operator">=</span> GMNamedCurves.getByName(<span class="hljs-string">"sm2p256v1"</span>);</li><li>            <span class="hljs-type">ECDomainParameters</span> <span class="hljs-variable">ecDomainParameters</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ECDomainParameters</span>(x9ECParameters.getCurve(),</li><li>                x9ECParameters.getG(), x9ECParameters.getN());</li><li>            <span class="hljs-type">byte</span>[] bPriKey = Hex.decode(priKey);</li><li>            <span class="hljs-type">byte</span>[] enContent = Hex.decode(cipherData);</li><li>            BigInteger privateKeyD;</li><li>            <span class="hljs-keyword">if</span> (bPriKey.length != <span class="hljs-number">32</span> &amp;&amp; bPriKey.length != <span class="hljs-number">33</span>) {</li><li>                privateKeyD = getDInt(bPriKey);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                privateKeyD = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigInteger</span>(bPriKey);</li><li>            }</li><li>            <span class="hljs-type">ECPrivateKeyParameters</span> <span class="hljs-variable">privateKeyParameters</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ECPrivateKeyParameters</span>(privateKeyD, ecDomainParameters);</li><li>            sm2Engine.init(<span class="hljs-literal">false</span>, privateKeyParameters);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(sm2Engine.processBlock(enContent, <span class="hljs-number">0</span>, enContent.length), StandardCharsets.UTF_8);</li><li>        } <span class="hljs-keyword">catch</span> (Exception var7) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(var7);</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> BigInteger <span class="hljs-title function_">getDInt</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytesKey)</span> <span class="hljs-keyword">throws</span> IOException {</li><li>        <span class="hljs-type">ASN1Sequence</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> ASN1Sequence.getInstance(bytesKey);</li><li>        <span class="hljs-type">Enumeration</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> sequence.getObjects();</li><li>        <span class="hljs-type">BigInteger</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> ((ASN1Integer)e.nextElement()).getValue();</li><li>        <span class="hljs-keyword">if</span> (version.intValue() != <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"wrong version for private key info"</span>);</li><li>        }</li><li>        <span class="hljs-type">AlgorithmIdentifier</span> <span class="hljs-variable">algId</span> <span class="hljs-operator">=</span> AlgorithmIdentifier.getInstance(e.nextElement());</li><li>        <span class="hljs-type">ASN1OctetString</span> <span class="hljs-variable">privKey</span> <span class="hljs-operator">=</span> ASN1OctetString.getInstance(e.nextElement());</li><li>        ASN1Set attributes;</li><li>        <span class="hljs-keyword">if</span> (e.hasMoreElements()) {</li><li>            attributes= ASN1Set.getInstance((ASN1TaggedObject) e.nextElement(), <span class="hljs-literal">false</span>);</li><li>        }</li><li>        <span class="hljs-type">ASN1Primitive</span> <span class="hljs-variable">primitive</span> <span class="hljs-operator">=</span> ASN1Primitive.fromByteArray(privKey.getOctets());</li><li>        <span class="hljs-type">ECPrivateKey</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> ECPrivateKey.getInstance(primitive);</li><li>        <span class="hljs-keyword">return</span> privateKey.getKey();</li><li>    }</li><li>}</li></ol></pre></div></div>     <p></p>    </div>   </div>   <div></div></div>