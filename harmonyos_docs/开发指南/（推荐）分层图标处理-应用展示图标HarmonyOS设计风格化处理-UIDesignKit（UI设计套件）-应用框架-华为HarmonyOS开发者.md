<h1 _ngcontent-trx-c119="" class="doc-title ng-star-inserted" title="（推荐）分层图标处理"> （推荐）分层图标处理 </h1>

<div _ngcontent-trx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section154545114557">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section154545114557" tips="复制节点链接"></i></h2>          <p>从5.0.0(12)版本开始， Hds支持分层图标处理能力。</p>     <p>适用于图标为分层资源，且图标展示风格要与华为HarmonyOS Design System设计风格一致的应用场景。以下是一些典型的应用场景：</p>     <ul>      <li>展示带图标的应用列表：可调用UI Design Kit批量处理分层图标的接口获取处理后的应用图标。</li>      <li>展示应用详情：可调用UI Design Kit处理单个分层图标的接口获取处理后的应用图标。</li>      <li>展示跟随在线主题的应用图标：可调用UI Design Kit处理分层图标的接口获取主题换肤后的应用图标。</li>     </ul>     <p></p>     <p></p>     <p></p>    </div>    <div class="tiledSection">     <h2 id="section103557150263">约束条件<i class="anchor-icon anchor-icon-link" anchorid="section103557150263" tips="复制节点链接"></i></h2>          <p>分层图标处理支持Phone、Tablet、PC/2in1设备，并且从5.1.1(19)版本开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section360515172116">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section360515172116" tips="复制节点链接"></i></h2>          <p><span><img height="138.6525" originheight="950" originwidth="3564" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114725.17030721633734270462675386390848:50001231000000:2800:C30DA1DDB03C4A81A69C7C9F5CFB5026C641B572D5D0001A4A47C7FBCE3CC487.png" title="点击放大" width="523.6875"></span></p>     <ol>      <li><span>设置分层图标。</span>       <p></p>       <p>将前景资源和背景资源，放到entry/src/main/resources/base/media下，在该目录创建一个json文件（例如：drawable.json），内容为</p>       <div _ngcontent-trx-c106="" class="highlight-div"><div _ngcontent-trx-c106="" class="highlight-div-header"><div _ngcontent-trx-c106="" class="highlight-div-header-left"><div _ngcontent-trx-c106="" class="handle-button expand-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trx-c106="" class="highlight-div-header-right"><div _ngcontent-trx-c106="" class="handle-button ai-button"></div><div _ngcontent-trx-c106="" class="handle-button line-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trx-c106="" class="handle-button theme-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trx-c106="" class="handle-button copy-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"layered-image"</span>:</li><li>  {</li><li>    <span class="hljs-string">"background"</span> : <span class="hljs-string">"$media:background"</span>,</li><li>    <span class="hljs-string">"foreground"</span> : <span class="hljs-string">"$media:foreground"</span></li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>将图标处理的相关类添加至工程。</span>       <p></p>       <div _ngcontent-trx-c106="" class="highlight-div"><div _ngcontent-trx-c106="" class="highlight-div-header"><div _ngcontent-trx-c106="" class="highlight-div-header-left"><div _ngcontent-trx-c106="" class="handle-button expand-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trx-c106="" class="highlight-div-header-right"><div _ngcontent-trx-c106="" class="handle-button ai-button"></div><div _ngcontent-trx-c106="" class="handle-button line-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trx-c106="" class="handle-button theme-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trx-c106="" class="handle-button copy-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LayeredDrawableDescriptor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hdsDrawable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UIDesignKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>       <p></p></li>     </ol>     <ol start="3">      <li><span>简单配置页面的布局，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdsdrawable#section156601033183215" target="_blank">分层图标接口</a>获取处理后的图标信息，也可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ui-design-hdsdrawable#section712131324710" target="_blank">异步批量处理接口</a>。</span>       <p></p>       <div _ngcontent-trx-c106="" class="highlight-div"><div _ngcontent-trx-c106="" class="highlight-div-header"><div _ngcontent-trx-c106="" class="highlight-div-header-left"><div _ngcontent-trx-c106="" class="handle-button expand-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trx-c106="" class="highlight-div-header-right"><div _ngcontent-trx-c106="" class="handle-button ai-button"></div><div _ngcontent-trx-c106="" class="handle-button line-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trx-c106="" class="handle-button theme-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trx-c106="" class="handle-button copy-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span>{</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'com.example.uidesignkit'</span>;</li><li>  <span class="hljs-attr">resManager</span>: resourceManager.<span class="hljs-property">ResourceManager</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">layeredDrawableDescriptor</span>: <span class="hljs-title class_">LayeredDrawableDescriptor</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">layeredIconsResult</span>: <span class="hljs-title class_">Array</span>&lt;hdsDrawable.<span class="hljs-property">ProcessedIcon</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'getHdsLayeredIcon'</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHdsLayeredIcon</span>())</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">48</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'getHdsLayeredIcons'</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredIconsResult</span>,</li><li>          <span class="hljs-function">(<span class="hljs-params">item: hdsDrawable.ProcessedIcon, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">bundleName</span>)</li><li>                  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                  .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>                <span class="hljs-title class_">Image</span>(item.<span class="hljs-property">pixelMap</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-number">48</span>)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>              }</li><li>              .<span class="hljs-title function_">margin</span>(<span class="hljs-number">15</span>)</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>())</li><li>      }</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取资源管理器</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>)?.<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 通过资源管理获取原始分层图标信息</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span>.<span class="hljs-title function_">getDrawableDescriptor</span>($r(<span class="hljs-string">'app.media.drawable'</span>)</li><li>      .<span class="hljs-property">id</span>)) <span class="hljs-keyword">as</span> <span class="hljs-title class_">LayeredDrawableDescriptor</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHdsLayeredIcons</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getHdsLayeredIcon</span>(): image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用HDS分层图标接口处理图标</span></li><li>      <span class="hljs-keyword">return</span> hdsDrawable.<span class="hljs-title function_">getHdsLayeredIcon</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bundleName</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span>, <span class="hljs-number">48</span>, <span class="hljs-literal">true</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcon failed, code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getHdsLayeredIcons</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons layeredDrawableDescriptor is undefined.`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    </li><li>    <span class="hljs-comment">// 构造批量接口传参</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: hdsDrawable.<span class="hljs-property">Options</span> = {</li><li>      <span class="hljs-attr">size</span>: <span class="hljs-number">48</span>,</li><li>      <span class="hljs-attr">hasBorder</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">parallelNumber</span>: <span class="hljs-number">4</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">layeredIcons</span>: <span class="hljs-title class_">Array</span>&lt;hdsDrawable.<span class="hljs-property">LayeredIcon</span>&gt; = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>      layeredIcons.<span class="hljs-title function_">push</span>({</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.bundleName}</span>-<span class="hljs-subst">${i}</span>`</span>,</li><li>        <span class="hljs-attr">layeredDrawableDescriptor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span></li><li>      });</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用HDS批量分层接口处理图标</span></li><li>      hdsDrawable.<span class="hljs-title function_">getHdsLayeredIcons</span>(layeredIcons, options)</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;hdsDrawable.ProcessedIcon&gt;</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`getHdsLayeredIcons data size: <span class="hljs-subst">${data.length}</span>`</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredIconsResult</span> = data;</li><li>        })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons return error, code: <span class="hljs-subst">${err.code}</span>, msg: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons failed, code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1817964534718">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section1817964534718" tips="复制节点链接"></i></h2>          <div _ngcontent-trx-c106="" class="highlight-div"><div _ngcontent-trx-c106="" class="highlight-div-header"><div _ngcontent-trx-c106="" class="highlight-div-header-left"><div _ngcontent-trx-c106="" class="handle-button expand-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trx-c106="" class="highlight-div-header-right"><div _ngcontent-trx-c106="" class="handle-button ai-button"></div><div _ngcontent-trx-c106="" class="handle-button line-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trx-c106="" class="handle-button theme-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trx-c106="" class="handle-button copy-button"><div _ngcontent-trx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LayeredDrawableDescriptor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hdsDrawable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UIDesignKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span>{</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'com.example.uidesignkit'</span>;</li><li>  <span class="hljs-attr">resManager</span>: resourceManager.<span class="hljs-property">ResourceManager</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">layeredDrawableDescriptor</span>: <span class="hljs-title class_">LayeredDrawableDescriptor</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">layeredIconsResult</span>: <span class="hljs-title class_">Array</span>&lt;hdsDrawable.<span class="hljs-property">ProcessedIcon</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'getHdsLayeredIcon'</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHdsLayeredIcon</span>())</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">48</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'getHdsLayeredIcons'</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredIconsResult</span>,</li><li>          <span class="hljs-function">(<span class="hljs-params">item: hdsDrawable.ProcessedIcon, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">bundleName</span>)</li><li>                  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                  .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>                <span class="hljs-title class_">Image</span>(item.<span class="hljs-property">pixelMap</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-number">48</span>)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>              }</li><li>              .<span class="hljs-title function_">margin</span>(<span class="hljs-number">15</span>)</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>())</li><li>      }</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取资源管理器</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>)?.<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 通过资源管理获取原始分层图标信息</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">resManager</span>.<span class="hljs-title function_">getDrawableDescriptor</span>($r(<span class="hljs-string">'app.media.drawable'</span>).<span class="hljs-property">id</span>)) <span class="hljs-keyword">as</span> <span class="hljs-title class_">LayeredDrawableDescriptor</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getHdsLayeredIcons</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getHdsLayeredIcon</span>(): image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用HDS分层图标接口处理图标</span></li><li>      <span class="hljs-keyword">return</span> hdsDrawable.<span class="hljs-title function_">getHdsLayeredIcon</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bundleName</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span>, <span class="hljs-number">48</span>, <span class="hljs-literal">true</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcon failed, code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getHdsLayeredIcons</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons layeredDrawableDescriptor is undefined.`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 构造批量接口传参</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: hdsDrawable.<span class="hljs-property">Options</span> = {</li><li>      <span class="hljs-attr">size</span>: <span class="hljs-number">48</span>,</li><li>      <span class="hljs-attr">hasBorder</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">parallelNumber</span>: <span class="hljs-number">4</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">layeredIcons</span>: <span class="hljs-title class_">Array</span>&lt;hdsDrawable.<span class="hljs-property">LayeredIcon</span>&gt; = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>      layeredIcons.<span class="hljs-title function_">push</span>({</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.bundleName}</span>-<span class="hljs-subst">${i}</span>`</span>,</li><li>        <span class="hljs-attr">layeredDrawableDescriptor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredDrawableDescriptor</span></li><li>      });</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 调用HDS批量分层接口处理图标</span></li><li>      hdsDrawable.<span class="hljs-title function_">getHdsLayeredIcons</span>(layeredIcons, options)</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;hdsDrawable.ProcessedIcon&gt;</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`getHdsLayeredIcons data size: <span class="hljs-subst">${data.length}</span>`</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">layeredIconsResult</span> = data;</li><li>        })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons return error, code: <span class="hljs-subst">${err.code}</span>, msg: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`getHdsLayeredIcons failed, code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>