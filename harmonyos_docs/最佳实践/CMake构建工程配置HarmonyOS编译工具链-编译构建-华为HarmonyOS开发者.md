<h1 _ngcontent-bym-c119="" class="doc-title ng-star-inserted" title="CMake构建工程配置HarmonyOS编译工具链"> CMake构建工程配置HarmonyOS编译工具链 </h1>

<div _ngcontent-bym-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section86743470381">概述<i class="anchor-icon anchor-icon-link" anchorid="section86743470381" tips="复制节点链接"></i></h2><p>CMake是一个跨平台的构建工具，用于管理构建过程、编译、链接和打包软件项目，它可以生成Makefile等用于不同操作系统和编译器的构建脚本。CMake的配置过程是跨平台的，因此可以在不同的操作系统上运行，例如Linux、Windows和macOS。</p> <p>CMake构建过程可分为以下三个主要步骤：</p> <ul><li>配置（Configuration）：配置阶段是CMake解析CMakeLists.txt文件的过程。在配置阶段，CMake会读取CMakeLists.txt文件，并执行其中的命令。CMakeLists.txt文件是CMake的核心，其定义了项目的构建规则和依赖关系。</li><li>生成（Generation）：生成阶段是CMake根据配置阶段的结果，生成实际构建文件的过程。在生成阶段，CMake会将CMakeLists.txt文件中定义的构建规则和依赖关系转为构建工具可以理解的形式。</li><li>构建（Build）：构建阶段是使用构建工具（如Make或DevEco Studio）根据生成的构建文件，编译源代码并链接生成目标文件的过程。在构建阶段，构建工具会读取生成的构建文件，按照其中定义的规则和依赖关系，执行实际的编译和链接操作。</li></ul> </div> <div class="tiledSection"><h2 id="section1826019653918">CMake构建三方库适配流程<i class="anchor-icon anchor-icon-link" anchorid="section1826019653918" tips="复制节点链接"></i></h2><p>本小节介绍如何在Linux环境下，使用CMake构建工具通过ohos sdk编译cJSON三方库源码，生成ohos平台三方库的so及二进制文件。</p> </div> <div class="tiledSection"><h2 id="section197241001402">环境准备<i class="anchor-icon anchor-icon-link" anchorid="section197241001402" tips="复制节点链接"></i></h2><ol><li>首先需要Linux编译环境。<p>开发者可以选择熟悉的发行版来进行环境搭建，这里以Ubuntu为例，Ubuntu目前主要支持Ubuntu18.04和Ubuntu20.04。</p> </li><li>HarmonyOS SDK镜像下载：通过<a href="https://developer.huawei.com/consumer/cn/download/" target="_blank">下载中心</a>，下载Command Line Tools获取，或通过<a href="https://ci.openharmony.cn/workbench/cicd/dailybuild/dailylist" target="_blank">CI平台</a>进行下载。</li><li>进入SDK文件所在目录，使用tar -zxvf解压SDK文件。<div class="p">随着版本更新，SDK版本可能会有变动，开发者可自行下载最新版本，此处以4.0.10.5版本为例。<div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/ohosSDK</span><span class="hljs-variable">$ </span>tar -zxvf version-<span class="hljs-title class_">Master</span>_Version-<span class="hljs-title class_">OpenHarmony</span>_4.<span class="hljs-number">0.10</span>.<span class="hljs-number">5</span>-<span class="hljs-number">20230824_120921</span>-ohos-sdk-public_monthly.tar.gz</li></ol></pre></div></div> </div> </li><li>进入到SDK的linux目录，解压工具包。<div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/ohosSDK</span><span class="hljs-variable">$ </span>cd ohos-sdk/linux</li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/ohosSDK/ohos-sdk/linux</span><span class="hljs-variable">$ </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> *.zip;<span class="hljs-keyword">do</span> unzip <span class="hljs-variable">${</span>i};done                  <span class="hljs-comment"># 通过for循环一次解压所有的工具包</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/ohosSDK/ohos-sdk/linux</span><span class="hljs-variable">$ </span>ls</li><li>ets                                 native                                    toolchains</li><li>ets-linux-x64-<span class="hljs-number">4.0</span>.<span class="hljs-number">10.5</span>-<span class="hljs-title class_">Release</span>.zip  native-linux-x64-<span class="hljs-number">4.0</span>.<span class="hljs-number">10.5</span>-<span class="hljs-title class_">Release</span>.zip     toolchains-linux-x64-<span class="hljs-number">4.0</span>.<span class="hljs-number">10.5</span>-<span class="hljs-title class_">Release</span>.zip</li><li>js                                  previewer</li><li>js-linux-x64-<span class="hljs-number">4.0</span>.<span class="hljs-number">10.5</span>-<span class="hljs-title class_">Release</span>.zip   previewer-linux-x64-<span class="hljs-number">4.0</span>.<span class="hljs-number">10.5</span>-<span class="hljs-title class_">Release</span>.zip</li></ol></pre></div></div> </li><li>获取三方库源码，适配三方库如果没有指定版本，一般取三方库最新版本（/mnt/e/cmake中cmake表示创建的文件夹名称，用于存放三方库源码文件，开发者可自行选择创建与否）。<div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">owner</span>@<span class="hljs-title function_">ubuntu</span>:/<span class="hljs-variable">mnt</span>/<span class="hljs-variable">e</span>/<span class="hljs-variable">cmake</span>$ <span class="hljs-variable">git</span> <span class="hljs-variable">clone</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//github.com/DaveGamble/cJSON.git -b v1.7.18        # 通过git下载指定版本的源码</span></li><li><span class="hljs-variable">Cloning</span> <span class="hljs-variable">into</span> <span class="hljs-string">'cJSON'</span>...</li><li><span class="hljs-variable">remote</span>: <span class="hljs-title class_">Enumerating</span> <span class="hljs-title class_">objects</span>: <span class="hljs-number">4545</span>, <span class="hljs-variable">done</span>.</li><li><span class="hljs-variable">remote</span>: <span class="hljs-title class_">Total</span> <span class="hljs-number">4545</span> (<span class="hljs-title class_">delta</span> <span class="hljs-number">0</span>), <span class="hljs-variable">reused</span> <span class="hljs-number">0</span> (<span class="hljs-variable">delta</span> <span class="hljs-number">0</span>), <span class="hljs-variable">pack</span>-<span class="hljs-variable">reused</span> <span class="hljs-number">4545</span></li><li><span class="hljs-variable">Receiving</span> <span class="hljs-variable">objects</span>: <span class="hljs-number">100</span>% (<span class="hljs-number">4545</span>/<span class="hljs-number">4545</span>), <span class="hljs-number">2.45</span> <span class="hljs-variable">MiB</span> | <span class="hljs-number">1.65</span> <span class="hljs-variable">MiB</span>/<span class="hljs-variable">s</span>, <span class="hljs-variable">done</span>.</li><li><span class="hljs-variable">Resolving</span> <span class="hljs-variable">deltas</span>: <span class="hljs-number">100</span>% (<span class="hljs-number">3026</span>/<span class="hljs-number">3026</span>), <span class="hljs-variable">done</span>.</li><li><span class="hljs-variable">Note</span>: <span class="hljs-title class_">switching</span> <span class="hljs-title class_">to</span> <span class="hljs-string">'d348621ca93571343a56862df7de4ff3bc9b5667'</span>.</li><li>
</li><li><span class="hljs-variable">You</span> <span class="hljs-variable">are</span> <span class="hljs-keyword">in</span> <span class="hljs-string">'detached HEAD'</span> <span class="hljs-variable">state</span>. <span class="hljs-variable">You</span> <span class="hljs-variable">can</span> <span class="hljs-variable">look</span> <span class="hljs-variable">around</span>, <span class="hljs-variable">make</span> <span class="hljs-variable">experimental</span></li><li><span class="hljs-variable">changes</span> <span class="hljs-variable">and</span> <span class="hljs-variable">commit</span> <span class="hljs-variable">them</span>, <span class="hljs-variable">and</span> <span class="hljs-variable">you</span> <span class="hljs-variable">can</span> <span class="hljs-variable">discard</span> <span class="hljs-variable">any</span> <span class="hljs-variable">commits</span> <span class="hljs-variable">you</span> <span class="hljs-variable">make</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span></li><li><span class="hljs-variable">state</span> <span class="hljs-variable">without</span> <span class="hljs-variable">impacting</span> <span class="hljs-variable">any</span> <span class="hljs-variable">branches</span> <span class="hljs-variable">by</span> <span class="hljs-variable">switching</span> <span class="hljs-variable">back</span> <span class="hljs-variable">to</span> <span class="hljs-variable">a</span> <span class="hljs-variable">branch</span>.</li><li>
</li><li><span class="hljs-variable">If</span> <span class="hljs-variable">you</span> <span class="hljs-variable">want</span> <span class="hljs-variable">to</span> <span class="hljs-variable">create</span> <span class="hljs-variable">a</span> <span class="hljs-variable">new</span> <span class="hljs-variable">branch</span> <span class="hljs-variable">to</span> <span class="hljs-variable">retain</span> <span class="hljs-variable">commits</span> <span class="hljs-variable">you</span> <span class="hljs-variable">create</span>, <span class="hljs-variable">you</span> <span class="hljs-variable">may</span></li><li><span class="hljs-keyword">do</span> <span class="hljs-variable">so</span> (<span class="hljs-variable">now</span> <span class="hljs-variable">or</span> <span class="hljs-variable">later</span>) <span class="hljs-variable">by</span> <span class="hljs-variable">using</span> -<span class="hljs-variable">c</span> <span class="hljs-variable">with</span> <span class="hljs-variable">the</span> <span class="hljs-variable">switch</span> <span class="hljs-variable">command</span>. <span class="hljs-variable">Example</span>:</li><li>
</li><li>  <span class="hljs-variable">git</span> <span class="hljs-variable">switch</span> -<span class="hljs-title class_">c</span> &lt;<span class="hljs-title class_">new</span>-<span class="hljs-title class_">branch</span>-<span class="hljs-title class_">name</span>&gt;</li><li>
</li><li><span class="hljs-variable">Or</span> <span class="hljs-variable">undo</span> <span class="hljs-keyword">this</span> <span class="hljs-variable">operation</span> <span class="hljs-variable">with</span>:</li><li>
</li><li>  <span class="hljs-variable">git</span> <span class="hljs-variable">switch</span> -</li><li>
</li><li><span class="hljs-variable">Turn</span> <span class="hljs-variable">off</span> <span class="hljs-keyword">this</span> <span class="hljs-variable">advice</span> <span class="hljs-variable">by</span> <span class="hljs-variable">setting</span> <span class="hljs-variable">config</span> <span class="hljs-variable">variable</span> <span class="hljs-variable">advice</span>.<span class="hljs-variable">detachedHead</span> <span class="hljs-variable">to</span> <span class="hljs-keyword">false</span></li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section154231955124018">编译三方库<i class="anchor-icon anchor-icon-link" anchorid="section154231955124018" tips="复制节点链接"></i></h2><ol><li>新建编译目录。<p>为防止污染源码目录文件，推荐在三方库源码目录新建一个编译目录，用于生成需要编译的配置文件。</p> <p>本用例中在cJSON目录下新建一个build目录：</p> <div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake</span><span class="hljs-variable">$ </span>cd cJSON-<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>                                   <span class="hljs-comment"># 进入cJSON目录</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span><span class="hljs-variable">$ </span>mkdir build &amp;&amp; cd build              <span class="hljs-comment"># 创建编译目录并进入到编译目录</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/build$</li></ol></pre></div></div> </li><li>执行cmake编译命令，配置交叉编译参数，生成Makefile。<div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/build<span class="hljs-variable">$ </span>/xxx/ohos-sdk/linux/native/build-tools/cmake/bin/cmake -<span class="hljs-variable constant_">DCMAKE_TOOLCHAIN_FILE</span>=<span class="hljs-regexp">/xxx/ohos</span>-sdk/linux/native/build/cmake/ohos.toolchain.cmake -<span class="hljs-variable constant_">DCMAKE_INSTALL_PREFIX</span>=<span class="hljs-regexp">/xxx/c</span>JSON -<span class="hljs-variable constant_">DOHOS_ARCH</span>=arm64-v8a .. -L                                                   <span class="hljs-comment"># 执行cmake命令</span></li><li>-- <span class="hljs-title class_">The</span> C compiler identification is <span class="hljs-title class_">Clang</span> <span class="hljs-number">12.0</span>.<span class="hljs-number">1</span></li><li>-- <span class="hljs-title class_">Check</span> <span class="hljs-keyword">for</span> working C <span class="hljs-symbol">compiler:</span> /mnt/e/ohosSDK/ohos-sdk/linux/native/llvm/bin/clang   <span class="hljs-comment"># 采用sdk内的编译器</span></li><li>-- <span class="hljs-title class_">Check</span> <span class="hljs-keyword">for</span> working C <span class="hljs-symbol">compiler:</span> /mnt/e/ohosSDK/ohos-sdk/linux/native/llvm/bin/clang -- works</li><li>...</li><li><span class="hljs-comment"># 省略部分cmake信息</span></li><li>...</li><li><span class="hljs-variable constant_">ENABLE_PUBLIC_SYMBOLS</span><span class="hljs-symbol">:BOOL=ON</span></li><li><span class="hljs-variable constant_">ENABLE_SAFE_STACK</span><span class="hljs-symbol">:BOOL=OFF</span></li><li><span class="hljs-variable constant_">ENABLE_SANITIZERS</span><span class="hljs-symbol">:BOOL=OFF</span></li><li><span class="hljs-variable constant_">ENABLE_TARGET_EXPORT</span><span class="hljs-symbol">:BOOL=ON</span></li><li><span class="hljs-variable constant_">ENABLE_VALGRIND</span><span class="hljs-symbol">:BOOL=OFF</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/build<span class="hljs-variable">$ </span>ls                             <span class="hljs-comment"># 执行完cmake成功后在当前目录生成Makefile文件</span></li><li>cJSONConfig.cmake  cJSONConfigVersion.cmake  <span class="hljs-title class_">CMakeCache</span>.txt  <span class="hljs-title class_">CMakeFiles</span>  cmake_install.cmake  <span class="hljs-title class_">CTestTestfile</span>.cmake  fuzzing  libcjson.pc  <span class="hljs-title class_">Makefile</span>  tests</li></ol></pre></div></div> <p>参数说明：</p> <ul><li>CMAKE_TOOLCHAIN_FILE：交叉编译配置文件路径，设置为ohos工具链配置文件。</li><li>CMAKE_INSTALL_PREFIX：配置安装三方库路径。</li><li>OHOS_ARCH: 配置交叉编译的CPU架构，一般为arm64-v8a（编译64位的三方库）或armeabi-v7a（编译32位的三方库），本示例中设置编译为64位的cJSON库。</li><li>-L: 显示cmake中可配置项目。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>ohos.toolchain.cmake中CMAKE_FIND_ROOT_PATH_MODE_XXX变量可设置如下值：</p> <ul><li>ONLY：仅在CMAKE_FIND_ROOT_PATH（即native sysroot）中搜索（默认为ONLY）。</li><li>NEVER：仅在主机系统路径中搜索。</li><li>BOTH：先在CMAKE_FIND_ROOT_PATH搜索，后在主机路径搜索。</li></ul> <p>若执行编译后，无法找到依赖交叉编译版本的boost，开发者可以通过将ohos.toolchain.cmake中CMAKE_FIND_ROOT_PATH_MODE_XXX变量设置为BOTH后再执行编译。</p> </div></div></div> <p>部分文件产物说明：</p> <ul><li>Makefile：构建项目的Makefile文件，包含了编译、链接等指令。</li><li>CMakeCache.txt：CMake的缓存文件，记录了CMake的配置选项和变量信息。</li><li>CMakeFiles：CMake的临时文件目录，包含了一些中间文件和构建信息，方便后续重新生成Makefile时使用。</li><li>cmake_install.cmake：安装规则文件，用于执行安装操作，将编译好的文件安装到指定的目录下。</li><li>CTestTestfile.cmake：用于执行测试的CMake脚本文件，方便进行自动化测试。</li></ul> </li><li>执行编译。<p>执行make对cJSON进行编译：</p> <div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">owner</span>@<span class="hljs-title function_">ubuntu</span>:/<span class="hljs-variable">mnt</span>/<span class="hljs-variable">e</span>/<span class="hljs-variable">cmake</span>/<span class="hljs-variable">cJSON</span>-<span class="hljs-number">1.7</span><span class="hljs-number">.18</span>/<span class="hljs-variable">build</span>$ <span class="hljs-variable">make</span>                  # <span class="hljs-variable">执行make命令进行编译</span></li><li><span class="hljs-variable">Scanning</span> <span class="hljs-variable">dependencies</span> <span class="hljs-variable">of</span> <span class="hljs-variable">target</span> <span class="hljs-variable">cjson</span></li><li>[  <span class="hljs-number">2</span>%] <span class="hljs-variable">Building</span> <span class="hljs-variable">C</span> <span class="hljs-variable">object</span> <span class="hljs-variable">CMakeFiles</span>/<span class="hljs-variable">cjson</span>.<span class="hljs-variable">dir</span>/<span class="hljs-variable">cJSON</span>.<span class="hljs-variable">c</span>.<span class="hljs-variable">o</span></li><li><span class="hljs-variable">clang</span>: <span class="hljs-title class_">warning</span>: <span class="hljs-title class_">argument</span> <span class="hljs-title class_">unused</span> <span class="hljs-title class_">during</span> <span class="hljs-title class_">compilation</span>: <span class="hljs-string">'--gcc-toolchain=/mnt/e/ohosSDK/ohos-sdk/linux/native/llvm'</span> [-<span class="hljs-title class_">Wunused</span>-<span class="hljs-title class_">command</span>-<span class="hljs-title class_">line</span>-<span class="hljs-title class_">argument</span>]</li><li>  /<span class="hljs-variable">mnt</span>/<span class="hljs-variable">e</span>/<span class="hljs-variable">cmake</span>/<span class="hljs-variable">cJSON</span>-<span class="hljs-number">1.7</span><span class="hljs-number">.18</span>/<span class="hljs-variable">cJSON</span>.<span class="hljs-variable">c</span>:<span class="hljs-number">561</span>:<span class="hljs-number">9</span>: <span class="hljs-title class_">warning</span>: <span class="hljs-string">'long long'</span> <span class="hljs-keyword">is</span> <span class="hljs-title class_">an</span> <span class="hljs-title class_">extension</span> <span class="hljs-title class_">when</span> <span class="hljs-title class_">C99</span> <span class="hljs-title class_">mode</span> <span class="hljs-keyword">is</span> <span class="hljs-title class_">not</span> <span class="hljs-title class_">enabled</span> [-<span class="hljs-title class_">Wlong</span>-<span class="hljs-title class_">long</span>]</li><li>...</li><li># <span class="hljs-variable">省略部分make信息</span></li><li>...</li><li><span class="hljs-variable">clang</span>: <span class="hljs-title class_">warning</span>: <span class="hljs-title class_">argument</span> <span class="hljs-title class_">unused</span> <span class="hljs-title class_">during</span> <span class="hljs-title class_">compilation</span>: <span class="hljs-string">'--gcc-toolchain=/mnt/e/ohosSDK/ohos-sdk/linux/native/llvm'</span> [-<span class="hljs-title class_">Wunused</span>-<span class="hljs-title class_">command</span>-<span class="hljs-title class_">line</span>-<span class="hljs-title class_">argument</span>]</li><li>[ <span class="hljs-number">97</span>%] <span class="hljs-variable">Building</span> <span class="hljs-variable">C</span> <span class="hljs-variable">object</span> <span class="hljs-variable">fuzzing</span>/<span class="hljs-variable">CMakeFiles</span>/<span class="hljs-variable">fuzz_main</span>.<span class="hljs-variable">dir</span>/<span class="hljs-variable">cjson_read_fuzzer</span>.<span class="hljs-variable">c</span>.<span class="hljs-variable">o</span></li><li><span class="hljs-variable">clang</span>: <span class="hljs-title class_">warning</span>: <span class="hljs-title class_">argument</span> <span class="hljs-title class_">unused</span> <span class="hljs-title class_">during</span> <span class="hljs-title class_">compilation</span>: <span class="hljs-string">'--gcc-toolchain=/mnt/e/ohosSDK/ohos-sdk/linux/native/llvm'</span> [-<span class="hljs-title class_">Wunused</span>-<span class="hljs-title class_">command</span>-<span class="hljs-title class_">line</span>-<span class="hljs-title class_">argument</span>]</li><li>[<span class="hljs-number">100</span>%] <span class="hljs-variable">Linking</span> <span class="hljs-variable">C</span> <span class="hljs-variable">executable</span> <span class="hljs-variable">fuzz_main</span></li><li>[<span class="hljs-number">100</span>%] <span class="hljs-variable">Built</span> <span class="hljs-variable">target</span> <span class="hljs-variable">fuzz_main</span></li></ol></pre></div></div> </li><li>获取编译完成后的文件。<p>编译成功后开发者可以通过file命令查看文件的属性，以此判断交叉编译是否成功，如下信息显示libcjson.so为aarch64架构文件，即交叉编译成功：</p> <div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/build<span class=""><span class="hljs-variable">$ </span></span>file libcjson.so.<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>                     <span class="hljs-comment"># 查看文件属性命令</span></li><li>libcjson.so.<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>: <span class="hljs-variable constant_">ELF</span> <span class="hljs-number">64</span>-bit <span class="hljs-variable constant_">LSB</span> shared object, <span class="hljs-variable constant_">ARM</span> aarch64, version <span class="hljs-number">1</span> (<span class="hljs-variable constant_">SYSV</span>), dynamically linked, <span class="hljs-title class_">Build</span>ID[sha1]=a79e4b52a332702b4853f2d6cac2fcd7dff95023, with debug_info, <span class="hljs-keyword">not</span> stripped</li></ol></pre></div></div> </li><li>执行安装命令。<div class="p">编译成功后，执行make install将编译好的二进制文件以及头文件安装到cmake配置的安装路径下：<div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/build<span class="hljs-variable">$ </span>make install                                <span class="hljs-comment"># 执行安装命令</span></li><li>[  <span class="hljs-number">4</span>%] <span class="hljs-title class_">Built</span> target cjson</li><li>[  <span class="hljs-number">8</span>%] <span class="hljs-title class_">Built</span> target cJSON_test</li><li>...</li><li><span class="hljs-comment"># 省略部分make install信息</span></li><li>...</li><li>-- <span class="hljs-title class_">Installing</span>: <span class="hljs-regexp">/mnt/e</span><span class="hljs-regexp">/cmake/c</span>JSON-<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/lib/cmake/cJSON/cJSONConfig.cmake</li><li>-- <span class="hljs-title class_">Installing</span>: <span class="hljs-regexp">/mnt/e</span><span class="hljs-regexp">/cmake/c</span>JSON-<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/lib/cmake/cJSON/cJSONConfigVersion.cmake</li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/build$</li></ol></pre></div></div> </div> <div _ngcontent-bym-c106="" class="highlight-div"><div _ngcontent-bym-c106="" class="highlight-div-header"><div _ngcontent-bym-c106="" class="highlight-div-header-left"><div _ngcontent-bym-c106="" class="handle-button expand-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bym-c106="" class="highlight-div-header-right"><div _ngcontent-bym-c106="" class="handle-button ai-button"></div><div _ngcontent-bym-c106="" class="handle-button line-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bym-c106="" class="handle-button theme-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bym-c106="" class="handle-button copy-button"><div _ngcontent-bym-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bym-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/build<span class="hljs-variable">$ </span>ls /mnt/e/cmake/cJSON-<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON                <span class="hljs-comment"># 查看安装文件</span></li><li><span class="hljs-keyword">include</span>  lib</li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/cmake/cJSON-</span><span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/build<span class="hljs-variable">$ </span>ls /mnt/e/cmake/cJSON-<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>/cJSON/lib</li><li>cmake  libcjson.so  libcjson.so.<span class="hljs-number">1</span>  libcjson.so.<span class="hljs-number">1.7</span>.<span class="hljs-number">18</span>  pkgconfig</li></ol></pre></div></div> </li><li>安装成功后，即使用CMake构建工具通过ohos sdk编译cJSON三方库源码完成。</li></ol> </div> <div class="tiledSection"><h2 id="section947993195511">应用中集成使用三方库<i class="anchor-icon anchor-icon-link" anchorid="section947993195511" tips="复制节点链接"></i></h2><p>请参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-dynamic-link-library" target="_blank">三方动态链接库（.so）集成开发实践</a>。</p> </div> </div> <div></div></div>