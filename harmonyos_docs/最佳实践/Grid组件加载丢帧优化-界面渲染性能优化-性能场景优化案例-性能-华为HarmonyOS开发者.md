<h1 _ngcontent-ytm-c119="" class="doc-title ng-star-inserted" title="Grid组件加载丢帧优化"> Grid组件加载丢帧优化 </h1>

<div _ngcontent-ytm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section11868929182712">概述<i class="anchor-icon anchor-icon-link" anchorid="section11868929182712" tips="复制节点链接"></i></h2><p>网格是应用开发中常见的开发场景。它通过相交的横线和竖线，形成整齐有序的网状布局。网格适用于展示图片、媒体文件、购物商品等多种数据。当网格上下滑动时，子组件会带来测量和绘制的性能消耗。</p> <p>在网格的高频场景中，性能优化是关键，包括加快渲染速度、提升滑动帧率、降低内存占用等，从而显著提升应用流畅度和用户体验。对于希望快速实现的开发者，可使用ScrollComponents库直接创建流畅滑动的网格，该库内置组件复用、懒加载、复用池共享等优化能力，并支持预创建和预加载，大幅减少开发者的性能调优成本，具体实现细节和最佳实践可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-grid-based-on-scrollcomponents" target="_blank">基于ScrollComponents实现网格</a>。</p> </div> <p>在实现如下图所示可滚动布局效果时，可能会通过columnStart/columnEnd<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#设置子组件所占行列数" target="_blank">设置子组件所占行列数</a>，实现不规则的布局效果。</p> <div class="fignone"><span class="figcap"><b>图1 </b>columnStart/columnEnd实现不规则网格布局</span><br><span><img originheight="325" originwidth="457" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163433.73441685831770677850701455520954:50001231000000:2800:409365125CD80CB41BE94E2F11A6E9C0D9DFB407FB10E2E92B6A3A09A6580735.png" width="457" height="325"></span></div> <p>在以下使用场景中，使用columnStart或columnEnd可能会导致性能问题：</p> <ol><li><strong>删除或拖拽等改变GridItem位置</strong></li><li><strong>使用scrollToIndex滑动到指定GridItem</strong></li></ol> <p>在Grid中存在多个GridItem时，如果使用columnStart/columnEnd或rowStart/rowEnd设置GridItem的大小，可能会导致性能问题。在这种情况下，建议使用GridLayoutOptions来提升性能。使用columnStart/columnEnd或rowStart/rowEnd布局时，如果调用scrollToIndex滑动到指定索引，Grid会遍历所有GridItem以查找位置。而使用GridLayoutOptions布局时，通过计算方式查找位置，效率更高。因此，可以通过设置GridLayoutOptions，并结合rowsTemplate或columnsTemplate来替代使用columnStart/columnEnd控制GridItem占用多列的情况。</p> <div class="tiledSection"><h2 id="section1158054023112">案例说明<i class="anchor-icon anchor-icon-link" anchorid="section1158054023112" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section131204492324" class="firsth2">场景示例<i class="anchor-icon anchor-icon-link" anchorid="section131204492324" tips="复制节点链接"></i></h3></div> <p>介绍Grid中使用scrollToIndex滑动到指定位置的场景。案例中，columnStart/columnEnd设置不规则宫格布局的反例，与GridLayoutOption的正例对比，示例代码如下：</p> <p><strong>反例：</strong>使用columnStart/columnEnd设置GridItem大小。</p> <div class="screenLinkPre"><div _ngcontent-ytm-c106="" class="highlight-div"><div _ngcontent-ytm-c106="" class="highlight-div-header"><div _ngcontent-ytm-c106="" class="highlight-div-header-left"><div _ngcontent-ytm-c106="" class="handle-button expand-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ytm-c106="" class="highlight-div-header-right"><div _ngcontent-ytm-c106="" class="handle-button ai-button"></div><div _ngcontent-ytm-c106="" class="handle-button line-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ytm-c106="" class="handle-button theme-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ytm-c106="" class="handle-button copy-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ytm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/GridComponentLoadSlow/entry/src/main/ets/pages/Index.ets#L2-L89" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Import performance dot modules</span></li><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextItem</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xF9CF93</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>      .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// Finish the task</span></li><li>    hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'useColumnStartColumnEnd'</span>, <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GridExample</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">datasource</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2000</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">datasource</span>.<span class="hljs-title function_">pushData</span>(i + <span class="hljs-string">''</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'使用columnStart,columnEnd设置GridItem大小'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-number">0xCCCCCC</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">9</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      <span class="hljs-title class_">Grid</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">datasource</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> ((index % <span class="hljs-number">4</span>) === <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-title class_">GridItem</span>() {</li><li>              <span class="hljs-title class_">TextItem</span>({ <span class="hljs-attr">item</span>: item })</li><li>            }</li><li>            .<span class="hljs-title function_">columnStart</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">columnEnd</span>(<span class="hljs-number">2</span>)</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-title class_">GridItem</span>() {</li><li>              <span class="hljs-title class_">TextItem</span>({ <span class="hljs-attr">item</span>: item })</li><li>            }</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }</li><li>      .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'1fr 1fr 1fr'</span>)</li><li>      .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'scrollToIndex:1900'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// Start some tasks.</span></li><li>        hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'useColumnStartColumnEnd'</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">1900</span>);</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span> })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/GridComponentLoadSlow/entry/src/main/ets/pages/Index.ets#L2-L89" target="_blank">Index.ets</a></div></div></div></div> <p><strong>正例：</strong>使用GridLayoutOptions设置GridItem大小，布局效果和反例保持一致。</p> <div class="screenLinkPre"><div _ngcontent-ytm-c106="" class="highlight-div"><div _ngcontent-ytm-c106="" class="highlight-div-header"><div _ngcontent-ytm-c106="" class="highlight-div-header-left"><div _ngcontent-ytm-c106="" class="handle-button expand-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ytm-c106="" class="highlight-div-header-right"><div _ngcontent-ytm-c106="" class="handle-button ai-button"></div><div _ngcontent-ytm-c106="" class="handle-button line-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ytm-c106="" class="handle-button theme-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ytm-c106="" class="handle-button copy-button"><div _ngcontent-ytm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ytm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/GridComponentLoadSlow/entry/src/main/ets/pages/RightIndex.ets#L2-L89" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Import performance dot modules</span></li><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextItem</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xF9CF93</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>      .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// Finish the task</span></li><li>    hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'useGridLayoutOptions'</span>, <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">GridExample2</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">datasource</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">irregularData</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-attr">layoutOptions</span>: <span class="hljs-title class_">GridLayoutOptions</span> = {</li><li>    <span class="hljs-attr">regularSize</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>],</li><li>    <span class="hljs-attr">irregularIndexes</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">irregularData</span>,</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2000</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">datasource</span>.<span class="hljs-title function_">pushData</span>(i + <span class="hljs-string">''</span>);</li><li>      <span class="hljs-keyword">if</span> ((i - <span class="hljs-number">1</span>) % <span class="hljs-number">4</span> === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">irregularData</span>.<span class="hljs-title function_">push</span>(i - <span class="hljs-number">1</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'使用GridLayoutOptions设置GridItem大小'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-number">0xCCCCCC</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">9</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      <span class="hljs-title class_">Grid</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">layoutOptions</span>) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">datasource</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">GridItem</span>() {</li><li>            <span class="hljs-title class_">TextItem</span>({ <span class="hljs-attr">item</span>: item })</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }</li><li>      .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'1fr 1fr 1fr'</span>)</li><li>      .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'scrollToIndex:1900'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// Start some tasks.</span></li><li>        hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'useGridLayoutOptions'</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">1900</span>);</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span> })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/GridComponentLoadSlow/entry/src/main/ets/pages/RightIndex.ets#L2-L89" target="_blank">RightIndex.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section1553153916352">分析步骤<i class="anchor-icon anchor-icon-link" anchorid="section1553153916352" tips="复制节点链接"></i></h3></div> <p>正反例采用相同的操作步骤，收集跳转过程中的性能参数并进行对比：</p> <ol><li>打开Profiler工具，连接设备，选择对应的应用进程。<p><span><img originheight="23" originwidth="867" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163433.72844286080782567822761976117996:50001231000000:2800:533FD2F778B73ED1EF236C03158793C753BD7A46EC7AA9C80228F833899F4736.png" width="867" height="23"></span></p> </li><li>选择Frame，点击Create Session以开始数据测量。<p><span><img originheight="178" originwidth="312" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163433.20283050223649243639368326372223:50001231000000:2800:D899D52AA09D93851F4DC49F2F51B90A6F5149568943380D6FFB6B46C88DDDAA.png" width="312" height="178"></span></p> </li><li>通过点击按钮，先使用startTrace开始性能打点跟踪，再调用scrollToIndex。<p><span><img height="377.316345" originheight="714" originwidth="599" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163433.83515202655502673988164377043973:50001231000000:2800:D885903D49A9289B7997A4018A04B91350C36B1C1FDB245846382EC10A9FE330.png" title="点击放大" width="316.541596"></span></p> </li><li>查看对应应用进程下的自定义打点事件，包括反例代码中定义的“useColumnStartColumnEnd”和正例代码中的“useGridLayoutOptions”下的trace图。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p><strong>打点事件说明</strong>：Grid查找到指定GridItem位置，准备渲染节点前，进入GridItem组件的生命周期回调aboutToAppear，使用finishTrace停止性能打点。通过startTrace标记调用scrollToIndex，finishTrace标记查找到指定位置后准备渲染首个GridItem节点，对比正反例场景下的耗时数据。关于性能打点的介绍，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hitracemeter" target="_blank">@ohos.hiTraceMeter (性能打点)</a></p> </div></div></div> </li></ol> <div class="tiledSection"><h3 id="section1108191783211">结果对比<i class="anchor-icon anchor-icon-link" anchorid="section1108191783211" tips="复制节点链接"></i></h3><p>如图所示，使用columnStart和columnEnd设置GridItem大小的布局方式。从自定义打点标签“H:useColumnStartColumnEndGrid”可以看出，从调用scrollToIndex到查找到指定索引并准备构建GridItem节点耗时447ms。</p> </div> <div class="fignone"><span class="figcap"><b>图2 </b>使用columnStart，columnEnd的打点信息</span></div> <p><span><img height="173.565" originheight="518" originwidth="1555" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163434.09044606363617135839524070121468:50001231000000:2800:EC8531B5D492415D7EC4484AF081F9E2DF1514A35ADE489053B51E6A52CE81B3.png" title="点击放大" width="523.6875"></span></p> <p>如图3所示，使用GridLayoutOptions设置GridItem大小的布局方式。从自定义打点标签“H:useGridLayoutOptions”可以看出，从调用scrollToIndex到查找到指定Index并准备构建GridItem节点耗时12ms。</p> <div class="fignone"><span class="figcap"><b>图3 </b>使用GridLayoutOptions的打点信息</span></div> <p><span><img height="175.98294" originheight="515" originwidth="1549" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163434.58856383694551840445473903970107:50001231000000:2800:0AE093D8A68D8500EF42D17CFE84229F6DD89B2FCEC4241F75B886B2559E91C3.png" title="点击放大" width="529.400249"></span></p> <p>通过详细的trace分析可以发现，在“H:useColumnStartColumnEndGrid”打点标签时间段中，存在大量“H:Builder:BuildLazyItem”标签。这表明Grid在查找指定的Index 1900时，是通过依次遍历Index来实现的。</p> <div class="fignone"><span class="figcap"><b>图4 </b>使用columnStart，columnEnd的放大trace标签信息</span><br><span><img height="287.28000000000003" originheight="854" originwidth="1554" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163434.59655694759243774023272378867135:50001231000000:2800:3056AFAC3B6361C2D97FE04BDE7A336BA66D947423B4E264D6238DB1FCE5B14C.png" title="点击放大" width="523.6875"></span></div> <p>在使用GridLayoutOptions的示例中，“H:useGridLayoutOptions”打点标签时间段内仅出现一个“H:Builder:BuildLazyItem”标签。这表明Grid在查找指定索引1900时，能够直接一次性找到指定索引。</p> <div class="fignone"><span class="figcap"><b>图5 </b>使用GridLayoutOptions的放大trace标签信息</span><br><span><img height="273.315" originheight="810" originwidth="1549" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163434.59259409574663467287945222723695:50001231000000:2800:BA2C930D142B2BB3336F2CCF0238B84D17062B8117F14E8ED36A7058A662CF85.png" title="点击放大" width="523.6875"></span></div> <p>在相同布局情况下，使用columnStart和columnEnd设置GridItem大小时，Grid在使用scrollToIndex查找指定索引时，会依次遍历GridItem节点，导致查找过程耗时较长。而使用GridLayoutOptions设置GridItem大小时，直接一次性计算找到指定索引，查找过程耗时较短。因此，使用GridLayoutOptions设置GridItem大小可以显著减少Grid加载时间，提升应用性能。</p> <p></p> </div> <div></div></div>