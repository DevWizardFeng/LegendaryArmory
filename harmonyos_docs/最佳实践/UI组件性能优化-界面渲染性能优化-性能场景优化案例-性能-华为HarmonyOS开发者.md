<h1 _ngcontent-yfq-c119="" class="doc-title ng-star-inserted" title="UI组件性能优化"> UI组件性能优化 </h1>

<div _ngcontent-yfq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>应用启动到UI页面展示过程包含框架初始化、页面加载和布局渲染三个步骤。其中页面加载和布局渲染的主要流程如下：</p> <div class="fignone"><span class="figcap"><b>图1 </b>页面首次加载过程流程图</span></div> <p><span><img height="214.4625" originheight="332" originwidth="808" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.87823379193245642437012200743229:50001231000000:2800:98BD3C031E76E596DF0A0C29BD6C5191891E7F14BB8D7D40E0A4B6A380925E97.png" title="点击放大" width="523.6875"></span></p> <ul><li>在执行页面文件时，前端UI描述会在后端创建相应的FrameNode节点树。该树主要用于处理UI组件属性更新、布局测算、事件处理。每个树节点和前端UI组件是一一对应的关系。</li><li>FrameNode节点树生成之后，根节点开始创建布局任务。该任务遍历所有子节点并创建子节点的布局包装任务。布局包装任务包括执行相关测算和布局任务。</li><li>布局包装任务完成后，每个FrameNode将创建相应的渲染包装任务并进行内容绘制。</li></ul> <p>可以看到，应用启动后页面加载和渲染的性能与FrameNode树上的节点数量以及每个节点上的属性相关。因此，为缩短页面加载和布局渲染时长，在前端使用UI组件时可以考虑以下优化方案：</p> <ul><li>避免在自定义组件的生命周期内执行高耗时操作：自定义组件创建后在渲染前会调用其生命周期回调函数，若函数中包含高耗时操作将阻塞UI渲染，将增加主线程负担。</li><li>按需注册组件属性：后端在创建FrameNode节点树时，对于组件上注册的每个属性也会保存在FrameNode节点上，包括渲染类属性集合（如颜色）和布局类属性集合（如长宽，对齐方式）。在FrameNode执行布局包装任务和渲染包装任务时，属性集合将作为输入参与。因此，在应用开发中应按需注册组件属性，避免设置冗余属性。</li><li>使用@Builder函数代替自定义组件：前端定义的每一个自定义组件都会在后端FrameNode节点树上创建一对一的CustomNode类型的节点。CustomNode类作为FrameNode的子类，用于处理自定义组件相关业务逻辑。当在页面上大量使用自定义组件时，会成倍增加FrameNode节点树上CustomNode类型的节点数量，增加页面创建和渲染时长。因此，在满足业务需求的前提下，可以优先使用@Builder函数代替自定义组件。</li><li>合理使用布局容器组件：ArkUI提供了一系列布局容器组件用于开发者快速搭建页面，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-build-layout" target="_blank">构建布局</a>。不同的业务场景应选择合适的布局容器组件，并合理使用该组件的特性功能可以有效缩短页面布局时长。</li></ul> <div class="tiledSection"><h2 id="section18755173594714">避免在自定义组件的生命周期内执行高耗时操作<i class="anchor-icon anchor-icon-link" anchorid="section18755173594714" tips="复制节点链接"></i></h2><div class="fignone"><span class="figcap"><b>图2 </b>自定义组件生命周期流程图</span></div> <p><span><img height="365.306445" originheight="509" originwidth="631" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.26279760666785109990637195113496:50001231000000:2800:F6A39D1BE2E96930BB93B1AED700E269F8022110135877528C2975868B7F76C6.png" title="点击放大" width="452.865"></span></p> <p>如上图所示，自定义组件创建完成之后，在build函数执行之前，将先执行aboutToAppear()生命周期回调函数。此时若在该函数中执行耗时操作，将阻塞UI渲染，增加UI主线程负担。因此，应尽量避免在自定义组件的生命周期内执行高耗时操作。对于复杂计算的耗时场景，可以将计算结果进行缓存处理。对于不需要等待结果的高耗时任务，可以采用多线程处理该任务，通过并发的方式避免主线程阻塞。在aboutToAppear()生命周期函数内建议只做当前组件的初始化逻辑，其他业务逻辑可以按需提前或延后处理。假设在首页视频列表中的子组件内需要初始化创建一个复杂播放器对象，该对象的创建非常耗时。若在该组件的aboutToAppear()函数中创建该对象，当首页加载渲染时，列表内每个子组件的渲染都将等待相应的播放器对象初始化创建完成，此时页面加载将非常耗时甚至可能出现白屏。伪代码如下:</p> <div class="p"><strong>反例</strong><div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment.ets#L10-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">VideoCard</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Create a complex object task, if the task takes 1s to execute, the component will be rendered again after 1s</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createComplexVideoPlayer</span>();</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">CardList</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">videoList</span>: <span class="hljs-title class_">VideoItem</span>[] = <span class="hljs-title function_">getVideoList</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>, <span class="hljs-function">(<span class="hljs-params">item: VideoItem</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">VideoCard</span>({ item })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: VideoItem</span>) =&gt;</span> item.<span class="hljs-property">id</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment.ets#L10-L44" target="_blank">segment.ets</a></div></div></div></div> </div> </div> <p>对于该场景，可以考虑将创建播放器对象任务的时机延后。如，计算当前组件出现在页面中的位置，当子组件滑动到页面的三分之一处时再创建播放器对象并播放视频。此时，页面首次渲染时，不会出现主线程阻塞。示例代码如下：</p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment2.ets#L12-L52" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">VideoCard</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isVideoInit</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// Video Playback Component</span></li><li>    }</li><li>    .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">old, newValue</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isVideoInit</span>) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">positionY</span>: <span class="hljs-built_in">number</span> = newValue.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span></li><li>        <span class="hljs-keyword">if</span> (positionY &lt; screenHeight / <span class="hljs-number">3</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createComplexVideoPlayer</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isVideoInit</span> = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }</li><li>    })</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">CardList</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">videoList</span>: <span class="hljs-title class_">VideoItem</span>[] = <span class="hljs-title function_">getVideoList</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>, <span class="hljs-function">(<span class="hljs-params">item: VideoItem</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">VideoCard</span>({ item })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: VideoItem</span>) =&gt;</span> item.<span class="hljs-property">id</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment2.ets#L12-L52" target="_blank">segment2.ets</a></div></div></div></div> <p>例如在生命周期aboutToAppear中应该避免使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager" target="_blank">@ohos.resourceManager (资源管理)</a>的getXXXSync接口入参中直接使用资源信息，推荐使用资源id作为入参，推荐用法为：resourceManager.getStringSync($r('app.string.test').id)。 下面以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getstringsync10" target="_blank">getStringSync</a>为例，测试一下这两种参数在方法中的使用是否会有耗时区别。</p> <p><strong>反例</strong></p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment3.ets#L2-L28" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'getStringSync'</span>;</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'getStringSync'</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-comment">// The input parameter of the getStringSync interface uses the resource directly, without using the resource ID.</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.app_name'</span>));</li><li>    hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'getStringSync'</span>, <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment3.ets#L2-L28" target="_blank">segment3.ets</a></div></div></div></div> <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-launch-overview" target="_blank">冷启动分析：Launch分析</a>工具抓取Trace，根据hiTraceMeter性能打点，查看耗时为1.956ms。</p> <p><span><img height="213.854" originheight="302" originwidth="1319" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.86540008753622176191820960971449:50001231000000:2800:D12737A34211D5382B2208FE57D2AB1C438D494A6193FBA20C2B3655F7BF7794.png" title="点击放大" width="920"></span></p> <p><strong>正例</strong></p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment4.ets#L2-L29" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'getStringSyncAfter'</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'getStringSyncAfter'</span>, <span class="hljs-number">2</span>);</li><li>    <span class="hljs-comment">// The input parameter of the getStringSync interface uses the resource ID.</span></li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getStringSync</span>($r(<span class="hljs-string">'app.string.app_name'</span>).<span class="hljs-property">id</span>);</li><li>    hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'getStringSyncAfter'</span>, <span class="hljs-number">2</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment4.ets#L2-L29" target="_blank">segment4.ets</a></div></div></div></div> <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-launch-overview" target="_blank">冷启动分析：Launch分析</a>工具抓取Trace，根据hiTraceMeter性能打点，查看耗时为0.071ms。</p> <p></p> <p><span><img height="218.3505" originheight="308" originwidth="1317" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.33088210102788428459231497169000:50001231000000:2800:88F1FE967F0BC8084B22FFC194754D022D1BBFE37859E2A3345EEDB0A389B0DB.png" title="点击放大" width="920"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>耗时统计</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.2.3.1.1" valign="top" width="50%"><p>写法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.2.3.1.2" valign="top" width="50%"><p>耗时情况</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>资源信息为参数：getStringSync($r('app.string.app_name'))</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>1.956ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>资源ID为参数：getStringSync($r('app.string.app_name').id)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>0.071ms</p> </td> </tr>  </tbody></table></div> </div> <p>可得出结论：参数为资源信息时比参数为资源ID值时耗时更多。所以当需要使用类似方法时，使用资源ID值作为参数更优，可有效减少自定义组件生命周期耗时。</p> <div class="tiledSection"><h2 id="section14178121175019">按需注册组件属性<i class="anchor-icon anchor-icon-link" anchorid="section14178121175019" tips="复制节点链接"></i></h2><p>在使用组件开发应用UI界面时，会为每个组件设置属性，进行UI样式、行为等逻辑处理。当应用中单个组件设置了大量属性且该组件在应用中被大量使用时，单个组件的设置对应用的整体性能会产生较大影响。比如，在RN框架开发中，单个组件需要设置21个属性，且该组件在ForEach循环中使用。在该场景下，由于不知道应用实际需要使用哪些属性，因此把所有的属性通过属性方法的方式设置到组件上。而在实际使用中，大部分应用只会用到其中很少的几个属性，其他属性均维持默认值，这导致了大量属性的冗余设置。该场景示例代码片段如下：</p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment9.ets#L32-L54" data-highlighted="yes"><ol class="linenums"><li>build() {</li><li>  Stack() {</li><li>    <span class="hljs-keyword">this</span>.renderChildren()</li><li>  }</li><li>  .width(<span class="hljs-keyword">this</span>.descriptor.layoutMetrics.frame.size.width)</li><li>  .height(<span class="hljs-keyword">this</span>.descriptor.layoutMetrics.frame.size.height)</li><li>  .backgroundColor(convertColorSegmentsToString(<span class="hljs-keyword">this</span>.descriptor.props.backgroundColor))</li><li>  .position({ y: <span class="hljs-keyword">this</span>.descriptor.layoutMetrics.frame.origin.y, x: <span class="hljs-keyword">this</span>.descriptor.layoutMetrics.frame.origin.x })</li><li>  .borderWidth(<span class="hljs-keyword">this</span>.descriptor.props.borderWidth)</li><li>  .borderColor({</li><li>    left: convertColorSegmentsToString(<span class="hljs-keyword">this</span>.descriptor.props.borderColor.left),</li><li>    top: convertColorSegmentsToString(<span class="hljs-keyword">this</span>.descriptor.props.borderColor.top),</li><li>    right: convertColorSegmentsToString(<span class="hljs-keyword">this</span>.descriptor.props.borderColor.right),</li><li>    bottom: convertColorSegmentsToString(<span class="hljs-keyword">this</span>.descriptor.props.borderColor.bottom)</li><li>  })</li><li>  .borderRadius(<span class="hljs-keyword">this</span>.descriptor.props.borderRadius)</li><li>  .borderStyle(<span class="hljs-keyword">this</span>.getBorderStyle())</li><li>  .opacity(<span class="hljs-keyword">this</span>.getOpacity())</li><li>  .transform(<span class="hljs-keyword">this</span>.descriptor.props.transform != undefined ? convertMatrixArrayToMatrix4(<span class="hljs-keyword">this</span>.descriptor.props.transform) : undefined)</li><li>  .clip(<span class="hljs-keyword">this</span>.getClip())</li><li>  .hitTestBehavior(<span class="hljs-keyword">this</span>.getHitTestMode())</li><li>  .shadow(<span class="hljs-keyword">this</span>.getShadow())</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment9.ets#L32-L54" target="_blank">segment9.ets</a></div></div></div></div> <p>从该场景中可以看到，在应用开发中，当注册了大量冗余属性的组件需要在视图上批量展示时对性能有较大影响。此时，可以考虑采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier" target="_blank">动态属性设置</a>动态注册组件属性的方式，替换使用属性方法静态注册组件属性的方式。</p> <p>使用AttributeModifier动态注册组件属性相比于直接在组件上使用属性方法静态注册组件属性，主要存在以下两点区别：</p> <ul><li>动态注册属性：系统提供AttributeModifier接口，支持开发者自定义AttributeModifier接口的实现类。 当应用运行时，系统调用AttributeModifier接口的实现类中与组件样式相关的方法，在该方法内按照开发者自定义的业务逻辑动态设置组件属性。</li><li>Diff更新属性：当组件创建或者更新时，重新执行组件的样式属性对象的更新接口。属性Diff逻辑基于Map实现，其中key值是属性类型，value值是属性修改器对象。更新场景下，通过key找到对应的属性修改器对象进行Diff对比，若有更新变化再通知native侧进行属性更新。</li></ul> <p>以一个简单的公共头像组件为例演示AttributeModifier方案的性能收益。公共头像组件要求对于有用户头像的数据，界面展示用户头像图片。对于没有用户头像的数据，界面展示灰色背景和用户名的第一个字符。现列表展示1000个头像组件，界面效果如下：</p> <div class="fignone"><span class="figcap"><b>图3 </b>表格展示头像组件界面</span><p></p> <p><span><img height="545.7522" originheight="1026" originwidth="497" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.28130325771453381454571679311095:50001231000000:2800:511CE8C40327276EC962DD27080207B8E07FC266B2C69CB37E9F7EE7D793CE57.png" title="点击放大" width="266"></span></p> <p></p> </div> <div class="p">使用属性方法的方式给头像组件设置属性，代码如下：<div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment5.ets#L2-L90" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">avatarImage</span>: <span class="hljs-title class_">ResourceStr</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, name: <span class="hljs-built_in">string</span>, avatarImage: ResourceStr</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">avatarImage</span> = avatarImage;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">//create data</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DEFAULT_BACKGROUND_COLOR</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Grey</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">getUsers</span> = (<span class="hljs-params"></span>) =&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title class_">Array</span>(<span class="hljs-number">1000</span>), <span class="hljs-function">(<span class="hljs-params">item: User, i: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(</li><li>      util.<span class="hljs-title function_">generateRandomUUID</span>(),</li><li>      i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'张三'</span> : <span class="hljs-string">'李四'</span>,</li><li>      i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">''</span> : $r(<span class="hljs-string">'app.media.startIcon'</span>)</li><li>    );</li><li>  });</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">AvatarGrid</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[] = <span class="hljs-title function_">getUsers</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Grid</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>, <span class="hljs-function">(<span class="hljs-params">u: User</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">GridItem</span>() {</li><li>          <span class="hljs-title class_">Avatar</span>({ <span class="hljs-attr">user</span>: u })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">user: User</span>) =&gt;</span> user.<span class="hljs-property">id</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'1fr 1fr 1fr 1fr 1fr 1fr'</span>)</li><li>    .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">4</span>)</li><li>    .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">4</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Avatar component</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Avatar</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">avatarImage</span>) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>))</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">28</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundImage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">avatarImage</span>)</li><li>    .<span class="hljs-title function_">backgroundImageSize</span>(<span class="hljs-title class_">ImageSize</span>.<span class="hljs-property">Cover</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable constant_">DEFAULT_BACKGROUND_COLOR</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> })</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)</li><li>
</li><li>    <span class="hljs-comment">// .padding(2)</span></li><li>    <span class="hljs-comment">// .margin(2)</span></li><li>    <span class="hljs-comment">// .opacity(1)</span></li><li>    <span class="hljs-comment">// .clip(false)</span></li><li>    <span class="hljs-comment">// .layoutWeight(1)</span></li><li>    <span class="hljs-comment">// .backgroundBlurStyle(BlurStyle.NONE)</span></li><li>    <span class="hljs-comment">// .alignItems(VerticalAlign.Center)</span></li><li>    <span class="hljs-comment">// .borderWidth(1)</span></li><li>    <span class="hljs-comment">// .borderColor(Color.Pink)</span></li><li>    <span class="hljs-comment">// .borderStyle(BorderStyle.Solid)</span></li><li>    <span class="hljs-comment">// .expandSafeArea([SafeAreaType.SYSTEM])</span></li><li>    <span class="hljs-comment">// .rotate({angle: 5})</span></li><li>    <span class="hljs-comment">// .responseRegion({x: 0})</span></li><li>    <span class="hljs-comment">// .mouseResponseRegion({x: 0})</span></li><li>    <span class="hljs-comment">// .constraintSize({minWidth: 25})</span></li><li>    <span class="hljs-comment">// .hitTestBehavior(HitTestMode.Default)</span></li><li>    <span class="hljs-comment">// .backgroundImagePosition(Alignment.Center)</span></li><li>    <span class="hljs-comment">// .foregroundBlurStyle(BlurStyle.NONE)</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment5.ets#L2-L90" target="_blank">segment5.ets</a></div></div></div></div> </div> <p>将方案改为采用AttributeModifier动态注册属性的方式，需要新增自定义类实现AttributeModifier接口，并修改Avatar组件的属性注册逻辑。具体改动代码如下：</p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment6.ets#L13-L84" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 1.Custom Attribute Modifier, this class implements the AttributeModifier interface</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">RowModifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AttributeModifier</span>&lt;<span class="hljs-title class_">RowAttribute</span>&gt; {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">customImage</span>: <span class="hljs-title class_">ResourceStr</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">RowModifier</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setCustomImage</span>(<span class="hljs-params">customImage: ResourceStr</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">customImage</span> = customImage;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Adopting a singleton pattern avoids creating a new modifier for each component, increasing the performance overhead incurred by creating the</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">RowModifier</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">RowModifier</span>.<span class="hljs-property">instance</span>) {</li><li>      <span class="hljs-title class_">RowModifier</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowModifier</span>();</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">RowModifier</span>.<span class="hljs-property">instance</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 2.Implement the applyNormalAttribute method of the AttributeModifier interface to customize the logic of attribute setting.</span></li><li>  <span class="hljs-title function_">applyNormalAttribute</span>(<span class="hljs-params">instance: RowAttribute</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">customImage</span>) {</li><li>      instance.<span class="hljs-title function_">backgroundImage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">customImage</span>);</li><li>      instance.<span class="hljs-title function_">backgroundImageSize</span>(<span class="hljs-title class_">ImageSize</span>.<span class="hljs-property">Cover</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      instance.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>);</li><li>      instance.<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>);</li><li>      <span class="hljs-comment">// instance.padding(2)</span></li><li>      <span class="hljs-comment">// instance.margin(2)</span></li><li>      <span class="hljs-comment">// instance.opacity(1)</span></li><li>      <span class="hljs-comment">// instance.clip(false)</span></li><li>      <span class="hljs-comment">// instance.layoutWeight(1)</span></li><li>      <span class="hljs-comment">// instance.backgroundBlurStyle(BlurStyle.NONE)</span></li><li>      <span class="hljs-comment">// instance.alignItems(VerticalAlign.Center)</span></li><li>      <span class="hljs-comment">// instance.borderWidth(1)</span></li><li>      <span class="hljs-comment">// instance.borderColor(Color.Pink)</span></li><li>      <span class="hljs-comment">// instance.borderStyle(BorderStyle.Solid)</span></li><li>      <span class="hljs-comment">// instance.expandSafeArea([SafeAreaType.SYSTEM])</span></li><li>      <span class="hljs-comment">// instance.rotate({ angle: 5 })</span></li><li>      <span class="hljs-comment">// instance.responseRegion({x: 0})</span></li><li>      <span class="hljs-comment">//instance.mouseResponseRegion({x: 0})</span></li><li>      <span class="hljs-comment">// instance.constraintSize({minWidth: 25})</span></li><li>      <span class="hljs-comment">// instance.hitTestBehavior(HitTestMode.Default)</span></li><li>      <span class="hljs-comment">//instance.backgroundImagePosition(Alignment.Center)</span></li><li>      <span class="hljs-comment">//instance.foregroundBlurStyle(BlurStyle.NONE)</span></li><li>    }</li><li>    instance.<span class="hljs-title function_">size</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> });</li><li>    instance.<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>);</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Avatar</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">avatarImage</span>) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>))</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">28</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 3.Pass a custom RowModifier class as a parameter to enable on-demand property registration</span></li><li>    .<span class="hljs-title function_">attributeModifier</span>(<span class="hljs-title class_">RowModifier</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">setCustomImage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">avatarImage</span>))</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment6.ets#L13-L84" target="_blank">segment6.ets</a></div></div></div></div> <p>对于上述两种方案，逐渐增加注册的属性个数，通过DevEco Studio提供的Launch场景分析能力获取两个方案的页面加载耗时（PageRouterManager::LoadPage）和应用侧首帧耗时（First Frame - App Phase），对比如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>静态注册属性和动态注册属性在不同属性数量下耗时</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.23.13.2.10.1.1" valign="top">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" colspan="4" id="mcps1.3.23.13.2.10.1.2" valign="top"><p>静态注册属性</p> </th> <th align="left" class="cellrowborder" colspan="4" id="mcps1.3.23.13.2.10.1.3" valign="top"><p>动态注册属性</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="19.458054194580544%"><p>注册的属性个数</p> </td> <td class="cellrowborder" valign="top" width="8.809119088091192%"><p>6个</p> </td> <td class="cellrowborder" valign="top" width="9.57904209579042%"><p>12个</p> </td> <td class="cellrowborder" valign="top" width="9.799020097990201%"><p>18个</p> </td> <td class="cellrowborder" valign="top" width="9.839016098390161%"><p>24个</p> </td> <td class="cellrowborder" valign="top" width="11.228877112288771%"><p>6个</p> </td> <td class="cellrowborder" valign="top" width="11.198880111988801%"><p>12个</p> </td> <td class="cellrowborder" valign="top" width="10.4989501049895%"><p>18个</p> </td> <td class="cellrowborder" valign="top" width="9.58904109589041%"><p>24个</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.458054194580544%"><p>PageRouterManager::LoadPage</p> </td> <td class="cellrowborder" valign="top" width="8.809119088091192%"><p>639ms900μs</p> </td> <td class="cellrowborder" valign="top" width="9.57904209579042%"><p>668ms624μs</p> </td> <td class="cellrowborder" valign="top" width="9.799020097990201%"><p>719ms139μs</p> </td> <td class="cellrowborder" valign="top" width="9.839016098390161%"><p>764ms437μs</p> </td> <td class="cellrowborder" valign="top" width="11.228877112288771%"><p>640ms989μs</p> </td> <td class="cellrowborder" valign="top" width="11.198880111988801%"><p>662ms112μs</p> </td> <td class="cellrowborder" valign="top" width="10.4989501049895%"><p>705ms407μs</p> </td> <td class="cellrowborder" valign="top" width="9.58904109589041%"><p>717ms294μs</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.458054194580544%"><p>First Frame - App Phase</p> </td> <td class="cellrowborder" valign="top" width="8.809119088091192%"><p>45ms554μs</p> </td> <td class="cellrowborder" valign="top" width="9.57904209579042%"><p>45ms638μs</p> </td> <td class="cellrowborder" valign="top" width="9.799020097990201%"><p>52ms918μs</p> </td> <td class="cellrowborder" valign="top" width="9.839016098390161%"><p>52ms643μs</p> </td> <td class="cellrowborder" valign="top" width="11.228877112288771%"><p>44ms603μs</p> </td> <td class="cellrowborder" valign="top" width="11.198880111988801%"><p>43ms923μs</p> </td> <td class="cellrowborder" valign="top" width="10.4989501049895%"><p>46ms709μs</p> </td> <td class="cellrowborder" valign="top" width="9.58904109589041%"><p>46ms355μs</p> </td> </tr>  </tbody></table></div> </div> <div class="fignone"><span class="figcap"><b>图4 </b>静态注册属性和动态注册属性在不同属性数量下LoadPage耗时</span><br><span><img height="311.169061" originheight="452" originwidth="752" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.95046397055896622219088482469937:50001231000000:2800:42344D217F3BDFA22866EEF9ED14F23261603C4C643F0C3760D1BA44CC8F80EF.png" title="点击放大" width="517.705559"></span></div> <div class="fignone"><span class="figcap"><b>图5 </b>静态注册属性和动态注册属性在不同属性数量下First Frame - App Phase耗时</span><br><span><img height="312.969615" originheight="452" originwidth="752" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.52176820828546314168301451721098:50001231000000:2800:DCF2AE0161C8CB153D0BC89E28E4D9E3D8A7EB19E47B0A4BE5DDA6C4C3172C4A.png" title="点击放大" width="520.6980590000001"></span></div> <p>可以看到，当注册的属性个数较少时，使用动态注册的方案收益并不明显。当注册的属性个数递增时，动态注册的收益效果同步线性递增。</p> </div> <div class="tiledSection"><h2 id="section18773182614502">优先使用@Builder方法代替自定义组件<i class="anchor-icon anchor-icon-link" anchorid="section18773182614502" tips="复制节点链接"></i></h2><p>在ArkUI中使用自定义组件时，在build阶段将在后端FrameNode树创建一个相应的CustomNode节点，在渲染阶段时也会创建对应的RenderNode节点，如下图所示。</p> <div class="fignone"><span class="figcap"><b>图6 </b>前后端UI组件树关系图</span><br><span><img height="360.1906" originheight="663" originwidth="1575" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.15092665409815702377254298265834:50001231000000:2800:52AD6180DCF32455E44DA1FC1E882CA1042B104D8B79C8DBFFDDF1C19EE20AAD.png" title="点击放大" width="851.2"></span></div> <p></p> <ul><li>前端UI描述结构会在后端创建相应的FrameNode节点树；</li><li>FrameNode节点树主要用于处理UI组件属性更新、布局测算、事件处理等业务逻辑；</li><li>CustomNode作为FrameNode的子类，用于处理自定义组件相关业务逻辑，比如执行build函数。</li><li>FrameNode节点树在渲染阶段生成后端渲染树进行UI渲染。</li></ul> <p>因此，在应用开发时，减少自定义组件的使用，尤其是自定义组件在循环中的使用，将成倍减少FrameNode节点树上CustomNode节点数量，有效缩短页面的加载和渲染时长。当在应用中使用自定义组件时，可以优先考虑使用@Builder函数代替自定义组件，@Builder函数不会在后端FrameNode节点树上创建一个新的树节点。如，在使用ForEach循环展示卡片列表信息时，若卡片组件仅作展示，无需使用自定义组件的复杂能力如生命周期函数时，可以创建一个@Builder函数代替创建自定义卡片组件，界面展示如下：</p> <div class="fignone"><span class="figcap"><b>图7 </b>卡片列表界面</span></div> <p></p> <p><span><img height="545.7522" originheight="1026" originwidth="497" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.78267244770585053928097106989494:50001231000000:2800:E6BDACAB492C8CA27AA550A624CC3B3484E227F3266560C3998824683154E2D6.png" title="点击放大" width="266"></span></p> <p></p> <p>使用自定义组件方案，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment7.ets#L2-L80" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">util</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-variable">id</span>: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;</li><li>  <span class="hljs-variable">age</span>?: <span class="hljs-title class_">number</span>;</li><li>  <span class="hljs-variable">avatarImage</span>?: <span class="hljs-title class_">ResourceStr</span>;</li><li>  <span class="hljs-comment">//introduction: string;</span></li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// create data</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DEFAULT_BACKGROUND_COLOR</span> = <span class="hljs-variable">Color</span>.<span class="hljs-variable">Pink</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">getUsers</span> = () =&gt; {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">USERS</span>: <span class="hljs-title class_">User</span>[] = [{</li><li>    <span class="hljs-variable">id</span>: <span class="hljs-string">'1'</span>,</li><li>    <span class="hljs-variable">name</span>: <span class="hljs-string">'张三'</span>,</li><li>  }, {</li><li>    <span class="hljs-variable">id</span>: <span class="hljs-string">'2'</span>,</li><li>    <span class="hljs-variable">name</span>: <span class="hljs-string">'李四'</span>,</li><li>  }, {</li><li>    <span class="hljs-variable">id</span>: <span class="hljs-string">'3'</span>,</li><li>    <span class="hljs-variable">name</span>: <span class="hljs-string">'王五'</span>,</li><li>  }];</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">Array</span>.<span class="hljs-keyword">from</span>(<span class="hljs-title function_">Array</span>(<span class="hljs-number">30</span>), (<span class="hljs-variable">item</span>: <span class="hljs-title class_">User</span>, <span class="hljs-variable">i</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-keyword">return</span> {</li><li>      <span class="hljs-variable">id</span>: <span class="hljs-title class_">util</span>.<span class="hljs-title class_">generateRandomUUID</span>(),</li><li>      <span class="hljs-variable">name</span>: <span class="hljs-title class_">USERS</span>[<span class="hljs-title class_">i</span>%<span class="hljs-number">3</span>].<span class="hljs-variable">name</span>,</li><li>      <span class="hljs-variable">avatarImage</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">startIcon</span>'),</li><li>      <span class="hljs-variable">age</span>: <span class="hljs-number">18</span> + <span class="hljs-title class_">i</span></li><li>    } <span class="hljs-keyword">as</span> <span class="hljs-variable">User</span>;</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-comment">// User Card List Component</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserCardList</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">users</span>: <span class="hljs-title class_">User</span>[] = <span class="hljs-title function_">getUsers</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">8</span> }) {</li><li>      <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">users</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">User</span>) =&gt; {</li><li>        <span class="hljs-title function_">ListItem</span>() {</li><li>          <span class="hljs-title function_">UserCard</span>({ <span class="hljs-variable">name</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">name</span>, <span class="hljs-variable">age</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">age</span>, <span class="hljs-variable">avatarImage</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">avatarImage</span> })</li><li>        }</li><li>      }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">User</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-variable">ListItemAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// User Card Customization Component</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserCard</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">avatarImage</span>: <span class="hljs-title class_">ResourceStr</span>;</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>;</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">age</span>: <span class="hljs-title class_">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Row</span>() {</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">avatarImage</span>)</li><li>          .<span class="hljs-title function_">size</span>({ <span class="hljs-variable">width</span>: <span class="hljs-number">50</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">50</span> })</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">8</span>)</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">name</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      }</li><li>      <span class="hljs-title function_">Text</span>(`<span class="hljs-variable">age</span>：${<span class="hljs-keyword">this</span>.<span class="hljs-variable">age</span>.<span class="hljs-title function_">toString</span>()}`)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">DEFAULT_BACKGROUND_COLOR</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">SpaceBetween</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">66</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment7.ets#L2-L80" target="_blank">segment7.ets</a></div></div></div></div> <p>改用@Builder函数的方式代替自定义组件UserCard的方案，具体修改的代码如下:</p> <div class="screenLinkPre"><div _ngcontent-yfq-c106="" class="highlight-div"><div _ngcontent-yfq-c106="" class="highlight-div-header"><div _ngcontent-yfq-c106="" class="highlight-div-header-left"><div _ngcontent-yfq-c106="" class="handle-button expand-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yfq-c106="" class="highlight-div-header-right"><div _ngcontent-yfq-c106="" class="handle-button ai-button"></div><div _ngcontent-yfq-c106="" class="handle-button line-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yfq-c106="" class="handle-button theme-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yfq-c106="" class="handle-button copy-button"><div _ngcontent-yfq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yfq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment8.ets#L13-L51" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 1. Customizing @Builder Function Components</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">UserCardBuilder</span>(<span class="hljs-variable">name</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">age</span>?: <span class="hljs-title class_">number</span>, <span class="hljs-variable">avatarImage</span>?: <span class="hljs-title class_">ResourceStr</span>) {</li><li>  <span class="hljs-title function_">Row</span>() {</li><li>    <span class="hljs-title function_">Row</span>() {</li><li>      <span class="hljs-title function_">Image</span>(<span class="hljs-variable">avatarImage</span>)</li><li>        .<span class="hljs-title function_">size</span>({ <span class="hljs-variable">width</span>: <span class="hljs-number">50</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">50</span> })</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">8</span>)</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-variable">name</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>    }</li><li>    <span class="hljs-title function_">Text</span>(`<span class="hljs-variable">age</span>：${<span class="hljs-variable">age</span>?.<span class="hljs-title function_">toString</span>()}`)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>  }</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Blue</span>)</li><li>  .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">SpaceBetween</span>)</li><li>  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>  .<span class="hljs-title function_">padding</span>(<span class="hljs-number">8</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">66</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">UserCardList</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">users</span>: <span class="hljs-title class_">User</span>[] = <span class="hljs-title function_">getUsers</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">8</span> }) {</li><li>      <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">users</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">User</span>) =&gt; {</li><li>        <span class="hljs-title function_">ListItem</span>() {</li><li>          <span class="hljs-comment">// 2. Using the @Builder function in a build function</span></li><li>          <span class="hljs-title function_">UserCardBuilder</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">name</span>, <span class="hljs-variable">item</span>.<span class="hljs-variable">age</span>, <span class="hljs-variable">item</span>.<span class="hljs-variable">avatarImage</span>)</li><li>        }</li><li>      }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">User</span>) =&gt; <span class="hljs-variable">item</span>.<span class="hljs-variable">id</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-variable">ListItemAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/UI_Component_Performance_Optimization/entry/src/main/ets/segment/segment8.ets#L13-L51" target="_blank">segment8.ets</a></div></div></div></div> <p>将组件数量从30个递增到3000个，通过profiler获取页面加载标签PageRouterManager::LoadPage和页面UI刷新任务标签UITaskScheduler::FlushTask的耗时，对比两种方案的耗时如下：</p> <div class="fignone"><span class="figcap"><b>图8 </b>两种方案LoadPage标签耗时对比</span><br><span><img height="307.584179" originheight="452" originwidth="752" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.22577194628172772687670271448530:50001231000000:2800:13AE1A084B92E74ADF00A06EA58FB108CEDAF39482290F95A310D0EC38D83F27.png" title="点击放大" width="511.71750000000003"></span></div> <div class="fignone"><span class="figcap"><b>图9 </b>两种方案UITaskSchedule标签耗时对比</span><br><span><img height="306.22146100000003" originheight="452" originwidth="752" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163424.42827361204351649672030532267052:50001231000000:2800:31EA3A6C652DB57EF7DD833FBEAEE7DDC8794A5865032B9FCF9425F0821A991F.png" title="点击放大" width="509.46514500000006"></span></div> <p>通过对比图可以看到，@Builder方案在页面加载和刷新UI页面（包括布局、渲染和动画）方面优于自定义组件方案。随着组件个数增加，收益也线性增加。</p> </div> <div class="tiledSection"><h2 id="section1992221195313">合理使用布局容器组件<i class="anchor-icon anchor-icon-link" anchorid="section1992221195313" tips="复制节点链接"></i></h2><p>对于需要展示大量组件的场景，通常会使用布局容器组件，以达到快速实现页面布局的需求。在使用布局容器组件时，由于一次需要展示多个组件，可能出现首帧耗时过长甚至掉帧问题。此时可以考虑对容器组件内的子组件进行按需加载或懒加载等处理，对于相同结构的组件也可以使用组件复用能力。针对每个布局容器组件的性能优化可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-improve-layout-performance" target="_blank">布局优化指导</a>。</p> </div> <div class="tiledSection"><h2 id="section1078520389541">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1078520389541" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/ArkUI/UI_Component_Performance_Optimization" target="_blank">UI组件性能优化</a></li></ul> </div> </div> <div></div></div>