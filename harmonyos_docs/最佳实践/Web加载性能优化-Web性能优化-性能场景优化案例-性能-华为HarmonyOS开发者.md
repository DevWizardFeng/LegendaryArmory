<h1 _ngcontent-ofl-c119="" class="doc-title ng-star-inserted" title="Web加载性能优化"> Web加载性能优化 </h1>

<div _ngcontent-ofl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section4786113852512">概述<i class="anchor-icon anchor-icon-link" anchorid="section4786113852512" tips="复制节点链接"></i></h2>          <p>ArkWeb是一个Web组件平台，旨在为应用程序提供展示Web页面内容的功能，并为开发者提供丰富的能力，如页面加载、页面交互和页面调试。在当前的数字化时代，页面加载速度直接影响应用的流畅性，进而影响用户对应用的印象和体验。迅速加载并展示页面，可以吸引用户留在应用上，减少等待时间，从而提升用户满意度。</p>     <p>Web页面显示过程包含DNS解析、建立连接等阶段，其速度受网络延迟、资源大小等因素影响。为提升Web页面显示速度，开发者可以从Web页面加载、资源下载和页面渲染等方面进行优化，提高性能和用户体验。</p>     <p>本文将介绍以下常见的优化方式。</p>     <ul>      <li>Web页面加载优化：提高页面加载速度能直接提升应用的流畅性。</li>      <li>JSBridge：通过JSBridge通信，可以解决ArkTS环境的冗余切换，避免造成UI阻塞。</li>      <li>同层渲染：将页面元素分层渲染，减少页面重绘和重排次数，提升页面渲染效率。</li>     </ul>    </div>    <p>ArkWeb（方舟Web）为开发者提供了优化页面显示速度的方法。采取这些优化方式可以改善应用性能和用户体验，提升用户满意度和留存率。</p>    <div class="tiledSection">     <h2 id="section128761465256">Web页面加载性能优化指导<i class="anchor-icon anchor-icon-link" anchorid="section128761465256" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section8756342319" class="firsth2">Web页面加载流程<i class="anchor-icon anchor-icon-link" anchorid="section8756342319" tips="复制节点链接"></i></h3>          <p>Web页面加载流程包括网络连接、资源下载（包括等待网络资源下载）、DOM解析、JavaScript代码编译执行、渲染等。页面加载中，比较关键的节点有网络连接、资源下载和完整的页面渲染，本文将主要对以下关键节点的耗时进行优化。</p>     <ul>      <li>预启动Web渲染进程：预启动Web渲染进程指在业务需要的Web页面启动前，加载一个空白Web组件。当至少一个Web组件存活时，Web渲染进程将一直存在，从而节省后续启动Web组件时拉起渲染进程的时间，加快页面加载速度。</li>      <li>预解析：预解析是预先对DNS进行解析，以节省解析时间，优化Web加载速度。</li>     </ul>     <ul>      <li>预连接：预连接包含预解析步骤，可在用户请求页面前完成DNS解析和socket连接建立。这样，用户真正请求页面时，服务器与浏览器之间已建立连接，可直接传输数据，减少网络延迟，提升页面加载速度。</li>      <li>预下载：预下载是指在页面加载之前提前下载所需的资源，以避免资源下载导致的阻塞和延迟。通过预下载，浏览器可以在加载页面时提前获取所需的资源，如图片、CSS文件和JavaScript文件。提前下载这些资源可以避免页面渲染因资源未加载完成而延迟的情况。合理使用预下载技术，可以加快页面加载速度，提升用户体验。</li>      <li>预渲染：预渲染是指在后台提前渲染需要加载的页面，完成整个页面加载流程。当访问该页面时，可直接切换至前台展示，实现页面“秒开”。预渲染需在DOM解析、JavaScript执行和页面渲染前完成所需资源的下载，否则可能导致页面内容不完整或渲染错误。预渲染可显著减少页面加载时间，尤其适用于资源密集型或交互复杂的页面。</li>      <li>预取POST：当即将加载的Web页面中存在POST请求且该请求耗时较长时，可以预先获取POST请求的数据，从而消除等待POST请求数据下载完成的耗时。当用户实际发起POST请求时，系统将拦截并替换预取的数据，从而加快页面加载速度，提升用户体验。</li>      <li>预编译JavaScript文件生成字节码缓存：将JavaScript文件编译成字节码并缓存到本地，首次加载页面时可节省编译时间。</li>      <li>资源拦截替换时，JavaScript生成字节码缓存（Code Cache）将JavaScript文件编译成字节码并缓存到本地，节省页面非首次加载时的编译时间。</li>      <li>离线资源免拦截注入：在页面加载前，将所需的图片、样式表和脚本资源注入内存缓存，以减少首次加载时的网络请求时间。</li>      <li>资源拦截替换加速：资源拦截替换加速支持ArrayBuffer格式的入参，开发者可直接使用ArrayBuffer格式的数据进行拦截替换，无需在应用侧进行格式转换。</li>     </ul>     <div class="fignone">      <span class="figcap"><b>图1 </b>Web页面加载流程</span>      <br><span><img height="318.70923" originheight="611" originwidth="1490" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.95428648056100909934137321522871:50001231000000:2800:D53C87CB3A4D11453D0951FA07F03B4A8C6A78658A22848B9F70EA2A7CB55DE6.png" title="点击放大" width="773.4954150000001"></span>     </div>     <p><strong>由于所有的关键点都是建立在预处理的思路上，因此如果用户实际并未打开预处理的Web页面，将会造成额外的资源消耗。</strong>下表列出了各优化方法的具体效果、代价和适用场景对比。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <caption>        <b>表1 </b>优化方法对比表格       </caption>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.2.6.1.1" valign="top" width="23.1%">          <p>优化方法</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.2.6.1.2" valign="top" width="23.14%">          <p><strong>效果</strong>（优化数据仅供参考）</p></th>         <th align="center" class="cellrowborder" id="mcps1.3.4.7.2.6.1.3" valign="top" width="7.5200000000000005%">          <p>适配难度</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.2.6.1.4" valign="top" width="23.76%">          <p>影响</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.2.6.1.5" valign="top" width="22.48%">          <p><strong>适用场景</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预启动Web渲染进程</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除拉起Web渲染进程的耗时，约140ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>低</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的内存、算力。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预解析</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除用户真正启动的Web网页域名解析的耗时，约66ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>低</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>可能存在提前解析了用户未启动的Web网页域名。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>中高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预连接</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除用户真正启动的Web网页域名解析、网络连接耗时，约80ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>低</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>可能存在提前连接了用户未启动Web网页资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>中高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预下载</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除网络GET请求下载带来的耗时及阻塞DOM解析、JavaScript执行的耗时，约641ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>低</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的网络连接、下载、存储资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预渲染</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>能实现页面“秒开”效果，将页面加载时延降到最低，约486ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>中</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的网络连接、下载、存储和渲染消耗。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>超高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预取POST</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除网络POST请求下载带来的耗时及阻塞DOM解析、JavaScript执行的耗时，约313ms。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>中</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的网络连接、下载、存储资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>高概率被使用的Web页面。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>预编译JavaScript生成字节码缓存</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除JavaScript编译的耗时，优化数据根据JS资源大小而定，5.76Mb资源预编译时约有2915ms收益。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>中</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的存储资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>加载HTTP/HTTPS协议JavaScript的Web页面，在前两次优化加载性能。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>资源拦截替换的JavaScript生成字节码缓存</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除JavaScript编译的耗时，优化数据根据JS资源大小而定，2.4Mb资源拦截替换时约有67ms收益。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>高</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的存储资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>加载自定义协议JavaScript的Web页面，在第三次及以后优化加载性能。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>离线资源免拦截注入</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>消除资源加载到内存的耗时，优化数据根据资源大小而定，25Mb资源注入时约有1240ms收益。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>中</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>额外的存储资源。</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>高概率被使用的资源。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="23.1%">          <p>资源拦截替换加速</p></td>         <td class="cellrowborder" valign="top" width="23.14%">          <p>节省了转换时间，同时对ArrayBuffer格式的数据传输方式进行了优化，优化数据根据资源大小而定，10Kb资源拦截替换时约有20ms收益。</p></td>         <td align="center" class="cellrowborder" valign="top" width="7.5200000000000005%">          <p>低</p></td>         <td class="cellrowborder" valign="top" width="23.76%">          <p>-</p></td>         <td class="cellrowborder" valign="top" width="22.48%">          <p>ArrayBuffer格式的数据传输。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section2446239101011">预启动Web渲染进程<i class="anchor-icon anchor-icon-link" anchorid="section2446239101011" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>预启动Web渲染进程指用户可以在业务需要的Web页面启动前，加载一个空白的Web组件，在至少一个Web组件存活时，Web渲染进程会一直存在，节省了用户后续启动Web组件拉起渲染进程的时间，加快页面加载速度。</p>     <p>建议在Web页面启动前执行预启动Web渲染进程，例如在应用冷启动阶段或广告展示阶段。如果无法在冷启动期间预启动Web渲染进程，建议在系统空闲时间进行预启动。</p>     <div class="fignone">      <span class="figcap"><b>图2 </b>预启动Web渲染流程</span>      <br><span><img height="332.685269" originheight="629" originwidth="1495" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.97384062986973496447038187229564:50001231000000:2800:E9B9A63BAA427E29B0B9776673513902DB0674FEE447FBF41DD2F49360915AA6.png" title="点击放大" width="780.0450000000001"></span>     </div>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ol>       <li>该方案通过创建一个空白的ArkWeb组件来预启动Web渲染进程。额外创建ArkWeb组件会消耗内存和算力，预创建一个空白的Web组件大约消耗200Mb内存。因此，建议后续页面加载复用预创建的Web组件。</li>       <li>应用全局共享一个Web渲染进程，仅在所有Web组件销毁时，该进程才会终止。因此，建议应用确保至少有一个Web组件处于活动状态。</li>      </ol>     </div></div></div>    <p><strong>实践案例</strong></p>    <p>【不推荐用法】</p>    <p>点击跳转到下一页，直接加载Web页面。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>该示例涉及网络地址访问，需配置网络权限。</p>     </div></div></div>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Index.ets#L6-L26" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-variable">pageInfos</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>()</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Navigation</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>) {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'加载测试页面'</span>, { <span class="hljs-variable">stateEffect</span>: <span class="hljs-keyword">true</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-comment">// Put the NavDestination page information specified by name on the stack.</span></li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-variable">name</span>: <span class="hljs-string">'pageOne'</span> })</li><li>          })</li><li>      }</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Index.ets#L6-L26" target="_blank">Index.ets</a></div></div></div></div>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/view/Second.ets#L2-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Second.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span></li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PageOneBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Second</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Second</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Output Web page start loading time</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load page start time: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-comment">// Please replace the URL with the real address.</span></li><li>          <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span> })</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>              <span class="hljs-comment">// Output Web page loading completion time</span></li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load page end time: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);</li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/view/Second.ets#L2-L37" target="_blank">Second.ets</a></div></div></div></div>    <p>点击“加载测试页面”按钮，页面加载完成耗时1066ms，具体如下图所示：</p>    <p><span><img originheight="105" originwidth="821" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.06374915426166072648351483142268:50001231000000:2800:91B2798CC5AFDD656E7C11799F43F5A79A25E83F9CE736A1EF884E11E5894E71.png" width="821" height="105"></span></p>    <p></p>    <p>【推荐用法】</p>    <p>在后台创建一个ArkWeb组件来预先启动用于渲染的Web渲染进程。</p>    <ol>     <li>创建Node和对应的NodeController。在后台创建ArkWeb组件。      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateNodeController.ets#L2-L116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Create NodeController</span></li><li><span class="hljs-comment">// common.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">Size</span>, <span class="hljs-title class_">FrameNode</span> }  <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// Specific component contents of dynamic components in @Builder</span></li><li><span class="hljs-comment">// Data is a parameter encapsulation class.</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span>{</li><li>  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">shouldInactive</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">WebBuilder</span>(<span class="hljs-params">data:Data</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: data.<span class="hljs-property">url</span>, <span class="hljs-attr">controller</span>: data.<span class="hljs-property">controller</span> })</li><li>      .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">zoomAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">mixedMode</span>(<span class="hljs-title class_">MixedMode</span>.<span class="hljs-property">All</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">onPageBegin</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        data.<span class="hljs-property">controller</span>.<span class="hljs-title function_">onActive</span>();</li><li>      })</li><li>      .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load page end time: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">onFirstMeaningfulPaint</span>(<span class="hljs-function">() =&gt;</span>{</li><li>        <span class="hljs-keyword">if</span> (!shouldInactive) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-comment">// stop render</span></li><li>        data.<span class="hljs-property">controller</span>.<span class="hljs-title function_">onInactive</span>();</li><li>        shouldInactive = <span class="hljs-literal">false</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-comment">// Used to control and feedback the behavior of nodes on the corresponding NodeContainer, which needs to be used together with NodeContainer</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;<span class="hljs-title class_">Data</span>[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">root</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-comment">// The method that must be overridden is used to build the number of nodes and return the nodes to be mounted in the corresponding NodeContainer.</span></li><li>  <span class="hljs-comment">// //Called when the corresponding NodeContainer is created, or refreshed by calling the rebuild method.</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">' uicontext is undefined : '</span>+ (uiContext === <span class="hljs-literal">undefined</span>));</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>()?.<span class="hljs-title function_">getParent</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">FrameNode</span>;</li><li>      <span class="hljs-keyword">if</span> (parent) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(parent.<span class="hljs-title function_">getInspectorInfo</span>()));</li><li>        parent.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span> = <span class="hljs-literal">null</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>      <span class="hljs-comment">// Returns the FrameNode node</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>;</li><li>    }</li><li>    <span class="hljs-comment">// Returns a null node that controls the dynamic component to be unbound.</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>  }</li><li>  <span class="hljs-comment">// Callback when layout size changes.</span></li><li>  <span class="hljs-title function_">aboutToResize</span>(<span class="hljs-attr">size</span>: <span class="hljs-title class_">Size</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToResize width : '</span> + size.<span class="hljs-property">width</span>  +  <span class="hljs-string">' height : '</span> + size.<span class="hljs-property">height</span> )</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Call back when the NodeContainer corresponding to the controller is in Appear.</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToAppear'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Call back when the NodeContainer corresponding to the controller is Disappear.</span></li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToDisappear'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// This function is a user-defined function and can be used as an initialization function.</span></li><li>  <span class="hljs-comment">// Initialize builderNode through UIContext, and then initialize the contents in @Builder through the Build interface in BuilderNode.</span></li><li>  <span class="hljs-title function_">initWeb</span>(<span class="hljs-attr">url</span>:<span class="hljs-built_in">string</span>, <span class="hljs-attr">uiContext</span>:<span class="hljs-title class_">UIContext</span>, <span class="hljs-attr">control</span>:<span class="hljs-title class_">WebviewController</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> != <span class="hljs-literal">null</span>)</li><li>    {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// Creating a node requires uiContext.</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext)</li><li>    <span class="hljs-comment">// Create dynamic Web components</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;<span class="hljs-title class_">Data</span>[]&gt;(<span class="hljs-title class_">WebBuilder</span>), { <span class="hljs-attr">url</span>:url, <span class="hljs-attr">controller</span>:control })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Create the NodeController needed for Map saving.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title class_">NodeMap</span>:<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyNodeController</span> | <span class="hljs-literal">undefined</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li><span class="hljs-comment">// Create WebViewController needed for Map saving.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">controllerMap</span>:<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">WebviewController</span> | <span class="hljs-literal">undefined</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>
</li><li><span class="hljs-comment">// Initialization requires UIContext to be obtained in Ability.</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createNWeb</span> = (<span class="hljs-params">url: <span class="hljs-built_in">string</span>, uiContext: UIContext</span>) =&gt; {</li><li>  <span class="hljs-comment">// Create NodeController</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">baseNode</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>() ;</li><li>  <span class="hljs-comment">// Initialize a custom web component</span></li><li>  baseNode.<span class="hljs-title function_">initWeb</span>(url, uiContext, controller);</li><li>  controllerMap.<span class="hljs-title function_">set</span>(url, controller)</li><li>  <span class="hljs-title class_">NodeMap</span>.<span class="hljs-title function_">set</span>(url, baseNode);</li><li>}</li><li>
</li><li><span class="hljs-comment">// Customize to get the NodeController interface.</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getNWeb = (url : <span class="hljs-built_in">string</span>) : <span class="hljs-title class_">MyNodeController</span> | <span class="hljs-function"><span class="hljs-params">undefined</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">NodeMap</span>.<span class="hljs-title function_">get</span>(url);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateNodeController.ets#L2-L116" target="_blank">CreateNodeController.ets</a></div></div></div></div></li>     <li>创建载体，并创建ArkWeb组件，加载一个blank页面。      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/entryability/EntryAbility.ets#L2-L14" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Carrier Ability</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { createNWeb } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/common'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// Create an empty ArkWeb dynamic component in advance (need to pass in UIContext) and start the rendering process.</span></li><li>      <span class="hljs-title function_">createNWeb</span>(<span class="hljs-string">'about:blank'</span>, windowStage.<span class="hljs-title function_">getMainWindowSync</span>().<span class="hljs-title function_">getUIContext</span>());</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/entryability/EntryAbility.ets#L2-L14" target="_blank">EntryAbility.ets</a></div></div></div></div></li>     <li>创建需要加载的ArkWeb组件。      <p>首页：</p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Index.ets#L6-L26" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-variable">pageInfos</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">NavPathStack</span>()</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Navigation</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>) {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'加载测试页面'</span>, { <span class="hljs-variable">stateEffect</span>: <span class="hljs-keyword">true</span>, <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-comment">// Put the NavDestination page information specified by name on the stack.</span></li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-variable">name</span>: <span class="hljs-string">'pageOne'</span> })</li><li>          })</li><li>      }</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Index.ets#L6-L26" target="_blank">Index.ets</a></div></div></div></div>      <div class="p">       跳转测试页面：       <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Second.ets#L2-L32" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Second.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { getNWeb } <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PageOneBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Second</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Second</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Output Web page start loading time</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load page start time: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-comment">// Please replace the URL with the real address.</span></li><li>          <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-title function_">getNWeb</span>(<span class="hljs-string">'https://www.example.com'</span>))</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/Second.ets#L2-L32" target="_blank">Second.ets</a></div></div></div></div>      </div></li>    </ol>    <p></p>    <p>点击“加载测试页面”按钮，页面加载完成耗时927ms，具体如图所示：</p>    <p><span><img originheight="99" originwidth="851" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.27075398191603162110035805486759:50001231000000:2800:10E8F60A4D13888D211AD62D1143F2CF2452FBF8F654519F96F7DD1D31A55607.png" width="851" height="99"></span></p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>开发者可以在后续页面操作中选择是否复用ArkWeb组件。</p>     </div></div></div>    <p></p>    <p><strong>总结</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.25.1.4.1.1" valign="top" width="33.33333333333333%">         <p>下一页加载方式</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.25.1.4.1.2" valign="top" width="33.33333333333333%">         <p>耗时(局限不同设备和场景，数据仅供参考)</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.25.1.4.1.3" valign="top" width="33.33333333333333%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>直接加载Web页面</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>1066ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>页面加载时拉起渲染进程，增加加载时间</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>使用预启动Web渲染进程方案</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>927ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>在闲时提前拉起渲染进程，优化启动时间</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h3 id="section29621418112311">预解析和预连接优化<i class="anchor-icon anchor-icon-link" anchorid="section29621418112311" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>应用启动和UIAbility的onCreate生命周期完成后，Web组件才能初始化和运行。ArkWeb组件运行阶段包括onAppear、load、onPageBegin、onPageEnd步骤。预解析、预连接优化适用于Web页面启动和跳转场景，例如应用启动时加载Web首页。创建ArkWeb组件实例后，开发者可以选择不同时机设置URL并进行预解析、预连接。</p>     <ul>      <li>如下图中a节点所示，如果是应用首页，推荐在ArkWeb组件初始化后设置首页URL，进行预解析和预连接。</li>      <li>如下图中b节点所示，对于应用内页面，推荐在ArkWeb组件的onAppear阶段设置当前页面的URL，进行预解析和预连接。</li>      <li>如下图中c节点所示，页面加载完成后，设置用户下一步可能点击页面的URL，进行预解析和预连接，推荐在onPageEnd及后续时机执行。</li>     </ul>     <div class="fignone">      <span class="figcap"><b>图3 </b>预连接优化原理图</span>      <br><span><img height="272.3175" originheight="455" originwidth="873" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.11705491823226683445510899066498:50001231000000:2800:C3CB6B3FDF5E4ADE380DB41A3B978D9BDF86FFE14D6A788E6CF0F37FE496A58C.png" title="点击放大" width="523.6875"></span>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在设置预解析和预连接进行优化时，需要注意：</p>       <ul>        <li>预连接存在时效性，建议在5分钟内复用已建立的连接，超时后连接将被关闭。</li>        <li>预连接存在耗时，建议预加载时间比页面实际时间提前150ms以上。</li>        <li>当前页面加载完成后，即onPageEnd回调后，可复用当前ArkWeb组件预连接新的页面或预下载资源。</li>       </ul>      </div></div></div>    </div>    <p><strong>实践案例</strong></p>    <p>案例一：如果需要提前对应用的首页进行操作，可以调用initializeWebEngine()初始化ArkWeb组件的内核，然后调用prepareForPageLoad()预连接即将加载的页面。在prepareForPageLoad中，将第二个参数设为true以进行预连接，设为false时仅进行DNS预解析。具体代码如下所示。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseOne.ets#L2-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onCreate'</span>);</li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">initializeWebEngine</span>();</li><li>    <span class="hljs-comment">// When pre-connecting, you need to replace' https://www.example.com' with the actual website address to visit</span></li><li>    <span class="hljs-comment">// Specify that the second parameter is true, which means to pre-connect. If it is false, the interface will only pre-resolve the URL.</span></li><li>    <span class="hljs-comment">// The third parameter, numSockets, has a value range of 1-6. If it exceeds 6, the parameter will be treated as 6.</span></li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">prepareForPageLoad</span>(<span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">2</span>);</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'abilityWant'</span>, want);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onCreate done'</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseOne.ets#L2-L16" target="_blank">CaseOne.ets</a></div></div></div></div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>prepareForPageLoad预解析和预连接只和host相关，URL带参数的情况下也能进行预解析和预连接。</p>     </div></div></div>    <p>案例二：如果需要提前连接当前页面的Web页面，可以在Web组件的 `onAppear` 方法中预连接要加载的页面。具体代码如下所示：</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseTwo.ets#L2-L24" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'loadData'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">accessBackward</span>()) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">backward</span>();</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/cn/'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>})</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Specify that the second parameter is true, which means to pre-connect. If it is false, the interface will only pre-resolve the URL.</span></li><li>          <span class="hljs-comment">// The third parameter is the number of socket to be pre-connected. A maximum of six are allowed.</span></li><li>          webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">prepareForPageLoad</span>(<span class="hljs-string">'https://www.example.com/cn/'</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">2</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseTwo.ets#L2-L24" target="_blank">CaseTwo.ets</a></div></div></div></div>    <p></p>    <p>案例三：当前页面显示完成后，可以在onPageEnd()中预连接下一个页面。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseThree.ets#L2-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>})</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Pre-connected https://www.example1.com/</span></li><li>          <span class="hljs-comment">// The third parameter, numSockets, has a value range of 1-6. If it exceeds 6, the parameter will be treated as 6.</span></li><li>          webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">prepareForPageLoad</span>(<span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">2</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseThree.ets#L2-L18" target="_blank">CaseThree.ets</a></div></div></div></div>    <p></p>    <div class="tiledSection">     <h3 id="section11708113212514">预下载优化<i class="anchor-icon anchor-icon-link" anchorid="section11708113212514" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>如下图所示，ArkWeb组件运行包含onAppear、load、onPageBegin、onPageEnd。开发者可以在onPageEnd设置下一步访问的URL，提前下载所需资源。这种方式适用于Web页面启动和跳转场景，例如，在引导流程完成后，预下载需要跳转的页面。创建ArkWeb组件实例后，可以在当前页面加载完成后，设置URL并进行预下载。本方案可以消除资源下载耗时及资源下载导致的页面DOM解析、JS代码编译执行的阻塞耗时，预估收益在数百毫秒（具体时间依赖当前网络环境）。</p>     <div class="fignone">      <span class="figcap"><b>图4 </b>预下载优化原理图</span>      <br><span><img height="350.1225" originheight="455" originwidth="679" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.40662276753645492709332637998062:50001231000000:2800:90348CF11295FEFBB3157C8EBC899A650C82433E47AF045372D2F652650F13A5.png" title="点击放大" width="523.6875"></span>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>预下载行为包括连接和资源下载，耗时可能超过700毫秒（取决于当前网络环境），建议开发者为预下载预留充足的时间。</li>        <li>预下载行为会消耗额外的流量和内存，建议针对高频页面使用。</li>        <li>预下载完成后，当前ArkWeb组件的连接将被关闭。如果要进行下一个页面的预连接，需要显式调用预连接接口。</li>       </ul>      </div></div></div>    </div>    <p><strong>实践案例</strong></p>    <p>如下示例所示，在onPageEnd阶段，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#prefetchpage10" target="_blank">prefetchPage()</a>方法，即可提前下载页面所需的资源，包括主资源子资源，但不会执行网页JavaScript代码或呈现网页，以加快加载速度。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseFour.ets#L2-L17" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>})</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Pre-connected https://www.iana.org/help/example-domains</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">prefetchPage</span>(<span class="hljs-string">'https://www.iana.org/help/example-domains'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CaseFour.ets#L2-L17" target="_blank">CaseFour.ets</a></div></div></div></div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>prefetchPage会缓存下载的资源，缓存时效为5分钟。</p>     </div></div></div>    <div class="tiledSection">     <h3 id="section172031338172719">预渲染优化<i class="anchor-icon anchor-icon-link" anchorid="section172031338172719" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>预渲染优化适用于Web页面启动和跳转场景，例如首页跳转到子页。与预连接、预下载不同，预渲染需创建新的ArkWeb组件并进行后台预渲染，此时组件不会挂载到组件树上（状态为Hidden和InActive）。开发者可在后续按需动态挂载。</p>     <p>具体原理如下图所示。首先，需要定义一个自定义组件封装 ArkWeb 组件，该组件被离线创建，并包含在一个无状态的节点 NodeContainer 中，与相应的 NodeController 绑定。ArkWeb 组件在后台完成预渲染后，需要展示时，再通过 NodeController 将其挂载到 ViewTree 的 NodeContainer 中，即通过 NodeController 绑定到对应的 NodeContainer 组件。预渲染通用实现的步骤如下：</p>     <ol>      <li><span>创建自定义ArkWeb组件：根据实际场景创建封装，组件被离线创建。</span></li>      <li><span>创建并绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller" target="_blank">NodeController</a>：实现NodeController接口，管理节点的创建、显示、更新等操作。将NodeController对象放入容器中，等待调用。</span></li>      <li><span>绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer" target="_blank">NodeContainer</a>组件：与NodeController绑定，实现动态页面显示。</span></li>     </ol>     <div class="fignone">      <span class="figcap"><b>图5 </b>预渲染优化原理图</span>      <br><span><img height="349.125" originheight="406" originwidth="608" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.56071977135849022220809672110360:50001231000000:2800:2C809A2F5EC655244B68E10B68CF782EF72C951C8A4D570836DF8C0FFFDAEA1E.png" title="点击放大" width="523.6875"></span>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>预渲染相比预下载和预连接方案，会消耗更多内存和算力，建议仅用于高频页面。单个应用后台创建的ArkWeb组件数量应少于200个。</p>      </div></div></div>    </div>    <p>另外，为了方便实现Web组件预渲染，开发者可以引用三方库<a href="https://ohpm.openharmony.cn/#/cn/detail/@hadss%2Fnodepool/v/1.0.2-rc.0" target="_blank">nodepool</a>。nodepool提供了全局自定义组件复用的能力，能够更高效、更简单的实现Web组件预渲染。</p>    <p><strong>实践案例</strong></p>    <div class="p">     创建载体，并创建ArkWeb组件。     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateCarrier.ets#L2-L17" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-comment">// Carrier Ability</span></li><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> {createNWeb} <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-keyword">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// Create ArkWeb dynamic components (need to pass in UIContext), which can be created at any time after loadContent.</span></li><li>      <span class="hljs-title function_">createNWeb</span>(<span class="hljs-string">'https://www.example.com'</span>, windowStage.<span class="hljs-title function_">getMainWindowSync</span>().<span class="hljs-title function_">getUIContext</span>());</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateCarrier.ets#L2-L17" target="_blank">CreateCarrier.ets</a></div></div></div></div>    </div>    <div class="p">     创建NodeContainer和对应的NodeController，渲染后台ArkWeb组件。     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateNodeController.ets#L2-L116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Create NodeController</span></li><li><span class="hljs-comment">// common.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">Size</span>, <span class="hljs-title class_">FrameNode</span> }  <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// Specific component contents of dynamic components in @Builder</span></li><li><span class="hljs-comment">// Data is a parameter encapsulation class.</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span>{</li><li>  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">shouldInactive</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">WebBuilder</span>(<span class="hljs-params">data:Data</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: data.<span class="hljs-property">url</span>, <span class="hljs-attr">controller</span>: data.<span class="hljs-property">controller</span> })</li><li>      .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">zoomAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">mixedMode</span>(<span class="hljs-title class_">MixedMode</span>.<span class="hljs-property">All</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">onPageBegin</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        data.<span class="hljs-property">controller</span>.<span class="hljs-title function_">onActive</span>();</li><li>      })</li><li>      .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load page end time: <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">onFirstMeaningfulPaint</span>(<span class="hljs-function">() =&gt;</span>{</li><li>        <span class="hljs-keyword">if</span> (!shouldInactive) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-comment">// stop render</span></li><li>        data.<span class="hljs-property">controller</span>.<span class="hljs-title function_">onInactive</span>();</li><li>        shouldInactive = <span class="hljs-literal">false</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-comment">// Used to control and feedback the behavior of nodes on the corresponding NodeContainer, which needs to be used together with NodeContainer</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;<span class="hljs-title class_">Data</span>[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">root</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-comment">// The method that must be overridden is used to build the number of nodes and return the nodes to be mounted in the corresponding NodeContainer.</span></li><li>  <span class="hljs-comment">// //Called when the corresponding NodeContainer is created, or refreshed by calling the rebuild method.</span></li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">' uicontext is undefined : '</span>+ (uiContext === <span class="hljs-literal">undefined</span>));</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">FrameNode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>()?.<span class="hljs-title function_">getParent</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">FrameNode</span>;</li><li>      <span class="hljs-keyword">if</span> (parent) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(parent.<span class="hljs-title function_">getInspectorInfo</span>()));</li><li>        parent.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span> = <span class="hljs-literal">null</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>      <span class="hljs-comment">// Returns the FrameNode node</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">root</span>;</li><li>    }</li><li>    <span class="hljs-comment">// Returns a null node that controls the dynamic component to be unbound.</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>  }</li><li>  <span class="hljs-comment">// Callback when layout size changes.</span></li><li>  <span class="hljs-title function_">aboutToResize</span>(<span class="hljs-attr">size</span>: <span class="hljs-title class_">Size</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToResize width : '</span> + size.<span class="hljs-property">width</span>  +  <span class="hljs-string">' height : '</span> + size.<span class="hljs-property">height</span> )</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Call back when the NodeContainer corresponding to the controller is in Appear.</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToAppear'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Call back when the NodeContainer corresponding to the controller is Disappear.</span></li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToDisappear'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// This function is a user-defined function and can be used as an initialization function.</span></li><li>  <span class="hljs-comment">// Initialize builderNode through UIContext, and then initialize the contents in @Builder through the Build interface in BuilderNode.</span></li><li>  <span class="hljs-title function_">initWeb</span>(<span class="hljs-attr">url</span>:<span class="hljs-built_in">string</span>, <span class="hljs-attr">uiContext</span>:<span class="hljs-title class_">UIContext</span>, <span class="hljs-attr">control</span>:<span class="hljs-title class_">WebviewController</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> != <span class="hljs-literal">null</span>)</li><li>    {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// Creating a node requires uiContext.</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext)</li><li>    <span class="hljs-comment">// Create dynamic Web components</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;<span class="hljs-title class_">Data</span>[]&gt;(<span class="hljs-title class_">WebBuilder</span>), { <span class="hljs-attr">url</span>:url, <span class="hljs-attr">controller</span>:control })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Create the NodeController needed for Map saving.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title class_">NodeMap</span>:<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyNodeController</span> | <span class="hljs-literal">undefined</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li><span class="hljs-comment">// Create WebViewController needed for Map saving.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">controllerMap</span>:<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">WebviewController</span> | <span class="hljs-literal">undefined</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();</li><li>
</li><li><span class="hljs-comment">// Initialization requires UIContext to be obtained in Ability.</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createNWeb</span> = (<span class="hljs-params">url: <span class="hljs-built_in">string</span>, uiContext: UIContext</span>) =&gt; {</li><li>  <span class="hljs-comment">// Create NodeController</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">baseNode</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>() ;</li><li>  <span class="hljs-comment">// Initialize a custom web component</span></li><li>  baseNode.<span class="hljs-title function_">initWeb</span>(url, uiContext, controller);</li><li>  controllerMap.<span class="hljs-title function_">set</span>(url, controller)</li><li>  <span class="hljs-title class_">NodeMap</span>.<span class="hljs-title function_">set</span>(url, baseNode);</li><li>}</li><li>
</li><li><span class="hljs-comment">// Customize to get the NodeController interface.</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getNWeb = (url : <span class="hljs-built_in">string</span>) : <span class="hljs-title class_">MyNodeController</span> | <span class="hljs-function"><span class="hljs-params">undefined</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">NodeMap</span>.<span class="hljs-title function_">get</span>(url);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/CreateNodeController.ets#L2-L116" target="_blank">CreateNodeController.ets</a></div></div></div></div>    </div>    <div class="p">     通过NodeContainer使用已经预渲染的页面。     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseNodeController.ets#L2-L22" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Use the Page page of NodeController.</span></li><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> {createNWeb, getNWeb} <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// NodeContainer is used to bind with NodeController node, and rebuild will trigger makeNode.</span></li><li>        <span class="hljs-comment">// Page page is bound to NodeController through NodeContainer interface to realize dynamic component page display.</span></li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-title function_">getNWeb</span>(<span class="hljs-string">'https://www.example.com'</span>))</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseNodeController.ets#L2-L22" target="_blank">UseNodeController.ets</a></div></div></div></div>    </div>    <div class="tiledSection">     <h3 id="section1742343332915">预取POST请求优化<i class="anchor-icon anchor-icon-link" anchorid="section1742343332915" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>    </div>    <p>预取POST请求适用于Web页面启动和跳转场景。当即将加载的Web页面中存在耗时较长的POST请求时，可以选择在不同时机进行预取，以消除等待POST请求数据下载完成的耗时。具体有以下两种场景可供参考：</p>    <ol>     <li>如果是应用首页，推荐在ArkWeb组件创建后或提前初始化Web内核后，对首页的POST请求进行预取，例如在XComponent.onCreate()或自定义组件的生命周期函数aboutToAppear()中。</li>     <li>当前页面加载完成后，可以对用户下一步可能点击的页面的POST请求进行预取，推荐在Web组件的生命周期函数onPageEnd()及后续时机进行。</li>    </ol>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ol>       <li>本方案能消除POST请求下载的耗时，预计收益在100毫秒左右，具体取决于POST请求的数据内容和当前网络环境。</li>       <li>预取POST请求行为包括连接和资源下载。连接和资源加载耗时可能达到数百毫秒，具体取决于POST请求的数据内容和当前网络环境。建议为预下载留出足够的时间。</li>       <li>预取POST请求会消耗额外的流量和内存，建议仅用于高频页面。</li>       <li>POST请求具有即时性，预取POST请求需指定有效期。</li>       <li>目前仅支持预取Context-Type为application/x-www-form-urlencoded的POST请求，最多预取6个。预取第7个时，会自动清除最早预取的POST缓存。也可以通过clearPrefetchedResource()接口主动清除不再使用的预取资源缓存。</li>       <li>如果要使用预获取的资源缓存，开发者需要在正式发起的POST请求的请求头中添加“ArkWebPostCacheKey”，其值为对应缓存的cacheKey。</li>      </ol>     </div></div></div>    <p></p>    <p><strong>实践案例</strong></p>    <p>案例一：加载包含POST请求的首页。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>预取POST不会影响首页加载时间。</p>     </div></div></div>    <p>【不推荐用法】</p>    <p>当首页包含POST请求，并且该请求耗时较长时，不建议直接加载Web页面。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/WebComponent.ets#L2-L14" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-variable">webviewController</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Web</span>({ <span class="hljs-variable">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">webviewController</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/WebComponent.ets#L2-L14" target="_blank">WebComponent.ets</a></div></div></div></div>    <p>【推荐用法】</p>    <p>预取POST请求以加载首页，具体步骤如下：</p>    <ol>     <li><span>通过initializeWebEngine()来提前初始化Web组件的内核，然后在初始化内核后调用prefetchResource()预获取将要加载页面中的POST请求。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PrefetchResource.ets#L2-L27" data-highlighted="yes"><ol class="linenums"><li>import { AbilityConstant, UIAbility, Want } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>import { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UIAbility</span> </span>{</li><li>  <span class="hljs-comment">// EntryAbility.ets</span></li><li>  <span class="hljs-title function_ invoke__">onCreate</span>(<span class="hljs-attr">want</span>: Want, <span class="hljs-attr">launchParam</span>: AbilityConstant.LaunchParam): <span class="hljs-keyword">void</span> {</li><li>    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'EntryAbility onCreate.'</span>);</li><li>    webview.WebviewController.<span class="hljs-title function_ invoke__">initializeWebEngine</span>();</li><li>    <span class="hljs-comment">// When pre-acquiring, 'https://www.example1.com/POST? E=f&amp;g=h' is replaced by the actual website address to be visited.</span></li><li>    webview.WebviewController.<span class="hljs-title function_ invoke__">prefetchResource</span>(</li><li>      {</li><li>        <span class="hljs-attr">url</span>: <span class="hljs-string">'https://www.example.com/POST?e=f&amp;g=h'</span>,</li><li>        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,</li><li>        <span class="hljs-attr">formData</span>: <span class="hljs-string">'a=x&amp;b=y'</span></li><li>      },</li><li>      [{</li><li>        <span class="hljs-attr">headerKey</span>: <span class="hljs-string">'c'</span>,</li><li>        <span class="hljs-attr">headerValue</span>: <span class="hljs-string">'z'</span></li><li>      }],</li><li>      <span class="hljs-string">'KeyX'</span>, <span class="hljs-number">500</span></li><li>    );</li><li>    AppStorage.<span class="hljs-title function_ invoke__">setOrCreate</span>(<span class="hljs-string">'abilityWant'</span>, want);</li><li>    console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-string">'EntryAbility onCreate done.'</span>);</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PrefetchResource.ets#L2-L27" target="_blank">PrefetchResource.ets</a></div></div></div></div>      <p></p>      <p></p></li>     <li><span>通过Web组件加载包含POST请求的页面。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ClearResourceCache.ets#L2-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-variable">webviewController</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Web</span>({ <span class="hljs-variable">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">webviewController</span> })</li><li>        .<span class="hljs-title function_">onPageEnd</span>(() =&gt; {</li><li>          <span class="hljs-comment">// Clear the cache of pre-acquired resources that are no longer used in the future.</span></li><li>          <span class="hljs-variable">webview</span>.<span class="hljs-variable">WebviewController</span>.<span class="hljs-title function_">clearPrefetchedResource</span>([<span class="hljs-string">'KeyX'</span>]);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ClearResourceCache.ets#L2-L18" target="_blank">ClearResourceCache.ets</a></div></div></div></div>      <p></p></li>     <li><span>在页面加载的JavaScript文件中，发起POST请求，并将请求响应头ArkWebPostCacheKey设置为预取时的cachekey值'KeyX'。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/HttpRequestPost.js#L2-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();</li><li>xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://www.example.com/POST?e=f&amp;g=h'</span>, <span class="hljs-literal">true</span>);</li><li>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>);</li><li>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">'ArkWebPostCacheKey'</span>, <span class="hljs-string">'KeyX'</span>);</li><li>xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xhr.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'成功'</span>, xhr.<span class="hljs-property">responseText</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();</li><li>formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'a'</span>, <span class="hljs-string">'x'</span>);</li><li>formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'b'</span>, <span class="hljs-string">'y'</span>);</li><li>xhr.<span class="hljs-title function_">send</span>(formData);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/HttpRequestPost.js#L2-L16" target="_blank">HttpRequestPost.js</a></div></div></div></div>      <p></p></li>    </ol>    <p></p>    <p>案例二：加载包含POST请求的下一页。</p>    <p>【不推荐用法】</p>    <p>当即将加载的Web页面中包含POST请求，并且POST请求耗时较长时，不建议直接加载Web页面。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/WebComponentLoad.ets#L2-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'加载页面'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">'https://www.example1.com/'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/WebComponentLoad.ets#L2-L18" target="_blank">WebComponentLoad.ets</a></div></div></div></div>    <p>【推荐用法】</p>    <p>通过预取POST加载包含POST请求的下一个跳转页面。</p>    <ol>     <li><span>当前页面显示完成后，使用onPageEnd()预获取即将加载页面中的POST请求。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/LoadWebComponentRight.ets#L2-L39" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hiTraceMeter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>  <span class="hljs-variable">webviewController</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-comment">// Load the business Web component at an appropriate time. This example takes the Button click trigger as an example.</span></li><li>      <span class="hljs-title function_">Button</span>(<span class="hljs-string">'加载页面'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-comment">// Performance dot</span></li><li>          <span class="hljs-variable">hiTraceMeter</span>.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">1</span>);</li><li>          <span class="hljs-comment">// Please replace the URL with the real address.</span></li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">'https://www.example1.com/'</span>);</li><li>        })</li><li>      <span class="hljs-title function_">Web</span>({ <span class="hljs-variable">src</span>: <span class="hljs-string">'https://www.example.com/'</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">webviewController</span> })</li><li>        .<span class="hljs-title function_">onPageEnd</span>(() =&gt; {</li><li>          <span class="hljs-comment">// When pre-acquiring, 'https://www.example1.com/POST? E=f&amp;g=h' is replaced by the actual website address to be visited.</span></li><li>          <span class="hljs-variable">webview</span>.<span class="hljs-variable">WebviewController</span>.<span class="hljs-title function_">prefetchResource</span>(</li><li>            {</li><li>              <span class="hljs-variable">url</span>: <span class="hljs-string">'https://www.example1.com/POST?e=f&amp;g=h'</span>,</li><li>              <span class="hljs-variable">method</span>: <span class="hljs-string">'POST'</span>,</li><li>              <span class="hljs-variable">formData</span>: <span class="hljs-string">'a=x&amp;b=y'</span></li><li>            },</li><li>            [{</li><li>              <span class="hljs-variable">headerKey</span>: <span class="hljs-string">'c'</span>,</li><li>              <span class="hljs-variable">headerValue</span>: <span class="hljs-string">'z'</span></li><li>            }],</li><li>            <span class="hljs-string">'KeyX'</span>, <span class="hljs-number">500</span></li><li>          );</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/LoadWebComponentRight.ets#L2-L39" target="_blank">LoadWebComponentRight.ets</a></div></div></div></div>      <p></p></li>     <li><span>在将要加载的页面中，JavaScript发起POST请求，并将请求响应头ArkWebPostCacheKey设置为预取时设置的cachekey值'KeyX'。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/HttpRequestPost.js#L2-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();</li><li>xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'https://www.example.com/POST?e=f&amp;g=h'</span>, <span class="hljs-literal">true</span>);</li><li>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>);</li><li>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">'ArkWebPostCacheKey'</span>, <span class="hljs-string">'KeyX'</span>);</li><li>xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xhr.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'成功'</span>, xhr.<span class="hljs-property">responseText</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();</li><li>formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'a'</span>, <span class="hljs-string">'x'</span>);</li><li>formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'b'</span>, <span class="hljs-string">'y'</span>);</li><li>xhr.<span class="hljs-title function_">send</span>(formData);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/HttpRequestPost.js#L2-L16" target="_blank">HttpRequestPost.js</a></div></div></div></div>      <p></p></li>    </ol>    <p></p>    <div class="tiledSection">     <h3 id="section563844632917">预编译JavaScript生成字节码缓存（Code Cache）<i class="anchor-icon anchor-icon-link" anchorid="section563844632917" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>预编译JavaScript生成字节码缓存，可以在页面加载前将即将使用的JavaScript文件编译为字节码并缓存到本地，从而在页面首次加载时减少编译时间。</p>     <p>创建一个无需渲染的离线Web组件，用于预编译。预编译结束后，使用其他Web组件加载业务网页。</p>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>建议开发者优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter" target="_blank">Code Linter扫描工具</a>进行代码检查，重点关注<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-js-code-cache-by-precompile-check" target="_blank">@performance/js-code-cache-by-precompile-check</a>规则。若扫描结果中出现该规则相关问题，可参考本章节提供的优化建议进行调整。</p>      <ol>       <li>仅HTTP或HTTPS协议请求的JavaScript文件可以预编译。</li>       <li>不支持ES6 Module语法的JavaScript文件生成预编译字节码缓存。</li>       <li>通过配置响应头中的E-Tag和Last-Modified值来标记JavaScript缓存版本，当这些值发生变化时，更新字节码缓存。</li>       <li>不支持本地JavaScript文件预编译缓存。</li>      </ol>     </div></div></div>    <p><strong>实践案例</strong></p>    <p>案例一：在未使用预编译JavaScript前提下，启动加载Web页面</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseOne.ets#L2-L32" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// Load the business Web component at an appropriate time. This example takes the Button click trigger as an example.</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'加载页面'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Performance dot</span></li><li>          hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'unPrecompileJavaScript'</span>, <span class="hljs-number">1</span>);</li><li>          <span class="hljs-comment">// Please replace url with real address.</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>?.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">'https://www.example.com/b.html'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/a.html'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageBegin</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`load page begin: <span class="hljs-subst">${event?.url}</span>`</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// Performance dot</span></li><li>          hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'unPrecompileJavaScript'</span>, <span class="hljs-number">1</span>);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`load page end: <span class="hljs-subst">${event?.url}</span>`</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseOne.ets#L2-L32" target="_blank">PracticalCaseOne.ets</a></div></div></div></div>    <p>点击“加载页面”按钮，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hitracemeter" target="_blank">性能打点</a>数据如下，getMessageData进程中的Duration为加载页面开始到结束的耗时：</p>    <p><span><img height="216.5506" originheight="397" originwidth="1463" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.76374918495926471909775494263399:50001231000000:2800:C9CE5E1E20E704E9D540501AEFF430D5F5DD048B5E71AEDC199AA7CC2ABDEF65.png" title="点击放大" width="798"></span></p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>JavaScript的编译时间受文件大小和逻辑复杂度的影响。</p>     </div></div></div>    <p></p>    <p>案例二：使用预编译JavaScript生成字节码缓存，具体步骤如下：</p>    <ol>     <li><span>配置预编译的JavaScript文件信息。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseTwo.ets#L2-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hiTraceMeter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> {</li><li>  <span class="hljs-variable">url</span>: <span class="hljs-title class_">string</span>,</li><li>  <span class="hljs-variable">localPath</span>: <span class="hljs-title class_">string</span>, <span class="hljs-comment">// local resource path</span></li><li>  <span class="hljs-variable">options</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">CacheOptions</span></li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>  <span class="hljs-comment">// Configure precompiled JavaScript file information</span></li><li>  <span class="hljs-variable">configs</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Config</span>&gt; = [</li><li>    {</li><li>      <span class="hljs-variable">url</span>: <span class="hljs-string">'https://www.example.com/example.js'</span>,</li><li>      <span class="hljs-variable">localPath</span>: <span class="hljs-string">'example.js'</span>,</li><li>      <span class="hljs-variable">options</span>: {</li><li>        <span class="hljs-variable">responseHeaders</span>: [</li><li>          { <span class="hljs-variable">headerKey</span>: <span class="hljs-string">'E-Tag'</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">'xxx'</span> },</li><li>          { <span class="hljs-variable">headerKey</span>: <span class="hljs-string">'Last-Modified'</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">'Web, 21 Mar 2024 10:38:41 GMT'</span> }</li><li>        ]</li><li>      }</li><li>    }</li><li>  ]</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseTwo.ets#L2-L55" target="_blank">PracticalCaseTwo.ets</a></div></div></div></div>      <p></p></li>     <li><span>读取配置，进行预编译。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseTwo.ets#L33-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/a.html'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>  .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-comment">// Read the configuration and precompile.</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> config <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">configs</span>) {</li><li>      <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFileContentSync</span>(config.<span class="hljs-property">localPath</span>);</li><li>
</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">precompileJavaScript</span>(config.<span class="hljs-property">url</span>, content, config.<span class="hljs-property">options</span>)</li><li>          .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">errCode: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'precompile successfully!'</span> );</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">errCode: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'precompile failed.'</span> + errCode);</li><li>        })</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'precompile failed!.'</span> + err.<span class="hljs-property">code</span> + err.<span class="hljs-property">message</span>);</li><li>      }</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PracticalCaseTwo.ets#L33-L50" target="_blank">PracticalCaseTwo.ets</a></div></div></div></div>      <p>点击“加载页面”按钮，性能打点数据如下：getMessageData进程中的Duration表示加载页面从开始到结束的耗时。</p>      <p><span><img originheight="459" originwidth="1462" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.65253861151069379976529297969727:50001231000000:2800:965101A048F1563AB244D2770CE4713FFE1EC393D0237C23EF2F1F0FAFC29710.png" width="920" height="288.8372093023256"></span></p>      <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">        <p>当需要更新本地已生成的编译字节码时，修改cacheOptions参数中responseHeaders的E-Tag或Last-Modified响应头对应的值，再次调用接口即可。</p>       </div></div></div>      <p></p></li>    </ol>    <p></p>    <p><strong>总结</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <caption>       <b>表2 </b>      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.84.2.4.1.1" valign="top" width="33.33333333333333%">         <p>页面加载方式</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.84.2.4.1.2" valign="top" width="33.33333333333333%">         <p>耗时(局限不同设备和场景，数据仅供参考)</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.84.2.4.1.3" valign="top" width="33.33333333333333%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>直接加载Web页面</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>3183ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>页面加载时才进行JavaScript编译，从而增加了加载时间</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>预编译JavaScript生成字节码缓存</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>268ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>在加载页面前完成JavaScript预编译，从而节省了首次加载的编译时间</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h3 id="section1495115588211">资源拦截替换的JavaScript生成字节码缓存（Code Cache）<i class="anchor-icon anchor-icon-link" anchorid="section1495115588211" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>资源拦截替换的JavaScript生成字节码缓存适用于页面加载时需要加载网络JavaScript文件并进行拦截替换的场景。此功能支持将字节码缓存到本地，从而在页面非首次加载时节省编译时间。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>建议开发者优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter" target="_blank">Code Linter扫描工具</a>进行代码检查，重点关注<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-js-code-cache-by-interception-check" target="_blank">@performance/js-code-cache-by-interception-check</a>规则。若扫描结果中出现该规则相关问题，可参考本章节提供的优化建议进行调整</p>      </div></div></div>     <div class="fignone">      <span class="figcap"><b>图6 </b>JS资源编译执行流程</span>     </div>     <p><span><img height="185.28230000000002" originheight="254" originwidth="1094" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.68464015614782010472017846758185:50001231000000:2800:0E7BBCDEC972FE56C6011A9C840A589047465685746A40D6315C5458CB7C76AB.png" title="点击放大" width="798"></span></p>     <div class="fignone">      <span class="figcap"><b>图7 </b>资源拦截替换后JS资源编译执行流程</span>     </div>     <p><span><img height="214.13000000000002" originheight="300" originwidth="1118" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.70911859035793516132667842542242:50001231000000:2800:993CE17F973A2806DE4E490581326F67B818F15209D7B46BB8B29F7F6F48C3FA.png" title="点击放大" width="798"></span></p>     <p>Web组件默认支持HTTP协议和自定义协议的JavaScript生成字节码缓存。具体步骤如下：</p>     <ol>      <li><span>开发者需要在Web组件运行前注册自定义协议。</span></li>      <li><span>拦截自定义协议的JavaScript，设置ResponseData和ResponseDataID。</span></li>     </ol>     <p></p>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>ResponseData为JavaScript内容，ResponseDataID用于区分内容是否变更。内容变更时，ResponseDataID也需要变更。</p>     </div></div></div>    <p><strong>实践案例</strong></p>    <p>案例一：拦截HTTP协议的JavaScript文件，生成字节码缓存。</p>    <p>【不推荐用法】</p>    <p>不设置ResponseDataID，直接加载Web界面。</p>    <ol>     <li><span>构造前端H5界面</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/index.html#L2-L25" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span></span></span></li><li><span class="language-xml">          <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"</span>&gt;</span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-1"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-2"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-3"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-4"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-5"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-6"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-7"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-8"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-9"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-10"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div-11"</span>&gt;</span>this is a test div<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.example.com/test.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/index.html#L2-L25" target="_blank">index.html</a></div></div></div></div>      <p></p></li>     <li><span>不设置ResponseDataID，进行界面请求拦截替换</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PageRequestInterception.ets#L2-L38" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } from <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hiTraceMeter } from <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  webViewController: webview.WebviewController = new webview.WebviewController();</li><li>  responseResource: WebResourceResponse = new WebResourceResponse();</li><li>  <span class="hljs-comment">// The developer defines the response data, and the length of the response data must be greater than or equal to 1024 to generate CodeCache.</span></li><li>  <span class="hljs-meta">@State</span> jsData: string = <span class="hljs-string">'JavaScript Data'</span>;</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({ src: $rawfile(<span class="hljs-string">'index.html'</span>), controller: <span class="hljs-keyword">this</span>.webViewController })</li><li>        .onInterceptRequest(event =&gt; {</li><li>          <span class="hljs-comment">// Intercept page requests</span></li><li>          <span class="hljs-keyword">if</span> (event?.request.getRequestUrl() === <span class="hljs-string">'https://www.example.com/test.js'</span>) {</li><li>            <span class="hljs-comment">// Construct response data</span></li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseData(<span class="hljs-keyword">this</span>.jsData);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseMimeType(<span class="hljs-string">'application/javascript'</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.responseResource;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>        })</li><li>        .onPageBegin(() =&gt; {</li><li>          hiTraceMeter.startTrace(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">0</span>);</li><li>        })</li><li>        .onPageEnd(() =&gt; {</li><li>          hiTraceMeter.finishTrace(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">0</span>);</li><li>        })</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/PageRequestInterception.ets#L2-L38" target="_blank">PageRequestInterception.ets</a></div></div></div></div>      <p></p></li>    </ol>    <p>打开应用后关闭，重复两次，然后查看第三次页面加载的耗时。性能打点数据如下：getMessageData 进程中的 Duration 表示页面加载从开始到结束的耗时。</p>    <p><span><img originheight="260" originwidth="865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.51133221525392611027625496875532:50001231000000:2800:189B2C786D962663AE53D5031226A7B15AE8881157F32600476EE3EA937E0F5C.png" width="865" height="260"></span></p>    <p>【推荐用法】</p>    <p>在进行资源拦截替换时，设置请求头中的ResponseData和ResponseDataID。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/SetResposeData.ets#L2-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } from <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hiTraceMeter } from <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  controller: webview.WebviewController = new webview.WebviewController();</li><li>  responseResource: WebResourceResponse = new WebResourceResponse();</li><li>  <span class="hljs-comment">// Construct response data</span></li><li>  <span class="hljs-meta">@State</span> jsData: string = <span class="hljs-string">'JavaScript Data'</span>;</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({ src: $rawfile(<span class="hljs-string">'index.html'</span>), controller: <span class="hljs-keyword">this</span>.controller })</li><li>        .onInterceptRequest((event) =&gt; {</li><li>          <span class="hljs-comment">// Intercept page requests</span></li><li>          <span class="hljs-keyword">if</span> (event?.request.getRequestUrl() === <span class="hljs-string">'https://www.example.com/test.js'</span>) {</li><li>            <span class="hljs-comment">// Construct response data</span></li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseHeader([</li><li>              {</li><li>                <span class="hljs-comment">// Format: No more than 13 digits. Js ID, this field must be updated when Js is updated.</span></li><li>                headerKey: <span class="hljs-string">'ResponseDataID'</span>,</li><li>                headerValue: <span class="hljs-string">'0000000000001'</span></li><li>              }]);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseData(<span class="hljs-keyword">this</span>.jsData);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseMimeType(<span class="hljs-string">'application/javascript'</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>            <span class="hljs-keyword">this</span>.responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.responseResource;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>        })</li><li>        .onPageBegin(() =&gt; {</li><li>          hiTraceMeter.startTrace(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">0</span>);</li><li>        })</li><li>        .onPageEnd(() =&gt; {</li><li>          hiTraceMeter.finishTrace(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">0</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/SetResposeData.ets#L2-L43" target="_blank">SetResposeData.ets</a></div></div></div></div>    <p>打开应用后关闭，重复两次，然后查看第三次页面加载的耗时。性能打点数据如下：getMessageData 进程中的 Duration 表示页面加载从开始到结束的耗时。</p>    <p><span><img originheight="279" originwidth="865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163417.08048336891210062870907176122514:50001231000000:2800:AC53DF9E41C592471054D31A3F12D68393407BDF3366B448B759F095632389C7.png" width="865" height="279"></span></p>    <p></p>    <p>案例二：调用ArkTS接口customizeSchemes()，在注册自定义协议的情况下，实现JavaScript生成字节码缓存，具体步骤如下：</p>    <ol>     <li><span>将scheme对象的isCodeCacheSupported属性设置为true，支持自定义协议的JavaScript生成字节码缓存</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L7-L7" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">scheme1</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebCustomScheme</span> = { <span class="hljs-variable">schemeName</span>: <span class="hljs-string">"scheme1"</span>, <span class="hljs-variable">isSupportCORS</span>: <span class="hljs-keyword">true</span>, <span class="hljs-variable">isSupportFetch</span>: <span class="hljs-keyword">true</span>, <span class="hljs-variable">isCodeCacheSupported</span>: <span class="hljs-keyword">true</span> }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L7-L7" target="_blank">ByteCodeCache.ets</a></div></div></div></div>      <p></p></li>     <li><span>在Web组件运行前，向Web组件注册自定义协议。</span>      <p></p>      <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">        <p>请确保自定义协议不与Web内核内置协议相同。</p>       </div></div></div>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L14-L21" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">customizeSchemes</span>([<span class="hljs-variable language_">this</span>.<span class="hljs-property">scheme1</span>])</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: business_error.<span class="hljs-property">BusinessError</span> = error <span class="hljs-keyword">as</span> business_error.<span class="hljs-property">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${e.code}</span>,  Message: <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L14-L21" target="_blank">ByteCodeCache.ets</a></div></div></div></div>      <p></p></li>     <li><span>拦截自定义协议的JavaScript，设置ResponseData和ResponseDataID。ResponseData包含JavaScript内容，ResponseDataID用于标识JavaScript内容是否发生变化。</span>      <p></p>      <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">        <p>若JavaScript内容变更，ResponseDataID需要一起变更。</p>       </div></div></div>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L27-L75" data-highlighted="yes"><ol class="linenums"><li>Web({</li><li>  src: $rawfile(<span class="hljs-string">'index.html'</span>),</li><li>  controller: <span class="hljs-keyword">this</span>.webController</li><li>})</li><li>  .fileAccess(<span class="hljs-literal">true</span>)</li><li>  .javaScriptAccess(<span class="hljs-literal">true</span>)</li><li>  .width(<span class="hljs-string">'100%'</span>)</li><li>  .height(<span class="hljs-string">'100%'</span>)</li><li>  .onConsole((<span class="hljs-keyword">event</span>) =&gt; {</li><li>    console.log(<span class="hljs-string">'ets onConsole:'</span> + <span class="hljs-keyword">event</span>?.message.getMessage());</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></li><li>  })</li><li>  .onInterceptRequest((<span class="hljs-keyword">event</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> responseResource = <span class="hljs-keyword">new</span> WebResourceResponse()</li><li>    <span class="hljs-comment">// Intercept page requests</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>?.request.getRequestUrl() == <span class="hljs-string">'https://www.intercept.com/test-cc.js'</span>) {</li><li>      <span class="hljs-comment">// Construct response data</span></li><li>      responseResource.setResponseHeader([</li><li>        {</li><li>          headerKey: <span class="hljs-string">'ResponseDataID'</span>,</li><li>          headerValue: <span class="hljs-string">'0000000000002'</span></li><li>          <span class="hljs-comment">// Format: No more than 13 digits. Js ID, this field must be updated when Js is updated.</span></li><li>        }]);</li><li>      responseResource.setResponseData(<span class="hljs-keyword">this</span>.jsData);</li><li>      responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>      responseResource.setResponseMimeType(<span class="hljs-string">'application/javascript'</span>);</li><li>      responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>      responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>      <span class="hljs-keyword">return</span> responseResource;</li><li>
</li><li>
</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>?.request.getRequestUrl() == <span class="hljs-string">'scheme1://www.intercept.com/test-cc2.js'</span>) {</li><li>      <span class="hljs-comment">// Construct response data</span></li><li>      responseResource.setResponseHeader([</li><li>        {</li><li>          headerKey: <span class="hljs-string">'ResponseDataID'</span>,</li><li>          headerValue: <span class="hljs-string">'0000000000001'</span></li><li>          <span class="hljs-comment">// Format: No more than 13 digits. Js ID, this field must be updated when Js is updated.</span></li><li>        }]);</li><li>      responseResource.setResponseData(<span class="hljs-keyword">this</span>.jsData2);</li><li>      responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>      responseResource.setResponseMimeType(<span class="hljs-string">'application/javascript'</span>);</li><li>      responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>      responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>      <span class="hljs-keyword">return</span> responseResource;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/ByteCodeCache.ets#L27-L75" target="_blank">ByteCodeCache.ets</a></div></div></div></div>      <p></p></li>    </ol>    <p></p>    <p>案例三：调用Native接口 `int32_t OH_ArkWeb_RegisterCustomSchemes(const char *scheme, int32_t option)`，实现自定义协议的JavaScript生成字节码缓存。通过网络拦截接口拦截Web组件发出的请求。示例代码请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-scheme-handler" target="_blank">拦截Web组件发起的网络请求</a>。具体步骤如下：</p>    <ol>     <li><span>注册三方协议配置时，传入 `ARKWEB_SCHEME_OPTION_CODE_CACHE_ENABLED` 参数。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/nnapi_init.cpp#L2-L7" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// register Custom Schemes before web initialized</span></li><li>static napi_value <span class="hljs-built_in">RegisterCustomSchemes</span>(napi_env env, napi_callback_info info) {</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, "register custom schemes");</li><li>    <span class="hljs-built_in">OH_ArkWeb_RegisterCustomSchemes</span>("custom", ARKWEB_SCHEME_OPTION_STANDARD | ARKWEB_SCHEME_OPTION_CORS_ENABLED | ARKWEB_SCHEME_OPTION_CODE_CACHE_ENABLED);</li><li>    return nullptr;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/nnapi_init.cpp#L2-L7" target="_blank">nnapi_init.cpp</a></div></div></div></div>      <p></p></li>     <li><span>设置ResponseDataID。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/nnapi_init.cpp#L11-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Read Rawfile Data On Worker Thread</span></li><li><span class="hljs-variable">void</span> <span class="hljs-variable">RawfileRequest</span>::<span class="hljs-title class_">ReadRawfileDataOnWorkerThread</span>() {</li><li>    <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"read rawfile in worker thread."</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">struct</span> <span class="hljs-variable">UrlInfo</span> {</li><li>        <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">resource</span>;</li><li>        <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">mimeType</span>;</li><li>    } <span class="hljs-variable">urlInfos</span>[] = {{<span class="hljs-string">"local.html"</span>, <span class="hljs-string">"text/html"</span>},</li><li>                    {<span class="hljs-string">"local_script.js"</span>, <span class="hljs-string">"text/javascript"</span>},</li><li>                    {<span class="hljs-string">"test-cc.js"</span>, <span class="hljs-string">"text/javascript"</span>}</li><li>                    };</li><li>
</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">resourceManager</span>()) {</li><li>        <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"read rawfile error, resource manager is nullptr."</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>
</li><li>    <span class="hljs-variable">RawFile</span> *<span class="hljs-variable">rawfile</span> = <span class="hljs-title function_">OH_ResourceManager_OpenRawFile</span>(<span class="hljs-title function_">resourceManager</span>(), <span class="hljs-title function_">rawfilePath</span>().<span class="hljs-title function_">c_str</span>());</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">rawfile</span>) {</li><li>        <span class="hljs-title function_">OH_ArkWebResponse_SetStatus</span>(<span class="hljs-title function_">response</span>(), <span class="hljs-number">404</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">OH_ArkWebResponse_SetStatus</span>(<span class="hljs-title function_">response</span>(), <span class="hljs-number">200</span>);</li><li>    }</li><li>
</li><li>
</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">auto</span> &amp;<span class="hljs-title class_">urlInfo</span> : <span class="hljs-title class_">urlInfos</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">urlInfo</span>.<span class="hljs-variable">resource</span> == <span class="hljs-title function_">rawfilePath</span>()) {</li><li>            <span class="hljs-title function_">OH_ArkWebResponse_SetMimeType</span>(<span class="hljs-title function_">response</span>(), <span class="hljs-variable">urlInfo</span>.<span class="hljs-variable">mimeType</span>.<span class="hljs-title function_">c_str</span>());</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>    }</li><li>
</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-string">"test-cc.js"</span> == <span class="hljs-title function_">rawfilePath</span>()) {</li><li>        <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"OH_ArkWebResponse_SetHeaderByName ResponseDataID"</span>);</li><li>        <span class="hljs-title function_">OH_ArkWebResponse_SetHeaderByName</span>(<span class="hljs-title function_">response</span>(), <span class="hljs-string">"ResponseDataID"</span>, <span class="hljs-string">"0000000000001"</span>, <span class="hljs-keyword">true</span>);</li><li>    }</li><li>    <span class="hljs-title function_">OH_ArkWebResponse_SetCharset</span>(<span class="hljs-title function_">response</span>(), <span class="hljs-string">"UTF-8"</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/nnapi_init.cpp#L11-L50" target="_blank">nnapi_init.cpp</a></div></div></div></div>      <p></p></li>     <li><span>注册三方协议并设置SchemeHandler。</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/SetSchemeHandler.ets#L8-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-comment">// register CustomSchemes</span></li><li>  <span class="hljs-variable">testNapi</span>.<span class="hljs-title function_">registerCustomSchemes</span>();</li><li>  <span class="hljs-comment">// initializeWebEngine</span></li><li>  <span class="hljs-variable">webview</span>.<span class="hljs-variable">WebviewController</span>.<span class="hljs-title function_">initializeWebEngine</span>();</li><li>  <span class="hljs-comment">// set SchemeHandler。</span></li><li>  <span class="hljs-variable">testNapi</span>.<span class="hljs-title function_">setSchemeHandler</span>();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/SetSchemeHandler.ets#L8-L16" target="_blank">SetSchemeHandler.ets</a></div></div></div></div>      <p>性能打点数据如下，getMessageData进程中的Avg Wall Duration为两次加载页面开始到结束的平均耗时：</p>      <p><span><img height="170.28810494931423" originheight="283" originwidth="1551" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.72565960477510993556698392979702:50001231000000:2800:32202B726C9CE8E930DABA789D1344ED692D4D802AB3C1805FCB78380CC80877.png" title="点击放大" width="920"></span></p>      <p></p></li>    </ol>    <p><strong>总结</strong><strong>（以拦截替换HTTP协议的JavaScript生成字节码缓存场景性能数据举例）</strong></p>    <p>构造2.4MB大小的JavaScript文件，进行资源拦截替换，多次测试取平均耗时，具体数据如下：</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.107.1.4.1.1" valign="top" width="33.33333333333333%">         <p>资源拦截替换方式</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.107.1.4.1.2" valign="top" width="33.33333333333333%">         <p>耗时（数据基于特定设备和场景，仅供参考）</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.107.1.4.1.3" valign="top" width="33.33333333333333%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>在资源拦截替换中不设置ResponseDataID</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>1469.7ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>每次页面加载时，编译并缓存JavaScript资源，会增加加载时间。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>在资源拦截替换中设置ResponseDataID</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>1402.9ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>在页面加载时，将字节码缓存至本地并设置ResponseDataID，避免后续重复缓存，节省非首次加载时间。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h3 id="section166720457447">离线资源免拦截注入<i class="anchor-icon anchor-icon-link" anchorid="section166720457447" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p></p>     <p>页面加载前，离线资源免拦截注入会将图片、样式表和脚本资源注入内存缓存，节省首次加载的网络请求时间。</p>    </div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ol>       <li>开发者需创建一个离线Web组件，用于将资源注入内存缓存，以便其他Web组件加载对应的业务网页。</li>       <li>仅使用HTTP或HTTPS协议请求的资源可被注入进内存缓存。</li>       <li>内存缓存中的资源由内核自动管理。当注入的资源数量过多导致内存压力增大时，内核会自动释放未使用的资源。应避免注入过多资源到内存缓存中。</li>       <li>正常情况下，资源的有效期由提供的Cache-Control或Expires响应头控制。默认的有效期为86400秒，即1天。</li>       <li>资源的MIMEType通过提供的参数中的Content-Type响应头配置，Content-Type需符合标准，否则无法正常使用，MODULE_JS必须提供有效的MIMEType，其他类型可不提供。</li>       <li>仅支持通过HTML标签加载。</li>       <li>如果业务网页中的script标签使用了crossorigin属性，需在接口的responseHeaders参数中设置Cross-Origin响应头的值为anonymous或use-credentials。</li>       <li>当调用 `webview.WebviewController.SetRenderProcessMode(web_webview.RenderProcessMode.MULTIPLE)` 接口后，应用会启动多渲染进程模式，此方案在该场景下无效。</li>       <li>单次调用最大支持注入30个资源，单个资源最大支持10Mb。</li>      </ol>     </div></div></div>    <p><strong>实践案例</strong></p>    <p>案例一：直接加载Web页面</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/LoadWebPage.ets#L2-L28" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hiTraceMeter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// Load business web components at the right time. This example is the example of Button click trigger.</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'加载页面'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Performance hit point</span></li><li>          hiTraceMeter.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">1</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">'https://www.example.com/b.html'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com/a.html'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Performance hit point</span></li><li>          hiTraceMeter.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'getMessageData'</span>, <span class="hljs-number">1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/LoadWebPage.ets#L2-L28" target="_blank">LoadWebPage.ets</a></div></div></div></div>    <p>性能打点数据如下，getMessageData进程中的Duration为加载页面开始到结束的耗时：</p>    <p><span><img originheight="383" originwidth="1496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.28412371772661678899804637894177:50001231000000:2800:4C94711A77B443516B9970FEA38CD33418C97378B04EB7AFC798B5CC084F6F28.png" width="920" height="235.53475935828877"></span></p>    <p>案例二：使用资源免拦截注入加载Web页面，请参考以下步骤：</p>    <ol>     <li><span>创建资源配置</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/CreateResourceConfig.ets#L2-L87" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResourceConfig</span> {</li><li>  <span class="hljs-variable">urlList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt;,</li><li>  <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>,</li><li>  <span class="hljs-variable">responseHeaders</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Header</span>&gt;,</li><li>  <span class="hljs-variable">localPath</span>: <span class="hljs-title class_">string</span>,</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExceptionResource</span> {</li><li>  <span class="hljs-variable">console</span>: <span class="hljs-title class_">string</span>,</li><li>  <span class="hljs-variable">urlList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">string</span>&gt; | <span class="hljs-title class_">undefined</span> | <span class="hljs-title class_">null</span>;</li><li>  <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>  | <span class="hljs-title class_">undefined</span> | <span class="hljs-title class_">null</span>,</li><li>  <span class="hljs-variable">responseHeaders</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Header</span>&gt; | <span class="hljs-title class_">undefined</span> | <span class="hljs-title class_">null</span>,</li><li>  <span class="hljs-variable">resource</span>?: <span class="hljs-title class_">Uint8Array</span> | <span class="hljs-title class_">undefined</span> | <span class="hljs-title class_">null</span></li><li>  <span class="hljs-variable">localPath</span>?: <span class="hljs-title class_">string</span>,</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable">baseURL</span> = <span class="hljs-string">'http://localhost:8083/resource/'</span>;</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable">baseURL1</span> = <span class="hljs-string">'http://localhost:8083/resource/'</span>;</li><li>
</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable">basicResources</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ResourceConfig</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-variable">localPath</span>: <span class="hljs-string">"in_cache_middle.png"</span>,</li><li>    <span class="hljs-variable">urlList</span>: [</li><li>      <span class="hljs-variable">baseURL</span>,</li><li>      <span class="hljs-variable">baseURL</span> + <span class="hljs-string">"request.png"</span>,</li><li>      <span class="hljs-variable">baseURL1</span> + <span class="hljs-string">"request.png"</span>,</li><li>    ],</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>.<span class="hljs-title class_">IMAGE</span>,</li><li>    <span class="hljs-variable">responseHeaders</span>: []</li><li>  },</li><li>  {</li><li>    <span class="hljs-variable">localPath</span>: <span class="hljs-string">"in_cache.js"</span>,</li><li>    <span class="hljs-variable">urlList</span>: [</li><li>      <span class="hljs-variable">baseURL</span>,</li><li>      <span class="hljs-variable">baseURL</span> + <span class="hljs-string">"request.js"</span>,</li><li>      <span class="hljs-variable">baseURL1</span> + <span class="hljs-string">"request.js"</span></li><li>    ],</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>.<span class="hljs-title class_">CLASSIC_JS</span>,</li><li>    <span class="hljs-variable">responseHeaders</span>: [</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Content-Type"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"text/javascript"</span> },</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Cache-Control"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"max-age=100000"</span> },</li><li>    ]</li><li>  },</li><li>  {</li><li>    <span class="hljs-variable">localPath</span>: <span class="hljs-string">"in_cache_module1.js"</span>,</li><li>    <span class="hljs-variable">urlList</span>: [</li><li>      <span class="hljs-variable">baseURL</span> + <span class="hljs-string">"request_module1.js"</span>,</li><li>    ],</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>.<span class="hljs-title class_">MODULE_JS</span>,</li><li>    <span class="hljs-variable">responseHeaders</span>: [</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Content-Type"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"application/javascript"</span> },</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Access-Control-Allow-Origin"</span> , <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"*"</span>},</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Cache-Control"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"max-age=100000"</span> },</li><li>    ]</li><li>  },</li><li>  {</li><li>    <span class="hljs-variable">localPath</span>: <span class="hljs-string">"in_cache_module2.js"</span>,</li><li>    <span class="hljs-variable">urlList</span>: [</li><li>      <span class="hljs-variable">baseURL</span> + <span class="hljs-string">"request_module2.js"</span>,</li><li>    ],</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>.<span class="hljs-title class_">MODULE_JS</span>,</li><li>    <span class="hljs-variable">responseHeaders</span>: [</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Content-Type"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"application/javascript"</span> },</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Access-Control-Allow-Origin"</span> , <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"*"</span>},</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Cache-Control"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"max-age=100000"</span> },</li><li>    ]</li><li>  },</li><li>  {</li><li>    <span class="hljs-variable">localPath</span>: <span class="hljs-string">"in_cache.css"</span>,</li><li>    <span class="hljs-variable">urlList</span>: [</li><li>      <span class="hljs-variable">baseURL</span>,</li><li>      <span class="hljs-variable">baseURL</span> + <span class="hljs-string">"request.css"</span>,</li><li>      <span class="hljs-variable">baseURL1</span> + <span class="hljs-string">"request.css"</span>,</li><li>    ],</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">OfflineResourceType</span>.<span class="hljs-title class_">CSS</span>,</li><li>    <span class="hljs-variable">responseHeaders</span>: [</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"resource-Type"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"text/css"</span> },</li><li>      {<span class="hljs-variable">headerKey</span>: <span class="hljs-string">"Cache-Control"</span>, <span class="hljs-variable">headerValue</span>: <span class="hljs-string">"max-age=100000"</span> },</li><li>    ]</li><li>  },</li><li>];</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/CreateResourceConfig.ets#L2-L87" target="_blank">CreateResourceConfig.ets</a></div></div></div></div>      <p></p></li>     <li><span>读取配置并注入资源</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/CreateResourceConfig.ets#L91-L98" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Call the offline resource injection cache interface</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">injectOfflineResource</span>(<span class="hljs-params">controller: WebviewController, resourceMapArr: <span class="hljs-built_in">Array</span>&lt;webview.OfflineResourceMap&gt;</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    controller.<span class="hljs-title function_">injectOfflineResources</span>(resourceMapArr);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"qqq injectOfflineResource error: "</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">" "</span> + err.<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/utils/CreateResourceConfig.ets#L91-L98" target="_blank">CreateResourceConfig.ets</a></div></div></div></div>      <p>性能打点数据如下：getMessageData进程中的Duration表示加载页面的总耗时。</p>      <p><span><img originheight="285" originwidth="1536" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.28873932092738609372936574927715:50001231000000:2800:147D62677B764381282A6E9B45C2B4FA4D3001902D39EF77A620E6E1DB66D927.png" width="920" height="170.703125"></span></p>      <p></p></li>    </ol>    <p></p>    <p><strong>总结</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <caption>       <b>表3 </b>      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.119.2.4.1.1" valign="top" width="33.33333333333333%">         <p>页面加载方式</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.119.2.4.1.2" valign="top" width="32.893289328932894%">         <p>耗时（数据仅供参考）</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.119.2.4.1.3" valign="top" width="33.77337733773377%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>直接加载Web页面</p></td>        <td class="cellrowborder" valign="top" width="32.893289328932894%">         <p>1312ms</p></td>        <td class="cellrowborder" valign="top" width="33.77337733773377%">         <p>在触发页面加载时才发起资源请求，这会延长页面加载时间。</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>使用离线资源免拦截注入加载Web页面</p></td>        <td class="cellrowborder" valign="top" width="32.893289328932894%">         <p>74ms</p></td>        <td class="cellrowborder" valign="top" width="33.77337733773377%">         <p>将资源预置在内存中，节省网络请求时间。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h3 id="section1638162365115">资源拦截替换加速<i class="anchor-icon anchor-icon-link" anchorid="section1638162365115" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>资源拦截替换加速在资源拦截替换接口基础上新增支持了ArrayBuffer格式的入参，开发者无需在应用侧进行ArrayBuffer到String格式的转换，可直接使用ArrayBuffer格式的数据进行拦截替换。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>本方案与原有接口使用相同，开发者只需在调用WebResourceResponse.setResponseData()接口时传入ArrayBuffer格式的数据。</p>      </div></div></div>    </div>    <p></p>    <p><strong>实践案例</strong></p>    <p>案例一：使用字符串格式的数据做拦截替换</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseStringInterceptReplace.ets#L2-L32" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } from <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  controller: webview.WebviewController = new webview.WebviewController();</li><li>  responseResource: WebResourceResponse = new WebResourceResponse();</li><li>  <span class="hljs-comment">// Here is the string format data.</span></li><li>  resourceStr: string = <span class="hljs-string">'xxxxxxxxxxxxxxx'</span>;</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({ src: <span class="hljs-string">'https:www.example.com/test.html'</span>, controller: <span class="hljs-keyword">this</span>.controller })</li><li>        .onInterceptRequest(event =&gt; {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-keyword">if</span> (!event.request.getRequestUrl().startsWith(<span class="hljs-string">'https://www.example.com/'</span>)) {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>            }</li><li>          }</li><li>          <span class="hljs-comment">// Use string format data for interception and replacement</span></li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseData(<span class="hljs-keyword">this</span>.resourceStr);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseMimeType(<span class="hljs-string">'text/json'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseHeader([{ headerKey: <span class="hljs-string">'Access-Control-Allow-Origin'</span>, headerValue: <span class="hljs-string">'*'</span> }]);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.responseResource;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseStringInterceptReplace.ets#L2-L32" target="_blank">UseStringInterceptReplace.ets</a></div></div></div></div>    <p>资源替换耗时如图所示。getMessageData和someFunction的执行时间表示页面加载资源的耗时。</p>    <p><span><img originheight="359" originwidth="1431" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.76979233280597472564455838672878:50001231000000:2800:0F669FEE990F67759AB96A90C7046BEF019CBC3F3FD656B71726D0FFBC3E2666.png" width="920" height="230.80363382250172"></span></p>    <p>案例二：使用ArrayBuffer格式的数据做拦截替换</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseArrayBufferInterceptReplace.ets#L2-L119" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } from <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct WebComponent {</li><li>  controller: webview.WebviewController = new webview.WebviewController()</li><li>  scheme1: webview.WebCustomScheme = { schemeName: <span class="hljs-string">"imeituan"</span>, isSupportCORS: <span class="hljs-literal">true</span>, isSupportFetch: <span class="hljs-literal">true</span> }</li><li>  responseResource: WebResourceResponse = new WebResourceResponse()</li><li>  <span class="hljs-comment">// Developer Custom Response Data</span></li><li>  <span class="hljs-keyword">data</span>: string = <span class="hljs-string">""</span>;</li><li>  buffer: ArrayBuffer = new ArrayBuffer(<span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length);</li><li>  usingLen: number = <span class="hljs-number">1</span>;</li><li>
</li><li>  aboutToAppear(): void {</li><li>    <span class="hljs-comment">// Configure the Web to open the debugging mode</span></li><li>    webview.WebviewController.setWebDebuggingAccess(<span class="hljs-literal">true</span>);</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      webview.WebviewController.customizeSchemes([<span class="hljs-keyword">this</span>.scheme1])</li><li>      console.info(`customizeSchemes`)</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      console.error(error);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">this</span>.initArrayBufferData(<span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  onPageShow(): void {</li><li>
</li><li>  }</li><li>
</li><li>  initStringData(size: Number): void {</li><li>    switch (size){</li><li>      case <span class="hljs-number">1</span>:</li><li>        <span class="hljs-keyword">this</span>.usingLen = <span class="hljs-number">10</span>; <span class="hljs-comment">//10k</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      case <span class="hljs-number">2</span>:</li><li>        <span class="hljs-keyword">this</span>.usingLen = <span class="hljs-number">1024</span>; <span class="hljs-comment">//1M</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      case <span class="hljs-number">3</span>:</li><li>        <span class="hljs-keyword">this</span>.usingLen = <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">//10M</span></li><li>        <span class="hljs-keyword">break</span>;</li><li>      default:</li><li>        <span class="hljs-keyword">this</span>.usingLen = <span class="hljs-number">1</span>;</li><li>    }</li><li>
</li><li>    let str: string = <span class="hljs-string">""</span>;</li><li>    let str_1k: string = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">1024</span>; i++) {</li><li>      str_1k = str_1k.concat(<span class="hljs-string">"x"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">for</span> (let j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-keyword">this</span>.usingLen; j++) {</li><li>      str = str.concat(str_1k);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span> = JSON.stringify({</li><li>      status: <span class="hljs-number">200</span>,</li><li>      result: str,</li><li>    });</li><li>    console.info(<span class="hljs-string">"init data length: "</span> + <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// size - 1:10k, 2:1M, 3:10M</span></li><li>  initArrayBufferData(size:Number): void {</li><li>    <span class="hljs-keyword">this</span>.initStringData(size);</li><li>    console.error(<span class="hljs-string">"target string: "</span> + <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>);</li><li>    <span class="hljs-keyword">this</span>.buffer = new ArrayBuffer(<span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length);</li><li>    <span class="hljs-keyword">const</span> uint8Array: Uint8Array = new Uint8Array(<span class="hljs-keyword">this</span>.buffer);</li><li>    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length; i++) {</li><li>      uint8Array[i] = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.charCodeAt(i);</li><li>    }</li><li>  }</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Button(<span class="hljs-string">'set to 10K'</span>)</li><li>        .onClick(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.initArrayBufferData(<span class="hljs-number">1</span>);</li><li>          console.log(<span class="hljs-string">"datalen set to length "</span>+ <span class="hljs-keyword">this</span>.buffer.byteLength);</li><li>        })</li><li>      Button(<span class="hljs-string">'set to 1M'</span>)</li><li>        .onClick(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.initArrayBufferData(<span class="hljs-number">2</span>);</li><li>          console.log(<span class="hljs-string">"datalen set to length "</span>+ <span class="hljs-keyword">this</span>.buffer.byteLength);</li><li>        })</li><li>      Button(<span class="hljs-string">'set to 10M'</span>)</li><li>        .onClick(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.initArrayBufferData(<span class="hljs-number">3</span>);</li><li>          console.log(<span class="hljs-string">"datalen set to length "</span>+ <span class="hljs-keyword">this</span>.buffer.byteLength);</li><li>        })</li><li>      Web({ src: $rawfile(<span class="hljs-string">"intercept.html"</span>), controller: <span class="hljs-keyword">this</span>.controller })</li><li>        .onConsole((event) =&gt; {</li><li>          console.error(`ygz ${event?.message?.getMessage()}`);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        .onInterceptRequest((event) =&gt; {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            console.error(<span class="hljs-string">'url:'</span> + event.request.getRequestUrl());</li><li>            <span class="hljs-comment">// Block Page Request</span></li><li>            <span class="hljs-keyword">if</span> (!event.request.getRequestUrl().startsWith(<span class="hljs-string">'http://bridge'</span>)) {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>            }</li><li>          }</li><li>          <span class="hljs-comment">// Construct response data</span></li><li>          <span class="hljs-comment">// const str: string = buffer.from(this.buffer).toString();</span></li><li>          console.error(<span class="hljs-string">"response data length: "</span> + <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseData(<span class="hljs-keyword">this</span>.buffer);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseEncoding(<span class="hljs-string">'utf-8'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseMimeType(<span class="hljs-string">'text/json'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseCode(<span class="hljs-number">200</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setReasonMessage(<span class="hljs-string">'OK'</span>);</li><li>          <span class="hljs-keyword">this</span>.responseResource.setResponseHeader([{ headerKey: <span class="hljs-string">'Access-Control-Allow-Origin'</span>, headerValue: <span class="hljs-string">'*'</span> }]);</li><li>          console.info(`ygz <span class="hljs-keyword">return</span> reponse`);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.responseResource;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/UseArrayBufferInterceptReplace.ets#L2-L119" target="_blank">UseArrayBufferInterceptReplace.ets</a></div></div></div></div>    <p>资源替换耗时如图所示。getMessageData和william someFunction的执行时间表示页面加载资源的耗时。</p>    <p><span><img originheight="577" originwidth="1542" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.75527382203733009141741007583246:50001231000000:2800:C7DA419011C4E03CFCCADD763A7E81ACE1F5876CF640668BA1994BC28280FB83.png" width="920" height="344.25421530479895"></span></p>    <p><strong>总结</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <caption>       <b>表4 </b>      </caption>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.132.2.4.1.1" valign="top" width="33.33333333333333%">         <p>页面加载方式</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.132.2.4.1.2" valign="top" width="33.33333333333333%">         <p>耗时(局限不同设备和场景，数据仅供参考)</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.132.2.4.1.3" valign="top" width="33.33333333333333%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>使用String格式的数据做拦截替换</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>34ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>Web组件内部数据传输需要转换为ArrayBuffer，这会增加数据处理步骤和启动耗时</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>使用ArrayBuffer格式的数据做拦截替换</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>13ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>接口支持ArrayBuffer格式，优化了数据传输方式，减少转换和传输时间</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section58781855115017">JSBridge<i class="anchor-icon anchor-icon-link" anchorid="section58781855115017" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section16140548175117" class="firsth2">JSBridge优化解决方案<i class="anchor-icon anchor-icon-link" anchorid="section16140548175117" tips="复制节点链接"></i></h3>          <p><strong>适用场景</strong></p>     <p>应用使用ArkTS或C++语言混合开发，或应用架构接近小程序架构，自带C++环境，推荐使用ArkWeb在Native侧提供的ArkWeb_ControllerAPI和ArkWeb_ComponentAPI实现JSBridge功能。</p>     <p><span><img height="368.8622" originheight="669" originwidth="967" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.59152053043630534441680184652632:50001231000000:2800:6E3F565C386A12B0136C82DADA7EB3871CAC6D9D888474E8BE7506CD7AC05B10.png" title="点击放大" width="532"></span></p>     <p></p>     <p>上图展示了小程序的一般架构，逻辑层使用自带的JavaScript运行时，现有C++环境通过Native接口直接与视图层（ArkWeb渲染器）通信，无需返回ArkTS环境调用JSBridge接口。</p>     <p><span><img height="254.9477" originheight="423" originwidth="1324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.03340686109745716468061494131613:50001231000000:2800:C883EBC4B3B0544589EB4B309F7B59585CF3F95347034441D639C35270A4BA29.png" title="点击放大" width="798"></span></p>     <p>Native JSBridge方案解决ArkTS环境的冗余切换，允许回调在非UI线程上报，避免UI阻塞。</p>     <p><strong>实践案例</strong></p>     <p>案例一：使用ArkTS接口实现JSBridge通信。</p>     <p>应用侧代码：</p>     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/JsBridgeOfArkTS.ets#L2-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webviewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// Configure the Web to open the debugging mode</span></li><li>    webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setWebDebuggingAccess</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'runJavaScript'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'现在时间是:'</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>());</li><li>          <span class="hljs-comment">// When the front-end page function has no parameters, delete the param.</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-string">'htmlTest(param)'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'runJavaScriptCodePassed'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// Pass runJavaScript side code method</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-string">`function changeColor(){document.getElementById('text').style.color = 'red'}`</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/JsBridgeOfArkTS.ets#L2-L30" target="_blank">JsBridgeOfArkTS.ets</a></div></div></div></div>     <p>前端页面代码：</p>     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/test.html#L2-L23" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"callArkTS()"</span>&gt;</span>Click Me!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"text"</span>&gt;</span>这是一个测试信息，默认字体为黑色，调用runJavaScript方法后字体为绿色，调用runJavaScriptCodePassed方法后字体为红色<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span></li><li><span class="language-xml">    <span class="hljs-keyword">var</span> param = <span class="hljs-string">"param: JavaScript Hello World!"</span>;</span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">htmlTest</span>(<span class="hljs-params">param</span>) {</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'green'</span>;</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'现在时间：'</span>+<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()</span></li><li><span class="language-xml">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(param);</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">htmlTest</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'green'</span>;</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'text'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'现在时间：'</span>+<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">callArkTS</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">      <span class="hljs-title function_">changeColor</span>();</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/test.html#L2-L23" target="_blank">test.html</a></div></div></div></div>     <p>点击runJavaScript按钮后，触发h5页面的htmlTest方法，页面内容将变更为当前时间戳。如下图所示。</p>     <p><span><img height="200.0187" originheight="416" originwidth="1674" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.19653020363309173286138911268754:50001231000000:2800:D7E515F3DBD79B29317E58DBDE08860A43A5D64032071D1D34D20F335417748F.png" title="点击放大" width="798"></span></p>     <p></p>     <p>经过多轮测试，从点击ArkTS侧的Button到触发H5侧的runJSRetStr方法，耗时7到9毫秒。</p>     <p></p>     <p>案例二：使用NDK接口实现JSBridge通信。</p>     <p>应用侧代码：</p>     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/JsBridgeOfNdk.ets#L2-L53" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">testObj</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">test</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ArkUI Web Component'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">"ArkUI Web Component"</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">toString</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Web Component toString'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">webTag</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ArkWeb1'</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webTag</span>);</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testObjtest</span>: testObj = <span class="hljs-keyword">new</span> <span class="hljs-title function_">testObj</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"aboutToAppear"</span>);</li><li>    <span class="hljs-comment">// init web ndk</span></li><li>    testNapi.<span class="hljs-title function_">nativeWebInit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webTag</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'runJS hello'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'start:----&gt;'</span>+<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>());</li><li>            testNapi.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webTag</span>, <span class="hljs-string">"runJSRetStr(\""</span> + <span class="hljs-string">"hello"</span> + <span class="hljs-string">"\")"</span>);</li><li>          })</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'20%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'runJS.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>          .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>          .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ndk onControllerAttached webId: "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getWebId</span>());</li><li>          })</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'80%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/JsBridgeOfNdk.ets#L2-L53" target="_blank">JsBridgeOfNdk.ets</a></div></div></div></div>     <p>hello.cpp作为应用C++侧业务逻辑代码：</p>     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/hello.cpp#L2-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Registration objects and methods, sending scripts to callbacks after H5 execution, parsing instances passed from the side of the storage application and other code logics are not displayed here, and developers realize them by themselves according to their own business scenarios.</span></li><li><span class="hljs-comment">// Send the JS script to the H5 side for execution</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RunJavaScript</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    </li><li>    <span class="hljs-comment">// Get the first parameter webTag</span></li><li>    <span class="hljs-type">size_t</span> webTagSize = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;webTagSize);</li><li>    <span class="hljs-type">char</span> *webTagValue = <span class="hljs-built_in">new</span> (std::nothrow) <span class="hljs-type">char</span>[webTagSize + <span class="hljs-number">1</span>];</li><li>    <span class="hljs-type">size_t</span> webTagLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">0</span>], webTagValue, webTagSize + <span class="hljs-number">1</span>, &amp;webTagLength);</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"ArkWeb"</span>, <span class="hljs-string">"ndk OH_NativeArkWeb_RunJavaScript webTag:%{public}s"</span>,</li><li>                 webTagValue);</li><li>
</li><li>    <span class="hljs-comment">// Get the second parameter jsCode</span></li><li>    <span class="hljs-type">size_t</span> bufferSize = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">1</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;bufferSize);</li><li>    <span class="hljs-type">char</span> *jsCode = <span class="hljs-built_in">new</span> (std::nothrow) <span class="hljs-type">char</span>[bufferSize + <span class="hljs-number">1</span>];</li><li>    <span class="hljs-type">size_t</span> byteLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">1</span>], jsCode, bufferSize + <span class="hljs-number">1</span>, &amp;byteLength);</li><li>
</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"ArkWeb"</span>,</li><li>                 <span class="hljs-string">"ndk OH_NativeArkWeb_RunJavaScript jsCode len:%{public}zu"</span>, <span class="hljs-built_in">strlen</span>(jsCode));</li><li>    </li><li>    <span class="hljs-comment">// Construct the structure of runJS execution</span></li><li>    ArkWeb_JavaScriptObject object = {(<span class="hljs-type">uint8_t</span> *)jsCode, bufferSize, &amp;JSBridgeObject::StaticRunJavaScriptCallback,</li><li>                                     <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">void</span> *&gt;(jsbridge_object_ptr-&gt;<span class="hljs-built_in">GetWeakPtr</span>())};</li><li>    controller-&gt;<span class="hljs-built_in">runJavaScript</span>(webTagValue, &amp;object);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"nativeWebInit"</span>, <span class="hljs-literal">nullptr</span>, NativeWebInit, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"runJavaScript"</span>, <span class="hljs-literal">nullptr</span>, RunJavaScript, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>),</li><li>    .reserved = {<span class="hljs-number">0</span>}</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{ <span class="hljs-built_in">napi_module_register</span>(&amp;demoModule); }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/hello.cpp#L2-L56" target="_blank">hello.cpp</a></div></div></div></div>     <p>Native侧业务代码entry/src/main/cpp/jsbridge_object.h和entry/src/main/cpp/jsbridge_object.cpp详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkweb-ndk-jsbridge" target="_blank">应用侧与前端页面的相互调用(C/C++)</a>。</p>     <p>runJS.html作为应用前端页面：</p>     <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/runJS.html#L2-L69" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en-gb"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>run javascript demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>run JavaScript Ext demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webDemo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height:30px;width:200px"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"testNdkProxyObjMethod1()"</span>&gt;</span>test ndk method1 ! <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height:30px;width:200px"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"testNdkProxyObjMethod2()"</span>&gt;</span>test ndk method2 ! <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span></span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">testNdkProxyObjMethod1</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">      <span class="hljs-comment">// Verify whether the ndk method has been registered in window</span></span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-property">method1</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy method1 undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName  test undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-property">method2</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy method2 undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName  test undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-comment">// Call the method1 method of ndk registered to window and display the results back to the p tag.</span></span></li><li><span class="language-xml">      <span class="hljs-keyword">var</span> retStr = <span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-title function_">method1</span>(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>, [<span class="hljs-number">1.2</span>, -<span class="hljs-number">3.4</span>, <span class="hljs-number">123.456</span>], [<span class="hljs-string">"Saab"</span>, <span class="hljs-string">"Volvo"</span>, <span class="hljs-string">"BMW"</span>, <span class="hljs-literal">undefined</span>], <span class="hljs-number">1.23456</span>, <span class="hljs-number">123789</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>,  <span class="hljs-literal">undefined</span>);</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span>  = <span class="hljs-string">"ndkProxy and method1 is ok, "</span> + retStr;</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">testNdkProxyObjMethod2</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">      <span class="hljs-comment">// Verify whether the ndk method has been registered in window</span></span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-property">method1</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy method1 undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName  test undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-property">method2</span> == <span class="hljs-literal">undefined</span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"ndkProxy method2 undefined"</span>;</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"objName  test undefined"</span>;</span></li><li><span class="language-xml">      }</span></li><li><span class="language-xml">      <span class="hljs-keyword">var</span> student = {</span></li><li><span class="language-xml">        <span class="hljs-attr">name</span>:<span class="hljs-string">"zhang"</span>,</span></li><li><span class="language-xml">        <span class="hljs-attr">sex</span>:<span class="hljs-string">"man"</span>,</span></li><li><span class="language-xml">        <span class="hljs-attr">age</span>:<span class="hljs-number">25</span></span></li><li><span class="language-xml">      };</span></li><li><span class="language-xml">      <span class="hljs-keyword">var</span> cars = [student, <span class="hljs-number">456</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">4.567</span>];</span></li><li><span class="language-xml">      <span class="hljs-keyword">let</span> params = <span class="hljs-string">"[\"{\\\"scope\\\"]"</span>;</span></li><li><span class="language-xml">      <span class="hljs-comment">// Call the method2 method of ndk registration to the windows and display the results back to the p tag</span></span></li><li><span class="language-xml">      <span class="hljs-keyword">var</span> retStr = <span class="hljs-variable language_">window</span>.<span class="hljs-property">ndkProxy</span>.<span class="hljs-title function_">method2</span>(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>, <span class="hljs-literal">false</span>, cars, params);</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span>  = <span class="hljs-string">"ndkProxy and method2 is ok, "</span> + retStr;</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">runJSRetStr</span>(<span class="hljs-params">data</span>) {</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">let</span> time = d.<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"webDemo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(time);</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/runJS.html#L2-L69" target="_blank">runJS.html</a></div></div></div></div>     <p>点击“runJS hello”按钮后，触发H5页面的`runJSRetStr`方法，页面内容更新为当前时间戳。</p>     <p><span><img originheight="721" originwidth="1579" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163418.92841677707365392605096870496386:50001231000000:2800:9DE4D321B8D48B885DF539AB10244B325C76B06CC74B01886BACCDA99884D4A9.png" width="920" height="420.0886637112096"></span></p>     <p>经过多轮测试，从点击ArkTS侧的Button到触发H5侧的runJSRetStr方法，耗时2到6毫秒。</p>     <p></p>     <p><strong>总结</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.134.33.1.4.1.1" valign="top" width="33.33333333333333%">          <p>通信方式</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.134.33.1.4.1.2" valign="top" width="33.33333333333333%">          <p>耗时(局限不同设备和场景，数据仅供参考)</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.134.33.1.4.1.3" valign="top" width="33.33333333333333%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>ArkWeb实现与前端页面通信</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>7ms~9ms</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>ArkTS环境冗余切换,耗时较长</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>ArkWeb、c++实现与前端页面通信</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>2ms~6ms</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>避免ArkTS环境冗余切换，耗时短</p></td>        </tr>             </tbody></table></div>     </div>     <p>JSBridge优化方案适用于ArkWeb应用与前端网页通信，开发者可根据应用架构选择合适的通信机制。</p>     <ol>      <li>应用使用ArkTS语言开发，推荐使用ArkWeb的runJavaScriptExt接口实现应用侧与前端页面的通信，并使用registerJavaScriptProxy接口实现前端页面与应用侧的通信。</li>      <li>应用使用ArkTS和C++语言混合开发，或应用结构类似于小程序架构，自带C++环境，推荐使用ArkWeb在NDK侧提供的OH_NativeArkWeb_RunJavaScript和OH_NativeArkWeb_RegisterJavaScriptProxy接口实现JSBridge功能。</li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开发者需根据当前业务区分是否存在C++侧环境（较为显著标志点为当前应用是否使用了Node API技术进行开发，若是则该应用具备C++侧环境）。 具备C++侧环境的应用开发，可使用ArkWeb提供的NDK侧JSBridge接口。 不具备C++侧环境的应用开发，可使用ArkWeb侧JSBridge接口。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section25281659132214">异步JSBridge调用<i class="anchor-icon anchor-icon-link" anchorid="section25281659132214" tips="复制节点链接"></i></h3>          <p><strong>原理介绍</strong></p>     <p>异步JSBridge调用适用于H5侧调用ArkTS侧或C++侧注册的JSBridge函数。调用后不等待执行结果，避免在ArkUI主线程负载重时JSBridge同步调用导致Web线程等待IPC时间过长，从而造成阻塞。</p>     <p></p>     <p><strong>实践案例</strong></p>    </div>    <p>案例一：使用ArkTS接口实现JSBridge通信，具体步骤如下：</p>    <ol>     <li><span>只注册同步函数</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/RegisterSyncFunction.ets#L2-L111" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-comment">// Define ETS side objects and functions</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestObj</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {}</li><li>  <span class="hljs-title function_">test</span>(<span class="hljs-attr">testStr</span>:<span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-comment">// Simulate time-consuming operations</span></li><li>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {}</li><li>    <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objName.test start: '</span> + start);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'objName.test Sync function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">asyncTestBool</span>(<span class="hljs-attr">testBol</span>:<span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>      <span class="hljs-comment">// Simulate time-consuming operation (asynchronous)</span></li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {}</li><li>        <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objAsyncName.asyncTestBool start: '</span> + start);</li><li>        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'objName.asyncTestBool Async function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>);</li><li>      }, <span class="hljs-number">0</span>); <span class="hljs-comment">// Use 0 ms delay to simulate an asynchronous operation that starts immediately</span></li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebObj</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {}</li><li>  <span class="hljs-title function_">webTest</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-comment">// Simulate time-consuming operations</span></li><li>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {}</li><li>    <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objTestName.webTest start: '</span> + start);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'objTestName.webTest Sync function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">webString</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-comment">// Simulate time-consuming operations</span></li><li>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {}</li><li>    <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objTestName.webString start: '</span> + start);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'objTestName.webString Sync function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncObj</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">asyncTest</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>      <span class="hljs-comment">// Simulate time-consuming operation (asynchronous)</span></li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {</li><li>        }</li><li>        <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objAsyncName.asyncTest start: '</span> + start);</li><li>        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'objAsyncName.asyncTest Async function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>);</li><li>      }, <span class="hljs-number">0</span>); <span class="hljs-comment">// Use 0 ms delay to simulate an asynchronous operation that starts immediately</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">asyncString</span>(<span class="hljs-attr">testStr</span>:<span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>      <span class="hljs-comment">// Simulate time-consuming operation (asynchronous)</span></li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">500000</span>; i++) {</li><li>        }</li><li>        <span class="hljs-keyword">let</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'objAsyncName.asyncString start: '</span> + start);</li><li>        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'objAsyncName.asyncString Async function took '</span> + (end - start) + <span class="hljs-string">'ms'</span>);</li><li>      }, <span class="hljs-number">0</span>); <span class="hljs-comment">// Use 0 millisecond delay to simulate immediate asynchronous operation</span></li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testObjtest</span>: <span class="hljs-title class_">TestObj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObj</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">webTestObj</span>: <span class="hljs-title class_">WebObj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebObj</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">asyncTestObj</span>: <span class="hljs-title class_">AsyncObj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncObj</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'refresh'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-keyword">try</span>{</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">refresh</span>();</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,Message:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Register JavaScript To Window'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// Only register synchronization functions</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">registerJavaScriptProxy</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webTestObj</span>,<span class="hljs-string">"objTestName"</span>,[<span class="hljs-string">"webTest"</span>,<span class="hljs-string">"webString"</span>]);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,Message:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>),<span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>}).<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/RegisterSyncFunction.ets#L2-L111" target="_blank">RegisterSyncFunction.ets</a></div></div></div></div>      <p></p></li>     <li><span>H5侧调用JSBridge函数</span>      <p></p>      <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/demo.html#L2-L42" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span></li><li><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"htmlTest()"</span>&gt;</span> Click Me!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"demo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webDemo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"asyncDemo"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span></span></li><li><span class="language-xml">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">htmlTest</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"demo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'测试开始:'</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() + <span class="hljs-string">'\n'</span>;</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objTestName.<span class="hljs-title function_">webString</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objAsyncName.<span class="hljs-title function_">asyncString</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objName.<span class="hljs-title function_">asyncTestBool</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objName.<span class="hljs-title function_">test</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time5 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objTestName.<span class="hljs-title function_">webTest</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time6 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      objAsyncName.<span class="hljs-title function_">asyncTest</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> time7 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();</span></li><li><span class="language-xml">      <span class="hljs-keyword">const</span> result = [</span></li><li><span class="language-xml">        <span class="hljs-string">'objTestName.webString()耗时：'</span>+ (time2 - time1),</span></li><li><span class="language-xml">        <span class="hljs-string">'objAsyncName.asyncString()耗时：'</span>+ (time3 - time2),</span></li><li><span class="language-xml">        <span class="hljs-string">'objName.asyncTestBool()耗时：'</span>+ (time4 - time3),</span></li><li><span class="language-xml">        <span class="hljs-string">'objName.test()耗时：'</span>+ (time5 - time4),</span></li><li><span class="language-xml">        <span class="hljs-string">'objTestName.webTest()耗时：'</span>+ (time6 - time5),</span></li><li><span class="language-xml">        <span class="hljs-string">'objAsyncName.asyncTest()耗时：'</span>+ (time7 - time6)</span></li><li><span class="language-xml">      ]</span></li><li><span class="language-xml">      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"demo"</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"demo"</span>).<span class="hljs-property">innerHTML</span> + <span class="hljs-string">'\n'</span> + result.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/resources/rawfile/demo.html#L2-L42" target="_blank">demo.html</a></div></div></div></div>      <p></p></li>    </ol>    <p></p>    <p>案例二：使用 `registerJavaScriptProxy` 或 `javaScriptProxy` 注册异步函数或异步同步共存函数。H5 侧调用 JSBridge 函数时，建议避免使用不推荐的用法。</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/RegisterJavaScriptProxy.ets#L91-L121" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'refresh'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>    <span class="hljs-keyword">try</span>{</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">refresh</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,Message:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  })</li><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'Register JavaScript To Window'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Only register synchronization functions</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">registerJavaScriptProxy</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webTestObj</span>,<span class="hljs-string">"objTestName"</span>,[<span class="hljs-string">"webTest"</span>,<span class="hljs-string">"webString"</span>]);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,Message:<span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  })</li><li><span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>),<span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>}).<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>
</li><li><span class="hljs-comment">// Registration by javaScriptProxy</span></li><li><span class="hljs-comment">// javaScriptProxy only supports the registration of one object. If you need to register multiple objects, please use registerJavaScriptProxy.</span></li><li><span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>),<span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>})</li><li> .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li> .<span class="hljs-title function_">javaScriptProxy</span>({</li><li>   <span class="hljs-attr">object</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">testObjtest</span>,</li><li>   <span class="hljs-attr">name</span>:<span class="hljs-string">"objName"</span>,</li><li>   <span class="hljs-attr">methodList</span>: [<span class="hljs-string">"test"</span>,<span class="hljs-string">"toString"</span>],</li><li>   <span class="hljs-comment">// Specify the list of asynchronous functions</span></li><li>   <span class="hljs-attr">asyncMethodList</span>: [<span class="hljs-string">"test"</span>,<span class="hljs-string">"toString"</span>],</li><li>   <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span></li><li> })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/ets/pages/RegisterJavaScriptProxy.ets#L91-L121" target="_blank">RegisterJavaScriptProxy.ets</a></div></div></div></div>    <p></p>    <p><strong>总结</strong></p>    <p>数据运行结果如下表所示。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.144.1.4.1.1" valign="top" width="33.33333333333333%">         <p>注册方法类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.144.1.4.1.2" valign="top" width="33.33333333333333%">         <p>耗时(局限不同设备和场景，数据仅供参考)</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.144.1.4.1.3" valign="top" width="33.33333333333333%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>同步方法</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>1398ms，2707ms，2705ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>同步函数调用会阻塞JavaScript线程</p></td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>异步方法</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>2ms，2ms，4ms</p></td>        <td class="cellrowborder" valign="top" width="33.33333333333333%">         <p>异步函数调用不阻塞JavaScript线程</p></td>       </tr>           </tbody></table></div>    </div>    <p>运行数据显示，`async`异步方法在JavaScript单线程任务队列中不会长时间占用，因为它们不需要等待结果。而同步方法则需要等待ArkTS侧主线程同步执行后才能返回结果。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>JSBridge接口在注册时，即会根据注册调用的接口决定其调用方式（同步/异步）。开发者需根据当前业务区分， 是否将其注册为异步函数。</p>      <ul>       <li>同步函数调用会阻塞JavaScript执行，等待JSBridge函数执行结束，适用于需要返回值或存在时序问题的场景。</li>       <li>异步函数调用时不会等待JSBridge函数执行结束，后续JavaScript可在特定时间后继续执行。JSBridge函数无法直接返回值。</li>       <li>注册在ETS侧的JSBridge函数调用时需要在主线程上执行；NDK侧注册的函数将在其他线程中执行。</li>       <li>异步JSBridge接口与同步接口在JavaScript侧的调用方式一致，仅注册方式不同，本部分调用方式仅作简要示范。</li>      </ul>     </div></div></div>    <p>附 NDK 接口实现 JSBridge 通信（C++ 侧注册异步函数）：</p>    <div class="screenLinkPre"><div _ngcontent-ofl-c106="" class="highlight-div"><div _ngcontent-ofl-c106="" class="highlight-div-header"><div _ngcontent-ofl-c106="" class="highlight-div-header-left"><div _ngcontent-ofl-c106="" class="handle-button expand-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ofl-c106="" class="highlight-div-header-right"><div _ngcontent-ofl-c106="" class="handle-button ai-button"></div><div _ngcontent-ofl-c106="" class="handle-button line-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ofl-c106="" class="handle-button theme-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ofl-c106="" class="handle-button copy-button"><div _ngcontent-ofl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ofl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/DefineJSBridge.cpp#L2-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Define the JSBridge function</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ProxyMethod1</span><span class="hljs-params">(const <span class="hljs-type">char</span>* webTag, <span class="hljs-keyword">void</span>* userData)</span> {</li><li>    OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"ArkWeb"</span>, <span class="hljs-string">"Method1 webTag :%{public}s"</span>,webTag);</li><li>}</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ProxyMethod2</span><span class="hljs-params">(const <span class="hljs-type">char</span>* webTag, <span class="hljs-keyword">void</span>* userData)</span> {</li><li>    OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"ArkWeb"</span>, <span class="hljs-string">"Method2 webTag :%{public}s"</span>,webTag);</li><li>}</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ProxyMethod3</span><span class="hljs-params">(const <span class="hljs-type">char</span>* webTag, <span class="hljs-keyword">void</span>* userData)</span> {</li><li>    OH_LOG_Print(LOG_APP, LOG_INFO, LOG_PRINT_DOMAIN, <span class="hljs-string">"ArkWeb"</span>, <span class="hljs-string">"Method3 webTag :%{public}s"</span>,webTag);</li><li>}</li><li>
</li><li><span class="hljs-keyword">void</span> <span class="hljs-title function_">RegisterCallback</span><span class="hljs-params">(const <span class="hljs-type">char</span> *webTag)</span> {</li><li>    <span class="hljs-type">int</span> <span class="hljs-variable">myUserData</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;</li><li>    <span class="hljs-comment">//Create function method structure</span></li><li>    <span class="hljs-type">ArkWeb_ProxyMethod</span> <span class="hljs-variable">m1</span> <span class="hljs-operator">=</span> {</li><li>        .methodName = <span class="hljs-string">"method1"</span>,</li><li>        .callback = ProxyMethod1,</li><li>        .userData = (<span class="hljs-keyword">void</span> *)&amp;myUserData</li><li>    };</li><li>    <span class="hljs-type">ArkWeb_ProxyMethod</span> <span class="hljs-variable">m2</span> <span class="hljs-operator">=</span> {</li><li>        .methodName = <span class="hljs-string">"method2"</span>,</li><li>        .callback = ProxyMethod2,</li><li>        .userData = (<span class="hljs-keyword">void</span> *)&amp;myUserData</li><li>    };</li><li>    <span class="hljs-type">ArkWeb_ProxyMethod</span> <span class="hljs-variable">m3</span> <span class="hljs-operator">=</span> {</li><li>        .methodName = <span class="hljs-string">"method3"</span>,</li><li>        .callback = ProxyMethod3,</li><li>        .userData = (<span class="hljs-keyword">void</span> *)&amp;myUserData</li><li>    };</li><li>    ArkWeb_ProxyMethod methodList[<span class="hljs-number">2</span>] = {m1,m2};</li><li>    </li><li>    <span class="hljs-comment">//Create a JSBridge object structure</span></li><li>    <span class="hljs-type">ArkWeb_ProxyObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> {</li><li>        .objName = <span class="hljs-string">"ndkProxy"</span>,</li><li>        .methodList = methodList,</li><li>        .size = <span class="hljs-number">2</span></li><li>    };</li><li>    <span class="hljs-comment">// Get the ArkWeb_Controller API structure</span></li><li>    ArkWeb_AnyNativeAPI* apis = OH_ArkWeb_GetNativeAPI(ArkWeb_NativeAPIVariantKind::ARKWEB_NATIVE_CONTROLLER);</li><li>    ArkWeb_ControllerAPI* ctrlApi = reinterpret_cast&lt;ArkWeb_ControllerAPI*&gt;(apis);</li><li>
</li><li>        <span class="hljs-comment">// Call the registration interface, registration function</span></li><li>        ctrlApi-&gt;registerJavaScriptProxy(webTag, &amp;obj);</li><li>    </li><li>    ArkWeb_ProxyMethod asyncMethodList[<span class="hljs-number">1</span>] = {m3};</li><li>    <span class="hljs-type">ArkWeb_ProxyObject</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> {</li><li>        .objName = <span class="hljs-string">"ndkProxy"</span>,</li><li>    .methodList = asyncMethodList,</li><li>    .size = <span class="hljs-number">1</span></li><li>    };</li><li>    ctrlApi-&gt;registerAsyncJavaScriptProxy(webTag, &amp;obj2);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/LoadPerformanceInWeb/entry/src/main/cpp/DefineJSBridge.cpp#L2-L55" target="_blank">DefineJSBridge.cpp</a></div></div></div></div>    <div class="tiledSection">     <h2 id="section8520716143919">同层渲染<i class="anchor-icon anchor-icon-link" anchorid="section8520716143919" tips="复制节点链接"></i></h2>         </div>    <p>同层渲染是一种优化技术，用于提高Web页面的渲染性能。同层渲染会将位于同一个图层的元素一起渲染，以减少重绘和重排的次数，从而提高页面的渲染效率。关于同层渲染的内容，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-render-web-using-same-layer-render">使用同层渲染在Web组件上渲染原生组件</a>。</p>    <div class="tiledSection">     <h2 id="section105131011207">总结<i class="anchor-icon anchor-icon-link" anchorid="section105131011207" tips="复制节点链接"></i></h2>          <p>本文深入探讨Web页面加载原理及优化方法，为开发者提供重要指导。互联网时代，用户对网页加载速度和体验要求提高，页面加载优化成为开发者必须重视的环节。理解Web页面加载原理，有助于开发者处理加载优化问题，提升应用质量。</p>     <p>文中介绍了预连接、预下载、预渲染、预取POST、预编译等优化方法，指导开发者提高Web页面的加载速度。这些方法能够显著提升应用的流畅度和用户体验。然而，这些优化方法均依赖预处理，因此会带来一定的成本。</p>     <p>在实际开发中，开发者应根据具体情况进行权衡，确定合适的方案与策略。此外，提供JSBridge和资源加速优化方案，帮助提高Web加载性能。除了上述方法，开发者还可以通过压缩资源和减少HTTP请求来进一步优化页面加载速度。压缩资源可减小文件大小，减少加载时间；减少HTTP请求可降低网络延迟，加快页面加载速度，提升用户体验。</p>     <p>Web页面加载优化对提升用户体验、网站性能、页面浏览量和转化率至关重要。开发者应重视并持续探索优化方法，以实现商业目标。采用文章中介绍的优化方法，可以改善页面加载速度，增强用户体验，增加页面浏览量，提升应用活跃度和用户粘性。持续优化页面加载速度，能够更好地满足用户需求，提升应用价值。</p>    </div>   </div>   <div></div></div>