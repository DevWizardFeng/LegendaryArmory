<h1 _ngcontent-rgs-c119="" class="doc-title ng-star-inserted" title="Web页面视频适配"> Web页面视频适配 </h1>

<div _ngcontent-rgs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1044424515504">概述<i class="anchor-icon anchor-icon-link" anchorid="section1044424515504" tips="复制节点链接"></i></h2><p>在Web页面中，通常会包含一些像图片、视频一类的媒体资源，在使用Web组件加载这一类页面时，就会遇到视频播放适配的问题，本文汇总了以下常见的Web页面内视频适配场景：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-video-adaptation-based-web#section6164167185112">全屏播放视频</a>：默认情况下视频点进全屏播放后，会以竖屏的形式进行播放，导致视频画面较小影响用户体验，通过适配全屏播放视频，可以让用户拥有更好的视频观看体验。</li><li><a href="/consumer/cn/doc/best-practices/bpta-video-adaptation-based-web#section17915201314510">长按复制视频链接</a>：Web页面内视频无法通过有效的方式快速地在用户间分享，限制了内容的分享传播，通过适配长按复制视频链接，可以让用户快速精确地获得视频地址，更好地促进应用内容传播。</li><li><a href="/consumer/cn/doc/best-practices/bpta-video-adaptation-based-web#section101341622115114">长按下载视频</a>：H5提供的video标签默认带有保存功能，但是在使用Web组件加载时，下载按钮实际不可用，不便于用户保存感兴趣的视频内容，通过适配长按下载视频，可以让Web页面内的视频便捷地保存到本地设备。</li></ul> </div> <div class="tiledSection"><h2 id="section6164167185112">全屏播放视频<i class="anchor-icon anchor-icon-link" anchorid="section6164167185112" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section152819612521" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section152819612521" tips="复制节点链接"></i></h3><p>默认情况下，网页中的视频点击全屏按钮后，会在移动设备上以竖屏形式播放视频，同时也无法兼容手势返回，对于用户而言，竖屏播放视频画面有限，更希望视频能够以横屏全屏的形式播放，同时使用手势返回后，只退出全屏播放，而不是返回到桌面，在这种情况下，就需要开发者对Web视频做全屏播放的适配。</p> <div class="fignone"><span class="figcap"><b>图1 </b>默认情况下进入视频全屏播放效果</span><br><span><img height="600.0827" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.31215231322297315078141229215341:50001231000000:2800:79D83E37F4487F36CDF6D9F00A0980F7305B31B42ADB85A2B88E9F2A3133025C.gif" title="点击放大" width="292.6"></span></div> </div> <div class="tiledSection"><h3 id="section11663171015217">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section11663171015217" tips="复制节点链接"></i></h3><div class="fignone"><span class="figcap"><b>图2 </b>Web页面适配全屏播放视频流程图</span><br><span><img height="183.06298494623653" originheight="398" originwidth="2000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.60477217030817457980031574862879:50001231000000:2800:A3C709463A20DE0886A1554474C5AE98154939BC0684FC31BCF9E395E8B6CDAB.png" title="点击放大" width="920"></span></div> <p>全屏播放视频首先需要Web页面做沉浸式展示，才能保证在进入全屏显示后，视频能够在非安全区展示。具体实现可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-develop-apply-immersive-effects" target="_blank">开发应用沉浸式效果</a>。</p> <p>为解决点击全屏后视频竖屏显示的问题，需要在Web页面进入全屏的事件回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfullscreenenter9" target="_blank">onFullScreenEnter()</a>中，通过手动<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>接口将屏幕设置为横屏显示。</p> <p>为保证退出全屏后，页面继续保持正常的竖屏显示，需要在Web页面退出全屏的事件回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfullscreenexit9" target="_blank">onFullScreenExit()</a>中，手动通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>接口将屏幕设置为竖屏显示。</p> <p>需要注意的是，在页面进入全屏后，需要兼容通过返回手势触发退出全屏的逻辑，具体实现上，需要在触发手势返回的事件回调中，首先判断当前应用是否处于全屏显示，若处于则触发退出全屏，返回手势触发有以下两类。</p> <ul><li>若为入口页面，则可在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#onbackpress" target="_blank">onBackPress()</a>页面生命周期函数中，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-nativemediaplayerbridge#exitfullscreen12" target="_blank">exitFullScreen()</a>退出全屏。</li><li>若为使用Navigation加载的页面，则可在NavDestination的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navdestination#onbackpressed10" target="_blank">onBackPressed()</a>回调中，同样通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-nativemediaplayerbridge#exitfullscreen12" target="_blank">exitFullScreen()</a>退出全屏。</li></ul> <div class="fignone"><span class="figcap"><b>图3 </b>Web页面适配全屏播放效果</span><br><span><img height="600.0827" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.73199609222436249061832229486942:50001231000000:2800:9A0995EF2126DAFA189FA99E3425BDBD2D81B2B3ADBC76A4D8DCD7A1AE7961AE.gif" title="点击放大" width="292.6"></span></div> </div> <div class="tiledSection"><h3 id="section146918181526">实现步骤<i class="anchor-icon anchor-icon-link" anchorid="section146918181526" tips="复制节点链接"></i></h3><p><strong>进入全屏播放</strong></p> <ol><li>Web页面实现时需要注意进行非安全区内容避让，Web组件在加载Web页面时通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-expand-safe-area#expandsafearea" target="_blank">expandSafeArea()</a>扩展其安全区域，从而让视频沉浸式显示。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L145-L159" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Web</span>({</li><li>  <span class="hljs-variable">src</span>: $<span class="hljs-title class_">rawfile</span>(<span class="hljs-variable">/zh</span>/.<span class="hljs-title class_">test</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title class_">language</span>) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">webController</span></li><li>})</li><li><span class="hljs-comment">// ...</span></li><li>  .<span class="hljs-title function_">expandSafeArea</span>([<span class="hljs-variable">SafeAreaType</span>.<span class="hljs-variable">SYSTEM</span>])</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L145-L159" target="_blank">Index.ets</a></div></div></div></div> </li><li>自定义改变设备横竖屏状态函数，此处定义了changeOrientation()函数，在函数内通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setpreferredorientation9" target="_blank">setPreferredOrientation()</a>接口改变屏幕方向。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L29-L222" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = context <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowClass</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span> = windowClass);</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * Changes the preferred orientation of the window.</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">orientation</span> - The preferred orientation to set. This should be a value from the `window.Orientation` enum.</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> <span class="hljs-variable">void</span> - This function does not return any value.</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">changeOrientation</span>(<span class="hljs-params">orientation: <span class="hljs-variable language_">window</span>.Orientation</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">setPreferredOrientation</span>(orientation);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L29-L222" target="_blank">Index.ets</a></div></div></div></div> </li><li>设置Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfullscreenenter9" target="_blank">onFullScreenEnter()</a>方法，在方法内通过刚刚定义的changeOrientation()方法改变设备的横竖屏状态，设置屏幕方向为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#orientation10" target="_blank">window.Orientation.LANDSCAPE</a>（横屏显示模式）。此时需要存储event中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-i#fullscreenenterevent12" target="_blank">handler</a>，该函数句柄中存储了退出全屏的方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-fullscreenexithandler#exitfullscreen9" target="_blank">exitFullScreen()</a>。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L30-L221" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isFullScreen</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">handler</span>: <span class="hljs-title class_">FullScreenExitHandler</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({</li><li>        <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-regexp">/zh/</span>.<span class="hljs-title function_">test</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">language</span>) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span></li><li>      })</li><li>      <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-title function_">onFullScreenEnter</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">handler</span> = event.<span class="hljs-property">handler</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeOrientation</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">LANDSCAPE</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isFullScreen</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L30-L221" target="_blank">Index.ets</a></div></div></div></div> </li></ol> <p><strong>退出全屏播放</strong></p> <ol><li>设置Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfullscreenexit9" target="_blank">onFullScreenExit()</a>回调，在回调内通过changeOrientation()方法改变设备的横竖屏状态，设置屏幕方向为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-display#orientation10" target="_blank">window.Orientation.PORTRAIT</a>（竖屏显示模式）。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L146-L213" data-highlighted="yes"><ol class="linenums"><li>Web({</li><li>  src: $rawfile(/zh/.test(<span class="hljs-keyword">this</span>.language) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>  controller: <span class="hljs-keyword">this</span>.webController</li><li>})</li><li><span class="hljs-comment">// ...</span></li><li>  .onFullScreenExit(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.changeOrientation(window.Orientation.PORTRAIT);</li><li>    <span class="hljs-keyword">this</span>.isFullScreen = <span class="hljs-literal">false</span>;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L146-L213" target="_blank">Index.ets</a></div></div></div></div> </li><li>处理手势返回，以下以首页返回为例，需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#onbackpress" target="_blank">onBackPress()</a>页面生命周期函数中，判断当前是否处于全屏显示状态，若处于全屏显示，则调用之前存储的handler中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-fullscreenexithandler#exitfullscreen9" target="_blank">exitFullScreen()</a>退出全屏。<div class="p"><div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L128-L134" data-highlighted="yes"><ol class="linenums"><li>onBackPress(): boolean | void {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFullScreen &amp;&amp; <span class="hljs-keyword">this</span>.handler) {</li><li>    <span class="hljs-keyword">this</span>.handler.exitFullScreen();</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L128-L134" target="_blank">Index.ets</a></div></div></div></div> </div> </li></ol> </div> <div class="tiledSection"><h2 id="section17915201314510">长按复制视频链接<i class="anchor-icon anchor-icon-link" anchorid="section17915201314510" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1878595375415" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1878595375415" tips="复制节点链接"></i></h3><p>长按复制视频链接经常被应用于社交分享的场景，用户在应用内看到感兴趣的视频内容希望分享给周边的人，通过长按希望分享的视频选中“复制视频链接地址”选项，可以帮助用户快捷准确地获取到视频的链接地址。</p> <div class="fignone"><span class="figcap"><b>图4 </b>长按复制视频链接地址效果图</span><br><span><img height="600.0827" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.28470658867383557297704572966714:50001231000000:2800:BD2EDA112C583AF606E2F6B1673702B2292EC9156E29060BD62A97C51B431FB9.gif" title="点击放大" width="292.6"></span></div> </div> <div class="tiledSection"><h3 id="section193351327504">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section193351327504" tips="复制节点链接"></i></h3><p>长按复制视频链接功能在实现上有以下两个关键部分。</p> <ul><li>长按菜单功能主要依靠<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-popup#bindpopup" target="_blank">bindPopup()</a>实现，该方法能为组件绑定popup弹窗，并通过布尔类型的状态变量控制弹窗的打开关闭，开发者可以通过设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-popup#custompopupoptions8类型说明" target="_blank">CustomPopupOptions</a>定制弹窗内容与样式。</li><li>复制视频链接功能主要依靠<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow()</a>回调，该回调会在长按特定页面元素（图片、视频、链接等）时被调用，其事件参数中会携带长按元素的相关属性，对于视频而言，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuparam#getsourceurl9" target="_blank">event.param.getSourceUrl()</a>获取到视频地址，并通过改变弹窗控制的状态变量来打开弹窗。在点击“复制视频链接地址”时将该链接地址通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard#setdata9" target="_blank">setData()</a>方法写入系统剪贴板。</li></ul> </div> <div class="tiledSection"><h3 id="section181959331809">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section181959331809" tips="复制节点链接"></i></h3><ol><li>定义弹窗内容组件，此处使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>作为弹窗内容，通过循环渲染menus菜单数据生成对应的菜单列表。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/view/CustomPopupMenu.ets#L51-L89" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//src/main/ets/view/CustomPopupMenu.ets</span></li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * A custom popup menu Builder.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">uri</span> - The URI for which the popup menu will be built.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">context</span> - The UI context in which the popup menu will be used. This should be an instance of `common.UIAbilityContext`.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">openDownloadDialog</span> - A function that, when called, will open a download dialog.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">closeDownloadDialog</span> - A function that, when called, will close the download dialog.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">changeIsShow</span> - A function that, when called, will change the visibility of certain UI elements.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customPopupMenuBuilder</span>(<span class="hljs-params"></span></li><li><span class="hljs-params">  uri: <span class="hljs-built_in">string</span>,</span></li><li><span class="hljs-params">  context: common.UIAbilityContext,</span></li><li><span class="hljs-params">  openDownloadDialog: <span class="hljs-built_in">Function</span>,</span></li><li><span class="hljs-params">  closeDownloadDialog: <span class="hljs-built_in">Function</span>,</span></li><li><span class="hljs-params">  changeIsShow: <span class="hljs-built_in">Function</span></span></li><li><span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(menus, <span class="hljs-function">(<span class="hljs-params">menu: MenuItem</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">MenuItem</span>({</li><li>          <span class="hljs-attr">content</span>: menu.<span class="hljs-property">text</span></li><li>        })</li><li>          .<span class="hljs-title function_">height</span>(singlePopupHeight)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              menu.<span class="hljs-property">caller</span> &amp;&amp; menu.<span class="hljs-title function_">caller</span>(uri, context, openDownloadDialog, closeDownloadDialog);</li><li>              <span class="hljs-title function_">changeIsShow</span>();</li><li>            } <span class="hljs-keyword">catch</span> (e) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-title class_">Constants</span>.<span class="hljs-property">TAG</span>, <span class="hljs-string">`some error happened, <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(e)}</span>`</span>);</li><li>            }</li><li>          })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">menu: MenuItem</span>) =&gt;</span> menu.<span class="hljs-property">id</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(popupWidth)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/view/CustomPopupMenu.ets#L51-L89" target="_blank">CustomPopupMenu.ets</a></div></div></div></div> </li><li>定义isShow作为弹窗显示控制的状态变量，并为Web组件绑定popup弹窗。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L26-L223" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> uiContext: UIContext | undefined = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'uiContext'</span>);</li><li>let context = uiContext!.getHostContext()</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-meta">@State</span> isShow: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({</li><li>        src: $rawfile(/zh/.test(<span class="hljs-keyword">this</span>.language) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>        controller: <span class="hljs-keyword">this</span>.webController</li><li>      })</li><li>      <span class="hljs-comment">// ...</span></li><li>        .bindPopup(<span class="hljs-keyword">this</span>.isShow, {</li><li>          builder: customPopupMenuBuilder(</li><li>            <span class="hljs-keyword">this</span>.linkUrl,</li><li>            <span class="hljs-keyword">this</span>.context,</li><li>            <span class="hljs-keyword">this</span>.openDownloadDialog,</li><li>            <span class="hljs-keyword">this</span>.closeDownloadDialog,</li><li>            <span class="hljs-keyword">this</span>.changeIsShow,</li><li>          ),</li><li>          enableArrow: <span class="hljs-literal">false</span>,</li><li>          placement: Placement.TopLeft,</li><li>          offset: getOffset(<span class="hljs-keyword">this</span>.webWidth, <span class="hljs-keyword">this</span>.webHeight,</li><li>            <span class="hljs-keyword">this</span>.pressPosX, <span class="hljs-keyword">this</span>.pressPosY),</li><li>          onStateChange: (e) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (!e.isVisible) {</li><li>              <span class="hljs-keyword">this</span>.isShow = <span class="hljs-literal">false</span>;</li><li>              <span class="hljs-keyword">this</span>.result?.closeContextMenu();</li><li>            }</li><li>          }</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L26-L223" target="_blank">Index.ets</a></div></div></div></div> </li><li>使用Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow()</a>事件，当触发自定义弹窗时，通过事件参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuparam#getsourceurl9" target="_blank">event.param.getSourceUrl()</a>获取到Web视频链接地址。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L31-L224" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-meta">@State</span> isShow: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({</li><li>        src: $rawfile(/zh/.test(<span class="hljs-keyword">this</span>.language) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>        controller: <span class="hljs-keyword">this</span>.webController</li><li>      })</li><li>      <span class="hljs-comment">// ...</span></li><li>        .onContextMenuShow((event) =&gt; {</li><li>          <span class="hljs-keyword">if</span> (!event) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-keyword">this</span>.linkUrl = event.param.getSourceUrl();</li><li>          <span class="hljs-keyword">this</span>.isShow = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L31-L224" target="_blank">Index.ets</a></div></div></div></div> </li><li>将获取的链接地址通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard#setdata9" target="_blank">setData()</a>方法写入到系统剪贴板，即可完成视频地址的复制。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/CustomFunction.ets#L28-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Copies a URI to the system clipboard.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">uri</span> - The URI to be copied to the clipboard. This should be a valid string representing a URI.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> <span class="hljs-variable">void</span> - This function does not return any value.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyLink</span>(<span class="hljs-params">uri: string</span>) {</li><li>  <span class="hljs-keyword">const</span> pasteData = pasteboard.<span class="hljs-title function_">createData</span>(<span class="hljs-string">'text/plain'</span>, uri);</li><li>  pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>().<span class="hljs-title function_">setData</span>(pasteData, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-title class_">Constants</span>.<span class="hljs-property">TAG</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    context1.<span class="hljs-title function_">showToast</span>({</li><li>      <span class="hljs-attr">message</span>: $r(<span class="hljs-string">'app.string.copy_success'</span>)</li><li>    })</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/CustomFunction.ets#L28-L45" target="_blank">CustomFunction.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section101341622115114">长按下载视频<i class="anchor-icon anchor-icon-link" anchorid="section101341622115114" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section20312105718019" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section20312105718019" tips="复制节点链接"></i></h3><p>长按下载视频经常用于提供给用户本地缓存感兴趣的视频内容的能力，用户可以直接长按感兴趣的视频内容打开弹窗，选择“下载视频”将其保存到设备本地，下载后的视频也可以通过社交分享渠道进行分享。</p> </div> <div class="tiledSection"><h3 id="section7514011615">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section7514011615" tips="复制节点链接"></i></h3><div class="fignone"><span class="figcap"><b>图5 </b>长按下载视频整体适配流程图</span><br><span><img height="177.23354838709676" originheight="383" originwidth="1988" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.58816784045709131885844181357400:50001231000000:2800:3EB81F6009259D08D1EDBBD74A6D55AE6CF3F7F3B909C54005E7CDC24424F1EB.png" title="点击放大" width="920"></span></div> <p>长按视频区域后，可通过在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow()</a>接口中的事件参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuparam#getsourceurl9" target="_blank">event.param.getSourceUrl()</a>获取到视频链接地址。</p> <p>开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-download" target="_blank">使用Web组件的下载能力</a>，通过绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaddelegate" target="_blank">WebDownloadDelegate</a>委托类进行下载控制与状态感知，该类会通过以下四个回调注册方法通知下载状态。</p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaddelegate#onbeforedownload11" target="_blank">onBeforeDownload()</a>：下载开始前的回调注册方法，方法内通常用于做下载前的校验，同时在该方法内还需要通过WebDownloadItem.start('xxx')方式指定下载路径。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaddelegate#ondownloadupdated11" target="_blank">onDownloadUpdated()</a>：下载过程中的回调注册方法，方法内通常用于维护下载过程中的状态变量，例如下载进度、下载速度等信息，并将这些信息可视化地呈现给用户。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaddelegate#ondownloadfailed11" target="_blank">onDownloadFailed()</a>：下载失败的回调注册方法，方法内通常需要进行下载失败的逻辑处理，例如序列化已下载数据便于恢复下载、向用户提示下载失败等。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaddelegate#ondownloadfinish11" target="_blank">onDownloadFinish()</a>：下载成功的回调注册方法，方法内用于注册下载成功后的处理逻辑，例如分享给其他用户、保存到相册等。</li></ul> <p>通过Web组件关联的WebviewController调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#startdownload11" target="_blank">startDownload()</a>并传入视频链接地址触发下载。</p> <div class="fignone"><span class="figcap"><b>图6 </b>长按下载视频效果图</span><br><span><img height="600.0827" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163018.04973916039715010874723944710099:50001231000000:2800:3FF6DD1C6C4A649034BDA5F4771FDE7CBC5436CB764D5A814800EDB154FB5DFD.gif" title="点击放大" width="292.6"></span></div> </div> <div class="tiledSection"><h3 id="section1218512813113">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1218512813113" tips="复制节点链接"></i></h3><ol><li>通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow()</a>事件，在事件参数event中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuparam#getsourceurl9" target="_blank">event.param.getSourceUrl()</a>获取到视频链接地址。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L31-L224" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-meta">@State</span> isShow: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Web({</li><li>        src: $rawfile(/zh/.test(<span class="hljs-keyword">this</span>.language) ? <span class="hljs-string">'index_cn.html'</span> : <span class="hljs-string">'index_en.html'</span>),</li><li>        controller: <span class="hljs-keyword">this</span>.webController</li><li>      })</li><li>      <span class="hljs-comment">// ...</span></li><li>        .onContextMenuShow((event) =&gt; {</li><li>          <span class="hljs-keyword">if</span> (!event) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>          }</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-keyword">this</span>.linkUrl = event.param.getSourceUrl();</li><li>          <span class="hljs-keyword">this</span>.isShow = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/pages/Index.ets#L31-L224" target="_blank">Index.ets</a></div></div></div></div> </li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloadmanager#setdownloaddelegate11" target="_blank">setDownloadDelegate()</a>为Web组件关联的控制器WebviewController绑定下载委托类WebDownloadDelegate。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L40-L197" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebDownloadManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbstractWebDownloadManager</span></li><li><span class="hljs-keyword">implements</span> <span class="hljs-title class_">ControllerManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Define the download delegate instance.</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">delegate</span>: webview.<span class="hljs-property">WebDownloadDelegate</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebDownloadDelegate</span>();</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">start</span>(<span class="hljs-attr">controllerName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> controller = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getController</span>(controllerName);</li><li>      <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-comment">// Associate the download delegate with the webview controller.</span></li><li>        controller?.<span class="hljs-title function_">setDownloadDelegate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">delegate</span>);</li><li>        <span class="hljs-comment">// ...</span></li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Execution failed, code = %{public}d, message = %{public}s'</span>,</li><li>          error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L40-L197" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li><li>为WebDownloadDelegate下载委托类设置相关事件回调。<ol><li>下载开始前需要指定文件的存储路径，开发者可通过UIAbilityContent上的filesDir传入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank">应用沙箱目录</a>作为下载地址，通过WebDownloadItem的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaditem#start11" target="_blank">start()</a>方法传入下载路径即可完成配置。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L73-L79" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.delegate.onBeforeDownload((webDownloadItem: webview.WebDownloadItem) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.currentTask = webDownloadItem;</li><li>  <span class="hljs-keyword">this</span>.sourcePath = path + <span class="hljs-string">'/'</span> + webDownloadItem.getSuggestedFileName();</li><li>  <span class="hljs-keyword">this</span>.currentTask.start(<span class="hljs-keyword">this</span>.sourcePath);</li><li>  <span class="hljs-comment">// Specify the download path before downloading.</span></li><li>  <span class="hljs-keyword">this</span>.taskStatus = webDownloadItem.getState();</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L73-L79" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li><li>任务下载过程中，开发者可按需维护下载相关信息，例如此处维护了下载的进度downloadProgress与下载速度downloadSpeed提供给UI组件进行展示，下载进度通过webDownloadItem调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaditem#getpercentcomplete11" target="_blank">getPercentComplete()</a>方法获取，下载速度通过webDownloadItem调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaditem#getcurrentspeed11" target="_blank">getCurrentSpeed()</a>方法获取。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L82-L88" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.delegate.onDownloadUpdated((webDownloadItem: webview.WebDownloadItem) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.currentTask = webDownloadItem;</li><li>  <span class="hljs-comment">// maintain download progress.</span></li><li>  <span class="hljs-keyword">this</span>.downloadProgress = webDownloadItem.getPercentComplete();</li><li>  <span class="hljs-keyword">this</span>.downloadSpeed = webDownloadItem.getCurrentSpeed();</li><li>  <span class="hljs-keyword">this</span>.taskStatus = webDownloadItem.getState();</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L82-L88" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li><li>当任务下载成功后，开发者可以向用户提示下载完成，并按需执行后续的业务逻辑。例如将视频分享给其他软件或保存到其他位置，此处以用户提示下载完成为例。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L99-L102" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.delegate.onDownloadFinish((webDownloadItem: webview.WebDownloadItem) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.taskStatus = webDownloadItem.getState();</li><li>  resolve(<span class="hljs-keyword">this</span>.sourcePath);</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L99-L102" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li><li>WebDownloadDelegate也提供了下载失败的事件回调，并提供了序列化下载任务的方法，开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaditem#serialize11" target="_blank">serialize()</a>方法将下载失败的任务进行序列化，便于之后恢复下载。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L91-L96" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">delegate</span>.<span class="hljs-title function_">onDownloadFailed</span>(<span class="hljs-function">(<span class="hljs-params">webDownloadItem: webview.WebDownloadItem</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// Serialize the download data when the download fails to resume the download.</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">failedData</span> = webDownloadItem.<span class="hljs-title function_">serialize</span>();</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskStatus</span> = webDownloadItem.<span class="hljs-title function_">getState</span>();</li><li>  <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'download failed'</span>));</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L91-L96" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li><li>在合适的时机首先通过webview.WebDownloadManager上的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloadmanager#setdownloaddelegate11" target="_blank">setDownloadDelegate()</a>方法重新绑定下载委托类，再通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloaditem#deserialize11" target="_blank">deserialize()</a>将失败数据反序列化，最后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webdownloadmanager#resumedownload11" target="_blank">resumeDownload()</a>方法恢复下载任务，被恢复任务会自动开始下载。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L145-L157" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Provides an external interface for resuming downloads.</span></li><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">resume</span>()</span> {</li><li>  <span class="hljs-keyword">const</span> state = <span class="hljs-keyword">this</span>.currentTask.getState();</li><li>  <span class="hljs-keyword">if</span> (state === webview.WebDownloadState.CANCELED) {</li><li>    webview.WebDownloadManager.setDownloadDelegate(<span class="hljs-keyword">this</span>.<span class="hljs-built_in">delegate</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      webview.WebDownloadManager.resumeDownload(webview.WebDownloadItem.deserialize(<span class="hljs-keyword">this</span>.failedData));</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.error(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Execution failed, code = %{public}d, message = %{public}s'</span>,</li><li>        error.code, error.message);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L145-L157" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li></ol> </li><li>通过WebviewController提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#startdownload11" target="_blank">startDownload()</a>方法并传入获取到的视频链接来启动下载。<div class="screenLinkPre"><div _ngcontent-rgs-c106="" class="highlight-div"><div _ngcontent-rgs-c106="" class="highlight-div-header"><div _ngcontent-rgs-c106="" class="highlight-div-header-left"><div _ngcontent-rgs-c106="" class="handle-button expand-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgs-c106="" class="highlight-div-header-right"><div _ngcontent-rgs-c106="" class="handle-button ai-button"></div><div _ngcontent-rgs-c106="" class="handle-button line-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgs-c106="" class="handle-button theme-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgs-c106="" class="handle-button copy-button"><div _ngcontent-rgs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L110-L110" data-highlighted="yes"><ol class="linenums"><li>controller?<span class="hljs-selector-class">.startDownload</span>(url);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/VideoProcessBaseWeb/entry/src/main/ets/utils/WebDownloadManager.ets#L110-L110" target="_blank">WebDownloadManager.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section171239281510">总结<i class="anchor-icon anchor-icon-link" anchorid="section171239281510" tips="复制节点链接"></i></h2><p>本文提供了Web页面内视频的相关适配实践，包括解决视频全屏播放默认竖屏、获取到视频链接地址并写入到剪贴板、通过Web组件提供的相关能力下载网页视频，开发者可结合本文根据实际业务需求进行Web页面内视频的适配。</p> </div> <div class="tiledSection"><h2 id="section782117314519">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section782117314519" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/VideoProcessBaseWeb" target="_blank">基于Web组件实现视频处理功能</a></li></ul> </div> </div> <div></div></div>