<h1 _ngcontent-uko-c119="" class="doc-title ng-star-inserted" title="Web页面跨域解决方案"> Web页面跨域解决方案 </h1>

<div _ngcontent-uko-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section16635204594211">概述<i class="anchor-icon anchor-icon-link" anchorid="section16635204594211" tips="复制节点链接"></i></h2></div> <p>在Web开发领域，跨域资源共享是浏览器为保障用户信息安全而实施的一种安全策略，它限制了不同源（协议、域名、端口任意一项存在差异）的网页之间进行资源交互。对于依赖多源数据交互的Web应用而言，有效的跨域解决方案是确保业务数据正常传输与交互的关键，能够减少因跨域限制导致的功能阻塞，防止恶意网站通过脚本窃取用户数据或进行未授权操作，进而提升应用的兼容性和用户体验。</p> <p>结合实际应用，本文将分为以下几种场景介绍Web页面跨域解决方案：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-cross-domain-solutions-for-web-pages#section6164167185112">本地资源跨域</a>：当Web页面访问本地文件系统资源时，由于本地文件协议与网页协议不同而引发的跨域问题。</li><li><a href="/consumer/cn/doc/best-practices/bpta-cross-domain-solutions-for-web-pages#section1281615241211">远程请求跨域</a>：Web页面向不同域名、端口或协议的远程服务器发送请求（如API接口调用）时，因源的不同而受到的跨域限制。</li><li><a href="/consumer/cn/doc/best-practices/bpta-cross-domain-solutions-for-web-pages#section1081074115327">跨域请求的Cookie设置</a>：在跨域请求过程中，需要传递Cookie等身份凭证时，因浏览器安全策略的限制，导致Cookie无法正常携带或读取的问题。</li><li><a href="/consumer/cn/doc/best-practices/bpta-cross-domain-solutions-for-web-pages#section47286466323">自定义协议跨域</a>：应用通过自定义协议（如app://）与本地服务或其他应用进行通信时，由于协议存在差异而导致的跨域交互问题。</li></ul> <div class="tiledSection"><h2 id="section6164167185112">本地资源跨域<i class="anchor-icon anchor-icon-link" anchorid="section6164167185112" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section183452025171218" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section183452025171218" tips="复制节点链接"></i></h3></div> <p>在Web开发与调试工作中，经常会出现通过本地文件系统直接打开HTML页面，并访问同目录下的本地脚本、样式或图片等资源的情况。这时，浏览器会因为协议不同而判定为跨域，从而触发安全限制，导致资源加载失败。</p> <p>本地资源跨域具体的安全限制表现如下：</p> <ul><li>AJAX（XMLHttpRequest/Fetch）：无法向另一个本地文件发送请求，会遇到经典的CORS(跨域资源共享)错误。</li><li>访问iframe内容：如果一个file://协议页面通过&lt;iframe&gt;嵌入另一个本地文件，父页面无法使用JavaScript读取或操作iframe内部的内容。</li><li>Web Workers：可能无法从本地文件启动。</li><li>某些HTML5 API：如localStorage和sessionStorage的访问可能会受到更严格的限制，甚至在某些情况下不可用。</li><li>CSS和JavaScript模块：使用import、@import或&lt;link rel="modulepreload"&gt;引用其他本地模块文件时，可能会失败。</li></ul> <p>本节以“WebView 加载本地H5离线包（file://协议），且该离线H5发起HTTP请求”的场景举例，介绍file协议下不同源跨域问题的解决方案。</p> <div class="tiledSection"><h3 id="section1096863591211">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1096863591211" tips="复制节点链接"></i></h3></div> <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setpathallowinguniversalaccess12" target="_blank">setPathAllowingUniversalAccess()</a>设置一个路径列表。当使用file协议访问该列表中的资源时，允许进行跨域访问本地文件。此外，一旦设置了路径列表，file协议将仅限于访问列表内的资源（此时，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>的行为将会被此接口行为覆盖）。</p> <div class="tiledSection"><h3 id="section1721437191314">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1721437191314" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setpathallowinguniversalaccess12" target="_blank">setPathAllowingUniversalAccess()</a>设置的路径列表中的路径应符合以下任一路径格式：</p> <ol><li>应用文件目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.filesDir()</a>获取，其子目录示例如下：<ul><li>/data/storage/el2/base/files/example</li><li>/data/storage/el2/base/haps/entry/files/example</li></ul> </li><li>应用资源目录通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context#context" target="_blank">Context.resourceDir()</a>获取，其子目录示例如下：<ul><li>/data/storage/el1/bundle/entry/resource/resfile</li><li>/data/storage/el1/bundle/entry/resource/resfile/example</li></ul> </li></ol> <p>当路径列表中的任一路径不满足上述条件时，系统将抛出异常码401，并判定路径列表设置失败。如果路径列表设置为空，file协议的可访问范围将遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#fileaccess" target="_blank">fileAccess</a>规则。</p> <p>在当前示例中，本地H5页面存放在工程的resfile目录下，通过setPathAllowingUniversalAccess()设置resfile目录，将本地H5及其引用资源文件都放在允许跨域访问的路径列表中，解决页面发起http请求跨域问题。</p> <div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/LocalResource.ets#L34-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'resource://resfile/LocalResource/dist/index.html'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>  .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Set the list of paths that allow cross-origin access</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setPathAllowingUniversalAccess</span>([</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span> + <span class="hljs-string">'/LocalResource'</span>,</li><li>      ])</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/LocalResource.ets#L34-L44" target="_blank">LocalResource.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用setPathAllowingUniversalAccess需确保该路径可信任，并与用户文件隔离。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section1281615241211">远程请求跨域<i class="anchor-icon anchor-icon-link" anchorid="section1281615241211" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section191439211327" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section191439211327" tips="复制节点链接"></i></h3><p>在Web应用中，当前端页面向不同源的远程服务器发送请求以获取数据时，浏览器会因为同源策略而拦截响应，导致请求失败。这种场景在前后端分离架构中十分常见，例如前端应用部署在http://***a.com，而后端 API 部署在http://***b.com（域名不同），或者调用第三方服务（如http://www.***thirdparty.com）时，都会触发远程请求跨域问题。</p> </div> <div class="tiledSection"><h3 id="section314352115327">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section314352115327" tips="复制节点链接"></i></h3><p>远程请求跨域的解决方案基于浏览器的跨域资源共享（CORS）机制或间接代理方式，其核心是通过服务器配置或中间层转发来消除源的差异：</p> <ul><li>CORS（跨域资源共享）：由服务器端进行响应头配置，明确允许特定源的请求访问资源。服务器通过设置Access-Control-Allow-Origin指定允许的源，Access-Control-Allow-Methods指定允许的请求方法，Access-Control-Allow-Headers指定允许的请求头，使浏览器认可跨域请求的合法性。在ArkWeb中发起请求时，无需特殊配置，只需服务器正确设置CORS即可。</li><li>代理请求：在WebView中设置拦截器拦截Web页面发起的跨域请求，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp" target="_blank">RCP请求</a>代理请求到目标远程服务器。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp" target="_blank">RCP请求</a>与远程服务器的通信不受浏览器限制，因此可以接收到服务器的响应结果，但将结果传回WebView时仍需配置跨域响应头来解决跨域问题。<div class="fignone"><span class="figcap"><b>图1 </b>代理请求方案流程图</span><br><span><img height="500.745" originheight="1035" originwidth="1081" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163020.19569737892258716777097356079296:50001231000000:2800:B6232EE3107131A5DAF835D31F2CAE3E380CB2F1AC08C730C1609AB4063DC48D.png" title="点击放大" width="523.6875"></span></div> </li></ul> </div> <div class="tiledSection"><h3 id="section71431221143219">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section71431221143219" tips="复制节点链接"></i></h3><p>开发者进行跨域访问远程服务器时，首选方案为在远程服务器端配置跨域相关响应头，包括Access-Control-Allow-Origin、Access-Control-Allow-Methods、Access-Control-Allow-Headers等关键字段；其次，可根据实际需求在WebView中通过代理请求并修改响应头，以保障请求顺利完成。两种方案任选其一即可。</p> </div> <p><strong>方案一 服务器端CORS设置</strong></p> <p>将Access-Control-Allow-Origin、Access-Control-Allow-Methods、Access-Control-Allow-Headers等配置根据自身开发的实际情况设置在响应头上。需要注意的是，修改跨域头Access-Control-Allow-Origin时需要匹配具体域名，避免使用通配符“*”。</p> <div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalServer/app.js#L68-L73" data-highlighted="yes"><ol class="linenums"><li>appB.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">cors</span>({</li><li>  <span class="hljs-attr">origin</span>: <span class="hljs-string">'http://www.a.harmonyos:8080'</span>,</li><li>  <span class="hljs-attr">methods</span>: [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'POST'</span>, <span class="hljs-string">'PUT'</span>, <span class="hljs-string">'DELETE'</span>, <span class="hljs-string">'OPTIONS'</span>],</li><li>  <span class="hljs-attr">allowedHeaders</span>: [<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'Authorization'</span>],</li><li>  <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span></li><li>}));</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalServer/app.js#L68-L73" target="_blank">app.js</a></div></div></div></div> <div class="p"><strong>方案二 代理请求</strong><ol><li>在WebView中设置请求拦截器时，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onloadintercept10" target="_blank">onLoadIntercept()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oninterceptrequest9" target="_blank">onInterceptRequest()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webschemehandler#onrequeststart12" target="_blank">WebSchemeHandler.onRequestStart()</a>三种常用方法实现。下文以WebSchemeHandler.onRequestStart()方法为例，说明具体拦截逻辑的实现方式：<p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setwebschemehandler12" target="_blank">setWebSchemeHandler()</a>为当前Web组件配置拦截器，专门用于拦截HTTP协议请求。当拦截到请求后，可在WebSchemeHandler的onRequestStart()回调中编写跨域请求的具体处理逻辑；回调中需返回true，以此告知Web组件“该请求已被拦截，无需继续执行默认请求流程”。</p> <div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/RemoteRequest.ets#L47-L70" data-highlighted="yes"><ol class="linenums"><li>Web({ src: <span class="hljs-string">'http://www.a.harmonyos:8080/RemoteRequest/dist/index.html'</span>, controller: <span class="hljs-keyword">this</span>.controller })</li><li>  .onControllerAttached(() =&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Using interceptor to intercept requests</span></li><li>      <span class="hljs-keyword">this</span>.schemeHandler.onRequestStart((request: webview.WebSchemeHandlerRequest, resourceHandler: webview.WebResourceHandler) =&gt; {</li><li>        Logger.info(<span class="hljs-string">'[schemeHandler] onRequestStart'</span>);</li><li>        <span class="hljs-keyword">if</span> (request.getRequestUrl().includes(<span class="hljs-string">'www.c.harmonyos'</span>)) {</li><li>          <span class="hljs-comment">// Through proxy request server</span></li><li>          <span class="hljs-keyword">this</span>.httpProxy.<span class="hljs-keyword">get</span>(request.getRequestUrl(), resourceHandler, {</li><li>            mimeType: <span class="hljs-string">'application/json'</span>,</li><li>            requestOrigin: <span class="hljs-string">'http://www.a.harmonyos:8080'</span></li><li>          })</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        }</li><li>      })</li><li>
</li><li>      <span class="hljs-comment">// Bind an interceptor to the HTTP protocol.</span></li><li>      <span class="hljs-keyword">this</span>.controller.setWebSchemeHandler(<span class="hljs-string">'http'</span>, <span class="hljs-keyword">this</span>.schemeHandler);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      Logger.error(`ErrorCode: ${(error <span class="hljs-keyword">as</span> BusinessError).code}, Message: ${(error <span class="hljs-keyword">as</span> BusinessError).message}`);</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/RemoteRequest.ets#L47-L70" target="_blank">RemoteRequest.ets</a></div></div></div></div> </li><li><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp" target="_blank">RCP</a>请求作为跨域请求的代理请求。</p> <div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/common/HttpProxy.ets#L22-L83" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpProxy</span> {</li><li>  session?: rcp.<span class="hljs-property">Session</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">sessionConfiguration?: rcp.SessionConfiguration | <span class="hljs-literal">undefined</span></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">session</span> = rcp.<span class="hljs-title function_">createSession</span>(sessionConfiguration);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">get</span>(<span class="hljs-attr">request</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">resourceHandler</span>: webview.<span class="hljs-property">WebResourceHandler</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">HttpProxyOptions</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">session</span>?.<span class="hljs-title function_">get</span>(request).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleResponse</span>(res, resourceHandler, options)</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${error.code}</span>, Message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>, Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/common/HttpProxy.ets#L22-L83" target="_blank">HttpProxy.ets</a></div></div></div></div> </li><li>新建响应头，将跨域响应头配置到新响应头上，将新响应头和RCP请求的结果都放到拦截器的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webresourcehandler" target="_blank">resourceHandler</a>中，通知Web组件被拦截的请求已经完成。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/common/HttpProxy.ets#L35-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_ invoke__">handleResponse</span>(<span class="hljs-attr">res</span>: rcp.Response, <span class="hljs-attr">resourceHandler</span>: webview.WebResourceHandler,</li><li>  <span class="hljs-attr">options</span>: HttpProxyOptions): <span class="hljs-keyword">void</span> {</li><li>  let response = <span class="hljs-keyword">new</span> webview.<span class="hljs-title function_ invoke__">WebSchemeHandlerResponse</span>();</li><li>  response.<span class="hljs-title function_ invoke__">setStatus</span>(<span class="hljs-number">200</span>)</li><li>  response.<span class="hljs-title function_ invoke__">setStatusText</span>(<span class="hljs-string">'OK'</span>)</li><li>  response.<span class="hljs-title function_ invoke__">setMimeType</span>(options.mimeType || <span class="hljs-string">'application/json'</span>)</li><li>  response.<span class="hljs-title function_ invoke__">setEncoding</span>(<span class="hljs-string">'utf-8'</span>)</li><li>  response.<span class="hljs-title function_ invoke__">setNetErrorCode</span>(WebNetErrorList.NET_OK)</li><li>  response.<span class="hljs-title function_ invoke__">setHeaderByName</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, options.requestOrigin, <span class="hljs-literal">true</span>);</li><li>  response.<span class="hljs-title function_ invoke__">setHeaderByName</span>(<span class="hljs-string">'Access-Control-Allow-Credentials'</span>, <span class="hljs-string">'true'</span>, <span class="hljs-literal">true</span>);</li><li>  response.<span class="hljs-title function_ invoke__">setHeaderByName</span>(<span class="hljs-string">'Access-Control-Allow-Methods'</span>, <span class="hljs-string">'GET, POST, PUT, DELETE'</span>, <span class="hljs-literal">true</span>);</li><li>  response.<span class="hljs-title function_ invoke__">setHeaderByName</span>(<span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-string">'Content-Type, Authorization'</span>, <span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    resourceHandler.<span class="hljs-title function_ invoke__">didReceiveResponse</span>(response);</li><li>    resourceHandler.<span class="hljs-title function_ invoke__">didReceiveResponseBody</span>(res.body);</li><li>    resourceHandler.<span class="hljs-title function_ invoke__">didFinish</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    Logger.<span class="hljs-title function_ invoke__">error</span>(`<span class="hljs-attr">ErrorCode</span>: ${(error <span class="hljs-keyword">as</span> BusinessError).code}, Message: ${(error <span class="hljs-keyword">as</span> BusinessError).message}`);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/common/HttpProxy.ets#L35-L54" target="_blank">HttpProxy.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section1081074115327">跨域请求的Cookies设置<i class="anchor-icon anchor-icon-link" anchorid="section1081074115327" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section3810194116322" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section3810194116322" tips="复制节点链接"></i></h3></div> <p>在跨域请求中，当需要携带Cookie时，浏览器会因为安全策略默认阻止Cookie的发送或接收。例如，前端请求需要携带www.***a.com的Cookie到www.***b.com，会因跨域被拦截，导致基于Cookie的身份验证失败。在ArkTS应用中，跨域请求时Cookie的设置和传递也会受到类似的限制。</p> <div class="tiledSection"><h3 id="section168101541183213">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section168101541183213" tips="复制节点链接"></i></h3><p>跨域请求的Cookie设置需要同时满足前端请求配置与服务器响应头要求，核心是通过显式声明允许Cookie跨域传输，消除浏览器的安全限制。</p> <ul><li>前端配置：在发送跨域请求时，需设置credentials: 'include'（Fetch API）或withCredentials: true（XMLHttpRequest），告知浏览器允许携带Cookie。</li><li>WebView配置：调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager#putacceptcookieenabled" target="_blank">WebCookieManager.putAcceptCookieEnabled()</a>接口以允许携带Cookie。</li><li>服务器配置：响应头需包含Access-Control-Allow-Credentials: true，明确允许跨域请求携带Cookie；同时Access-Control-Allow-Origin不能为通配符“*”，必须指定具体的前端源（如http://www.***a.com），确保权限可控。</li><li>Cookie属性：根据业务开发需要，设置合适的允许携带的Cookie属性。</li></ul> </div> <div class="tiledSection"><h3 id="section981154118329">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section981154118329" tips="复制节点链接"></i></h3></div> <ol><li>在Web前端访问服务器时，设置withCredentials: true。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-rust" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalVue/src/components/CookiesSettingsB.vue#L53-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_ invoke__">post</span>(<span class="hljs-symbol">'http</span>:<span class="hljs-comment">//www.b.harmonyos:8080/api/getCookies', {}, {</span></li><li>  withCredentials: <span class="hljs-literal">true</span></li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalVue/src/components/CookiesSettingsB.vue#L53-L55" target="_blank">CookiesSettingsB.vue</a></div></div></div></div> </li><li>在ArkWeb中，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webcookiemanager" target="_blank">WebCookieManager</a>的相关接口，完成允许携带Cookie、获取A域名下的Cookie、将Cookie设置到B域名下的操作。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-rust" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CookiesSettings.ets#L53-L57" data-highlighted="yes"><ol class="linenums"><li>webview.WebCookieManager.<span class="hljs-title function_ invoke__">putAcceptCookieEnabled</span>(<span class="hljs-literal">true</span>);</li><li>webview.WebCookieManager.<span class="hljs-title function_ invoke__">putAcceptThirdPartyCookieEnabled</span>(<span class="hljs-literal">true</span>)</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">value</span> = webview.WebCookieManager.<span class="hljs-title function_ invoke__">fetchCookieSync</span>(<span class="hljs-symbol">'http</span>:<span class="hljs-comment">//www.a.harmonyos');</span></li><li>webview.WebCookieManager.<span class="hljs-title function_ invoke__">configCookieSync</span>(<span class="hljs-symbol">'http</span>:<span class="hljs-comment">//www.b.harmonyos',</span></li><li>  value + '; PATH=/; Max-Age=<span class="hljs-number">900000</span>; HttpOnly; SameSite=Lax');</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CookiesSettings.ets#L53-L57" target="_blank">CookiesSettings.ets</a></div></div></div></div> </li><li>服务器端在响应头中添加Access-Control-Allow-Credentials: true，将Access-Control-Allow-Origin设置为具体域名（非通配符“*”）。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalServer/app.js#L68-L73" data-highlighted="yes"><ol class="linenums"><li>appB.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">cors</span>({</li><li>  <span class="hljs-attr">origin</span>: <span class="hljs-string">'http://www.a.harmonyos:8080'</span>,</li><li>  <span class="hljs-attr">methods</span>: [<span class="hljs-string">'GET'</span>, <span class="hljs-string">'POST'</span>, <span class="hljs-string">'PUT'</span>, <span class="hljs-string">'DELETE'</span>, <span class="hljs-string">'OPTIONS'</span>],</li><li>  <span class="hljs-attr">allowedHeaders</span>: [<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'Authorization'</span>],</li><li>  <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span></li><li>}));</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/LocalServer/app.js#L68-L73" target="_blank">app.js</a></div></div></div></div> </li></ol> <div class="tiledSection"><h2 id="section47286466323">自定义协议跨域<i class="anchor-icon anchor-icon-link" anchorid="section47286466323" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section4728646123214" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section4728646123214" tips="复制节点链接"></i></h3><p>开发者为避免拦截所有请求，可让前端使用自定义协议标识需要转发的请求。本节通过拦截自定义协议（app://）来展现自定义协议跨域，主要分为两个功能点：拦截页面加载时的自定义协议请求，替换为本地资源加载；点击页面按钮后拦截其发起的自定义协议请求，调用系统弹窗进行提示。</p> </div> <div class="tiledSection"><h3 id="section1728134613326">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1728134613326" tips="复制节点链接"></i></h3><ul><li>拦截自定义协议替换为本地资源加载：通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webschemehandler" target="_blank">WebSchemeHandler</a>拦截器，在WebView加载页面资源时，对自定义协议的资源进行拦截，返回读取的本地资源。</li><li>拦截自定义协议调用系统弹窗：通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webschemehandler" target="_blank">WebSchemeHandler</a>拦截器，拦截自定义协议接口，调用系统弹窗提示“已拦截自定义协议”。</li></ul> </div> <div class="tiledSection"><h3 id="section772814467327">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section772814467327" tips="复制节点链接"></i></h3></div> <ol><li>为自定义协议app://设置拦截器。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L64-L111" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.schemeHandler.onRequestStart((request: webview.WebSchemeHandlerRequest,</li><li>  resourceHandler: webview.WebResourceHandler) =&gt; {</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>})</li><li>
</li><li><span class="hljs-comment">// Bind an interceptor to the app protocol</span></li><li><span class="hljs-keyword">this</span>.controller.setWebSchemeHandler(<span class="hljs-string">'app'</span>, <span class="hljs-keyword">this</span>.schemeHandler);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L64-L111" target="_blank">CustomProtocol.ets</a></div></div></div></div> </li><li>拦截WebView组件加载页面资源时的自定义协议资源，读取对应的本地资源文件进行替换，创建响应头，将响应头和读取的本地资源设置到拦截器的resourceHandler中。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L80-L104" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> pathArray = request.<span class="hljs-title function_">getRequestUrl</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'app://'</span>);</li><li><span class="hljs-keyword">let</span> filePath = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!.<span class="hljs-property">resourceDir</span> + <span class="hljs-string">'/CustomProtocol/dist/'</span> +</li><li>pathArray[pathArray.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>];</li><li><span class="hljs-keyword">let</span> file = fs.<span class="hljs-title function_">readTextSync</span>(filePath);</li><li>
</li><li><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebSchemeHandlerResponse</span>();</li><li>response.<span class="hljs-title function_">setNetErrorCode</span>(<span class="hljs-title class_">WebNetErrorList</span>.<span class="hljs-property">NET_OK</span>);</li><li>response.<span class="hljs-title function_">setStatus</span>(<span class="hljs-number">200</span>);</li><li>response.<span class="hljs-title function_">setStatusText</span>(<span class="hljs-string">'OK'</span>);</li><li>response.<span class="hljs-title function_">setMimeType</span>(<span class="hljs-title function_">getContentType</span>(filePath));</li><li>response.<span class="hljs-title function_">setEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>
</li><li><span class="hljs-comment">// Convert to buffer type</span></li><li><span class="hljs-keyword">let</span> buf = buffer.<span class="hljs-title function_">from</span>(file)</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">if</span> (buf.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>    resourceHandler.<span class="hljs-title function_">didFail</span>(<span class="hljs-title class_">WebNetErrorList</span>.<span class="hljs-property">ERR_FAILED</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    resourceHandler.<span class="hljs-title function_">didReceiveResponse</span>(response);</li><li>    resourceHandler.<span class="hljs-title function_">didReceiveResponseBody</span>(buf.<span class="hljs-property">buffer</span>);</li><li>    resourceHandler.<span class="hljs-title function_">didFinish</span>();</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[schemeHandler] ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L80-L104" target="_blank">CustomProtocol.ets</a></div></div></div></div> </li><li>拦截自定义协议接口，调用显示系统弹窗接口，提示自定义协议已被拦截，返回true拦截该请求。<div class="screenLinkPre"><div _ngcontent-uko-c106="" class="highlight-div"><div _ngcontent-uko-c106="" class="highlight-div-header"><div _ngcontent-uko-c106="" class="highlight-div-header-left"><div _ngcontent-uko-c106="" class="handle-button expand-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uko-c106="" class="highlight-div-header-right"><div _ngcontent-uko-c106="" class="handle-button ai-button"></div><div _ngcontent-uko-c106="" class="handle-button line-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uko-c106="" class="handle-button theme-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uko-c106="" class="handle-button copy-button"><div _ngcontent-uko-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uko-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L70-L76" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (request.getRequestUrl().includes(<span class="hljs-string">'openDialog'</span>)) {</li><li>  <span class="hljs-keyword">this</span>.promptAction.showToast({</li><li>    message: $r(<span class="hljs-string">'app.string.CustomProtocol_toast'</span>),</li><li>    duration: <span class="hljs-number">3000</span>,</li><li>  })</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/WebCrossDomain/blob/master/entry/src/main/ets/views/CustomProtocol.ets#L70-L76" target="_blank">CustomProtocol.ets</a></div></div></div></div> </li></ol> <div class="tiledSection"><h2 id="section158731658103513">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section158731658103513" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/WebCrossDomain" target="_blank">Web页面跨域解决方案</a></li></ul> </div> </div> <div></div></div>