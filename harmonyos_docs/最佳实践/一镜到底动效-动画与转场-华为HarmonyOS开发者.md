<h1 _ngcontent-wfv-c119="" class="doc-title ng-star-inserted" title="一镜到底动效"> 一镜到底动效 </h1>

<div _ngcontent-wfv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section136749454417">概述<i class="anchor-icon anchor-icon-link" anchorid="section136749454417" tips="复制节点链接"></i></h2><p>一镜到底动效是页面切换时对相同或者相似的两个元素做的一种位置、大小等属性匹配的过渡动画效果，有助于提升用户操作任务的效率，增强视觉的流畅感，同时也增强动效的品质感，是转场设计中重点推荐的技法。如下例所示，在点击图片后，该图片消失，同时在另一个位置出现新的图片，二者之间内容相同，可以对它们添加一镜到底动效。图1为不添加一镜到底动效的效果，图2为添加一镜到底动效的效果，一镜到底的效果能够让二者的出现消失产生联动，使得内容切换过程显得灵动自然而不生硬。</p> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.1.3.1.1" valign="top" width="50%"><p>不添加一镜到底动效</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.1.3.1.2" valign="top" width="50%"><p>添加一镜到底动效</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><span><img originheight="202" originwidth="238" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.95311267521790771402204784532103:50001231000000:2800:6A521A38328A263DA5CA1681A44CAE070442188B694B92CB0FF5036DEF1C99EF.gif" class="notEnlarge" width="238" height="202"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img originheight="202" originwidth="238" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.35409904178003225925884262473277:50001231000000:2800:982B5E2140D197A8D7BDE4CF68A1DF442CF1EC007458AB837AE536246FB8F5C5.gif" class="notEnlarge" width="238" height="202"></span></p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section112934675513">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section112934675513" tips="复制节点链接"></i></h2><p>一镜到底动效中整个页面会以一种平滑的方式从一个场景过渡到另一个场景。这种转场效果常用于展示不同页面之间的关联性，能够给用户带来流畅的视觉体验。</p> <p>根据场景，可以将一镜到底动效分为两类：</p> <ul><li>共享元素<p>共享元素一般是转场前后持续存在的界面元素，即上文提到的持续元素，是在转场发生后希望用户关注到的焦点元素，它增强了转场的连续感。如下图，搜索框是共享元素。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.32310725287686439792258082736722:50001231000000:2800:CB346D8CE5EDF82E591D88D5957648A966C9334E394265BC02D6FB4A1C469D6B.gif" width="348" height="720"></span></p> </li><li>共享容器<p>当一组元素在过渡时包含明确的边界，可使用容器来让转换过程有连续感。容器通过大小、高度、圆角等属性进行补间过渡转换，容器内的元素可通过淡入淡出或共享元素的手法进行过渡。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.98470583277027815735539574678641:50001231000000:2800:285911C939DE4209C9CA293A98234DFA13358F26C26C7ACDB687C0FB080E49E9.gif" width="348" height="720"></span></p> <p></p> </li></ul> <p>根据场景，可以将本文的案例分为以下两类。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.1" valign="top" width="20.25%"><p>场景分类</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.2" valign="top" width="33.51%"><p>场景案例</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.6.1.4.1.3" valign="top" width="46.239999999999995%"><p>实现方式</p> </th> </tr> </thead> <tbody><tr><td align="left" class="cellrowborder" rowspan="4" valign="top" width="20.25%"><p>共享元素转场</p> </td> <td class="cellrowborder" valign="top" width="33.51%"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#li1714143812118">图片展开：双指放大</a></p> </td> <td class="cellrowborder" valign="top" width="46.239999999999995%"><p>属性动画+节点迁移</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#li1837152813249">图片展开：查看大图</a></p> </td> <td class="cellrowborder" valign="top"><p>geometryTransition()+位移缩放</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#li3497202554819">图片移动：半模态</a></p> </td> <td class="cellrowborder" valign="top"><p>属性动画+节点迁移</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#li3497202554819">图标（搜索框、头像等）展开</a></p> </td> <td class="cellrowborder" valign="top"><p>geometryTransition()+显示动画</p> </td> </tr> <tr><td class="cellrowborder" rowspan="4" valign="top" width="20.25%"><p>共享容器转场</p> </td> <td class="cellrowborder" valign="top" width="33.51%"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section11650141951719">卡片展开</a></p> </td> <td class="cellrowborder" valign="top" width="46.239999999999995%"><p>Navigation自定义动画+位移缩放</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section11650141951719">列表展开</a></p> </td> <td class="cellrowborder" valign="top"><p>geometryTransition()+显示动画</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section268511598185">“图书”翻页展开一镜到底</a></p> </td> <td class="cellrowborder" valign="top"><p>Navigation自定义动画+旋转</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section1347263162416">视频展开</a></p> </td> <td class="cellrowborder" valign="top"><p>Navigation自定义动画+节点迁移</p> </td> </tr>  </tbody></table></div> </div> <p>一镜到底动效的实现需要转场能力和动画能力组合使用。</p> <p><span><img originheight="232" originwidth="683" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.56157846644998051497297047821499:50001231000000:2800:606EC6251244CC58FB4F85E9C6ACAA02695E0582A75882347FC445B38FD555A0.png" width="683" height="232"></span></p> <p>其中组件转场有三种方式实现，开发者可以根据需要选择合适的方式实现：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.10.1.4.1.1" valign="top" width="33.33333333333333%"><p>方式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.10.1.4.1.2" valign="top" width="33.33333333333333%"><p>特点</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.10.1.4.1.3" valign="top" width="33.33333333333333%"><p>适用场景</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section1922264051914">使用容器进行节点迁移</a></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>通过使用NodeController，将组件从一个容器迁移到另一个容器，在开始迁移时，需要根据前后两个布局的位置大小等信息对组件添加位移及缩放，确保迁移开始时组件能够对齐初始布局，避免出现视觉上的跳变现象。之后再添加动画将位移及缩放等属性复位，实现组件从初始布局到目标布局的一镜到底过渡效果。</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>适用于新建对象开销大的场景，如视频直播组件点击转为全屏等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section117061757174220">使用geometryTransition()共享元素转场</a></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>利用系统能力，转场前后两个组件调用geometryTransition()接口绑定同一id，同时将转场逻辑置于animateTo动画闭包内，这样系统侧会自动为二者添加一镜到底的过渡效果。</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>此方式适用于创建新节点开销小的场景。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p><a href="/consumer/cn/doc/best-practices/bpta-one-shot-to-the-end#section1168010819268">使用Navigation自定义动画转场</a></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>进行路由跳转，customNavContentTransition事件提供自定义转场动画的能力。</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>适用于页面切换转场，如标题页和详情页之间的转场。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1922264051914" class="firsth2">使用容器进行节点迁移<i class="anchor-icon anchor-icon-link" anchorid="section1922264051914" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer" target="_blank">NodeContainer</a>作为一个占位容器组件，主要是用于自定义节点以及自定义节点树的显示和复用。NodeController提供了一系列生命周期回调，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller#makenode" target="_blank">makeNode()</a>回调返回一个 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#framenode-1" target="_blank">FrameNode</a>节点树的根节点。将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode" target="_blank">FrameNode</a>节点树挂载到对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer" target="_blank">NodeContainer</a>下。同时提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttoappear" target="_blank">aboutToAppear()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttodisappear" target="_blank">aboutToDisappear()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller#abouttoresize" target="_blank">aboutToResize()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller#ontouchevent" target="_blank">onTouchEvent()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-nodecontroller#rebuild" target="_blank">rebuild()</a>五个回调方法用于监听对应的NodeContainer的状态。</p> <p><span><img originheight="699" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.01893997948249358330511912504765:50001231000000:2800:0D42F49FCC317730537E6DD7B70A075473A09B619C47C3F354D17F1D20EC7115.gif" width="337" height="699"></span></p> <p>举个简单的例子，例如上图，卡片状态可以分为两个形态，折叠态和展开态。开发者可以将折叠态和展开态分为两个节点NodeContainer1和NodeContainer2来控制二者之间的相互切换。NodeController触发onRemove()方法使NodeContainer1下树，调用update()方法更新卡片的展开状态，节点迁移至NodeContainer2，并触发动画。</p> <p></p> <p><span><img originheight="315" originwidth="514" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.91121701968825206762453004839024:50001231000000:2800:61173A5AEAFE94312583761952528189648E4CE6855419DCD3C4B1DAF6ED53C2.png" width="514" height="315"></span></p> </div> <div class="tiledSection"><h3 id="section117061757174220">使用geometryTransition()共享元素转场<i class="anchor-icon anchor-icon-link" anchorid="section117061757174220" tips="复制节点链接"></i></h3><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-transition-animation-geometrytransition" target="_blank">geometryTransition()</a>接口用于组件内隐式共享元素转场，在视图状态切换过程中提供丝滑的上下文继承过渡体验。</p> <p>geometryTransition()的使用方式为对需要添加一镜到底动效的两个组件使用geometryTransition()接口绑定同一id，这样在其中一个组件消失同时另一个组件创建出现的时候，系统会对二者添加一镜到底动效。</p> <p>geometryTransition()绑定两个对象的实现方式使得geometryTransition()区别于其他方法，最适合用于两个不同对象之间完成一镜到底。</p> </div> <div class="tiledSection"><h3 id="section1168010819268">使用Navigation自定义动画转场<i class="anchor-icon anchor-icon-link" anchorid="section1168010819268" tips="复制节点链接"></i></h3><p>Navigation通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation#customnavcontenttransition11" target="_blank">customNavContentTransition()</a>事件提供自定义转场动画的能力，通过如下三步可以定义一个自定义的转场动画。</p> <ol><li>构建一个自定义转场动画工具类CustomNavigationUtils，通过一个Map管理各个页面自定义动画对象CustomTransition，页面在创建的时候将自己的自定义转场动画对象注册进去，销毁的时候解注册。</li><li>实现一个转场协议对象<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation#navigationanimatedtransition11" target="_blank">NavigationAnimatedTransition</a>，其中timeout属性表示转场结束的超时时间，默认为1000ms，transition属性为自定义的转场动画方法，开发者要在这里实现自己的转场动画逻辑，系统会在转场开始时调用该方法，onTransitionEnd为转场结束时的回调。</li><li>调用customNavContentTransition()方法，返回实现的转场协议对象，如果返回undefined，则使用系统默认转场。</li></ol> </div> <div class="tiledSection"><h2 id="section93918379314">元素转场案例<i class="anchor-icon anchor-icon-link" anchorid="section93918379314" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section2046482891111" class="firsth2">图片展开一镜到底<i class="anchor-icon anchor-icon-link" anchorid="section2046482891111" tips="复制节点链接"></i></h3><ul><li id="li1714143812118">双指放大转场<p>图片使用双指放大转场显示图片详情页。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.92828438386364906905918234926788:50001231000000:2800:D00A052BFDD6CE1DD08AEAC20E83D40543915853A250263CD2B2814976B8243B.gif" width="348" height="720"></span></p> <p>通过NodeContainer组件实现跨节点迁移，通过手势捏合来控制节点的上下树，达成一镜到底动效。</p> <ol><li>小图模式和大图模式分别为两个页面，通过监听expand值来进行页面切换。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/PinchToShareImagePageOne.ets#L28-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'expand'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'goToPageTwo'</span>) <span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-title function_">goToPageTwo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {};</li><li>  param[<span class="hljs-string">'onBack'</span>] = <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">restoreNodeController</span>() };</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'PinchToShareImagePageTwo'</span>, param }, <span class="hljs-literal">false</span>);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">imageGalleryNodeController</span> = <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/PinchToShareImagePageOne.ets#L28-L43" target="_blank">PinchToShareImagePageOne.ets</a></div></div></div></div> </li><li>创建NodeContainer节点类。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/ImageGalleryNode.ets#L49-L77" data-highlighted="yes"><ol class="linenums"><li>export <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageGalleryNodeController</span> <span class="hljs-title">extends</span> <span class="hljs-title">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> rootNode: BuilderNode&lt;[Params]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> wrapBuilder: WrappedBuilder&lt;[Params]&gt; = wrapBuilder(ImageGalleryBuilder);</li><li>  <span class="hljs-keyword">private</span> isExpand: boolean = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-keyword">constructor</span>(isExpand: boolean) {</li><li>    <span class="hljs-keyword">super</span>();</li><li>    <span class="hljs-keyword">this</span>.isExpand = isExpand;</li><li>  }</li><li>
</li><li>  makeNode(uiContext: UIContext): FrameNode | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.rootNode === <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">this</span>.rootNode = new BuilderNode(uiContext);</li><li>      <span class="hljs-keyword">this</span>.rootNode.build(<span class="hljs-keyword">this</span>.wrapBuilder, { isExpand: <span class="hljs-keyword">this</span>.isExpand });</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.rootNode.getFrameNode();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">init</span>(uiContext: UIContext) {</li><li>    <span class="hljs-keyword">this</span>.rootNode = new BuilderNode(uiContext);</li><li>    <span class="hljs-keyword">this</span>.rootNode.build(<span class="hljs-keyword">this</span>.wrapBuilder, { isExpand: <span class="hljs-keyword">this</span>.isExpand });</li><li>  }</li><li>
</li><li>  update(isExpand: boolean) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.rootNode !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">this</span>.rootNode.update({ isExpand });</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/ImageGalleryNode.ets#L49-L77" target="_blank">ImageGalleryNode.ets</a></div></div></div></div> </li><li>在小图界面当对图片进行双指捏合操作时，改变isExpand值。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/ImageWithGesture.ets#L360-L377" data-highlighted="yes"><ol class="linenums"><li>PinchGesture()</li><li>  .onActionStart((event: GestureEvent) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.offsetY = getTranslateToFullScreen(<span class="hljs-keyword">this</span>.getUIContext(), <span class="hljs-string">'swiper'</span>)?.offsetY || <span class="hljs-number">0</span></li><li>    <span class="hljs-keyword">this</span>.imageHeight = <span class="hljs-keyword">this</span>.getUIContext().vp2px(Number(event.target.area.height))</li><li>    <span class="hljs-keyword">this</span>.imageWidth = <span class="hljs-keyword">this</span>.getUIContext().vp2px(Number(event.target.area.width))</li><li>    <span class="hljs-keyword">this</span>.status = Status.PINCHING;</li><li>    <span class="hljs-keyword">this</span>.updateCenter([<span class="hljs-keyword">this</span>.getUIContext().vp2px(event.pinchCenterX), <span class="hljs-keyword">this</span>.getUIContext().vp2px(event.pinchCenterY)])</li><li>    <span class="hljs-keyword">this</span>.updateTranslateAccordingToCenter();</li><li>    <span class="hljs-keyword">this</span>.startGestureScale = <span class="hljs-keyword">this</span>.imageScale;</li><li>    <span class="hljs-keyword">this</span>.gestureCount++;</li><li>  })</li><li>  .onActionUpdate((event: GestureEvent) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.imageScale = <span class="hljs-keyword">this</span>.startGestureScale * event.scale;</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isExpand &amp;&amp; <span class="hljs-keyword">this</span>.imageScale &gt;= <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">this</span>.onExpand();</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.updateExtremeOffset();</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/ImageWithGesture.ets#L360-L377" target="_blank">ImageWithGesture.ets</a></div></div></div></div> </li><li>当expand值更改时，页面进行切换到大图页面，完成一镜到底页面切换。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/PinchToShareImagePageTwo.ets#L46-L64" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">NavDestination</span>() {</li><li>  <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imageGalleryNodeController</span>)</li><li>}</li><li>.<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavDestinationMode</span>.<span class="hljs-property">DIALOG</span>)</li><li>.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>.<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span> = context.<span class="hljs-property">pathStack</span>;</li><li>  <span class="hljs-keyword">const</span> param = context.<span class="hljs-property">pathInfo</span>?.<span class="hljs-property">param</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">onBack</span> = param[<span class="hljs-string">'onBack'</span>] <span class="hljs-keyword">as</span> () =&gt; <span class="hljs-built_in">void</span>;</li><li>})</li><li>.<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'reset'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseIn</span> }, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">backToPageOne</span>();</li><li>  })</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/PinchToShareImage/PinchToShareImagePageTwo.ets#L46-L64" target="_blank">PinchToShareImagePageTwo.ets</a></div></div></div></div> </li></ol> </li><li id="li1837152813249">查看大图转场<p>比如图片在九宫格中显示，点击查看大图，同时还支持手势下拉返回到九宫格。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162949.80994607403446161206758504997714:50001231000000:2800:7118DB9A28583E2BF1D1E5C7A16DCE68346BCF1B04B200FE17D41EC97D15BDA8.gif" width="348" height="720"></span></p> <p>设置geometryTransition属性将图片首页和大图页面的图片绑定同一id值，结合属性动画效果实现一镜到底效果。核心代码如下：</p> <ol><li>首页通过网格布局实现三行三列图片布局，并给每个图片设置geometryTransition属性，绑定唯一id值，绑定共享的两个图片组件。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/ShowLargeImageWithGesture/ShowLargeImageWithGesturePageOne.ets#L72-L110" data-highlighted="yes"><ol class="linenums"><li>NavDestination() {</li><li>  Column() {</li><li>    Grid(<span class="hljs-keyword">this</span>.scroller) {</li><li>      ForEach(<span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>, (item: number) =&gt; {</li><li>        GridItem() {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.clickedIndex !== item || (<span class="hljs-keyword">this</span>.isFirstPageShow)) {</li><li>            Image($r(`app.media.img_${item % <span class="hljs-number">9</span>}`))</li><li>              .width(<span class="hljs-string">'100%'</span>)</li><li>              .height(<span class="hljs-string">'100%'</span>)</li><li>              .objectFit(ImageFit.Cover)</li><li>              .id(<span class="hljs-string">'item2_'</span> + item)</li><li>              .onClick(() =&gt; {</li><li>                <span class="hljs-keyword">this</span>.onItemClick(item);</li><li>              })</li><li>              .geometryTransition(<span class="hljs-keyword">this</span>.clickedIndex === item ? <span class="hljs-string">'app.media.img_'</span> + item.toString() : <span class="hljs-string">''</span>)</li><li>              .transition(TransitionEffect.opacity(<span class="hljs-number">0.99</span>))</li><li>          }</li><li>        }</li><li>        .width(<span class="hljs-keyword">this</span>.getUIContext().px2vp(<span class="hljs-number">381</span>))</li><li>        .height(<span class="hljs-keyword">this</span>.getUIContext().px2vp(<span class="hljs-number">381</span>))</li><li>      }, (item: number) =&gt; item + <span class="hljs-string">''</span>)</li><li>    }</li><li>    .rowsTemplate(<span class="hljs-string">'1fr 1fr 1fr'</span>)</li><li>    .columnsTemplate(<span class="hljs-string">'1fr 1fr 1fr'</span>)</li><li>    .columnsGap(<span class="hljs-number">2</span>)</li><li>    .rowsGap(<span class="hljs-number">2</span>)</li><li>    .size({</li><li>      width: <span class="hljs-keyword">this</span>.getUIContext().px2vp(<span class="hljs-number">1169</span>),</li><li>      height: <span class="hljs-keyword">this</span>.getUIContext().px2vp(<span class="hljs-number">1169</span>)</li><li>    })</li><li>    .margin({ top: <span class="hljs-number">16</span> })</li><li>  }</li><li>}</li><li>.title(<span class="hljs-string">'View larger picture'</span>)</li><li>.height(<span class="hljs-string">'100%'</span>)</li><li>.width(<span class="hljs-string">'100%'</span>)</li><li>.onReady((context: NavDestinationContext) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.pageInfo = context.pathStack;</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/ShowLargeImageWithGesture/ShowLargeImageWithGesturePageOne.ets#L72-L110" target="_blank">ShowLargeImageWithGesturePageOne.ets</a></div></div></div></div> </li><li>通过属性动画来进行小图和大图页面的切换，同时为了避免触发Navigation的转场动画，在pushPath()的时候把动画选项设置成了false。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/ShowLargeImageWithGesture/ShowLargeImageWithGesturePageOne.ets#L39-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onItemClick</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {};</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">needFollow</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">clickedIndex</span> = index;</li><li>  param[<span class="hljs-string">'selectedIndex'</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">clickedIndex</span>;</li><li>  param[<span class="hljs-string">'onIndexChange'</span>] = <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onIndexChange</span>(index);</li><li>  };</li><li>  param[<span class="hljs-string">'onBackToFirstPage'</span>] = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onBack</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>    <span class="hljs-attr">duration</span>: <span class="hljs-number">250</span>,</li><li>    <span class="hljs-attr">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-property">EaseIn</span>,</li><li>  }, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'ShowLargeImageWithGesturePageTwo'</span>, <span class="hljs-attr">param</span>: param }, <span class="hljs-literal">false</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isFirstPageShow</span> = <span class="hljs-literal">false</span>;</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/ShowLargeImageWithGesture/ShowLargeImageWithGesturePageOne.ets#L39-L58" target="_blank">ShowLargeImageWithGesturePageOne.ets</a></div></div></div></div> </li></ol> </li><li id="li3497202554819">半模态转场<p>图片从页面向半模态弹窗中转场显示。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.01287925694217266328761292770040:50001231000000:2800:ABD49E6916377AC98D1E30358F314A8033834DB9332AABCAF962AD887175EBF0.gif" width="348" height="720"></span></p> <p>利用NodeContainer组件实现跨节点迁移，将半模态SheetOptions()中的mode设置为SheetMode.EMBEDDED，该模式下新起的页面可以覆盖在半模态弹窗上，页面返回后该半模态依旧存在，半模态面板内容不丢失。通过属性动画，展示组件从初始界面至半模态页面的一镜到底动效，并在动画结束时关闭页面，并将该组件迁移至半模态页面。</p> <ol><li>创建NodeContainer节点类。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/CustomComponent.ets#L27-L73" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> extends NodeController {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/CustomComponent.ets#L27-L73" target="_blank">CustomComponent.ets</a></div></div></div></div> </li><li>首页图片绑定半模态弹窗，并通过bindContentCover设置模态转场动画。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/Index.ets#L145-L191" data-highlighted="yes"><ol class="linenums"><li>NavDestination() {</li><li>  Column() {</li><li>    Image($r(<span class="hljs-string">'app.media.flower'</span>))</li><li>      .opacity(<span class="hljs-keyword">this</span>.opacityDegree)</li><li>      .width(<span class="hljs-string">'90%'</span>)</li><li>      .id(<span class="hljs-string">'origin'</span>)</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled)</li><li>      .onClick(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.originInfo = <span class="hljs-keyword">this</span>.calculateData(<span class="hljs-string">'origin'</span>);</li><li>        <span class="hljs-keyword">this</span>.scaleValue = <span class="hljs-keyword">this</span>.originInfo.scale;</li><li>        <span class="hljs-keyword">this</span>.translateX = <span class="hljs-keyword">this</span>.originInfo.translateX;</li><li>        <span class="hljs-keyword">this</span>.translateY = <span class="hljs-keyword">this</span>.originInfo.translateY;</li><li>        <span class="hljs-keyword">this</span>.clipWidth = <span class="hljs-keyword">this</span>.originInfo.clipWidth;</li><li>        <span class="hljs-keyword">this</span>.clipHeight = <span class="hljs-keyword">this</span>.originInfo.clipHeight;</li><li>        <span class="hljs-keyword">this</span>.radius = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-keyword">this</span>.opacityDegree = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-keyword">this</span>.isShowSheet = <span class="hljs-literal">true</span>;</li><li>        <span class="hljs-keyword">this</span>.isShowOverlay = <span class="hljs-literal">true</span>;</li><li>        <span class="hljs-comment">// Set the artwork to non-interactive interrupt resistant.</span></li><li>        <span class="hljs-keyword">this</span>.isEnabled = <span class="hljs-literal">false</span>;</li><li>      })</li><li>  }</li><li>  .width(<span class="hljs-string">'100%'</span>)</li><li>  .height(<span class="hljs-string">'100%'</span>)</li><li>  .padding({ top: <span class="hljs-number">16</span> })</li><li>  .alignItems(HorizontalAlign.Center)</li><li>  .bindSheet(<span class="hljs-keyword">this</span>.isShowSheet, <span class="hljs-keyword">this</span>.mySheet(), {</li><li>    mode: SheetMode.EMBEDDED,</li><li>    height: <span class="hljs-keyword">this</span>.bindSheetHeight,</li><li>    onDisappear: () =&gt; {</li><li>      <span class="hljs-comment">// Ensure that the state is correct when the half-mode disappears.</span></li><li>      <span class="hljs-keyword">this</span>.isShowImage = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-keyword">this</span>.isShowSheet = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-comment">// Set a mirror at the end of the animation to enter the trigger state.</span></li><li>      <span class="hljs-keyword">this</span>.isAnimating = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-comment">// The artwork becomes interoperable again.</span></li><li>      <span class="hljs-keyword">this</span>.isEnabled = <span class="hljs-literal">true</span>;</li><li>    }</li><li>  })</li><li>  .bindContentCover(<span class="hljs-keyword">this</span>.isShowOverlay, <span class="hljs-keyword">this</span>.overlayNode(), {</li><li>    <span class="hljs-comment">// The modal page is set to no transition</span></li><li>    transition: TransitionEffect.IDENTITY</li><li>  })</li><li>}</li><li>.backgroundColor(<span class="hljs-string">'#F1F3F5'</span>)</li><li>.expandSafeArea([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])</li><li>.title(<span class="hljs-string">'half mode'</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/Index.ets#L145-L191" target="_blank">Index.ets</a></div></div></div></div> </li><li>点击首页图片后将图片节点迁移至半模态，当半模态完成布局之后，触发onLayoutComplete()函数，获取到图片初始位置和半模态位置，通过自定义显示动画完成一镜到底的效果。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/Index.ets#L62-L104" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-comment">// Set the layout of the image on the half mode to complete the callback.</span></li><li>  let onLayoutComplete: () =&gt; void = (): void =&gt; {</li><li>    <span class="hljs-comment">// Grab the layout information when the target image layout is complete.</span></li><li>    <span class="hljs-keyword">this</span>.targetInfo = <span class="hljs-keyword">this</span>.calculateData(<span class="hljs-string">'target'</span>);</li><li>    <span class="hljs-comment">// Only half modes are correctly laid out and a mirror is triggered when there is no animation at this time.</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.targetInfo.scale !== <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.targetInfo.clipWidth !== <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.targetInfo.clipHeight !== <span class="hljs-number">0</span> &amp;&amp;</li><li>      !<span class="hljs-keyword">this</span>.isAnimating) {</li><li>      <span class="hljs-keyword">this</span>.isAnimating = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-comment">// Property animation for a mirror to the bottom of a modal page.</span></li><li>      <span class="hljs-keyword">this</span>.getUIContext().animateTo({</li><li>        duration: <span class="hljs-number">1000</span>,</li><li>        curve: Curve.Friction,</li><li>        onFinish: () =&gt; {</li><li>          <span class="hljs-comment">// Custom node subtree on overlay page.</span></li><li>          <span class="hljs-keyword">this</span>.isShowOverlay = <span class="hljs-literal">false</span>;</li><li>          <span class="hljs-comment">// Custom nodes on the semi-modal tree, thus completing node migration.</span></li><li>          <span class="hljs-keyword">this</span>.isShowImage = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.scaleValue = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-number">0.382</span> : <span class="hljs-keyword">this</span>.targetInfo.scale;</li><li>        <span class="hljs-keyword">this</span>.translateX = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-number">93.5</span> : <span class="hljs-keyword">this</span>.targetInfo.translateX;</li><li>        <span class="hljs-keyword">this</span>.clipWidth = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-number">525</span> : <span class="hljs-keyword">this</span>.targetInfo.clipWidth;</li><li>        <span class="hljs-keyword">this</span>.clipHeight = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-number">785</span> : <span class="hljs-keyword">this</span>.targetInfo.clipHeight;</li><li>        <span class="hljs-comment">// Fixed height differences due to half-mode height and scaling.</span></li><li>        <span class="hljs-keyword">this</span>.translateY = <span class="hljs-keyword">this</span>.targetInfo.translateY + (<span class="hljs-keyword">this</span>.getUIContext().px2vp(WindowUtils.windowHeight_px) - <span class="hljs-keyword">this</span>.bindSheetHeight -</li><li>        <span class="hljs-keyword">this</span>.getUIContext().px2vp(WindowUtils.navigationIndicatorHeight_px) - <span class="hljs-keyword">this</span>.getUIContext().px2vp(WindowUtils.topAvoidAreaHeight_px)) -</li><li>          (AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-number">134.3</span> : <span class="hljs-number">0</span>);</li><li>        <span class="hljs-comment">// Fixed differences in rounded corners due to scaling.</span></li><li>        <span class="hljs-keyword">this</span>.radius = <span class="hljs-keyword">this</span>.sheetRadius / <span class="hljs-keyword">this</span>.scaleValue;</li><li>      })</li><li>      <span class="hljs-comment">// The artwork goes from transparent to animated.</span></li><li>      <span class="hljs-keyword">this</span>.getUIContext().animateTo({</li><li>        duration: <span class="hljs-number">2000</span>,</li><li>        curve: Curve.Friction,</li><li>      }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.opacityDegree = <span class="hljs-number">1</span>;</li><li>      })</li><li>    }</li><li>  };</li><li>  <span class="hljs-comment">// Open layout listening.</span></li><li>  <span class="hljs-keyword">this</span>.listener.on(<span class="hljs-string">'layout'</span>, onLayoutComplete);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ImageLongTakeTransition/SemiModalImage/Index.ets#L62-L104" target="_blank">Index.ets</a></div></div></div></div> </li></ol> </li></ul> </div> <div class="tiledSection"><h3 id="section1112514503114">图标（搜索框、头像等）展开一镜到底<i class="anchor-icon anchor-icon-link" anchorid="section1112514503114" tips="复制节点链接"></i></h3><p>搜索框点击后，转场到搜索结果页面。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.48995875619594439539442393390381:50001231000000:2800:A9EB364FB30FEA5A61584F9207DE8A08EECD1D9368B41E443BED1D1EC3C16A29.gif" width="348" height="720"></span></p> <p>将搜索框首页与搜索框页面的Search组件同时设置geometryTransition属性，并绑定同一id值。设置显式动画和transition属性的转场效果，实现搜索框的一镜到底效果。</p> <ol><li>搜索框首页在Search组件添加geometryTransition属性，并绑定id值，禁用掉Navigation本身转场的动画。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/SearchLongTakeTransition/SearchLongTakeTransitionPageOne.ets#L33-L78" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> showSearchPage(): void {</li><li>  <span class="hljs-keyword">this</span>.transitionEffect = TransitionEffect.OPACITY;</li><li>  <span class="hljs-keyword">this</span>.getUIContext().animateTo({</li><li>    curve: curves.interpolatingSpring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">342</span>, <span class="hljs-number">38</span>)</li><li>  }, () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.pageInfos.pushPath({ name: <span class="hljs-string">'SearchLongTakeTransitionPageTwo'</span> }, <span class="hljs-literal">false</span>);</li><li>  })</li><li>}</li><li>
</li><li>build() {</li><li>  NavDestination() {</li><li>    Column({ space: <span class="hljs-number">20</span> }) {</li><li>      Search({ placeholder: <span class="hljs-string">'Search'</span> })</li><li>        .height(<span class="hljs-number">40</span>)</li><li>        .placeholderColor($r(<span class="hljs-string">'sys.color.mask_secondary'</span>))</li><li>        .width(<span class="hljs-string">'100%'</span>)</li><li>        .geometryTransition(<span class="hljs-string">'SEARCH_ONE_SHOT_DEMO_TRANSITION_ID'</span>, { follow: <span class="hljs-literal">true</span> })</li><li>        .backgroundColor(<span class="hljs-string">'#0D000000'</span>)</li><li>        .defaultFocus(<span class="hljs-literal">false</span>)</li><li>        .focusOnTouch(<span class="hljs-literal">false</span>)</li><li>        .focusable(<span class="hljs-literal">false</span>)</li><li>        .onTouch((event: TouchEvent) =&gt; {</li><li>          <span class="hljs-keyword">if</span> (event.type === TouchType.Up) {</li><li>            <span class="hljs-keyword">this</span>.showSearchPage();</li><li>          }</li><li>        })</li><li>    }</li><li>    .size({</li><li>      width: <span class="hljs-string">'90%'</span>,</li><li>      height: <span class="hljs-string">'100%'</span></li><li>    })</li><li>  }</li><li>  .transition(TransitionEffect.OPACITY)</li><li>  .backgroundColor(<span class="hljs-string">'#F1F3F5'</span>)</li><li>  .title(getResourceString(<span class="hljs-keyword">this</span>.getUIContext(), $r(<span class="hljs-string">'app.string.search_title'</span>), <span class="hljs-keyword">this</span>))</li><li>  .onReady((context: NavDestinationContext) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.pageInfos = context.pathStack;</li><li>  })</li><li>  .onBackPressed(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.transitionEffect = TransitionEffect.IDENTITY;</li><li>    <span class="hljs-keyword">this</span>.pageInfos.pop(<span class="hljs-literal">true</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/SearchLongTakeTransition/SearchLongTakeTransitionPageOne.ets#L33-L78" target="_blank">SearchLongTakeTransitionPageOne.ets</a></div></div></div></div> </li><li>搜索页面中的Search组件添加geometryTransition()，并添加与搜索框首页中的同一id值。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/SearchLongTakeTransition/SearchLongTakeTransitionPageOne.ets#L46-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_ invoke__">Search</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Search'</span> })</li><li>  .<span class="hljs-title function_ invoke__">height</span>(<span class="hljs-number">40</span>)</li><li>  .<span class="hljs-title function_ invoke__">placeholderColor</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'sys.color.mask_secondary'</span>))</li><li>  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_ invoke__">geometryTransition</span>(<span class="hljs-string">'SEARCH_ONE_SHOT_DEMO_TRANSITION_ID'</span>, { <span class="hljs-attr">follow</span>: <span class="hljs-literal">true</span> })</li><li>  .<span class="hljs-title function_ invoke__">backgroundColor</span>(<span class="hljs-string">'#0D000000'</span>)</li><li>  .<span class="hljs-title function_ invoke__">defaultFocus</span>(<span class="hljs-literal">false</span>)</li><li>  .<span class="hljs-title function_ invoke__">focusOnTouch</span>(<span class="hljs-literal">false</span>)</li><li>  .<span class="hljs-title function_ invoke__">focusable</span>(<span class="hljs-literal">false</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/SearchLongTakeTransition/SearchLongTakeTransitionPageOne.ets#L46-L54" target="_blank">SearchLongTakeTransitionPageOne.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section28882059195518">容器转场案例<i class="anchor-icon anchor-icon-link" anchorid="section28882059195518" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section11650141951719" class="firsth2">卡片、列表展开一镜到底<i class="anchor-icon anchor-icon-link" anchorid="section11650141951719" tips="复制节点链接"></i></h3><p>在瀑布流或列表流布局中，当用户点击其中一个卡片或列表项时，应用将执行平滑的转场动画，引导用户从概览页面切换到详情页面。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.26918598318799832770494576725052:50001231000000:2800:36507ECC951665370837E9F2456AD822078E2D827EBF3F2A03542167B3829627.gif" width="348" height="720"></span></p> <p>使用WaterFlow()和LazyForEach()实现卡片列表瀑布流。利用Navigation的自定义导航转场动画能力，通过customNavContentTransition()配置列表页与详情页的自定义导航转场动画，结合componentSnapshot()将卡片进行截图避免跳转页面白屏。</p> <ol><li>卡片列表页使用WaterFlow和LazyForEach实现页面布局。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/CardLongTakeTransition/CardLongTakeTransitionPageOne.ets#L60-L127" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onColumnClicked</span>(<span class="hljs-variable">indexValue</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt; = {};</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">clickedIndex</span> = <span class="hljs-title function_">parseInt</span>(<span class="hljs-variable">indexValue</span>);</li><li>  <span class="hljs-variable">param</span>[<span class="hljs-string">'indexValue'</span>] = <span class="hljs-variable">clickedIndex</span>;</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">clickedIndex</span> = <span class="hljs-variable">clickedIndex</span>;</li><li>  <span class="hljs-comment">// Click the card to get the corresponding screenshot and save it.</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getComponentSnapshot</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">'FlowItem_'</span> + <span class="hljs-variable">indexValue</span>, (<span class="hljs-variable">error</span>: <span class="hljs-title class_">Error</span>, <span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">error</span>) {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'CardLongTakePageOne'</span>, <span class="hljs-string">'componentSnapshot.get error, reason: '</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">error</span>));</li><li>      <span class="hljs-comment">// If the screenshot fails, go to the default left/right transition. In this case, the pop-up page will not receive clickedComponentId parameter, and the registration process will not proceed.</span></li><li>      <span class="hljs-comment">// At that time from and to the animation are undefined, will go in customNavContentTransition transitions by default.</span></li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-variable">name</span>: <span class="hljs-string">'CardLongTakeTransitionPageTwo'</span>, <span class="hljs-variable">param</span>: <span class="hljs-title class_">param</span> });</li><li>      <span class="hljs-keyword">return</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'CardLongTakePageOne'</span>, <span class="hljs-string">'componentSnapshot.get success!'</span>);</li><li>      <span class="hljs-comment">// If the screenshot is successful, then go to a custom mirror in the end transition.</span></li><li>      <span class="hljs-variable">param</span>[<span class="hljs-string">'clickedComponentId'</span>] = <span class="hljs-variable">CardUtil</span>.<span class="hljs-title function_">getFlowItemIdByIndex</span>(<span class="hljs-variable">indexValue</span>);</li><li>      <span class="hljs-variable">param</span>[<span class="hljs-string">'doDefaultTransition'</span>] = () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-title function_">doFinishTransition</span>();</li><li>      };</li><li>      <span class="hljs-variable">SnapShotImage</span>.<span class="hljs-variable">pixelMap</span> = <span class="hljs-variable">pixelMap</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-variable">name</span>: <span class="hljs-string">'CardLongTakeTransitionPageTwo'</span>, <span class="hljs-variable">param</span>: <span class="hljs-title class_">param</span> });</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">clickedIndex</span>).<span class="hljs-variable">isVisible</span> = <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Hidden</span>;</li><li>    }</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>() {</li><li>  <span class="hljs-title function_">NavDestination</span>() {</li><li>    <span class="hljs-title function_">Stack</span>() {</li><li>      <span class="hljs-title function_">WaterFlow</span>() {</li><li>        <span class="hljs-title function_">LazyForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataSource</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">CardAttr</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>          <span class="hljs-title function_">FlowItem</span>() {</li><li>            <span class="hljs-title function_">CardComponent</span>({</li><li>              <span class="hljs-variable">indexValue</span>: <span class="hljs-title class_">index</span>.<span class="hljs-title class_">toString</span>(),</li><li>              <span class="hljs-variable">cardAttr</span>: <span class="hljs-title class_">item</span>,</li><li>              <span class="hljs-variable">onColumnClicked</span>: (<span class="hljs-variable">indexValue</span>: <span class="hljs-title class_">string</span>) =&gt; {</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-title function_">onColumnClicked</span>(<span class="hljs-variable">indexValue</span>);</li><li>              }</li><li>            })</li><li>          }</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">clip</span>(<span class="hljs-keyword">true</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-variable">CardUtil</span>.<span class="hljs-title function_">getFlowItemIdByIndex</span>(<span class="hljs-variable">index</span>.<span class="hljs-title function_">toString</span>()))</li><li>        }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">columnType</span>)</li><li>      .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">size</span>({</li><li>      <span class="hljs-variable">width</span>: <span class="hljs-string">'100%'</span>,</li><li>      <span class="hljs-variable">height</span>: <span class="hljs-string">'100%'</span></li><li>    })</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">16</span></li><li>    })</li><li>  }</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>  .<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>(), $<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.card_title'</span>), <span class="hljs-keyword">this</span>))</li><li>  .<span class="hljs-title function_">onReady</span>((<span class="hljs-variable">context</span>: <span class="hljs-title class_">NavDestinationContext</span>) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">pageInfos</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">pathStack</span>;</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/CardLongTakeTransition/CardLongTakeTransitionPageOne.ets#L60-L127" target="_blank">CardLongTakeTransitionPageOne.ets</a></div></div></div></div> </li><li>卡片详情页通过Navigation自定义动画实现一镜到底。这里套了两层Stack()，因为要放截图，以及把原来的详情页内容转移过来。缩放、translate属性设置在Stack()这层上实现边界动画，透明度属性设置在截图上实现内容过渡。在onReady()里面注册自定义动画，通过id对动画属性进行初始化。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/CardLongTakeTransition/CardLongTakeTransitionPageTwo.ets#L62-L200" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Try to register a custom transition animation to restore the page properties to their normal state in case of an exception.</span></li><li>tryRegisterCustomTransition(clickedCardId: string): void {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// First initialize some transition information.</span></li><li>    <span class="hljs-keyword">this</span>.longTakeAnimationProperties.<span class="hljs-keyword">init</span>(clickedCardId, <span class="hljs-keyword">this</span>.prePageDoFinishTransition);</li><li>    CustomTransition.getInstance().registerNavParam(<span class="hljs-keyword">this</span>.pageId, <span class="hljs-number">2000</span>,</li><li>      (transitionProxy: NavigationTransitionProxy) =&gt; {</li><li>        <span class="hljs-keyword">this</span>.longTakeAnimationProperties.doAnimation(transitionProxy);</li><li>      });</li><li>    hilog.info(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'CardLongTakePageTwo'</span>, <span class="hljs-string">'register successes'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.info(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'CardLongTakePageTwo'</span>, <span class="hljs-string">'this is error '</span> + error);</li><li>    <span class="hljs-keyword">this</span>.longTakeAnimationProperties.setFinalStatus();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>build() {</li><li>  NavDestination() {</li><li>    <span class="hljs-comment">// Stack needs to set the alignContent to TopStart, otherwise the screenshot and content will be repositioned with the height as it changes.</span></li><li>    Stack({ alignContent: Alignment.TopStart }) {</li><li>      Stack({ alignContent: Alignment.TopStart }) {</li><li>        <span class="hljs-comment">// Used to display a screenshot of the card clicked on the previous page.</span></li><li>        Image(<span class="hljs-keyword">this</span>.snapShotImage)</li><li>          .size(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.snapShotSize)</li><li>          .objectFit(ImageFit.Auto)</li><li>          .opacity(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.snapShotOpacity)</li><li>          <span class="hljs-comment">// eslint-disable-next-line @performance/hp-arkui-image-async-load</span></li><li>          .syncLoad(<span class="hljs-literal">true</span>)<span class="hljs-comment">// The position here gives the distance from the screenshot position to the expanded page image position.</span></li><li>          .position({</li><li>            x: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.snapShotPositionX,</li><li>            y: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.snapShotPositionY</li><li>          })</li><li>
</li><li>        <span class="hljs-comment">// The pop-up page originally displays the content, adding transparency to control its display during animation.</span></li><li>        DetailPageContent({</li><li>          indexValue: <span class="hljs-keyword">this</span>.indexValue,</li><li>          pageInfos: <span class="hljs-keyword">this</span>.pageInfos,</li><li>          onBackPressed: () =&gt; {</li><li>            <span class="hljs-keyword">this</span>.onBackPressed()</li><li>          },</li><li>          SharedComponentId: CardUtil.getPostPageImageId(<span class="hljs-keyword">this</span>.clickedCardId)</li><li>        })</li><li>          .size({</li><li>            width: <span class="hljs-string">'100%'</span>,</li><li>            height: <span class="hljs-string">'100%'</span></li><li>          })</li><li>          .opacity(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.postPageOpacity)</li><li>      }</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>      .position({</li><li>        x: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.positionXValue,</li><li>        y: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.positionYValue</li><li>      })</li><li>    }</li><li>    .scale({</li><li>      x: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.scaleValue,</li><li>      y: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.scaleValue</li><li>    })</li><li>    .translate({</li><li>      x: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.translateX,</li><li>      y: <span class="hljs-keyword">this</span>.longTakeAnimationProperties.translateY</li><li>    })</li><li>    .width(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.clipWidth)</li><li>    .height(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.clipHeight)</li><li>    .borderRadius(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.radius)</li><li>    .expandSafeArea([SafeAreaType.SYSTEM])</li><li>    .backgroundColor($r(<span class="hljs-string">'app.color.water_flow_background_color'</span>))</li><li>    .clip(<span class="hljs-literal">true</span>)</li><li>  }</li><li>  .backgroundColor(<span class="hljs-keyword">this</span>.longTakeAnimationProperties.navDestinationBgColor)</li><li>  .GestureStyles()</li><li>  .hideTitleBar(<span class="hljs-literal">true</span>)</li><li>  .onReady((context: NavDestinationContext) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.pageInfos = context.pathStack;</li><li>    let param = context.pathInfo?.param <span class="hljs-keyword">as</span> Record&lt;string, Object&gt;;</li><li>    let clickedCardId = param[<span class="hljs-string">'clickedComponentId'</span>] <span class="hljs-keyword">as</span> string;</li><li>    <span class="hljs-keyword">this</span>.indexValue = param[<span class="hljs-string">'indexValue'</span>] <span class="hljs-keyword">as</span> number;</li><li>    <span class="hljs-keyword">this</span>.prePageDoFinishTransition = param[<span class="hljs-string">'doDefaultTransition'</span>] <span class="hljs-keyword">as</span> () =&gt; void;</li><li>    <span class="hljs-keyword">if</span> (context.navDestinationId &amp;&amp; clickedCardId) {</li><li>      <span class="hljs-keyword">this</span>.pageId = context.navDestinationId;</li><li>      <span class="hljs-keyword">this</span>.clickedCardId = clickedCardId;</li><li>      <span class="hljs-keyword">this</span>.tryRegisterCustomTransition(clickedCardId);</li><li>    }</li><li>  })</li><li>  .onBackPressed(() =&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.onBackPressed();</li><li>  })</li><li>  .onDisAppear(() =&gt; {</li><li>    CustomTransition.getInstance().unRegisterNavParam(<span class="hljs-keyword">this</span>.pageId);</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/CardLongTakeTransition/CardLongTakeTransitionPageTwo.ets#L62-L200" target="_blank">CardLongTakeTransitionPageTwo.ets</a></div></div></div></div> </li></ol> <p>列表一镜到底效果图。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.38803494694340620678763881486739:50001231000000:2800:B7F821871B7866D40422FE5C93F66513F5C694CD75AB2B9E3B2F0C3B7DE7DFCA.gif" width="348" height="720"></span></p> <p>将列表项与详情页面同时设置geometryTransition属性，并绑定同一id值。每个列表项设置显式动画和transition属性的转场效果，实现列表展开的一镜到底效果。</p> <ol><li>列表页面中每一个列表项设置geometryTransition属性，并绑定当前列表的id值。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ListLongTakeTransition/ListLongTakeTransitionPageOne.ets#L101-L171" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyButton</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">listContent</span>: <span class="hljs-title class_">ListContent</span>;</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">indexValue</span>: <span class="hljs-title class_">string</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">scaleValue</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">onButtonClicked</span>: (<span class="hljs-variable">index</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">void</span> = (<span class="hljs-variable">_index</span>: <span class="hljs-title class_">string</span>) =&gt; {</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onTouchProcess</span>(<span class="hljs-variable">event</span>?: <span class="hljs-title class_">TouchEvent</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">event</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">event</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">TouchType</span>.<span class="hljs-variable">Down</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">curve</span>: <span class="hljs-title class_">curves</span>.<span class="hljs-title class_">interpolatingSpring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">350</span>, <span class="hljs-number">35</span>) }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">scaleValue</span> = <span class="hljs-number">0.95</span>;</li><li>      })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">event</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">TouchType</span>.<span class="hljs-variable">Up</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">curve</span>: <span class="hljs-title class_">curves</span>.<span class="hljs-title class_">interpolatingSpring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">350</span>, <span class="hljs-number">35</span>) }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">scaleValue</span> = <span class="hljs-number">1</span>;</li><li>      })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">event</span>.<span class="hljs-keyword">type</span> === <span class="hljs-variable">TouchType</span>.<span class="hljs-variable">Cancel</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">curve</span>: <span class="hljs-title class_">curves</span>.<span class="hljs-title class_">interpolatingSpring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">350</span>, <span class="hljs-number">35</span>) }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">scaleValue</span> = <span class="hljs-number">1</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title function_">Row</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title function_">Line</span>()</li><li>          .<span class="hljs-title function_">startPoint</span>([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])</li><li>          .<span class="hljs-title function_">endPoint</span>([<span class="hljs-number">0</span>, <span class="hljs-number">20</span>])</li><li>          .<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">stroke</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Yellow</span>)</li><li>          .<span class="hljs-title function_">strokeLineCap</span>(<span class="hljs-variable">LineCapStyle</span>.<span class="hljs-variable">Round</span>)</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">listContent</span>.<span class="hljs-variable">title</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-variable">FontWeight</span>.<span class="hljs-variable">Medium</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>      }</li><li>
</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">listContent</span>.<span class="hljs-variable">content</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Grey</span>)</li><li>        .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-variable">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-title class_">Ellipsis</span> })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Start</span>)</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">20</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">20</span>,</li><li>      <span class="hljs-variable">top</span>: <span class="hljs-number">20</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-number">20</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'91%'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>    .<span class="hljs-title function_">clip</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>    .<span class="hljs-title function_">scale</span>({</li><li>      <span class="hljs-variable">x</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scaleValue</span>,</li><li>      <span class="hljs-variable">y</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scaleValue</span></li><li>    })</li><li>    .<span class="hljs-title function_">geometryTransition</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">indexValue</span>, { <span class="hljs-variable">follow</span>: <span class="hljs-keyword">true</span> })</li><li>    .<span class="hljs-title function_">onTouch</span>((<span class="hljs-variable">event</span>?: <span class="hljs-title class_">TouchEvent</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">onTouchProcess</span>(<span class="hljs-variable">event</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">onButtonClicked</span>?.(<span class="hljs-keyword">this</span>.<span class="hljs-variable">indexValue</span>);</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ListLongTakeTransition/ListLongTakeTransitionPageOne.ets#L101-L171" target="_blank">ListLongTakeTransitionPageOne.ets</a></div></div></div></div> </li><li>列表详情页中的容器组件Column组件设置geometryTransition属性，并绑定对应列表项的id值，完成一镜到底效果。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ListLongTakeTransition/ListLongTakeTransitionPageTwo.ets#L32-L68" data-highlighted="yes"><ol class="linenums"><li>NavDestination() {</li><li>  Column({ space: <span class="hljs-number">20</span> }) {</li><li>    Text(<span class="hljs-keyword">this</span>.param.title)</li><li>      .fontSize(<span class="hljs-number">30</span>)</li><li>      .fontWeight(FontWeight.Medium)</li><li>    Text(<span class="hljs-keyword">this</span>.param.content)</li><li>      .fontColor(<span class="hljs-string">'#E6000000'</span>)</li><li>      .lineHeight(<span class="hljs-number">28</span>)</li><li>      .fontSize(<span class="hljs-number">16</span>)</li><li>  }</li><li>  .alignItems(HorizontalAlign.Start)</li><li>  .clip(<span class="hljs-literal">true</span>)</li><li>  .size({</li><li>    width: <span class="hljs-string">'100%'</span>,</li><li>    height: <span class="hljs-string">'100%'</span></li><li>  })</li><li>  .geometryTransition(<span class="hljs-keyword">this</span>.param.geometryId)</li><li>}</li><li>.padding({</li><li>  top: <span class="hljs-number">46</span>,</li><li>  left: <span class="hljs-number">16</span>,</li><li>  right: <span class="hljs-number">16</span></li><li>})</li><li>.backgroundColor(Constants.DEFAULT_BG_COLOR)</li><li>.transition(TransitionEffect.OPACITY)</li><li>.hideTitleBar(<span class="hljs-literal">true</span>)</li><li>.backgroundColor(Color.Transparent)</li><li>.onReady((context: NavDestinationContext) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.pageInfos = context.pathStack;</li><li>  <span class="hljs-keyword">this</span>.param = (context.pathInfo.param <span class="hljs-keyword">as</span> ListDetailPageExtraInfo);</li><li>})</li><li>.onBackPressed(() =&gt; {</li><li>  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ curve: curves.interpolatingSpring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">342</span>, <span class="hljs-number">38</span>) }, () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.pageInfos.pop(<span class="hljs-literal">false</span>);</li><li>  })</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/ListLongTakeTransition/ListLongTakeTransitionPageTwo.ets#L32-L68" target="_blank">ListLongTakeTransitionPageTwo.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="section268511598185">“图书”翻页展开一镜到底<i class="anchor-icon anchor-icon-link" anchorid="section268511598185" tips="复制节点链接"></i></h3><p>阅读类应用中，点击一本“图书”的图标后，模拟图书翻页展开的效果，转场到书本内容页面，同时支持手势返回。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.45140714882934162522981696633607:50001231000000:2800:02DF1B2CA6892227EB254FD4BC4028118B7C63505D11AEC054CB6B27B3AA1A21.gif" width="348" height="720"></span></p> <p>利用Navigation的自定义导航转场动画能力，通过customNavContentTransition()配置书籍页与详情页的自定义导航转场动画实现图书翻页一镜到底效果。使用rotate属性实现书籍封页的旋转效果。</p> <ol><li>书架页面通过Grid组件实现书架第一行书籍布局，使用Swiper()组件实现书架第一行书籍布局。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/BookFlipLongTakeTransition/BookFlipLongTakeTransitionPageOne.ets#L82-L177" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onColumnClicked</span>(<span class="hljs-attr">bookId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">bookCoverUrl</span>: <span class="hljs-built_in">string</span>, toBookId?: <span class="hljs-built_in">string</span>, prePageCallback?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-title class_">CustomTransition</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">unRegisterNavParam</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageId</span>);</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">fromCardItemInfo</span>: <span class="hljs-title class_">RectInfoInPx</span> =</li><li>    <span class="hljs-title class_">ComponentAttrUtils</span>.<span class="hljs-title function_">getRectInfoById</span>(<span class="hljs-title class_">WindowUtils</span>.<span class="hljs-property">window</span>.<span class="hljs-title function_">getUIContext</span>(), bookId);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = {};</li><li>  param[<span class="hljs-string">'fromCardItemInfo'</span>] = fromCardItemInfo;</li><li>  param[<span class="hljs-string">'bookCoverUrl'</span>] = bookCoverUrl;</li><li>  <span class="hljs-keyword">if</span> (toBookId) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">toCardItemInfo</span>: <span class="hljs-title class_">RectInfoInPx</span> =</li><li>      <span class="hljs-title class_">ComponentAttrUtils</span>.<span class="hljs-title function_">getRectInfoById</span>(<span class="hljs-title class_">WindowUtils</span>.<span class="hljs-property">window</span>.<span class="hljs-title function_">getUIContext</span>(), toBookId);</li><li>    param[<span class="hljs-string">'toCardItemInfo'</span>] = toCardItemInfo;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (prePageCallback) {</li><li>    param[<span class="hljs-string">'prePageCallback'</span>] = prePageCallback;</li><li>  }</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfos</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'BookFlipLongTakeTransitionPageTwo'</span>, <span class="hljs-attr">param</span>: param });</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">NavDestination</span>() {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span> }) {</li><li>        <span class="hljs-comment">// A mirror returns to the first position.</span></li><li>        <span class="hljs-title class_">Grid</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">item: BookItem, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">GridItem</span>() {</li><li>              <span class="hljs-title class_">Image</span>($r(item.<span class="hljs-property">coverImageUrl</span>))</li><li>                .<span class="hljs-title function_">id</span>(item.<span class="hljs-property">id</span>)</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onColumnClicked</span>(item.<span class="hljs-property">id</span>, item.<span class="hljs-property">coverImageUrl</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>, <span class="hljs-function">() =&gt;</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">timestamp</span> - a.<span class="hljs-property">timestamp</span>);</li><li>                  })</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>[index].<span class="hljs-property">timestamp</span> = <span class="hljs-title class_">Number</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());</li><li>                })</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidth</span>)</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: BookItem</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item))</li><li>        }</li><li>        .<span class="hljs-title function_">padding</span>({</li><li>          <span class="hljs-attr">left</span>: <span class="hljs-number">12</span>,</li><li>          <span class="hljs-attr">right</span>: <span class="hljs-number">12</span>,</li><li>          <span class="hljs-attr">top</span>: <span class="hljs-number">12</span></li><li>        })</li><li>        .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span>)</li><li>        .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">10</span>)</li><li>
</li><li>        <span class="hljs-comment">// A mirror is returned to its original position.</span></li><li>        <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span> }) {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Recently read'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>          <span class="hljs-title class_">Swiper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">swiperController</span>) {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">recentData</span>, <span class="hljs-function">(<span class="hljs-params">item: BookItem</span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">GridItem</span>() {</li><li>                <span class="hljs-title class_">Image</span>($r(item.<span class="hljs-property">coverImageUrl</span>))</li><li>                  .<span class="hljs-title function_">id</span>(item.<span class="hljs-property">id</span>)</li><li>                  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onColumnClicked</span>(item.<span class="hljs-property">id</span>, item.<span class="hljs-property">coverImageUrl</span>);</li><li>                  })</li><li>              }</li><li>            }, <span class="hljs-function">(<span class="hljs-params">item: BookItem</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item))</li><li>          }</li><li>          .<span class="hljs-title function_">indicator</span>(<span class="hljs-literal">false</span>)</li><li>          .<span class="hljs-title function_">displayCount</span>(<span class="hljs-number">3</span>)</li><li>          .<span class="hljs-title function_">loop</span>(<span class="hljs-literal">false</span>)</li><li>          .<span class="hljs-title function_">itemSpace</span>(<span class="hljs-number">10</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">padding</span>({</li><li>          <span class="hljs-attr">left</span>: <span class="hljs-number">12</span>,</li><li>          <span class="hljs-attr">right</span>: <span class="hljs-number">12</span></li><li>        })</li><li>        .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/BookFlipLongTakeTransition/BookFlipLongTakeTransitionPageOne.ets#L82-L177" target="_blank">BookFlipLongTakeTransitionPageOne.ets</a></div></div></div></div> </li><li>书籍详情页通过Navigation自定义动画实现一镜到底。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/BookFlipLongTakeTransition/BookFlipLongTakeTransitionPageTwo.ets#L82-L160" data-highlighted="yes"><ol class="linenums"><li>NavDestination() {</li><li>  Stack() {</li><li>    Column() {</li><li>      Text($r(<span class="hljs-string">'app.string.DetailPage_text'</span>))</li><li>        .fontColor(<span class="hljs-string">'#E6000000'</span>)</li><li>        .lineHeight(<span class="hljs-number">28</span>)</li><li>        .fontSize(<span class="hljs-number">16</span>)</li><li>    }</li><li>    .width(AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'currentBreakpoint'</span>) === <span class="hljs-string">'md'</span> ? <span class="hljs-string">'75%'</span> : <span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .alignItems(HorizontalAlign.Start)</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      top: <span class="hljs-number">46</span></li><li>    })</li><li>
</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.doDefaultTransition) {</li><li>      Image($r(<span class="hljs-keyword">this</span>.bookCoverUrl))</li><li>        .objectFit(ImageFit.Cover)</li><li>        <span class="hljs-comment">// eslint-disable-next-line @performance/hp-arkui-image-async-load</span></li><li>        .syncLoad(<span class="hljs-literal">true</span>)</li><li>        .rotate({</li><li>          x: <span class="hljs-number">0</span>,</li><li>          y: <span class="hljs-number">1</span>,</li><li>          z: <span class="hljs-number">0</span>,</li><li>          angle: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.coverRotateAngle,</li><li>          centerX: <span class="hljs-number">0</span>,</li><li>          centerY: <span class="hljs-string">'50%'</span></li><li>        })</li><li>        .scale({</li><li>          x: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.coverScale,</li><li>          centerX: <span class="hljs-number">0</span>,</li><li>          centerY: <span class="hljs-string">'50%'</span></li><li>        })</li><li>    }</li><li>  }</li><li>  .scale({</li><li>    x: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.scaleValue,</li><li>    y: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.scaleValue</li><li>  })</li><li>  .translate({</li><li>    x: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.translateX,</li><li>    y: <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.translateY</li><li>  })</li><li>  .width(<span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.clipWidth)</li><li>  .height(<span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.clipHeight)</li><li>  .backgroundColor(<span class="hljs-string">'#DEDFDF'</span>)</li><li>}</li><li>.backgroundColor(<span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.navDestinationBgColor)</li><li>.GestureStyles()</li><li>.hideTitleBar(<span class="hljs-literal">true</span>)</li><li>.onReady((context: NavDestinationContext) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.pageInfos = context.pathStack;</li><li>  let param = context.pathInfo?.param <span class="hljs-keyword">as</span> Record&lt;string, Object&gt;;</li><li>  <span class="hljs-keyword">this</span>.bookCoverUrl = param[<span class="hljs-string">'bookCoverUrl'</span>] <span class="hljs-keyword">as</span> string;</li><li>  <span class="hljs-keyword">this</span>.fromCardItemInfo = param[<span class="hljs-string">'fromCardItemInfo'</span>] <span class="hljs-keyword">as</span> RectInfoInPx;</li><li>  <span class="hljs-keyword">this</span>.toCardItemInfo = (param[<span class="hljs-string">'toCardItemInfo'</span>] || param[<span class="hljs-string">'fromCardItemInfo'</span>]) <span class="hljs-keyword">as</span> RectInfoInPx;</li><li>  <span class="hljs-keyword">this</span>.prePageCallback = param[<span class="hljs-string">'prePageCallback'</span>] <span class="hljs-keyword">as</span> () =&gt; void;</li><li>  <span class="hljs-keyword">if</span> (context.navDestinationId) {</li><li>    <span class="hljs-keyword">this</span>.pageId = context.navDestinationId;</li><li>  }</li><li>  CustomTransition.getInstance()</li><li>    .registerNavParam(<span class="hljs-keyword">this</span>.pageId, <span class="hljs-number">500</span>, (transitionProxy: NavigationTransitionProxy) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.doAnimation(transitionProxy, <span class="hljs-keyword">this</span>.fromCardItemInfo,</li><li>        <span class="hljs-keyword">this</span>.toCardItemInfo);</li><li>    }, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.onInteractiveFinish();</li><li>    }, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.bookFlipLongTakeTransitionProperties.onInteractive(</li><li>        <span class="hljs-keyword">this</span>.fromCardItemInfo, <span class="hljs-keyword">this</span>.toCardItemInfo);</li><li>    });</li><li>})</li><li>.onBackPressed(() =&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.onBackPressed();</li><li>})</li><li>.onDisAppear(() =&gt; {</li><li>  CustomTransition.getInstance().unRegisterNavParam(<span class="hljs-keyword">this</span>.pageId);</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/BookFlipLongTakeTransition/BookFlipLongTakeTransitionPageTwo.ets#L82-L160" target="_blank">BookFlipLongTakeTransitionPageTwo.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="section1347263162416">视频展开一镜到底<i class="anchor-icon anchor-icon-link" anchorid="section1347263162416" tips="复制节点链接"></i></h3><p>视频组件从一个页面向目标页面的转场，在一镜到底的过程中，视频需要持续播放。</p> <p><span><img originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162950.76410628037646233845654685761009:50001231000000:2800:805A79A7EDEBE42A4E7F10D0DE9B9F6AEB7F6E212B9A783F80F5824F10516A6F.gif" width="348" height="720"></span></p> <p>使用WaterFlow()和LazyForEach()实现卡片列表瀑布流。利用NodeController实现组件的跨节点迁移，通过customNavContentTransition配置概览页与视频详情的自定义导航转场动画，给节点的迁移过程赋予一镜到底效果。</p> <ol><li>创建NodeController节点类。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/VideoLongTakeTransition/NodeController.ets#L32-L94" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> extends NodeController {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/VideoLongTakeTransition/NodeController.ets#L32-L94" target="_blank">NodeController.ets</a></div></div></div></div> </li><li>视频首页使用WaterFlow()和LazyForEach()实现页面布局，点击视频后将视频节点迁移至视频播放页面，通过Navigation自定义动画完成一镜到底的效果。<div class="screenLinkPre"><div _ngcontent-wfv-c106="" class="highlight-div"><div _ngcontent-wfv-c106="" class="highlight-div-header"><div _ngcontent-wfv-c106="" class="highlight-div-header-left"><div _ngcontent-wfv-c106="" class="handle-button expand-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wfv-c106="" class="highlight-div-header-right"><div _ngcontent-wfv-c106="" class="handle-button ai-button"></div><div _ngcontent-wfv-c106="" class="handle-button line-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wfv-c106="" class="handle-button theme-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wfv-c106="" class="handle-button copy-button"><div _ngcontent-wfv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wfv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/VideoLongTakeTransition/CustomNavigation/CustomNavigationPageOne.ets#L69-L108" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">NavDestination</span>() {</li><li>  <span class="hljs-title class_">WaterFlow</span>() {</li><li>    <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>, <span class="hljs-function">(<span class="hljs-params">_: CardAttr, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">FlowItem</span>() {</li><li>        <span class="hljs-title class_">VideoCardComponent</span>({</li><li>          <span class="hljs-attr">isPlaying</span>: <span class="hljs-literal">false</span>,</li><li>          index,</li><li>          <span class="hljs-attr">onColumnClicked</span>: <span class="hljs-function">(<span class="hljs-params">prePageCallback</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onColumnClicked</span>(<span class="hljs-string">`xComponent_<span class="hljs-subst">${index}</span>`</span>, prePageCallback)</li><li>          }</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">clip</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">'FlowItem_'</span> + index.<span class="hljs-title function_">toString</span>())</li><li>    }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>  }</li><li>  .<span class="hljs-title function_">edgeEffect</span>(<span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-property">Spring</span>)</li><li>  .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">first: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollFirstIndex</span> = first;</li><li>  })</li><li>  .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>  .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnType</span>)</li><li>  .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">12</span>)</li><li>  .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">10</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li><li>.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">DEFAULT_BG_COLOR</span>)</li><li>.<span class="hljs-title function_">title</span>(<span class="hljs-title function_">getResourceString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>(), $r(<span class="hljs-string">'app.string.vedio_title'</span>),<span class="hljs-variable language_">this</span>))</li><li>.<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfos</span> = context.<span class="hljs-property">pathStack</span>;</li><li>  <span class="hljs-keyword">if</span> (context.<span class="hljs-property">navDestinationId</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageId</span> = context.<span class="hljs-property">navDestinationId</span>;</li><li>  }</li><li>})</li><li>.<span class="hljs-title function_">onDisAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-title class_">CustomTransition</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">unRegisterNavParam</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageId</span>);</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/transitions-collection/blob/master/entry/src/main/ets/feature/VideoLongTakeTransition/CustomNavigation/CustomNavigationPageOne.ets#L69-L108" target="_blank">CustomNavigationPageOne.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section16701410145813">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section16701410145813" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/transitions-collection" target="_blank">转场动效合集</a></li></ul> </div> </div></div>