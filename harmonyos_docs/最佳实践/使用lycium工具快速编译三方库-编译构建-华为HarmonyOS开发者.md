<h1 _ngcontent-xqn-c119="" class="doc-title ng-star-inserted" title="使用lycium工具快速编译三方库"> 使用lycium工具快速编译三方库 </h1>

<div _ngcontent-xqn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section5870129176">概述<i class="anchor-icon anchor-icon-link" anchorid="section5870129176" tips="复制节点链接"></i></h2><p>随着技术的不断发展，移动应用开发需求也越来越大，在传统移动应用开发过程中，开发者需要面对较为繁琐的配置和环境搭建，这使开发成本变得更高。为解决这类问题，通过使用lycium工具，可以帮助开发者实现快速开发，简化开发流程，减少开发耗时。</p> <p>lycium是一款协助开发者通过shell语言实现C/C++三方库快速交叉编译，并在HarmonyOS上快速验证的编译框架工具。</p> <p>开发者只需要设置对应C/C++三方库的编译方式以及编译参数，通过lycium就能快速的构建出能在HarmonyOS上运行的二进制文件。</p> <p>本文将以openssl为例，介绍如何通过lycium工具快速编译三方库。</p> </div> <div class="tiledSection"><h2 id="section42371745152513">通过lycium工具快速编译三方库<i class="anchor-icon anchor-icon-link" anchorid="section42371745152513" tips="复制节点链接"></i></h2><p>本小节介绍如何在Linux环境下，使用lycium工具通过ohos sdk快速编译openssl三方库源码。</p> </div> <div class="tiledSection"><h2 id="section7846157195518">编译环境准备<i class="anchor-icon anchor-icon-link" anchorid="section7846157195518" tips="复制节点链接"></i></h2><ol><li>Linux编译环境搭建及HarmonyOS SDK下载，请参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-cmake-adapts-to-harmonyos#section197241001402">环境准备</a>。</li><li>下载完SDK后，将SDK工具链配置到环境变量中。<ol><li>lycium支持的是C/C++三方库的交叉编译，SDK工具链只涉及到native目录下的工具，故OHOS_SDK的路径需配置成native工具的父目录，Linux环境中配置SDK环境变量方法如下：<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e</span><span class="hljs-variable">$ </span>export <span class="hljs-variable constant_">OHOS_SDK</span>=<span class="hljs-regexp">/xxx/ohos</span>-sdk/linux <span class="hljs-comment"># 此处SDK的路径需要开发者配置成自己的sdk解压目录</span></li></ol></pre></div></div> </li><li>拷贝编译工具。<p>为简化开发中命令的配置，针对arm架构以及aarch64架构集成了几个编译命令，存放在lycium/Buildtools目录下。在使用lycium工具前，需要将这些编译命令拷贝到SDK对应的目录下，具体操作如下：</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master</span><span class="hljs-variable">$ </span>cd lycium/<span class="hljs-title class_">Buildtools</span> <span class="hljs-comment"># 进入到工具包目录</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/lycium/Buildtools</span><span class="hljs-variable">$ </span>sha512sum -c <span class="hljs-variable constant_">SHA512SUM</span> <span class="hljs-comment"># 可校验工具包是否正常, 若输出"toolchain.tar.gz: OK"则说明工具包正常，否则说明工具包异常，需重新下载</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/lycium/Buildtools</span><span class="hljs-variable">$ </span>tar -zxvf toolchain.tar.gz <span class="hljs-comment"># 解压拷贝编译工具</span></li><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/lycium/Buildtools</span><span class="hljs-variable">$ </span>cp toolchain/* <span class="hljs-variable">${</span><span class="hljs-variable constant_">OHOS_SDK</span>}/native/llvm/bin <span class="hljs-comment"># 将命令拷贝到工具链的native/llvm/bin目录下</span></li></ol></pre></div></div> </li><li>若SDK中cmake版本较低（cmake推荐使用3.26及以上版本），升级SDK即可。</li></ol> </li></ol> </div> <div class="tiledSection"><h2 id="section122061927165512">编译三方库<i class="anchor-icon anchor-icon-link" anchorid="section122061927165512" tips="复制节点链接"></i></h2><ol><li>修改三方库的编译方式以及编译参数。<p>lycium框架提供了HPKBUILD文件供开发者对相应的C/C++三方库的编译配置。</p> <ol><li>在thirdparty目录下新建文件夹，用于存放三方库文件和HPKBUILD文件。<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/thirdparty</span><span class="hljs-variable">$ </span>mkdir openssl</li></ol></pre></div></div> </li><li>将HPKBUILD模板文件拷贝到新建三方库目录下。<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/thirdparty</span><span class="hljs-variable">$ </span>cp /xxx/tpc_c_cplusplus-master/lycium/template/<span class="hljs-variable constant_">HPKBUILD</span> openssl</li></ol></pre></div></div> </li><li>根据三方库实际情况修改HPKBUILD文件配置项。<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-makefile" data-highlighted="yes"><ol class="linenums"><li>pkgname=NAME <span class="hljs-comment"># 库名(必填)</span></li><li>pkgver=VERSION <span class="hljs-comment"># 库版本(必填)</span></li><li>source=<span class="hljs-string">"https://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz"</span> <span class="hljs-comment"># 库源码下载链接(必填)</span></li><li>buildtools= <span class="hljs-comment"># 编译方法, 暂时支持cmake, configure, make等, 根据三方库的编译构建方式填写.(必填)</span></li><li>builddir= <span class="hljs-comment"># 源码压缩包解压后目录名(必填)</span></li><li><span class="hljs-comment"># 省略部分配置项</span></li><li><span class="hljs-comment"># 编译前准备工作，如设置环境变量，创建编译目录等</span></li><li>prepare() {</li><li>}</li><li>
</li><li><span class="hljs-comment"># 执行编译构建的命令</span></li><li>build() {</li><li>}</li><li>
</li><li><span class="hljs-comment"># 安装打包</span></li><li>package() {</li><li>}</li><li>
</li><li><span class="hljs-comment"># 测试</span></li><li>check() {</li><li>}</li><li>
</li><li><span class="hljs-comment"># 清理环境</span></li><li>cleanbuild() {</li><li>}</li></ol></pre></div></div> <p>每个编译脚本都需要按照该规则定义相应的变量以及对应的5个函数，其中变量标明必填的，需要根据库信息正确填写，否则会导致编译失败。</p> <p>填写示例参考如下：</p> <p>openssl的编译构建方式是configure编译构建，configure交叉编译是需要配置host类型，且需要配置对应的环境变量，框架中集成了环境变量设置的接口，封装在envset.sh中，因此除了基本信息外，还需要定义一个host变量以及导入envset.sh文件，基本变量配置参考如下：</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-makefile" data-highlighted="yes"><ol class="linenums"><li>pkgname=openssl <span class="hljs-comment"># 库名</span></li><li>pkgver=OpenSSL_1_1_1u <span class="hljs-comment"># 库的版本号</span></li><li>source=<span class="hljs-string">"https://github.com/openssl/$pkgname/archive/refs/tags/$pkgver.zip"</span> <span class="hljs-comment"># 库的源码包路径</span></li><li>archs=(<span class="hljs-string">"armeabi-v7a"</span> <span class="hljs-string">"arm64-v8a"</span>) <span class="hljs-comment"># 架构信息</span></li><li>buildtools=<span class="hljs-string">"configure"</span> <span class="hljs-comment"># 编译方式为configure</span></li><li>builddir=$pkgname-${pkgver} <span class="hljs-comment"># openssl 源码包解压后的文件夹名</span></li><li>packagename=$builddir.zip <span class="hljs-comment"># 包名</span></li><li>source envset.sh <span class="hljs-comment"># 导入envset.sh，envset.sh为环境设置脚本文件，通常包含构建所需的变量和函数，存放于tpc_c_cplusplus/lycium/script目录下</span></li><li>host= <span class="hljs-comment"># 定义host变量</span></li></ol></pre></div></div> <p>在prepare()函数中创建编译目录，配置对应架构的环境变量：</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-title">prepare</span></span>() {</li><li>   <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$builddir</span>/<span class="hljs-variable">$ARCH</span>-build</li><li>   <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ARCH</span> == <span class="hljs-variable">${archs[0]}</span> ] <span class="hljs-comment"># </span><strong><span class="hljs-comment">$ARCH</span></strong><span class="hljs-comment">：环境变量，表示目标架构，用于区分不同的CPU架构</span></li><li>   <span class="hljs-keyword">then</span></li><li>     setarm32ENV</li><li>     host=linux-generic32</li><li>   <span class="hljs-keyword">elif</span> [ <span class="hljs-variable">$ARCH</span> == <span class="hljs-variable">${archs[1]}</span> ]</li><li>   <span class="hljs-keyword">then</span></li><li>     setarm64ENV</li><li>     host=linux-aarch64</li><li>   <span class="hljs-keyword">else</span></li><li>     <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${ARCH}</span> not support"</span></li><li>     <span class="hljs-built_in">return</span> -1</li><li>   <span class="hljs-keyword">fi</span></li><li>}</li></ol></pre></div></div> <p>build()函数使用configure命令生成Makefile并执行make指令：</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-title">build</span></span>() {</li><li>   <span class="hljs-built_in">cd</span> <span class="hljs-variable">$builddir</span>/<span class="hljs-variable">$ARCH</span>-build</li><li>   ../Configure $* <span class="hljs-variable">$host</span> &gt; `<span class="hljs-built_in">pwd</span>`/build.log 2&gt;&amp;1</li><li>   make -j4 &gt;&gt; `<span class="hljs-built_in">pwd</span>`/build.log 2&gt;&amp;1</li><li>   ret=$?</li><li>   <span class="hljs-built_in">cd</span> <span class="hljs-variable">$OLDPWD</span></li><li>   <span class="hljs-built_in">return</span> <span class="hljs-variable">$ret</span></li><li>}</li></ol></pre></div></div> <p>openssl测试时需要单独通过编译目标depend生成测试用例，因此需要修改对应的check()函数。在check函数中执行make depend，并在执行完后清理对应的环境变量，以及在该函数后面通过注释说明该库在设备上的测试方法。</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-title">check</span></span>() {</li><li>   <span class="hljs-built_in">cd</span> <span class="hljs-variable">$builddir</span>/<span class="hljs-variable">$ARCH</span>-build</li><li>   make depend &gt;&gt; `<span class="hljs-built_in">pwd</span>`/build.log 2&gt;&amp;1</li><li>   <span class="hljs-built_in">cd</span> <span class="hljs-variable">$OLDPWD</span></li><li>   <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ARCH</span> == <span class="hljs-variable">${archs[0]}</span> ]</li><li>   <span class="hljs-keyword">then</span></li><li>     unsetarm32ENV</li><li>   <span class="hljs-keyword">fi</span></li><li>   <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$ARCH</span> == <span class="hljs-variable">${archs[1]}</span> ]</li><li>   <span class="hljs-keyword">then</span></li><li>     unsetarm64ENV</li><li>   <span class="hljs-keyword">fi</span></li><li>     <span class="hljs-built_in">unset</span> host</li><li>   <span class="hljs-built_in">echo</span> <span class="hljs-string">"Test must be on HarmonyOS device!"</span></li><li>   <span class="hljs-comment"># real test CMD</span></li><li>   <span class="hljs-comment"># 将编译目录加到 LD_LIBRARY_PATH 环境变量</span></li><li>   <span class="hljs-comment"># make test</span></li><li>}</li></ol></pre></div></div> <p>package()和cleanbuild()函数，使用模板默认的即可。</p> </li></ol> </li><li>快速编译三方库。<p>配置完三方库的编译方式参数后，在lycium目录执行./build.sh openssl（openssl即为创建的目录名称），进行自动编译三方库，并打包安装到当前目录的usr/pkgname/ARCH目录（pkgname为三方库名称，ARCH为架构名称）。</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li>owner<span class="hljs-variable">@ubuntu</span><span class="hljs-symbol">:/mnt/e/tpc_c_cplusplus-master/lycium</span><span class="hljs-variable">$ </span>./build.sh openssl <span class="hljs-comment"># 默认编译thirdparty目录下的库</span></li><li><span class="hljs-title class_">Build</span> <span class="hljs-variable constant_">OS</span> linux</li><li><span class="hljs-variable constant_">OHOS_SDK</span>=<span class="hljs-regexp">/mnt/e</span><span class="hljs-regexp">/ohos-sdk/linux</span></li><li><span class="hljs-variable constant_">CLANG_VERSION</span>=<span class="hljs-number">15.0</span>.<span class="hljs-number">4</span></li><li><span class="hljs-title class_">Build</span> openssl <span class="hljs-title class_">Open</span>SSL_1_1_1u start!</li><li>  % <span class="hljs-title class_">Total</span> % <span class="hljs-title class_">Received</span> % <span class="hljs-title class_">Xferd</span> <span class="hljs-title class_">Average</span> <span class="hljs-title class_">Speed</span>     <span class="hljs-title class_">Time</span>    <span class="hljs-title class_">Time</span>     <span class="hljs-title class_">Time</span> <span class="hljs-title class_">Current</span></li><li>                             <span class="hljs-title class_">Dload</span>  <span class="hljs-title class_">Upload</span>    <span class="hljs-title class_">Total</span>    <span class="hljs-title class_">Spent</span>     <span class="hljs-title class_">Left</span> <span class="hljs-title class_">Speed</span></li><li><span class="hljs-number">100</span>   <span class="hljs-number">222</span> <span class="hljs-number">0</span>      <span class="hljs-number">222</span> <span class="hljs-number">0</span>     <span class="hljs-number">0</span>   <span class="hljs-number">457</span>       <span class="hljs-number">0</span> --<span class="hljs-symbol">:--</span><span class="hljs-symbol">:--</span> --<span class="hljs-symbol">:--</span><span class="hljs-symbol">:--</span> --<span class="hljs-symbol">:--</span><span class="hljs-symbol">:--</span>   <span class="hljs-number">456</span></li><li><span class="hljs-number">100</span> <span class="hljs-number">11</span>.3M <span class="hljs-number">0</span>    <span class="hljs-number">11</span>.3M <span class="hljs-number">0</span>     <span class="hljs-number">0</span>  958k       <span class="hljs-number">0</span> --<span class="hljs-symbol">:--</span><span class="hljs-symbol">:--</span> <span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span>  --<span class="hljs-symbol">:--</span><span class="hljs-symbol">:--</span> 1802k</li><li><span class="hljs-title class_">Compile</span> <span class="hljs-title class_">Harmony</span>OS armeabi-v7a openssl <span class="hljs-title class_">Open</span>SSL_1_1_1u libs...</li><li><span class="hljs-comment"># 省略部分编译信息</span></li><li><span class="hljs-variable constant_">ALL</span> <span class="hljs-variable constant_">JOBS</span> <span class="hljs-variable constant_">DONE</span>!!!</li></ol></pre></div></div> <p>当未报错且日志打印ALL JOBS DONE!!!时，表示三方库编译成功。</p> </li><li>查看编译后的三方库文件。<p>编译成功后进入lycium/usr目录下，可查看编译生成的文件。</p> </li></ol> </div> <div class="tiledSection"><h2 id="section1112661015613">应用中集成使用三方库<i class="anchor-icon anchor-icon-link" anchorid="section1112661015613" tips="复制节点链接"></i></h2><ol><li>将三方库生成的二进制文件拷贝到应用工程目录。<p>为更好管理应用集成的三方库，需要在应用工程的cpp目录新建一个thirdparty目录，将生成的二进制文件以及头文件拷贝到该目录下。</p> <p>如下图所示，xxx代表三方库名称，xxx文件夹下包含了aarch64架构以及arm架构两种方式生成的二进制文件，每种架构目录下包含了该库的头文件目录include以及二进制文件目录lib。</p> <p><span><img originheight="341" originwidth="306" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163512.40792006576536885610126895911140:50001231000000:2800:996AA19FA708E12FFB3E33C3C539E725A6AE388ACE1AF77173D5C0259F26B160.png" width="306" height="341"></span></p> <p>如果三方库二进制文件为so文件，还需要将so文件拷贝到工程目录的entry/libs/${OHOS_ARCH}/目录下，如下图：</p> <p><span><img originheight="323" originwidth="328" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163512.44478609716843908368675686393961:50001231000000:2800:2D8D6335B00B0C67742D93BD28D05BDB6A75B8223D5737647ACFCBEF1D517452.png" width="328" height="323"></span></p> <p>动态库引用注意事项：</p> <ol><li>应用在引用动态库的时候是通过soname来查找的，所以开发者需要将名字为soname的库文件拷贝到entry/libs/${OHOS_ARCH}/目录下（soname查看方法：${OHOS_SDK}/native/llvm/bin/llvm-readelf -d libxxx.so）。<p><span><img height="234.41250000000002" originheight="546" originwidth="1218" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163512.55425112448816543425618653756605:50001231000000:2800:E067D610188616506EB3C3F5F3DA54997BE18FDFD1A3CE05AACBA49B974B7F4E.png" title="点击放大" width="523.6875"></span></p> </li><li>正确拷贝so文件。<p>拷贝方法：不通过压缩直接将so文件拷贝到windows，或将so文件压缩成.zip格式拷贝到windows，正确拷贝so文件后，so文件大小应该与原库实体文件大小一致。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果将so文件以tar、gz、7z、bzip2等压缩方式拷贝到windows后在解压，其文件是实体库的软连接，大小和实体库大小不一致，文件也不能正常使用。</p> </div></div></div> </li></ol> </li><li>配置对应链接。<p>配置链接只需要在cpp目录的CMakeLists.txt文件中添加对应target_link_libraries即可（动态库链接和静态库链接，只需填写一个）。</p> <ul><li>配置静态库链接。<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PRIVATE <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/thirdparty/xxx/<span class="hljs-variable">${OHOS_ARCH}</span>/lib/libxxx.a)</li></ol></pre></div></div> </li><li>配置动态库链接。<div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PRIVATE <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/thirdparty/xxx/<span class="hljs-variable">${OHOS_ARCH}</span>/lib/libxxx.so)</li></ol></pre></div></div> </li></ul> <p><span><img height="207.48000000000002" originheight="396" originwidth="999" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163512.90224737062513907232972731091703:50001231000000:2800:1F07AF227F1B2908C4CCCA7ECCD6184ABDB7FCACBA8A582B838B9455D1C940C6.png" title="点击放大" width="523.6875"></span></p> </li><li>配置头文件路径。<p>在cpp目录的CMakeLists.txt文件中添加对应target_include_directories即可：</p> <div _ngcontent-xqn-c106="" class="highlight-div"><div _ngcontent-xqn-c106="" class="highlight-div-header"><div _ngcontent-xqn-c106="" class="highlight-div-header-left"><div _ngcontent-xqn-c106="" class="handle-button expand-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqn-c106="" class="highlight-div-header-right"><div _ngcontent-xqn-c106="" class="handle-button ai-button"></div><div _ngcontent-xqn-c106="" class="handle-button line-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqn-c106="" class="handle-button theme-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqn-c106="" class="handle-button copy-button"><div _ngcontent-xqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>target_include_directories(entry PRIVATE <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/thirdparty/xxx/<span class="hljs-variable">${OHOS_ARCH}</span>/include)</li></ol></pre></div></div> <p><span><img height="217.455" originheight="404" originwidth="970" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163512.85636038613682607536917977354405:50001231000000:2800:61F3174B7D940357353CF7B17ED8493F4D3DB67C52EFF5F33BFA8F87F39D5A4F.png" title="点击放大" width="523.6875"></span></p> </li><li>配置完三方库的链接和头文件路径后，开发者即可根据自身业务逻辑，在应用中调用三方库接口，详细请参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-dynamic-link-library" target="_blank">三方动态链接库（.so）集成开发实践</a>。</li></ol> </div> </div></div>