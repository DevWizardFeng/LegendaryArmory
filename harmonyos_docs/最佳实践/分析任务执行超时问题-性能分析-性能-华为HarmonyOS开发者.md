<h1 _ngcontent-isy-c119="" class="doc-title ng-star-inserted" title="分析任务执行超时问题"> 分析任务执行超时问题 </h1>

<div _ngcontent-isy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在应用开发过程中，开发者希望某段业务逻辑能在预期时间内完成执行。如果该业务逻辑的执行时间超过了预期，即被视为任务超时。</p>    <p>任务超时检测包括主线程超时检测和任务执行超时检测，这两种检测均可通过HiCollie实现，以自定义时长对选定的业务逻辑进行主动监控。对于主线程超时，也可以选择使用默认时长进行检测。详情请参阅：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hicollie" target="_blank">HiCollie使用指导</a>。</p>    <p>任务执行超时检测的原理、日志获取方式及规格，请参阅：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines" target="_blank">任务超时检测</a>。</p>    <div class="tiledSection">     <h2 id="section109061046173719">分析思路<i class="anchor-icon anchor-icon-link" anchorid="section109061046173719" tips="复制节点链接"></i></h2>          <ol>      <li>主线程超时       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines#主线程超时检测" target="_blank">主线程超时检测</a>实际利用多次采样堆栈，并聚类的原理来提供最终堆栈。分析此类问题时，开发者只需关注与业务逻辑相关的堆栈（命中次数最高者），并进行优化即可。</p></li>      <li>任务执行超时       <p>由于任务执行超时分析方法与应用冻屏分析方法一致，可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-app-freeze-way">应用冻屏（AppFreeze）问题排查方法</a>。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1510210472414">分析步骤<i class="anchor-icon anchor-icon-link" anchorid="section1510210472414" tips="复制节点链接"></i></h2>          <ol>      <li>示例：主线程超时采样堆栈，数字表示采样命中次数       <div _ngcontent-isy-c106="" class="highlight-div"><div _ngcontent-isy-c106="" class="highlight-div-header"><div _ngcontent-isy-c106="" class="highlight-div-header-left"><div _ngcontent-isy-c106="" class="handle-button expand-button"><div _ngcontent-isy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-isy-c106="" class="highlight-div-header-right"><div _ngcontent-isy-c106="" class="handle-button ai-button"></div><div _ngcontent-isy-c106="" class="handle-button line-button"><div _ngcontent-isy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-isy-c106="" class="handle-button theme-button"><div _ngcontent-isy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-isy-c106="" class="handle-button copy-button"><div _ngcontent-isy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-isy-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>9 #00 pc 0000757c /system/bin/appspawn(55679d09bcdea35bb1e0d4e1d9a3e58f)</li><li>    9 #01 pc 000731c0 /system/lib/ld-musl-aarch64.so.1(add9e521e4eaf5cb009d4260f3b69ccd)</li><li>        9 #02 pc 000090a9 /system/bin/appspawn(main+396)(55679d09bcdea35bb1e0d4e1d9a3e58f)</li><li>            9 #03 pc 0000ab5d /system/bin/appspawn(AppSpawnRun+100)(55679d09bcdea35bb1e0d4e1d9a3e58f)</li><li>                9 #04 pc 0000e7f1 /system/lib/chipset-pub-sdk/libbegetutil.z.so(RunLoop_+200)(52ace27d827ad482439bf32cc75bb17b)</li><li>                ......</li><li>                                        9 #21 pc 00107aec /system/lib/ld-musl-aarch64.so.1(__pthread_cond_timedwait+628)(add9e521e4eaf5cb009d4260f3b69ccd)</li><li>1 #00 pc 00032e67 /system/lib/platformsdk/libmmi-util.z.so(OHOS::MMI::UDSSocket::OnReadPackets(OHOS::MMI::CircleStreamBuffer&amp;, std::__h::function&lt;void (OHOS::MMI::NetPacket&amp;)&gt;)+158)(99e56bc765f9208f7b7ba8b268886a59)</li><li>    1 #01 pc 0000312e5 /system/lib/platformsdk/libmmi-client.z.so(OHOS::MMI::ClientMsgHandler::OnMsgHandler(OHOS::MMI::UDSClient const&amp;, OHOS::MMI::NetPacket&amp;)+340)(66ac85e964777ae89f0c26c339093cd1)</li><li>        1 #02 pc 0003016b /system/lib/platformsdk/libmmi-client.z.so(OHOS::MMI::ClientMsgHandler::OnPointerEvent(OHOS::MMI::UDSClient const&amp;, OHOS::MMI::NetPacket&amp;)+1222)(66ac85e964777ae89f0c26c339093cd1)</li><li>            1 #03 pc 0003b96b /system/lib/platformsdk/libmmi-client.z.so(OHOS::MMI::InputManagerImpl::OnPointerEvent(std::__h::shared_ptr&lt;OHOS::MMI::PointerEvent&gt;)+1370)(66ac85e964777ae89f0c26c339093cd1)</li><li>                1 #04 pc 00095903 /system/lib/platformsdk/libwm.z.so(OHOS::Rosen::InputEventListener::OnInputEvent(std::__h::shared_ptr&lt;OHOS::MMI::PointerEvent&gt;) const+478)(9c40c5f416d6f830435126998fbcad42)</li><li>                ......</li><li>                                        1 #21 pc 003f5c55 /system/lib/platformsdk/libark_jsruntime.so(4e6a2651ec80a7f639233f414d6486fe)</li><li>                                            1 #22 at anonymous (/entry/build/default/cache/default/default@CompileArkTS/esmodule/debug/entry/src/main/ets/pages/Index.js:67:17)</li><li>                                                1 #23 at wait2 (/entry/build/default/cache/default/default@CompileArkTS/esmodule/debug/entry/src/main/ets/pages/Index.js:16:12)</li><li>                                                ......</li></ol></pre></div></div>       <p>如上述示例所示，通过订阅相关事件获取日志信息后，按照#xx前的数字排查，排除系统侧堆栈之后，查找与业务逻辑相关的堆栈，数字越高表示采样栈命中次数越高，需要优化的可能性越大。如上述案例所示，需要分析#22业务执行耗时逻辑是否合理。</p></li>      <li>任务执行超时分析步骤同<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-app-freeze-way#section1950514261110">应用冻屏（AppFreeze）定位步骤与思路</a>。</li>     </ol>    </div>   </div>   <div></div></div>