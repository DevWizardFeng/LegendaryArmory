<h1 _ngcontent-igi-c119="" class="doc-title ng-star-inserted" title="动画使用指导"> 动画使用指导 </h1>

<div _ngcontent-igi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section16852432183015">概述<i class="anchor-icon anchor-icon-link" anchorid="section16852432183015" tips="复制节点链接"></i></h2><p>动画是应用开发中必不可少的部分，它可以使应用程序更加生动和易于互动，一方面可以提升用户体验、增强视觉吸引力，另一方面可以引导用户操作、提高信息传达效率。应用程序中，页面层级间的转场、点击交互、手势操控都可以添加动画。合理使用动画可以通过以下两个方面考虑：</p> <ul><li>提升动画感知流畅度：使用合适的动画能力将UX设计视角转换为开发实现视角，并将设计师提供的动效转化为具体的代码实现。这样可以确保应用在实际使用中达到设计的预期效果，提升动画感知流畅度并提供良好的用户体验。</li><li>提升动画运行流畅度：优化动画资源的加载和释放，避免内存泄漏和资源浪费；合理使用动画缓存和复用，减少不必要的重复绘制，提高动画的运行效率。</li></ul> <p>在使用动画时，需要根据具体场景和用户需求进行合理的设计和运用，并且需要注意动画的性能影响，及时采取相应的优化措施。通过合理使用动画，可以提升动画的感知流畅度和运行流畅度，从而提升应用程序的用户体验和性能。</p> </div> <div class="tiledSection"><h2 id="section6998195315306">提升动画感知流畅度<i class="anchor-icon anchor-icon-link" anchorid="section6998195315306" tips="复制节点链接"></i></h2><p>HarmonyOS动效引力体系，围绕回归本源设计理念，打造了自然、流畅、品质一体的操作体验。基于视觉效果设计，可以将动效划分为特征动效、转场动效、手势动效、微动效、插画动效。在特征动效中呈现出天体运动“力”的即视感；转场动效表现出物体在运动过程中“力”的秩序感；手势动效打造出元素运动互相影响“力”的控制感；微动效和插画动效辅助HarmonyOS动效引力体系，增加用户的操作趣味性和浏览愉悦感。动效要始终围绕操作符合用户心理预期，物体运动符合真实世界，元素表现形态凸显产品的品牌与调性，从用户感知角度提升流畅度。</p> </div> <p>HarmonyOS系统为开发者提供了丰富的动画能力，在实际开发过程中，需要把上述UX设计视角转换为开发实现视角，即使用HarmonyOS系统提供的动画能力来实现UX设计的场景和动效，一般来说需要采取如下步骤完成视角转换：</p> <ol><li><span>了解系统能力：首先，开发者需要深入了解HarmonyOS系统提供的动画能力，包括动画类型和动画相关API。</span></li><li><span>分析UX设计视角：仔细分析UX设计所提供的动效，理解设计师的意图。</span></li><li><span>设计动画方案：基于分析的结果，设计出合理的动画方案。确定动画的触发时机、动画的类型和参数等。</span></li><li><span>使用动画能力：利用HarmonyOS提供的动画能力，如属性动画、路径动画等或者调用三方库，完成设计效果。</span></li><li><span>调试和优化：在实施动画的过程中，进行调试和优化。确保动画效果流畅，动效符合预期，且满足性能要求。</span></li></ol> <p>通过以上步骤，开发者可以将UX设计视角转换为开发实现视角，并将设计师提供的动效转化为具体的代码实现。这样可以确保应用在实际使用中达到设计的预期效果，提升动画感知流畅度并提供良好的用户体验。</p> <div class="fignone"><span class="figcap"><b>图1 </b>合理使用动画</span></div> <p><span><img height="475.542165" originheight="712" originwidth="1256" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162945.81996488444370566183651119836867:50001231000000:2800:C33D352310F0EDE757FCC94AEA4C80A03866A5C75E7ED30CF8C88870CE1A7DE9.png" title="点击放大" width="838.8975"></span></p> <div class="tiledSection"><h3 id="section201821311193214" class="firsth2">动效场景设计<i class="anchor-icon anchor-icon-link" anchorid="section201821311193214" tips="复制节点链接"></i></h3><p>在设计动效过程中，要清楚地理解动效在系统中承载的作用，动效能体现页面的流畅过渡、对象的明确提示、元素的层级关系、产品的品牌印象等。</p> <p><strong>特征动效</strong></p> <p>特征动效主要打造 “天体拟物感知”，提供一种天体拟物的品牌效应和宇宙空间感的交互体验，它将力赋予元素，更直观地传递出形象化、拟物化、动态化的设计理念，在不同场景上表达新颖个性的同时又凸显了独特的产品调性。它可以广泛应用于开场动画、加载动画、下载动画等场景。</p> <p>特征动效是指在用户界面中突出某个特定元素的动画效果。通过特征动效，可以吸引用户的注意力，提升用户体验。例如，在一个应用程序中，当用户点击”下载”按钮时，渐变显示出进度条并动态加载(如下图所示)。</p> <div class="fignone"><span class="figcap"><b>图2 </b>点击特征动效示意</span><br><span><img height="180.68209600000003" originheight="896" originwidth="925" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162945.10488734192519676555624850652146:50001231000000:2800:B1B54FDF8292C75EB7AD550498B353EE0DF96527AAF03D81AE1A49C51BAF053A.gif" title="点击放大" width="186.5325"></span></div> <p></p> <p><strong>转场动效</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/design-guides/transition-animation-0000001750078488" target="_blank">转场动效</a>是指在不同页面或视图之间切换时使用的动画效果。通过转场动效，可以平滑地过渡到下一个页面或视图，增加界面间的连贯性和流畅性。</p> <p>HarmonyOS系统为开发者提供了丰富的转场动效库，使开发者能够轻松实现各种转场动画效果。开发者可以根据具体需求，在应用的不同场景中应用这些转场动效，以提升用户体验和界面的吸引力。需要注意的是，为了最佳的用户体验，开发者应根据界面的功能和特点，合理选择转场动效，并遵循动效的使用准则，以确保转场动效在视觉和交互上的一致性。</p> <div class="fignone"><span class="figcap"><b>图3 </b>转场动效示意</span><br><span><img height="528.4621999999999" originheight="747" originwidth="376" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162945.30256476016276524656429177895198:50001231000000:2800:5BFF04F998F7E5AB28504DFE978944F513DE4F46F434B4CFDC969422B212E001.gif" title="点击放大" width="266"></span></div> <p></p> <p><strong>手势动效</strong></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/design-guides/gesture-animation-0000001797038213" target="_blank">手势动效</a>是指根据用户的手势操作而产生的动画效果。通过手势动效，可以增强用户与设备之间的互动体验。</p> <ul><li>点击：点击的接触过程中有一段100ms~300ms的时长是无反馈状态，为了提升感知体验，可以在按下那一刻即响应动效反馈。这一可先行的触控响应机制强化了界面元素的视觉反馈，为理解界面状态提供了更多的线索信息。</li><li>滑动：滑动手势是用户进行滑动操作时产生的相应动画效果，例如随手指移动的平滑过渡动画，增强了界面的流畅性。保证对象动效反馈的结果与手势动作的连贯性是滑动手势动效设计的关键。</li><li>翻动：翻动手势动效通常用于模拟翻书或翻页的效果，用户可以通过拖拽或抛滑手势来翻转页面或切换内容，界面元素会产生相应的翻页动画，提供更真实的交互体验。翻页分为成功与未成功，未成功会停留在当前内容上；成功则显示下一页/几页的内容。为了提示性，翻页也有过界拖拽的场景。</li><li>夹捏：捏合手势是指双/多指合拢或分开的动作，常用于缩放或旋转对象。手势过程中需要令对象跟随手势做出相应的响应趋势。</li><li>拖拽：拖拽手势是指手指按下同时进行移动的动作，动效设计了对象通过拖拽行为进行状态转换的整个过程，以确保用户操作的连贯性和流畅性。</li></ul> <div class="fignone"><span class="figcap"><b>图4 </b>手势动效示意</span><br><span><img height="277.40076" originheight="597" originwidth="592" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162945.00026677590881661071089319737542:50001231000000:2800:840B2AF91FE51309C24B4C5784CED072576985B91925AF8C18A2FBE1509BA49C.gif" title="点击放大" width="275.31"></span></div> <p></p> <p><strong>微动效</strong></p> <p>微动效是指在界面中细微的动画效果，用于增加界面的生动感和交互性。微动效可以体现在按钮的点击效果、图标的变化、文本的出现等。例如，当用户打开某个面板时，可以使用微小的缩放或颜色变化来体现（如图所示）。</p> <div class="fignone"><span class="figcap"><b>图5 </b>微动效示意</span></div> <p><span><img height="161.595" originheight="500" originwidth="500" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162945.75777655982379982482796981687657:50001231000000:2800:DC0FF42CC262A91371ED13442E51FFFC787180FA6F28B0F46A6A3AD022F7E264.gif" title="点击放大" width="161.595"></span></p> <p></p> <p><strong>插画动效</strong></p> <p>插画动效是指在界面中应用的基于插画的动画效果。通过插画动效，可以为界面增添趣味和个性化。例如，在一个游戏应用中，可以使用插画动效来展示角色的动作、表情或者场景的变化（如图所示）。</p> <p>通过动画的方式丰富视觉元素所要表达的信息，可以引导解读功能信息并串联前后画面，便于用户理解，也使画面表现更富有生命力。</p> <div class="fignone"><span class="figcap"><b>图6 </b>插画动效示意</span><br><span><img height="467.12260000000003" originheight="792" originwidth="451" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.73900786013475069016862590516566:50001231000000:2800:17BD258FFCECC1C7A7FE62D402FF6EE3414FDFE6D3B1E1B4CDC825BEE92D71B1.gif" title="点击放大" width="266"></span></div> <p></p> </div> <div class="tiledSection"><h3 id="section511214376349">动画能力选型<i class="anchor-icon anchor-icon-link" anchorid="section511214376349" tips="复制节点链接"></i></h3><p>开发人员接收到设计需求后，需要选择合适的动画能力完成该设计。HarmonyOS为开发者提供了系统能力、资源调用、三方库三种方式，在选择动画能力时，开发者需要考虑目标和需求以及效率和质量，合理选择能够满足需求的工具、追求高效率和高质量的结果导向，帮助应用实现更好的动画效果。</p> <p><strong>系统能力</strong></p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-animatorproperty" target="_blank">属性动画</a>：通过更改组件的属性值实现渐变过渡效果，例如缩放、旋转、平移等。支持的属性包括width、height、backgroundColor、opacity、scale、rotate、translate等。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-explicit-animation" target="_blank">显式动画</a>：可以通过用户的直接操作或应用程序的特定逻辑来触发，例如按钮点击时的缩放动画、列表项展开时的渐变动画等。HarmonyOS提供了全局animateTo显式动画接口来指定由于闭包代码导致状态变化的插入过渡动效。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-transition-overview" target="_blank">转场动画</a>：转场动画可以实现平滑的界面切换效果，例如页面之间的淡入淡出、滑动切换、旋转切换等，增强了界面的连贯性和吸引力。具体使用方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-page-transition">《合理使用页面间转场》</a>。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-motion-path-animation" target="_blank">路径动画</a>：指对象沿着指定路径进行移动的动画效果。通过设置路径可以实现视图沿着预定义的路径进行移动，例如曲线运动、圆周运动等，为用户呈现更加生动的交互效果。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-particle-animation" target="_blank">粒子动画</a>：通过大量小颗粒的运动来形成整体动画效果。通过对粒子在颜色、透明度、大小、速度、加速度、自旋角度等维度变化做动画，来营造一种氛围感。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-keyframeanimateto" target="_blank">关键帧动画</a>：在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext" target="_blank">UIContext</a>中提供keyframeAnimateTo接口来指定若干个关键帧状态，实现分段的动画。</li></ul> <p></p> <p><strong>资源调用</strong></p> <ul><li>GIF动画：GIF动画可以在特定位置循环播放，为应用界面增添生动的视觉效果。在开发中，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image" target="_blank">Image组件</a>来实现GIF动画的播放。通过在特定位置放置Image组件，并加载GIF格式的图像，开发者可以轻松实现动画效果。</li><li>帧动画：通过逐帧播放一系列图片来实现动画效果，在开发中可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imageanimator" target="_blank">ImageAnimator组件</a>来实现帧动画的播放。开发者可以配置需要播放的图片列表，以及每张图片的播放时长，从而实现精细的动画效果。</li></ul> <p></p> <p><strong>三方库</strong></p> <ul><li>Lottie：解析Adobe After Effects软件通过Bodymovin插件导出的json格式的动画，并在移动设备上进行本地渲染。Lottie动画可以在各种屏幕尺寸和分辨率上呈现，并且支持动画的交互性，通过添加触摸事件或其他用户交互操作，使动画更加生动和具有响应性。</li><li>SVG：通过将SVG图片解析并渲染到页面上并对SVG图片样式动态改变实现动画。OHOS-SVG不仅能够提供高质量的图形呈现，而且还能够实现图形样式的实时更新，为用户带来更加丰富的视觉体验。</li></ul> </div> <div class="tiledSection"><h3 id="section640141219361">动画实践案例<i class="anchor-icon anchor-icon-link" anchorid="section640141219361" tips="复制节点链接"></i></h3><p><strong>使用显式动画实现特征动效</strong></p> <ul><li>场景描述</li></ul> <p>在本场景中，圆形按钮上会依次出现多个水波状圆环，这些圆环从中心向外进行扩散，进而凸显功能，实现效果如图所示。</p> <div class="fignone"><span class="figcap"><b>图7 </b>使用显式动画实现水波纹动效</span><br><span><img height="550.354" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.69296248108035022251088977520109:50001231000000:2800:E890915C526E856A3721AF11487CB059477F287032E2B180ABD6CEE9A58D83B6.gif" title="点击放大" width="266"></span></div> <ul><li>实现原理</li></ul> <p>水波圆环以圆形按钮为中心，将多个圆形图层逐渐向外扩展放大，每个圆形图层的动画开始时间稍微错开，进而形成多个水波圆环依次扩散的效果。其动效实现步骤如下。</p> <ol><li><span>实现圆形图层，以圆形图层作为水波圆环的基础形状，并设置相关背景属性。</span></li><li><span>通过显示动画animateTo实现圆形图层放大的动效，并设置延迟时间。</span></li></ol> <ul><li>开发步骤</li></ul> <p>实现圆形图层，通过Stack将圆形图层与Button组件进行重叠。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageWaterRipples/view/PageWaterRipples.ets#L47-L135" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct ButtonWithWaterRipples {</li><li>  <span class="hljs-keyword">@Link</span> <span class="hljs-attribute">isListening</span>: boolean;</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">immediatelyOpacity</span>: number = <span class="hljs-number">0.5</span>;</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">immediatelyScale</span>: Scale = { x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> };</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">delayOpacity</span>: number = <span class="hljs-number">0.5</span>;</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">delayScale</span>: Scale = { x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> };</li><li>  private readonly BUTTON_SIZE: number = <span class="hljs-number">120</span>;</li><li>  private readonly BUTTON_CLICK_SCALE: number = <span class="hljs-number">0.8</span>;</li><li>  private readonly ANIMATION_DURATION: number = <span class="hljs-number">1300</span>;</li><li>
</li><li>  <span class="hljs-keyword">@Styles</span></li><li>  ripplesStyle() {</li><li>    <span class="hljs-selector-class">.width</span>(this.BUTTON_SIZE * this.BUTTON_CLICK_SCALE)</li><li>    <span class="hljs-selector-class">.height</span>(this.BUTTON_SIZE * this.BUTTON_CLICK_SCALE)</li><li>    <span class="hljs-selector-class">.borderRadius</span>(this.BUTTON_SIZE * this.BUTTON_CLICK_SCALE / <span class="hljs-number">2</span>)</li><li>    <span class="hljs-selector-class">.backgroundColor</span>(Color.Red)</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Stack</span>() {</li><li>      <span class="hljs-built_in">Stack</span>()</li><li>        <span class="hljs-selector-class">.ripplesStyle</span>()</li><li>        <span class="hljs-selector-class">.opacity</span>(this.immediatelyOpacity)</li><li>        <span class="hljs-selector-class">.scale</span>(this.immediatelyScale)</li><li>      <span class="hljs-built_in">Stack</span>()</li><li>        <span class="hljs-selector-class">.ripplesStyle</span>()</li><li>        <span class="hljs-selector-class">.opacity</span>(this.delayOpacity)</li><li>        <span class="hljs-selector-class">.scale</span>(this.delayScale)</li><li>      <span class="hljs-selector-tag">Button</span>() {</li><li>        <span class="hljs-built_in">Image</span>($r('app.media.ic_public_music_filled'))</li><li>          <span class="hljs-selector-class">.width</span>($r('app.float.water_ripples_width'))</li><li>          <span class="hljs-selector-class">.fillColor</span>(Color.White)</li><li>      }</li><li>      <span class="hljs-selector-class">.clickEffect</span>({ level: ClickEffectLevel.HEAVY, scale: this.BUTTON_CLICK_SCALE })</li><li>      <span class="hljs-selector-class">.backgroundColor</span>($r('app.color.music_icon'))</li><li>      <span class="hljs-selector-class">.type</span>(ButtonType.Circle)</li><li>      <span class="hljs-selector-class">.width</span>(this.BUTTON_SIZE)</li><li>      <span class="hljs-selector-class">.height</span>(this.BUTTON_SIZE)</li><li>      <span class="hljs-selector-class">.zIndex</span>(<span class="hljs-number">1</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageWaterRipples/view/PageWaterRipples.ets#L47-L135" target="_blank">PageWaterRipples.ets</a></div></div></div></div> <p>实现圆形图层的放大动效，并设置延迟时间。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageWaterRipples/view/PageWaterRipples.ets#L77-L131" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Button</span>() {</li><li>  <span class="hljs-title function_">Image</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.ic_public_music_filled'</span>))</li><li>    .<span class="hljs-title function_">width</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.water_ripples_width'</span>))</li><li>    .<span class="hljs-title function_">fillColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>}</li><li>.<span class="hljs-title function_">clickEffect</span>({ <span class="hljs-variable">level</span>: <span class="hljs-title class_">ClickEffectLevel</span>.<span class="hljs-title class_">HEAVY</span>, <span class="hljs-variable">scale</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">BUTTON_CLICK_SCALE</span> })</li><li>.<span class="hljs-title function_">backgroundColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.music_icon'</span>))</li><li>.<span class="hljs-keyword">type</span>(<span class="hljs-variable">ButtonType</span>.<span class="hljs-variable">Circle</span>)</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">BUTTON_SIZE</span>)</li><li>.<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">BUTTON_SIZE</span>)</li><li>.<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li><li>.<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">isListening</span> = !<span class="hljs-keyword">this</span>.<span class="hljs-variable">isListening</span>;</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">isListening</span>) {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>      <span class="hljs-variable">duration</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">ANIMATION_DURATION</span>,</li><li>      <span class="hljs-variable">iterations</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">ITERATIONS</span>,</li><li>      <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">EaseInOut</span></li><li>    }, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">immediatelyOpacity</span> = <span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">COMMON_NUMBER_0</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">immediatelyScale</span> = {</li><li>        <span class="hljs-variable">x</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_6</span>,</li><li>        <span class="hljs-variable">y</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_6</span></li><li>      };</li><li>    })</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>      <span class="hljs-variable">duration</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">ANIMATION_DURATION</span>,</li><li>      <span class="hljs-variable">iterations</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">ITERATIONS</span>,</li><li>      <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">EaseInOut</span>,</li><li>      <span class="hljs-variable">delay</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">DELAY_200</span></li><li>    }, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">delayOpacity</span> = <span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">COMMON_NUMBER_0</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">delayScale</span> = {</li><li>        <span class="hljs-variable">x</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_6</span>,</li><li>        <span class="hljs-variable">y</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_6</span></li><li>      };</li><li>    })</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// Break the animation by modifying the variable with a closure of duration 0.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_0</span> }, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">immediatelyOpacity</span> = <span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">COMMON_NUMBER</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">delayOpacity</span> = <span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">COMMON_NUMBER</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">immediatelyScale</span> = {</li><li>        <span class="hljs-variable">x</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_1</span>,</li><li>        <span class="hljs-variable">y</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_1</span></li><li>      };</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">delayScale</span> = {</li><li>        <span class="hljs-variable">x</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_1</span>,</li><li>        <span class="hljs-variable">y</span>: <span class="hljs-title class_">CommonConstants</span>.<span class="hljs-title class_">COMMON_NUMBER_1</span></li><li>      };</li><li>    })</li><li>  }</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageWaterRipples/view/PageWaterRipples.ets#L77-L131" target="_blank">PageWaterRipples.ets</a></div></div></div></div> <p><strong>使用关键帧动画实现微动效</strong></p> <ul><li>场景描述</li></ul> <p>如图所示，在本场景中，在登录页面前需要勾选相关的协议，如果未勾选相关协议，提示框将会通过左右移动进行提示。</p> <div class="fignone"><span class="figcap"><b>图8 </b>使用关键帧动画实现左右移动提示</span><br><span><img height="550.354" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.64511769743397242101766752246100:50001231000000:2800:00A5B872CE1FBD2BF66219C0380AF402215BB4E56A735B95B77A89E9053FD208.gif" title="点击放大" width="266"></span></div> <ul><li>实现原理</li></ul> <p>提示框左右移动提醒是将提示框进行左移，然后再进行右移，如此往复循环多次。其动效可以分为提示框左移和提示框右移两段，可以使用keyframeAnimateTo接口实现分段的动画效果，实现步骤如下所示。</p> <ol><li><span>根据需要实现的动画效果，将动画拆分成若干个关键帧，即将动画进行分段，如本案例中将动画分成提示框左移和提示框右移两段。</span></li><li><span>根据不同的关键帧设置关键帧状态，即设置该段关键帧动画的持续时间、动画曲线和闭包函数等。</span></li><li><span>设置动画触发条件，使用通用事件点击、出现等，选择对应需求的触发方式。</span></li></ol> <ul><li>开发步骤</li></ul> <p>通过keyframeAnimateTo来设置关键帧动画。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageVibrateEffect/view/PageVibrateEffect.ets#L229-L249" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">startAnimation</span>() {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">translateX</span> = <span class="hljs-variable">CONFIGURATION</span>.<span class="hljs-variable">POSITION_ZERO</span>;</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">keyframeAnimateTo</span>({ <span class="hljs-variable">iterations</span>: <span class="hljs-title class_">CONFIGURATION</span>.<span class="hljs-title class_">PLAYBACK_COUNT</span> }, [</li><li>    {</li><li>      <span class="hljs-variable">duration</span>: <span class="hljs-title class_">CONFIGURATION</span>.<span class="hljs-title class_">ANIMATION_TIME</span>,</li><li>      <span class="hljs-variable">event</span>: () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">translateX</span> = <span class="hljs-variable">CONFIGURATION</span>.<span class="hljs-variable">TRANSLATE_OFFSET_X</span>;</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-variable">duration</span>: <span class="hljs-title class_">CONFIGURATION</span>.<span class="hljs-title class_">ANIMATION_TIME</span>,</li><li>      <span class="hljs-variable">event</span>: () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">translateX</span> = <span class="hljs-variable">CONFIGURATION</span>.<span class="hljs-variable">POSITION_ZERO</span>;</li><li>      }</li><li>    }</li><li>  ]);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageVibrateEffect/view/PageVibrateEffect.ets#L229-L249" target="_blank">PageVibrateEffect.ets</a></div></div></div></div> <p>设置onClick事件，通过onClick事件调用关键帧动画。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageVibrateEffect/view/PageVibrateEffect.ets#L162-L182" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>($r(<span class="hljs-string">'app.string.login_in'</span>))</li><li>  .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>)</li><li>  .<span class="hljs-title function_">borderRadius</span>($r(<span class="hljs-string">'app.integer.comm_border_radius'</span>))</li><li>  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.ohos_id_color_background'</span>))</li><li>  .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.integer.login_button_font_size'</span>))</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">LAYOUT_MAX_PERCENT</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">confirm</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startVibrate</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startAnimation</span>();</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>          <span class="hljs-attr">message</span>: $r(<span class="hljs-string">'app.string.login_text'</span>)</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'PageVibrateEffect'</span>, <span class="hljs-string">`error code=<span class="hljs-subst">${error.code}</span>, message=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageVibrateEffect/view/PageVibrateEffect.ets#L162-L182" target="_blank">PageVibrateEffect.ets</a></div></div></div></div> <p><strong>使用属性动画实现手势动效</strong></p> <ul><li>场景描述</li></ul> <p>在本场景中，页面主要分为标题和列表两个部分，当向下滑动列表时，标题会跟随下滑手势扩展显示详细信息，其实现效果如下所示。</p> <div class="fignone"><span class="figcap"><b>图9 </b>使用属性动画实现手势动效</span><br><span><img height="550.354" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.09021184126816765814537957429953:50001231000000:2800:83790359A7566A141AA78C782D7E43290FD23FB047A72872F19E2BB12FFB646F.gif" title="点击放大" width="266"></span></div> <ul><li>实现原理</li></ul> <p>在实现下拉缩放详情中，主要包含了两个部分，分别是列表下拉的手势和下拉后标题和列表的动画，详细实现步骤如下。</p> <ol><li><span>处理手势事件：通过onTouch事件记录当前的触摸点，判断当前的手势是否为向上或向下滑动。</span></li><li><span>通过属性动画animation实现标题缩放的效果：当列表向上或向下滑动时，改变列表的高度，并通过属性动画进行平滑过度，从而实现标题区域缩放的效果。</span></li><li><span>实现标题内容的平移：在标题区域进行缩放的同时，标题的内容也会同步进行平移，从而实现标题部分整体缩放的效果。</span></li></ol> <ul><li>开发步骤</li></ul> <p>实现手势事件方法。当手指按下时，触发TouchType.Down事件记录当前触碰的位置。手指按压态在屏幕上移动时，可以通过当前的位置与初始位置进行比较，判断手势是否为向上或向下滑动，进而变更列表的高度。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L154-L187" data-highlighted="yes"><ol class="linenums"><li>handleTouchEvent(event: TouchEvent): void {</li><li>  switch (event.type) {</li><li>    case TouchType.Down:</li><li>      <span class="hljs-keyword">this</span>.downY = event.touches[<span class="hljs-number">0</span>].y;</li><li>      <span class="hljs-keyword">this</span>.lastMoveY = event.touches[<span class="hljs-number">0</span>].y;</li><li>      <span class="hljs-keyword">this</span>.isMoving = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.duration = Constants.ANIMATE_DURATION_DRAG;</li><li>      <span class="hljs-keyword">break</span>;</li><li>
</li><li>    case TouchType.Move:</li><li>      <span class="hljs-keyword">const</span> delta = event.touches[<span class="hljs-number">0</span>].y - <span class="hljs-keyword">this</span>.lastMoveY;</li><li>      <span class="hljs-keyword">this</span>.offsetY = event.touches[<span class="hljs-number">0</span>].y - <span class="hljs-keyword">this</span>.downY;</li><li>      <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">this</span>.heightValue = Constants.AREA_HEIGHT_BEFORE;</li><li>        <span class="hljs-keyword">this</span>.isExpanded = <span class="hljs-literal">false</span>;</li><li>        <span class="hljs-keyword">this</span>.atStart = <span class="hljs-literal">false</span>;</li><li>      }</li><li>      <span class="hljs-keyword">if</span> (delta &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.atStart) {</li><li>        <span class="hljs-keyword">this</span>.animateToThrottle(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.heightValue = Constants.AREA_HEIGHT_AFTER;</li><li>          <span class="hljs-keyword">this</span>.isExpanded = <span class="hljs-literal">true</span>;</li><li>        }, <span class="hljs-number">1000</span>);</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.lastMoveY = event.touches[<span class="hljs-number">0</span>].y;</li><li>      <span class="hljs-keyword">break</span>;</li><li>
</li><li>    case TouchType.Cancel:</li><li>      <span class="hljs-keyword">this</span>.isMoving = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-keyword">this</span>.duration = Constants.ANIMATE_DURATION_BACK;</li><li>      <span class="hljs-keyword">break</span>;</li><li>    default:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L154-L187" target="_blank">PageExpandTitle.ets</a></div></div></div></div> <p>为列表设置触摸事件onTouch和属性动画，实现标题区域缩放的效果。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L90-L117" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-tag">Column</span>() {</li><li>  <span class="hljs-selector-tag">List</span>({ space: Constants.SEARCH_MEMO_SPACE }) {</li><li>    <span class="hljs-selector-tag">ListItem</span>() {</li><li>      <span class="hljs-selector-tag">Search</span>({ placeholder: $r('app.string.search_placeholder') })</li><li>        <span class="hljs-selector-class">.width</span>(Constants.LAYOUT_MAX_PERCENT)</li><li>        <span class="hljs-selector-class">.height</span>(Constants.LAYOUT_EIGHT_PERCENT)</li><li>        <span class="hljs-selector-class">.backgroundColor</span>(Color.White)</li><li>        <span class="hljs-selector-class">.enableKeyboardOnFocus</span>(false)</li><li>    }</li><li>
</li><li>    <span class="hljs-built_in">LazyForEach</span>(this.memoData, (<span class="hljs-attribute">item</span>: MemoInfo) =&gt; {</li><li>      <span class="hljs-built_in">ListItem</span>() {</li><li>        <span class="hljs-built_in">MemoItem</span>({ <span class="hljs-attribute">memoItem</span>: item })</li><li>      }</li><li>    }, (<span class="hljs-attribute">item</span>: MemoInfo) =&gt; JSON.<span class="hljs-built_in">stringify</span>(item))</li><li>  }</li><li>  .<span class="hljs-built_in">scrollBar</span>(BarState.Off)</li><li>  .<span class="hljs-built_in">margin</span>({ <span class="hljs-attribute">left</span>: $<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.float.layout_10'</span>), <span class="hljs-attribute">right</span>: $<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.float.layout_10'</span>) })</li><li>  .<span class="hljs-built_in">width</span>(Constants.LAYOUT_NINETY_PERCENT)</li><li>  .<span class="hljs-built_in">expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.TOP, SafeAreaEdge.BOTTOM])</li><li>  .<span class="hljs-built_in">onReachStart</span>(() =&gt; {</li><li>    this.atStart = true;</li><li>  })</li><li>}</li><li>.<span class="hljs-built_in">width</span>(Constants.LAYOUT_MAX_PERCENT)</li><li>.<span class="hljs-built_in">height</span>(this.heightValue)</li><li>.<span class="hljs-built_in">animation</span>({ <span class="hljs-attribute">duration</span>: this.duration, <span class="hljs-attribute">curve</span>: Curve.FastOutLinearIn })</li><li>.<span class="hljs-built_in">onTouch</span>((<span class="hljs-attribute">event</span>: TouchEvent) =&gt; this.<span class="hljs-built_in">handleTouchEvent</span>(event))</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L90-L117" target="_blank">PageExpandTitle.ets</a></div></div></div></div> <p>通过animation属性动画实现标题内容平移，从而达到标题整体缩放的效果。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L48-L86" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">Column</span>() {</li><li>  <span class="hljs-built_in">Row</span>() {</li><li>    Text(!this.isExpanded ? $r('app.string.memo_title') : <span class="hljs-string">''</span>)</li><li>      .<span class="hljs-built_in">fontSize</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.init_title_font_size'</span>))</li><li>    <span class="hljs-built_in">Blank</span>()</li><li>    // <span class="hljs-built_in">Image</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.media.is_public_add'</span>))</li><li>    //   .<span class="hljs-built_in">width</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.menu_pic_layout'</span>))</li><li>    //   .<span class="hljs-built_in">height</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.menu_pic_layout'</span>))</li><li>    // <span class="hljs-built_in">Image</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.media.ic_public_more'</span>))</li><li>    //   .<span class="hljs-built_in">width</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.menu_pic_layout'</span>))</li><li>    //   .<span class="hljs-built_in">height</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.menu_pic_layout'</span>))</li><li>    //   .<span class="hljs-built_in">margin</span>({ <span class="hljs-attribute">left</span>: <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.float.layout_8'</span>) })</li><li>  }</li><li>  <span class="hljs-selector-class">.width</span>(Constants.LAYOUT_MAX_PERCENT)</li><li>  <span class="hljs-selector-class">.padding</span>($r('app.float.layout_25'))</li><li>  <span class="hljs-selector-class">.margin</span>({ top: $r('app.float.layout_10') })</li><li>  <span class="hljs-selector-class">.alignItems</span>(VerticalAlign.Center)</li><li>  <span class="hljs-selector-class">.translate</span>(this.getMenuTranslateOptions())</li><li>  <span class="hljs-selector-class">.animation</span>({ duration: this.duration, curve: Curve.FastOutLinearIn })</li><li>
</li><li>  <span class="hljs-built_in">Column</span>() {</li><li>    Text($r('app.string.memo_title'))</li><li>      <span class="hljs-selector-class">.fontSize</span>($r('app.float.expanded_title_font_size'))</li><li>    Text($r('app.string.memo_counts'))</li><li>      <span class="hljs-selector-class">.fontSize</span>($r('app.float.memo_counts_font_size'))</li><li>      <span class="hljs-selector-class">.fontColor</span>(Color.Grey)</li><li>  }</li><li>  <span class="hljs-selector-class">.width</span>(Constants.LAYOUT_MAX_PERCENT)</li><li>  <span class="hljs-selector-class">.padding</span>({ left: $r('app.float.layout_25') })</li><li>  <span class="hljs-selector-class">.margin</span>({ top: $r('app.float.layout_10') })</li><li>  <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Start)</li><li>  <span class="hljs-selector-class">.translate</span>(this.getTitleTranslateOptions())</li><li>  <span class="hljs-selector-class">.scale</span>(this.getTitleScaleOptions())</li><li>  <span class="hljs-selector-class">.animation</span>({ duration: this.duration, curve: Curve.FastOutLinearIn })</li><li>  <span class="hljs-selector-class">.transition</span>({ type: TransitionType.Insert, translate: { y: Constants.TRANSLATE_Y } })</li><li>  <span class="hljs-selector-class">.visibility</span>(this.isExpanded ? Visibility.Visible : Visibility.Hidden)</li><li>}</li><li><span class="hljs-selector-class">.height</span>(Constants.LAYOUT_MAX_PERCENT)</li><li><span class="hljs-selector-class">.width</span>(Constants.LAYOUT_MAX_PERCENT)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/animation-collection/blob/master/entry/src/main/ets/feature/pageExpandTitle/view/PageExpandTitle.ets#L48-L86" target="_blank">PageExpandTitle.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section979417191967">提升动画感知流畅度总结<i class="anchor-icon anchor-icon-link" anchorid="section979417191967" tips="复制节点链接"></i></h3><p>在应用开发中，动画可以为用户界面增添生动、流畅的交互效果，提升用户对应用的好感度。然而，滥用动画也会导致应用性能下降，消耗过多的系统资源，甚至影响用户体验。</p> <p>本文重点描述了如何在特定设计场景下充分利用HarmonyOS提供的动画能力，以确保动画既能够增强用户体验，又不至于对应用性能造成负面影响。开发者需要在实现动画效果时，注意控制动画的复杂度和频率，以节约系统资源，提升应用的性能表现。提升动画感知流畅度需要考虑以下几点：</p> <ul><li>用户体验：动画应该能够提升用户体验，而不是仅仅为了动画而动画。动画应该能够使用户界面更加生动、直观和易于理解，而不应该过于花哨或者繁琐。</li><li>性能优化：动画的流畅性对于用户体验至关重要。在设计动画时，需要考虑到设备的性能和资源消耗，避免过多的动画效果导致性能下降或者卡顿。</li><li>可访问性：在设计动画时，需要考虑到一些用户可能存在的视觉或认知障碍。动画效果应该不会影响到用户对应用界面的理解和操作。</li><li>上下文适应：动画效果应该根据应用的具体场景和功能进行设计，与应用的整体风格和设计语言保持一致。</li></ul> <p>合理利用HarmonyOS提供的动画能力可以有效提升应用的用户体验和吸引力，但开发者需要在设计和实现过程中综合考虑动画的使用场景、频率以及对系统资源的影响，扬长避短，确保应用的性能和稳定性。</p> </div> <div class="tiledSection"><h2 id="section4662105481116">提升动画运行流畅度<i class="anchor-icon anchor-icon-link" anchorid="section4662105481116" tips="复制节点链接"></i></h2><p>动画在应用开发中扮演着重要的角色，能够提升用户体验，传达信息，引导用户操作，提升应用品质和增加视觉吸引力。而动画的性能表现也至关重要，优化可以从属性更新和布局等几个方面考虑，尽可能减少冗余刷新。本文将介绍如下5种优化手段，通过这些优化手段的单个使用或组合使用，可以对动画帧率、应用卡顿等方面带来优化，提升性能和用户体验：</p> <ul><li>使用系统提供的动画接口：系统提供的动画接口经过精心设计和优化，能够在不同设备上提供流畅的动画效果，最大程度地减少丢帧率和卡顿现象。</li><li>使用图形变换属性变化组件布局：通过对组件的图形变换属性进行调整，而不是直接修改组件的布局属性，可以减少不必要的布局计算和重绘操作，从而降低丢帧率，提升动画的流畅度和响应速度。</li><li>参数相同时使用同一个animateTo：当多个动画的参数相同时，合并它们并使用同一个animateTo方法进行处理能够有效减少不必要的计算和渲染开销。</li><li>多次animateTo时统一更新状态变量：在进行多次动画操作时，统一更新状态变量可以避免不必要的状态更新和重复渲染，从而减少性能开销。</li><li>使用renderGroup：在单一页面上存在大量应用动效的组件时，可以使用renderGroup方法来解决卡顿问题，从而提升动画性能。</li></ul> <p>下文将通过5个测试来验证上述优化方法的收益，以证明这些优化手段的可行性。综合考虑业界共识指标和实际用户使用体验，测试将对比分析如下几个关键指标：</p> <ul><li>丢帧率（Janky Frames）：表示一个时间周期内的丢帧比率，指一个时间周期内有问题的帧比例。HarmonyOS系统要求每一帧都要在11.1ms（90Hz刷新率）内绘制完成，如果页面没有在11.1ms内完成这一帧的绘制，就会出现丢帧。部分丢帧一般用户肉眼是感知不到的，只有出现连续丢帧用户才有明显感知。</li><li>最大连续丢帧数（maximum successive frame dropping count）：表示从页面开始有响应变化到页面结束刷新的过程中，由于显示器画面刷新频率低于预设的画面帧率而未能正常呈现的最大连续帧数。一般而言，当连续值超过3时，用户可以明显感知到卡顿掉帧，数值越大卡顿时间越长。</li><li>平均1s大卡顿次数：表示程序运行过程中平均1s出现连续丢3帧以上的卡顿的次数，数值越大用户体验感越差。</li></ul> <p>测试表明，当系统提供的接口可以实现所需动画效果时，其性能明显优于使用自定义动画实现，自定义动画大量的计算会导致其在应用侧大量丢帧，而系统提供的接口不依赖应用侧计算，更加流畅顺滑；实现位移、缩放、旋转等布局变化动画时，使用图形变换属性替换布局属性实现动画可以将丢帧率从8.1%降至3.7%，且明显减少了大卡顿次数；而多个参数相同的动画闭包同时实现时，将变化属性放入一个动画闭包可以使丢帧率从9.6%降低至4.0%；同样的，避免在两个动画闭包之间更新状态也可以降低动画的丢帧率。</p> </div> <div class="tiledSection"><h3 id="section897161681719" class="firsth2">使用系统提供的动画接口<i class="anchor-icon anchor-icon-link" anchorid="section897161681719" tips="复制节点链接"></i></h3><p>一般而言，在HarmonyOS应用开发中，动画设计实现可以通过自定义动画或系统提供的动画接口两种方式来实现。</p> <ul><li>方式一，自定义动画：<p>自定义动画是指通过编写自定义的动画逻辑和计算过程来实现特定的动画效果。开发人员可以根据应用的需求和设计要求，使用自定义的动画算法和逻辑来创建独特的动画效果。自定义动画的优势在于可以实现非常个性化的动画效果，并且能够完全控制动画的每一个细节，但需要开发人员具备一定的动画算法和计算能力。</p> </li><li>方式二，系统动画接口：<p>系统动画接口是指通过使用系统提供的动画框架和接口来实现动画效果。在移动应用开发中，通常会使用属性动画来实现各种动画效果。通过可动画属性改变引起UI上产生的连续视觉效果，即为属性动画。属性动画是最基础易懂的动画，ArkUI提供两种属性动画接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#animateto" target="_blank">animateTo</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-animatorproperty" target="_blank">animation</a>驱动组件属性按照动画曲线等动画参数进行连续的变化，产生属性动画。使用系统提供的动画接口可以简化动画的实现过程，并且能够充分利用系统优化的动画计算和渲染能力，从而提高动画的性能和流畅度。</p> </li></ul> <p><strong>场景设计</strong></p> <p>针对同一界面多个按钮同时缩放的场景（如下图所示），分别用自定义动画、属性动画、显式动画实现。</p> <div class="fignone"><span class="figcap"><b>图10 </b>同一界面多个按钮同时缩放示意图</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.23028654958406034834041254177871:50001231000000:2800:0788C43D105CF99495F0F8307216FA81AF13BE14E172D11DE823BCE87FB8EA23.gif" title="点击放大" width="266"></span></div> <p><strong>自定义动画</strong></p> <p>播放动画时，系统需要在一个刷新周期内完成动画变化曲线的计算，完成组件布局绘制等操作。使用了自定义动画，动画曲线计算过程很容易引起UI线程高负载，易导致丢帧。</p> <p>使用自定义动画实现按键缩放，具体实现代码如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/CustomAnimation.ets#L17-L186" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct CustomAnimation {</li><li>  <span class="hljs-meta">@State</span> widthSize: number = <span class="hljs-number">80</span></li><li>  <span class="hljs-meta">@State</span> heightSize: number = <span class="hljs-number">40</span></li><li>  <span class="hljs-meta">@State</span> flag: boolean = <span class="hljs-literal">true</span></li><li>
</li><li>  <span class="hljs-comment">// Custom animation function</span></li><li>  computeSize() {</li><li>    let duration = <span class="hljs-number">2000</span></li><li>    <span class="hljs-comment">// Set the loop cycle</span></li><li>    let period = <span class="hljs-number">1</span></li><li>    let widthSizeEnd = <span class="hljs-number">0</span></li><li>    let heightSizeEnd = <span class="hljs-number">0</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.flag) {</li><li>      widthSizeEnd = <span class="hljs-number">50</span></li><li>      heightSizeEnd = <span class="hljs-number">25</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      widthSizeEnd = <span class="hljs-number">80</span></li><li>      heightSizeEnd = <span class="hljs-number">40</span></li><li>    }</li><li>    <span class="hljs-comment">// Calculate loop count</span></li><li>    let doTimes = duration / period</li><li>    <span class="hljs-comment">// Calculate the variation per cycle</span></li><li>    let deltaHeight = (heightSizeEnd - <span class="hljs-keyword">this</span>.heightSize) / doTimes</li><li>    let deltaWeight = (widthSizeEnd - <span class="hljs-keyword">this</span>.widthSize) / doTimes</li><li>    <span class="hljs-comment">// Loop, with each cycle the component increases in width and height by a portion.</span></li><li>    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">1</span>; i &lt;= doTimes; i++) {</li><li>      let t = period * (i);</li><li>      setTimeout(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.heightSize = <span class="hljs-keyword">this</span>.heightSize + deltaHeight</li><li>        <span class="hljs-keyword">this</span>.widthSize = <span class="hljs-keyword">this</span>.widthSize + deltaWeight</li><li>      }, t)</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.flag = !<span class="hljs-keyword">this</span>.flag</li><li>  }</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Column() {</li><li>        Row() {</li><li>          Button()</li><li>            .width(<span class="hljs-keyword">this</span>.widthSize)</li><li>            .height(<span class="hljs-keyword">this</span>.heightSize)</li><li>            .margin(<span class="hljs-number">20</span>)</li><li>          Button()</li><li>            .width(<span class="hljs-keyword">this</span>.widthSize)</li><li>            .height(<span class="hljs-keyword">this</span>.heightSize)</li><li>            .margin(<span class="hljs-number">20</span>)</li><li>          Button()</li><li>            .width(<span class="hljs-keyword">this</span>.widthSize)</li><li>            .height(<span class="hljs-keyword">this</span>.heightSize)</li><li>            .margin(<span class="hljs-number">20</span>)</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .height(<span class="hljs-string">'85%'</span>)</li><li>
</li><li>      Column() {</li><li>        Button(<span class="hljs-string">'Tap me'</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .onClick(() =&gt; {</li><li>            setTimeout(() =&gt; {</li><li>              <span class="hljs-keyword">this</span>.computeSize()</li><li>            }, <span class="hljs-number">500</span>)</li><li>          })</li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>      .height(<span class="hljs-string">'15%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/CustomAnimation.ets#L17-L186" target="_blank">CustomAnimation.ets</a></div></div></div></div> <p><strong>系统动画接口</strong></p> <p>系统提供的动画接口，只需设置曲线类型、终点位置、时长等信息，就能够满足常用的动画功能，减少UI主线程的负载。</p> <ul><li>使用属性动画实现按键缩放，具体实现代码如下：<div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/PropertyAnimateTo.ets#L17-L275" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PropertyAnimateTo</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">widthSize</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">80</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">heightSize</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">40</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">flag</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">true</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Button</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span>)</li><li>            .<span class="hljs-title function_">animation</span>({</li><li>              <span class="hljs-variable">duration</span>: <span class="hljs-number">2000</span>,</li><li>              <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Linear</span>,</li><li>              <span class="hljs-variable">delay</span>: <span class="hljs-number">500</span>,</li><li>              <span class="hljs-variable">iterations</span>: <span class="hljs-number">1</span>,</li><li>              <span class="hljs-variable">playMode</span>: <span class="hljs-title class_">PlayMode</span>.<span class="hljs-title class_">Normal</span></li><li>            })</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>
</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'85%'</span>)</li><li>
</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'Tap me'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>((<span class="hljs-variable">event</span>?: <span class="hljs-title class_">ClickEvent</span> | <span class="hljs-title class_">undefined</span>) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span>) {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span> = <span class="hljs-number">50</span></li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span> = <span class="hljs-number">25</span></li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span> = <span class="hljs-number">80</span></li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span> = <span class="hljs-number">40</span></li><li>            }</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span> = !<span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-number">16</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/PropertyAnimateTo.ets#L17-L275" target="_blank">PropertyAnimateTo.ets</a></div></div></div></div> </li></ul> <ul><li>使用显式动画实现按键缩放，具体实现代码如下：<div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ExplicitAnimateTo.ets#L17-L180" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExplicitAnimateTo</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">widthSize</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">80</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">heightSize</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">40</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">flag</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">true</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Button</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>
</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'85%'</span>)</li><li>
</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'Tap me'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>((<span class="hljs-variable">event</span>?: <span class="hljs-title class_">ClickEvent</span> | <span class="hljs-title class_">undefined</span>) =&gt; {</li><li>            <span class="hljs-comment">// Animate the width and height properties of the Button component</span></li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span>) {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>                <span class="hljs-variable">duration</span>: <span class="hljs-number">2000</span>,</li><li>                <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Linear</span>,</li><li>                <span class="hljs-variable">delay</span>: <span class="hljs-number">500</span>,</li><li>                <span class="hljs-variable">iterations</span>: <span class="hljs-number">1</span>,</li><li>                <span class="hljs-variable">playMode</span>: <span class="hljs-title class_">PlayMode</span>.<span class="hljs-title class_">Normal</span></li><li>              }, () =&gt; {</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span> = <span class="hljs-number">50</span>;</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span> = <span class="hljs-number">25</span>;</li><li>              })</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>                <span class="hljs-variable">duration</span>: <span class="hljs-number">2000</span>,</li><li>                <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Linear</span>,</li><li>                <span class="hljs-variable">delay</span>: <span class="hljs-number">500</span>,</li><li>                <span class="hljs-variable">iterations</span>: <span class="hljs-number">1</span>,</li><li>                <span class="hljs-variable">playMode</span>: <span class="hljs-title class_">PlayMode</span>.<span class="hljs-title class_">Normal</span></li><li>              }, () =&gt; {</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-variable">widthSize</span> = <span class="hljs-number">80</span>;</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-variable">heightSize</span> = <span class="hljs-number">40</span>;</li><li>              })</li><li>            }</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span> = !<span class="hljs-keyword">this</span>.<span class="hljs-variable">flag</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-number">16</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ExplicitAnimateTo.ets#L17-L180" target="_blank">ExplicitAnimateTo.ets</a></div></div></div></div> </li></ul> <p><strong>性能分析</strong></p> <p>使用DevEco Studio的Profiler工具检测下述指标，得到的数据如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b><strong>自定义动画、属性动画、显式动画实现相同场景</strong><strong>的指标对比</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.17.2.5.1.1" valign="top" width="22.24%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.13.17.2.5.1.2" valign="top" width="24.23%"><p>自定义动画</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.17.2.5.1.3" valign="top" width="26.1%"><p>属性动画</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.17.2.5.1.4" valign="top" width="27.43%"><p>显式动画</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="22.24%"><p>丢帧率（%）</p> </td> <td class="cellrowborder" valign="top" width="24.23%"><p>9.2%</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>0%</p> </td> <td class="cellrowborder" valign="top" width="27.43%"><p>0%</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.24%"><p>最大连续丢帧数（帧）</p> </td> <td class="cellrowborder" valign="top" width="24.23%"><p>7</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="27.43%"><p>0</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="22.24%"><p>平均1s大卡顿次数（次/s）</p> </td> <td class="cellrowborder" valign="top" width="24.23%"><p>1.50</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>0</p> </td> <td class="cellrowborder" valign="top" width="27.43%"><p>0</p> </td> </tr>  </tbody></table></div> </div> <p>分析结论：</p> <p>1）使用自定义动画实现计算量较大的动画时，丢帧率高达9.2%，最大连续丢失7帧，平均每秒发生大卡顿1.5次。</p> <p>2）使用系统动画接口实现相同效果时，属性动画接口和显式动画接口都能够达到0丢帧。</p> <p>这一结果表明，系统动画接口内部实现对开发者是透明的，已经进行了尽可能的性能优化，避免开发者使用自定义动画时产生不必要的性能劣化。自定义动画适合实现个性化的、复杂的动画效果，而系统提供的动画接口则适合实现常见的动画效果并且能够获得更好的性能表现。因此，在动画能够使用系统提供的接口实现的情况下，开发者应尽量使用系统提供的接口实现，保持动画的流畅性和稳定性，提升应用的性能表现。</p> </div> <div class="tiledSection"><h3 id="section1723931117204">使用图形变换属性变化组件<i class="anchor-icon anchor-icon-link" anchorid="section1723931117204" tips="复制节点链接"></i></h3><p>在应用开发中，改动组件的布局显示可以通过改动布局属性、改动图形变换属性两种方式来实现。</p> <ul><li>方式一，改动布局属性<p>常见的布局属性包括位置、大小、内边距、外边距、对齐方式、权重等。当这些布局属性发生改变时，界面将重新布局以适应新的属性值。</p> </li><li>方式二，改动图形变换属性<p>图形变换属性是指对组件布局结果的变换操作，如平移、旋转、缩放等操作。通过改变这些图形变换属性，可以实现对组件布局完成后，在界面上的位置和形态进行动态变换。</p> </li></ul> <p>布局属性和图形变换属性的可替换关系如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.5.2.3.1.1" valign="top" width="50%"><p>图形变换属性</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.5.2.3.1.2" valign="top" width="50%"><p>布局属性</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>rotate</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>/</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>translate</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>position、offset</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>scale</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>width、height、Size</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>transform</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>/</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>表格中的对应关系仅供参考，开发者可以自行发掘更多的替代关系。</p> </div></div></div> <p><strong>场景设计</strong></p> <p>针对同一界面多个图片同时缩放并位移的场景（如下图所示），分别通过改变布局属性、改变图形变换属性实现。</p> <div class="fignone"><span class="figcap"><b>图11 </b>同一界面多个图片同时缩放并位移示意图</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.75465017137643324463007548492394:50001231000000:2800:5BCEB0B563A88781D25D4F582403F0AC8AF2E8375DB5D3394B5325CBE5D003FB.gif" title="点击放大" width="266"></span></div> <p><strong>改变布局属性</strong></p> <p>布局属性发生变化时，系统需要重新计算组件的位置和大小，然后进行重新布局。这个过程需要消耗大量的计算资源和时间，尤其是在界面中包含大量组件或者复杂布局时，性能开销会更加明显。</p> <p>通过组件的width、height、position属性来改变组件大小和位置，具体代码实现如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ImageAnimation.ets#L17-L242" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct ImageAnimation {</li><li>  <span class="hljs-meta">@State</span> imageWidth: number = <span class="hljs-number">60</span>;</li><li>  <span class="hljs-meta">@State</span> imageHeight: number = <span class="hljs-number">60</span>;</li><li>  <span class="hljs-meta">@State</span> xPosition: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> yPosition: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> imageScaleX: number = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> imageScaleY: number = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> imageTranslateX: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> imageTranslateY: number = <span class="hljs-number">0</span>;</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Row() {</li><li>          Image($r(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>            .width(<span class="hljs-keyword">this</span>.imageWidth)</li><li>            .height(<span class="hljs-keyword">this</span>.imageHeight)</li><li>            .position({ x: <span class="hljs-keyword">this</span>.xPosition, y: <span class="hljs-keyword">this</span>.yPosition })</li><li>            .scale({</li><li>              x: <span class="hljs-keyword">this</span>.imageScaleX,</li><li>              y: <span class="hljs-keyword">this</span>.imageScaleY,</li><li>              centerX: <span class="hljs-number">0</span>,</li><li>              centerY: <span class="hljs-number">0</span></li><li>            })</li><li>            .translate({ x: <span class="hljs-keyword">this</span>.imageTranslateX, y: <span class="hljs-keyword">this</span>.imageTranslateY })</li><li>        }.width(<span class="hljs-string">'33%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>      Column() {</li><li>        Button(<span class="hljs-string">'Change Layout Properties'</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          <span class="hljs-comment">// Key Attribute Settings</span></li><li>          .onClick(() =&gt; {</li><li>            <span class="hljs-comment">// Loop animation by play count</span></li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>              <span class="hljs-comment">// Interval playback position, width and height changes</span></li><li>              <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {</li><li>                setTimeout(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.imageWidth = <span class="hljs-number">100</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageHeight = <span class="hljs-number">100</span>;</li><li>                    <span class="hljs-keyword">this</span>.xPosition = <span class="hljs-number">12</span>;</li><li>                    <span class="hljs-keyword">this</span>.yPosition = <span class="hljs-number">12</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * i)</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                setTimeout(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.imageWidth = <span class="hljs-number">60</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageHeight = <span class="hljs-number">60</span>;</li><li>                    <span class="hljs-keyword">this</span>.xPosition = <span class="hljs-number">0</span>;</li><li>                    <span class="hljs-keyword">this</span>.yPosition = <span class="hljs-number">0</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * i)</li><li>              }</li><li>            }</li><li>          })</li><li>        Button(<span class="hljs-string">'Change Image Properties'</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .margin({ top: <span class="hljs-number">12</span> })</li><li>          .onClick(() =&gt; {</li><li>            <span class="hljs-comment">// Loop animation by play count</span></li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>              <span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {</li><li>                setTimeout(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.imageScaleX = <span class="hljs-number">2</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageScaleY = <span class="hljs-number">2</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageTranslateX = <span class="hljs-number">12</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageTranslateY = <span class="hljs-number">12</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * i)</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                setTimeout(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.imageScaleX = <span class="hljs-number">1</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageScaleY = <span class="hljs-number">1</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageTranslateX = <span class="hljs-number">0</span>;</li><li>                    <span class="hljs-keyword">this</span>.imageTranslateY = <span class="hljs-number">0</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * i)</li><li>              }</li><li>            }</li><li>          })</li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ImageAnimation.ets#L17-L242" target="_blank">ImageAnimation.ets</a></div></div></div></div> <p><strong>改变图形变换属性</strong></p> <p>图形变换只是对组件的显示效果进行变换，而不会改变其在布局中的位置和大小，因此不会触发重新布局的计算过程。这使得使用图形变换属性来实现动画效果时，能够提升界面的流畅性和性能表现。</p> <p>通过组件的scale、translate属性来改变组件大小和位置，具体代码实现如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ImageAnimation.ets#L18-L243" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ImageAnimation</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageWidth</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageHeight</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">xPosition</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">yPosition</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageScaleX</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageScaleY</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageTranslateX</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageTranslateY</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Image</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.startIcon'</span>))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageWidth</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageHeight</span>)</li><li>            .<span class="hljs-title function_">position</span>({ <span class="hljs-variable">x</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">xPosition</span>, <span class="hljs-variable">y</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">yPosition</span> })</li><li>            .<span class="hljs-title function_">scale</span>({</li><li>              <span class="hljs-variable">x</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">imageScaleX</span>,</li><li>              <span class="hljs-variable">y</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">imageScaleY</span>,</li><li>              <span class="hljs-variable">centerX</span>: <span class="hljs-number">0</span>,</li><li>              <span class="hljs-variable">centerY</span>: <span class="hljs-number">0</span></li><li>            })</li><li>            .<span class="hljs-title function_">translate</span>({ <span class="hljs-variable">x</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">imageTranslateX</span>, <span class="hljs-variable">y</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">imageTranslateY</span> })</li><li>        }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'33%'</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'Change Image Properties'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-comment">// Loop animation by play count</span></li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-number">10</span>; <span class="hljs-title class_">i</span>++) {</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable">i</span> % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageScaleX</span> = <span class="hljs-number">2</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageScaleY</span> = <span class="hljs-number">2</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTranslateX</span> = <span class="hljs-number">12</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTranslateY</span> = <span class="hljs-number">12</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * <span class="hljs-variable">i</span>)</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageScaleX</span> = <span class="hljs-number">1</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageScaleY</span> = <span class="hljs-number">1</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTranslateX</span> = <span class="hljs-number">0</span>;</li><li>                    <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageTranslateY</span> = <span class="hljs-number">0</span>;</li><li>                  })</li><li>                }, <span class="hljs-number">1000</span> * <span class="hljs-variable">i</span>)</li><li>              }</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">End</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-number">16</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/ImageAnimation.ets#L18-L243" target="_blank">ImageAnimation.ets</a></div></div></div></div> <p><strong>性能分析</strong></p> <p>使用DevEco Studio的Profiler工具检测下述指标，得到的数据如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表3 </b><strong>改变布局属性、改变图形变换属性实现</strong><strong>相同场景</strong><strong>的指标对比</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.20.2.4.1.1" valign="top" width="26.810000000000002%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.14.20.2.4.1.2" valign="top" width="33.56%"><p>改变布局属性</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.20.2.4.1.3" valign="top" width="39.629999999999995%"><p>改变图形变换属性</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>丢帧率（%）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>8.1%</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>3.7%</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>最大连续丢帧数（帧）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>8</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>2</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>平均1s大卡顿次数（次/s）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>0.48</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>0</p> </td> </tr>  </tbody></table></div> </div> <p>分析结论：</p> <p>1）使用布局属性改变图片大小和位置时，丢帧率为8.1%，最多连续丢失8帧，平均每秒发生大卡顿0.48次。</p> <p>2）使用图形变化属性改变图片大小和位置时，丢帧率降到了3.7%，最多连续丢失2帧，在相同时长内没有发生大卡顿。</p> <p>这一结果表明，使用图形变化属性改变图片大小和位置时，能够显著降低丢帧率和大卡顿的发生频率。界面布局是非常耗时的操作，因此频繁地改动布局属性会导致界面性能下降，出现卡顿现象，影响用户体验。因此，在动画能够使用图形变化属性实现的情况下，开发者应尽量使用图形变化属性实现，保持动画的流畅性和稳定性，提升应用的性能表现。</p> </div> <div class="tiledSection"><h3 id="section1150051943714">参数相同时使用同一个animateTo<i class="anchor-icon anchor-icon-link" anchorid="section1150051943714" tips="复制节点链接"></i></h3><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>建议开发者优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter" target="_blank">Code Linter扫描工具</a>进行代码检查，重点关注<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide_hp-arkui-combine-same-arg-animateto" target="_blank">@performance/hp-arkui-combine-same-arg-animateto</a>规则。若扫描结果中出现该规则相关问题，可参考本章节提供的优化建议进行调整。</p> </div></div></div> <p>每次调用animateTo方法，都会触发一次属性变化，这意味着在每次动画执行时都需要进行动画前后的对比，以确定属性的变化情况。当多次连续调用animateTo时，会增加额外的布局计算和绘制开销，从而降低性能表现。特别是当这些animateTo操作针对同一个组件的属性时，会导致该组件更新的次数增加，进一步影响性能。</p> <p>在实际开发中，如果多个属性需要以相同的动画参数进行变化，推荐将它们放到同一个动画闭包中执行。通过将多个属性的动画操作合并到同一个动画闭包中，可以减少对组件的多次更新，避免重复的布局计算和绘制操作，提升动画效果的性能。</p> <p>除了性能方面的优势，将多个属性的动画操作合并到同一个动画闭包中还有助于提高代码的可读性和维护性。通过集中管理相关联的属性变化，可以使代码结构更加清晰，便于后续的维护和修改。</p> <p><strong>场景设计</strong></p> <p>针对多个相同组件同时修改多个属性的场景（如下图所示），分别使用多个animateTo闭包和一个animateTo闭包实现。</p> <div class="fignone"><span class="figcap"><b>图12 </b>多个相同组件同时修改多个属性示意图</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162946.09663620966155588139913096063910:50001231000000:2800:51D7718F386D6BC8A6056B35EDCECAA5DE05A4503414D6AF030D2759FBD64675.gif" title="点击放大" width="266"></span></div> <p><strong>代码实现</strong></p> <ul><li>将相同动画参数的状态变量更新放在不同的动画闭包中，具体代码实现如下：<div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/MultipleProperties.ets#L17-L183" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct MultipleProperties {</li><li>  <span class="hljs-meta">@State</span> w:number = <span class="hljs-number">150</span></li><li>  <span class="hljs-meta">@State</span> h:number = <span class="hljs-number">2</span></li><li>  <span class="hljs-meta">@State</span> brightNum:number = <span class="hljs-number">1.5</span></li><li>  <span class="hljs-meta">@State</span> color:Color = Color.Red</li><li>  <span class="hljs-comment">// Animation closure 1, set width change</span></li><li>  func1() {</li><li>    <span class="hljs-keyword">this</span>.getUIContext().animateTo({curve: Curve.Sharp, duration: <span class="hljs-number">1000</span>}, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.w = (<span class="hljs-keyword">this</span>.w === <span class="hljs-number">80</span> ? <span class="hljs-number">150</span> : <span class="hljs-number">80</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// Animation Closure 2, Set Color Change</span></li><li>  func2() {</li><li>    <span class="hljs-keyword">this</span>.getUIContext().animateTo({curve: Curve.Sharp, duration: <span class="hljs-number">1000</span>}, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.color = (<span class="hljs-keyword">this</span>.color === Color.Yellow ? Color.Red : Color.Yellow);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// Animation closure 3, set height variation</span></li><li>  func3() {</li><li>    <span class="hljs-keyword">this</span>.getUIContext().animateTo({curve: Curve.Sharp, duration: <span class="hljs-number">1000</span>}, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.h = (<span class="hljs-keyword">this</span>.h === <span class="hljs-number">2</span> ? <span class="hljs-number">5</span> : <span class="hljs-number">2</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// Animation Closure 4, Set Highlight Variation</span></li><li>  func4() {</li><li>    <span class="hljs-keyword">this</span>.getUIContext().animateTo({curve: Curve.Sharp, duration: <span class="hljs-number">1000</span>}, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.brightNum= (<span class="hljs-keyword">this</span>.brightNum=== <span class="hljs-number">1.5</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">1.5</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>            .brightness(<span class="hljs-keyword">this</span>.brightNum)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>
</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>            .brightness(<span class="hljs-keyword">this</span>.brightNum)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>      }</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>
</li><li>      Column() {</li><li>        Button(<span class="hljs-string">"Tap nFunc"</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          <span class="hljs-comment">// Key Attribute Settings</span></li><li>          .onClick(() =&gt; {</li><li>            <span class="hljs-comment">// Loop animation by play count</span></li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>              setTimeout(() =&gt; {</li><li>                <span class="hljs-keyword">this</span>.func1();</li><li>                <span class="hljs-keyword">this</span>.func2();</li><li>                <span class="hljs-keyword">this</span>.func3();</li><li>                <span class="hljs-keyword">this</span>.func4();</li><li>              }, <span class="hljs-number">1000</span> * i)</li><li>            }</li><li>          })</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/MultipleProperties.ets#L17-L183" target="_blank">MultipleProperties.ets</a></div></div></div></div> </li></ul> <ul><li>将相同动画参数的动画合并在一个动画闭包中，具体代码实现如下：<div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/MultipleProperties.ets#L18-L182" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct MultipleProperties {</li><li>  <span class="hljs-meta">@State</span> w:number = <span class="hljs-number">150</span></li><li>  <span class="hljs-meta">@State</span> h:number = <span class="hljs-number">2</span></li><li>  <span class="hljs-meta">@State</span> brightNum:number = <span class="hljs-number">1.5</span></li><li>  <span class="hljs-meta">@State</span> color:Color = Color.Red</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Unify animation closures while simultaneously setting changes for four properties</span></li><li>  func() {</li><li>    <span class="hljs-keyword">this</span>.getUIContext().animateTo({curve: Curve.Sharp, duration: <span class="hljs-number">1000</span>}, () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.w = (<span class="hljs-keyword">this</span>.w === <span class="hljs-number">80</span> ? <span class="hljs-number">150</span> : <span class="hljs-number">80</span>);</li><li>      <span class="hljs-keyword">this</span>.color = (<span class="hljs-keyword">this</span>.color === Color.Yellow ? Color.Red : Color.Yellow);</li><li>      <span class="hljs-keyword">this</span>.h = (<span class="hljs-keyword">this</span>.h === <span class="hljs-number">2</span> ? <span class="hljs-number">5</span> : <span class="hljs-number">2</span>);</li><li>      <span class="hljs-keyword">this</span>.brightNum= (<span class="hljs-keyword">this</span>.brightNum=== <span class="hljs-number">1.5</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">1.5</span>);</li><li>    });</li><li>  }</li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>            .brightness(<span class="hljs-keyword">this</span>.brightNum)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>
</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>            .brightness(<span class="hljs-keyword">this</span>.brightNum)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>      }</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>
</li><li>      Column() {</li><li>        <span class="hljs-comment">// ...</span></li><li>        Button(<span class="hljs-string">"Tap oneFunc"</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .margin({ top: <span class="hljs-number">12</span> })</li><li>          <span class="hljs-comment">// Key Attribute Settings</span></li><li>          .onClick(() =&gt; {</li><li>            <span class="hljs-comment">// Loop animation by play count</span></li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>              setTimeout(() =&gt; {</li><li>                <span class="hljs-keyword">this</span>.func();</li><li>              }, <span class="hljs-number">1000</span> * i)</li><li>            }</li><li>          })</li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/MultipleProperties.ets#L18-L182" target="_blank">MultipleProperties.ets</a></div></div></div></div> </li></ul> <p><strong>性能分析</strong></p> <p>使用DevEco Studio的Profiler工具检测下述指标，得到的数据如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表4 </b><strong>使用多个animateTo闭包和一个animateTo闭包实现</strong><strong>相同场景</strong><strong>的指标对比</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.14.2.4.1.1" valign="top" width="26.810000000000002%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.15.14.2.4.1.2" valign="top" width="33.56%"><p>多个animateTo闭包</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.14.2.4.1.3" valign="top" width="39.629999999999995%"><p>一个animateTo闭包</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>丢帧率（%）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>9.6%</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>4.0%</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>最大连续丢帧数（帧）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>9</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>4</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="26.810000000000002%"><p>平均1s大卡顿次数（次/s）</p> </td> <td class="cellrowborder" valign="top" width="33.56%"><p>1.01</p> </td> <td class="cellrowborder" valign="top" width="39.629999999999995%"><p>0.24</p> </td> </tr>  </tbody></table></div> </div> <p>分析结论：</p> <p>1）将四个属性变化动画分别放在四个animateTo动画闭包中，丢帧率为9.6%，最多连续丢失9帧，平均每秒发生大卡顿1.01次。</p> <p>2）将四个属性变化动画合入一个animateTo动画闭包中，丢帧率降到了4.0%，最多连续丢失4帧，平均每秒发生大卡顿0.24次。</p> <p>这一结果表明，将多个属性变化动画合并到同一个animateTo动画闭包中能够显著降低丢帧率和大卡顿的发生频率。合并动画操作可以减少不必要的布局计算和绘制开销，从而提升动画的流畅性和性能表现，有助于优化动画效果的性能。</p> </div> <div class="tiledSection"><h3 id="section2396161284213">多次animateTo时统一更新状态变量<i class="anchor-icon anchor-icon-link" anchorid="section2396161284213" tips="复制节点链接"></i></h3><p>使用animateTo方法执行动画时，会对执行动画闭包前后的状态进行对比，然后只对差异部分进行动画处理。</p> <p>在动画执行过程中，脏节点是指在界面上需要进行重新绘制的区域。如果状态发生了变化，ArkUI会跟踪这些变化，并在动画闭包执行前进行状态对比，相关的脏节点会被标记为需要刷新，以便在动画闭包执行前对这些脏节点进行重新绘制。这样，只有发生变化的部分才会被纳入动画处理，而不需要重新绘制整个界面。</p> <p>这种差异对比的方式能够显著减少不必要的绘制操作，提高动画的性能和流畅度。</p> <p><strong>场景设计</strong></p> <p>针对多个相同组件修改多个属性进行动画的场景（如下图所示），分别使用在多个animateTo之间更新状态变量、在animateTo之前显式指定属性初值、在animateTo之前使用原始状态实现。</p> <div class="fignone"><span class="figcap"><b>图13 </b>多个相同组件修改多个属性示意图</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.00935310662254903799013971240534:50001231000000:2800:9E3C92B2C922077A2A25B756DB023A6DBB9D086F70DF15CF74DD4CEFFD0A9498.gif" title="点击放大" width="266"></span></div> <p><strong>在多个animateTo之间更新状态变量</strong></p> <p>如果多个animateTo之间存在状态更新，会导致执行下一个animateTo之前又存在需要更新的脏节点，可能造成冗余更新，其动画更新流程如下图所示：</p> <div class="fignone"><span class="figcap"><b>图14 </b>多个animateTo之间更新状态变量更新流程</span><br><span><img height="68.74271979291854" originheight="116" originwidth="1552" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.98842863588866202739091318645538:50001231000000:2800:4B812E6AD0F96040A2150684CDB1B59088C3C33FC815BC8EE6574CE93B5171E5.png" title="点击放大" width="920"></span></div> <p>在第一个animateTo前，重新设置了w属性，所以Row组件需要更新一次。在第一个animateTo的动画闭包中，改变了w属性，所以Row组件又需要更新一次并对比产生宽高动画。第二个animateTo前，重新设置了color属性，所以Row组件又需要更新一次。在第二个animateTo的动画闭包中，改变了color属性，所以Row组件再更新一次并产生了背景色动画。Row组件总共更新了4次属性。</p> <p>此外还更改了与动画无关的状态h，如果不需要改变无关状态，则不应改变造成冗余更新。</p> <p>其具体代码实现如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L17-L181" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct UpdateMultipleProperties {</li><li>  <span class="hljs-meta">@State</span> w: number = <span class="hljs-number">100</span></li><li>  <span class="hljs-meta">@State</span> h: number = <span class="hljs-number">2</span></li><li>  <span class="hljs-meta">@State</span> color: Color = Color.Red</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>
</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>      }</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>      <span class="hljs-comment">// ...</span></li><li>      Column() {</li><li>        Button(<span class="hljs-string">'Tap1'</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .margin({ top: <span class="hljs-number">12</span> })</li><li>          .onClick(() =&gt; {</li><li>            let doTimes = <span class="hljs-number">5</span>;</li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; doTimes; i++) {</li><li>              setTimeout(() =&gt; {</li><li>                <span class="hljs-keyword">this</span>.w = <span class="hljs-number">80</span></li><li>                <span class="hljs-keyword">this</span>.h = <span class="hljs-number">4</span></li><li>                <span class="hljs-keyword">this</span>.getUIContext().animateTo({ curve: Curve.Sharp, duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.w = (<span class="hljs-keyword">this</span>.w === <span class="hljs-number">80</span> ? <span class="hljs-number">150</span> : <span class="hljs-number">80</span>);</li><li>                });</li><li>                <span class="hljs-comment">// Updating state variables between two animateTo calls</span></li><li>                <span class="hljs-keyword">this</span>.color = Color.Yellow</li><li>                <span class="hljs-keyword">this</span>.getUIContext().animateTo({ curve: Curve.Linear, duration: <span class="hljs-number">2000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.color = (<span class="hljs-keyword">this</span>.color === Color.Yellow ? Color.Red : Color.Yellow);</li><li>                });</li><li>              }, <span class="hljs-number">2000</span> * i)</li><li>            }</li><li>          })</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L17-L181" target="_blank">UpdateMultipleProperties.ets</a></div></div></div></div> <p><strong>统一更新状态变量</strong></p> <ul><li>在animateTo之前显式指定属性初值</li></ul> <p>在animateTo之前显式的指定所有需要动画的属性初值，统一更新到节点中，然后再做动画，其动画更新流程如下图所示：</p> <div class="fignone"><span class="figcap"><b>图15 </b>animateTo之前显式指定属性初值更新流程</span><br><span><img height="75.479362" originheight="116" originwidth="1240" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.08606521430947925563868205963861:50001231000000:2800:EF73EF679E9A649EFE5337ABAEB5A744BDD1D3FA96AE1719B47D94EC05F25A41.png" title="点击放大" width="806.9775000000001"></span></div> <p>在第一个animateTo之前，重新设置了w和color属性，所以Row需要更新一次。在第一个animateTo的动画闭包中，改变了w属性，所以Row组件需要更新一次并对比产生宽高动画。在第二个animateTo之前，由于没有执行额外的语句，不存在需要更新的脏状态变量和脏节点，无需更新。在第二个animateTo的动画闭包中，改变了color属性，所以Row组件再更新一次并产生了背景色动画。Row组件总共更新了3次属性。</p> <p>其具体代码实现如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L18-L182" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export struct UpdateMultipleProperties {</li><li>  <span class="hljs-meta">@State</span> w: number = <span class="hljs-number">100</span></li><li>  <span class="hljs-meta">@State</span> h: number = <span class="hljs-number">2</span></li><li>  <span class="hljs-meta">@State</span> color: Color = Color.Red</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>
</li><li>        Row() {</li><li>          Row()</li><li>            .width(<span class="hljs-keyword">this</span>.w)</li><li>            .backgroundColor(<span class="hljs-keyword">this</span>.color)</li><li>            .height(<span class="hljs-keyword">this</span>.h)</li><li>        }</li><li>        .justifyContent(FlexAlign.Center)</li><li>        .width(<span class="hljs-string">'50%'</span>)</li><li>      }</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>      <span class="hljs-comment">// ...</span></li><li>      Column() {</li><li>        <span class="hljs-comment">// ...</span></li><li>        Button(<span class="hljs-string">'Tap2'</span>)</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .margin({ top: <span class="hljs-number">12</span> })</li><li>          .onClick(() =&gt; {</li><li>            let doTimes = <span class="hljs-number">5</span>;</li><li>            <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; doTimes; i++) {</li><li>              setTimeout(() =&gt; {</li><li>                <span class="hljs-comment">// Explicitly specify the initial values of all properties to be animated before the animation.</span></li><li>                <span class="hljs-keyword">this</span>.w = <span class="hljs-number">80</span></li><li>                <span class="hljs-keyword">this</span>.color = Color.Yellow</li><li>                <span class="hljs-keyword">this</span>.getUIContext().animateTo({ curve: Curve.Sharp, duration: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.w = (<span class="hljs-keyword">this</span>.w === <span class="hljs-number">80</span> ? <span class="hljs-number">150</span> : <span class="hljs-number">80</span>);</li><li>                });</li><li>                <span class="hljs-keyword">this</span>.getUIContext().animateTo({ curve: Curve.Linear, duration: <span class="hljs-number">2000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.color = (<span class="hljs-keyword">this</span>.color === Color.Yellow ? Color.Red : Color.Yellow);</li><li>                });</li><li>                <span class="hljs-comment">// Refresh non-animated properties after animation completes</span></li><li>                <span class="hljs-keyword">this</span>.h = <span class="hljs-number">5</span></li><li>              }, <span class="hljs-number">2000</span> * i)</li><li>            }</li><li>          })</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .justifyContent(FlexAlign.End)</li><li>      .height(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .padding({</li><li>      left: <span class="hljs-number">16</span>,</li><li>      right: <span class="hljs-number">16</span>,</li><li>      bottom: <span class="hljs-number">16</span></li><li>    })</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Start)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L18-L182" target="_blank">UpdateMultipleProperties.ets</a></div></div></div></div> <ul><li>在animateTo之前使用原始状态</li></ul> <p>在animateTo之前使用原始状态，让动画从原始状态过渡到指定状态，其动画更新流程如下图所示：</p> <div class="fignone"><span class="figcap"><b>图16 </b>animateTo之前使用原始状态更新流程</span><br><span><img height="82.7925" originheight="148" originwidth="928" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.04936113852946088446077157083632:50001231000000:2800:5170A7EE006785A59269BC5C36015B196531F808E1BA19FD98003B263E86CBF4.png" title="点击放大" width="523.6875"></span></div> <p>在第一个animateTo之前，不存在需要更新的脏状态变量和脏节点，无需更新。在第一个animateTo的动画闭包中，改变了w属性，所以Row组件需要更新一次并对比产生宽高动画。在第二个animateTo之前，由于也没有执行额外的语句，不存在需要更新的脏状态变量和脏节点，无需更新。在第二个animateTo的动画闭包中，改变了color属性，所以Row组件再更新一次并产生了背景色动画。Row组件总共更新了2次属性。</p> <p>其具体代码实现如下：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L19-L183" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">UpdateMultipleProperties</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">w</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">100</span></li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">h</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">2</span></li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">color</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Row</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">w</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">color</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">h</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>
</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Row</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">w</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">color</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">h</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Center</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>
</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'Tap3'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-variable">doTimes</span> = <span class="hljs-number">5</span>;</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">doTimes</span>; <span class="hljs-title class_">i</span>++) {</li><li>              <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Sharp</span>, <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.<span class="hljs-variable">w</span> = (<span class="hljs-keyword">this</span>.<span class="hljs-variable">w</span> === <span class="hljs-number">80</span> ? <span class="hljs-number">150</span> : <span class="hljs-number">80</span>);</li><li>                });</li><li>                <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Linear</span>, <span class="hljs-variable">duration</span>: <span class="hljs-number">2000</span> }, () =&gt; {</li><li>                  <span class="hljs-keyword">this</span>.<span class="hljs-variable">color</span> = (<span class="hljs-keyword">this</span>.<span class="hljs-variable">color</span> === <span class="hljs-variable">Color</span>.<span class="hljs-variable">Yellow</span> ? <span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Yellow</span>);</li><li>                });</li><li>              }, <span class="hljs-number">2000</span> * <span class="hljs-variable">i</span>)</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">End</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-number">16</span></li><li>    })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/UpdateMultipleProperties.ets#L19-L183" target="_blank">UpdateMultipleProperties.ets</a></div></div></div></div> <p><strong>性能分析</strong></p> <p>使用DevEco Studio的Profiler工具检测下述指标，得到的数据如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表5 </b><strong>状态变量更新位置不同的指标对比</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.16.30.2.5.1.1" valign="top" width="20.86%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.16.30.2.5.1.2" valign="top" width="22.21%"><p>在多个animateTo之间更新状态变量</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.30.2.5.1.3" valign="top" width="26.1%"><p>在animateTo之前显式指定属性初值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.30.2.5.1.4" valign="top" width="30.830000000000002%"><p>在animateTo之前使用原始状态</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20.86%"><p>丢帧率（%）</p> </td> <td class="cellrowborder" valign="top" width="22.21%"><p>9.1%</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>5.4%</p> </td> <td class="cellrowborder" valign="top" width="30.830000000000002%"><p>3.5%</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.86%"><p>最大连续丢帧数（帧）</p> </td> <td class="cellrowborder" valign="top" width="22.21%"><p>15</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>10</p> </td> <td class="cellrowborder" valign="top" width="30.830000000000002%"><p>5</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.86%"><p>平均1s大卡顿次数（次/s）</p> </td> <td class="cellrowborder" valign="top" width="22.21%"><p>0.67</p> </td> <td class="cellrowborder" valign="top" width="26.1%"><p>0.23</p> </td> <td class="cellrowborder" valign="top" width="30.830000000000002%"><p>0.10</p> </td> </tr>  </tbody></table></div> </div> <p>分析结论：</p> <p>1）在多个animateTo之间更新状态变量时，丢帧率高达9.1%，最大连续丢失15帧，平均每秒发生大卡顿0.67次。</p> <p>2）在animateTo之前显式指定属性初值时，丢帧率降到了5.4%，最多连续丢失10帧，平均每秒发生大卡顿0.23次。</p> <p>3）在animateTo之前使用原始状态时，丢帧率降到了3.5%，最多连续丢失5帧，平均每秒发生大卡顿0.10次。</p> <p>在进行属性变化动画时，显式指定属性初值或者使用原始状态作为动画的起始状态能够显著降低丢帧率和大卡顿的发生频率。因此，在进行动画操作时，合理管理状态变量的更新和初始值设定对于优化动画效果的性能至关重要，开发者应根据需要，尽可能地避免在多个animateTo之间更新状态变量，从而提升动画的流畅性和性能表现。</p> </div> <div class="tiledSection"><h3 id="section1223162922415">使用renderGroup<i class="anchor-icon anchor-icon-link" anchorid="section1223162922415" tips="复制节点链接"></i></h3><p>renderGroup是组件通用方法，它代表了渲染绘制的一个组合。其核心功能就是标记组件，在绘制阶段将组件和其子组件的绘制结果进行合并并缓存，以达到复用的效果，从而降低绘制负载。</p> <p>首次绘制组件时，若组件被标记为启用renderGroup状态，将对组件和其子组件进行离屏绘制，将绘制结果进行缓存。此后当需要重新绘制组件时，就会优先使用缓存而不必重新绘制，从而降低绘制负载，优化渲染性能。组件渲染流程图如下所示：</p> <div class="fignone"><span class="figcap"><b>图17 </b>组件渲染流程图</span><br><span><img height="243.39000000000001" originheight="624" originwidth="1339" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.84594042173715562984250938539109:50001231000000:2800:87F7BB096F696D9887E1D751E41F0FEB392E90858276F446ECFD431E591E1761.png" title="点击放大" width="523.6875"></span></div> <p>在进行缓存更新时，需要满足以下三个条件：</p> <ul><li>组件在当前组件树上。</li><li>组件renderGroup被标记为true。</li><li>组件内容被标脏。</li></ul> <p>在进行缓存清理时，需要满足以下任意条件：</p> <ul><li>组件不存在于组件树上。</li><li>组件renderGroup被标记为false。</li></ul> <p>具体缓存管理流程图如下所示：</p> <p><span><img height="169.57500000000002" originheight="467" originwidth="1442" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.73099049912491626815152733215304:50001231000000:2800:CD6992A76D512F4999E0D2D639EC777F2BAEB658CD03BE158ECDE43FD85E307A.png" title="点击放大" width="523.6875"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>为了能使renderGroup功能生效，组件存在以下约束。</p> <ul><li>组件内容固定不变：父组件和其子组件各属性保持固定，不发生变化。如果父组件内容不是固定的，也就是说其子组件中上存在某些属性变化或者样式变化的组件，此时如果使用renderGroup，那么缓存的利用率将大大下降，并且有可能需要不断执行缓存更新逻辑，在这种情况下，不仅不能优化卡顿效果，甚至还可能使卡顿恶化。例如：文本内容使用双向绑定的动态数据；图片资源使用gif格式；使用video组件播放视频。</li><li>子组件无动效：由父组件统一应用动效，其子组件均无动效。如果子组件上也应用动效，那么子组件相对父组件就不再是静止的，每一帧都有可能需要更新缓存，更新逻辑同样需要消耗系统资源。</li></ul> </div></div></div> <p><strong>场景设计</strong></p> <p>此案例在同一个页面下使用了固定的图片和文本内容，并且每个组件统一使用旋转和缩放的动效，并且重复使用了60个这样的组件。</p> <div class="fignone"><span class="figcap"><b>图18 </b>renderGroup案例实现图</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162947.43271892823236284938403221292213:50001231000000:2800:D4735E09B518EBE58019EEE803AD5DD1E9F83D348CCE3B1B87CC1C2129223C54.gif" title="点击放大" width="266"></span></div> <p><strong>代码实现</strong></p> <p>实现页面中需要使用的组件，并设置renderGroup属性，用@StorageLink修饰绑定renderGroupFlag标识。renderGroup属性的设置要满足父组件统一应用动效，子组件无动效，所以，动效在父组件上统一实现，未在IconItem上设置动效。在Flex组件中，Image和Text都无动效设置，所以在最外层Flex上设置renderGroup属性即可。</p> <p>具体代码如下所示：</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/IconItem.ets#L17-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export  struct IconItem {</li><li>  <span class="hljs-keyword">@StorageLink</span>(<span class="hljs-string">'renderGroupFlag'</span>) <span class="hljs-attribute">renderGroupFlag</span>: boolean = false;</li><li>  image: string | Resource = <span class="hljs-string">''</span>;</li><li>  text: string | Resource = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-attribute">Flex</span>({</li><li>      direction: FlexDirection.Column,</li><li>      justifyContent: FlexAlign.Center,</li><li>      alignContent: FlexAlign.Center</li><li>    }) {</li><li>      <span class="hljs-built_in">Image</span>(this.image)</li><li>        <span class="hljs-selector-class">.height</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)</li><li>        <span class="hljs-selector-class">.margin</span>({ left: <span class="hljs-number">15</span> })</li><li>
</li><li>      Text(this.text)</li><li>        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">10</span>)</li><li>        <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">182431</span>')</li><li>        <span class="hljs-selector-class">.margin</span>({ top: <span class="hljs-number">5</span> })</li><li>        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">50</span>)</li><li>        <span class="hljs-selector-class">.opacity</span>(<span class="hljs-number">0.8</span>)</li><li>        <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>    }</li><li>    <span class="hljs-selector-class">.backgroundColor</span>('#e3e3e3')</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-number">50</span>)</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-number">50</span>)</li><li>    <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">25</span>)</li><li>    <span class="hljs-comment">// Call renderGroup within IconItem, false to disable, true to enable.</span></li><li>    <span class="hljs-selector-class">.renderGroup</span>(this.renderGroupFlag)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/IconItem.ets#L17-L50" target="_blank">IconItem.ets</a></div></div></div></div> <p>实现展示的页面，将控制renderGroup的标识renderGroupFlag通过APPStorage进行存储。</p> <div class="screenLinkPre"><div _ngcontent-igi-c106="" class="highlight-div"><div _ngcontent-igi-c106="" class="highlight-div-header"><div _ngcontent-igi-c106="" class="highlight-div-header-left"><div _ngcontent-igi-c106="" class="handle-button expand-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-igi-c106="" class="highlight-div-header-right"><div _ngcontent-igi-c106="" class="handle-button ai-button"></div><div _ngcontent-igi-c106="" class="handle-button line-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-igi-c106="" class="handle-button theme-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-igi-c106="" class="handle-button copy-button"><div _ngcontent-igi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-igi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/RenderGroup.ets#L17-L108" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">IconItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./IconItem'</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">IconItemSource</span> {</li><li>  <span class="hljs-variable">image</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">Resource</span> = <span class="hljs-string">''</span></li><li>  <span class="hljs-variable">text</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">Resource</span> = <span class="hljs-string">''</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-variable">image</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">Resource</span> = <span class="hljs-string">''</span>, <span class="hljs-variable">text</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">Resource</span> = <span class="hljs-string">''</span>) {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">image</span> = <span class="hljs-variable">image</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">text</span> = <span class="hljs-variable">text</span>;</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RenderGroup</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">renderGroupFlag</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">iconItemSourceList</span>: <span class="hljs-title class_">IconItemSource</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>() {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">index</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">index</span> &lt; <span class="hljs-number">20</span>; <span class="hljs-title class_">index</span>++) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">numStart</span>: <span class="hljs-title class_">number</span> = <span class="hljs-variable">index</span> * <span class="hljs-number">3</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">iconItemSourceList</span>.<span class="hljs-title function_">push</span>(</li><li>        <span class="hljs-variable">new</span> <span class="hljs-title function_">IconItemSource</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.app_icon'</span>), `<span class="hljs-variable">item</span>${<span class="hljs-variable">numStart</span> + <span class="hljs-number">1</span>}`),</li><li>        <span class="hljs-variable">new</span> <span class="hljs-title function_">IconItemSource</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.app_icon'</span>), `<span class="hljs-variable">item</span>${<span class="hljs-variable">numStart</span> + <span class="hljs-number">2</span>}`),</li><li>        <span class="hljs-variable">new</span> <span class="hljs-title function_">IconItemSource</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.app_icon'</span>), `<span class="hljs-variable">item</span>${<span class="hljs-variable">numStart</span> + <span class="hljs-number">3</span>}`),</li><li>      );</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Text</span>(<span class="hljs-string">'Example'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)</li><li>            .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">24</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Black</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-variable">FontWeight</span>.<span class="hljs-variable">Bold</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">left</span>: <span class="hljs-number">30</span> })</li><li>        }</li><li>
</li><li>        <span class="hljs-comment">// Dynamic switching of renderGroup functionality</span></li><li>        <span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">End</span> }) {</li><li>          <span class="hljs-title function_">Button</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">renderGroupFlag</span> ? <span class="hljs-string">'renderGroup On'</span> : <span class="hljs-string">'renderGroup Off'</span>, {</li><li>            <span class="hljs-keyword">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-title class_">Normal</span>,</li><li>            <span class="hljs-variable">stateEffect</span>: <span class="hljs-keyword">true</span></li><li>          })</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">150</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">right</span>: <span class="hljs-number">30</span> })</li><li>            .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">renderGroupFlag</span> = !<span class="hljs-keyword">this</span>.<span class="hljs-variable">renderGroupFlag</span>;</li><li>              <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'renderGroupFlag'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">renderGroupFlag</span>)</li><li>            })</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">56</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">SpaceBetween</span>)</li><li>
</li><li>      <span class="hljs-title function_">GridRow</span>({</li><li>        <span class="hljs-variable">columns</span>: <span class="hljs-number">6</span>,</li><li>        <span class="hljs-variable">gutter</span>: { <span class="hljs-variable">x</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">0</span> },</li><li>        <span class="hljs-variable">breakpoints</span>: {</li><li>          <span class="hljs-variable">value</span>: [<span class="hljs-string">'400vp'</span>, <span class="hljs-string">'600vp'</span>, <span class="hljs-string">'800vp'</span>],</li><li>          <span class="hljs-variable">reference</span>: <span class="hljs-title class_">BreakpointsReference</span>.<span class="hljs-title class_">WindowSize</span></li><li>        },</li><li>        <span class="hljs-variable">direction</span>: <span class="hljs-title class_">GridRowDirection</span>.<span class="hljs-title class_">Row</span></li><li>      }) {</li><li>        <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">iconItemSourceList</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">IconItemSource</span>) =&gt; {</li><li>          <span class="hljs-title function_">GridCol</span>() {</li><li>            <span class="hljs-title function_">IconItem</span>({ <span class="hljs-variable">image</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">image</span>, <span class="hljs-variable">text</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">text</span> })</li><li>              .<span class="hljs-title function_">transition</span>(</li><li>                <span class="hljs-variable">TransitionEffect</span>.<span class="hljs-title function_">scale</span>({ <span class="hljs-variable">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-variable">y</span>: <span class="hljs-number">0.5</span> })</li><li>                  .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">3000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">FastOutSlowIn</span>, <span class="hljs-variable">iterations</span>: -<span class="hljs-number">1</span> })</li><li>                  .<span class="hljs-title function_">combine</span>(<span class="hljs-variable">TransitionEffect</span>.<span class="hljs-title function_">rotate</span>({ <span class="hljs-variable">z</span>: <span class="hljs-number">1</span>, <span class="hljs-variable">angle</span>: <span class="hljs-number">360</span> })</li><li>                    .<span class="hljs-title function_">animation</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">3000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">Linear</span>, <span class="hljs-variable">iterations</span>: -<span class="hljs-number">1</span> }))</li><li>              )</li><li>          }</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">70</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'25%'</span>)</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/animation/entry/src/main/ets/pages/RenderGroup.ets#L17-L108" target="_blank">RenderGroup.ets</a></div></div></div></div> <p><strong>性能分析</strong></p> <p>使用DevEco Studio的Profiler工具检测下述指标，得到的数据如下所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表6 </b>未开启renderGroup、开启renderGroup相同场景的指标对比</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.23.2.4.1.1" valign="top" width="33.33333333333333%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.17.23.2.4.1.2" valign="top" width="33.33333333333333%"><p>未开启renderGroup</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.23.2.4.1.3" valign="top" width="33.33333333333333%"><p>开启renderGroup</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>丢帧率（%）</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>52.3%</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>0%</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>最大连续丢帧数（帧）</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>36</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>0</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>平均1s大卡顿次数（次/s）</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>2.3</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>0</p> </td> </tr>  </tbody></table></div> </div> <p>分析结论：</p> <p>1）未开启renderGroup时，在render_service侧的丢帧率为52.3%，最多连续丢失36帧，平均每秒发生大卡顿2.3次。</p> <p>2）开启renderGroup时，既没有发生卡顿，也没有发生丢帧的情况，其丢帧率为0%。</p> <p>这一结果表明，在满足上述的约束后，使用renderGroup时，能够显著降低丢帧率、最大连续丢帧数和平均1s大卡顿次数。因此，在单一页面上存在大量应用动效的组件，且组件和其子组件各属性保持固定、组件统一应用动效时，开发者可以使用renderGroup来提升应用的性能，保证应用及动画的流畅性。</p> </div> <div class="tiledSection"><h3 id="section22451324517">提升动画运行流畅度总结<i class="anchor-icon anchor-icon-link" anchorid="section22451324517" tips="复制节点链接"></i></h3><p>本文通过5个测试验证了使用系统提供的动画接口、使用图形变换属性变化组件布局、参数相同时使用同一个animateTo、多次animateTo时统一更新状态变量、使用renderGroup这五项措施的有效性。</p> <p>动画的性能表现对于用户体验、设备资源消耗、应用稳定性和流量消耗等方面都具有重要意义：</p> <ul><li>用户体验：流畅的动画能够提升用户体验，使用户感到界面更加生动和直观。相反，卡顿或者延迟的动画会带来不良的体验。</li><li>设备资源消耗：动画的性能表现会直接影响设备的资源消耗，尤其是CPU和GPU的占用。低性能的动画可能导致设备发热、耗电量增加，甚至影响其他应用的运行。</li><li>应用稳定性：性能较差的动画可能会导致应用崩溃或者卡顿，影响应用的稳定性和可靠性。</li><li>节省流量：高性能的动画可以减少数据传输量，对于移动应用来说，这意味着可以节省用户的流量消耗。</li><li>适应不同设备：不同设备的性能差异很大，提升动画性能可以使应用在各种设备上都能够流畅运行。</li></ul> <p>在实际开发中，开发人员可以结合本文提出的四项措施，并根据具体场景和需求进行优化，从而达到更好的动画性能表现。</p> </div> <div class="tiledSection"><h2 id="section487383864512">合理使用动画总结<i class="anchor-icon anchor-icon-link" anchorid="section487383864512" tips="复制节点链接"></i></h2><p>在实际开发过程中，开发者应该充分认识到动画对用户体验的重要性。动画不仅可以增强应用的吸引力，还能够提升用户的参与感和操作的直观性。</p> <p>本文通过两个角度介绍了如何合理使用动画：</p> <ul><li>提升动画感知流畅度：首先，从UX设计视角出发，开发者需要理解动画在用户体验中的作用和意义。其次，开发者需要具备一定的动画实现技术，能够根据设计需求，合理、高效地使用动画能力实现各类动画效果。</li><li>提升动画运行流畅度：为了进一步提升动画性能，开发者还需要采取一些措施。例如，可以通过使用系统提供的动画接口、使用图形变换属性变化组件布局、参数相同时使用同一个animateTo、多次animateTo时统一更新状态变量等方式，有效减少动画对系统资源的占用，提升动画的流畅度和稳定性。</li></ul> <p>总之，合理使用动画对于提升用户体验至关重要。开发者需要从UX设计视角转换为开发实现视角，充分认识动画在用户体验中的作用和意义，并通过合理的实现和性能优化来提升动画的效果和稳定性。</p> </div> </div></div>