<h1 _ngcontent-fuq-c119="" class="doc-title ng-star-inserted" title="后台上传下载合理使用"> 后台上传下载合理使用 </h1>

<div _ngcontent-fuq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>应用上传下载时，应使用系统服务，不要申请长时任务。</p> <div class="tiledSection"><h2 id="section1883119316220">约束<i class="anchor-icon anchor-icon-link" anchorid="section1883119316220" tips="复制节点链接"></i></h2><p>NA</p> </div> <div class="tiledSection"><h2 id="section665511312213">示例<i class="anchor-icon anchor-icon-link" anchorid="section665511312213" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section19282032979" class="firsth2">上传<i class="anchor-icon anchor-icon-link" anchorid="section19282032979" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-fuq-c106="" class="highlight-div"><div _ngcontent-fuq-c106="" class="highlight-div-header"><div _ngcontent-fuq-c106="" class="highlight-div-header-left"><div _ngcontent-fuq-c106="" class="handle-button expand-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fuq-c106="" class="highlight-div-header-right"><div _ngcontent-fuq-c106="" class="handle-button ai-button"></div><div _ngcontent-fuq-c106="" class="handle-button line-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fuq-c106="" class="handle-button theme-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fuq-c106="" class="handle-button copy-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fuq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Upload.ets#L21-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span>, <span class="hljs-variable">request</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'uiContext'</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">context</span> = <span class="hljs-variable">uiContext</span>!.<span class="hljs-title function_">getHostContext</span>()!;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">uploadTask</span>: <span class="hljs-title class_">request</span>.<span class="hljs-title class_">UploadTask</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">uploadConfig</span>: <span class="hljs-title class_">request</span>.<span class="hljs-title class_">UploadConfig</span> = {</li><li>  <span class="hljs-variable">url</span>: <span class="hljs-string">'http://www.example.com'</span>, <span class="hljs-comment">//Replace the IP address of the real server manually</span></li><li>  <span class="hljs-variable">header</span>: { <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'*/*'</span> },</li><li>  <span class="hljs-variable">method</span>: <span class="hljs-string">"POST"</span>,</li><li>  <span class="hljs-variable">files</span>: [{</li><li>    <span class="hljs-variable">filename</span>: <span class="hljs-string">"test"</span>,</li><li>    <span class="hljs-variable">name</span>: <span class="hljs-string">"test"</span>,</li><li>    <span class="hljs-variable">uri</span>: <span class="hljs-string">"internal://cache/test.jpg"</span>,</li><li>    <span class="hljs-keyword">type</span>: <span class="hljs-string">"jpg"</span></li><li>  }],</li><li>  <span class="hljs-variable">data</span>: [{ <span class="hljs-variable">name</span>: <span class="hljs-string">"name123"</span>, <span class="hljs-variable">value</span>: <span class="hljs-string">"123"</span> }],</li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">//Upload request</span></li><li>  <span class="hljs-variable">request</span>.<span class="hljs-title function_">uploadFile</span>(<span class="hljs-variable">context</span>, <span class="hljs-variable">uploadConfig</span>, (<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">request</span>.<span class="hljs-title class_">UploadTask</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failedtorequesttheupload</span>.<span class="hljs-variable">Code</span>:${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>},<span class="hljs-variable">message</span>:${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable">uploadTask</span> = <span class="hljs-variable">data</span>;</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>  <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failedtorequesttheupload</span>.<span class="hljs-variable">err</span>:${<span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">err</span>)}`);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Upload.ets#L21-L50" target="_blank">Upload.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section176268462714">下载<i class="anchor-icon anchor-icon-link" anchorid="section176268462714" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-fuq-c106="" class="highlight-div"><div _ngcontent-fuq-c106="" class="highlight-div-header"><div _ngcontent-fuq-c106="" class="highlight-div-header-left"><div _ngcontent-fuq-c106="" class="handle-button expand-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fuq-c106="" class="highlight-div-header-right"><div _ngcontent-fuq-c106="" class="handle-button ai-button"></div><div _ngcontent-fuq-c106="" class="handle-button line-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fuq-c106="" class="handle-button theme-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fuq-c106="" class="handle-button copy-button"><div _ngcontent-fuq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fuq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Download.ets#L21-L49" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      request.<span class="hljs-title function_">downloadFile</span>(context, {</li><li>        <span class="hljs-attr">url</span>: <span class="hljs-string">'https://xxxx/xxxxx.hap'</span>, <span class="hljs-comment">// IP address of the server to download the file</span></li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">'xxx/xxxxx.hap'</span></li><li>      }, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: request.DownloadTask</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (err) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failedtorequestthedownload.Code:<span class="hljs-subst">${err.code}</span>,message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">downloadTask</span>: request.<span class="hljs-property">DownloadTask</span> = data;</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failedtorequestthedownload.err:<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>    }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Download.ets#L21-L49" target="_blank">Download.ets</a></div></div></div></div> </div> <p>有关上传下载相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file-upload-download" target="_blank">应用文件上传下载</a>。</p> </div> <div></div></div>