<h1 _ngcontent-rsd-c119="" class="doc-title ng-star-inserted" title="后台系统资源合理使用"> 后台系统资源合理使用 </h1>

<div _ngcontent-rsd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>无长时任务的应用退至后台后，应释放对应资源，避免阻止系统休眠。</p> <div class="tiledSection"><h2 id="section199262471112">约束<i class="anchor-icon anchor-icon-link" anchorid="section199262471112" tips="复制节点链接"></i></h2><p>接口runningLock.create的type参数BACKGROUND类型已废弃，不建议使用。如果确实需要使用，后台运行时必须主动释放锁。</p> </div> <div class="tiledSection"><h2 id="section201332701114">示例<i class="anchor-icon anchor-icon-link" anchorid="section201332701114" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section161618519147" class="firsth2">应用直接持锁<i class="anchor-icon anchor-icon-link" anchorid="section161618519147" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-rsd-c106="" class="highlight-div"><div _ngcontent-rsd-c106="" class="highlight-div-header"><div _ngcontent-rsd-c106="" class="highlight-div-header-left"><div _ngcontent-rsd-c106="" class="handle-button expand-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rsd-c106="" class="highlight-div-header-right"><div _ngcontent-rsd-c106="" class="handle-button ai-button"></div><div _ngcontent-rsd-c106="" class="handle-button line-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rsd-c106="" class="handle-button theme-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rsd-c106="" class="handle-button copy-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rsd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/LockByApplication.ets#L21-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { runningLock } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Return to the background to release the lock</span></li><li>runningLock.<span class="hljs-title function_">create</span>(<span class="hljs-string">'running_lock_test'</span>, runningLock.<span class="hljs-property">RunningLockType</span>.<span class="hljs-property">BACKGROUND</span>)</li><li>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">lock: runningLock.RunningLock</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      lock.<span class="hljs-title function_">unhold</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`setColorMode failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  })</li><li>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'create running lock failed, err: '</span> + err);</li><li>  });</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/LockByApplication.ets#L21-L37" target="_blank">LockByApplication.ets</a></div></div></div></div> </div> <p>有关RunningLock开发相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-runninglock" target="_blank">RunningLock锁</a>。</p> <div class="tiledSection"><h3 id="section05147472145">系统帮助应用持锁<i class="anchor-icon anchor-icon-link" anchorid="section05147472145" tips="复制节点链接"></i></h3><p>使用音频资源时，系统会为应用持锁。如果不释放音频资源，会导致系统持锁不释放。因此，应用在后台应主动释放音频资源。</p> <p>可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-reasonable-audio-use" target="_blank">合理使用音频资源</a>。</p> <div class="screenLinkPre"><div _ngcontent-rsd-c106="" class="highlight-div"><div _ngcontent-rsd-c106="" class="highlight-div-header"><div _ngcontent-rsd-c106="" class="highlight-div-header-left"><div _ngcontent-rsd-c106="" class="handle-button expand-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rsd-c106="" class="highlight-div-header-right"><div _ngcontent-rsd-c106="" class="handle-button ai-button"></div><div _ngcontent-rsd-c106="" class="handle-button line-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rsd-c106="" class="handle-button theme-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rsd-c106="" class="handle-button copy-button"><div _ngcontent-rsd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rsd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/LockBySystem.ets#L22-L65" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">//Apply for the resources required by the system, or reapply for the resources released in onBackground ()</span></li><li>    audio.<span class="hljs-title function_">createAudioRenderer</span>(audioRendererOptions,<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {});</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-comment">//Release resources when the UI is invisible</span></li><li>    audioRenderer.<span class="hljs-title function_">stop</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {});</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/LockBySystem.ets#L22-L65" target="_blank">LockBySystem.ets</a></div></div></div></div> </div> </div> <div></div></div>