<h1 _ngcontent-ind-c119="" class="doc-title ng-star-inserted" title="后台音频播放合理使用"> 后台音频播放合理使用 </h1>

<div _ngcontent-ind-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>申请音频播放长时任务的应用退到后台后，禁止不写入数据或写入静音数据等恶意行为。</p> <div class="tiledSection"><h2 id="section1021134513152">约束<i class="anchor-icon anchor-icon-link" anchorid="section1021134513152" tips="复制节点链接"></i></h2><p>系统检测到应用后台行为时，将挂起或清理应用。</p> </div> <div class="tiledSection"><h2 id="section1064810451181">示例<i class="anchor-icon anchor-icon-link" anchorid="section1064810451181" tips="复制节点链接"></i></h2><div class="screenLinkPre"><div _ngcontent-ind-c106="" class="highlight-div"><div _ngcontent-ind-c106="" class="highlight-div-header"><div _ngcontent-ind-c106="" class="highlight-div-header-left"><div _ngcontent-ind-c106="" class="handle-button expand-button"><div _ngcontent-ind-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ind-c106="" class="highlight-div-header-right"><div _ngcontent-ind-c106="" class="handle-button ai-button"></div><div _ngcontent-ind-c106="" class="handle-button line-button"><div _ngcontent-ind-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ind-c106="" class="handle-button theme-button"><div _ngcontent-ind-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ind-c106="" class="handle-button copy-button"><div _ngcontent-ind-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ind-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Audio.ets#L21-L71" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'uiContext'</span>);</li><li><span class="hljs-keyword">let</span> context = uiContext!.<span class="hljs-title function_">getHostContext</span>()!;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">read</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">bufferSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-keyword">await</span> audioRenderer.<span class="hljs-title function_">getBufferSize</span>();</li><li>  <span class="hljs-keyword">let</span> path = context.<span class="hljs-property">filesDir</span>; <span class="hljs-comment">// Path of the file</span></li><li>
</li><li>  <span class="hljs-keyword">const</span> filePath = path + <span class="hljs-string">'/voice_call_data.wav'</span>; <span class="hljs-comment">// Prohibit the file from being played silently</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>); <span class="hljs-comment">// Open the file</span></li><li>    <span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(bufferSize);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">readSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">read</span>(file.<span class="hljs-property">fd</span>, buf); <span class="hljs-comment">// Read the file content</span></li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`openSync or read failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/BptaUseSoftware/entry/src/main/ets/pages/Audio.ets#L21-L71" target="_blank">Audio.ets</a></div></div></div></div> <p>有关AudioRenderer开发相关接口的使用，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback" target="_blank">使用AudioRenderer开发音频播放功能</a>。</p> </div> </div> <div></div></div>