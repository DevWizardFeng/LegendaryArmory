<h1 _ngcontent-ykq-c119="" class="doc-title ng-star-inserted" title="图像模糊动效优化"> 图像模糊动效优化 </h1>

<div _ngcontent-ykq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section4652132214525">概述<i class="anchor-icon anchor-icon-link" anchorid="section4652132214525" tips="复制节点链接"></i></h2><p>模糊效果是一种常见的图像处理技术，它通过弱化图像细节来突出主体，使焦点更加鲜明。如下图所示，模糊效果不仅能增强界面空间感，还能清晰区分元素层级。当这一效果融入动态变化，便催生了模糊动效。模糊动效被广泛应用于页面转场、图像元素缩放等需要突出内容或改变用户关注点的场景中。</p> <p><span><img originheight="464" originwidth="500" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163049.15995907582911081901500246608269:50001231000000:2800:0C63EBEA3B57643D77D72422302F09A5F1EAB0A82239E8974D16CD10809AA94F.png" width="500" height="464"></span></p> <p>由于模糊算法需要进行精细地像素级处理，因而在组件需要实时渲染时，这要求在极短的周期内完成模糊化处理。尤其是在组件同时执行动画渲染任务时，则会进一步加剧计算资源的消耗，容易导致模糊效果处理时间不足，无法按时完成模糊动效，最终引发卡顿、丢帧等不良现象。</p> <p>因此，随着应用的广泛普及，模糊动效的性能优化愈发显得至关重要。鉴于系统为开发者提供的静态模糊和动态模糊两种动效能力，本文将在“转场结合图片模糊”的应用场景下，对静态模糊与动态模糊的性能进行差异性对比。同时，建议开发者在组件背景和内容无需实时更新的场景中，优先使用静态模糊，可以减少应用卡顿与丢帧，提升用户体验。</p> </div> <div class="tiledSection"><h2 id="section4945532519">使用场景<i class="anchor-icon anchor-icon-link" anchorid="section4945532519" tips="复制节点链接"></i></h2><p>在介绍静态模糊和动态模糊之前，需要说明静态模糊和动态模糊的区别在于要模糊的内容是不是动态更新的，如对视频做模糊就是动态模糊，对图片做模糊就是静态模糊。</p> <ul><li><strong>静态模糊</strong>：静态模糊是指对输入的静态内容进行模糊处理并获取一张模糊后的图像的模糊。适用于需要为静态图像提供模糊化效果的场景。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-effectkit" target="_blank">Effect Kit</a>在Filter图像效果类中提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-effectkit#blur" target="_blank">blur</a>接口，可用于定义模糊半径，数值越大模糊效果越明显。</li></ul> <ul><li><strong>动态模糊</strong>：动态模糊是指模糊效果会随着每帧模糊内容和模糊半径的变化，进行实时变化的模糊。适用于模糊内容需要实时刷新和更改的场景。系统针对组件内容、背景的动态模糊提供了两种实现动态模糊的方法：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-background#backgroundblurstyle9" target="_blank">backgroundBlurStyle</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-foreground-blur-style#foregroundblurstyle" target="_blank">foregroundBlurStyle</a>。这两个方法不能指定模糊半径、提亮、饱和度、蒙版颜色等具体参数，只能调用底层将这些参数封装好的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-background#blurstyle9" target="_blank">模糊样式</a>来实现不同风格的模糊效果。同时系统也为开发者提供了能够自定义参数的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-background#backgroundeffect11" target="_blank">backgroundEffect</a>，可以对组件背景实现自定义模糊动效。如果只需要对组件进行简单的模糊处理，系统还提供了与静态模糊类似的简单方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-image-effect#blur" target="_blank">blur</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-background#backdropblur" target="_blank">backdropBlur</a>，只需要定义模糊半径即可。</li></ul> </div> <div class="tiledSection"><h2 id="section12935191712615">场景示例<i class="anchor-icon anchor-icon-link" anchorid="section12935191712615" tips="复制节点链接"></i></h2><p>下面将在常见的“转场结合图片模糊”的应用场景下（全屏模态转场拉起一个图片设置模糊的模态页面），分别采用动态模糊和静态模糊，进行性能分析对比。需要说明，由于静态模糊和动态模糊底层采用的算法不同，动态模糊blur和静态模糊blur设置的模糊半径数值并不等效。为了从效果一致性的维度来更准确的比较两者的性能差异，这里将动态模糊和静态模糊场景的模糊半径的数值尽可能的调整到类似的模糊效果来进行对比。动态模糊blur设置13，静态模糊blur设置3的图片模糊效果较为接近，作为本例中效果一致性较为近似的等效条件。</p> <p>下面是使用动态模糊对图片进行模糊处理的场景示例。通过直接对Image组件设置blur，为Image添加模糊效果。</p> <div class="screenLinkPre"><div _ngcontent-ykq-c106="" class="highlight-div"><div _ngcontent-ykq-c106="" class="highlight-div-header"><div _ngcontent-ykq-c106="" class="highlight-div-header-left"><div _ngcontent-ykq-c106="" class="handle-button expand-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ykq-c106="" class="highlight-div-header-right"><div _ngcontent-ykq-c106="" class="handle-button ai-button"></div><div _ngcontent-ykq-c106="" class="handle-button line-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ykq-c106="" class="handle-button theme-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ykq-c106="" class="handle-button copy-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ykq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FuzzySceneOptimization/entry/src/main/ets/pages/MotionBlur.ets#L17-L92" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">MotionBlur</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'navPathStack'</span>) <span class="hljs-attr">navPathStack</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isShowMotionBlur</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bottomSafeHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// bottom navigation bar height</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()!, <span class="hljs-function">(<span class="hljs-params">err, windowBar</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>
</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// get the height of the bottom navigation bar</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> =</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>            .<span class="hljs-title function_">px2vp</span>(windowBar.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_NAVIGATION_INDICATOR</span>).<span class="hljs-property">bottomRect</span>.<span class="hljs-property">height</span>);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getWindowAvoidArea failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>      windowBar.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`setWindowLayoutFullScreen failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>        })</li><li>
</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// modal page with dynamically blurred image settings</span></li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">motionBlurBuilder</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span> }) {</li><li>      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.test'</span>))</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>        .<span class="hljs-title function_">blur</span>(<span class="hljs-number">13</span>) <span class="hljs-comment">// add motion blur effect</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'close'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> + <span class="hljs-number">16</span> })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowMotionBlur</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'motion blur'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowMotionBlur</span> = <span class="hljs-literal">true</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">bindContentCover</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowMotionBlur</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">motionBlurBuilder</span>(), {</li><li>            <span class="hljs-attr">modalTransition</span>: <span class="hljs-title class_">ModalTransition</span>.<span class="hljs-property">DEFAULT</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> + <span class="hljs-number">16</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">End</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FuzzySceneOptimization/entry/src/main/ets/pages/MotionBlur.ets#L17-L92" target="_blank">MotionBlur.ets</a></div></div></div></div> <div class="fignone"><span class="figcap"><b>图1 </b>动态模糊</span><br><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163049.91531541520907519927953236366565:50001231000000:2800:40E3FBA3AE3D3C16288A1AB8350106A2160600EB453BE6C2AC657C00541442D4.gif" title="点击放大" width="266"></span></div> <p>下面是使用静态模糊对图片进行模糊处理的场景示例。主要步骤如下：</p> <ol><li>通过createPixelMap创建图片的PixelMap。</li><li>通过createEffect创建Filter实例。</li><li>通过Filter图像效果类中的blur，为Image添加模糊效果。<div class="screenLinkPre"><div _ngcontent-ykq-c106="" class="highlight-div"><div _ngcontent-ykq-c106="" class="highlight-div-header"><div _ngcontent-ykq-c106="" class="highlight-div-header-left"><div _ngcontent-ykq-c106="" class="handle-button expand-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ykq-c106="" class="highlight-div-header-right"><div _ngcontent-ykq-c106="" class="handle-button ai-button"></div><div _ngcontent-ykq-c106="" class="handle-button line-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ykq-c106="" class="handle-button theme-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ykq-c106="" class="handle-button copy-button"><div _ngcontent-ykq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ykq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FuzzySceneOptimization/entry/src/main/ets/pages/StaticBlur.ets#L17-L130" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { effectKit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">StaticBlur</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'navPathStack'</span>) <span class="hljs-attr">navPathStack</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isShowStaticBlur</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">imgSource</span>: image.<span class="hljs-property">ImageSource</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bottomSafeHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// bottom navigation bar height</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()!, <span class="hljs-function">(<span class="hljs-params">err, windowBar</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-comment">// get the height of the bottom navigation bar</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> =</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>            .<span class="hljs-title function_">px2vp</span>(windowBar.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_NAVIGATION_INDICATOR</span>).<span class="hljs-property">bottomRect</span>.<span class="hljs-property">height</span>);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getWindowAvoidArea failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>      windowBar.<span class="hljs-title function_">setWindowLayoutFullScreen</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`setWindowLayoutFullScreen failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>        })</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">staticBlur</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()!;</li><li>    <span class="hljs-keyword">let</span> resourceMgr = context.<span class="hljs-property">resourceManager</span>; <span class="hljs-comment">// retrieve the resourceManager object</span></li><li>    <span class="hljs-comment">// const fileData = await resourceMgr.getRawFileContent('test.png'); // retrieve images from the rawfile directory</span></li><li>    <span class="hljs-keyword">await</span> resourceMgr.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-string">'test.png'</span>) <span class="hljs-comment">// retrieve images from the rawfile directory</span></li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">fileData: <span class="hljs-built_in">Uint8Array</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span> = fileData.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// create an ArrayBuffer instance</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSource</span> = image.<span class="hljs-title function_">createImageSource</span>(buffer); <span class="hljs-comment">// create an image source instance</span></li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getRawFileContent failed, code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      })</li><li>    <span class="hljs-comment">// create attributes for pixels</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">opts</span>: image.<span class="hljs-property">InitializationOptions</span> = {</li><li>      <span class="hljs-attr">editable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// is it editable</span></li><li>      <span class="hljs-attr">pixelFormat</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// pixel format. 3 represents RGBA_8888</span></li><li>      <span class="hljs-attr">size</span>: {</li><li>        <span class="hljs-comment">// create image size</span></li><li>        <span class="hljs-attr">height</span>: <span class="hljs-number">4</span>,</li><li>        <span class="hljs-attr">width</span>: <span class="hljs-number">6</span></li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// create PixelMap</span></li><li>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSource</span>!.<span class="hljs-title function_">createPixelMap</span>(opts).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelMap: image.PixelMap</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> blurRadius = <span class="hljs-number">3</span>;</li><li>      <span class="hljs-keyword">let</span> headFilter = effectKit.<span class="hljs-title function_">createEffect</span>(pixelMap); <span class="hljs-comment">// create Filter Instance</span></li><li>      <span class="hljs-keyword">if</span> (headFilter !== <span class="hljs-literal">null</span>) {</li><li>        headFilter.<span class="hljs-title function_">blur</span>(blurRadius); <span class="hljs-comment">// set static blur. Add the blur effect to the effect list</span></li><li>        <span class="hljs-comment">// retrieve the image of the source image with the added linked list effect PixelMap</span></li><li>        headFilter.<span class="hljs-title function_">getEffectPixelMap</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelMap: image.PixelMap</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = pixelMap;</li><li>        });</li><li>      }</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">staticBlurBuilder</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span> }) {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'close'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> + <span class="hljs-number">16</span> })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowStaticBlur</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'static blur'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowStaticBlur</span> = <span class="hljs-literal">true</span>;</li><li>            <span class="hljs-comment">// set static blur</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">staticBlur</span>();</li><li>          })</li><li>          .<span class="hljs-title function_">bindContentCover</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isShowStaticBlur</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">staticBlurBuilder</span>(), {</li><li>            <span class="hljs-attr">modalTransition</span>: <span class="hljs-title class_">ModalTransition</span>.<span class="hljs-property">DEFAULT</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bottomSafeHeight</span> + <span class="hljs-number">16</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">End</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/FuzzySceneOptimization/entry/src/main/ets/pages/StaticBlur.ets#L17-L130" target="_blank">StaticBlur.ets</a></div></div></div></div> </li></ol> <div class="fignone"><span class="figcap"><b>图2 </b>静态模糊</span></div> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163049.46468577023942748873977815044107:50001231000000:2800:30C81698345F3025059EAFA9B2017531BB4DD04D10E8A974BE7BCCBD0C11B060.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section12488810070">效果对比<i class="anchor-icon anchor-icon-link" anchorid="section12488810070" tips="复制节点链接"></i></h2><p>下面使用DevEco Studio内置的Profiler中的帧率分析工具Frame抓取点击按钮触发转场过程的trace来分析静态模糊和动态模糊场景下的性能差异。需要说明，由于场景示例通过点击按钮触发转场，所以可以通过User Events（用户输入事件）的Click标签定位到转场过程的起点为Click标签结束位置。转场过程的终点为连续的RenderFrame（执行GPU绘制）标签不再连续的位置。</p> <p><span><img height="252.3675" originheight="482" originwidth="1000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163049.75783669676678478346298697024165:50001231000000:2800:7872D178318C920047F6CF9A973723F7BE71DEB6171B89BA260BE3A6B1A24950.png" title="点击放大" width="523.6875"></span></p> <p>如上图所示，通过RenderFrame（执行GPU绘制）标签可以看出，动态模糊转场平均渲染耗时为6.113ms。同时从Present Fence（图形上屏信号）标签可以看出动态模糊转场平均帧率为108.0fps。</p> <p><span><img height="233.41500000000002" originheight="447" originwidth="1000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163049.93519903829325671846958931871004:50001231000000:2800:AEFEE3BBE51B4A5A629BAA34BC0A0E330C7E653804EF7ABF02CC22A7340D894F.png" title="点击放大" width="523.6875"></span></p> <p>如上图所示，通过RenderFrame标签可以看出，静态模糊转场平均渲染耗时为3.357ms。同时从Present Fence标签可以看出静态模糊转场平均帧率为119.9fps。和动态模糊转场相比平均渲染耗时减少了约45%（性能耗时数据因应用场景、设备型号版本而异，以实测为准）。</p> <p>由此可见，在模糊效果类似的条件下，静态模糊的性能要优于动态模糊。这源于底层实现机制的差异：静态模糊只需完成一次性的模糊处理，有效减轻了实时渲染的负担；而动态模糊则需要对每一帧进行连续的模糊计算，尽管在理想情况下能够营造出更为平滑和连贯的视觉过渡效果，但同时也显著增加了渲染的复杂度和资源消耗，若页面过于复杂，反而可能导致卡顿或丢帧现象的发生。</p> </div> <div class="tiledSection"><h2 id="section19423911173814">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section19423911173814" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/FuzzySceneOptimization" target="_blank">图像模糊动效优化</a></li></ul> </div> </div> <div></div></div>