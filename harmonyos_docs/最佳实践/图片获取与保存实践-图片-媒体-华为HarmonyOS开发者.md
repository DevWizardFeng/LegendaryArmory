<h1 _ngcontent-eud-c119="" class="doc-title ng-star-inserted" title="图片获取与保存实践"> 图片获取与保存实践 </h1>

<div _ngcontent-eud-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section142364384135">概述<i class="anchor-icon anchor-icon-link" anchorid="section142364384135" tips="复制节点链接"></i></h2><p>应用在业务流程中常需要获取设备图片用于编辑、分享等操作，可能还需要读取图片信息、将图像保存到本地等。本文介绍了HarmonyOS上几种常见的获取图片的方式、获取后读取图片信息、以及将图片保存在本地的操作，可供开发者学习和参考。</p> <p><span><img originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163029.60436456836292171906298057793370:50001231000000:2800:6547B644ACCCFA029D79135CBFE7223F020729F272232052689598FAC681875D.gif" width="320" height="662"></span></p> </div> <div class="tiledSection"><h2 id="section7533141871620">获取图片<i class="anchor-icon anchor-icon-link" anchorid="section7533141871620" tips="复制节点链接"></i></h2><p>在HarmonyOS上，从智能终端获取图片的方式主要有两种：</p> <ul><li>用户从系统相册中选择想要的图片</li><li>通过相机拍摄获取</li></ul> <p>以下针对两种场景分别进行介绍。</p> </div> <div class="tiledSection"><h3 id="section19709151017246" class="firsth2">从相册获取图片<i class="anchor-icon anchor-icon-link" anchorid="section19709151017246" tips="复制节点链接"></i></h3><p>HarmonyOS提供了两种便捷方法来从相册中获取图片，一种是基于PhotoPickerComponent（下文统称PhotoPicker组件）来在应用中直接访问相册中的图片或视频，另一种是使用PhotoViewPicker接口拉起系统相册后选择图片或视频文件。</p> <p><strong>实现原理</strong></p> <p>PhotoPicker组件是一个ArkUI组件，应用在页面中嵌入该组件，可以直接展示系统相册中的图片或视频文件，无需额外申请权限。用户可以直接在组件中选择想要的图片或视频文件。PhotoViewPicker是图库选择器，应用使用此接口可以跳转到系统相册选择一个或多个图片/视频，然后将所选的图片/视频以uris的形式传递回应用。</p> <p>因此，如果开发者接受在应用页面中直接显示系统相册，则推荐使用PhotoPicker组件；如果开发者不希望系统相册在应用页面中占据空间，则推荐使用PhotoViewPicker跳转到系统相册应用里去选择图片或视频。</p> <p><strong>开发步骤</strong></p> <p>基于PhotoPicker组件获取图片的开发步骤可以参考指南<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/component-guidelines-photoviewpicker" target="_blank">使用PhotoPicker组件访问图片/视频</a>，使用PhotoViewPicker拉起系统相册获取图片的开发步骤可以参考指南<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker" target="_blank">使用Picker选择媒体库资源</a>。</p> </div> <div class="tiledSection"><h3 id="section610819151543">拍照获取图片<i class="anchor-icon anchor-icon-link" anchorid="section610819151543" tips="复制节点链接"></i></h3><p>除了从相册获取图片外，应用还可以通过拍照来获取图片。对于拍照这一行为，HarmonyOS上提供了系统相机和自定义相机两种选项。应用可以通过拉起系统相机拍照并获得一张照片，也可以自行实现自定义相机来拍照获取照片。</p> <p><strong>实现原理</strong></p> <p>CameraPicker是系统提供的相机选择器，可以拉起系统相机为应用提供拍照或录像功能，结果以uri的形式返回给应用。系统还提供了一整套相机服务接口（包含ArkTS API和C API）给开发者用于开发适合自身需求的自定义相机功能，对自定义相机开发有诉求的开发者可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-kit" target="_blank">Camera Kit</a>，本文不再赘述。</p> <p><strong>开发步骤</strong></p> <p>使用CameraPicker的参考代码如下：</p> <div class="screenLinkPre"><div _ngcontent-eud-c106="" class="highlight-div"><div _ngcontent-eud-c106="" class="highlight-div-header"><div _ngcontent-eud-c106="" class="highlight-div-header-left"><div _ngcontent-eud-c106="" class="handle-button expand-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eud-c106="" class="highlight-div-header-right"><div _ngcontent-eud-c106="" class="handle-button ai-button"></div><div _ngcontent-eud-c106="" class="handle-button line-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eud-c106="" class="handle-button theme-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eud-c106="" class="handle-button copy-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eud-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L83-L95" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">pickerProfile</span>: <span class="hljs-title class_">cameraPicker</span>.<span class="hljs-title class_">PickerProfile</span> =</li><li>    { <span class="hljs-variable">cameraPosition</span>: <span class="hljs-title class_">camera</span>.<span class="hljs-title class_">CameraPosition</span>.<span class="hljs-title class_">CAMERA_POSITION_BACK</span> };</li><li>  <span class="hljs-comment">//Select the action of pulling up the camera to take pictures.</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">pickerResult</span>: <span class="hljs-title class_">cameraPicker</span>.<span class="hljs-title class_">PickerResult</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">cameraPicker</span>.<span class="hljs-title function_">pick</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(),</li><li>    [<span class="hljs-variable">cameraPicker</span>.<span class="hljs-variable">PickerMediaType</span>.<span class="hljs-variable">PHOTO</span>], <span class="hljs-variable">pickerProfile</span>);</li><li>  <span class="hljs-comment">//Return the photo uri to the application.</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageUri</span> = <span class="hljs-variable">pickerResult</span>.<span class="hljs-variable">resultUri</span> ? <span class="hljs-variable">pickerResult</span>.<span class="hljs-variable">resultUri</span> : <span class="hljs-keyword">this</span>.<span class="hljs-title class_">imageUri</span>;</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable">TAG</span>, <span class="hljs-string">'cameraPicker.pick succeed, uri: '</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">pickerResult</span>));</li><li>} <span class="hljs-keyword">catch</span> (<span class="hljs-variable">error</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">err</span> = <span class="hljs-variable">error</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">cameraPicker</span>.<span class="hljs-variable">pick</span> <span class="hljs-variable">failed</span>, <span class="hljs-variable">error</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L83-L95" target="_blank">Index.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section175521657142419">读取图片信息<i class="anchor-icon anchor-icon-link" anchorid="section175521657142419" tips="复制节点链接"></i></h2><p><strong>实现原理</strong></p> <p>HarmonyOS提供了ImageSource图片源类用于获取图片相关信息，既可以读取图片大小、像素格式等基本信息，也可以读取EXIF信息，如曝光时间、光圈值等。</p> <p><strong>开发步骤</strong></p> <p>首先基于前文获得的图片uri，创建一个ImageSource实例，然后调用相关方法即可读取图片信息。</p> <p>读取基本信息：</p> <div class="screenLinkPre"><div _ngcontent-eud-c106="" class="highlight-div"><div _ngcontent-eud-c106="" class="highlight-div-header"><div _ngcontent-eud-c106="" class="highlight-div-header-left"><div _ngcontent-eud-c106="" class="handle-button expand-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eud-c106="" class="highlight-div-header-right"><div _ngcontent-eud-c106="" class="handle-button ai-button"></div><div _ngcontent-eud-c106="" class="handle-button line-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eud-c106="" class="handle-button theme-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eud-c106="" class="handle-button copy-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eud-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L276-L283" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">path</span>);</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span>.<span class="hljs-title function_">getImageInfo</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError, imageInfo: image.ImageInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`getImageInfo failed, error: <span class="hljs-subst">${error.code}</span>, <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'getImageInfo succeed, info: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(imageInfo));</li><li>  }</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L276-L283" target="_blank">Index.ets</a></div></div></div></div> <p>读取EXIF信息：</p> <div class="screenLinkPre"><div _ngcontent-eud-c106="" class="highlight-div"><div _ngcontent-eud-c106="" class="highlight-div-header"><div _ngcontent-eud-c106="" class="highlight-div-header-left"><div _ngcontent-eud-c106="" class="handle-button expand-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eud-c106="" class="highlight-div-header-right"><div _ngcontent-eud-c106="" class="handle-button ai-button"></div><div _ngcontent-eud-c106="" class="handle-button line-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eud-c106="" class="handle-button theme-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eud-c106="" class="handle-button copy-button"><div _ngcontent-eud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eud-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L286-L291" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> key = [image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">IMAGE_WIDTH</span>, image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">IMAGE_LENGTH</span>, image.<span class="hljs-property">PropertyKey</span>.<span class="hljs-property">F_NUMBER</span>];</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">imageSource</span>.<span class="hljs-title function_">getImageProperties</span>(key).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'getImageProperties succeed, data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'getImageProperties failed, error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ImageGetAndSave/blob/master/entry/src/main/ets/pages/Index.ets#L286-L291" target="_blank">Index.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section13488161110165">保存图片<i class="anchor-icon anchor-icon-link" anchorid="section13488161110165" tips="复制节点链接"></i></h2><p>对于已经编辑处理后的PixelMap图像，如果想要保存到本地，可以选择保存到文件目录或者是系统相册中。</p> </div> <div class="tiledSection"><h3 id="section537603311233" class="firsth2">保存到文件目录<i class="anchor-icon anchor-icon-link" anchorid="section537603311233" tips="复制节点链接"></i></h3><p><strong>实现原理</strong></p> <p>ImagePacker是HarmonyOS提供的图片打包器类，可以用于图片压缩和打包。在创建ImagePacker实例后，可以调用packToFile方法将PixelMap对象编码打包进文件，保存的路径可以指定具有写权限的文件目录，具体可以参考指南<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-encoding" target="_blank">使用ImagePacker完成图片编码</a>。</p> </div> <div class="tiledSection"><h3 id="section6220757102311">保存到系统相册<i class="anchor-icon anchor-icon-link" anchorid="section6220757102311" tips="复制节点链接"></i></h3><p><strong>实现原理</strong></p> <p>要将PixelMap保存到系统相册，可以通过先将pixelmap保存到文件目录的方法，获得图片uri后，使用安全控件或者弹窗授权的方式保存到系统相册，具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-savebutton" target="_blank">保存媒体库资源</a>开发指南。</p> </div> <div class="tiledSection"><h2 id="section2060872091912">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section2060872091912" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/ImageGetAndSave" target="_blank">实现图片获取与保存功能</a></li></ul> </div> </div> <div></div></div>