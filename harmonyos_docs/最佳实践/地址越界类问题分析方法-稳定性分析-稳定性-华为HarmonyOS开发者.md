<h1 _ngcontent-blp-c119="" class="doc-title ng-star-inserted" title="地址越界类问题分析方法"> 地址越界类问题分析方法 </h1>

<div _ngcontent-blp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1255515505816">概述<i class="anchor-icon anchor-icon-link" anchorid="section1255515505816" tips="复制节点链接"></i></h2></div> <p>地址越界问题是指访问了不合法的地址，导致程序运行出现异常，通常表现为应用崩溃（crash），其故障原因为释放后使用（use after free）、重复释放（double-free）、栈溢出（stack-overflow）、堆溢出（heap-overflow）等。由于应用崩溃（crash）日志信息有限且非崩溃第一现场，地址越界问题定位较为困难，一般依赖ASan、HWASan、GWP-ASan等检测工具以获取更多内存操作信息。从API13开始推荐使用HWASan检测工具进行地址越界问题的分析，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-hwasan-detection">使用HWASan检测内存错误</a>。</p> <p>本文主要介绍地址越界问题检测能力、地址越界问题定位分析思路。</p> <div class="tiledSection"><h2 id="section7235331135818">检测能力<i class="anchor-icon anchor-icon-link" anchorid="section7235331135818" tips="复制节点链接"></i></h2></div> <p>目前系统提供了ASan、HWASan、GWP-ASan等检测工具，支撑应用解决地址越界问题，相关介绍、检测问题类型均在<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-asan-detection">《使用ASan检测内存错误》</a>、<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-gwpasan-detection">《使用GWP-ASan检测内存错误》</a>已有讲解，不再赘述。</p> <div class="tiledSection"><h2 id="section33521841125815">分析定位思路<i class="anchor-icon anchor-icon-link" anchorid="section33521841125815" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1520212471810" class="firsth2">地址越界问题的定位流程<i class="anchor-icon anchor-icon-link" anchorid="section1520212471810" tips="复制节点链接"></i></h3><p>如下，由于地址越界问题在应用的故障现象通常为崩溃闪退（Crash），且Crash的栈可能不是第一现场，而是受害者的栈，因此这类问题分析难度较高，且经常依赖于天网版本复现。</p> <p><span><img height="259.35" originheight="553" originwidth="1113" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163448.17524782601269931239926076514485:50001231000000:2800:2567D50E60CC331BB1C4DDA73FBF191D8ED0B7B09ED83A56DB373C3A9B5F111B.png" title="点击放大" width="523.6875"></span></p> <p>以下为踩内存问题的通用分析流程，力求提升踩内存问题检测和定位效率。</p> <p><span><img originheight="464" originwidth="716" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163448.39059235122255863706541443460551:50001231000000:2800:78F24ECE99C522DAECF57172EC42EE6A2F3640C30AB77D61684F13B96D342730.png" width="716" height="464"></span></p> <p><strong>第一步：</strong><strong>问题类型分析</strong></p> <p><span style="color: rgb(29,29,26);">识别</span><span style="color: rgb(29,29,26);">cppcrash</span><span style="color: rgb(29,29,26);">问题的类型，是否为地址越界导致，一般需要提供汇编（C++隐藏太多细节，建议查看汇编）、内存的分析，代码中此内存的生命周期。</span>具体详细案例可参看<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-scenario-stability-address-sanitizer">地址越界类问题案例</a>。</p> <p><strong>第二步：</strong><strong><span style="color: rgb(29,29,26);">场景分析</span></strong></p> <ol><li><strong>用户场景：</strong>配合流水日志、崩溃栈（报错原因）、应用处理逻辑，分析用户或者测试在什么场景激发此问题（哪些页面、哪些控件，哪些功能，例如用户点击从App的页面1切换到页面2，再例如上面日志中某个进程崩在启动阶段），代码在什么场景下会走到这段流程。最好结合多份日志提炼共性，搞清楚场景有助于明确这个过程中用到了哪些部分的代码，针对性的测试，并且对这部分代码补充维测和天网插桩。</li><li><strong>异常线程分析：</strong>由于大部分内存分配器（比如jemalloc、scudo等）都是线程亲和，本线程前一个释放的内存会优先给到下一个分配者，因此如果崩溃线程非常聚焦，那说明凶手也和这个线程上跑的业务相关。同样有助于找到场景。</li></ol> <p><strong>第三步：</strong><strong style="color: rgb(29,29,26);">内存特征分析</strong></p> <p><span style="color: rgb(29,29,26);">包含内存的大小、踩内存点在内存块的偏移、踩内存值的特征，最好结合多份日志提炼共性。</span></p> <p><strong>找准出现问题的内存是什么</strong></p> <p>错误的内存使用，可能有两种：</p> <ol><li>地址直接从某个内存取出来的，取错了，例如从this解引用出来一个值放x0，再做一次解引用，如果第二行挂了，那说明this上面的值是坏的。<div _ngcontent-blp-c106="" class="highlight-div"><div _ngcontent-blp-c106="" class="highlight-div-header"><div _ngcontent-blp-c106="" class="highlight-div-header-left"><div _ngcontent-blp-c106="" class="handle-button expand-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-blp-c106="" class="highlight-div-header-right"><div _ngcontent-blp-c106="" class="handle-button ai-button"></div><div _ngcontent-blp-c106="" class="handle-button line-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-blp-c106="" class="handle-button theme-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-blp-c106="" class="handle-button copy-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-blp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li>LDR       X0, [<span class="hljs-keyword">this</span>] <span class="hljs-comment">// ARM64架构示例，X0寄存器存储this指针值</span></li><li>LDR       X8, [X0]   <span class="hljs-comment">// ARM64架构示例，X8寄存器存储X0寄存器指向的值</span></li></ol></pre></div></div> <p>可能的原因：</p> <ul><li>地址越界：this这块内存已经被本模块释放了，被新申请走填了新内容（常见）。</li><li>地址越界：this这块内存还是本模块持有，但内容被别的代码改坏了（常见）。</li><li>兼容性：数据结构定义不一致（少见但必现）。</li><li>器件问题：DDR、SOC问题（少见）。</li></ul> </li><li>地址是算出来的，计算过程中有一些参数是从某个内存取出来的，计算结果错了，那肯定是这些取的参数有问题。<p>如下图所示，IDA（反汇编工具）展示了一个典型的函数指针数组操作，w8是数组下标，从1开始，x9是reference解引用出来的，如果blr x8这条挂了，说明x9[x8]上面的值是坏的，而如果是ldr x8, [x9,x8,LSL#3]这条挂了，说明x9[x8]这个地址是无效的。</p> <p><span><img originheight="595" originwidth="617" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163448.74446528854705933063636180228342:50001231000000:2800:D6361D314F341216888EAB3D68A86B9099FFDC907A23989260BB38B9D1FB8D36.png" width="617" height="595"></span></p> </li></ol> <p><strong>找出现问题的内存大小：</strong></p> <p>在sizeclass类型的分配器中，大小是一个重要的信息，筛选该内存大小的栈有助于快速筛选，提升定位效率。</p> <p>以native内存分配器jemalloc为例，内存统计布局如下：</p> <p><span><img originheight="167" originwidth="1494" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163449.77280638269963126667184653450724:50001231000000:2800:456C57749F2B1E14805DD551F23DBD8002B8FFD699015D4879E9C67829C8160B.png" width="920" height="102.83801874163319"></span></p> <p>假设踩内存大小为32，查看上图右边红框标记出来的地方表示128个32字节的内存会挤在1个page上，刚好是32*128=4096字节。同样，下面80字节的内存块，每256个都挤在5个page上，80*256==20480=4096*5。17-32字节的内存分配，都会从这个32档位sizeclass的内存页上去分配，也就是说，如果发生overflow，凶手前后多半也是32字节的，因此受害者是32字节的，如果发生uaf（use-after-free），那么free的内存会被另一个17-32字节的申请者拿走，这个申请者就成为了受害者。</p> <p><strong>第四步：</strong><strong style="color: rgb(29,29,26);">用例部署</strong></p> <p>针对场景分析给出测试场景建议，以及测试部署规模的预测。</p> <ol><li><strong>目标</strong><strong>：</strong>复杂问题的测试往往需要分类分段。有这么几种<ol><li>复现为了找到场景，明确用例是否有效</li><li>添加了更多的定位信息后，复现为了证明/排除某个怀疑方向。</li></ol> <p>当一个目标达成，要尽快制定策略进入下一个目标。例如当添加的日志已经证明输入参数是有问题的，那需要找到传参模块进行流程分析并给出维测和测试方案</p> </li><li><strong>用例</strong>：由于越界问题和特定代码相关，因此需要对应用例让故障代码执行到。<p>最常规的用例就是UI随机测试，但是随机测试效率较低，需要根据场景和内存特征定制用例。同时应用的问题往往和内存的析构相关，因此要重点关注页面退出、资源关闭等场景</p> </li><li><strong>规模：</strong>开发应当了解crash的发生频率，以此预估所需要的测试资源<p>例如某个Crash问题的APR为10（发生10次/千小时），也就是说此问题100小时复现1次，那么也就是在实验室和Beta测试这类综合场景中，大约4台手机测24小时能复现一次。如果在针对性的复现测试中，4台手机测试了24-48小时还不能出现一次同类的crash，那么说明测试的场景不对。需要根据现场的hilog等日志，再分析出高效的场景。</p> </li></ol> <p><strong>第五步：</strong><strong style="color: rgb(29,29,26);">应用天网部署</strong></p> <p>明确应用进程中已经有哪些so插桩，有条件插桩的应用侧so都应该部署插桩。由于踩内存产生的crash调用栈存在很多随机性，而且反复复现编译很浪费时间，因此建议插桩越全越好，进程加载的so可基于crash文件的maps数据段确定，尽量都用HWASan编译。并且so链接时如果有静态库，静态库本身最好也用HWASan编译。插桩方法可见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-hwasan-detection#section10791454125320">配置HWASan</a>，继而基于上文部署的用例进行压测。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>应用天网版本：应用开启地址越界检测能力后编译的版本，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-address-sanitizer-overview">地址越界检测能力概述</a>。</p> </div></div></div> <p><strong>第六步：日志分析</strong></p> <p>对于稳定性测试出来的地址越界问题，基于问题日志，分析问题根因并解决。同样，也可基于地址越界日志，基于内存特征、场景等信息逆向分析，确认是否与之前疑似踩内存的crash问题类似。</p> </div> <div class="tiledSection"><h3 id="section586941820578">地址越界问题类型<i class="anchor-icon anchor-icon-link" anchorid="section586941820578" tips="复制节点链接"></i></h3><p>常见地址问题类型可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-address-sanitizer-events#type字段说明" target="_blank">地址越界事件介绍-type字段说明</a></p> </div> <div class="tiledSection"><h3 id="section937251519196">地址越界问题的日志分析<i class="anchor-icon anchor-icon-link" anchorid="section937251519196" tips="复制节点链接"></i></h3><p>对于地址越界问题的日志分析，由于日志落盘与cppcrash日志相似，具体参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-app-crash-cpp-way">CppCrash类问题分析方法</a>，详细的步骤为：</p> <ol><li>获取HWASan检测工具，检测到的地址越界问题日志。</li><li>获取符号表，定位行号（use栈、free栈）。</li><li>结合应用代码逻辑分析代码的内存操作。</li></ol> <p>地址越界问题代码示例：</p> <p>以地址越界问题类型栈缓存区溢出（stack-buffer-overflow）为例，该类型是指程序读、写的栈内存超出预期范围，程序运行异常、崩溃，具体影响如下</p> <ol><li>对于越界读的场景，读取到无效数据并且使用时，程序运行出现异常；</li><li>对于越界写的场景，出现对有效数据的覆盖，甚至覆盖支撑问题定位的信息（例如，栈帧信息）；</li></ol> <p>地址越界问题类型的示例代码如下。</p> <div class="screenLinkPre"><div _ngcontent-blp-c106="" class="highlight-div"><div _ngcontent-blp-c106="" class="highlight-div-header"><div _ngcontent-blp-c106="" class="highlight-div-header-left"><div _ngcontent-blp-c106="" class="handle-button expand-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-blp-c106="" class="highlight-div-header-right"><div _ngcontent-blp-c106="" class="handle-button ai-button"></div><div _ngcontent-blp-c106="" class="handle-button line-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-blp-c106="" class="handle-button theme-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-blp-c106="" class="handle-button copy-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-blp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/MemoryDetection/entry/src/main/cpp/address_problems.cpp#L72-L77" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">AddressOverflowCode</span><span class="hljs-params">(<span class="hljs-type">int</span> argc)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int</span> stack_array[<span class="hljs-number">99</span>];</li><li>    stack_array[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">return</span> stack_array[argc + <span class="hljs-number">100</span>]; <span class="hljs-comment">// BOOM</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/MemoryDetection/entry/src/main/cpp/address_problems.cpp#L72-L77" target="_blank">address_problems.cpp</a></div></div></div></div> <ul><li>地址越界问题日志分析</li></ul> <p>开启HWASan检测，上报的地址越界问题日志如下，</p> <div _ngcontent-blp-c106="" class="highlight-div"><div _ngcontent-blp-c106="" class="highlight-div-header"><div _ngcontent-blp-c106="" class="highlight-div-header-left"><div _ngcontent-blp-c106="" class="handle-button expand-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-blp-c106="" class="highlight-div-header-right"><div _ngcontent-blp-c106="" class="handle-button ai-button"></div><div _ngcontent-blp-c106="" class="handle-button line-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-blp-c106="" class="handle-button theme-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-blp-c106="" class="handle-button copy-button"><div _ngcontent-blp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-blp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>==<span class="hljs-number">27137</span>==<span class="hljs-variable">ERROR</span>: <span class="hljs-title class_">HWAddressSanitizer</span>: <span class="hljs-title class_">tag</span>-<span class="hljs-title class_">mismatch</span> <span class="hljs-title class_">on</span> <span class="hljs-title class_">address</span> <span class="hljs-number">0x007fdfd21014</span> <span class="hljs-title class_">at</span> <span class="hljs-title class_">pc</span> <span class="hljs-number">0x005578a3dad0</span></li><li><span class="hljs-variable">READ</span> <span class="hljs-variable">of</span> <span class="hljs-variable">size</span> <span class="hljs-number">4</span> <span class="hljs-variable">at</span> <span class="hljs-number">0x007fdfd21014</span> <span class="hljs-variable">tags</span>: <span class="hljs-title class_">c6</span>/<span class="hljs-number">00</span> (<span class="hljs-variable">ptr</span>/<span class="hljs-variable">mem</span>) <span class="hljs-keyword">in</span> <span class="hljs-variable">thread</span> <span class="hljs-variable">T0</span></li><li>    #<span class="hljs-number">0</span> <span class="hljs-number">0x5578a3dad0</span>  (/<span class="hljs-variable">data</span>/<span class="hljs-variable">local</span>/<span class="hljs-variable">tmp</span>/<span class="hljs-variable">test</span>.<span class="hljs-variable">out</span>+<span class="hljs-number">0x1ad0</span>)</li><li>    #<span class="hljs-number">1</span> <span class="hljs-number">0x7fbd30c574</span>  (/<span class="hljs-variable">lib</span>/<span class="hljs-variable">ld</span>-<span class="hljs-variable">musl</span>-<span class="hljs-variable">aarch64</span>.<span class="hljs-variable">so</span><span class="hljs-number">.1</span>+<span class="hljs-number">0xa0574</span>) (<span class="hljs-variable">BuildId</span>: <span class="hljs-number">8504e35</span><span class="hljs-title class_">ee1068ac2f54be5cafe869af6</span>)</li><li>    #<span class="hljs-number">2</span> <span class="hljs-number">0x5578a3d8b4</span>  (/<span class="hljs-variable">data</span>/<span class="hljs-variable">local</span>/<span class="hljs-variable">tmp</span>/<span class="hljs-variable">test</span>.<span class="hljs-variable">out</span>+<span class="hljs-number">0x18b4</span>)</li><li><span class="hljs-variable">Cause</span>: <span class="hljs-title class_">stack</span> <span class="hljs-title class_">tag</span>-<span class="hljs-title class_">mismatch</span></li><li><span class="hljs-variable">Address</span> <span class="hljs-number">0x007fdfd21014</span> <span class="hljs-keyword">is</span> <span class="hljs-variable">located</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">stack</span> <span class="hljs-variable">of</span> <span class="hljs-variable">thread</span> <span class="hljs-variable">T0</span></li><li><span class="hljs-variable">Thread</span>: <span class="hljs-title class_">T0</span> <span class="hljs-number">0x007600002000</span> <span class="hljs-title class_">stack</span>: [<span class="hljs-number">0x007fdf522000</span>,<span class="hljs-number">0x007fdfd22000</span>) <span class="hljs-variable">sz</span>: <span class="hljs-number">8388608</span> <span class="hljs-title class_">tls</span>: [<span class="hljs-number">0x007fbd45c200</span>,<span class="hljs-number">0x007fbd45c8f8</span>)</li><li><span class="hljs-variable">Previously</span> <span class="hljs-variable">allocated</span> <span class="hljs-variable">frames</span>:</li><li>  <span class="hljs-variable">record_addr</span>:<span class="hljs-number">0x7fbd21c630</span> <span class="hljs-title class_">record</span>:<span class="hljs-number">0x2102005578a3da1c</span>  (<span class="hljs-variable">/data</span><span class="hljs-variable">/local</span><span class="hljs-variable">/tmp</span><span class="hljs-variable">/test</span>.<span class="hljs-variable">out</span>+<span class="hljs-number">0x1a1c</span>)</li><li><span class="hljs-variable">Memory</span> <span class="hljs-variable">tags</span> <span class="hljs-variable">around</span> <span class="hljs-variable">the</span> <span class="hljs-variable">buggy</span> <span class="hljs-variable">address</span> (<span class="hljs-variable">one</span> <span class="hljs-variable">tag</span> <span class="hljs-variable">corresponds</span> <span class="hljs-variable">to</span> <span class="hljs-number">16</span> <span class="hljs-variable">bytes</span>):</li><li>  <span class="hljs-number">0x007efdfd2080</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2090</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd20a0</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd20b0</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd20c0</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd20d0</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd20e0</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span></li><li>  <span class="hljs-number">0x007efdfd20f0</span>: <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span>  <span class="hljs-title class_">c6</span></li><li>=&gt;<span class="hljs-number">0x007efdfd2100</span>: <span class="hljs-number">0</span><span class="hljs-title class_">c</span> [<span class="hljs-number">00</span>] <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2110</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2120</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2130</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2140</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2150</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2160</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2170</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li>  <span class="hljs-number">0x007efdfd2180</span>: <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span>  <span class="hljs-number">00</span></li><li><span class="hljs-variable">Tags</span> <span class="hljs-keyword">for</span> <span class="hljs-variable">short</span> <span class="hljs-variable">granules</span> <span class="hljs-variable">around</span> <span class="hljs-variable">the</span> <span class="hljs-variable">buggy</span> <span class="hljs-variable">address</span> (<span class="hljs-variable">one</span> <span class="hljs-variable">tag</span> <span class="hljs-variable">corresponds</span> <span class="hljs-variable">to</span> <span class="hljs-number">16</span> <span class="hljs-variable">bytes</span>):</li><li>  <span class="hljs-number">0x007efdfd20f0</span>: ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..</li><li>=&gt;<span class="hljs-number">0x007efdfd2100</span>: <span class="hljs-title class_">c6</span> [..] ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..</li><li>  <span class="hljs-number">0x007efdfd2110</span>: ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..  ..</li><li><span class="hljs-variable">See</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//clang.llvm.org/docs/HardwareAssistedAddressSanitizerDesign.html#short-granules for a description of short granule tags</span></li><li><span class="hljs-variable">Registers</span> <span class="hljs-keyword">where</span> <span class="hljs-variable">the</span> <span class="hljs-variable">failure</span> <span class="hljs-variable">occurred</span> (<span class="hljs-variable">pc</span> <span class="hljs-number">0x005578a3dad0</span>):</li><li>    <span class="hljs-variable">x0</span>  <span class="hljs-variable">c600007fdfd21014</span>  <span class="hljs-variable">x1</span>  <span class="hljs-variable">c600007fdfd20e84</span>  <span class="hljs-variable">x2</span>  <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd21010</span>  <span class="hljs-variable">x3</span>  <span class="hljs-number">0000000000006000</span></li><li>    <span class="hljs-variable">x4</span>  <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd20fdc</span>  <span class="hljs-variable">x5</span>  <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd20fdc</span>  <span class="hljs-variable">x6</span>  <span class="hljs-number">0000000033313732</span>  <span class="hljs-variable">x7</span>  <span class="hljs-number">3</span><span class="hljs-variable">a6b636174735f6c</span></li><li>    <span class="hljs-variable">x8</span>  <span class="hljs-number">0000000000000000</span>  <span class="hljs-variable">x9</span>  <span class="hljs-number">0200007</span><span class="hljs-variable">efdfd20e8</span>  <span class="hljs-variable">x10</span> <span class="hljs-variable">c600007fdfd20e80</span>  <span class="hljs-variable">x11</span> <span class="hljs-number">0000000000000065</span></li><li>    <span class="hljs-variable">x12</span> <span class="hljs-number">000000000000000</span><span class="hljs-variable">c</span>  <span class="hljs-variable">x13</span> <span class="hljs-number">0101010101010101</span>  <span class="hljs-variable">x14</span> <span class="hljs-number">0000000000000002</span>  <span class="hljs-variable">x15</span> <span class="hljs-number">0000000000000000</span></li><li>    <span class="hljs-variable">x16</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fbc3a74ac</span>  <span class="hljs-variable">x17</span> <span class="hljs-number">0000000000000007</span>  <span class="hljs-variable">x18</span> <span class="hljs-number">0000000000000000</span>  <span class="hljs-variable">x19</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd210a8</span></li><li>    <span class="hljs-variable">x20</span> <span class="hljs-number">0200007700000000</span>  <span class="hljs-variable">x21</span> <span class="hljs-number">0000005578</span><span class="hljs-variable">a3d9f4</span>  <span class="hljs-variable">x22</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd210b8</span>  <span class="hljs-variable">x23</span> <span class="hljs-number">00000000000000</span><span class="hljs-variable">f0</span></li><li>    <span class="hljs-variable">x24</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fbd45c060</span>  <span class="hljs-variable">x25</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fbd459140</span>  <span class="hljs-variable">x26</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fbd45c988</span>  <span class="hljs-variable">x27</span> <span class="hljs-number">0000000000000001</span></li><li>    <span class="hljs-variable">x28</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fbd45c0b0</span>  <span class="hljs-variable">x29</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd21020</span>  <span class="hljs-variable">x30</span> <span class="hljs-number">0000005578</span><span class="hljs-variable">a3dad4</span>   <span class="hljs-variable">sp</span> <span class="hljs-number">0000007</span><span class="hljs-variable">fdfd20e70</span></li><li><span class="hljs-variable">SUMMARY</span>: <span class="hljs-title class_">HWAddressSanitizer</span>: <span class="hljs-title class_">tag</span>-<span class="hljs-title class_">mismatch</span> (<span class="hljs-variable">/data</span><span class="hljs-variable">/local</span><span class="hljs-variable">/tmp</span><span class="hljs-variable">/test</span>.<span class="hljs-variable">out</span>+<span class="hljs-number">0x1ad0</span>)</li><li>==<span class="hljs-number">27137</span>==<span class="hljs-variable">End</span> <span class="hljs-variable">Hwasan</span> <span class="hljs-variable">report</span></li></ol></pre></div></div> <p>对应的日志结构如下，以#0栈为例，可使用反编译工具<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-app-crash-cpp-way#section14952241528">llvm-addr2line</a>，输入地址的偏移0x1ad0，即可解析出对应的源代码行号。</p> <p><span><img originheight="846" originwidth="1441" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163449.38228310192450244461576261882689:50001231000000:2800:7897D9696BB7A2F24CC8E801D7B94DE58651EBD11E5575C61170E3F2C144AC10.png" width="920" height="540.1249132546843"></span></p> </div> </div> <div></div></div>