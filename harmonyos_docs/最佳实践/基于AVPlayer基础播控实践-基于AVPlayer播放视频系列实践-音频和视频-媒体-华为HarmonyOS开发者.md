<h1 _ngcontent-gyl-c119="" class="doc-title ng-star-inserted" title="基于AVPlayer基础播控实践"> 基于AVPlayer基础播控实践 </h1>

<div _ngcontent-gyl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section31226444581">概述<i class="anchor-icon anchor-icon-link" anchorid="section31226444581" tips="复制节点链接"></i></h2><p>本文适用于视频播放类应用的开发，针对市场上主流视频播放类应用的常见场景，介绍了如何基于AVPlayer系统播放器实现视频播放应用。</p> <p>本文指导开发者基于HarmonyOS提供的媒体和ArkUI等能力，实现视频播放、暂停、跳转播放、静音播放、循环播放、窗口缩放模式设置、倍速设置、音量设置等基本开发场景，可以为视频播放应用提供灵活的交互体验和良好的观看效果。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在阅读本文之前，建议开发者先熟悉视频播放器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/video-playback-V5" target="_blank">《AVPlayer实现》</a>。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section194502434446">场景分析<i class="anchor-icon anchor-icon-link" anchorid="section194502434446" tips="复制节点链接"></i></h2></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.1.4.1.1" valign="top" width="19.52%"><p>场景名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.1.4.1.2" valign="top" width="35.22%"><p>描述</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.1.4.1.3" valign="top" width="45.26%"><p>实现方案</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section169581112135319">基础播控</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>视频资源的加载、播放、暂停、退出等操作。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer" target="_blank">AVPlayer接口</a>实现。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section1897734041617">跳转播放</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>滑动进度条精准跳转到指定时间进行播放。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-slider-V5" target="_blank">Slider组件</a>实现进度条，在其onChange回调中触发进度调节。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section15152110181715">静音播放</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>点击按钮设置静音播放。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setmediamuted12" target="_blank">setMediaMuted()方法</a>控制静音状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section09619253174">循环播放</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>视频播放结束后会从初始位置再次播放。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>通过在prepared状态下，设置视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#属性" target="_blank">loop属性</a>值为true，实现视频循环播放。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section18974144910175">窗口缩放模式设置</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>设置窗口缩放模式体验不同的缩放效果。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>通过设置AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#videoscaletype9" target="_blank">videoScaleType属性</a>设置窗口缩放模式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section1333481316184">倍速设置</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>可以通过<a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section1333481316184">点击按钮选择倍速</a>或者通过<a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section364983943913">长按手势调节倍速</a>。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setspeed9" target="_blank">setSpeed()方法</a>设置倍速。通过添加按钮和弹窗实现通过按钮调节倍速；通过给组件绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-longpressgesture" target="_blank">长按手势</a>实现长按倍速。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section74003157187">音量设置</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>可以滑动屏幕调节音量。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ohos-multimedia-avvolumepanel-V5" target="_blank">AVVolumePanel组件</a>显示音量，通过给组件绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-pangesture" target="_blank">手势滑动监听</a>实现调节音量。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.52%"><p><a href="/consumer/cn/doc/best-practices/bpta-avplayer-basic-control#section627701016296">字幕挂载与切换</a></p> </td> <td class="cellrowborder" valign="top" width="35.22%"><p>视频下方显示字幕。</p> </td> <td class="cellrowborder" valign="top" width="45.26%"><p>使用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#addsubtitlefromfd12" target="_blank">addSubtitleFromFd()方法</a>设置外挂字幕资源，并通过AVPlayer实例注册字幕回调函数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#onsubtitleupdate12" target="_blank">on('subtitleUpdate')</a>；通过切换字幕资源并使用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#reset9-1" target="_blank">reset()方法</a>重置播放实现切换字幕。</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section169581112135319">基础播控<i class="anchor-icon anchor-icon-link" anchorid="section169581112135319" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section17768143917128" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section17768143917128" tips="复制节点链接"></i></h3><p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/video-playback" target="_blank">AVPlayer</a>实现核心视频播放控制能力，包括视频资源加载、播放、暂停、停止及退出等操作。</p> </div> <div class="tiledSection"><h3 id="section138875294911">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section138875294911" tips="复制节点链接"></i></h3></div> <p>本开发指导将介绍如何使用AVPlayer开发视频播放功能，以完整地播放一个视频作为示例，实现端到端播放原始媒体资源。</p> <p>播放的全流程包含：创建AVPlayer，设置播放资源和窗口，设置播放参数（音量/倍速/缩放模式），播放控制（播放/暂停/跳转/停止），重置，销毁资源。在进行应用开发的过程中，开发者可以通过AVPlayer的state属性主动获取当前状态或使用on('stateChange')方法监听状态变化。如果应用在视频播放器处于错误状态时执行操作，系统可能会抛出异常或生成其他未定义的行为。</p> <p>原理详情可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/video-playback-V5" target="_blank">《AVPlayer实现》</a>。</p> <div class="tiledSection"><h3 id="section191211141191218">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section191211141191218" tips="复制节点链接"></i></h3><ol><li><span>创建实例：调用createAVPlayer()接口创建AVPlayer实例，初始化进入idle状态。</span></li><li><span>设置视频资源：设置AVPlayer实例的url或者fdSrc属性值，进入initialized状态。</span></li><li><span>准备播放：调用prepare()接口，进入prepared状态。</span></li><li><span>播放：调用play()接口，进入playing状态。</span></li><li><span>暂停：调用pause()接口，进入paused状态。</span></li><li><span>停止：调用stop()接口，进入stopped状态。</span></li><li><span>销毁实例：调用release()接口销毁实例，AVPlayer进入released状态，退出播放。</span></li></ol> </div> <div class="tiledSection"><h2 id="section1897734041617">跳转播放<i class="anchor-icon anchor-icon-link" anchorid="section1897734041617" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section18246595508" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section18246595508" tips="复制节点链接"></i></h3><p>进度条是视频应用的一个基础能力，可以通过点击或拖动进度条精准跳转到指定时间进行播放。</p> <p><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163042.78210753453339787059469068591477:50001231000000:2800:331D8E5EC4E1BDE4728273B628F24F3DCE0DCA49083CC59AB2D8BC0B4395008F.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section1695622314516">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1695622314516" tips="复制节点链接"></i></h3><p>基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-slider-V5" target="_blank">Slider组件</a>和视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#seek9" target="_blank">seek()方法</a>实现跳转播放。</p> </div> <div class="tiledSection"><h3 id="section56531643135417">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section56531643135417" tips="复制节点链接"></i></h3><p>采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-slider-V5" target="_blank">Slider组件</a>实现进度条功能，根据Silder组件属性设置进度条样式，并在其onChange()事件中触发视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#seek9" target="_blank">seek()方法</a>跳转到指定播放位置，实现视频进度的控制。</p> <div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/VideoOperate.ets#L106-L132" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Progress slider</span></li><li><span class="hljs-comment"> */</span></li><li>Slider({</li><li>  value: <span class="hljs-keyword">this</span>.currentTime,</li><li>  min: <span class="hljs-number">0</span>,</li><li>  max: <span class="hljs-keyword">this</span>.durationTime,</li><li>  style: SliderStyle.OutSet</li><li>})</li><li>  .id(<span class="hljs-string">'Slider'</span>)</li><li>  .blockColor(Color.White)</li><li>  .trackColor(Color.Gray)</li><li>  .selectedColor($r(<span class="hljs-string">'app.color.slider_selected'</span>))</li><li>  .showTips(<span class="hljs-literal">false</span>)</li><li>  .onChange((value: number, mode: SliderChangeMode) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (mode === SliderChangeMode.Begin) {</li><li>      <span class="hljs-keyword">this</span>.isSwiping = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.avPlayerController.videoPause();</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.avPlayerController.videoSeek(value);</li><li>    <span class="hljs-keyword">this</span>.currentTime = value;</li><li>    <span class="hljs-keyword">if</span> (mode === SliderChangeMode.End) {</li><li>      <span class="hljs-keyword">this</span>.isSwiping = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-keyword">this</span>.flag = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.avPlayerController.videoPlay();</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/VideoOperate.ets#L106-L132" target="_blank">VideoOperate.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section15152110181715">静音播放<i class="anchor-icon anchor-icon-link" anchorid="section15152110181715" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1458112414240" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1458112414240" tips="复制节点链接"></i></h3><p>通过界面按钮快捷切换视频播放静音状态，实现一键开启或关闭静音，提升媒体播放的交互便捷性。</p> <p><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163042.43889627889154422103311417829342:50001231000000:2800:0EE749C3EE31A9B5110A92890AD8EE93A1DB553C7E006285FDBB2782928E29B4.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section339464434818">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section339464434818" tips="复制节点链接"></i></h3><p>通过视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setmediamuted12" target="_blank">setMediaMuted()方法</a>，实现控制视频静音状态。</p> </div> <div class="tiledSection"><h3 id="section1058122415241">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1058122415241" tips="复制节点链接"></i></h3><ol><li><span>在底部操作栏添加<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-button-V5" target="_blank">Button组件</a>，按钮显示为icon图标；根据Button组件属性设置按钮样式，并在其onClick()事件中触发视频管理接口AvPlayerController.ets文件中封装的videoMuted()方法。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/VideoOperate.ets#L162-L181" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Video Muted Button</span></li><li><span class="hljs-comment"> */</span></li><li>Button() {</li><li>  Image(<span class="hljs-keyword">this</span>.isMuted ? $r(<span class="hljs-string">'app.media.ic_video_speaker_slash'</span>) : $r(<span class="hljs-string">'app.media.ic_video_speaker'</span>))</li><li>    .width($r(<span class="hljs-string">'app.float.size_30'</span>))</li><li>    .height($r(<span class="hljs-string">'app.float.size_30'</span>))</li><li>}</li><li>.type(ButtonType.Normal)</li><li>.width($r(<span class="hljs-string">'app.float.size_30'</span>))</li><li>.height($r(<span class="hljs-string">'app.float.size_30'</span>))</li><li>.borderRadius($r(<span class="hljs-string">'app.float.size_20'</span>))</li><li>.backgroundColor(<span class="hljs-string">'rgba(0, 0, 0, 0)'</span>)</li><li>.margin({ left: $r(<span class="hljs-string">'app.float.size_5'</span>) })</li><li>.fontColor(Color.White)</li><li>.onClick(() =&gt; {</li><li>  <span class="hljs-keyword">this</span>.isMuted = !<span class="hljs-keyword">this</span>.isMuted;</li><li>  <span class="hljs-keyword">this</span>.avPlayerController.videoMuted(<span class="hljs-keyword">this</span>.isMuted)</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/VideoOperate.ets#L162-L181" target="_blank">VideoOperate.ets</a></div></div></div></div> <p></p></li><li><span>videoMuted()方法中调用了视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setmediamuted12" target="_blank">setMediaMuted()方法</a>，实现控制视频静音状态，其中第一个参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#mediatype8" target="_blank">mediaType</a>选择媒体类型为MEDIA_TYPE_AUD表示音频，第二个参数是静音开关。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L321-L337" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Video muted</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">isMuted</span></span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">videoMuted</span>(<span class="hljs-attr">isMuted</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span> = isMuted;</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>!.<span class="hljs-title function_">setMediaMuted</span>(media.<span class="hljs-property">MediaType</span>.<span class="hljs-property">MEDIA_TYPE_AUD</span>, isMuted)</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`videoMuted failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L321-L337" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section09619253174">循环播放<i class="anchor-icon anchor-icon-link" anchorid="section09619253174" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6814172213518" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section6814172213518" tips="复制节点链接"></i></h3><p>本功能可以用于在视频播放结束后自动将播放器重置至初始状态，使用户能够立即重新开始播放视频内容，实现无缝循环观看体验。</p> </div> <div class="tiledSection"><h3 id="section881420221153">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section881420221153" tips="复制节点链接"></i></h3><div class="p">在视频prepared状态下，设置视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#属性" target="_blank">loop属性</a>值为true，实现视频循环播放。<div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L168-L253" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Callback function for state machine changes</span></li><li><span class="hljs-keyword">this</span>.avPlayer.on(<span class="hljs-string">'stateChange'</span>, async (state) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.avPlayer) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  switch (state) {</li><li>    <span class="hljs-comment">// ...</span></li><li>    case <span class="hljs-string">'prepared'</span>: <span class="hljs-comment">// This state machine is reported after the prepare interface is successfully invoked.</span></li><li>      <span class="hljs-keyword">this</span>.isReady = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-keyword">this</span>.avPlayer.loop = <span class="hljs-literal">true</span></li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L168-L253" target="_blank">AvPlayerController.ets</a></div></div></div></div> </div> </div> <div class="tiledSection"><h2 id="section18974144910175">窗口缩放模式设置<i class="anchor-icon anchor-icon-link" anchorid="section18974144910175" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section6887224151411" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section6887224151411" tips="复制节点链接"></i></h3><p>通过窗口缩放模式设置功能，用户可根据实际观看需求灵活调整视频内容的显示方式。该功能在未设置视频固定宽高时，在窗口尺寸频繁调整、不同宽高比视频源适配、全屏/窗口模式切换及多屏协作等场景下较为重要。</p> <p>点击按钮即可弹出设置弹窗，可选择"拉伸至与窗口等大"模式，视频拉伸至与窗口等大，适合需要充分利用显示区域且对比例变化不敏感的场景；选择"缩放至最短边填满窗口"模式，视频将保持原始宽高比并以最短边为基准进行缩放，适合需要保持画面比例不变的场景。</p> <div class="fignone"><span class="figcap"><b>图1 </b>拉伸至与窗口等大模式</span><br><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163042.34560160293335957172626709794877:50001231000000:2800:4E5676EF44380F5CB076FC6C4186E0185B377630A97B102B48D71FFA2F65618F.gif" title="点击放大" width="266"></span></div> <div class="fignone"><span class="figcap"><b>图2 </b>缩放至最短边填满窗口</span><br><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163043.96851113721771952528532116737766:50001231000000:2800:B130D84E9D83645146DE0C4147B7A4380697B32270A0D8EF17C66C0FE99F8D97.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection"><h3 id="section19317101817172">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section19317101817172" tips="复制节点链接"></i></h3><p>通过设置视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#videoscaletype9" target="_blank">videoScaleType</a>属性值，实现窗口缩放模式的切换。由于VIDEO_SCALE_TYPE_SCALED_ASPECT（缩放至长边填满窗口）属性值从APIversion20开始才支持在元服务中使用，因此在这之前的版本中可根据屏幕大小为视频设置固定宽高来实现。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在未设置视频固定宽高的情况下，即未设置XComponent的height和width为固定值时，设置AVPlayer的videoScaleType属性值才能生效。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section7887102481418">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7887102481418" tips="复制节点链接"></i></h3><ol><li><span>可选择拉伸至与窗口等大/缩放至最短边填满窗口模式，选择后调用封装的videoScaleFit()/videoScaleFitCrop()方法。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/ScaleDialog.ets#L48-L101" data-highlighted="yes"><ol class="linenums"><li>List() {</li><li>  ForEach(<span class="hljs-keyword">this</span>.scaleList, (item: Resource, index) =&gt; {</li><li>    ListItem() {</li><li>      Column() {</li><li>        Row() {</li><li>          Text(item)</li><li>          <span class="hljs-comment">// ...</span></li><li>          Blank()</li><li>          Image(<span class="hljs-keyword">this</span>.windowScaleSelect === index ? $r(<span class="hljs-string">'app.media.ic_radio_selected'</span>) :</li><li>            $r(<span class="hljs-string">'app.media.ic_radio'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .width(<span class="hljs-string">'90%'</span>)</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height($r(<span class="hljs-string">'app.float.size_48'</span>))</li><li>    .onClick(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.windowScaleSelect = index;</li><li>      switch (<span class="hljs-keyword">this</span>.windowScaleSelect) {</li><li>        case ZERO:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoScaleFit();</li><li>          <span class="hljs-keyword">break</span>;</li><li>        case ONE:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoScaleFitCrop();</li><li>          <span class="hljs-keyword">break</span>;</li><li>        default:</li><li>          <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.controller.close();</li><li>    })</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/ScaleDialog.ets#L48-L101" target="_blank">ScaleDialog.ets</a></div></div></div></div> <p></p></li><li><span>videoScaleFit()/videoScaleFitCrop()方法内设置视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#videoscaletype9" target="_blank">videoScaleType</a>属性值。VIDEO_SCALE_TYPE_FIT表示拉伸至与窗口等大；VIDEO_SCALE_TYPE_FIT_CROP表示缩放至最短边填满窗口。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L400-L424" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Set window scale mode</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-title function_">videoScaleFit</span>(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-property">videoScaleType</span> = media.<span class="hljs-property">VideoScaleType</span>.<span class="hljs-property">VIDEO_SCALE_TYPE_FIT</span></li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`videoScaleType_0 failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-title function_">videoScaleFitCrop</span>(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-property">videoScaleType</span> = media.<span class="hljs-property">VideoScaleType</span>.<span class="hljs-property">VIDEO_SCALE_TYPE_FIT_CROP</span></li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`videoScaleType_1 failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L400-L424" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section1333481316184">点击按钮选择倍速<i class="anchor-icon anchor-icon-link" anchorid="section1333481316184" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section19824435142518" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section19824435142518" tips="复制节点链接"></i></h3><p>通过点击按钮选择预设倍速实现倍速设置，为用户提供灵活的视频播放速率控制。</p> <p><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163043.34988051731839336921199891797588:50001231000000:2800:B4835D81B4034A3432EFAFD90C2EF1977454D75AD3B6D5829E0319C1D6E31126.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section136317213245">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section136317213245" tips="复制节点链接"></i></h3><p>根据选择的倍速调用视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setspeed9" target="_blank">setSpeed()方法</a>设置对应值，实现视频播放倍速设置。</p> </div> <div class="tiledSection"><h3 id="section3824635162513">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section3824635162513" tips="复制节点链接"></i></h3><ol><li><span>可选择1.0X、1.25X、1.75X、2.0X，选择后调用对应的设置倍速方法。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/SpeedDialog.ets#L55-L113" data-highlighted="yes"><ol class="linenums"><li>  ForEach(<span class="hljs-keyword">this</span>.speedList, (item: Resource, index) =&gt; {</li><li>    ListItem() {</li><li>      Column() {</li><li>        Row() {</li><li>          Text(item)</li><li>          <span class="hljs-comment">// ...</span></li><li>          Blank()</li><li>          Image(<span class="hljs-keyword">this</span>.speedSelect === index ? $r(<span class="hljs-string">'app.media.ic_radio_selected'</span>) :</li><li>          $r(<span class="hljs-string">'app.media.ic_radio'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .width(<span class="hljs-string">'90%'</span>)</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height($r(<span class="hljs-string">'app.float.size_48'</span>))</li><li>    .onClick(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.speedSelect = index;</li><li>      switch (<span class="hljs-keyword">this</span>.speedSelect) {</li><li>        case ZERO:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_1_00_X);</li><li>          <span class="hljs-keyword">break</span>;</li><li>        case ONE:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_1_25_X);</li><li>          <span class="hljs-keyword">break</span>;</li><li>        case TWO:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_1_75_X);</li><li>          <span class="hljs-keyword">break</span>;</li><li>        case THREE:</li><li>          <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_2_00_X);</li><li>          <span class="hljs-keyword">break</span>;</li><li>        default:</li><li>          <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">this</span>.controller.close();</li><li>    })</li><li>  }, (item: Resource, index) =&gt; index + <span class="hljs-string">'_'</span> + JSON.stringify(item))</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/SpeedDialog.ets#L55-L113" target="_blank">SpeedDialog.ets</a></div></div></div></div> <p></p></li><li><span>设置倍速方法内调用视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setspeed9" target="_blank">setSpeed()方法</a>实现设置倍速。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L341-L351" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">videoSpeed</span>(<span class="hljs-attr">speed</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-title function_">setSpeed</span>(speed);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`videoSpeed failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L341-L351" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section364983943913">长按手势调节倍速<i class="anchor-icon anchor-icon-link" anchorid="section364983943913" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section26496391398" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section26496391398" tips="复制节点链接"></i></h3><p>通过长按手势实现长按屏幕时2倍速播放，长按结束时恢复1倍速播放。</p> </div> <div class="tiledSection"><h3 id="section1576212571302">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1576212571302" tips="复制节点链接"></i></h3><p>通过为元素绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-longpressgesture" target="_blank">长按手势</a>事件，在长按手势开始时调用视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setspeed9" target="_blank">setSpeed()方法</a>设置值为media.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#playbackspeed8" target="_blank">PlaybackSpeed</a>.SPEED_FORWARD_2_00_X，实现长按时2倍速播放；长按结束后调用视频播放器AVPlayer的setSpeed()方法设置值为media.PlaybackSpeed.SPEED_FORWARD_1_00_X，恢复播放速度为1倍速。</p> </div> <div class="tiledSection"><h3 id="section17207330173011">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section17207330173011" tips="复制节点链接"></i></h3><ol><li><span>为元素绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-longpressgesture" target="_blank">长按手势LongPressGesture</a>事件，并调用封装的videoSpeed()方法，长按手势开始时传递参数为media.PlaybackSpeed.SPEED_FORWARD_2_00_X，设置播放速度为2倍速；长按手势结束时传递参数为media.PlaybackSpeed.SPEED_FORWARD_1_00_X，恢复播放速度为1倍速。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L331-L341" data-highlighted="yes"><ol class="linenums"><li>.gesture(</li><li>  LongPressGesture({ repeat: <span class="hljs-literal">true</span> })</li><li>    .onAction(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.speedSelect = CASE_THREE</li><li>      <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_2_00_X);</li><li>    })</li><li>    .onActionEnd(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.speedSelect = CASE_ZERO</li><li>      <span class="hljs-keyword">this</span>.avPlayerController.videoSpeed(media.PlaybackSpeed.SPEED_FORWARD_1_00_X);</li><li>    })</li><li>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L331-L341" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>设置倍速方法内调用视频播放器AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#setspeed9" target="_blank">setSpeed()方法</a>实现设置倍速。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L341-L351" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">videoSpeed</span>(<span class="hljs-attr">speed</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-title function_">setSpeed</span>(speed);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`videoSpeed failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L341-L351" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section74003157187">音量设置<i class="anchor-icon anchor-icon-link" anchorid="section74003157187" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section127353210442" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section127353210442" tips="复制节点链接"></i></h3><p>滑动调节音量是一项非常实用的功能，它允许用户在不离开视频播放界面的情况下快速调整音量，以获得更好的观看体验。该功能位于窗口左侧，通过上下滑动手势即可调整音量。</p> <p><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163043.38137270976101553469138372068975:50001231000000:2800:953A79ADC721E8EF28C00CA4CA7B853FF052583CD8F9D13900787E4847002F1F.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section18791656172413">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section18791656172413" tips="复制节点链接"></i></h3><p>用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ohos-multimedia-avvolumepanel-V5" target="_blank">AVVolumePanel组件</a>显示系统音量面板，为元素绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-gestures-pangesture-V5?catalogVersion=V5" target="_blank">PanGesture</a>滑动手势事件，设置滑动方向为竖直方向，当手势在移动时，上滑增加音量，下滑减少音量，实现控制系统音量功能。</p> </div> <div class="tiledSection"><h3 id="section247731012162">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section247731012162" tips="复制节点链接"></i></h3></div> <ol><li><span>添加<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ohos-multimedia-avvolumepanel-V5" target="_blank">AVVolumePanel组件</a>显示系统音量面板。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/SetVolume.ets#L17-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AVVolumePanel</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">SetVolume</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">volume</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">5</span></li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">volumeVisible</span>: <span class="hljs-title class_">boolean</span> = <span class="hljs-keyword">false</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">AVVolumePanel</span>({</li><li>        <span class="hljs-variable">volumeLevel</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">volume</span>,</li><li>        <span class="hljs-variable">volumeParameter</span>: {</li><li>          <span class="hljs-variable">position</span>: {</li><li>            <span class="hljs-variable">x</span>: <span class="hljs-number">50</span>,</li><li>            <span class="hljs-variable">y</span>: <span class="hljs-number">1000</span></li><li>          }</li><li>        }</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">10</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">visibility</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">volumeVisible</span> ? <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Visible</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-title class_">Hidden</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/views/SetVolume.ets#L17-L40" target="_blank">SetVolume.ets</a></div></div></div></div> <p></p></li><li><span>为元素绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-gestures-pangesture-V5?catalogVersion=V5" target="_blank">PanGesture</a>滑动手势事件，并根据手势滑动距离计算音量值volume。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L251-L265" data-highlighted="yes"><ol class="linenums"><li>.gesture(</li><li>  PanGesture({ direction: PanDirection.Vertical })</li><li>    .onActionStart(() =&gt; {</li><li>    })</li><li>    .onActionUpdate((event: GestureEvent) =&gt; {</li><li>      <span class="hljs-keyword">this</span>.volumeVisible = <span class="hljs-literal">true</span>;</li><li>      let curVolume = <span class="hljs-keyword">this</span>.volume - <span class="hljs-keyword">this</span>.getUIContext().vp2px(event.offsetY) / <span class="hljs-keyword">this</span>.windowHeight;</li><li>      curVolume = curVolume &gt;= <span class="hljs-number">15.0</span> ? <span class="hljs-number">15.0</span> : curVolume;</li><li>      curVolume = curVolume &lt;= <span class="hljs-number">0.0</span> ? <span class="hljs-number">0.0</span> : curVolume;</li><li>      <span class="hljs-keyword">this</span>.volume = curVolume;</li><li>    })</li><li>    .onActionEnd(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.setVolumeTimer();</li><li>    })</li><li>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L251-L265" target="_blank">Index.ets</a></div></div></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section627701016296">字幕挂载与切换<i class="anchor-icon anchor-icon-link" anchorid="section627701016296" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section827801082916" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section827801082916" tips="复制节点链接"></i></h3><p>在视频播放前，用户可设置外挂字幕文件，字幕将精准同步显示于视频画面下方，并可以通过按钮切换字幕语言，提升观看体验。</p> <p><span><img height="567.7504" originheight="1080" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163043.96730249594883969404540496759964:50001231000000:2800:57D39E412F870A09BF34F149CB07FF6B923111D5D4464E2390DABD587ADBDBD1.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section327831022916">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section327831022916" tips="复制节点链接"></i></h3><p>通过AVPlayer视频播放器的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#addsubtitlefromfd12" target="_blank">addSubtitleFromFd()</a>方法加载外挂字幕，并使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#onsubtitleupdate12" target="_blank">on('subtitleUpdate')</a>方法注册字幕回调函数。在回调函数中获取字幕文本，通过状态变量刷新<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text组件</a>显示内容。使用Text组件显示字幕并设置字体格式。</p> <p>切换字幕语言需依据所选语言加载相应的字幕资源，然后调用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#reset9-1" target="_blank">reset()方法</a>重置播放器并重新初始化。</p> </div> <div class="tiledSection"><h3 id="section42783104291">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section42783104291" tips="复制节点链接"></i></h3></div> <ol><li><span>使用AVPlayer实例的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#addsubtitlefromfd12" target="_blank">addSubtitleFromFd()</a>方法为视频添加外挂字幕资源。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L109-L116" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">curSource</span>.<span class="hljs-property">caption</span>) {</li><li>  <span class="hljs-keyword">let</span> fileDescriptorSub = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">curSource</span>.<span class="hljs-property">caption</span>);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-title function_">addSubtitleFromFd</span>(fileDescriptorSub.<span class="hljs-property">fd</span>, fileDescriptorSub.<span class="hljs-property">offset</span>, fileDescriptorSub.<span class="hljs-property">length</span>)</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>        <span class="hljs-string">`addSubtitleFromFd failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L109-L116" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li><li><span>通过AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#onsubtitleupdate12" target="_blank">on('subtitleUpdate')</a>方法订阅获取外挂字幕事件，当有外挂字幕时，会通过订阅的回调方法通知用户。用户只能订阅一个外挂字幕事件的回调方法，若用户重复订阅，则以最后一次订阅的回调接口为准。回调中可以获取字幕文本、当前时间等信息，从而可以通过状态变量刷新Text组件显示的内容。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L430-L438" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">avPlayer</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'subtitleUpdate'</span>, <span class="hljs-function">(<span class="hljs-params">info: media.SubtitleInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (info) {</li><li>    <span class="hljs-keyword">let</span> text = (!info.<span class="hljs-property">text</span>) ? <span class="hljs-string">''</span> : info.<span class="hljs-property">text</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCaption</span> = text; <span class="hljs-comment">//update current caption content</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentCaption</span> = <span class="hljs-string">''</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">LOG_DOMAIN</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'subtitleUpdate info is null'</span>);</li><li>  }</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L430-L438" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li><li><span>使用状态变量刷新<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text组件</a>的内容，并通过修改Text属性调整字幕字体格式。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L236-L245" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">Center</span> }) {</li><li>  <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">avPlayerController</span>.<span class="hljs-variable">currentCaption</span>)</li><li>    .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>    .<span class="hljs-title function_">fontSize</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.float.size_20'</span>))</li><li>    .<span class="hljs-title function_">fontFamily</span>(<span class="hljs-string">'Sans'</span>)</li><li>}</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">position</span>({ <span class="hljs-variable">x</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">size_zero</span>'), <span class="hljs-variable">y</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">size_216</span>') })</li><li>.<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/pages/Index.ets#L236-L245" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>根据所选语言切换对应字幕资源，并调用AVPlayer的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#reset9-1" target="_blank">reset()方法</a>重置播放器并重新初始化。</span><p></p><div class="screenLinkPre"><div _ngcontent-gyl-c106="" class="highlight-div"><div _ngcontent-gyl-c106="" class="highlight-div-header"><div _ngcontent-gyl-c106="" class="highlight-div-header-left"><div _ngcontent-gyl-c106="" class="handle-button expand-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gyl-c106="" class="highlight-div-header-right"><div _ngcontent-gyl-c106="" class="handle-button ai-button"></div><div _ngcontent-gyl-c106="" class="handle-button line-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gyl-c106="" class="handle-button theme-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gyl-c106="" class="handle-button copy-button"><div _ngcontent-gyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gyl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L448-L463" data-highlighted="yes"><ol class="linenums"><li>async languageChange(languageSelect: number = <span class="hljs-number">0</span>): Promise&lt;void&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.avPlayer) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.curSource &amp;&amp; <span class="hljs-keyword">this</span>.curSource.caption) {</li><li>        <span class="hljs-keyword">this</span>.curSource.caption = languageSelect === <span class="hljs-number">0</span> ? <span class="hljs-string">'captions.srt'</span> : <span class="hljs-string">'en_captions.srt'</span></li><li>        <span class="hljs-keyword">this</span>.curSource.seekTime = <span class="hljs-keyword">this</span>.avPlayer.currentTime;</li><li>        await <span class="hljs-keyword">this</span>.avPlayer.reset();</li><li>        <span class="hljs-keyword">this</span>.initAVPlayer(<span class="hljs-keyword">this</span>.curSource, <span class="hljs-keyword">this</span>.surfaceID, <span class="hljs-keyword">this</span>.avPlayer);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.error(CommonConstants.LOG_DOMAIN, TAG,</li><li>        `languageChange failed, code <span class="hljs-keyword">is</span> ${err.code}, message <span class="hljs-keyword">is</span> ${err.message}`);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control/blob/master/entry/src/main/ets/controller/AvPlayerController.ets#L448-L463" target="_blank">AvPlayerController.ets</a></div></div></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section2011582865819">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section2011582865819" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/avplayer-basic-control" target="_blank">基于AVPlayer基础播控</a></li></ul> </div> </div> <div></div></div>