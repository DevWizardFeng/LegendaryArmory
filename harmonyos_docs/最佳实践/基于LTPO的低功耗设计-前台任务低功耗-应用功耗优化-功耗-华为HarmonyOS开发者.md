<h1 _ngcontent-jxf-c119="" class="doc-title ng-star-inserted" title="基于LTPO的低功耗设计"> 基于LTPO的低功耗设计 </h1>

<div _ngcontent-jxf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1562719621715">概述<i class="anchor-icon anchor-icon-link" anchorid="section1562719621715" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section132241429121713" class="firsth2">LTPO技术简介<i class="anchor-icon anchor-icon-link" anchorid="section132241429121713" tips="复制节点链接"></i></h3><p>LTPO的全称是“Low Temperature Polycrystalline Oxide”，中文译为“低温多晶氧化物”。这是OLED屏背板的一种驱动技术。通过将OLED驱动电路中的TFT换成IGZO TFT，降低显示功耗。LTPO屏支持1~120Hz的自适应刷新率，使应用在需要高刷新率的场景下提升流畅性，而在视频、静止等场景中使用低刷新率降低显示功耗，延长电池续航。通常，用“LTPO”指代自适应刷新率技术。</p> </div> <div class="tiledSection"><h3 id="section684464531716">特性介绍<i class="anchor-icon anchor-icon-link" anchorid="section684464531716" tips="复制节点链接"></i></h3><p>LTPO是自适应刷新率技术，按需调整显示刷新率，优化性能和功耗。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>适配LTPO的好处包括：精细化场景帧率控制，降低场景负载，减少偶发卡顿，降低场景功耗。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section12516101118180">场景策略建议<i class="anchor-icon anchor-icon-link" anchorid="section12516101118180" tips="复制节点链接"></i></h3><p>实现控件级帧率控制，降低系统因突发负载增加导致的卡顿，同时在高刷新率场景下主动适配，确保流畅体验。</p> <p><strong>不建议锁定最高帧率运行</strong></p> <p>不建议将ExpectedFrameRateRange中的expected、min、max都设置为120，这会干扰系统可变帧率机制，增加负载，影响整机性能和功耗。</p> <p>主要原因有以下三点：</p> <ol><li>ExpectedFrameRateRange中的关键参数是expected（期望帧率）。系统优先按照expected设置的帧率执行。如果系统难以满足expected帧率，会在min和max之间选择一个更合适的帧率提供给应用。</li><li>如果应用锁定120Hz，系统会优先满足应用的设置，以120帧运行。这将显著增加手机功耗，长时间运行会导致手机过热，严重影响用户体验。此外，不必要的高帧率会额外占据更多算力，可能导致其他场景的响应延迟。</li><li>如果系统持续以120Hz运行，此时系统的可变帧率能力已失效，这与可变帧率的设计原则不符。</li></ol> <p><strong>策略建议</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td class="cellrowborder" valign="top" width="19.259999999999998%"><p><strong>类型</strong></p> </td> <td class="cellrowborder" valign="top" width="45.16%"><p><strong>类型描述</strong></p> </td> <td class="cellrowborder" valign="top" width="35.58%"><p><strong>帧率建议（案例）</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.259999999999998%"><p>高帧率场景</p> </td> <td class="cellrowborder" valign="top" width="45.16%"><p>基本全屏的非持续动效</p> <p></p> </td> <td class="cellrowborder" valign="top" width="35.58%"><p>应用启动，退出，窗口转场动效，拖动窗口移动动效：90~120Hz</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.259999999999998%"><p>中等帧率场景</p> </td> <td class="cellrowborder" valign="top" width="45.16%"><p>变化区域大的持续型动效，非全屏的手势动效与转场动效</p> </td> <td class="cellrowborder" valign="top" width="35.58%"><p>视频内弹幕，小说自动翻页动效：60Hz</p> <p>QQ首页左滑某一行消息动效:60Hz</p> <p>微信右上角点击“+”号弹出应用内子窗口动效:60~120Hz</p> <p>抖音内滑动切换视频，图库滑动切换图片动效：60Hz</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.259999999999998%"><p>低帧率场景</p> </td> <td class="cellrowborder" valign="top" width="45.16%"><p>小区域动效，微动效</p> </td> <td class="cellrowborder" valign="top" width="35.58%"><p>小视频右下角转盘动效：15~30Hz</p> <p>页面刷新加载转圈动效:20~30Hz</p> <p>滑动列表右侧拖动条消失动效:15~30Hz</p> <p>复杂微动效，根据实际效果调整帧率</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="19.259999999999998%"><p>跟随源帧率场景</p> </td> <td class="cellrowborder" valign="top" width="45.16%"><p>插画动效，固定源帧率动效</p> </td> <td class="cellrowborder" valign="top" width="35.58%"><p>帧率跟随内容源，不建议长时间保持高帧率</p> <p>购物应用首页图标帧动效</p> <p>聊天表情包动效</p> <p>导航主界面</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1748831215172">功耗测试工具<i class="anchor-icon anchor-icon-link" anchorid="section1748831215172" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section01331333101815" class="firsth2">显示手机实时刷新率<i class="anchor-icon anchor-icon-link" anchorid="section01331333101815" tips="复制节点链接"></i></h3><p>打开开发者模式中的"显示刷新频率"开关。具体操作：设置中搜索"开发者" -&gt;  "显示刷新频率"。</p> <p><span><img originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163441.83218476712655467701068346809175:50001231000000:2800:527FF4F77ED8EE05117CC2CDB1FF6DC4478E6A5A1493457049EFC31F79B46765.png" width="320" height="664"></span> <span><img originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163441.39420830143075211678537500211737:50001231000000:2800:2E2E145133D298CB0C1126D8CAF3AD15B3E8075438A607BEFC1A8FBFD224B09A.png" width="320" height="664"></span></p> </div> <div class="tiledSection"><h3 id="section1374705712189">Profiler工具测试手机功耗<i class="anchor-icon anchor-icon-link" anchorid="section1374705712189" tips="复制节点链接"></i></h3><p>1. 启动程序，并将其部署安装到真实手机上。</p> <p>2. 打开工具Profiler，并按图示选择需要监控的设备、app、进程。未启动app会出现设备、app等选项为空的情况，此时不能进行Profiler性能分析。</p> <p><span><img height="351.29764609053495" originheight="716" originwidth="1875" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163441.53160841556737876491396304303848:50001231000000:2800:3A160773AD406DFE3987A67DB47F3486FE4E57BAA9655836D3A7EF1BF8A44979.png" title="点击放大" width="920"></span></p> <p>图中的黄色折线展示整机的电量消耗，斜率为正表示设备耗电，斜率为负表示设备充电。</p> <p>3. 点击会话区“Realtime Monitor”页签上的启动按钮，控制实时监控界面的录制状态。</p> <p>4. 将鼠标悬浮在关注的泳道数据上时，界面上会显示当前时间点的时间标线和详细数据的Tooltips。当鼠标悬浮在时间轴上时，实时监控页面内的所有泳道均会以Tooltips显示该时刻的数据。</p> <p><span><img height="458.15827715355806" originheight="1254" originwidth="2518" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163441.35977178930645062500865729264887:50001231000000:2800:0F41957415FCF0E48EA258029ED2858C653F0947AD560EA5DAB063E3EC4567D8.png" title="点击放大" width="920"></span></p> <p>本文采用的测试方式是让应用运行30秒，每3秒记录一次功耗数据，取设备从第6秒到第21秒的5个节点的平均功耗。此时设备已平稳运行，功耗也趋于稳定。</p> </div> <div class="tiledSection"><h2 id="section172630189174">使用场景<i class="anchor-icon anchor-icon-link" anchorid="section172630189174" tips="复制节点链接"></i></h2><p></p> </div> <div class="tiledSection"><h3 id="section073373341913" class="firsth2">场景说明<i class="anchor-icon anchor-icon-link" anchorid="section073373341913" tips="复制节点链接"></i></h3><p>在具备LTPO屏幕的设备上，基于显示内容的可变帧率能力，可以达到性能体验和功耗间的平衡。HarmonyOS支持可变帧率能力，开发者通过使用可变帧率接口，进行相关业务开发，可以享受可变帧率特性带来的功耗收益。</p> <p>可变帧率能力支持开发者自定义应用业务的帧率，其常见的使用场景：</p> <ul><li>通过配置属性动画/显示动画的帧率属性参数，用于动画的绘制，具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/displaysync-animation" target="_blank">请求动画绘制帧率</a>。</li><li>通过申请一个独立的绘制帧率，用于UI的绘制，具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/displaysync-ui" target="_blank">请求UI绘制帧率</a>。</li><li>通过XComponent在Native侧申请独立的绘制帧率，用于游戏等自绘制内容的绘制，具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/displaysync-xcomponent" target="_blank">请求自绘制内容绘制帧率</a>。</li></ul> <p>基于以上使用场景，结合众多实际开发案例，本文选取两个有代表性的案例展开介绍。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>设置的期望帧率值可能无法完全实现，因为会受到系统能力和屏幕刷新率的限制。</p> </div></div></div> <p></p> <p></p> </div> <div class="tiledSection"><h3 id="section56574413196">基于LTPO实现循环动画<i class="anchor-icon anchor-icon-link" anchorid="section56574413196" tips="复制节点链接"></i></h3></div> <p>针对无限循环的动画效果，如转盘动画，需要特别注意设置动画的可变帧率。长时间保持高帧率可能导致手机发热。</p> <p><strong>效果展示</strong></p> <p><span><img originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163442.95575173189700923166076858575057:50001231000000:2800:1D58A6DDDA516EE7DACCDBCAD88A8DA8E62255AB14EF9BC5144733ED9B7CBBE5.png" width="320" height="664"></span></p> <p><strong>功耗对比</strong></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用DisplaySync去实现转盘动画，通过主动设置可变帧率，可以获取功耗的差异。</p> <p>功耗测试方法参考章节2。</p> </div></div></div> <p>打开手机屏幕刷新率设置，可以查看刷新率变化。使用Profiler工具，可以查看功耗变化。</p> <p><span><img height="434.24367000000007" originheight="535" originwidth="787" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163442.91568861359399151151263239402561:50001231000000:2800:86B2C756BA3E89B1D05DDDBA46B12B6C8748B55A5E7C61074B2EBEEBDC0FCD97.png" title="点击放大" width="635.4075"></span></p> <p>从图中可以发现，当屏幕刷新率降低时，功耗也会降低。</p> <p>传入可变帧率（ExpectedFrameRateRange），屏幕感知并利用LTPO技术降低功耗。屏幕帧率不始终保持最高，功耗较低。</p> <p><strong>实现说明</strong></p> <p>首先，导入模块。</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L3-L3" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { displaySync } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L3-L3" target="_blank">segment.ets</a></div></div></div></div> <p>定义并构建DisplaySync对象。</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L13-L14" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-variable">backDisplaySyncSlow</span>: <span class="hljs-title class_">displaySync</span>.<span class="hljs-title class_">DisplaySync</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li><span class="hljs-keyword">private</span> <span class="hljs-variable">backDisplaySyncFast</span>: <span class="hljs-title class_">displaySync</span>.<span class="hljs-title class_">DisplaySync</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L13-L14" target="_blank">segment.ets</a></div></div></div></div> <p>定义图片组件，添加旋转方法。</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L58-L70" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Row</span>() {</li><li>  <span class="hljs-title function_">Image</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.avatar'</span>))</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)</li><li>}</li><li>.<span class="hljs-title function_">rotate</span>({</li><li>  <span class="hljs-variable">x</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-variable">y</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-variable">z</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-variable">centerX</span>: <span class="hljs-string">'50%'</span>,</li><li>  <span class="hljs-variable">centerY</span>: <span class="hljs-string">'50%'</span>,</li><li>  <span class="hljs-variable">angle</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">rotateAngle</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L58-L70" target="_blank">segment.ets</a></div></div></div></div> <p>使用DisplaySync实例设置帧率并注册订阅函数。</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L33-L38" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">range</span>: <span class="hljs-title class_">ExpectedFrameRateRange</span> = {</li><li>  <span class="hljs-variable">expected</span>: <span class="hljs-number">30</span>,</li><li>  <span class="hljs-variable">min</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-variable">max</span>: <span class="hljs-number">120</span></li><li>};</li><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">backDisplaySyncSlow</span>.<span class="hljs-title function_">setExpectedFrameRateRange</span>(<span class="hljs-variable">range</span>); <span class="hljs-comment">// Setting the frame rate</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L33-L38" target="_blank">segment.ets</a></div></div></div></div> <p>全部代码实现如下</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L2-L86" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { displaySync } from <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-meta">@State</span> drawFirstSize: number = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-meta">@State</span> rotateAngle: number = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> drawSecondSize: number = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-keyword">private</span> backDisplaySyncSlow: displaySync.DisplaySync | undefined = undefined;</li><li>  <span class="hljs-keyword">private</span> backDisplaySyncFast: displaySync.DisplaySync | undefined = undefined;</li><li>  <span class="hljs-keyword">private</span> isBigger30: boolean = <span class="hljs-literal">true</span>;</li><li>
</li><li>  aboutToDisappear() {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.backDisplaySyncSlow) {</li><li>      <span class="hljs-keyword">this</span>.backDisplaySyncSlow.stop(); <span class="hljs-comment">// DisplaySync enable off</span></li><li>      <span class="hljs-keyword">this</span>.backDisplaySyncSlow = undefined; <span class="hljs-comment">// Empty the instance</span></li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.backDisplaySyncFast) {</li><li>      <span class="hljs-keyword">this</span>.backDisplaySyncFast.stop(); <span class="hljs-comment">// DisplaySync enable off</span></li><li>      <span class="hljs-keyword">this</span>.backDisplaySyncFast = undefined; <span class="hljs-comment">// Empty the instance</span></li><li>    }</li><li>  }</li><li>
</li><li>  CreateDisplaySyncSlow() {</li><li>    <span class="hljs-comment">// Defining the Desired Drawing Frame Rate</span></li><li>    <span class="hljs-keyword">this</span>.backDisplaySyncSlow = displaySync.create(); <span class="hljs-comment">// Creating a DisplaySync Instance</span></li><li>    let range: ExpectedFrameRateRange = {</li><li>      expected: <span class="hljs-number">30</span>,</li><li>      min: <span class="hljs-number">0</span>,</li><li>      max: <span class="hljs-number">120</span></li><li>    };</li><li>    <span class="hljs-keyword">this</span>.backDisplaySyncSlow.setExpectedFrameRateRange(range); <span class="hljs-comment">// Setting the frame rate</span></li><li>
</li><li>    let draw30 = (intervalInfo: displaySync.IntervalInfo) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isBigger30) {</li><li>        <span class="hljs-keyword">this</span>.rotateAngle += <span class="hljs-number">1</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">this</span>.rotateAngle -= <span class="hljs-number">1</span>;</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.rotateAngle &lt; <span class="hljs-number">25</span>) {</li><li>          <span class="hljs-keyword">this</span>.isBigger30 = <span class="hljs-literal">true</span>;</li><li>        }</li><li>      }</li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">this</span>.backDisplaySyncSlow.on(<span class="hljs-string">"frame"</span>, draw30); <span class="hljs-comment">// Subscribing to frame events and registering subscription functions</span></li><li>  }</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Row() {</li><li>        Image($r(<span class="hljs-string">'app.media.avatar'</span>))</li><li>          .height(<span class="hljs-number">40</span>)</li><li>          .width(<span class="hljs-number">40</span>)</li><li>      }</li><li>      .rotate({</li><li>        x: <span class="hljs-number">0</span>,</li><li>        y: <span class="hljs-number">0</span>,</li><li>        z: <span class="hljs-number">1</span>,</li><li>        centerX: <span class="hljs-string">'50%'</span>,</li><li>        centerY: <span class="hljs-string">'50%'</span>,</li><li>        angle: <span class="hljs-keyword">this</span>.rotateAngle</li><li>      })</li><li>
</li><li>      Row() {</li><li>        Button(<span class="hljs-string">'Start'</span>)</li><li>          .onClick(() =&gt; {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.backDisplaySyncSlow === undefined) {</li><li>              <span class="hljs-keyword">this</span>.CreateDisplaySyncSlow();</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.backDisplaySyncSlow) {</li><li>              <span class="hljs-keyword">this</span>.backDisplaySyncSlow.start(); <span class="hljs-comment">// DisplaySync enable off</span></li><li>            }</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L2-L86" target="_blank">segment.ets</a></div></div></div></div> <p>上述代码中，设置DisplaySync的可变帧率ExpectedFrameRateRange可以让系统调整屏幕刷新率。若要取消设置可变帧率，可注释以下代码：</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L90-L96" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Note the following lines</span></li><li><span class="hljs-comment">// let range : ExpectedFrameRateRange = {</span></li><li><span class="hljs-comment">//     expected: 30,</span></li><li><span class="hljs-comment">//     min: 0,</span></li><li><span class="hljs-comment">//     max: 120</span></li><li><span class="hljs-comment">// };</span></li><li><span class="hljs-comment">// this.backDisplaySyncSlow.setExpectedFrameRateRange(range);</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/segment/segment.ets#L90-L96" target="_blank">segment.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>不建议将ExpectedFrameRateRange中的expected、min、max都设置为120，这会干扰系统的可变帧率机制，增加负载，影响整机性能和功耗。</p> <p>如setExpectedFrameRateRange({ expected: <span>120</span>, min: <span>120</span>, max: <span>120</span> })。</p> </div></div></div> <div class="tiledSection"><h3 id="section178251521213">基于LTPO实现滑动条<i class="anchor-icon anchor-icon-link" anchorid="section178251521213" tips="复制节点链接"></i></h3><p><strong>效果展示</strong></p> </div> <p><span><img originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163442.91636489059276805208957202843406:50001231000000:2800:2CD2FDEAF7714098F1C03F1A5E3DD6F21D23A75C00D048E27960C0AE56378BBE.png" width="320" height="664"></span></p> <p><strong>功耗对比</strong></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用animateTo实现滑动动画，通过设置可变帧率，可以观察功耗差异。</p> <p>功耗测试方法参考章节2。</p> </div></div></div> <p>开启手机帧率设置，查看帧率变化；使用Profiler工具，查看功耗变化。</p> <p></p> <p><span><img height="263.75895" originheight="510" originwidth="1243" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163442.56201737576372597545096897019926:50001231000000:2800:67E98B04D9F02AB450B3754ED97061D1C87EF77181BE5EDCD01898D7EB401826.png" title="点击放大" width="642.87279"></span></p> <p>屏幕刷新率降低时，功耗也会降低。</p> <p>传入可变帧率（ExpectedFrameRateRange），屏幕感知后充分利用LTPO技术降低功耗。屏幕帧率不始终处于最高，因此功耗较低。</p> <p><strong>代码实现</strong></p> <p>在滑动条中添加onVisibleAreaChange事件，并在回调函数中将滑块的当前值增加到100。</p> <div class="screenLinkPre"><div _ngcontent-jxf-c106="" class="highlight-div"><div _ngcontent-jxf-c106="" class="highlight-div-header"><div _ngcontent-jxf-c106="" class="highlight-div-header-left"><div _ngcontent-jxf-c106="" class="handle-button expand-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jxf-c106="" class="highlight-div-header-right"><div _ngcontent-jxf-c106="" class="handle-button ai-button"></div><div _ngcontent-jxf-c106="" class="handle-button line-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jxf-c106="" class="handle-button theme-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jxf-c106="" class="handle-button copy-button"><div _ngcontent-jxf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jxf-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/view/SampleUnitAVPlayView.ets#L96-L122" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Slider</span>({ <span class="hljs-variable">value</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">curTime</span>, <span class="hljs-variable">min</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">max</span>: <span class="hljs-number">100</span> })</li><li>  .<span class="hljs-title function_">enabled</span>(<span class="hljs-keyword">false</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">4</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>  .<span class="hljs-title function_">trackThickness</span>(<span class="hljs-number">3</span>)</li><li>  .<span class="hljs-title function_">blockColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span>)</li><li>  .<span class="hljs-title function_">blockSize</span>({ <span class="hljs-variable">width</span>: <span class="hljs-number">4</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">4</span> })</li><li>  .<span class="hljs-title function_">onVisibleAreaChange</span>([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], (<span class="hljs-variable">isVisible</span>: <span class="hljs-title class_">boolean</span>, <span class="hljs-variable">currentRatio</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">isVisible</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>        <span class="hljs-variable">duration</span>: <span class="hljs-title class_">DURATION</span>,</li><li>        <span class="hljs-variable">iterations</span>: -<span class="hljs-number">1</span>,</li><li>        <span class="hljs-variable">expectedFrameRateRange</span>: {</li><li>          <span class="hljs-variable">expected</span>: <span class="hljs-number">30</span>,</li><li>          <span class="hljs-variable">min</span>: <span class="hljs-number">0</span>,</li><li>          <span class="hljs-variable">max</span>: <span class="hljs-number">120</span>,</li><li>        },</li><li>      }, () =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">curTime</span> &gt;= <span class="hljs-number">100</span>) {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">curTime</span> = <span class="hljs-number">0</span>;</li><li>        }</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-number">101</span>; <span class="hljs-title class_">i</span>++) {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">curTime</span> += <span class="hljs-number">1</span>;</li><li>        }</li><li>      })</li><li>    }</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/fluent-blog/blob/master/entry/src/main/ets/view/SampleUnitAVPlayView.ets#L96-L122" target="_blank">SampleUnitAVPlayView.ets</a></div></div></div></div> <div class="tiledSection"><h2 id="section58711922131712">总结<i class="anchor-icon anchor-icon-link" anchorid="section58711922131712" tips="复制节点链接"></i></h2><p></p> <p>综上所述，使用LTPO技术可以控制动效刷新率，降低屏幕功耗，延长续航时间，提升使用体验。开发时推荐使用可变帧率接口，享受功耗优化。</p> </div> <div class="tiledSection"><h2 id="section106485111149">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section106485111149" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/fluent-blog" target="_blank">FluentBlog</a></li></ul> </div> </div> <div></div></div>