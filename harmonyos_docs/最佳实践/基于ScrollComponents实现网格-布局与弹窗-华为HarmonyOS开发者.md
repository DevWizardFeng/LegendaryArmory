<h1 _ngcontent-vsx-c119="" class="doc-title ng-star-inserted" title="基于ScrollComponents实现网格"> 基于ScrollComponents实现网格 </h1>

<div _ngcontent-vsx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted renderOptimization" style="position: relative;"> <div><div class="tiledSection" style="contain-intrinsic-size: auto 420px;"><h2 id="section126740590119">概述<i class="anchor-icon anchor-icon-link" anchorid="section126740590119" tips="复制节点链接"></i></h2><p>网格是应用开发中常见的开发场景。它通过相交的横线和竖线，形成整齐有序的网状布局。网格适用于展示图片、媒体文件、购物商品等多种数据。当网格上下滑动时，子组件会带来测量和绘制的性能消耗。本文通过跨页面复用、加速首屏渲染、下拉刷新等场景，介绍ScrollComponents库创建高流畅滑动的网格页面。</p> <p>ScrollComponents作为高性能滑动解决方案，主要解决组件复用的问题，支持通过少量的代码实现高性能滑动，同时开发者无需关注复用池管理和其他性能优化方案的交互细节。可以参考<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/README.md#快速开始" target="_blank">ScrollComponents使用说明</a>进行安装配置与快速上手。ScrollComponents框架提供了下列功能特性：</p> <ul><li>支持List，WaterFlow，Grid三种常见复杂页面的流畅滑动</li><li>默认支持懒加载，开发者不用使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>和定义IDataSource数据源，减少一定的代码量</li><li>支持组件复用，解决滑动丢帧，提升滑动性能</li><li>支持复用池共享，满足跨页面跨父组件复用能力</li><li>支持预创建，减少冷启动首次滑动丢帧，提升滑动性能</li><li>支持预加载，滑动过程提前加载数据，提升浏览体验</li></ul> </div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 160px;"><h2 id="section74193317316">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section74193317316" tips="复制节点链接"></i></h2><ul><li>不支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#设置子组件所占行列数" target="_blank">设置子组件所占行列数</a></li><li>不支持捏合手势识别</li></ul> </div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 80px;"><h2 id="section369151320517">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section369151320517" tips="复制节点链接"></i></h2></div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 654px;"><h3 id="section668114421458" class="firsth2">关键技术<i class="anchor-icon anchor-icon-link" anchorid="section668114421458" tips="复制节点链接"></i></h3><p>ScrollComponents三方库底层封装NodeContainer+FrameNode，结合NodeAdapter+BuildNode+自定义复用池实现懒加载、组件复用、组件预创建等能力，同时为开发者提供WaterFlowManager、ListManager、GridManager等视图管理组件，为开发者提供系统滑动组件的其他各种能力，在满足开发者正常开发的前提下提供高性能的滑动能力，只需要传入数据源和viewManager即可快速实现懒加载和组件复用的开发，可以更加聚焦业务实现。</p> <p>如图1是RecyclerView整体流程图，当节点从可视区移除时，NodeAdapter会通知视图管理器将组件回收，经NodeFactory回收处理之后，组件最终被存入到组件复用池。当节点需要创建时，NodeAdapter通知视图管理器开始创建，NodeFactory会向复用池请求复用节点，获取到节点之后经过一系列更新组件、组件拼接之后返回，最后由NodeAdapter将节点添加到可视区。</p> <div class="fignone"><span class="figcap"><b>图1 </b>RecyclerView整体流程图</span><br><span><img height="370.07250000000005" originheight="9919" originwidth="14031" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162921.52797246431201617472892651579420:50001231000000:2800:41F658E6D743224DD8D26704C63D0AF58849D0C51A0E4EE381A05C0DD06F1DA8.jpg" title="点击放大" width="523.6875"></span></div> </div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 56px;"><h3 id="section8120113914181">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section8120113914181" tips="复制节点链接"></i></h3></div> <ol><li>自定义网格的视图管理器<p>GridManager仅具备基础的视图能力，开发者需要使用组件复用能力，需定义一个继承自GridManager的类，并实现onWillCreateItem()接口，具体可参考<a href="/consumer/cn/doc/best-practices/bpta-grid-based-on-scrollcomponents#li616965082419">4.注册子节点模板</a>。核心代码如下：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L17-L110" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">GridManager</span>, <span class="hljs-variable">NodeItem</span>, <span class="hljs-variable">RecyclerView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@hadss/scroll_components"</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WordGridComponent</span> {</li><li>  <span class="hljs-variable">gridViewManager</span>: <span class="hljs-title class_">GridViewManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">GridViewManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'word'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>() });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">GridViewManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">GridManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">WordViewModel</span>) {</li><li>    <span class="hljs-comment">// get node based on identifier 'word' from recycle pool.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">WordCellData</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'word'</span>);</li><li>    <span class="hljs-variable">node</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">word</span>: <span class="hljs-title class_">data</span> })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L17-L110" target="_blank">WordGridComponent.ets</a></div></div></div></div> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果开发者想通过ScrollComponents快速创建网格，方便使用懒加载、预创建等提升滑动效率的能力，而不考虑组件复用，则直接使用ScrollComponents库提供的GridManager创建网格视图管理器即可。具体可参考<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/README.md#快速开始" target="_blank">ScrollComponents使用说明</a>。</p> </div></div></div> </li></ol><ol start="2"><li>网格组件初始化<p>页面初始化时，开发者通过视图管理器的setViewStyle()接口，给视图设置对应的视图属性。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L47-L84" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.setViewStyle()</li><li>    .alignItems(GridItemAlignment.STRETCH);</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.setViewStyle()</li><li>    .columnsTemplate(<span class="hljs-string">'repeat(auto-fill, 70)'</span>)</li><li>    .columnsGap(<span class="hljs-number">5</span>)</li><li>    .rowsGap(<span class="hljs-number">5</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L47-L84" target="_blank">WordGridComponent.ets</a></div></div></div></div> </li></ol><ol start="3"><li>设置数据源并渲染组件<ol><li>开发者通过自定义的视图管理器调用setDataSource()方法设置数据。ScrollComponent库默认支持懒加载，提供了基于懒加载的数据增删改查能力，开发者无需关心LazyForEach的使用限制，无需定义DataSource，引入即用。懒加载接口可参考：<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/docs/Reference.md#lazynodeadapter-类" target="_blank">基于NodeAdapter为视图管理器提供懒加载能力</a>。</li><li>开发者通过自定义的视图管理器调用registerNodeItem()接口，注册item子节点模板，传入模板名称和节点构建函数。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L18-L99" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GridManager</span>, <span class="hljs-title class_">NodeItem</span>, <span class="hljs-title class_">RecyclerView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@hadss/scroll_components"</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">WordGridViewModel</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../viewModel/WordGridViewModel"</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">WordViewModel</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../viewModel/WordViewModel"</span>;</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> struct <span class="hljs-title class_">WordGridComponent</span> {</li><li>  <span class="hljs-attr">gridViewManager</span>: <span class="hljs-title class_">GridViewManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridViewManager</span>({ <span class="hljs-attr">defaultNodeItem</span>: <span class="hljs-string">'word'</span>, <span class="hljs-attr">context</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>() });</li><li>  <span class="hljs-attr">viewModel</span>: <span class="hljs-title class_">WordGridViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordGridViewModel</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// associates the builder with the identifier 'word'.</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'word'</span>, <span class="hljs-title function_">wrapBuilder</span>(buildWordCell));</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewModel</span>.<span class="hljs-title function_">loadData</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// place the grid in a column.</span></li><li>      <span class="hljs-title class_">RecyclerView</span>({</li><li>        <span class="hljs-attr">viewManager</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L18-L99" target="_blank">WordGridComponent.ets</a></div></div></div></div> <p></p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WordGridViewModel.ets#L21-L47" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordGridViewModel</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">WordViewModel</span>[] = [];</li><li>  gridViewManager?: <span class="hljs-title class_">GridManager</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// simulated request data.</span></li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">15</span>; index++) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">viewModel</span>: <span class="hljs-title class_">WordViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordViewModel</span>();</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(viewModel);</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>?.<span class="hljs-title function_">setDataSource</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>);</li><li>    }, <span class="hljs-number">100</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WordGridViewModel.ets#L21-L47" target="_blank">WordGridViewModel.ets</a></div></div></div></div> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>1. 注册子节点模板块方法registerNodeItem()中使用@builder函数目前仅支持全局。</p> <p>2. 开发者如果使用this.gridViewManager.preCreate()实现组件预创建，则需要在注册节点模板后预创建组件。</p> </div></div></div> </li></ol> </li></ol><ol start="4"><li id="li616965082419"><a name="ZH-CN_TOPIC_0000002490866904__li616965082419"></a><a name="li616965082419"></a><span>注册子节点模板</span><p>开发者自定义模板后，在定义视图管理器时需要实现onWillCreateItem()接口，并在此接口中通过dequeueReusableNodeByType()获取可复用node，实现组件复用，同时也需要在复用组件的aboutToReuse生命期中，对数据进行更新。</p> <ol><li>单元格结构类型相同<p>如果复用的单元格组件结构相同，数据不同时，直接注册节点模板。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L24-L109" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">WordCell</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./WordCellComponent"</span>;</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * define item template.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * @param data data of node</span></li><li><span class="hljs-comment"> */</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">buildWordCell</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">WordCellData</span>) {</li><li>  <span class="hljs-title function_">WordCell</span>({ <span class="hljs-variable">word</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">word</span> })</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WordGridComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// associates the builder with the identifier 'word'.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'word'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildWordCell</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">GridViewManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">GridManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">WordViewModel</span>) {</li><li>    <span class="hljs-comment">// get node based on identifier 'word' from recycle pool.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">WordCellData</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'word'</span>);</li><li>    <span class="hljs-variable">node</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">word</span>: <span class="hljs-title class_">data</span> })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L24-L109" target="_blank">WordGridComponent.ets</a></div></div></div></div> </li><li>单元格内子组件可拆分组合<p>如果复用的单元格组件结构基本相同，存在部分差异，差异的部分会复用失效。ScrollComponents提供了PartReuse来保证命中组件复用。</p> <div class="fignone"><span class="figcap"><b>图2 </b>可拆分组件复用创建流程图</span><br><span><img height="370.07250000000005" originheight="9919" originwidth="14031" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162922.70522631261469374277627513789614:50001231000000:2800:4CE3E52869D46A8E098AB804298C187FA8FB6F6E360F08DD3F9FCD7A1ECC5E9D.jpg" title="点击放大" width="523.6875"></span></div> <p>开发者可参考图3日志打印"generateItem reuse "表示复用，检验是否复用成功。</p> <div class="fignone"><span class="figcap"><b>图3 </b>日志效果图</span><br><span><img height="119.7" originheight="415" originwidth="1808" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162923.07033981999305416194103946127566:50001231000000:2800:FB9F8DF4188D0426D31B112F5089E508B4F37C8D5C5D136458612FA541E8BFDE.png" title="点击放大" width="523.6875"></span></div> <p>子组件1：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/UserCardComponent.ets#L20-L97" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// child component in item</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> struct <span class="hljs-title class_">UserCardComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">UserInfoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfoViewModel</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, ESObject&gt;</span>) {</li><li>    <span class="hljs-keyword">let</span> input = params <span class="hljs-keyword">as</span> <span class="hljs-title class_">CardCellData</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = input.<span class="hljs-property">user</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildUserCard</span>(<span class="hljs-params">params: CardCellData</span>) {</li><li>  <span class="hljs-title class_">UserCardComponent</span>({ <span class="hljs-attr">user</span>: params.<span class="hljs-property">user</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/UserCardComponent.ets#L20-L97" target="_blank">UserCardComponent.ets</a></div></div></div></div> <p>子组件2：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/ManagerCardComponent.ets#L20-L100" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// child component in item</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> struct <span class="hljs-title class_">ManagerCardComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">UserInfoViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfoViewModel</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, ESObject&gt;</span>) {</li><li>    <span class="hljs-keyword">let</span> input = params <span class="hljs-keyword">as</span> <span class="hljs-title class_">CardCellData</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = input.<span class="hljs-property">user</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildManagerCard</span>(<span class="hljs-params">params: CardCellData</span>) {</li><li>  <span class="hljs-title class_">ManagerCardComponent</span>({ <span class="hljs-attr">user</span>: params.<span class="hljs-property">user</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/ManagerCardComponent.ets#L20-L100" target="_blank">ManagerCardComponent.ets</a></div></div></div></div> <p>单元格组件：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardComponent.ets#L24-L96" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// item component</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CardComponent</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">user</span>: <span class="hljs-title class_">UserInfoViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">UserInfoViewModel</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-variable">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">ESObject</span>&gt;) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">input</span> = <span class="hljs-variable">params</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">CardCellData</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">user</span> = <span class="hljs-variable">input</span>.<span class="hljs-variable">user</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">user</span>.<span class="hljs-variable">role</span> === <span class="hljs-string">'manager'</span>) {</li><li>        <span class="hljs-comment">// when need to reuse a subcomponent, use PartReuse to encapsulate it.</span></li><li>        <span class="hljs-title function_">PartReuse</span>({</li><li>          <span class="hljs-keyword">type</span>: <span class="hljs-string">'manager'</span>,</li><li>          <span class="hljs-variable">builder</span>: <span class="hljs-title class_">wrapBuilder</span>(<span class="hljs-title class_">buildManagerCard</span>),</li><li>          <span class="hljs-variable">data</span>: {</li><li>            <span class="hljs-variable">user</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">user</span></li><li>          }</li><li>        })</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">PartReuse</span>({</li><li>          <span class="hljs-keyword">type</span>: <span class="hljs-string">'user'</span>,</li><li>          <span class="hljs-variable">builder</span>: <span class="hljs-title class_">wrapBuilder</span>(<span class="hljs-title class_">buildUserCard</span>),</li><li>          <span class="hljs-variable">data</span>: {</li><li>            <span class="hljs-variable">user</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">user</span></li><li>          }</li><li>        })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">bindContextMenu</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">optMenu</span>(), <span class="hljs-variable">ResponseType</span>.<span class="hljs-variable">LongPress</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">buildCard</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">CardCellData</span>) {</li><li>  <span class="hljs-title function_">CardComponent</span>({ <span class="hljs-variable">user</span>: <span class="hljs-title class_">data</span>.<span class="hljs-title class_">user</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardComponent.ets#L24-L96" target="_blank">CardComponent.ets</a></div></div></div></div> <p>组件注册：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L25-L211" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// card grid view</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CardGridComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// register the reusable template.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"card"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildCard</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"user"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildUserCard</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"manager"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildManagerCard</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">Bottom</span> }) {</li><li>      <span class="hljs-comment">// main grid</span></li><li>      <span class="hljs-title function_">RecyclerView</span>({</li><li>        <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">gridViewManager</span></li><li>      })</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * grid manager class</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">GridViewManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">GridManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">UserInfoViewModel</span>): <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">CardCellData</span>&gt; | <span class="hljs-title class_">null</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">CardCellData</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'card'</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">user</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L25-L211" target="_blank">CardGridComponent.ets</a></div></div></div></div> </li><li>单元格结构类型不同<p>如果GridItem结构差异较大，包括布局差异大、差异的组件数量较多、组件类型不同等因素，导致直接复用GridItem困难，则可定义多个复用模板。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L27-L245" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WorkComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"video"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildVideoWork</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"picture"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildPictureWork</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">"photoContainer"</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">buildPhoto</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * grid manager class</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">GridViewManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">GridManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">WorkViewModel</span>): <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">WorkCellData</span>&gt; | <span class="hljs-title class_">null</span> {</li><li>    <span class="hljs-comment">// select the corresponding template according to the data type.</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">WorkCellData</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-variable">data</span>.<span class="hljs-keyword">type</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">work</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L27-L245" target="_blank">WorkComponent.ets</a></div></div></div></div> </li></ol> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section130953914815">网格跨页面复用场景<i class="anchor-icon anchor-icon-link" anchorid="section130953914815" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section035711511495" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section035711511495" tips="复制节点链接"></i></h3><p>开发者可能存在多个页面间复用Grid，比如tab栏切换。ScrollComponents提供了全局复用能力。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section5496029104914">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section5496029104914" tips="复制节点链接"></i></h3></div> <ol><li>定义复用池单例<p>RecyclerView默认会生成一个RecycledPool，通过定义复用池单例存储该pool，提供跨页面使用。以下单例仅做参考，开发者可自行封装。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/common/util/Utils.ets#L17-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">RecycledPool</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hadss/scroll_components'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Utils</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">utils_</span>: <span class="hljs-title class_">Utils</span>;</li><li>  <span class="hljs-attr">nodePool</span>: <span class="hljs-title class_">RecycledPool</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/common/util/Utils.ets#L17-L37" target="_blank">Utils.ets</a></div></div></div></div> </li><li>复用池单例保存RecycledPool<p>GridManager提供getRecyclePool()方法可获取RecycledPool，然后存储在全局单例中。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L28-L230" data-highlighted="yes"><ol class="linenums"><li>@Component</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WorkComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-built_in">aboutToAppear</span>(): <span class="hljs-type">void</span> {</li><li>    <span class="hljs-keyword">if</span> (Utils.<span class="hljs-built_in">getInstance</span>().nodePool) {</li><li>      <span class="hljs-keyword">this</span>.gridViewManager.<span class="hljs-built_in">registerRecyclePool</span>(Utils.<span class="hljs-built_in">getInstance</span>().nodePool!);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-comment">// save recycle pool.</span></li><li>      Utils.<span class="hljs-built_in">getInstance</span>().nodePool = <span class="hljs-keyword">this</span>.gridViewManager.<span class="hljs-built_in">getRecyclePool</span>();</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L28-L230" target="_blank">WorkComponent.ets</a></div></div></div></div> </li></ol><ol start="3"><li>跨页面共享单例中的RecycledPool<p>跨页面使用registerRecyclePool，将全局单例中的RecyclePool注册到该页面定义的Grid视图类对象上，实现跨页面不同RecyclerView视图的复用池共享。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L25-L138" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>export default struct PhotoGridComponent {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  aboutToAppear(): void {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">if</span> (Utils.getInstance().nodePool) {</li><li>      <span class="hljs-comment">// register recycle pool.</span></li><li>      <span class="hljs-keyword">this</span>.gridViewManager.registerRecyclePool(Utils.getInstance().nodePool!);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      Utils.getInstance().nodePool = <span class="hljs-keyword">this</span>.gridViewManager.getRecyclePool();</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// register template after register recycle pool.</span></li><li>    <span class="hljs-keyword">this</span>.gridViewManager.registerNodeItem(<span class="hljs-string">'photoContainer'</span>, wrapBuilder(buildPhoto));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L25-L138" target="_blank">PhotoGridComponent.ets</a></div></div></div></div> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section16992125615535">网格加速首屏渲染场景<i class="anchor-icon anchor-icon-link" anchorid="section16992125615535" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section14793142415419" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section14793142415419" tips="复制节点链接"></i></h3><p>冷启动后首次打开网格页面，由于页面的图片或者视频等媒体资源过多，出现白屏或者白块，等好几秒才缓慢刷出内容。ScrollComponents库支持组件预创建，能打开页面后瞬间看到文字、图片骨架，减少卡顿。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 531px;"><h3 id="section1056613503547">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1056613503547" tips="复制节点链接"></i></h3><p>核心代码参考如下：</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L36-L122" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// register the reusable template.</span></li><li>  <span class="hljs-keyword">this</span>.gridViewManager.registerNodeItem(<span class="hljs-string">"card"</span>, wrapBuilder(buildCard));</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.registerNodeItem(<span class="hljs-string">"user"</span>, wrapBuilder(buildUserCard));</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.registerNodeItem(<span class="hljs-string">"manager"</span>, wrapBuilder(buildManagerCard));</li><li>  <span class="hljs-comment">// key point: `preCreate()` pre-creates the reusable template,</span></li><li>  <span class="hljs-comment">// which must be registered before the reusable template.</span></li><li>  <span class="hljs-keyword">this</span>.gridViewManager.preCreate(<span class="hljs-string">"card"</span>);</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.preCreate(<span class="hljs-string">"user"</span>);</li><li>  <span class="hljs-keyword">this</span>.gridViewManager.preCreate(<span class="hljs-string">"manager"</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L36-L122" target="_blank">CardGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section9765142395519">性能测试<i class="anchor-icon anchor-icon-link" anchorid="section9765142395519" tips="复制节点链接"></i></h3><p>加载相同数据冷启动场景完成时延情况，通过延迟1s模拟冷启动后网络请求场景</p> </div> <p>@Reusable：网络请求期间主线程大段空闲，请求结束后首屏组件绘帧耗时较长</p> <div class="fignone"><span class="figcap"><b>图4 </b>@Reusable测试结果</span><br><span><img height="233.41500000000002" originheight="834" originwidth="1869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162923.85430020960403611145953629438652:50001231000000:2800:B720889E99B5CB83C06D02D27780BDDB261969243878B9FDFAB5F7F2B3E9061D.png" title="点击放大" width="523.6875"></span></div> <p>ScrollComponents：网络请求期间主线程空闲较少，请求结束后首屏组件绘帧耗时较短</p> <div class="fignone"><span class="figcap"><b>图5 </b>ScrollComponents测试结果</span><br><span><img height="233.41500000000002" originheight="834" originwidth="1869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162923.72922569231482512740918276307408:50001231000000:2800:0369001CAA7F21419D03AC7972829C0A224A3E8EBA4DF81594B7B5BCA5B8ACEC.png" title="点击放大" width="523.6875"></span></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.23.2.5.1.1" valign="top" width="25%"><p>实现方式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.2.5.1.2" valign="top" width="25%"><p>冷启动完成时延</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.2.5.1.3" valign="top" width="25%"><p>主线程空闲时间</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.2.5.1.4" valign="top" width="25%"><p>首屏组件创建时间</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>ScrollComponents</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2.5s</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>281ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>223ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>@Reusable</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2.8s</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>997ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>467ms</p> </td> </tr>  </tbody></table></div> </div> <p>结论：ScrollComponents在冷启动场景下，完成时延优于原生@Reusable。整体完成时延优化300ms。</p> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section11524131755911">网格下拉刷新场景<i class="anchor-icon anchor-icon-link" anchorid="section11524131755911" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section19162035175916" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section19162035175916" tips="复制节点链接"></i></h3><p>下拉刷新是提升用户体验的关键功能，即要保证数据无缝加载，又要维持流畅的交互效果。下拉刷新场景下使用懒加载刷新避免媒体资源加载造成UI渲染阻塞。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh#示例6实现下拉刷新上拉加载更多" target="_blank">Refresh示例6实现下拉刷新上拉加载更多</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1616px;"><h3 id="section202571656145917">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section202571656145917" tips="复制节点链接"></i></h3><ol><li>使用Refresh组件扩展下拉刷新状态回调。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L29-L231" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WorkComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable">gridViewManager</span>: <span class="hljs-title class_">GridViewManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">GridViewManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'video'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>() });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">viewModel</span>: <span class="hljs-title class_">WorkGridViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">WorkGridViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Refresh</span>({ <span class="hljs-variable">refreshing</span>: $$<span class="hljs-keyword">this</span>.<span class="hljs-title class_">viewModel</span>.<span class="hljs-title class_">isRefresh</span>, <span class="hljs-variable">builder</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">refreshBuilder</span>() }) {</li><li>      <span class="hljs-comment">// ...</span></li><li>            <span class="hljs-comment">// main grid</span></li><li>            <span class="hljs-title function_">RecyclerView</span>({</li><li>              <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">gridViewManager</span></li><li>            })</li><li>            <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    .<span class="hljs-title function_">onRefreshing</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">viewModel</span>.<span class="hljs-title function_">refreshData</span>();</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L29-L231" target="_blank">WorkComponent.ets</a></div></div></div></div> </li></ol><ol start="2"><li>接收回调后触发数据刷新<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L22-L147" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkGridViewModel</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">isRefresh</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  gridViewManager?: <span class="hljs-title class_">GridManager</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">gridViewManager: GridManager</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span> = gridViewManager;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">loadData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-comment">// refresh data source</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>?.<span class="hljs-property">nodeAdapter</span>.<span class="hljs-title function_">deleteData</span>(<span class="hljs-number">0</span>, lastLength);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>?.<span class="hljs-title function_">setDataSource</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>);</li><li>    }, <span class="hljs-number">200</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * refresh display data</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">refreshData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefresh</span> = <span class="hljs-literal">false</span>;</li><li>    }, <span class="hljs-number">1000</span>);</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L22-L147" target="_blank">WorkGridViewModel.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section2740156376">网格上拉加载更多场景<i class="anchor-icon anchor-icon-link" anchorid="section2740156376" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section12631181117811" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section12631181117811" tips="复制节点链接"></i></h3><p>当开发网格页面涉及大量数据，需要进行分页或分批次进行请求时，结合ScrollComponents提供的懒加载能力实现加载更多的效果。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh#示例6实现下拉刷新上拉加载更多" target="_blank">Refresh示例6实现下拉刷新上拉加载更多</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1640px;"><h3 id="section28153119817">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section28153119817" tips="复制节点链接"></i></h3><ol><li>增加监听事件onScrollIndex()<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L30-L232" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">WorkComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable">gridViewManager</span>: <span class="hljs-title class_">GridViewManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">GridViewManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'video'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>() });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">viewModel</span>: <span class="hljs-title class_">WorkGridViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">WorkGridViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">setViewStyle</span>()</li><li>      .<span class="hljs-title function_">onScrollIndex</span>((<span class="hljs-variable">start</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">end</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>        <span class="hljs-comment">// listen the scroll position.</span></li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">viewModel</span>.<span class="hljs-title function_">loadMore</span>(<span class="hljs-variable">end</span>);</li><li>      });</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L30-L232" target="_blank">WorkComponent.ets</a></div></div></div></div> </li><li>触发回调，请求数据并追加到数据源<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L23-L148" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li>export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkGridViewModel</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-meta">@Track</span> isLoading = <span class="hljs-literal">false</span>;</li><li>  gridViewManager?: GridManager;</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * mock load more data when reach end</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> last current last index</span></li><li><span class="hljs-comment">   */</span></li><li>  loadMore(last: number) {</li><li>    <span class="hljs-keyword">if</span> (last &gt;= <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length - <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.worksCount &gt; <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length) {</li><li>      <span class="hljs-keyword">this</span>.isLoading = <span class="hljs-literal">true</span>;</li><li>      setTimeout(() =&gt; {</li><li>        <span class="hljs-keyword">for</span> (let index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10</span>; index++) {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length + index &lt; <span class="hljs-keyword">this</span>.worksCount) {</li><li>            <span class="hljs-keyword">this</span>.gridViewManager?.nodeAdapter.pushData([<span class="hljs-keyword">this</span>.generateData()]);</li><li>            <span class="hljs-keyword">this</span>.isLoading = <span class="hljs-literal">false</span>;</li><li>          }</li><li>        }</li><li>      }, <span class="hljs-number">200</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * generate mock Work</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@returns</span> work data</span></li><li><span class="hljs-comment">   */</span></li><li>  generateData(): WorkViewModel {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L23-L148" target="_blank">WorkGridViewModel.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section439685818813">网格设置排列方式场景<i class="anchor-icon anchor-icon-link" anchorid="section439685818813" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 136px;"><h3 id="section737519103910" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section737519103910" tips="复制节点链接"></i></h3><ul><li>通过设置行列数量与尺寸占比可以确定网格布局的整体排列方式</li><li>通过layoutDirection设置网格布局的主轴方向</li></ul> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section1667915372096">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1667915372096" tips="复制节点链接"></i></h3></div> <div class="tiledSection" style="contain-intrinsic-size: auto 375px;"><h3 id="section419911586910">设置行列数量与占比<i class="anchor-icon anchor-icon-link" anchorid="section419911586910" tips="复制节点链接"></i></h3><div class="p">通过设置行列数量与尺寸占比可以确定网格布局的整体排列方式。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#设置行列数量与占比" target="_blank">Grid设置行列数量与占比</a>。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L35-L80" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">this</span>.gridViewManager.setViewStyle()</li><li>    .columnsTemplate(<span class="hljs-keyword">this</span>.viewModel.columnsTemplate);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L35-L80" target="_blank">PhotoGridComponent.ets</a></div></div></div></div> </div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 375px;"><h3 id="section1547192918101">设置主轴方向<i class="anchor-icon anchor-icon-link" anchorid="section1547192918101" tips="复制节点链接"></i></h3><div class="p">通过layoutDirection设置网格布局的主轴方向，决定子组件的排列方式。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#设置主轴方向" target="_blank">Grid设置主轴方向</a>。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L36-L79" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  this<span class="hljs-selector-class">.gridViewManager</span><span class="hljs-selector-class">.setViewStyle</span>()</li><li>    <span class="hljs-selector-class">.layoutDirection</span>(GridDirection.Row);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/PhotoGridComponent.ets#L36-L79" target="_blank">PhotoGridComponent.ets</a></div></div></div></div> </div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section11538112619115">网格布局中显示数据的场景<i class="anchor-icon anchor-icon-link" anchorid="section11538112619115" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section8704256101118" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section8704256101118" tips="复制节点链接"></i></h3><p>可以通过在单元格组件中添加文本等组件在网格中显示数据。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#在网格布局中显示数据" target="_blank">Grid在网格布局中显示数据</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 651px;"><h3 id="section1324861519127">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1324861519127" tips="复制节点链接"></i></h3><p>在单元格组件中添加文本组件进行数据显示。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordCellComponent.ets#L20-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// item component</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> struct <span class="hljs-title class_">WordCell</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">word</span>: <span class="hljs-title class_">WordViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordViewModel</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, ESObject&gt;</span>) {</li><li>    <span class="hljs-keyword">let</span> input = params <span class="hljs-keyword">as</span> <span class="hljs-title class_">WordCellData</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">word</span> = input.<span class="hljs-property">word</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-comment">// define a text component that displays data in a cell after receiving it.</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">word</span>.<span class="hljs-property">value</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>      <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordCellComponent.ets#L20-L45" target="_blank">WordCellComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section1832121614137">网格设置行列间距场景<i class="anchor-icon anchor-icon-link" anchorid="section1832121614137" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section19873133511134" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section19873133511134" tips="复制节点链接"></i></h3><p>在两个网格单元之间的网格横向间距称为行间距，网格纵向间距称为列间距。通过rowsGap和columnsGap可以设置网格布局的行列间距。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#设置行列间距" target="_blank">Grid设置行列间距</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 387px;"><h3 id="section1993174520135">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1993174520135" tips="复制节点链接"></i></h3><p>分别设置columnsGap和rowsGap为8vp。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L37-L121" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  this<span class="hljs-selector-class">.gridViewManager</span><span class="hljs-selector-class">.setViewStyle</span>()</li><li>    <span class="hljs-selector-class">.columnsGap</span>(<span class="hljs-number">8</span>) <span class="hljs-comment">// set column spacing to 8vp. </span></li><li>    <span class="hljs-selector-class">.rowsGap</span>(<span class="hljs-number">8</span>); <span class="hljs-comment">// set row spacing to 8vp.</span></li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L37-L121" target="_blank">CardGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section714718123158">网格构建可滚动的布局场景<i class="anchor-icon anchor-icon-link" anchorid="section714718123158" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section1934131812156" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1934131812156" tips="复制节点链接"></i></h3><p>通过columnsTemplate和rowsTemplate可以让网格拥有滚动能力。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#构建可滚动的网格布局" target="_blank">Grid构建可滚动的网格布局</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 387px;"><h3 id="section1312515271517">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1312515271517" tips="复制节点链接"></i></h3><p>通过columnsTemplate设置网格为三列等份网格。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L38-L120" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// only set the columnsTemplate property. when the content exceeds the grid area, it can be scrolled vertically.</span></li><li>  this<span class="hljs-selector-class">.gridViewManager</span><span class="hljs-selector-class">.setViewStyle</span>()</li><li>    <span class="hljs-selector-class">.columnsTemplate</span>("<span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr");</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L38-L120" target="_blank">CardGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section168720566161">网格控制滚动位置场景<i class="anchor-icon anchor-icon-link" anchorid="section168720566161" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section185281121715" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section185281121715" tips="复制节点链接"></i></h3><p>通过对设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scroller" target="_blank">Scroller</a>对象，可以进行滚动控制。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-grid#控制滚动位置" target="_blank">Grid控制滚动位置</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 2120px;"><h3 id="section146061411131718">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section146061411131718" tips="复制节点链接"></i></h3><ol><li>绑定Scroller对象<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L26-L199" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// card grid view</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CardGridComponent</span> {</li><li>  <span class="hljs-variable">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Scroller</span>();</li><li>  <span class="hljs-variable">gridViewManager</span>: <span class="hljs-title class_">GridViewManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">GridViewManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">"card"</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>() });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">viewModel</span>: <span class="hljs-title class_">CardGridViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CardGridViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">setViewStyle</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">Bottom</span> }) {</li><li>      <span class="hljs-comment">// main grid</span></li><li>      <span class="hljs-title function_">RecyclerView</span>({</li><li>        <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">gridViewManager</span></li><li>      })</li><li>
</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-comment">// button goto pre page</span></li><li>        <span class="hljs-title function_">Button</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">viewModel</span>.<span class="hljs-title function_">prePage</span>();</li><li>        })</li><li>
</li><li>        <span class="hljs-comment">// button goto next page</span></li><li>        <span class="hljs-title function_">Button</span>() {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">viewModel</span>.<span class="hljs-title function_">nextPage</span>();</li><li>        })</li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L26-L199" target="_blank">CardGridComponent.ets</a></div></div></div></div> </li></ol><ol start="2"><li>通过Scroller对象的scrollPage方法进行翻页。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/CardGridViewModel.ets#L23-L147" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CardGridViewModel</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  gridViewManager?: <span class="hljs-title class_">GridManager</span>;</li><li>  scroller?: <span class="hljs-title class_">Scroller</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">gridViewManager: GridManager, scroller: Scroller</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span> = gridViewManager;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> = scroller;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * goto pre page</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">prePage</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>?.<span class="hljs-title function_">scrollPage</span>({</li><li>      <span class="hljs-attr">next</span>: <span class="hljs-literal">false</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * goto next page.</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">nextPage</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>?.<span class="hljs-title function_">scrollPage</span>({</li><li>      <span class="hljs-attr">next</span>: <span class="hljs-literal">true</span></li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/CardGridViewModel.ets#L23-L147" target="_blank">CardGridViewModel.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section12584134581715">网格嵌套滚动场景<i class="anchor-icon anchor-icon-link" anchorid="section12584134581715" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section16404135851714" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section16404135851714" tips="复制节点链接"></i></h3><p>通过nestedScroll和onScrollFrameBegin设置嵌套滚动效果。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例4grid嵌套滚动" target="_blank">Grid示例4grid嵌套滚动</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 435px;"><h3 id="section143846551812">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section143846551812" tips="复制节点链接"></i></h3><p>通过nestedScroll设置前后两个方向的嵌套滚动模式，实现与父组件的滚动联动。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L53-L124" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">setViewStyle</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>)</li><li>    .<span class="hljs-title function_">nestedScroll</span>({</li><li>      <span class="hljs-variable">scrollForward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">PARENT_FIRST</span>,</li><li>      <span class="hljs-variable">scrollBackward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">SELF_FIRST</span></li><li>    });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L53-L124" target="_blank">WorkComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section3564125415189">网格拖拽场景<i class="anchor-icon anchor-icon-link" anchorid="section3564125415189" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section199759910196" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section199759910196" tips="复制节点链接"></i></h3><p>通过对拖拽事件处理和数据交换逻辑可以实现单元格拖拽效果。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例5grid拖拽场景" target="_blank">Grid示例5grid拖拽场景</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1728px;"><h3 id="section7715171612191">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section7715171612191" tips="复制节点链接"></i></h3><ol><li>设置属性editMode(true)设置网格是否进入编辑模式，进入编辑模式可以拖拽网格组件内部单元格。</li><li>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#onitemdragstart8" target="_blank">onItemDragStart</a>回调中设置拖拽过程中显示的图片。</li><li>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#onitemdrop8" target="_blank">onItemDrop</a>中获取拖拽起始位置，和拖拽插入位置，并在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#onitemdrop8" target="_blank">onItemDrop</a>中完成转移数组位置逻辑。<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L31-L229" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> struct <span class="hljs-title class_">WorkComponent</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">workModel</span>: <span class="hljs-title class_">WorkViewModel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WorkViewModel</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>.<span class="hljs-title function_">setViewStyle</span>()</li><li>      .<span class="hljs-title function_">editMode</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">onItemDragStart</span>(<span class="hljs-function">(<span class="hljs-params">event: ItemDragInfo, itemIndex: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> model = <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewModel</span>.<span class="hljs-title function_">getItemData</span>(itemIndex);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">workModel</span> = model;</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildDrag</span>();</li><li>      })</li><li>      .<span class="hljs-title function_">onItemDrop</span>(<span class="hljs-function">(<span class="hljs-params">event: ItemDragInfo, itemIndex: <span class="hljs-built_in">number</span>, insertIndex: <span class="hljs-built_in">number</span>, isSuccess: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (!isSuccess) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewModel</span>.<span class="hljs-title function_">move</span>(itemIndex, insertIndex);</li><li>      });</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">buildDrag</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">workModel</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'video'</span>) {</li><li>        <span class="hljs-title function_">buildVideoWork</span>({ <span class="hljs-attr">work</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">workModel</span> });</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">buildPictureWork</span>({ <span class="hljs-attr">work</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">workModel</span> });</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">125</span>)</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L31-L229" target="_blank">WorkComponent.ets</a></div></div></div></div> <p></p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L24-L146" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkGridViewModel</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  gridViewManager?: <span class="hljs-title class_">GridManager</span>;</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * move work index</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> fromIndex source index</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> toIndex target index</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">move</span>(<span class="hljs-params">fromIndex: <span class="hljs-built_in">number</span>, toIndex: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (toIndex &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>?.<span class="hljs-property">nodeAdapter</span>.<span class="hljs-title function_">moveData</span>(fromIndex, toIndex);</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/WorkGridViewModel.ets#L24-L146" target="_blank">WorkGridViewModel.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section769154551917">网格自适应场景<i class="anchor-icon anchor-icon-link" anchorid="section769154551917" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section15510165911917" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section15510165911917" tips="复制节点链接"></i></h3><p>通过layoutDirection、maxCount、minCount、cellLength实现自适应效果。rowsTemplate、columnsTemplate都不设置layoutDirection、maxCount、minCount、cellLength才生效。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例6自适应grid" target="_blank">Grid示例6自适应grid</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 507px;"><h3 id="section125710952014">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section125710952014" tips="复制节点链接"></i></h3><p>通过设置maxCount、minCount、cellLength实现自适应。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/NumberGridComponent.ets#L27-L47" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>() {</li><li>  this<span class="hljs-selector-class">.gridViewManager</span><span class="hljs-selector-class">.setViewStyle</span>()</li><li>    <span class="hljs-selector-class">.width</span>("<span class="hljs-number">90%</span>")</li><li>    <span class="hljs-selector-class">.columnsGap</span>(<span class="hljs-number">10</span>)</li><li>    <span class="hljs-selector-class">.rowsGap</span>(<span class="hljs-number">5</span>)</li><li>    <span class="hljs-selector-class">.maxCount</span>(<span class="hljs-number">10</span>)</li><li>    <span class="hljs-selector-class">.minCount</span>(<span class="hljs-number">2</span>)</li><li>    <span class="hljs-selector-class">.cellLength</span>(<span class="hljs-number">0</span>)</li><li>    <span class="hljs-selector-class">.border</span>({ color: Color.Black, width: <span class="hljs-number">1</span> });</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/NumberGridComponent.ets#L27-L47" target="_blank">NumberGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section17051032112013">网格自适应列数场景<i class="anchor-icon anchor-icon-link" anchorid="section17051032112013" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section191913459208" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section191913459208" tips="复制节点链接"></i></h3><p>通过属性columnsTemplate中auto-fill、auto-fit和auto-stretch实现列数自适应效果。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例8设置自适应列数" target="_blank">Grid示例8设置自适应列数</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 411px;"><h3 id="section137481949142014">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section137481949142014" tips="复制节点链接"></i></h3><p>通过设置columnsTemplate为repeat(auto-fill, 70)实现自适应列数。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L48-L83" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">this</span>.gridViewManager.setViewStyle()</li><li>    .columnsTemplate(<span class="hljs-string">'repeat(auto-fill, 70)'</span>)</li><li>    .columnsGap(<span class="hljs-number">5</span>)</li><li>    .rowsGap(<span class="hljs-number">5</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L48-L83" target="_blank">WordGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section82961643142913">网格以当前行最高的单元格的高度为其他单元格的高度场景<i class="anchor-icon anchor-icon-link" anchorid="section82961643142913" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section1421495562916" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1421495562916" tips="复制节点链接"></i></h3><p>可以通过alignItems设置当前行最高单元格高度为其他单元格的高度。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例9以当前行最高的griditem的高度为其他griditem的高度" target="_blank">Grid示例9以当前行最高的griditem的高度为其他griditem的高度</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 339px;"><h3 id="section5183195913291">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section5183195913291" tips="复制节点链接"></i></h3><p>设置alignItems为GridItemAlignment.STRETCH时，以当前行最高的单元格高度为其他单元格的高度。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L49-L82" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>  this<span class="hljs-selector-class">.gridViewManager</span><span class="hljs-selector-class">.setViewStyle</span>()</li><li>    <span class="hljs-selector-class">.alignItems</span>(GridItemAlignment.STRETCH);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WordGridComponent.ets#L49-L82" target="_blank">WordGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section159192304309">网格设置边缘渐隐场景<i class="anchor-icon anchor-icon-link" anchorid="section159192304309" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section2038794011308" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section2038794011308" tips="复制节点链接"></i></h3><p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#fadingedge14" target="_blank">fadingEdge</a>属性来设置边缘渐隐效果。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid#示例10设置边缘渐隐" target="_blank">Grid示例10设置边缘渐隐</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 363px;"><h3 id="section12483744103017">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section12483744103017" tips="复制节点链接"></i></h3><p>开启边缘渐隐，并设置边缘渐隐长度为40vp。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L54-L123" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">gridViewManager</span>.<span class="hljs-title function_">setViewStyle</span>()</li><li>    .<span class="hljs-title function_">fadingEdge</span>(<span class="hljs-keyword">true</span>, { <span class="hljs-variable">fadingEdgeLength</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">vp</span>(<span class="hljs-number">40</span>) })</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/WorkComponent.ets#L54-L123" target="_blank">WorkComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section3206111112310">网格设置单元格样式场景<i class="anchor-icon anchor-icon-link" anchorid="section3206111112310" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section376802311319" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section376802311319" tips="复制节点链接"></i></h3><p>可以使用gridViewManager.setItemViewStyle()接口设置单元格样式。效果参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-griditem#示例2设置griditem样式" target="_blank">GridItem示例2设置griditem样式</a>。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 459px;"><h3 id="section132161524143117">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section132161524143117" tips="复制节点链接"></i></h3><p>使用gridViewManager.setItemViewStyle()设置单元格样式和属性。</p> <div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L39-L119" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridViewManager</span>.<span class="hljs-title function_">setItemViewStyle</span>(<span class="hljs-function">(<span class="hljs-params">gridItem</span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">gridItem</span>({ <span class="hljs-attr">style</span>: <span class="hljs-title class_">GridItemStyle</span>.<span class="hljs-property">PLAIN</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">80</span>) <span class="hljs-comment">// set the cell width to 80vp.</span></li><li>      .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.home_background_color'</span>))</li><li>      .<span class="hljs-title function_">selectable</span>(<span class="hljs-literal">false</span>)</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L39-L119" target="_blank">CardGridComponent.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section1968534812318">网格长按删除单元格场景<i class="anchor-icon anchor-icon-link" anchorid="section1968534812318" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section81114101322" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section81114101322" tips="复制节点链接"></i></h3><p>长按时显示删除按钮，点击按钮可以删除对应item。</p> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1902px;"><h3 id="section147901612193214">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section147901612193214" tips="复制节点链接"></i></h3><ol><li>绑定长按手势<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardComponent.ets#L25-L91" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// item component</span></li><li><span class="hljs-variable">@Component</span></li><li>export default struct CardComponent {</li><li>  <span class="hljs-variable">@State</span> <span class="hljs-attribute">user</span>: UserInfoViewModel = new <span class="hljs-built_in">UserInfoViewModel</span>();</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable">@Builder</span></li><li>  <span class="hljs-built_in">optMenu</span>() {</li><li>    <span class="hljs-selector-tag">Row</span>() {</li><li>      <span class="hljs-selector-tag">Button</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .<span class="hljs-built_in">backgroundColor</span>(<span class="hljs-attribute">Color</span>.Red)</li><li>      .<span class="hljs-built_in">onClick</span>(() =&gt; {</li><li>        this.<span class="hljs-built_in">getUIContext</span>().<span class="hljs-built_in">getHostContext</span>()?.eventHub.<span class="hljs-built_in">emit</span>(CommonConstants.EVENT_REMOVE_ITEM, this.user.id);</li><li>      })</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.bindContextMenu</span>(this.<span class="hljs-built_in">optMenu</span>(), ResponseType.LongPress)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardComponent.ets#L25-L91" target="_blank">CardComponent.ets</a></div></div></div></div> </li></ol><ol start="2"><li>响应删除事件<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L40-L131" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// register 'delete' event listener.</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">EVENT_REMOVE_ITEM</span>, <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">animateToImmediately</span>({ <span class="hljs-attr">duration</span>: <span class="hljs-number">500</span> }, <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewModel</span>.<span class="hljs-title function_">deleteData</span>(id);</li><li>    })</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// when the page is destroyed, cancel the deletion listener.</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">off</span>(<span class="hljs-title class_">CommonConstants</span>.<span class="hljs-property">EVENT_REMOVE_ITEM</span>);</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewModel</span>.<span class="hljs-title function_">destroy</span>();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/view/CardGridComponent.ets#L40-L131" target="_blank">CardGridComponent.ets</a></div></div></div></div> </li><li>通过this.gridViewManager?.nodeAdapter.deleteData()删除数据及组件<div class="screenLinkPre"><div _ngcontent-vsx-c106="" class="highlight-div"><div _ngcontent-vsx-c106="" class="highlight-div-header"><div _ngcontent-vsx-c106="" class="highlight-div-header-left"><div _ngcontent-vsx-c106="" class="handle-button expand-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vsx-c106="" class="highlight-div-header-right"><div _ngcontent-vsx-c106="" class="handle-button ai-button"></div><div _ngcontent-vsx-c106="" class="handle-button line-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vsx-c106="" class="handle-button theme-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vsx-c106="" class="handle-button copy-button"><div _ngcontent-vsx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vsx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/CardGridViewModel.ets#L126-L140" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * delete data by user id</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id user id</span></li><li><span class="hljs-comment"> */</span></li><li>deleteData(id: number) {</li><li>  <span class="hljs-keyword">for</span> (let index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.length; index++) {</li><li>    let model = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>[index];</li><li>    <span class="hljs-keyword">if</span> (model.id === id) {</li><li>      <span class="hljs-comment">// delete components and data</span></li><li>      <span class="hljs-keyword">this</span>.gridViewManager?.nodeAdapter.deleteData(index);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/GridScrollComponent/blob/master/entry/src/main/ets/viewModel/CardGridViewModel.ets#L126-L140" target="_blank">CardGridViewModel.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 128px;"><h2 id="section1185284612335">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1185284612335" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/GridScrollComponent" target="_blank">流畅滑动网格页面</a></li></ul> </div> </div> <div></div></div>