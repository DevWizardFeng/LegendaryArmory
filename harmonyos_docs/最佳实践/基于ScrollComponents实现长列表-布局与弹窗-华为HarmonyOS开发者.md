<h1 _ngcontent-osp-c119="" class="doc-title ng-star-inserted" title="基于ScrollComponents实现长列表"> 基于ScrollComponents实现长列表 </h1>

<div _ngcontent-osp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted renderOptimization" style="position: relative;"> <div><div class="tiledSection" style="contain-intrinsic-size: auto 708px;"><h2 id="section11490145194813">概述<i class="anchor-icon anchor-icon-link" anchorid="section11490145194813" tips="复制节点链接"></i></h2><p>列表包含一系列相同宽度的列表项，适合连续、多行展示同类数据，例如图片和文本。List具备动态数据处理能力，可以循环生成列表项，适应数据变化。它采用滚动加载技术，仅渲染可视项目，从而提升长列表的性能。同时，支持自定义交互逻辑与视觉样式，以满足多样化的交互需求。其使用场景广泛，涵盖列表类信息展示（如新闻、商品清单）、导航菜单设计（底部导航、侧边栏）及分页长内容呈现（如社交媒体动态、评论区），是实现高效数据可视化与交互的核心组件。</p> <p>当长列表上下滑动时，频繁的子组件创建和测量会大量消耗计算资源，容易造成滑动卡顿。图片等资源的短时集中请求会造成明显的页面滑动白块，影响用户体验。</p> <p>ScrollComponents作为高性能滑动解决方案，主要解决组件复用问题，支持通过少量的代码实现高性能滑动场景开发，同时开发者无需关注复用池管理和其他性能优化方案的交互细节。可以参考<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/README.md#快速开始" target="_blank">ScrollComponents使用说明</a>进行安装配置与快速上手。ScrollComponents三方库提供了下列功能特性：</p> <ul><li>支持List，WaterFlow，Grid 三种常见复杂页面的流畅滑动</li><li>默认支持懒加载</li><li>支持组件复用，解决滑动丢帧，提升滑动性能</li><li>支持复用池共享，满足跨页面跨父组件复用能力</li><li>支持预创建，减少冷启首次滑动丢帧，提升滑动性能</li><li>支持预加载，滑动过程提前加载数据，提升浏览体验</li></ul> <p>ScrollComponents三方库基于系统<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#nodeadapter12" target="_blank">NodeAdapter</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode" target="_blank">FrameNode</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-prefetcher" target="_blank">Prefetcher</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-framecallback" target="_blank">FrameCallback</a>的能力，通过高效的组件复用、分帧预创建组件、动态内容预创建和懒加载等技术，实现了高性能的滑动效果。此外，它还基于FrameNode封装了系统List、WaterFlow、Grid组件，提供了一系列ViewManager，为开发者提供了多种系统滑动组件的能力，如列表项样式设置、首尾偏移量调整、滚动监听、边缘渐隐等，旨在简化开发流程的同时满足开发者的常规需求。</p> <p>下文将通过长列表的跨页面复用、加速首屏渲染、无限滑动、下拉刷新、上拉加载等场景，详细介绍ScrollComponents库在长列表组件中的应用。</p> </div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 80px;"><h2 id="section9826204316336">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section9826204316336" tips="复制节点链接"></i></h2></div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 56px;"><h3 id="section1090854153314" class="firsth2">关键技术<i class="anchor-icon anchor-icon-link" anchorid="section1090854153314" tips="复制节点链接"></i></h3></div> <p>ScrollComponents三方库底层封装了NodeContainer+FrameNode，结合NodeAdapter、BuildNode和自定义复用池实现懒加载、组件复用、组件预创建等功能。同时，它为开发者提供了WaterFlowManager、ListManager、GridManager等视图管理组件，以支持系统滑动组件的其他各种能力。在满足开发者正常开发需求的前提下，提供高性能的滑动能力，只需传入数据源和viewManager即可快速实现懒加载和组件复用的开发，使开发者能够更加专注于业务实现。</p> <p>如下图所示，当节点从可视区域移除时，NodeAdapter会通知视图管理器回收组件，经NodeFactory处理后，组件最终被存入复用池。当需要创建节点时，NodeAdapter通知视图管理器开始创建，NodeFactory会从复用池请求复用节点，获取节点后经过一系列更新和组件拼接，最后由NodeAdapter将节点添加到可视区域。</p> <div class="fignone"><span class="figcap"><b>图1 </b>RecyclerView整体流程图</span><br><span><img height="247.318155" originheight="877" originwidth="2193" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162923.57804413300760501985122973633516:50001231000000:2800:4715D6CAE2405B1D9B0A8D6E726CE6511672BA1ADDD19D5A546AEFA5FCA746C2.png" title="点击放大" width="618.45"></span></div> <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 8823px;"><h3 id="section16640155348">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section16640155348" tips="复制节点链接"></i></h3><ol><li>创建长列表视图管理器。<p>ListManager仅具备基础的视图功能。若开发者需要使用组件复用功能，需定义一个继承自ListManager的类，并实现onWillCreateItem()方法，从复用池中获取组件，以开启复用能力。具体实现可参考<a href="/consumer/cn/doc/best-practices/bpta-list-based-on-scrollcomponents#li18448145318540">复用子节点模板</a>。</p> <p>在创建视图管理器的实例对象时，defaultNodeItem属性用于指定默认的列表项模板名称，通常传入唯一标识字符串用于组件复用；context属性用于获取UI上下文，通常传入this.getUIContext()。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L18-L283" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">ListManager</span>, <span class="hljs-variable">NodeItem</span>, <span class="hljs-variable">RecyclerView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hadss/scroll_components'</span>;</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SameItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L18-L283" target="_blank">SameItemListPage.ets</a></div></div></div></div> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>如果开发者希望通过ScrollComponents快速创建长列表，并利用懒加载、预创建等功能来提升滑动效率，而不涉及组件复用，那么可以直接使用ScrollComponents库中提供的ListManager来创建长列表视图管理器。具体的使用方法和配置选项，可以参考<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/README.md#快速开始" target="_blank">ScrollComponents使用说明-快速开始</a>。</p> </div></div></div> </li><li>ListManager初始化<div class="p">在页面初始化时，开发者通过视图管理器的setViewStyle接口为视图设置相应的属性。这包括设置布局与约束条件、主轴和交叉轴的方向、自定义列表样式（如内容间距、分割线、滚动条等）以及设置滚动监听。<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L108-L165" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setItemViewStyle</span>((<span class="hljs-variable">item</span>, <span class="hljs-variable">index</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">Params</span>) =&gt; {</li><li>  <span class="hljs-title function_">item</span>({ <span class="hljs-variable">style</span>: <span class="hljs-title class_">ListItemStyle</span>.<span class="hljs-title class_">NONE</span> })</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'auto'</span>)</li><li>    .<span class="hljs-title function_">swipeAction</span>({</li><li>      <span class="hljs-comment">// ...</span></li><li>    })</li><li>    .<span class="hljs-title function_">onClick</span>(() =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"index:"</span> + <span class="hljs-variable">index</span>))</li><li>})</li><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">listScroller</span> })</li><li>  .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)<span class="hljs-comment">// Set the number of preloaded ListItemListItemGroups in the list and whether to display the preloaded nodes</span></li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>  .<span class="hljs-title function_">contentStartOffset</span>(<span class="hljs-number">20</span>)<span class="hljs-comment">// Sets the offset at the start of the content area</span></li><li>  .<span class="hljs-title function_">contentEndOffset</span>(<span class="hljs-number">20</span>)<span class="hljs-comment">// Sets the offset at the end of the content area</span></li><li>  .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-variable">BarState</span>.<span class="hljs-variable">Off</span>)<span class="hljs-comment">// Set the scrollbar status</span></li><li>  <span class="hljs-comment">// ...</span></li><li>  .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-variable">ListItemAlign</span>.<span class="hljs-variable">Start</span>)<span class="hljs-comment">// Set the direction of the List cross axis</span></li><li>  .<span class="hljs-title function_">lanes</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">// Set the number of layout columns or rows in the List portlet</span></li><li>  .<span class="hljs-title function_">childrenMainSize</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">listChildrenSize</span>)<span class="hljs-comment">// Set the size of the child components of the List component in the direction of the main axis</span></li><li>  .<span class="hljs-title function_">fadingEdge</span>(<span class="hljs-keyword">true</span>, { <span class="hljs-variable">fadingEdgeLength</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">vp</span>(<span class="hljs-number">80</span>) })</li><li>  <span class="hljs-comment">// Nested scrolling: Set up a scrolling scheme</span></li><li>  .<span class="hljs-title function_">nestedScroll</span>({</li><li>    <span class="hljs-variable">scrollForward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">PARENT_FIRST</span>, <span class="hljs-comment">// The parent component scrolls first, scrolls to the edge, and then scrolls itself</span></li><li>    <span class="hljs-variable">scrollBackward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">SELF_FIRST</span> <span class="hljs-comment">// Itself rolls first, and then the parent component scrolls to the edge</span></li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L108-L165" target="_blank">SameItemListPage.ets</a></div></div></div></div> </div> </li><li>设置数据源渲染组件<ol><li>通过视图管理器的setDataSource()方法设置数据。ScrollComponents库默认支持懒加载，提供基于懒加载的数据增删改查功能，开发者无需担心LazyForEach的使用限制，无需定义DataSource，引入即可使用。懒加载接口可参考：<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/docs/Reference.md#lazynodeadapter-类" target="_blank">基于NodeAdapter为视图管理器提供懒加载能力</a>。</li><li>通过视图管理器的registerNodeItem方法注册item子节点模板时，需要传入模板名称和子节点的@Builder构造函数。</li><li>ScrollComponents提供了视图占位组件RecyclerView，RecyclerView通过绑定视图容器实例即可渲染长列表。<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L17-L290" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">ListManager</span>, <span class="hljs-variable">NodeItem</span>, <span class="hljs-variable">RecyclerView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hadss/scroll_components'</span>;</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SameItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">myViewModel</span>: <span class="hljs-title class_">SameItemViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">SameItemViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Register a reuse template</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">EasyBlogItemContainer</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Simulate request data</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-title function_">loadData</span>();</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">Column</span>() {</li><li>          <span class="hljs-title function_">RecyclerView</span>({</li><li>            <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Define an item template</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">EasyBlogItemContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">EasyBlogItem</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L17-L290" target="_blank">SameItemListPage.ets</a></div></div></div></div> <p></p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/SameItemViewModel.ets#L20-L73" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SameItemViewModel</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">BlogData</span>[] = [];</li><li>  <span class="hljs-attr">myListManager</span>: <span class="hljs-title class_">ListManager</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">loadData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title function_">generateRandomBlogData</span>(<span class="hljs-number">300</span>, <span class="hljs-literal">false</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dataArray: BlogData[]</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = dataArray;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setDataSource</span>(dataArray);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/SameItemViewModel.ets#L20-L73" target="_blank">SameItemViewModel.ets</a></div></div></div></div> </li></ol> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>1. 在注册子节点模板的方法registerNodeItem()中，目前仅支持使用全局builder函数。</p> <p>2. 如果开发者使用this.ListView.myListManager.preCreate()来实现组件的预创建，则必须在注册节点模板之前完成此操作。</p> </div></div></div> </li><li id="li18448145318540">复用子节点模板<div class="p">开发者自定义模板后，在定义长列表视图管理器时，需要实现onWillCreateItem()接口。在此接口中，通过dequeueReusableNodeByType()获取可复用的node，以实现组件复用。同时，还需要在复用组件的aboutToReuse生命周期中更新数据。<ol><li>列表项结构类型相同<p>当ListItem组件的结构相同但数据不同时，直接注册节点模板。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L39-L291" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SameItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Register a reuse template</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">EasyBlogItemContainer</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">Params</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Define an item template</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">EasyBlogItemContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">EasyBlogItem</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L39-L291" target="_blank">SameItemListPage.ets</a></div></div></div></div> </li><li>列表项内子组件可拆分组合<p>如果复用的ListItem组件结构基本相同，但存在部分差异，例如头部和尾部组件展示相同，而中间内容可能渲染Text组件或Image组件，通常需要定义两个不同的@Builder函数来实现复用。然而，在这种场景下，ScrollComponents提供了PartReuse功能，确保组件复用的实现，只需定义一个@Builder函数。具体可参考<a href="https://gitcode.com/openharmony-sig/scroll_components/blob/master/README.md#列表项内子组件可拆分" target="_blank">组件复用-列表项子组件可拆分</a>。</p> <p>当组件即将被销毁时，会从视图容器中移除并进入item复用池。当组件即将被创建时，会从item复用池中获取item节点。如果item节点与目标节点类型存在差异，会先将差异部分，即PartReuse中的组件回收到对应的组件复用池，然后从对应的组件复用池中取出目标组件所需的差异组件，并与item节点拼接，形成目标组件，再进入视图容器中。</p> <div class="fignone"><span class="figcap"><b>图2 </b>可拆分组件复用创建流程图</span><br><span><img height="323.19" originheight="1209" originwidth="1990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.46113512018135120914935742439768:50001231000000:2800:C8F1582CB0B03FA3E8425CF17F5609AA25FB267CBDE68F75D2E015907DE73DAA.png" title="点击放大" width="532"></span></div> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L17-L222" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">ListManager</span>, <span class="hljs-variable">NodeItem</span>, <span class="hljs-variable">PartReuse</span>, <span class="hljs-variable">RecyclerView</span>, } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hadss/scroll_components'</span>;</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CombineItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">"BlogItemContainer"</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Register a reuse template</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'BlogItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">BlogItemContainer</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'AdaptiveTextComponentContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">AdaptiveTextComponentContainer</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'GridImageViewContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">GridImageViewContainer</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">Params</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'BlogItemContainer'</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">BlogItemContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">BlogItem</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">BlogItem</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">BlogData</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">BlogData</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-variable">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span> = <span class="hljs-variable">params</span>.<span class="hljs-variable">blogData</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">12</span> }) {</li><li>      <span class="hljs-title function_">BlogItemHeaderView</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">blogData</span> })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span>?.<span class="hljs-variable">content</span>.<span class="hljs-variable">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title function_">PartReuse</span>({</li><li>          <span class="hljs-keyword">type</span>: <span class="hljs-string">'AdaptiveTextComponent'</span>,</li><li>          <span class="hljs-variable">builder</span>: <span class="hljs-title class_">wrapBuilder</span>(<span class="hljs-title class_">AdaptiveTextComponentContainer</span>),</li><li>          <span class="hljs-variable">data</span>: { <span class="hljs-variable">blogData</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">blogData</span> }</li><li>        })</li><li>      }</li><li>      <span class="hljs-comment">// Display pictures</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span>?.<span class="hljs-variable">images</span> &amp;&amp; <span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span>.<span class="hljs-variable">images</span>.<span class="hljs-variable">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title function_">PartReuse</span>({</li><li>          <span class="hljs-keyword">type</span>: <span class="hljs-string">'GridImageViewContainer'</span>,</li><li>          <span class="hljs-variable">builder</span>: <span class="hljs-title class_">wrapBuilder</span>(<span class="hljs-title class_">GridImageViewContainer</span>),</li><li>          <span class="hljs-variable">data</span>: { <span class="hljs-variable">blogData</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">blogData</span> }</li><li>        })</li><li>      }</li><li>      <span class="hljs-title function_">BottomActionView</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">blogData</span> })</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">AdaptiveTextComponentContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">AdaptiveTextComponent</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GridImageViewContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">GridImageView</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L17-L222" target="_blank">CombineItemListPage.ets</a></div></div></div></div> <p>开发者可以参考下图所示的日志打印内容，以检验是否成功复用，"generateItem reuse" 表示复用。</p> <div class="fignone"><span class="figcap"><b>图3 </b>日志效果图</span><br><span><img height="125.685" originheight="446" originwidth="1858" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.35779121930906276793626793551239:50001231000000:2800:5D2C9E3CA7F0D397FEDFA12F9AA546FC1C81E31DE13801DFCDA9C7DA6B037508.png" title="点击放大" width="523.6875"></span></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>日志默认是关闭的，若需开启日志，应在ListManager的初始化方法中设置Config参数，将debug设为true。</p> </div></div></div> </li><li>列表项结构类型不同<p>如果ListItem结构存在较大差异，包括布局不同、子组件数量差异大、组件类型不同等因素，导致难以直接复用同一个ListItem，则可以定义多个复用模板。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L34-L198" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DifferentItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">dataArray</span>: <span class="hljs-title class_">BlogData</span>[] = [];</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">myViewModel</span>: <span class="hljs-title class_">DifferentItemViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">DifferentItemViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataArray</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">EasyBlogItemContainer</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'HotVideoBlogItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">HotVideoBlogItemContainer</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">preCreate</span>(<span class="hljs-string">'HotVideoBlogItemContainer'</span>, <span class="hljs-number">30</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">preCreate</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>, <span class="hljs-number">30</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-title function_">loadData</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">initView</span>() {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setItemViewStyle</span>((<span class="hljs-variable">_item</span>, <span class="hljs-variable">_index</span>, <span class="hljs-variable">_data</span>: <span class="hljs-title class_">ESObject</span>) =&gt; {</li><li>    })</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span> })</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">buildListView</span>() {</li><li>    <span class="hljs-title function_">RecyclerView</span>({</li><li>      <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">PullToRefresh</span>({</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-variable">customList</span>: () =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-title function_">buildListView</span>();</li><li>          },</li><li>          <span class="hljs-comment">// ...</span></li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">index</span> % <span class="hljs-number">4</span> === <span class="hljs-number">3</span>) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">Params</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'HotVideoBlogItemContainer'</span>);</li><li>      <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">data</span> });</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">Params</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'EasyBlogItemContainer'</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// Reusable EasyBlog Component Template</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">EasyBlogItemContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">EasyBlogItem</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li><li>
</li><li><span class="hljs-comment">// Reusable HotVideoBlog Component Template</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">HotVideoBlogItemContainer</span>($$: <span class="hljs-title class_">Params</span>) {</li><li>  <span class="hljs-title function_">HotVideoBlogItem</span>({ <span class="hljs-variable">blogData</span>: $$.<span class="hljs-title class_">blogData</span> })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L34-L198" target="_blank">DifferentItemListPage.ets</a></div></div></div></div> </li></ol> </div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section690864814419">长列表分组布局场景<i class="anchor-icon anchor-icon-link" anchorid="section690864814419" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section79089489443" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section79089489443" tips="复制节点链接"></i></h3></div> <p>在长列表中支持数据的分组展示，可以使列表结构更加清晰，便于查找，从而提高使用效率。分组列表在实际应用中非常常见，例如下图所示的联系人列表和商品分类展示列表。</p> <p>在分组场景中，通常会设置Group的header和footer，用于展示组内统一的头部和尾部信息。</p> <div class="fignone"><span class="figcap"><b>图4 </b>商品分类列表展示效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.38121768373914483494321983304841:50001231000000:2800:65915CD83EFDF2D80527ED83E7F0906197D1D81EF6E8A66EF08608BD20C4A88A.gif" title="点击放大" width="266"></span></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section1120234544514">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1120234544514" tips="复制节点链接"></i></h3></div> <ol><li>定义Item复用的模板<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L342-L393" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GoodItemContainer</span>($$: <span class="hljs-title class_">ParamsGoods</span>) {</li><li>  <span class="hljs-title function_">GoodItem</span>({ <span class="hljs-variable">dataModel</span>: $$.<span class="hljs-title class_">dataModel</span> })</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">GoodItem</span> {</li><li>  @<span class="hljs-title function_">Prop</span> <span class="hljs-variable">dataModel</span>: <span class="hljs-title class_">GoodsDataModel</span> = {</li><li>    <span class="hljs-variable">titleId</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">goodsId</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">goodsName</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-variable">imgUrl</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">pic2</span>'),</li><li>    <span class="hljs-variable">price</span>: <span class="hljs-number">0</span></li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-variable">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataModel</span> = <span class="hljs-variable">params</span>.<span class="hljs-variable">dataModel</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Row</span>() {</li><li>      <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataModel</span>.<span class="hljs-variable">imgUrl</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">sourceSize</span>({ <span class="hljs-variable">width</span>: <span class="hljs-number">96</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">96</span>})</li><li>      <span class="hljs-title function_">Column</span>() {</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">dataModel</span>.<span class="hljs-variable">goodsName</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">2</span>)</li><li>          .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-variable">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-title class_">Clip</span> })</li><li>          .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">20</span>)</li><li>        <span class="hljs-title function_">Text</span>(<span class="hljs-string">'￥'</span> + <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataModel</span>.<span class="hljs-variable">price</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Red</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Start</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">SpaceBetween</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">clip</span>(<span class="hljs-keyword">true</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">96</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">18</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L342-L393" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>定义ListItemGroupManager类<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L107-L123" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListItemGroupManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListItemGroupManager</span> {</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">GoodsDataModel</span>): <span class="hljs-title class_">NodeItem</span> | <span class="hljs-title class_">null</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">node</span>: <span class="hljs-title class_">NodeItem</span>&lt;<span class="hljs-title class_">ParamsGoods</span>&gt; | <span class="hljs-title class_">null</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">dequeueReusableNodeByType</span>(<span class="hljs-string">'GoodItemContainer'</span>);</li><li>    <span class="hljs-variable">node</span>?.<span class="hljs-title function_">setData</span>({ <span class="hljs-variable">dataModel</span>: <span class="hljs-title class_">data</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">node</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L107-L123" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>定义ListManager类<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L32-L100" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-variable">context</span>: <span class="hljs-title class_">UIContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-variable">config</span>: <span class="hljs-title class_">Config</span>) {</li><li>    <span class="hljs-keyword">super</span>(<span class="hljs-variable">config</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span> = <span class="hljs-variable">config</span>.<span class="hljs-variable">context</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">CategoryModel</span>): <span class="hljs-title class_">NodeItem</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">groupManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListItemGroupManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span> });</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">GoodItemContainer</span>));</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setDataSource</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">goodsList</span>);</li><li>    <span class="hljs-comment">// The header and footer of the group</span></li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setViewStyle</span>({</li><li>      <span class="hljs-variable">space</span>: <span class="hljs-number">12</span>,</li><li>      <span class="hljs-comment">// ...</span></li><li>    })</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setItemViewStyle</span>((<span class="hljs-variable">listItem</span>, <span class="hljs-variable">index</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">ParamsGoods</span>) =&gt; {</li><li>      <span class="hljs-comment">// Used to set the scratch component of ListItem.</span></li><li>      <span class="hljs-title function_">listItem</span>().<span class="hljs-title function_">swipeAction</span>({</li><li>        <span class="hljs-comment">// ...</span></li><li>      })</li><li>    })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">getNodeItem</span>(<span class="hljs-keyword">this</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L32-L100" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>Group的header和footer设置<p>如果需要设置组头和组尾，可以通过ListItemGroupManager的headerComponent和footerComponent属性实现，并实现其对应的Builder函数。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L33-L337" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">CategoryModel</span>): <span class="hljs-title class_">NodeItem</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">groupManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListItemGroupManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span> });</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">GoodItemContainer</span>));</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setDataSource</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">goodsList</span>);</li><li>    <span class="hljs-comment">// The header and footer of the group</span></li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setViewStyle</span>({</li><li>      <span class="hljs-variable">space</span>: <span class="hljs-number">12</span>,</li><li>      <span class="hljs-variable">headerComponent</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">ComponentContent</span>&lt;<span class="hljs-title class_">Resource</span>&gt;(<span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span>,</li><li>        <span class="hljs-title class_">wrapBuilder</span>&lt;[<span class="hljs-title class_">Resource</span>]&gt;(<span class="hljs-title class_">goodsHeaderBuilderPublic</span>),</li><li>        <span class="hljs-title class_">data</span>.<span class="hljs-title class_">titleName</span>),</li><li>      <span class="hljs-comment">// onClick:(...)=&gt;{} can be declared in the DataModel, and data.onClick is used when data is assigned</span></li><li>      <span class="hljs-comment">// headerComponent: new ComponentContent&lt;DataModel&gt;(this.context,</span></li><li>      <span class="hljs-comment">//   wrapBuilder&lt;[DataModel]&gt;(groupHeaderBuilderPublic),</span></li><li>      <span class="hljs-comment">//   dataModel)</span></li><li>      <span class="hljs-variable">footerComponent</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">ComponentContent</span>&lt;[<span class="hljs-title class_">Resource</span>, <span class="hljs-title class_">number</span>]&gt;(<span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span>,</li><li>        <span class="hljs-title class_">wrapBuilder</span>&lt;[[<span class="hljs-title class_">Resource</span>, <span class="hljs-title class_">number</span>]]&gt;(<span class="hljs-title class_">goodsFooterBuilderPublic</span>),</li><li>        [<span class="hljs-title class_">data</span>.<span class="hljs-title class_">titleName</span>, <span class="hljs-title class_">data</span>.<span class="hljs-title class_">titleId</span>]),</li><li>    })</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">getNodeItem</span>(<span class="hljs-keyword">this</span>);</li><li>  }</li><li>}</li><li><span class="hljs-comment">// The global Builder: passes multiple parameters</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">goodsHeaderBuilderPublic</span>(<span class="hljs-variable">headerName</span>: <span class="hljs-title class_">Resource</span>) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// The global Builder: passes multiple parameters</span></li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">goodsFooterBuilderPublic</span>(<span class="hljs-variable">args</span>: [<span class="hljs-variable">Resource</span>, <span class="hljs-variable">number</span>]) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L33-L337" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>header目前支持使用headerComponent属性的写法，且goodsHeaderBuilderPublic只支持全局builder。footer的写法与header相同。</p> <p>对于需要将内部事件传递到Page页面的场景，可以通过在DataModel中设置一个点击回调属性来实现，并在Page页面传递Data时进行赋值。</p> <p>目前这种写法不支持同时设置header和footer。后续，ScrollComponents库将支持这一功能。</p> </div></div></div> </li><li>页面实现<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L129-L347" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct GroupLayoutListPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>  myListManager: MyListManager = new <span class="hljs-built_in">MyListManager</span>({ defaultNodeItem: <span class="hljs-string">''</span>, context: this.<span class="hljs-built_in">getUIContext</span>() });</li><li>  private goodsListScroller: ListScroller = new <span class="hljs-built_in">ListScroller</span>();</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">myViewModel</span>: GroupLayoutViewModel = new GroupLayoutViewModel(this.myListManager, this.goodsListScroller);</li><li>
</li><li>  <span class="hljs-built_in">aboutToAppear</span>() {</li><li>    this<span class="hljs-selector-class">.initView</span>();</li><li>    this<span class="hljs-selector-class">.myListManager</span><span class="hljs-selector-class">.registerNodeItem</span>('GoodItemContainer', wrapBuilder(GoodItemContainer));</li><li>    this<span class="hljs-selector-class">.myListManager</span><span class="hljs-selector-class">.preCreate</span>('GoodItemContainer', <span class="hljs-number">30</span>);</li><li>    this<span class="hljs-selector-class">.myViewModel</span><span class="hljs-selector-class">.loadData</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>            <span class="hljs-built_in">Column</span>() { <span class="hljs-comment">// 3.Nested Scrolling: Inner List</span></li><li>              <span class="hljs-built_in">RecyclerView</span>({</li><li>                viewManager: this.myListManager</li><li>              })</li><li>            }</li><li>            <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>            <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">@Builder</span></li><li>function GoodItemContainer($$: ParamsGoods) {</li><li>  <span class="hljs-built_in">GoodItem</span>({ dataModel: $$.dataModel })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L129-L347" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section192009011914">长列表跨页面复用场景<i class="anchor-icon anchor-icon-link" anchorid="section192009011914" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 92px;"><h3 id="section1020060161912" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1020060161912" tips="复制节点链接"></i></h3><p>开发者可能需要在多个页面间复用List，例如在Tabs切换时。ScrollComponents提供了全局复用的能力。</p> </div> <div class="fignone"><span class="figcap"><b>图5 </b>Tabs组件子页面跨页面复用效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.55926566586880472462978305772528:50001231000000:2800:1D67489C8FF665F41CF9EA4724D9EA51D8673E3B3711F14D58F108C1D420D9F2.gif" title="点击放大" width="266"></span></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section1061419222145">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1061419222145" tips="复制节点链接"></i></h3></div> <ol><li>定义复用池单例<p>ScrollComponents默认会生成一个RecycledPool对象，通过定义复用池单例存储该pool对象，以便跨页面使用。以下单例仅做参考，开发者可根据需要自行封装。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/common/util/Utils.ets#L17-L34" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">RecycledPool</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hadss/scroll_components'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Utils</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">utils_</span>: <span class="hljs-title class_">Utils</span>;</li><li>  <span class="hljs-attr">nodePool</span>: <span class="hljs-title class_">RecycledPool</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/common/util/Utils.ets#L17-L34" target="_blank">Utils.ets</a></div></div></div></div> </li><li>复用池单例保存RecycledPool<p>HMListManager提供getRecyclePool()方法可获取RecyclePool对象，然后存储到全局单例中。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L205-L209" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (Utils.getInstance().nodePool) {</li><li>  <span class="hljs-keyword">this</span>.myListManager.registerRecyclePool(Utils.getInstance().nodePool!);</li><li>} <span class="hljs-keyword">else</span> {</li><li>  Utils.getInstance().nodePool = <span class="hljs-keyword">this</span>.myListManager.getRecyclePool();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L205-L209" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li><li>跨页面共享单例中的RecyclePool<p>通过使用registerRecyclePool()接口，将全局单例中的RecyclePool注册到页面定义的List视图类对象上，实现跨页面HMRecyclerView视图的复用池共享。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L32-L232" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TabsCeilingListPage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">tabArray</span>: <span class="hljs-title class_">Resource</span>[] = [</li><li>  <span class="hljs-comment">// ...</span></li><li>  ];</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">Utils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-variable">nodePool</span>?.<span class="hljs-title function_">clear</span>()</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>              <span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">Start</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">contentTabController</span> }) {</li><li>                <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">tabArray</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">Resource</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>                  <span class="hljs-title function_">TabContent</span>() {</li><li>                    <span class="hljs-title function_">CustomListPage</span>({ <span class="hljs-variable">index</span>: <span class="hljs-title class_">index</span> })</li><li>                  }</li><li>                  .<span class="hljs-title function_">tabBar</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">tabBuilder</span>(<span class="hljs-variable">index</span>, <span class="hljs-variable">item</span>))</li><li>                  .<span class="hljs-title function_">align</span>(<span class="hljs-variable">Alignment</span>.<span class="hljs-variable">Center</span>)</li><li>                }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>              }</li><li>              <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomListPage</span> {</li><li>  <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'CustomListItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">myViewModel</span>: <span class="hljs-title class_">TabsCeilingViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TabsCeilingViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>);</li><li>  <span class="hljs-variable">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// Shared multiplexing pools</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">Utils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-variable">nodePool</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerRecyclePool</span>(<span class="hljs-variable">Utils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-variable">nodePool</span>!);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable">Utils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-variable">nodePool</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">getRecyclePool</span>();</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'CustomListItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">CustomListItemContainer</span>));</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">preCreate</span>(<span class="hljs-string">'CustomListItemContainer'</span>, <span class="hljs-number">5</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-title function_">loadData</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">RecyclerView</span>({</li><li>      <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L32-L232" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section12068179172">长列表加速首屏渲染场景<i class="anchor-icon anchor-icon-link" anchorid="section12068179172" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h3 id="section11206111718178" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section11206111718178" tips="复制节点链接"></i></h3><p>冷启动后首次打开长列表页面时，由于页面包含大量图片或视频等媒体资源，可能会出现白屏或白块，需要等待几秒内容才会逐渐加载出来。ScrollComponents库支持组件预创建，使用后可以在打开页面后立即看到文字和图片的骨架，从而减少卡顿。</p> </div> <div class="fignone"><span class="figcap"><b>图6 </b>加速首屏渲染效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.98733765446571349459278767234403:50001231000000:2800:0CA842B39266C54304F70D206E55F55CD5A6DA482030CB7BF08D7D18E74FE7B3.gif" title="点击放大" width="266"></span></div> <div class="tiledSection" style="contain-intrinsic-size: auto 531px;"><h3 id="section18179160182">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section18179160182" tips="复制节点链接"></i></h3><p>包括注册模板和复用模板的预创建。重点：必须在注册复用模板之后使用preCreate()接口。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L46-L74" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Register a reuse template</span></li><li>  <span class="hljs-keyword">this</span>.myListManager.registerNodeItem(<span class="hljs-string">'BlogItemContainer'</span>, wrapBuilder(BlogItemContainer));</li><li>  <span class="hljs-keyword">this</span>.myListManager.registerNodeItem(<span class="hljs-string">'AdaptiveTextComponentContainer'</span>, wrapBuilder(AdaptiveTextComponentContainer));</li><li>  <span class="hljs-keyword">this</span>.myListManager.registerNodeItem(<span class="hljs-string">'GridImageViewContainer'</span>, wrapBuilder(GridImageViewContainer));</li><li>  <span class="hljs-comment">// Pre-creation Important: preCreate pre-creates a reusable template, which must be done after the reuse template is registered</span></li><li>  <span class="hljs-comment">// Pre-create 30 list items to optimize the first-screen performance; the number can be adjusted according to actual needs.</span></li><li>  <span class="hljs-keyword">this</span>.myListManager.preCreate(<span class="hljs-string">'BlogItemContainer'</span>, <span class="hljs-number">30</span>);</li><li>  <span class="hljs-keyword">this</span>.myListManager.preCreate(<span class="hljs-string">'AdaptiveTextComponentContainer'</span>, <span class="hljs-number">30</span>);</li><li>  <span class="hljs-keyword">this</span>.myListManager.preCreate(<span class="hljs-string">'GridImageViewContainer'</span>, <span class="hljs-number">30</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L46-L74" target="_blank">CombineItemListPage.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section657215331514">性能测试<i class="anchor-icon anchor-icon-link" anchorid="section657215331514" tips="复制节点链接"></i></h3></div> <p>在冷启动场景下加载相同数据的完成时延情况，通过延迟1s来模拟冷启动后的网络请求场景。</p> <p>@Reusable：在网络请求期间，主线程有大段空闲时间，请求结束后首屏组件的绘帧耗时较长。</p> <div class="fignone"><span class="figcap"><b>图7 </b>@Reusable测试结果</span><br><span><img height="233.41500000000002" originheight="834" originwidth="1869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.16394116204221641602295488789014:50001231000000:2800:255444C5B01A06E51D7D62323B5784AA605F82341032542051B186AD3A3C4322.png" title="点击放大" width="523.6875"></span></div> <p>在ScrollComponents中，网络请求期间主线程空闲时间较少，请求结束后首屏组件的绘帧耗时较短。</p> <div class="fignone"><span class="figcap"><b>图8 </b>ScrollComponents测试结果</span><br><span><img height="233.41500000000002" originheight="834" originwidth="1869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162924.54740111290571364475274313960728:50001231000000:2800:3EE5489675758AABACC62F841FE341028E71B32FA0F60A472FB27F106A9BDA9E.png" title="点击放大" width="523.6875"></span></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>ScrollComponents与@Reusable性能时延数据对比</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.30.2.5.1.1" valign="top" width="25%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.30.2.5.1.2" valign="top" width="25%"><p>冷启动完成时延</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.30.2.5.1.3" valign="top" width="25%"><p>主线程空闲时间</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.30.2.5.1.4" valign="top" width="25%"><p>首屏组件创建时间</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>ScrollComponents</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2.5s</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>281ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>223ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>@Reusable</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2.8s</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>997ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>467ms</p> </td> </tr>  </tbody></table></div> </div> <p>结论：ScrollComponents在冷启动场景下，完成时延优于原生@Reusable。整体完成时延优化300ms。</p> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section1710403051614">长列表下拉刷新场景<i class="anchor-icon anchor-icon-link" anchorid="section1710403051614" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 694px;"><h3 id="section1810513081612" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1810513081612" tips="复制节点链接"></i></h3><p>下拉刷新是提升用户体验的关键功能，它既要确保数据无缝加载，又要保持流畅的交互效果。建议采用懒加载方式刷新数据，以避免媒体资源加载导致的UI渲染阻塞。实现逻辑可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh#示例6实现下拉刷新上拉加载更多" target="_blank">实现下拉刷新上拉加载更多</a>。</p> <div class="fignone"><span class="figcap"><b>图9 </b>下拉刷新效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.18653433655752099352333121143688:50001231000000:2800:82F642E4720251E0BCB8614834922EFB8344D1B88ACF0EE06AF0F0D7F302F180.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1637px;"><h3 id="section710523012160">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section710523012160" tips="复制节点链接"></i></h3><p>可以通过PullToRefresh组件实现页面下拉操作，并绑定显示刷新Loading动效的容器组件，以达到下拉加载的效果。之后，使用onRefresh回调重新设置数据，模拟刷新数据的操作。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L35-L170" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DifferentItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">dataArray</span>: <span class="hljs-title class_">BlogData</span>[] = [];</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">myViewModel</span>: <span class="hljs-title class_">DifferentItemViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">DifferentItemViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataArray</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">buildListView</span>() {</li><li>    <span class="hljs-title function_">RecyclerView</span>({</li><li>      <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">PullToRefresh</span>({</li><li>          <span class="hljs-variable">data</span>: $<span class="hljs-title class_">dataArray</span>,</li><li>          <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span>,</li><li>          <span class="hljs-variable">refreshConfigurator</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">refreshConfigurator</span>,</li><li>          <span class="hljs-variable">customList</span>: () =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-title function_">buildListView</span>();</li><li>          },</li><li>          <span class="hljs-variable">onRefresh</span>: () =&gt; {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">string</span>&gt;((<span class="hljs-variable">resolve</span>, <span class="hljs-variable">_reject</span>) =&gt; {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-title function_">loadData</span>((<span class="hljs-variable">isSuccess</span>) =&gt; {</li><li>                <span class="hljs-comment">// ...</span></li><li>              });</li><li>            });</li><li>          },</li><li>          <span class="hljs-comment">// ...</span></li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L35-L170" target="_blank">DifferentItemListPage.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/DifferentItemViewModel.ets#L20-L65" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DifferentItemViewModel</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">BlogData</span>[] = [];</li><li>  <span class="hljs-attr">myListManager</span>: <span class="hljs-title class_">ListManager</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">loadData</span>(callBack?: <span class="hljs-function">(<span class="hljs-params">isSuccess: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">generateRandomBlogData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: BlogData[]</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = data;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setDataSource</span>(data);</li><li>      <span class="hljs-keyword">if</span> (callBack) {</li><li>        <span class="hljs-title function_">callBack</span>(<span class="hljs-literal">true</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/DifferentItemViewModel.ets#L20-L65" target="_blank">DifferentItemViewModel.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section9976419142113">长列表上拉加载场景<i class="anchor-icon anchor-icon-link" anchorid="section9976419142113" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section13976161972110" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section13976161972110" tips="复制节点链接"></i></h3></div> <p>在开发涉及大量数据的长列表页面时，需要通过分页请求来加载数据。结合ScrollComponents提供的懒加载功能，可以实现加载更多数据的效果。</p> <div class="fignone"><span class="figcap"><b>图10 </b>上拉加载效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.90744841583648431894844664431052:50001231000000:2800:91C5D0C54CB507760BD1274BB7F75AF1247555F06C9883916099D3CC6718084E.gif" title="点击放大" width="266"></span></div> <div class="tiledSection" style="contain-intrinsic-size: auto 1733px;"><h3 id="section12202329152114">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section12202329152114" tips="复制节点链接"></i></h3><p>可以通过PullToRefresh组件实现页面上拉操作，并绑定显示刷新Loading动效的容器组件，以达到上拉加载的效果。之后，使用onLoadMore回调来新增数据，模拟加载数据的操作。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L36-L171" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DifferentItemListPage</span> {</li><li>  <span class="hljs-variable">myListManager</span>: <span class="hljs-title class_">MyListManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListManager</span>({</li><li>    <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'EasyBlogItemContainer'</span>,</li><li>    <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">getUIContext</span>()</li><li>  });</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">dataArray</span>: <span class="hljs-title class_">BlogData</span>[] = [];</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">myViewModel</span>: <span class="hljs-title class_">DifferentItemViewModel</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">DifferentItemViewModel</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">dataArray</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">buildListView</span>() {</li><li>    <span class="hljs-title function_">RecyclerView</span>({</li><li>      <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">PullToRefresh</span>({</li><li>          <span class="hljs-variable">data</span>: $<span class="hljs-title class_">dataArray</span>,</li><li>          <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span>,</li><li>          <span class="hljs-variable">refreshConfigurator</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">refreshConfigurator</span>,</li><li>          <span class="hljs-variable">customList</span>: () =&gt; {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-title function_">buildListView</span>();</li><li>          },</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-variable">onLoadMore</span>: () =&gt; {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">string</span>&gt;((<span class="hljs-variable">resolve</span>) =&gt; {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-title function_">loadDataMore</span>((<span class="hljs-variable">isSuccess</span>) =&gt; {</li><li>                <span class="hljs-comment">// ...</span></li><li>              });</li><li>            });</li><li>          }</li><li>        })</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/DifferentItemListPage.ets#L36-L171" target="_blank">DifferentItemListPage.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/DifferentItemViewModel.ets#L21-L66" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DifferentItemViewModel</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isLoadingMore</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">loadDataMore</span>(callBack?: <span class="hljs-function">(<span class="hljs-params">isSuccess: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoadingMore</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoadingMore</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">generateRandomBlogData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: BlogData[]</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-property">nodeAdapter</span>.<span class="hljs-title function_">pushData</span>(data);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLoadingMore</span> = <span class="hljs-literal">false</span>;</li><li>          <span class="hljs-keyword">if</span> (callBack) {</li><li>            <span class="hljs-title function_">callBack</span>(<span class="hljs-literal">true</span>);</li><li>          }</li><li>        })</li><li>      }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">NetworkTime</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/DifferentItemViewModel.ets#L21-L66" target="_blank">DifferentItemViewModel.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section8817142852315">长列表无限滑动场景<i class="anchor-icon anchor-icon-link" anchorid="section8817142852315" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section13818828112313" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section13818828112313" tips="复制节点链接"></i></h3></div> <p>为了解决手动上拉加载操作的繁琐问题，在即将下滑到最底端时，提前触发新数据的加载，并将其显示在长列表的最底部，从而实现无限滑动的效果。</p> <ul><li>痛点问题：当长列表页面包含大量图片或视频时，下滑至列表底部后快速继续下滑可能会导致“滑动白块”现象。特别是在用户使用大量在线数据的情况下，弱网环境和快速滑动会使滑动过程中的白块现象更加明显。</li><li>解决方案：为了减少滑动过程中的白块和页面数据加载的等待时间，ScrollComponents内置了内容预取功能Prefetcher，支持根据网络状态动态自适应。通过提前下载图片或资源，确保在需要时能够立即显示，从而减少白块的出现。</li><li>适用场景：动态预加载特别适用于数据请求耗时较长的场景，例如滑动列表中包含大量图片资源。</li></ul> <p>以下介绍具体的使用：</p> <div class="fignone"><span class="figcap"><b>图11 </b>无限滑动效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.86048085964177527143666782730081:50001231000000:2800:2D5348B1BE747B8F7855BC6473506593CD2EDABA751D5DAEFD3D12960C8EFE09.gif" title="点击放大" width="266"></span></div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section956215493235">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section956215493235" tips="复制节点链接"></i></h3></div> <ol><li>修改数据体参数，增加位图<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/model/types.ets#L19-L50" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-title class_">T</span>&gt; <span class="hljs-variable">extends</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">T</span>&gt; {</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Observed</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImagePixelMap</span> {</li><li>  <span class="hljs-variable">imageUrl</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-variable">imagePixelMap</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Observed</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogData</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// Multiple graphs define imagePixelMapArray, corresponding to images</span></li><li>  <span class="hljs-variable">imagePixelMapArray</span>: <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-title class_">ImagePixelMap</span>&gt; = [];</li><li>  <span class="hljs-comment">// A single graph defines an imagePixelMap, which corresponds to an imageUrl</span></li><li>  <span class="hljs-comment">// imageUrl: string = ''</span></li><li>  <span class="hljs-comment">// imagePixelMap: image.PixelMap | undefined = undefined;</span></li><li>
</li><li>  <span class="hljs-variable">callback</span>: <span class="hljs-title class_">Function</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>  <span class="hljs-variable">fetchUrl</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">ImageContent</span> = <span class="hljs-variable">ImageContent</span>.<span class="hljs-variable">EMPTY</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/model/types.ets#L19-L50" target="_blank">types.ets</a></div></div></div></div> </li><li>实现fetchCallback()和cancelCallback()方法<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/CombineItemViewModel.ets#L66-L112" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">fetchCallback</span>: <span class="hljs-function">(<span class="hljs-params">item: ESObject, fetchId: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; = <span class="hljs-function">(<span class="hljs-params">item: ESObject, fetchId: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// Simulate a simple pre-loading scenario ,This is where you can migrate the preloaded scenarios for your project</span></li><li>  <span class="hljs-comment">// 1、When the component is not displayed or created, the image is obtained. PixelMap, when the component is displayed, load the image directly. PixelMap and show no need to wait for the network</span></li><li>  <span class="hljs-comment">// 2、If the image is displayed but the pixelMap is not obtained, the data is bound to the Image component first, and the image can be refreshed immediately after the pixelMap is obtained</span></li><li>  <span class="hljs-keyword">let</span> data = item <span class="hljs-keyword">as</span> <span class="hljs-title class_">BlogData</span>;</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">set</span>(fetchId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      data.<span class="hljs-property">imagePixelMapArray</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">pixMap: ImagePixelMap, index, _array</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (pixMap.<span class="hljs-property">imagePixelMap</span>) {</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-keyword">let</span> httpRequest = <span class="hljs-title class_">HttpGet</span>(pixMap.<span class="hljs-property">imageUrl</span>, <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">number</span>, pixelMap?: sendableImage.PixelMap</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> fetchMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">get</span>(fetchId);</li><li>          <span class="hljs-keyword">if</span> (fetchMap) {</li><li>            fetchMap.<span class="hljs-title function_">delete</span>(index);</li><li>            <span class="hljs-keyword">if</span> (fetchMap?.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">delete</span>(fetchId);</li><li>            }</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (error === -<span class="hljs-number">1</span>) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (pixelMap) {</li><li>            <span class="hljs-comment">// You need to create an array to store the pixelMap, because there is a change in the internal data of the array to make the component respond, which is more complicated, the developer can choose the preloading scheme by himself:</span></li><li>            <span class="hljs-comment">// Define the ImagePixelMap class to store the pixelMap, encapsulate the Image component as an ObservedImage, add @ObjectLink imagePixelMap: ImagePixelMap property to bind the data object,</span></li><li>            <span class="hljs-comment">// In the preloaded callback fetchCallback, after the image pixelMap is obtained, set ImagePixelMap.imagePixelMap, and the image can be refreshed by ObservedImage</span></li><li>            pixMap.<span class="hljs-property">imagePixelMap</span> = sendableImage.<span class="hljs-title function_">convertToPixelMap</span>(pixelMap);</li><li>          }</li><li>        })</li><li>        <span class="hljs-keyword">let</span> fetchMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">get</span>(fetchId);</li><li>        <span class="hljs-keyword">if</span> (fetchMap) {</li><li>          fetchMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>;</li><li>          fetchMap.<span class="hljs-title function_">set</span>(index, httpRequest);</li><li>        }</li><li>      })</li><li>      <span class="hljs-title function_">resolve</span>();</li><li>    }, <span class="hljs-number">0</span>);</li><li>  })</li><li>}</li><li><span class="hljs-attr">cancelCallback</span>: <span class="hljs-function">(<span class="hljs-params">fetchId: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">fetchId: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">get</span>(fetchId)?.<span class="hljs-title function_">values</span>() ?? []).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {</li><li>    element.<span class="hljs-title function_">destroy</span>();</li><li>  });</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">clear</span>();</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fetchesMore</span>.<span class="hljs-title function_">delete</span>(fetchId);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/CombineItemViewModel.ets#L66-L112" target="_blank">CombineItemViewModel.ets</a></div></div></div></div> </li><li>创建组件实例时，注册fetch和cancel方法到视图管理器<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L44-L73" data-highlighted="yes"><ol class="linenums"><li>aboutToAppear(): void {</li><li>  <span class="hljs-keyword">this</span>.initView();</li><li>  <span class="hljs-comment">// Register a preload function callback</span></li><li>  <span class="hljs-keyword">this</span>.myViewModel.registerPrefetch();</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L44-L73" target="_blank">CombineItemListPage.ets</a></div></div></div></div> <p></p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/CombineItemViewModel.ets#L60-L63" data-highlighted="yes"><ol class="linenums"><li>registerPrefetch() {</li><li>  <span class="hljs-keyword">this</span>.myListManager?.registerFetchCallback(<span class="hljs-keyword">this</span>.fetchCallback);</li><li>  <span class="hljs-keyword">this</span>.myListManager?.registerCancelCallback(<span class="hljs-keyword">this</span>.cancelCallback);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/viewmodel/CombineItemViewModel.ets#L60-L63" target="_blank">CombineItemViewModel.ets</a></div></div></div></div> </li><li>监听滑动组件子组件变化事件<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L32-L131" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CombineItemListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">initView</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> })</li><li>    <span class="hljs-comment">// ...</span></li><li>      .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start: <span class="hljs-built_in">number</span>, end: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// Infinite swipe, when the 10th data is counted, new data is requested in advance</span></li><li>        <span class="hljs-keyword">if</span> (end &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">myViewModel</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">10</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myViewModel</span>.<span class="hljs-title function_">loadDataMore</span>();</li><li>        }</li><li>        <span class="hljs-comment">// Trigger a preload callback, request an image in advance, and resolve the white block of the image</span></li><li>        <span class="hljs-keyword">if</span> (end &gt; <span class="hljs-number">0</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">visibleAreaChanged</span>(start, end);</li><li>        }</li><li>      })</li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L32-L131" target="_blank">CombineItemListPage.ets</a></div></div></div></div> </li><li>自定义Image组件，双向绑定数据<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L225-L262" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">GridImageView</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">blogData</span>: <span class="hljs-title class_">BlogData</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">BlogData</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-variable">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span> = <span class="hljs-variable">params</span>.<span class="hljs-variable">blogData</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Grid</span>() {</li><li>      <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">blogData</span>.<span class="hljs-variable">imagePixelMapArray</span>, (<span class="hljs-variable">image</span>: <span class="hljs-title class_">ImagePixelMap</span> | <span class="hljs-title class_">undefined</span>, <span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>        <span class="hljs-title function_">GridItem</span>() {</li><li>          <span class="hljs-title function_">Stack</span>() {</li><li>            <span class="hljs-title function_">ObservedImage</span>({ <span class="hljs-variable">imagePixelMap</span>: <span class="hljs-title class_">image</span> })</li><li>          }</li><li>        }</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">"1fr 1fr 1fr"</span>)</li><li>    .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">5</span>)</li><li>    .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ObservedImage</span> {</li><li>  @<span class="hljs-title function_">ObjectLink</span> <span class="hljs-variable">imagePixelMap</span>: <span class="hljs-title class_">ImagePixelMap</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imagePixelMap</span>.<span class="hljs-variable">imagePixelMap</span>)</li><li>      .<span class="hljs-title function_">sourceSize</span>({ <span class="hljs-variable">width</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">height</span>: <span class="hljs-number">100</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">objectFit</span>(<span class="hljs-variable">ImageFit</span>.<span class="hljs-variable">Cover</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/CombineItemListPage.ets#L225-L262" target="_blank">CombineItemListPage.ets</a></div></div></div></div> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section2776129203114">长列表侧滑删除场景<i class="anchor-icon anchor-icon-link" anchorid="section2776129203114" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 694px;"><h3 id="section67762953113" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section67762953113" tips="复制节点链接"></i></h3><p>侧滑菜单在许多应用中十分常见。例如，在通讯类应用中，通常会为消息列表提供侧滑删除功能，即用户可以通过向左滑动列表中的某一项，然后点击删除按钮来删除消息。</p> <div class="fignone"><span class="figcap"><b>图12 </b>侧滑删除效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.84546808976724505265761164020191:50001231000000:2800:A80AB474EA66F8C4C20B5FC65A10BEDA949502184E520D191A70EB044CDD1E10.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 2664px;"><h3 id="section77773914316">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section77773914316" tips="复制节点链接"></i></h3><ol><li>标准列表侧滑删除<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L42-L269" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SameItemListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">initView</span>() {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setItemViewStyle</span>((<span class="hljs-variable">item</span>, <span class="hljs-variable">index</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">Params</span>) =&gt; {</li><li>      <span class="hljs-title function_">item</span>({ <span class="hljs-variable">style</span>: <span class="hljs-title class_">ListItemStyle</span>.<span class="hljs-title class_">NONE</span> })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'auto'</span>)</li><li>        .<span class="hljs-title function_">swipeAction</span>({</li><li>          <span class="hljs-variable">end</span>: { <span class="hljs-variable">builder</span>: () =&gt; <span class="hljs-keyword">this</span>.<span class="hljs-title function_">ItemActionEnd</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">blogData</span>) },</li><li>          <span class="hljs-variable">start</span>: { <span class="hljs-variable">builder</span>: () =&gt; <span class="hljs-keyword">this</span>.<span class="hljs-title function_">ItemActionStart</span>(<span class="hljs-variable">data</span>.<span class="hljs-variable">blogData</span>) },</li><li>          <span class="hljs-variable">onOffsetChange</span>: (<span class="hljs-variable">offset</span>: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"offset:"</span> + <span class="hljs-variable">offset</span>)</li><li>        })</li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"index:"</span> + <span class="hljs-variable">index</span>))</li><li>    })</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">ItemActionStart</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-title function_">Row</span>() {</li><li>      <span class="hljs-title function_">Text</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.collection'</span>))</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">ItemActionEnd</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">BlogData</span>) {</li><li>    <span class="hljs-title function_">Row</span>() {</li><li>      <span class="hljs-title function_">Text</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.string.delete'</span>))</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_">Column</span>() {</li><li>          <span class="hljs-title function_">RecyclerView</span>({</li><li>            <span class="hljs-variable">viewManager</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">myListManager</span></li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L42-L269" target="_blank">SameItemListPage.ets</a></div></div></div></div> </li><li>分组列表侧滑删除<p>目前ListItemGroupManage是写在ListManager内部的，侧滑组件groupManager.setItemViewStyle()需要在ListManager.onWillCreateItem()内部设置。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L31-L452" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onWillCreateItem</span>(<span class="hljs-variable">_index</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">CategoryModel</span>): <span class="hljs-title class_">NodeItem</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">groupManager</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MyListItemGroupManager</span>({ <span class="hljs-variable">defaultNodeItem</span>: <span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-variable">context</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span> });</li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">registerNodeItem</span>(<span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-variable">GoodItemContainer</span>));</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">setItemViewStyle</span>((<span class="hljs-variable">listItem</span>, <span class="hljs-variable">index</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">ParamsGoods</span>) =&gt; {</li><li>      <span class="hljs-comment">// Used to set the scratch component of ListItem.</span></li><li>      <span class="hljs-title function_">listItem</span>().<span class="hljs-title function_">swipeAction</span>({</li><li>        <span class="hljs-variable">end</span>: {</li><li>          <span class="hljs-variable">builderComponent</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">ComponentContent</span>&lt;[<span class="hljs-title class_">number</span>, <span class="hljs-title class_">GoodsDataModel</span>, <span class="hljs-title class_">ListItemGroupManager</span>]&gt;(<span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span>,</li><li>            <span class="hljs-title class_">wrapBuilder</span>&lt;[[<span class="hljs-title class_">number</span>, <span class="hljs-title class_">GoodsDataModel</span>, <span class="hljs-title class_">ListItemGroupManager</span>]]&gt;(<span class="hljs-title class_">GroupItemActionEnd</span>),</li><li>            [<span class="hljs-title class_">index</span>, <span class="hljs-title class_">data</span>.<span class="hljs-title class_">dataModel</span>, <span class="hljs-title class_">groupManager</span>]),</li><li>          <span class="hljs-variable">onEnterActionArea</span>: () =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onEnterActionArea"</span>),</li><li>          <span class="hljs-variable">onExitActionArea</span>: () =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onExitActionArea"</span>),</li><li>          <span class="hljs-variable">onStateChange</span>: (<span class="hljs-variable">state</span>: <span class="hljs-title class_">SwipeActionState</span>) =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onStateChange"</span> + <span class="hljs-variable">state</span>)</li><li>        },</li><li>        <span class="hljs-variable">start</span>: {</li><li>          <span class="hljs-variable">builderComponent</span>: <span class="hljs-title class_">new</span> <span class="hljs-title class_">ComponentContent</span>&lt;[<span class="hljs-title class_">number</span>, <span class="hljs-title class_">GoodsDataModel</span>]&gt;(<span class="hljs-keyword">this</span>.<span class="hljs-title class_">context</span>,</li><li>            <span class="hljs-title class_">wrapBuilder</span>&lt;[[<span class="hljs-title class_">number</span>, <span class="hljs-title class_">GoodsDataModel</span>]]&gt;(<span class="hljs-title class_">GroupItemActionStart</span>),</li><li>            [<span class="hljs-title class_">index</span>, <span class="hljs-title class_">data</span>.<span class="hljs-title class_">dataModel</span>]),</li><li>        },</li><li>        <span class="hljs-variable">onOffsetChange</span>: (<span class="hljs-variable">offset</span>: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"offset:"</span> + <span class="hljs-variable">offset</span>),</li><li>        <span class="hljs-variable">edgeEffect</span>: <span class="hljs-title class_">SwipeEdgeEffect</span>.<span class="hljs-title class_">Spring</span>,</li><li>      })</li><li>    })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">groupManager</span>.<span class="hljs-title function_">getNodeItem</span>(<span class="hljs-keyword">this</span>);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListItemGroupManager</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">ListItemGroupManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GroupItemActionStart</span>(<span class="hljs-variable">args</span>: [<span class="hljs-variable">number</span>, <span class="hljs-variable">GoodsDataModel</span>]) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li>@<span class="hljs-title function_">Builder</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GroupItemActionEnd</span>(<span class="hljs-variable">args</span>: [<span class="hljs-variable">number</span>, <span class="hljs-variable">GoodsDataModel</span>, <span class="hljs-variable">ListItemGroupManager</span>]) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L31-L452" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> <p></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>swipeAction目前仅支持builderComponent属性的写法，且GroupItemActionEnd只能是全局builder。end和start的写法相同。</p> <p>对于需要将内部事件传递到Page页面的场景，可以通过在DataModel中设置一个点击回调属性来实现，并在Page页面进行数据传递时赋值。</p> </div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section186931312183310">长列表多类型列表项场景<i class="anchor-icon anchor-icon-link" anchorid="section186931312183310" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 694px;"><h3 id="section9733163725915" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section9733163725915" tips="复制节点链接"></i></h3><p>List组件作为整个首页长列表的容器，通过ListItem对不同模块进行视图界面的定制，常用于门户首页、商城首页等多类型视图展示的列表信息流场景。多类型列表项场景（List+ListHeaderView）参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-common-list-flows#section20614147618" target="_blank">常见列表流开发实践：多类型列表项场景</a>。</p> <div class="fignone"><span class="figcap"><b>图13 </b>ListHeaderView滑动效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.47860115983238743889444055797514:50001231000000:2800:5F98075631C45928BB035701A192B5C66949ACA52CA17E30D7BBC99DA730D6DE.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1794px;"><h3 id="section208693276598">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section208693276598" tips="复制节点链接"></i></h3><p>通过Scroll内部包含HeaderView+RecyclerView的方式实现，并通过nestedScroll()接口设置RecyclerView的嵌套滚动方式，来达到上图所示的效果。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L128-L478" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>struct GroupLayoutListPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-built_in">initView</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>    this<span class="hljs-selector-class">.myListManager</span><span class="hljs-selector-class">.setViewStyle</span>({ space: <span class="hljs-number">10</span>, scroller: this.goodsListScroller })</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-selector-class">.nestedScroll</span>({</li><li>        // <span class="hljs-number">1</span>.Nested scrolling: Set up a scrolling scheme</li><li>        scrollForward: NestedScrollMode.PARENT_FIRST,</li><li>        scrollBackward: NestedScrollMode.SELF_FIRST</li><li>      })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-comment">// Nested scrolling: Implement the ListHeader effect</span></li><li>        Scroll() { <span class="hljs-comment">// 2.Nested Scroll: Outer Scroll</span></li><li>          <span class="hljs-built_in">Column</span>() {</li><li>            <span class="hljs-built_in">ListHeaderView</span>()</li><li>            <span class="hljs-built_in">Column</span>() { <span class="hljs-comment">// 3.Nested Scrolling: Inner List</span></li><li>              <span class="hljs-built_in">RecyclerView</span>({</li><li>                viewManager: this.myListManager</li><li>              })</li><li>            }</li><li>            <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>          }</li><li>        }</li><li>        <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>        <span class="hljs-selector-class">.scrollBar</span>(BarState.Off)</li><li>        <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">@Component</span></li><li>export struct ListHeaderView {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ListHeaderView: You can set up various types of subassemblies</span></li><li>      <span class="hljs-comment">// Swiper(...){...}</span></li><li>      <span class="hljs-comment">// Grid(...){...}</span></li><li>      <span class="hljs-comment">// CustomComponent(...){...}</span></li><li>      <span class="hljs-built_in">Stack</span>({ alignContent: Alignment.Center }) {</li><li>        <span class="hljs-built_in">Image</span>($r('app.media.pic1'))</li><li>        <span class="hljs-built_in">Row</span>() {</li><li>          Text($r('app.string.i_am'))</li><li>            <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)</li><li>            <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333</span>')</li><li>          Text(' ListHeaderView')</li><li>            <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)</li><li>            <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333</span>')</li><li>        }</li><li>      }</li><li>    }</li><li>    <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Center)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L128-L478" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在ArkUI中，可通过List内部包含HeaderView+ForEach实现。HeaderView支持添加多种类型组件以实现与List同步滑动的效果，ForEach展示具体的Item。</p> <p>ScrollComponents中采用了FrameNode实现并自动管理数据源，可通过Scroll内部包含HeaderView+RecyclerView的方式实现。</p> </div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section1385691473414">长列表Tabs吸顶场景<i class="anchor-icon anchor-icon-link" anchorid="section1385691473414" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 670px;"><h3 id="section1485601483415" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1485601483415" tips="复制节点链接"></i></h3><p>Tabs嵌套List的吸顶效果，常用于新闻和资讯类应用的首页。长列表Tabs吸顶功能参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-common-list-flows#section103354617711" target="_blank">常见列表流开发实践：Tabs吸顶场景</a></p> <div class="fignone"><span class="figcap"><b>图14 </b>Tabs的TabBar吸顶效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162925.86945848594913839258133666198129:50001231000000:2800:79202725D97D55EF5F18113895DA2249450C00028AC199540A4CF7093ECC9A90.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 2712px;"><h3 id="section161851730153919">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section161851730153919" tips="复制节点链接"></i></h3><ol><li>实现Tabs组件TabContent骨架<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L31-L161" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TabsCeilingListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>            <span class="hljs-title function_">Column</span>() {</li><li>              <span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">Start</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">contentTabController</span> }) {</li><li>                <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">tabArray</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">Resource</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>                  <span class="hljs-title function_">TabContent</span>() {</li><li>                    <span class="hljs-title function_">CustomListPage</span>({ <span class="hljs-variable">index</span>: <span class="hljs-title class_">index</span> })</li><li>                  }</li><li>                  .<span class="hljs-title function_">tabBar</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">tabBuilder</span>(<span class="hljs-variable">index</span>, <span class="hljs-variable">item</span>))</li><li>                  .<span class="hljs-title function_">align</span>(<span class="hljs-variable">Alignment</span>.<span class="hljs-variable">Center</span>)</li><li>                }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>              }</li><li>              <span class="hljs-comment">// Set the height of the tab to 'calc(100% - 63vp)' to ensure that the Tabs component leaks out just when the nest slides</span></li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-string">'calc(100% - 58vp)'</span>)</li><li>              .<span class="hljs-title function_">barHeight</span>(<span class="hljs-number">56</span>)</li><li>              <span class="hljs-comment">// ...</span></li><li>              .<span class="hljs-title function_">onChange</span>((<span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-keyword">this</span>.<span class="hljs-variable">currentTabIndex</span> = <span class="hljs-variable">index</span>)</li><li>            }</li><li>            .<span class="hljs-title function_">backgroundColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.home_background_color'</span>))</li><li>            <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L31-L161" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li><li><span style="color: rgb(51,51,51);">RecyclerView</span>实现TabContent内部List页面<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L166-L252" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@Component</span></li><li>struct CustomListPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-selector-tag">aboutToAppear</span>(): <span class="hljs-selector-tag">void</span> {</li><li>    <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.myListManager</span><span class="hljs-selector-class">.setItemViewStyle</span>((_item, _index, <span class="hljs-attribute">_data</span>: ESObject) =&gt; {</li><li>    })</li><li>    <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.myListManager</span><span class="hljs-selector-class">.setViewStyle</span>({ space: 10, scroller: this.scroller, })</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-selector-tag">RecyclerView</span>({</li><li>      viewManager: this.myListManager</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li>class MyListManager extends ListManager {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">@Builder</span></li><li>function <span class="hljs-built_in">CustomListItemContainer</span>($$: ParamsItemData) {</li><li>  <span class="hljs-selector-tag">CustomListItem</span>({ itemData: $$.itemData })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L166-L252" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li><li>设置嵌套滚动模式<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L165-L230" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span>, })</li><li>    <span class="hljs-comment">// ...</span></li><li>      .<span class="hljs-title function_">nestedScroll</span>({</li><li>        <span class="hljs-variable">scrollForward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">PARENT_FIRST</span>, <span class="hljs-comment">// Set the effect of scrolling the component to the end: The parent component rolls first, and then rolls itself to the edge</span></li><li>        <span class="hljs-variable">scrollBackward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-title class_">SELF_FIRST</span> <span class="hljs-comment">// Set the effect of rolling the component to the start end: Rolls itself first, and then the parent component scrolls to the edge</span></li><li>      })</li><li>    <span class="hljs-comment">// Shared multiplexing pools</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L165-L230" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li><li>设置List组件的高度在滑动到顶部时漏出Tabs组件<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L30-L160" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TabsCeilingListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>            <span class="hljs-title function_">Column</span>() {</li><li>              <span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">Start</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">contentTabController</span> }) {</li><li>                <span class="hljs-comment">// ...</span></li><li>              }</li><li>              <span class="hljs-comment">// Set the height of the tab to 'calc(100% - 63vp)' to ensure that the Tabs component leaks out just when the nest slides</span></li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-string">'calc(100% - 58vp)'</span>)</li><li>              .<span class="hljs-title function_">barHeight</span>(<span class="hljs-number">56</span>)</li><li>              <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/TabsCeilingListPage.ets#L30-L160" target="_blank">TabsCeilingListPage.ets</a></div></div></div></div> </li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>存在的问题：当Tabs设置为吸顶时，nestedScroll属性设置不生效。</p> <p>解决方案：RecyclerView内部默认使用.layoutWeight(1)自动填充高度，需在最外层添加一个布局组件，并设置其高度为.height(calc(100% - 50vp))，以正确设置RecyclerView的高度。</p> </div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section1571163617617">分组吸顶场景<i class="anchor-icon anchor-icon-link" anchorid="section1571163617617" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 742px;"><h3 id="section17262333173113" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section17262333173113" tips="复制节点链接"></i></h3><p>双列表同向联动，左侧分类列表用于快速索引，内容列表依据分类进行分组，常用于商品分类选择、通讯录、城市选择、分组选择等页面。长列表分组吸顶功能参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-common-list-flows#section16551551888" target="_blank">常见列表流开发实践：分组吸顶场景</a>。</p> <p>本案例实现商品分类选择页面列表头部分类吸顶效果，如下图所示。</p> <div class="fignone"><span class="figcap"><b>图15 </b>分组布局组头吸顶效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162926.10822715406616765084350997718126:50001231000000:2800:8A0E6B6B62B77DEEC0EED6E2025BF5FE1377DC04FFC81EBAD2A6321E47314F53.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1592px;"><h3 id="section9389528123117">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9389528123117" tips="复制节点链接"></i></h3><ol><li>实现商品分类页面的分组展示<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L30-L346" data-highlighted="yes"><ol class="linenums"><li>class MyListManager extends ListManager {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>class MyListItemGroupManager extends ListItemGroupManager {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">@Component</span></li><li>struct GroupLayoutListPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Row</span>() {</li><li>        <span class="hljs-built_in">List</span>({ scroller: this.categoryScroller }) {</li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">100</span>)</li><li>        <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>        <span class="hljs-selector-class">.scrollBar</span>(BarState.Off)</li><li>
</li><li>        <span class="hljs-comment">// Nested scrolling: Implement the ListHeader effect</span></li><li>        Scroll() { <span class="hljs-comment">// 2.Nested Scroll: Outer Scroll</span></li><li>          <span class="hljs-built_in">Column</span>() {</li><li>            <span class="hljs-built_in">ListHeaderView</span>()</li><li>            <span class="hljs-built_in">Column</span>() { <span class="hljs-comment">// 3.Nested Scrolling: Inner List</span></li><li>              <span class="hljs-built_in">RecyclerView</span>({</li><li>                viewManager: this.myListManager</li><li>              })</li><li>            }</li><li>            <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>          }</li><li>        }</li><li>        <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>        <span class="hljs-selector-class">.scrollBar</span>(BarState.Off)</li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">@Builder</span></li><li>function GoodItemContainer($$: ParamsGoods) {</li><li>  <span class="hljs-built_in">GoodItem</span>({ dataModel: $$.dataModel })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L30-L346" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>设置吸顶属性<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L155-L196" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">initView</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">goodsListScroller</span> })</li><li>    <span class="hljs-comment">// ...</span></li><li>    .<span class="hljs-title function_">sticky</span>(<span class="hljs-title class_">StickyStyle</span>.<span class="hljs-property">Header</span>)<span class="hljs-comment">// Set up grouped ceilings</span></li><li>    <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L155-L196" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section118736339353">长列表二级联动场景<i class="anchor-icon anchor-icon-link" anchorid="section118736339353" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 766px;"><h3 id="section1910111529234" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1910111529234" tips="复制节点链接"></i></h3><p>通过选择左侧的一级列表，右侧的二级列表数据将相应更新，常用于商品分类选择、编辑风格等二级类别选择页面。长列表二级联动功能参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-common-list-flows#section323632114913" target="_blank">常见列表流开发实践：二级联动场景</a>。</p> <p>本场景以商品分类列表页面为例，分别使用List组件展示左侧分类导航和右侧导航内容。进入页面后，点击左侧分类导航，右侧将展示对应的分类详情列表数据；滑动右侧列表内容时，列表标题将吸顶显示，同时左侧对应的导航内容高亮显示。</p> <div class="fignone"><span class="figcap"><b>图16 </b>长列表二级联动效果图</span><br><span><img height="553.1869" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162926.93333593872067030741661898932836:50001231000000:2800:199F782BA86D5D3BD2152FA4A3A7996492B7DECD5E91D6BAF85512A2327FDB63.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 56px;"><h3 id="section101011452112314">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section101011452112314" tips="复制节点链接"></i></h3></div> <ol><li>通过List组件构建左侧分类导航数据<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L224-L244" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">List</span>({ <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">categoryScroller</span> }) {</li><li>  <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">myViewModel</span>.<span class="hljs-variable">categoryList</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">CategoryModel</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">titleName</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">CategoryModel</span>) =&gt; <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">titleName</span>))</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L224-L244" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>通过RecyclerView构建右侧分类内容数据，以及Item复用相关代码<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L29-L290" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListManager</span> <span class="hljs-title">extends</span> <span class="hljs-title">ListManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListItemGroupManager</span> <span class="hljs-title">extends</span> <span class="hljs-title">ListItemGroupManager</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct GroupLayoutListPage {</li><li>  <span class="hljs-comment">// ...</span></li><li>  aboutToAppear() {</li><li>    <span class="hljs-keyword">this</span>.initView();</li><li>    <span class="hljs-keyword">this</span>.myListManager.registerNodeItem(<span class="hljs-string">'GoodItemContainer'</span>, wrapBuilder(GoodItemContainer));</li><li>    <span class="hljs-keyword">this</span>.myListManager.preCreate(<span class="hljs-string">'GoodItemContainer'</span>, <span class="hljs-number">30</span>);</li><li>    <span class="hljs-keyword">this</span>.myViewModel.loadData();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  build() {</li><li>    <span class="hljs-comment">// ...</span></li><li>            Column() { <span class="hljs-comment">// 3.Nested Scrolling: Inner List</span></li><li>              RecyclerView({</li><li>                viewManager: <span class="hljs-keyword">this</span>.myListManager</li><li>              })</li><li>            }</li><li>            .height(<span class="hljs-string">'100%'</span>)</li><li>            <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L29-L290" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li><li>为左侧导航列表添加点击事件，为右侧分类详情列表添加<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onscrollindex" target="_blank">onScrollIndex()</a>事件，并调用自定义的listChange方法。在listChange方法内部，根据isGoods变量的值，调用相应列表控制器的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolltoindex" target="_blank">scrollToIndex()</a>方法，以实现导航列表和分类详情数据的联动效果。<div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L223-L245" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>({ <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">categoryScroller</span> }) {</li><li>  <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myViewModel</span>.<span class="hljs-property">categoryList</span>, <span class="hljs-function">(<span class="hljs-params">item: CategoryModel, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">titleName</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listChange</span>(index, <span class="hljs-literal">true</span>))</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: CategoryModel</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item.<span class="hljs-property">titleName</span>))</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L223-L245" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> <p></p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L152-L210" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">initView</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">goodsListScroller</span> })</li><li>    <span class="hljs-comment">// ...</span></li><li>    .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-comment">// Scrolling listeners</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listChange</span>(index, <span class="hljs-literal">false</span>);</li><li>    })</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-title function_">listChange</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, isGoods: <span class="hljs-built_in">boolean</span></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTitleId</span> !== index) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTitleId</span> = index;</li><li>    <span class="hljs-keyword">if</span> (isGoods) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">goodsListScroller</span>.<span class="hljs-title function_">scrollToIndex</span>(index);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">categoryScroller</span>.<span class="hljs-title function_">scrollToIndex</span>(index);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/GroupLayoutListPage.ets#L152-L210" target="_blank">GroupLayoutListPage.ets</a></div></div></div></div> </li></ol> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section18837143619351">长列表动态切换列数场景<i class="anchor-icon anchor-icon-link" anchorid="section18837143619351" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 694px;"><h3 id="section123371648203514" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section123371648203514" tips="复制节点链接"></i></h3><p>当设备在横屏和竖屏之间切换，或折叠屏在小屏、中屏和大屏状态之间切换时，长列表的显示列数将根据当前屏幕宽度进行调整，以展示更合适大小的Item。</p> <div class="fignone"><span class="figcap"><b>图17 </b>动态切换列数效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162926.25405483196026368537808189268356:50001231000000:2800:AB50132A7828BBBF9EA5BB4B9FD8CF59D91446A8C1BD7DE12182B4A440DB361C.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 1227px;"><h3 id="section12338848103519">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section12338848103519" tips="复制节点链接"></i></h3><p>首先，设置页面可自由旋转，然后监听屏幕尺寸的变化。当发现宽度大于高度时，设置为2列。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L38-L268" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SameItemListPage</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">private</span> windowClass = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">getMainWindowSync</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">listChildrenSize</span>: <span class="hljs-title class_">ChildrenMainSize</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChildrenMainSize</span>(<span class="hljs-number">100</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// The settings page is free to rotate</span></li><li>    <span class="hljs-keyword">let</span> orientation = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Orientation</span>.<span class="hljs-property">AUTO_ROTATION</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setPreferredOrientation</span>(orientation, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">errCode</span>: <span class="hljs-built_in">number</span> = err.<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">if</span> (errCode) {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set window orientation. Cause:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeed to setting window orientation'</span>);</li><li>    })</li><li>    <span class="hljs-comment">// Listen for screen size changes</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowSizeChange'</span>, <span class="hljs-function">(<span class="hljs-params">size</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> viewWidth = size.<span class="hljs-property">width</span>;</li><li>      <span class="hljs-keyword">let</span> viewHeight = size.<span class="hljs-property">height</span>;</li><li>      <span class="hljs-keyword">if</span> (viewWidth &gt; viewHeight) { <span class="hljs-comment">// Criteria are judged based on business settings</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>().<span class="hljs-title function_">lanes</span>(<span class="hljs-number">2</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>().<span class="hljs-title function_">lanes</span>(<span class="hljs-number">1</span>);</li><li>      }</li><li>    })</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initView</span>();</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-title function_">initView</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">listScroller</span> })</li><li>    <span class="hljs-comment">// ...</span></li><li>      .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-title class_">ListItemAlign</span>.<span class="hljs-property">Start</span>)<span class="hljs-comment">// Set the direction of the List cross axis</span></li><li>      .<span class="hljs-title function_">lanes</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">// Set the number of layout columns or rows in the List portlet</span></li><li>      <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L38-L268" target="_blank">SameItemListPage.ets</a></div></div></div></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在Item高度一致的情况下，推荐使用动态改变列数的场景。当Item大小不一致时，动态设置显示的列数，当前行的高度将以最高的Item为准，这可能导致部分空白区域的出现。此时，需要开发者自行选择合适的布局方案。</p> <p>目前不支持使用@State属性对List的属性进行双向绑定，需通过this.myListManager.setViewStyle().xxxx的格式进行设置。</p> </div></div></div> <div class="tiledSection" style="contain-intrinsic-size: auto 80px;"><h2 id="section2654630183815">设置边缘渐隐场景<i class="anchor-icon anchor-icon-link" anchorid="section2654630183815" tips="复制节点链接"></i></h2></div> <div class="tiledSection" style="contain-intrinsic-size: auto 670px;"><h3 id="section146541230123814" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section146541230123814" tips="复制节点链接"></i></h3><p>通过设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#fadingedge14" target="_blank">fadingEdge</a>属性来实现边缘渐隐效果，效果如图所示。</p> <div class="fignone"><span class="figcap"><b>图18 </b>边缘渐隐效果图</span><br><span><img height="553.5194" originheight="1080" originwidth="519" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162926.51859647989955685732121522666325:50001231000000:2800:99F30A8647BE6002FE125237232AD791E6E39CEB737973E0C5CFAC46DAAA0FA4.gif" title="点击放大" width="266"></span></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 291px;"><h3 id="section765433019382">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section765433019382" tips="复制节点链接"></i></h3><p>可以直接在setViewStyle接口中设置渐隐效果。</p> <div class="screenLinkPre"><div _ngcontent-osp-c106="" class="highlight-div"><div _ngcontent-osp-c106="" class="highlight-div-header"><div _ngcontent-osp-c106="" class="highlight-div-header-left"><div _ngcontent-osp-c106="" class="handle-button expand-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-osp-c106="" class="highlight-div-header-right"><div _ngcontent-osp-c106="" class="handle-button ai-button"></div><div _ngcontent-osp-c106="" class="handle-button line-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-osp-c106="" class="handle-button theme-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-osp-c106="" class="handle-button copy-button"><div _ngcontent-osp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-osp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L124-L158" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">myListManager</span>.<span class="hljs-title function_">setViewStyle</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">listScroller</span> })</li><li><span class="hljs-comment">// ...</span></li><li>  .<span class="hljs-title function_">fadingEdge</span>(<span class="hljs-keyword">true</span>, { <span class="hljs-variable">fadingEdgeLength</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">vp</span>(<span class="hljs-number">80</span>) })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/ListScrollComponent/blob/master/entry/src/main/ets/pages/SameItemListPage.ets#L124-L158" target="_blank">SameItemListPage.ets</a></div></div></div></div> </div> <div class="tiledSection" style="contain-intrinsic-size: auto 116px;"><h2 id="section14762914144214">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section14762914144214" tips="复制节点链接"></i></h2><p><a href="https://gitee.com/harmonyos_samples/ListScrollComponent" target="_blank">流畅滑动长列表页面</a></p> </div> </div></div>