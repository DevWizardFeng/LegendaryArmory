<h1 _ngcontent-aoy-c119="" class="doc-title ng-star-inserted" title="基于系统能力获取视频缩略图"> 基于系统能力获取视频缩略图 </h1>

<div _ngcontent-aoy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section116975521271">概述<i class="anchor-icon anchor-icon-link" anchorid="section116975521271" tips="复制节点链接"></i></h2><p>视频缩略图是视频的静态预览图像，是从视频中截取的某一帧画面，经常用作视频的封面。在视频浏览、分享和管理等场景中使用可以帮助用户快速浏览和选择想要的内容，提高用户的使用体验。HarmonyOS提供了对应的模块能力，帮助开发者获取视频文件的缩略图。根据应用获取缩略图策略的不同，可以分为以下两种场景：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-video-thumbnail#section14470163720352">获取视频默认缩略图</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-video-thumbnail#section1848255103812">选取视频帧作为缩略图</a></li></ul> </div> <div class="tiledSection"><h2 id="section14470163720352">获取视频默认缩略图<i class="anchor-icon anchor-icon-link" anchorid="section14470163720352" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section14115149192117" class="firsth2">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section14115149192117" tips="复制节点链接"></i></h3><p>视频的默认缩略图一般为视频的第一帧，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoasset" target="_blank">PhotoAsset</a>类的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoasset#getthumbnail-2" target="_blank">getThumbnail()</a>方法获取。这里以获取图库视频缩略图场景为例。</p> </div> <div class="tiledSection"><h3 id="section35829248387">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section35829248387" tips="复制节点链接"></i></h3><ol><li>通过相册管理模块<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-photoaccesshelper" target="_blank">@ohos.file.photoAccessHelper</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoviewpicker" target="_blank">PhotoViewPicker</a>选取图库视频，获得视频的URL。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L28-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Pull up the gallery picker and select a video.</span></li><li><span class="hljs-comment"> * @returns The url of the selected video.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-variable">async</span> <span class="hljs-title function_">selectVideo</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">string</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">photoViewPicker</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">photoAccessHelper</span>.<span class="hljs-title function_">PhotoViewPicker</span>();</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">photoViewPicker</span>.<span class="hljs-title function_">select</span>({</li><li>    <span class="hljs-variable">MIMEType</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoViewMIMETypes</span>.<span class="hljs-title class_">VIDEO_TYPE</span>,</li><li>    <span class="hljs-variable">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>  }).<span class="hljs-title function_">then</span>((<span class="hljs-variable">photoSelectResult</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoSelectResult</span>): <span class="hljs-title class_">string</span> =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">photoSelectResult</span>.<span class="hljs-variable">photoUris</span>.<span class="hljs-variable">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">photoSelectResult</span>.<span class="hljs-variable">photoUris</span>[<span class="hljs-number">0</span>];</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L28-L43" target="_blank">PhotoUtils.ets</a></div></div></div></div> </li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoaccesshelper#getassets-1" target="_blank">getAssets()</a>方法，通过选择的图库视频的URL获取视频资源。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L53-L61" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Obtain video resources.</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">predicates</span>: <span class="hljs-title class_">dataSharePredicates</span>.<span class="hljs-title class_">DataSharePredicates</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">dataSharePredicates</span>.<span class="hljs-title function_">DataSharePredicates</span>();</li><li><span class="hljs-variable">predicates</span>.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'uri'</span>, <span class="hljs-variable">videoUrl</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">videoFetchResult</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">FetchResult</span>&lt;<span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoAsset</span>&gt; =</li><li>  <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">phAccessHelper</span>.<span class="hljs-title function_">getAssets</span>({</li><li>    <span class="hljs-variable">fetchColumns</span>: [<span class="hljs-string">'width'</span>, <span class="hljs-string">'height'</span>, <span class="hljs-string">'orientation'</span>],</li><li>    <span class="hljs-variable">predicates</span>: <span class="hljs-title class_">predicates</span></li><li>  });</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">photoAsset</span>: <span class="hljs-title class_">photoAccessHelper</span>.<span class="hljs-title class_">PhotoAsset</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">videoFetchResult</span>.<span class="hljs-title function_">getFirstObject</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L53-L61" target="_blank">PhotoUtils.ets</a></div></div></div></div> </li><li>根据视频资源的属性配置缩略图的尺寸信息，调用getThumbnail()方法获取PixelMap格式的图片。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L64-L74" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Configure thumbnail parameters.</span></li><li><span class="hljs-keyword">let</span> thumbnailSize: Size = { width: <span class="hljs-number">0</span>, height: <span class="hljs-number">0</span> };</li><li><span class="hljs-keyword">if</span> (photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.ORIENTATION) === <span class="hljs-number">90</span> ||</li><li>  photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.ORIENTATION) === <span class="hljs-number">270</span>) {</li><li>  thumbnailSize.width = photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.HEIGHT) <span class="hljs-keyword">as</span> number;</li><li>  thumbnailSize.height = photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.WIDTH) <span class="hljs-keyword">as</span> number;</li><li>} <span class="hljs-keyword">else</span> {</li><li>  thumbnailSize.width = photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.WIDTH) <span class="hljs-keyword">as</span> number;</li><li>  thumbnailSize.height = photoAsset.<span class="hljs-keyword">get</span>(photoAccessHelper.PhotoKeys.HEIGHT) <span class="hljs-keyword">as</span> number;</li><li>}</li><li><span class="hljs-keyword">return</span> photoAsset.getThumbnail(thumbnailSize);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L64-L74" target="_blank">PhotoUtils.ets</a></div></div></div></div> </li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>使用getAsset()和getThumbnail()方法需要申请受限开放权限'<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/restricted-permissions#ohospermissionread_imagevideo" target="_blank">ohos.permission.READ_IMAGEVIDEO'</a>，对于需要克隆、备份或同步图片/视频类文件的应用可申请获取该权限，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-photoaccesshelper#getalbums" target="_blank">getAlbums()</a>方法获取相册资源再调用这两个方法获取缩略图。或者通过picker的方式可以在不获取权限的情况下，使用这两个方法来访问用户指定的图库资源获取缩略图。本文中的示例使用的是第二种picker的方式。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section115752421389">实现效果<i class="anchor-icon anchor-icon-link" anchorid="section115752421389" tips="复制节点链接"></i></h3><p><span><img height="549.2900000000001" originheight="1077" originwidth="521" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163040.03379496412659404316734659139105:50001231000000:2800:2793215734EC7D2E58B709E24011D6B01A7140F43536D1C9F3421BD4109EA048.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section1848255103812">选取视频帧作为缩略图<i class="anchor-icon anchor-icon-link" anchorid="section1848255103812" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section35395222615" class="firsth2">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section35395222615" tips="复制节点链接"></i></h3><p>HarmonyOS提供视频缩略图获取类<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avimagegenerator" target="_blank">AVImageGenerator</a>用于选取视频指定时间的帧作为缩略图，这里以选取图库视频缩略图场景为例。</p> </div> <div class="tiledSection"><h3 id="section9538201416394">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9538201416394" tips="复制节点链接"></i></h3><ol><li>拉起图库picker，选取视频获取文件资源描述符。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L74-L108" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Obtain video resources through AVImageGenerator.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">imageGeneratorGetThumbnail</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">photoUtils</span>.<span class="hljs-title function_">selectVideo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span>) =&gt; {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileAlbum</span> = fileIo.<span class="hljs-title function_">openSync</span>(result, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">avFileDescriptor</span> = { <span class="hljs-attr">fd</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileAlbum</span>.<span class="hljs-property">fd</span> };</li><li>    <span class="hljs-comment">// ...</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>,</li><li>      <span class="hljs-string">`Invoke imageGeneratorGetThumbnail failed!, error code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L74-L108" target="_blank">Index.ets</a></div></div></div></div> </li><li>根据文件资源描述符获取视频元数据信息。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L82-L99" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Get video infos through video file descriptor.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> avFileDescriptor AVFileDescriptor of video.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> the size infos of video.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">getVideoData</span>(<span class="hljs-attr">avFileDescriptor</span>: media.<span class="hljs-property">AVFileDescriptor</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">VideoSizeData</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">videoSize</span>: <span class="hljs-title class_">VideoSizeData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoSizeData</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">avMetaDataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li><li>  avMetaDataExtractor.<span class="hljs-property">fdSrc</span> = avFileDescriptor;</li><li>  <span class="hljs-keyword">let</span> metadata = <span class="hljs-keyword">await</span> avMetaDataExtractor.<span class="hljs-title function_">fetchMetadata</span>();</li><li>  videoSize.<span class="hljs-property">photoSize</span>.<span class="hljs-property">width</span> = <span class="hljs-built_in">parseInt</span>(metadata.<span class="hljs-property">videoWidth</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);</li><li>  videoSize.<span class="hljs-property">photoSize</span>.<span class="hljs-property">height</span> = <span class="hljs-built_in">parseInt</span>(metadata.<span class="hljs-property">videoHeight</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);</li><li>  <span class="hljs-keyword">if</span> (metadata.<span class="hljs-property">duration</span>) {</li><li>    videoSize.<span class="hljs-property">totalTime</span> = <span class="hljs-built_in">parseInt</span>(metadata.<span class="hljs-property">duration</span>);</li><li>  }</li><li>  avMetaDataExtractor.<span class="hljs-title function_">release</span>();</li><li>  <span class="hljs-keyword">return</span> videoSize;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/common/utils/PhotoUtils.ets#L82-L99" target="_blank">PhotoUtils.ets</a></div></div></div></div> </li><li>创建AVImageGenerator。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L94-L100" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.avImageGenerator = await media.createAVImageGenerator();</li><li><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.avImageGenerator) {</li><li>  <span class="hljs-keyword">this</span>.avImageGenerator.fdSrc = <span class="hljs-keyword">this</span>.avFileDescriptor;</li><li>} <span class="hljs-keyword">else</span> {</li><li>  hilog.error(<span class="hljs-number">0X0000</span>, TAG, <span class="hljs-string">'Create AVImageGenerator failed!'</span>);</li><li>  <span class="hljs-keyword">return</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L94-L100" target="_blank">Index.ets</a></div></div></div></div> </li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avimagegenerator#fetchframebytime12-1" target="_blank">fetchFrameByTime()</a>方法来获取指定时间的缩略图，返回PixelMap格式的图片。<div class="screenLinkPre"><div _ngcontent-aoy-c106="" class="highlight-div"><div _ngcontent-aoy-c106="" class="highlight-div-header"><div _ngcontent-aoy-c106="" class="highlight-div-header-left"><div _ngcontent-aoy-c106="" class="handle-button expand-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aoy-c106="" class="highlight-div-header-right"><div _ngcontent-aoy-c106="" class="handle-button ai-button"></div><div _ngcontent-aoy-c106="" class="handle-button line-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aoy-c106="" class="handle-button theme-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aoy-c106="" class="handle-button copy-button"><div _ngcontent-aoy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aoy-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L43-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Obtain a frame at a certain point in time of the video.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> time A certain point in time of the video.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchFrameByTime</span>(<span class="hljs-params">time: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">avImageGenerator</span>?.<span class="hljs-title function_">fetchFrameByTime</span>(time,</li><li>    media.<span class="hljs-property">AVImageQueryOptions</span>.<span class="hljs-property">AV_IMAGE_QUERY_CLOSEST_SYNC</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoSize</span>.<span class="hljs-property">photoSize</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/VideoThumbnail/blob/master/entry/src/main/ets/pages/Index.ets#L43-L50" target="_blank">Index.ets</a></div></div></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="section13595145018398">实现效果<i class="anchor-icon anchor-icon-link" anchorid="section13595145018398" tips="复制节点链接"></i></h3><p><span><img height="549.2900000000001" originheight="1077" originwidth="521" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163040.18368245159993212488824951270822:50001231000000:2800:D85F518380E0B1F56B5ABD8BCBBAF11D3B9D37DE5C9281359B4D79B6F795A8C7.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section58118110206">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section58118110206" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1613941114218" class="firsth2">如何获取网络视频的缩略图<i class="anchor-icon anchor-icon-link" anchorid="section1613941114218" tips="复制节点链接"></i></h3><p>推荐使用系统在API20上的新增接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avmetadataextractor#seturlsource20" target="_blank">setUrlSource()</a>，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avmetadataextractor" target="_blank">AVMetadataExtractor</a>实例中调用该接口获取网络视频url地址对应的数据源，再调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avmetadataextractor#fetchframebytime20" target="_blank">fetchFrameByTime()</a>接口即可获取网络视频的缩略图。</p> </div> <div class="tiledSection"><h2 id="section9501143262218">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section9501143262218" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/VideoThumbnail" target="_blank">基于系统能力获取视频缩略图</a></li></ul> </div> </div> <div></div></div>