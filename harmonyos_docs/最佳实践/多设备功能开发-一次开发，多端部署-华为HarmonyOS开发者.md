<h1 _ngcontent-kmi-c119="" class="doc-title ng-star-inserted" title="多设备功能开发"> 多设备功能开发 </h1>

<div _ngcontent-kmi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>应用开发至少包含两部分工作： UI页面开发和底层功能开发（部分需要联网的应用还会涉及服务端开发）。前面章节介绍了如何解决页面适配的问题，本章节主要介绍应用如何解决设备系统能力差异的兼容问题。</p> <div class="tiledSection"><h2 id="系统能力">系统能力<i class="anchor-icon anchor-icon-link" anchorid="系统能力" tips="复制节点链接"></i></h2><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/syscap" target="_blank">系统能力SystemCapability使用指南</a>（即SystemCapability，缩写为SysCap）指操作系统中每一个相对独立的特性，如蓝牙，WIFI，NFC，摄像头等，都是系统能力之一。每个系统能力对应多个API，随着目标设备是否支持该系统能力共同存在或消失。</p> <p>与系统能力相关的，有支持能力集、联想能力集和要求能力集三个核心概念。</p> <ul><li><strong>支持能力集</strong>：设备具备的系统能力集合，在设备配置文件中配置。</li><li><strong>要求能力集</strong>：应用需要的系统能力集合，在应用配置文件中配置。</li><li><strong>联想能力集</strong>：开发应用时DevEco Studio可联想的API所在的系统能力集合，在应用配置文件中配置。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>只有当应用要求能力集是设备支持能力集的子集的时候，应用才可以在该设备上分发、安装和运行。</li><li>系统能力使用可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/syscap" target="_blank">系统能力SystemCapability使用指南</a>。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="多设备应用开发">多设备应用开发<i class="anchor-icon anchor-icon-link" anchorid="多设备应用开发" tips="复制节点链接"></i></h2><p>开发多设备应用时，工程中默认的要求能力集是多个设备支持能力集的交集，默认的联想能力集是多个设备支持能力集的并集。</p> <ul><li><p>开发者可以在运行时动态判断某设备是否支持特定的系统能力。</p> </li><li><p>开发者可以自行修改联想能力集和要求能力集。</p> </li></ul> <p><strong>动态逻辑判断</strong></p> <p>如果某个系统能力没有写入应用的要求能力集中，那么在使用前需要判断设备是否支持该系统能力。</p> <ul><li><p>方法1：canIUse()接口帮助开发者来判断该设备是否支持某个特定的syscap。</p> <div class="screenLinkPre"><div _ngcontent-kmi-c106="" class="highlight-div"><div _ngcontent-kmi-c106="" class="highlight-div-header"><div _ngcontent-kmi-c106="" class="highlight-div-header-left"><div _ngcontent-kmi-c106="" class="handle-button expand-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kmi-c106="" class="highlight-div-header-right"><div _ngcontent-kmi-c106="" class="handle-button ai-button"></div><div _ngcontent-kmi-c106="" class="handle-button line-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kmi-c106="" class="handle-button theme-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kmi-c106="" class="handle-button copy-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kmi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-go" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/Index.ets#L13-L17" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (canIUse(<span class="hljs-string">'SystemCapability.Communication.NFC.Core'</span>)) {</li><li>  hilog.info(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">`该设备支持SystemCapability.Communication.NFC.Core`</span>);</li><li>} <span class="hljs-keyword">else</span> {</li><li>  hilog.<span class="hljs-type">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">`该设备不支持SystemCapability.Communication.NFC.Core`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/Index.ets#L13-L17" target="_blank">Index.ets</a></div></div></div></div> </li><li><p>方法2：开发者可通过import的方式将模块导入，若当前设备不支持该模块，import的结果为undefined，开发者在使用其API时，需要判断其是否存在。</p> <div class="screenLinkPre"><div _ngcontent-kmi-c106="" class="highlight-div"><div _ngcontent-kmi-c106="" class="highlight-div-header"><div _ngcontent-kmi-c106="" class="highlight-div-header-left"><div _ngcontent-kmi-c106="" class="handle-button expand-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kmi-c106="" class="highlight-div-header-right"><div _ngcontent-kmi-c106="" class="handle-button ai-button"></div><div _ngcontent-kmi-c106="" class="handle-button line-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kmi-c106="" class="handle-button theme-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kmi-c106="" class="handle-button copy-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kmi-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/Index.ets#L2-L47" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { nfcController } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ConnectivityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">canIUseNfc</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">'SystemCapability.Communication.NFC.Core'</span>)) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">`该设备支持SystemCapability.Communication.NFC.Core`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">`该设备不支持SystemCapability.Communication.NFC.Core`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/orientationDevelopment/entry/src/main/ets/pages/Index.ets#L2-L47" target="_blank">Index.ets</a></div></div></div></div> </li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>如果某系统能力是应用运行必须的，则要将其写入到应用的要求能力集中，以确保应用不会分发和安装到不符合要求的设备上。</li><li>如果某系统能力不是应用运行必须的，则可以在运行时做动态判断，这样可以最大程度扩大应用的适用范围。</li></ul> </div></div></div> <p><strong>配置联想能力集和要求能力集</strong></p> <p>DevEco Studio会根据创建的工程所支持的设备自动配置联想能力集和要求能力集，同时也支持开发者修改。</p> <div _ngcontent-kmi-c106="" class="highlight-div"><div _ngcontent-kmi-c106="" class="highlight-div-header"><div _ngcontent-kmi-c106="" class="highlight-div-header-left"><div _ngcontent-kmi-c106="" class="handle-button expand-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kmi-c106="" class="highlight-div-header-right"><div _ngcontent-kmi-c106="" class="handle-button ai-button"></div><div _ngcontent-kmi-c106="" class="handle-button line-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kmi-c106="" class="handle-button theme-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kmi-c106="" class="handle-button copy-button"><div _ngcontent-kmi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kmi-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// syscap.json</span></li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"devices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"general"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>            </li><li>            <span class="hljs-string">"default"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-string">"tablet"</span></li><li>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"custom"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>            </li><li>            <span class="hljs-punctuation">{</span></li><li>                <span class="hljs-attr">"Custom Device"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>                    <span class="hljs-string">"SystemCapability.Communication.SoftBus.Core"</span></li><li>                <span class="hljs-punctuation">]</span></li><li>            <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>             </li><li>        <span class="hljs-attr">"addedSysCaps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>            <span class="hljs-string">"SystemCapability.Communication.NFC.Core"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>              </li><li>        <span class="hljs-attr">"addedSysCaps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>      </li><li>        <span class="hljs-attr">"removedSysCaps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>     </li><li>    <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>对于要求能力集，开发者修改时要十分慎重，修改不当会导致应用无法分发和安装到目标设备上。</li><li>对于联想能力集，通过增加系统能力可以扩大DevEco Studio可联想的API范围。但要注意这些API可能在某些设备上不支持，使用前需要判断。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="总结">总结<i class="anchor-icon anchor-icon-link" anchorid="总结" tips="复制节点链接"></i></h2><p>从应用开发到用户使用，通常要经历应用分发和下载、应用安装、应用运行等环节。借助SysCap机制，可以在各个环节中加以拦截或管控，保证应用可以在设备上正常安装和使用。</p> <ul><li>应用分发和下载：只有当应用要求能力集是设备支持能力集的子集时（即设备满足应用运行要求），应用才可以分发到该设备。</li><li>应用安装：只有当应用要求能力集是设备支持能力集的子集时，应用才可以安装到该设备。</li><li>应用运行：应用在使用要求能力集之外的能力前，需要动态判断相应系统能力的有效性，防止崩溃或功能异常等问题。</li></ul> <p>SysCap机制可以帮助开发者仅关注设备的系统能力，而不用考虑成百上千种具体的设备类型，降低多设备应用开发难度。</p> </div> </div></div>