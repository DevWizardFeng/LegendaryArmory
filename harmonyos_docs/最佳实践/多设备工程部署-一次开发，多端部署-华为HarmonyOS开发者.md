<h1 _ngcontent-utn-c119="" class="doc-title ng-star-inserted" title="多设备工程部署"> 多设备工程部署 </h1>

<div _ngcontent-utn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1739315713611">概述<i class="anchor-icon anchor-icon-link" anchorid="section1739315713611" tips="复制节点链接"></i></h2><p>本章介绍一多应用在工程结构设计及应用上架配置中的方法。在开发<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-overview" target="_blank">”一多”</a>应用时，除了需要针对手机、平板、电脑、智能穿戴、智慧屏等不同设备的硬件特性进行适配外，还需合理组织代码工程，以提升开发效率与部署灵活性。为保障多设备间一致的用户体验，系统提供了相应的配置能力。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本章的内容基于DevEco Studio 6.0.0 Release版本进行介绍，如使用DevEco Studio其它版本，可能存在文档与产品功能界面不一致、操作不一致的情况，请以实际功能界面为准。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section4828415677">创建三层架构工程<i class="anchor-icon anchor-icon-link" anchorid="section4828415677" tips="复制节点链接"></i></h2><p>建议在应用开发过程中使用<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-overview#section73681810173312" target="_blank">架构设计</a>中介绍的“三层架构工程”，在common层存放基础公共代码，features层存放相对独立的功能模块代码，products层存放完全独立的产品代码。通过在products层依赖features和common提供的公共能力，可最大化实现代码复用与职责分离。</p> <p>“三层架构工程”将项目工程以common、features、products三个层级进行组织，以提升代码复用性与开发效率。工程结构示例如下所示：</p> <div _ngcontent-utn-c106="" class="highlight-div"><div _ngcontent-utn-c106="" class="highlight-div-header"><div _ngcontent-utn-c106="" class="highlight-div-header-left"><div _ngcontent-utn-c106="" class="handle-button expand-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-utn-c106="" class="highlight-div-header-right"><div _ngcontent-utn-c106="" class="handle-button ai-button"></div><div _ngcontent-utn-c106="" class="handle-button line-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-utn-c106="" class="handle-button theme-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-utn-c106="" class="handle-button copy-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-utn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>/application</li><li> ├── common                  <span class="hljs-comment"># 公共特性目录</span></li><li> │</li><li> ├── features                <span class="hljs-comment"># 功能模块目录</span></li><li> │   ├── feature1            <span class="hljs-comment"># 子功能</span></li><li> │   ├── feature2            <span class="hljs-comment"># 子功能2</span></li><li> │   └── ...                 <span class="hljs-comment"># 子功能n</span></li><li> │</li><li> └── products                <span class="hljs-comment"># 产品层目录</span></li><li>     ├── default             <span class="hljs-comment"># 默认设备泛类目录</span></li><li>     ├── tv                  <span class="hljs-comment"># 智慧屏泛类目录</span></li><li>     └── wearable            <span class="hljs-comment"># 智能穿戴泛类目录</span></li></ol></pre></div></div> <p>建议使用DevEco Studio直接创建出三层架构的新工程。在编译器创建工程弹框中选择Flexible Layout Ability工程模板，该模板可以创建跨设备应用开发的三层工程结构。更多工程模板介绍内容可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-template" target="_blank">工程模板介绍</a>。</p> <p><span><img originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163104.69296774634866691564227565666456:50001231000000:2800:1C724661FB424CF3FCD06BF09F9975CAADA606126EC17A733C1347E0AD9B732C.png" width="920" height="614.8979591836735"></span></p> <p>配置工程名称、包名等基本信息，选择目标支持设备，完成设置后即可创建项目。</p> <p><span><img originheight="655" originwidth="980" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163104.25436526292433743462446686239374:50001231000000:2800:0684F8439C32A026E48232C03BA1F8922DA4A666457310BC212C2B9C3845FC76.png" width="920" height="614.8979591836735"></span></p> <p>创建后的工程目录如下图所示：</p> <ul><li>common层为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package" target="_blank">HAR</a>（Harmony Archive）类型的Module，提供通用组件和工具类等基础能力支撑；</li><li>features层默认创建两个HAR类型的Module，用于封装独立的功能模块与业务逻辑，提升模块化程度与复用性；</li><li>products层创建一个entry类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package" target="_blank">HAP</a>（Harmony Ability Package）Module，作为应用的主入口模块，承载设备与场景差异化的个性化配置和启动逻辑。</li></ul> <p><span><img originheight="546" originwidth="438" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163104.47804722240052027774442762823803:50001231000000:2800:BB32AA51FF1C8B0B50809B975FB034C04CBA8A594B988B34F218D7A37EDBA8AC.png" width="438" height="546"></span></p> <p>根据业务需求，应用可以灵活规划新增或删除Module，具体操作步骤可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-add-new-module" target="_blank">添加/删除模块</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在一多应用开发中，可以根据设备类型的设计差异选择是否创建独立HAP包。例如，手机和平板的布局与功能设计类似，可共用一个HAP包；而智慧屏（TV）和智能穿戴设备（Wearable）因与其他设备相比差异较大，建议分别创建独立的HAP包。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section9471571818">修改Module类型及设备类型<i class="anchor-icon anchor-icon-link" anchorid="section9471571818" tips="复制节点链接"></i></h2><p><strong>修改Module类型</strong></p> <p>在新增Module时，可选择不同类型的Module进行创建。若需修改已创建Module的类型，只需编辑其module.json5配置文件中的"type"字段即可。"type"支持"entry/feature/har/shared"四个取值，分别表示应用的主模块、动态特性模块、静态共享包模块、动态共享包模块，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-package-dev" target="_blank">应用程序包开发与使用</a>，根据具体使用场景来选择或修改Module的类型。</p> <p><span><img originheight="369" originwidth="424" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.35228494948027712062598835759377:50001231000000:2800:5AD02D5AF77398C85776F74057D018C99A7C868A2E67A41383C6077EBC8425A9.png" width="424" height="369"></span></p> <p><strong>修改设备类型</strong></p> <p>在新增Module时，可指定该Module支持运行的设备类型；对于已创建的Module，可通过修改其module.json5配置文件中的"<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#devicetypes标签" target="_blank">deviceTypes</a>"字段，修改支持运行的设备类型，支持"phone/tablet/2in1/tv/wearable/car"，分别对应手机、平板、电脑、智慧屏、智能穿戴、智能座舱设备。修改后需要点击右上角的"Sync Now"，否则改动不会生效。</p> <p><span><img originheight="429" originwidth="900" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.25029547845167158458157807841960:50001231000000:2800:48CE68F9852CCEAB422D9435BC1E587D1FE0D52C9977BBC5E4202B92C292EF4D.png" width="900" height="429"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>module.json5配置文件中定义了Module的各项基本配置信息，更多字段的详细说明可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file" target="_blank">module.json5配置文件</a>。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section793018291115">修改依赖关系<i class="anchor-icon anchor-icon-link" anchorid="section793018291115" tips="复制节点链接"></i></h2><p>采用<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-overview#section73681810173312" target="_blank">架构设计</a>中介绍的“三层架构工程”设计原则，在Module中引用其他Module时，需在其oh-package.json5文件中配置依赖关系。使用Flexible Layout Ability工程模板创建的三层架构，模板会默认配置好依赖关系。若要引入新的依赖关系，修改"dependencies"字段，添加新的依赖关系，格式为：</p> <div _ngcontent-utn-c106="" class="highlight-div"><div _ngcontent-utn-c106="" class="highlight-div-header"><div _ngcontent-utn-c106="" class="highlight-div-header-left"><div _ngcontent-utn-c106="" class="handle-button expand-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-utn-c106="" class="highlight-div-header-right"><div _ngcontent-utn-c106="" class="handle-button ai-button"></div><div _ngcontent-utn-c106="" class="handle-button line-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-utn-c106="" class="handle-button theme-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-utn-c106="" class="handle-button copy-button"><div _ngcontent-utn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-utn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"依赖名称"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"本地相对路径"</span></li></ol></pre></div></div> <p>配置完成后，在代码中可直接通过该依赖名称使用features或common的功能模块。</p> <p>修改oh-package.json5文件后，请点击右上角的"Sync Now"，否则改动不会生效。更多详情参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-har-import" target="_blank">引用及管理共享包</a>。</p> <p><span><img height="355.68190000000004" originheight="596" originwidth="1336" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.26002672859857865061215016606059:50001231000000:2800:C2D9CECC7094B2B4BE9A5BD0A1A220AC16CA2D079914B552D7A1D70DDA2C64E8.png" title="点击放大" width="798"></span></p> </div> <div class="tiledSection"><h2 id="section142876558126">配置增强启动页<i class="anchor-icon anchor-icon-link" anchorid="section142876558126" tips="复制节点链接"></i></h2><p>启动页（Starting Window）在应用冷启动、进程未就绪或内容未加载完成时显示，是首个呈现给用户的界面。开发一多应用时，多端设备共用一套代码，由于不同设备的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout#section1532120147301" target="_blank">断点</a>存在差异，启动页在各端呈现的效果可能有所不同，如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.1.6.1.1" valign="top" width="9.24907509249075%"><p>横向断点</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.6.1.2" valign="top" width="14.7985201479852%"><p>sm</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.6.1.3" valign="top" width="24.027597240275973%"><p>md</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.6.1.4" valign="top" width="26.027397260273972%"><p>lg</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.6.1.5" valign="top" width="25.8974102589741%"><p>xl</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="9.24907509249075%"><p>效果图</p> </td> <td class="cellrowborder" valign="top" width="14.7985201479852%"><p><span><img height="232.0045429800914" originheight="1026" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.39968156443621472811329716933189:50001231000000:2800:1A7DAD44639EFBC634EC7E45067F3D8A2B9C2AF37FE91BEF80F7F04A43220CDD.png" title="点击放大" width="112.14638536146384"></span></p> </td> <td class="cellrowborder" valign="top" width="24.027597240275973%"><p><span><img height="219.75734165856906" originheight="1026" originwidth="920" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.50646856296802804110230372309132:50001231000000:2800:F922C9BAC0B01EF1E5FF2F6A1A5AF3B82828A2BCF3138975B07610B5BB65F3C8.png" title="点击放大" width="197.05389461053895"></span></p> </td> <td class="cellrowborder" valign="top" width="26.027397260273972%"><p><span><img height="139.12046966731899" originheight="1035" originwidth="1602" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.32930799364179034661102814195715:50001231000000:2800:A25C0585295C6392FB19AF2F253AF234B6867F676415A3790C59A48665E6C619.png" title="点击放大" width="215.45205479452056"></span></p> </td> <td class="cellrowborder" valign="top" width="25.8974102589741%"><p><span><img height="121.61588564953028" originheight="873" originwidth="1535" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163105.58992677618944435153081782824649:50001231000000:2800:0C385452567CB3127B71B35E0CB21BD8A9121022472469218BF9844DE3C92A13.png" title="点击放大" width="214.25617438256174"></span></p> </td> </tr>  </tbody></table></div> </div> <p>系统提供增强启动页配置能力，旨在保障应用在多端设备上启动页体验的一致性，减少开发者的手动适配工作。开发者可根据设计需求配置启动资源，相应资源也具备根据窗口尺寸进行缩放的能力，更易于多设备适配设计。</p> <p>增强启动页通过配置json文件的方式实现，json文件需要由开发者自行创建并放置到工程目录下，配置文件中可设置图标、插画、背景颜色、背景图片、品牌标识等多元化元素，有助于提升用户对产品的认知。详细的配置步骤可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/launch-page-config#配置增强启动页" target="_blank">配置增强启动页</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>增强启动页从API version 19开始支持，低版本下配置不会生效。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section463114146138">发布一多应用<i class="anchor-icon anchor-icon-link" anchorid="section463114146138" tips="复制节点链接"></i></h2><p>发布一多应用时，可以配置应用分发至多种设备。默认分发设备为创建项目时所选的设备类型，但可根据实际需求调整。只需发布一次，用户即可在所有支持的设备上安装和使用您的应用。详细的发布流程可参考<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-release-app-0000002271695230" target="_blank">发布HarmonyOS应用</a>。</p> <p><span><img originheight="415" originwidth="865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163106.79222104364004866450836026443814:50001231000000:2800:6B1B4198DCA430342C17BDF3EB4989CE013B970CBDDD7C4E9F4DFF8453D3F794.png" width="865" height="415"></span></p> <p>构建的一多工程若包含多个根据设备区分的HAP，且在<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-release-app-devicetype-0000002271592112" target="_blank">配置支持设备</a>时一并勾选了相关设备，应用程序（.app文件）在流水线或应用市场上被解包为N个Entry类型的HAP，根据HAP中的deviceTypes声明的设备类型，分发到不同设备。</p> <p><span><img height="157.09" originheight="223" originwidth="1306" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163106.41797662308145237554312622235879:50001231000000:2800:E56B46140F9A8CF87B9464CE3AAE568B316CB0572DD4EAF09D9B52D2E1ECE94D.png" title="点击放大" width="920"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>请确保软件包中声明的支持设备范围（即module.json5文件中"deviceTypes"字段的枚举值）包含AppGallery Connect上最终勾选的设备类型。若声明范围小于勾选范围，超出部分将不会生效。若要新增支持的设备，可参考<a href="/consumer/cn/doc/best-practices/bpta-multi-device-ide#section9471571818">修改Module类型及设备类型</a>。</li><li>在应用提交上架前可以修改分发的设备，应用一旦发布，升级版本只支持增加设备，无法删除已选择的设备。</li><li>当工程中存在多个entry类型的Module时，IDE会校验各Module所支持的设备类型，并确保每种设备仅归属于一个entry类型的Module，避免设备支持冲突。</li></ul> </div></div></div> </div> </div> <div></div></div>