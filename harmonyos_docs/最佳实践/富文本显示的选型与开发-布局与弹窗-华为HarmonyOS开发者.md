<h1 _ngcontent-idr-c119="" class="doc-title ng-star-inserted" title="富文本显示的选型与开发"> 富文本显示的选型与开发 </h1>

<div _ngcontent-idr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section14693811568">概述<i class="anchor-icon anchor-icon-link" anchorid="section14693811568" tips="复制节点链接"></i></h2><p>富文本格式是一种便于在不同设备和系统间查看的文本与图形文档格式。本文将重点介绍显示富文本数据所需的相关组件的特性，并探讨如下几种常见场景及其实现方法：</p> <ul><li><a href="/consumer/cn/doc/best-practices/bpta-rich-text-display#section16779144302217">实现高亮显示的超链接文本</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-rich-text-display#section175121131193714">实现文本中的图片表情</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-rich-text-display#section48901816104715">实现自定义的图文元素</a></li><li><a href="/consumer/cn/doc/best-practices/bpta-rich-text-display#section20943112412539">实现图标与文本的组合元素</a></li></ul> </div> <div class="tiledSection"><h3 id="section9352181916251" class="firsth2">能力介绍<i class="anchor-icon anchor-icon-link" anchorid="section9352181916251" tips="复制节点链接"></i></h3><p><strong>特点</strong></p> <p>应用中的富文本可能具有以下特点：</p> <ul><li>文本样式：包括字体前景色、背景色、字体类型、字号、粗体、下划线、删除线等装饰线、基线偏移、字符间距、行高和段落样式等。</li><li>定制效果：如边框、阴影、渐变和背景图片等。</li><li>图文混排：支持emoji表情、图标和网络图片等。</li><li>高亮超链接：包括@提醒、#标签、电话、Email和Https链接等。</li><li>手势交互：支持单击和长按等操作。</li><li>应用范围：富文本可能在文本显示的任何区域使用，如详情页内容、列表信息流、编辑器及弹窗提示框等。</li></ul> <p><strong>能力支持</strong></p> <p>以下为当前各种组件能力支持情况的汇总表，仅供参考。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.1" valign="top" width="10.386883934819554%"><p>技术方案</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.2" valign="top" width="15.935219434169747%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+ <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a> 属性字符串</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.3" valign="top" width="17.654703588923322%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>+<a class="break-all" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>子组件</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.4" valign="top" width="18.65440367889633%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>+ <a class="break-all" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#enabledatadetector11" target="_blank">enableDataDetector()</a> 文本识别</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.5" valign="top" width="14.70558832350295%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+ <a class="break-all" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor#addtextspan" target="_blank">addTextSpan()</a></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.6" valign="top" width="10.446865940217934%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-web" target="_blank">Web</a></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.8.1.7" valign="top" width="12.216335099470161%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richtext" target="_blank">RichText</a>(Deprecated)</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>支持元素种类</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>文本、图片、自定义</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imagespan" target="_blank">ImageSpan</a>、 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-symbolspan" target="_blank">SymbolSpan</a>、 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan" target="_blank">ContainerSpan</a></p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#textdatadetectortype11枚举说明" target="_blank">TextDataDetectorType</a> 中的类型，包括电话号码、 链接、邮箱、地址、时间</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>文本、图片、自定义</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>丰富，HTML标签元素</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richtext#支持标签" target="_blank">标签范围</a>内的元素</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>扩展元素类型</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>自定义元素样式</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imagespan" target="_blank">ImageSpan</a>、 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-symbolspan" target="_blank">SymbolSpan</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan" target="_blank">ContainerSpan</a> 组件属性范围内的样式设置</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>支持颜色、装饰线设置</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>通过css支持</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>通过css有限支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>元素事件类型</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>点击、长按</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imagespan" target="_blank">ImageSpan</a>支持点击</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>点击</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>点击、长按</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>点击</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>自定义元素事件</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>不支持</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>自定义扩展信息</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>自行维护</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>自行维护</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>自行维护</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>自行维护</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>自行维护</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p class="break-all">加载HTML文本 并渲染显示</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p class="break-all">仅支持&lt;p&gt;、&lt;span&gt;、 &lt;img&gt;</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>有限支持：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richtext#支持标签" target="_blank">标签范围</a></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p>长列表中显示</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>不推荐，影响性能</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>不推荐，影响性能</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.386883934819554%"><p class="break-all">宽高根据内容自 适应</p> </td> <td class="cellrowborder" valign="top" width="15.935219434169747%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="17.654703588923322%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="18.65440367889633%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="14.70558832350295%"><p>支持</p> </td> <td class="cellrowborder" valign="top" width="10.446865940217934%"><p>不支持</p> </td> <td class="cellrowborder" valign="top" width="12.216335099470161%"><p>不支持</p> </td> </tr>  </tbody></table></div> </div> <p><strong>使用建议</strong></p> <p>建议开发者全面考虑需求场景的特点及其潜在的扩展需求，然后根据自身能力进行技术选型。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.1" valign="top" width="15.416916616676666%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+ <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a> 属性字符串</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.2" valign="top" width="16.926614677064588%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a> 等Text的子组件</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.3" valign="top" width="16.166766646670666%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>+ <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#enabledatadetector11" target="_blank">enableDataDetector()</a> 文本识别方法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.4" valign="top" width="14.367126574685063%"><p class="break-all"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+ <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor#addtextspan" target="_blank">addTextSpan()</a> 类似方法</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.5" valign="top" width="11.567686462707458%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-web" target="_blank">Web</a></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.10.1.7.1.6" valign="top" width="25.55488902219556%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richtext" target="_blank">RichText</a>(Deprecated)</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15.416916616676666%"><p class="break-all">可以更新各元素的 样式；</p> <p class="break-all">可自定义富文本的 呈现效果；</p> <p class="break-all">可扩展元素种类并 自定义其样式；</p> <p class="break-all">元素可携带自定义 扩展信息。</p> </td> <td class="cellrowborder" valign="top" width="16.926614677064588%"><p class="break-all">通过子组件布局 实现，结构较为 清晰；</p> <p class="break-all">支持的元素种类 有限 （如文本、 图片、图标 等）。</p> </td> <td class="cellrowborder" valign="top" width="16.166766646670666%"><p>使用相对简单；</p> <p>仅支持文本内容；</p> <p>依赖底层的识别能力；</p> <p class="break-all">事件和菜单不可自定 义。</p> </td> <td class="cellrowborder" valign="top" width="14.367126574685063%"><p class="break-all">可以自定义富文本 的呈现效果；</p> <p class="break-all">可以扩展元素种类 并自定义样式；</p> <p class="break-all">不支持更新自定义 Span的样式；</p> <p class="break-all">扩展信息需由开发 者自行维护。</p> </td> <td class="cellrowborder" valign="top" width="11.567686462707458%"><p class="break-all">支持加载和显示本地网页、在线网页及HTML格式的文本；</p> <p class="break-all">不适用于长列表等特定场景。</p> </td> <td class="cellrowborder" valign="top" width="25.55488902219556%"><p class="break-all">可加载并显示 HTML格式的文本， 适用于元素样式在 其标签范围内的 场景；</p> <p class="break-all">较为消耗内存 资源；</p> <p class="break-all">不适用于长列 表等场景；</p> <p class="break-all">不适用于需要 对HTML字符 串显示效果 进行大量自 定义的应用 场景。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>选择路线图</strong></p> </div> <p><span><img height="147.7098" originheight="338" originwidth="1826" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.91816248466557103096285125699221:50001231000000:2800:B5B4288564CE16F796CBBD947DEB79D99A116DDE440D2B93D44008E0D21805CD.png" title="点击放大" width="798"></span></p> <p>从上图可以看出，在简单场景中通常使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>组件，因为其使用简便且能满足需求，可以优先考虑。相比之下，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor#addtextspan" target="_blank">addTextSpan()</a>较为复杂，适用于更复杂的场景。而<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-richeditor" target="_blank">RichEditor</a>+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a>属性字符串的使用虽然更为复杂，但其兼容性更高，功能更丰富，可以根据具体场景自定义组件，适用范围更广。以下将详细介绍几种常见属性字符串的应用案例。</p> <div class="tiledSection"><h2 id="section16779144302217">实现高亮显示的超链接文本<i class="anchor-icon anchor-icon-link" anchorid="section16779144302217" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section166018612114" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section166018612114" tips="复制节点链接"></i></h3><p>在社交和聊天等应用平台中，常见的文本元素包括@昵称、#话题和https链接等高亮显示的内容。</p> <p><span><img originheight="233" originwidth="536" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.60190866419262971867215736028152:50001231000000:2800:E9BB318A299305BC4D98D90D771B9C3EEF713FBAE64722C1A06ECB876EF151C9.png" width="536" height="233"></span></p> </div> <div class="tiledSection"><h3 id="section12667185918912">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section12667185918912" tips="复制节点链接"></i></h3><p>只需对文中的@昵称和#话题等文字设置高亮样式，并添加点击跳转事件，点击后跳转至相应的话题详情页面或用户详情页面。选择的方案如下：</p> <p><span><img height="116.78730000000002" originheight="215" originwidth="1469" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.67580706740479200648640262287698:50001231000000:2800:99BFFCDF527D0FDF951EB07CA7ADA8A78529F3C79D4BE66C40603CEAC668967C.png" title="点击放大" width="798"></span></p> <p>可以通过属性字符串<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#textstyle" target="_blank">TextStyle</a>属性设置样式，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#gesturestyle" target="_blank">GestureStyle</a>属性实现点击事件。</p> </div> <div class="tiledSection"><h3 id="section746115141620">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section746115141620" tips="复制节点链接"></i></h3></div> <ol><li><span>初始化时通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#textstyle" target="_blank">TextStyle</a>属性定义文字样式，包括文字颜色、大小等。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L32-L36" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">textAttribute</span>: <span class="hljs-title class_">TextStyle</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextStyle</span>({</li><li>  <span class="hljs-variable">fontColor</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">color</span>.<span class="hljs-title class_">styled_text_link_font_color</span>'),</li><li>  <span class="hljs-variable">fontSize</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">fp</span>(<span class="hljs-number">14</span>)</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L32-L36" target="_blank">TitleLink.ets</a></div></div></div></div> <p></p></li><li><span>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#gesturestyle" target="_blank">GestureStyle</a>属性定义点击超链接时的跳转事件。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L66-L73" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">generateClickStyle</span>(<span class="hljs-variable">span</span>: <span class="hljs-title class_">MyCustomSpan</span>): <span class="hljs-title class_">GestureStyle</span> {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">GestureStyle</span>({</li><li>    <span class="hljs-variable">onClick</span>: () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">linkClickCallback</span>(<span class="hljs-variable">span</span>);</li><li>    }</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L66-L73" target="_blank">TitleLink.ets</a></div></div></div></div> <p></p></li><li><span>循环处理文本数据，并生成属性字符串。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L80-L92" data-highlighted="yes"><ol class="linenums"><li>handleStyledString() {</li><li>  <span class="hljs-keyword">this</span>.spans = TitleLinkMock;</li><li>  <span class="hljs-keyword">this</span>.spans.forEach((span, index) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (span.url) {</li><li>      <span class="hljs-keyword">this</span>.handleLink(span);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.styledStrings.push(new MutableStyledString(span.content, []));</li><li>    }</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">this</span>.controller = HandleData.handleStyledString(<span class="hljs-keyword">this</span>.styledStrings);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L80-L92" target="_blank">TitleLink.ets</a></div></div></div></div> <p></p></li><li><span>设置文本样式和点击事件。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L43-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">handleLink</span>(<span class="hljs-variable">span</span>: <span class="hljs-title class_">MyCustomSpan</span>) {</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-variable">span</span>.<span class="hljs-variable">content</span>, [{</li><li>    <span class="hljs-variable">start</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">length</span>: <span class="hljs-title class_">span</span>.<span class="hljs-title class_">content</span>.<span class="hljs-title class_">length</span>,</li><li>    <span class="hljs-variable">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-title class_">GESTURE</span>,</li><li>    <span class="hljs-variable">styledValue</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">generateClickStyle</span>(<span class="hljs-title class_">span</span>)</li><li>  }, {</li><li>    <span class="hljs-variable">start</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">length</span>: <span class="hljs-title class_">span</span>.<span class="hljs-title class_">content</span>.<span class="hljs-title class_">length</span>,</li><li>    <span class="hljs-variable">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-title class_">FONT</span>,</li><li>    <span class="hljs-variable">styledValue</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">textAttribute</span></li><li>  }</li><li>  ]));</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/TitleLink.ets#L43-L57" target="_blank">TitleLink.ets</a></div></div></div></div> <p></p></li><li><span>将生成的属性信息拼接成属性字符串，并绑定到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>组件以进行渲染显示。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-title function_">handleStyledString</span>(<span class="hljs-variable">styledStrings</span>: <span class="hljs-title class_">MutableStyledString</span>[]): <span class="hljs-title class_">TextController</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">paragraphStyledString</span>: <span class="hljs-title class_">MutableStyledString</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-string">''</span>, []);</li><li>
</li><li>  <span class="hljs-comment">// Append the attribute string generated for each text fragment to the attribute string paragraphStyledString</span></li><li>  <span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">mutableStyledString</span>: <span class="hljs-title class_">MutableStyledString</span>) =&gt; {</li><li>    <span class="hljs-variable">paragraphStyledString</span>.<span class="hljs-title function_">appendStyledString</span>(<span class="hljs-variable">mutableStyledString</span>);</li><li>  })</li><li>
</li><li>  <span class="hljs-variable">controller</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable">paragraphStyledString</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">controller</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" target="_blank">HandleData.ets</a></div></div></div></div> <p></p></li></ol> <div class="tiledSection"><h2 id="section175121131193714">实现文本中的图片表情<i class="anchor-icon anchor-icon-link" anchorid="section175121131193714" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section16858928122115" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section16858928122115" tips="复制节点链接"></i></h3></div> <p>文本中的自定义emoji表情通常使用类似[哈哈]这样的字符进行传输，但在显示时会被替换为本地或网络图片。</p> <p><span><img originheight="125" originwidth="537" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.98751018381539502706974650580992:50001231000000:2800:8C6DF3DA2A2940EBCF721DB81976471AB8ADBC07F12F59CC5F892AC93849265C.png" width="537" height="125"></span></p> <div class="tiledSection"><h3 id="section392078112314">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section392078112314" tips="复制节点链接"></i></h3><p>文本中显示为表情图片，需要调整其样式设置，而无需编辑文本信息。以下是可选方案：</p> <p><span><img height="95.21470000000001" originheight="218" originwidth="1827" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.69020651243282568740335984413687:50001231000000:2800:0B37E9E6EF035EBCBF62E5780A619EB99253A59541F8059E2164888DA1F896BB.png" title="点击放大" width="798"></span></p> <p>可以先获取输入字符对应的图片，然后通过属性字符串<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#imageattachment" target="_blank">ImageAttachment</a>属性加载图片，并使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#userdataspan" target="_blank">UserDataSpan</a>属性存储自定义扩展信息。</p> </div> <div class="tiledSection"><h3 id="section98802373238">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section98802373238" tips="复制节点链接"></i></h3><ol><li><span>初始化声明文字和图片的对应关系。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/mock/MockData.ets#L22-L25" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">EMOJI_DATA</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Resource</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([</li><li>  [<span class="hljs-string">"[哈哈]"</span>, $r(<span class="hljs-string">'app.media.smile'</span>)]</li><li>]);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/mock/MockData.ets#L22-L25" target="_blank">MockData.ets</a></div></div></div></div> <p></p></li><li><span>循环处理文本数据，并生成属性字符串。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/CustomizeEmoji.ets#L51-L59" data-highlighted="yes"><ol class="linenums"><li>handleStyledString() {</li><li>  <span class="hljs-keyword">this</span>.spans = EmojiMock;</li><li>  <span class="hljs-keyword">this</span>.spans.forEach((span, index) =&gt; {</li><li>    <span class="hljs-keyword">this</span>.handleEmoji(span);</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">this</span>.controller = HandleData.handleStyledString(<span class="hljs-keyword">this</span>.styledStrings);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/CustomizeEmoji.ets#L51-L59" target="_blank">CustomizeEmoji.ets</a></div></div></div></div> <p></p></li><li><span>将输入的文本转换为图片，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#imageattachment" target="_blank">ImageAttachment</a>，设置图片资源和大小等。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/CustomizeEmoji.ets#L35-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">handleEmoji</span>(<span class="hljs-variable">span</span>: <span class="hljs-title class_">MyCustomSpan</span>) {</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">ImageAttachment</span>({</li><li>    <span class="hljs-variable">resourceValue</span>: <span class="hljs-title class_">EMOJI_DATA</span>.<span class="hljs-title class_">get</span>(<span class="hljs-title class_">span</span>.<span class="hljs-title class_">content</span>),</li><li>    <span class="hljs-variable">size</span>: {</li><li>      <span class="hljs-variable">width</span>: <span class="hljs-number">16</span>,</li><li>      <span class="hljs-variable">height</span>: <span class="hljs-number">16</span></li><li>    }</li><li>  })));</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/CustomizeEmoji.ets#L35-L44" target="_blank">CustomizeEmoji.ets</a></div></div></div></div> <p></p></li><li><span>将生成的属性信息拼接成属性字符串，并绑定到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>组件以进行渲染显示。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-title function_">handleStyledString</span>(<span class="hljs-variable">styledStrings</span>: <span class="hljs-title class_">MutableStyledString</span>[]): <span class="hljs-title class_">TextController</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">paragraphStyledString</span>: <span class="hljs-title class_">MutableStyledString</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-string">''</span>, []);</li><li>
</li><li>  <span class="hljs-comment">// Append the attribute string generated for each text fragment to the attribute string paragraphStyledString</span></li><li>  <span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">mutableStyledString</span>: <span class="hljs-title class_">MutableStyledString</span>) =&gt; {</li><li>    <span class="hljs-variable">paragraphStyledString</span>.<span class="hljs-title function_">appendStyledString</span>(<span class="hljs-variable">mutableStyledString</span>);</li><li>  })</li><li>
</li><li>  <span class="hljs-variable">controller</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable">paragraphStyledString</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">controller</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" target="_blank">HandleData.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section48901816104715">实现自定义的图文元素<i class="anchor-icon anchor-icon-link" anchorid="section48901816104715" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section12946103492717" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section12946103492717" tips="复制节点链接"></i></h3><p>文中包含小图标与文本的组合，点击可跳转至详情页面。</p> <p><span><img originheight="234" originwidth="540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.00791757701663732644901988440917:50001231000000:2800:7078E03E5567D72B4E60FD47EF913AD881A1D3B031959DE599CBCB92C17853D7.png" width="540" height="234"></span></p> </div> <div class="tiledSection"><h3 id="section1072825532716">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section1072825532716" tips="复制节点链接"></i></h3><p>文本中包含一个系统小图标和一段高亮显示的文字，点击可跳转至详情页面。选择方案如下：</p> <p><span><img height="95.21470000000001" originheight="218" originwidth="1827" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.34540516338370270505925091141867:50001231000000:2800:A11963473C3580CCD0CED215320DE2F2C7C738B58EC4561FEF2FDC0498D5F270.png" title="点击放大" width="798"></span></p> <p>需要自定义一个包含系统图标的超链接文本，可以通过属性字符串<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#imageattachment" target="_blank">ImageAttachment</a>属性来加载系统图片，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#textstyle" target="_blank">TextStyle</a>属性设置来调整字体样式，点击事件则可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#gesturestyle" target="_blank">GestureStyle</a>属性来实现。</p> </div> <div class="tiledSection"><h3 id="section361209132812">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section361209132812" tips="复制节点链接"></i></h3><ol><li><span>初始化时通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#textstyle" target="_blank">TextStyle</a>属性定义文字样式，包括文字颜色、大小等。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L32-L36" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">textAttribute</span>: <span class="hljs-title class_">TextStyle</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextStyle</span>({</li><li>  <span class="hljs-variable">fontColor</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">color</span>.<span class="hljs-title class_">styled_text_link_font_color</span>'),</li><li>  <span class="hljs-variable">fontSize</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title class_">fp</span>(<span class="hljs-number">14</span>)</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L32-L36" target="_blank">VideoLink.ets</a></div></div></div></div> <p></p></li><li><span>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#gesturestyle" target="_blank">GestureStyle</a>属性定义点击超链接时的跳转事件。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L75-L82" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">generateClickStyle</span>(<span class="hljs-variable">span</span>: <span class="hljs-title class_">MyCustomSpan</span>): <span class="hljs-title class_">GestureStyle</span> {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">GestureStyle</span>({</li><li>    <span class="hljs-variable">onClick</span>: () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">linkClickCallback</span>(<span class="hljs-variable">span</span>);</li><li>    }</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L75-L82" target="_blank">VideoLink.ets</a></div></div></div></div> <p></p></li><li><span>实现点击跳转。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L114-L125" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">linkClickCallback</span>: <span class="hljs-function">(<span class="hljs-params">span: MyCustomSpan</span>) =&gt;</span> <span class="hljs-built_in">void</span> =</li><li>  <span class="hljs-function">(<span class="hljs-params">span: MyCustomSpan</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// Process according to the type of text hyperlink.</span></li><li>    <span class="hljs-keyword">if</span> (span) {</li><li>      <span class="hljs-keyword">let</span> uiContext = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>      <span class="hljs-keyword">let</span> router = uiContext.<span class="hljs-title function_">getRouter</span>();</li><li>         <span class="hljs-keyword">if</span> (span.<span class="hljs-property">url</span> !== <span class="hljs-literal">null</span>) {</li><li>        router.<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: span.<span class="hljs-property">url</span> });</li><li>      }</li><li>    }</li><li>  };</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L114-L125" target="_blank">VideoLink.ets</a></div></div></div></div> <p></p></li><li><span>循环处理文本数据，并生成属性字符串。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L89-L101" data-highlighted="yes"><ol class="linenums"><li>handleStyledString() {</li><li>  <span class="hljs-keyword">this</span>.spans = VideoLinkMock;</li><li>  <span class="hljs-keyword">this</span>.spans.forEach((span) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (span.url) {</li><li>      <span class="hljs-keyword">this</span>.handleVideoLink(span);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.styledStrings.push(new MutableStyledString(span.content, []));</li><li>    }</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">this</span>.controller = HandleData.handleStyledString(<span class="hljs-keyword">this</span>.styledStrings);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L89-L101" target="_blank">VideoLink.ets</a></div></div></div></div> <p></p></li><li><span>设置小图标、文本样式和点击事件。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L42-L66" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">handleVideoLink</span>(<span class="hljs-variable">span</span>: <span class="hljs-title class_">MyCustomSpan</span>) {</li><li>  <span class="hljs-comment">// If the pixelMap for the video link icon exists, add an image attachment styled string before the corresponding link</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">ImageAttachment</span>({</li><li>    <span class="hljs-variable">resourceValue</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">play_round_rectangle</span>'),</li><li>    <span class="hljs-variable">size</span>: {</li><li>      <span class="hljs-variable">width</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">styled_text_video_link_icon_size</span>'),</li><li>      <span class="hljs-variable">height</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">integer</span>.<span class="hljs-title class_">styled_text_video_link_icon_size</span>')</li><li>    },</li><li>    <span class="hljs-variable">verticalAlign</span>: <span class="hljs-title class_">ImageSpanAlignment</span>.<span class="hljs-title class_">CENTER</span>,</li><li>    <span class="hljs-variable">objectFit</span>: <span class="hljs-title class_">ImageFit</span>.<span class="hljs-title class_">Contain</span></li><li>  })));</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-variable">span</span>.<span class="hljs-variable">content</span>, [{</li><li>    <span class="hljs-variable">start</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">length</span>: <span class="hljs-title class_">span</span>.<span class="hljs-title class_">content</span>.<span class="hljs-title class_">length</span>,</li><li>    <span class="hljs-variable">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-title class_">GESTURE</span>,</li><li>    <span class="hljs-variable">styledValue</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">generateClickStyle</span>(<span class="hljs-title class_">span</span>)</li><li>  }, {</li><li>    <span class="hljs-variable">start</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">length</span>: <span class="hljs-title class_">span</span>.<span class="hljs-title class_">content</span>.<span class="hljs-title class_">length</span>,</li><li>    <span class="hljs-variable">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-title class_">FONT</span>,</li><li>    <span class="hljs-variable">styledValue</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">textAttribute</span></li><li>  }</li><li>  ]));</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/VideoLink.ets#L42-L66" target="_blank">VideoLink.ets</a></div></div></div></div> <p></p></li><li><span>将生成的属性信息拼接成属性字符串，并绑定到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>组件以进行渲染显示。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-title function_">handleStyledString</span>(<span class="hljs-variable">styledStrings</span>: <span class="hljs-title class_">MutableStyledString</span>[]): <span class="hljs-title class_">TextController</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">paragraphStyledString</span>: <span class="hljs-title class_">MutableStyledString</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-string">''</span>, []);</li><li>
</li><li>  <span class="hljs-comment">// Append the attribute string generated for each text fragment to the attribute string paragraphStyledString</span></li><li>  <span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">mutableStyledString</span>: <span class="hljs-title class_">MutableStyledString</span>) =&gt; {</li><li>    <span class="hljs-variable">paragraphStyledString</span>.<span class="hljs-title function_">appendStyledString</span>(<span class="hljs-variable">mutableStyledString</span>);</li><li>  })</li><li>
</li><li>  <span class="hljs-variable">controller</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable">paragraphStyledString</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">controller</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" target="_blank">HandleData.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section20943112412539">实现图标与文本的组合元素<i class="anchor-icon anchor-icon-link" anchorid="section20943112412539" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section2101151614322" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section2101151614322" tips="复制节点链接"></i></h3><p>文中包含自定义的小图标与文本的组合。</p> <p><span><img originheight="225" originwidth="539" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.84099550813095659088961088365482:50001231000000:2800:86E5EFB06038551A3CD23F09871960720D3FC60799C3AB684DABAE42F0230015.png" width="539" height="225"></span></p> </div> <div class="tiledSection"><h3 id="section5416634103220">实现原理<i class="anchor-icon anchor-icon-link" anchorid="section5416634103220" tips="复制节点链接"></i></h3><p>文本中包含一个小图标、文字和背景颜色的复杂样式。以下是选择方案：</p> <p><span><img height="98.0609" originheight="225" originwidth="1831" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162937.41252405594374539127382031445250:50001231000000:2800:75EB0BC5BF1040E9BC3EF711F18A7D94E2813F43E02EA5970D93EAC1490E9CC1.png" title="点击放大" width="798"></span></p> <p>需要通过属性字符串<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring" target="_blank">StyledString</a>属性中的自定义<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#customspan" target="_blank">CustomSpan</a>来进行绘制。</p> </div> <div class="tiledSection"><h3 id="section16940402324">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section16940402324" tips="复制节点链接"></i></h3><ol><li><span>创建自定义的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#customspan" target="_blank">CustomSpan</a>以绘制自定义样式。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/components/MyDrawCustomSpan.ets#L18-L110" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDrawCustomSpan</span> <span class="hljs-variable">extends</span> <span class="hljs-variable">CustomSpan</span> {</li><li>  <span class="hljs-variable">width</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">160</span>;</li><li>  <span class="hljs-variable">word</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">"drawing"</span>;</li><li>  <span class="hljs-variable">height</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-variable">color</span>: <span class="hljs-title class_">string</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>  <span class="hljs-variable">gUIContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-comment">// Draw</span></li><li>  <span class="hljs-title function_">onDraw</span>(<span class="hljs-variable">context</span>: <span class="hljs-title class_">DrawContext</span>, <span class="hljs-variable">options</span>: <span class="hljs-title class_">CustomSpanDrawInfo</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">canvas</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">canvas</span>;</li><li>
</li><li>    <span class="hljs-comment">// Set brush</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">brush</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">drawing</span>.<span class="hljs-title function_">Brush</span>();</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">font</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">drawing</span>.<span class="hljs-title function_">Font</span>();</li><li>    <span class="hljs-variable">font</span>.<span class="hljs-title function_">setSize</span>(<span class="hljs-number">40</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">textBlob</span> = <span class="hljs-variable">drawing</span>.<span class="hljs-variable">TextBlob</span>.<span class="hljs-title function_">makeFromString</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">word</span>, <span class="hljs-variable">font</span>, <span class="hljs-variable">drawing</span>.<span class="hljs-variable">TextEncoding</span>.<span class="hljs-variable">TEXT_ENCODING_UTF8</span>);</li><li>    <span class="hljs-variable">canvas</span>.<span class="hljs-title function_">attachBrush</span>(<span class="hljs-variable">brush</span>);</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">r_width</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">gUIContext</span>) {</li><li>      <span class="hljs-variable">r_width</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">gUIContext</span>?.<span class="hljs-title function_">vp2px</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">width</span>);</li><li>    }</li><li>    <span class="hljs-comment">// Draw a rounded rectangle</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">rect</span>: <span class="hljs-title class_">common2D</span>.<span class="hljs-title class_">Rect</span> = {</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-title class_">options</span>.<span class="hljs-title class_">x</span> - <span class="hljs-number">50</span>,</li><li>      <span class="hljs-variable">top</span>: <span class="hljs-title class_">options</span>.<span class="hljs-title class_">lineTop</span> + <span class="hljs-number">11</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-title class_">options</span>.<span class="hljs-title class_">x</span> + <span class="hljs-title class_">r_width</span> + <span class="hljs-number">10</span>,</li><li>      <span class="hljs-variable">bottom</span>: <span class="hljs-title class_">options</span>.<span class="hljs-title class_">lineBottom</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">roundRect</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">drawing</span>.<span class="hljs-title function_">RoundRect</span>(<span class="hljs-variable">rect</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);</li><li>    <span class="hljs-variable">canvas</span>.<span class="hljs-title function_">drawRoundRect</span>(<span class="hljs-variable">roundRect</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-variable">canvas</span>.<span class="hljs-title function_">attachBrush</span>(<span class="hljs-variable">brush</span>);</li><li>    <span class="hljs-variable">canvas</span>.<span class="hljs-title function_">drawTextBlob</span>(<span class="hljs-variable">textBlob</span>, <span class="hljs-variable">options</span>.<span class="hljs-variable">x</span>, <span class="hljs-variable">options</span>.<span class="hljs-variable">lineBottom</span> - <span class="hljs-number">13</span>);</li><li>    <span class="hljs-variable">canvas</span>.<span class="hljs-title function_">detachBrush</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setWord</span>(<span class="hljs-variable">word</span>: <span class="hljs-title class_">string</span>) {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">word</span> = <span class="hljs-variable">word</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/components/MyDrawCustomSpan.ets#L18-L110" target="_blank">MyDrawCustomSpan.ets</a></div></div></div></div> <p></p></li><li><span>循环处理文本数据，并生成属性字符串。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/ImageText.ets#L67-L79" data-highlighted="yes"><ol class="linenums"><li>handleStyledString() {</li><li>  <span class="hljs-keyword">this</span>.spans = ImageTextMock;</li><li>  <span class="hljs-keyword">this</span>.spans.forEach((span, index) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (span.url) {</li><li>      <span class="hljs-keyword">this</span>.handleImageText(span);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">this</span>.styledStrings.push(new MutableStyledString(span.content, []));</li><li>    }</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">this</span>.controller = HandleData.handleStyledString(<span class="hljs-keyword">this</span>.styledStrings);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/ImageText.ets#L67-L79" target="_blank">ImageText.ets</a></div></div></div></div> <p></p></li><li><span>设置自定义图文元素。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/ImageText.ets#L38-L60" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_ invoke__">handleImageText</span>(<span class="hljs-attr">span</span>: MyCustomSpan) {</li><li>  let resourceStr = <span class="hljs-variable">$r</span>(<span class="hljs-string">'app.media.doc_plaintext_green'</span>);</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  this.styledStrings.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageAttachment</span>({</li><li>    <span class="hljs-attr">resourceValue</span>: resourceStr,</li><li>    <span class="hljs-attr">size</span>: {</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">13</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">13</span></li><li>    },</li><li>    <span class="hljs-attr">layoutStyle</span>: {</li><li>      <span class="hljs-attr">margin</span>: { <span class="hljs-attr">top</span>: <span class="hljs-number">4</span> }</li><li>    },</li><li>    <span class="hljs-attr">verticalAlign</span>: ImageSpanAlignment.CENTER</li><li>  })));</li><li>  this.styledStrings.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDrawCustomSpan</span>(span.content, <span class="hljs-number">11</span> * span.content.length, <span class="hljs-number">20</span>,</li><li>    span.url, gUIContext)));</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/pages/ImageText.ets#L38-L60" target="_blank">ImageText.ets</a></div></div></div></div> <p></p></li><li><span>将生成的属性信息拼接成属性字符串，并绑定到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>组件以进行渲染和显示。</span><p></p><div class="screenLinkPre"><div _ngcontent-idr-c106="" class="highlight-div"><div _ngcontent-idr-c106="" class="highlight-div-header"><div _ngcontent-idr-c106="" class="highlight-div-header-left"><div _ngcontent-idr-c106="" class="handle-button expand-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idr-c106="" class="highlight-div-header-right"><div _ngcontent-idr-c106="" class="handle-button ai-button"></div><div _ngcontent-idr-c106="" class="handle-button line-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idr-c106="" class="handle-button theme-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idr-c106="" class="handle-button copy-button"><div _ngcontent-idr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-title function_">handleStyledString</span>(<span class="hljs-variable">styledStrings</span>: <span class="hljs-title class_">MutableStyledString</span>[]): <span class="hljs-title class_">TextController</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextController</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">paragraphStyledString</span>: <span class="hljs-title class_">MutableStyledString</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">MutableStyledString</span>(<span class="hljs-string">''</span>, []);</li><li>
</li><li>  <span class="hljs-comment">// Append the attribute string generated for each text fragment to the attribute string paragraphStyledString</span></li><li>  <span class="hljs-variable">styledStrings</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">mutableStyledString</span>: <span class="hljs-title class_">MutableStyledString</span>) =&gt; {</li><li>    <span class="hljs-variable">paragraphStyledString</span>.<span class="hljs-title function_">appendStyledString</span>(<span class="hljs-variable">mutableStyledString</span>);</li><li>  })</li><li>
</li><li>  <span class="hljs-variable">controller</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable">paragraphStyledString</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">controller</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/styledtext/blob/master/entry/src/main/ets/common/HandleData.ets#L21-L33" target="_blank">HandleData.ets</a></div></div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section069716165712">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section069716165712" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/styledtext" target="_blank">富文本显示</a></li></ul> </div> </div></div>