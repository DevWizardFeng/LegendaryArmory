<h1 _ngcontent-jip-c119="" class="doc-title ng-star-inserted" title="导航定位场景低功耗规则"> 导航定位场景低功耗规则 </h1>

<div _ngcontent-jip-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section92211410123919">规则<i class="anchor-icon anchor-icon-link" anchorid="section92211410123919" tips="复制节点链接"></i></h2></div> <ul><li>导航类应用需设置正确的应用类型，并使用系统自带的导航场景音效算法，避免冗余处理。</li><li>在导航类应用无语音播报等语音输出时，禁止持续向系统写入音频空数据。</li></ul> <div class="tiledSection"><h2 id="section9588112810396">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section9588112810396" tips="复制节点链接"></i></h2></div> <div class="p">为了避免导航类应用无法使用系统低功耗方案，确保正确设置usage类型。配置音频渲染参数并创建AudioRenderer实例时，设置usage类型为audio.StreamUsage.STREAM_USAGE_NAVIGATION。<div class="screenLinkPre"><div _ngcontent-jip-c106="" class="highlight-div"><div _ngcontent-jip-c106="" class="highlight-div-header"><div _ngcontent-jip-c106="" class="highlight-div-header-left"><div _ngcontent-jip-c106="" class="handle-button expand-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jip-c106="" class="highlight-div-header-right"><div _ngcontent-jip-c106="" class="handle-button ai-button"></div><div _ngcontent-jip-c106="" class="handle-button line-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jip-c106="" class="handle-button theme-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jip-c106="" class="handle-button copy-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jip-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/NavigationAndPositioningRule.ets#L21-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">audio</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hilog</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">audioStreamInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioStreamInfo</span> = {</li><li>  <span class="hljs-variable">samplingRate</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSamplingRate</span>.<span class="hljs-title class_">SAMPLE_RATE_44100</span>,</li><li>  <span class="hljs-variable">channels</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioChannel</span>.<span class="hljs-title class_">CHANNEL_1</span>,</li><li>  <span class="hljs-variable">sampleFormat</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioSampleFormat</span>.<span class="hljs-title class_">SAMPLE_FORMAT_S16LE</span>,</li><li>  <span class="hljs-variable">encodingType</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioEncodingType</span>.<span class="hljs-title class_">ENCODING_TYPE_RAW</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">audioRendererInfo</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioRendererInfo</span> = {</li><li>  <span class="hljs-variable">usage</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">StreamUsage</span>.<span class="hljs-title class_">STREAM_USAGE_NAVIGATION</span>,</li><li>  <span class="hljs-variable">rendererFlags</span>: <span class="hljs-number">0</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">audioRendererOptions</span>: <span class="hljs-title class_">audio</span>.<span class="hljs-title class_">AudioRendererOptions</span> = {</li><li>  <span class="hljs-variable">streamInfo</span>: <span class="hljs-title class_">audioStreamInfo</span>,</li><li>  <span class="hljs-variable">rendererInfo</span>: <span class="hljs-title class_">audioRendererInfo</span></li><li>};</li><li><span class="hljs-variable">audio</span>.<span class="hljs-title function_">createAudioRenderer</span>(<span class="hljs-variable">audioRendererOptions</span>, (<span class="hljs-variable">err</span>, <span class="hljs-variable">data</span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">err</span>) {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, `<span class="hljs-variable">Invoke</span> <span class="hljs-variable">createAudioRenderer</span> <span class="hljs-variable">failed</span>, <span class="hljs-variable">code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-string">'Invoke createAudioRenderer succeeded.'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">audioRenderer</span> = <span class="hljs-variable">data</span>;</li><li>  }</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/RationalUseOfFrontEndResources/entry/src/main/ets/pages/NavigationAndPositioningRule.ets#L21-L46" target="_blank">NavigationAndPositioningRule.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section113816347474">调测验证<i class="anchor-icon anchor-icon-link" anchorid="section113816347474" tips="复制节点链接"></i></h2></div> <ul><li>通过以下命令查看日志确认：<div _ngcontent-jip-c106="" class="highlight-div"><div _ngcontent-jip-c106="" class="highlight-div-header"><div _ngcontent-jip-c106="" class="highlight-div-header-left"><div _ngcontent-jip-c106="" class="handle-button expand-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jip-c106="" class="highlight-div-header-right"><div _ngcontent-jip-c106="" class="handle-button ai-button"></div><div _ngcontent-jip-c106="" class="handle-button line-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jip-c106="" class="handle-button theme-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jip-c106="" class="handle-button copy-button"><div _ngcontent-jip-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jip-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-perl" data-highlighted="yes"><ol class="linenums"><li>hdc shell</li><li>hilog | <span class="hljs-keyword">grep</span> usage</li></ol></pre></div></div> </li><li>执行效果如下图：<p class="msonormal"><span><img height="19.950000000000003" originheight="34" originwidth="906" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.24477929980739482780205711578325:50001231000000:2800:A7C831757D6892F960C901C1DE5726D125CB61F31369C97AD191F52637044DF0.png" title="点击放大" width="551.95"></span></p> </li></ul> <div class="tiledSection"><h2 id="section05211430276">结果对比<i class="anchor-icon anchor-icon-link" anchorid="section05211430276" tips="复制节点链接"></i></h2></div> <ul><li>优化前：<p class="msonormal"><span><img height="159.60000000000002" originheight="553" originwidth="1912" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.81641683284288391633856375042525:50001231000000:2800:7C26E6202B78886C58C1D41AB6C1EC62D75A9190DF189135B8F650F90E4D8023.png" title="点击放大" width="551.95"></span></p> <p><span><img height="259.35" originheight="888" originwidth="1890" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.41469821875866774226094691469340:50001231000000:2800:85F480595B0660B2A90863990199E42CEC6D73D3FAE734DBB35333BE39BD5015.png" title="点击放大" width="551.95"></span></p> </li></ul> <ul><li>优化后（负载约降低43.89%）：<p class="msonormal"><span><img height="163.59" originheight="557" originwidth="1885" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.79202535644376952484559426193969:50001231000000:2800:4065A55A23A765FDE8BAFA3B465DA8CC553A52294CFDE32CF10B44E6FCD85F0D.png" title="点击放大" width="551.95"></span></p> <p><span><img height="263.34000000000003" originheight="895" originwidth="1874" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163444.04880943299295728591290058262689:50001231000000:2800:2D2E22AA9032528FBB49EC41AA5B9E5B4595C3D59FC5E2B522C7715DD2CED5A7.png" title="点击放大" width="551.95"></span></p> </li></ul> </div> <div></div></div>