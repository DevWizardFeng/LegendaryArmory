<h1 _ngcontent-hjs-c119="" class="doc-title ng-star-inserted" title="常见列表操作"> 常见列表操作 </h1>

<div _ngcontent-hjs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section423919414912">概述<i class="anchor-icon anchor-icon-link" anchorid="section423919414912" tips="复制节点链接"></i></h2><p>在应用开发中，列表通常用于展示结构化数据，例如联系人列表、通讯录等。为了提升用户体验和交互效果，开发者需要实现一系列常见的列表操作功能，本文主要介绍列表滚动、列表排版、列表数据更新、列表拖拽等常见功能，通过实现一个简单聊天列表的案例，来介绍常见列表操作以及对应的代码实现。</p> </div> <div class="tiledSection"><h2 id="section675072320911">列表滚动<i class="anchor-icon anchor-icon-link" anchorid="section675072320911" tips="复制节点链接"></i></h2><p>列表滚动是指用户通过上下或左右滚动屏幕来浏览超出当前视口范围的内容，它是最常见的交互方式之一，适用于展示联系人列表、商品目录、新闻文章等多种场景。</p> </div> <div class="tiledSection"><h3 id="section14292181253312" class="firsth2">滚动到指定位置<i class="anchor-icon anchor-icon-link" anchorid="section14292181253312" tips="复制节点链接"></i></h3><p>列表滚动主要通过List组件的scroller参数绑定一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-scroll-V5#scroller" target="_blank">Scroller</a>对象，进行列表的滚动控制。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L20-L48" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-variable">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">Scroller</span>();</li><li>@<span class="hljs-title function_">StorageProp</span>(<span class="hljs-string">'topRectHeight'</span>) <span class="hljs-variable">topRectHeight</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>    <span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">20</span>, <span class="hljs-variable">initialIndex</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">arr</span>.<span class="hljs-title class_">length</span> - <span class="hljs-number">1</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span> }) {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L20-L48" target="_blank">ScrollToTheBottom.ets</a></div></div></div></div> <p>根据滚动位置的不同，本文介绍列表滚动常见的三种形式：滚动到底部、滚动到指定索引、指定偏移量滚动，其实现方式如下：</p> <p><strong>滚动到底部：</strong>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-swiper-components-indicator#initialindex" target="_blank">initialIndex()</a>或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolltoindex" target="_blank">scrollToIndex()</a>接口实现。</p> <ul><li>使用List组件的ListOptions参数-<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-swiper-components-indicator#initialindex" target="_blank">initialIndex()</a>设置列表初始化显示到最后一个ListItem的位置。<div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L29-L49" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">20</span>, <span class="hljs-variable">initialIndex</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">arr</span>.<span class="hljs-title class_">length</span> - <span class="hljs-number">1</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span> }) {</li><li>
</li><li>  <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">arr</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>  }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>) =&gt; <span class="hljs-variable">item</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L29-L49" target="_blank">ScrollToTheBottom.ets</a></div></div></div></div> </li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolltoindex" target="_blank">scrollToIndex()</a>接口实现滚动到最后一个ListItem的索引位置。<div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L56-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.scroller.scrollToIndex(<span class="hljs-keyword">this</span>.arr.length - <span class="hljs-number">1</span>);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L56-L56" target="_blank">ScrollToTheBottom.ets</a></div></div></div></div> <p>需要注意的是，scrollToIndex与initialIndex都能实现滚动到底部（最后一个ListItem），若ListItem高度过高则不能展示到最底部，可以搭配使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolledge" target="_blank">scrollEdge()</a>滚动到列表底部。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L59-L59" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.scroller.scrollEdge(Edge.Bottom);</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollToTheBottom.ets#L59-L59" target="_blank">ScrollToTheBottom.ets</a></div></div></div></div> </li></ul> <p><strong>滚动到指定索引：</strong>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolltoindex" target="_blank">scrollToIndex()</a>接口滚动到列表数组的指定索引Index。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在使用scrollToIndex()等场景时，若滚动过程中ListItem大小动态变化，将会导致获取到的currentOffset不准确，无法准确的跳转到指定位置。可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#childrenmainsize12" target="_blank">childrenMainSize()</a>给ListItem固定高度，该属性通过向List组件提供所有子组件在主轴方向的大小信息，确保List组件能够维护其滚动位置准确性。</p> </div></div></div> <p><strong>指定偏移量滚动：</strong>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrollto" target="_blank">scrollTo()</a>接口实现，可以配置上下偏移量、左右偏移量以及动画方式。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L27-L33" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Button</span>(<span class="hljs-string">'scroll 200'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">curve</span> = <span class="hljs-variable">curves</span>.<span class="hljs-title function_">interpolatingSpring</span>(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">228</span>, <span class="hljs-number">30</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">yOffset</span>: <span class="hljs-title class_">number</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-variable">yOffset</span>;</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">scrollTo</span>({ <span class="hljs-variable">xOffset</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">yOffset</span>: <span class="hljs-title class_">yOffset</span> + <span class="hljs-number">200</span>, <span class="hljs-variable">animation</span>: { <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">curve</span> } })</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L27-L33" target="_blank">RollingMonitoring.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>需要注意的是，这里的偏移量是相对于组件最顶端的偏移量，并非相对于当前显示Item的偏移量。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section5556509347">滚动监听<i class="anchor-icon anchor-icon-link" anchorid="section5556509347" tips="复制节点链接"></i></h3><p>当列表项过多时，通常需要监听列表的滚动偏移量，基于此来展示额外信息或辅助功能。例如，在选择商品时，滚动至一定距离后，用户希望能返回顶部，就需要进行滚动监听。通过在List组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#onwillscroll12" target="_blank">onWillScroll()</a>或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#ondidscroll12" target="_blank">onDidScroll()</a>方法里面执行scroller.currentOffset()实时监听位移偏移量。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L64-L71" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">onWillScroll</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-comment">// Trigger before scrolling component scrolling.</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'currentOffset:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>)</li><li>})</li><li>.<span class="hljs-title function_">onDidScroll</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-comment">// Triggered when scrolling components scroll.</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'currentOffset:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>)</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L64-L71" target="_blank">RollingMonitoring.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>scroller.currentOffset()偏移量是相对于组件最顶端的偏移量，并非相对于当前显示Item的偏移量。如果想要获取此次滚动偏移量，可以通过onWillScroll()或者onDidScroll()接口的回调参数获取。onwillscroll()中回调的偏移量为计算得到的将要滚动的偏移量值，并非最终实际滚动偏移。可以通过该回调返回值指定Scroll将要滚动的偏移。具体可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#示例1设置scroller控制器" target="_blank">设置scroller控制器</a>。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section16572315195219">嵌套滚动<i class="anchor-icon anchor-icon-link" anchorid="section16572315195219" tips="复制节点链接"></i></h3><p>嵌套滚动是指多个滚动容器相互嵌套，并能协同工作的滚动机制。例如：在移动端应用中，一个页面整体可以垂直滚动，而其中某个子组件（如Tab内容、评论区、图片列表）也只支持独立滚动。根据滚动对象的不同，嵌套滚动主要分为Scroll组件嵌套List组件、Web组件嵌套List组件、List组件嵌套List组件等。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162934.76961805870156348004386949658327:50001231000000:2800:2DAC4D55554FD42FA8CDB269848B64319A12E27D719AC67784C3D6445B295B4F.gif" title="点击放大" width="266"></span></p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#示例2嵌套滚动实现方式一" target="_blank">List组件与Scroll组件的嵌套滚动</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-nested-scrolling#滚动偏移量由滚动父组件统一派发" target="_blank">Web组件与List组件嵌套</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs/faqs-arkui-337" target="_blank">List组件与List组件嵌套滚动</a></li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>若通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#onscrollframebegin9" target="_blank">onScrollFrameBegin()</a>事件和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrollby9" target="_blank">scrollBy()</a>方法实现容器嵌套滚动，需设置子滚动节点的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#edgeeffect11" target="_blank">EdgeEffect()</a>为None。如Scroll嵌套List滚动时，List组件的edgeEffect属性需设置为EdgeEffect.None。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section103161738203413">滚动效果<i class="anchor-icon anchor-icon-link" anchorid="section103161738203413" tips="复制节点链接"></i></h3><p>列表滚动效果指的是当用户通过上下或左右滚动屏幕来浏览超出当前视口范围的内容时，列表项如何平滑地进入和离开视口，以及在此过程中可能伴随的视觉效果，例如单边回弹、滚动过程中禁用滚动、列表项左滑等<strong>。</strong></p> <p><strong>单边回弹效果：</strong></p> <p>单边回弹是指当用户滚动到可滚动区域的一端时，如果继续施加力，该端会出现一种视觉上的“回弹”效果，例如实现顶部回弹效果，可以有2种方式实现：</p> <ul><li>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#ondidscroll12" target="_blank">onDidScroll()</a>里获取currentOffset().yOffset，然后拿获取的值与0比较，当其值小于等于0时，说明已到达或超越顶部，此时设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#edgeeffect11" target="_blank">EdgeEffect</a>属性设置边缘滚动效果。<div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/UnilateralRebound.ets#L26-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">20</span>, <span class="hljs-variable">initialIndex</span>: <span class="hljs-number">0</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span> }) {</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>.<span class="hljs-title function_">scrollBar</span>(<span class="hljs-variable">BarState</span>.<span class="hljs-variable">Off</span>)</li><li>.<span class="hljs-title function_">onDidScroll</span>(() =&gt; {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">y</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-variable">yOffset</span>;</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">isTop</span> = <span class="hljs-variable">y</span> &lt;= <span class="hljs-number">0</span>;</li><li>})</li><li>.<span class="hljs-title function_">edgeEffect</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">isTop</span> ? <span class="hljs-variable">EdgeEffect</span>.<span class="hljs-variable">Spring</span> : <span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-title class_">None</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/UnilateralRebound.ets#L26-L50" target="_blank">UnilateralRebound.ets</a></div></div></div></div> </li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onscrollindex" target="_blank">onScrollIndex()</a>实现单边回弹效果，List显示区域内第一个子组件的索引值为0时，说明已到达顶部，此时设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#edgeeffect11" target="_blank">EdgeEffect</a>属性设置边缘滚动效果。<div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/UnilateralRebound.ets#L50-L56" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">edgeEffect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isTop</span> ? <span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-property">Spring</span> : <span class="hljs-title class_">EdgeEffect</span>.<span class="hljs-property">None</span>)</li><li>.<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">firstIndex: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTop</span> = firstIndex === <span class="hljs-number">0</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'firstIndex:'</span> + firstIndex + <span class="hljs-string">','</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTop</span>)</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/UnilateralRebound.ets#L50-L56" target="_blank">UnilateralRebound.ets</a></div></div></div></div> </li></ul> <p>当List组件内容大小小于组件自身时，默认不开启滚动效果，可以设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scrollable-common#edgeeffect11" target="_blank">edgeEffect(EdgeEffect.Spring, { alwaysEnabled: true })</a>开启滚动效果。</p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162934.18494190724060480024950681054290:50001231000000:2800:F75B233638F43631173E65B6D506A803A54C733632CBC81F6C3FBE4A9495261D.gif" title="点击放大" width="266"></span></p> <p><strong>滚动过程中禁用滚动：</strong>可以通过enabled(false)关闭滚动使能，但是如果是惯性滚动触发的，List仍然能依靠惯性滚动一段距离。如果想要实现禁用滚动及惯性滚动，可使用以下2种方式：</p> <ul><li>设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#enablescrollinteraction10" target="_blank">enableScrollInteraction(false)</a>来禁用List滚动。</li><li>在列表开始滚动时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onscrollframebegin9" target="_blank">onScrollFrameBegin</a>事件，事件参数传入即将发生的滚动量，在事件处理函数中根据应用场景计算实际需要的滚动量，并将其作为事件处理函数的返回值返回，列表将按照返回值的实际滚动量进行滚动，例如，可以将返回值设置为0，则表示不滚动。<div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/EdgeBlur.ets#L55-L57" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">onScrollFrameBegin</span>((<span class="hljs-variable">offset</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">state</span>: <span class="hljs-title class_">ScrollState</span>) =&gt; {</li><li>  <span class="hljs-keyword">return</span> { <span class="hljs-variable">offsetRemain</span>: <span class="hljs-number">0</span> } <span class="hljs-comment">// If the return value is set to 0, it means that there will be no scrolling.</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/EdgeBlur.ets#L55-L57" target="_blank">EdgeBlur.ets</a></div></div></div></div> </li></ul> <p><strong>列表项左滑：</strong>通过给列表项ListItem添加SwiperAction组件实现，可以实现左滑删除、置顶等功能。具体实现方案和示例代码请参见下一章节<a href="/consumer/cn/doc/best-practices/bpta-common-list-operations#section312414023718">案例一：实现简单聊天列表</a>中的左滑删除/置顶。</p> <p><strong>循环滚动：</strong>当用户滚动到列表的末尾或开头时，列表会自动循环回到开头或结尾。例如，实现一个可左右滑动的循环滚动列表，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onscrollframebegin9" target="_blank">onScrollFrameBegin</a>事件计算当前的滚动偏移量和即将发生的滚动量之和，与ListItem的总宽度作比较，从而判断用户是左滑还是右滑，计算出列表滚动时实际需要的滚动量，示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/LoopScrolling.ets#L142-L153" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">onScrollFrameBegin</span>((<span class="hljs-variable">offset</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">state</span>: <span class="hljs-title class_">ScrollState</span>) =&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">currentOffset</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-variable">xOffset</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">newOffset</span> = <span class="hljs-variable">currentOffset</span> + <span class="hljs-variable">offset</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">totalWeight</span> = <span class="hljs-number">220</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">// The total width of LIST.</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">newOffset</span> &lt; <span class="hljs-title class_">totalWeight</span> * <span class="hljs-number">0.5</span>) {</li><li>    <span class="hljs-variable">newOffset</span> += <span class="hljs-variable">totalWeight</span>;</li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable">newOffset</span> &gt; <span class="hljs-variable">totalWeight</span> * <span class="hljs-number">2.5</span>) {</li><li>    <span class="hljs-variable">newOffset</span> -= <span class="hljs-variable">totalWeight</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> { <span class="hljs-variable">offsetRemain</span>: <span class="hljs-title class_">newOffset</span> - <span class="hljs-title class_">currentOffset</span> };</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/LoopScrolling.ets#L142-L153" target="_blank">LoopScrolling.ets</a></div></div></div></div> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162934.74878364156334569214134087399059:50001231000000:2800:9C1B458890EBF5B082A90BEB6B1652CBC48E35CF1C07372C864135A024E81A7E.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section343622003510">列表排版<i class="anchor-icon anchor-icon-link" anchorid="section343622003510" tips="复制节点链接"></i></h2><p>列表排版是指根据数据内容或使用场景，将一组相似或相关的列表项（如消息、商品等）按照一定的布局方式进行排列，以便用户能够快速识别并操作列表项。</p> </div> <div class="tiledSection"><h3 id="section1685233073513" class="firsth2">列表内容显示<i class="anchor-icon anchor-icon-link" anchorid="section1685233073513" tips="复制节点链接"></i></h3><p>列表内容显示的方式决定了用户能否快速获取信息，直接影响整体的视觉体验和交互效率。主要包括边栏索引、列表底部留白、列表吸顶、边缘模糊效果等，具体说明和实现方式如下：</p> <p><strong>边栏索引：</strong>可以通过监听List组件的onScrollIndex事件来实现，右侧索引栏需要使用字母表索引组件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-alphabet-indexer" target="_blank">AlphabetIndexer</a>。具体请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list#响应滚动位置" target="_blank">响应滚动位置</a></p> <p><strong>列表底部留白：</strong>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#contentendoffset11" target="_blank">contentEndOffset</a>设置内容区末尾偏移量。列表滚动到末尾位置时，列表内容与列表显示区域边界保留指定距离。</p> <p><strong>列表吸顶：</strong>List组件的sticky属性配合ListItemGroup组件使用，用于设置ListItemGroup中的头部组件是否呈现吸顶效果或者尾部组件是否呈现吸底效果。通过给List组件设置sticky属性为StickyStyle.Header，即可实现列表的粘性标题效果。如果需要支持吸底效果，可以通过footer参数初始化ListItemGroup的底部组件，并将sticky属性设置为StickyStyle.Footer。具体请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list#添加粘性标题" target="_blank">添加粘性标题</a></p> <p><strong>边缘模糊效果：</strong>例如实现List上下渐隐效果，可以在List组件上添加overlay浮层，通过linearGradient属性给overlay叠加模糊渐变效果实现。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/EdgeBlur.ets#L23-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-title function_">overlayBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Stack</span>().<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">linearGradient</span>({</li><li>      <span class="hljs-attr">direction</span>: <span class="hljs-title class_">GradientDirection</span>.<span class="hljs-property">Bottom</span>, <span class="hljs-comment">// Gradient direction.</span></li><li>      <span class="hljs-attr">colors</span>: [[<span class="hljs-number">0x00000000</span>, <span class="hljs-number">0.0</span>], [<span class="hljs-number">0xB3000000</span>, <span class="hljs-number">1.0</span>]]</li><li>    })</li><li>    .<span class="hljs-title function_">blendMode</span>(<span class="hljs-title class_">BlendMode</span>.<span class="hljs-property">DST_IN</span>, <span class="hljs-title class_">BlendApplyType</span>.<span class="hljs-property">OFFSCREEN</span>)</li><li>}</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">NavDestination</span>() {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">''</span> + item)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }</li><li>    .<span class="hljs-title function_">overlay</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">overlayBuilder</span>())</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/EdgeBlur.ets#L23-L50" target="_blank">EdgeBlur.ets</a></div></div></div></div> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162934.11270551650083633341244151828624:50001231000000:2800:3F1A4510321517F897FA17E8D9D123C854D046ED0E826B35519AD74D4CB86B7B.png" title="点击放大" width="266"></span></p> <p><strong>折叠展开：</strong>列表项的折叠与展开用途广泛，常用于信息清单的展示、填写等应用场景。通过改变ListItem的状态，来控制每个列表项是否展开，并通过animation和animateTo来实现展开与折叠过程中的动效效果。具体请参见：<strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list#折叠与展开" target="_blank">折叠与展开</a></strong></p> </div> <div class="tiledSection"><h2 id="section569294153617">列表数据更新<i class="anchor-icon anchor-icon-link" anchorid="section569294153617" tips="复制节点链接"></i></h2><p>列表数据更新操作通常包含列表刷新方式、增删列表项以及在数据刷新时，可能需要保持可见区域内容位置不变，其对应的具体说明和实现方式可参考如下。</p> </div> <div class="tiledSection"><h3 id="section1554052463614" class="firsth2">列表刷新<i class="anchor-icon anchor-icon-link" anchorid="section1554052463614" tips="复制节点链接"></i></h3><p>列表刷新指的是在不重新加载整个页面或组件的前提下，根据新的数据源动态地对列表内容进行刷新、替换或局部更新，主要方式包括上拉加载、下拉刷新、左右滚动刷新、局部数据刷新。</p> <p><strong>上拉加载：</strong>在列表底部添加LoadingProgress()组件用于显示加载动画，并在onScrollIndex()回调中判断显示区域是否到底，当显示到底时加载更多数据。示例如下：</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/PullUpLoading.ets#L45-L75" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>  <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">''</span> + item)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>  <span class="hljs-title class_">ListItem</span>() {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">LoadingProgress</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">48</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'加载中'</span>)</li><li>    }</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">64</span>)</li><li>}</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>.<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start: <span class="hljs-built_in">number</span>, end: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (end &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>);</li><li>      }</li><li>    })</li><li>  }</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/PullUpLoading.ets#L45-L75" target="_blank">PullUpLoading.ets</a></div></div></div></div> <p><strong>下拉刷新：</strong>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh" target="_blank">Refresh</a>容器进行页面下拉操作并绑定显示刷新动效的容器组件，实现下拉刷新效果。具体实现方案和示例代码请参见下一章节<a href="/consumer/cn/doc/best-practices/bpta-common-list-operations#section312414023718">案例一：实现简单聊天列表</a>中的下拉加载更多聊天记录。</p> <p><strong>左右滚动刷新：</strong>由于refresh没有横滑交互，可以使用Column容器包裹refresh，然后给Column容器设置rotate属性使其旋转90度。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollLeftAndRightToRefresh.ets#L24-L75" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-tag">Column</span>() {</li><li>  <span class="hljs-selector-tag">Refresh</span>({ refreshing: $$this.isRefreshing }) {</li><li>    <span class="hljs-selector-tag">List</span>({ space: 10 }) {</li><li>      <span class="hljs-selector-tag">ForEach</span>(this.arr, (<span class="hljs-attribute">item</span>: number) =&gt; {</li><li>        <span class="hljs-selector-tag">ListItem</span>() {</li><li>          <span class="hljs-selector-tag">Text</span>(<span class="hljs-string">''</span> + item)</li><li>            <span class="hljs-selector-class">.width</span>(<span class="hljs-number">300</span>)</li><li>            <span class="hljs-selector-class">.height</span>(<span class="hljs-number">80</span>)</li><li>            <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)</li><li>            <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>            <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">16</span>)</li><li>            <span class="hljs-selector-class">.backgroundColor</span>(<span class="hljs-number">0</span>xFFFFFF)</li><li>            <span class="hljs-selector-class">.translate</span>({ x: (80 - 300) / 2 })</li><li>            <span class="hljs-selector-class">.rotate</span>({</li><li>              x: 0,</li><li>              y: 0,</li><li>              z: 1,</li><li>              centerX: '50%',</li><li>              centerY: '50%',</li><li>              angle: 90</li><li>            })</li><li>        }</li><li>        .<span class="hljs-built_in">width</span>(<span class="hljs-number">80</span>)</li><li>        .<span class="hljs-built_in">height</span>(<span class="hljs-number">300</span>)</li><li>      }, (<span class="hljs-attribute">item</span>: string) =&gt; item)</li><li>    }</li><li>    .<span class="hljs-built_in">width</span>(<span class="hljs-number">300</span>)</li><li>    .<span class="hljs-built_in">height</span>(<span class="hljs-number">300</span>)</li><li>    .<span class="hljs-built_in">alignListItem</span>(ListItemAlign.Center)</li><li>    .<span class="hljs-built_in">scrollBar</span>(BarState.Off)</li><li>  }</li><li>  .<span class="hljs-built_in">onRefreshing</span>(() =&gt; {</li><li>    <span class="hljs-built_in">setTimeout</span>(() =&gt; {</li><li>      this.isRefreshing = false;</li><li>    }, <span class="hljs-number">2000</span>)</li><li>  })</li><li>  .<span class="hljs-built_in">backgroundColor</span>(<span class="hljs-number">0</span>xDCDCDC)</li><li>  .<span class="hljs-built_in">refreshOffset</span>(<span class="hljs-number">64</span>)</li><li>  .<span class="hljs-built_in">pullToRefresh</span>(true)</li><li>}</li><li>.<span class="hljs-built_in">justifyContent</span>(FlexAlign.Center)</li><li>.<span class="hljs-built_in">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-built_in">height</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-built_in">rotate</span>({</li><li>  <span class="hljs-attribute">x</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attribute">y</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attribute">z</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-attribute">centerX</span>: <span class="hljs-string">'50%'</span>,</li><li>  <span class="hljs-attribute">centerY</span>: <span class="hljs-string">'50%'</span>,</li><li>  <span class="hljs-attribute">angle</span>: -<span class="hljs-number">90</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/ScrollLeftAndRightToRefresh.ets#L24-L75" target="_blank">ScrollLeftAndRightToRefresh.ets</a></div></div></div></div> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.21639210982898840925726817430629:50001231000000:2800:C6F263F03A072FE734BC8B4A822C17606AB8E7B90BCB60BDD2C011CCEB6FFB76.gif" title="点击放大" width="266"></span></p> <p><strong>局部数据刷新：</strong>通过直接修改单一ListItem的数据源即可实现。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L37-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'Partial_Refresh'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>)</li><li>  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">8</span> })</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] += <span class="hljs-number">10</span>;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/RollingMonitoring.ets#L37-L42" target="_blank">RollingMonitoring.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section10292535183620">增删列表项<i class="anchor-icon anchor-icon-link" anchorid="section10292535183620" tips="复制节点链接"></i></h3><p>增删列表项是指用户可以动态地向列表中添加新项或从列表中删除已有项，通常伴随着数据更新与界面刷新。使用数组的Push()、Pop()或splice()等方法即可实现插入列表项、删除列表项、删除ListItem子元素等操作。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/MaintainVisibleAreaContent.ets#L86-L95" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> addData(index: number, <span class="hljs-keyword">data</span>: TextClass): void {</li><li>  <span class="hljs-keyword">this</span>.dataArray.splice(index, <span class="hljs-number">0</span>, <span class="hljs-keyword">data</span>);</li><li>  <span class="hljs-keyword">this</span>.notifyDataAdd(index);</li><li>}</li><li>
</li><li><span class="hljs-keyword">public</span> pushData(<span class="hljs-keyword">data</span>: TextClass): void {</li><li>  <span class="hljs-keyword">this</span>.dataArray.push(<span class="hljs-keyword">data</span>);</li><li>  <span class="hljs-keyword">this</span>.notifyDataAdd(<span class="hljs-keyword">this</span>.dataArray.length - <span class="hljs-number">1</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/MaintainVisibleAreaContent.ets#L86-L95" target="_blank">MaintainVisibleAreaContent.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section5348124673615">保持可见区域内容<i class="anchor-icon anchor-icon-link" anchorid="section5348124673615" tips="复制节点链接"></i></h3><p>保持可见区域内容是指在用户滚动列表时，确保当前正在查看的内容不会因为数据更新、界面刷新或组件重新渲染而被替换或消失。例如在一些动态更新的列表中，如聊天消息、任务状态更新、股票行情等，如果每次更新都重新加载整个列表，可能会导致用户正在查看的内容被顶上去或消失，造成体验中断。针对此需求，主要有两种解决方案，参考如下：</p> <p><strong>方案一：</strong>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#maintainvisiblecontentposition12" target="_blank">maintainVisibleContentPosition</a>设置显示区域上方插入或删除数据时是否要保持可见内容位置不变。需要注意的是，此方案只有在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach" target="_blank">LazyForEach：数据懒加载</a>场景下才能生效。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/MaintainVisibleAreaContent.ets#L122-L137" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: TextClass</span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ListItem</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>    }</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: TextClass</span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item))</li><li>}</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)</li><li>.<span class="hljs-title function_">maintainVisibleContentPosition</span>(<span class="hljs-literal">true</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/SimpleChatList/entry/src/main/ets/pages/MaintainVisibleAreaContent.ets#L122-L137" target="_blank">MaintainVisibleAreaContent.ets</a></div></div></div></div> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.20823246643834740512465587265153:50001231000000:2800:620DD6EA63F84C7A12EF438622E0DBD939FCB0608D7FC318E85FAFB27C4402F9.gif" title="点击放大" width="266"></span></p> <p><strong>方案二：</strong>可以给List添加scroller控制器，将列表跳回至原先所在位置this.scroller.scrollToIndex，具体请参考示例：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs/faqs-arkui-268" target="_blank">List的下拉加载如何回滚到当前展示位置</a></p> </div> <div class="tiledSection"><h2 id="section2034018511375">列表拖拽<i class="anchor-icon anchor-icon-link" anchorid="section2034018511375" tips="复制节点链接"></i></h2><p>列表拖拽指的是用户通过长按或点击并拖动某个列表项ListItem，将其移动到另一个位置或区域的操作。这种交互通常用于列表项优先级调整、列表排序等。可以通过List组件的拖拽方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onitemdragstart8" target="_blank">onItemDragStart()</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onitemdragmove8" target="_blank">onItemDragMove()</a>方法，在列表开始拖拽时和拖拽状态的回调中处理被拖拽的ListItem，当结束拖拽时，在新的位置或区域插入ListItem。具体实现方案和示例代码请参见下一章节<a href="/consumer/cn/doc/best-practices/bpta-common-list-operations#section312414023718">案例一：实现简单聊天列表</a>中的消息列表拖拽排序。</p> </div> <div class="tiledSection"><h2 id="section1642042514374">列表场景案例<i class="anchor-icon anchor-icon-link" anchorid="section1642042514374" tips="复制节点链接"></i></h2><p>本章节包含实现简单聊天列表和常见列表流这两个案例，主要通过实现简单聊天列表来介绍列表常见操作、实现方案以及代码实现。</p> </div> <div class="tiledSection"><h3 id="section312414023718" class="firsth2">案例一：实现简单聊天列表<i class="anchor-icon anchor-icon-link" anchorid="section312414023718" tips="复制节点链接"></i></h3><p><strong>场景描述</strong></p> <p>常见聊天界面主要包含联系人消息界面以及聊天窗口界面。其中，联系人列表界面主要支持以下交互场景：</p> <ul><li>左滑操作，用于删除或置顶联系人</li><li>滚动后点击“回到顶部”按钮快速跳转</li><li>拖拽调整联系人排序</li></ul> <p>聊天窗口界面则包含以下功能：</p> <ul><li>初始化时自动定位到底部消息</li><li>支持下拉加载历史聊天记录</li><li>实时新增并展示最新聊天内容</li></ul> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.13512848079378580277917663630526:50001231000000:2800:FE3B3C2553AF3586CD157A2E8180BF38B5FFFEDF9990F33119AEBD7C3399ED8E.gif" title="点击放大" width="266"></span></p> <p><strong>消息气泡</strong></p> <p>在ListItem中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-badge" target="_blank">Badge</a>组件可实现给列表项添加标记功能。Badge是可以附加在单个组件上用于信息标记的容器组件。例如，在消息列表中，若希望在联系人头像右上角添加标记，可在实现消息列表项ListItem的联系人头像时，将头像Image组件作为Badge的子组件。在Badge组件中，count和position参数用于设置需要展示的消息数量和提示点显示位置，还可以通过style参数灵活设置标记的样式。</p> <p><span><img height="549.2235000000001" originheight="2258" originwidth="1093" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.28127001230728798783313797658823:50001231000000:2800:0B55F281F0F29804B3F1259F99C03ECE7E97CE391B6C345EBA623F37C02CAA5A.png" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>定义一个变量isNewMessage来标识是否需要给列表项添加标记功能，然后使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-badge" target="_blank">Badge</a>组件给列表项添加标记功能。</p> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L154-L169" data-highlighted="yes"><ol class="linenums"><li>if (item.isNewMessage) {</li><li>  <span class="hljs-comment">// The Badge component can be used to add tags to list items.</span></li><li>  <span class="hljs-built_in">Badge</span>({</li><li>    value: '',</li><li>    position: BadgePosition.RightTop,</li><li>    style: { badgeSize: <span class="hljs-number">8</span>, badgeColor: '#FA2A2D' }</li><li>  }) {</li><li>    <span class="hljs-built_in">Image</span>(item.image)</li><li>      <span class="hljs-selector-class">.width</span>(<span class="hljs-number">48</span>)</li><li>      <span class="hljs-selector-class">.height</span>(<span class="hljs-number">48</span>)</li><li>  }</li><li>} else {</li><li>  <span class="hljs-built_in">Image</span>(item.image)</li><li>    <span class="hljs-selector-class">.width</span>(<span class="hljs-number">48</span>)</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-number">48</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L154-L169" target="_blank">Index.ets</a></div></div></div></div> <p><strong>左滑删除/置顶</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.89687204654389704715841041554732:50001231000000:2800:EEF711F2417CD61234FBDED664DD4822F2F6F1FAEC4D9B13C8E49EB1DD207557.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>使用组件swipeAction实现ListItem左滑划出组件，然后实现一个左滑区域内容显示的组件itemEnd，将其绑定到swipeAction上。</p> <ul><li>实现ListItem置顶，为每个ListItem定义一个变量isTop用于标记是否置顶，然后设置一个排序方式实现置顶项优先显示。</li><li>实现ListItem删除，利用Item数组自带的splice方法删除指定index的ListItem。</li></ul> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L120-L142" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-title function_">itemEnd</span>(<span class="hljs-params">item: Item, index: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Image</span>($r(item.<span class="hljs-property">isTop</span> ? <span class="hljs-string">'app.media.up_off'</span> : <span class="hljs-string">'app.media.up_on'</span>))</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">8</span> })</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTop</span>(item);</li><li>      })</li><li>    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.delete'</span>))</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortedList</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>      })</li><li>  }</li><li>  .<span class="hljs-title function_">padding</span>(<span class="hljs-number">4</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>  .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L120-L142" target="_blank">Index.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L217-L231" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">swipeAction</span>({</li><li>  <span class="hljs-variable">end</span>: {</li><li>    <span class="hljs-variable">builder</span>: () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">itemEnd</span>(<span class="hljs-variable">item</span>, <span class="hljs-variable">index</span>);</li><li>    },</li><li>    <span class="hljs-variable">actionAreaDistance</span>: <span class="hljs-number">56</span>,</li><li>    <span class="hljs-variable">onAction</span>: () =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({ <span class="hljs-variable">duration</span>: <span class="hljs-number">1000</span> }, () =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">sortedList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable">index</span>, <span class="hljs-number">1</span>);</li><li>      })</li><li>    }</li><li>  },</li><li>  <span class="hljs-variable">edgeEffect</span>: <span class="hljs-title class_">SwipeEdgeEffect</span>.<span class="hljs-title class_">Spring</span></li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L217-L231" target="_blank">Index.ets</a></div></div></div></div> <p><strong>滚动后跳转到指定位置</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.71197066492184956523731320940265:50001231000000:2800:DA44B582C95DB8D40EC7ACA46C22A31CBD21DC510512F52260EEB61CD40CBE53.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>以滚动后跳转到顶部为例，在回调.onWillScroll()中通过scroll组件自带的接口currentOffset()获取当前滚动偏移量，将偏移量与临界值进行对比，当超过临界值时显示按钮，点击后调用scrolltoindex(0)即可跳转到顶部。</p> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L241-L247" data-highlighted="yes"><ol class="linenums"><li>.onWillScroll(() =&gt; {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.scroller.currentOffset().yOffset &gt; <span class="hljs-number">100</span>) {</li><li>    <span class="hljs-keyword">this</span>.isFlag = <span class="hljs-literal">true</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">this</span>.isFlag = <span class="hljs-literal">false</span>;</li><li>  }</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L241-L247" target="_blank">Index.ets</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L286-L296" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFlag) {</li><li>  Button($r(<span class="hljs-string">'app.string.Back_to_top'</span>))</li><li>    .margin({ right: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span> })</li><li>    .backgroundColor(<span class="hljs-string">'#0A59F7'</span>)</li><li>    .borderRadius(<span class="hljs-number">20</span>)</li><li>    .fontColor(Color.White)</li><li>    .onClick(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.scroller.scrollToIndex(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);</li><li>      <span class="hljs-keyword">this</span>.isFlag = <span class="hljs-literal">false</span>;</li><li>    })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L286-L296" target="_blank">Index.ets</a></div></div></div></div> <p><strong>消息列表拖拽排序</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.43235799191393888714451656934623:50001231000000:2800:9D537ABBE31DB9603EBD6D5B1BBEB32ECFF33BBD738114CFD187605611003967.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>通过List组件的拖拽方法onItemDragStart()和onItemDragMove()方法，主要步骤如下：</p> <ol><li><span>开始拖拽列表元素时，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onitemdragstart8" target="_blank">onItemDragStart()</a>方法被触发，在回调里记录当前拖拽的ListItem并赋值给自定义对象dragItem，返回并展示拖拽时的UI函数dragFloatView()。</span><p></p><div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L253-L257" data-highlighted="yes"><ol class="linenums"><li>.onItemDragStart((event: ItemDragInfo, itemIndex: number) =&gt; {</li><li>  <span class="hljs-comment">// Triggered when starting to drag and drop list elements.</span></li><li>  <span class="hljs-keyword">this</span>.dragItem = <span class="hljs-keyword">this</span>.sortedList[itemIndex];</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dragFloatView(<span class="hljs-keyword">this</span>.sortedList[itemIndex]);</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L253-L257" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>拖拽列表元素在列表范围内移动时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#onitemdragmove8" target="_blank">onItemDragMove()方法</a>，在回调里分别记录被拖拽ListItem的索引deleteIndex和拖拽插入位置索引insertIndex，然后通过Item数组的splice方法删除被拖拽的ListItem，同时将被删除的ListItem添加至insertIndex所在的位置。</span><p></p><div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L260-L267" data-highlighted="yes"><ol class="linenums"><li>.onItemDragMove((event: ItemDragInfo, itemIndex: number, insertIndex: number) =&gt; {</li><li>  <span class="hljs-comment">// Triggered when dragging and moving within the range of a list element.</span></li><li>  <span class="hljs-keyword">this</span>.getUIContext().animateTo({ duration: <span class="hljs-number">200</span>, curve: Curve.Linear }, () =&gt; {</li><li>    let deleteIndex = <span class="hljs-keyword">this</span>.sortedList.indexOf(<span class="hljs-keyword">this</span>.dragItem);</li><li>    <span class="hljs-keyword">this</span>.sortedList.splice(deleteIndex, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-keyword">this</span>.sortedList.splice(insertIndex, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.dragItem);</li><li>  })</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L260-L267" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>定义一个dragFloatView<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder#私有自定义构建函数" target="_blank">自定义构建函数</a>作为拖拽时临时展示的UI元素，直至拖拽结束。</span><p></p><div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L65-L115" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Builder</span></li><li>dragFloatView(<span class="hljs-attribute">item</span>: Item) {</li><li>  <span class="hljs-built_in">Row</span>() {</li><li>    if (item.isNewMessage) {</li><li>      <span class="hljs-built_in">Badge</span>({</li><li>        value: '',</li><li>        position: BadgePosition.RightTop,</li><li>        style: { badgeSize: <span class="hljs-number">8</span>, badgeColor: '#FA2A2D' }</li><li>      }) {</li><li>        <span class="hljs-built_in">Image</span>(item.image)</li><li>          <span class="hljs-selector-class">.width</span>(<span class="hljs-number">48</span>)</li><li>          <span class="hljs-selector-class">.height</span>(<span class="hljs-number">48</span>)</li><li>      }</li><li>    } else {</li><li>      <span class="hljs-built_in">Image</span>(item.image)</li><li>        <span class="hljs-selector-class">.width</span>(<span class="hljs-number">48</span>)</li><li>        <span class="hljs-selector-class">.height</span>(<span class="hljs-number">48</span>)</li><li>    }</li><li>
</li><li>    <span class="hljs-built_in">Row</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        Text(item.name)</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)</li><li>          <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)</li><li>          <span class="hljs-selector-class">.margin</span>({ bottom: <span class="hljs-number">8</span> })</li><li>          <span class="hljs-selector-class">.textAlign</span>(TextAlign.Start)</li><li>        Text(item.message[item.message.length - <span class="hljs-number">1</span>].msg)</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)</li><li>          <span class="hljs-selector-class">.maxLines</span>(<span class="hljs-number">1</span>)</li><li>          <span class="hljs-selector-class">.constraintSize</span>({ maxWidth: '<span class="hljs-number">70%</span>' })</li><li>          <span class="hljs-selector-class">.textOverflow</span>({ overflow: TextOverflow.Ellipsis })</li><li>      }</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.Center)</li><li>      <span class="hljs-selector-class">.alignItems</span>(HorizontalAlign.Start)</li><li>
</li><li>      Text(item.time)</li><li>        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">12</span>)</li><li>        <span class="hljs-selector-class">.margin</span>({ bottom: <span class="hljs-number">20</span> })</li><li>        <span class="hljs-selector-class">.fontColor</span>(item.isTop ? Color.Black : Color.Gray)</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">80%</span>')</li><li>    <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.SpaceBetween)</li><li>  }</li><li>  <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>  <span class="hljs-selector-class">.height</span>(<span class="hljs-number">72</span>)</li><li>  <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">16</span>)</li><li>  <span class="hljs-selector-class">.backgroundColor</span>(item.isTop ? '#<span class="hljs-number">4497</span>FF' : '#CCCCCC')</li><li>  <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.SpaceAround)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L65-L115" target="_blank">Index.ets</a></div></div></div></div> <p></p></li><li><span>在拖拽时，被拖拽的ListItem若与记录的dragItem相同，则对其隐藏，避免页面中同时出现相同的ListItem。</span><p></p><div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L209-L209" data-highlighted="yes"><ol class="linenums"><li>.<span class="hljs-title function_">visibility</span>(<span class="hljs-variable">item</span> == <span class="hljs-keyword">this</span>.<span class="hljs-variable">dragItem</span> ? <span class="hljs-variable">Visibility</span>.<span class="hljs-variable">Hidden</span> : <span class="hljs-title class_">Visibility</span>.<span class="hljs-title class_">Visible</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/Index.ets#L209-L209" target="_blank">Index.ets</a></div></div></div></div> <p></p></li></ol> <p></p> <p><strong>初始化显示到底部</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162935.67898192833988708080024083508493:50001231000000:2800:B3801BC9416A3C962B19718127ECA85C5FDE874B895AC1FB9CF19FC7788F21C0.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>通过设置参数initialIndex为消息列表的最大长度，此时只是实现了显示到最后一条，还不能达到预期效果。当遇到超长item时，会从最后一条的顶部开始显示，并不能直接显示到底部。还需要在List组件挂载显示后触发的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-show-hide#onappear" target="_blank">onAppear()</a>回调中通过ScrollEdge(Edge.Bottom)跳转至最底部。</p> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L57-L109" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span>, <span class="hljs-variable">initialIndex</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">itemInfo</span>.<span class="hljs-title class_">message</span>.<span class="hljs-title class_">length</span> - <span class="hljs-number">1</span> }) {</li><li>  <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">showItemMessage</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">messageObj</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>    <span class="hljs-title function_">ListItem</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">item</span>.<span class="hljs-variable">sender</span> === <span class="hljs-string">'others'</span>) {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">itemInfo</span>.<span class="hljs-variable">image</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">36</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">36</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">right</span>: <span class="hljs-number">8</span> })</li><li>
</li><li>          <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">msg</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">constraintSize</span>({ <span class="hljs-variable">maxWidth</span>: <span class="hljs-string">'70%'</span> })</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>            .<span class="hljs-title function_">padding</span>({</li><li>              <span class="hljs-variable">top</span>: <span class="hljs-number">8</span>,</li><li>              <span class="hljs-variable">bottom</span>: <span class="hljs-number">8</span>,</li><li>              <span class="hljs-variable">left</span>: <span class="hljs-number">12</span>,</li><li>              <span class="hljs-variable">right</span>: <span class="hljs-number">12</span></li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">constraintSize</span>({ <span class="hljs-variable">minHeight</span>: <span class="hljs-number">48</span> })</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">Row</span>() {</li><li>          <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">msg</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>            .<span class="hljs-title function_">padding</span>({</li><li>              <span class="hljs-variable">top</span>: <span class="hljs-number">8</span>,</li><li>              <span class="hljs-variable">bottom</span>: <span class="hljs-number">8</span>,</li><li>              <span class="hljs-variable">left</span>: <span class="hljs-number">12</span>,</li><li>              <span class="hljs-variable">right</span>: <span class="hljs-number">12</span></li><li>            })</li><li>          <span class="hljs-title function_">Image</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.Public_avatar'</span>))</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">36</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">36</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">left</span>: <span class="hljs-number">8</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">End</span>)</li><li>      }</li><li>    }</li><li>  })</li><li>}</li><li>.<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>  <span class="hljs-comment">// Initialize display to the bottom.</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">scrollEdge</span>(<span class="hljs-variable">Edge</span>.<span class="hljs-variable">Bottom</span>);</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L57-L109" target="_blank">ChatPage.ets</a></div></div></div></div> <p><strong>下拉加载更多聊天记录</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.49317535204101125425061836470200:50001231000000:2800:54AFC85C758C7B1E82F5C3F6FAEE8865FFE785961C9F7A7EE80C1A638CD32655.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh" target="_blank">Refresh</a>容器组件包裹List组件进行页面下拉操作，进入刷新状态时触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-refresh#onrefreshing" target="_blank">onRefreshing()</a>回调，并在其中添加数据更新的操作，实现下拉刷新页面的功能。</p> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L55-L126" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Refresh</span>({ <span class="hljs-variable">refreshing</span>: $$<span class="hljs-keyword">this</span>.<span class="hljs-title class_">isRefreshing</span> }) {</li><li>  <span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span>, <span class="hljs-variable">scroller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">scroller</span>, <span class="hljs-variable">initialIndex</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">itemInfo</span>.<span class="hljs-title class_">message</span>.<span class="hljs-title class_">length</span> - <span class="hljs-number">1</span> }) {</li><li>    <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">showItemMessage</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">messageObj</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>      <span class="hljs-title function_">ListItem</span>() {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">item</span>.<span class="hljs-variable">sender</span> === <span class="hljs-string">'others'</span>) {</li><li>          <span class="hljs-title function_">Row</span>() {</li><li>            <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">itemInfo</span>.<span class="hljs-variable">image</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">36</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">36</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">right</span>: <span class="hljs-number">8</span> })</li><li>
</li><li>            <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">msg</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">constraintSize</span>({ <span class="hljs-variable">maxWidth</span>: <span class="hljs-string">'70%'</span> })</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>              .<span class="hljs-title function_">padding</span>({</li><li>                <span class="hljs-variable">top</span>: <span class="hljs-number">8</span>,</li><li>                <span class="hljs-variable">bottom</span>: <span class="hljs-number">8</span>,</li><li>                <span class="hljs-variable">left</span>: <span class="hljs-number">12</span>,</li><li>                <span class="hljs-variable">right</span>: <span class="hljs-number">12</span></li><li>              })</li><li>          }</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">constraintSize</span>({ <span class="hljs-variable">minHeight</span>: <span class="hljs-number">48</span> })</li><li>          .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">Start</span>)</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-title function_">Row</span>() {</li><li>            <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>.<span class="hljs-variable">msg</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)</li><li>              .<span class="hljs-title function_">padding</span>({</li><li>                <span class="hljs-variable">top</span>: <span class="hljs-number">8</span>,</li><li>                <span class="hljs-variable">bottom</span>: <span class="hljs-number">8</span>,</li><li>                <span class="hljs-variable">left</span>: <span class="hljs-number">12</span>,</li><li>                <span class="hljs-variable">right</span>: <span class="hljs-number">12</span></li><li>              })</li><li>            <span class="hljs-title function_">Image</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.media.Public_avatar'</span>))</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">36</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">36</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">left</span>: <span class="hljs-number">8</span> })</li><li>          }</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">48</span>)</li><li>          .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-variable">FlexAlign</span>.<span class="hljs-variable">End</span>)</li><li>        }</li><li>      }</li><li>    })</li><li>  }</li><li>  .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>    <span class="hljs-comment">// Initialize display to the bottom.</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">scroller</span>.<span class="hljs-title function_">scrollEdge</span>(<span class="hljs-variable">Edge</span>.<span class="hljs-variable">Bottom</span>);</li><li>  })</li><li>  .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-variable">BarState</span>.<span class="hljs-variable">Off</span>)</li><li>  .<span class="hljs-title function_">contentEndOffset</span>(<span class="hljs-number">8</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li><li>.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>.<span class="hljs-title function_">refreshOffset</span>(<span class="hljs-number">64</span>)</li><li>.<span class="hljs-title function_">pullToRefresh</span>(<span class="hljs-keyword">true</span>)</li><li>.<span class="hljs-title function_">onRefreshing</span>(() =&gt; {</li><li>  <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getLastTenElements</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">itemMessage</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">isRefreshing</span> = <span class="hljs-keyword">false</span>;</li><li>  }, <span class="hljs-number">1500</span>)</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L55-L126" target="_blank">ChatPage.ets</a></div></div></div></div> <p><strong>新增聊天记录</strong></p> <p><span><img height="549.2900000000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211162936.40506542388163928762360609400658:50001231000000:2800:52DBCC644CAE9DE9269B60B64EBA82A0DC04114AA0FB91AA012664C8659E0A66.gif" title="点击放大" width="266"></span></p> <p><strong>实现方案</strong></p> <p>通过TextInput组件获取聊天键盘内容，使用新增列表项push()接口将消息添加到聊天记录中。</p> <p><strong>示例代码</strong></p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L151-L163" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'input your word...'</span>, <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputMessage</span> })</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>  .<span class="hljs-title function_">margin</span>({</li><li>    <span class="hljs-attr">left</span>: <span class="hljs-number">12</span>,</li><li>    <span class="hljs-attr">right</span>: <span class="hljs-number">12</span></li><li>  })</li><li>  .<span class="hljs-title function_">onBlur</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollEdge</span>(<span class="hljs-title class_">Edge</span>.<span class="hljs-property">Bottom</span>);</li><li>  })</li><li>  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputMessage</span> = value;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L151-L163" target="_blank">ChatPage.ets</a></div></div></div></div> <p>点击图标发送消息，通过数组的push()方法将输入的内容添加至List数据源itemMessage数组中，然后调用scrollEdge(Edge.Bottom)使List滚动到底部，同时清空输入框的内容。</p> <div class="screenLinkPre"><div _ngcontent-hjs-c106="" class="highlight-div"><div _ngcontent-hjs-c106="" class="highlight-div-header"><div _ngcontent-hjs-c106="" class="highlight-div-header-left"><div _ngcontent-hjs-c106="" class="handle-button expand-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hjs-c106="" class="highlight-div-header-right"><div _ngcontent-hjs-c106="" class="handle-button ai-button"></div><div _ngcontent-hjs-c106="" class="handle-button line-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hjs-c106="" class="handle-button theme-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hjs-c106="" class="handle-button copy-button"><div _ngcontent-hjs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hjs-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L172-L186" data-highlighted="yes"><ol class="linenums"><li>Image(<span class="hljs-keyword">this</span>.inputMessage === <span class="hljs-string">''</span> ? $r(<span class="hljs-string">'app.media.send_off'</span>) : $r(<span class="hljs-string">'app.media.send_on'</span>))</li><li>  .width(<span class="hljs-number">28</span>)</li><li>  .height(<span class="hljs-number">28</span>)</li><li>  .onClick(() =&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.inputMessage.trim() === <span class="hljs-string">''</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">this</span>.itemMessage.push({</li><li>      sender: <span class="hljs-string">'myself'</span>,</li><li>      msg: <span class="hljs-keyword">this</span>.inputMessage</li><li>    });</li><li>    <span class="hljs-keyword">this</span>.showItemMessage = <span class="hljs-keyword">this</span>.itemMessage.slice(-<span class="hljs-number">10</span>);</li><li>    <span class="hljs-keyword">this</span>.scroller.scrollEdge(Edge.Bottom);</li><li>    <span class="hljs-keyword">this</span>.inputMessage = <span class="hljs-string">''</span>;</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/simple-chat-list/blob/master/entry/src/main/ets/pages/ChatPage.ets#L172-L186" target="_blank">ChatPage.ets</a></div></div></div></div> </div> <div class="tiledSection"><h3 id="section19401241163814">案例二：常见列表流场景<i class="anchor-icon anchor-icon-link" anchorid="section19401241163814" tips="复制节点链接"></i></h3><p>列表流是采用以“行”为单位进行内容排列的布局形式，每“行”列表项通过文本、图片等不同形式的组合，高效地显示结构化的信息，当列表项内容超过屏幕大小时，可以提供滚动功能。具体场景介绍请参见：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-common-list-flows" target="_blank">常见列表流</a>。</p> </div> <div class="tiledSection"><h2 id="section87561112393">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section87561112393" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/simple-chat-list" target="_blank">实现简单聊天列表功能</a></li></ul> </div> </div></div>