<h1 _ngcontent-xkd-c119="" class="doc-title ng-star-inserted" title="应用事件"> 应用事件 </h1>

<div _ngcontent-xkd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section199648871416">概述<i class="anchor-icon anchor-icon-link" anchorid="section199648871416" tips="复制节点链接"></i></h2></div> <p>HiAppEvent是在系统层面为应用开发者提供的一种事件打点机制，支持应用记录在运行过程中发生的故障事件、统计事件、安全事件、行为事件，帮助开发者定位问题、分析应用运行情况，以便进一步统计分析访问数量、日常用户活跃数量、用户操作习惯以及其他影响用户使用产品的关键因素。</p> <p>本文主要介绍如何使用HiAppEvent订阅和触发应用事件。</p> <div class="tiledSection"><h2 id="section5778103073917">订阅应用事件（ArkTS）<i class="anchor-icon anchor-icon-link" anchorid="section5778103073917" tips="复制节点链接"></i></h2><p>HiAppEvent提供了事件订阅接口，用于本地获取应用事件。</p> </div> <div class="tiledSection"><h3 id="section93731955123912" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section93731955123912" tips="复制节点链接"></i></h3><p>API接口的具体使用说明（参数使用限制、具体取值范围等）请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-hiappevent" target="_blank">应用事件打点</a>。</p> <p><strong>订阅接口功能介绍：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>addWatcher(watcher: Watcher): AppEventPackageHolder</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>添加应用的事件观察者，以添加对应用的事件的订阅。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>removeWatcher(watcher: Watcher): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>移除应用的事件观察者，以移除对应用的事件的订阅。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>打点接口功能介绍：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>write(info: AppEventInfo, callback: AsyncCallback&lt;void&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>应用事件异步打点方法，使用callback方式作为异步回调。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>write(info: AppEventInfo): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>应用事件异步打点方法，使用Promise方式作为异步回调。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1881513425441">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1881513425441" tips="复制节点链接"></i></h3><p>以实现对用户点击按钮行为的事件打点及订阅为例，说明开发步骤。</p> <ol><li><span>新建一个ArkTS应用工程，编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; entryability &gt; EntryAbility.ets”文件，导入依赖模块：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiAppEvent, hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; entryability &gt; EntryAbility.ets” 文件，在onCreate()函数中添加对用户点击按钮事件的订阅，示例代码如下：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>hiAppEvent.<span class="hljs-title function_">addWatcher</span>({</li><li>  <span class="hljs-comment">// Developers can customize observer names, and the system will use these names to identify different observers.</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-string">"watcher1"</span>,</li><li>  <span class="hljs-attr">appEventFilters</span>: [{ <span class="hljs-attr">domain</span>: <span class="hljs-string">"button"</span> }],</li><li>  <span class="hljs-attr">triggerCondition</span>: { <span class="hljs-attr">row</span>: <span class="hljs-number">1</span> },</li><li>   <span class="hljs-attr">onTrigger</span>: <span class="hljs-function">(<span class="hljs-params">curRow: <span class="hljs-built_in">number</span>, curSize: <span class="hljs-built_in">number</span>, holder: hiAppEvent.AppEventPackageHolder</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (holder == <span class="hljs-literal">null</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">"HiAppEvent holder is null"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent onTrigger: curRow=%{public}d, curSize=%{public}d`</span>, curRow, curSize);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">eventPkg</span>: hiAppEvent.<span class="hljs-property">AppEventPackage</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>    <span class="hljs-keyword">let</span> maxRetry = <span class="hljs-number">10</span>; </li><li>    <span class="hljs-keyword">while</span> (maxRetry-- &gt; <span class="hljs-number">0</span> &amp;&amp; (eventPkg = holder.<span class="hljs-title function_">takeNext</span>()) != <span class="hljs-literal">null</span>){</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventPkg.packageId=%{public}d`</span>, eventPkg.<span class="hljs-property">packageId</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventPkg.row=%{public}d`</span>, eventPkg.<span class="hljs-property">row</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventPkg.size=%{public}d`</span>, eventPkg.<span class="hljs-property">size</span>);</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventInfo <span class="hljs-keyword">of</span> eventPkg.<span class="hljs-property">data</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventPkg.info=%{public}s`</span>, eventInfo);</li><li>      }</li><li>    }</li><li>  }</li><li>});</li></ol></pre></div></div> <p></p></li><li><span>编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; pages &gt; Index.ets” 文件，导入依赖模块：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hiAppEvent, hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> <p></p></li><li><span>编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; pages &gt; Index.ets” 文件，添加一个按钮并在其onClick()函数中进行事件打点，以记录按钮点击事件，示例代码如下：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">Button</span>(<span class="hljs-string">"writeTest"</span>).<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">eventParams</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">number</span>&gt; = { <span class="hljs-string">'clickTime'</span>: <span class="hljs-number">100</span> };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">eventInfo</span>: <span class="hljs-title class_">hiAppEvent</span>.<span class="hljs-title class_">AppEventInfo</span> = {</li><li>     <span class="hljs-variable">domain</span>: <span class="hljs-string">"button"</span>,</li><li>    <span class="hljs-variable">name</span>: <span class="hljs-string">"click"</span>,</li><li>    <span class="hljs-variable">eventType</span>: <span class="hljs-title class_">hiAppEvent</span>.<span class="hljs-title class_">EventType</span>.<span class="hljs-title class_">BEHAVIOR</span>,</li><li>    <span class="hljs-variable">params</span>: <span class="hljs-title class_">eventParams</span>,</li><li>  };</li><li>  <span class="hljs-variable">hiAppEvent</span>.<span class="hljs-title function_">write</span>(<span class="hljs-variable">eventInfo</span>).<span class="hljs-title function_">then</span>(() =&gt; {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, `<span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">success</span> <span class="hljs-variable">to</span> <span class="hljs-variable">write</span> <span class="hljs-variable">event</span>`)</li><li>  }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>    <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, `<span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`)</li><li>  });</li><li>})</li></ol></pre></div></div> <p></p></li><li><span>点击DevEco Studio界面中的运行按钮，运行应用工程，然后在应用界面中点击按钮“writeTest”，触发一次按钮点击事件打点。</span></li><li><span>可以在Log窗口看到按钮点击事件打点成功的日志，以及触发订阅回调后对打点事件数据的处理日志：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">success</span> <span class="hljs-variable">to</span> <span class="hljs-variable">write</span> <span class="hljs-variable">event</span></li><li><span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">eventPkg</span>.<span class="hljs-variable">packageId</span>=<span class="hljs-number">0</span></li><li><span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">eventPkg</span>.<span class="hljs-variable">row</span>=<span class="hljs-number">1</span></li><li><span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">eventPkg</span>.<span class="hljs-variable">size</span>=<span class="hljs-number">124</span></li><li><span class="hljs-variable">HiAppEvent</span> <span class="hljs-variable">eventPkg</span>.<span class="hljs-variable">info</span>={<span class="hljs-string">"domain_"</span>:<span class="hljs-string">"button"</span>,<span class="hljs-string">"name_"</span>:<span class="hljs-string">"click"</span>,<span class="hljs-string">"type_"</span>:<span class="hljs-number">4</span>,<span class="hljs-string">"time_"</span>:<span class="hljs-number">1670268234523</span>,<span class="hljs-string">"tz_"</span>:<span class="hljs-string">"+0800"</span>,<span class="hljs-string">"pid_"</span>:<span class="hljs-number">3295</span>,<span class="hljs-string">"tid_"</span>:<span class="hljs-number">3309</span>,<span class="hljs-string">"click_time"</span>:<span class="hljs-number">100</span>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section2194195218463">订阅应用事件（C/C++）<i class="anchor-icon anchor-icon-link" anchorid="section2194195218463" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section275716137474" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section275716137474" tips="复制节点链接"></i></h3><p>API接口的具体使用说明（参数使用限制、具体取值范围等）请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-hiappevent" target="_blank">HiAppEvent</a>。</p> <p><strong>订阅接口功能介绍：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>int OH_HiAppEvent_AddWatcher(HiAppEvent_Watcher * watcher)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>添加应用的事件观察者，以添加对应用的事件的订阅。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>int OH_HiAppEvent_RemoveWatcher(HiAppEvent_Watcher * watcher)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>移除应用的事件观察者，以移除对应用的事件的订阅。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>打点接口功能介绍：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>int OH_HiAppEvent_Write(const char * domain, const char * name, enum EventType type, const ParamList list)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>实现对参数为列表类型的应用事件打点。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section313112392470">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section313112392470" tips="复制节点链接"></i></h3><p>以实现对用户点击按钮行为的事件打点及订阅为例，说明开发步骤：</p> <ol><li><span>从<a href="https://github.com/open-source-parsers/jsoncpp" target="_blank">三方开源库jsoncpp代码仓</a>下载源码的压缩包，并按照README的Amalgamated source中介绍的操作步骤得到jsoncpp.cpp、json.h和json-forwards.h三个文件。新建Native C++工程，并将jsoncpp导入到新建工程内，目录结构如下：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>entry</li><li>└── <span class="hljs-attribute">src</span></li><li>    └── <span class="hljs-selector-tag">main</span></li><li>        ├── cpp</li><li>        │   ├── CMakeLists<span class="hljs-selector-class">.txt</span></li><li>        │   ├── json</li><li>        │   │   ├── json-forwards<span class="hljs-selector-class">.h</span></li><li>        │   │   └── json<span class="hljs-selector-class">.h</span></li><li>        │   ├── jsoncpp<span class="hljs-selector-class">.cpp</span></li><li>        │   ├── napi_init<span class="hljs-selector-class">.cpp</span></li><li>        │   └── types</li><li>        │       └── libentry</li><li>        │           ├── Index<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span></li><li>        │           └── oh-package<span class="hljs-selector-class">.json5</span></li><li>        └── ets</li><li>            ├── entryability</li><li>            │   └── EntryAbility<span class="hljs-selector-class">.ets</span></li><li>            └── pages</li><li>                └── Index<span class="hljs-selector-class">.ets</span></li></ol></pre></div></div> <p></p></li><li><span>编辑“CMakeLists.txt”文件，添加源文件及动态库：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li># 新增jsoncpp<span class="hljs-selector-class">.cpp</span>(解析订阅事件中的json字符串)源文件</li><li><span class="hljs-built_in">add_library</span>(entry SHARED napi_init.cpp jsoncpp.cpp)</li><li># 新增动态库依赖libhiappevent_ndk<span class="hljs-selector-class">.z</span><span class="hljs-selector-class">.so</span>和libhilog_ndk<span class="hljs-selector-class">.z</span><span class="hljs-selector-class">.so</span>(日志输出)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so libhiappevent_ndk.z.so)</li></ol></pre></div></div> <p></p></li><li><span>编辑“napi_init.cpp”文件，导入依赖的文件，并定义LOG_TAG：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"json/json.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hiappevent/hiappevent.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"testTag"</span></span></li></ol></pre></div></div> <p></p></li><li><span>订阅应用事件：</span><p></p><ul><li>OnReceive()类型观察者：编辑“napi_init.cpp”文件，定义OnReceive()类型观察者相关方法：</li></ul> <div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> HiAppEvent_Watcher *appEventWatcher;</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnReceive</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *domain, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> HiAppEvent_AppEventGroup *appEventGroups, <span class="hljs-type">uint32_t</span> groupLen)</span> </span>{</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; groupLen; ++i) {</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; appEventGroups[i].infoLen; ++j) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.domain=%{public}s"</span>, appEventGroups[i].appEventInfos[j].domain);</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.name=%{public}s"</span>, appEventGroups[i].appEventInfos[j].name);</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.eventType=%{public}d"</span>, appEventGroups[i].appEventInfos[j].type);</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(appEventGroups[i].appEventInfos[j].domain, <span class="hljs-string">"button"</span>) == <span class="hljs-number">0</span> &amp;&amp;</li><li>                <span class="hljs-built_in">strcmp</span>(appEventGroups[i].appEventInfos[j].name, <span class="hljs-string">"click"</span>) == <span class="hljs-number">0</span>) {</li><li>                Json::Value params;</li><li>                <span class="hljs-function">Json::Reader <span class="hljs-title">reader</span><span class="hljs-params">(Json::Features::strictMode())</span></span>;</li><li>                <span class="hljs-keyword">if</span> (reader.<span class="hljs-built_in">parse</span>(appEventGroups[i].appEventInfos[j].params, params)) {</li><li>                    <span class="hljs-keyword">auto</span> time = params[<span class="hljs-string">"click_time"</span>].<span class="hljs-built_in">asInt64</span>();</li><li>                    <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.params.click_time=%{public}lld"</span>, time);</li><li>                }</li><li>            }</li><li>        }</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RegisterWatcher</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    appEventWatcher = <span class="hljs-built_in">OH_HiAppEvent_CreateWatcher</span>(<span class="hljs-string">"onReceiverWatcher"</span>);</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *names[] = {<span class="hljs-string">"click"</span>};</li><li>    <span class="hljs-built_in">OH_HiAppEvent_SetAppEventFilter</span>(appEventWatcher, <span class="hljs-string">"button"</span>, <span class="hljs-number">0</span>, names, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_SetWatcherOnReceive</span>(appEventWatcher, OnReceive);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_AddWatcher</span>(appEventWatcher);</li><li>    <span class="hljs-keyword">return</span> {};</li><li>}</li></ol></pre></div></div> <ul><li>OnTrigger()类型观察者：编辑“napi_init.cpp”文件，定义OnTrigger()类型观察者相关方法：</li></ul> <div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> HiAppEvent_Watcher *appEventWatcher;</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnTake</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-type">const</span> *events, <span class="hljs-type">uint32_t</span> eventLen)</span> </span>{</li><li>    <span class="hljs-function">Json::Reader <span class="hljs-title">reader</span><span class="hljs-params">(Json::Features::strictMode())</span></span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; eventLen; ++i) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo=%{public}s"</span>, events[i]);</li><li>        Json::Value eventInfo;</li><li>        <span class="hljs-keyword">if</span> (reader.<span class="hljs-built_in">parse</span>(events[i], eventInfo)) {</li><li>            <span class="hljs-keyword">auto</span> domain = eventInfo[<span class="hljs-string">"domain_"</span>].<span class="hljs-built_in">asString</span>();</li><li>            <span class="hljs-keyword">auto</span> name = eventInfo[<span class="hljs-string">"name_"</span>].<span class="hljs-built_in">asString</span>();</li><li>            <span class="hljs-keyword">auto</span> type = eventInfo[<span class="hljs-string">"type_"</span>].<span class="hljs-built_in">asInt</span>();</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.domain=%{public}s"</span>, domain.<span class="hljs-built_in">c_str</span>());</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.name=%{public}s"</span>, name.<span class="hljs-built_in">c_str</span>());</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.eventType=%{public}d"</span>, type);</li><li>            <span class="hljs-keyword">if</span> (domain == <span class="hljs-string">"button"</span> &amp;&amp; name == <span class="hljs-string">"click"</span>) {</li><li>                <span class="hljs-keyword">auto</span> clickTime = eventInfo[<span class="hljs-string">"click_time"</span>].<span class="hljs-built_in">asInt64</span>();</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"HiAppEvent eventInfo.params.click_time=%{public}lld"</span>, clickTime);</li><li>            }</li><li>        }</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnTrigger</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> size)</span> </span>{</li><li>    <span class="hljs-built_in">OH_HiAppEvent_TakeWatcherData</span>(appEventWatcher, row, OnTake);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RegisterWatcher</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    appEventWatcher = <span class="hljs-built_in">OH_HiAppEvent_CreateWatcher</span>(<span class="hljs-string">"onTriggerWatcher"</span>);</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *names[] = {<span class="hljs-string">"click"</span>};</li><li>     <span class="hljs-built_in">OH_HiAppEvent_SetAppEventFilter</span>(appEventWatcher, <span class="hljs-string">"button"</span>, <span class="hljs-number">0</span>, names, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_SetWatcherOnTrigger</span>(appEventWatcher, OnTrigger);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_SetTriggerCondition</span>(appEventWatcher, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_AddWatcher</span>(appEventWatcher);</li><li>    <span class="hljs-keyword">return</span> {};</li><li>}</li></ol></pre></div></div> <p></p></li><li><span>编辑“napi_init.cpp”文件，添加button事件打点接口：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">WriteAppEvent</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-keyword">auto</span> params = <span class="hljs-built_in">OH_HiAppEvent_CreateParamList</span>();</li><li>    <span class="hljs-built_in">OH_HiAppEvent_AddInt64Param</span>(params, <span class="hljs-string">"click_time"</span>, <span class="hljs-built_in">time</span>(<span class="hljs-literal">nullptr</span>));</li><li>    <span class="hljs-built_in">OH_HiAppEvent_Write</span>(<span class="hljs-string">"button"</span>, <span class="hljs-string">"click"</span>, EventType::BEHAVIOR, params);</li><li>    <span class="hljs-built_in">OH_HiAppEvent_DestroyParamList</span>(params);</li><li>    <span class="hljs-keyword">return</span> {};</li><li>}</li></ol></pre></div></div> <p></p></li><li><span>编辑“napi_init.cpp”文件，将RegisterWatcher和WriteAppEvent注册为ArkTS接口：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"registerWatcher"</span>, <span class="hljs-literal">nullptr</span>, RegisterWatcher, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"writeAppEvent"</span>, <span class="hljs-literal">nullptr</span>, WriteAppEvent, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li></ol></pre></div></div> <p>编辑“index.d.ts”文件，定义ArkTS接口：</p> <div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">registerWatcher</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">writeAppEvent</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>;</li></ol></pre></div></div> <p></p></li><li><span>编辑“EntryAbility.ets”文件，在onCreate()函数中新增接口调用：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span></li><li>
</li><li>testNapi.<span class="hljs-title function_">registerWatcher</span>();</li></ol></pre></div></div> <p></p></li><li><span>编辑“Index.ets”文件，新增按钮触发打点事件：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span></li><li>
</li><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">"button_click"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  testNapi.<span class="hljs-title function_">writeAppEvent</span>();</li><li>})</li></ol></pre></div></div> <p></p></li><li><span>可以在Log窗口看到对应用事件数据的处理日志：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>HiAppEvent eventInfo.domain=button</li><li>HiAppEvent eventInfo.name=click</li><li>HiAppEvent eventInfo.eventType=<span class="hljs-number">4</span></li><li>HiAppEvent eventInfo.<span class="hljs-keyword">params</span>.click_time=<span class="hljs-number">1502031843</span></li></ol></pre></div></div> <p></p></li><li><span>移除应用事件观察者：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>static napi_value <span class="hljs-built_in">RemoveWatcher</span>(napi_env env, napi_callback_info info) {</li><li>    <span class="hljs-built_in">OH_HiAppEvent_RemoveWatcher</span>(appEventWatcher);</li><li>    return {};</li><li>}</li></ol></pre></div></div> <p></p></li><li><span>销毁应用事件观察者：</span><p></p><div _ngcontent-xkd-c106="" class="highlight-div"><div _ngcontent-xkd-c106="" class="highlight-div-header"><div _ngcontent-xkd-c106="" class="highlight-div-header-left"><div _ngcontent-xkd-c106="" class="handle-button expand-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xkd-c106="" class="highlight-div-header-right"><div _ngcontent-xkd-c106="" class="handle-button ai-button"></div><div _ngcontent-xkd-c106="" class="handle-button line-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xkd-c106="" class="handle-button theme-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xkd-c106="" class="handle-button copy-button"><div _ngcontent-xkd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xkd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">DestroyWatcher</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-built_in">OH_HiAppEvent_DestroyWatcher</span>(appEventWatcher);</li><li>    appEventWatcher = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">return</span> {};</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> </div> <div></div></div>