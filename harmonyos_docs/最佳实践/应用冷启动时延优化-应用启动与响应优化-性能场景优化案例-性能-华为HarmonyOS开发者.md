<h1 _ngcontent-duc-c119="" class="doc-title ng-star-inserted" title="应用冷启动时延优化"> 应用冷启动时延优化 </h1>

<div _ngcontent-duc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section1235404851116">概述<i class="anchor-icon anchor-icon-link" anchorid="section1235404851116" tips="复制节点链接"></i></h2>          <p>应用启动时延是影响用户体验的关键要素，是指从用户点击桌面应用图标、通知或其他入口启动应用，到应用界面内容成功加载并显示在屏幕上的时间间隔。如果这段时间超过3秒，将显著影响用户体验。</p>     <p>应用启动可以分为冷启动和热启动。当应用启动时，后台没有该应用的进程，系统会重新创建应用的进程，这种启动方式就叫做<strong>冷启动</strong>。而<strong>热启动</strong>是当应用程序已经在后台运行，用户再次打开应用程序时，应用程序仍然在内存中，可以直接从内存中加载并继续之前的状态，而不需要重新初始化和加载资源。</p>     <p>当应用冷启动时延大于1100ms时，可以认为是应用启动缓慢，体验标准可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-smooth-application-design">应用流畅体验设计</a>。</p>     <p>本文将介绍以下内容，帮助开发者提升应用的冷启动速度，避免启动过程中的延迟。</p>     <ul>      <li><a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section196451814101216">应用冷启动流程</a></li>      <li><a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section860412154015">应用冷启动时延检测</a></li>      <li><a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section167931444111612">应用冷启动时延问题分析</a></li>      <li><a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section8516174361218">识别启动缓慢问题</a></li>      <li><a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section1770316268136">提升应用冷启动速度</a></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section196451814101216">应用冷启动流程<i class="anchor-icon anchor-icon-link" anchorid="section196451814101216" tips="复制节点链接"></i></h2>          <p>优化应用冷启动体验前，了解应用冷启动的流程和重要生命周期。应用冷启动分为5个阶段：应用进程创建&amp;初始化、Application&amp;Ability初始化、Ability/AbilityStage生命周期、加载绘制首页、网络数据二次刷新。</p>     <div class="fignone">      <span class="figcap"><b>图1 </b>应用冷启动流程</span>      <p><span><img height="101.79846666553507" originheight="183" originwidth="1898" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.81497410257139692944590753432757:50001231000000:2800:2A8E2CDCDB4DC8FC17B259429CECC53D5B916475FB543534C4378338BA75EDDB.png" title="点击放大" width="920"></span></p>     </div>     <ol>      <li>应用进程创建和初始化阶段：此阶段系统完成应用进程的创建和初始化，包括启动页图标（startWindowIcon）的解码。</li>      <li>Application和Ability初始化：该阶段包括资源加载、虚拟机创建、Application&amp;Ability 对象的创建与初始化、依赖模块加载等。</li>      <li>Ability/AbilityStage 生命周期：此阶段主要涉及 AbilityStage/Ability 的启动，执行相应的生命周期回调。</li>      <li>加载首页内容，测量布局，刷新组件并绘制。</li>      <li>网络数据二次刷新：此阶段应用根据业务需求对网络数据进行请求、处理和刷新。</li>     </ol>     <p>若要提升应用冷启动速度，需缩短上述阶段的耗时。</p>    </div>    <div class="tiledSection">     <h2 id="section860412154015">应用冷启动时延检测<i class="anchor-icon anchor-icon-link" anchorid="section860412154015" tips="复制节点链接"></i></h2>          <p>在应用开发中，网络请求时机、图片下载、页面资源加载、依赖模块的加载等，都会导致应用冷启动时延受到影响，合理处理代码逻辑可以提升应用冷启动速度。开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-performance-detection#section135451444171" target="_blank">AppAnalyzer</a>对应用冷启动进行检测，针对诊断出的应用冷启动不达标问题进行分析和优化。</p>    </div>    <p>应用冷启动时延检测步骤如下：</p>    <ol>     <li>选择entry模块，暂时关闭模块build-profile中的混淆开关。      <p><span><img height="152.6175" originheight="423" originwidth="1445" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163411.35839046493796681980551753934736:50001231000000:2800:68D92D30CE7A4FEBEC9A66C89D1EF95CE7C6909B1CE4BFCD3EA5A5A578B093EA.png" title="点击放大" width="523.6875"></span></p></li>     <li>检查一下build模式，改为release。      <p><span><img originheight="325" originwidth="512" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.63213135849856567997231444509853:50001231000000:2800:851671B8B91BD56E3E1FF69D0015876655117ECE71587C2DA1474775EBF2B0B6.png" width="512" height="325"></span></p></li>     <li>点击菜单 -&gt; tool -&gt; AppAnalyzer，打开体检工具。</li>     <li>选择“场景化体检”，点击“手动性能冷启动体检”。      <p>工具开始准备，会自动编译、安装、运行当前工程，此时需要“保持手机解锁状态”，当准备完成后，会提示点击开始按钮，开始体检。</p>      <p><span><img height="519.3384000000001" originheight="811" originwidth="1036" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.52020966290866651989324222014350:50001231000000:2800:E3442DE583102C6B74CB342A94AF6ED0E1E60640187DA9BC4FE0448A22288DFE.png" title="点击放大" width="665"></span></p></li>     <li>根据提示在设备上进行手动操作：      <ol>       <li>首先，在最近任务列表关闭应用。</li>       <li>进入手机设置 ，在顶部搜索栏中输入应用名并，点击进入应用设置界面，如果该应用还有进程存活，在应用设置界面可以点击强行停止按钮。</li>       <li>在桌面点击应用图标重新启动应用。</li>       <li>点击“结束”按钮停止体检任务，体检工具会将刚才的操作数据进行解析。</li>      </ol></li>    </ol>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>冷启动体检需要强行停止应用：</p>      <ol>       <li>进入手机设置。</li>       <li>在顶部搜索栏中输入应用名并点击进入应用设置界面。</li>       <li>在应用设置界面点击强行停止。</li>       <li>在桌面启动待检测的应用。</li>      </ol>     </div></div></div>    <div class="tiledSection">     <h2 id="section167931444111612">应用冷启动时延问题分析<i class="anchor-icon anchor-icon-link" anchorid="section167931444111612" tips="复制节点链接"></i></h2>          <p>AppAnalyzer详情报告中会显示动态检测可能导致冷启动完成时延不达标的故障原因，并提供相应的优化建议，此处列举以下冷启动时延不达标问题原因进行说明：</p>    </div>    <div class="tiledSection">     <h3 id="section1085655213190" class="firsth2"><strong>高耗时非UI操作</strong><i class="anchor-icon anchor-icon-link" anchorid="section1085655213190" tips="复制节点链接"></i></h3>          <p>高耗时函数可能会造成应用卡顿，对于执行次数较多的函数，应尽量减少调用次数，单次执行但总耗时较高的函数，可以考虑通过异步方式进行优化。</p>     <p>在检测结果中，开发者可以通过点击报告表格中的对应方法名，快速跳转至对应代码片段，同时体检工具也会给出相应的优化建议，如将耗时函数放到子线程或进行缓存、使用多线程能力等，详细流程及示例可参考文档：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-time-optimization-of-the-main-thread#section4365993361" target="_blank">主线程耗时操作优化--其他主线程优化思路</a>。</p>     <p><span><img height="140.5943" originheight="378" originwidth="1781" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.26773943184940375947702990512135:50001231000000:2800:3FEE283225256DBB4FAAD3273610C0DC7779DAD7C608478DE4EF206CA8793514.png" title="点击放大" width="665"></span></p>    </div>    <div class="tiledSection">     <h3 id="section16955857103112"><strong>import加载耗时</strong><i class="anchor-icon anchor-icon-link" anchorid="section16955857103112" tips="复制节点链接"></i></h3>          <p>体检工具可以检测出应用冷启动过程中累计加载的文件数量、未使用的文件数量和加载总耗时，开发者可参考以下优化思路和流程，对此类冷启动问题进行优化。</p>     <p><strong>import加载耗时问题优化思路</strong></p>     <p><span><img height="70.9289" originheight="832" originwidth="7691" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.55236168658892479525431068553425:50001231000000:2800:DEA2E77CBCBB0926B187FADB39B149CE9FBBDCDFE90B879FAA39F74A3C0F894F.png" title="点击放大" width="665"></span></p>     <ol>      <li>分析模块使用情况：查看总结信息和未使用文件import列表信息，包括加载文件总耗时，和未使用文件数量和总耗时，了解未使用文件import情况。</li>      <li>查找依赖关系优化导入：点击第一个“下载”按钮下载全量依赖关系文件，使用调用链搜索框查找未使用文件依赖关系，结合代码逻辑对未使用文件进行延迟加载。</li>      <li>标记优化状态：点击第二个“下载”按钮下载全量import清单文件，统计已优化和未优化的未使用文件，分析全量文件的依赖关系。</li>      <li>再次进行冷启动检测：优化耗时最多的几个文件之后，再次进行冷启动检测，验证整改收益。在逐步优化未使用文件导入的过程中，收益会逐步降低，开发者需根据实际情况是否需要继续“lazy import”的整改。</li>     </ol>     <p><span><img height="186.20000000000002" originheight="337" originwidth="1197" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.97260769237150449789081904906145:50001231000000:2800:0A2813168E8ECEA3D76647DA9DAFCDC21D54E6B01645F3EA3703C5CD847F59E8.png" title="点击放大" width="665"></span></p>     <p><strong>import加载耗时问题优化流程</strong></p>     <p><span><img height="462.84000000000003" originheight="3176" originwidth="3591" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.56183506587983094504213470631119:50001231000000:2800:0F865FCE96049708E837996B48F36A748B1135143F4312DCE7EA5530676C5FC4.png" title="点击放大" width="523.6875"></span></p>     <ol>      <li>查找耗时最高的未使用import文件。       <p>在本地浏览器中打开下载的依赖关系的文件full_dependency.html，视图中左侧列表表示已加载未使用的文件，并且按照耗时从高到低排序；右侧表示已使用文件，开发者需要关注未使用文件中耗时较多的几个文件导入，例如DetailView文件的导入。</p>       <p><span><img height="215.32700000000003" originheight="620" originwidth="1905" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.14297533110509141591132449625945:50001231000000:2800:715B79C847E1DF87C8F1F34BDEDCD110CC3933A18637D33CC03E1361C2FEF47E.png" title="点击放大" width="665"></span></p></li>      <li>根据文件名检索文件调用关系链。       <p>在搜索框中通过文件名DetailView进行检索，该文件的依赖关系则会在下方节点视图中展示，并且默认会展示其子节点的使用情况，未使用的文件会被标红显示。</p>       <p><span><img height="82.327" originheight="239" originwidth="1903" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.52895336883975539914804220960128:50001231000000:2800:7726E62655767BE6E4A5F60D9F3F3C4DD4B57C3AD23494FCAC719E1D0C2C5FAD.png" title="点击放大" width="665"></span></p></li>      <li>查看检索文件的上层和下层文件节点信息。       <p>查找上层文件节点信息，即目标文件被导入的位置；查找下层文件节点信息，目标文件的耗时是否由其子节点导致，如果下层文件耗时较长，则需要考虑优化子节点的导入。</p>       <p><span><img height="81.0635" originheight="234" originwidth="1905" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.37467273088250772362418036344181:50001231000000:2800:778932DFF38927AB3DAC5A38CC31FFCACB43516AA73B26E07EE49F6BBA9BE405.png" title="点击放大" width="665"></span></p></li>      <li>判断上层文件是否为为其他module的Index.ets文件导出。       <ul>        <li>如果上层文件不为其他module的统一对外暴露接口文件（例如Index.ets），则可以在上层文件中使用对该模块使用lazy import进行优化。         <div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> lazy { <span class="hljs-title class_">DetailView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../view/DetailView'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>        <li>如果上层文件为其他module的统一对外暴露接口文件（例如Index.ets），则需要通过import路径展开性能优化。         <p>例如CustomLayout1上层模块为library模块的Index.ets，其中有多个文件导出。</p>         <p><span><img height="108.927" originheight="190" originwidth="1149" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.57024082702545348149538426242772:50001231000000:2800:711643840ED312F0ADE090FF6380F50F0A149650034A32F2E44C7D4FE8CD22CF.png" title="点击放大" width="665"></span></p>         <p>在Entry的首页通过依赖对应模块引入，会导致冷启动阶段将CustomLayout2和CustomLayout3等冷启动阶段无用的文件导入。</p>         <div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/Index.ets</span></li><li><strong><span class="hljs-keyword">import</span> </strong>{ <span class="hljs-title class_">CustomLayout1</span> } <strong><span class="hljs-keyword">from</span> </strong><span class="hljs-string">'library'</span>;</li></ol></pre></div></div>         <p>具体优化方案，则是通过在import时，对路径展开进而优化性能。</p>         <div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/Index.ets</span></li><li><strong><span class="hljs-keyword">import</span></strong> { <span class="hljs-title class_">CustomLayout1</span> } <strong><span class="hljs-keyword">from</span> </strong><span class="hljs-string">'library/src/main/ets/pages/CustomLayout1'</span>;</li></ol></pre></div></div></li>       </ul></li>      <li>在导出文件中标记已修改的文件。       <p>在下载全量import文件清单表格中，标记已优化的未使用文件，便于优化备忘，特别是当需要优化的文件比较多的时候。</p>       <p><span><img height="173.5384" originheight="404" originwidth="1547" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163412.70971435824404150045685394056327:50001231000000:2800:25B2253B99C162C6E1EB5D76351EB31A2060B4002F414E324BF7320F4092F28B.png" title="点击放大" width="665"></span></p></li>      <li>重新进行冷启动场景化检测。       <p>当优化完成后，重新进行冷启动场景化检测，查看优化收益是否达到预期，如未达到预期，则需要重新进行分析优化。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section590864514325"><strong>网络请求耗时</strong><i class="anchor-icon anchor-icon-link" anchorid="section590864514325" tips="复制节点链接"></i></h3>          <p>应用首页内容需要通过网络请求获取数据并显示时，网络请求耗时和网络请求发起的时机，对应用冷启动时长会产生一定影响。使用AppAnalyzer能够检测出应用中请求URL的请求耗时和点击离手到请求发起间隔。</p>     <ul>      <li>网络请求本身耗时长       <p><span><img height="190.00380000000004" originheight="258" originwidth="899" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.97635569563975290165805633108297:50001231000000:2800:89B99D32845ACACA436EADA645AADCC6E3B8719101F29D899BFBC8BB02C98FED.png" title="点击放大" width="665"></span></p>       <p>网络请求本身是否耗时可通过检测结果中的请求耗时时长来进行判断，时间越长，则网络请求本身耗时越久。详细分析请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-profiler-network" target="_blank">网络诊断：Network分析</a>。</p>       <p>网络请求本身耗时长，可对该URL请求进行预连接和预解析来优化网络传输速度，提前完成DNS查询和TCP/TLS握手，即在应用启动或空闲时提前建立并维护一个持久的连接池；还可以使用CDN来优化网络传输速度，即将静态资源部署到CDN上。</p></li>      <li>网络请求发起太晚       <p><span><img height="188.727" originheight="256" originwidth="902" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.39082956760457804002483089711408:50001231000000:2800:096BFDA042DC98AA92B8A1413135B960A2243E5CB005ED5ACFEDE0C12D2A8BAB.png" title="点击放大" width="665"></span></p>       <p>点击离手到请求发起间隔则表示用户进行点击操作后，到真正向服务器发起网络请求的那一刻止，这中间所经过的时间。可通过检测结果中的点击离手到请求发起间隔时长来进行判断，时间越长，则表示网络请求发起的越晚。可通过提前发起网络请求，来进行优化。可参考：<a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section199911250658">网络请求提前发送</a>。</p></li>     </ul>     <p>如果开发者既无法优化网络请求本身耗时，也无法将网络请求提前发起，可以考虑提前将网络请求数据缓存，下次冷启动时候直接加载缓存数据，再通过发送网络请求二刷刷新数据。</p>    </div>    <div class="tiledSection">     <h3 id="section164049152335"><strong>首页组件复杂度高导致构建耗时</strong><i class="anchor-icon anchor-icon-link" anchorid="section164049152335" tips="复制节点链接"></i></h3>          <p>首页组件复杂度较高会影响首页加载绘制耗时，AppAnalyzer工具能检测出页面中组件自身创建是否耗时过长。</p>     <p><span><img height="290.07300000000004" originheight="447" originwidth="1023" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.04352579487093948812862331567324:50001231000000:2800:10D8DFE9C378A9E8AFD9E4F570244F2BD2D19867532EAE4489C0B47F5D238992.png" title="点击放大" width="665"></span></p>     <p>在静态检测可能故障原因表格中，可点击源文件定位到创建耗时的UI组件，根据提供的可能故障原因，去对UI组件进行相应优化修改，即可减少该UI组件自身创建耗时。</p>     <p>开发者可采用以下方式，控制UI的渲染范围，防止页面卡顿或掉帧：</p>     <ul>      <li><strong>合理控制元素显示与隐藏</strong>       <p>在应用开发中，控制页面元素的显示与隐藏是一种常见的场景，通过Visibility.None、if条件判断等都能够实现该效果。visibility属性可以控制元素在布局阶段是否参与布局渲染，if条件判断控制的是组件的创建、布局阶段。</p></li>      <li><strong>懒加载</strong>       <p>懒加载LazyForEach是一种延迟加载的技术，通常应用于长列表优化、瀑布流优化等数据量较大、子组件可重复使用的场景，当用户滚动页面到相应位置时，才会触发资源的加载，以减少组件的加载时间，提高应用性能，提升用户体验。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="section1833373711103"><strong>异步线程阻塞主线程</strong><i class="anchor-icon anchor-icon-link" anchorid="section1833373711103" tips="复制节点链接"></i></h3>          <p>当主线程长时间等待子线程或异步函数返回，会造成主线程长时间被阻塞，可能导致时延不达标的情况。体检工具会对主线程长时间被阻塞进行检测，可以根据检测结果中主线程空闲时间判断主线程是否长时间被阻塞，空闲时间越长，则阻塞时间越久，详细请参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-click-to-complete-delay-analysis#section73671398291">主线程长时间被阻塞</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section8516174361218">识别启动缓慢问题<i class="anchor-icon anchor-icon-link" anchorid="section8516174361218" tips="复制节点链接"></i></h2>          <p>开发者需要分析启动过程的耗时瓶颈，优化应用或服务的冷启动速度时，可使用Profiler的Launch场景分析功能，录制启动过程中的关键数据，识别启动缓慢的原因。Profiler Launch可拆解应用冷启动过程，抓取各阶段的耗时数据，帮助开发者快速分析冷启动过程的耗时瓶颈。Launch的具体使用方法参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-launch-overview" target="_blank">冷启动分析：Launch分析</a>。</p>     <p>已录制一段Launch任务，具体操作步骤请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-recording" target="_blank">性能问题定位：深度录制</a>。</p>     <p><span><img height="209.72933333333333" originheight="425" originwidth="1864" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.22068224772953140293274612890648:50001231000000:2800:0C6A240072230B6328FFCD922D8654CAD2CBC76A2E999D1BBFB1DEA8FAD57C2E.png" title="点击放大" width="920"></span></p>     <p>上图显示，Launch将应用的冷启动过程分为以下几个阶段：</p>     <ol>      <li>Create Process：应用进程创建阶段，对应的trace打点为AbilityManagerService::StartAbility。</li>      <li>Application Launching：应用启动阶段，对应的trace打点为AppMgrServiceInner::AttachApplication##{bundleName}。</li>      <li>UIAbility Launching：UIAbility启动阶段，对应的trace打点为MainThread::HandleLaunchAbility##{bundleName}。</li>      <li>UI Ability OnForeground：应用进入前台阶段，对应的 trace 打点为 AbilityThread::HandleAbilityTransaction。</li>      <li>First Frame - App Phase：App首帧渲染提交阶段，对应的trace打点为H:ReceiveVsync，H:MarshRSTransactionData。</li>      <li>First Frame - Render Phase：RS首帧渲染提交阶段，对应的trace打点为H:ReceiveVsync和H:RSMainThread::ProcessCommandUni。</li>      <li>EntryAbility：应用启动之后的阶段，渲染完成，首页显示。</li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>阶段1对应图1中的第1阶段，阶段2对应图1中的第2阶段，阶段3和4对应图1中的第3阶段，阶段5和6对应图1中的第4阶段，阶段7对应图1中的第5阶段。</p>      </div></div></div>     <p></p>     <p><span><img height="232.46355555555556" originheight="471" originwidth="1864" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.77755157413996902518218490184483:50001231000000:2800:05743CBF2262674C020FB919508D84EF2CCB628A462C10A426890086BC8DF9F5.png" title="点击放大" width="920"></span></p>     <p><strong>冷启动缓慢示例分析</strong></p>     <p>运行以下示例代码，开发者可以明显感知到应用启动速度较慢。接下来，开发者可以通过此示例，结合 Launch 分析应用冷启动缓慢的问题。</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSlow.ets#L17-L47" data-highlighted="yes"><ol class="linenums"><li>const LARGE_NUMBER: number = <span class="hljs-number">200000000</span>;</li><li>
</li><li><span class="hljs-keyword">@Entry</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">message</span>: string = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-built_in">aboutToAppear</span>(): void {</li><li>    console<span class="hljs-selector-class">.log</span>('aboutToAppear');</li><li>    this<span class="hljs-selector-class">.computeTask</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">computeTask</span>(): void {</li><li>    let count: number = <span class="hljs-number">0</span>;</li><li>    while (count &lt; LARGE_NUMBER) {</li><li>      count++;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Row</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        Text(this.message)</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)</li><li>          <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)</li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSlow.ets#L17-L47" target="_blank">ColdStartSlow.ets</a></div></div></div></div>     <p>首先创建Launch分析录制，可以观察到整个启动时间较长。UI Ability OnForeground阶段在应用冷启动过程中耗时最多，达到了3.3秒。因此，需要重点分析该阶段的耗时。</p>     <p><span><img height="200.77850000000004" originheight="378" originwidth="1732" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.15737794084217893315323890825439:50001231000000:2800:EB2C473D27472AE2F38AFE5C53E86E4782CA712DCB148B3D64DBE2764F777A57.png" title="点击放大" width="920"></span></p>     <p>针对应用冷启动问题的性能分析，可以选择分析主线程的Trace数据或采样得到的函数热点。</p>     <p><strong>分析主线程的Trace数据</strong></p>     <p><span><img height="399.74000000000007" originheight="670" originwidth="1542" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.23065123804501673824488121998732:50001231000000:2800:33D036283FECF859850CD93CEAF652BD5AD1E161FA081FF210C695837C9FF487.png" title="点击放大" width="920"></span></p>     <ol>      <li>单击“Launch”泳道上的UI Ability OnForeground阶段，在下方“Details”面板中可查看所选阶段的耗时统计。</li>      <li>展开UI Ability OnForeground统计信息折叠表，可查看各函数的具体耗时信息。</li>      <li>根据Duration找到耗时最长的函数aboutToAppear。</li>      <li>单击图标按钮，可直接跳转至主线程的打点任务，查看相关Trace数据。</li>     </ol>     <p><span><img height="305.026" originheight="618" originwidth="1864" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.53899261636734237285532527727368:50001231000000:2800:C32B9F735800F5E74B85F766A01C70EC1E886DC1415FA8ACCF114B16AD751CA8.png" title="点击放大" width="920"></span></p>     <p>在UI Ability OnForeground阶段的耗时主要由aboutToAppear引起。通过分析aboutToAppear中的代码逻辑，可以确定计算任务computeTask是导致耗时的原因。</p>     <p><strong>分析采样得到的函数热点</strong></p>     <p>开发者也可以分析采样得到的函数热点直观的显示应用冷启动过程中具体函数的耗时，如下图：</p>     <p><span><img height="363.37700000000007" originheight="737" originwidth="1866" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.11214591457156218019509347506574:50001231000000:2800:3BECCC7B530333A5CF374764277DF86CBAB0F7D7C93EC4314C4FCEA0151114EC.png" title="点击放大" width="920"></span></p>     <ol>      <li>单击“Launch”泳道的UI Ability OnForeground阶段。</li>      <li>选择“ArkTS Callstack”泳道，它会基于时间轴展示CPU使用率和状态变化，以及当前调用栈名称和类型。</li>      <li>在“Details”详情面板中，可以查看这段时间内的函数热点，以Top-Down形式的树状列表展示。computeTask函数在aboutToAppear函数中耗时最多，占整个阶段的97.9%。双击该函数可跳转到源码。</li>      <li>此外，点击底部Flame Chart按钮打开火焰图可以更直观的看出热点函数的耗时情况，如下图所示。</li>     </ol>     <p><span><img height="346.7044" originheight="737" originwidth="1866" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.76651135267927405659100226409484:50001231000000:2800:07F693DB4121070DC1A09B7119D8D72A4E94FE73425B66EFF24689EA28D5BE9C.png" title="点击放大" width="877.8000000000001"></span></p>     <p><strong>冷启动速度优化</strong></p>     <p>通过前面的分析，冷启动缓慢的原因是在aboutToAppear方法中执行了耗时计算任务。可以将computeTask以异步延时的方式处理，优化后的代码如下：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSpeedOptimization.ets#L17-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">LARGE_NUMBER</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">100000000</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DELAYED_TIME</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1000</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">message</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToAppear'</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">computeTaskAsync</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">computeTask</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">count</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">count</span> &lt; <span class="hljs-title class_">LARGE_NUMBER</span>) {</li><li>      <span class="hljs-variable">count</span>++;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Asynchronous processing of operation tasks</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTaskAsync</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">setTimeout</span>(() =&gt; { <span class="hljs-comment">// SetTimeout is used here to realize asynchronous delayed operation.</span></li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">computeTask</span>();</li><li>    }, <span class="hljs-variable">DELAYED_TIME</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSpeedOptimization.ets#L17-L57" target="_blank">ColdStartSpeedOptimization.ets</a></div></div></div></div>     <p>重新编译并运行程序，录制Launch过程。优化后，UI Ability OnForeground阶段的耗时显著缩短，如下图所示：</p>     <p><span><img height="203.83111111111108" originheight="413" originwidth="1864" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.02952291985226821259341648445729:50001231000000:2800:729CBD258AD69C97EE9E0C954DE927441B8954DFB17ADAB91970C09645B0A863.png" title="点击放大" width="920"></span></p>     <p><strong>查看首帧卡顿</strong></p>     <p>为了识别首帧是否卡顿，可以先查看Launch的Frame泳道。应用的首帧渲染提交在First Frame - App Phase阶段，APP侧的这一帧表示应用渲染的首帧。如下图所示，此处首帧为36号帧。</p>     <p><span><img height="239.45555555555555" originheight="481" originwidth="1848" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.31372247992549731152424995084356:50001231000000:2800:8ADECEE13FA4D753F1A8487D5DC9AC5EE586037DB336E5ECF870DA2734E8C6D3.png" title="点击放大" width="920"></span></p>     <p>如上所示36号帧被标记为了红色，表示首帧出现了卡顿。鼠标左键36号帧，可以看到它的期望提交渲染时间为左边白色竖线区域所示，这里出现了比较严重的延时。发现问题后，开发者可以参考前面讲到的示例进行问题定位和优化。</p>    </div>    <div class="tiledSection">     <h2 id="section1770316268136">提升应用冷启动速度<i class="anchor-icon anchor-icon-link" anchorid="section1770316268136" tips="复制节点链接"></i></h2>          <p>本文将通过公共类优化的方法，包括<a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section1351981113010">非冷启动必须的服务或模块延迟加载</a>、<a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section17543719239">减少主线程非UI耗时操作</a>和<a href="/consumer/cn/doc/best-practices/bpta-application-cold-start-optimization#section199911250658">网络请求提前发送</a>，以及结合应用启动的几个阶段分别介绍提升应用冷启动速度的相关方法。</p>    </div>    <div class="tiledSection">     <h3 id="section1351981113010" class="firsth2">非冷启动必须的服务或模块延迟加载<i class="anchor-icon anchor-icon-link" anchorid="section1351981113010" tips="复制节点链接"></i></h3>          <p>应用在启动前加载过多不必要启动项，同时这些启动项在主线程串行执行，该阶段耗时为450ms。</p>     <p><span><img height="334.67814100000004" originheight="600" originwidth="1470" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.74811746161401879527349279510605:50001231000000:2800:6C1F4159D8411755E5B80D3E03E0DE34BC3EBD33252BDD05C858B732709AC6F5.png" title="点击放大" width="808.9725000000001"></span></p>     <p>应用冷启动过程中，加载不必要的启动项会增加冷启动时间。建议延后加载或并行处理，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-arkts-high-performance#section12861143418213" target="_blank">延迟加载Lazy-Import使用指导</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section17543719239">减少主线程非UI耗时操作<i class="anchor-icon anchor-icon-link" anchorid="section17543719239" tips="复制节点链接"></i></h3>          <p>在应用启动流程中，主要聚焦在执行UI相关操作中，为了更快的显示首页内容，不建议在主线程中执行非UI相关的耗时操作，建议通过异步任务进行异步处理或放到其他子线程中执行，线程并发方案详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-comparative_practice_of_taskpool_and_worker">TaskPool和Worker的对比实践</a>。</p>     <p>在冷启动过程中如果存在图片下载、网络请求前置数据、数据反序列化等非UI操作，开发者可以根据实际情况移至子线程中进行，详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-app-concurrency-design">应用并发设计</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section199911250658">网络请求提前发送<i class="anchor-icon anchor-icon-link" anchorid="section199911250658" tips="复制节点链接"></i></h3>          <p>当前大多数应用的首页内容需从网络获取，发送网络请求的时机显得尤为重要。应用发送网络请求后等待网络数据的返回，网络请求的这段时间应用可以继续执行启动流程，直到网络数据返回后进行解析，反序列化之后就可以加载首页数据，因此网络请求的发起时机越早，整个冷启动的完成时延阶段越短。</p>     <p>将网络请求及初始化流程放置在AbilityStage/UIAbility的onCreate()生命周期中。仅执行网络相关预处理。等待网络请求发送后继续执行首页数据准备和UI操作。在服务端处理相同的情况下，应用可以更早获取网络数据并行展示。</p>     <div class="fignone">      <span class="figcap"><b>图2 </b>应用首页框架加载时进行网络数据请求</span>     </div>     <p><span><img height="284.2875" originheight="1489" originwidth="2738" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.73504491816060956099691586460515:50001231000000:2800:C819ADF7E952F224924384BB8CB9D64B334512E82C593CB6860B18E47C264E6B.png" title="点击放大" width="523.6875"></span></p>     <p>将网络请求提前至AbilityStage/UIAbility的onCreate()生命周期回调函数中。这可以将首刷或二刷时间提前，减少用户等待时间。为了体现性能收益，将网络请求放到了更早的AbilityStage的onCreate()生命周期回调中。</p>     <div class="fignone">      <span class="figcap"><b>图3 </b>网络请求提前至AbilityStage的onCreate()生命周期回调中</span>     </div>     <p><span><img height="261.345" originheight="1369" originwidth="2738" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163413.27883612704176066684816021237140:50001231000000:2800:B88262CF73BE12AF801845ECBCF5F2C00844E7A2C05039708C308C8298F710D4.png" title="点击放大" width="523.6875"></span></p>     <div class="p">      【优化前】：在首页根组件的onAppear()回调中发起网络请求。      <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/Index.ets#L17-L49" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { httpRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/NetRequest'</span>;</li><li>
</li><li><span class="hljs-keyword">import</span> { <span class="hljs-built_in">number</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/Calculator'</span>;</li><li>
</li><li><span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">link</span>(<span class="hljs-string">'netData'</span>);</li><li><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'netData'</span>, <span class="hljs-literal">undefined</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// In order to reflect the performance benefits, refer to the execution result number of the time-consuming function.</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span> + <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'netData'</span>) <span class="hljs-attr">netData</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">32</span>)</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">netData</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-comment">// Send a network request</span></li><li>      <span class="hljs-title function_">httpRequest</span>();</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/Index.ets#L17-L49" target="_blank">Index.ets</a></div></div></div></div>      <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/NetRequest.ets#L2-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NetRequest.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hiTraceMeter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">http</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-comment">// Download picture resources from the Internet through the http request method</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">httpRequest</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-variable">hiTraceMeter</span>.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'Http Request'</span>, <span class="hljs-number">1</span>);</li><li>  <span class="hljs-variable">http</span>.<span class="hljs-title function_">createHttp</span>()</li><li>  <span class="hljs-comment">// The actual development needs to "https://www.example1.com/POST?e=f&amp;g=h"replaced with the real website address to visit</span></li><li>    .<span class="hljs-title function_">request</span>(<span class="hljs-string">'https://www.example1.com/POST?e=f&amp;g=h'</span>,</li><li>      (<span class="hljs-variable">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">error</span>) {</li><li>          <span class="hljs-comment">// The follow-up logic is not executed when the download fails.</span></li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-comment">// Processing the data returned by network requests</span></li><li>        <span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>);</li><li>      }</li><li>    )</li><li>}</li><li>
</li><li><span class="hljs-comment">// Use createPixelMap to replace pictures of ArrayBuffer types with PixelMap types.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">http</span>.<span class="hljs-variable">ResponseCode</span>.<span class="hljs-variable">OK</span> === <span class="hljs-variable">data</span>.<span class="hljs-variable">responseCode</span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageData</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-variable">data</span>.<span class="hljs-variable">result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">ArrayBuffer</span>;</li><li>    <span class="hljs-comment">// Create a picture source instance through ArrayBuffer</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageSource</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">imageData</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">InitializationOptions</span> = {</li><li>      <span class="hljs-string">'alphaType'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// Transparency</span></li><li>      <span class="hljs-string">'editable'</span>: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// Is it editable?</span></li><li>      <span class="hljs-string">'pixelFormat'</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// Pixel format</span></li><li>      <span class="hljs-string">'scaleMode'</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// Abbreviation</span></li><li>      <span class="hljs-string">'size'</span>: { <span class="hljs-variable">height</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">width</span>: <span class="hljs-number">100</span> }</li><li>    }; <span class="hljs-comment">// Create the size of the picture</span></li><li>    <span class="hljs-comment">// Create PixelMap through properties</span></li><li>    <span class="hljs-variable">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>(<span class="hljs-variable">options</span>).<span class="hljs-title function_">then</span>((<span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">PixelMap</span>) =&gt; {</li><li>      <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'netData'</span>, <span class="hljs-variable">pixelMap</span>);</li><li>      <span class="hljs-variable">hiTraceMeter</span>.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'Http Request'</span>, <span class="hljs-number">1</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/NetRequest.ets#L2-L45" target="_blank">NetRequest.ets</a></div></div></div></div>      <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/Calculator.ets#L2-L13" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Calculator.ets</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">LARGE_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">100000000</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">computeTask</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">while</span> (count &lt; <span class="hljs-variable constant_">LARGE_NUMBER</span>) {</li><li>    count++;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> count;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> <span class="hljs-built_in">number</span> = <span class="hljs-title function_">computeTask</span>();</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/Calculator.ets#L2-L13" target="_blank">Calculator.ets</a></div></div></div></div>     </div>     <p></p>     <p>【优化后】</p>     <ol>      <li>在NetRequest.ets中进行网络请求以及数据处理。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/NetRequest.ets#L3-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NetRequest.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hiTraceMeter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">http</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-comment">// Download picture resources from the Internet through the http request method</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">httpRequest</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-variable">hiTraceMeter</span>.<span class="hljs-title function_">startTrace</span>(<span class="hljs-string">'Http Request'</span>, <span class="hljs-number">1</span>);</li><li>  <span class="hljs-variable">http</span>.<span class="hljs-title function_">createHttp</span>()</li><li>  <span class="hljs-comment">// The actual development needs to "https://www.example1.com/POST?e=f&amp;g=h"replaced with the real website address to visit</span></li><li>    .<span class="hljs-title function_">request</span>(<span class="hljs-string">'https://www.example1.com/POST?e=f&amp;g=h'</span>,</li><li>      (<span class="hljs-variable">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>) =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">error</span>) {</li><li>          <span class="hljs-comment">// The follow-up logic is not executed when the download fails.</span></li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>        <span class="hljs-comment">// Processing the data returned by network requests</span></li><li>        <span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>);</li><li>      }</li><li>    )</li><li>}</li><li>
</li><li><span class="hljs-comment">// Use createPixelMap to replace pictures of ArrayBuffer types with PixelMap types.</span></li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">http</span>.<span class="hljs-variable">ResponseCode</span>.<span class="hljs-variable">OK</span> === <span class="hljs-variable">data</span>.<span class="hljs-variable">responseCode</span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageData</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-variable">data</span>.<span class="hljs-variable">result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">ArrayBuffer</span>;</li><li>    <span class="hljs-comment">// Create a picture source instance through ArrayBuffer</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">imageSource</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">imageData</span>);</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">InitializationOptions</span> = {</li><li>      <span class="hljs-string">'alphaType'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// Transparency</span></li><li>      <span class="hljs-string">'editable'</span>: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// Is it editable?</span></li><li>      <span class="hljs-string">'pixelFormat'</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// Pixel format</span></li><li>      <span class="hljs-string">'scaleMode'</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// Abbreviation</span></li><li>      <span class="hljs-string">'size'</span>: { <span class="hljs-variable">height</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">width</span>: <span class="hljs-number">100</span> }</li><li>    }; <span class="hljs-comment">// Create the size of the picture</span></li><li>    <span class="hljs-comment">// Create PixelMap through properties</span></li><li>    <span class="hljs-variable">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>(<span class="hljs-variable">options</span>).<span class="hljs-title function_">then</span>((<span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">PixelMap</span>) =&gt; {</li><li>      <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'netData'</span>, <span class="hljs-variable">pixelMap</span>);</li><li>      <span class="hljs-variable">hiTraceMeter</span>.<span class="hljs-title function_">finishTrace</span>(<span class="hljs-string">'Http Request'</span>, <span class="hljs-number">1</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/utils/NetRequest.ets#L3-L44" target="_blank">NetRequest.ets</a></div></div></div></div></li>      <li>在AbilityStage的onCreate()生命周期回调中发起网络请求。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/entryability/MyAbilityStage.ets#L17-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// MyAbilityStage.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityStage</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { httpRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/NetRequest'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbilityStage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbilityStage</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Send a network request</span></li><li>    <span class="hljs-title function_">httpRequest</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onAcceptWant</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-comment">// Triggered in specified mode only.</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'MyAbilityStage'</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/entryability/MyAbilityStage.ets#L17-L30" target="_blank">MyAbilityStage.ets</a></div></div></div></div></li>      <li>在首页 Index.ets 中展示请求获取的图片。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/NewIndex.ets#L17-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-built_in">number</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/Calculator'</span>;</li><li>
</li><li><span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">link</span>(<span class="hljs-string">'netData'</span>);</li><li><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'netData'</span>, <span class="hljs-literal">undefined</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span> + <span class="hljs-built_in">number</span>; <span class="hljs-comment">// In order to reflect the performance benefits, refer to the execution result number of the time-consuming function.</span></li><li>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'netData'</span>) <span class="hljs-attr">netData</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">netData</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onDisAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'netData'</span>, <span class="hljs-literal">undefined</span>);</li><li>    })</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/NewIndex.ets#L17-L41" target="_blank">NewIndex.ets</a></div></div></div></div></li>     </ol>     <p>使用Launch分析工具，对比优化前后启动性能。分析阶段从启动Ability（即H:void OHOS::AppExecFwk::MainThread::HandleLaunchAbility的开始点）到应用接收到网络数据返回后的首帧刷新（即H:ReceiveVsync dataCount:24Bytes now:timestamp expectedEnd:timestamp vsyncId:int的开始点）。</p>     <div class="fignone">      <span class="figcap"><b>图4 </b>优化网络请求时机前</span>      <br><span><img height="115.71000000000001" originheight="353" originwidth="1595" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.26412130571937312216082513430131:50001231000000:2800:22FFD1203E60993494D6C79ABE152D169D8C550EB73A757A4B7AB27F72235E6A.png" title="点击放大" width="523.6875"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图5 </b>优化网络请求时机后</span>      <br><span><img height="114.7125" originheight="353" originwidth="1598" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.03376463223325595298484477326811:50001231000000:2800:4E5E69A9B2D175AD6B9273D58C91D66DBF41AAD541208006C18FFC60AC129CC6.png" title="点击放大" width="523.6875"></span>     </div>     <p>对比数据如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.17.1.3.1.1" valign="top" width="50%">          <p>方案</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.17.1.3.1.2" valign="top" width="50%">          <p>阶段时长(毫秒)</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>优化网络请求时机前</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>1700</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>优化网络请求时机后</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>885.3</p></td>        </tr>             </tbody></table></div>     </div>     <p>因此，可以通过提前网络请求的方式减少应用冷启动耗时。</p>    </div>    <div class="tiledSection">     <h3 id="section5953164714132">缩短应用进程创建和初始化阶段耗时<i class="anchor-icon anchor-icon-link" anchorid="section5953164714132" tips="复制节点链接"></i></h3>          <p>应用进程创建和初始化阶段包括系统完成应用进程的创建及初始化，以及启动页图标（startWindowIcon）的解码。建议使用不超过256×256分辨率的图标，以减少图片解码时延，提升体验。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>建议开发者优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter" target="_blank">Code Linter扫描工具</a>进行代码检查，重点关注<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-start-window-icon-check" target="_blank">@performance/start-window-icon-check</a>规则。若扫描结果中出现该规则相关问题，可参考本章节提供的优化建议进行调整。</p>      </div></div></div>     <p><strong>设置合适分辨率的startWindowIcon</strong></p>     <p>如果启动页图标分辨率过大，解码耗时会影响应用的启动速度。建议启动页图标分辨率不超过256像素×256像素，如下所示。</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/module.json5#L2-L55" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:EntryAbility_desc"</span>,</li><li>        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:layered_image"</span>,</li><li>        <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:EntryAbility_label"</span>,</li><li>        <span class="hljs-string">"startWindowIcon"</span>: <span class="hljs-string">"$media:startIcon"</span>,</li><li>        <span class="hljs-string">"startWindowBackground"</span>: <span class="hljs-string">"$color:start_window_background"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/module.json5#L2-L55" target="_blank">module.json5</a></div></div></div></div>     <p>下面使用Launch分析对比优化前的startWindowIcon（4096像素\*4096像素）及优化后的startWindowIcon（144像素\*144像素）的启动性能。分析阶段的起点为Process Creating，阶段终点为First Frame - Render Phase，优化前后的启动耗时如下图：</p>     <div class="fignone">      <span class="figcap"><b>图6 </b>优化前使用4096px-4096px启动页图标应用启动耗时</span>      <br><span><img originheight="84" originwidth="524" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.28354259626866945600534473640942:50001231000000:2800:2280DBA69A126F377AB1CCA3B43520D46D340F68075CC92B4A49F49D5F810A74.png" width="524" height="84"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图7 </b>优化后使用144px-144px启动页图标应用启动耗时</span>      <br><span><img originheight="81" originwidth="461" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.26977140277189823186803364599173:50001231000000:2800:ECA9826987F4E4D3846F0092D84C632B9710CA19CD60AB4136E26CA1F8BE1DAE.png" width="461" height="81"></span>     </div>     <p>优化后，应用启动时长缩短了37.2ms，设置合适的startWindowIcon分辨率能有效减少应用进程创建和初始化阶段的耗时。</p>    </div>    <div class="tiledSection">     <h3 id="section584818173141">缩短Application和Ability初始化阶段耗时<i class="anchor-icon anchor-icon-link" anchorid="section584818173141" tips="复制节点链接"></i></h3>          <p>Application和Ability初始化包括资源加载、虚拟机创建、相关对象的创建与初始化及依赖模块的加载。</p>     <p>主要耗时点在资源加载阶段，分为以下几个步骤。</p>     <ol>      <li>文件加载：查找并解析所有的文件到模块中记录。</li>      <li>依赖模块解析（实例化）：分配内存空间来存放模块所有导出的变量，此时内存中并没有分配变量的值。</li>      <li>文件执行：运行.ets文件，将内存中之前未分配值的变量赋为真实的值。</li>     </ol>     <p>本章节将详细说明这三个阶段的具体优化方法。</p>     <p><strong>减少import的模块</strong></p>     <p>应用程序在执行代码前，必须找到并加载所有导入的模块。每个加载的第三方框架或模块都会增加启动时间，具体耗时取决于模块的数量和大小。建议开发者优先使用系统提供的模块，并按需加载，以缩短应用程序的启动时间。</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ReduceImport.ets#L17-L31" data-highlighted="yes"><ol class="linenums"><li>// Optimize modules that reduce <span class="hljs-keyword">import</span></li><li>/*<span class="hljs-keyword">import</span> { ConfigurationConstant, contextConstant, wantConstant } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { GesturePath, GesturePoint } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccessibilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { distributedAccount, osAccount } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { Configuration } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { atomicService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScenarioFusionKit'</span>;</li><li><span class="hljs-keyword">import</span> { sim } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TelephonyKit'</span>;*/</li><li>
</li><li>
</li><li><span class="hljs-keyword">import</span> { UIAbility } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>
</li><li>export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> extends UIAbility {</li><li>  // ...</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ReduceImport.ets#L17-L31" target="_blank">ReduceImport.ets</a></div></div></div></div>     <p>下面使用Launch分析，对优化import的模块前（模块数量15个）及优化import的模块后（移除不必要的模块剩余5个）的启动性能进行对比分析。分析的trace点为H:SourceTextModule::Evaluate，优化前后的启动耗时如下图：</p>     <div class="fignone">      <span class="figcap"><b>图8 </b>优化前import 15个模块</span>      <br><span><img height="216.6703" originheight="639" originwidth="1550" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.26908717635139316681427998086578:50001231000000:2800:4526A76AC98CCF2AA1F8D9BA01EAD31D117CA0C3DFBF5B54A75F6845B6E6ABFF.png" title="点击放大" width="522.69"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图9 </b>优化后import 5个模块</span>      <br><span><img height="212.74680000000004" originheight="631" originwidth="1559" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.01436444445162825926032330101673:50001231000000:2800:FF7755A111A5FDDA7CB537C9692FE5207D0F63ECEFCAAA3DE39B7A393B386866.png" title="点击放大" width="522.69"></span>     </div>     <p>对比数据如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.13.1.3.1.1" valign="top" width="50%">          <p>方案</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.13.1.3.1.2" valign="top" width="50%">          <p>阶段时长(微秒)</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>减少import的模块前</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>6239.5</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>减少import的模块后</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>119.7</p></td>        </tr>             </tbody></table></div>     </div>     <p>减少不必要的模块导入可以缩短应用的冷启动时间。如果某些必要模块的导入较为耗时，建议采用动态导入方式。具体方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-dynamic-import" target="_blank">动态加载</a>。</p>     <p>减少使用嵌套的export *和import *方式。</p>     <ul>      <li>减少使用嵌套的export *方式进行全量导出       <p>在应用冷启动过程中，`HandleLaunchAbility` 会执行冷启动相关的 `.ets` 文件。所有被主页面import的 `.ets` 文件均会被执行，包括数据结构、变量和全局函数的初始化。首页所需的变量和函数可能来自其他 `.ets` 文件，并通过export形式提供给首页使用。详细信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-arkts-high-performance#section1218510102815" target="_blank">减少同文件大量export *导出方式</a>。</p>       <p>使用Launch分析，对比优化前（嵌套8层export *）和优化后（直接从目标文件中import）的启动性能。分析阶段从开始加载abc文件（H:JSPandaFileExecutor::ExecuteFromAbcFile）到abc文件加载完成。</p>       <div class="fignone">        <span class="figcap"><b>图10 </b>（优化前）存在8层嵌套export *</span>        <br><span><img height="91.77000000000001" originheight="280" originwidth="1590" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.46360529113301855963494905540176:50001231000000:2800:2152658810405736C66F0BE644C2BF1C805E28A51C3023A5F3749C98B3C77A55.png" title="点击放大" width="523.6875"></span>       </div>       <div class="fignone">        <span class="figcap"><b>图11 </b>（优化后）不存在嵌套export *，从目标文件中直接import</span>        <br><span><img height="85.78500000000001" originheight="261" originwidth="1589" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.85129744998165078650264358884390:50001231000000:2800:408BA3958077A21BDC0D5B101772D0D6CC6F585204BD350BF871CABFC4C425D7.png" title="点击放大" width="523.6875"></span>       </div>       <p>对比数据如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.19.16.1.6.1.3.1.1" valign="top" width="55.510000000000005%">            <p>方案</p></th>           <th align="left" class="cellrowborder" id="mcps1.3.19.16.1.6.1.3.1.2" valign="top" width="44.49%">            <p>阶段时长(微秒)</p></th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="55.510000000000005%">            <p>（优化前）存在8层嵌套export *</p></td>           <td class="cellrowborder" valign="top" width="44.49%">            <p>492.6</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="55.510000000000005%">            <p>（优化后）不存在嵌套export *，从目标文件中直接import</p></td>           <td class="cellrowborder" valign="top" width="44.49%">            <p>388.7</p></td>          </tr>                 </tbody></table></div>       </div>       <p>可见阶段时长已缩短。减少多层文件嵌套导出可以提升应用冷启动速度。</p></li>      <li>减少import *的方式全量引用       <p>应用程序加载时，通常将相同类型的变量或函数放在同一个工具类文件中。使用时，通过import方式引入对应的模块。当工具类中存在较多暴露的函数或变量时，推荐按需引用具体的变量，以减少 `.ets` 文件的执行耗时和文件中所有export变量的初始化过程。详情请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-arkts-high-performance#section1218510102815" target="_blank">减少同文件大量export *导出方式</a>。</p>       <p>对优化前（使用 `import * as nm` 全量引用2000条数据）和优化后（使用import { One }按需引用）的启动性能进行对比分析。分析阶段从 `H:void OHOS::AppExecFwk::MainThread::HandleLaunchAbility(const std::shared_ptr&lt;AbilityLocalRecord&gt; &amp;)` 的开始点到结束点。</p>       <div class="fignone">        <span class="figcap"><b>图12 </b>优化前，使用import * as nm全量引用2000条数据</span>        <br><span><img height="82.7925" originheight="253" originwidth="1584" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.09118101530091381224144100951222:50001231000000:2800:D6F663E0C235A2AAD4ED86741EFAA5C6AEBE0F0CAA8B34776610AC8F3534A6EB.png" title="点击放大" width="523.6875"></span>       </div>       <div class="fignone">        <span class="figcap"><b>图13 </b>优化后，使用import { One }按需引用</span>        <br><span><img height="84.78750000000001" originheight="259" originwidth="1588" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.48822307679127957896055173762420:50001231000000:2800:30DF68CA5EE21350C644FF2D7CFC9F42E71AF5A747E1BD8D8C3AF71C8F569ADB.png" title="点击放大" width="523.6875"></span>       </div>       <p>优化前后的对比数据如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.19.16.2.6.1.3.1.1" valign="top" width="50%">            <p>方案</p></th>           <th align="left" class="cellrowborder" id="mcps1.3.19.16.2.6.1.3.1.2" valign="top" width="50%">            <p>阶段时长(毫秒)</p></th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">            <p>（优化前）使用import * as nm全量引用</p></td>           <td class="cellrowborder" valign="top" width="50%">            <p>16.7</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">            <p>（优化后）使用import { One }按需引用</p></td>           <td class="cellrowborder" valign="top" width="50%">            <p>7.1</p></td>          </tr>                 </tbody></table></div>       </div>       <p>可见阶段的时长已减少。使用按需引用的方式，可以进一步缩短应用冷启动的完成时间。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>此优化方案仅可将冷启动阶段耗时缩短，但是可能导致其他场景耗时增长，即变量初始化过程从冷启动阶段分摊至其它使用阶段，例：当二级页面使用到Numbers.ets中Two变量，此方案会使二级页面跳转过程对比优化前耗时更长。</p>        </div></div></div></li>     </ul>     <p><strong>合理拆分导出文件，减少冗余文件执行</strong></p>     <p>应用程序加载模块后，需执行应用侧的.ets文件，进行初始化并执行全局变量和函数的初始化。文件可分类为冷启动强相关文件（如首页展示界面及组件相关文件）和非冷启动强相关文件（如跳转后二级页面）。冷启动过程中仅执行冷启动强相关文件，以缩短应用启动时间。</p>     <p>【场景示例】</p>     <p>应用包含两个页面：首页Index和二级页面SecondPage。首页展示HAR包中MainPage.ets文件的Text组件，该文件中没有耗时操作。点击首页中的Text组件时，跳转至二级页面。二级页面引用HAR包中的SubPage.ets文件，该文件包含全局函数的耗时操作，这些操作在模块加载时执行。</p>     <p>HAR包中的导出文件Index.ets同时导出了MainPage.ets和SubPage.ets两个文件。当首页直接使用 “import { MainPage } from 'library/Index'” 的方式进行导入时，会导致应用在冷启动过程中执行非冷启动强相关文件SubPage.ets，增加了冷启动时间。</p>     <div class="fignone">      <span class="figcap"><b>图14 </b>优化前，加载模块时执行了非冷启动相关文件 SubPage.ets。</span>     </div>     <p><span><img height="505.7325" originheight="1765" originwidth="1825" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.77898825504867835348989316570217:50001231000000:2800:388A3C553C859ACAB6208EED2F07095C6B7B740FA316CDC36C8B956C22715A51.png" title="点击放大" width="523.6875"></span></p>     <p>以下为示例代码：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/NotRecommendDemo.ets#L17-L30" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MainPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'library/Index'</span>; <span class="hljs-comment">// Unrecommended usage: Direct import of subPage.ets files related to cold start non-strong</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Index</span>{</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span>) {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// Refer to the custom components of HAR</span></li><li>        <span class="hljs-title class_">MainPage</span>()</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/NotRecommendDemo.ets#L17-L30" target="_blank">NotRecommendDemo.ets</a></div></div></div></div>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/src/main/ets/components/mainpage/MainPage.ets#L17-L32" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// library/src/main/ets/components/mainpage/MainPage.ets</span></li><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">MainPage</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'HAR MainPage'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }.<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'SecondPage'</span> });</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/src/main/ets/components/mainpage/MainPage.ets#L17-L32" target="_blank">MainPage.ets</a></div></div></div></div>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/SecondPage.ets#L17-L39" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/SecondPage.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SubPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'library/Index'</span>;</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SecondPageBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">SecondPage</span>()</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SecondPage</span> {</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// Refer to the custom components of HAR</span></li><li>        <span class="hljs-title class_">SubPage</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/SecondPage.ets#L17-L39" target="_blank">SecondPage.ets</a></div></div></div></div>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/src/main/ets/components/mainpage/SubPage.ets#L2-L15" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// library/src/main/ets/components/mainpage/SubPage.ets</span></li><li><span class="hljs-comment">// Global time-consuming functions in SubPage</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">LARGE_NUMBER</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">10000000</span>;</li><li>
</li><li><span class="hljs-variable">function</span> <span class="hljs-title function_">computeTask</span>(): <span class="hljs-title class_">number</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">count</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">while</span> (<span class="hljs-variable">count</span> &lt; <span class="hljs-title class_">LARGE_NUMBER</span>) {</li><li>    <span class="hljs-variable">count</span>++;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">count</span>;</li><li>}</li><li>
</li><li><span class="hljs-title function_">computeTask</span>();</li><li><span class="hljs-comment">// ...</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/src/main/ets/components/mainpage/SubPage.ets#L2-L15" target="_blank">SubPage.ets</a></div></div></div></div>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/Index.ets#L17-L18" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> { <span class="hljs-title class_">MainPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/components/mainpage/MainPage'</span>; <span class="hljs-comment">// Cold start strong related files</span></li><li><span class="hljs-keyword">export</span> { <span class="hljs-title class_">SubPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/components/mainpage/SubPage'</span>; <span class="hljs-comment">// Non-cold start strong related files</span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/Index.ets#L17-L18" target="_blank">Index.ets</a></div></div></div></div>     <p>【优化方案一】</p>     <p>将HAR包的导出文件Index.ets进行拆分，IndexAppStart.ets文件仅导出首页相关文件，即MainPage.ets。IndexOthers.ets文件导出非首页相关文件，即SubPage.ets。</p>     <p>优点：使用此种方案优化后可以将冷启动阶段（加载首页文件）与非冷启动阶段（加载非首页文件）需要执行的.ets文件进行完全拆分，类比其他需优化的场景也可以使用本方案进行拆分。</p>     <p>缺点：拆分后，需确保IndexAppStart.ets中的导出文件不引用IndexOthers.ets中的导出文件。</p>     <div class="fignone">      <span class="figcap"><b>图15 </b>优化方案一，拆分HAR导出文件</span>     </div>     <p><span><img height="505.7325" originheight="1765" originwidth="1825" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.06782215909244264883875174870557:50001231000000:2800:06894E7A8F4F19A1E4797383C34CA44CF80F9FF5409B557012A3A52E6C7A9D85.png" title="点击放大" width="523.6875"></span></p>     <p>示例代码如下：</p>     <ol>      <li>将HAR包的导出文件Index.ets进行拆分，IndexAppStart.ets文件仅导出首页相关文件，IndexOthers.ets文件导出非首页相关文件。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/IndexAppStart.ets#L2-L3" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// library/IndexAppStart.ets</span></li><li><span class="hljs-keyword">export</span> { <span class="hljs-title class_">MainPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/components/mainpage/MainPage'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/IndexAppStart.ets#L2-L3" target="_blank">IndexAppStart.ets</a></div></div></div></div>       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/IndexOthers.ets#L2-L3" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// library/IndexOthers.ets</span></li><li><span class="hljs-keyword">export</span> { <span class="hljs-title class_">SubPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/components/mainpage/SubPage'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/library/IndexOthers.ets#L2-L3" target="_blank">IndexOthers.ets</a></div></div></div></div></li>      <li>首页Index从IndexAppStart.ets导入MainPage。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportMainPage.ets#L17-L35" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MainPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'library/IndexAppStart'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span>) {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// Refer to the custom components of HAR</span></li><li>        <span class="hljs-title class_">MainPage</span>()</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportMainPage.ets#L17-L35" target="_blank">ImportMainPage.ets</a></div></div></div></div></li>      <li>跳转后的页面SecondPage从IndexOthers.ets导入SubPage。       <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportSubPage.ets#L17-L42" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// SecondPage.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SubPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'library/IndexOthers'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SecondPageBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">SecondPage</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SecondPage</span> {</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// Refer to the custom components of HAR</span></li><li>        <span class="hljs-title class_">SubPage</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportSubPage.ets#L17-L42" target="_blank">ImportSubPage.ets</a></div></div></div></div></li>     </ol>     <p>【优化方案二】</p>     <p>在首页的Index.ets文件中导入MainPage.ets时，使用全路径。</p>     <p>优点：无需新增文件即可汇总导出所有冷启阶段的文件。</p>     <p>缺点：引用时需对冷启阶段的所有文件路径进行展开，增加开发和维护成本。</p>     <div class="fignone">      <span class="figcap"><b>图16 </b>优化方案二，首页导入冷启动文件时使用全路径展开</span>     </div>     <p><span><img height="505.7325" originheight="1765" originwidth="1825" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163414.38093524693175700017517200404220:50001231000000:2800:6FA96D6D611AC6146B8477D6722D4BB44CC1C3FB3A59C51FBE1160239885B029.png" title="点击放大" width="523.6875"></span></p>     <p>示例代码如下：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportMainPage.ets#L17-L35" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MainPage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'library/IndexAppStart'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span>) {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// Refer to the custom components of HAR</span></li><li>        <span class="hljs-title class_">MainPage</span>()</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ImportMainPage.ets#L17-L35" target="_blank">ImportMainPage.ets</a></div></div></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>1. 上述两种优化方案假设MainPage中不存在对SubPage的import。</p>       <p>2. 当MainPage中存在对SubPage的直接import时，需使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-dynamic-import" target="_blank">动态import</a>方法来进行优化。</p>       <p>3. 开发者可自行根据优化方案的优缺点权衡选择合适的优化方案。</p>      </div></div></div>     <p>使用Launch分析优化前后启动性能。阶段起点为UI Ability Launching，终点为应用首帧即First Frame - App Phase。</p>     <div class="fignone">      <span class="figcap"><b>图17 </b>优化前：加载模块时执行了非冷启动相关文件</span>      <br><span><img height="35.910000000000004" originheight="108" originwidth="1538" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.68745300938891899686151057345048:50001231000000:2800:D42395BFA2EAC4E050209AD8142DBA019126FB00DD1F2B2F63C2F2B65756EBF9.png" title="点击放大" width="523.6875"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图18 </b>优化方案一：拆分HAR导出文件</span>      <br><span><img height="35.910000000000004" originheight="104" originwidth="1479" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.33025680298594287349353943695658:50001231000000:2800:587BFC92698989869F44AA5D639ABC936923550FF1526A2F548F937DDB1DCFC4.png" title="点击放大" width="523.6875"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图19 </b>优化方案二：导入冷启动文件时全路径展开</span>      <br><span><img height="37.905" originheight="105" originwidth="1431" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.71613240368559344878595125028830:50001231000000:2800:BC8EE4A3E95C1FF8638ABD87C6C2ED488AEADF642A1AD27CFBD2074C44B2DCD6.png" title="点击放大" width="523.6875"></span>     </div>     <p>优化前后的对比数据如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.52.1.3.1.1" valign="top" width="50%">          <p>方案</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.52.1.3.1.2" valign="top" width="50%">          <p>阶段时长(毫秒)</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>优化前</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>140.1</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>优化方案一（拆分HAR导出文件）</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>62.9</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>优化方案二（导入冷启动文件时全路径展开）</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>61.3</p></td>        </tr>             </tbody></table></div>     </div>     <p>可见阶段的时长已减少。为减少应用冷启动时.ets文件的执行耗时，可以采取以下措施：拆分HAR包导出的Index.ets文件，或在导入冷启动文件时展开完整路径，从而提升应用冷启动速度。</p>     <p><strong>减少多个HAP/HSP对相同HAR的引用</strong></p>     <p>在应用开发的过程中，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp" target="_blank">HSP</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package" target="_blank">HAR</a>的共享包方式，整合同类模块，实现多个模块或工程间共享ArkUI组件、资源等相关代码。同时，避免多个HAP/HSP引用相同HAR。详细信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-modular-design#section9492615385">多HAP/HSP引用相同HAR包的影响</a>。</p>     <p><strong>优化加载HSP时间过长</strong></p>     <p>对于单窗口应用的APP工程，其仅包含一个Entry类型的HAP。如果划分的模块没有按需加载的需求，建议业务组件和公共组件采用HAR的打包方式。最终构建应用HAP包时，这些被依赖的HAR将被编译进HAP包中。HSP采用动态加载，在启动过程中会将依赖的HSP加载进来，增加额外的IO与运行耗时。在单HAP场景下，如果使用多模块的话。推荐使用多HAR，不推荐使用HSP。</p>     <p>以下为示例代码：</p>     <div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp1'</span>;</li><li><span class="hljs-keyword">import</span> { add2 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp2'</span>;</li><li><span class="hljs-keyword">import</span> { add3 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp3'</span>;</li><li><span class="hljs-keyword">import</span> { add4 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp4'</span>;</li><li><span class="hljs-keyword">import</span> { add5 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp5'</span>;</li><li><span class="hljs-keyword">import</span> { add6 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp6'</span>;</li><li><span class="hljs-keyword">import</span> { add7 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp7'</span>;</li><li><span class="hljs-keyword">import</span> { add8 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp8'</span>;</li><li><span class="hljs-keyword">import</span> { add9 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp9'</span>;</li><li><span class="hljs-keyword">import</span> { add10 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp10'</span>;</li><li><span class="hljs-keyword">import</span> { add11 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp11'</span>;</li><li><span class="hljs-keyword">import</span> { add12 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp12'</span>;</li><li><span class="hljs-keyword">import</span> { add13 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp13'</span>;</li><li><span class="hljs-keyword">import</span> { add14 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp14'</span>;</li><li><span class="hljs-keyword">import</span> { add15 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp15'</span>;</li><li><span class="hljs-keyword">import</span> { add16 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp16'</span>;</li><li><span class="hljs-keyword">import</span> { add17 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp17'</span>;</li><li><span class="hljs-keyword">import</span> { add18 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp18'</span>;</li><li><span class="hljs-keyword">import</span> { add19 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp19'</span>;</li><li><span class="hljs-keyword">import</span> { add20 } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp20'</span>;</li></ol></pre></div></div>     <p>下面使用Launch分析，对比HAP与20个HSP混合打包以及将20个HSP包设计成HAR包的启动性能。</p>     <div class="fignone">      <span class="figcap"><b>图20 </b>HAP+20个HSP混合打包</span>      <br><span><img height="215.6329" originheight="638" originwidth="1555" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.76751403482892641255256730302559:50001231000000:2800:E84B870129E30013994E51BF5836B5DAE7218C0696DA4869DC86A4F5FB2F3090.png" title="点击放大" width="522.69"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图21 </b>将20个HSP包设计成HAR包</span>      <br><span><img height="190.2831" originheight="563" originwidth="1557" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.61082296439111864052119713687359:50001231000000:2800:C8C4A1FFB8B8F784A1F74B6DC1FF7A9CCEDB0D6D86C0C8B04511C51675D2B6BA.png" title="点击放大" width="522.69"></span>     </div>     <p>对比数据如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.64.1.3.1.1" valign="top" width="50%">          <p>方案</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.64.1.3.1.2" valign="top" width="50%">          <p>阶段时长(微秒)</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>HAP+20个HSP混合打包</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>34643.7</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>将20个HSP包设计成HAR包</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>36.4</p></td>        </tr>             </tbody></table></div>     </div>     <p>在单HAP场景下，如果需要使用多模块，建议使用多HAR，不建议使用HSP。</p>    </div>    <div class="tiledSection">     <h3 id="section178661559171413">缩短AbilityStage生命周期阶段耗时<i class="anchor-icon anchor-icon-link" anchorid="section178661559171413" tips="复制节点链接"></i></h3>          <p>AbilityStage生命周期阶段执行相应的生命周期回调。</p>     <p><strong>避免在AbilityStage生命周期回调接口进行耗时操作</strong></p>     <p>在应用启动流程中，系统会执行 AbilityStage 的生命周期回调函数。不建议在这些回调函数中执行耗时操作，例如 onCreate。建议将耗时操作通过异步任务延迟处理或放到其他线程执行。关于线程并发方案，可以参考 <a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-comparative_practice_of_taskpool_and_worker">TaskPool和Worker的对比实践</a>。在这些生命周期回调中，推荐仅执行必要的操作。关于 AbilityStage，可以参考 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/abilitystage" target="_blank">AbilityStage组件管理器</a>，以下为示例代码：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSpeedOptimization.ets#L17-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">LARGE_NUMBER</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">100000000</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DELAYED_TIME</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">1000</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">message</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'aboutToAppear'</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">computeTaskAsync</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">computeTask</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">count</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">count</span> &lt; <span class="hljs-title class_">LARGE_NUMBER</span>) {</li><li>      <span class="hljs-variable">count</span>++;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Asynchronous processing of operation tasks</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTaskAsync</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-title function_">setTimeout</span>(() =&gt; { <span class="hljs-comment">// SetTimeout is used here to realize asynchronous delayed operation.</span></li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-title function_">computeTask</span>();</li><li>    }, <span class="hljs-variable">DELAYED_TIME</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ColdStartSpeedOptimization.ets#L17-L57" target="_blank">ColdStartSpeedOptimization.ets</a></div></div></div></div>     <p>使用Launch分析，对比优化前同步执行耗时操作和优化后异步执行耗时操作的启动性能。分析范围从Process Creating到First Frame - Render Phase，优化前后的启动耗时如下图所示。</p>     <div class="fignone">      <span class="figcap"><b>图22 </b>优化前同步执行操作（computeTask），应用冷启动耗时</span>      <br><span><img originheight="81" originwidth="759" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.36532565265607245635448453832243:50001231000000:2800:B81E8AE524DAB05E1F967D9A4BEF17C9C72C89DDB20DA482EFBFFE9C16C49031.png" width="759" height="81"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图23 </b>优化后异步执行操作（computeTaskAsync），应用冷启动耗时</span>      <br><span><img originheight="79" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.64820620440442926442183056694269:50001231000000:2800:2FE17E8571502824AB08BED2FFFAF3F44E4AED00C98A761ECC9290FAC60BAB34.png" width="523" height="79"></span>     </div>     <p>使用异步后，应用冷启动时间从2.2秒减少到220.9毫秒，速度提升显著。</p>    </div>    <div class="tiledSection">     <h3 id="section1161113241512">缩短Ability生命周期阶段耗时<i class="anchor-icon anchor-icon-link" anchorid="section1161113241512" tips="复制节点链接"></i></h3>          <p>Ability生命周期阶段执行相应的生命周期回调。</p>     <p><strong>避免在Ability生命周期回调接口进行耗时操作</strong></p>     <p>在应用启动流程中，系统会执行Ability的生命周期回调函数。因此，不建议在这些回调函数中执行耗时操作，建议通过异步任务延迟处理或者放到其他线程执行。线程并发方案可以参考 <a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-comparative_practice_of_taskpool_and_worker">TaskPool和Worker的对比实践</a>。</p>     <p>在这些生命周期回调里，推荐开发者只做必要的操作，下面以UIAbility为例进行说明。比如在生命周期回调函数onCreate、onWindowStageCreate、onForeground等中执行耗时操作都会导致启动缓慢问题，关于UIAbility组件生命周期的详细说明，参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-lifecycle" target="_blank">UIAbility组件生命周期</a>。</p>     <div class="fignone">      <span class="figcap"><b>图24 </b>UIAbility生命周期状态</span>     </div>     <p><span><img height="406.3549" originheight="1653" originwidth="1081" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.96909994973784001361978249341208:50001231000000:2800:4EB06B262FA2CC1E6196D27FF0BC7BFB610492BF5FED1E605775568ABFAE2C99.png" title="点击放大" width="266"></span></p>     <p>下面示例代码在UIAbility的回调函数onCreate()中分别执行了同步和异步操作：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/entryability/EntryAbility.ets#L17-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span></li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">LARGE_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">100000000</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DELAYED_TIME</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1000</span>;</li><li>
</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Time-consuming operation</span></li><li>    <span class="hljs-comment">// this.computeTask();</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeTaskAsync</span>(); <span class="hljs-comment">// Asynchronous tasks</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load the content. Cause: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err) ?? <span class="hljs-string">''</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in loading the content. Data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) ?? <span class="hljs-string">''</span>);</li><li>    });</li><li>
</li><li>    <span class="hljs-comment">// Time-consuming operation</span></li><li>    <span class="hljs-comment">// this.computeTask();</span></li><li>    <span class="hljs-comment">// this.computeTaskAsync(); // Asynchronous mission</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Time-consuming operation</span></li><li>    <span class="hljs-comment">// this.computeTask();</span></li><li>    <span class="hljs-comment">// this.computeTaskAsync(); // Asynchronous mission</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTask</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (count &lt; <span class="hljs-variable constant_">LARGE_NUMBER</span>) {</li><li>      count++;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTaskAsync</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// SetTimeout is used here to achieve asynchronous delayed operation.</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeTask</span>();</li><li>    }, <span class="hljs-variable constant_">DELAYED_TIME</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/entryability/EntryAbility.ets#L17-L63" target="_blank">EntryAbility.ets</a></div></div></div></div>     <p>下面使用Launch分析，对比优化前同步执行耗时操作和优化后异步执行耗时操作的启动性能。分析从Process Creating阶段开始，到First Frame - Render Phase阶段结束。优化前后的启动耗时如下图所示。</p>     <div class="fignone">      <span class="figcap"><b>图25 </b>优化前同步执行操作（computeTask），应用冷启动耗时</span>      <br><span><img originheight="78" originwidth="694" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.99651926465171557449642095330733:50001231000000:2800:50176AC3C965813CCD29BFE4B4BE4D5A9D11875DB9C4E84E89510F4DC1C7849A.png" width="694" height="78"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图26 </b>优化后异步执行操作（computeTaskAsync），应用冷启动耗时</span>      <br><span><img originheight="79" originwidth="482" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.39367610392882170507624634139771:50001231000000:2800:04D202D253ADB4B92122B9C6D89FB612293645F4DAF66AB46D0E1876CC92279C.png" width="482" height="79"></span>     </div>     <p>使用延时异步后，应用冷启动时间显著提升，耗时从2.1秒减少到220毫秒。</p>    </div>    <div class="tiledSection">     <h3 id="section46001212168">缩短加载绘制首页阶段耗时<i class="anchor-icon anchor-icon-link" anchorid="section46001212168" tips="复制节点链接"></i></h3>          <p>首页加载绘制阶段主要包含加载首页内容、测量布局、刷新组件和绘制。处理页面生命周期时，避免耗时操作，优先创建首页需要显示的组件，使用if分支语句隐藏不需要显示的组件，减少创建过程的耗时。耗时操作建议通过异步任务或放到其他线程执行，线程并发方案可参考 <a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-comparative_practice_of_taskpool_and_worker">TaskPool和Worker的对比实践</a>。</p>     <p><strong>自定义组件生命周期回调接口里避免耗时操作</strong></p>     <p>自定义组件的生命周期变更会调用相应的回调函数，aboutToAppear()函数会在创建自定义组件实例后，页面绘制之前执行，而onPageShow则是在页面进入前台的时候显示，因此避免在这两个回调函数中执行该耗时操作，不阻塞页面绘制。关于自定义组件生命周期的详细说明，参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-page-custom-components-lifecycle" target="_blank">页面和自定义组件生命周期</a>。</p>     <div class="fignone">      <span class="figcap"><b>图27 </b>被@Entry装饰的组件（页面）生命周期</span>     </div>     <p><span><img height="378.0525" originheight="1355" originwidth="1874" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.10020536947026960670701331713129:50001231000000:2800:D9BD0968DD0306B688BF4D1E499B6CACFCB7D96AA112B136A502E3F97E12D62F.png" title="点击放大" width="523.6875"></span></p>     <p>在Page的回调函数aboutToAppear()中分别执行同步和异步操作的示例代码如下：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ComputeTaskAsync.ets#L17-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">LARGE_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">100000000</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DELAYED_TIME</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1000</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// Time-consuming operation</span></li><li>    <span class="hljs-comment">// this.computeTask();</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeTaskAsync</span>(); <span class="hljs-comment">// Asynchronous tasks</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTask</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (count &lt; <span class="hljs-variable constant_">LARGE_NUMBER</span>) {</li><li>      count++;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Asynchronous processing of computing tasks</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">computeTaskAsync</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// SetTimeout is used here to achieve asynchronous delayed operation.</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeTask</span>();</li><li>    }, <span class="hljs-variable constant_">DELAYED_TIME</span>);</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ComputeTaskAsync.ets#L17-L56" target="_blank">ComputeTaskAsync.ets</a></div></div></div></div>     <p>下面使用Launch分析，对优化前同步执行耗时操作及优化后异步执行耗时操作的启动性能进行对比分析。分析阶段的起点Process Creating，阶段终点为First Frame - Render Phase。</p>     <p>如下图所示，优化前后的启动耗时对比：</p>     <div class="fignone">      <span class="figcap"><b>图28 </b>优化前同步执行操作（computeTask），应用冷启动耗时</span>      <br><span><img originheight="81" originwidth="640" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.99758598773683054090572021794386:50001231000000:2800:6E24B3BE5EA7C6A69B774DC28A870634281071B30142ACEBF016DD0ECE929B08.png" width="640" height="81"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图29 </b>优化后异步执行操作（computeTaskAsync），应用冷启动耗时</span>      <br><span><img height="119.50555400000002" originheight="83" originwidth="442" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.07043379143995229636725345216035:50001231000000:2800:1462F02E46E8E05BEE9E279D3D391108A164C5F1FC7D881B5865E2AA190D8B48.png" title="点击放大" width="636.4050000000001"></span>     </div>     <p>使用异步处理后，应用冷启动时间显著提升，耗时从2.4秒减少到238.3毫秒。</p>     <p><strong>使用本地存储加载首页数据</strong></p>     <p>在应用启动流程中，大部分应用的首页数据信息需要等待网络请求返回的数据解析结果，因此可以将首页数据通过应用数据持久化的方式进行本地存储，再次冷启动时优先展示已存储数据，网络请求后再次刷新首页数据。</p>     <div class="fignone">      <span class="figcap"><b>图30 </b>使用本地存储首页数据流程图</span>      <p><span><img height="148.96" originheight="733" originwidth="3841" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163415.26073416799034544051752990738290:50001231000000:2800:320D7CD682564EF65B52FB1DEE29067D5F3231F325E612E38A4546C6CCB8F31D.png" title="点击放大" width="782.0400000000001"></span></p>      <p>使用本地<strong>存储</strong>优先展示，可减少首帧展示延迟，缩短用户可见白屏时间，提升冷启动体验。</p>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>应用需根据自身对于数据的时效性要求，来决定是否使用<strong>本地存储</strong>数据。例如时效性要求为一天时，一天前保存的数据就不适合进行展示，需从网络获取新数据进行展示，并更新本地存储数据。</p>      </div></div></div>     <p>【场景示例】</p>     <p>应用首页需展示从网站获取的图片信息。在aboutToAppear()中发起网络请求，数据返回并解析后展示在首页。图片信息存储在本地应用沙箱内。再次冷启动时，首先从沙箱获取图片信息，若存在则解析并展示。网络请求返回时，更新图片信息。</p>     <p>以下为关键示例代码：</p>     <div class="screenLinkPre"><div _ngcontent-duc-c106="" class="highlight-div"><div _ngcontent-duc-c106="" class="highlight-div-header"><div _ngcontent-duc-c106="" class="highlight-div-header-left"><div _ngcontent-duc-c106="" class="handle-button expand-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-duc-c106="" class="highlight-div-header-right"><div _ngcontent-duc-c106="" class="handle-button ai-button"></div><div _ngcontent-duc-c106="" class="handle-button line-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-duc-c106="" class="handle-button theme-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-duc-c106="" class="handle-button copy-button"><div _ngcontent-duc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-duc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ScenariosExample.ets#L17-L134" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">http</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">abilityAccessCtrl</span>, <span class="hljs-variable">common</span>, <span class="hljs-variable">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">fileIo</span>, <span class="hljs-variable">fileIo</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">fs</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">PERMISSIONS</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [</li><li>  <span class="hljs-string">'ohos.permission.READ_MEDIA'</span>,</li><li>  <span class="hljs-string">'ohos.permission.WRITE_MEDIA'</span></li><li>];</li><li><span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">link</span>(<span class="hljs-string">'net_picture'</span>);</li><li><span class="hljs-variable">PersistentStorage</span>.<span class="hljs-title function_">persistProp</span>(<span class="hljs-string">'net_picture'</span>, <span class="hljs-string">''</span>);</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">image</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>;</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">imageBuffer</span>: <span class="hljs-title class_">ArrayBuffer</span> | <span class="hljs-title class_">undefined</span> = <span class="hljs-variable">undefined</span>; <span class="hljs-comment">// Picture ArrayBuffer</span></li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * Download picture resources from the Internet through the http request method</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">getPicture</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-variable">http</span>.<span class="hljs-title function_">createHttp</span>()</li><li>      .<span class="hljs-title function_">request</span>(<span class="hljs-string">'https://www.example1.com/POST?e=f&amp;g=h'</span>,</li><li>        (<span class="hljs-variable">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>) =&gt; {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable">error</span>) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-comment">// Determine whether the resources obtained by the network are of the ArrayBuffer type.</span></li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable">data</span>.<span class="hljs-variable">result</span> <span class="hljs-variable">instanceof</span> <span class="hljs-variable">ArrayBuffer</span>) {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-variable">imageBuffer</span> = <span class="hljs-variable">data</span>.<span class="hljs-variable">result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">ArrayBuffer</span>;</li><li>          }</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>);</li><li>        }</li><li>      )</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * Use createPixelMap to replace pictures of ArrayBuffer type with PixelMap type</span></li><li><span class="hljs-comment">   * @param data：Resources obtained from the network</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-title function_">transcodePixelMap</span>(<span class="hljs-variable">data</span>: <span class="hljs-title class_">http</span>.<span class="hljs-title class_">HttpResponse</span>): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">http</span>.<span class="hljs-variable">ResponseCode</span>.<span class="hljs-variable">OK</span> === <span class="hljs-variable">data</span>.<span class="hljs-variable">responseCode</span>) {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">imageData</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-variable">data</span>.<span class="hljs-variable">result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">ArrayBuffer</span>;</li><li>      <span class="hljs-comment">// Create a picture source instance through ArrayBuffer</span></li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">imageSource</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">imageData</span>);</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">InitializationOptions</span> = {</li><li>        <span class="hljs-string">'alphaType'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// Transparency</span></li><li>        <span class="hljs-string">'editable'</span>: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// Is it editable?</span></li><li>        <span class="hljs-string">'pixelFormat'</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// Pixel format</span></li><li>        <span class="hljs-string">'scaleMode'</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// Abbreviation</span></li><li>        <span class="hljs-string">'size'</span>: { <span class="hljs-variable">height</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">width</span>: <span class="hljs-number">100</span> }</li><li>      }; <span class="hljs-comment">// Create the size of the picture</span></li><li>
</li><li>      <span class="hljs-comment">// Create PixelMap through attributes</span></li><li>      <span class="hljs-variable">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>(<span class="hljs-variable">options</span>).<span class="hljs-title function_">then</span>((<span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">PixelMap</span>) =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">image</span> = <span class="hljs-variable">pixelMap</span>;</li><li>        <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageBuffer</span> !== <span class="hljs-variable">undefined</span>) {</li><li>            <span class="hljs-keyword">this</span>.<span class="hljs-title function_">saveImage</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">imageBuffer</span>);</li><li>          }</li><li>        }, <span class="hljs-number">0</span>)</li><li>      });</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">saveImage</span>(<span class="hljs-variable">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span> | <span class="hljs-title class_">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">context</span>:<span class="hljs-title class_">common</span>.<span class="hljs-title class_">UIAbilityContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">filePath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">context</span>.<span class="hljs-variable">cacheDir</span> + <span class="hljs-string">'/test.jpg'</span>;</li><li>      <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'net_picture'</span>, <span class="hljs-variable">filePath</span>);</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">file</span>: <span class="hljs-title class_">fileIo</span>.<span class="hljs-title class_">File</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">fs</span>.<span class="hljs-keyword">open</span>(<span class="hljs-variable">filePath</span>, <span class="hljs-variable">fs</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">READ_WRITE</span> | <span class="hljs-variable">fs</span>.<span class="hljs-variable">OpenMode</span>.<span class="hljs-variable">CREATE</span>);</li><li>      <span class="hljs-variable">await</span> <span class="hljs-variable">fs</span>.<span class="hljs-title function_">write</span>(<span class="hljs-variable">file</span>.<span class="hljs-variable">fd</span>, <span class="hljs-variable">buffer</span>);</li><li>      <span class="hljs-variable">await</span> <span class="hljs-variable">fs</span>.<span class="hljs-title function_">close</span>(<span class="hljs-variable">file</span>.<span class="hljs-variable">fd</span>);</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">error</span> = <span class="hljs-variable">err</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">BusinessError</span>;</li><li>      <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">onAddForm</span> <span class="hljs-variable">err</span>, <span class="hljs-variable">code</span>: ${<span class="hljs-variable">error</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">mesage</span>: ${<span class="hljs-variable">error</span>.<span class="hljs-variable">message</span>}`);</li><li>    }</li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">useCachePic</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'net_picture'</span>) !== <span class="hljs-string">''</span>) {</li><li>      <span class="hljs-comment">// Get the ArrayBuffer of the picture</span></li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">imageSource</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'net_picture'</span>));</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">InitializationOptions</span> = {</li><li>        <span class="hljs-string">'alphaType'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// transparency</span></li><li>        <span class="hljs-string">'editable'</span>: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// Is it editable?</span></li><li>        <span class="hljs-string">'pixelFormat'</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// pixel format</span></li><li>        <span class="hljs-string">'scaleMode'</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// Abbreviated value</span></li><li>        <span class="hljs-string">'size'</span>: { <span class="hljs-variable">height</span>: <span class="hljs-number">100</span>, <span class="hljs-variable">width</span>: <span class="hljs-number">100</span> }</li><li>      };</li><li>      <span class="hljs-variable">imageSource</span>.<span class="hljs-title function_">createPixelMap</span>(<span class="hljs-variable">options</span>).<span class="hljs-title function_">then</span>((<span class="hljs-variable">pixelMap</span>: <span class="hljs-title class_">PixelMap</span>) =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">image</span> = <span class="hljs-variable">pixelMap</span>;</li><li>      });</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-variable">async</span> <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">common</span>.<span class="hljs-title class_">UIAbilityContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-variable">atManager</span>: <span class="hljs-title class_">abilityAccessCtrl</span>.<span class="hljs-title class_">AtManager</span> = <span class="hljs-variable">abilityAccessCtrl</span>.<span class="hljs-title function_">createAtManager</span>();</li><li>    <span class="hljs-variable">await</span> <span class="hljs-variable">atManager</span>.<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable">context</span>, <span class="hljs-variable">PERMISSIONS</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">useCachePic</span>(); <span class="hljs-comment">// Get data from local storage</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getPicture</span>(); <span class="hljs-comment">// Obtain data from the network side</span></li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">image</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-variable">ImageFit</span>.<span class="hljs-variable">Contain</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppColdStart/entry/src/main/ets/pages/ScenariosExample.ets#L17-L134" target="_blank">ScenariosExample.ets</a></div></div></div></div>     <p>下面对比优化前后的启动性能。分析阶段从启动Ability开始，到首次解析Pixelmap后的第一个vsync结束。</p>     <div class="fignone">      <span class="figcap"><b>图31 </b>优化前未使用本地存储数据</span>      <br><span><img height="111.72" originheight="342" originwidth="1590" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.16787735817494126636813712142595:50001231000000:2800:0F71AED8726992DD33DA39BBA5A60A92373E52A87B8D17DC1E13FA4FBE557DF0.png" title="点击放大" width="523.6875"></span>     </div>     <div class="fignone">      <span class="figcap"><b>图32 </b>优化后使用本地存储数据</span>      <br><span><img height="122.69250000000001" originheight="373" originwidth="1590" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163416.64567001777030128802581120335063:50001231000000:2800:F721AC3A67F2BA7E3F6BE6787E8C637D42B9C04F13BEF12BB78FC50E30960258.png" title="点击放大" width="523.6875"></span>     </div>     <p>对比数据如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.22.26.1.3.1.1" valign="top" width="50%">          <p>方案</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.22.26.1.3.1.2" valign="top" width="50%">          <p>阶段时长(毫秒)</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p>（优化前）未使用本地存储</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>641.8</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p>（优化后）使用本地存储</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>68.9</p></td>        </tr>             </tbody></table></div>     </div>     <p>使用本地存储后，应用冷启动时从Ability启动到图片显示的阶段耗时明显减少。</p>     <p>针对应用冷启动过程中网络请求耗时久的问题，提供了一个三方库供开发者使用，优化方式是首页内容复用，先使用本地缓存的数据。三方库链接：<a href="https://ohpm.openharmony.cn/#/cn/detail/@hadss%2Fdatacache" target="_blank">首页数据缓存</a>。加速应用冷启动的使用方法可参考：<a href="https://gitee.com/harmonyos_samples/DataCache" target="_blank">首页数据缓存加速冷启动</a>。</p>     <p><strong>优化首页显示速度</strong></p>     <p>启动过程从用户点击应用入口到首页数据显示在屏幕上，这是对用户点击事件响应的过程。开发者可以通过UI优化、并发优化、代码逻辑优化及IPC通信优化等方法来提升首页的响应速度，具体可参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-click-to-click-response-optimization" target="_blank">点击响应时延分析</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section1110511071712">总结<i class="anchor-icon anchor-icon-link" anchorid="section1110511071712" tips="复制节点链接"></i></h2>          <p>本文介绍了应用冷启动的流程，如何识别和分析冷启动缓慢问题，以及针对冷启动各阶段的注意事项和优化方法。</p>     <ul>      <li>非冷启动所需的服务或模块可以延迟加载。</li>      <li>将网络请求提前至AbilityStage/UIAbility的onCreate()生命周期回调函数中，提前首刷或二刷时间，减少用户等待时间。</li>      <li>建议将启动页图标startWindowIcon的分辨率设置为不超过256px*256px。</li>      <li>在AbilityStage、UIAbility和自定义组件的生命周期回调函数中，不建议直接执行复杂的计算任务、同步文件读写等耗时任务。建议通过异步任务或在其他线程中处理。</li>      <li>按需导入模块，移除初始化阶段不必要的模块导入，动态加载耗时的模块。</li>      <li>减少使用嵌套的export *全量导出和import *全量引用。</li>      <li>拆分HAR包导出文件或导入冷启动相关文件时，使用全路径，减少应用冷启动的.ets文件执行耗时。</li>      <li>避免多个HAP/HSP对相同HAR的引用。</li>      <li>在单HAP场景下，建议模块使用多HAR，而不推荐使用HSP。</li>      <li>建议通过使用合理的布局结构和懒加载等UI优化方法来减少首帧绘制时间。</li>      <li>建议使用本地存储首页数据，以减少首帧展示完成的时延，并减少用户可见的白屏或白块时间。</li>     </ul>     <p>希望通过本文的学习，开发者可以了解和识别应用启动耗时的问题，有助于开发者提升应用冷启动速度，提升用户体验。</p>    </div>   </div>   <div></div></div>