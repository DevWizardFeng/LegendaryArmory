<h1 _ngcontent-ury-c119="" class="doc-title ng-star-inserted" title="应用安全编码实践"> 应用安全编码实践 </h1>

<div _ngcontent-ury-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section24933501732">通用组件安全<i class="anchor-icon anchor-icon-link" anchorid="section24933501732" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section93277172115" class="firsth2">不涉及对外交互的应用组件应设置exported属性为false<i class="anchor-icon anchor-icon-link" anchorid="section93277172115" tips="复制节点链接"></i></h3><p>应用程序内部使用的组件必须设置为不可见，以防止其他应用程序调用。</p> <p>不对外交互的应用组件应显式设置exported属性为false，防止遗漏和错误配置。这可避免内部接口被恶意应用利用，导致信息泄露、功能异常或应用拒绝服务等问题。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>当应用组件的exported属性设置为false时，使用DevEco Studio启动调试或运行应用/服务，或通过命令行拉起时，会出现安装HAP错误，提示“error: failed to start ability. error: ability visible false deny request”。系统安全权限不允许拉起exported属性设置为false的应用/服务。建议在调试阶段将exported属性设置为true，正式上架发布时再设置为false。</p> </div></div></div> <p><strong>错误示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5</span></li><li><span class="hljs-string">"abilities"</span>: [ </li><li>  { </li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"PrivacyAbility"</span>, </li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/privacyability/PrivacyAbility.ts"</span>, </li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:PrivacyAbility_desc"</span>, </li><li>    <span class=""><span class="hljs-string">"exported"</span>: <span class="hljs-keyword">true</span> </span></li><li>  } </li><li>]</li></ol></pre></div></div> <p>PrivacyAbility 是一个不对外交互的组件，但设置exported属性为true后，任何应用都能访问该组件。</p> <p><strong>正确示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5 </span></li><li><span class="hljs-string">"abilities"</span>: [ </li><li>  { </li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"PrivacyAbility"</span>, </li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/privacyability/PrivacyAbility.ts"</span>, </li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:PrivacyAbility_desc"</span>, </li><li>   <span class=""> <span class="hljs-string">"exported"</span>: <span class="hljs-keyword">false</span></span> </li><li>  } </li><li>]</li></ol></pre></div></div> <p></p> </div> <div class="tiledSection"><h3 id="section16254131183715">对外交互的应用组件应设置合理的访问权限<i class="anchor-icon anchor-icon-link" anchorid="section16254131183715" tips="复制节点链接"></i></h3><p>应用程序组件不仅在内部使用，还需要与外部进行交互。以下情况表明组件是对外交互的：</p> <ul><li>module.json5文件中显式设置exported属性为true，则表明该Ability允许对外交互的；</li></ul> <p>程序内应用组件如果允许对外交互，数据会跨越信任边界，若被恶意应用程序利用，可能导致信息泄露、功能异常或应用拒绝服务等问题。因此，应使用`permissions`属性为对外交互的应用组件设置访问权限。</p> <p>敏感功能和对外提供的Ability存在利用风险，建议相关组件设置权限进行保护。</p> <p>1）未经用户操作确认，系统即可执行关键操作，例如发送短信、拨打电话、拍照、录音、录屏、截屏和定位等。</p> <p>2）导致个人数据和敏感数据泄露的关键操作，例如：读取短信、读取联系人和读取设备标识符等。</p> <p>3）导致权限提升，例如：可以执行原本需要system权限的操作。</p> <p><strong>例外情况：</strong>必须对外提供且无利用风险的应用组件，可以不设置权限。</p> <p><strong>错误示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5 </span></li><li><span class="hljs-string">"abilities"</span>: [ </li><li>  { </li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ContactDataAbility"</span>, </li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/DataAbility/DataAbility.ts"</span>, </li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string: DataAbility_desc"</span>, </li><li>    <span class="hljs-string">"exported"</span>: <span class="hljs-keyword">true</span> </li><li>  } </li><li>]</li></ol></pre></div></div> <p>任意外部应用都可以访问此ContactDataAbility，恶意应用可能利用该组件获取联系人数据。</p> <p><strong>正确示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// module.json5 </span></li><li><span class="hljs-string">"abilities"</span>: [ </li><li>  { </li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ContactDataAbility"</span>, </li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/DataAbility/DataAbility.ts"</span>, </li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string: DataAbility_desc"</span>, </li><li>    <span class="hljs-string">"exported"</span>: <span class="hljs-keyword">true</span>, </li><li>    <span class="hljs-string">"permissions"</span>: [<span class="hljs-string">"ohos.permission.READ_CONTACTS"</span>] </li><li>  } </li><li>]</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section143261097385">建议隐式启动应用组件时避免携带个人数据<i class="anchor-icon anchor-icon-link" anchorid="section143261097385" tips="复制节点链接"></i></h3><p>隐式want是通过action条件匹配的方式来筛选组件，凡是满足条件的应用组件都有被启动的可能。如果携带个人数据，则恶意应用有可能劫持携带的个人数据。应用程序如果要携带个人数据，需要显式指定目标应用组件（bundle名、ability名）或者将个人数据匿名化。示例中的context的获取方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息" target="_blank">获取UIAbility的上下文信息</a>。</p> <p><strong>错误示例:</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/NoInfoJumpTo.ets#L22-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">wantInfo</span>:<span class="hljs-title class_">Want</span> = {</li><li>      <span class="hljs-attr">deviceId</span>: <span class="hljs-string">''</span>,</li><li>      <span class="hljs-attr">action</span>: <span class="hljs-string">'ability.want.test'</span>,</li><li>      <span class="hljs-attr">parameters</span>: {</li><li>        <span class="hljs-string">'password'</span>: <span class="hljs-string">'xxxxxxxx'</span></li><li>      }</li><li>    };</li><li>    <span class="hljs-keyword">try</span>{</li><li>      <span class="hljs-keyword">let</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">startAbility</span>(wantInfo);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'startAbility success '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'startAbility  with error message: '</span> + err.<span class="hljs-property">message</span> + <span class="hljs-string">', error code: '</span> + err.<span class="hljs-property">code</span>);</li><li>    }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/NoInfoJumpTo.ets#L22-L46" target="_blank">NoInfoJumpTo.ets</a></div></div></div></div> <p>通过示例代码中的action："ability.want.test" 可以隐式启动组件。如果恶意应用也声明了相同的action，隐式调用时将显示一个列表供用户选择。如果用户选择了恶意应用，该应用可能会获取传递的敏感信息。</p> <p><strong>正确示例:</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NoInfoJumpTo.ets#L22-L48" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">wantInfo</span>:<span class="hljs-title class_">Want</span> = {</li><li>      <span class="hljs-variable">deviceId</span>: <span class="hljs-string">''</span>,</li><li>      <span class="hljs-variable">action</span>: <span class="hljs-string">'ability.want.test'</span>,</li><li>      <span class="hljs-variable">bundleName</span>:<span class="hljs-string">'com.example.myapplication10'</span>,</li><li>      <span class="hljs-variable">abilityName</span>:<span class="hljs-string">'MainAbility1'</span>,</li><li>      <span class="hljs-variable">parameters</span>: {</li><li>        <span class="hljs-string">'password'</span>: <span class="hljs-string">'xxxxxxxx'</span></li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">try</span>{</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">data</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">context</span>.<span class="hljs-title function_">startAbility</span>(<span class="hljs-variable">wantInfo</span>);</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'startAbility success '</span> + <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>));</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">err</span>) {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'startAbility  with error message: '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">message</span> + <span class="hljs-string">', error code: '</span> + <span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>);</li><li>    }</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/NoInfoJumpTo.ets#L22-L48" target="_blank">NoInfoJumpTo.ets</a></div></div></div></div> <p>这里显式指定了需要拉起的应用组件的bundleName和abilityName，只会拉起指定的目标组件。</p> <p></p> </div> <div class="tiledSection"><h3 id="section18516943133816">避免涉及口令输入的应用界面可以被截屏或录屏<i class="anchor-icon anchor-icon-link" anchorid="section18516943133816" tips="复制节点链接"></i></h3><p>口令输入界面包含账号密码输入框和输入法弹出框。在用户输入口令时，应禁止截屏或录屏操作。如果恶意软件获得授权，窃取用户账号和密码，便可能在其他设备上登录，导致用户隐私泄露。</p> <p><strong>实施指导：</strong></p> <p>在需要保护的Page页面调用setWindowPrivacyMode()方法，禁止截屏和录屏。</p> <p>注意：使用此接口前，需申请ohos.permission.PRIVACY_WINDOW权限。</p> <p><strong>正确示例:</strong></p> <p>在口令输入、转账支付页面中设置隐私属性，防止截屏/录屏：</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PrivacyMode.ets#L21-L59" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">onPageShow</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.Window</span>) =&gt;</span> {</li><li>      windowStage.<span class="hljs-title function_">setWindowPrivacyMode</span>(<span class="hljs-literal">true</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'PrivacyMode'</span>, <span class="hljs-string">`getLastWindow error code <span class="hljs-subst">${error.code}</span>`</span>)</li><li>    });</li><li>  }</li><li>  <span class="hljs-title function_">onPageHide</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getLastWindow</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.Window</span>) =&gt;</span> {</li><li>      windowStage.<span class="hljs-title function_">setWindowPrivacyMode</span>(<span class="hljs-literal">false</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'PrivacyMode'</span>, <span class="hljs-string">`getLastWindow error code <span class="hljs-subst">${error.code}</span>`</span>)</li><li>    });</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'click to start Succ Page'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/loginSuccPage'</span> });</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PrivacyMode.ets#L21-L59" target="_blank">PrivacyMode.ets</a></div></div></div></div> </div> <p></p> <div class="tiledSection"><h2 id="section2013918084018">公共事件安全<i class="anchor-icon anchor-icon-link" anchorid="section2013918084018" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section190521394018" class="firsth2">避免使用携带个人数据未设置权限的动态公共事件<i class="anchor-icon anchor-icon-link" anchorid="section190521394018" tips="复制节点链接"></i></h3><p></p> <p>不同应用程序可以通过公共事件进行进程间通信。如果公共事件的发送权限设置不当，并且携带个人数据，任何应用都可能读取这些个人数据，导致用户数据泄露。</p> <p>对于携带个人数据的公共事件，需设置发送权限或加密个人数据。</p> <p><strong>错误示例:</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/PublicSafeInfo.ets#L22-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { commonEventManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">publishEventWithData</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: commonEventManager.<span class="hljs-property">CommonEventPublishData</span> = {</li><li>    <span class="hljs-attr">code</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-string">'ContactData'</span>, <span class="hljs-comment">// Sending sensitive data</span></li><li>  }</li><li>  commonEventManager.<span class="hljs-title function_">publish</span>(<span class="hljs-string">'MyCommonEvent'</span>, options, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`publish event error: <span class="hljs-subst">${err.code}</span> <span class="hljs-subst">${err.message}</span> <span class="hljs-subst">${err.name}</span> <span class="hljs-subst">${err.stack}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'publish event with data Succeeded'</span>);</li><li>    }</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/PublicSafeInfo.ets#L22-L37" target="_blank">PublicSafeInfo.ets</a></div></div></div></div> <p>发送了一个包含联系人数据的公共事件，但未设置接收方所需的权限。</p> <div class="p"><strong>正确示例:</strong><div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PublicSafeInfo.ets#L22-L38" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { commonEventManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">publishEventWithData</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: commonEventManager.<span class="hljs-property">CommonEventPublishData</span> = {</li><li>    <span class="hljs-attr">code</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-string">'ContactData'</span>, <span class="hljs-comment">// Sending sensitive data</span></li><li>    <span class="hljs-attr">subscriberPermissions</span>: [<span class="hljs-string">'ohos.permission.READ_CONTACTS'</span>], <span class="hljs-comment">// Set the permission</span></li><li>  }</li><li>  commonEventManager.<span class="hljs-title function_">publish</span>(<span class="hljs-string">'MyCommonEvent'</span>, options, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`publish event error: <span class="hljs-subst">${err.code}</span> <span class="hljs-subst">${err.message}</span> <span class="hljs-subst">${err.name}</span> <span class="hljs-subst">${err.stack}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'publish event with data Succeeded'</span>);</li><li>    }</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PublicSafeInfo.ets#L22-L38" target="_blank">PublicSafeInfo.ets</a></div></div></div></div> </div> <p>通过subscriberPermissions字段设置接收权限，发布者要求订阅者具有“ohos.permission.READ_CONTACTS”权限，才能接收携带联系人数据的公共事件。</p> </div> <div class="tiledSection"><h3 id="section74546012413">建议对涉及敏感功能的公共事件进行访问权限控制<i class="anchor-icon anchor-icon-link" anchorid="section74546012413" tips="复制节点链接"></i></h3><p>应用支持订阅自定义公共事件，并在接收到事件后执行相应功能。订阅公共事件时，需通过publisherPermission设置接收权限。若未设置权限，任意应用可发送同名自定义公共事件，可能导致接收应用拒绝服务或敏感功能泄露。</p> <p>对于涉及敏感数据或操作的公共事件，订阅方必须设置足够高的权限。</p> <p><strong>错误示例:</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/PublicSensitive.ets#L22-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { commonEventManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subscriber</span>: commonEventManager.<span class="hljs-property">CommonEventSubscriber</span>;</li><li><span class="hljs-comment">//Subscriber information</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subscribeInfo</span>: commonEventManager.<span class="hljs-property">CommonEventSubscribeInfo</span> = {</li><li>  <span class="hljs-attr">events</span>: [<span class="hljs-string">'event'</span>]</li><li>};</li><li>
</li><li><span class="hljs-comment">// Create a subscriber</span></li><li><span class="hljs-keyword">try</span> {</li><li>  commonEventManager.<span class="hljs-title function_">createSubscriber</span>(subscribeInfo, <span class="hljs-function">(<span class="hljs-params">err, commonEventSubscriber</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'createSubscriber Succeed'</span>);</li><li>      subscriber = commonEventSubscriber;</li><li>      <span class="hljs-comment">//Subscribe to public events</span></li><li>      <span class="hljs-keyword">try</span> {</li><li>        commonEventManager.<span class="hljs-title function_">subscribe</span>(subscriber, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (err) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`subscribe failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">//Event processing after receiving public events</span></li><li>            <span class="hljs-comment">// doSomeDangerousThing(data)</span></li><li>          }</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`subscribe failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`createSubscriber failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`createSubscriber failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/PublicSensitive.ets#L22-L56" target="_blank">PublicSensitive.ets</a></div></div></div></div> <div class="p"><strong>正确示例:</strong><div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PublicSensitive.ets#L22-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { commonEventManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subscriber</span>: commonEventManager.<span class="hljs-property">CommonEventSubscriber</span>;</li><li><span class="hljs-comment">//Subscriber information</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">subscribeInfo</span>: commonEventManager.<span class="hljs-property">CommonEventSubscribeInfo</span> = {</li><li>  <span class="hljs-attr">events</span>: [<span class="hljs-string">'event'</span>],</li><li>  <span class="hljs-attr">publisherPermission</span>: <span class="hljs-string">'ohos.permission.publisherPermission1'</span>, <span class="hljs-comment">// Set the subscription permission</span></li><li>};</li><li>
</li><li><span class="hljs-comment">// Create a subscriber</span></li><li><span class="hljs-keyword">try</span> {</li><li>  commonEventManager.<span class="hljs-title function_">createSubscriber</span>(subscribeInfo, <span class="hljs-function">(<span class="hljs-params">err, commonEventSubscriber</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'createSubscriber'</span>);</li><li>      subscriber = commonEventSubscriber;</li><li>      <span class="hljs-comment">//Subscribe to public events</span></li><li>      <span class="hljs-keyword">try</span> {</li><li>        commonEventManager.<span class="hljs-title function_">subscribe</span>(subscriber, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (err) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`subscribe failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">//Event processing after receiving public events</span></li><li>            <span class="hljs-comment">// doSomeDangerousThing(data)</span></li><li>          }</li><li>        });</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`subscribe failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`createSubscriber failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`createSubscriber failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/PublicSensitive.ets#L22-L57" target="_blank">PublicSensitive.ets</a></div></div></div></div> </div> <p>常见敏感功能和对外提供的公共事件存在利用风险。建议对涉及这些情况的公共事件设置权限保护。</p> <p>1）未经用户确认，系统可执行关键操作，如发送短信、拨打电话、拍照、录音、录屏、截屏、定位等。</p> <p>2）导致个人数据和敏感数据泄露的关键操作包括：读取短信、读取联系人、读取设备标识符等。</p> <p>3）导致权限提升，例如：进行原本需要system权限的操作。</p> <p><strong>例外情况：</strong>必须对外提供且无利用风险的应用公共事件，可以不设置权限。</p> </div> <div class="tiledSection"><h2 id="section1154573694115">WebView安全<i class="anchor-icon anchor-icon-link" anchorid="section1154573694115" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1113104054110" class="firsth2">避免加载不安全的URL或页面<i class="anchor-icon anchor-icon-link" anchorid="section1113104054110" tips="复制节点链接"></i></h3><p>Web组件或WebController均可以加载URL或页面。如果加载的URL或页面被攻击者控制，可能会加载恶意JS代码，从而调用ArkTS开放的敏感JS接口，获取用户个人数据或对应用进行攻击。</p> <p>需要在加载URL之前，通过Web组件的onLoadIntercept()方法拦截URL，获取并校验其字段值是否在业务预置的白名单内。</p> <p><strong>正确示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/WebUrlSafe.ets#L21-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { uri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Check function</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkUrl</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">let</span> tmpUri = <span class="hljs-keyword">new</span> uri.<span class="hljs-title function_">URI</span>(str);</li><li>  <span class="hljs-keyword">let</span> res =</li><li>    tmpUri.<span class="hljs-title function_">normalize</span>(); <span class="hljs-comment">// Note that you need to normalize tmpUri first. Otherwise, security verification will be bypassed</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.scheme:'</span> + res.<span class="hljs-property">scheme</span>); <span class="hljs-comment">// Protocol</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.host:'</span> + res.<span class="hljs-property">host</span>); <span class="hljs-comment">// domain name</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.port:'</span> + res.<span class="hljs-property">port</span>); <span class="hljs-comment">// Ports</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.path:'</span> + res.<span class="hljs-property">path</span>); <span class="hljs-comment">// Path</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.ssp:'</span> + res.<span class="hljs-property">ssp</span>);</li><li>  <span class="hljs-comment">// After obtaining the values of scheme, host, port, and path, perform security verification based on the actual service</span></li><li>  <span class="hljs-comment">// Omit the part here. Perform the verification based on service requirements</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-string">'校验成功'</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'loadUrl'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-string">'www.huawei.com'</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">50</span> })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.huawei.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onLoadIntercept</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'onLoadIntercept:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>());</li><li>          <span class="hljs-keyword">let</span> tempUrl = event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>();</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-title function_">checkUrl</span>(tempUrl); <span class="hljs-comment">// Return true to block the load, otherwise allow the load</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/WebUrlSafe.ets#L21-L63" target="_blank">WebUrlSafe.ets</a></div></div></div></div> <p><strong>例外：</strong>如果应用本身是提供URL加载能力的，譬如浏览器等，可以例外。但是要注意，如果应用也提供了敏感的JS接口，要注意防范可能的被恶意调用的风险。</p> </div> <div class="tiledSection"><h3 id="section87224215429">避免加载不可信的JavaScript脚本<i class="anchor-icon anchor-icon-link" anchorid="section87224215429" tips="复制节点链接"></i></h3><p>WebController提供了runJavaScript()和runJavaScriptExt()函数用于异步执行JavaScript脚本，并通过回调方式返回脚本执行的结果。以runJavaScript为例：</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/RunJavaScriptTrustList.ets#L22-L56" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> whiteMethods = [<span class="hljs-string">'test()'</span>, <span class="hljs-string">'test1()'</span>];</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">jsMethod</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'alert(`xss`)'</span>; <span class="hljs-comment">// Externally controllable fields</span></li><li>          <span class="hljs-comment">// Check the trustlist</span></li><li>          <span class="hljs-keyword">if</span> (whiteMethods.<span class="hljs-title function_">indexOf</span>(jsMethod) === -<span class="hljs-number">1</span>) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'input method not in whiteList'</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">runJavaScript</span>(jsMethod)</li><li>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'result: '</span> + result);</li><li>            })</li><li>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`ErrorCode: <span class="hljs-subst">${error.code}</span>,  Message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>          <span class="hljs-keyword">if</span> (e) {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'url: '</span>, e.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/RunJavaScriptTrustList.ets#L22-L56" target="_blank">RunJavaScriptTrustList.ets</a></div></div></div></div> <p>加载的index.html文件内容如下：</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/resources/rawfile/index.html#L9-L21" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml">Hello world!</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span></span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Ark WebComponent'</span>)</span></li><li><span class="language-xml">        <span class="hljs-keyword">return</span> <span class="hljs-string">"This value is from index.html"</span></span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/resources/rawfile/index.html#L9-L21" target="_blank">index.html</a></div></div></div></div> <p>如果加载的脚本内容不可信，可能会导致恶意JavaScript代码的加载，引发XSS攻击。若Web组件注册了敏感的JavaScript接口，恶意代码还可能调用这些接口，进一步影响应用的安全性。</p> <p>若待加载的JavaScript脚本外部可控，加载前需进行白名单校验。</p> <div class="p"><strong>正确示例：</strong><div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/RunJavaScript.ets#L22-L49" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-string">'test()'</span>)</li><li>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'result: '</span> + result);</li><li>            })</li><li>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`ErrorCode: <span class="hljs-subst">${error.code}</span>,  Message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>          <span class="hljs-keyword">if</span> (e) {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'url: '</span>, e.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/RunJavaScript.ets#L22-L49" target="_blank">RunJavaScript.ets</a></div></div></div></div> </div> <p><strong>错误示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/RunJavaScriptTrustList.ets#L22-L50" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">jsMethod</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'alert(`xss`)'</span> <span class="hljs-comment">// Externally controllable fields</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">runJavaScript</span>(jsMethod)</li><li>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'result: '</span> + result);</li><li>            })</li><li>            .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`ErrorCode: <span class="hljs-subst">${error.code}</span>,  Message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>          <span class="hljs-keyword">if</span> (e) {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'url: '</span>, e.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/RunJavaScriptTrustList.ets#L22-L50" target="_blank">RunJavaScriptTrustList.ets</a></div></div></div></div> <p></p> </div> <div class="tiledSection"><h3 id="section4947114114317">避免将mixedMode属性配置成All<i class="anchor-icon anchor-icon-link" anchorid="section4947114114317" tips="复制节点链接"></i></h3><p>mixedMode设置是否允许加载超文本传输协议（HTTP）和超文本传输安全协议（HTTPS）混合内容，默认不允许加载HTTP和HTTPS混合内容。支持三种模式，其中All是允许混合内容加载，存在中间人攻击的风险，默认不允许配置成All。</p> <p><strong>错误示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/MixedMode.ets#L22-L35" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Web</span>({ <span class="hljs-variable">src</span>:<span class="hljs-string">'www.huawei.com'</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span> })</li><li>        .<span class="hljs-title function_">mixedMode</span>(<span class="hljs-variable">MixedMode</span>.<span class="hljs-variable">All</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/MixedMode.ets#L22-L35" target="_blank">MixedMode.ets</a></div></div></div></div> <p>应该去掉此配置项，或者选择MixedMode.None模式。</p> <p><strong>例外：</strong>对于提供特定业务的应用可以例外，例如浏览器。</p> <p></p> </div> <div class="tiledSection"><h3 id="section1256314434316">避免在SSL校验出错时继续加载页面<i class="anchor-icon anchor-icon-link" anchorid="section1256314434316" tips="复制节点链接"></i></h3><p>onSslErrorEventReceive()回调函数用于通知用户加载资源时发生SSL错误。</p> <p>当Web组件通过SSL协议进行网络请求时，默认情况下，如果底层Web组件校验服务端返回的证书或协议出错，则应取消请求，以避免中间人攻击风险。</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/OnSslErrorEventReceive.ets#L22-L39" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onSslErrorEventReceive</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'ssl check failed,error is : '</span> + event.<span class="hljs-property">error</span>.<span class="hljs-title function_">toString</span>());</li><li>          event.<span class="hljs-property">handler</span>.<span class="hljs-title function_">handleCancel</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/OnSslErrorEventReceive.ets#L22-L39" target="_blank">OnSslErrorEventReceive.ets</a></div></div></div></div> <p><strong>错误示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/OnSslErrorEventReceive.ets#L22-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onSslErrorEventReceive</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          event.<span class="hljs-property">handler</span>.<span class="hljs-title function_">handleConfirm</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/OnSslErrorEventReceive.ets#L22-L37" target="_blank">OnSslErrorEventReceive.ets</a></div></div></div></div> <p>如果在SSL校验出错时直接调用handleConfirm()函数，页面将忽略SSL错误并继续加载，从而导致中间人攻击等风险。</p> <p><strong>例外：</strong>对于浏览器等用于加载URL的应用可以例外，但需要在页面显式告知用户待加载页面存在安全风险。</p> <p></p> </div> <div class="tiledSection"><h3 id="section12671987440">避免在用户同意前返回位置信息<i class="anchor-icon anchor-icon-link" anchorid="section12671987440" tips="复制节点链接"></i></h3><p>geolocationAccess开关用于配置是否开启地理位置权限，默认开启。onGeolocationShow()回调函数用于通知用户收到地理位置信息获取请求。H5页面请求获取地理位置信息时，Web组件通过上述两个API进行配置。</p> <p>无使用场景时，显式禁用geolocationAccess()。存在使用场景时，需在onGeolocationShow()回调内先弹框提示用户，经用户确认和同意后才能返回位置信息，否则存在隐私泄露风险。</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/GeolocationAccess.ets#L22-L53" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">geolocationAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onGeolocationShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event === <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-title class_">AlertDialog</span>.<span class="hljs-title function_">show</span>({</li><li>            <span class="hljs-attr">title</span>: <span class="hljs-string">'title'</span>,</li><li>            <span class="hljs-attr">message</span>: <span class="hljs-string">'text'</span>,</li><li>            <span class="hljs-attr">confirm</span>: {</li><li>              <span class="hljs-attr">value</span>: <span class="hljs-string">'onConfirm'</span>,</li><li>              <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                event.<span class="hljs-property">geolocation</span>.<span class="hljs-title function_">invoke</span>(event.<span class="hljs-property">origin</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);</li><li>              }</li><li>            },</li><li>            <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              event.<span class="hljs-property">geolocation</span>.<span class="hljs-title function_">invoke</span>(event.<span class="hljs-property">origin</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);</li><li>            }</li><li>          });</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/GeolocationAccess.ets#L22-L53" target="_blank">GeolocationAccess.ets</a></div></div></div></div> <p><strong>错误示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/GeolocationAccess.ets#L22-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">geolocationAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onGeolocationShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event === <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          event.<span class="hljs-property">geolocation</span>.<span class="hljs-title function_">invoke</span>(event.<span class="hljs-property">origin</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/GeolocationAccess.ets#L22-L41" target="_blank">GeolocationAccess.ets</a></div></div></div></div> <p>在使用位置权限的场景中，不能直接返回位置信息。必须先明确告知用户并获得其同意后，才能返回位置信息。</p> </div> <div class="tiledSection"><h3 id="section20515337164412">避免注册返回含有全局认证凭据的JavaScriptProxy<i class="anchor-icon anchor-icon-link" anchorid="section20515337164412" tips="复制节点链接"></i></h3><p>在HarmonyOS中，可以使用Web组件加载H5等页面。同时Web组件可以通过JavaScriptProxy()方法或者通过WebController的registerJavaScriptProxy()方法向H5提供JS接口，供H5访问。</p> <p>如果提供的JS接口返回敏感信息或涉及敏感操作，被恶意调用，则存在安全风险。特别是当JS接口返回用于认证用户身份的全局认证凭据ServiceToken（简称ST）或AccessToken（简称AT）时，攻击者获取这些凭据后，可以冒充用户恶意调用应用在云端的所有接口，扩大攻击影响。因此，禁止Web组件提供获取全局认证凭据ST或AT的JavaScriptProxy。</p> <p><strong>错误示例：</strong></p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/JavaScriptProxy.ets#L22-L60" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">webview</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">webview</span>.<span class="hljs-title class_">WebviewController</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">webview</span>.<span class="hljs-title function_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Row</span>() {</li><li>        <span class="hljs-title function_">Button</span>(<span class="hljs-string">'registerJavaScriptProxy'</span>).<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">registerJavaScriptProxy</span>(</li><li>            {</li><li>              <span class="hljs-variable">getServiceToken</span>: () =&gt; {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>              }</li><li>            },</li><li>            <span class="hljs-string">'objName'</span>,</li><li>            [<span class="hljs-string">'getServiceToken'</span>],</li><li>          );</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">refresh</span>();</li><li>        })</li><li>      }</li><li>
</li><li>      <span class="hljs-title function_">Web</span>({ <span class="hljs-variable">src</span>: $<span class="hljs-title class_">rawfile</span>('<span class="hljs-title class_">H5CallETS</span>.<span class="hljs-title class_">html</span>'), <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-keyword">true</span>)</li><li>        .<span class="hljs-title function_">javaScriptProxy</span>({</li><li>          <span class="hljs-variable">object</span>: {</li><li>            <span class="hljs-variable">getServiceToken</span>: () =&gt; {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>            }</li><li>          },</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-string">'objName'</span>,</li><li>          <span class="hljs-variable">methodList</span>: [<span class="hljs-string">'getServiceToken'</span>],</li><li>          <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/JavaScriptProxy.ets#L22-L60" target="_blank">JavaScriptProxy.ets</a></div></div></div></div> <p>H5攻击界面：</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php-template" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/resources/rawfile/H5CallETS.html#L22-L37" data-highlighted="yes"><ol class="linenums"><li><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml">Hello js call ets interface!</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span></span></li><li><span class="language-xml">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">callJSInt</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-xml">        <span class="hljs-keyword">let</span> <span class="hljs-variable constant_">ST</span> = objName.<span class="hljs-title function_">getServiceToken</span>();</span></li><li><span class="language-xml">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'wzz:ST = '</span>+ <span class="hljs-variable constant_">ST</span>);</span></li><li><span class="language-xml">        <span class="hljs-title function_">alert</span>(<span class="hljs-variable constant_">ST</span>);</span></li><li><span class="language-xml">    }</span></li><li><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"callJSInt()"</span>&gt;</span>get ST<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span></li><li><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/resources/rawfile/H5CallETS.html#L22-L37" target="_blank">H5CallETS.html</a></div></div></div></div> <p>提供了一个ST接口，用于H5调用以获取全局认证凭据。如果H5存在漏洞，攻击者可能获取此ST并冒充用户访问云服务上的个人数据，进行恶意操作。</p> <p>为了降低全局认证凭据ST或AT丢失带来的安全风险，推荐以下两种方法：</p> <p><strong>第一种方法：</strong>在加载URL页面前，校验当前页面的URL是否在白名单内，仅允许白名单内的URL调用。要同时校验协议、域名、PATH等，白名单范围控制的越小越安全。</p> <p>校验方法可使用如下API格式化相关URL，跟预置的数据进行比较。</p> <p>1. 使用URI库进行URL格式化，准确获取URL各字段值，并校验这些值是否在业务预置的白名单内。</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/TrustListCheck.ets#L22-L84" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { uri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Check function</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkUrl</span>(<span class="hljs-params">surl: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">tmpUri</span>: uri.<span class="hljs-property">URI</span> = <span class="hljs-keyword">new</span> uri.<span class="hljs-title function_">URI</span>(surl);</li><li>  <span class="hljs-keyword">let</span> res = tmpUri.<span class="hljs-title function_">normalize</span>(); <span class="hljs-comment">// Note that you need to normalize tmpUri first. Otherwise, security verification will be bypassed</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.scheme:'</span> + res.<span class="hljs-property">scheme</span>); <span class="hljs-comment">// scheme</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.host:'</span> + res.<span class="hljs-property">host</span>); <span class="hljs-comment">// host</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.port:'</span> + res.<span class="hljs-property">port</span>); <span class="hljs-comment">// port</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.path:'</span> + res.<span class="hljs-property">path</span>); <span class="hljs-comment">// path</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.ssp:'</span> + res.<span class="hljs-property">ssp</span>);</li><li>  <span class="hljs-comment">// After obtaining the values of the scheme, host, port, and path parameters, perform security verification based on the service requirements</span></li><li>  <span class="hljs-comment">// The part is omitted here. The verification is performed based on the service requirements</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-string">'校验成功'</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'registerJavaScriptProxy'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">registerJavaScriptProxy</span>(</li><li>            {</li><li>              <span class="hljs-attr">getServiceToken</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>              }</li><li>            },</li><li>            <span class="hljs-string">'objName'</span>,</li><li>            [<span class="hljs-string">'getServiceToken'</span>],</li><li>          );</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">refresh</span>();</li><li>        })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'H5CallETS.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptProxy</span>({</li><li>          <span class="hljs-attr">object</span>: {</li><li>            <span class="hljs-attr">getServiceToken</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>            }</li><li>          },</li><li>          <span class="hljs-attr">name</span>: <span class="hljs-string">'objName'</span>,</li><li>          <span class="hljs-attr">methodList</span>: [<span class="hljs-string">'getServiceToken'</span>],</li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span></li><li>        })</li><li>        .<span class="hljs-title function_">onLoadIntercept</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'onLoadIntercept:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>());</li><li>          <span class="hljs-keyword">let</span> tempUrl = event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>();</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-title function_">checkUrl</span>(tempUrl); <span class="hljs-comment">// Returns true to block the load, otherwise allow the load</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/TrustListCheck.ets#L22-L84" target="_blank">TrustListCheck.ets</a></div></div></div></div> <div class="p">2. 使用URL库进行URL格式化，准确获取URL各字段值并校验是否在业务预置的白名单内。<div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/UrlListCheck.ets#L22-L84" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { url } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Check Function</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkUrl</span>(<span class="hljs-params">surl: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">let</span> tmpUrl = url.<span class="hljs-property">URL</span>.<span class="hljs-title function_">parseURL</span>(surl);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.scheme:'</span> + tmpUrl.<span class="hljs-property">protocol</span>); <span class="hljs-comment">// scheme</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.host:'</span> + tmpUrl.<span class="hljs-property">host</span>); <span class="hljs-comment">// host</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.port:'</span> + tmpUrl.<span class="hljs-property">port</span>); <span class="hljs-comment">// port</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.path:'</span> + tmpUrl.<span class="hljs-property">pathname</span>); <span class="hljs-comment">// path</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'res.ssp:'</span> + tmpUrl.<span class="hljs-property">hostname</span>); <span class="hljs-comment">// ssp</span></li><li>  <span class="hljs-comment">// After obtaining the values of the scheme, host, port, and path parameters, perform security verification based on the service requirements</span></li><li>  <span class="hljs-comment">// The part is omitted here. The verification is performed based on the service requirements</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-string">'校验成功'</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'registerJavaScriptProxy'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">registerJavaScriptProxy</span>(</li><li>            {</li><li>              <span class="hljs-attr">getServiceToken</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>              }</li><li>            },</li><li>            <span class="hljs-string">'objName'</span>,</li><li>            [<span class="hljs-string">'getServiceToken'</span>]</li><li>          );</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">refresh</span>();</li><li>        })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'H5CallETS.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">javaScriptProxy</span>({</li><li>          <span class="hljs-attr">object</span>: {</li><li>            <span class="hljs-attr">getServiceToken</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-string">'DLFJSLDFJALGJLDFJSDDFISLDF323LSDJFLS212DLSFJOEV'</span>;</li><li>            }</li><li>          },</li><li>          <span class="hljs-attr">name</span>: <span class="hljs-string">'objName'</span>,</li><li>          <span class="hljs-attr">methodList</span>: [<span class="hljs-string">'getServiceToken'</span>],</li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span></li><li>        })</li><li>        .<span class="hljs-title function_">onLoadIntercept</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'wzz:onLoadIntercept:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>());</li><li>          <span class="hljs-keyword">let</span> tempUrl = event.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>();</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-title function_">checkUrl</span>(tempUrl); <span class="hljs-comment">// Returns true to block the load, otherwise allow the load</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/UrlListCheck.ets#L22-L84" target="_blank">UrlListCheck.ets</a></div></div></div></div> </div> <p><strong>第二种方法：</strong>针对H5页面申请一个新的H5Token，并严格限定此H5Token可以调用的云服务业务接口在最小范围内。</p> </div> <div class="tiledSection"><h2 id="section285164844514">数据传递安全<i class="anchor-icon anchor-icon-link" anchorid="section285164844514" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section16864711174616" class="firsth2">建议对跨信任边界传入的Want进行合法性判断<i class="anchor-icon anchor-icon-link" anchorid="section16864711174616" tips="复制节点链接"></i></h3><p>攻击者可能向指定应用Ability发送空的Want或携带恶意数据。如果应用接收这些Want，却没有进行合法性判断，可能会导致应用业务逻辑被篡改、数据泄露或财产损失。因此，应对外部传入的Want内容进行合法性判断。</p> <p>常见的对Want的判断：</p> <div class="p">1.  在使用Want的数据属性之前，先判断其是否为null或undefined，确保访问的对象属性存在。<div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/CheckWantOne.ets#L23-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">AbilityConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Check function</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkWant</span>(<span class="hljs-params">want: Want</span>) {</li><li>  <span class="hljs-keyword">if</span> (want === <span class="hljs-literal">null</span> || want.<span class="hljs-property">parameters</span> === <span class="hljs-literal">null</span></li><li>    || want === <span class="hljs-literal">undefined</span> || want.<span class="hljs-property">parameters</span> === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-keyword">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkWant</span>(want)) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'invalid want'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'correct want'</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/CheckWantOne.ets#L23-L44" target="_blank">CheckWantOne.ets</a></div></div></div></div> </div> <div class="p">2.  使用Want的数据前，进行try...catch异常捕获，以防止应用崩溃，并且可以定位问题。<div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/CheckWantTwo.ets#L22-L48" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">AbilityConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// Check function</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkWant</span>(<span class="hljs-params">want: Want</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">if</span> (want.<span class="hljs-property">parameters</span>) {</li><li>      <span class="hljs-keyword">let</span> param = want.<span class="hljs-property">parameters</span>[<span class="hljs-string">'test'</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Want</span>;</li><li>      <span class="hljs-keyword">let</span> str = param.<span class="hljs-property">uri</span>;</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'get uri string: '</span> + str);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-keyword">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkWant</span>(want)) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'invalid want'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'correct want'</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/CheckWantTwo.ets#L22-L48" target="_blank">CheckWantTwo.ets</a></div></div></div></div> </div> <p>应用获取外部不可信Want的方式有很多种，例如：</p> <p>在不同场景下，获取Want的方式如下：</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/WantScene.ts#L26-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Application life cycle:</span></li><li><span class="hljs-comment">// @ohos.application.AbilityStage.d.ts</span></li><li><span class="hljs-title function_">onAcceptWant</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-title class_">string</span>;</li><li><span class="hljs-comment">// ability life cycle：</span></li><li><span class="hljs-comment">// @ohos.application.Ability.d.ts</span></li><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">param</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span>;</li><li><span class="hljs-title function_">onContinue</span>(<span class="hljs-variable">wantParam</span>: {}): <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">OnContinueResult</span>;</li><li><span class="hljs-title function_">onNewWant</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParams</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span>;</li><li><span class="hljs-comment">// ServiceExtensionAbility life cycle：</span></li><li><span class="hljs-comment">// @ohos.application.ServiceExtensionAbility.d.ts</span></li><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-title class_">void</span>;</li><li><span class="hljs-title function_">onRequest</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">startId</span>: <span class="hljs-title class_">number</span>): <span class="hljs-title class_">void</span>;</li><li><span class="hljs-title function_">onConnect</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-title class_">rpc</span>.<span class="hljs-title class_">RemoteObject</span>;</li><li><span class="hljs-title function_">onDisconnect</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-title class_">void</span>;</li><li><span class="hljs-title function_">onReconnect</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-title class_">void</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/privacy/src/main/ets/pages/WantScene.ts#L26-L40" target="_blank">WantScene.ts</a></div></div></div></div> <p></p> </div> <div class="tiledSection"><h2 id="section13519110134719">数据存储安全<i class="anchor-icon anchor-icon-link" anchorid="section13519110134719" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1927111334714" class="firsth2">避免直接使用不可信数据来拼接SQL语句<i class="anchor-icon anchor-icon-link" anchorid="section1927111334714" tips="复制节点链接"></i></h3><p>SQL注入是指对用户输入数据的合法性没有判断或过滤不严。攻击者可以传入特定内容，将应用事先定义好的语句变成含义完全不同的SQL语句，导致信息泄露或数据篡改。</p> <p>任何外部的输入，包括用户的输入，都是不安全的，需要对外部输入的数据进行过滤处理。</p> <p>HarmonyOS系统提供的关系型数据库基于SQLite组件，可以直接运行用户输入的SQL语句。如果不可信的数据用于拼接SQL语句，就存在SQL注入的风险。应使用参数化查询的方式或对不可信内容进行过滤。</p> <p>HarmonyOS上querySql和executeSql会被用于拼接SQL语句的执行。</p> <p>示例中的context的获取方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息" target="_blank">获取UIAbility的上下文信息</a>。</p> <div class="p"><strong>错误示例：</strong><div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/UntrustedDataToSQL.ets#L22-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span></li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-comment">// The sql parameters are from external input</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">exesql</span>(<span class="hljs-params">sql: string</span>) {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">STORE_CONFIG</span>: relationalStore.<span class="hljs-property">StoreConfig</span> = {</li><li>    <span class="hljs-attr">name</span>: <span class="hljs-string">'RdbTest.db'</span>,</li><li>    <span class="hljs-attr">securityLevel</span>: relationalStore.<span class="hljs-property">SecurityLevel</span>.<span class="hljs-property">S1</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">store</span>: relationalStore.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, rdbStore: relationalStore.RdbStore</span>) =&gt;</span> {</li><li>    store = rdbStore;</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`Get RdbStore failed, code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'Get RdbStore successfully.'</span>);</li><li>  })</li><li>  <span class="hljs-comment">// The external input is used to directly concatenate the SQL statement, and the verification is not performed</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable constant_">SQL_DELETE_TABLE</span> = <span class="hljs-string">'DELETE FROM test WHERE name = '</span> + sql;</li><li>  <span class="hljs-keyword">if</span> (store != <span class="hljs-literal">undefined</span>) {</li><li>    (store <span class="hljs-keyword">as</span> relationalStore.<span class="hljs-property">RdbStore</span>).<span class="hljs-title function_">executeSql</span>(<span class="hljs-variable constant_">SQL_DELETE_TABLE</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">`ExecuteSql failed, code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'Delete table done.'</span>);</li><li>    })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/UntrustedDataToSQL.ets#L22-L57" target="_blank">UntrustedDataToSQL.ets</a></div></div></div></div> </div> <p>如果直接使用用户输入作为查询参数，恶意用户可以输入类似“1' OR 'a' = 'a”的字符串，导致 SQL 语句变为select * from book where name='1' OR 'a' = 'a'，从而引发 SQL 注入攻击。因此，禁止直接使用外部输入作为查询字符串的一部分，或者在拼接 SQL 语句之前，对外部输入进行字符校验。</p> </div> <div class="tiledSection"><h3 id="section156969911505">避免将个人数据存放到剪贴板中<i class="anchor-icon anchor-icon-link" anchorid="section156969911505" tips="复制节点链接"></i></h3><p>剪贴板是指操作系统提供的一个暂存数据并提供共享的模块，也称为数据中转站。剪贴板在后台起作用，存放在内存里。</p> <p>如果将个人数据放入剪贴板中是不安全的，因为任意程序都可以访问剪贴板中的内容。</p> <p>将内容存放入剪贴板的方法有SystemPasteboard类中的setPasteData()方法。</p> <p><strong>例外：</strong>如果是用户自己主动以剪切板作为中转，拷贝数据，则不受此规则约束。</p> </div> <div class="tiledSection"><h3 id="section1798510289507">避免使用未校验的外部数据拼接文件路径<i class="anchor-icon anchor-icon-link" anchorid="section1798510289507" tips="复制节点链接"></i></h3><p>HarmonyOS系统对文件存储进行了沙箱隔离。内部存储的文件仅应用程序有权限读取，且仅限于本应用的内部存储目录。若需读取外部共享存储，则必须添加读取权限。</p> <p>在对文件进行读、写、下载、删除等操作时，如果使用外部输入拼接文件路径，攻击者可能注入恶意字符（如../）进行跨目录攻击，导致数据泄露或应用拒绝服务等安全问题。因此，拼接路径前需校验外部输入，确保其不包含恶意字符。</p> <div class="screenLinkPre"><div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/UntrustedDataToSQL.ets#L66-L76" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// The fileName is from external</span></li><li><span class="hljs-function">function <span class="hljs-title">readFile</span>(<span class="hljs-params">fileName: <span class="hljs-built_in">string</span></span>)</span> {</li><li>  <span class="hljs-keyword">let</span> filePath = <span class="hljs-string">'/data/storage/'</span>;</li><li>  <span class="hljs-keyword">if</span> (fileName.indexOf(<span class="hljs-string">'..'</span>) === <span class="hljs-number">-1</span>) { <span class="hljs-comment">// Anti-splicing verification</span></li><li>    <span class="hljs-keyword">let</span> fileAllPath: <span class="hljs-built_in">string</span> = filePath + fileName;</li><li>    <span class="hljs-comment">// Service processing</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.info(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'privacy'</span>, <span class="hljs-string">'be attacked'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/Privacy/PrivacyError/src/main/ets/pages/UntrustedDataToSQL.ets#L66-L76" target="_blank">UntrustedDataToSQL.ets</a></div></div></div></div> <p></p> </div> <div class="tiledSection"><h2 id="section10527184615537">配置安全<i class="anchor-icon anchor-icon-link" anchorid="section10527184615537" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section469175205113" class="firsth2">建议正确设置发布版本应用调试属性<i class="anchor-icon anchor-icon-link" anchorid="section469175205113" tips="复制节点链接"></i></h3><p>"debug"属性是为了方便开发人员对应用进行调试，但对于正式发布版本，如果应用设置为可调试模式，方便了攻击者对应用进行更深入的分析调试，不利于对应用的保护，因此要求正式版本须设置为不可调试模式。</p> <p>对"debug"的设置需要在app.json5文件中进行配置。其中"debug"属性缺省值为false。</p> <p><strong>错误示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// app.json5   </span></li><li>{  </li><li>    <span class="hljs-string">"app"</span>: {  </li><li>        <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.application.music"</span>,  </li><li>        <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"application"</span>,  </li><li>        <span class="hljs-string">"versionCode"</span>: <span class="hljs-number">1</span>,  </li><li>        <span class="hljs-string">"versionName"</span>: <span class="hljs-string">"1.0"</span>,  </li><li>        <span class="hljs-string">"minCompatibleVersionCode"</span>: <span class="hljs-number">1</span>,  </li><li>        <span class="hljs-string">"minAPIVersion"</span>: <span class="hljs-number">7</span>,  </li><li>        <span class="hljs-string">"targetAPIVersion"</span>: <span class="hljs-number">8</span>,  </li><li>        <span class="hljs-string">"apiReleaseType"</span>: <span class="hljs-string">"Release"</span>,  </li><li>        <strong><span class=""><span class="hljs-string">"debug"</span>: <span class="hljs-keyword">true</span></span>, <span class="hljs-comment">// debug字段设置 </span></strong></li><li>        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:app_icon"</span>,  </li><li>        <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:app_name"</span>,  </li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:description_application"</span>,  </li><li>        <span class="hljs-string">"distributedNotificationEnabled"</span>: <span class="hljs-keyword">true</span>,  </li><li>        <span class="hljs-string">"entityType"</span>: <span class="hljs-string">"game"</span>,  </li><li>        <span class="hljs-string">"car"</span>: {  </li><li>            <span class="hljs-string">"apiCompatibleVersion"</span>: <span class="hljs-number">8</span>  </li><li>        }  </li><li>    }  </li><li>} </li></ol></pre></div></div> <p><strong>正确示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// app.json5   </span></li><li>{  </li><li>    <span class="hljs-string">"app"</span>: {  </li><li>        <span class="hljs-string">"bundleName"</span>: <span class="hljs-string">"com.application.music"</span>,  </li><li>        <span class="hljs-string">"vendor"</span>: <span class="hljs-string">"application"</span>,  </li><li>        <span class="hljs-string">"versionCode"</span>: <span class="hljs-number">1</span>,  </li><li>        <span class="hljs-string">"versionName"</span>: <span class="hljs-string">"1.0"</span>,  </li><li>        <span class="hljs-string">"minCompatibleVersionCode"</span>: <span class="hljs-number">1</span>,  </li><li>        <span class="hljs-string">"minAPIVersion"</span>: <span class="hljs-number">7</span>,  </li><li>        <span class="hljs-string">"targetAPIVersion"</span>: <span class="hljs-number">8</span>,  </li><li>        <span class="hljs-string">"apiReleaseType"</span>: <span class="hljs-string">"Release"</span>,  </li><li>        <span class=""><span class="hljs-string">"debug"</span>: <span class="hljs-keyword">false</span>,</span>  </li><li>        <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:app_icon"</span>,  </li><li>        <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:app_name"</span>,  </li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"$string:description_application"</span>,  </li><li>        <span class="hljs-string">"distributedNotificationEnabled"</span>: <span class="hljs-keyword">true</span>,  </li><li>        <span class="hljs-string">"entityType"</span>: <span class="hljs-string">"game"</span>,  </li><li>        <span class="hljs-string">"car"</span>: {  </li><li>            <span class="hljs-string">"apiCompatibleVersion"</span>: <span class="hljs-number">8</span>  </li><li>        }  </li><li>    }  </li><li>}  </li></ol></pre></div></div> <p></p> </div> <div class="tiledSection"><h3 id="section154964228510">建议发布的软件包进行代码混淆<i class="anchor-icon anchor-icon-link" anchorid="section154964228510" tips="复制节点链接"></i></h3><p>鸿蒙应用软件包（HAP、HAR、HSP）可以被反编译。配置代码混淆，增加攻击者分析代码的成本。</p> <p><strong>正确示例，开启属性混淆例子：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># Define project specific obfuscation rules here.</span></li><li><span class="hljs-comment"># You can include the obfuscation configuration files in the current module's build-profile.json5.</span></li><li><span class="hljs-comment">#</span></li><li><span class="hljs-comment"># For more details, see</span></li><li><span class="hljs-comment">#   https://gitee.com/openharmony/arkcompiler_ets_frontend/blob/master/arkguard/README.md</span></li><li>   </li><li><span class="hljs-comment"># Obfuscation options:</span></li><li><span class="hljs-comment"># -disable-obfuscation: disable all obfuscations</span></li><li><span class=""><span class="hljs-comment"># 开启对象属性混淆</span></span></li><li><span class="">-enable-<span class="hljs-built_in">property</span>-obfuscation: obfuscate the <span class="hljs-built_in">property</span> names</span></li><li><span class="hljs-comment"># -enable-toplevel-obfuscation: obfuscate the names in the global scope</span></li><li><span class="hljs-comment"># -compact: remove unnecessary blank spaces and all line feeds</span></li><li><span class="hljs-comment"># -remove-log: remove all console.* statements</span></li><li><span class="hljs-comment"># -print-namecache: print the name cache that contains the mapping from the old names to new names</span></li><li><span class="hljs-comment"># -apply-namecache: reuse the given cache file</span></li><li>
</li><li><span class="hljs-comment"># Keep options:</span></li><li><span class="hljs-comment"># -keep-property-name: specifies property names that you want to keep</span></li><li><span class="hljs-comment"># -keep-global-name: specifies names that you want to keep in the global scope   </span></li><li>
</li></ol></pre></div></div> <p>在应用源码工程obfuscation-rules.txt文件中，按照应用业务的需求配置和开启混淆规则。</p> <p></p> </div> <div class="tiledSection"><h3 id="section1916104511514">建议应用使用的依赖库处于最新状态<i class="anchor-icon anchor-icon-link" anchorid="section1916104511514" tips="复制节点链接"></i></h3><p>应用通常依赖外部第三方库和系统SDK来完成特定任务。及时更新这些依赖项，可增强应用的安全性。</p> <p>在发布应用前，请确保所有库、SDK 和其他依赖项均为最新版本。</p> <ul><li>对于SDK等第一方依赖项，当前SDK已嵌入DevEco Studio中，无需额外下载配置，请使用DevEco Studio最新版本。</li><li>对于第三方依赖项，请检查您的应用所用库的网站，并安装所有可用的更新和安全补丁。</li></ul> <p></p> </div> <div class="tiledSection"><h2 id="section14121320155411">应用签名安全<i class="anchor-icon anchor-icon-link" anchorid="section14121320155411" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section562055715517" class="firsth2">避免正式版本应用使用debug调试签名<i class="anchor-icon anchor-icon-link" anchorid="section562055715517" tips="复制节点链接"></i></h3><p>在HarmonyOS应用打包时，可以选择debug和release两种模式。debug模式的应用便于开发者进行调试。然而，在正式发布版本中，若应用设置为可调试模式，将增加攻击者分析调试应用的风险，不利于应用的安全保护。因此，正式发布的应用必须使用release模式并禁止使用debug签名。</p> <p>注意：DevEco Studio默认编译的hap应用为debug模式，不可直接用于商用版本。</p> </div> <div class="tiledSection"><h3 id="section64388132523">建议应用需保证签名完整性<i class="anchor-icon anchor-icon-link" anchorid="section64388132523" tips="复制节点链接"></i></h3><p>应用签名是保障应用完整性的关键。若因版本更新需对应用进行资源裁剪或字节调整，修改后必须重新签名，否则会破坏签名完整性。</p> <p>禁止应用破坏签名后上架或者直接预装到版本中。</p> </div> <div class="tiledSection"><h3 id="section9522428105216">建议应用在申请应用证书时不使用个人信息<i class="anchor-icon anchor-icon-link" anchorid="section9522428105216" tips="复制节点链接"></i></h3><p>应用签名必须申请签名证书。申请证书时需要输入开发者信息和公司信息。该证书是应用的身份标识和认证凭据。签名时，证书会嵌入到应用包，成为应用包数据结构的一部分。开发者可以通过公开的API或读取应用包数据结构获取应用证书信息。</p> <p>如果在证书信息中填写了姓名、工号等个人信息，将导致信息泄露，并可能引发质疑。证书信息应填写公司或团队名称，而不是个人信息。</p> <p></p> </div> <div class="tiledSection"><h3 id="section9566165615525">建议应用软件应包含的签名信息需要真实有效<i class="anchor-icon anchor-icon-link" anchorid="section9566165615525" tips="复制节点链接"></i></h3><p>预置应用软件必须包含真实有效的签名信息。对于非开源鸿蒙官方应用，不得使用开源鸿蒙公开证书，也不得使用与产品无关的签名信息，例如Demo等。应用开发者、公司和部门信息必须真实有效，不得为网址、乱码等无效信息。签名证书应正确标识开发者身份，包括企业名称、组织、省市和国家等信息，不得包含与主体无关的信息。</p> <p><strong>错误示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">53</span> <span class="hljs-title class_">WARN</span>  - <span class="hljs-title class_">Missing</span> <span class="hljs-title class_">parameter</span>: <span class="hljs-title class_">outproof</span></li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">53</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Find</span> <span class="hljs-title class_">Hap</span> <span class="hljs-title class_">Signing</span> <span class="hljs-title class_">Block</span> <span class="hljs-title class_">success</span>, <span class="hljs-variable">version</span>: <span class="hljs-number">3</span>, <span class="hljs-variable">block</span> <span class="hljs-variable">count</span>: <span class="hljs-number">2</span></li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-title class_">INFO</span>  - +++++++++++++++++++++++++++<span class="hljs-title class_">certificate</span> #<span class="hljs-number">0</span> +++++++++++++++++++++++++++++++</li><li><strong><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Subject</span>: <span class="hljs-title class_">C</span>=<span class="hljs-variable">CN</span>, <span class="hljs-variable">O</span>=<span class="hljs-variable">Organization</span>, <span class="hljs-variable">OU</span>=<span class="hljs-keyword">Unit</span>, <span class="hljs-variable">CN</span>=<span class="hljs-variable">ide_demo_app</span> <span class="hljs-comment">// CN字段无法标识开发组织</span></strong></li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Issuer</span>: <span class="hljs-title class_">CN</span>=<span class="hljs-variable">OpenHarmony</span> <span class="hljs-variable">Application</span> <span class="hljs-variable">CA</span>, <span class="hljs-variable">OU</span>=<span class="hljs-variable">OpenHarmony</span> <span class="hljs-variable">Team</span>, <span class="hljs-variable">O</span>=<span class="hljs-variable">OpenHarmony</span>, <span class="hljs-variable">C</span>=<span class="hljs-variable">CN</span>       </li></ol></pre></div></div> <p><strong>正确示例：</strong></p> <div _ngcontent-ury-c106="" class="highlight-div"><div _ngcontent-ury-c106="" class="highlight-div-header"><div _ngcontent-ury-c106="" class="highlight-div-header-left"><div _ngcontent-ury-c106="" class="handle-button expand-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ury-c106="" class="highlight-div-header-right"><div _ngcontent-ury-c106="" class="handle-button ai-button"></div><div _ngcontent-ury-c106="" class="handle-button line-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ury-c106="" class="handle-button theme-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ury-c106="" class="handle-button copy-button"><div _ngcontent-ury-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ury-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">51</span>:<span class="hljs-number">54</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Issuer</span>: <span class="hljs-title class_">CN</span>=<span class="hljs-variable">OpenHarmony</span> <span class="hljs-variable">Application</span> <span class="hljs-variable">CA</span>, <span class="hljs-variable">OU</span>=<span class="hljs-variable">OpenHarmony</span> <span class="hljs-variable">Team</span>, <span class="hljs-variable">O</span>=<span class="hljs-variable">OpenHarmony</span>, <span class="hljs-variable">C</span>=<span class="hljs-variable">CN</span>  </li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span> <span class="hljs-title class_">WARN</span>  - <span class="hljs-title class_">Missing</span> <span class="hljs-title class_">parameter</span>: <span class="hljs-title class_">outproof</span></li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Find</span> <span class="hljs-title class_">Hap</span> <span class="hljs-title class_">Signing</span> <span class="hljs-title class_">Block</span> <span class="hljs-title class_">success</span>, <span class="hljs-variable">version</span>: <span class="hljs-number">3</span>, <span class="hljs-variable">block</span> <span class="hljs-variable">count</span>: <span class="hljs-number">2</span></li><li><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span> <span class="hljs-title class_">INFO</span>  - +++++++++++++++++++++++++++<span class="hljs-title class_">certificate</span> #<span class="hljs-number">0</span> +++++++++++++++++++++++++++++++</li><li><strong><span class="hljs-number">10</span>-<span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span> <span class="hljs-title class_">INFO</span>  - <span class="hljs-title class_">Subject</span>: <span class="hljs-title class_">CN</span>=<span class="hljs-variable">应用名称</span>, <span class="hljs-variable">OU</span>=<span class="hljs-variable">开发者组织</span>/<span class="hljs-variable">公司</span>/<span class="hljs-variable">部门</span>, <span class="hljs-variable">O</span>=<span class="hljs-variable">开发者组织</span>/<span class="hljs-variable">公司</span>/<span class="hljs-variable">部门</span>, <span class="hljs-variable">C</span>=<span class="hljs-variable">CN</span> <span class="hljs-comment">// CN字段标识开发组织</span></strong></li></ol></pre></div></div> <p></p> </div> </div></div>