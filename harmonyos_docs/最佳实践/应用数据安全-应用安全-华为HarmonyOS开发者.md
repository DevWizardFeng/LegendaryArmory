<h1 _ngcontent-aqm-c119="" class="doc-title ng-star-inserted" title="应用数据安全"> 应用数据安全 </h1>

<div _ngcontent-aqm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1245682816366">概述<i class="anchor-icon anchor-icon-link" anchorid="section1245682816366" tips="复制节点链接"></i></h2><p>应用的安全性是成功的关键。</p> <p>HarmonyOS提供系统安全、DevEco Studio工具安全和应用安全生态三个层面的安全能力。</p> <ul><li>在系统安全层面，HarmonyOS通过完整性保护、漏洞防利用和安全可信环境等技术，支持应用的安全运行，保证业务的安全可靠。</li><li>在DevEco Studio和工具层面，生态开发者提供的应用来自不同的开发者，用途各异。除了优质的生态应用外，还存在恶意牟利、黑产、诈骗、恶意营销广告推广（如恶意弹框）等各种风险应用。为确保生态应用的安全、纯净和可控，HarmonyOS将构建端到端的安全可控生态模式。</li><li>在应用安全生态方面，HarmonyOS通过多种软硬件基础设施保障应用的安全性。具体措施包括实现敏感数据存储和用户隐私保护：<ul><li>敏感数据等级划分：通过设备和数据等级划分，保护用户数据安全，确保分布式设备间数据正确流动。</li><li>文件分级保护：应用根据数据安全等级，保存到系统加密目录，确保数据安全。</li><li>关键资产数据加密保护：提供基于TEE的安全保护和管理API，开发者无需关注底层实现。</li></ul> </li></ul> <p>讨论应用安全生态层面的敏感数据存储和用户隐私保护。</p> </div> <div class="tiledSection"><h2 id="section3735185783613">风险等级划分<i class="anchor-icon anchor-icon-link" anchorid="section3735185783613" tips="复制节点链接"></i></h2><p>HarmonyOS安全能力以分级安全为架构基础，构建安全应用生态，包括设备和数据的安全等级划分。</p> </div> <ul><li>在分布式场景中，不同设备的安全等级不同，需要进行设备分级，确保数据跨设备流动的安全性。</li><li>对流动的数据进行分级，例如数据能否流动到普通设备上，不同敏感程度的数据有不同的流动限制。这些分级应在系统层面决定，而非应用层面。如果在应用层面划分数据等级，且应用开发者缺乏等级概念，会导致系统数据严重泄露。</li></ul> <div class="tiledSection"><h3 id="section1428845313378" class="firsth2">设备等级划分<i class="anchor-icon anchor-icon-link" anchorid="section1428845313378" tips="复制节点链接"></i></h3><p>根据设备安全能力，如是否有TEE和安全存储芯片等，将设备安全等级分为SL1、SL2、SL3、SL4和SL5五个等级。例如，智能穿戴设备通常为低安全的SL1设备，手机和平板通常为高安全的设备。</p> </div> <p><span><img height="522.5962350000001" originheight="641" originwidth="1068" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163353.33313706549656943012004264268818:50001231000000:2800:FEF6AF802A6FB5600F5F7F233FF06FC97796E7ACC9B76D08C650E6CE0DBBCDFC.png" title="点击放大" width="870.7228040000001"></span></p> <p>设备从SL1到SL5分级，在完整性保护、加密及数据保护、权限及访问控制、可信执行环境和漏洞防利用这几个维度对应的安全能力要求逐渐提高。</p> <div class="tiledSection"><h3 id="section5534204153812">数据等级划分<i class="anchor-icon anchor-icon-link" anchorid="section5534204153812" tips="复制节点链接"></i></h3></div> <p>敏感数据分类可帮助应用开发者根据数据的敏感性、价值以及数据泄露时的潜在影响来识别和分类数据。开发者需要了解不同类型的数据及其使用方式，并对数据进行分类，针对分类制定适当的安全措施和控制措施来保护数据并确保遵守相关法规和标准。下表举例说明了个人数据的分类：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>个人数据分类表</caption><thead><tr><th align="left" class="cellrowborder" colspan="2" id="mcps1.3.9.2.5.1.1" valign="top"><p>个人数据分类</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.2.5.1.2" valign="top"><p>数据分级</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.2.5.1.3" valign="top"><p>举例</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" rowspan="12" valign="top" width="15.709999999999999%"><p>个人/敏感数据</p> </td> <td class="cellrowborder" valign="top" width="15.709999999999999%"><p>关键资产数据</p> </td> <td class="cellrowborder" rowspan="2" valign="top" width="11.57%"><p>严重</p> </td> <td class="cellrowborder" valign="top" width="57.010000000000005%"><p>口令、认证Token、密保问题答案</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>个人种族数据</p> </td> <td class="cellrowborder" valign="top"><p>种族血统</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>权威社会识别标识</p> </td> <td class="cellrowborder" rowspan="4" valign="top"><p>高</p> </td> <td class="cellrowborder" valign="top"><p>身份证号码、军官证、社会/保险保障号码（社会号码）、驾照、护照号码、签证授权编号</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>负向名誉数据</p> </td> <td class="cellrowborder" valign="top"><p>犯罪记录（刑事、民事犯罪和诉讼记录）、服刑记录、纪律处分</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>健康数据</p> </td> <td class="cellrowborder" valign="top"><p>健康数据（身高、体重、体脂、血压、血糖、心率等）、医疗记录</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>家居控制数据</p> </td> <td class="cellrowborder" valign="top"><p>家居控制、汽车反向控制、手机投屏后反向控制等</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>年龄生辰数据</p> </td> <td class="cellrowborder" rowspan="4" valign="top"><p>中</p> </td> <td class="cellrowborder" valign="top"><p>年龄，出生日期</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>虚拟网络身份标识</p> </td> <td class="cellrowborder" valign="top"><p>华为帐号、宽带帐号、其他网络帐号（电话号码、邮箱）</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>一般社会识别标识</p> </td> <td class="cellrowborder" valign="top"><p>姓名</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>个人多媒体数据</p> </td> <td class="cellrowborder" valign="top"><p>照片、视频、录音、文字、日历日程、备忘录文本等</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>一般注册信息</p> </td> <td class="cellrowborder" rowspan="2" valign="top"><p>低</p> </td> <td class="cellrowborder" valign="top"><p>昵称、头像、性别、国籍、出生地、教育背景、专业背景等</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>正向名誉数据</p> </td> <td class="cellrowborder" valign="top"><p>专业成就</p> </td> </tr> <tr><td class="cellrowborder" rowspan="2" valign="top" width="15.709999999999999%"><p>非个人数据</p> </td> <td class="cellrowborder" valign="top" width="15.709999999999999%"><p>非个人数据</p> </td> <td class="cellrowborder" rowspan="2" valign="top" width="11.57%"><p>公开</p> </td> <td class="cellrowborder" valign="top" width="57.010000000000005%"><p>匿名化处理后的个人数据</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>非个人数据</p> </td> <td class="cellrowborder" valign="top"><p>系统、设备信息中公开发布的数据，如：TCB模块的版本信息、完整性度量值、访问控制策略数据的完整性度量值、策略数据本身等</p> </td> </tr>  </tbody></table></div> </div> <p>除了对数据进行内容分类，开发者还需遵守相关法律法规，例如通用数据保护条例（GDPR）和个人信息保护法，以保护用户隐私和数据安全。具体的数据分类图如图1所示。</p> <p><span><img originheight="548" originwidth="592" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163353.22500132383718047107822226287859:50001231000000:2800:CE0F2C56110B95D8ED19D5EA04FB89009F955B7DBABE119535FA84F0211ABF6A.png" width="592" height="548"></span></p> <p>按照个人数据分类分级规范要求，可将数据分为S1、S2、S3、S4四个安全等级。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>数据安全等级</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.2.5.1.1" valign="top" width="15.61%"><p>风险等级</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.2.5.1.2" valign="top" width="11.020000000000001%"><p>风险标准</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.2.5.1.3" valign="top" width="37%"><p>定义</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.2.5.1.4" valign="top" width="36.370000000000005%"><p>样例</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15.61%"><p>严重</p> </td> <td class="cellrowborder" valign="top" width="11.020000000000001%"><p>S4</p> </td> <td class="cellrowborder" valign="top" width="37%"><p>业界法律法规定义的特殊数据类型，涉及个人的最私密领域的信息或一旦泄露、篡改、破坏、销毁可能会给个人或组织造成重大的不利影响的数据。</p> </td> <td class="cellrowborder" valign="top" width="36.370000000000005%"><p>政治观点、宗教和哲学信仰、工会成员资格、基因数据、生物信息、健康和性生活状况，性取向等或设备认证鉴权、个人信用卡等财物信息等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.61%"><p>高</p> </td> <td class="cellrowborder" valign="top" width="11.020000000000001%"><p>S3</p> </td> <td class="cellrowborder" valign="top" width="37%"><p>数据泄露、篡改、破坏、销毁可能给个人或组织带来有限不利影响。</p> </td> <td class="cellrowborder" valign="top" width="36.370000000000005%"><p>个人实时精确定位信息、运动轨迹等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.61%"><p>中</p> </td> <td class="cellrowborder" valign="top" width="11.020000000000001%"><p>S2</p> </td> <td class="cellrowborder" valign="top" width="37%"><p>数据泄露、篡改、破坏、销毁可能给个人或组织带来有限不利影响。</p> </td> <td class="cellrowborder" valign="top" width="36.370000000000005%"><p>个人的详细通信地址、姓名昵称等。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15.61%"><p>低</p> </td> <td class="cellrowborder" valign="top" width="11.020000000000001%"><p>S1</p> </td> <td class="cellrowborder" valign="top" width="37%"><p>数据泄露、篡改、破坏、销毁可能给个人或组织带来有限不利影响。</p> </td> <td class="cellrowborder" valign="top" width="36.370000000000005%"><p>性别、国籍、用户申请记录等。</p> </td> </tr>  </tbody></table></div> </div> <p>数据安全标签和设备安全等级越高，加密措施和访问控制措施越严格，从而确保数据安全性更高。</p> <p>数据跨设备同步时，根据数据安全标签和设备安全等级进行访问控制。规则如下：数据从本设备同步到对端设备的前提是，本设备的数据安全标签不高于对端设备的设备安全等级，否则无法同步。具体访问控制矩阵如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表3 </b>访问控制矩阵</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.16.2.3.1.1" valign="top" width="50%"><p>设备安全级别</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.2.3.1.2" valign="top" width="50%"><p>可同步的数据安全标签</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>SL1</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>S1</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>SL2</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>S1~S2</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>SL3</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>S1~S3</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>SL4</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>S1~S4</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>SL5</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>S1~S4</p> </td> </tr>  </tbody></table></div> </div> <p>手表为低安全级别的SL1设备。若创建数据安全标签为S1的数据库，则此数据库数据可以在这些设备间同步；若创建的数据库标签为S2至S4，则不能在这些设备间同步。</p> <div class="tiledSection"><h2 id="section46363683810">分级数据加密<i class="anchor-icon anchor-icon-link" anchorid="section46363683810" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1433616432387" class="firsth2">分级数据保护<i class="anchor-icon anchor-icon-link" anchorid="section1433616432387" tips="复制节点链接"></i></h3><p>不同的文件路径具有独特的属性和特征。应用沙箱保护分级数据，防止恶意路径穿越访问。在应用文件目录中，根据文件加密类型区分不同的目录。</p> <ul><li>el1，设备级加密区：设备开机后即可访问的数据区。</li><li>el2，用户级加密区：设备开机后，需要至少一次解锁对应用户的锁屏界面（密码、指纹、人脸等方式或无密码状态）后，才能够访问的加密数据区。<p>应用如无特殊需要，应将数据存放在el2加密目录下，以尽可能保证数据安全。但是对于某些场景，一些应用文件需要在用户解锁前就可被访问，例如时钟、闹铃、壁纸等，此时应用需要将这些文件存放到设备级加密区（el1）。切换应用文件加密类型目录的方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取和修改加密分区" target="_blank">获取和修改加密分区</a>。</p> </li></ul> <p>应用文件目录的详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory#应用文件目录与应用文件路径" target="_blank">应用文件目录与应用文件路径</a>。</p> <p>分级数据文件路径使用应用通用文件路径，获取路径代码如下：</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L68-L73" data-highlighted="yes"><ol class="linenums"><li>getEl2Path(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-keyword">let</span> context = <span class="hljs-keyword">this</span>.getUIContext().getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li>  context.area = contextConstant.AreaMode.EL2;</li><li>  <span class="hljs-keyword">let</span> filePath = context.filesDir + <span class="hljs-string">'/health_data.txt'</span>;</li><li>  <span class="hljs-keyword">this</span>.message = filePath;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L68-L73" target="_blank">Index.ets</a></div></div></div></div> <p>需要获取el1的路径时，修改AreaMode。代码如下：</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L77-L82" data-highlighted="yes"><ol class="linenums"><li>getEl1Path(): <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-keyword">let</span> context = <span class="hljs-keyword">this</span>.getUIContext().getHostContext() <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li>  context.area = contextConstant.AreaMode.EL1;</li><li>  <span class="hljs-keyword">let</span> filePath = context.filesDir + <span class="hljs-string">'/health_data.txt'</span>;</li><li>  <span class="hljs-keyword">this</span>.message = filePath;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L77-L82" target="_blank">Index.ets</a></div></div></div></div> <p>如果应用没有特殊需求，应将数据存储在el2加密目录中。</p> <p>系统提供4种文件级加密类型以实现文件保护。应用可根据需求将文件保存到对应的数据目录。下表列出了各加密区所对应的策略：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表4 </b>分级加密策略</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.19.11.2.3.1.1" valign="top" width="10.69%"><p>分级加密</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.11.2.3.1.2" valign="top" width="89.31%"><p>策略</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="10.69%"><p>el4</p> </td> <td class="cellrowborder" valign="top" width="89.31%"><p>用户锁定设备后 10 秒钟，解密的数据保护类密钥会被从内存丢弃，此类的所有数据都无法访问，除非用户再次输入密码或使用指纹或面容解锁设备。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.69%"><p>el3</p> </td> <td class="cellrowborder" valign="top" width="89.31%"><p>用户锁定设备后，如果文件已经被打开，则文件始终可以被继续访问，一旦文件关闭（锁屏），文件将不能被再次访问，除非用户再次输入密码或使用指纹或面容解锁设备。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.69%"><p>el2</p> </td> <td class="cellrowborder" valign="top" width="89.31%"><p>用户开机后首次解锁设备后，即可对文件进行访问。这是未分配给数据保护类的所有第三方应用数据的默认数据保护类。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10.69%"><p>el1</p> </td> <td class="cellrowborder" valign="top" width="89.31%"><p>设备在直接启动模式下和用户解锁设备后均可对文件进行访问。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section834743103915">数据加密算法<i class="anchor-icon anchor-icon-link" anchorid="section834743103915" tips="复制节点链接"></i></h3><p>通用密钥库系统（OpenHarmony Universal KeyStore，简称HUKS）为业务提供平台级的密钥管理功能，包括密钥的生成、导入、销毁、证明、协商、派生、加密、解密、签名、验签及访问控制。HUKS作为系统的底层安全能力，业务无需实现复杂的密码学算法和密钥访问控制模型，即可安全、便捷地使用HUKS提供的密钥全生命周期管理功能，从而确保业务敏感数据的安全。</p> <p>使用数据加密算法实现数据加密请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-overview" target="_blank">Universal Keystore Kit简介</a>。</p> </div> <div class="tiledSection"><h2 id="section10159314397">数据安全案例<i class="anchor-icon anchor-icon-link" anchorid="section10159314397" tips="复制节点链接"></i></h2><p>健康数据是日常生活中常见的敏感数据，在HarmonyOS设备中广泛存在，如手机和手表。下面介绍体检报表的存储和保护案例。</p> </div> <div class="tiledSection"><h3 id="section7881194493915" class="firsth2">场景设计<i class="anchor-icon anchor-icon-link" anchorid="section7881194493915" tips="复制节点链接"></i></h3><p>根据数据分类规则，体检数据被归类为高风险级别的数据。因此，在程序设计过程中，除了采用分级数据加密的保护措施外，还需进行二次加密以增强数据的安全性。具体而言，可以先对数据进行一次加密，再使用分级数据加密的方法处理加密后的数据。这样可以提高数据的保密性和完整性，有效防止潜在的数据泄露和非法访问。通过多层次的加密措施，确保体检数据安全可靠地存储和传输。</p> <p>程序的场景包含三个页面：体检列表页、数据录入页和数据详情页。页面如下：</p> <div class="fignone"><span class="figcap"><b>图1 </b>场景设计图</span><br><span><img height="506.46400000000006" originheight="1686" originwidth="2510" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163353.52695123655656829254522952920681:50001231000000:2800:8F97067F365C248E5875D3D9B136599F2CFBC7D84D2C29DBDB55ACFB7F1FFFD6.png" title="点击放大" width="753.1125000000001"></span></div> </div> <div class="tiledSection"><h3 id="section624857134013">场景开发<i class="anchor-icon anchor-icon-link" anchorid="section624857134013" tips="复制节点链接"></i></h3></div> <p>在实际开发中，数据的加密与解密经常同时存在。本场景中也一样，由两个子场景组成：数据录入和数据详情。下面分别介绍这两个子场景的具体实现方式。</p> <ul><li>数据录入的实现方式</li></ul> <ol><li><span>在列表页点击录入按钮，进入数据录入页。</span></li><li><span>在数据录入页中录入信息，以标签提示字符为键，将数据组装成JSON对象。</span></li><li><span>对录入的信息进行加密。组装好的JSON对象序列化为字符串，再将字符串转换为字节数组，使用HUKS接口对字节数组进行加密，得到加密后的字节数组。</span></li><li><span>对加密后的数据进行分级加密，然后将加密后的字节数组使用fileio接口写入分级加密文件。</span></li></ol> <ul><li>数据详情的实现方式</li></ul> <ol><li><span>在列表页点击数据项，进入数据详情页，使用pushUrl接口的params参数传递分级加密文件的文件名。</span></li><li><span>对加密数据进行解密。根据params传入的分级加密文件名，调用fileio接口读取加密数据，然后调用huks接口解密读取的字节数组，获得解密后的字节数组。</span></li><li><span>展示数据详情。将解密后的字节数组转换为字符串，再将字符串转换为JSON对象，并将其展示到页面。</span></li></ol> <div class="tiledSection"><h3 id="section84394813405">代码实现<i class="anchor-icon anchor-icon-link" anchorid="section84394813405" tips="复制节点链接"></i></h3><ul><li>分级加密数据读写</li></ul> </div> <p>参考<a href="/consumer/cn/doc/best-practices/bpta-app-data-security#section1433616432387">分级数据保护</a>中代码获取到数据路径后按正常的文件读写即可，以下是文件读写的代码：</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L93-L125" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">writeFile</span>(<span class="hljs-params">filePath: <span class="hljs-built_in">string</span>, data: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> file = fileIo.<span class="hljs-title function_">openSync</span>(filePath, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>    <span class="hljs-keyword">let</span> writeLen = fileIo.<span class="hljs-title function_">writeSync</span>(file.<span class="hljs-property">fd</span>, data);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">'The length of str is: '</span> + writeLen);</li><li>    fileIo.<span class="hljs-title function_">closeSync</span>(file);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`writeFile error <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">readFile</span>(<span class="hljs-params">filePath: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> file = fileIo.<span class="hljs-title function_">openSync</span>(filePath, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>    <span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">1024</span>);</li><li>
</li><li>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Option</span> {</li><li>      <span class="hljs-keyword">public</span> <span class="hljs-attr">offset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>      <span class="hljs-keyword">public</span> <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> option = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Option</span>();</li><li>    option.<span class="hljs-property">length</span> = arrayBuffer.<span class="hljs-property">byteLength</span>;</li><li>    <span class="hljs-keyword">let</span> readLen = fileIo.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, arrayBuffer, option);</li><li>    <span class="hljs-keyword">let</span> buf = buffer.<span class="hljs-title function_">from</span>(arrayBuffer, <span class="hljs-number">0</span>, readLen);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`The length of of file: <span class="hljs-subst">${readLen}</span>`</span>);</li><li>    fileIo.<span class="hljs-title function_">closeSync</span>(file);</li><li>    <span class="hljs-keyword">return</span> buf.<span class="hljs-title function_">toString</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`readFile error <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L93-L125" target="_blank">Index.ets</a></div></div></div></div> <ul><li>数据加解密</li></ul> <p>在使用huks之前，先配置加密算法的规格。本案例中选择密钥长度为128的AES算法。在使用加解密算法前，先生成算法key。以下是算法配置和生成算法key的代码。</p> <p>在生成算法key的配置函数中，需要指定算法类型HUKS_ALG_AES、算法key的大小以及密钥用途。</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L139-L152" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GetAesGenerateProperties</span>(): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; = [{</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_AES</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_128</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span> |</li><li>    <span class="hljs-variable">huks</span>.<span class="hljs-variable">HuksKeyPurpose</span>.<span class="hljs-variable">HUKS_KEY_PURPOSE_DECRYPT</span></li><li>  }];</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L139-L152" target="_blank">Index.ets</a></div></div></div></div> <p>加密函数的算法规格必须与生成算法密钥的配置一致。</p> <p>HUKS_TAG_PADDING填充模式有三种。</p> <ul><li>NoPadding：不带填充；</li><li>PKCS5：填充字符由一个字节序列组成，每个字节填充该填充字节序列的长度，规定8字节填充；</li><li>PKCS7：填充字符和PKCS5填充方法一样，但是可以在1-255字节之间任意填充。</li></ul> <p>HUKS_TAG_BLOCK_MODE有7种分组模式。对于CBC、CTR、OFB、CFB模式，仅使用HUKS_TAG_IV加解密参数。对于GCM、CCM模式，需要设置HUKS_TAG_NONCE、HUKS_TAG_ASSOCIATED_DATA，并配置HUKS_TAG_IV。</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L156-L177" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GetAesEncryptProperties</span>(): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; = [{</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_AES</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_128</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_PKCS7</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_BLOCK_MODE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksCipherMode</span>.<span class="hljs-title class_">HUKS_MODE_CBC</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_IV</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">StringToUint8Array</span>(<span class="hljs-title class_">IV</span>)</li><li>  }];</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L156-L177" target="_blank">Index.ets</a></div></div></div></div> <p>解密函数的算法规格应与加密算法的配置一致，但需将密钥用途设置为解密。</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L181-L202" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">function</span> <span class="hljs-title function_">GetAesDecryptProperties</span>(): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">properties</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksParam</span>&gt; = [{</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_ALGORITHM</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyAlg</span>.<span class="hljs-title class_">HUKS_ALG_AES</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_KEY_SIZE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeySize</span>.<span class="hljs-title class_">HUKS_AES_KEY_SIZE_128</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PURPOSE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPurpose</span>.<span class="hljs-title class_">HUKS_KEY_PURPOSE_DECRYPT</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_PADDING</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksKeyPadding</span>.<span class="hljs-title class_">HUKS_PADDING_PKCS7</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_BLOCK_MODE</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksCipherMode</span>.<span class="hljs-title class_">HUKS_MODE_CBC</span></li><li>  }, {</li><li>    <span class="hljs-variable">tag</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksTag</span>.<span class="hljs-title class_">HUKS_TAG_IV</span>,</li><li>    <span class="hljs-variable">value</span>: <span class="hljs-title class_">StringToUint8Array</span>(<span class="hljs-title class_">IV</span>)</li><li>  }];</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">properties</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L181-L202" target="_blank">Index.ets</a></div></div></div></div> <p>完成上述配置后，调用生成算法的key函数。</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L206-L218" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">async</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">GenerateAesKey</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">genProperties</span> = <span class="hljs-title function_">GetAesGenerateProperties</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">options</span>: <span class="hljs-title class_">huks</span>.<span class="hljs-title class_">HuksOptions</span> = {</li><li>    <span class="hljs-variable">properties</span>: <span class="hljs-title class_">genProperties</span></li><li>  };</li><li>
</li><li>  <span class="hljs-variable">await</span> <span class="hljs-variable">huks</span>.<span class="hljs-title function_">generateKeyItem</span>(<span class="hljs-variable">aesKeyAlias</span>, <span class="hljs-variable">options</span>)</li><li>    .<span class="hljs-title function_">then</span>((<span class="hljs-variable">data</span>) =&gt; {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, `<span class="hljs-variable">promise</span>: <span class="hljs-title class_">generate</span> <span class="hljs-title class_">AES</span> <span class="hljs-title class_">Key</span> <span class="hljs-title class_">success</span>, <span class="hljs-variable">data</span> = ${<span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">data</span>)}`);</li><li>    }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">error</span>: <span class="hljs-title class_">Error</span>) =&gt; {</li><li>      <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, `<span class="hljs-variable">promise</span>: <span class="hljs-title class_">generate</span> <span class="hljs-title class_">AES</span> <span class="hljs-title class_">Key</span> <span class="hljs-title class_">failed</span>, ${<span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">error</span>)}`);</li><li>    })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L206-L218" target="_blank">Index.ets</a></div></div></div></div> <p>生成算法密钥后即可进行加解密。加解密过程中，先获取相应配置，然后调用initSession和finishSession完成操作。</p> <div class="screenLinkPre"><div _ngcontent-aqm-c106="" class="highlight-div"><div _ngcontent-aqm-c106="" class="highlight-div-header"><div _ngcontent-aqm-c106="" class="highlight-div-header-left"><div _ngcontent-aqm-c106="" class="handle-button expand-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aqm-c106="" class="highlight-div-header-right"><div _ngcontent-aqm-c106="" class="handle-button ai-button"></div><div _ngcontent-aqm-c106="" class="handle-button line-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aqm-c106="" class="handle-button theme-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aqm-c106="" class="handle-button copy-button"><div _ngcontent-aqm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aqm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L222-L267" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">EncryptData</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> encryptProperties = <span class="hljs-title class_">GetAesEncryptProperties</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>    <span class="hljs-attr">properties</span>: encryptProperties,</li><li>    <span class="hljs-attr">inData</span>: <span class="hljs-title class_">StringToUint8Array</span>(plainText)</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">initSession</span>(aesKeyAlias, options)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      handle = data.<span class="hljs-property">handle</span>;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`promise: init EncryptData failed, <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    })</li><li>
</li><li>  <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">finishSession</span>(handle, options)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>,</li><li>        <span class="hljs-string">`promise: encrypt data success, data is `</span> + <span class="hljs-title class_">Uint8ArrayToString</span>(data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>));</li><li>      cipherData = data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`promise: encrypt data failed, <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    })</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">DecryptData</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> decryptOptions = <span class="hljs-title class_">GetAesDecryptProperties</span>()</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>    <span class="hljs-attr">properties</span>: decryptOptions,</li><li>    <span class="hljs-attr">inData</span>: cipherData</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">initSession</span>(aesKeyAlias, options)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      handle = data.<span class="hljs-property">handle</span>;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`promise: init DecryptData failed, <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    })</li><li>
</li><li>  <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">finishSession</span>(handle, options)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>,</li><li>        <span class="hljs-string">`promise: decrypt data success, data is `</span> + <span class="hljs-title class_">Uint8ArrayToString</span>(data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>));</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'AppDataSecurity'</span>, <span class="hljs-string">`promise: decrypt data failed, <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/AppDataSecurity/entry/src/main/ets/pages/Index.ets#L222-L267" target="_blank">Index.ets</a></div></div></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在体检报表中存在敏感数据，因此需要对数据进行二次加密和分级加密。解密过程与加密顺序相反，先读取分级加密的数据，再进行解密。当涉及不同密级的敏感数据时，可以按密级分别封装序列化，避免高密级数据在数据流动过程中泄露到低密级设备中。</p> <p>为了方便日志打印输出，对加密后的数据进行Base64转码。在应用开发中，此步骤可以省略。</p> </div></div></div> <div class="tiledSection"><h2 id="section71881948204319">总结与回顾<i class="anchor-icon anchor-icon-link" anchorid="section71881948204319" tips="复制节点链接"></i></h2><p>数据安全在应用开发中至关重要，必须在分析评估和设计开发两个阶段综合考虑。</p> <ul><li>对应用中涉及的各类数据进行全面的风险评估和分类分析，根据数据的敏感程度和重要性确定相应的安全保护策略。</li><li>采用分级数据保护和合适的加密算法规格 ，避免敏感数据泄露。</li></ul> <p>本文中，针对体检报表中的数据进行了安全等级划分，并根据定义的等级采取了相应的加密措施。</p> <ul><li>数据安全分级是根据数据的重要性和敏感程度进行分类保护的方法。通过分类，采取相应的安全措施，确保数据安全。开发人员应根据业务场景选择合适的数据分级保护策略，降低数据管理复杂度，提高数据安全性。例如，对敏感的个人隐私数据，应实施严格的访问控制，防止未经授权的访问和泄露。</li><li>数据加密技术保护数据机密性。合理选择加密算法和规格，平衡安全性和计算复杂度，确保用户正常使用。还需考虑数据的传输加密和存储加密。</li></ul> <p>在实际应用开发中，开发者应重视数据安全，持续完善数据安全保护措施，确保用户数据安全和隐私得到有效保护。</p> </div> <div class="tiledSection"><h2 id="section18571548184811">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section18571548184811" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/AppDataSecurity" target="_blank">应用数据安全</a></li></ul> </div> </div> <div></div></div>