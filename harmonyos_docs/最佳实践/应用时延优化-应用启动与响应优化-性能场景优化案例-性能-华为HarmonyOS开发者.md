<h1 _ngcontent-bgx-c119="" class="doc-title ng-star-inserted" title="应用时延优化"> 应用时延优化 </h1>

<div _ngcontent-bgx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section131521247089">应用时延概述<i class="anchor-icon anchor-icon-link" anchorid="section131521247089" tips="复制节点链接"></i></h2><p>在移动终端应用开发中，完成时延是指用户操作移动终端时，从输入触控指令到界面完全刷新结束并达到可以阅读的稳定状态所用时间，点击时延依据界面转场类型可以分为界面内跳转和界面间跳转两种。完成时延作为用户体验关键指标，直接影响用户对响应速度和交互流畅性的感知，主要影响用户对触控交互及时性和愉悦性的体验评价。关于响应时延阶段的分析，请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-click-to-click-response-optimization">《点击响应时延分析》</a>。关于完成时延阶段的分析，请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-click-to-complete-delay-analysis">《点击完成时延分析》</a>。</p> <p>在一定时延水平以上，时延越短越好，当时延小于一定水平后，用户的流畅体验不再继续提升。建议应用或元服务内点击操作响应时延应≤100ms，应用或元服务内点击操作完成时延≤900ms，更多体验建议，请参考指南<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/performance-experience-suggestions" target="_blank">《应用性能体验建议》</a>。本文将给出时延问题常见优化方案。</p> <div class="fignone"><span class="figcap"><b>图1 </b>点击完成起止点示意图</span><br><span><img height="326.905754" originheight="1116" originwidth="1868" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.41303288804729436780540698109803:50001231000000:2800:FD76917F833033662DF19B3BB5CE12FAEA865787550DD2C6913A427BE5028C35.png" title="点击放大" width="535.858064"></span></div> <div class="fignone"><span class="figcap"><b>图2 </b>页面转场过程解析</span><br><span><img height="133.66500000000002" originheight="1170" originwidth="4583" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.41842556297481165406887345430644:50001231000000:2800:528E5E0A78A7F65AD79DBCE1468B2A0A77C6B6128FD5356DAA412ECA6C2441C8.png" title="点击放大" width="523.6875"></span></div> </div> <div class="tiledSection"><h2 id="section81324583216">常见时延问题优化方案<i class="anchor-icon anchor-icon-link" anchorid="section81324583216" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section677814192383" class="firsth2">UI优化<i class="anchor-icon anchor-icon-link" anchorid="section677814192383" tips="复制节点链接"></i></h3><p>本节的示例是一个应用开发中常见的留言箱列表。</p> <p>设计图稿显示，列表视图中的每个子项包含头像、消息红点、昵称、最新信息和时间等元素。</p> <p>应用进入该页面时，根据每条消息的元素数据，呈现出不同的样式内容。</p> <div class="fignone"><span class="figcap"><b>图3 </b>留言箱列表界面</span></div> <p><span><img height="422.067254" originheight="804" originwidth="385" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.65543421898599105937344388777017:50001231000000:2800:E231DD798497778D28B37A91F27EC6AA364CD2019CA804A401BF6A2D0B8A08D1.png" title="点击放大" width="209.373255"></span></p> <p>分解关系结构后，单个子项界面由6个构成元素组成，元素排列以线性风格为主，使用的组件包括Image、Badge和Text。</p> <div class="fignone"><span class="figcap"><b>图4 </b>单个ListItem界面示意</span></div> <p><span><img height="91.69512100000001" originheight="74" originwidth="387" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.11660620836691387528075867941058:50001231000000:2800:890E00DB779817580558A765848048955F6495C7AC55445C12E39797EFBE18CE.png" title="点击放大" width="455.9164190000001"></span></p> <p><strong>具体实现</strong></p> <ul><li>熟悉弹性布局的开发者，得到需求后会第一时间使用Flex容器实现。界面主体呈线性结构，使用Flex作为包裹父容器，依次将横向纵向的元素添加进去，并设置其样式属性。通过DevEco Studio内置ArkUI Inspector工具，可以得到布局代码对应的视图树。实现结果从根结点到元素叶子结点最深处有6层，组件数目为15。这种实现方式，由于Flex容器默认情况下存在shrink等行为，绘制时会二次布局，造成页面渲染上的性能劣化。</li><li>接下来采用相对布局优化实现。先将左侧头像添加到容器中，然后锚定其位置，逐一在右侧添加其他元素。实现结果使用工具观察，发现层级相对减少，最终实现的层级是3层。同时，借助相对布局，子元素结构扁平化，容器也相对减少，进一步优化了页面的构建渲染时间。</li></ul> <div class="fignone"><span class="figcap"><b>图5 </b>Flex布局下的界面层级关系</span><br><span><img originheight="334" originwidth="236" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.68888495231281172829312354297149:50001231000000:2800:933F9AD4F1A0FA150549084E146ACC3B47895F282F002E82B8FCCA170997A547.png" class="notEnlarge" width="236" height="334"></span></div> <div class="fignone"><span class="figcap"><b>图6 </b>相对布局下的界面层级关系</span></div> <p><span><img originheight="202" originwidth="194" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.54182470664603728487213027302934:50001231000000:2800:1F99E2F9EACEEEE76E975A11AF5DED3061BA8B9A73E1AB2FFA528215BA5F1E97.png" class="notEnlarge" width="194" height="202"></span></p> <p><strong>统计分析</strong></p> <p>在不同布局下，相同界面效果所需的组件数和嵌套层数不同。对本案例场景下的留言箱进行拆分，可以得到以下数目对比：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b><strong>不同布局下的数目对比</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.17.2.4.1.1" valign="top" width="33.33333333333333%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.3.17.2.4.1.2" valign="top" width="33.33333333333333%"><p>组件数目</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.17.2.4.1.3" valign="top" width="33.33333333333333%"><p>嵌套数目</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>Flex实现方式</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>15</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>6</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p>相对布局实现方式</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>9</p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>3</p> </td> </tr>  </tbody></table></div> </div> <p>使用相同数据测试，记录从上一页面点击启动到留言箱列表渲染的响应时延，对比结果如下表：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b><strong>不同布局下的列表界面响应时长</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.19.2.5.1.1" valign="top" width="25%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.3.19.2.5.1.2" valign="top" width="25%"><p>256条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.19.2.5.1.3" valign="top" width="25%"><p>512条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.19.2.5.1.4" valign="top" width="25%"><p>1024条数据</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>Flex实现方式</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>308ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>570ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1096ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>相对布局实现方式</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>249ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>499ms</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>986ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>优化百分比</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>19.2%</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>12.5%</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>10.0%</p> </td> </tr>  </tbody></table></div> </div> <p>从最后统计的数据来看：</p> <ul><li>形态单一的案例中，响应时长降低50ms以上，优化比提升10%以上。减少组件渲染数目和布局嵌套层级，有助于提升应用UI的绘制性能，减少响应时延。</li><li>随着加载数据量的提升，优化时长占比下降。列表在加载大量数据时，存在其他性能瓶颈，需要结合更多优化方法提升性能表现。</li></ul> <p>在实际开发中，简化布局结构和精简相关元素（包括绘制的子元素及其父容器）可以提升UI的响应速度。</p> </div> <div class="tiledSection"><h3 id="section878021963815">并发优化<i class="anchor-icon anchor-icon-link" anchorid="section878021963815" tips="复制节点链接"></i></h3><p>该示例是添加地址功能。点击“选择”按钮后，应用切换到选择城市地区的目标页。切换时，加载全国城市数据，按首字符排序，刷新列表。</p> <p>在实际场景中，可以使用同步串行方式实现这一功能：点击按钮后，初始化页面，加载数据到内存，然后渲染界面视图。</p> <p>当目标页选择范围到“市”这一行政级别时，数据量为1000条，新页面响应速度良好，没有明显异常。</p> <p>如果功能需求调整，当目标页选择范围到“区”这一级别，数据量达到2000，页面响应速度仍然可以接受。</p> <p>如果功能调整后，当目标页选择范围达到“乡镇/街道”这一级别时，数据量超过4000，页面响应将出现明显延迟。</p> <p>地区数据的加载和排序都会消耗性能，可以使用并发机制来优化。</p> <p></p> <p><strong>代码实现</strong></p> <p>在目标页面的aboutToAppear()中，使用TaskPool启动子线程加载城市数据，实现并发：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CityListPage.ets#L28-L137" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Concurrent</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">computeTask</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">string</span>[] {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">array</span>: <span class="hljs-built_in">string</span>[] = []</li><li>  <span class="hljs-comment">// AppConstant.CITYS is the data to be loaded.</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> t <span class="hljs-keyword">of</span> <span class="hljs-title class_">AppConstant</span>.<span class="hljs-property">CITYS</span>) {</li><li>    array.<span class="hljs-title function_">push</span>(t.<span class="hljs-title function_">trim</span>())</li><li>  }</li><li>  <span class="hljs-keyword">let</span> collator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Collator</span>(<span class="hljs-string">"zh-CN"</span>, { <span class="hljs-attr">localeMatcher</span>: <span class="hljs-string">"lookup"</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">"sort"</span> });</li><li>  array.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> collator.<span class="hljs-title function_">compare</span>(a, b))</li><li>  <span class="hljs-keyword">return</span> array;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CityList</span> {</li><li>  <span class="hljs-attr">isAsync</span>: <span class="hljs-built_in">boolean</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">getParams</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt;)[<span class="hljs-string">'isAsync'</span>];</li><li>  <span class="hljs-comment">// Interface data</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">citys</span>: <span class="hljs-built_in">string</span>[] = []</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listScroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeTaskAsync</span>(); <span class="hljs-comment">// Call asynchronous operation function</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Asynchronous thread</span></li><li>  <span class="hljs-title function_">computeTaskAsync</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">task</span>: taskpool.<span class="hljs-property">Task</span> = <span class="hljs-keyword">new</span> taskpool.<span class="hljs-title class_">Task</span>(computeTask);</li><li>    taskpool.<span class="hljs-title function_">execute</span>(task).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">citys</span> = res <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[]</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CityListPage.ets#L28-L137" target="_blank">CityListPage.ets</a></div></div></div></div> <p><strong>统计分析</strong></p> <p>使用Profiler Time工具，分别测试不同数量级别下的响应时长，得到结果如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表3 </b><strong>不同数据量的响应时长</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.14.2.6.1.1" valign="top" width="23.12%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.4.14.2.6.1.2" valign="top" width="18.440000000000005%"><p>500条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.14.2.6.1.3" valign="top" width="18.6%"><p>1000条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.14.2.6.1.4" valign="top" width="19.340000000000003%"><p>2000条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.14.2.6.1.5" valign="top" width="20.5%"><p>4000条数据</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="23.12%"><p>串行</p> </td> <td class="cellrowborder" valign="top" width="18.440000000000005%"><p>49ms</p> </td> <td class="cellrowborder" valign="top" width="18.6%"><p>94ms</p> </td> <td class="cellrowborder" valign="top" width="19.340000000000003%"><p>296ms</p> </td> <td class="cellrowborder" valign="top" width="20.5%"><p>780ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="23.12%"><p>并发</p> </td> <td class="cellrowborder" valign="top" width="18.440000000000005%"><p>48ms</p> </td> <td class="cellrowborder" valign="top" width="18.6%"><p>86ms</p> </td> <td class="cellrowborder" valign="top" width="19.340000000000003%"><p>140ms</p> </td> <td class="cellrowborder" valign="top" width="20.5%"><p>172ms</p> </td> </tr>  </tbody></table></div> </div> <p>在该场景下，如果数据量小于1000，串行加载的用户体验可以保持良好。但随着城市数据量的增加，当数据量超过1000条时，响应时间显著增加，用户体验开始恶化。从手指抬起到页面转场进入列表页的第一帧画面，会出现明显的响应迟滞。</p> <p>采用并发异步加载的优势在于，UI主线程可以快速拉起目标列表页面，同时触发异步加载和排序的逻辑线程。待结果返回后，再刷新列表，从而提升整体响应速度。</p> </div> <div class="tiledSection"><h3 id="section1478111913814">减少调用数据库API次数<i class="anchor-icon anchor-icon-link" anchorid="section1478111913814" tips="复制节点链接"></i></h3><p>本节示例是一个记账工具应用，其基于关系型数据库管理相关账目。</p> <p>在查询用户数据时，会依次读取account表中每一行的数据，其中每一列column的值，需要借助getColumnIndex("列名")得到column索引，然后再取得对应值 。</p> <p>修改前代码：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/common/db/AccountTable.ets#L42-L55" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">count</span>; <span class="hljs-title class_">i</span>++) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">tmp</span>: <span class="hljs-title class_">AccountData</span> = {</li><li>    <span class="hljs-variable">id</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">accountType</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">typeText</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-variable">amount</span>: <span class="hljs-number">0</span></li><li>  };</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">id</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'id'</span>));</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">accountType</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'accountType'</span>));</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">typeText</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getString</span>(<span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'typeText'</span>));</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">amount</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">'amount'</span>));</li><li>  <span class="hljs-variable">result</span>[<span class="hljs-variable">i</span>] = <span class="hljs-variable">tmp</span>;</li><li>  <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">goToNextRow</span>();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/common/db/AccountTable.ets#L42-L55" target="_blank">AccountTable.ets</a></div></div></div></div> <p>在数据表结构固定的情况下，可以将getColumnIndex的调用提前，以减少总的调用次数，从而优化指令耗时。随着数据行数count的增加，for循环内的getColumnIndex调用次数也会增加，但索引不会变化。</p> <p>修改后代码：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/common/db/AccountTable.ets#L58-L75" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">idIndex</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">"id"</span>);</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">accountTypeIndex</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">"accountType"</span>);</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">typeTextIndex</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">"typeText"</span>);</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">amountIndex</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getColumnIndex</span>(<span class="hljs-string">"amount"</span>);</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">count</span>; <span class="hljs-title class_">i</span>++) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">tmp</span>: <span class="hljs-title class_">AccountData</span> = {</li><li>    <span class="hljs-variable">id</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">accountType</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">typeText</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-variable">amount</span>: <span class="hljs-number">0</span></li><li>  };</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">id</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">idIndex</span>);</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">accountType</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">accountTypeIndex</span>);</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">typeText</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getString</span>(<span class="hljs-variable">typeTextIndex</span>);</li><li>  <span class="hljs-variable">tmp</span>.<span class="hljs-variable">amount</span> = <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">getDouble</span>(<span class="hljs-variable">amountIndex</span>);</li><li>  <span class="hljs-variable">result</span>[<span class="hljs-variable">i</span>] = <span class="hljs-variable">tmp</span>;</li><li>  <span class="hljs-variable">resultSet</span>.<span class="hljs-title function_">goToNextRow</span>();</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/common/db/AccountTable.ets#L58-L75" target="_blank">AccountTable.ets</a></div></div></div></div> <p><strong>统计分析</strong></p> <p>使用Profiler Time工具，分别测试不同数量下的响应时长，得到结果如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表4 </b><strong>不同数据量的响应时长</strong></caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.11.2.5.1.1" valign="top" width="28.402840284028404%">&nbsp;&nbsp;</th> <th align="left" class="cellrowborder" id="mcps1.3.5.11.2.5.1.2" valign="top" width="22.65226522652265%"><p>50条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.11.2.5.1.3" valign="top" width="23.762376237623766%"><p>500条数据</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.11.2.5.1.4" valign="top" width="25.182518251825186%"><p>5000条数据</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="28.402840284028404%"><p>修改前</p> </td> <td class="cellrowborder" valign="top" width="22.65226522652265%"><p>72ms</p> </td> <td class="cellrowborder" valign="top" width="23.762376237623766%"><p>97ms</p> </td> <td class="cellrowborder" valign="top" width="25.182518251825186%"><p>157ms</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="28.402840284028404%"><p>修改后</p> </td> <td class="cellrowborder" valign="top" width="22.65226522652265%"><p>72ms</p> </td> <td class="cellrowborder" valign="top" width="23.762376237623766%"><p>92ms</p> </td> <td class="cellrowborder" valign="top" width="25.182518251825186%"><p>110ms</p> </td> </tr>  </tbody></table></div> </div> <p>由此可以看出，在使用数据库时，需要关注相关API调用的潜在频率。</p> <p>在数据条目数量较少时，API调用对应用响应的影响很小。随着使用时间的增加，数据量逐渐增大，API的高频调用将直接影响程序的性能。</p> </div> <div class="tiledSection"><h3 id="section8783201923819">延迟执行资源释放操作<i class="anchor-icon anchor-icon-link" anchorid="section8783201923819" tips="复制节点链接"></i></h3><p>该场景是相机正常使用后，执行释放相机资源的相关操作。通过“停止拍摄进程&gt;暂停并释放相机会话&gt;关闭和释放预览及拍照的输入输出对象&gt;清空相机管理对象”的过程，确保应用程序在不再使用相机时能够有效管理并回收所有相机资源。但是，直接调用的release方法中，captureSession、cameraInput、previewOutput、cameraOutput都使用了await，导致相机关闭和释放操作顺序执行，可能会降低应用程序的响应性，引起用户界面卡顿。</p> <p>下列代码将资源释放操作放在相机页面隐藏时触发的函数：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CameraPage.ets#L23-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">cameraOutput</span>: camera.<span class="hljs-property">PreviewOutput</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">captureSession</span>: camera.<span class="hljs-property">PhotoSession</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">previewOutput</span>: camera.<span class="hljs-property">PhotoOutput</span>;</li><li>
</li><li><span class="hljs-comment">// The camera page is triggered once every time it is hidden.</span></li><li><span class="hljs-title function_">onPageHide</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">releaseCamera</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// Release resources</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">releaseCamera</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// Photo mode session class pause</span></li><li>    <span class="hljs-keyword">await</span> captureSession?.<span class="hljs-title function_">stop</span>();</li><li>    <span class="hljs-comment">// Photo mode conversation class release</span></li><li>    <span class="hljs-keyword">await</span> captureSession?.<span class="hljs-title function_">release</span>();</li><li>    <span class="hljs-comment">// The photo input object class is closed.</span></li><li>    <span class="hljs-keyword">await</span> cameraInput?.<span class="hljs-title function_">close</span>();</li><li>    <span class="hljs-comment">// Preview output object class release</span></li><li>    <span class="hljs-keyword">await</span> previewOutput?.<span class="hljs-title function_">release</span>();</li><li>    <span class="hljs-comment">// Photo output object class release</span></li><li>    <span class="hljs-keyword">await</span> cameraOutput?.<span class="hljs-title function_">release</span>();</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x00</span>, <span class="hljs-string">'release input output error:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(e));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CameraPage.ets#L23-L58" target="_blank">CameraPage.ets</a></div></div></div></div> <p>启动setTimeout异步延迟操作，在200毫秒后调用release释放并关闭相机。通过“停止拍摄进程&gt;并发执行：暂停并释放相机会话&gt;关闭和释放预览及拍照的输入输出对象&gt;清空相机管理对象”的过程，确保应用程序在不再使用相机时能够有效管理并回收所有相机资源。移除await关键字应用于相机资源释放操作，允许异步并发执行，减少主线程阻塞，提升应用性能和响应速度。</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CameraOptPage.ets#L23-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">cameraOutput</span>: camera.<span class="hljs-property">PreviewOutput</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">captureSession</span>: camera.<span class="hljs-property">PhotoSession</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">previewOutput</span>: camera.<span class="hljs-property">PhotoOutput</span>;</li><li>
</li><li><span class="hljs-comment">// The camera page is triggered once every time it is hidden.</span></li><li><span class="hljs-title function_">onPageHide</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">releaseCamera</span>, <span class="hljs-number">200</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// Release resources</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">releaseCamera</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// Photo mode session class pause</span></li><li>    <span class="hljs-keyword">await</span> captureSession?.<span class="hljs-title function_">stop</span>();</li><li>    <span class="hljs-comment">// Photo mode conversation class release</span></li><li>    <span class="hljs-keyword">await</span> captureSession?.<span class="hljs-title function_">release</span>();</li><li>    <span class="hljs-comment">// The photo input object class is closed.</span></li><li>    <span class="hljs-keyword">await</span> cameraInput?.<span class="hljs-title function_">close</span>();</li><li>    <span class="hljs-comment">// Preview output object class release</span></li><li>    <span class="hljs-keyword">await</span> previewOutput?.<span class="hljs-title function_">release</span>();</li><li>    <span class="hljs-comment">// Photo output object class release</span></li><li>    <span class="hljs-keyword">await</span> cameraOutput?.<span class="hljs-title function_">release</span>();</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x00</span>, <span class="hljs-string">'release input output error:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(e));</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/CameraOptPage.ets#L23-L58" target="_blank">CameraOptPage.ets</a></div></div></div></div> </div> <p><strong>性能比对</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表5 </b>不同释放逻辑下的耗时</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.2.4.1.1" valign="top" width="25.840000000000003%"><p>操作逻辑</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.4.1.2" valign="top" width="23.51%"><p>trace图识别耗时</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.2.4.1.3" valign="top" width="50.64999999999999%"><p>备注</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25.840000000000003%"><p>直接关闭与释放（修改前）</p> </td> <td class="cellrowborder" valign="top" width="23.51%"><p>457.5ms</p> </td> <td class="cellrowborder" valign="top" width="50.64999999999999%"><p>在onPageHide中直接执行相机关闭与释放操作</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25.840000000000003%"><p>延时关闭与释放（修改后）</p> </td> <td class="cellrowborder" valign="top" width="23.51%"><p>85.6ms</p> </td> <td class="cellrowborder" valign="top" width="50.64999999999999%"><p>在onPageHide中使用setTimeout延迟200ms后执行关闭与释放操作</p> </td> </tr>  </tbody></table></div> </div> <p>两组数据显示，合理运用延时策略能够显著提高函数执行效率，是优化相机资源管理和关闭操作性能的有效方法，有助于提升整体用户体验。</p> <div class="tiledSection"><h3 id="section1116134115286">减小拖动识别距离<i class="anchor-icon anchor-icon-link" anchorid="section1116134115286" tips="复制节点链接"></i></h3><p>该场景涉及为组件添加手势事件。优化前，设置触发拖动手势事件的最小拖动距离为100vp。代码如下：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/PanGestureDistancePage.ets#L19-L69" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceMeter } from <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct PanGestureExample {</li><li>  <span class="hljs-meta">@State</span> offsetX: number = <span class="hljs-number">0</span></li><li>  <span class="hljs-meta">@State</span> offsetY: number = <span class="hljs-number">0</span></li><li>  <span class="hljs-meta">@State</span> positionX: number = <span class="hljs-number">0</span></li><li>  <span class="hljs-meta">@State</span> positionY: number = <span class="hljs-number">0</span></li><li>  <span class="hljs-keyword">private</span> panOption: PanGestureOptions = new PanGestureOptions({ direction: PanDirection.Left | PanDirection.Right })</li><li>
</li><li>  build() {</li><li>    Column() {</li><li>      Column() {</li><li>        Text(<span class="hljs-string">'PanGesture offset:\nX: '</span> + <span class="hljs-keyword">this</span>.offsetX + <span class="hljs-string">'\n'</span> + <span class="hljs-string">'Y: '</span> + <span class="hljs-keyword">this</span>.offsetY)</li><li>      }</li><li>      .height(<span class="hljs-number">200</span>)</li><li>      .width(<span class="hljs-number">300</span>)</li><li>      .padding(<span class="hljs-number">20</span>)</li><li>      .border({ width: <span class="hljs-number">3</span> })</li><li>      .margin(<span class="hljs-number">50</span>)</li><li>      .translate({ x: <span class="hljs-keyword">this</span>.offsetX, y: <span class="hljs-keyword">this</span>.offsetY, z: <span class="hljs-number">0</span> }) <span class="hljs-comment">// Move with the upper left corner of the component as the coordinate origin.</span></li><li>      <span class="hljs-comment">// Drag left and right to trigger the gesture event.</span></li><li>      .gesture(</li><li>        PanGesture(<span class="hljs-keyword">this</span>.panOption)</li><li>          .onActionStart((event: GestureEvent) =&gt; {</li><li>            console.info(<span class="hljs-string">'Pan start'</span>)</li><li>            hiTraceMeter.startTrace(<span class="hljs-string">"PanGesture"</span>, <span class="hljs-number">1</span>)</li><li>          })</li><li>          .onActionUpdate((event: GestureEvent) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (event) {</li><li>              <span class="hljs-keyword">this</span>.offsetX = <span class="hljs-keyword">this</span>.positionX + event.offsetX</li><li>              <span class="hljs-keyword">this</span>.offsetY = <span class="hljs-keyword">this</span>.positionY + event.offsetY</li><li>            }</li><li>          })</li><li>          .onActionEnd(() =&gt; {</li><li>            <span class="hljs-keyword">this</span>.positionX = <span class="hljs-keyword">this</span>.offsetX</li><li>            <span class="hljs-keyword">this</span>.positionY = <span class="hljs-keyword">this</span>.offsetY</li><li>            console.info(<span class="hljs-string">'Pan end'</span>)</li><li>            hiTraceMeter.finishTrace(<span class="hljs-string">"PanGesture"</span>, <span class="hljs-number">1</span>)</li><li>          })</li><li>      )</li><li>
</li><li>      Button(<span class="hljs-string">'修改PanGesture触发条件'</span>)</li><li>        .onClick(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.panOption.setDistance(<span class="hljs-number">100</span>)</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/PanGestureDistancePage.ets#L19-L69" target="_blank">PanGestureDistancePage.ets</a></div></div></div></div> </div> <p>利用Profiler工具分析得到的trace图，重点关注两个trace标签：DispatchTouchEvent表示点击事件，PanGesture表示事件响应。追踪流程从应用侧的DispatchTouchEvent（type=0，表示手指接触屏幕）标签开始，到PanGesture（事件响应）的变化，整个过程耗时145.1毫秒。</p> <p><span><img height="249.375" originheight="462" originwidth="1544" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.86940402382805759978195549420368:50001231000000:2800:36BEDB78DEFAB94701DFEFE456BC08DDB946B0878E890CCD630177B306E83815.png" title="点击放大" width="833.3902360000001"></span></p> <p>日志关注从应用接收TouchDown事件到pan识别的耗时，该过程耗时127ms。注：日志信息和trace图非同一时间获取，性能数据存在差异，提供的数值仅供参考。</p> <p><span><img height="94.7625" originheight="171" originwidth="1507" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.46682248572842588209637577475814:50001231000000:2800:F318BACAF6878C84AABD3525AE8A532F1469104243EE6159B0FB4B7B75D695CD.png" title="点击放大" width="835.1099260000001"></span></p> <p>针对该组件，其拖动手势识别距离可以调整到更合适的数值，这里优化后，指定触发拖动手势事件的最小拖动距离为4vp，代码如下：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/PanGestureDistanceOptPage.ets#L62-L65" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">'修改PanGesture触发条件'</span>)</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">panOption</span>.<span class="hljs-title function_">setDistance</span>(<span class="hljs-number">4</span>)</li><li>  })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/PanGestureDistanceOptPage.ets#L62-L65" target="_blank">PanGestureDistanceOptPage.ets</a></div></div></div></div> <p>同样采用Profiler工具分析trace图，得到对应耗时38.4ms</p> <p><span><img height="236.4075" originheight="430" originwidth="1539" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.29692331718614497032489503378806:50001231000000:2800:2062DF15A7C268DCDFB398E4927186949F1028CA8E51F9F23F3D2338E83A26F1.png" title="点击放大" width="846.1123510000001"></span></p> <p>对应日志过程耗时42ms。</p> <p><span><img height="77.805" originheight="138" originwidth="1499" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.81759248455516819684867735414468:50001231000000:2800:86D84732E9980F9274C77DBD9FEA36021794A051DABD3947F14A714AB5A86DEF.png" title="点击放大" width="845.13786"></span></p> <p><strong>性能比对</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表6 </b>不同拖动识别距离下的耗时</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.22.2.5.1.1" valign="top" width="21.27787221277872%"><p>拖动距离设置</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.2.5.1.2" valign="top" width="19.358064193580642%"><p>trace图识别耗时</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.2.5.1.3" valign="top" width="17.658234176582344%"><p>日志识别耗时</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.2.5.1.4" valign="top" width="41.7058294170583%"><p>备注</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="21.27787221277872%"><p>最小拖动距离100vp（修改前）</p> </td> <td class="cellrowborder" valign="top" width="19.358064193580642%"><p>145.1ms</p> </td> <td class="cellrowborder" valign="top" width="17.658234176582344%"><p>127ms</p> </td> <td class="cellrowborder" valign="top" width="41.7058294170583%"><p>最小拖动距离过大可能导致滑动脱手和响应时延慢等问题，从而导致性能劣化</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="21.27787221277872%"><p>最小拖动距离4vp（修改后）</p> </td> <td class="cellrowborder" valign="top" width="19.358064193580642%"><p>38.4ms</p> </td> <td class="cellrowborder" valign="top" width="17.658234176582344%"><p>42ms</p> </td> <td class="cellrowborder" valign="top" width="41.7058294170583%"><p>设置合理的拖动距离可以优化性能</p> </td> </tr>  </tbody></table></div> </div> <p>两组数据对比显示，适当减小拖动距离可显著提升执行效率，有效优化响应时延，从而显著改善整体用户体验。本案例通过设置较大和较小的拖动距离进行对比得出结论。设置过小的拖动距离容易导致误触等问题，建议开发者根据具体应用场景进行合理设置。</p> <div class="tiledSection"><h3 id="section17886155414385">转场动画场景案例<i class="anchor-icon anchor-icon-link" anchorid="section17886155414385" tips="复制节点链接"></i></h3><p>下面的示例通过不同的连贯动画，使应用使用者在操作过程中感受到程序的快速响应。</p> <p>该示例场景：从留言箱的列表项点击后，执行切换进入个人页。在这一过程中，使用了三个动画组成其完整过程：</p> <ul><li>在整体界面的切换过程，使用系统平台的转场动画，两个界面通过横向滑动完成切换。</li><li>转场动画中添加头像移动缩放的共享元素动画，体现响应元素的切换。</li><li>在个人页列表加载前，添加了列表轮廓的骨架图闪烁动画，让用户感知新页面的加载动态。</li></ul> <div class="fignone"><span class="figcap"><b>图7 </b>场景实例图</span></div> <p><span><img height="416.680754" originheight="804" originwidth="385" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.51369439982963103617142178672705:50001231000000:2800:14FB1115503AB7E2E21D7961D295D095027CF25D964D790A07D34BC3E517A144.png" title="点击放大" width="206.88948000000002"></span></p> <p></p> <p><strong>具体实现</strong></p> <p>用router+sharedTransition+animateTo()的组合实现，具体操作思路如下：</p> <ol><li><span>在两个页面中设置pageTransition()转场动画参数，然后在列表页头像的点击事件中添加router跳转，实现列表页到个人页的转场动画效果。</span></li><li><span>在两个页面的头像组件Image中添加属性sharedTransition，并赋予相同的id以进行唯一匹配。同时，添加共享元素动画的时间等相关参数，实现头像从列表页向个人页移动的动画效果。</span></li><li><span>根据个人页内容的版面样式，实现一个骨架图组件，并使用animateTo()添加反复渐显渐隐的动画行为。在个人页组件onAppear()时呈现该动画，具体内容刷新后隐藏动画元素。</span></li></ol> <p><strong>关键代码</strong></p> <p>转场动画设置：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/VisionOptPage.ets#L30-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// page A Transition animation settings</span></li><li><span class="hljs-built_in">pageTransition</span>() {</li><li>  <span class="hljs-built_in">PageTransitionEnter</span>({ type: RouteType.None, duration: <span class="hljs-number">400</span> })</li><li>    <span class="hljs-selector-class">.slide</span>(SlideEffect.Left)</li><li>  <span class="hljs-built_in">PageTransitionExit</span>({ type: RouteType.None, duration: <span class="hljs-number">400</span> })</li><li>    <span class="hljs-selector-class">.slide</span>(SlideEffect.Left)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/VisionOptPage.ets#L30-L37" target="_blank">VisionOptPage.ets</a></div></div></div></div> <p>列表页中共享元素动画设置：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/view/OptChatItemView.ets#L30-L35" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Use the avatar as a shared element in the list and specify the id as sharedImage+this.itemData.id</span></li><li><span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">itemData</span>.<span class="hljs-variable">avatar</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40vp'</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'40vp'</span>)</li><li>  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>  .<span class="hljs-title function_">sharedTransition</span>(<span class="hljs-string">'sharedImage'</span> + <span class="hljs-keyword">this</span>.<span class="hljs-variable">itemData</span>.<span class="hljs-variable">id</span>, { <span class="hljs-variable">duration</span>: <span class="hljs-number">500</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">FastOutSlowIn</span>, <span class="hljs-variable">delay</span>: <span class="hljs-number">0</span> })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/view/OptChatItemView.ets#L30-L35" target="_blank">OptChatItemView.ets</a></div></div></div></div> </div> <p>个人页中共享元素动画设置：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/ProfilePage.ets#L57-L66" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// The personal page sharing element needs to be the same as the previous page id.</span></li><li><span class="hljs-title function_">Image</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">itemData</span>.<span class="hljs-variable">avatar</span>)</li><li>  .<span class="hljs-title function_">size</span>({</li><li>    <span class="hljs-variable">width</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">user_image_size</span>'),</li><li>    <span class="hljs-variable">height</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">user_image_size</span>')</li><li>  })<span class="hljs-comment">// .borderRadius($r('app.float.user_image_border_radius'))</span></li><li>  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)</li><li>  .<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">bottom</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">user_image_padding</span>'), <span class="hljs-variable">top</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">app</span>.<span class="hljs-title class_">float</span>.<span class="hljs-title class_">user_image_padding</span>') })</li><li>  .<span class="hljs-title function_">sharedTransition</span>(<span class="hljs-string">'sharedImage'</span> + <span class="hljs-keyword">this</span>.<span class="hljs-variable">itemData</span>.<span class="hljs-variable">id</span>,</li><li>    { <span class="hljs-variable">duration</span>: <span class="hljs-number">500</span>, <span class="hljs-variable">curve</span>: <span class="hljs-title class_">Curve</span>.<span class="hljs-title class_">FastOutSlowIn</span>, <span class="hljs-variable">delay</span>: <span class="hljs-number">0</span> })</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/ProfilePage.ets#L57-L66" target="_blank">ProfilePage.ets</a></div></div></div></div> <p>骨架图实现：</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/view/LoadingView.ets#L30-L65" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Skeleton diagram, presenting skeleton animation in a fading way.</span></li><li><span class="hljs-title function_">startAnimation</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>(<span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">SKELETON_ANIMATION</span>, () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">listOpacity</span> = <span class="hljs-variable">CommonConstants</span>.<span class="hljs-variable">HALF_OPACITY</span>;</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-comment">// Skeletal diagram layout</span></li><li><span class="hljs-title function_">build</span>() {</li><li>  <span class="hljs-title function_">Row</span>() {</li><li>    <span class="hljs-title function_">List</span>({ <span class="hljs-variable">space</span>: <span class="hljs-title class_">Constants</span>.<span class="hljs-title class_">RESOURCE_LIST_SPACE</span> }) {</li><li>      <span class="hljs-title function_">ForEach</span>(<span class="hljs-variable">SkeletonData</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">SkeType</span>) =&gt; {</li><li>        <span class="hljs-title function_">ListItem</span>() {</li><li>          <span class="hljs-title function_">ArticleSkeletonView</span>({ <span class="hljs-variable">isMine</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">isMine</span>, <span class="hljs-variable">isFeed</span>: <span class="hljs-title class_">item</span>.<span class="hljs-title class_">isFeed</span> })</li><li>        }</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>({</li><li>      <span class="hljs-variable">left</span>: <span class="hljs-string">'12vp'</span>,</li><li>      <span class="hljs-variable">right</span>: <span class="hljs-string">'12vp'</span></li><li>    })</li><li>    .<span class="hljs-title function_">lanes</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-variable">BarState</span>.<span class="hljs-variable">Off</span>)</li><li>
</li><li>    <span class="hljs-title function_">Row</span>()</li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">0</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>($<span class="hljs-title function_">r</span>(<span class="hljs-string">'app.color.skeleton_color_medium'</span>))</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">opacity</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">listOpacity</span>)</li><li>  .<span class="hljs-title function_">onAppear</span>(() =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">startAnimation</span>();</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/view/LoadingView.ets#L30-L65" target="_blank">LoadingView.ets</a></div></div></div></div> <div class="tiledSection"><h3 id="section36181326113013">动画时延场景案例<i class="anchor-icon anchor-icon-link" anchorid="section36181326113013" tips="复制节点链接"></i></h3><p>页面转场动画对提升用户体验至关重要。动画时延过长会显著影响用户的点击完成时延，因为动画完成时间直接影响用户何时能开始与应用交互。动画时延的主要原因是动画时长设置过长。</p> <p>常见的页面转场动画时长参数有：</p> <ol><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabs" target="_blank">Tabs</a>组件设置TabContent切换动画时长，即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabs#animationduration" target="_blank">animationDuration</a>属性。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper" target="_blank">Swiper</a>组件设置子组件切换动画时长，即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper#duration" target="_blank">duration</a>属性。</li><li>页面间转场（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-page-transition-animation" target="_blank">pageTransition</a>）设置转场动画时长，即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-page-transition-animation#pagetransitionoptions对象说明" target="_blank">PageTransitionOptions</a>对象中的duration字段。</li></ol> <p>使用Tabs组件进行页面切换时，当不设置BottomTabBarStyle时默认<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-tabs#animationduration" target="_blank">animationDuration</a>属性有300ms的动画时长，当该属性值设置过长时会导致完成时延变大。接下来将该属性值分别设置为100ms与1000ms来探究animationDuration属性对完成时延的影响。</p> <p>实验一：设置animationDuration为100ms</p> <div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/TabsPositiveExample.ets#L22-L82" data-highlighted="yes"><ol class="linenums"><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TabsPositiveExample</span> {</li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">currentIndex</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">controller</span>: <span class="hljs-title class_">TabsController</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TabsController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">list</span>: <span class="hljs-title class_">string</span>[] = [<span class="hljs-string">'green'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'yellow'</span>, <span class="hljs-string">'pink'</span>];</li><li>
</li><li>  @<span class="hljs-title function_">Builder</span></li><li>  <span class="hljs-title function_">customContent</span>(<span class="hljs-variable">color</span>: <span class="hljs-title class_">Color</span>) {</li><li>    <span class="hljs-title function_">Column</span>()</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">color</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">Row</span>({ <span class="hljs-variable">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title function_">ForEach</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">list</span>, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; {</li><li>          <span class="hljs-title function_">Text</span>(<span class="hljs-variable">item</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-variable">TextAlign</span>.<span class="hljs-variable">Center</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)</li><li>            .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">currentIndex</span> === <span class="hljs-variable">index</span> ? <span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-title class_">Black</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">currentIndex</span> === <span class="hljs-variable">index</span> ? <span class="hljs-variable">Color</span>.<span class="hljs-variable">Blue</span> : <span class="hljs-string">'#f2f2f2'</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">currentIndex</span> = <span class="hljs-variable">index</span>;</li><li>              <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">changeIndex</span>(<span class="hljs-variable">index</span>);</li><li>            })</li><li>        }, (<span class="hljs-variable">item</span>: <span class="hljs-title class_">string</span>, <span class="hljs-variable">index</span>: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">item</span>) + <span class="hljs-variable">index</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>
</li><li>      <span class="hljs-title function_">Tabs</span>({ <span class="hljs-variable">barPosition</span>: <span class="hljs-title class_">BarPosition</span>.<span class="hljs-title class_">Start</span>, <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span> }) {</li><li>        <span class="hljs-title function_">TabContent</span>() {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customContent</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Green</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title function_">TabContent</span>() {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customContent</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Blue</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title function_">TabContent</span>() {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customContent</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Yellow</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title function_">TabContent</span>() {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">customContent</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Pink</span>)</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">animationDuration</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>      .<span class="hljs-title function_">barHeight</span>(<span class="hljs-number">0</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-keyword">false</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/TabsPositiveExample.ets#L22-L82" target="_blank">TabsPositiveExample.ets</a></div></div></div></div> <p><span><img height="387.2855" originheight="924" originwidth="2195" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.83942727167711825203234654665210:50001231000000:2800:0CD78F6743D4623D91A5EB884E862DEE71ABD6C86A0C0ABDDCAD660CD3562EFC.png" title="点击放大" width="920"></span></p> <div class="p">实验二：设置animationDuration为1000ms<div class="screenLinkPre"><div _ngcontent-bgx-c106="" class="highlight-div"><div _ngcontent-bgx-c106="" class="highlight-div-header"><div _ngcontent-bgx-c106="" class="highlight-div-header-left"><div _ngcontent-bgx-c106="" class="handle-button expand-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bgx-c106="" class="highlight-div-header-right"><div _ngcontent-bgx-c106="" class="handle-button ai-button"></div><div _ngcontent-bgx-c106="" class="handle-button line-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bgx-c106="" class="handle-button theme-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bgx-c106="" class="handle-button copy-button"><div _ngcontent-bgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/TabsNegativeExample.ets#L22-L94" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Entry</span></li><li><span class="hljs-keyword">@Component</span></li><li>struct TabsNegativeExample {</li><li>  <span class="hljs-comment">// ...</span></li><li>  private controller: TabsController = new <span class="hljs-built_in">TabsController</span>();</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>
</li><li>      <span class="hljs-built_in">Tabs</span>({ barPosition: BarPosition.Start, controller: this.controller }) {</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>      }</li><li>      <span class="hljs-selector-class">.barHeight</span>(<span class="hljs-number">0</span>)</li><li>      <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>      <span class="hljs-selector-class">.animationDuration</span>(<span class="hljs-number">1000</span>)</li><li>      <span class="hljs-selector-class">.scrollable</span>(false)</li><li>    }</li><li>    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/OptimizationAppDelay/entry/src/main/ets/pages/TabsNegativeExample.ets#L22-L94" target="_blank">TabsNegativeExample.ets</a></div></div></div></div> </div> <p><span><img height="387.458" originheight="924" originwidth="2194" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.16115702810455469750927482244362:50001231000000:2800:CBF7F2F552B398557AA6DA88C96FB730EE622AAF6655FCA66A40B2BFA28B5C59.png" title="点击放大" width="920"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表7 </b>运行效果图</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.29.11.2.3.1.1" valign="top" width="50%"><p>设置animationDuration为100ms</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.29.11.2.3.1.2" valign="top" width="50%"><p>设置animationDuration为1000ms</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><span><img height="538.8854100000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.94752371153673149989317634812240:50001231000000:2800:518217E7D5846B8ABE6258966523D1BACE5E2AACFA9837EBA36060FAD2F1FB89.gif" title="点击放大" width="270.41134400000004"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img height="538.9971300000001" originheight="1080" originwidth="523" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163421.72352009517377071305250978803663:50001231000000:2800:9580ADEB04537BBBA8493E138AC623B06F41EF0537825D4F81ADCB661DBEE981.gif" title="点击放大" width="268.27962"></span></p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表8 </b>animationDuration属性值对比</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.29.12.2.3.1.1" valign="top" width="50%"><p>animationDuration属性值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.29.12.2.3.1.2" valign="top" width="50%"><p>完成时延</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>100ms</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>99ms39μs</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>1000ms</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>1s7ms693μs</p> </td> </tr>  </tbody></table></div> </div> <p>通过减少animationDuration属性的数值，可以减小Tabs组件切换动画的完成时延。如果不设置BottomTabBarStyle样式，动画时长默认为300毫秒。开发者可以根据实际业务场景，适当降低该动画时长，以提高应用性能。</p> </div> </div> <div></div></div>