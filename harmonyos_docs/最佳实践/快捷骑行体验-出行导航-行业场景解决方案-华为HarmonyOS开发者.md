<h1 _ngcontent-bdl-c119="" class="doc-title ng-star-inserted" title="快捷骑行体验"> 快捷骑行体验 </h1>

<div _ngcontent-bdl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1820752333613">概述<i class="anchor-icon anchor-icon-link" anchorid="section1820752333613" tips="复制节点链接"></i></h2><p>本场景解决方案涉及共享租赁、即时配送等应用，以共享单车为例，使用实况窗、地图导航和统一扫码等技术，为消费者提供更好的骑行体验。</p> </div> <div class="tiledSection"><h2 id="section185191825013">效果展示<i class="anchor-icon anchor-icon-link" anchorid="section185191825013" tips="复制节点链接"></i></h2><p><span><img originheight="480" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.58253621756183682549720530851312:50001231000000:2800:6630944AA3D5E106EF5F4CA1F99C5B471EE6A2E675874D9774B9B47A4015EBB0.gif" class="notEnlarge" width="232" height="480"></span></p> </div> <div class="tiledSection"><h2 id="section1411425416503">场景说明<i class="anchor-icon anchor-icon-link" anchorid="section1411425416503" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section79921418102" class="firsth2">场景整体介绍<i class="anchor-icon anchor-icon-link" anchorid="section79921418102" tips="复制节点链接"></i></h3><p></p> <p>为了简化骑行流程，提升用户体验，建议如下：</p> <p></p> <p>1. 用户可以从应用内或者系统扫码入口进行扫码，直接进入共享单车解锁页面。</p> <p>2. 点击解锁按钮后，拉起实况窗显示骑行状态。</p> <p>3. 完成还车、支付等操作后，实况窗状态实时更新。</p> <p></p> <p>这样，用户无需重复寻找应用和功能入口，整个流程更加简便。</p> </div> <div class="tiledSection"><h3 id="section7327155319596">场景优势<i class="anchor-icon anchor-icon-link" anchorid="section7327155319596" tips="复制节点链接"></i></h3><p>本场景结合提供的实况窗、地图导航、扫码等系统能力，可以带给用户更加便捷高效的体验。具体优势如下：</p> <p>1.使用实况窗技术帮助用户聚焦任务，快速查看和即时处理。支持在锁屏、通知中心显示卡片，在状态栏显示胶囊，点击胶囊后展开悬浮卡片，方便用户查看重点信息。多种显示方式确保信息即时触达，减少用户进出应用或服务页面的次数。</p> <p>2.基于Map Kit实现个性化地图呈现、地图搜索和路线规划等功能，提供缩放、旋转、移动等流畅的手势交互体验。</p> </div> <div class="tiledSection"><h2 id="section17159729607">场景分析<i class="anchor-icon anchor-icon-link" anchorid="section17159729607" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section12709566010" class="firsth2">典型场景<i class="anchor-icon anchor-icon-link" anchorid="section12709566010" tips="复制节点链接"></i></h3> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><tbody><tr><td align="left" class="cellrowborder" valign="top" width="9.19091909190919%"><p><strong>编号</strong></p> </td> <td align="left" class="cellrowborder" valign="top" width="15.171517151715172%"><p><strong>场景名称</strong></p> </td> <td align="left" class="cellrowborder" valign="top" width="30.133013301330138%"><p><strong>描述</strong></p> </td> <td align="left" class="cellrowborder" valign="top" width="45.504550455045504%"><p><strong>实现方案</strong></p> </td> </tr> <tr><td align="left" class="cellrowborder" valign="top" width="9.19091909190919%"><p>1</p> </td> <td align="left" class="cellrowborder" valign="top" width="15.171517151715172%"><p>扫码解锁</p> </td> <td align="left" class="cellrowborder" valign="top" width="30.133013301330138%"><p>首页和共享单车页面均可扫码直达解锁页面。</p> </td> <td align="left" class="cellrowborder" valign="top" width="45.504550455045504%"><p>基于ScanKit能够快速实现扫码能力</p> </td> </tr> <tr><td align="left" class="cellrowborder" valign="top" width="9.19091909190919%"><p>2</p> </td> <td align="left" class="cellrowborder" valign="top" width="15.171517151715172%"><p>地图规划路径</p> </td> <td align="left" class="cellrowborder" valign="top" width="30.133013301330138%"><p>选中目的地，展示最短路径。</p> </td> <td align="left" class="cellrowborder" valign="top" width="45.504550455045504%"><p>基于MapKit能够快速实现路径规划和路线绘制能力</p> </td> </tr> <tr><td align="left" class="cellrowborder" valign="top" width="9.19091909190919%"><p>3</p> </td> <td align="left" class="cellrowborder" valign="top" width="15.171517151715172%"><p>实况窗展示骑行状态</p> </td> <td align="left" class="cellrowborder" valign="top" width="30.133013301330138%"><p>骑行过程中，用户需要查看骑行状态。</p> </td> <td align="left" class="cellrowborder" valign="top" width="45.504550455045504%"><p>使用实况窗，用户在锁屏状态下也能查看骑行状态，无需解锁应用。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section152021651117">场景实现<i class="anchor-icon anchor-icon-link" anchorid="section152021651117" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section22818268213" class="firsth2">业务流程图<i class="anchor-icon anchor-icon-link" anchorid="section22818268213" tips="复制节点链接"></i></h3><p>左图展示了当前骑行场景的流程，右图展示了优化后的流程。优化后，省去了在应用间切换和寻找功能入口的步骤，简化了用户操作，提升了用户体验。</p> <p><span><img originheight="663" originwidth="1072" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.11039743689279435836783283292957:50001231000000:2800:61DEA1CA466B41F6CAB1E06EBF72D81859D97DED00BC9B8FD43B4174A941BC3E.png" width="920" height="568.9925373134329"></span></p> </div> <div class="tiledSection"><h3 id="section166821848226">骑行状态图<i class="anchor-icon anchor-icon-link" anchorid="section166821848226" tips="复制节点链接"></i></h3><p><span><img originheight="107" originwidth="957" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.30827926538495985156876011287068:50001231000000:2800:3626CBD5261508A0295B157E05638A71DEEC1D236EF456420DE436F77A19E8D6.png" width="920" height="102.86311389759665"></span></p> </div> <div class="tiledSection"><h3 id="section3467610437">时序图<i class="anchor-icon anchor-icon-link" anchorid="section3467610437" tips="复制节点链接"></i></h3><p><span><img height="556.468409" originheight="1079" originwidth="1157" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.09688320937250509916595231762622:50001231000000:2800:EA7F992B2FE707737BCB51521E9673925B90D4E0AE0728A368B6A262C1D4DB19.png" title="点击放大" width="596.505"></span></p> </div> <div class="tiledSection"><h2 id="section349016376320">扫码解锁<i class="anchor-icon anchor-icon-link" anchorid="section349016376320" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section134354511836" class="firsth2">效果展示<i class="anchor-icon anchor-icon-link" anchorid="section134354511836" tips="复制节点链接"></i></h3><p>在首页或者共享单车页面，点击扫码进入扫码界面，可以使用后置摄像头进行扫码，也可以点击图库选择二维码图片进行扫码。“扫码直达”相关的使用请参见“<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/scan-directservice" target="_blank">接入扫码直达服务</a>”。</p> <p></p> <p><span><img originheight="480" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.95297669718400627060491736224512:50001231000000:2800:A5CCE977693AD8BB94D1BF794A324C09D3A539034309415219A1B508404FADCB.gif" class="notEnlarge" width="232" height="480"></span></p> </div> <div class="tiledSection"><h3 id="section1912392111415">时序图<i class="anchor-icon anchor-icon-link" anchorid="section1912392111415" tips="复制节点链接"></i></h3><p>主要业务流程如下：</p> <p class="msonormal"><span><img height="201.495" originheight="366" originwidth="950" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.08003575799083270060626234167853:50001231000000:2800:51F1C24E1816C6F51BB28EB6EB3673630F1F625A16B0B99B3BE60D3BF5352CCF.png" title="点击放大" width="523.6875"></span></p> </div> <div class="tiledSection"><h3 id="section174762391413">关键点说明<i class="anchor-icon anchor-icon-link" anchorid="section174762391413" tips="复制节点链接"></i></h3><p>1、使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/scan-kit-guide" target="_blank">Scan Kit</a>实现扫码能力，Scan Kit应用了多项计算机视觉技术和AI算法技术，不仅实现了远距离自动扫码，同时还针对多种复杂扫码场景（如暗光、污损、模糊、小角度、曲面码等）做了识别优化，提升扫码成功率与用户体验。</p> <p>2、在Entry模块的module.json5文件的requestPermissions字段中添加ohos.permission.CAMERA权限，以申请系统相机权限。</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/module.json5#L52-L110" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"requestPermissions"</span>: [</li><li>  <span class="hljs-comment">// ...</span></li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.CAMERA"</span>,</li><li>    <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:reason_camera"</span>,</li><li>    <span class="hljs-string">"usedScene"</span>: {</li><li>      <span class="hljs-string">"abilities"</span>: [</li><li>        <span class="hljs-string">"EntryAbility"</span></li><li>      ],</li><li>      <span class="hljs-string">"when"</span>: <span class="hljs-string">"always"</span></li><li>    }</li><li>  }</li><li>]</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/module.json5#L52-L110" target="_blank">module.json5</a></div></div></div></div> <p>3、支持多种识码类型，常用的是二维码，也支持条形码扫描。</p> </div> <div class="tiledSection"><h3 id="section7571304517">关键代码片段<i class="anchor-icon anchor-icon-link" anchorid="section7571304517" tips="复制节点链接"></i></h3><div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/ScanUtil.ets#L16-L46" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { scanBarcode, scanCore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { router } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CyclingConstants</span>, <span class="hljs-title class_">CyclingStatus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../constants/CyclingConstants'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">Logger</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Logger'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'uiContext'</span>);</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScanUtil</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">scan</span>(<span class="hljs-attr">obj</span>: <span class="hljs-title class_">Object</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = {</li><li>      <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>, scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ONE_D_CODE</span>],</li><li>      <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>,</li><li>      <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span></li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      scanBarcode.<span class="hljs-title function_">startScanForResult</span>(uiContext?.<span class="hljs-title function_">getHostContext</span>(), options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: scanBarcode.ScanResult</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[BicycleSharing]'</span>, <span class="hljs-string">'Promise scan result: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>        <span class="hljs-keyword">if</span> (result.<span class="hljs-property">scanType</span> === <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-property">SCAN_TYPE</span>) {</li><li>          <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-property">CYCLING_STATUS</span>, <span class="hljs-title class_">CyclingStatus</span>.<span class="hljs-property">WAITING_UNLOCK</span>);</li><li>          uiContext?.<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/ConfirmUnlock'</span> });</li><li>        }</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[BicycleSharing]'</span>, <span class="hljs-string">'Promise error: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[BicycleSharing]'</span>, <span class="hljs-string">'failReason: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/ScanUtil.ets#L16-L46" target="_blank">ScanUtil.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section1551812341958">地图路径规划<i class="anchor-icon anchor-icon-link" anchorid="section1551812341958" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section84489511520" class="firsth2">效果展示<i class="anchor-icon anchor-icon-link" anchorid="section84489511520" tips="复制节点链接"></i></h3><p>进入找车页面后，可以点击任意位置模拟自行车的所在地，地图将进行步行路线规划并增加标记点。</p> <p></p> <p><span><img originheight="480" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.19730090682798198009161639326223:50001231000000:2800:0FC17414B2B87E094FE3187623D58CA808718D0761914901D202A2F6EF25B484.gif" class="notEnlarge" width="232" height="480"></span></p> </div> <div class="tiledSection"><h3 id="section10312142811612">时序图<i class="anchor-icon anchor-icon-link" anchorid="section10312142811612" tips="复制节点链接"></i></h3><p><span><img height="435.9075" originheight="738" originwidth="886" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163342.80422766773204746600699631171699:50001231000000:2800:9224CD61E64CA0290FAF26CE59F1C61ED08040613F2044599AD5FDCCB822C7C2.png" title="点击放大" width="523.6875"></span></p> </div> <div class="tiledSection"><h3 id="section920418421610">关键点说明<i class="anchor-icon anchor-icon-link" anchorid="section920418421610" tips="复制节点链接"></i></h3><p>1、使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/map-kit-guide" target="_blank">Map Kit</a>实现地图能力，Map Kit可以帮助开发者实现个性化地图呈现、地图搜索和路线规划等功能，轻松完成地图构建工作。</p> <p>2、参考文档<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/map-config-agc#section16133115441516" target="_blank">开通地图服务</a>去AppGallery Connect开通地图服务。注意要在工程中entry模块的module.json5文件中配置client_id。</p> <p>3、启用“我的位置”之前，确保应用已获取用户定位权限。需要申请ohos.permission.LOCATION和ohos.permission.APPROXIMATELY_LOCATION权限。</p> </div> <div class="tiledSection"><h3 id="section1020618371">关键代码片段<i class="anchor-icon anchor-icon-link" anchorid="section1020618371" tips="复制节点链接"></i></h3><p>1、导入Map Kit</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L16-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { MapComponent, mapCommon, <span class="hljs-built_in">map</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MapKit'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L16-L16" target="_blank">CyclingPage.ets</a></div></div></div></div> <p>2、集成地图组件，初始化地图页面</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L48-L113" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-comment">// initialize map</span></li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">callback</span> = <span class="hljs-variable">async</span> (<span class="hljs-variable">err</span>, <span class="hljs-variable">mapController</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">hasPermissions</span> = <span class="hljs-keyword">false</span>;</li><li>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable">err</span>) {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span> = <span class="hljs-variable">mapController</span>;</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mapLoad'</span>, <span class="hljs-variable">async</span> () =&gt; {</li><li>        <span class="hljs-variable">hasPermissions</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">checkPermissions</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>);</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">hasPermissions</span>) {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-title function_">requestPermissions</span>();</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">hasPermissions</span>) {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">requestInfo</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">CurrentLocationRequest</span> = {</li><li>            <span class="hljs-string">'priority'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestPriority</span>.<span class="hljs-title class_">FIRST_FIX</span>,</li><li>            <span class="hljs-string">'scenario'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestScenario</span>.<span class="hljs-title class_">UNSET</span>,</li><li>            <span class="hljs-string">'maxAccuracy'</span>: <span class="hljs-number">0</span></li><li>          };</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">locationChange</span> = <span class="hljs-variable">async</span> (): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; =&gt; {</li><li>          };</li><li>          <span class="hljs-variable">geoLocationManager</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable">requestInfo</span>, <span class="hljs-variable">locationChange</span>);</li><li>          <span class="hljs-variable">geoLocationManager</span>.<span class="hljs-title function_">getCurrentLocation</span>(<span class="hljs-variable">requestInfo</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable">async</span> (<span class="hljs-variable">result</span>) =&gt; {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-variable">mapPosition</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> =</li><li>              <span class="hljs-variable">await</span> <span class="hljs-variable">map</span>.<span class="hljs-title function_">convertCoordinate</span>(<span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">WGS84</span>, <span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">GCJ02</span>, <span class="hljs-variable">result</span>);</li><li>            <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'longitude'</span>, <span class="hljs-variable">mapPosition</span>.<span class="hljs-variable">longitude</span>);</li><li>            <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'latitude'</span>, <span class="hljs-variable">mapPosition</span>.<span class="hljs-variable">latitude</span>);</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-variable">cameraPosition</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">CameraPosition</span> = {</li><li>              <span class="hljs-variable">target</span>: <span class="hljs-title class_">mapPosition</span>,</li><li>              <span class="hljs-variable">zoom</span>: <span class="hljs-number">15</span>,</li><li>              <span class="hljs-variable">tilt</span>: <span class="hljs-number">0</span>,</li><li>              <span class="hljs-variable">bearing</span>: <span class="hljs-number">0</span></li><li>            };</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-variable">cameraUpdate</span> = <span class="hljs-variable">map</span>.<span class="hljs-title function_">newCameraPosition</span>(<span class="hljs-variable">cameraPosition</span>);</li><li>            <span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">animateCamera</span>(<span class="hljs-variable">cameraUpdate</span>, <span class="hljs-number">1000</span>);</li><li>          })</li><li>        }</li><li>      });</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mapClick'</span>, <span class="hljs-variable">async</span> (<span class="hljs-variable">position</span>) =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">clear</span>();</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">marker</span>?.<span class="hljs-title function_">remove</span>();</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">requestInfo</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">CurrentLocationRequest</span> = {</li><li>          <span class="hljs-string">'priority'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestPriority</span>.<span class="hljs-title class_">FIRST_FIX</span>,</li><li>          <span class="hljs-string">'scenario'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestScenario</span>.<span class="hljs-title class_">UNSET</span>,</li><li>          <span class="hljs-string">'maxAccuracy'</span>: <span class="hljs-number">0</span></li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">locationChange</span> = <span class="hljs-variable">async</span> (<span class="hljs-variable">location</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">Location</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; =&gt; {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">wgs84Position</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> = {</li><li>            <span class="hljs-variable">latitude</span>: <span class="hljs-title class_">location</span>.<span class="hljs-title class_">latitude</span>,</li><li>            <span class="hljs-variable">longitude</span>: <span class="hljs-title class_">location</span>.<span class="hljs-title class_">longitude</span></li><li>          };</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">gcj02Posion</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> =</li><li>            <span class="hljs-variable">await</span> <span class="hljs-variable">map</span>.<span class="hljs-title function_">convertCoordinate</span>(<span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">WGS84</span>, <span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">GCJ02</span>,</li><li>              <span class="hljs-variable">wgs84Position</span>);</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">myPosition</span> = <span class="hljs-variable">gcj02Posion</span></li><li>        };</li><li>        <span class="hljs-variable">geoLocationManager</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable">requestInfo</span>, <span class="hljs-variable">locationChange</span>);</li><li>        <span class="hljs-comment">// add walking marker</span></li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">marker</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">addMarker</span>(<span class="hljs-variable">position</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>);</li><li>        <span class="hljs-keyword">const</span> <span class="hljs-variable">walkingRoutes</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">walkingRoutes</span>(<span class="hljs-variable">position</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">myPosition</span>);</li><li>        <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">paintRoute</span>(<span class="hljs-variable">walkingRoutes</span>!, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapPolyline</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>);</li><li>      });</li><li>    }</li><li>  };</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L48-L113" target="_blank">CyclingPage.ets</a></div></div></div></div> <p>3、向用户申请授予定位权限，启动“我的位置”功能</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L282-L310" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">requestPermissions</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">atManager</span>: <span class="hljs-title class_">abilityAccessCtrl</span>.<span class="hljs-title class_">AtManager</span> = <span class="hljs-variable">abilityAccessCtrl</span>.<span class="hljs-title function_">createAtManager</span>();</li><li>  <span class="hljs-variable">atManager</span>.<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>,</li><li>    [<span class="hljs-string">'ohos.permission.LOCATION'</span>, <span class="hljs-string">'ohos.permission.APPROXIMATELY_LOCATION'</span>])</li><li>    .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">setMyLocationEnabled</span>(<span class="hljs-keyword">true</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">setMyLocationControlsEnabled</span>(<span class="hljs-keyword">true</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">setCompassControlsEnabled</span>(<span class="hljs-keyword">false</span>);</li><li>      <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">setMyLocationStyle</span>({ <span class="hljs-variable">displayType</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">MyLocationDisplayType</span>.<span class="hljs-title class_">FOLLOW</span> });</li><li>      <span class="hljs-variable">geoLocationManager</span>.<span class="hljs-title function_">getCurrentLocation</span>().<span class="hljs-title function_">then</span>(<span class="hljs-variable">async</span> (<span class="hljs-variable">result</span>) =&gt; {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">mapPosition</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> =</li><li>          <span class="hljs-variable">await</span> <span class="hljs-variable">map</span>.<span class="hljs-title function_">convertCoordinate</span>(<span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">WGS84</span>, <span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">GCJ02</span>, <span class="hljs-variable">result</span>);</li><li>        <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'longitude'</span>, <span class="hljs-variable">mapPosition</span>.<span class="hljs-variable">longitude</span>);</li><li>        <span class="hljs-variable">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'latitude'</span>, <span class="hljs-variable">mapPosition</span>.<span class="hljs-variable">latitude</span>);</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">cameraPosition</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">CameraPosition</span> = {</li><li>          <span class="hljs-variable">target</span>: <span class="hljs-title class_">mapPosition</span>,</li><li>          <span class="hljs-variable">zoom</span>: <span class="hljs-number">15</span>,</li><li>          <span class="hljs-variable">tilt</span>: <span class="hljs-number">0</span>,</li><li>          <span class="hljs-variable">bearing</span>: <span class="hljs-number">0</span></li><li>        };</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">cameraUpdate</span> = <span class="hljs-variable">map</span>.<span class="hljs-title function_">newCameraPosition</span>(<span class="hljs-variable">cameraPosition</span>);</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">animateCamera</span>(<span class="hljs-variable">cameraUpdate</span>, <span class="hljs-number">1000</span>);</li><li>      })</li><li>    })</li><li>    .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>      <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">error</span>(`<span class="hljs-variable">Failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">request</span> <span class="hljs-variable">permissions</span> <span class="hljs-keyword">from</span> <span class="hljs-variable">user</span>. <span class="hljs-variable">Code</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span> <span class="hljs-keyword">is</span> ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>    })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/CyclingPage.ets#L282-L310" target="_blank">CyclingPage.ets</a></div></div></div></div> <p>4、监听点击事件</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/FindBike.ets#L73-L96" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mapClick'</span>, <span class="hljs-variable">async</span> (<span class="hljs-variable">position</span>) =&gt; {</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">clear</span>();</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">marker</span>?.<span class="hljs-title function_">remove</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">requestInfo</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">CurrentLocationRequest</span> = {</li><li>    <span class="hljs-string">'priority'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestPriority</span>.<span class="hljs-title class_">FIRST_FIX</span>,</li><li>    <span class="hljs-string">'scenario'</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">LocationRequestScenario</span>.<span class="hljs-title class_">UNSET</span>,</li><li>    <span class="hljs-string">'maxAccuracy'</span>: <span class="hljs-number">0</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">locationChange</span> = <span class="hljs-variable">async</span> (<span class="hljs-variable">location</span>: <span class="hljs-title class_">geoLocationManager</span>.<span class="hljs-title class_">Location</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">wgs84Position</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> = {</li><li>      <span class="hljs-variable">latitude</span>: <span class="hljs-title class_">location</span>.<span class="hljs-title class_">latitude</span>,</li><li>      <span class="hljs-variable">longitude</span>: <span class="hljs-title class_">location</span>.<span class="hljs-title class_">longitude</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">gcj02Posion</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">LatLng</span> =</li><li>      <span class="hljs-variable">await</span> <span class="hljs-variable">map</span>.<span class="hljs-title function_">convertCoordinate</span>(<span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">WGS84</span>, <span class="hljs-variable">mapCommon</span>.<span class="hljs-variable">CoordinateType</span>.<span class="hljs-variable">GCJ02</span>,</li><li>        <span class="hljs-variable">wgs84Position</span>);</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">myPosition</span> = <span class="hljs-variable">gcj02Posion</span></li><li>  };</li><li>  <span class="hljs-variable">geoLocationManager</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'locationChange'</span>, <span class="hljs-variable">requestInfo</span>, <span class="hljs-variable">locationChange</span>);</li><li>
</li><li>  <span class="hljs-keyword">this</span>.<span class="hljs-variable">marker</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">addMarker</span>(<span class="hljs-variable">position</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>);</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">walkingRoutes</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">walkingRoutes</span>(<span class="hljs-variable">position</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">myPosition</span>);</li><li>  <span class="hljs-variable">await</span> <span class="hljs-variable">MapUtil</span>.<span class="hljs-title function_">paintRoute</span>(<span class="hljs-variable">walkingRoutes</span>!, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapPolyline</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">mapController</span>);</li><li>});</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/pages/FindBike.ets#L73-L96" target="_blank">FindBike.ets</a></div></div></div></div> <p>5、启动步行路径规划</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/MapUtil.ets#L48-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">walkingRoutes</span>(<span class="hljs-params">position: mapCommon.LatLng, myPosition?: mapCommon.LatLng</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: navi.<span class="hljs-property">RouteParams</span> = {</li><li>    <span class="hljs-attr">origins</span>: [myPosition!],</li><li>    <span class="hljs-attr">destination</span>: position,</li><li>    <span class="hljs-attr">language</span>: <span class="hljs-string">'zh_CN'</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> navi.<span class="hljs-title function_">getWalkingRoutes</span>(params);</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'naviDemo'</span>, <span class="hljs-string">'getWalkingRoutes success result ='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'naviDemo'</span>, <span class="hljs-string">'getWalkingRoutes fail err ='</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/MapUtil.ets#L48-L63" target="_blank">MapUtil.ets</a></div></div></div></div> <p>6、绘制路线</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/MapUtil.ets#L66-L84" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">async</span> <span class="hljs-title function_">paintRoute</span>(<span class="hljs-variable">routeResult</span>: <span class="hljs-title class_">navi</span>.<span class="hljs-title class_">RouteResult</span>, <span class="hljs-variable">mapPolyline</span>?: <span class="hljs-title class_">map</span>.<span class="hljs-title class_">MapPolyline</span>,</li><li>  <span class="hljs-variable">mapController</span>?: <span class="hljs-title class_">map</span>.<span class="hljs-title class_">MapComponentController</span>) {</li><li>  <span class="hljs-variable">mapPolyline</span>?.<span class="hljs-title function_">remove</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">polylineOption</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">MapPolylineOptions</span> = {</li><li>    <span class="hljs-variable">points</span>: <span class="hljs-title class_">routeResult</span>.<span class="hljs-title class_">routes</span>[<span class="hljs-number">0</span>].<span class="hljs-variable">overviewPolyline</span>!,</li><li>    <span class="hljs-variable">clickable</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">startCap</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">CapStyle</span>.<span class="hljs-title class_">BUTT</span>,</li><li>    <span class="hljs-variable">endCap</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">CapStyle</span>.<span class="hljs-title class_">BUTT</span>,</li><li>    <span class="hljs-variable">geodesic</span>: <span class="hljs-keyword">false</span>,</li><li>    <span class="hljs-variable">jointType</span>: <span class="hljs-title class_">mapCommon</span>.<span class="hljs-title class_">JointType</span>.<span class="hljs-title class_">BEVEL</span>,</li><li>    <span class="hljs-variable">visible</span>: <span class="hljs-keyword">true</span>,</li><li>    <span class="hljs-variable">width</span>: <span class="hljs-number">20</span>,</li><li>    <span class="hljs-variable">zIndex</span>: <span class="hljs-number">10</span>,</li><li>    <span class="hljs-variable">gradient</span>: <span class="hljs-keyword">false</span>,</li><li>    <span class="hljs-variable">color</span>: <span class="hljs-number">0xFF2970FF</span></li><li>  }</li><li>  <span class="hljs-variable">mapPolyline</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">mapController</span>?.<span class="hljs-title function_">addPolyline</span>(<span class="hljs-variable">polylineOption</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/utils/MapUtil.ets#L66-L84" target="_blank">MapUtil.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section8352839572">实况窗展示骑行状态<i class="anchor-icon anchor-icon-link" anchorid="section8352839572" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1117721582" class="firsth2">效果展示<i class="anchor-icon anchor-icon-link" anchorid="section1117721582" tips="复制节点链接"></i></h3><p>点击解锁后，实况窗显示骑行状态。完成还车、支付等操作后，实况窗的状态实时更新。支持在锁屏、通知中心显示卡片，状态栏显示胶囊形态。点击状态栏的胶囊后，展开悬浮卡片，方便用户查看骑行状态。</p> <p></p> <p><span><img originheight="480" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163343.68567631317638257433061765764143:50001231000000:2800:D69693CE265AEE4522E2351248EAE24EDD2533A4A1B1A74C40831A9A99320887.gif" class="notEnlarge" width="232" height="480"></span></p> </div> <div class="tiledSection"><h3 id="section1772710238815">时序图<i class="anchor-icon anchor-icon-link" anchorid="section1772710238815" tips="复制节点链接"></i></h3><p><span><img height="338.448824" originheight="502" originwidth="935" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163343.79088939146880702626101872985279:50001231000000:2800:6FF54B286E4E316212E7AAB63B410211D46DB358D0A7C780BBF40D41B6E7D8E0.png" title="点击放大" width="630.4200000000001"></span></p> </div> <div class="tiledSection"><h3 id="section171642347820">关键点说明<i class="anchor-icon anchor-icon-link" anchorid="section171642347820" tips="复制节点链接"></i></h3><p>1、使用Live View Kit实现实况窗服务，支持应用在设备的关键界面展示订单或服务的实时状态信息。</p> <p>2、参考文档<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/liveview-formal-authority" target="_blank">申请实况窗正式权限</a>去AppGallery Connect开通实况窗服务。</p> <p>3、此场景中仅使用了本地实况窗的能力。本地更新或结束实况窗依赖于您的应用进程。若业务需要，可使用Push Kit远程更新或结束实况窗。</p> </div> <div class="tiledSection"><h3 id="section8686194918810">关键代码片段<i class="anchor-icon anchor-icon-link" anchorid="section8686194918810" tips="复制节点链接"></i></h3><p>1、导入Live View Kit</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L16-L16" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { liveViewManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LiveViewKit'</span>;</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L16-L16" target="_blank">LiveViewController.ets</a></div></div></div></div> <p>2、创建实况窗</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L49-L63" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title">startLiveView</span>(<span class="hljs-params">context: LiveViewContext,</span></span></li><li><span class="hljs-function">  liveViewEnvironment?: LiveViewEnvironment</span>): Promise&lt;liveViewManager.LiveViewResult&gt; {</li><li>  <span class="hljs-comment">// build liveView</span></li><li>  <span class="hljs-keyword">this</span>.liveViewData = <span class="hljs-keyword">await</span> LiveViewController.buildDefaultView(context);</li><li>  <span class="hljs-keyword">let</span> env = liveViewEnvironment;</li><li>  <span class="hljs-keyword">if</span> (!env) {</li><li>    env = {</li><li>      id: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-keyword">event</span>: <span class="hljs-string">'RENT'</span></li><li>    };</li><li>  }</li><li>  <span class="hljs-keyword">this</span>.liveNotification = LiveNotification.<span class="hljs-keyword">from</span>(context, env);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.liveNotification.create(<span class="hljs-keyword">this</span>.liveViewData);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L49-L63" target="_blank">LiveViewController.ets</a></div></div></div></div> <p>3、更新和结束实况窗</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L66-L120" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-variable">async</span> <span class="hljs-title function_">updateLiveView</span>(<span class="hljs-variable">status</span>: <span class="hljs-title class_">number</span>, <span class="hljs-variable">context</span>: <span class="hljs-title class_">LiveViewContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">liveViewManager</span>.<span class="hljs-title class_">LiveViewResult</span>&gt; {</li><li>  <span class="hljs-comment">// update liveView</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-variable">liveViewData</span> = <span class="hljs-keyword">this</span>.<span class="hljs-variable">liveViewData</span>!;</li><li>  <span class="hljs-variable">switch</span> (<span class="hljs-variable">status</span>) {</li><li>    <span class="hljs-keyword">case</span> <span class="hljs-variable">CyclingStatus</span>.<span class="hljs-variable">WAITING_PAYMENT</span>:</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">title</span> = <span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_TITLE</span>;</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">content</span> = [</li><li>        {</li><li>          <span class="hljs-variable">text</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">WAITING_PAYMENT_CONTENT</span>,</li><li>          <span class="hljs-variable">textColor</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">CONTENT_COLOR</span></li><li>        }</li><li>      ];</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">clickAction</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">LiveViewController</span>.<span class="hljs-title function_">buildWantAgent</span>(<span class="hljs-variable">context</span>.<span class="hljs-variable">want</span>);</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">layoutData</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextLayoutBuilder</span>()</li><li>        .<span class="hljs-title function_">setTitle</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_LAYOUT_TITLE</span>)</li><li>        .<span class="hljs-title function_">setContent</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_LAYOUT_CONTENT</span>)</li><li>        .<span class="hljs-title function_">setDescPic</span>(<span class="hljs-string">'bike_page.png'</span>);</li><li>
</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">capsule</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextCapsuleBuilder</span>()</li><li>        .<span class="hljs-title function_">setIcon</span>(<span class="hljs-string">'white_bike.png'</span>)</li><li>        .<span class="hljs-title function_">setBackgroundColor</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">CAPSULE_COLOR</span>)</li><li>        .<span class="hljs-title function_">setTitle</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_LAYOUT_TITLE</span>)</li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> <span class="hljs-variable">CyclingStatus</span>.<span class="hljs-variable">PAYMENT_COMPLETED</span>:</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">title</span> = <span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_TITLE</span>;</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">clickAction</span> = <span class="hljs-variable">await</span> <span class="hljs-variable">LiveViewController</span>.<span class="hljs-title function_">buildWantAgent</span>(<span class="hljs-variable">context</span>.<span class="hljs-variable">want</span>);</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">content</span> = [</li><li>        {</li><li>          <span class="hljs-variable">text</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">WAITING_PAYMENT_PAY</span>,</li><li>          <span class="hljs-variable">textColor</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">CONTENT_COLOR</span></li><li>        },</li><li>        {</li><li>          <span class="hljs-variable">text</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">WAITING_PAYMENT_PAY_SUCCESS</span>,</li><li>          <span class="hljs-variable">textColor</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">CONTENT_COLOR</span></li><li>        }</li><li>      ];</li><li>
</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">primary</span>.<span class="hljs-variable">layoutData</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextLayoutBuilder</span>()</li><li>        .<span class="hljs-title function_">setTitle</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_PAY_END</span>)</li><li>        .<span class="hljs-title function_">setContent</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">WAITING_PAYMENT_LAYOUT_CONTENT</span>)</li><li>        .<span class="hljs-title function_">setDescPic</span>(<span class="hljs-string">'bike_page.png'</span>);</li><li>
</li><li>      <span class="hljs-variable">liveViewData</span>.<span class="hljs-variable">capsule</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">TextCapsuleBuilder</span>()</li><li>        .<span class="hljs-title function_">setIcon</span>(<span class="hljs-string">'white_bike.png'</span>)</li><li>        .<span class="hljs-title function_">setBackgroundColor</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">CAPSULE_COLOR</span>)</li><li>        .<span class="hljs-title function_">setTitle</span>(<span class="hljs-variable">CyclingConstants</span>.<span class="hljs-variable">PAYMENT_COMPLETED_CAPSULE_TITLE</span>)</li><li>
</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">liveNotification</span>!.<span class="hljs-title function_">stop</span>(<span class="hljs-variable">liveViewData</span>);</li><li>    <span class="hljs-variable">default</span>:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">await</span> <span class="hljs-keyword">this</span>.<span class="hljs-variable">liveNotification</span>!.<span class="hljs-title function_">update</span>(<span class="hljs-variable">liveViewData</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewController.ets#L66-L120" target="_blank">LiveViewController.ets</a></div></div></div></div> <p>4、开发用户自定义向沉浸态实况窗</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/entryability/LiveViewLockScreenExtAbility.ets#L20-L45" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LiveViewLockScreenExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">LiveViewLockScreenExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'LiveViewLockScreenTag'</span>, <span class="hljs-string">'LiveViewLockScreenExtAbility onCreate begin.'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'LiveViewLockScreenTag'</span>, <span class="hljs-string">'LiveViewLockScreenExtAbility onForeground begin.'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'LiveViewLockScreenTag'</span>, <span class="hljs-string">'LiveViewLockScreenExtAbility onBackground begin.'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'LiveViewLockScreenTag'</span>, <span class="hljs-string">'LiveViewLockScreenExtAbility onDestroy begin.'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionCreate</span>(<span class="hljs-params">_want: Want, session: UIExtensionContentSession</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'LiveViewLockScreenTag'</span>, <span class="hljs-string">'LiveViewLockScreenExtAbility onSessionCreate begin.'</span>);</li><li>    session.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/LiveViewLockScreenPage'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onSessionDestroy</span>(<span class="hljs-params">_session: UIExtensionContentSession</span>) {</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/entryability/LiveViewLockScreenExtAbility.ets#L20-L45" target="_blank">LiveViewLockScreenExtAbility.ets</a></div></div></div></div> <p>5、在LiveViewDataBuilder中配置沉浸态实况窗参数</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewDataBuilder.ets#L30-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">this</span>.<span class="hljs-variable">primary</span> = {</li><li>  <span class="hljs-variable">title</span>: <span class="hljs-string">''</span>,</li><li>  <span class="hljs-variable">content</span>: [</li><li>    {</li><li>      <span class="hljs-variable">text</span>: <span class="hljs-string">''</span>,</li><li>      <span class="hljs-variable">textColor</span>: <span class="hljs-string">''</span></li><li>    }</li><li>  ],</li><li>  <span class="hljs-variable">keepTime</span>: <span class="hljs-title class_">CyclingConstants</span>.<span class="hljs-title class_">KEEP_TIME</span>,</li><li>  <span class="hljs-variable">clickAction</span>: <span class="hljs-title class_">undefined</span>,</li><li>  <span class="hljs-variable">layoutData</span>: <span class="hljs-title class_">undefined</span>,</li><li>  <span class="hljs-variable">liveViewLockScreenPicture</span>: <span class="hljs-string">'icBike.png'</span>,</li><li>  <span class="hljs-variable">liveViewLockScreenAbilityName</span>: <span class="hljs-string">'LiveViewLockScreenExtAbility'</span>,</li><li>  <span class="hljs-variable">liveViewLockScreenAbilityParameters</span>: <span class="hljs-title class_">parameters</span></li><li>};</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/ets/liveview/LiveViewDataBuilder.ets#L30-L44" target="_blank">LiveViewDataBuilder.ets</a></div></div></div></div> <p>6、在module.json5中配置拓展的ability</p> <div class="screenLinkPre"><div _ngcontent-bdl-c106="" class="highlight-div"><div _ngcontent-bdl-c106="" class="highlight-div-header"><div _ngcontent-bdl-c106="" class="highlight-div-header-left"><div _ngcontent-bdl-c106="" class="handle-button expand-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdl-c106="" class="highlight-div-header-right"><div _ngcontent-bdl-c106="" class="handle-button ai-button"></div><div _ngcontent-bdl-c106="" class="handle-button line-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdl-c106="" class="handle-button theme-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdl-c106="" class="handle-button copy-button"><div _ngcontent-bdl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdl-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/module.json5#L36-L43" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"extensionAbilities"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"LiveViewLockScreenExtAbility"</span>,</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"liveViewLockScreen"</span>,</li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/LiveViewLockScreenExtAbility.ets"</span>,</li><li>    <span class="hljs-string">"exported"</span>: <span class="hljs-keyword">true</span></li><li>  }</li><li>],</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/bicycle-sharing/blob/master/entry/src/main/module.json5#L36-L43" target="_blank">module.json5</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section58227122578">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section58227122578" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/bicycle-sharing" target="_blank">快捷触达的骑行体验</a></li></ul> </div> </div> <div></div></div>