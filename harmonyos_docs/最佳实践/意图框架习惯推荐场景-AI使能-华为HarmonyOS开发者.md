<h1 _ngcontent-hek-c119="" class="doc-title ng-star-inserted" title="意图框架习惯推荐场景"> 意图框架习惯推荐场景 </h1>

<div _ngcontent-hek-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section10869126143715">概述<i class="anchor-icon anchor-icon-link" anchorid="section10869126143715" tips="复制节点链接"></i></h2><p>意图框架是HarmonyOS系统级的意图标准体系。将应用和元服务的业务功能智能分发给不同的系统入口，以“音乐播放”为例，HarmonyOS将业务分发给“小艺建议”，提供了桌面大流量曝光，同时为开发者实现业务增长。习惯推荐类别下典型场景主要分为常用接续、常用复访以及常用推新三大类。比如“音乐播放”就属于常用接续场景。具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-habit-rec-scene-experience#section19150165420493" target="_blank">习惯推荐典型场景</a>。</p> </div> <ul><li>常用接续：涵盖长视频、音乐、有声以及课程等领域，接续指在某个时间节点进行续播。</li><li>常用复访：涵盖导航、打车以及小游戏等领域，推荐用户经常使用的应用并展示卡片入口。</li><li>常用推新：涵盖资讯及短视频等领域，推荐用户新的资讯或者视频。</li></ul> <p>接入意图框架首先需要确定特性类别和具体意图，详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-access-flow" target="_blank">Intents Kit接入流程</a>。</p> <p>本文以“音乐播放”意图为例，详细讲解意图接入与开发全过程。</p> <div class="tiledSection"><h2 id="section516212453617">音乐播放开发<i class="anchor-icon anchor-icon-link" anchorid="section516212453617" tips="复制节点链接"></i></h2><p>以“音乐播放”为例，从意图注册、意图共享以及意图调用三大块介绍意图运行的开发过程。如果应用支持播放功能并且需要实现推荐播放接续，例如音乐、长视频以及课程的播放接续，可以参考本文。首先需要在设置中开启意图框架调试，如下图所示。确保意图框架调试开启且在界面成功展示设备支持测试应用。</p> <p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163349.00291761813464091504632718883406:50001231000000:2800:6DBB1B13A3ED5070844A1FE0979E132C9DA082D304C10C2E819E4ED0826CE540.png" title="点击放大" width="266"></span></p> <p><strong>开发步骤</strong></p> <p><span><img height="394.01250000000005" originheight="8756" originwidth="11631" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163349.48796023622757414013583754554037:50001231000000:2800:5806919EB258E9A9BC27E3676A6AD11FB092F43F68A6B2F966D9BDBAC6FE7268.png" title="点击放大" width="523.6875"></span></p> <ol><li>在应用工程中新增PROJECT_HOME/entry/src/main/resources/base/profile/insight_intent.json文件注册意图，指定意图名称和所属垂域，并且指定一个意图调用逻辑入口。比如在本示例中将调用逻辑放在了EntryAbility下的InsightIntentExecutorImpl文件中。<div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"insightIntents"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayMusic"</span>,</li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">"MusicDomain"</span>,</li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.1"</span>,</li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span>,</li><li>          <span class="hljs-string">"foreground"</span></li><li>        ]</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayMusicList"</span>,</li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">"MusicDomain"</span>,</li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.1"</span>,</li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span>,</li><li>          <span class="hljs-string">"foreground"</span></li><li>        ]</li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li><li>新增PROJECT_HOME/entry/src/main/resources/rawfile/config/shareIntent.json文件，定义共享数据。数据体除了意图名、版本和标识前三个公共字段外，必选字段还包括动作模式、当前播放百分比、实体名称和ID、音乐名、logo、歌手以及音乐时长等。以下是“音乐播放”的完整数据。具体意图共享字段含义可参考<a href="https://developer.huawei.com/consumer/cn/doc/service/intents-schema-0000001901962713" target="_blank">各垂域意图Schema</a>中的音乐垂类。<div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>[</li><li>  {</li><li>    <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayMusic"</span>,</li><li>    <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0"</span>,</li><li>    <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"52dac3b0-6520-4974-81e5-25f0879449b5"</span>,</li><li>    <span class="hljs-string">"intentActionInfo"</span>: {</li><li>      <span class="hljs-string">"actionMode"</span>: <span class="hljs-string">"EXECUTED"</span>,</li><li>      <span class="hljs-string">"executedTimeSlots"</span>: {</li><li>        <span class="hljs-string">"executedStartTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>        <span class="hljs-string">"executedEndTime"</span>: <span class="hljs-number">1637393112000</span></li><li>      },</li><li>      <span class="hljs-string">"currentPercentage"</span>: <span class="hljs-number">50</span></li><li>    },</li><li>    <span class="hljs-string">"intentEntityInfo"</span>: {</li><li>      <span class="hljs-string">"entityName"</span>: <span class="hljs-string">"Music"</span>,</li><li>      <span class="hljs-string">"entityId"</span>: <span class="hljs-string">"C10194368"</span>,</li><li>      <span class="hljs-string">"entityGroupId"</span>: <span class="hljs-string">"C10194321312"</span>,</li><li>      <span class="hljs-string">"displayName"</span>: <span class="hljs-string">"红颜如霜"</span>,</li><li>      <span class="hljs-string">"description"</span>: <span class="hljs-string">"NA"</span>,</li><li>      <span class="hljs-string">"logoURL"</span>: <span class="hljs-string">"https://www-file.huawei.com/-/media/corporate/images/home/logo/huawei_logo.png"</span>,</li><li>      <span class="hljs-string">"keywords"</span>: [</li><li>        <span class="hljs-string">"华为音乐"</span>,</li><li>        <span class="hljs-string">"化妆"</span></li><li>      ],</li><li>      <span class="hljs-string">"rankingHint"</span>: <span class="hljs-number">99</span>,</li><li>      <span class="hljs-string">"expirationTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>      <span class="hljs-string">"metadataModificationTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>      <span class="hljs-string">"activityType"</span>: [</li><li>        <span class="hljs-string">"1"</span>,</li><li>        <span class="hljs-string">"2"</span>,</li><li>        <span class="hljs-string">"3"</span></li><li>      ],</li><li>      <span class="hljs-string">"artist"</span>: [</li><li>        <span class="hljs-string">"测试歌手1"</span>,</li><li>        <span class="hljs-string">"测试歌手2"</span></li><li>      ],</li><li>      <span class="hljs-string">"lyricist"</span>: [</li><li>        <span class="hljs-string">"测试词作者1"</span>,</li><li>        <span class="hljs-string">"测试词作者2"</span></li><li>      ],</li><li>      <span class="hljs-string">"composer"</span>: [</li><li>        <span class="hljs-string">"测试曲作者1"</span>,</li><li>        <span class="hljs-string">"测试曲作者2"</span></li><li>      ],</li><li>      <span class="hljs-string">"albumName"</span>: <span class="hljs-string">"测试专辑"</span>,</li><li>      <span class="hljs-string">"duration"</span>: <span class="hljs-number">244000</span>,</li><li>      <span class="hljs-string">"playCount"</span>: <span class="hljs-number">100000</span>,</li><li>      <span class="hljs-string">"musicalGenre"</span>: [</li><li>        <span class="hljs-string">"流行"</span>,</li><li>        <span class="hljs-string">"话语"</span>,</li><li>        <span class="hljs-string">"抖音"</span>,</li><li>        <span class="hljs-string">"00后"</span></li><li>      ],</li><li>      <span class="hljs-string">"isPublicData"</span>: <span class="hljs-keyword">false</span></li><li>    }</li><li>  },</li><li>  {</li><li>    <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayMusicList"</span>,</li><li>    <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0"</span>,</li><li>    <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"52dac3b0-6520-4974-81e5-25f0879449b5"</span>,</li><li>    <span class="hljs-string">"intentActionInfo"</span>: {</li><li>      <span class="hljs-string">"actionMode"</span>: <span class="hljs-string">"EXECUTED"</span>,</li><li>      <span class="hljs-string">"executedTimeSlots"</span>: {</li><li>        <span class="hljs-string">"executedStartTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>        <span class="hljs-string">"executedEndTime"</span>: <span class="hljs-number">1637393112000</span></li><li>      },</li><li>      <span class="hljs-string">"currentPercentage"</span>: <span class="hljs-number">50</span></li><li>    },</li><li>    <span class="hljs-string">"intentEntityInfo"</span>: {</li><li>      <span class="hljs-string">"entityName"</span>: <span class="hljs-string">"MusicList"</span>,</li><li>      <span class="hljs-string">"entityId"</span>: <span class="hljs-string">"C10194368"</span>,</li><li>      <span class="hljs-string">"entityGroupId"</span>: <span class="hljs-string">"C10194321312"</span>,</li><li>      <span class="hljs-string">"displayName"</span>: <span class="hljs-string">"测试歌单"</span>,</li><li>      <span class="hljs-string">"description"</span>: <span class="hljs-string">"这是xxx歌单"</span>,</li><li>      <span class="hljs-string">"logoURL"</span>: <span class="hljs-string">"https://www-file.huawei.com/-/media/corporate/images/home/logo/huawei_logo.png"</span>,</li><li>      <span class="hljs-string">"keyWords"</span>: [</li><li>        <span class="hljs-string">"抖音"</span>,</li><li>        <span class="hljs-string">"动感"</span></li><li>      ],</li><li>      <span class="hljs-string">"rankingHint"</span>: <span class="hljs-number">99</span>,</li><li>      <span class="hljs-string">"expirationTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>      <span class="hljs-string">"metadataModificationTime"</span>: <span class="hljs-number">1637393212000</span>,</li><li>      <span class="hljs-string">"activityType"</span>: [</li><li>        <span class="hljs-string">"1"</span>,</li><li>        <span class="hljs-string">"2"</span>,</li><li>        <span class="hljs-string">"3"</span></li><li>      ],</li><li>      <span class="hljs-string">"isPublicData"</span>: <span class="hljs-keyword">false</span>,</li><li>      <span class="hljs-string">"briefDescription"</span>: <span class="hljs-string">"这是xxx歌单，来自xxx，是xxx风格"</span>,</li><li>      <span class="hljs-string">"artist"</span>: [</li><li>        <span class="hljs-string">"测试歌手1"</span>,</li><li>        <span class="hljs-string">"测试歌手2"</span></li><li>      ],</li><li>      <span class="hljs-string">"numberOfSongs"</span>: <span class="hljs-number">20</span>,</li><li>      <span class="hljs-string">"type"</span>: <span class="hljs-string">"1"</span>,</li><li>      <span class="hljs-string">"creator"</span>: <span class="hljs-string">"测试创建者"</span>,</li><li>      <span class="hljs-string">"createDate"</span>: <span class="hljs-string">"2023-10-08T08:00:00+08:00"</span>,</li><li>      <span class="hljs-string">"musicNameList"</span>: [</li><li>        <span class="hljs-string">"测试歌曲1"</span>,</li><li>        <span class="hljs-string">"测试歌曲2"</span></li><li>      ],</li><li>      <span class="hljs-string">"playCount"</span>: <span class="hljs-number">30</span>,</li><li>      <span class="hljs-string">"musicalGenre"</span>: [</li><li>        <span class="hljs-string">"流行"</span>,</li><li>        <span class="hljs-string">"华语"</span>,</li><li>        <span class="hljs-string">"抖音"</span>,</li><li>        <span class="hljs-string">"00后"</span></li><li>      ]</li><li>    }</li><li>  }</li><li>]</li></ol></pre></div></div> </li><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/intents-arkts-api-insightintent#section144826162913" target="_blank">insightIntent.shareIntent()</a>接口将意图对象输入到HarmonyOS，用于学习用户的行为规律。成功共享后“小艺建议”会展示对应应用的音乐模板卡片。展示效果如图所示。<p><span><img height="546.3906000000001" originheight="662" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163350.28302213606737104378031051493675:50001231000000:2800:496EA84D8F95C4410BBCADC1A06D08EF6897C9F25E0DAD9245742CB6A31A2372.png" title="点击放大" width="266"></span></p> <div class="screenLinkPre"><div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/utils/InsightIntentSharer.ets#L34-L54" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">shareIntent</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>  <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'shareIntent'</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">insightIntents</span>: insightIntent.<span class="hljs-property">InsightIntent</span>[] = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(input);</li><li>    <span class="hljs-keyword">if</span> (!insightIntents || insightIntents.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'shareIntent: json invalid.'</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-string">'shareIntent: json invalid.'</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> insightIntent.<span class="hljs-title function_">shareIntent</span>(context, insightIntents).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'shareIntent success'</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-string">'share intent success'</span>;</li><li>    }, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`shareIntent error message: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-string">`shareIntent error message: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>;</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'shareIntent fail'</span>, err);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'shareIntent fail'</span>);</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/utils/InsightIntentSharer.ets#L34-L54" target="_blank">InsightIntentSharer.ets</a></div></div></div></div> </li><li>配置PROJECT_HOME/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets文件，定义onExecuteInUIAbilityForegroundMode()方法。点击卡片，会拉起对应的应用并触发onCreate()和onExecuteInUIAbilityForegroundMode()等方法。意图调用如果会拉起应用界面，采取前台模式，如果不需要拉起采取后台模式。应用在foreground模式和background模式下会触发不同的生命周期与方法： <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.4.1.1.5.1.1" valign="top" width="23.859515174651648%"><p>前后台模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.4.1.1.5.1.2" valign="top" width="23.859515174651648%"><p>启动模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.4.1.1.5.1.3" valign="top" width="45.60030540179423%"><p>触发生命周期</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.4.1.1.5.1.4" valign="top" width="6.680664248902462%">&nbsp;&nbsp;</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="23.859515174651648%"><p>foreground</p> </td> <td class="cellrowborder" valign="top" width="23.859515174651648%"><p>冷启动</p> </td> <td class="cellrowborder" valign="top" width="45.60030540179423%"><p>onCreate-&gt;onWindowStageCreate-&gt;onExecuteInUIAbilityForegroundMode</p> </td> <td class="cellrowborder" valign="top" width="6.680664248902462%">&nbsp;&nbsp;</td> </tr> <tr><td class="cellrowborder" valign="top" width="23.859515174651648%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="23.859515174651648%"><p>热启动</p> </td> <td class="cellrowborder" valign="top" width="45.60030540179423%"><p>onNewWant-&gt;onExecuteInUIAbilityForegroundMode</p> </td> <td class="cellrowborder" valign="top" width="6.680664248902462%">&nbsp;&nbsp;</td> </tr> <tr><td class="cellrowborder" valign="top" width="23.859515174651648%"><p>background</p> </td> <td class="cellrowborder" valign="top" width="23.859515174651648%"><p>冷启动</p> </td> <td class="cellrowborder" valign="top" width="45.60030540179423%"><p>onCreate-&gt;onExecuteInUIAbilityBackgroundMode</p> </td> <td class="cellrowborder" valign="top" width="6.680664248902462%">&nbsp;&nbsp;</td> </tr> <tr><td class="cellrowborder" valign="top" width="23.859515174651648%">&nbsp;&nbsp;</td> <td class="cellrowborder" valign="top" width="23.859515174651648%"><p>热启动</p> </td> <td class="cellrowborder" valign="top" width="45.60030540179423%"><p>onExecuteInUIAbilityBackgroundMode</p> </td> <td class="cellrowborder" valign="top" width="6.680664248902462%">&nbsp;&nbsp;</td> </tr>  </tbody></table></div> </div> <p>本示例中采取foreground模式，可以在onCreate()或者onNewWant()解析want和launchParam。通过launchReason区分是否是意图调用拉起的Ability，如果是则解析want中的参数，并且将参数result存储在AppStorage中。如果是在真实开发中意图调用传参字段可以在开发前和接口方协商。</p> <div class="screenLinkPre"><div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L16-L22" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onCreate</span>(<span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-variable">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-title class_">LaunchParam</span>): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable">TAG</span>, <span class="hljs-string">'onCreate'</span>);</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">want</span>.<span class="hljs-variable">parameters</span>?.[<span class="hljs-string">'result'</span>]) {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">result</span> = <span class="hljs-variable">want</span>.<span class="hljs-variable">parameters</span>?.[<span class="hljs-string">'result'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">string</span>;</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/EntryAbility.ets#L16-L22" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>want解析完毕后，会触发onExecuteInUIAbilityForegroundMode()方法进行真正逻辑处理，根据意图名称去分发处理方法并且返回一个Promise，成功调用code返回0，失败时返回-1。</p> <div class="screenLinkPre"><div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L20-L48" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Override the method to execute the intent in the foreground UIAbility.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> name Intent name.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> param Intent parameters.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageLoader Window.</span></li><li><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> Intent call result.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-title function_ invoke__">onExecuteInUIAbilityForegroundMode</span>(<span class="hljs-attr">name</span>: <span class="hljs-keyword">string</span>, <span class="hljs-attr">param</span>: Record&lt;<span class="hljs-keyword">string</span>, Object&gt;, <span class="hljs-attr">pageLoader</span>: window.WindowStage):</li><li>  Promise&lt;insightIntent.ExecuteResult&gt; {</li><li>  Logger.<span class="hljs-title function_ invoke__">info</span>(TAG, `onExecuteInUIAbilityForegroundMode <span class="hljs-attr">name</span>: ${name}, <span class="hljs-attr">param</span>: ${JSON.<span class="hljs-title function_ invoke__">stringify</span>(param)}`);</li><li>  <span class="hljs-comment">// Distribute the processing logic based on the intent name.</span></li><li>  <span class="hljs-keyword">switch</span> (name) {</li><li>    <span class="hljs-keyword">case</span> InsightIntentExecutorImpl.PLAY_MUSIC:</li><li>      <span class="hljs-keyword">return</span> this.<span class="hljs-title function_ invoke__">playMusic</span>(param, pageLoader);</li><li>    <span class="hljs-keyword">case</span> InsightIntentExecutorImpl.PLAY_MUSIC_LIST:</li><li>      <span class="hljs-keyword">return</span> this.<span class="hljs-title function_ invoke__">playMusicList</span>(param, pageLoader);</li><li>    <span class="hljs-keyword">default</span>:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">return</span> Promise.<span class="hljs-title function_ invoke__">resolve</span>({</li><li>    <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">result</span>: {</li><li>      <span class="hljs-attr">message</span>: <span class="hljs-string">'unknown intent'</span></li><li>    }</li><li>  } <span class="hljs-keyword">as</span> insightIntent.ExecuteResult)</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L20-L48" target="_blank">InsightIntentExecutorImpl.ets</a></div></div></div></div> <div class="p">最后完成playMusic()的功能逻辑，小艺建议基于共享数据生成推荐卡片，点击卡片后将上述shareIntent.json定义的实体ID值传递到应用中。<div class="screenLinkPre"><div _ngcontent-hek-c106="" class="highlight-div"><div _ngcontent-hek-c106="" class="highlight-div-header"><div _ngcontent-hek-c106="" class="highlight-div-header-left"><div _ngcontent-hek-c106="" class="handle-button expand-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hek-c106="" class="highlight-div-header-right"><div _ngcontent-hek-c106="" class="handle-button ai-button"></div><div _ngcontent-hek-c106="" class="handle-button line-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hek-c106="" class="handle-button theme-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hek-c106="" class="handle-button copy-button"><div _ngcontent-hek-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hek-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L51-L88" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * Implement the music playback function.</span></li><li><span class="hljs-comment"> *</span></li><li><span class="hljs-comment"> * @param param Intent parameters.</span></li><li><span class="hljs-comment"> * @param pageLoader Window.</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">playMusic</span>(<span class="hljs-variable">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt;,</li><li>  <span class="hljs-variable">pageLoader</span>: <span class="hljs-title class_">window</span>.<span class="hljs-title class_">WindowStage</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">insightIntent</span>.<span class="hljs-title class_">ExecuteResult</span>&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Promise</span>((<span class="hljs-variable">resolve</span>, <span class="hljs-variable">reject</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">string</span>&gt; = {</li><li>      <span class="hljs-string">'result'</span>: `<span class="hljs-title class_">intent</span> <span class="hljs-title class_">execute</span> <span class="hljs-title class_">success</span>, <span class="hljs-variable">entityId</span>: ${<span class="hljs-variable">param</span>.<span class="hljs-variable">entityId</span>}`</li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">localStorage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">LocalStorage</span>(<span class="hljs-variable">para</span>);</li><li>    <span class="hljs-comment">// TODO Implement an intent call.</span></li><li>    <span class="hljs-variable">pageLoader</span>.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-variable">localStorage</span>)</li><li>      .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>        <span class="hljs-comment">// TODO The intent is called successfully.</span></li><li>        <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable">TAG</span>, <span class="hljs-string">"Intent execute success"</span>);</li><li>        <span class="hljs-title function_">resolve</span>({</li><li>          <span class="hljs-variable">code</span>: <span class="hljs-number">0</span>,</li><li>          <span class="hljs-variable">result</span>: {</li><li>            <span class="hljs-variable">message</span>: <span class="hljs-string">'Intent execute success'</span></li><li>          }</li><li>        });</li><li>      })</li><li>      .<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>        <span class="hljs-comment">// TODO Handle the failure if the intent fails to be called.</span></li><li>        <span class="hljs-variable">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Intent</span> <span class="hljs-variable">execute</span> <span class="hljs-variable">failed</span>: ${<span class="hljs-variable">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable">err</span>)}`);</li><li>        <span class="hljs-title function_">resolve</span>({</li><li>          <span class="hljs-variable">code</span>: -<span class="hljs-number">1</span>,</li><li>          <span class="hljs-variable">result</span>: {</li><li>            <span class="hljs-variable">message</span>: <span class="hljs-string">'Intent execute failed'</span></li><li>          }</li><li>        })</li><li>      });</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts/blob/master/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L51-L88" target="_blank">InsightIntentExecutorImpl.ets</a></div></div></div></div> </div> <p></p> <p>如果想删除掉意图，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/intents-arkts-api-insightintent#section138017435231" target="_blank">insightIntent.deleteIntent()</a>，在注册文件只有一个意图的情况下卡片入口会消失。运行效果如下图所示。</p> <p><span><img height="546.7763" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163350.42655162392570936152119691226221:50001231000000:2800:F3DEB341E4EA5C9448135FFF9B700A1C399614884B4E5D88E522870EA0C9E690.gif" title="点击放大" width="266"></span></p> </li></ol> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>在真机设备上，小艺建议卡片不会实时刷新。可以通过点击卡片中的服务，重新返回到桌面后，进行卡片刷新。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section415817415512">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section415817415512" tips="复制节点链接"></i></h2><ul><li><a href="https://gitee.com/harmonyos_samples/intents-kit-samplecode-clientdemo-arkts#约束与限制" target="_blank">意图框架-音乐播放案例实践</a></li></ul> </div> </div></div>