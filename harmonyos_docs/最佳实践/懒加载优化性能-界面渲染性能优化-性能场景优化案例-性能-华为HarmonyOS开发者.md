<h1 _ngcontent-msb-c119="" class="doc-title ng-star-inserted" title="懒加载优化性能"> 懒加载优化性能 </h1>

<div _ngcontent-msb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section127811853164918">概述<i class="anchor-icon anchor-icon-link" anchorid="section127811853164918" tips="复制节点链接"></i></h2>          <p>懒加载LazyForEach是一种延迟加载的技术，它是在需要的时候才加载数据或资源，并在每次迭代过程中创建相应的组件，而不是一次性将所有内容都加载出来。懒加载通常应用于长列表、网格、瀑布流等数据量较大、子组件可重复使用的场景，当用户滚动页面到相应位置时，才会触发资源的加载，以减少组件的加载时间，提高应用性能，提升用户体验。</p>    </div>    <div class="tiledSection">     <h2 id="section18647203612505">懒加载原理介绍<i class="anchor-icon anchor-icon-link" anchorid="section18647203612505" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1188383651517" class="firsth2">渲染过程<i class="anchor-icon anchor-icon-link" anchorid="section1188383651517" tips="复制节点链接"></i></h3>          <p>在声明式描述语句中，有两种方式控制列表、网格等容器类组件的渲染，分别为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach" target="_blank">循环渲染（ForEach）</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach" target="_blank">数据懒加载（LazyForEach）</a>。</p>     <ul>      <li>循环渲染       <p>ForEach循环渲染的过程如下：</p>       <ol>        <li>从列表数据源一次性加载全量数据。</li>        <li>为列表数据的每一个元素都创建对应的组件，并全部挂载在组件树上。即，ForEach遍历多少个列表元素，就创建多少个ListItem组件节点并依次挂载在List组件树根节点上。</li>        <li>列表内容显示时，只渲染屏幕可视区内的ListItem组件，可视区外的ListItem组件滑动进入屏幕内时，因为已经完成了数据加载和组件创建挂载，直接渲染即可。</li>       </ol>       <p>其数据加载、组件树挂载、页面渲染的示意图如下所示：</p>       <div class="fignone">        <span class="figcap"><b>图1 </b>ForEach渲染过程示意图</span>        <br><span><img height="310.4486" originheight="440" originwidth="1131" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.43357953456799974408708263814116:50001231000000:2800:C3E814095D2A70A4D078C908900A49BCBF1BB31C81147346A0E51974B38BC849.png" title="点击放大" width="798"></span>       </div>       <p>如果列表数据较少，数据一次性全量加载不是性能瓶颈时，可以直接使用ForEach；但是当数据量大、组件结构复杂的情况下ForEach会出现性能瓶颈。这是因为要一次性加载所有的列表数据，创建所有组件节点并完成组件树的构建，在数据量大时会非常耗时，从而导致页面启动时间过长。另外，屏幕可视区外的组件虽然不会显示在屏幕上，但是仍然会占用内存。在系统处于高负载的情况下，更容易出现性能问题，极限情况下甚至会导致应用异常退出。</p></li>      <li>数据懒加载       <p>LazyForEach懒加载的原理和渲染过程如下：</p>       <ol>        <li>LazyForEach会根据屏幕可视区能够容纳显示的组件数量，按需加载数据。</li>        <li>根据加载的数据量创建组件，挂载在组件树上，构建出一棵短小的组件树。即，屏幕可以展示多少列表项组件，就按需创建多少个ListItem组件节点挂载在List组件树根节点上。</li>        <li>屏幕可视区只展示部分组件。当可视区外的组件需要在屏幕内显示时，需要从头完成数据加载、组件创建、挂载组件树这一过程，直至渲染到屏幕上。</li>       </ol>       <p>其数据加载、组件树挂载、页面渲染的示意图如下所示：</p>       <div class="fignone">        <span class="figcap"><b>图2 </b>LazyForEach渲染过程示意图</span>       </div>       <p><span><img height="310.4486" originheight="440" originwidth="1131" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.29517857625317413023302956481816:50001231000000:2800:B0C38747D09265BAF1683B0B4F990DB76685B33DA904423795AFDAB399B7F551.png" title="点击放大" width="798"></span></p></li>     </ul>     <p>LazyForEach实现了按需加载，针对列表数据量大、列表组件复杂的场景，减少了页面首次启动时一次性加载数据的时间消耗，减少了内存峰值。不过在长列表滑动的过程中，因为需要根据用户的滑动行为不断地加载新的内容，这需要进行额外的数据请求和处理，会增加滑动时的计算量，从而对性能产生一定的影响。然而，合理使用LazyForEach的按需加载能力，通过在滑动停止或达到某个阈值时才进行加载，可以减少不必要的计算和请求，从而提高性能，给用户带来更好的体验。总之，在实现按需加载的场景中，需要综合考虑性能和用户体验的平衡，合理地优化加载逻辑和渲染方式，以提升整体的性能表现。</p>    </div>    <div class="tiledSection">     <h3 id="section68711519072">键值生成规则和组件创建规则<i class="anchor-icon anchor-icon-link" anchorid="section68711519072" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>建议开发者优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter" target="_blank">Code Linter扫描工具</a>进行代码检查，重点关注<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide_hp-arkui-no-stringify-lazyforeach-key" target="_blank">@performance/hp-arkui-no-stringify-in-lazyforeach-key-generator</a>规则。若扫描结果中出现该规则相关问题，可参考本章节提供的优化建议进行调整。</p>      </div></div></div>     <p>在使用LazyForEach时，我们需要分别实现数据源dataSource、键值生成函数keyGenerator、子组件生成函数itemGenerator。其中，数据源为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#idatasource" target="_blank">IDataSource</a>类型，需要开发者实现该接口。keyGenerator是一个函数，用于为每个item生成一个唯一且持久的键值以标识对应的组件，开发者可以通过它自定义键值的生成规则，关于键值生成规则，详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#键值生成规则" target="_blank">键值生成规则</a>。LazyForEach的itemGenerator函数会根据键值生成规则为数据源的每个数组项创建组件，组件的创建分为首次渲染和非首次渲染两种情况，详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#组件创建规则" target="_blank">组件创建规则</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在使用LazyForEach进行组件复用时，键值生成函数keyGenerator中不推荐使用stringify。在复杂的业务场景中，使用stringify会对item对象进行序列化，最终把item转换成字符串，这过程需要消耗大量的时间和计算资源，从而导致页面性能降低。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section1199016155113">常见使用场景<i class="anchor-icon anchor-icon-link" anchorid="section1199016155113" tips="复制节点链接"></i></h2>          <p>LazyForEach作为常见的渲染控制的方式之一，常用的使用场景有长列表加载、无限瀑布流等。</p>    </div>    <div class="tiledSection">     <h3 id="section1847219719551" class="firsth2">长列表加载<i class="anchor-icon anchor-icon-link" anchorid="section1847219719551" tips="复制节点链接"></i></h3>          <p>长列表作为应用开发中最常见的开发场景之一，通常会包含成千上万个列表项，在此场景下，直接使用循环渲染ForEach一次性加载所有的列表项，会导致渲染时间过长，影响用户体验。而使用数据懒加载LazyForEach替换循环渲染ForEach，可以按需加载列表项，从而提升列表性能。数据懒加载的示例代码可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>。</p>     <p>虽然，按需加载列表项可以优化长列表性能，但在快速滑动长列表的场景下，可能会来不及加载需要显示的列表项，导致出现白块的现象，从而影响用户体验。而在ArkUI中，List容器提供了cachedCount属性，LazyForEach可以结合cachedCount属性一起使用，能够避免白块的现象。cachedCount可以设置列表中ListItem/ListItemGroup的预加载数量，并且只在LazyForEach中生效，即cachedCount只能与LazyForEach一起使用。除了List容器，其他容器Grid、Swiper以及WaterFlow也都包含cachedCount属性。cachedCount的使用方法如下所示。</p>     <div class="screenLinkPre"><div _ngcontent-msb-c106="" class="highlight-div"><div _ngcontent-msb-c106="" class="highlight-div-header"><div _ngcontent-msb-c106="" class="highlight-div-header-left"><div _ngcontent-msb-c106="" class="handle-button expand-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-msb-c106="" class="highlight-div-header-right"><div _ngcontent-msb-c106="" class="handle-button ai-button"></div><div _ngcontent-msb-c106="" class="handle-button line-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-msb-c106="" class="handle-button theme-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-msb-c106="" class="handle-button copy-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-msb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/pages/Index.ets#L12-L14" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">List</span>() {</li><li>  <span class="hljs-comment">// ...</span></li><li>}<span class="hljs-selector-class">.cachedCount</span>(<span class="hljs-number">3</span>)</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/pages/Index.ets#L12-L14" target="_blank">Index.ets</a></div></div></div></div>     <p>此外，HarmonyOS应用框架提供了组件复用能力，可以结合LazyForEach一起使用，进一步优化长列表的性能。组件复用会把组件树上将要移除的组件进行回收，回收的组件会进入到一个回收缓存区。后续创建新组件节点时，会复用缓存区中的节点，节约组件重新创建的时间。关于组件复用的详细原理可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-component-reuse">组件复用</a>。针对长列表加载的性能优化，可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-best-practices-long-list" target="_blank">优化长列表加载慢丢帧问题</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section17386102375316">无限瀑布流<i class="anchor-icon anchor-icon-link" anchorid="section17386102375316" tips="复制节点链接"></i></h3>          <p>瀑布流的内容呈现方式类似瀑布流一样，从上往下依次排列，每一列的高度不一定相同，整体呈现出瀑布流的视觉效果。在瀑布流中，经常使用LazyForEach实现数据按需加载，同时，结合onReachEnd、onScrollIndex方法实现无限瀑布流，关于瀑布流的优化详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-waterflow-performance-optimization" target="_blank">优化瀑布流加载慢丢帧问题</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section1556917819517">常见失效场景<i class="anchor-icon anchor-icon-link" anchorid="section1556917819517" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section151828185819" class="firsth2">使用限制<i class="anchor-icon anchor-icon-link" anchorid="section151828185819" tips="复制节点链接"></i></h3>          <p>在LazyForEach的使用上，有一些限制条件和限制场景，详细的限制条件请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#使用限制" target="_blank">使用限制</a>，常见的限制场景总结如下：</p>     <ul>      <li>键值相同导致渲染错乱</li>      <li>ListItem过于复杂导致丢帧</li>      <li>Scroll嵌套List导致按需加载失效</li>      <li>GridItem未设置高度导致按需加载失效</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="section149545267336">检查失效方法<i class="anchor-icon anchor-icon-link" anchorid="section149545267336" tips="复制节点链接"></i></h3>          <p>当LazyForEach失效时，可能出现渲染错误、卡顿等现象，开发者可以使用日志、Profiler调优工具等方法来定位具体的问题。常见检查LazyForEach的失效方法有如下几种方式：</p>     <ol>      <li>通过日志观察键值、子组件创建的情况，参考如下所示。开发者需要留意日志中是否出现相同的键值、子组件出现的次数与实际不符等情况。       <div class="screenLinkPre"><div _ngcontent-msb-c106="" class="highlight-div"><div _ngcontent-msb-c106="" class="highlight-div-header"><div _ngcontent-msb-c106="" class="highlight-div-header-left"><div _ngcontent-msb-c106="" class="handle-button expand-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-msb-c106="" class="highlight-div-header-right"><div _ngcontent-msb-c106="" class="handle-button ai-button"></div><div _ngcontent-msb-c106="" class="handle-button line-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-msb-c106="" class="handle-button theme-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-msb-c106="" class="handle-button copy-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-msb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/pages/Index.ets#L18-L31" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">lazyForEachItem: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">ListItem</span>() {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(lazyForEachItem).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }.<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// Record the number of times the component is created through onAppear</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"appear:"</span> + lazyForEachItem)</li><li>  })</li><li>}, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// Print the key value in the keyGenerator function</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"key:"</span> + item)</li><li>  <span class="hljs-keyword">return</span> item;</li><li>})</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/pages/Index.ets#L18-L31" target="_blank">Index.ets</a></div></div></div></div></li>      <li>通过Profiler调优工具抓取Trace，可以判断子组件创建的次数。如下图所示，在该帧中出现大量的BuildLazyItem切片，每一次BuildLazyItem对应一次子组件的创建，对比数量可知LazyForEach按需加载失效。关于调优的内容可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-optimization-tool-practice" target="_blank">性能分析</a>。       <p><span><img height="360.1241" originheight="991" originwidth="2196" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163420.09181726565776378687231416039255:50001231000000:2800:ED9BB3D7C07FBE6CDCA594995C5EA0D43E65623D08A48DDEA627081ABE952A6D.png" title="点击放大" width="798"></span></p></li>      <li>通过HiDumper查看组件信息，判断组件的渲染情况。关于HiDumper的内容可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hidumper" target="_blank">HiDumper</a>。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section5356143331915">键值相同导致渲染错乱<i class="anchor-icon anchor-icon-link" anchorid="section5356143331915" tips="复制节点链接"></i></h3>          <p>在LazyForEach的键值生成规则中，每个item对应着一个唯一且持久的键值，用于标识对应的组件。当不同的数据项有相同的键值时，框架可能找不到正确的数据项，导致子组件渲染错误。关于键值错误导致渲染错乱的案例，详情可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#首次渲染" target="_blank">首次渲染</a>中的示例。</p>    </div>    <div class="tiledSection">     <h3 id="section1086542617280">ListItem过于复杂导致丢帧<i class="anchor-icon anchor-icon-link" anchorid="section1086542617280" tips="复制节点链接"></i></h3>          <p>当使用LazyForEach时，如果子组件ListItem过于复杂，在子组件创建时，将产生大量的布局计算耗时，最终导致该帧丢帧。关键代码如下所示。</p>     <div class="screenLinkPre"><div _ngcontent-msb-c106="" class="highlight-div"><div _ngcontent-msb-c106="" class="highlight-div-header"><div _ngcontent-msb-c106="" class="highlight-div-header-left"><div _ngcontent-msb-c106="" class="handle-button expand-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-msb-c106="" class="highlight-div-header-right"><div _ngcontent-msb-c106="" class="handle-button ai-button"></div><div _ngcontent-msb-c106="" class="handle-button line-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-msb-c106="" class="handle-button theme-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-msb-c106="" class="handle-button copy-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-msb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/segment/segment1.ets#L48-L80" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">lazyForEachItem: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">getAllData</span>(), <span class="hljs-function">(<span class="hljs-params">forEachItem: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">ListItem</span>() {</li><li>                <span class="hljs-title class_">Row</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(lazyForEachItem + forEachItem).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>                    .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"appear:"</span> + lazyForEachItem)</li><li>                    })</li><li>                }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>              }</li><li>            }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          }</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/segment/segment1.ets#L48-L80" target="_blank">segment1.ets</a></div></div></div></div>    </div>    <div class="tiledSection">     <h3 id="section6296154115367">Scroll嵌套List导致按需加载失效<i class="anchor-icon anchor-icon-link" anchorid="section6296154115367" tips="复制节点链接"></i></h3>          <p>当Scroll容器嵌套List组件加载长列表时，若不指定List的宽高尺寸，则默认加载全部ListItem，导致按需加载失效，甚至会导致应用卡顿、崩溃，详细案例可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-improve-layout-performance" target="_blank">合理使用布局</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section1995835515112">GridItem未设置高度导致按需加载失效<i class="anchor-icon anchor-icon-link" anchorid="section1995835515112" tips="复制节点链接"></i></h3>          <p>当使用Grid容器时，如果GridItem没有设置高度，会加载所有子组件，设置了GridItem的宽高，会加载Grid显示区域内的子组件。参考案例代码如下：</p>     <div class="screenLinkPre"><div _ngcontent-msb-c106="" class="highlight-div"><div _ngcontent-msb-c106="" class="highlight-div-header"><div _ngcontent-msb-c106="" class="highlight-div-header-left"><div _ngcontent-msb-c106="" class="handle-button expand-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-msb-c106="" class="highlight-div-header-right"><div _ngcontent-msb-c106="" class="handle-button ai-button"></div><div _ngcontent-msb-c106="" class="handle-button line-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-msb-c106="" class="handle-button theme-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-msb-c106="" class="handle-button copy-button"><div _ngcontent-msb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-msb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/segment/segment2.ets#L48-L86" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Grid</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">lazyForEachItem: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">GridItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(lazyForEachItem)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"appear:"</span> + lazyForEachItem)</li><li>          })</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">return</span> item;</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'1fr'</span>)</li><li>      .<span class="hljs-title function_">enableScrollInteraction</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">800</span>)</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">700</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/ArkUI/Lazy_Loading_Optimizes_Performance/entry/src/main/ets/segment/segment2.ets#L48-L86" target="_blank">segment2.ets</a></div></div></div></div>    </div>    <div class="tiledSection">     <h2 id="section1078520389541">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1078520389541" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/tree/master/ArkUI/Lazy_Loading_Optimizes_Performance" target="_blank">懒加载优化性能</a></li>     </ul>    </div>   </div>   <div></div></div>