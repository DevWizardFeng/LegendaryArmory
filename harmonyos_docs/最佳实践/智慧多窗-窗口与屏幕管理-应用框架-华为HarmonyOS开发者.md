<h1 _ngcontent-nby-c119="" class="doc-title ng-star-inserted" title="智慧多窗"> 智慧多窗 </h1>

<div _ngcontent-nby-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section786112347235">概述<i class="anchor-icon anchor-icon-link" anchorid="section786112347235" tips="复制节点链接"></i></h2><p>智慧多窗是一种多任务处理解决方案，允许用户在同一时间、同一屏幕上以悬浮窗或分屏的方式同时运行多个应用窗口。在智慧多窗的显示模式下，用户可以根据自己的需求，合理安排应用窗口的位置和大小。目前智慧多窗的形式，主要包含悬浮窗和分屏。</p> <ul><li><strong>悬浮窗</strong>：设备屏幕上悬浮的、非全屏的应用窗口。一般用于在已有全屏任务运行的基础上，临时处理另一个任务，或短时间多任务并行使用。如浏览网页的同时回复消息。<p><span><img height="253.1955" originheight="2352" originwidth="8546" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163001.89670329527270688743289603823510:50001231000000:2800:BA0E0962B709F9CD42E367DFEC221ED4136DC670ADAFBF5D7E2CF25BA3066710.png" title="点击放大" width="920"></span></p> </li><li><strong>分屏</strong>：分屏一般用于两个应用长时间并行使用的场景。例如边看购物攻略、边浏览商品；边看视频、边玩游戏；看学习类视频的同时做笔记等。<p><span><img height="347.09010000000006" originheight="595" originwidth="1140" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163001.74570124358189978106917974876697:50001231000000:2800:5FEC94BEA256D1F3276B24DCBAC63AC8A4660595DEA31155F28C0F1526C51B97.png" title="点击放大" width="665"></span></p> </li></ul> <p>由于应用从全屏进入智慧多窗（悬浮窗/分屏）模式后，窗口尺寸、宽高比例会发生变化，往往会产生一些布局的适配问题。例如，分屏后页面内容显示不全无法滑动、视频被压缩导致宽高比不正确，应用开启悬浮窗后内容和状态栏的重叠区域无法响应用户操作等。</p> <p>本文将主要介绍悬浮窗/分屏布局适配方案，以及智慧多窗开发过程中的一些常见问题以及解决方案，来帮助开发者快速适配智慧多窗布局开发，提升用户使用体验。</p> <p>在阅读本文前开发者可以先了解下关于智慧多窗的UX设计规范，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/system-features-multi-window-interaction-0000001795392917" target="_blank">多窗口交互</a>。</p> </div> <div class="tiledSection"><h2 id="section5891111632416">智慧多窗适配方案<i class="anchor-icon anchor-icon-link" anchorid="section5891111632416" tips="复制节点链接"></i></h2><p>悬浮窗和分屏功能是由系统提供的能力，不需要开发者单独开发功能，所以开发者只需要考虑应用悬浮或者分屏之后应用界面的适配问题。</p> <p>首先开发者需要考虑应用是否需要支持悬浮窗/分屏能力，如果确定应用需要支持悬浮窗/分屏能力，则需要考虑布局适配问题，进行布局一多适配。在一些特殊的场景下，比如沉浸模式下，顶部窗口控制条遮挡住了重要信息或者重叠区域有事件需要响应的时候，需要考虑控制条的避让适配；横向游戏和视频需要考虑横向悬浮窗适配。开发者可以参考下面的流程图进行智慧多窗适配。</p> <p><span><img height="460.80909" originheight="694" originwidth="987" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.58765897928770819481083887807304:50001231000000:2800:0D6C5E5E93489D9D9450327359BEF8838E327657E1B8FA391623013050ABF783.png" title="点击放大" width="655.3575000000001"></span></p> <p></p> </div> <div class="tiledSection"><h3 id="section339152552519" class="firsth2">配置声明支持智慧多窗<i class="anchor-icon anchor-icon-link" anchorid="section339152552519" tips="复制节点链接"></i></h3><p>当应用需要配置是否支持悬浮窗/分屏能力时，可以通过在module.json5配置文件中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#abilities标签" target="_blank">abilities标签</a>下添加supportWindowMode字段来实现，supportWindowMode属性主要标识当前UIAbility所支持的窗口模式，详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-support" target="_blank">应用声明支持智慧多窗</a>。</p> </div> <div class="tiledSection"><h3 id="section85351666261">一多布局适配<i class="anchor-icon anchor-icon-link" anchorid="section85351666261" tips="复制节点链接"></i></h3><p>在使用多窗口功能时，窗口的尺寸会发生变化，可能影响布局。以下是两种情况的具体描述：</p> <ul><li><strong>进入分屏模式</strong>：当手机设备进入分屏模式时，窗口高度缩小为原来的1/2或1/3，宽度保持不变。由于内容页面大小未作相应调整，垂直方向的内容可能被截断，且页面无法滚动查看完整内容。</li><li><strong>进入竖向悬浮窗模式</strong>：在这种模式中，窗口内容会根据窗口大小进行等比缩放。但是，窗口的高宽比变为3:4.575，这与全屏模式（通常为16:9或4:3）的比例不同。纵向比例相对于横向较小，这也可能导致内容截断现象。</li></ul> <p>这种对比说明，在多窗口使用时，需要特别注意布局的可视性和内容的可访问性，以确保用户体验。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>关于不同设备悬浮窗宽高比、应用分屏窗口高度比例详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-layout-adapt#section4402545164612" target="_blank">应用布局适配智慧多窗</a>。</p> </div></div></div> <p><span><img height="455.71386" originheight="636" originwidth="813" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.47087539499455312753697121392677:50001231000000:2800:5317DBDF7C39B72FF14E40B8B6CF2959996F7A3DED1FA37260D719639397EF78.png" title="点击放大" width="582.5400000000001"></span></p> <p>针对应用进入悬浮窗/分屏出现的页面内容截断、挤压、堆叠等问题，开发者可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-overview" target="_blank">一次开发，多端部署</a>中关于页面开发的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-page" target="_blank">多设备界面开发</a>，通过<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout" target="_blank">自适应布局</a>和<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-responsive-layout" target="_blank">响应式布局</a><strong>，</strong>来使应用自适应窗口的大小变化。例如示例<a href="/consumer/cn/doc/best-practices/bpta-multi-window-practice#section3687216112915">布局适配问题</a>节：界面被截断，无法上下滑动，使用了一多的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout#延伸能力" target="_blank">延伸能力</a>。</p> </div> <div class="tiledSection"><h3 id="section106714588269">沉浸模式下顶部窗口控制条避让适配<i class="anchor-icon anchor-icon-link" anchorid="section106714588269" tips="复制节点链接"></i></h3><p>沉浸式布局是指应用布局不避让状态栏、导航栏以及智慧多窗顶部横条，这可能发生组件与顶部横条的重叠，导致文字遮挡、点击事件冲突等情况。</p> <p><span><img height="433.766865" originheight="798" originwidth="1024" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.28227179482573961030369511925469:50001231000000:2800:DDB7013DC9DFD2FE54DF4EA69E0B663548889B090F5EB521B7E10A93E533FB76.png" title="点击放大" width="556.605"></span></p> <p>顶部横条的避让可通过以下两种方式适配，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a>。</p> <ul><li><strong>使用窗口的避让能力</strong>：通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen</a>设置窗口布局是否为沉浸式布局。根据业务需要，可以先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onwindowstatuschange11" target="_blank">on('windowStatusChange')</a>方法监听窗口模式变化，当窗口模式为全屏的时候，设置setWindowLayoutFullScreen为false，当窗口模式为非全屏的时候（包括分屏和悬浮窗）设置为true。</li><li><strong>应用主动避让</strong>：应用不使用窗口避让能力（即设置窗口为沉浸式布局），还通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">getWindowAvoidArea</a>接口可获取屏幕顶部需要规避的矩阵区域topRect，获取到该值后应用可对应做布局避让。同时可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>监听系统规避区域变化以进行布局的动态调整。</li></ul> <p>顶部横条的避让具体实践可以参考：<a href="/consumer/cn/doc/best-practices/bpta-multi-window-practice#section533165015358">沉浸模式下顶部窗口控制条避让问题</a>。</p> </div> <div class="tiledSection"><h3 id="section364215616276">横向游戏和视频横向悬浮窗适配<i class="anchor-icon anchor-icon-link" anchorid="section364215616276" tips="复制节点链接"></i></h3><p>悬浮窗默认是竖向的，但是对于横向游戏和视频应用，横向的悬浮窗体验会更好。开发者可以通过在module.json5配置文件中abilities标签下的preferMultiWindowOrientation属性增加“landscape”或者“landscape_auto”配合API以声明应用支持横向悬浮窗或上下分屏模式。</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/module.json5#L2-L59" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"preferMultiWindowOrientation"</span>: <span class="hljs-string">"landscape_auto"</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/module.json5#L2-L59" target="_blank">module.json5</a></div></div></div></div> <p>preferMultiWindowOrientation属性主要标识当前UIAbility多窗布局方向，具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-support#section14646185913211" target="_blank">声明支持悬浮窗</a>中关于preferMultiWindowOrientation的属性的描述<strong>。</strong>当设置preferMultiWindowOrientation属性为“landscape_auto”表示多窗布局动态可变为横向，需要配合API（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#enablelandscapemultiwindow12" target="_blank">enableLandscapeMultiWindow</a> / <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#disablelandscapemultiwindow12" target="_blank">disableLandscapeMultiWindow</a>）使用，建议视频类应用配置，视频播放界面适配横屏悬浮窗效果图如下，具体使用可以参考：<a href="/consumer/cn/doc/best-practices/bpta-multi-window-practice#section4595191593711">横向悬浮窗适配问题</a>。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.71066130208034760018317970689555:50001231000000:2800:4FEC5163AA18F176AFDCD646BB0257AB7D80369F28B707448AAB18529B80487E.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section11539464288">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section11539464288" tips="复制节点链接"></i></h2><p>为了帮助开发者快速对智慧多窗进行布局适配，下面列举了一些常见的智慧多窗布局适配问题，接下来介绍如何使用前面讲到的一些适配方案来解决这些问题。</p> <p>下面将常见问题分为以下三类，开发者可以使用前面对应的适配方案进行适配：</p> <ul><li>布局适配问题：这类问题一般是由于进入分屏/悬浮窗时，由于窗口高度缩小，导致的布局混乱、被截断等问题。</li><li>沉浸模式下顶部窗口控制条避让问题：在沉浸模式下，应用分屏后视图和悬浮窗顶部重合的区域无法响应操作的问题。</li><li>横屏悬浮窗适配问题：对于横向游戏和视频应用横向的悬浮窗体适配问题。</li></ul> </div> <div class="tiledSection"><h3 id="section3687216112915" class="firsth2">布局适配问题<i class="anchor-icon anchor-icon-link" anchorid="section3687216112915" tips="复制节点链接"></i></h3><ol><li>界面被截断，无法上下滑动。<p><strong>问题现象</strong></p> <p>应用分屏后内容显示不全，无法通过上下滑动展示未显示的内容。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.72118733056335159367585124808209:50001231000000:2800:BAB29A18095237C23C1691F44DD7430BDE16495AFEAB461573A4BEA8CC991D08.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question1Incorrect.ets#L22-L58" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question1Incorrect {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">12</span> }) {</li><li>        Text('Text1')</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)</li><li>          <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>          <span class="hljs-selector-class">.height</span>(<span class="hljs-number">350</span>)</li><li>          <span class="hljs-selector-class">.backgroundColor</span>(Color.Brown)</li><li>
</li><li>        Text('Text2')</li><li>          <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)</li><li>          <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>          <span class="hljs-selector-class">.height</span>(<span class="hljs-number">350</span>)</li><li>          <span class="hljs-selector-class">.backgroundColor</span>(Color.Orange)</li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question1Incorrect.ets#L22-L58" target="_blank">Question1Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>应用只适配了全屏大小，当应用分屏/悬浮窗后，窗口会变小，导致页面显示不全，超出窗口的区域无法显示。</p> <p><strong>解决措施</strong></p> <p>使用一多的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout#延伸能力" target="_blank">延伸能力</a>，增加Scroll组件，让列表或者文字区域可以按照指定方向滑动，优化后示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question1Correct.ets#L21-L57" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question1Correct {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      Scroll() {</li><li>        <span class="hljs-built_in">Column</span>({ space: <span class="hljs-number">12</span> }) {</li><li>          Text('Text1')</li><li>            <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)</li><li>            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>            <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>            <span class="hljs-selector-class">.height</span>(<span class="hljs-number">350</span>)</li><li>            <span class="hljs-selector-class">.backgroundColor</span>(Color.Brown)</li><li>
</li><li>          Text('Text2')</li><li>            <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">50</span>)</li><li>            <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>            <span class="hljs-selector-class">.textAlign</span>(TextAlign.Center)</li><li>            <span class="hljs-selector-class">.height</span>(<span class="hljs-number">350</span>)</li><li>            <span class="hljs-selector-class">.backgroundColor</span>(Color.Orange)</li><li>        }</li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question1Correct.ets#L21-L57" target="_blank">Question1Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.30992085473209165762651582255434:50001231000000:2800:0C8232C091D78DFB457C09C0B422E5CBA0B85B3932D8B364D68A968B5A0478FE.gif" title="点击放大" width="266"></span></p> </li><li>Xcomponent视频画面在分屏页面显示不全。<p><strong>问题现象</strong></p> <p>视频播放界面分屏后，视频被截断显示不全。</p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163002.93545907330932623727464057942010:50001231000000:2800:86846CC20E74119BD7B5CA3835343BE219734528DE6B2DCEC8E4839E8B9E28EC.gif" title="点击放大" width="266"></span></p> <p><strong>可能原因</strong></p> <p>在进入分屏页面，窗口的height变成了屏幕的1/2，应用没有对这种情况进行适配，导致Xcomponent宽度没变为之前的1/2导致视屏形变。优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question2Incorrect.ets#L24-L62" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question2Incorrect {</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">aspect</span>: number = <span class="hljs-number">9</span> / <span class="hljs-number">16</span>; <span class="hljs-comment">// default video height/width ratio value</span></li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">xComponentWidth</span>: number = this.getUIContext().px2vp(display.getDefaultDisplaySync().<span class="hljs-attribute">width</span>);</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">xComponentHeight</span>: number = this.getUIContext().px2vp(display.getDefaultDisplaySync().<span class="hljs-attribute">width</span> * this.aspect);</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Stack</span>() {</li><li>        <span class="hljs-built_in">XComponent</span>({ id: 'video_player_id', type: XComponentType.SURFACE, controller: this.xComponentController })</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.width</span>(this.xComponentWidth)</li><li>          <span class="hljs-selector-class">.height</span>(this.xComponentHeight)</li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.backgroundColor</span>(Color.Black)</li><li>    }</li><li>    <span class="hljs-selector-class">.hideTitleBar</span>(true)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question2Incorrect.ets#L24-L62" target="_blank">Question2Incorrect.ets</a></div></div></div></div> <p><strong>解决措施</strong></p> <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-layout-constraints" target="_blank">布局约束</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-layout-constraints#aspectratio" target="_blank">aspectRatio</a>属性指定XComponent组件的宽高比，设置aspectRatio属性后，组件宽高会受父组件内容区大小限制。</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question2Correct.ets#L24-L59" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question2Correct {</li><li>  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">aspect</span>: number = <span class="hljs-number">9</span> / <span class="hljs-number">16</span>; <span class="hljs-comment">// default video width/height ratio value</span></li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Stack</span>() {</li><li>        <span class="hljs-built_in">XComponent</span>({ id: 'video_player_id', type: XComponentType.SURFACE, controller: this.xComponentController })</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.aspectRatio</span>(this.aspect)</li><li>      }</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.backgroundColor</span>(Color.Black)</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question2Correct.ets#L24-L59" target="_blank">Question2Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.08912541685252666143498202746440:50001231000000:2800:BD4D0DD17733D88C51F6DAC9ED9C6A319D6CCDE814CF3D183E36F3CE6E3A53FE.gif" title="点击放大" width="266"></span></p> </li><li>Video组件在分屏状态下截断。<p><strong>问题现象</strong></p> <p>Video组件在分屏状态下，视频播放界面被截断显示不全。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.05232383665624266283640006860621:50001231000000:2800:16F72336F382DDB11CADE2F6B94A9AFDEACCA2A43BE3CA47D6DB494AF4A6CD88.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question3Incorrect.ets#L21-L37" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question3Incorrect {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        <span class="hljs-selector-tag">Video</span>({ src: $rawfile('testVideo2.mp4') })</li><li>          <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.autoPlay</span>(true)</li><li>          <span class="hljs-selector-class">.controls</span>(false)</li><li>      }</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.hideTitleBar</span>(true)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question3Incorrect.ets#L21-L37" target="_blank">Question3Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>给Video组件宽高设置的均为100%，Video组件默认保持宽高比进行缩小或者放大，使得视频铺满屏幕。当应用分屏后，由于窗口宽度不变，高度变为原来的1/2，Video组件的高度会超出窗口高度，导致视频显示不全。</p> <p><strong>解决措施</strong></p> <p>给Video组件设置.objectFit(ImageFit.Contain)属性，使视频保持宽高进行缩小或者放大，使得视频完全显示在Video组件边界内，优化后示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question3Correct.ets#L22-L41" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question3Correct {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        <span class="hljs-selector-tag">Video</span>({ src: $rawfile('testVideo2.mp4') })</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)</li><li>      }</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.hideTitleBar</span>(true)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question3Correct.ets#L22-L41" target="_blank">Question3Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.5261" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.10653335954333080329901415227678:50001231000000:2800:6E4C688C6DD38D30D317441781D5580C3C12FB63004EF1ABAAF2DDC4BDE21AC6.gif" title="点击放大" width="266"></span></p> </li><li>子组件超出父组件的范围。<p><strong>问题现象</strong></p> <p>子组件显示超出了父组件范围，无法通过上下滑动显示完全。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.24465629062396059352792682417991:50001231000000:2800:72DAF939881A8ABADF32E7D8742401A329B8763A90B0DBCAEC099E13FC59ECF5.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question4Incorrect.ets#L23-L96" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question4Incorrect {</li><li>
</li><li>  <span class="hljs-keyword">@Builder</span></li><li>  customDialogComp() {</li><li>    <span class="hljs-built_in">Column</span>() {</li><li>      Text('Top')</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>      Scroll() {</li><li>        Text('Middle')</li><li>          <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>      Text('Bottom')</li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.height</span>(<span class="hljs-number">500</span>)</li><li>    <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.SpaceBetween)</li><li>  }</li><li>
</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question4Incorrect.ets#L23-L96" target="_blank">Question4Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>子组件设置为了固定值，当应用分屏的时候，屏幕高度变为原来的1/2，父组件高度会随之变小。如果此时子组件高度大于父组件，就会导致子组件无法完全显示。</p> <p><strong>解决措施</strong></p> <p>子组件使用constraintSize约束子组件跟随父容器的大小，建议用子组件占用父组件的高度百分比，而不是绝对值，优化后示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question4Correct.ets#L26-L67" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Builder</span></li><li>customDialogComp() {</li><li>  <span class="hljs-built_in">Column</span>() {</li><li>    Text('Top')</li><li>      <span class="hljs-comment">// ...</span></li><li>
</li><li>    Scroll() {</li><li>      Text('Middle')</li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>    Text('Bottom')</li><li>      <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-selector-class">.height</span>(<span class="hljs-number">500</span>)</li><li>  <span class="hljs-selector-class">.justifyContent</span>(FlexAlign.SpaceBetween)</li><li>  <span class="hljs-selector-class">.constraintSize</span>({</li><li>    maxHeight: '<span class="hljs-number">90%</span>'</li><li>  })</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question4Correct.ets#L26-L67" target="_blank">Question4Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示：</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.23002402749164038218179030554447:50001231000000:2800:DBC708F7205F419855BE3836B29BBF327B8C6E4C6288F73EEE775838008F3628.gif" title="点击放大" width="266"></span></p> </li><li>Image组件在分屏状态下显示异常。<p><strong>问题现象</strong></p> <p>应用进入分屏后，随着窗口变小，Image组件显示不全，页面布局显示异常。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.89586638365716951731936140952912:50001231000000:2800:ACA13C8FB8FEEA16E9552CBA8F8FC55AD00C069A9CE5240AB9E76BB2037FB843.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question5Incorrect.ets#L22-L102" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question5Incorrect {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-attribute">Flex</span>({ direction: FlexDirection.Column, alignItems: ItemAlign.Center }) {</li><li>        Text("Login Page")</li><li>          <span class="hljs-comment">// ...</span></li><li>        Text("Login in to access more services")</li><li>          <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">Image</span>($r('app.media.login_pic'))</li><li>          <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-built_in">Column</span>() {</li><li>          <span class="hljs-built_in">TextInput</span>({ placeholder:  "Account" })</li><li>            <span class="hljs-comment">// ...</span></li><li>
</li><li>          <span class="hljs-built_in">TextInput</span>({ placeholder:"Password" })</li><li>            <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-selector-tag">Button</span>($r('app.string.login'))</li><li>          <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question5Incorrect.ets#L22-L102" target="_blank">Question5Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>在进入分屏页面，窗口的height变成了屏幕的1/2，导致image组件的height变小，image图片形变。</p> <p><strong>解决措施</strong></p> <p>推荐开发者通过一多的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout#隐藏能力" target="_blank">隐藏能力</a>来实现，按照其预设的显示优先级，随容器组件尺寸变化显示或隐藏，通过设置布局优先级（displayPriority属性）来控制显隐。示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question5Correct.ets#L22-L102" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question5Correct {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-attribute">Flex</span>({ direction: FlexDirection.Column, alignItems: ItemAlign.Center }) {</li><li>        Text("Login Page")</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.displayPriority</span>(<span class="hljs-number">4</span>)</li><li>
</li><li>        Text("Login in to access more services")</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.displayPriority</span>(<span class="hljs-number">3</span>)</li><li>
</li><li>        <span class="hljs-built_in">Image</span>($r('app.media.login_pic'))</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.displayPriority</span>(<span class="hljs-number">2</span>)</li><li>
</li><li>        <span class="hljs-built_in">Column</span>() {</li><li>          <span class="hljs-built_in">TextInput</span>({ placeholder: "Account" })</li><li>            <span class="hljs-comment">// ...</span></li><li>
</li><li>          <span class="hljs-built_in">TextInput</span>({ placeholder: "Password" })</li><li>            <span class="hljs-comment">// ...</span></li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-selector-class">.displayPriority</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-selector-tag">Button</span>($r('app.string.login'))</li><li>          <span class="hljs-comment">// ...</span></li><li>          <span class="hljs-selector-class">.displayPriority</span>(<span class="hljs-number">5</span>)</li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question5Correct.ets#L22-L102" target="_blank">Question5Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示：</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.28739504506120110385846436413755:50001231000000:2800:7484D176E665F7F74E7CFCFF736AA55A1DAF9A44DFA36A329556B9CA4C8AAD14.gif" title="点击放大" width="266"></span></p> </li><li>弹窗布局错乱。<p><strong>问题现象</strong></p> <p>进入分屏后弹窗页面内容显示错乱，底部按钮挡住弹窗内容。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163003.02548150769321857286171772366385:50001231000000:2800:108F588746A003DF039EA7532C132D3D5A45C58609215AE10A9E752D34B5B935.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question6Incorrect.ets#L22-L83" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@CustomDialog</span></li><li>struct CustomDialogComp1 {</li><li>  controller: CustomDialogController = new CustomDialogController({ 'builder': '' });</li><li>
</li><li>  <span class="hljs-selector-tag">build</span>() {</li><li>    <span class="hljs-selector-tag">Column</span>() {</li><li>      <span class="hljs-selector-tag">Text</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.welcome'</span>))</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>      <span class="hljs-selector-tag">Column</span>() {</li><li>        <span class="hljs-selector-tag">Scroll</span>() {</li><li>          <span class="hljs-selector-tag">Text</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.dialog_content'</span>))</li><li>            <span class="hljs-comment">// ...</span></li><li>        }</li><li>      }</li><li>
</li><li>      <span class="hljs-selector-tag">Row</span>({ space: 12 }) {</li><li>        <span class="hljs-selector-tag">Button</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.disagree'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-selector-tag">Button</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">'app.string.agree'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-selector-class">.height</span>(<span class="hljs-number">56</span>)</li><li>      <span class="hljs-selector-class">.alignItems</span>(VerticalAlign.Top)</li><li>      <span class="hljs-selector-class">.position</span>({</li><li>        <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-built_in">constraintSize</span>({</li><li>      <span class="hljs-attribute">maxHeight</span>: <span class="hljs-string">'80%'</span></li><li>    })</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question6Incorrect.ets#L22-L83" target="_blank">Question6Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>应用未考虑分屏窗口尺寸变小的情况，弹窗高度设置为固定值，且底部按钮使用position属性设置了固定位置，导致整体布局错乱。</p> <p><strong>解决措施</strong></p> <p>使用constraintSize属性给弹窗高度限定最大值，同时使用Scroll组件包裹弹窗内容区域（一多的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout#延伸能力" target="_blank">延伸能力</a>），通过给内容区域的Column组件设置layoutWeight（一多的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-adaptive-layout#占比能力" target="_blank">占比能力</a>）属性，使其占据剩余空间，使操作按钮居于底部显示。当内容高度超过内容区域高度的时候可以滚动进行查看，优化后示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question6Correct.ets#L22-L80" data-highlighted="yes"><ol class="linenums"><li>@CustomDialog</li><li>struct CustomDialogComp {</li><li>  controller: CustomDialogController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomDialogController</span>({ <span class="hljs-string">'builder'</span>: <span class="hljs-string">''</span> });</li><li>
</li><li>  <span class="hljs-title function_ invoke__">build</span>() {</li><li>    <span class="hljs-title function_ invoke__">Column</span>() {</li><li>      <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.welcome'</span>))</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>      <span class="hljs-title function_ invoke__">Column</span>() {</li><li>        <span class="hljs-title function_ invoke__">Scroll</span>() {</li><li>          <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.dialog_content'</span>))</li><li>            <span class="hljs-comment">// ...</span></li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_ invoke__">layoutWeight</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>      <span class="hljs-title function_ invoke__">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">12</span> }) {</li><li>        <span class="hljs-title function_ invoke__">Button</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.disagree'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title function_ invoke__">Button</span>(<span class="hljs-variable">$r</span>(<span class="hljs-string">'app.string.agree'</span>))</li><li>          <span class="hljs-comment">// ...</span></li><li>      }</li><li>      .<span class="hljs-title function_ invoke__">height</span>(<span class="hljs-number">56</span>)</li><li>      .<span class="hljs-title function_ invoke__">alignItems</span>(VerticalAlign.Top)</li><li>    }</li><li>    .<span class="hljs-title function_ invoke__">constraintSize</span>({</li><li>      <span class="hljs-attr">maxHeight</span>: <span class="hljs-string">'80%'</span></li><li>    })</li><li>    .<span class="hljs-title function_ invoke__">height</span>(<span class="hljs-number">400</span>)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question6Correct.ets#L22-L80" target="_blank">Question6Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.64725624400457701303634045243732:50001231000000:2800:61D5CAF81A2AACCB03B3AE8FCA5E0DB05CD1602A33E3041DA8ED27CD4247B3B6.gif" title="点击放大" width="266"></span></p> </li></ol> </div> <div class="tiledSection"><h3 id="section533165015358">沉浸模式下顶部窗口控制条避让问题<i class="anchor-icon anchor-icon-link" anchorid="section533165015358" tips="复制节点链接"></i></h3><p><strong>沉浸式应用在悬浮窗场景下顶部操作栏无法操作</strong></p> <p><strong>问题现象</strong></p> <p>应用分屏后视图和悬浮窗顶部重合的区域无法响应操作。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.69725643829777393589021569592501:50001231000000:2800:F429D3E180D8D8AF88BF2340170FB65B79578093C16BEBF4C67B55114BC1F39E.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question7Incorrect.ets#L28-L86" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Question7Incorrect</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>=(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">getMainWindowSync</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'status'</span>, <span class="hljs-literal">false</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setSpecificSystemBarEnabled err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`aboutToAppear err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'status'</span>, <span class="hljs-literal">true</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setSpecificSystemBarEnabled err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-comment">// ...</span></li><li>
</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.icon_pause'</span>))</li><li>            <span class="hljs-comment">// ...</span></li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>                  <span class="hljs-attr">message</span>: <span class="hljs-string">'Action success'</span></li><li>                });</li><li>              } <span class="hljs-keyword">catch</span> (err) {</li><li>                <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>                <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`showToast err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              }</li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">End</span>)</li><li>        .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Top</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">hideTitleBar</span>(<span class="hljs-literal">true</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question7Incorrect.ets#L28-L86" target="_blank">Question7Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>沉浸式应用顶部没有避让，导致悬浮窗顶部bar与应用的顶部区域重叠，重叠区域中的按钮无法响应点击事件。</p> <p><strong>解决措施</strong></p> <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowavoidarea9" target="_blank">getWindowAvoidArea</a>接口可获取屏幕顶部需要规避的矩阵区域topRect，获取到该值后应用可对应做布局避让。同时可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>监听系统规避区域变化以进行布局的动态调整。具体可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-window-controlbar-adapt" target="_blank">顶部窗口控制条避让适配智慧多窗</a>，优化后示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question7Correct.ets#L28-L102" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Question7Correct</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">topSafeHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">windowStatus</span>: <span class="hljs-title class_">WindowStatusType</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStatusType</span>.<span class="hljs-property">FULL_SCREEN</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>=(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">getMainWindowSync</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'status'</span>, <span class="hljs-literal">false</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setSpecificSystemBarEnabled err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStatus</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">getWindowStatus</span>();</li><li>
</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStatus</span> === <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStatusType</span>.<span class="hljs-property">FLOATING</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>          .<span class="hljs-title function_">px2vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM</span>).<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span>);</li><li>      }</li><li>
</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowStatusChange'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (data === <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStatusType</span>.<span class="hljs-property">FLOATING</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span> =</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>              .<span class="hljs-title function_">px2vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">getWindowAvoidArea</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">AvoidAreaType</span>.<span class="hljs-property">TYPE_SYSTEM</span>).<span class="hljs-property">topRect</span>.<span class="hljs-property">height</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">topSafeHeight</span> = <span class="hljs-number">0</span>;</li><li>        }</li><li>      })</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`aboutToAppear err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">setSpecificSystemBarEnabled</span>(<span class="hljs-string">'status'</span>, <span class="hljs-literal">true</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`setSpecificSystemBarEnabled err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question7Correct.ets#L28-L102" target="_blank">Question7Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.75814772876653058413193335009136:50001231000000:2800:C048323CDF76A45988039BAFD5D3686C64478BF4DE57A9C2215B039E90D44C6D.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h3 id="section4595191593711">横向悬浮窗适配问题<i class="anchor-icon anchor-icon-link" anchorid="section4595191593711" tips="复制节点链接"></i></h3><p><strong>视频播放未适配横向悬浮窗</strong></p> <p><strong>问题现象</strong></p> <p>视频或者游戏类应用在横屏模式下，开启悬浮窗后，页面没有适配横屏，导致内容显示不全或者观看体验不好。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.01324673869293485924685164876357:50001231000000:2800:56CD7CEBB5653A63A84589E239D459AD4BEFCDDE63D9EE4A1EB17767D4899937.gif" title="点击放大" width="266"></span></p> <p>优化前示例代码如下：</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question8Incorrect.ets#L21-L38" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">@Component</span></li><li>export struct Question8Incorrect {</li><li>  <span class="hljs-built_in">build</span>() {</li><li>    <span class="hljs-built_in">NavDestination</span>() {</li><li>      <span class="hljs-built_in">Column</span>() {</li><li>        <span class="hljs-selector-tag">Video</span>({ src: $rawfile('testVideo1.mp4') })</li><li>          <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>          <span class="hljs-selector-class">.autoPlay</span>(true)</li><li>          <span class="hljs-selector-class">.objectFit</span>(ImageFit.Contain)</li><li>          <span class="hljs-selector-class">.controls</span>(false)</li><li>      }</li><li>      <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')</li><li>      <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')</li><li>    }</li><li>    <span class="hljs-selector-class">.hideTitleBar</span>(true)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question8Incorrect.ets#L21-L38" target="_blank">Question8Incorrect.ets</a></div></div></div></div> <p><strong>可能原因</strong></p> <p>悬浮窗默认是竖屏，需要应用主动适配横屏的属性值。</p> <p><strong>解决措施</strong></p> <p>开发者可以通过在module.json5配置文件中abilities标签下的preferMultiWindowOrientation属性增加“landscape_auto”。</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/module.json5#L2-L59" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-string">"abilities"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-string">"preferMultiWindowOrientation"</span>: <span class="hljs-string">"landscape_auto"</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/module.json5#L2-L59" target="_blank">module.json5</a></div></div></div></div> <p>该场景下多窗布局动态可变为横向，需要配合API（enableLandscapeMultiWindow / disableLandscapeMultiWindow）使用。</p> <div class="screenLinkPre"><div _ngcontent-nby-c106="" class="highlight-div"><div _ngcontent-nby-c106="" class="highlight-div-header"><div _ngcontent-nby-c106="" class="highlight-div-header-left"><div _ngcontent-nby-c106="" class="handle-button expand-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nby-c106="" class="highlight-div-header-right"><div _ngcontent-nby-c106="" class="handle-button ai-button"></div><div _ngcontent-nby-c106="" class="handle-button line-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nby-c106="" class="handle-button theme-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nby-c106="" class="handle-button copy-button"><div _ngcontent-nby-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nby-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question8Correct.ets#L29-L70" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Question8Correct</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">windowClass</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">Window</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>=(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>).<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">getMainWindowSync</span>();</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>.<span class="hljs-title function_">enableLandscapeMultiWindow</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`enableLandscapeMultiWindow err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> error = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`aboutToAppear err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>
</li><li>
</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowClass</span>?.<span class="hljs-title function_">disableLandscapeMultiWindow</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error:BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title class_">Logger</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`disableLandscapeMultiWindow err, code: <span class="hljs-subst">${error.code}</span>, mesage: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/MultiWindowPractice/blob/master/entry/src/main/ets/pages/Question8Correct.ets#L29-L70" target="_blank">Question8Correct.ets</a></div></div></div></div> <p>优化后效果如下图所示。</p> <p></p> <p><span><img height="545.965" originheight="720" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163004.69506747053104484380227264226938:50001231000000:2800:432B9260A48967911FA3AF5A69B96EF78CB1AB421B5A23A3BD3790691E9ACB49.gif" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section63254723814">总结<i class="anchor-icon anchor-icon-link" anchorid="section63254723814" tips="复制节点链接"></i></h2><p>智慧多窗中的悬浮窗和分屏能力是系统提供的，开发者不需要人为进行功能开发，但是开发者需要重点关注是悬浮窗/分屏模式下的应用的布局适配问题。下面总结了一些常见的布局适配经验：</p> <ul><li>如果应用不需要使用悬浮窗/分屏能力，建议只声明supportWindowMode的值为“fullscreen”。</li><li>开发者可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-overview" target="_blank">一次开发，多端部署概览</a>中关于页面开发的<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-multi-device-page" target="_blank">多设备界面开发</a>，避免应用在使用悬浮窗/分屏能力时，页面出现截断、挤压、堆叠等现象。</li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#setwindowlayoutfullscreen9" target="_blank">setWindowLayoutFullScreen()</a>方法来动态的设置应用是否沉浸，从而确认是否规避状态栏。</li><li>在悬浮窗模式下，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#onavoidareachange9" target="_blank">on('avoidAreaChange')</a>方法来获取状态栏高度，使应用内容区域规避状态栏。</li></ul> </div> </div> <div></div></div>