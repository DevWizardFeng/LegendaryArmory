<h1 _ngcontent-mme-c119="" class="doc-title ng-star-inserted" title="智能体场景开发案例"> 智能体场景开发案例 </h1>

<div _ngcontent-mme-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section664274582410">简介<i class="anchor-icon anchor-icon-link" anchorid="section664274582410" tips="复制节点链接"></i></h2><p>智能体作为一个由用户通过角色指令精心设计的具有明确身份和目标的虚拟实体，其核心价值在于能够像人一样使用自然语言对话，理解用户需求，运用预设的知识、能力和逻辑进行思考与推理，并主动生成恰当的响应或执行相应操作（任务完成、信息提供、服务实施），以满足用户需求或实现预设目标。通过用户友好的交互界面、简便的接入方式及广泛的应用场景，满足消费者在日常生活中对智能助手、信息检索、推荐等功能的需求。同时，智能体还可服务于多个垂直行业和业务场景，有效拓展市场覆盖面与增强用户粘性，用户亦可直接与智能体独立对话，以获得场景化的连贯知识与服务。</p> <p><a href="https://developer.huawei.com/consumer/cn/hag/hagindex.html#/" target="_blank">小艺开放平台</a>是小艺结合了意图框架与华为AI大模型能力面向开发者的能力开放平台。基于该平台的<a href="https://developer.huawei.com/consumer/cn/hag/hagindex.html?isInFrame=true&amp;lang=zh_CN#/agentHome/square" target="_blank">小艺智能体平台</a>允许开发者构建智能体，为用户提供大模型时代的智能新体验，同时实现业务增长。开发者可以基于小艺智能体平台开发专属智能体。</p> <p>本文主要介绍如何基于<a href="/consumer/cn/doc/best-practices/bpta-agent#section2907103562520">智能问答场景</a>和<a href="/consumer/cn/doc/best-practices/bpta-agent#section15781420152616">音频播放场景</a>，在小艺智能体平台上快速搭建智能体并适配相应需求场景。</p> <p>智能体从创建到上架主要包含以下五个步骤：</p> <ol><li><a href="/consumer/cn/doc/best-practices/bpta-agent#section524618504324">智能体创建</a>：开发者需在<a href="https://developer.huawei.com/consumer/cn/hag/hagindex.html#/" target="_blank">小艺开放平台</a>完成企业/个人账号注册，获取HarmonyOS生态的开发权限，基于智能体平台快速初始化项目，自定义开发专属智能体。</li><li><a href="/consumer/cn/doc/best-practices/bpta-agent#section59501510153311">模式选择</a>：不同模式的智能体，适配的场景也有所不同，开发者可按照业务需求选择合适模式的智能体，开发构建智能场景的智能体。</li><li><a href="/consumer/cn/doc/best-practices/bpta-agent#section109683238339">智能体编排</a>：可视化流程的编排框架，自定义智能体能力点，优化完善智能体场景。</li><li><a href="/consumer/cn/doc/best-practices/bpta-agent#section864165923316">功能验证</a>：实时性、可视化、场景化的验证模式，可实时交互验证，或真实场景验证。</li><li><a href="/consumer/cn/doc/best-practices/bpta-agent#section74742275511">上架/升级</a>：通过<a href="https://developer.huawei.com/consumer/cn/doc/service/audit-specifications-0000002469548113" target="_blank">上架审核规范</a>的审核上架，保障对外发布信息的安全与合规，进一步提升用户体验。</li></ol> </div> <div class="tiledSection"><h2 id="section369116225258">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section369116225258" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section524618504324" class="firsth2">智能体创建<i class="anchor-icon anchor-icon-link" anchorid="section524618504324" tips="复制节点链接"></i></h3><p>登录<a href="https://developer.huawei.com/consumer/cn/hag/hagindex.html#/" target="_blank">小艺开放平台</a>，点击【立即体验】按钮，进入小艺智能体平台页面。点击左上角【+创建智能体】按钮，即可进入智能体创建流程。可自行设定智能体的相关信息，包括它的名称、头像、智能体描述、智能体分类和运行设备等信息。具体内容可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/quick-start-0000002469548009" target="_blank">快速创建智能体</a>。</p> <p>准备条件：真机调试及端插件开发需在HarmonyOS 5.1.0 Release及以上版本的设备上进行。</p> <p><span><img height="463.06881195720797" originheight="1282" originwidth="2547" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.43569343753336439027469085355893:50001231000000:2800:C371913F9CFF98F056FAE5D29DD2E150C5485F79D8090D99D4B8FD557DBE7A99.png" title="点击放大" width="920"></span></p> </div> <div class="tiledSection"><h3 id="section59501510153311">模式选择<i class="anchor-icon anchor-icon-link" anchorid="section59501510153311" tips="复制节点链接"></i></h3><p>智能体分为LLM模式、工作流模式和A2A模式三种，对于不同的场景，适配的智能体模式也会有所不同。</p> <p>LLM模式智能体主要依靠大语言模型的能力，如语言理解、生成、推理等，来处理任务和回答问题。它通常直接根据用户输入，利用大语言模型内部的知识和算法生成响应。</p> <p>工作流模式智能体是通过预定义的代码路径，协调智能体与工具的交互。它将任务按照特定顺序或规则分解为多个步骤，每个步骤有明确的输入和输出，智能体按照预设流程依次执行，以实现任务目标。这种模式强调可预测性和一致性，适合任务明确、流程固定的场景。</p> <p>A2A模式是一种三方智能体接入小艺开放平台的高效编排方式。开发者可通过该模式基于鸿蒙Agent通信协议快速、便捷地将成熟的第三方智能体对接至小艺开放平台，实现分发与调用，提升平台的场景覆盖能力。该模式适用于同时具备鸿蒙端应用与云侧智能体能力的企业开发者。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.6.1.5.1.1" valign="top" width="13.34%"><p>模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.5.1.2" valign="top" width="31.05%"><p>LLM模式（Agent）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.5.1.3" valign="top" width="27.13%"><p>工作流模式（Workflow）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.5.1.4" valign="top" width="28.48%"><p>A2A模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="13.34%"><p>核心逻辑</p> </td> <td class="cellrowborder" valign="top" width="31.05%"><p>基于内部知识直接生成回答，由大模型决策进行工具调用</p> </td> <td class="cellrowborder" valign="top" width="27.13%"><p>按预设流程分步执行（如数据查询→格式转换→结果整合）</p> </td> <td class="cellrowborder" valign="top" width="28.48%"><p>通过标准化通信协议，实现鸿蒙生态中智能体跨设备协作与端云协同。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.34%"><p>智能问答场景适用性</p> </td> <td class="cellrowborder" valign="top" width="31.05%"><p>适合知识型、交互型问答（如常识咨询、客服答疑、教育辅导）</p> </td> <td class="cellrowborder" valign="top" width="27.13%"><p>适合多步骤流程化任务（如报销申请审批、物流跟踪）</p> </td> <td class="cellrowborder" valign="top" width="28.48%"><p>适合整合多源动态知识、融合多模态响应并跨服务生成连贯交互的场景（如医疗咨询）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="13.34%"><p>音频播放场景适用性</p> </td> <td class="cellrowborder" valign="top" width="31.05%"><p>适合处理用户语音指令（如 “播放周杰伦的歌”），需调用外部工具处理音频解码、渲染等底层操作</p> </td> <td class="cellrowborder" valign="top" width="27.13%"><p>适合音频播放的全链路处理（从资源获取到设备输出）</p> </td> <td class="cellrowborder" valign="top" width="28.48%"><p>通过协议扩展第三方播控能力、设备间播放状态同步及低时延优化策略，实现无缝跨端音频流转与场景化音质适配。</p> </td> </tr>  </tbody></table></div> </div> <p>不同编排模式的智能体，能力拓展部分的功能点也会有所区别。各编排模式的区别可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/differences-in-arrangement-modes-0000002471344117" target="_blank">智能体分类</a>，开发者可根据不同模式的区别，考虑使用场景应该适配何种编排模式的智能体，选择对应的编排模式，并设定智能体相关信息，便可创建对应模式的智能体。</p> <p><span><img height="437.49371727748695" originheight="752" originwidth="1588" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.90419603248738380493954449532513:50001231000000:2800:4FAF2103FE527C38940833F89E973186CAAD7C420A174B006A1B115D98D8526E.png" title="点击放大" width="920"></span></p> <p></p> </div> <div class="tiledSection"><h3 id="section109683238339">智能体编排<i class="anchor-icon anchor-icon-link" anchorid="section109683238339" tips="复制节点链接"></i></h3><p>智能体创建后，进入智能体的编排页面，开始智能体的编排，给智能体添加各种能力，优化完善智能体。其中，开场对话可以让用户快速了解你的智能体功能或场景设定故事背景，预置问题可以让用户通过点击快速体验智能体的能力，角色指令（prompt）直接决定你所创造的智能体的效果。更多能力点，开发者可参考<a href="https://developer.huawei.com/consumer/cn/doc/service/ability-expansion-function-introduction-0000002437625858" target="_blank">编排-能力拓展</a>，自定义智能体的背景、能力等。</p> <p>以下为LLM模式和工作流模式的编排页面：</p> <p><span><img height="458.56384976525817" originheight="1269" originwidth="2552" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.22890674798943267816223182008125:50001231000000:2800:4287835099B103925618183A7345AF001534C32ACEF73D19431045CD17A3BC67.png" title="点击放大" width="920"></span></p> <p><span><img height="456.58779342723" originheight="1265" originwidth="2555" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.72590122020053426046391232871810:50001231000000:2800:15858E346D59270EF6CAC3B788A20EAEA21D04D0553DE1F0073A8247C643DCF8.png" title="点击放大" width="920"></span></p> <p></p> </div> <div class="tiledSection"><h3 id="section864165923316">功能验证<i class="anchor-icon anchor-icon-link" anchorid="section864165923316" tips="复制节点链接"></i></h3><p>在搭建完成智能体后，开发者可以在调试与预览区域与智能体进行对话，测试该智能体功能是否与预期相同，并根据智能体执行过程及响应信息对智能体配置进行优化与调整，具体调试过程可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/real-machine-testing-0000002471344145" target="_blank">调试与预览</a>，包括真机测试与调试两种功能验证方式。</p> </div> <div class="tiledSection"><h3 id="section74742275511">上架/升级<i class="anchor-icon anchor-icon-link" anchorid="section74742275511" tips="复制节点链接"></i></h3><p>功能测试完成后，点击【保存】【上架】即可将智能体提交到上架审核阶段，具体流程可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/process-introduction-0000002509696971" target="_blank">上/下架、升级流程介绍</a>。为了方便开发者的智能体能够顺利通过审核，可参考<a href="https://developer.huawei.com/consumer/cn/doc/service/audit-specifications-0000002469548113" target="_blank">上架审核规范</a>排查检视自开发的智能体。待通过审核上架后，即可在小艺平台使用完整的智能体。</p> </div> <div class="tiledSection"><h2 id="section2907103562520">智能问答场景<i class="anchor-icon anchor-icon-link" anchorid="section2907103562520" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section4901131065913" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section4901131065913" tips="复制节点链接"></i></h3><p>智能问答系统凭借其高效、便捷的交互特性，已广泛应用于多个领域。依托知识库，智能问答能够精准匹配用户需求，提供准确且专业的回答。例如，医疗场景中，用户描述 “咳嗽 + 发热”，系统结合症状库推荐科室并提示 “可能的流感风险”。智能问答的核心价值在于通过自然语言交互解决信息获取效率问题，它通常直接根据用户输入，利用开发者上架的知识库或大语言模型内部的知识和算法生成响应，实现更精准、个性化的服务。具有准确与规范的答案（所有回答基于企业预设的知识库或官方数据，避免人工客服因理解偏差或记忆错误导致答案不一致）和服务质量的可控性（企业可随时更新知识库，保证答案同步最新政策，如税法调整、产品更新等）。</p> </div> <div class="tiledSection"><h3 id="section15146192212599">场景开发<i class="anchor-icon anchor-icon-link" anchorid="section15146192212599" tips="复制节点链接"></i></h3><p><strong>模式选择</strong></p> <p>智能问答场景主要为简单的语言交互（如闲聊、知识查询），无需外部工具调用，因此优先选择LLM模式，可基于内部知识直接生成回答。LLM 模式主要有自然语言处理能力、知识整合效率、交互体验等方面的核心优势，凭借这些原生优势，成为智能问答的主流选择，尤其适合知识型、交互型、跨领域的问答场景。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.4.1.4.1.1" valign="top" width="14.788521147885211%"><p>模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.4.1.2" valign="top" width="44.375562443755626%"><p>LLM 模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.4.1.3" valign="top" width="40.83591640835916%"><p>工作流模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="14.788521147885211%"><p>核心逻辑</p> </td> <td class="cellrowborder" valign="top" width="44.375562443755626%"><p>基于内部知识直接生成回答，由大模型决策进行工具调用</p> </td> <td class="cellrowborder" valign="top" width="40.83591640835916%"><p>按预设流程分步执行（如数据查询→格式转换→结果整合）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="14.788521147885211%"><p>智能问答场景适用性</p> </td> <td class="cellrowborder" valign="top" width="44.375562443755626%"><p>适合知识型、交互型问答（如常识咨询、客服答疑、教育辅导）</p> </td> <td class="cellrowborder" valign="top" width="40.83591640835916%"><p>适合多步骤流程化任务（如报销申请审批、物流跟踪）</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="14.788521147885211%"><p>智能问答场景局限性</p> </td> <td class="cellrowborder" valign="top" width="44.375562443755626%"><p>依赖训练数据时效性（需定期更新知识库）；复杂计算任务需结合工具</p> </td> <td class="cellrowborder" valign="top" width="40.83591640835916%"><p>流程固定，难以应对灵活的问答需求；需人工配置大量流程节点</p> </td> </tr>  </tbody></table></div> </div> <p>问答智能体主要基于开发者提供的知识库，智能整合内部知识，生成所需回答。因此，除了需要选择LLM模式的智能体外，还需要自定义所需场景的知识库。</p> <p><strong>知识库创建上架</strong></p> <ol><li>创建知识库：在小艺开放平台工作空间的知识库界面点击【新建知识库】，进入新建知识库页面，填写知识库信息后点击【新建】按钮，新建知识库成功。</li><li>配置知识库：从知识库列表点击新建的知识库名称进入知识列表页面，点击【新建知识】，导入相应知识类型的文件，并填写相关信息后，点击【确定】，知识添加成功。具体流程可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/create-a-knowledge-base-0000002471344153" target="_blank">创建知识库</a>。</li><li>上架知识库：点击相应知识的【上架】按钮，等待知识库审核上架即可。文档类型的知识要等待数据校验完成后才能上架。</li></ol> <p><strong>LLM模式智能体创建</strong></p> <ol><li>创建智能体：参考上述<a href="/consumer/cn/doc/best-practices/bpta-agent#section369116225258">开发步骤</a>，创建一个LLM模式的智能体。</li><li>编排智能体：进入智能体编排页面，编辑智能体的开场对话，并添加上架完成的知识库，开发者也可按照实际业务需求自行编排。</li></ol> <p><strong>功能验证</strong></p> <p>可调试测试或真机测试，真机测试需添加白名单，设置白名单手机或账号，发布至手机智能体，方可真机测试。</p> <ol><li>调试测试：调试与预览界面可以进行交互测试，预览实际交互场景，也可点击右上角调试按钮，进入调试详情页，查看详细的调测信息。<p><span><img height="802.9875000000001" originheight="1562" originwidth="1490" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.84673989405482400757909185904996:50001231000000:2800:6A3F4050EC436B460925093A4CC42CC9CF7E0B68E7A007D1ED77B6FE20D0A075.png" title="点击放大" width="765.953384"></span></p> </li><li>真机测试：点击调试与预览页面右上角的真机测试，可发布真机测试。真机测试前需配置白名单，开发者（团队账户需管理员权限）可通过新增组来管理真机调试用户，每个团队最多可创建100个用户组，每个用户组最多可添加100个用户。 开发者在服务发布至真机调试后，处于真机调试用户白名单中的用户可以访问到该开发测试服务，详见开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/list-of-user-groups-for-real-machine-testing-0000002471264273" target="_blank">真机测试</a>。</li></ol> <p><strong>上架升级</strong></p> <p>功能测试完成后，点击【保存】【上架】即可将智能体提交到上架审核阶段，具体流程可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/process-introduction-0000002509696971" target="_blank">上/下架、升级流程介绍</a>。</p> </div> <div class="tiledSection"><h2 id="section15781420152616">音频播放场景<i class="anchor-icon anchor-icon-link" anchorid="section15781420152616" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section16841114495911" class="firsth2">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section16841114495911" tips="复制节点链接"></i></h3><p>音频播放的应用场景广泛，可根据使用场景、设备类型及功能需求分为多种适用类型，不同场景下的音频播放均围绕：实时性、音质、设备适配、离线能力、隐私安全等方面展开。</p> </div> <div class="tiledSection"><h3 id="section2084112446594">场景开发<i class="anchor-icon anchor-icon-link" anchorid="section2084112446594" tips="复制节点链接"></i></h3><p><strong>模式选择</strong></p> <p>音频播放场景APP一般包括跳转播放页、播放音频、获取歌曲名称等功能，对于涉及到存在音频播放场景的项目，想要通过语音、文字等操作智能化实现上述功能，则需使用端插件和工作流模式的智能体架构。该架构不仅解决了音频播放场景智能化交互（语音 / 文字指令），还提供了高效的本地执行载体，形成本地化处理与流程协同的高效架构。结合工作流模式，设置节点控制（如音频播放、页面跳转、信息获取），端插件可本地协调多模块交互，运行在设备本地的功能模块。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.4.1.4.1.1" valign="top" width="18.29%"><p>模式</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.4.1.2" valign="top" width="37.769999999999996%"><p>工作流模式（Workflow）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.4.1.3" valign="top" width="43.94%"><p>LLM 模式</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.29%"><p>核心逻辑</p> </td> <td class="cellrowborder" valign="top" width="37.769999999999996%"><p>按预设流程分步执行（如数据查询→格式转换→结果整合）</p> </td> <td class="cellrowborder" valign="top" width="43.94%"><p>基于内部知识直接生成回答，由大模型决策进行工具调用</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.29%"><p>音频播放场景适用性</p> </td> <td class="cellrowborder" valign="top" width="37.769999999999996%"><p>适合音频播放的全链路处理（从资源获取到设备输出）</p> </td> <td class="cellrowborder" valign="top" width="43.94%"><p>适合处理用户语音指令（如 “播放周杰伦的歌”），但无法直接处理音频解码、渲染等底层操作</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.29%"><p>音频播放场景局限性</p> </td> <td class="cellrowborder" valign="top" width="37.769999999999996%"><p>灵活性较低，需人工配置所有流程节点</p> </td> <td class="cellrowborder" valign="top" width="43.94%"><p>不具备音频编解码、设备驱动等底层能力，需依赖外部工具支持</p> </td> </tr>  </tbody></table></div> </div> <p>音频播放场景，主要基于音频编解码等功能，需要外部工具的支持，可在端插件实现音频播放功能。同时，音频播放场景一般涉及页面跳转、音频播放、获取信息等功能，通过设计流程节点，可搭建业务所需的整体流程。因此，除了需要选择工作流模式的智能体外，还需要实现适配流程节点的端插件。</p> <p><strong>端插件创建上架</strong></p> <ol><li>创建端插件：在小艺开放平台工作空间的插件界面点击【新建插件】，选择端插件，填写对应的APP包名和名称。点击【保存】后，创建端插件成功，进入端插件的编辑页面。</li><li>配置端插件：点击【新建工具】，在工具信息页填写工具名称后点击【创建】，可新增一条工具。点击【添加版本】，按页面提示填写参数后，点击【创建】，进入工具信息页，按需求可添加输入输出参数，点击【保存】，端插件的一个工具配置完成。按照上述操作方法，可添加多条工具，开发者可按需配置。具体配置方式也可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/create-side-plug-in-0000002437625930" target="_blank">创建端插件</a>。<p>本场景涉及三个功能，包括获取歌曲名称、跳转播放页、播放音频，因此配置了三个对应功能的工具。具体配置信息如下图所示：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.7.2.3.1.4.1.1" valign="top" width="33.33333333333333%"><p>获取信息</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.3.1.4.1.2" valign="top" width="33.33333333333333%"><p>跳转页面</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.3.1.4.1.3" valign="top" width="33.33333333333333%"><p>播放音频</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><p><span><img originheight="592" originwidth="897" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.15037232581488430039842904488009:50001231000000:2800:A0FA133595FC01C89B82977C4C3BACFEF02EFDE6F1BBEB3CD576BC18922E7934.png" width="282.66666666666663" height="186.55369751021922"></span></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p><span><img originheight="588" originwidth="898" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.27198001992919341031834230114494:50001231000000:2800:15305D05B0350853762CC9BB751F7019BA3CB2F64DCC322FE9F2490753DAB38A.png" width="282.66666666666663" height="185.08685968819594"></span></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p><span><img originheight="588" originwidth="900" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163351.31225673030069080581237636221891:50001231000000:2800:CF9E0AB51C526D77B8EE741C63CA1BD80B9EB3DB97DD5A2DA318C535BC42BBC3.png" width="282.66666666666663" height="184.67555555555552"></span></p> </td> </tr>  </tbody></table></div> </div> </li><li>上架：配置完端插件信息后，点击【上架】按钮，填写版本信息后，点击【确认】，端插件进入上架审核中，待审核上架成功后，即可在其他场景使用已上架的端插件。</li></ol> <p><strong>端插件开发</strong></p> <p>端插件作为设备本地运行的功能模块，提供能力的服务在HarmonyOS设备侧，需要在端侧进行代码实现。对于音频播放场景的实现有以下几步：</p> <ol><li>在端侧应用工程根目录下新建entry/src/main/resources/base/profile/insight_intent.json文件，用来绑定上一步实现的端插件中对应的工具。<p>intentName对应工具名称，intentVersion对应工具版本号，srcEntry为基于意图框架<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentexecutor#insightintentexecutor" target="_blank">InsightIntentExecutor</a>类方法的业务逻辑处理文件。</p> <div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"insightIntents"</span>: [</li><li>    {</li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">""</span>,</li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"PlayHiddenAudio"</span>,</li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span></li><li>        ]</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">""</span>,</li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"GetAudioName"</span>,</li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span></li><li>        ]</li><li>      }</li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"domain"</span>: <span class="hljs-string">""</span>,</li><li>      <span class="hljs-string">"intentName"</span>: <span class="hljs-string">"OpenSecondPage"</span>,</li><li>      <span class="hljs-string">"intentVersion"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>      <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/entryability/InsightIntentExecutorImpl.ets"</span>,</li><li>      <span class="hljs-string">"uiAbility"</span>: {</li><li>        <span class="hljs-string">"ability"</span>: <span class="hljs-string">"EntryAbility"</span>,</li><li>        <span class="hljs-string">"executeMode"</span>: [</li><li>          <span class="hljs-string">"background"</span>,</li><li>          <span class="hljs-string">"foreground"</span></li><li>        ]</li><li>      }</li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li><li>绑定的端插件被调用时的业务逻辑处理。<div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L17-L99" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent, <span class="hljs-title class_">InsightIntentExecutor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">AudioPlayHandler</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./intentHandlers/AudioPlayHandler'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">TextGetHandler</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./intentHandlers/TextGetHandler'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">PageNavigateHandler</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./intentHandlers/PageNavigateHandler'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsightIntentExecutorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InsightIntentExecutor</span> {</li><li>  <span class="hljs-comment">// Instruction implementation class.</span></li><li>  <span class="hljs-keyword">private</span> audioHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioPlayHandler</span>();</li><li>  <span class="hljs-keyword">private</span> textHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextGetHandler</span>();</li><li>  <span class="hljs-keyword">private</span> pageHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageNavigateHandler</span>();</li><li>
</li><li>  <span class="hljs-comment">// Intention execution method for backend execution.</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onExecuteInUIAbilityBackgroundMode</span>(</li><li>    <span class="hljs-attr">intentName</span>: <span class="hljs-built_in">string</span>,</li><li>    <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;</li><li>  ): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">switch</span> (intentName) {</li><li>        <span class="hljs-comment">// Play audio intention.</span></li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'PlayHiddenAudio'</span>:</li><li>          <span class="hljs-keyword">const</span> <span class="hljs-attr">stringParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">convertToRecord</span>(params);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioHandler</span>.<span class="hljs-title function_">execute</span>(stringParam);</li><li>
</li><li>        <span class="hljs-comment">// Obtain audio name intent.</span></li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetAudioName'</span>:</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">textHandler</span>.<span class="hljs-title function_">execute</span>();</li><li>
</li><li>        <span class="hljs-attr">default</span>:</li><li>          <span class="hljs-keyword">return</span> {</li><li>            <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span>,</li><li>            <span class="hljs-attr">result</span>: {</li><li>              <span class="hljs-string">'status'</span>: <span class="hljs-string">'failed'</span>,</li><li>              <span class="hljs-string">'message'</span>: <span class="hljs-string">`not valid intent name, <span class="hljs-subst">${intentName}</span>`</span></li><li>            }</li><li>          };</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">return</span> {</li><li>        <span class="hljs-attr">code</span>: -<span class="hljs-number">2</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-string">'status'</span>: <span class="hljs-string">'failed'</span>,</li><li>          <span class="hljs-string">'message'</span>: <span class="hljs-string">`Intent execution failed: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span></li><li>        }</li><li>      };</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">convertToRecord</span>(<span class="hljs-attr">origin</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;): <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {};</li><li>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(origin).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {</li><li>      result[key] = <span class="hljs-title class_">String</span>(origin[key]);</li><li>    });</li><li>
</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Execution method of backend execution intention.</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onExecuteInUIAbilityForegroundMode</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;, <span class="hljs-attr">pageLoader</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>):</li><li>    <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>    <span class="hljs-keyword">switch</span> (name) {</li><li>      <span class="hljs-comment">// Open the second page intention.</span></li><li>      <span class="hljs-keyword">case</span> <span class="hljs-string">'OpenSecondPage'</span>:</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageHandler</span>.<span class="hljs-title function_">execute</span>();</li><li>      <span class="hljs-attr">default</span>:</li><li>        pageLoader.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/MainPage'</span>)</li><li>          .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`loadContent failed. code=<span class="hljs-subst">${error.code}</span>, message=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>          })</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({</li><li>      <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span>,</li><li>      <span class="hljs-attr">result</span>: {</li><li>        <span class="hljs-attr">message</span>: <span class="hljs-string">'unknown intent'</span></li><li>      }</li><li>    } <span class="hljs-keyword">as</span> insightIntent.<span class="hljs-property">ExecuteResult</span>)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/InsightIntentExecutorImpl.ets#L17-L99" target="_blank">InsightIntentExecutorImpl.ets</a></div></div></div></div> </li><li>功能开发。<ul><li>实现获取歌曲名称的功能，并返回读取结果。<div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/TextGetHandler.ets#L17-L40" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MediaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utils/audioplayer/MediaService'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextGetHandler</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Execute the method of obtaining the name of the played audio.</span></li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">audioName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">MediaService</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getAudioFileName</span>();</li><li>
</li><li>      <span class="hljs-comment">// Return result.</span></li><li>      <span class="hljs-keyword">return</span> {</li><li>        <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-attr">status</span>:<span class="hljs-string">'success'</span>,</li><li>          <span class="hljs-attr">audioName</span>: audioName,</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'get audio name success'</span></li><li>        }</li><li>      };</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`get audio name failed: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/TextGetHandler.ets#L17-L40" target="_blank">TextGetHandler.ets</a></div></div></div></div> </li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-linking-startup#拉起方应用实现应用跳转" target="_blank">Deep Linking</a>实现跳转播放页的功能。<p>配置module.json5文件中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#skills标签" target="_blank">skills标签</a>，标识跳转场景。</p> <div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/module.json5#L25-L39" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"skills"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"entities"</span>: [<span class="hljs-string">"entity.system.browsable"</span>],</li><li>    <span class="hljs-string">"actions"</span>: [</li><li>      <span class="hljs-string">"ohos.want.action.viewData"</span></li><li>    ],</li><li>    <span class="hljs-string">"uris"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"scheme"</span>: <span class="hljs-string">"demo"</span>,</li><li>        <span class="hljs-string">"host"</span>: <span class="hljs-string">"aiagentdemo.com"</span>,</li><li>        <span class="hljs-string">"path"</span>: <span class="hljs-string">"SecondPage"</span></li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/module.json5#L25-L39" target="_blank">module.json5</a></div></div></div></div> <p>在EntryAbility.ets文件中的onNewWant()生命周期回调中，获取、解析拉起方传入的应用链接，开发者可自定义后续的业务处理。</p> <div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/EntryAbility.ets#L75-L92" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onNewWant</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-keyword">void</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Received URI:'</span>, want.<span class="hljs-property">uri</span>);</li><li>  <span class="hljs-keyword">const</span> uri = want.<span class="hljs-property">uri</span>;</li><li>  <span class="hljs-keyword">let</span> pathname = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">if</span> (uri) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> urlObj = url.<span class="hljs-property">URL</span>.<span class="hljs-title function_">parseURL</span>(uri);</li><li>      pathname = urlObj.<span class="hljs-property">pathname</span>;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getUIContext failed. code=<span class="hljs-subst">${err.code}</span>, message=<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>    uiContext?.<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages'</span> + pathname })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`pushUrl failed. code=<span class="hljs-subst">${error.code}</span>, message=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/EntryAbility.ets#L75-L92" target="_blank">EntryAbility.ets</a></div></div></div></div> <p>执行页面跳转并返回跳转结果。</p> <div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/PageNavigateHandler.ets#L17-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageNavigateHandler</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Execute page redirection.</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">null</span>;</li><li>      uiContext = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'uiContext'</span>);</li><li>      uiContext?.<span class="hljs-title function_">getRouter</span>().<span class="hljs-title function_">pushUrl</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'pages/SecondPage'</span> })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,<span class="hljs-string">`pushUrl failed, Code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-keyword">return</span> {</li><li>        <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span>,</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'Navigation successful'</span>,</li><li>          <span class="hljs-attr">targetPage</span>: <span class="hljs-string">'SecondPage'</span></li><li>        }</li><li>      };</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Page navigation failed: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/PageNavigateHandler.ets#L17-L44" target="_blank">PageNavigateHandler.ets</a></div></div></div></div> </li><li>音频播放功能的实现，开发者可根据实际业务需求自定义实现该功能。<div class="screenLinkPre"><div _ngcontent-mme-c106="" class="highlight-div"><div _ngcontent-mme-c106="" class="highlight-div-header"><div _ngcontent-mme-c106="" class="highlight-div-header-left"><div _ngcontent-mme-c106="" class="handle-button expand-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mme-c106="" class="highlight-div-header-right"><div _ngcontent-mme-c106="" class="handle-button ai-button"></div><div _ngcontent-mme-c106="" class="handle-button line-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mme-c106="" class="handle-button theme-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mme-c106="" class="handle-button copy-button"><div _ngcontent-mme-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mme-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" codehub="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/AudioPlayHandler.ets#L17-L44" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MediaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utils/audioplayer/MediaService'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioPlayHandler</span> {</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">ExecuteResult</span>&gt; {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// Analyze the parameters passed in by the plugin on the parsing end.</span></li><li>      <span class="hljs-keyword">const</span> rawAudioName = param.<span class="hljs-property">audioName</span>;</li><li>      <span class="hljs-keyword">const</span> audioName = rawAudioName.<span class="hljs-title function_">toString</span>();</li><li>
</li><li>      <span class="hljs-comment">// The method of playing audio can be customized by developers according to their actual business needs.</span></li><li>      <span class="hljs-title class_">MediaService</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">initAudioPlayer</span>(audioName);</li><li>
</li><li>      <span class="hljs-comment">// Return the result to the end plugin.</span></li><li>      <span class="hljs-keyword">return</span> {</li><li>        <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">result</span>: {</li><li>          <span class="hljs-attr">status</span>: <span class="hljs-string">'success'</span>,</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">`play audio <span class="hljs-subst">${audioName}</span> started`</span>,</li><li>        }</li><li>      };</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Audio play failed: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/BestPracticeSnippets/blob/master/XiaoyiAgentDemo/entry/src/main/ets/entryability/intentHandlers/AudioPlayHandler.ets#L17-L44" target="_blank">AudioPlayHandler.ets</a></div></div></div></div> </li></ul> </li></ol> <p><strong>工作流创建上架</strong></p> <ol><li><a href="https://developer.huawei.com/consumer/cn/doc/service/create-workflow-0000002471344157" target="_blank">创建工作流</a>：在小艺开放平台工作空间的工作流界面点击【新建工作流】，填写工作流对应信息后，点击【确定】，创建工作流成功并进入工作流编辑页面。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/service/arrange-workflow-0000002471264285" target="_blank">编排工作流</a>：<ol><li>创建工作流后，在画布中点击【添加节点】后，选择【插件】按钮，在工作空间中选择已上架的端插件点击【添加】，即可将所需插件添加至画布中。</li><li>获取歌曲名称、跳转播放页、播放音频三个功能场景为并列关系，可在画布中点击【添加节点】，添加【选择器】，点击添加好的选择器，在右侧的选择器编辑页面设定不同分支对应的条件，条件成立则下一步运行对应的分支（点击条件分支右侧的+号，可添加一条分支）。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.12.2.2.2.1.1.3.1.1" valign="top" width="50%"><p>创建选择器</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.12.2.2.2.1.1.3.1.2" valign="top" width="50%"><p>选择器条件分支</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><span><img originheight="546" originwidth="778" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.99046153539603205121537970932758:50001231000000:2800:CCD4A05B561D8A9CC1A672371376670A30BED48253051EEF31096C705A09FD11.png" width="436" height="305.9845758354756"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img height="394.03116107465394" originheight="920" originwidth="1018" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.58820831965125398236359168961342:50001231000000:2800:48A6D06DA239E42CD10555C84A95959CC189BE0B0F72019AD55BFEEAD14631DE.png" title="点击放大" width="436"></span></p> </td> </tr>  </tbody></table></div> </div> </li><li>按照任务执行顺序连接对应节点<p><span><img height="278.12960000000004" originheight="520" originwidth="1492" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.21385569698312914267947204681473:50001231000000:2800:70323B2618E3F3CFAB0818EB862BA2C176ADB53A8FE5684A1344294538868584.png" title="点击放大" width="798"></span></p> </li></ol> </li><li>测试上架：点击【试运行】后，进入调试页面，可自行测试整体流程（无法在小艺开放平台调试端插件适配情况，只能测试工作流整体流程）。测试无误后，点击【上架】，进入上架审核阶段，待审核通过，即可在智能体中添加插件。<p><span><img height="585.9847" originheight="1053" originwidth="478" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.22014434209594989763390808821314:50001231000000:2800:4A6C933A86A426F5E48B48B4128845B2F73BEC2EE7B7AC9BC673B9721E10F256.png" title="点击放大" width="266"></span></p> </li></ol> <p><strong>工作流模式智能体编排</strong></p> <p>音频播放场景所需的端插件、工作流都已经开发完成，并成功上架成功后，接下来就是智能体的搭建过程了。</p> <ol><li>创建智能体：可参考上述<a href="/consumer/cn/doc/best-practices/bpta-agent#section369116225258">开发步骤</a>，创建一个工作流模式的智能体；</li><li>编排智能体：进入智能体编排页面，编排智能体的开场对话，添加上架完成的工作流，开发者可按照实际业务需求自行搭建；</li></ol> <p><strong>功能验证</strong></p> <ol><li>调试与测试：调试与预览界面可以进行交互测试，预览实际交互场景，也可点击右上角调试按钮，进入调试详情页，查看详细的调试信息。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.17.1.1.1.3.1.1" valign="top" width="50%"><p>调试与预览</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.17.1.1.1.3.1.2" valign="top" width="50%"><p>调试详情</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p><span><img height="406.2310981641649" originheight="1187" originwidth="1274" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.99343756735094210855336365177112:50001231000000:2800:753A28244FA368EADA756C06EFE5CC1E8FFD8C3C6DD50AFF4A6E20501356C096.png" title="点击放大" width="436"></span></p> </td> <td class="cellrowborder" valign="top" width="50%"><p><span><img height="749.757071700192" originheight="1104" originwidth="642" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.26905374018771593386983136983012:50001231000000:2800:3F357223059BCC8A8B0BD32AA18119E32EDCF4A8F526BC4D3D272E1366B055AD.png" title="点击放大" width="436"></span></p> </td> </tr>  </tbody></table></div> </div> </li><li>真机测试：端插件涉及到端侧的应用，故平台调试无法与端侧应用联调，只能在端侧设备上进行智能体使用效果的真实体验。具体测试流程详见开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/list-of-user-groups-for-real-machine-testing-0000002471264273" target="_blank">真机测试</a>。</li></ol> <p><strong>上架升级</strong></p> <p>功能测试完成后，点击【保存】【上架】即可将智能体提交到上架审核阶段，具体流程可参考开发者指导文档<a href="https://developer.huawei.com/consumer/cn/doc/service/process-introduction-0000002509696971" target="_blank">上/下架、升级流程介绍</a>。上架完成后，可在端侧小艺的智能体页面搜索查询到创建的智能体并使用。效果如下：</p> <p><span><img height="549.4496" originheight="661" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211163352.33672911474523207383613898082721:50001231000000:2800:73FE67C3FEB8BA081E0F7D01A66C102DD42C37747606389C10C2956CD3D2D38E.png" title="点击放大" width="266"></span></p> </div> <div class="tiledSection"><h2 id="section33491017164712">总结<i class="anchor-icon anchor-icon-link" anchorid="section33491017164712" tips="复制节点链接"></i></h2><p>智能体具有拟人化交互与智能决策、多场景需求覆盖的特点，通过 “交互智能化 + 场景定制化” 满足用户与行业需求。<a href="https://developer.huawei.com/consumer/cn/hag/hagindex.html?isInFrame=true&amp;lang=zh_CN#/agentHome/square" target="_blank">小艺智能体平台</a>依托华为技术生态，为开发者提供从创建到上架的全流程工具支持，助力专属智能体的快速落地与实现。</p> </div> </div> <div></div></div>